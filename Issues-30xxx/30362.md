# Issue 30362: Add symplectic structures

archive/issues_030125.json:
```json
{
    "body": "CC:  @tscrim @nthiery @mjungmath @egourgoulhon @mkoeppe\n\nThis ticket implements the basics of symplectic structures,\nlike Poisson brackets and Hamiltonian vector fields.\n\nTODO (as follow-up tickets):\n- Extract general coordinate stuff from `EuclideanSpace`\n  to new class `VectorSpace`, and let `SymplecticVectorSpace`\n  derive from `VectorSpace`\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/30362\n\n",
    "closed_at": "2022-01-31T23:31:45Z",
    "created_at": "2020-08-14T21:32:09Z",
    "labels": [
        "component: manifolds"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.6",
    "title": "Add symplectic structures",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30362",
    "user": "https://github.com/tobiasdiez"
}
```
CC:  @tscrim @nthiery @mjungmath @egourgoulhon @mkoeppe

This ticket implements the basics of symplectic structures,
like Poisson brackets and Hamiltonian vector fields.

TODO (as follow-up tickets):
- Extract general coordinate stuff from `EuclideanSpace`
  to new class `VectorSpace`, and let `SymplecticVectorSpace`
  derive from `VectorSpace`



Issue created by migration from https://trac.sagemath.org/ticket/30362





---

archive/issue_comments_428051.json:
```json
{
    "body": "In my humble opinion, I think the very first step should be to establish a *Poisson manifold*. This is much more general, i.e. symplectic structures / manifolds are special cases of them. Since none of these are implemented yet, it is much easier to start with the more general setup.\n\n> I would like to get some initial feedback, before I cleanup the code and documentation.\n\n\nI am still busy with other things, but as soon as I have some free time, I could go through your code. However, it would be good to at least remove unneccessary methods (like e.g. `hodge_star` or `sqrt_abs_det`) to make the code much more readable and seek your new features immediately.\n\nI noticed that you already added typing. I think, this belongs to another ticket, namely #29775, and should be discussed there before we apply it to new things. There is still this issue with pyflakes and it seems there are still different opinions.\n\n> For me `SymplecticFormParal` is only a implementation detail, so I don't actually want to expose it to the user. Any ideas? (probably needs some modifications in the tensorfield.restrict method).\n\n\nThe use of `...Paral` is of course necessary since structures on manifolds are \"glued together\" via parallelizable parts. I agree in so far that there is no explicit need to expose it to the user since this is all managed via methods in `manifold.py`, that's right. Howver, in my opinion, there's also nothing wrong about it. Since this is a general problem not only restricted to symplectic forms, I suggest you open another ticket if you want to discuss it.",
    "created_at": "2020-08-15T12:17:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428051",
    "user": "https://github.com/mjungmath"
}
```

In my humble opinion, I think the very first step should be to establish a *Poisson manifold*. This is much more general, i.e. symplectic structures / manifolds are special cases of them. Since none of these are implemented yet, it is much easier to start with the more general setup.

> I would like to get some initial feedback, before I cleanup the code and documentation.


I am still busy with other things, but as soon as I have some free time, I could go through your code. However, it would be good to at least remove unneccessary methods (like e.g. `hodge_star` or `sqrt_abs_det`) to make the code much more readable and seek your new features immediately.

I noticed that you already added typing. I think, this belongs to another ticket, namely #29775, and should be discussed there before we apply it to new things. There is still this issue with pyflakes and it seems there are still different opinions.

> For me `SymplecticFormParal` is only a implementation detail, so I don't actually want to expose it to the user. Any ideas? (probably needs some modifications in the tensorfield.restrict method).


The use of `...Paral` is of course necessary since structures on manifolds are "glued together" via parallelizable parts. I agree in so far that there is no explicit need to expose it to the user since this is all managed via methods in `manifold.py`, that's right. Howver, in my opinion, there's also nothing wrong about it. Since this is a general problem not only restricted to symplectic forms, I suggest you open another ticket if you want to discuss it.



---

archive/issue_comments_428052.json:
```json
{
    "body": "I swiftly overviewed your code. It's a nice addition! However, I have some comments:\n\n- I think, this is redundant:\n\n```diff\n         PseudoRiemannianMetric._del_derived(self)\n+        self._del_inverse()\n \n     def _del_inverse(self):\n```\n\n    The method `_del_inverse` is already invoked in `PseudoRiemannianMetric._del_derived`.\n\n- I am not sure that `sharp` and `flat` are proper names for lowering/raising the index w.r.t. a symplectic structure, I presume they are reserved for metrics only. `raise` and `lower` sounds more appropriate to me.\n\n- In my opinion this change is not necessary either:\n\n```diff\n     \"\"\"\n-    def __init__(self, n, name, field, structure, base_manifold=None,\n+    def __init__(self, n, name, field='real', structure=RealDifferentialStructure(), base_manifold=None,\n                  diff_degree=infinity, latex_name=None, start_index=0,\n                  category=None, unique_tag=None):\n```\n\n    The default input is already managed by the factory method `Manifolds`. And in my opinion, it should stay there for maintenance reasons.\n\n- It would be good to add a new category for symplectic manifolds and also a new structure in `manifolds/structure.py`. Besides, I am not sure, is it possible to combine structures? Symplectic and pseudo-Riemannian structures certainly do not exclude each other. If not, I think this is something we should attack at some point. The more structures we allow, the more flexible the framework has to be.\n\n- I still think that starting with Poisson manifolds is a more reasonable approach. Anyway, someone always has to have the time to do it.",
    "created_at": "2020-08-19T17:17:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428052",
    "user": "https://github.com/mjungmath"
}
```

I swiftly overviewed your code. It's a nice addition! However, I have some comments:

- I think, this is redundant:

```diff
         PseudoRiemannianMetric._del_derived(self)
+        self._del_inverse()
 
     def _del_inverse(self):
```

    The method `_del_inverse` is already invoked in `PseudoRiemannianMetric._del_derived`.

- I am not sure that `sharp` and `flat` are proper names for lowering/raising the index w.r.t. a symplectic structure, I presume they are reserved for metrics only. `raise` and `lower` sounds more appropriate to me.

- In my opinion this change is not necessary either:

```diff
     """
-    def __init__(self, n, name, field, structure, base_manifold=None,
+    def __init__(self, n, name, field='real', structure=RealDifferentialStructure(), base_manifold=None,
                  diff_degree=infinity, latex_name=None, start_index=0,
                  category=None, unique_tag=None):
```

    The default input is already managed by the factory method `Manifolds`. And in my opinion, it should stay there for maintenance reasons.

- It would be good to add a new category for symplectic manifolds and also a new structure in `manifolds/structure.py`. Besides, I am not sure, is it possible to combine structures? Symplectic and pseudo-Riemannian structures certainly do not exclude each other. If not, I think this is something we should attack at some point. The more structures we allow, the more flexible the framework has to be.

- I still think that starting with Poisson manifolds is a more reasonable approach. Anyway, someone always has to have the time to do it.



---

archive/issue_events_078643.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-05T19:21:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30362#event-78643"
}
```



---

archive/issue_comments_428053.json:
```json
{
    "body": "Symplectic structures are certainly a nice addition to Sage! Thank you for contributing to this. \n\nI gave a look to the code, but I have to say that in the current state, it is hardly readable for me, because the docstrings are simply copied from other files, without any cleaning nor adaptation of the doctests to the new features introduced here. Can I suggest that you move forward and provide a first version with some minimal documentation and doctests, cleaning out what does not pertain to this ticket. \n\nReplying to [comment:1 gh-mjungmath]:\n> \n> > For me `SymplecticFormParal` is only a implementation detail, so I don't actually want to expose it to the user. Any ideas? (probably needs some modifications in the tensorfield.restrict method).\n\n> \n> The use of `...Paral` is of course necessary since structures on manifolds are \"glued together\" via parallelizable parts. I agree in so far that there is no explicit need to expose it to the user since this is all managed via methods in `manifold.py`, that's right. Howver, in my opinion, there's also nothing wrong about it. Since this is a general problem not only restricted to symplectic forms, I suggest you open another ticket if you want to discuss it.\n\n\n`SymplecticFormParal` is not exposed to the user, since the interface should not be via the class names but rather via a method `M.symplectic_form()` of the manifold `M`, which returns a `SymplecticFormParal` if `M` is parallelizable and a `SymplecticForm` otherwise.\n\nBesides, I agree with Michael's remarks in comment:2.",
    "created_at": "2020-09-07T16:48:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428053",
    "user": "https://github.com/egourgoulhon"
}
```

Symplectic structures are certainly a nice addition to Sage! Thank you for contributing to this. 

I gave a look to the code, but I have to say that in the current state, it is hardly readable for me, because the docstrings are simply copied from other files, without any cleaning nor adaptation of the doctests to the new features introduced here. Can I suggest that you move forward and provide a first version with some minimal documentation and doctests, cleaning out what does not pertain to this ticket. 

Replying to [comment:1 gh-mjungmath]:
> 
> > For me `SymplecticFormParal` is only a implementation detail, so I don't actually want to expose it to the user. Any ideas? (probably needs some modifications in the tensorfield.restrict method).

> 
> The use of `...Paral` is of course necessary since structures on manifolds are "glued together" via parallelizable parts. I agree in so far that there is no explicit need to expose it to the user since this is all managed via methods in `manifold.py`, that's right. Howver, in my opinion, there's also nothing wrong about it. Since this is a general problem not only restricted to symplectic forms, I suggest you open another ticket if you want to discuss it.


`SymplecticFormParal` is not exposed to the user, since the interface should not be via the class names but rather via a method `M.symplectic_form()` of the manifold `M`, which returns a `SymplecticFormParal` if `M` is parallelizable and a `SymplecticForm` otherwise.

Besides, I agree with Michael's remarks in comment:2.



---

archive/issue_comments_428054.json:
```json
{
    "body": "Replying to [comment:4 egourgoulhon]:\n> Can I suggest that you move forward and provide a first version with some minimal documentation and doctests, cleaning out what does not pertain to this ticket. \n\n\n+1",
    "created_at": "2020-09-08T09:17:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428054",
    "user": "https://github.com/mjungmath"
}
```

Replying to [comment:4 egourgoulhon]:
> Can I suggest that you move forward and provide a first version with some minimal documentation and doctests, cleaning out what does not pertain to this ticket. 


+1



---

archive/issue_comments_428055.json:
```json
{
    "body": "Thanks for the feedback. I'll cleanup and improve the code accordingly. I might need a couple of weeks for this however as I'm currently quite busy.",
    "created_at": "2020-09-08T11:02:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428055",
    "user": "https://github.com/tobiasdiez"
}
```

Thanks for the feedback. I'll cleanup and improve the code accordingly. I might need a couple of weeks for this however as I'm currently quite busy.



---

archive/issue_comments_428056.json:
```json
{
    "body": "Thanks for the initial reviews!\n\nReplying to [comment:2 gh-mjungmath]:\n> I swiftly overviewed your code. It's a nice addition! However, I have some comments:\n> \n> - I think, this is redundant:\n> \n> ```\n> #!diff\n>          PseudoRiemannianMetric._del_derived(self)\n> +        self._del_inverse()\n>  \n>      def _del_inverse(self):\n> ```\n> \n>     The method `_del_inverse` is already invoked in `PseudoRiemannianMetric._del_derived`.\n\n\nAgreed! Not sure why I added it in the first place, but I've now reverted this change.\n\n> \n> - I am not sure that `sharp` and `flat` are proper names for lowering/raising the index w.r.t. a symplectic structure, I presume they are reserved for metrics only. `raise` and `lower` sounds more appropriate to me.\n\n\nThe terminology sharp and flat (as well as musical isomorphisms) is standard in symplectic geometry, too. See for example Abraham Marsden Foundations of Mechanics. \n\n> \n> - In my opinion this change is not necessary either:\n> \n> ```\n> #!diff\n>      \"\"\"\n> -    def __init__(self, n, name, field, structure, base_manifold=None,\n> +    def __init__(self, n, name, field='real', structure=RealDifferentialStructure(), base_manifold=None,\n>                   diff_degree=infinity, latex_name=None, start_index=0,\n>                   category=None, unique_tag=None):\n> ```\n> \n>     The default input is already managed by the factory method `Manifolds`. And in my opinion, it should stay there for maintenance reasons.\n\n\nI think, it's strange if the constructor requires more data than actually is required. Although that might be a matter of taste, but I find `M = TopologicalManifold(2, 'M')` more readable than `M = Manifold(2, 'M', structure='topological')`.\n\n> \n> - It would be good to add a new category for symplectic manifolds and also a new structure in `manifolds/structure.py`. Besides, I am not sure, is it possible to combine structures? Symplectic and pseudo-Riemannian structures certainly do not exclude each other. If not, I think this is something we should attack at some point. The more structures we allow, the more flexible the framework has to be.\n\n\nAgreed! But I would like to leave the categorical questions to a follow-up ticket!\n\n> \n> - I still think that starting with Poisson manifolds is a more reasonable approach. Anyway, someone always has to have the time to do it.\n\n\nI'm working on it.",
    "created_at": "2020-11-22T22:17:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428056",
    "user": "https://github.com/tobiasdiez"
}
```

Thanks for the initial reviews!

Replying to [comment:2 gh-mjungmath]:
> I swiftly overviewed your code. It's a nice addition! However, I have some comments:
> 
> - I think, this is redundant:
> 
> ```
> #!diff
>          PseudoRiemannianMetric._del_derived(self)
> +        self._del_inverse()
>  
>      def _del_inverse(self):
> ```
> 
>     The method `_del_inverse` is already invoked in `PseudoRiemannianMetric._del_derived`.


Agreed! Not sure why I added it in the first place, but I've now reverted this change.

> 
> - I am not sure that `sharp` and `flat` are proper names for lowering/raising the index w.r.t. a symplectic structure, I presume they are reserved for metrics only. `raise` and `lower` sounds more appropriate to me.


The terminology sharp and flat (as well as musical isomorphisms) is standard in symplectic geometry, too. See for example Abraham Marsden Foundations of Mechanics. 

> 
> - In my opinion this change is not necessary either:
> 
> ```
> #!diff
>      """
> -    def __init__(self, n, name, field, structure, base_manifold=None,
> +    def __init__(self, n, name, field='real', structure=RealDifferentialStructure(), base_manifold=None,
>                   diff_degree=infinity, latex_name=None, start_index=0,
>                   category=None, unique_tag=None):
> ```
> 
>     The default input is already managed by the factory method `Manifolds`. And in my opinion, it should stay there for maintenance reasons.


I think, it's strange if the constructor requires more data than actually is required. Although that might be a matter of taste, but I find `M = TopologicalManifold(2, 'M')` more readable than `M = Manifold(2, 'M', structure='topological')`.

> 
> - It would be good to add a new category for symplectic manifolds and also a new structure in `manifolds/structure.py`. Besides, I am not sure, is it possible to combine structures? Symplectic and pseudo-Riemannian structures certainly do not exclude each other. If not, I think this is something we should attack at some point. The more structures we allow, the more flexible the framework has to be.


Agreed! But I would like to leave the categorical questions to a follow-up ticket!

> 
> - I still think that starting with Poisson manifolds is a more reasonable approach. Anyway, someone always has to have the time to do it.


I'm working on it.



---

archive/issue_comments_428057.json:
```json
{
    "body": "> > - I am not sure that `sharp` and `flat` are proper names for lowering/raising the index w.r.t. a symplectic structure, I presume they are reserved for metrics only. `raise` and `lower` sounds more appropriate to me.\n \n> \n> The terminology sharp and flat (as well as musical isomorphisms) is standard in symplectic geometry, too. See for example Abraham Marsden Foundations of Mechanics.\n\n\nYou have a page? I only find the terminology 'lowering' and 'raising'.",
    "created_at": "2020-11-24T20:32:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428057",
    "user": "https://github.com/mjungmath"
}
```

> > - I am not sure that `sharp` and `flat` are proper names for lowering/raising the index w.r.t. a symplectic structure, I presume they are reserved for metrics only. `raise` and `lower` sounds more appropriate to me.
 
> 
> The terminology sharp and flat (as well as musical isomorphisms) is standard in symplectic geometry, too. See for example Abraham Marsden Foundations of Mechanics.


You have a page? I only find the terminology 'lowering' and 'raising'.



---

archive/issue_comments_428058.json:
```json
{
    "body": "In the second edition, its definition 3.2.1 (p. 174, chapter about symplectic geometry). They don't write \"sharp\" or \"flat\" as words, but use the musical symbols.",
    "created_at": "2020-11-25T11:12:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428058",
    "user": "https://github.com/tobiasdiez"
}
```

In the second edition, its definition 3.2.1 (p. 174, chapter about symplectic geometry). They don't write "sharp" or "flat" as words, but use the musical symbols.



---

archive/issue_comments_428059.json:
```json
{
    "body": "Replying to [comment:7 gh-tobiasdiez]:\n> \n> Although that might be a matter of taste, but I find `M = TopologicalManifold(2, 'M')` more readable than `M = Manifold(2, 'M', structure='topological')`.\n> \n\nI agree, but the reason for using the function `Manifold` instead of a direct call to a specific class, like `TopologicalManifold`, is to not clutter Sage's global namespace, which is already very large. Likewise, at the user level, one has to use `Manifold(..., structure='symplectic')` instead of `SymplecticManifold(...)`.",
    "created_at": "2020-11-25T12:32:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428059",
    "user": "https://github.com/egourgoulhon"
}
```

Replying to [comment:7 gh-tobiasdiez]:
> 
> Although that might be a matter of taste, but I find `M = TopologicalManifold(2, 'M')` more readable than `M = Manifold(2, 'M', structure='topological')`.
> 

I agree, but the reason for using the function `Manifold` instead of a direct call to a specific class, like `TopologicalManifold`, is to not clutter Sage's global namespace, which is already very large. Likewise, at the user level, one has to use `Manifold(..., structure='symplectic')` instead of `SymplecticManifold(...)`.



---

archive/issue_comments_428060.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2020-11-25T15:54:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428060",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_428061.json:
```json
{
    "body": "Ok, makes sense!\n\nI've continued working on it, introduced Poisson structures, wrote most of the documentation and introduced a few tests. It's not yet finished, but if you have a spare minute I would like to get feedback.\n\nA few questions:\n- I get the following error message. What's the origin, and what do I have to do to make it work?\n\n```\nsrc/sage/manifolds/differentiable/symplectic_form.py:973: in poisson\n    if frame not in self._poisson._components:\nsage/structure/element.pyx:493: in sage.structure.element.Element.__getattr__\n    ???\nsage/structure/element.pyx:506: in sage.structure.element.Element.getattr_from_category\n    ???\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\n>   ???\nE   AttributeError: 'SymplecticVectorSpace_with_category' object has no attribute '__custom_name'\n```\n\n- I'm still somewhat confused by the subclasses that handle the structure on a parallelizable manifold. For example, in the symplectic form class I create the Poisson tensor, give it a name etc. \n\n```\npoisson_name = f'poisson_{self._name}'\npoisson_latex_name = f'{self._latex_name}^{{-1}}'\nself._poisson = PoissonTensorField(self._vmodule, poisson_name, poisson_latex_name)\n```\nHow do I make sure that it derives from `TensorFieldParal` if the manifold is parallelizable? I can of course put the same code in `SymplecticFormParal` and replace `PoissonTensorField` by `PoissonTensorFieldParal` but this appears to be somewhat subopmimal.\n\nMoreover, do I have to copy-paste the documentation from the parent class, or what is the convention?\n\n- How do I obtain a general function on a manifold? On a vector space M, I can do something like\n\n```\nq, p = M.cartesian_coordinates()[:]\nf = M.scalar_field(function('f')(q,p), name='f')\n```\nbut what would be the version on a sphere (in such a way that the code works for M being a vector space and a sphere)?\n\n- Since the hodge star operator makes sense also with respect to a symplectic form, I would propose to move the current method from `Metric` to `DifferentialForm`: `DifferentialForm.hodge_star(Metric|SymplecticForm)` (with an alias in `Metric` and `SymplecticForm`). Opinions?\n\n- What is the best way to test if two differential forms are equal (including / except of their name)?\n\nThanks!",
    "created_at": "2020-11-25T16:06:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428061",
    "user": "https://github.com/tobiasdiez"
}
```

Ok, makes sense!

I've continued working on it, introduced Poisson structures, wrote most of the documentation and introduced a few tests. It's not yet finished, but if you have a spare minute I would like to get feedback.

A few questions:
- I get the following error message. What's the origin, and what do I have to do to make it work?

```
src/sage/manifolds/differentiable/symplectic_form.py:973: in poisson
    if frame not in self._poisson._components:
sage/structure/element.pyx:493: in sage.structure.element.Element.__getattr__
    ???
sage/structure/element.pyx:506: in sage.structure.element.Element.getattr_from_category
    ???
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

>   ???
E   AttributeError: 'SymplecticVectorSpace_with_category' object has no attribute '__custom_name'
```

- I'm still somewhat confused by the subclasses that handle the structure on a parallelizable manifold. For example, in the symplectic form class I create the Poisson tensor, give it a name etc. 

```
poisson_name = f'poisson_{self._name}'
poisson_latex_name = f'{self._latex_name}^{{-1}}'
self._poisson = PoissonTensorField(self._vmodule, poisson_name, poisson_latex_name)
```
How do I make sure that it derives from `TensorFieldParal` if the manifold is parallelizable? I can of course put the same code in `SymplecticFormParal` and replace `PoissonTensorField` by `PoissonTensorFieldParal` but this appears to be somewhat subopmimal.

Moreover, do I have to copy-paste the documentation from the parent class, or what is the convention?

- How do I obtain a general function on a manifold? On a vector space M, I can do something like

```
q, p = M.cartesian_coordinates()[:]
f = M.scalar_field(function('f')(q,p), name='f')
```
but what would be the version on a sphere (in such a way that the code works for M being a vector space and a sphere)?

- Since the hodge star operator makes sense also with respect to a symplectic form, I would propose to move the current method from `Metric` to `DifferentialForm`: `DifferentialForm.hodge_star(Metric|SymplecticForm)` (with an alias in `Metric` and `SymplecticForm`). Opinions?

- What is the best way to test if two differential forms are equal (including / except of their name)?

Thanks!



---

archive/issue_comments_428062.json:
```json
{
    "body": "Replying to [comment:13 gh-tobiasdiez]:\n> \n> - I'm still somewhat confused by the subclasses that handle the structure on a parallelizable manifold. For example, in the symplectic form class I create the Poisson tensor, give it a name etc. \n> \n> ```\n> poisson_name = f'poisson_{self._name}'\n> poisson_latex_name = f'{self._latex_name}^{{-1}}'\n> self._poisson = PoissonTensorField(self._vmodule, poisson_name, poisson_latex_name)\n> ```\n> How do I make sure that it derives from `TensorFieldParal` if the manifold is parallelizable? \n\n\nYou should construct the Poisson tensor from the module of vector fields on the manifold, not by a direct call to `PoissonTensorField`, see the example of `DifferentiableManifold.metric()` in `src/sage/manifods/differentiable/manifold.py`. \n\n> \n> Moreover, do I have to copy-paste the documentation from the parent class, or what is the convention?\n\n\nI don't understand the question, sorry. Could you rephrase it?\n\n> \n> - How do I obtain a general function on a manifold? On a vector space M, I can do something like\n> \n> ```\n> q, p = M.cartesian_coordinates()[:]\n> f = M.scalar_field(function('f')(q,p), name='f')\n> ```\n> but what would be the version on a sphere (in such a way that the code works for M being a vector space and a sphere)?\n\n\nThe symbolic functions created by `function(...)` are functions of coordinates on a given chart; so to construct a generic function on a manifold, you have to pass a dictionary with as many charts as necessary to cover the manifold:\n\n```\n   f = M.scalar_field({X1: function('f_1')(q1, p1), X2: function('f_2')(q2, p2),...})\n```\nwhere `X1` is the chart with coordinates `(q1, p1)`, etc.\n> \n> - Since the hodge star operator makes sense also with respect to a symplectic form, I would propose to move the current method from `Metric` to `DifferentialForm`: `DifferentialForm.hodge_star(Metric|SymplecticForm)` (with an alias in `Metric` and `SymplecticForm`). Opinions?\n\n\nThe Hodge star is already in `DifferentialForm`: it is called `hodge_dual()` there and its code\nis simply `return metric.hodge_star(self)`. \n\n> \n> - What is the best way to test if two differential forms are equal (including / except of their name)?\n\n\nI would say simply  `a == b`.\nThis is actually computing `a - b` (in an efficient way, using the full antisymmetry of `a` and `b`'s components) and tests whether the result is zero.\n\nA question from my side: why is this ticket depending on #30901 and #30748 ? In the ticket description you write *Please ignore the dependencies, these are just there so that I can work locally on my PC.* This looks somewhat odd... \n\nMaybe this is related, but the ticket branch contains the following modified files:\n\n```\n-rw-r--r--\t.gitignore\t9\t\n-rw-r--r--\tsrc/sage/all.py\t6\t\n-rw-r--r--\tsrc/sage/all_cmdline.py\t1\t\n-rw-r--r--\tsrc/sage/env.py\t76\t\n-rw-r--r--\tsrc/sage/libs/gap/util.pyx\t1\t\t\n-rw-r--r--\tsrc/sage/libs/singular/singular.pyx\t11\t\n-rw-r--r--\tsrc/sage/misc/lazy_import.pyx\t69\t\n-rw-r--r--\tsrc/sage/misc/startup_guard.py\t25\t\t\t\n-rw-r--r--\tsrc/test.py\t64\t\n```\nDo they really pertain to this ticket?",
    "created_at": "2020-11-25T18:01:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428062",
    "user": "https://github.com/egourgoulhon"
}
```

Replying to [comment:13 gh-tobiasdiez]:
> 
> - I'm still somewhat confused by the subclasses that handle the structure on a parallelizable manifold. For example, in the symplectic form class I create the Poisson tensor, give it a name etc. 
> 
> ```
> poisson_name = f'poisson_{self._name}'
> poisson_latex_name = f'{self._latex_name}^{{-1}}'
> self._poisson = PoissonTensorField(self._vmodule, poisson_name, poisson_latex_name)
> ```
> How do I make sure that it derives from `TensorFieldParal` if the manifold is parallelizable? 


You should construct the Poisson tensor from the module of vector fields on the manifold, not by a direct call to `PoissonTensorField`, see the example of `DifferentiableManifold.metric()` in `src/sage/manifods/differentiable/manifold.py`. 

> 
> Moreover, do I have to copy-paste the documentation from the parent class, or what is the convention?


I don't understand the question, sorry. Could you rephrase it?

> 
> - How do I obtain a general function on a manifold? On a vector space M, I can do something like
> 
> ```
> q, p = M.cartesian_coordinates()[:]
> f = M.scalar_field(function('f')(q,p), name='f')
> ```
> but what would be the version on a sphere (in such a way that the code works for M being a vector space and a sphere)?


The symbolic functions created by `function(...)` are functions of coordinates on a given chart; so to construct a generic function on a manifold, you have to pass a dictionary with as many charts as necessary to cover the manifold:

```
   f = M.scalar_field({X1: function('f_1')(q1, p1), X2: function('f_2')(q2, p2),...})
```
where `X1` is the chart with coordinates `(q1, p1)`, etc.
> 
> - Since the hodge star operator makes sense also with respect to a symplectic form, I would propose to move the current method from `Metric` to `DifferentialForm`: `DifferentialForm.hodge_star(Metric|SymplecticForm)` (with an alias in `Metric` and `SymplecticForm`). Opinions?


The Hodge star is already in `DifferentialForm`: it is called `hodge_dual()` there and its code
is simply `return metric.hodge_star(self)`. 

> 
> - What is the best way to test if two differential forms are equal (including / except of their name)?


I would say simply  `a == b`.
This is actually computing `a - b` (in an efficient way, using the full antisymmetry of `a` and `b`'s components) and tests whether the result is zero.

A question from my side: why is this ticket depending on #30901 and #30748 ? In the ticket description you write *Please ignore the dependencies, these are just there so that I can work locally on my PC.* This looks somewhat odd... 

Maybe this is related, but the ticket branch contains the following modified files:

```
-rw-r--r--	.gitignore	9	
-rw-r--r--	src/sage/all.py	6	
-rw-r--r--	src/sage/all_cmdline.py	1	
-rw-r--r--	src/sage/env.py	76	
-rw-r--r--	src/sage/libs/gap/util.pyx	1		
-rw-r--r--	src/sage/libs/singular/singular.pyx	11	
-rw-r--r--	src/sage/misc/lazy_import.pyx	69	
-rw-r--r--	src/sage/misc/startup_guard.py	25			
-rw-r--r--	src/test.py	64	
```
Do they really pertain to this ticket?



---

archive/issue_comments_428063.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-11-25T22:33:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428063",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_428064.json:
```json
{
    "body": "Replying to [comment:14 egourgoulhon]:\n> Replying to [comment:13 gh-tobiasdiez]:\n> > \n> > - I'm still somewhat confused by the subclasses that handle the structure on a parallelizable manifold. For example, in the symplectic form class I create the Poisson tensor, give it a name etc. \n> > \n> > ```\n> > poisson_name = f'poisson_{self._name}'\n> > poisson_latex_name = f'{self._latex_name}^{{-1}}'\n> > self._poisson = PoissonTensorField(self._vmodule, poisson_name, poisson_latex_name)\n> > ```\n> > How do I make sure that it derives from `TensorFieldParal` if the manifold is parallelizable? \n\n> \n> You should construct the Poisson tensor from the module of vector fields on the manifold, not by a direct call to `PoissonTensorField`, see the example of `DifferentiableManifold.metric()` in `src/sage/manifods/differentiable/manifold.py`. \n> \n\n\nOk, thanks! That makes sense indeed and worked.\n\n> > \n> > Moreover, do I have to copy-paste the documentation from the parent class, or what is the convention?\n\n> \n> I don't understand the question, sorry. Could you rephrase it?\n> \n\nIf I implement a method in say `PoissonTensorFieldParal` that overrides a method in `PoissonTensorField`, do I have to add documentation/tests/examples to the method in ``PoissonTensorFieldParal` (given that the signature of the method is exactly the same)? \nI think sphinx normally copies the documentation given in the parent class.\n\n> > \n> > - How do I obtain a general function on a manifold? On a vector space M, I can do something like\n> > \n> > ```\n> > q, p = M.cartesian_coordinates()[:]\n> > f = M.scalar_field(function('f')(q,p), name='f')\n> > ```\n> > but what would be the version on a sphere (in such a way that the code works for M being a vector space and a sphere)?\n\n> \n> The symbolic functions created by `function(...)` are functions of coordinates on a given chart; so to construct a generic function on a manifold, you have to pass a dictionary with as many charts as necessary to cover the manifold:\n> \n> ```\n>    f = M.scalar_field({X1: function('f_1')(q1, p1), X2: function('f_2')(q2, p2),...})\n> ```\n> where `X1` is the chart with coordinates `(q1, p1)`, etc.\n\nThat worked! Merci!\n> > \n> > - Since the hodge star operator makes sense also with respect to a symplectic form, I would propose to move the current method from `Metric` to `DifferentialForm`: `DifferentialForm.hodge_star(Metric|SymplecticForm)` (with an alias in `Metric` and `SymplecticForm`). Opinions?\n \n> \n> The Hodge star is already in `DifferentialForm`: it is called `hodge_dual()` there and its code\n> is simply `return metric.hodge_star(self)`. \n> \n> > \n> > - What is the best way to test if two differential forms are equal (including / except of their name)?\n \n> \n> I would say simply  `a == b`.\n> This is actually computing `a - b` (in an efficient way, using the full antisymmetry of `a` and `b`'s components) and tests whether the result is zero.\n\nThat worked as well!\n> \n> A question from my side: why is this ticket depending on #30901 and #30748 ? In the ticket description you write *Please ignore the dependencies, these are just there so that I can work locally on my PC.* This looks somewhat odd... \n> \n> Maybe this is related, but the ticket branch contains the following modified files:\n> \n> ```\n> -rw-r--r--\t.gitignore\t9\t\n> -rw-r--r--\tsrc/sage/all.py\t6\t\n> -rw-r--r--\tsrc/sage/all_cmdline.py\t1\t\n> -rw-r--r--\tsrc/sage/env.py\t76\t\n> -rw-r--r--\tsrc/sage/libs/gap/util.pyx\t1\t\t\n> -rw-r--r--\tsrc/sage/libs/singular/singular.pyx\t11\t\n> -rw-r--r--\tsrc/sage/misc/lazy_import.pyx\t69\t\n> -rw-r--r--\tsrc/sage/misc/startup_guard.py\t25\t\t\t\n> -rw-r--r--\tsrc/test.py\t64\t\n> ```\n> Do they really pertain to this ticket?\n\n\nSorry for these (unnessary) changes. The only way I currently have to work on sage is with the virtual environment created in #30371. The compiled cython however only works correctly if the changes of #30901 and #30748 are included. Thus, until these packages are merged, I have to sadly include them as dependencies on all packages I develop...maybe you or Matthias have a better idea for a workaround.\n\n\nNow all tests are passing (not sure about the doctests), and the only thing left is to change the documentation a bit.\n\n---\nNew commits:",
    "created_at": "2020-11-25T22:36:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428064",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:14 egourgoulhon]:
> Replying to [comment:13 gh-tobiasdiez]:
> > 
> > - I'm still somewhat confused by the subclasses that handle the structure on a parallelizable manifold. For example, in the symplectic form class I create the Poisson tensor, give it a name etc. 
> > 
> > ```
> > poisson_name = f'poisson_{self._name}'
> > poisson_latex_name = f'{self._latex_name}^{{-1}}'
> > self._poisson = PoissonTensorField(self._vmodule, poisson_name, poisson_latex_name)
> > ```
> > How do I make sure that it derives from `TensorFieldParal` if the manifold is parallelizable? 

> 
> You should construct the Poisson tensor from the module of vector fields on the manifold, not by a direct call to `PoissonTensorField`, see the example of `DifferentiableManifold.metric()` in `src/sage/manifods/differentiable/manifold.py`. 
> 


Ok, thanks! That makes sense indeed and worked.

> > 
> > Moreover, do I have to copy-paste the documentation from the parent class, or what is the convention?

> 
> I don't understand the question, sorry. Could you rephrase it?
> 

If I implement a method in say `PoissonTensorFieldParal` that overrides a method in `PoissonTensorField`, do I have to add documentation/tests/examples to the method in ``PoissonTensorFieldParal` (given that the signature of the method is exactly the same)? 
I think sphinx normally copies the documentation given in the parent class.

> > 
> > - How do I obtain a general function on a manifold? On a vector space M, I can do something like
> > 
> > ```
> > q, p = M.cartesian_coordinates()[:]
> > f = M.scalar_field(function('f')(q,p), name='f')
> > ```
> > but what would be the version on a sphere (in such a way that the code works for M being a vector space and a sphere)?

> 
> The symbolic functions created by `function(...)` are functions of coordinates on a given chart; so to construct a generic function on a manifold, you have to pass a dictionary with as many charts as necessary to cover the manifold:
> 
> ```
>    f = M.scalar_field({X1: function('f_1')(q1, p1), X2: function('f_2')(q2, p2),...})
> ```
> where `X1` is the chart with coordinates `(q1, p1)`, etc.

That worked! Merci!
> > 
> > - Since the hodge star operator makes sense also with respect to a symplectic form, I would propose to move the current method from `Metric` to `DifferentialForm`: `DifferentialForm.hodge_star(Metric|SymplecticForm)` (with an alias in `Metric` and `SymplecticForm`). Opinions?
 
> 
> The Hodge star is already in `DifferentialForm`: it is called `hodge_dual()` there and its code
> is simply `return metric.hodge_star(self)`. 
> 
> > 
> > - What is the best way to test if two differential forms are equal (including / except of their name)?
 
> 
> I would say simply  `a == b`.
> This is actually computing `a - b` (in an efficient way, using the full antisymmetry of `a` and `b`'s components) and tests whether the result is zero.

That worked as well!
> 
> A question from my side: why is this ticket depending on #30901 and #30748 ? In the ticket description you write *Please ignore the dependencies, these are just there so that I can work locally on my PC.* This looks somewhat odd... 
> 
> Maybe this is related, but the ticket branch contains the following modified files:
> 
> ```
> -rw-r--r--	.gitignore	9	
> -rw-r--r--	src/sage/all.py	6	
> -rw-r--r--	src/sage/all_cmdline.py	1	
> -rw-r--r--	src/sage/env.py	76	
> -rw-r--r--	src/sage/libs/gap/util.pyx	1		
> -rw-r--r--	src/sage/libs/singular/singular.pyx	11	
> -rw-r--r--	src/sage/misc/lazy_import.pyx	69	
> -rw-r--r--	src/sage/misc/startup_guard.py	25			
> -rw-r--r--	src/test.py	64	
> ```
> Do they really pertain to this ticket?


Sorry for these (unnessary) changes. The only way I currently have to work on sage is with the virtual environment created in #30371. The compiled cython however only works correctly if the changes of #30901 and #30748 are included. Thus, until these packages are merged, I have to sadly include them as dependencies on all packages I develop...maybe you or Matthias have a better idea for a workaround.


Now all tests are passing (not sure about the doctests), and the only thing left is to change the documentation a bit.

---
New commits:



---

archive/issue_comments_428065.json:
```json
{
    "body": "Replying to [comment:16 gh-tobiasdiez]:\n> > A question from my side: why is this ticket depending on #30901 and #30748 ? In the ticket description you write *Please ignore the dependencies, these are just there so that I can work locally on my PC.* This looks somewhat odd... \n\n\nIndeed, this is not the way to do this.\n\n> Sorry for these (unnessary) changes. The only way I currently have to work on sage is with the virtual environment created in #30371. [...]maybe you or Matthias have a better idea for a workaround.\n\n\nI would suggest to create a clean branch starting from the latest beta and to push that to the ticket only.  Use `git cherry-pick` to get the commits from your branch (with the dependencies that you say you need for running Sage) onto the clean branch.  Push the clean branch to the ticket.",
    "created_at": "2020-11-25T23:54:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428065",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:16 gh-tobiasdiez]:
> > A question from my side: why is this ticket depending on #30901 and #30748 ? In the ticket description you write *Please ignore the dependencies, these are just there so that I can work locally on my PC.* This looks somewhat odd... 


Indeed, this is not the way to do this.

> Sorry for these (unnessary) changes. The only way I currently have to work on sage is with the virtual environment created in #30371. [...]maybe you or Matthias have a better idea for a workaround.


I would suggest to create a clean branch starting from the latest beta and to push that to the ticket only.  Use `git cherry-pick` to get the commits from your branch (with the dependencies that you say you need for running Sage) onto the clean branch.  Push the clean branch to the ticket.



---

archive/issue_comments_428066.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-11-27T13:26:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428066",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_428067.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-11-27T16:12:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428067",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_428068.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-12-29T17:00:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428068",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_428069.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-12-29T17:02:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428069",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_428070.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-12-29T17:06:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428070",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_428071.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-12-29T20:12:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428071",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_428072.json:
```json
{
    "body": "So, I think, I'm mostly finished with the implementation. Some of the doctests may still fail and this will be a bit of a tedious procedure since `sage -t` doesn't work for me locally (need to investigate). But it's definitely in a state where I would appreciate feedback!",
    "created_at": "2020-12-29T20:15:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428072",
    "user": "https://github.com/tobiasdiez"
}
```

So, I think, I'm mostly finished with the implementation. Some of the doctests may still fail and this will be a bit of a tedious procedure since `sage -t` doesn't work for me locally (need to investigate). But it's definitely in a state where I would appreciate feedback!



---

archive/issue_comments_428073.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-12-29T20:15:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428073",
    "user": "https://github.com/tobiasdiez"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_428074.json:
```json
{
    "body": "Thank you for your work on this. I will let someone who is more invested in the manifold code give more feedback about the overall implementation and structure. I will focus here on the more technical aspects.\n\nFrom the patchbot, you have at least one infinite recursion to take care of:\n\n```\n**********************************************************************\nFile \"src/sage/manifolds/differentiable/vectorfield.py\", line 1024, in sage.manifolds.differentiable.vectorfield.VectorField.curl\nFailed example:\n    curl(v) == s\nException raised:\n    Traceback (most recent call last):\n      File \"/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 714, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 1133, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.manifolds.differentiable.vectorfield.VectorField.curl[6]>\", line 1, in <module>\n        curl(v) == s\n      File \"/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/manifolds/operators.py\", line 239, in curl\n        return vector.curl()\n      File \"/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/manifolds/differentiable/vectorfield.py\", line 1052, in curl\n        resu = der.hodge_dual(metric).up(metric)\n      File \"/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/manifolds/differentiable/diff_form.py\", line 1568, in hodge_dual\n        return metric.hodge_star(self)\n      File \"/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/manifolds/differentiable/metric.py\", line 1970, in hodge_star\n        return pform.hodge_dual(self)\n      File \"/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/manifolds/differentiable/diff_form.py\", line 1568, in hodge_dual\n```\n\nYou should write all of the docstrings and doctests for all of your methods.\n\nThere are a number of formatting issues with your docstrings:\n\n```diff\n-TESTS:\n+TESTS::\n+\n     sage: import pytest\n     sage: pytest.main(\"symplectic_vector_space_test.py\")\n     TODO: add output\n```\n\n```diff\n     def hamiltonian_vector_field(self, function: DiffScalarField) -> VectorField:\n         r\"\"\"\n         Return the Hamiltonian vector field `X_f` generated by the given function `f: M \\to \\RR`.\n+\n-        It is defined by\n+        The Hamiltonian vector field is defined by\n+\n         .. MATH::\n \n             X_f = - \\varpi^\\sharp (d f),\n \n         where `\\varpi^\\sharp: T^* M \\to TM` is given by\n         `\\beta(\\varpi^\\sharp(\\alpha)) = \\varpi(\\alpha, \\beta)`.\n \n         INPUT:\n+\n         - ```function`` -- the function generating the Hamiltonian vector field\n```\n\n```\n        - ``coordinates`` -- (default: ``'Cartesian'``) the\n          type of coordinates to be initialized at the Euclidean space\n          creation; allowed values are\n\n          * ``'Cartesian'`` (canonical coordinates on `\\RR^{2n}`)\n          * ``'polar'`` for ``dimension=2`` only (see\n            :meth:`~sage.manifolds.differentiable.examples.euclidean.EuclideanPlane.polar_coordinates`)\n        - ``symbols`` -- the coordinate\n          text symbols and LaTeX symbols, with the same conventions as the\n          argument ``coordinates`` in\n          ...\n```\namong others.\n\nI am not sure I agree with using pytest and a test file as opposed to standard docstrings. We are still experimenting with these features.\n\n`poisson_tensor.py` is missing the initial file header info and docstring.\n\nI don't see the reason for the `TYPE_CHECKING`. There are also other ways to add the type info without importing.\n\nI think this docstring is wrong:\n\n```\n    def poisson(self, expansion_symbol: Optional[Expression] = None, order: int = 1) -> TensorFieldParal:\n        r\"\"\"\n        Return the inverse metric.\n```",
    "created_at": "2021-01-05T01:53:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428074",
    "user": "https://github.com/tscrim"
}
```

Thank you for your work on this. I will let someone who is more invested in the manifold code give more feedback about the overall implementation and structure. I will focus here on the more technical aspects.

From the patchbot, you have at least one infinite recursion to take care of:

```
**********************************************************************
File "src/sage/manifolds/differentiable/vectorfield.py", line 1024, in sage.manifolds.differentiable.vectorfield.VectorField.curl
Failed example:
    curl(v) == s
Exception raised:
    Traceback (most recent call last):
      File "/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 714, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 1133, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.manifolds.differentiable.vectorfield.VectorField.curl[6]>", line 1, in <module>
        curl(v) == s
      File "/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/manifolds/operators.py", line 239, in curl
        return vector.curl()
      File "/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/manifolds/differentiable/vectorfield.py", line 1052, in curl
        resu = der.hodge_dual(metric).up(metric)
      File "/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/manifolds/differentiable/diff_form.py", line 1568, in hodge_dual
        return metric.hodge_star(self)
      File "/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/manifolds/differentiable/metric.py", line 1970, in hodge_star
        return pform.hodge_dual(self)
      File "/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/manifolds/differentiable/diff_form.py", line 1568, in hodge_dual
```

You should write all of the docstrings and doctests for all of your methods.

There are a number of formatting issues with your docstrings:

```diff
-TESTS:
+TESTS::
+
     sage: import pytest
     sage: pytest.main("symplectic_vector_space_test.py")
     TODO: add output
```

```diff
     def hamiltonian_vector_field(self, function: DiffScalarField) -> VectorField:
         r"""
         Return the Hamiltonian vector field `X_f` generated by the given function `f: M \to \RR`.
+
-        It is defined by
+        The Hamiltonian vector field is defined by
+
         .. MATH::
 
             X_f = - \varpi^\sharp (d f),
 
         where `\varpi^\sharp: T^* M \to TM` is given by
         `\beta(\varpi^\sharp(\alpha)) = \varpi(\alpha, \beta)`.
 
         INPUT:
+
         - ```function`` -- the function generating the Hamiltonian vector field
```

```
        - ``coordinates`` -- (default: ``'Cartesian'``) the
          type of coordinates to be initialized at the Euclidean space
          creation; allowed values are

          * ``'Cartesian'`` (canonical coordinates on `\RR^{2n}`)
          * ``'polar'`` for ``dimension=2`` only (see
            :meth:`~sage.manifolds.differentiable.examples.euclidean.EuclideanPlane.polar_coordinates`)
        - ``symbols`` -- the coordinate
          text symbols and LaTeX symbols, with the same conventions as the
          argument ``coordinates`` in
          ...
```
among others.

I am not sure I agree with using pytest and a test file as opposed to standard docstrings. We are still experimenting with these features.

`poisson_tensor.py` is missing the initial file header info and docstring.

I don't see the reason for the `TYPE_CHECKING`. There are also other ways to add the type info without importing.

I think this docstring is wrong:

```
    def poisson(self, expansion_symbol: Optional[Expression] = None, order: int = 1) -> TensorFieldParal:
        r"""
        Return the inverse metric.
```



---

archive/issue_comments_428075.json:
```json
{
    "body": "Thanks for the feedback! I've now implemented your suggestions.\n\n> I don't see the reason for the TYPE_CHECKING. There are also other ways to add the type info without importing. \n\n\nWhat \"other ways\" do you mean? These imports are encapsulated by a check for `TYPE_CHECKING`, which is false during runtime and is only set to true by static code analyzers. This is needed to prevent circular inputs or imports from half-initialized modules.",
    "created_at": "2021-01-05T17:24:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428075",
    "user": "https://github.com/tobiasdiez"
}
```

Thanks for the feedback! I've now implemented your suggestions.

> I don't see the reason for the TYPE_CHECKING. There are also other ways to add the type info without importing. 


What "other ways" do you mean? These imports are encapsulated by a check for `TYPE_CHECKING`, which is false during runtime and is only set to true by static code analyzers. This is needed to prevent circular inputs or imports from half-initialized modules.



---

archive/issue_comments_428076.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-01-05T17:24:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428076",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_428077.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-01-05T17:32:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428077",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_428078.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-01-06T12:58:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428078",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_428079.json:
```json
{
    "body": "It might be worth mentioning that there was already an attempt in implementing Poisson structures. A first step had been made with #23429. It'd be beneficial to reuse parts of that code instead of writing new one. In particular, the Poisson tensor field, as you call it, is a bi-vectorfield and hence a multivectorfield in the above sense. It would thus make sense if your Poisson tensor inherits from a multivectorfield.\n\nMoreover, I think it's a good idea to split this ticket into two: one for the Poisson structure and another (dependent on the Poisson structure ticket) for the symplectic structure. That makes the debugging and review much easier.\n\nAt the moment, I am unfortunately busy with other things. If I have some time, I'll take a closer look.",
    "created_at": "2021-01-06T14:07:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428079",
    "user": "https://github.com/mjungmath"
}
```

It might be worth mentioning that there was already an attempt in implementing Poisson structures. A first step had been made with #23429. It'd be beneficial to reuse parts of that code instead of writing new one. In particular, the Poisson tensor field, as you call it, is a bi-vectorfield and hence a multivectorfield in the above sense. It would thus make sense if your Poisson tensor inherits from a multivectorfield.

Moreover, I think it's a good idea to split this ticket into two: one for the Poisson structure and another (dependent on the Poisson structure ticket) for the symplectic structure. That makes the debugging and review much easier.

At the moment, I am unfortunately busy with other things. If I have some time, I'll take a closer look.



---

archive/issue_comments_428080.json:
```json
{
    "body": "And pyflakes is complaining: \n\n```\nsrc/sage/manifolds/differentiable/examples/symplectic_vector_space_test.py:1:1 'sage.all' imported but unused\n\nsrc/sage/manifolds/differentiable/symplectic_form_test.py:5:1 'sage.all' imported but unused\n```",
    "created_at": "2021-01-06T14:08:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428080",
    "user": "https://github.com/mjungmath"
}
```

And pyflakes is complaining: 

```
src/sage/manifolds/differentiable/examples/symplectic_vector_space_test.py:1:1 'sage.all' imported but unused

src/sage/manifolds/differentiable/symplectic_form_test.py:5:1 'sage.all' imported but unused
```



---

archive/issue_comments_428081.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-01-06T16:19:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428081",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_428082.json:
```json
{
    "body": "Thanks for the pointer to the multivector fields! I've not  been aware of their existence. The poisson tensor now inherits from MultivectorField instead of TensorField.\n\nSince the PoissonTensor class is relatively short, and most changes intertwine Poisson and symplectic things (e.g. the up/down methods) I would like to keep them together.\n\nThe `sage.all` imports are needed due to half-finished module imports otherwise. I plan to address this in forthcoming tickets.",
    "created_at": "2021-01-06T16:23:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428082",
    "user": "https://github.com/tobiasdiez"
}
```

Thanks for the pointer to the multivector fields! I've not  been aware of their existence. The poisson tensor now inherits from MultivectorField instead of TensorField.

Since the PoissonTensor class is relatively short, and most changes intertwine Poisson and symplectic things (e.g. the up/down methods) I would like to keep them together.

The `sage.all` imports are needed due to half-finished module imports otherwise. I plan to address this in forthcoming tickets.



---

archive/issue_comments_428083.json:
```json
{
    "body": "Replying to [comment:37 gh-tobiasdiez]:\n> Since the PoissonTensor class is relatively short...\n\n\nJust underlines my argument. ;)\n\nShort code is much easier to review. Besides, since all the symplectic part relies on the Poisson structure, it's good to review that one first.\n\n> The sage.all imports are needed due to half-finished module imports otherwise. I plan to address this in forthcoming tickets. \n\n\nWhat do you mean?",
    "created_at": "2021-01-06T16:33:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428083",
    "user": "https://github.com/mjungmath"
}
```

Replying to [comment:37 gh-tobiasdiez]:
> Since the PoissonTensor class is relatively short...


Just underlines my argument. ;)

Short code is much easier to review. Besides, since all the symplectic part relies on the Poisson structure, it's good to review that one first.

> The sage.all imports are needed due to half-finished module imports otherwise. I plan to address this in forthcoming tickets. 


What do you mean?



---

archive/issue_comments_428084.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-01-06T16:37:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428084",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_428085.json:
```json
{
    "body": "Added #30551 dependency because of __future__.annotations",
    "created_at": "2021-01-06T19:07:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428085",
    "user": "https://github.com/mkoeppe"
}
```

Added #30551 dependency because of __future__.annotations



---

archive/issue_comments_428086.json:
```json
{
    "body": "What's the story behind the `..._test.py` files? Is it related to #30738?",
    "created_at": "2021-01-06T19:36:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428086",
    "user": "https://github.com/mjungmath"
}
```

What's the story behind the `..._test.py` files? Is it related to #30738?



---

archive/issue_comments_428087.json:
```json
{
    "body": "I'd say we should drop these features such as typing, pytest etc. in this ticket for now, otherwise this ticket will stay on hold as long as #30738, #30551, #31003, #29775 etc. and all their follow ups have not been settled.\n\nTaking a look at the discussions, that could take a while, whereas this ticket seems in principle to be ready for review.",
    "created_at": "2021-01-06T19:41:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428087",
    "user": "https://github.com/mjungmath"
}
```

I'd say we should drop these features such as typing, pytest etc. in this ticket for now, otherwise this ticket will stay on hold as long as #30738, #30551, #31003, #29775 etc. and all their follow ups have not been settled.

Taking a look at the discussions, that could take a while, whereas this ticket seems in principle to be ready for review.



---

archive/issue_comments_428088.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-01-06T19:49:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428088",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_428089.json:
```json
{
    "body": "Replying to [comment:38 gh-mjungmath]:\n> > The sage.all imports are needed due to half-finished module imports otherwise. I plan to address this in forthcoming tickets. \n\n> \n> What do you mean?\n\n\nWithout these imports I get the following error:\n\n```\nImportError while importing test module '/mnt/d/Programming/sage/src/sage/manifolds/differentiable/examples/symplectic_vector_space_test.py'.\nHint: make sure your test modules/packages have valid Python names.\nTraceback:\n/usr/lib/python3.8/importlib/__init__.py:127: in import_module\n    return _bootstrap._gcd_import(name[level:], package, level)\nsage/manifolds/differentiable/examples/symplectic_vector_space_test.py:2: in <module>\n    from sage.manifolds.differentiable.symplectic_form import SymplecticForm\nsage/manifolds/differentiable/symplectic_form.py:34: in <module>\n    from sage.symbolic.expression import Expression\nsage/symbolic/expression.pyx:310: in init sage.symbolic.expression\n    from .ring import SR\nsage/symbolic/ring.pyx:1: in init sage.symbolic.ring\n    # -*- coding: utf-8 -*-\nsage/rings/integer.pyx:1: in init sage.rings.integer\n    r\"\"\"\nsage/rings/rational.pyx:95: in init sage.rings.rational\n    import sage.rings.real_mpfr\nsage/rings/real_mpfr.pyx:1: in init sage.rings.real_mpfr\n    r\"\"\"\nsage/libs/mpmath/utils.pyx:1: in init sage.libs.mpmath.utils\n    \"\"\"\nsage/rings/complex_mpfr.pyx:1: in init sage.rings.complex_mpfr\n    \"\"\"\nsage/rings/complex_double.pyx:98: in init sage.rings.complex_double\n    from . import complex_mpfr\nE   ImportError: cannot import name complex_mpfr\n```\nI tried to make progress towards solving this in #30741, but I cannot really work on this until #30371 is merged.",
    "created_at": "2021-01-06T19:59:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428089",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:38 gh-mjungmath]:
> > The sage.all imports are needed due to half-finished module imports otherwise. I plan to address this in forthcoming tickets. 

> 
> What do you mean?


Without these imports I get the following error:

```
ImportError while importing test module '/mnt/d/Programming/sage/src/sage/manifolds/differentiable/examples/symplectic_vector_space_test.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/usr/lib/python3.8/importlib/__init__.py:127: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
sage/manifolds/differentiable/examples/symplectic_vector_space_test.py:2: in <module>
    from sage.manifolds.differentiable.symplectic_form import SymplecticForm
sage/manifolds/differentiable/symplectic_form.py:34: in <module>
    from sage.symbolic.expression import Expression
sage/symbolic/expression.pyx:310: in init sage.symbolic.expression
    from .ring import SR
sage/symbolic/ring.pyx:1: in init sage.symbolic.ring
    # -*- coding: utf-8 -*-
sage/rings/integer.pyx:1: in init sage.rings.integer
    r"""
sage/rings/rational.pyx:95: in init sage.rings.rational
    import sage.rings.real_mpfr
sage/rings/real_mpfr.pyx:1: in init sage.rings.real_mpfr
    r"""
sage/libs/mpmath/utils.pyx:1: in init sage.libs.mpmath.utils
    """
sage/rings/complex_mpfr.pyx:1: in init sage.rings.complex_mpfr
    """
sage/rings/complex_double.pyx:98: in init sage.rings.complex_double
    from . import complex_mpfr
E   ImportError: cannot import name complex_mpfr
```
I tried to make progress towards solving this in #30741, but I cannot really work on this until #30371 is merged.



---

archive/issue_comments_428090.json:
```json
{
    "body": "Replying to [comment:41 gh-mjungmath]:\n> What's the story behind the `..._test.py` files? Is it related to #30738?\n\n\nIt doesn't really rely on #30738, but it uses pytest as well, yes. I'm not a big fan of doctests (as unit tests) and was told that I can always extract them to test files if I prefer that.",
    "created_at": "2021-01-06T20:01:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428090",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:41 gh-mjungmath]:
> What's the story behind the `..._test.py` files? Is it related to #30738?


It doesn't really rely on #30738, but it uses pytest as well, yes. I'm not a big fan of doctests (as unit tests) and was told that I can always extract them to test files if I prefer that.



---

archive/issue_comments_428091.json:
```json
{
    "body": "Replying to [comment:42 gh-mjungmath]:\n> I'd say we should drop these features such as typing, pytest etc. in this ticket for now, otherwise this ticket will stay on hold as long as #30738, #30551, #31003, #29775 etc. and all their follow ups have not been settled.\n\n\nThe added typing doesn't have any dependencies (beyond #30551, which will be merged in 9.4). The pytests rely only on #31003, which is hopefully close to be merged. If you prefer, I can extract the pytests to a new ticket although it feels strange to separate the implementation from its tests.",
    "created_at": "2021-01-06T20:04:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428091",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:42 gh-mjungmath]:
> I'd say we should drop these features such as typing, pytest etc. in this ticket for now, otherwise this ticket will stay on hold as long as #30738, #30551, #31003, #29775 etc. and all their follow ups have not been settled.


The added typing doesn't have any dependencies (beyond #30551, which will be merged in 9.4). The pytests rely only on #31003, which is hopefully close to be merged. If you prefer, I can extract the pytests to a new ticket although it feels strange to separate the implementation from its tests.



---

archive/issue_comments_428092.json:
```json
{
    "body": "Technically, yes. However, I have the feeling that there are still too many open discussions about using pytest and typing and how to pull it on the current framework. I doubt this ticket will get a positive review until everything is clarified in a broader context like #29775 and #30738. See also comment:28 from Travis.\n\nAnyway, I think that symplectic forms are a great and extremely useful addition to Sage! I am looking forward to have that feature acutally in there. Thanks! :)",
    "created_at": "2021-01-06T20:41:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428092",
    "user": "https://github.com/mjungmath"
}
```

Technically, yes. However, I have the feeling that there are still too many open discussions about using pytest and typing and how to pull it on the current framework. I doubt this ticket will get a positive review until everything is clarified in a broader context like #29775 and #30738. See also comment:28 from Travis.

Anyway, I think that symplectic forms are a great and extremely useful addition to Sage! I am looking forward to have that feature acutally in there. Thanks! :)



---

archive/issue_comments_428093.json:
```json
{
    "body": "Replying to [comment:44 gh-tobiasdiez]:\n> I tried to make progress towards solving this in #30741, but I cannot really work on this until #30371 is merged.\n\n\nIt's best to keep workarounds for your experimental setup on your branches and not to push them to tickets. We cannot merge such code and it complicates the discussions in the review. I recommend to use `git add -p` and `git cherry-pick` to make clean branches.",
    "created_at": "2021-01-06T20:49:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428093",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:44 gh-tobiasdiez]:
> I tried to make progress towards solving this in #30741, but I cannot really work on this until #30371 is merged.


It's best to keep workarounds for your experimental setup on your branches and not to push them to tickets. We cannot merge such code and it complicates the discussions in the review. I recommend to use `git add -p` and `git cherry-pick` to make clean branches.



---

archive/issue_events_078644.json:
```json
{
    "actor": "https://github.com/tobiasdiez",
    "created_at": "2021-01-06T21:01:17Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30362#event-78644"
}
```



---

archive/issue_events_078645.json:
```json
{
    "actor": "https://github.com/tobiasdiez",
    "created_at": "2021-01-06T21:01:17Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30362#event-78645"
}
```



---

archive/issue_comments_428094.json:
```json
{
    "body": "Replying to [comment:47 gh-mjungmath]:\n> I have the feeling that there are still too many open discussions about using pytest and typing and how to pull it on the current framework. \n\n\nI agree! Since it's also a lot of work to remove the typing information again, I would say we wait until the development cycle of 9.4 is started, which will resolve #30551 and thereby the other typing tickets. When the time comes, we can reevaluate to split of the pytests to a new ticket.\nI think this is a resonable time plan anyway, since this is my first bigger contribution to sage and I'm expecting quite some comments concerning the actual implementation, beyond pytest and typing.",
    "created_at": "2021-01-06T21:01:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428094",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:47 gh-mjungmath]:
> I have the feeling that there are still too many open discussions about using pytest and typing and how to pull it on the current framework. 


I agree! Since it's also a lot of work to remove the typing information again, I would say we wait until the development cycle of 9.4 is started, which will resolve #30551 and thereby the other typing tickets. When the time comes, we can reevaluate to split of the pytests to a new ticket.
I think this is a resonable time plan anyway, since this is my first bigger contribution to sage and I'm expecting quite some comments concerning the actual implementation, beyond pytest and typing.



---

archive/issue_comments_428095.json:
```json
{
    "body": "Replying to [comment:48 mkoeppe]:\n> It's best to keep workarounds for your experimental setup on your branches and not to push them to tickets. We cannot merge such code and it complicates the discussions in the review. I recommend to use `git add -p` and `git cherry-pick` to make clean branches.\n\n\nThanks, but the problem does not come from my editable setup. Pytest simply doesn't import `sage.all` before importing the test file, and without such an import other imports such as ` from sage.symbolic.expression import Expression` do not work (because they implicitly rely on a certain import order that is provided by sage.all). \nThe reference to #30371 was only because I cannot efficiently work on #30741 without recompiling cython files for which I need #30371.",
    "created_at": "2021-01-06T21:06:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428095",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:48 mkoeppe]:
> It's best to keep workarounds for your experimental setup on your branches and not to push them to tickets. We cannot merge such code and it complicates the discussions in the review. I recommend to use `git add -p` and `git cherry-pick` to make clean branches.


Thanks, but the problem does not come from my editable setup. Pytest simply doesn't import `sage.all` before importing the test file, and without such an import other imports such as ` from sage.symbolic.expression import Expression` do not work (because they implicitly rely on a certain import order that is provided by sage.all). 
The reference to #30371 was only because I cannot efficiently work on #30741 without recompiling cython files for which I need #30371.



---

archive/issue_comments_428096.json:
```json
{
    "body": "Replying to [comment:50 gh-tobiasdiez]:\n> the problem does not come from my editable setup. Pytest simply doesn't import `sage.all` before importing the test file, and without such an import other imports such as ` from sage.symbolic.expression import Expression` do not work (because they implicitly rely on a certain import order that is provided by sage.all). \n\nThanks for the clarification. Would it be enough to do the import in the `src/conftest.py` file added by #31003?",
    "created_at": "2021-01-06T21:25:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428096",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:50 gh-tobiasdiez]:
> the problem does not come from my editable setup. Pytest simply doesn't import `sage.all` before importing the test file, and without such an import other imports such as ` from sage.symbolic.expression import Expression` do not work (because they implicitly rely on a certain import order that is provided by sage.all). 

Thanks for the clarification. Would it be enough to do the import in the `src/conftest.py` file added by #31003?



---

archive/issue_comments_428097.json:
```json
{
    "body": "Replying to [comment:51 mkoeppe]:\n> Thanks for the clarification. Would it be enough to do the import in the `src/conftest.py` file added by #31003?\n\n\nSadly not. The fixture in `conftest.py` does load `sage.all`, but this is only used when the test are run and not on test discovery. Hence, this only prevents these problems on runtime, but not if the import of the test module already fails. Anyway, for the modularization effort is still desired that one can import and use any sage module without using `sage.all` before.",
    "created_at": "2021-01-06T21:48:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428097",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:51 mkoeppe]:
> Thanks for the clarification. Would it be enough to do the import in the `src/conftest.py` file added by #31003?


Sadly not. The fixture in `conftest.py` does load `sage.all`, but this is only used when the test are run and not on test discovery. Hence, this only prevents these problems on runtime, but not if the import of the test module already fails. Anyway, for the modularization effort is still desired that one can import and use any sage module without using `sage.all` before.



---

archive/issue_comments_428098.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2021-04-20T04:25:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428098",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_428099.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-04-20T04:26:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428099",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_428100.json:
```json
{
    "body": "Rebased (squashed) on top of updated #30551",
    "created_at": "2021-04-20T04:26:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428100",
    "user": "https://github.com/mkoeppe"
}
```

Rebased (squashed) on top of updated #30551



---

archive/issue_comments_428101.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2021-04-22T18:39:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428101",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_428102.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2021-04-22T18:39:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428102",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_428103.json:
```json
{
    "body": "Rebased, no longer on top of #30551",
    "created_at": "2021-04-22T18:40:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428103",
    "user": "https://github.com/mkoeppe"
}
```

Rebased, no longer on top of #30551



---

archive/issue_comments_428104.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-04-23T08:11:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428104",
    "user": "https://github.com/tobiasdiez"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_428105.json:
```json
{
    "body": "Thanks!\nFrom my side this is also ready for review!",
    "created_at": "2021-04-23T08:11:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428105",
    "user": "https://github.com/tobiasdiez"
}
```

Thanks!
From my side this is also ready for review!



---

archive/issue_comments_428106.json:
```json
{
    "body": "The ticket still has to depend on #30551, just testing it you don't need the branch to be on top of it.",
    "created_at": "2021-04-23T14:06:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428106",
    "user": "https://github.com/mkoeppe"
}
```

The ticket still has to depend on #30551, just testing it you don't need the branch to be on top of it.



---

archive/issue_comments_428107.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-05-01T10:25:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428107",
    "user": "https://github.com/mjungmath"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_428108.json:
```json
{
    "body": "There are a lot of doctests missing. For example `symplectic_form` and `poisson_tensor` in `differentiable/manifold.py`.",
    "created_at": "2021-05-01T10:25:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428108",
    "user": "https://github.com/mjungmath"
}
```

There are a lot of doctests missing. For example `symplectic_form` and `poisson_tensor` in `differentiable/manifold.py`.



---

archive/issue_comments_428109.json:
```json
{
    "body": "Thanks for the input. That was one point I was struggling with. The tests are there, just in a different file (e.g. differentiable/poisson_tensor.py) and the methods in `manifold.py` is just a convenient helper method. So I was wondering where to add tests, without just copying them all over the place.",
    "created_at": "2021-05-01T10:38:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428109",
    "user": "https://github.com/tobiasdiez"
}
```

Thanks for the input. That was one point I was struggling with. The tests are there, just in a different file (e.g. differentiable/poisson_tensor.py) and the methods in `manifold.py` is just a convenient helper method. So I was wondering where to add tests, without just copying them all over the place.



---

archive/issue_comments_428110.json:
```json
{
    "body": "Well, it is not only about testing but also about documenting. Keep in mind that `EXAMPLE` blocks occur in the official reference manual and therefore provide a guideline for the user how to use that method adequately aside from testing.\n\nHaving the same examples in different places in the documentation isn't necessarily a bad thing. What I usually do is to change some values, dimensions or expressions instead of blindly copy.",
    "created_at": "2021-05-01T10:43:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428110",
    "user": "https://github.com/mjungmath"
}
```

Well, it is not only about testing but also about documenting. Keep in mind that `EXAMPLE` blocks occur in the official reference manual and therefore provide a guideline for the user how to use that method adequately aside from testing.

Having the same examples in different places in the documentation isn't necessarily a bad thing. What I usually do is to change some values, dimensions or expressions instead of blindly copy.



---

archive/issue_comments_428111.json:
```json
{
    "body": "It is also a good idea to add a `SEEALSO` block in the `poisson_tensor` method linking to `differentiable/poisson_tensor.py`.",
    "created_at": "2021-05-01T10:46:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428111",
    "user": "https://github.com/mjungmath"
}
```

It is also a good idea to add a `SEEALSO` block in the `poisson_tensor` method linking to `differentiable/poisson_tensor.py`.



---

archive/issue_comments_428112.json:
```json
{
    "body": "Now that Sage 9.4 beta cycle has started, it would be nice to have this ticket make its way into Sage 9.4.",
    "created_at": "2021-06-07T20:39:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428112",
    "user": "https://github.com/egourgoulhon"
}
```

Now that Sage 9.4 beta cycle has started, it would be nice to have this ticket make its way into Sage 9.4.



---

archive/issue_events_078646.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30362#event-78646"
}
```



---

archive/issue_events_078647.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30362#event-78647"
}
```



---

archive/issue_comments_428113.json:
```json
{
    "body": "Setting a new milestone for this ticket based on a cursory review.",
    "created_at": "2021-07-19T00:44:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428113",
    "user": "https://github.com/mkoeppe"
}
```

Setting a new milestone for this ticket based on a cursory review.



---

archive/issue_comments_428114.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-12-01T15:24:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428114",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_428115.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-12-01T17:11:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428115",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_428116.json:
```json
{
    "body": "Please excuse that it took me so long, but I've finally found the time to cleanup the code.\nThe tests should be complete and pass now, except for the pytests for S2 which fail because of #32953.\nOther than this, this is ready for review.",
    "created_at": "2021-12-01T17:13:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428116",
    "user": "https://github.com/tobiasdiez"
}
```

Please excuse that it took me so long, but I've finally found the time to cleanup the code.
The tests should be complete and pass now, except for the pytests for S2 which fail because of #32953.
Other than this, this is ready for review.



---

archive/issue_comments_428117.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-12-01T17:13:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428117",
    "user": "https://github.com/tobiasdiez"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_428118.json:
```json
{
    "body": "Replying to [comment:68 gh-tobiasdiez]:\n> Please excuse that it took me so long, but I've finally found the time to cleanup the code.\n> The tests should be complete and pass now, except for the pytests for S2 which fail because of #32953.\n> Other than this, this is ready for review.\n\n\nHappy to see that symplectic structures make their way to Sage! I'll have a look in the coming days. Meanwhile, the patchbot reveals that the doctest coverage is not complete. You can check it by yourself by running `sage -coverage src/sage/manifolds`.",
    "created_at": "2021-12-03T09:47:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428118",
    "user": "https://github.com/egourgoulhon"
}
```

Replying to [comment:68 gh-tobiasdiez]:
> Please excuse that it took me so long, but I've finally found the time to cleanup the code.
> The tests should be complete and pass now, except for the pytests for S2 which fail because of #32953.
> Other than this, this is ready for review.


Happy to see that symplectic structures make their way to Sage! I'll have a look in the coming days. Meanwhile, the patchbot reveals that the doctest coverage is not complete. You can check it by yourself by running `sage -coverage src/sage/manifolds`.



---

archive/issue_comments_428119.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-12-04T16:54:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428119",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_428120.json:
```json
{
    "body": "Thanks, I've overlooked that some doctests were missing. Now everything should be in order, except for a few 'false-positves' related to the usage of pytest. For this, I've opened #32975.",
    "created_at": "2021-12-04T17:54:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428120",
    "user": "https://github.com/tobiasdiez"
}
```

Thanks, I've overlooked that some doctests were missing. Now everything should be in order, except for a few 'false-positves' related to the usage of pytest. For this, I've opened #32975.



---

archive/issue_comments_428121.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-12-06T12:25:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428121",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_428122.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-12-06T15:45:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428122",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_428123.json:
```json
{
    "body": "While taking a look to the ticket, I've noticed that the relevant documentation was not generated because there was no entry about symplectic structures in Sage's reference manual. In the above commit, I have therefore added the new file\n\n```\nsrc/doc/en/reference/manifolds/poisson_manifold.rst\n```\nand inserted a reference to it in `index.rst` in the same directory. Then building the documentation failed due to various errors, mostly \n- `EXAMPLES:` to be replaced by `EXAMPLES::` when immediately followed by `sage: ...`\n- `.. MATH::` to be followed by a blank line\n- the bibliographic references `[AM1990]` and  `[RS2007]` are missing in the biblio file\nI fixed those so that the documentation now builds. Note that at the moment (i.e. until #32946 is merged), one cannot use \n`sage -docbuild reference/manifolds html` to quickly generate the relevant part of the reference manual. One has to use `make` instead, which takes much longer time. \n\nFor the references  `[AM1990]` and  `[RS2007]`, I simply turned them into literal text so that the documentation could build; could you please add them in the bibliographic file\n\n```\nsrc/doc/en/reference/references/index.rst\n```",
    "created_at": "2021-12-06T16:04:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428123",
    "user": "https://github.com/egourgoulhon"
}
```

While taking a look to the ticket, I've noticed that the relevant documentation was not generated because there was no entry about symplectic structures in Sage's reference manual. In the above commit, I have therefore added the new file

```
src/doc/en/reference/manifolds/poisson_manifold.rst
```
and inserted a reference to it in `index.rst` in the same directory. Then building the documentation failed due to various errors, mostly 
- `EXAMPLES:` to be replaced by `EXAMPLES::` when immediately followed by `sage: ...`
- `.. MATH::` to be followed by a blank line
- the bibliographic references `[AM1990]` and  `[RS2007]` are missing in the biblio file
I fixed those so that the documentation now builds. Note that at the moment (i.e. until #32946 is merged), one cannot use 
`sage -docbuild reference/manifolds html` to quickly generate the relevant part of the reference manual. One has to use `make` instead, which takes much longer time. 

For the references  `[AM1990]` and  `[RS2007]`, I simply turned them into literal text so that the documentation could build; could you please add them in the bibliographic file

```
src/doc/en/reference/references/index.rst
```



---

archive/issue_comments_428124.json:
```json
{
    "body": "A few comments:\n- The file `src/sage/all_cmdline.py` should not be touched by this ticket.\n- As stated in comment:2, the changes in `TopologicalManifold.__init__` and `DifferentiableManifold.__init__` should be reverted.\n- In the initialization\n  {{{\n  sage: M.<q, p> = EuclideanSpace(2, \"R2\", r\"\\mathbb{R}^2\", symbols=r\"q:q p:p\")\n  }}}\n  the arguments `2` and `symbols` are not necessary. This can be shortened to \n  {{{\n  sage: M.<q,p> = EuclideanSpace(name=\"R2\", latex_name=r\"\\mathbb{R}^2\")\n  }}}\n  Even better, for the sake of clarity, you could use the default in these doctests, since neither the name nor the LaTeX name of the Euclidean space appears:\n  {{{\n  sage: M.<q,p> = EuclideanSpace()\n  }}}\n  See [here](https://doc.sagemath.org/html/en/reference/manifolds/sage/manifolds/differentiable/examples/euclidean.html) for details.\n- In the examples, the following two lines\n  {{{\n  sage: from sage.manifolds.differentiable.poisson_tensor import PoissonTensorField\n  sage: poisson = PoissonTensorField(M, 'varpi')\n  }}}\n  should be replaced by\n  {{{\n  poisson = M.poisson_tensor(name='varpi')\n  }}}\n  since this is the way the end user should use initialize a Poisson tensor.\n- Similarly\n  {{{\n  sage: from sage.manifolds.differentiable.symplectic_form import SymplecticForm\n  sage: omega = SymplecticForm(M, 'omega', r'\\omega')\n  }}}\n  should be replaced by \n  {{{\n  sage: omega = M.symplectic_form(name='omega', latex_name=r'\\omega')\n  }}}",
    "created_at": "2021-12-06T18:41:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428124",
    "user": "https://github.com/egourgoulhon"
}
```

A few comments:
- The file `src/sage/all_cmdline.py` should not be touched by this ticket.
- As stated in comment:2, the changes in `TopologicalManifold.__init__` and `DifferentiableManifold.__init__` should be reverted.
- In the initialization
  {{{
  sage: M.<q, p> = EuclideanSpace(2, "R2", r"\mathbb{R}^2", symbols=r"q:q p:p")
  }}}
  the arguments `2` and `symbols` are not necessary. This can be shortened to 
  {{{
  sage: M.<q,p> = EuclideanSpace(name="R2", latex_name=r"\mathbb{R}^2")
  }}}
  Even better, for the sake of clarity, you could use the default in these doctests, since neither the name nor the LaTeX name of the Euclidean space appears:
  {{{
  sage: M.<q,p> = EuclideanSpace()
  }}}
  See [here](https://doc.sagemath.org/html/en/reference/manifolds/sage/manifolds/differentiable/examples/euclidean.html) for details.
- In the examples, the following two lines
  {{{
  sage: from sage.manifolds.differentiable.poisson_tensor import PoissonTensorField
  sage: poisson = PoissonTensorField(M, 'varpi')
  }}}
  should be replaced by
  {{{
  poisson = M.poisson_tensor(name='varpi')
  }}}
  since this is the way the end user should use initialize a Poisson tensor.
- Similarly
  {{{
  sage: from sage.manifolds.differentiable.symplectic_form import SymplecticForm
  sage: omega = SymplecticForm(M, 'omega', r'\omega')
  }}}
  should be replaced by 
  {{{
  sage: omega = M.symplectic_form(name='omega', latex_name=r'\omega')
  }}}



---

archive/issue_comments_428125.json:
```json
{
    "body": "Something a bit off-topic, but mentioned here a couple of months ago:\n\nReplying to [comment:7 gh-tobiasdiez]:\n> I think, it's strange if the constructor requires more data than actually is required. Although that might be a matter of taste, but I find `M = TopologicalManifold(2, 'M')` more readable than `M = Manifold(2, 'M', structure='topological')`.\n\n\nOn a second thought (after this time) I tend to agree with Tobias, though I also see the point of cluttering Sage's namespace.\n\nWhat if we use the namespace `manifolds`, i.e. `manifolds.TopologicalManifold`, `manifolds.SymplecticManifold`, ..., instead? We already have `manifolds.Sphere`, `manifolds.RealLine`, ..., and it seems quite natural to me adding the above to this namespace, too. This way, we do not clutter the global namespace but maintain the desired convenience. Eric, what do you think?\n\nOf course, this shouldn't be treated in this ticket, rather in a follow-up.",
    "created_at": "2021-12-06T22:24:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428125",
    "user": "https://github.com/mjungmath"
}
```

Something a bit off-topic, but mentioned here a couple of months ago:

Replying to [comment:7 gh-tobiasdiez]:
> I think, it's strange if the constructor requires more data than actually is required. Although that might be a matter of taste, but I find `M = TopologicalManifold(2, 'M')` more readable than `M = Manifold(2, 'M', structure='topological')`.


On a second thought (after this time) I tend to agree with Tobias, though I also see the point of cluttering Sage's namespace.

What if we use the namespace `manifolds`, i.e. `manifolds.TopologicalManifold`, `manifolds.SymplecticManifold`, ..., instead? We already have `manifolds.Sphere`, `manifolds.RealLine`, ..., and it seems quite natural to me adding the above to this namespace, too. This way, we do not clutter the global namespace but maintain the desired convenience. Eric, what do you think?

Of course, this shouldn't be treated in this ticket, rather in a follow-up.



---

archive/issue_comments_428126.json:
```json
{
    "body": "Replying to [comment:77 gh-mjungmath]:\n> \n> What if we use the namespace `manifolds`, i.e. `manifolds.TopologicalManifold`, `manifolds.SymplecticManifold`, ..., instead? We already have `manifolds.Sphere`, `manifolds.RealLine`, ..., and it seems quite natural to me adding the above to this namespace, too. This way, we do not clutter the global namespace but maintain the desired convenience. Eric, what do you think?\n> \n\n\nYes, why not? \n\n> Of course, this shouldn't be treated in this ticket, rather in a follow-up.\n\n\nCertainly.",
    "created_at": "2021-12-06T23:05:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428126",
    "user": "https://github.com/egourgoulhon"
}
```

Replying to [comment:77 gh-mjungmath]:
> 
> What if we use the namespace `manifolds`, i.e. `manifolds.TopologicalManifold`, `manifolds.SymplecticManifold`, ..., instead? We already have `manifolds.Sphere`, `manifolds.RealLine`, ..., and it seems quite natural to me adding the above to this namespace, too. This way, we do not clutter the global namespace but maintain the desired convenience. Eric, what do you think?
> 


Yes, why not? 

> Of course, this shouldn't be treated in this ticket, rather in a follow-up.


Certainly.



---

archive/issue_comments_428127.json:
```json
{
    "body": "Thanks for the feedback. I've incorporated your suggestions and updated the code.\n\nStill have to check for the docs, since building them takes adges...\n\n\nConcerning\n>In the examples, the following two lines\n>\n>sage: from sage.manifolds.differentiable.poisson_tensor import PoissonTensorField\n>sage: poisson = PoissonTensorField(M, 'varpi')\n>\n>should be replaced by\n>\n>poisson = M.poisson_tensor(name='varpi')\n>\n>since this is the way the end user should use initialize a Poisson tensor. \n\n\nI've changed it, but think that it still would be useful to have the examples directly for the constructor. It's similar to what I've mentioned above, but why should `M.poisson_tensor` be superior to `PoissonTensor(M)`? Sure for a normal sage user the first is more convient, as you don't have to import anything. But if you use sage more as a python library, than the latter is maybe your preferred way.",
    "created_at": "2021-12-07T21:29:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428127",
    "user": "https://github.com/tobiasdiez"
}
```

Thanks for the feedback. I've incorporated your suggestions and updated the code.

Still have to check for the docs, since building them takes adges...


Concerning
>In the examples, the following two lines
>
>sage: from sage.manifolds.differentiable.poisson_tensor import PoissonTensorField
>sage: poisson = PoissonTensorField(M, 'varpi')
>
>should be replaced by
>
>poisson = M.poisson_tensor(name='varpi')
>
>since this is the way the end user should use initialize a Poisson tensor. 


I've changed it, but think that it still would be useful to have the examples directly for the constructor. It's similar to what I've mentioned above, but why should `M.poisson_tensor` be superior to `PoissonTensor(M)`? Sure for a normal sage user the first is more convient, as you don't have to import anything. But if you use sage more as a python library, than the latter is maybe your preferred way.



---

archive/issue_comments_428128.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-12-07T21:35:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428128",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_428129.json:
```json
{
    "body": "Replying to [comment:79 gh-tobiasdiez]:\n> Concerning\n> >In the examples, the following two lines\n> >\n> >```\n> >sage: from sage.manifolds.differentiable.poisson_tensor import PoissonTensorField\n> >sage: poisson = PoissonTensorField(M, 'varpi')\n> >```\n> >should be replaced by\n> >\n> >```\n> >poisson = M.poisson_tensor(name='varpi')\n> >```\n> >since this is the way the end user should use initialize a Poisson tensor. \n\n> \n> I've changed it, but think that it still would be useful to have the examples directly for the constructor. It's similar to what I've mentioned above, but why should `M.poisson_tensor` be superior to `PoissonTensor(M)`? Sure for a normal sage user the first is more convient, as you don't have to import anything. But if you use sage more as a python library, than the latter is maybe your preferred way.\n\n\nIt is something that is associated to the manifold, therefore the API should favor the method. (Contrast this to the exterior algebra, which is not associated to its defining base ring.) Plus it means you do not have to care about it being parallelizeable or not. Not only for front-end users because of the lack of import, but we also want people using it as a library to use the method. It also helps avoid a bit circular import hell.\n\nRemove the pytest test and replace them with standard tests. The disassociation with the doctests makes it very easy to miss full coverage (to the point where I have to do a lot of very detailed checking), there are no examples right there in the methods for a future developer to quickly look at, it is a heavier maintenance burden to keep things in sync, and it adds clutter. I also do not want to keep a uniform approach to doctests at this point until there is a large consensus to adopt such a change. This also removes the otherwise unnecessary dependency on #32975.",
    "created_at": "2021-12-08T01:48:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428129",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:79 gh-tobiasdiez]:
> Concerning
> >In the examples, the following two lines
> >
> >```
> >sage: from sage.manifolds.differentiable.poisson_tensor import PoissonTensorField
> >sage: poisson = PoissonTensorField(M, 'varpi')
> >```
> >should be replaced by
> >
> >```
> >poisson = M.poisson_tensor(name='varpi')
> >```
> >since this is the way the end user should use initialize a Poisson tensor. 

> 
> I've changed it, but think that it still would be useful to have the examples directly for the constructor. It's similar to what I've mentioned above, but why should `M.poisson_tensor` be superior to `PoissonTensor(M)`? Sure for a normal sage user the first is more convient, as you don't have to import anything. But if you use sage more as a python library, than the latter is maybe your preferred way.


It is something that is associated to the manifold, therefore the API should favor the method. (Contrast this to the exterior algebra, which is not associated to its defining base ring.) Plus it means you do not have to care about it being parallelizeable or not. Not only for front-end users because of the lack of import, but we also want people using it as a library to use the method. It also helps avoid a bit circular import hell.

Remove the pytest test and replace them with standard tests. The disassociation with the doctests makes it very easy to miss full coverage (to the point where I have to do a lot of very detailed checking), there are no examples right there in the methods for a future developer to quickly look at, it is a heavier maintenance burden to keep things in sync, and it adds clutter. I also do not want to keep a uniform approach to doctests at this point until there is a large consensus to adopt such a change. This also removes the otherwise unnecessary dependency on #32975.



---

archive/issue_comments_428130.json:
```json
{
    "body": "Replying to [comment:81 tscrim]:\n> \n> Remove the pytest test and replace them with standard tests. The disassociation with the doctests makes it very easy to miss full coverage (to the point where I have to do a lot of very detailed checking), there are no examples right there in the methods for a future developer to quickly look at, it is a heavier maintenance burden to keep things in sync, and it adds clutter. I also do not want to keep a uniform approach to doctests at this point until there is a large consensus to adopt such a change. This also removes the otherwise unnecessary dependency on #32975.\n\n\nI fully agree: introducing the pytest framework in Sage does not belong to this ticket. It would be a pity to have to wait for #32975 for having symplectic structures in Sage. Similarly, I don't think #32953 should be a dependency.",
    "created_at": "2021-12-08T09:17:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428130",
    "user": "https://github.com/egourgoulhon"
}
```

Replying to [comment:81 tscrim]:
> 
> Remove the pytest test and replace them with standard tests. The disassociation with the doctests makes it very easy to miss full coverage (to the point where I have to do a lot of very detailed checking), there are no examples right there in the methods for a future developer to quickly look at, it is a heavier maintenance burden to keep things in sync, and it adds clutter. I also do not want to keep a uniform approach to doctests at this point until there is a large consensus to adopt such a change. This also removes the otherwise unnecessary dependency on #32975.


I fully agree: introducing the pytest framework in Sage does not belong to this ticket. It would be a pity to have to wait for #32975 for having symplectic structures in Sage. Similarly, I don't think #32953 should be a dependency.



---

archive/issue_comments_428131.json:
```json
{
    "body": "Replying to [comment:81 tscrim]:\n> Remove the pytest test and replace them with standard tests. The disassociation with the doctests makes it very easy to miss full coverage (to the point where I have to do a lot of very detailed checking), there are no examples right there in the methods for a future developer to quickly look at, it is a heavier maintenance burden to keep things in sync, and it adds clutter. I also do not want to keep a uniform approach to doctests at this point until there is a large consensus to adopt such a change. This also removes the otherwise unnecessary dependency on #32975.\n\n\n+1\n\nReplying to [comment:82 egourgoulhon]:\n> I fully agree: introducing the pytest framework in Sage does not belong to this ticket. It would be a pity to have to wait for #32975 for having symplectic structures in Sage. Similarly, I don't think #32953 should be a dependency. \n\n\n+1",
    "created_at": "2021-12-08T09:22:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428131",
    "user": "https://github.com/mjungmath"
}
```

Replying to [comment:81 tscrim]:
> Remove the pytest test and replace them with standard tests. The disassociation with the doctests makes it very easy to miss full coverage (to the point where I have to do a lot of very detailed checking), there are no examples right there in the methods for a future developer to quickly look at, it is a heavier maintenance burden to keep things in sync, and it adds clutter. I also do not want to keep a uniform approach to doctests at this point until there is a large consensus to adopt such a change. This also removes the otherwise unnecessary dependency on #32975.


+1

Replying to [comment:82 egourgoulhon]:
> I fully agree: introducing the pytest framework in Sage does not belong to this ticket. It would be a pity to have to wait for #32975 for having symplectic structures in Sage. Similarly, I don't think #32953 should be a dependency. 


+1



---

archive/issue_comments_428132.json:
```json
{
    "body": "Pytest is already an optional package for a long time, and it has been integrated in the usual `sage -t` command in #31003. So this ticket here is only using existing infrastructure. Note also that pytest is not essentially used - it only provides consistency and more detailed tests of special cases, every method still has \"normal\" examples in their documentation. The longterm idea is to make pytest a standard package, see #31110. But for this one needs to collect experience with its usage in sage. For example, as you point out the coverage tools needs improvement to be still useful with pytest. I've opened #32994 to keep track of this. Thanks for the suggestion.\n\nI thought ticket dependencies are a natural element of the sage workflow. Since you collectively don't liked them, I've now added a few doctests instead of using the proposed `TEST: pytest` syntax proposed in #32975. Once this ticket is merged one could revert to that syntax as a follow-up. The dependency on #32953 can indeed be removed thanks to the fix by Eric.",
    "created_at": "2021-12-08T12:32:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428132",
    "user": "https://github.com/tobiasdiez"
}
```

Pytest is already an optional package for a long time, and it has been integrated in the usual `sage -t` command in #31003. So this ticket here is only using existing infrastructure. Note also that pytest is not essentially used - it only provides consistency and more detailed tests of special cases, every method still has "normal" examples in their documentation. The longterm idea is to make pytest a standard package, see #31110. But for this one needs to collect experience with its usage in sage. For example, as you point out the coverage tools needs improvement to be still useful with pytest. I've opened #32994 to keep track of this. Thanks for the suggestion.

I thought ticket dependencies are a natural element of the sage workflow. Since you collectively don't liked them, I've now added a few doctests instead of using the proposed `TEST: pytest` syntax proposed in #32975. Once this ticket is merged one could revert to that syntax as a follow-up. The dependency on #32953 can indeed be removed thanks to the fix by Eric.



---

archive/issue_comments_428133.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-12-08T12:33:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428133",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_428134.json:
```json
{
    "body": "Thank you for making the changes.\n\nDependencies are a natural thing, but they still should be relevant to the ticket at-hand. Imposing a dependency because you want to use a new feature you care about is not a good practice IMO. (I feel it is more akin to hostage diplomacy.) To gain experience in using something, one should do a ticket that changes some part of Sage that is more stable that can be compared (or perhaps one that needs some attention because it is older code/doc).",
    "created_at": "2021-12-09T00:31:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428134",
    "user": "https://github.com/tscrim"
}
```

Thank you for making the changes.

Dependencies are a natural thing, but they still should be relevant to the ticket at-hand. Imposing a dependency because you want to use a new feature you care about is not a good practice IMO. (I feel it is more akin to hostage diplomacy.) To gain experience in using something, one should do a ticket that changes some part of Sage that is more stable that can be compared (or perhaps one that needs some attention because it is older code/doc).



---

archive/issue_comments_428135.json:
```json
{
    "body": "Replying to [comment:86 tscrim]:\n> Imposing a dependency because you want to use a new feature you care about is not a good practice IMO. (I feel it is more akin to hostage diplomacy.)\n\n\nSorry that it made this impression. It was actually the other way around: while working on this ticket here, I created #32975 to make my life easier...\n\n> To gain experience in using something, one should do a ticket that changes some part of Sage that is more stable that can be compared.\n\n\nThat's also done, see for example #30738 which awaits review/feedback.",
    "created_at": "2021-12-09T12:50:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428135",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:86 tscrim]:
> Imposing a dependency because you want to use a new feature you care about is not a good practice IMO. (I feel it is more akin to hostage diplomacy.)


Sorry that it made this impression. It was actually the other way around: while working on this ticket here, I created #32975 to make my life easier...

> To gain experience in using something, one should do a ticket that changes some part of Sage that is more stable that can be compared.


That's also done, see for example #30738 which awaits review/feedback.



---

archive/issue_comments_428136.json:
```json
{
    "body": "Thanks for the changes. It seems that we are converging ;-)\n\nA few more points:\n\n- The macro `\\contr` in the docstring of `hamiltonian_vector_field` is not recognized by LaTeX: this produces a red literal `\\contr` in the html documentation and breaks the pdf documentation, as you can easily check by running `sage -docbuild reference/manifolds pdf` (this works, no need to wait for #32946, which regards only the html documentation).\n- The docstring of `SymplecticFormParal` shall not start by `TODO`\n- The unnecessary import `from sage.manifolds.structure import RealDifferentialStructure` should be removed from `differentiable/manifold.py`. \n- The line containing `_dim: int` should be removed from `manifolds/manifold.py` (in other words, the file `manifolds/manifold.py` should not be touched by this ticket)\n- It seems to me that the files `symplectic_form_test.py` and `symplectic_vector_space_test.py` should be removed from this ticket, until #32975 is settled. They are triggering coverage and puflakes errors and are no used in the current test framework.",
    "created_at": "2021-12-10T18:11:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428136",
    "user": "https://github.com/egourgoulhon"
}
```

Thanks for the changes. It seems that we are converging ;-)

A few more points:

- The macro `\contr` in the docstring of `hamiltonian_vector_field` is not recognized by LaTeX: this produces a red literal `\contr` in the html documentation and breaks the pdf documentation, as you can easily check by running `sage -docbuild reference/manifolds pdf` (this works, no need to wait for #32946, which regards only the html documentation).
- The docstring of `SymplecticFormParal` shall not start by `TODO`
- The unnecessary import `from sage.manifolds.structure import RealDifferentialStructure` should be removed from `differentiable/manifold.py`. 
- The line containing `_dim: int` should be removed from `manifolds/manifold.py` (in other words, the file `manifolds/manifold.py` should not be touched by this ticket)
- It seems to me that the files `symplectic_form_test.py` and `symplectic_vector_space_test.py` should be removed from this ticket, until #32975 is settled. They are triggering coverage and puflakes errors and are no used in the current test framework.



---

archive/issue_comments_428137.json:
```json
{
    "body": "Replying to [comment:89 egourgoulhon]:\n> - The macro `\\contr` in the docstring of `hamiltonian_vector_field` is not recognized by LaTeX: this produces a red literal `\\contr` in the html documentation and breaks the pdf documentation, as you can easily check by running `sage -docbuild reference/manifolds pdf` (this works, no need to wait for #32946, which regards only the html documentation).\n\n\nShould be fixed now. I cannot test this, as building the PDF also doesn't work for me:\nRuntimeError: failed to run $MAKE all-pdf in /home/tobias/sage/local/share/doc/sage/latex/en/reference/manifolds\n\n> - The docstring of `SymplecticFormParal` shall not start by `TODO`\n\n\nNicely spotted!\n\n> - The unnecessary import `from sage.manifolds.structure import RealDifferentialStructure` should be removed from `differentiable/manifold.py`. \n\n\nDone!\n\n> - The line containing `_dim: int` should be removed from `manifolds/manifold.py` (in other words, the file `manifolds/manifold.py` should not be touched by this ticket)\n\n\nIt's needed in order to not get typing issues in the new symplectic forms file. I know that there is no check in place (yet?) to verify that all (new) code adheres to typing standards, but I think its good practice to let the typing evolve as one works on the code. Also typing errors are shown as errors for me in VS and as I will be probably the person working on the symplectic code the most in the near future, I would strongly prefer to have such errors as little as possible.\n\n> - It seems to me that the files `symplectic_form_test.py` and `symplectic_vector_space_test.py` should be removed from this ticket, until #32975 is settled. They are triggering coverage and puflakes errors and are no used in the current test framework. \n\n\nThey are invoked by `./sage -t` (if pytest is installed in the sage venv) and run without issues (at least for me). The `sage.all` imports that pyflakes is complaining about are needed due to various cyclic imports. #30741 started the work to remove these cyclic imports, but more work is needed.",
    "created_at": "2021-12-10T21:15:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428137",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:89 egourgoulhon]:
> - The macro `\contr` in the docstring of `hamiltonian_vector_field` is not recognized by LaTeX: this produces a red literal `\contr` in the html documentation and breaks the pdf documentation, as you can easily check by running `sage -docbuild reference/manifolds pdf` (this works, no need to wait for #32946, which regards only the html documentation).


Should be fixed now. I cannot test this, as building the PDF also doesn't work for me:
RuntimeError: failed to run $MAKE all-pdf in /home/tobias/sage/local/share/doc/sage/latex/en/reference/manifolds

> - The docstring of `SymplecticFormParal` shall not start by `TODO`


Nicely spotted!

> - The unnecessary import `from sage.manifolds.structure import RealDifferentialStructure` should be removed from `differentiable/manifold.py`. 


Done!

> - The line containing `_dim: int` should be removed from `manifolds/manifold.py` (in other words, the file `manifolds/manifold.py` should not be touched by this ticket)


It's needed in order to not get typing issues in the new symplectic forms file. I know that there is no check in place (yet?) to verify that all (new) code adheres to typing standards, but I think its good practice to let the typing evolve as one works on the code. Also typing errors are shown as errors for me in VS and as I will be probably the person working on the symplectic code the most in the near future, I would strongly prefer to have such errors as little as possible.

> - It seems to me that the files `symplectic_form_test.py` and `symplectic_vector_space_test.py` should be removed from this ticket, until #32975 is settled. They are triggering coverage and puflakes errors and are no used in the current test framework. 


They are invoked by `./sage -t` (if pytest is installed in the sage venv) and run without issues (at least for me). The `sage.all` imports that pyflakes is complaining about are needed due to various cyclic imports. #30741 started the work to remove these cyclic imports, but more work is needed.



---

archive/issue_comments_428138.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-12-10T21:16:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428138",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_428139.json:
```json
{
    "body": "Yet two more:\n- the `INPUT` blocks of `__init__` methods shall be moved to the main docstring of the class; otherwise, they don't appear in the documentation. Similarly for the `EXAMPLES` section. See e.g. what is done in`diff_form.py`.  Actually, only `TESTS` should appear in the docstring of `__init__` since, as for any private method, its docstring does not appear to the generated documentation. \n- the docstring of `hodge_star` is still in the stage of a copy/paste from the metric one; it should be adapted to the symplectic form. \n \n---\nNew commits:",
    "created_at": "2021-12-10T21:22:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428139",
    "user": "https://github.com/egourgoulhon"
}
```

Yet two more:
- the `INPUT` blocks of `__init__` methods shall be moved to the main docstring of the class; otherwise, they don't appear in the documentation. Similarly for the `EXAMPLES` section. See e.g. what is done in`diff_form.py`.  Actually, only `TESTS` should appear in the docstring of `__init__` since, as for any private method, its docstring does not appear to the generated documentation. 
- the docstring of `hodge_star` is still in the stage of a copy/paste from the metric one; it should be adapted to the symplectic form. 
 
---
New commits:



---

archive/issue_comments_428140.json:
```json
{
    "body": "Replying to [comment:90 gh-tobiasdiez]:\n> Replying to [comment:89 egourgoulhon]:\n> > - The macro `\\contr` in the docstring of `hamiltonian_vector_field` is not recognized by LaTeX: this produces a red literal `\\contr` in the html documentation and breaks the pdf documentation, as you can easily check by running `sage -docbuild reference/manifolds pdf` (this works, no need to wait for #32946, which regards only the html documentation).\n \n> \n> Should be fixed now.\n\n\nYes it is, thanks.\n\n> I cannot test this, as building the PDF also doesn't work for me:\n> RuntimeError: failed to run $MAKE all-pdf in /home/tobias/sage/local/share/doc/sage/latex/en/reference/manifolds\n\n\nStrange... It works for me. Don't you have a more precise error message?\n> \n\n \n> > - The line containing `_dim: int` should be removed from `manifolds/manifold.py` (in other words, the file `manifolds/manifold.py` should not be touched by this ticket)\n \n> \n> It's needed in order to not get typing issues in the new symplectic forms file. I know that there is no check in place (yet?) to verify that all (new) code adheres to typing standards, but I think its good practice to let the typing evolve as one works on the code. Also typing errors are shown as errors for me in VS and as I will be probably the person working on the symplectic code the most in the near future, I would strongly prefer to have such errors as little as possible.\n\n\nOK, very well. \n> \n> > - It seems to me that the files `symplectic_form_test.py` and `symplectic_vector_space_test.py` should be removed from this ticket, until #32975 is settled. They are triggering coverage and puflakes errors and are no used in the current test framework. \n \n> \n> They are invoked by `./sage -t` (if pytest is installed in the sage venv) and run without issues (at least for me). The `sage.all` imports that pyflakes is complaining about are needed due to various cyclic imports. #30741 started the work to remove these cyclic imports, but more work is needed. \n\n\nOK.",
    "created_at": "2021-12-10T21:32:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428140",
    "user": "https://github.com/egourgoulhon"
}
```

Replying to [comment:90 gh-tobiasdiez]:
> Replying to [comment:89 egourgoulhon]:
> > - The macro `\contr` in the docstring of `hamiltonian_vector_field` is not recognized by LaTeX: this produces a red literal `\contr` in the html documentation and breaks the pdf documentation, as you can easily check by running `sage -docbuild reference/manifolds pdf` (this works, no need to wait for #32946, which regards only the html documentation).
 
> 
> Should be fixed now.


Yes it is, thanks.

> I cannot test this, as building the PDF also doesn't work for me:
> RuntimeError: failed to run $MAKE all-pdf in /home/tobias/sage/local/share/doc/sage/latex/en/reference/manifolds


Strange... It works for me. Don't you have a more precise error message?
> 

 
> > - The line containing `_dim: int` should be removed from `manifolds/manifold.py` (in other words, the file `manifolds/manifold.py` should not be touched by this ticket)
 
> 
> It's needed in order to not get typing issues in the new symplectic forms file. I know that there is no check in place (yet?) to verify that all (new) code adheres to typing standards, but I think its good practice to let the typing evolve as one works on the code. Also typing errors are shown as errors for me in VS and as I will be probably the person working on the symplectic code the most in the near future, I would strongly prefer to have such errors as little as possible.


OK, very well. 
> 
> > - It seems to me that the files `symplectic_form_test.py` and `symplectic_vector_space_test.py` should be removed from this ticket, until #32975 is settled. They are triggering coverage and puflakes errors and are no used in the current test framework. 
 
> 
> They are invoked by `./sage -t` (if pytest is installed in the sage venv) and run without issues (at least for me). The `sage.all` imports that pyflakes is complaining about are needed due to various cyclic imports. #30741 started the work to remove these cyclic imports, but more work is needed. 


OK.



---

archive/issue_comments_428141.json:
```json
{
    "body": "Spotted some typos: \"Riemaninan\", \"Poissen\", \"indicies\", \"symplecic\", \"where where\", \"calculate it's\" -> \"calculate its\"",
    "created_at": "2021-12-10T21:58:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428141",
    "user": "https://github.com/mkoeppe"
}
```

Spotted some typos: "Riemaninan", "Poissen", "indicies", "symplecic", "where where", "calculate it's" -> "calculate its"



---

archive/issue_comments_428142.json:
```json
{
    "body": "The documentation of `DifferentiableManifold.poisson_tensor` and `DifferentiableManifold.symplectic_form` is pretty terse. It should contain an `OUTPUT` block with some hyperlink to the class `PoissonTensorField`, thereby providing an easy access to the latter, e.g.\n\n```\nOUTPUT:\n\n- instance of\n  :class:`~sage.manifolds.differentiable.poisson_tensor.PoissonTensorField`\n```",
    "created_at": "2021-12-10T22:25:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428142",
    "user": "https://github.com/egourgoulhon"
}
```

The documentation of `DifferentiableManifold.poisson_tensor` and `DifferentiableManifold.symplectic_form` is pretty terse. It should contain an `OUTPUT` block with some hyperlink to the class `PoissonTensorField`, thereby providing an easy access to the latter, e.g.

```
OUTPUT:

- instance of
  :class:`~sage.manifolds.differentiable.poisson_tensor.PoissonTensorField`
```



---

archive/issue_comments_428143.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-12-10T23:36:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428143",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_428144.json:
```json
{
    "body": "Replying to [comment:9 gh-mjungmath]:\n> > > - I am not sure that `sharp` and `flat` are proper names for lowering/raising the index w.r.t. a symplectic structure, I presume they are reserved for metrics only. `raise` and `lower` sounds more appropriate to me.\n \n> > \n> > The terminology sharp and flat (as well as musical isomorphisms) is standard in symplectic geometry, too. See for example Abraham Marsden Foundations of Mechanics.\n\n> \n> You have a page? I only find the terminology 'lowering' and 'raising'.\n\n\nI looked at that reference, and page 128 calls the maps \"raising\" and \"lowering\". But other sources do use the terminology \"the sharp of ...\" and \"the flat of ...\" for the results of these operations. Other things equal, I think for method names one should prefer verbs. So I would be in favor of `raise()` and `lower()` as well. Just my 2 cents",
    "created_at": "2021-12-11T01:34:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428144",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:9 gh-mjungmath]:
> > > - I am not sure that `sharp` and `flat` are proper names for lowering/raising the index w.r.t. a symplectic structure, I presume they are reserved for metrics only. `raise` and `lower` sounds more appropriate to me.
 
> > 
> > The terminology sharp and flat (as well as musical isomorphisms) is standard in symplectic geometry, too. See for example Abraham Marsden Foundations of Mechanics.

> 
> You have a page? I only find the terminology 'lowering' and 'raising'.


I looked at that reference, and page 128 calls the maps "raising" and "lowering". But other sources do use the terminology "the sharp of ..." and "the flat of ..." for the results of these operations. Other things equal, I think for method names one should prefer verbs. So I would be in favor of `raise()` and `lower()` as well. Just my 2 cents



---

archive/issue_comments_428145.json:
```json
{
    "body": "(However, `raise` is a reserved word.)",
    "created_at": "2021-12-11T01:35:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428145",
    "user": "https://github.com/mkoeppe"
}
```

(However, `raise` is a reserved word.)



---

archive/issue_comments_428146.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-12-12T16:21:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428146",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_428147.json:
```json
{
    "body": "The documentation was broken due to some indentation issue in the bullet list of some `INPUT` blocks. This is fixed in the above commit. In addition, I've \n- corrrected some cut-and-paste typos \n- added docstests to `__init__` methods, which had no longer any\n- changed the doctests of `PoissonTensorField`, `SymplecticForm` and `VectorFieldModule.poisson_tensor` and `VectorFieldModule.symplectic_form` from the Euclidean space to the 2-sphere, since we need here non-parallelizable manifolds (otherwise, the doctest is actually not testing the said method)\n- added some hyperlink to the Schouten-Nijenhuis bracket\n\nA question: in the definition of a symplectic form given in the docstring of `SymplecticForm`, shouldn't one add that `\\omega` must be closed?",
    "created_at": "2021-12-12T16:33:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428147",
    "user": "https://github.com/egourgoulhon"
}
```

The documentation was broken due to some indentation issue in the bullet list of some `INPUT` blocks. This is fixed in the above commit. In addition, I've 
- corrrected some cut-and-paste typos 
- added docstests to `__init__` methods, which had no longer any
- changed the doctests of `PoissonTensorField`, `SymplecticForm` and `VectorFieldModule.poisson_tensor` and `VectorFieldModule.symplectic_form` from the Euclidean space to the 2-sphere, since we need here non-parallelizable manifolds (otherwise, the doctest is actually not testing the said method)
- added some hyperlink to the Schouten-Nijenhuis bracket

A question: in the definition of a symplectic form given in the docstring of `SymplecticForm`, shouldn't one add that `\omega` must be closed?



---

archive/issue_comments_428148.json:
```json
{
    "body": "It would be nice to have this in Sage 9.5. Does everybody agree with the positive review? The doctest error reported by the patchbot does not belong to this ticket and the remaining coverage and pyflakes issues are kind of spurious since they are due to the pytest files `symplectic_form_test.py` and `symplectic_vector_space_test.py` (cf. #32975).",
    "created_at": "2021-12-14T09:28:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428148",
    "user": "https://github.com/egourgoulhon"
}
```

It would be nice to have this in Sage 9.5. Does everybody agree with the positive review? The doctest error reported by the patchbot does not belong to this ticket and the remaining coverage and pyflakes issues are kind of spurious since they are due to the pytest files `symplectic_form_test.py` and `symplectic_vector_space_test.py` (cf. #32975).



---

archive/issue_comments_428149.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-12-14T09:28:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428149",
    "user": "https://github.com/egourgoulhon"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_428150.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2021-12-14T12:16:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428150",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_428151.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2021-12-14T12:16:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428151",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_428152.json:
```json
{
    "body": "Thanks for your additions and the review!\n\nYou are right, symplectic forms need to be closed. I've added it to documentation.",
    "created_at": "2021-12-14T12:17:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428152",
    "user": "https://github.com/tobiasdiez"
}
```

Thanks for your additions and the review!

You are right, symplectic forms need to be closed. I've added it to documentation.



---

archive/issue_comments_428153.json:
```json
{
    "body": "Replying to [comment:104 gh-tobiasdiez]:\n> You are right, symplectic forms need to be closed. I've added it to documentation.\n\n\nThanks!",
    "created_at": "2021-12-14T13:17:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428153",
    "user": "https://github.com/egourgoulhon"
}
```

Replying to [comment:104 gh-tobiasdiez]:
> You are right, symplectic forms need to be closed. I've added it to documentation.


Thanks!



---

archive/issue_comments_428154.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-12-14T13:17:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428154",
    "user": "https://github.com/egourgoulhon"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_428155.json:
```json
{
    "body": "LGTM too.",
    "created_at": "2021-12-14T18:51:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428155",
    "user": "https://github.com/mkoeppe"
}
```

LGTM too.



---

archive/issue_comments_428156.json:
```json
{
    "body": "Why are `manifold.py`, `scalarfield.py` and `subset.py` touched in this ticket?",
    "created_at": "2021-12-14T19:57:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428156",
    "user": "https://github.com/mjungmath"
}
```

Why are `manifold.py`, `scalarfield.py` and `subset.py` touched in this ticket?



---

archive/issue_comments_428157.json:
```json
{
    "body": "Here are some further comments:\n\n- I'd raise an error if the dimension of a symplectic vector space is not even, similarly as you did for symplectic forms.\n- Rather a comment than a necessity to change:\n\n```diff\n             if latex_name is None:\n-                latex_name = \"\\\\omega\"\n+                latex_name = r\"\\omega\"\n```\n\n- Some very minor comments on the documentation:\n\n```diff\n         INPUT:\n\n-        - ``f`` -- first function\n-        - ``g`` -- second function\n+        - ``f`` -- function inserted in the first slot\n+        - ``g`` -- function inserted in the second slot\n```\n\n```diff\n     def volume_form(self, contra: int = 0) -> TensorField:\n         r\"\"\"\n         Liouville volume form `\\omega^n` associated with the symplectic form `\\omega`,\n-        where `2n` is the dimension of the manifold).\n+        where `2n` is the dimension of the manifold.\n-        TODO: Decide about normalization\n```\n\n- I am not sure whether a TODO is supposed to be in the documentation part. I probably would prefer it somewhere in the code. Nevertheless, it'd be nice if you could elaborate a bit more what that is supposed to mean. E.g. if it's a decision, present possible choices. I personally see those snippets as reminder for me and/or as a teaser for other developers who might want to attack this. (As for the former, I tend to forget what I meant by those things if I keep it too vague. :P)\n\nThese are just very minor things. If you want to change it, nice. If not, don't worry.\n\nI may take a closer look soon. But so far it already looks really really nice! :)",
    "created_at": "2021-12-14T20:27:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428157",
    "user": "https://github.com/mjungmath"
}
```

Here are some further comments:

- I'd raise an error if the dimension of a symplectic vector space is not even, similarly as you did for symplectic forms.
- Rather a comment than a necessity to change:

```diff
             if latex_name is None:
-                latex_name = "\\omega"
+                latex_name = r"\omega"
```

- Some very minor comments on the documentation:

```diff
         INPUT:

-        - ``f`` -- first function
-        - ``g`` -- second function
+        - ``f`` -- function inserted in the first slot
+        - ``g`` -- function inserted in the second slot
```

```diff
     def volume_form(self, contra: int = 0) -> TensorField:
         r"""
         Liouville volume form `\omega^n` associated with the symplectic form `\omega`,
-        where `2n` is the dimension of the manifold).
+        where `2n` is the dimension of the manifold.
-        TODO: Decide about normalization
```

- I am not sure whether a TODO is supposed to be in the documentation part. I probably would prefer it somewhere in the code. Nevertheless, it'd be nice if you could elaborate a bit more what that is supposed to mean. E.g. if it's a decision, present possible choices. I personally see those snippets as reminder for me and/or as a teaser for other developers who might want to attack this. (As for the former, I tend to forget what I meant by those things if I keep it too vague. :P)

These are just very minor things. If you want to change it, nice. If not, don't worry.

I may take a closer look soon. But so far it already looks really really nice! :)



---

archive/issue_comments_428158.json:
```json
{
    "body": "Replying to [comment:107 gh-mjungmath]:\n> Why are `manifold.py`, `scalarfield.py` and `subset.py` touched in this ticket?\n\n\nThis is needed for the correct typing in the newly added classes, see #30362#comment:93 for discussion on this point.\n\nThanks for the other suggestions. I've now implemented them.",
    "created_at": "2021-12-15T17:13:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428158",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:107 gh-mjungmath]:
> Why are `manifold.py`, `scalarfield.py` and `subset.py` touched in this ticket?


This is needed for the correct typing in the newly added classes, see #30362#comment:93 for discussion on this point.

Thanks for the other suggestions. I've now implemented them.



---

archive/issue_comments_428159.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2021-12-15T17:13:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428159",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_428160.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2021-12-15T17:13:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428160",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_428161.json:
```json
{
    "body": "The new class is called `SymplecticVectorSpace` but as far as I can see there is no vector space structure implemented: Elements are points and cannot be added or scaled.\n\nPerhaps, if it's not too late for this change, it should be called just `SymplecticSpace` (similar to `EuclideanSpace`) and we reserve the name `SymplecticVectorSpace` for later.",
    "created_at": "2021-12-15T19:54:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428161",
    "user": "https://github.com/mkoeppe"
}
```

The new class is called `SymplecticVectorSpace` but as far as I can see there is no vector space structure implemented: Elements are points and cannot be added or scaled.

Perhaps, if it's not too late for this change, it should be called just `SymplecticSpace` (similar to `EuclideanSpace`) and we reserve the name `SymplecticVectorSpace` for later.



---

archive/issue_comments_428162.json:
```json
{
    "body": "... or perhaps `AffineSymplecticSpace`.",
    "created_at": "2021-12-15T19:59:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428162",
    "user": "https://github.com/mkoeppe"
}
```

... or perhaps `AffineSymplecticSpace`.



---

archive/issue_comments_428163.json:
```json
{
    "body": "In particular, `sage.modules` already has vector spaces that can be equipped with an arbitrary bilinear form - https://doc.sagemath.org/html/en/reference/modules/sage/modules/free_module.html#sage.modules.free_module.FreeModule; symplectic vector spaces are merely a special case.",
    "created_at": "2021-12-15T20:30:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428163",
    "user": "https://github.com/mkoeppe"
}
```

In particular, `sage.modules` already has vector spaces that can be equipped with an arbitrary bilinear form - https://doc.sagemath.org/html/en/reference/modules/sage/modules/free_module.html#sage.modules.free_module.FreeModule; symplectic vector spaces are merely a special case.



---

archive/issue_comments_428164.json:
```json
{
    "body": "Another thing. I think it is better to use Sage's factorial function in `symplectic_form.py`, and import this function in the only method where it is needed, namely `volume_form`:\n\n```diff\n from __future__ import annotations\n from six.moves import range\n from typing import Dict, Union, Optional\n-from math import factorial\n```\n\n```diff\n             sage: vol = omega.volume_form() ; vol\n             4-form mu_omega on the 4-dimensional symplectic vector space R4\n             sage: vol.display()\n             mu_omega = dq1\u2227dp1\u2227dq2\u2227dp2\n         \"\"\"\n+        from sage.functions.other import factorial\n+\n         if self._vol_form is None:\n```",
    "created_at": "2021-12-15T20:35:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428164",
    "user": "https://github.com/mjungmath"
}
```

Another thing. I think it is better to use Sage's factorial function in `symplectic_form.py`, and import this function in the only method where it is needed, namely `volume_form`:

```diff
 from __future__ import annotations
 from six.moves import range
 from typing import Dict, Union, Optional
-from math import factorial
```

```diff
             sage: vol = omega.volume_form() ; vol
             4-form mu_omega on the 4-dimensional symplectic vector space R4
             sage: vol.display()
             mu_omega = dq1dp1dq2dp2
         """
+        from sage.functions.other import factorial
+
         if self._vol_form is None:
```



---

archive/issue_comments_428165.json:
```json
{
    "body": "Replying to [comment:111 mkoeppe]:\n> The new class is called `SymplecticVectorSpace` but as far as I can see there is no vector space structure implemented: Elements are points and cannot be added or scaled.\n\n\nThat's true. As written in the ticket description, the plan is to provide a \"vector space as a manifold\" example that should be used as the base class for `SymplecticVectorSpace`.\n\n> .. or perhaps AffineSymplecticSpace. \n\n\nNot sure if one needs this generalization, and even then one probably wants to say that its an affine space modeled on a symplectic vector space.",
    "created_at": "2021-12-15T20:40:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428165",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:111 mkoeppe]:
> The new class is called `SymplecticVectorSpace` but as far as I can see there is no vector space structure implemented: Elements are points and cannot be added or scaled.


That's true. As written in the ticket description, the plan is to provide a "vector space as a manifold" example that should be used as the base class for `SymplecticVectorSpace`.

> .. or perhaps AffineSymplecticSpace. 


Not sure if one needs this generalization, and even then one probably wants to say that its an affine space modeled on a symplectic vector space.



---

archive/issue_comments_428166.json:
```json
{
    "body": "Replying to [comment:114 gh-mjungmath]:\n> Another thing. I think it is better to use Sage's factorial function in `symplectic_form.py`\n\n\nI was wondering about this too, but in the end decided for the built-in factorial since the numbers for which one calculates this are very small (and are dominated by the n-th wedge product anyway). So I used the factorial from math to not pull-in some dependencies.\nBut I can change this of course.",
    "created_at": "2021-12-15T20:42:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428166",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:114 gh-mjungmath]:
> Another thing. I think it is better to use Sage's factorial function in `symplectic_form.py`


I was wondering about this too, but in the end decided for the built-in factorial since the numbers for which one calculates this are very small (and are dominated by the n-th wedge product anyway). So I used the factorial from math to not pull-in some dependencies.
But I can change this of course.



---

archive/issue_comments_428167.json:
```json
{
    "body": "Replying to [comment:116 gh-tobiasdiez]:\n> to not pull-in some dependencies.\n\n\nThis does not matter here because `sage.manifolds` already depends on all of `sage.symbolic` and `sage.functions`",
    "created_at": "2021-12-15T20:44:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428167",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:116 gh-tobiasdiez]:
> to not pull-in some dependencies.


This does not matter here because `sage.manifolds` already depends on all of `sage.symbolic` and `sage.functions`



---

archive/issue_comments_428168.json:
```json
{
    "body": "Replying to [comment:115 gh-tobiasdiez]:\n> > .. or perhaps AffineSymplecticSpace. \n  \n> \n> Not sure if one needs this generalization, and even then one probably wants to say that its an affine space modeled on a symplectic vector space.\n\n\nI don't know, one could just say it's an affine space with a translation-invariant symplectic form.",
    "created_at": "2021-12-15T20:45:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428168",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:115 gh-tobiasdiez]:
> > .. or perhaps AffineSymplecticSpace. 
  
> 
> Not sure if one needs this generalization, and even then one probably wants to say that its an affine space modeled on a symplectic vector space.


I don't know, one could just say it's an affine space with a translation-invariant symplectic form.



---

archive/issue_comments_428169.json:
```json
{
    "body": "Replying to [ticket:30362 gh-tobiasdiez]:\n> TODO (as follow-up tickets):\n> - Extract general coordinate stuff from `EuclideanSpace`\n>   to new class `VectorSpace`, and let `SymplecticVectorSpace`\n>   derive from `VectorSpace`\n\n\nWe will have to be very careful with the design of this so that we do not add a 4th incompatible implementation of finite-dimensional vector spaces in Sage in this way. (We already have 3, implemented in `sage.modules`, `sage.combinat.free_module`, and `sage.tensor.modules`, respectively, see the constructor in https://doc.sagemath.org/html/en/reference/modules/sage/modules/free_module.html#sage.modules.free_module.FreeModule)\n\nThat's why I would urge to set the vector space side of things aside and only focus on the (affine) symplectic space here on this ticket. \n\nThe relation of \n- free modules with a symplectic form to `SymplecticSpace` \n- free modules with a positive definite form to `EuclideanSpace`\nshould be done in one follow up ticket.",
    "created_at": "2021-12-15T20:55:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428169",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [ticket:30362 gh-tobiasdiez]:
> TODO (as follow-up tickets):
> - Extract general coordinate stuff from `EuclideanSpace`
>   to new class `VectorSpace`, and let `SymplecticVectorSpace`
>   derive from `VectorSpace`


We will have to be very careful with the design of this so that we do not add a 4th incompatible implementation of finite-dimensional vector spaces in Sage in this way. (We already have 3, implemented in `sage.modules`, `sage.combinat.free_module`, and `sage.tensor.modules`, respectively, see the constructor in https://doc.sagemath.org/html/en/reference/modules/sage/modules/free_module.html#sage.modules.free_module.FreeModule)

That's why I would urge to set the vector space side of things aside and only focus on the (affine) symplectic space here on this ticket. 

The relation of 
- free modules with a symplectic form to `SymplecticSpace` 
- free modules with a positive definite form to `EuclideanSpace`
should be done in one follow up ticket.



---

archive/issue_comments_428170.json:
```json
{
    "body": "Replying to [comment:117 mkoeppe]:\n> Replying to [comment:116 gh-tobiasdiez]:\n> > to not pull-in some dependencies.\n\n> \n> This does not matter here because `sage.manifolds` already depends on all of `sage.symbolic` and `sage.functions`\n\n\nUnfortunately, I am not an expert in this import business. Why does `sage.manifolds` matter here? And doesn't `factorial` belong to `sage.functions.other`? Wouldn't that make a difference, too? Notice that you did the same in `diff_form.py`:\n\n```diff\n@@ -732,9 +746,22 @@ class DiffForm(TensorField):\n         :meth:`~sage.manifolds.differentiable.metric.PseudoRiemannianMetric.hodge_star`\n         for more examples.\n         \"\"\"\n-        if metric is None:\n-            metric = self._vmodule._ambient_domain.metric()\n-        return metric.hodge_star(self)\n+        from sage.functions.other import factorial\n```",
    "created_at": "2021-12-16T08:15:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428170",
    "user": "https://github.com/mjungmath"
}
```

Replying to [comment:117 mkoeppe]:
> Replying to [comment:116 gh-tobiasdiez]:
> > to not pull-in some dependencies.

> 
> This does not matter here because `sage.manifolds` already depends on all of `sage.symbolic` and `sage.functions`


Unfortunately, I am not an expert in this import business. Why does `sage.manifolds` matter here? And doesn't `factorial` belong to `sage.functions.other`? Wouldn't that make a difference, too? Notice that you did the same in `diff_form.py`:

```diff
@@ -732,9 +746,22 @@ class DiffForm(TensorField):
         :meth:`~sage.manifolds.differentiable.metric.PseudoRiemannianMetric.hodge_star`
         for more examples.
         """
-        if metric is None:
-            metric = self._vmodule._ambient_domain.metric()
-        return metric.hodge_star(self)
+        from sage.functions.other import factorial
```



---

archive/issue_comments_428171.json:
```json
{
    "body": "Replying to [comment:119 mkoeppe]:\n> Replying to [ticket:30362 gh-tobiasdiez]:\n> > TODO (as follow-up tickets):\n> > - Extract general coordinate stuff from `EuclideanSpace`\n> >   to new class `VectorSpace`, and let `SymplecticVectorSpace`\n> >   derive from `VectorSpace`\n \n> \n> We will have to be very careful with the design of this so that we do not add a 4th incompatible implementation of finite-dimensional vector spaces in Sage in this way. (We already have 3, implemented in `sage.modules`, `sage.combinat.free_module`, and `sage.tensor.modules`, respectively, see the constructor in https://doc.sagemath.org/html/en/reference/modules/sage/modules/free_module.html#sage.modules.free_module.FreeModule)\n\n\n+1\n\n> \n> That's why I would urge to set the vector space side of things aside and only focus on the (affine) symplectic space here on this ticket. \n> \n> The relation of \n> - free modules with a symplectic form to `SymplecticSpace` \n> - free modules with a positive definite form to `EuclideanSpace`\n> should be done in one follow up ticket.\n\n\n+1\n\nIn the current state, `SymplecticVectorSpace` is simply a subclass of `EuclideanSpace`, which is fine at this stage. Maybe, following  Matthias' recommendation, just rename it to `AffineSymplecticSpace` (despite there is no affine structure explicitly implemented). IMHO, `SymplecticSpace` would be too general, sounding like a synonym for `SymplecticManifold`.\n\nBesides, I agree with Michael: import `factorial` as in `diff_form.py`.",
    "created_at": "2021-12-16T15:23:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428171",
    "user": "https://github.com/egourgoulhon"
}
```

Replying to [comment:119 mkoeppe]:
> Replying to [ticket:30362 gh-tobiasdiez]:
> > TODO (as follow-up tickets):
> > - Extract general coordinate stuff from `EuclideanSpace`
> >   to new class `VectorSpace`, and let `SymplecticVectorSpace`
> >   derive from `VectorSpace`
 
> 
> We will have to be very careful with the design of this so that we do not add a 4th incompatible implementation of finite-dimensional vector spaces in Sage in this way. (We already have 3, implemented in `sage.modules`, `sage.combinat.free_module`, and `sage.tensor.modules`, respectively, see the constructor in https://doc.sagemath.org/html/en/reference/modules/sage/modules/free_module.html#sage.modules.free_module.FreeModule)


+1

> 
> That's why I would urge to set the vector space side of things aside and only focus on the (affine) symplectic space here on this ticket. 
> 
> The relation of 
> - free modules with a symplectic form to `SymplecticSpace` 
> - free modules with a positive definite form to `EuclideanSpace`
> should be done in one follow up ticket.


+1

In the current state, `SymplecticVectorSpace` is simply a subclass of `EuclideanSpace`, which is fine at this stage. Maybe, following  Matthias' recommendation, just rename it to `AffineSymplecticSpace` (despite there is no affine structure explicitly implemented). IMHO, `SymplecticSpace` would be too general, sounding like a synonym for `SymplecticManifold`.

Besides, I agree with Michael: import `factorial` as in `diff_form.py`.



---

archive/issue_comments_428172.json:
```json
{
    "body": "To keep the old behavior of `hodge_dual`, I'd suggest to fall back on the metric if no input has been given, otherwise an `AttributeError` will be thrown (which didn't happen before):\n\n```diff\n         from sage.functions.other import factorial\n         from sage.tensor.modules.format_utilities import format_unop_txt, \\\n                                                          format_unop_latex\n\n+        if nondegenerate_tensor is None:\n+            nondegenerate_tensor = self._vmodule._ambient_domain.metric()\n\n         p = self.tensor_type()[1]\n         eps = nondegenerate_tensor.volume_form(p)\n```\n\nAccordingly, this behavior should be documented.",
    "created_at": "2021-12-16T15:39:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428172",
    "user": "https://github.com/mjungmath"
}
```

To keep the old behavior of `hodge_dual`, I'd suggest to fall back on the metric if no input has been given, otherwise an `AttributeError` will be thrown (which didn't happen before):

```diff
         from sage.functions.other import factorial
         from sage.tensor.modules.format_utilities import format_unop_txt, \
                                                          format_unop_latex

+        if nondegenerate_tensor is None:
+            nondegenerate_tensor = self._vmodule._ambient_domain.metric()

         p = self.tensor_type()[1]
         eps = nondegenerate_tensor.volume_form(p)
```

Accordingly, this behavior should be documented.



---

archive/issue_comments_428173.json:
```json
{
    "body": "Replying to [comment:122 gh-mjungmath]:\n> To keep the old behavior of `hodge_dual`, I'd suggest to fall back on the metric if no input has been given, otherwise an `AttributeError` will be thrown (which didn't happen before):\n> \n> \n> ```diff\n>          from sage.functions.other import factorial\n>          from sage.tensor.modules.format_utilities import format_unop_txt, \\\n>                                                           format_unop_latex\n> \n> +        if nondegenerate_tensor is None:\n> +            nondegenerate_tensor = self._vmodule._ambient_domain.metric()\n> \n>          p = self.tensor_type()[1]\n>          eps = nondegenerate_tensor.volume_form(p)\n> ```\n> \n> Accordingly, this behavior should be documented.\n\n\nIn any case, if we *really* want to change this behavior, I'd opt for a more meaningful error message than `NoneType object has no attribute...`.",
    "created_at": "2021-12-16T15:47:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428173",
    "user": "https://github.com/mjungmath"
}
```

Replying to [comment:122 gh-mjungmath]:
> To keep the old behavior of `hodge_dual`, I'd suggest to fall back on the metric if no input has been given, otherwise an `AttributeError` will be thrown (which didn't happen before):
> 
> 
> ```diff
>          from sage.functions.other import factorial
>          from sage.tensor.modules.format_utilities import format_unop_txt, \
>                                                           format_unop_latex
> 
> +        if nondegenerate_tensor is None:
> +            nondegenerate_tensor = self._vmodule._ambient_domain.metric()
> 
>          p = self.tensor_type()[1]
>          eps = nondegenerate_tensor.volume_form(p)
> ```
> 
> Accordingly, this behavior should be documented.


In any case, if we *really* want to change this behavior, I'd opt for a more meaningful error message than `NoneType object has no attribute...`.



---

archive/issue_comments_428174.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-12-16T18:44:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428174",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_428175.json:
```json
{
    "body": "I've now implemented the your suggestions except for the name change to \"AffineSymplecticSpace\". I agree that from a mathematical perspective \"affine\" has some justification, but in the end a affine symplectic space is diffeomorphic (even symplectomorphic) to a symplectic vector space; thus from a manifolds perspective there is no difference. More importantly, this class is meant as an example for symplectic manifolds (mostly for the doctests) and all textbooks talk about symplectic vector space but almost no one is interested in affine ones (google has like 800 hits for \"affine symplectic space\").",
    "created_at": "2021-12-16T18:52:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428175",
    "user": "https://github.com/tobiasdiez"
}
```

I've now implemented the your suggestions except for the name change to "AffineSymplecticSpace". I agree that from a mathematical perspective "affine" has some justification, but in the end a affine symplectic space is diffeomorphic (even symplectomorphic) to a symplectic vector space; thus from a manifolds perspective there is no difference. More importantly, this class is meant as an example for symplectic manifolds (mostly for the doctests) and all textbooks talk about symplectic vector space but almost no one is interested in affine ones (google has like 800 hits for "affine symplectic space").



---

archive/issue_comments_428176.json:
```json
{
    "body": "How is the vector space structure used? It seems to me that there is some conflation of the space and its (constant) tangent space happening.",
    "created_at": "2021-12-16T19:02:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428176",
    "user": "https://github.com/mkoeppe"
}
```

How is the vector space structure used? It seems to me that there is some conflation of the space and its (constant) tangent space happening.



---

archive/issue_comments_428177.json:
```json
{
    "body": "Note that also most linear algebra textbooks also talk about vector spaces all the time even when they manipulate points in an affine space, not vectors in a vector space.",
    "created_at": "2021-12-16T19:06:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428177",
    "user": "https://github.com/mkoeppe"
}
```

Note that also most linear algebra textbooks also talk about vector spaces all the time even when they manipulate points in an affine space, not vectors in a vector space.



---

archive/issue_comments_428178.json:
```json
{
    "body": "The manifold package currently doesn't provide a way to define a manifold abstractly (i.e. by specifying its points), instead a manifold is given in terms of its chart. But an affine and a vector space both have a single chart covering the whole space, the only difference being that there is no \"canonical\" choice in the affine case while there is one in the vector space setting.\n\nThe \"correct\" name of this class would be \"a symplectic manifold symplectomorphic to R2n with its standard symplectic form\". For me \"symplectic vector space\" is a good-enough approximation to this truth.",
    "created_at": "2021-12-16T19:12:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428178",
    "user": "https://github.com/tobiasdiez"
}
```

The manifold package currently doesn't provide a way to define a manifold abstractly (i.e. by specifying its points), instead a manifold is given in terms of its chart. But an affine and a vector space both have a single chart covering the whole space, the only difference being that there is no "canonical" choice in the affine case while there is one in the vector space setting.

The "correct" name of this class would be "a symplectic manifold symplectomorphic to R2n with its standard symplectic form". For me "symplectic vector space" is a good-enough approximation to this truth.



---

archive/issue_comments_428179.json:
```json
{
    "body": "This would be fine in a specialized system focused only on manifolds; but Sage covers many mathematical areas, and I am concerned that it is misleading to introduce a class that is called `...VectorSpace` but is not in the category `VectorSpaces`.",
    "created_at": "2021-12-16T19:22:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428179",
    "user": "https://github.com/mkoeppe"
}
```

This would be fine in a specialized system focused only on manifolds; but Sage covers many mathematical areas, and I am concerned that it is misleading to introduce a class that is called `...VectorSpace` but is not in the category `VectorSpaces`.



---

archive/issue_comments_428180.json:
```json
{
    "body": "Replying to [comment:128 gh-tobiasdiez]:\n> The manifold package currently doesn't provide a way to define a manifold abstractly (i.e. by specifying its points), instead a manifold is given in terms of its chart.\n\n\nAll points on a manifold are already uniquely determined in terms of charts. In fact, due to the manifold structure, specifying a manifold by its points or by its charts is equivalent.\n\nReplying to [comment:129 mkoeppe]:\n> This would be fine in a specialized system focused only on manifolds; but Sage covers many mathematical areas, and I am concerned that it is misleading to introduce a class that is called `...VectorSpace` but is not in the category `VectorSpaces`.\n\n\nI agree. I also think that the best compromise for now is `AffineSymplecticSpace`.",
    "created_at": "2021-12-16T19:27:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428180",
    "user": "https://github.com/mjungmath"
}
```

Replying to [comment:128 gh-tobiasdiez]:
> The manifold package currently doesn't provide a way to define a manifold abstractly (i.e. by specifying its points), instead a manifold is given in terms of its chart.


All points on a manifold are already uniquely determined in terms of charts. In fact, due to the manifold structure, specifying a manifold by its points or by its charts is equivalent.

Replying to [comment:129 mkoeppe]:
> This would be fine in a specialized system focused only on manifolds; but Sage covers many mathematical areas, and I am concerned that it is misleading to introduce a class that is called `...VectorSpace` but is not in the category `VectorSpaces`.


I agree. I also think that the best compromise for now is `AffineSymplecticSpace`.



---

archive/issue_comments_428181.json:
```json
{
    "body": "But its currently neither an affine nor a vector space... so the question would be: should sage (at some point) has a proper implementation of an affine symplectic space or of a symplectic vector space? In my opinion, for practical purposes, the vector version should be sufficient - if you really only have an affine space, then just don't use the fact that you could add vectors. \n\nEven if we should go with affine symplectic, how would one express the fact that the chart depends on a choice of a base point?",
    "created_at": "2021-12-16T19:57:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428181",
    "user": "https://github.com/tobiasdiez"
}
```

But its currently neither an affine nor a vector space... so the question would be: should sage (at some point) has a proper implementation of an affine symplectic space or of a symplectic vector space? In my opinion, for practical purposes, the vector version should be sufficient - if you really only have an affine space, then just don't use the fact that you could add vectors. 

Even if we should go with affine symplectic, how would one express the fact that the chart depends on a choice of a base point?



---

archive/issue_comments_428182.json:
```json
{
    "body": "A key difference is that we do not currently have a category for affine spaces. There's merely one implementation, in `sage.schemes`, that implements `AffineSpace` from a scheme-theoretic viewpoint. Its category is just the category of schemes, nothing more detailed than that.",
    "created_at": "2021-12-16T20:15:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428182",
    "user": "https://github.com/mkoeppe"
}
```

A key difference is that we do not currently have a category for affine spaces. There's merely one implementation, in `sage.schemes`, that implements `AffineSpace` from a scheme-theoretic viewpoint. Its category is just the category of schemes, nothing more detailed than that.



---

archive/issue_comments_428183.json:
```json
{
    "body": "Replying to [comment:131 gh-tobiasdiez]:\n> But its currently neither an affine nor a vector space... so the question would be: should sage (at some point) has a proper implementation of an affine symplectic space or of a symplectic vector space? In my opinion, for practical purposes, the vector version should be sufficient - if you really only have an affine space, then just don't use the fact that you could add vectors. \n\n\nThe important difference here is that, in a strict sense, the affine version has no vector space structure. If I understand Matthias's objection correctly, this is exactly the punchline.",
    "created_at": "2021-12-16T20:43:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428183",
    "user": "https://github.com/mjungmath"
}
```

Replying to [comment:131 gh-tobiasdiez]:
> But its currently neither an affine nor a vector space... so the question would be: should sage (at some point) has a proper implementation of an affine symplectic space or of a symplectic vector space? In my opinion, for practical purposes, the vector version should be sufficient - if you really only have an affine space, then just don't use the fact that you could add vectors. 


The important difference here is that, in a strict sense, the affine version has no vector space structure. If I understand Matthias's objection correctly, this is exactly the punchline.



---

archive/issue_comments_428184.json:
```json
{
    "body": "In addition, notice that `EuclideanSpace` is meant to represent an affine space, too:\n\n```text\nAn *Euclidean space of dimension* `n` is an affine space `E`, whose associated\nvector space is a `n`-dimensional vector space over `\\RR` and is equipped with\na positive definite symmetric bilinear form, called the *scalar product* or\n*dot product* [Ber1987]_. An Euclidean space of dimension `n` can also be\nviewed as a Riemannian manifold that is diffeomorphic to `\\RR^n` and that\nhas a flat metric `g`. The Euclidean scalar product is then that defined\nby the Riemannian metric `g`.\n```\n\nFrom that viewpoint, since you derive from `EuclideanSpace`, it is only natural to view your implementation as an affine symplectic space.",
    "created_at": "2021-12-16T20:45:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428184",
    "user": "https://github.com/mjungmath"
}
```

In addition, notice that `EuclideanSpace` is meant to represent an affine space, too:

```text
An *Euclidean space of dimension* `n` is an affine space `E`, whose associated
vector space is a `n`-dimensional vector space over `\RR` and is equipped with
a positive definite symmetric bilinear form, called the *scalar product* or
*dot product* [Ber1987]_. An Euclidean space of dimension `n` can also be
viewed as a Riemannian manifold that is diffeomorphic to `\RR^n` and that
has a flat metric `g`. The Euclidean scalar product is then that defined
by the Riemannian metric `g`.
```

From that viewpoint, since you derive from `EuclideanSpace`, it is only natural to view your implementation as an affine symplectic space.



---

archive/issue_comments_428185.json:
```json
{
    "body": "Replying to [comment:131 gh-tobiasdiez]:\n> the question would be: should sage (at some point) has a proper implementation of an affine symplectic space or of a symplectic vector space? \n\n\nTo make it a \"proper\" affine space, one only needs to implement lines, easy to do.\n\nOn the other hand, to make it a vector space, one would need to identify the space with its tangent space -- so that the bilinear form can be applied to elements of the space.",
    "created_at": "2021-12-16T20:53:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428185",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:131 gh-tobiasdiez]:
> the question would be: should sage (at some point) has a proper implementation of an affine symplectic space or of a symplectic vector space? 


To make it a "proper" affine space, one only needs to implement lines, easy to do.

On the other hand, to make it a vector space, one would need to identify the space with its tangent space -- so that the bilinear form can be applied to elements of the space.



---

archive/issue_comments_428186.json:
```json
{
    "body": "`@`Eric: Speaking of which, that brings to my mind: do we want to implement a method `vector_space` for `EuclideanSpace` that returns the corresponding underlying vector space (w.r.t. a given frame)?",
    "created_at": "2021-12-16T20:55:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428186",
    "user": "https://github.com/mjungmath"
}
```

`@`Eric: Speaking of which, that brings to my mind: do we want to implement a method `vector_space` for `EuclideanSpace` that returns the corresponding underlying vector space (w.r.t. a given frame)?



---

archive/issue_comments_428187.json:
```json
{
    "body": "I think, affinness is sufficiently represented by:\n\n```\nsage: EuclideanSpace(3) is EuclideanSpace(3)\nFalse\n```\n\nThus, you get two distinct affine spaces, you may (or may not) relate to each other. Of course, lines would make this construction mathematically more rigorous.",
    "created_at": "2021-12-16T21:00:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428187",
    "user": "https://github.com/mjungmath"
}
```

I think, affinness is sufficiently represented by:

```
sage: EuclideanSpace(3) is EuclideanSpace(3)
False
```

Thus, you get two distinct affine spaces, you may (or may not) relate to each other. Of course, lines would make this construction mathematically more rigorous.



---

archive/issue_comments_428188.json:
```json
{
    "body": "Replying to [comment:125 gh-tobiasdiez]:\n> More importantly, this class is meant as an example for symplectic manifolds (mostly for the doctests) and all textbooks talk about symplectic vector space but almost no one is interested in affine ones (google has like 800 hits for \"affine symplectic space\"). \n\n\nThis is a good point. Let us forget then about `AffineSymplecticSpace`. What about `StandardSymplecticSpace`? This would be in line with https://en.wikipedia.org/wiki/Symplectic_vector_space#Standard_symplectic_space.",
    "created_at": "2021-12-17T08:29:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428188",
    "user": "https://github.com/egourgoulhon"
}
```

Replying to [comment:125 gh-tobiasdiez]:
> More importantly, this class is meant as an example for symplectic manifolds (mostly for the doctests) and all textbooks talk about symplectic vector space but almost no one is interested in affine ones (google has like 800 hits for "affine symplectic space"). 


This is a good point. Let us forget then about `AffineSymplecticSpace`. What about `StandardSymplecticSpace`? This would be in line with https://en.wikipedia.org/wiki/Symplectic_vector_space#Standard_symplectic_space.



---

archive/issue_comments_428189.json:
```json
{
    "body": "Replying to [comment:136 gh-mjungmath]:\n> `@`Eric: Speaking of which, that brings to my mind: do we want to implement a method `vector_space` for `EuclideanSpace` that returns the corresponding underlying vector space (w.r.t. a given frame)?\n\n\nThis should probably be discussed in the follow up ticket mentioned in comment:119, in particular to decide which (Sage) type of vector space we want to return.",
    "created_at": "2021-12-17T08:34:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428189",
    "user": "https://github.com/egourgoulhon"
}
```

Replying to [comment:136 gh-mjungmath]:
> `@`Eric: Speaking of which, that brings to my mind: do we want to implement a method `vector_space` for `EuclideanSpace` that returns the corresponding underlying vector space (w.r.t. a given frame)?


This should probably be discussed in the follow up ticket mentioned in comment:119, in particular to decide which (Sage) type of vector space we want to return.



---

archive/issue_comments_428190.json:
```json
{
    "body": "Replying to [comment:138 egourgoulhon]:\n> Replying to [comment:125 gh-tobiasdiez]:\n> > More importantly, this class is meant as an example for symplectic manifolds (mostly for the doctests) and all textbooks talk about symplectic vector space but almost no one is interested in affine ones (google has like 800 hits for \"affine symplectic space\"). \n\n> \n> This is a good point. Let us forget then about `AffineSymplecticSpace`. What about `StandardSymplecticSpace`? This would be in line with https://en.wikipedia.org/wiki/Symplectic_vector_space#Standard_symplectic_space. \n\n\nI am open to other suggestions, but I'd like to point out that the above implementation in fact **represents** an affine symplectic space since it derives from `EuclideanSpace`. Thus, there is no other more appropriate name than `AffineSymplecticSpace`.\n\nAnd indeed, textbooks usually use symplectic vector spaces as primary example. But most textbooks also talk about the Euclidean vector space `RR^n` as primary example for Riemannian manifolds. Nevertheless, we decided for the affine version in Sage for the sake of convenience and (imho) accuracy. I say we should not break with it now.",
    "created_at": "2021-12-17T09:44:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428190",
    "user": "https://github.com/mjungmath"
}
```

Replying to [comment:138 egourgoulhon]:
> Replying to [comment:125 gh-tobiasdiez]:
> > More importantly, this class is meant as an example for symplectic manifolds (mostly for the doctests) and all textbooks talk about symplectic vector space but almost no one is interested in affine ones (google has like 800 hits for "affine symplectic space"). 

> 
> This is a good point. Let us forget then about `AffineSymplecticSpace`. What about `StandardSymplecticSpace`? This would be in line with https://en.wikipedia.org/wiki/Symplectic_vector_space#Standard_symplectic_space. 


I am open to other suggestions, but I'd like to point out that the above implementation in fact **represents** an affine symplectic space since it derives from `EuclideanSpace`. Thus, there is no other more appropriate name than `AffineSymplecticSpace`.

And indeed, textbooks usually use symplectic vector spaces as primary example. But most textbooks also talk about the Euclidean vector space `RR^n` as primary example for Riemannian manifolds. Nevertheless, we decided for the affine version in Sage for the sake of convenience and (imho) accuracy. I say we should not break with it now.



---

archive/issue_comments_428191.json:
```json
{
    "body": "Replying to [comment:135 mkoeppe]:\n> Replying to [comment:131 gh-tobiasdiez]:\n> > the question would be: should sage (at some point) has a proper implementation of an affine symplectic space or of a symplectic vector space? \n\n> \n> To make it a \"proper\" affine space, one only needs to implement lines, easy to do.\n> \n> On the other hand, to make it a vector space, one would need to identify the space with its tangent space -- so that the bilinear form can be applied to elements of the space.\n\n\nWell, you just declare the chart to be a linear isomorphism and your done carrying all the (vector space) structure over from Rn. Also easy ;-)\nTo be precise, the new \"SymplecticVectorSpace\" class currently represents  nothing else then R2n with a fixed basis and its canonical symplectic form, with addition and scalar multiplation forgotten/not yet implemented. You could view this as an abstract affine symplectic space with a chart; but in order to define a chart on an affine space one needs to choose a base point and a basis.\n\nFor these reasons I really like the idea\n> What about StandardSymplecticSpace\n\n\nShould I go ahead and rename everything?\n\n> In addition, notice that EuclideanSpace is meant to represent an affine space, too: \n\n\nThe documentation is at least claiming this, but EuclideanSpace is also not a proper affine space either. You cannot subtract elements (at least I couldn't figure out how) and there is only one chart - but on an affine space you don't have a canonical chart; and once you fix a base point you have a vector space. Moreover, what are \"polar coordinates\" on an affine space? I think \"EuclideanSpace\" is also just Rn with its Euclidean metric, so maybe it should be renamed to StandardEuclideanSpace in a follow-up ticket?\n\nSorry for being so stubborn on this, but I would bet that an average graduate student has never seen the definition of an affine symplectic space (I certainly didn't) and so far I cannot see any good examples / uses cases why one would actually need them, especially for a CAS. I agree that the current implementation is not satisfying, but that's why I'd added it as a follow-up todo to implement the \"vector space\" part. Finally, and most importantly for me, I think the docstrings should try to be as understandable as possible, hiding as much mathematical complexity and focus on how the method/class are used - thus, I would like to use a symplectic vector space as a primary example in the documentation of a symplectic form  and not an abstract concept one first has to lookup and understand.",
    "created_at": "2021-12-17T12:54:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428191",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:135 mkoeppe]:
> Replying to [comment:131 gh-tobiasdiez]:
> > the question would be: should sage (at some point) has a proper implementation of an affine symplectic space or of a symplectic vector space? 

> 
> To make it a "proper" affine space, one only needs to implement lines, easy to do.
> 
> On the other hand, to make it a vector space, one would need to identify the space with its tangent space -- so that the bilinear form can be applied to elements of the space.


Well, you just declare the chart to be a linear isomorphism and your done carrying all the (vector space) structure over from Rn. Also easy ;-)
To be precise, the new "SymplecticVectorSpace" class currently represents  nothing else then R2n with a fixed basis and its canonical symplectic form, with addition and scalar multiplation forgotten/not yet implemented. You could view this as an abstract affine symplectic space with a chart; but in order to define a chart on an affine space one needs to choose a base point and a basis.

For these reasons I really like the idea
> What about StandardSymplecticSpace


Should I go ahead and rename everything?

> In addition, notice that EuclideanSpace is meant to represent an affine space, too: 


The documentation is at least claiming this, but EuclideanSpace is also not a proper affine space either. You cannot subtract elements (at least I couldn't figure out how) and there is only one chart - but on an affine space you don't have a canonical chart; and once you fix a base point you have a vector space. Moreover, what are "polar coordinates" on an affine space? I think "EuclideanSpace" is also just Rn with its Euclidean metric, so maybe it should be renamed to StandardEuclideanSpace in a follow-up ticket?

Sorry for being so stubborn on this, but I would bet that an average graduate student has never seen the definition of an affine symplectic space (I certainly didn't) and so far I cannot see any good examples / uses cases why one would actually need them, especially for a CAS. I agree that the current implementation is not satisfying, but that's why I'd added it as a follow-up todo to implement the "vector space" part. Finally, and most importantly for me, I think the docstrings should try to be as understandable as possible, hiding as much mathematical complexity and focus on how the method/class are used - thus, I would like to use a symplectic vector space as a primary example in the documentation of a symplectic form  and not an abstract concept one first has to lookup and understand.



---

archive/issue_comments_428192.json:
```json
{
    "body": "Replying to [comment:141 gh-tobiasdiez]:\n> \n> \n> For these reasons I really like the idea\n> > What about StandardSymplecticSpace\n\n> \n> Should I go ahead and rename everything?\n\n\nYes please go on. If you agree with this name, this makes at least two of us and it does not collide with the name `VectorSpace`. We could still revert to `SymplecticVectorSpace` later on. IMHO, this nomenclature debate should not prevent this ticket to make its way into Sage 9.5, which is about to be released.  \n\n> \n> > In addition, notice that EuclideanSpace is meant to represent an affine space, too: \n\n> \n> The documentation is at least claiming this, but EuclideanSpace is also not a proper affine space either. \n\n\nActually, the documentation is not claiming that `EuclideanSpace` is an affine space, because the sentence just after the quoted one in comment:134 is \n\n```\nThe current implementation of Euclidean spaces is based on the second point \nof view.\n```\nThis second point of view is that of a Riemannian manifold, not of an affine space.\n\n> Sorry for being so stubborn on this, but I would bet that an average graduate student has never seen the definition of an affine symplectic space (I certainly didn't) and so far I cannot see any good examples / uses cases why one would actually need them, especially for a CAS. \n\n\n+1\n\n> I agree that the current implementation is not satisfying, but that's why I'd added it as a follow-up todo to implement the \"vector space\" part. Finally, and most importantly for me, I think the docstrings should try to be as understandable as possible, hiding as much mathematical complexity and focus on how the method/class are used - thus, I would like to use a symplectic vector space as a primary example in the documentation of a symplectic form  and not an abstract concept one first has to lookup and understand.\n\n\n+1",
    "created_at": "2021-12-17T13:41:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428192",
    "user": "https://github.com/egourgoulhon"
}
```

Replying to [comment:141 gh-tobiasdiez]:
> 
> 
> For these reasons I really like the idea
> > What about StandardSymplecticSpace

> 
> Should I go ahead and rename everything?


Yes please go on. If you agree with this name, this makes at least two of us and it does not collide with the name `VectorSpace`. We could still revert to `SymplecticVectorSpace` later on. IMHO, this nomenclature debate should not prevent this ticket to make its way into Sage 9.5, which is about to be released.  

> 
> > In addition, notice that EuclideanSpace is meant to represent an affine space, too: 

> 
> The documentation is at least claiming this, but EuclideanSpace is also not a proper affine space either. 


Actually, the documentation is not claiming that `EuclideanSpace` is an affine space, because the sentence just after the quoted one in comment:134 is 

```
The current implementation of Euclidean spaces is based on the second point 
of view.
```
This second point of view is that of a Riemannian manifold, not of an affine space.

> Sorry for being so stubborn on this, but I would bet that an average graduate student has never seen the definition of an affine symplectic space (I certainly didn't) and so far I cannot see any good examples / uses cases why one would actually need them, especially for a CAS. 


+1

> I agree that the current implementation is not satisfying, but that's why I'd added it as a follow-up todo to implement the "vector space" part. Finally, and most importantly for me, I think the docstrings should try to be as understandable as possible, hiding as much mathematical complexity and focus on how the method/class are used - thus, I would like to use a symplectic vector space as a primary example in the documentation of a symplectic form  and not an abstract concept one first has to lookup and understand.


+1



---

archive/issue_comments_428193.json:
```json
{
    "body": "Replying to [comment:138 egourgoulhon]:\n> What about `StandardSymplecticSpace`? \n\n\n+1, this is a great suggestion",
    "created_at": "2021-12-17T16:10:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428193",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:138 egourgoulhon]:
> What about `StandardSymplecticSpace`? 


+1, this is a great suggestion



---

archive/issue_comments_428194.json:
```json
{
    "body": "Replying to [comment:142 egourgoulhon]:\n> Actually, the documentation is not claiming that `EuclideanSpace` is an affine space, because the sentence just after the quoted one in comment:134 is \n> \n> ```\n> The current implementation of Euclidean spaces is based on the second point \n> of view.\n> ```\n> This second point of view is that of a Riemannian manifold, not of an affine space.\n\n\nFair enough.\n\nAll fine by me. :)",
    "created_at": "2021-12-17T20:01:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428194",
    "user": "https://github.com/mjungmath"
}
```

Replying to [comment:142 egourgoulhon]:
> Actually, the documentation is not claiming that `EuclideanSpace` is an affine space, because the sentence just after the quoted one in comment:134 is 
> 
> ```
> The current implementation of Euclidean spaces is based on the second point 
> of view.
> ```
> This second point of view is that of a Riemannian manifold, not of an affine space.


Fair enough.

All fine by me. :)



---

archive/issue_comments_428195.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-12-20T13:06:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428195",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_428196.json:
```json
{
    "body": "```diff\n-        return f\"{self._dim}-dimensional symplectic vector space {self._name}\"\n+        return f\"Standard symplectic vector space {self._name}\"\n```\n\nThis looks like cheating to me. Please correct me if I'm wrong, but wasn't the whole point that this implementation does **not** constitute a vector space? This would still leave the impression to the user that they can add/substract or scale points.\n\nFor the sake of consistency, I opt for:\n\n```diff\n-        return f\"Standard symplectic vector space {self._name}\"\n+        return f\"Standard symplectic space {self._name}\"\n```\n\nOtherwise, we have to rename `Euclidean space` to `Euclidean vector space`, too. Which wouldn't make sense to me due to the aforementioned reasons.",
    "created_at": "2021-12-20T13:30:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428196",
    "user": "https://github.com/mjungmath"
}
```

```diff
-        return f"{self._dim}-dimensional symplectic vector space {self._name}"
+        return f"Standard symplectic vector space {self._name}"
```

This looks like cheating to me. Please correct me if I'm wrong, but wasn't the whole point that this implementation does **not** constitute a vector space? This would still leave the impression to the user that they can add/substract or scale points.

For the sake of consistency, I opt for:

```diff
-        return f"Standard symplectic vector space {self._name}"
+        return f"Standard symplectic space {self._name}"
```

Otherwise, we have to rename `Euclidean space` to `Euclidean vector space`, too. Which wouldn't make sense to me due to the aforementioned reasons.



---

archive/issue_comments_428197.json:
```json
{
    "body": "Replying to [comment:141 gh-tobiasdiez]:\n> Sorry for being so stubborn on this, but I would bet that an average graduate student has never seen the definition of an affine symplectic space (I certainly didn't) and so far I cannot see any good examples / uses cases why one would actually need them, especially for a CAS. I agree that the current implementation is not satisfying, but that's why I'd added it as a follow-up todo to implement the \"vector space\" part. Finally, and most importantly for me, I think the docstrings should try to be as understandable as possible, hiding as much mathematical complexity and focus on how the method/class are used - thus, I would like to use a symplectic vector space as a primary example in the documentation of a symplectic form  and not an abstract concept one first has to lookup and understand.\n\n\nMatthias already pointed out in comment:113 that symplectic vector spaces are at present part of Sage. More reasonable, in my opinion, would be a link between both implementations instead of equipping `StandardSymplecticSpace` with an additional vector space structure. See for example #30832 for a vaguely similar attempt.",
    "created_at": "2021-12-20T13:36:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428197",
    "user": "https://github.com/mjungmath"
}
```

Replying to [comment:141 gh-tobiasdiez]:
> Sorry for being so stubborn on this, but I would bet that an average graduate student has never seen the definition of an affine symplectic space (I certainly didn't) and so far I cannot see any good examples / uses cases why one would actually need them, especially for a CAS. I agree that the current implementation is not satisfying, but that's why I'd added it as a follow-up todo to implement the "vector space" part. Finally, and most importantly for me, I think the docstrings should try to be as understandable as possible, hiding as much mathematical complexity and focus on how the method/class are used - thus, I would like to use a symplectic vector space as a primary example in the documentation of a symplectic form  and not an abstract concept one first has to lookup and understand.


Matthias already pointed out in comment:113 that symplectic vector spaces are at present part of Sage. More reasonable, in my opinion, would be a link between both implementations instead of equipping `StandardSymplecticSpace` with an additional vector space structure. See for example #30832 for a vaguely similar attempt.



---

archive/issue_comments_428198.json:
```json
{
    "body": "`@`Tobias: I'd like to point out that I perfectly understand your concerns. Actually, I dealt with similar issues when I started in the Sage project. Mathematical accuracy and implementation details cannot always be aligned, unfortunately. That being said, we cannot create Sage objects that unify all their mathematical properties. That's something Travis taught me with hours of patience. Isn't that right Travis? :D",
    "created_at": "2021-12-20T13:44:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428198",
    "user": "https://github.com/mjungmath"
}
```

`@`Tobias: I'd like to point out that I perfectly understand your concerns. Actually, I dealt with similar issues when I started in the Sage project. Mathematical accuracy and implementation details cannot always be aligned, unfortunately. That being said, we cannot create Sage objects that unify all their mathematical properties. That's something Travis taught me with hours of patience. Isn't that right Travis? :D



---

archive/issue_comments_428199.json:
```json
{
    "body": "Replying to [comment:146 gh-mjungmath]:\n> {{{#!diff\n> -        return f\"{self._dim}-dimensional symplectic vector space {self._name}\"\n> +        return f\"Standard symplectic vector space {self._name}\"\n> }}}\n> \n> This looks like cheating to me. Please correct me if I'm wrong, but wasn't the whole point that this implementation does **not** constitute a vector space? This would still leave the impression to the user that they can add/substract or scale points.\n> \n> For the sake of consistency, I opt for:\n> \n> \n> ```diff\n> -        return f\"Standard symplectic vector space {self._name}\"\n> +        return f\"Standard symplectic space {self._name}\"\n> ```\n> \n> Otherwise, we have to rename `Euclidean space` to `Euclidean vector space`, too. Which wouldn't make sense to me due to the aforementioned reasons.\n\n\n\nI wasn't sure about this one. The \"vector space\" part was meant to convey that \"R2\" is really *the* vector space `R^2` one knows and that the symplectic form is constant. Can be changed of course.",
    "created_at": "2021-12-20T16:12:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428199",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:146 gh-mjungmath]:
> {{{#!diff
> -        return f"{self._dim}-dimensional symplectic vector space {self._name}"
> +        return f"Standard symplectic vector space {self._name}"
> }}}
> 
> This looks like cheating to me. Please correct me if I'm wrong, but wasn't the whole point that this implementation does **not** constitute a vector space? This would still leave the impression to the user that they can add/substract or scale points.
> 
> For the sake of consistency, I opt for:
> 
> 
> ```diff
> -        return f"Standard symplectic vector space {self._name}"
> +        return f"Standard symplectic space {self._name}"
> ```
> 
> Otherwise, we have to rename `Euclidean space` to `Euclidean vector space`, too. Which wouldn't make sense to me due to the aforementioned reasons.



I wasn't sure about this one. The "vector space" part was meant to convey that "R2" is really *the* vector space `R^2` one knows and that the symplectic form is constant. Can be changed of course.



---

archive/issue_comments_428200.json:
```json
{
    "body": "Replying to [comment:148 gh-mjungmath]:\n> `@`Tobias: I'd like to point out that I perfectly understand your concerns. Actually, I dealt with similar issues when I started in the Sage project. Mathematical accuracy and implementation details cannot always be aligned, unfortunately. That being said, we cannot create Sage objects that unify all their mathematical properties. That's something Travis taught me with hours of patience. Isn't that right Travis? :D\n\n\nI guess I still have much to learn ;-). So thanks for everyone's patience. Also, as a physicist by education, it is perhaps easier for me to ignore fine mathematical details (affine vs vector space) or mathematical structure (category theory) if that makes the implementation easier. \n\n---\n\n\nThat being said, I still think it would be handy in applications if points of EuclideanSpace could be added and scaled (without the need to resort to explicit coordinates).",
    "created_at": "2021-12-20T16:19:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428200",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:148 gh-mjungmath]:
> `@`Tobias: I'd like to point out that I perfectly understand your concerns. Actually, I dealt with similar issues when I started in the Sage project. Mathematical accuracy and implementation details cannot always be aligned, unfortunately. That being said, we cannot create Sage objects that unify all their mathematical properties. That's something Travis taught me with hours of patience. Isn't that right Travis? :D


I guess I still have much to learn ;-). So thanks for everyone's patience. Also, as a physicist by education, it is perhaps easier for me to ignore fine mathematical details (affine vs vector space) or mathematical structure (category theory) if that makes the implementation easier. 

---


That being said, I still think it would be handy in applications if points of EuclideanSpace could be added and scaled (without the need to resort to explicit coordinates).



---

archive/issue_comments_428201.json:
```json
{
    "body": "Replying to [comment:149 gh-tobiasdiez]:\n> Replying to [comment:146 gh-mjungmath]:\n> > {{{#!diff\n> > -        return f\"{self._dim}-dimensional symplectic vector space {self._name}\"\n> > +        return f\"Standard symplectic vector space {self._name}\"\n> > }}}\n> > \n> > This looks like cheating to me. Please correct me if I'm wrong, but wasn't the whole point that this implementation does **not** constitute a vector space? This would still leave the impression to the user that they can add/substract or scale points.\n> > \n> > For the sake of consistency, I opt for:\n> > \n> > \n> > ```diff\n> > -        return f\"Standard symplectic vector space {self._name}\"\n> > +        return f\"Standard symplectic space {self._name}\"\n> > ```\n> > \n> > Otherwise, we have to rename `Euclidean space` to `Euclidean vector space`, too. Which wouldn't make sense to me due to the aforementioned reasons.\n\n> \n> \n> I wasn't sure about this one. The \"vector space\" part was meant to convey that \"R2\" is really *the* vector space `R^2` one knows and that the symplectic form is constant. Can be changed of course.\n\n\nYes please change it for consistency, albeit I agree that \"vector space\" in the name would make perfectly clear that the object is what the user expect.",
    "created_at": "2021-12-20T16:58:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428201",
    "user": "https://github.com/egourgoulhon"
}
```

Replying to [comment:149 gh-tobiasdiez]:
> Replying to [comment:146 gh-mjungmath]:
> > {{{#!diff
> > -        return f"{self._dim}-dimensional symplectic vector space {self._name}"
> > +        return f"Standard symplectic vector space {self._name}"
> > }}}
> > 
> > This looks like cheating to me. Please correct me if I'm wrong, but wasn't the whole point that this implementation does **not** constitute a vector space? This would still leave the impression to the user that they can add/substract or scale points.
> > 
> > For the sake of consistency, I opt for:
> > 
> > 
> > ```diff
> > -        return f"Standard symplectic vector space {self._name}"
> > +        return f"Standard symplectic space {self._name}"
> > ```
> > 
> > Otherwise, we have to rename `Euclidean space` to `Euclidean vector space`, too. Which wouldn't make sense to me due to the aforementioned reasons.

> 
> 
> I wasn't sure about this one. The "vector space" part was meant to convey that "R2" is really *the* vector space `R^2` one knows and that the symplectic form is constant. Can be changed of course.


Yes please change it for consistency, albeit I agree that "vector space" in the name would make perfectly clear that the object is what the user expect.



---

archive/issue_comments_428202.json:
```json
{
    "body": "Replying to [comment:150 gh-tobiasdiez]:\n> \n> That being said, I still think it would be handy in applications if points of EuclideanSpace could be added and scaled (without the need to resort to explicit coordinates). \n\n\nThis would be handy indeed and there is no reason why this cannot be implemented in a future ticket.",
    "created_at": "2021-12-20T17:00:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428202",
    "user": "https://github.com/egourgoulhon"
}
```

Replying to [comment:150 gh-tobiasdiez]:
> 
> That being said, I still think it would be handy in applications if points of EuclideanSpace could be added and scaled (without the need to resort to explicit coordinates). 


This would be handy indeed and there is no reason why this cannot be implemented in a future ticket.



---

archive/issue_comments_428203.json:
```json
{
    "body": "Replying to [comment:149 gh-tobiasdiez]:\n> I wasn't sure about this one. The \"vector space\" part was meant to convey that \"R2\" is really *the* vector space `R^2` one knows and that the symplectic form is constant. Can be changed of course.\n\n\nWell, the Euclidean space is abbreviated with `E^n` and not `R^n`. Perhaps we should do the same here, too?\n\nAt least until we have the vector space structure on Euclidean space (though, I'd personally prefer an affine structure).\n\nThis all is indeed a bit of a hassle, and a lot of subtleties lie on the path. Maybe it is a good idea to nudge a discussion with the Sage (manifolds) community?",
    "created_at": "2021-12-20T17:11:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428203",
    "user": "https://github.com/mjungmath"
}
```

Replying to [comment:149 gh-tobiasdiez]:
> I wasn't sure about this one. The "vector space" part was meant to convey that "R2" is really *the* vector space `R^2` one knows and that the symplectic form is constant. Can be changed of course.


Well, the Euclidean space is abbreviated with `E^n` and not `R^n`. Perhaps we should do the same here, too?

At least until we have the vector space structure on Euclidean space (though, I'd personally prefer an affine structure).

This all is indeed a bit of a hassle, and a lot of subtleties lie on the path. Maybe it is a good idea to nudge a discussion with the Sage (manifolds) community?



---

archive/issue_comments_428204.json:
```json
{
    "body": "In my head, these things make perfect sense for me:\n\n- Euclidean space in Sage is an affine vector space.\n- The symplectic space above is an affine space, too, endowed with a symplectic structure.\n- As for the vector space structure, I think we should link the Euclidean space to preexisting vector spaces endowed with bilinear forms.\n\nI am open to suggestions, different opinions and arguments. :)\n\nBut that's not for this ticket.",
    "created_at": "2021-12-20T17:20:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428204",
    "user": "https://github.com/mjungmath"
}
```

In my head, these things make perfect sense for me:

- Euclidean space in Sage is an affine vector space.
- The symplectic space above is an affine space, too, endowed with a symplectic structure.
- As for the vector space structure, I think we should link the Euclidean space to preexisting vector spaces endowed with bilinear forms.

I am open to suggestions, different opinions and arguments. :)

But that's not for this ticket.



---

archive/issue_comments_428205.json:
```json
{
    "body": "By the way, why don't you add `StandardSymplecticSpace` to the manifold catalog? \nThis would avoid having to import it:\n\n```diff\n- sage: from sage.manifolds.differentiable.examples.symplectic_space import StandardSymplecticSpace\n- sage: M.<q, p> = StandardSymplecticSpace(2, symplectic_name='omega')\n+ sage: M.<q, p> = manifolds.StandardSymplecticSpace(2, symplectic_name='omega')\n```\nTo do this, simply add \n\n```\n_lazy_import('sage.manifolds.differentiable.examples.symplectic_space',\n             'StandardSymplecticSpace')\n```\nto the file `src/sage/manifolds/catalog.py` (see e.g. the example of `Sphere` in that file).",
    "created_at": "2021-12-20T17:23:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428205",
    "user": "https://github.com/egourgoulhon"
}
```

By the way, why don't you add `StandardSymplecticSpace` to the manifold catalog? 
This would avoid having to import it:

```diff
- sage: from sage.manifolds.differentiable.examples.symplectic_space import StandardSymplecticSpace
- sage: M.<q, p> = StandardSymplecticSpace(2, symplectic_name='omega')
+ sage: M.<q, p> = manifolds.StandardSymplecticSpace(2, symplectic_name='omega')
```
To do this, simply add 

```
_lazy_import('sage.manifolds.differentiable.examples.symplectic_space',
             'StandardSymplecticSpace')
```
to the file `src/sage/manifolds/catalog.py` (see e.g. the example of `Sphere` in that file).



---

archive/issue_comments_428206.json:
```json
{
    "body": "Replying to [comment:153 gh-mjungmath]:\n> \n> Well, the Euclidean space is abbreviated with `E^n` and not `R^n`. Perhaps we should do the same here, too?\n\n\n-1. `R^n` is certainly much more standard here.",
    "created_at": "2021-12-20T17:24:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428206",
    "user": "https://github.com/egourgoulhon"
}
```

Replying to [comment:153 gh-mjungmath]:
> 
> Well, the Euclidean space is abbreviated with `E^n` and not `R^n`. Perhaps we should do the same here, too?


-1. `R^n` is certainly much more standard here.



---

archive/issue_comments_428207.json:
```json
{
    "body": "Replying to [comment:156 egourgoulhon]:\n> Replying to [comment:153 gh-mjungmath]:\n> > \n> > Well, the Euclidean space is abbreviated with `E^n` and not `R^n`. Perhaps we should do the same here, too?\n\n> \n> -1. `R^n` is certainly much more standard here.\n\n\nMhm. Well, since `StandardSymplecticSpace` inherits from `EuclideanSpace`, such an object still carries the structure of Euclidean space. I see your point though. Difficult...",
    "created_at": "2021-12-20T17:38:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428207",
    "user": "https://github.com/mjungmath"
}
```

Replying to [comment:156 egourgoulhon]:
> Replying to [comment:153 gh-mjungmath]:
> > 
> > Well, the Euclidean space is abbreviated with `E^n` and not `R^n`. Perhaps we should do the same here, too?

> 
> -1. `R^n` is certainly much more standard here.


Mhm. Well, since `StandardSymplecticSpace` inherits from `EuclideanSpace`, such an object still carries the structure of Euclidean space. I see your point though. Difficult...



---

archive/issue_comments_428208.json:
```json
{
    "body": "Replying to [comment:155 egourgoulhon]:\n> By the way, why don't you add `StandardSymplecticSpace` to the manifold catalog? \n> This would avoid having to import it:\n> \n> ```\n> #!diff\n> - sage: from sage.manifolds.differentiable.examples.symplectic_space import StandardSymplecticSpace\n> - sage: M.<q, p> = StandardSymplecticSpace(2, symplectic_name='omega')\n> + sage: M.<q, p> = manifolds.StandardSymplecticSpace(2, symplectic_name='omega')\n> ```\n> To do this, simply add \n> \n> ```\n> _lazy_import('sage.manifolds.differentiable.examples.symplectic_space',\n>              'StandardSymplecticSpace')\n> ```\n> to the file `src/sage/manifolds/catalog.py` (see e.g. the example of `Sphere` in that file). \n\n\nBig +1.",
    "created_at": "2021-12-20T17:38:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428208",
    "user": "https://github.com/mjungmath"
}
```

Replying to [comment:155 egourgoulhon]:
> By the way, why don't you add `StandardSymplecticSpace` to the manifold catalog? 
> This would avoid having to import it:
> 
> ```
> #!diff
> - sage: from sage.manifolds.differentiable.examples.symplectic_space import StandardSymplecticSpace
> - sage: M.<q, p> = StandardSymplecticSpace(2, symplectic_name='omega')
> + sage: M.<q, p> = manifolds.StandardSymplecticSpace(2, symplectic_name='omega')
> ```
> To do this, simply add 
> 
> ```
> _lazy_import('sage.manifolds.differentiable.examples.symplectic_space',
>              'StandardSymplecticSpace')
> ```
> to the file `src/sage/manifolds/catalog.py` (see e.g. the example of `Sphere` in that file). 


Big +1.



---

archive/issue_comments_428209.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-12-20T17:39:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428209",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_428210.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-12-20T17:47:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428210",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_428211.json:
```json
{
    "body": "Okay done",
    "created_at": "2021-12-20T17:48:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428211",
    "user": "https://github.com/tobiasdiez"
}
```

Okay done



---

archive/issue_comments_428212.json:
```json
{
    "body": "Replying to [comment:150 gh-tobiasdiez]:\n> Replying to [comment:148 gh-mjungmath]:\n> > `@`Tobias: I'd like to point out that I perfectly understand your concerns. Actually, I dealt with similar issues when I started in the Sage project. Mathematical accuracy and implementation details cannot always be aligned, unfortunately. That being said, we cannot create Sage objects that unify all their mathematical properties. That's something Travis taught me with hours of patience. Isn't that right Travis? :D\n\n> \n> I guess I still have much to learn ;-). So thanks for everyone's patience. Also, as a physicist by education, it is perhaps easier for me to ignore fine mathematical details (affine vs vector space) or mathematical structure (category theory) if that makes the implementation easier. \n\n\nThe \"canonical\" example of this is the real numbers. In implementations, we run up against things that are not quite mathematical, but we have to deal with the realities of finite and explicit computations.",
    "created_at": "2021-12-20T23:57:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428212",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:150 gh-tobiasdiez]:
> Replying to [comment:148 gh-mjungmath]:
> > `@`Tobias: I'd like to point out that I perfectly understand your concerns. Actually, I dealt with similar issues when I started in the Sage project. Mathematical accuracy and implementation details cannot always be aligned, unfortunately. That being said, we cannot create Sage objects that unify all their mathematical properties. That's something Travis taught me with hours of patience. Isn't that right Travis? :D

> 
> I guess I still have much to learn ;-). So thanks for everyone's patience. Also, as a physicist by education, it is perhaps easier for me to ignore fine mathematical details (affine vs vector space) or mathematical structure (category theory) if that makes the implementation easier. 


The "canonical" example of this is the real numbers. In implementations, we run up against things that are not quite mathematical, but we have to deal with the realities of finite and explicit computations.



---

archive/issue_comments_428213.json:
```json
{
    "body": "Thanks for the changes!",
    "created_at": "2021-12-21T10:26:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428213",
    "user": "https://github.com/egourgoulhon"
}
```

Thanks for the changes!



---

archive/issue_comments_428214.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-12-21T10:26:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428214",
    "user": "https://github.com/egourgoulhon"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_428215.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2021-12-21T13:02:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428215",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_428216.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2021-12-21T13:02:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428216",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_428217.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-12-21T13:04:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428217",
    "user": "https://github.com/egourgoulhon"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_428218.json:
```json
{
    "body": "The documentation was broken after the change of filename `symplectic_vector_space.py` --> `symplectic_space.py`. This is fixed in the latest commit.",
    "created_at": "2021-12-21T13:04:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428218",
    "user": "https://github.com/egourgoulhon"
}
```

The documentation was broken after the change of filename `symplectic_vector_space.py` --> `symplectic_space.py`. This is fixed in the latest commit.



---

archive/issue_comments_428219.json:
```json
{
    "body": "Thanks for the review and the fix!",
    "created_at": "2021-12-21T16:00:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428219",
    "user": "https://github.com/tobiasdiez"
}
```

Thanks for the review and the fix!



---

archive/issue_comments_428220.json:
```json
{
    "body": "Looks good to me too.",
    "created_at": "2021-12-21T16:32:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428220",
    "user": "https://github.com/mkoeppe"
}
```

Looks good to me too.



---

archive/issue_comments_428221.json:
```json
{
    "body": "Last question: do we really need to import everything in the test files?\n\nOtherwise, LGTM.",
    "created_at": "2021-12-22T06:51:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428221",
    "user": "https://github.com/mjungmath"
}
```

Last question: do we really need to import everything in the test files?

Otherwise, LGTM.



---

archive/issue_comments_428222.json:
```json
{
    "body": "Replying to [comment:168 gh-mjungmath]:\n> Last question: do we really need to import everything in the test files?\n> \n> Otherwise, LGTM.\n\n\nSadly yes, at the moment, since there are a few cyclic imports that are only resolved using the `sage.all` import.",
    "created_at": "2021-12-22T12:21:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428222",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:168 gh-mjungmath]:
> Last question: do we really need to import everything in the test files?
> 
> Otherwise, LGTM.


Sadly yes, at the moment, since there are a few cyclic imports that are only resolved using the `sage.all` import.



---

archive/issue_comments_428223.json:
```json
{
    "body": "Then we should probably add a `TODO` comment so that we don't forget to rectify this in due course, no?",
    "created_at": "2021-12-22T13:22:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428223",
    "user": "https://github.com/mjungmath"
}
```

Then we should probably add a `TODO` comment so that we don't forget to rectify this in due course, no?



---

archive/issue_comments_428224.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2021-12-23T21:29:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428224",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_428225.json:
```json
{
    "body": "Merge conflict",
    "created_at": "2021-12-23T21:29:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428225",
    "user": "https://github.com/vbraun"
}
```

Merge conflict



---

archive/issue_comments_428226.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-12-24T11:42:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428226",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_428227.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2021-12-24T11:45:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428227",
    "user": "https://github.com/egourgoulhon"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_428228.json:
```json
{
    "body": "Merge conflict fixed.",
    "created_at": "2021-12-24T11:45:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428228",
    "user": "https://github.com/egourgoulhon"
}
```

Merge conflict fixed.



---

archive/issue_events_078648.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-01-28T23:03:12Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30362#event-78648"
}
```



---

archive/issue_events_078649.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-01-28T23:03:12Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30362#event-78649"
}
```



---

archive/issue_events_078650.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-01-31T23:31:45Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30362#event-78650"
}
```



---

archive/issue_comments_428229.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-01-31T23:31:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428229",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_428230.json:
```json
{
    "body": "Now that the branch has been merged in Sage 9.6.beta0 (unfortunately it did not make its way to Sage 9.5...), there remains a last thing to do: preparing some examples of use for [Sage 9.6 release tour](https://wiki.sagemath.org/ReleaseTours/sage-9.6), on the same footing as what has been done for Sage 9.5:\nhttps://wiki.sagemath.org/ReleaseTours/sage-9.5#Manifolds. I've just added an entry for this in [Sage 9.6 release tour](https://wiki.sagemath.org/ReleaseTours/sage-9.6). Tobias, could you provide some nice examples?",
    "created_at": "2022-02-07T18:06:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428230",
    "user": "https://github.com/egourgoulhon"
}
```

Now that the branch has been merged in Sage 9.6.beta0 (unfortunately it did not make its way to Sage 9.5...), there remains a last thing to do: preparing some examples of use for [Sage 9.6 release tour](https://wiki.sagemath.org/ReleaseTours/sage-9.6), on the same footing as what has been done for Sage 9.5:
https://wiki.sagemath.org/ReleaseTours/sage-9.5#Manifolds. I've just added an entry for this in [Sage 9.6 release tour](https://wiki.sagemath.org/ReleaseTours/sage-9.6). Tobias, could you provide some nice examples?



---

archive/issue_comments_428231.json:
```json
{
    "body": "Is a copy&paste from the doctests good enough?\n\nShould I paste it here then, or how does one get access to the wiki?",
    "created_at": "2022-02-07T22:09:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428231",
    "user": "https://github.com/tobiasdiez"
}
```

Is a copy&paste from the doctests good enough?

Should I paste it here then, or how does one get access to the wiki?



---

archive/issue_comments_428232.json:
```json
{
    "body": "Replying to [comment:177 gh-tobiasdiez]:\n> Is a copy&paste from the doctests good enough?\n\n\nIt would be a bit better to give a very quick summary and some simple example usage (which can by c/p from the doctests).\n\n> Should I paste it here then, or how does one get access to the wiki?\n\n\nYou can edit the wiki by logging in with your trac account info. I don't know if it works for gh authentication.",
    "created_at": "2022-02-08T01:36:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428232",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:177 gh-tobiasdiez]:
> Is a copy&paste from the doctests good enough?


It would be a bit better to give a very quick summary and some simple example usage (which can by c/p from the doctests).

> Should I paste it here then, or how does one get access to the wiki?


You can edit the wiki by logging in with your trac account info. I don't know if it works for gh authentication.



---

archive/issue_comments_428233.json:
```json
{
    "body": "Replying to [comment:176 egourgoulhon]:\n> Now that the branch has been merged in Sage 9.6.beta0 (unfortunately it did not make its way to Sage 9.5...), there remains a last thing to do: preparing some examples of use for [Sage 9.6 release tour](https://wiki.sagemath.org/ReleaseTours/sage-9.6), on the same footing as what has been done for Sage 9.5:\n> https://wiki.sagemath.org/ReleaseTours/sage-9.5#Manifolds. I've just added an entry for this in [Sage 9.6 release tour](https://wiki.sagemath.org/ReleaseTours/sage-9.6). Tobias, could you provide some nice examples?\n\n\nPing\n(since the release of Sage 9.6 seems to be close).",
    "created_at": "2022-04-03T21:17:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428233",
    "user": "https://github.com/egourgoulhon"
}
```

Replying to [comment:176 egourgoulhon]:
> Now that the branch has been merged in Sage 9.6.beta0 (unfortunately it did not make its way to Sage 9.5...), there remains a last thing to do: preparing some examples of use for [Sage 9.6 release tour](https://wiki.sagemath.org/ReleaseTours/sage-9.6), on the same footing as what has been done for Sage 9.5:
> https://wiki.sagemath.org/ReleaseTours/sage-9.5#Manifolds. I've just added an entry for this in [Sage 9.6 release tour](https://wiki.sagemath.org/ReleaseTours/sage-9.6). Tobias, could you provide some nice examples?


Ping
(since the release of Sage 9.6 seems to be close).



---

archive/issue_comments_428234.json:
```json
{
    "body": "Another ping, pointing to the new release tour page, which is editable via a github login:\nhttps://trac.sagemath.org/wiki/ReleaseTours/sage-9.6?version=13#Symplecticmanifolds\nTobias, would you have time to provide a few examples there?",
    "created_at": "2022-04-26T08:40:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428234",
    "user": "https://github.com/egourgoulhon"
}
```

Another ping, pointing to the new release tour page, which is editable via a github login:
https://trac.sagemath.org/wiki/ReleaseTours/sage-9.6?version=13#Symplecticmanifolds
Tobias, would you have time to provide a few examples there?



---

archive/issue_comments_428235.json:
```json
{
    "body": "Sorry, I've been somewhat busy and forgot about this. Thanks for the reminder! I've now updated the release notes with a quick introduction.",
    "created_at": "2022-04-27T16:16:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428235",
    "user": "https://github.com/tobiasdiez"
}
```

Sorry, I've been somewhat busy and forgot about this. Thanks for the reminder! I've now updated the release notes with a quick introduction.



---

archive/issue_comments_428236.json:
```json
{
    "body": "Replying to [comment:181 gh-tobiasdiez]:\n> I've now updated the release notes with a quick introduction.\n\nThanks!",
    "created_at": "2022-04-27T19:07:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30362#issuecomment-428236",
    "user": "https://github.com/egourgoulhon"
}
```

Replying to [comment:181 gh-tobiasdiez]:
> I've now updated the release notes with a quick introduction.

Thanks!
