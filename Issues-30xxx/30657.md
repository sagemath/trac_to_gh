# Issue 30657: Fix up "sage -p"

archive/issues_030420.json:
```json
{
    "body": "\n```\n$ ./sage -p sagetex\nFound local metadata for sagetex-3.5\nUsing cached file /Users/mkoeppe/s/sage/sage-rebasing/upstream/sagetex-3.5.tar.gz\nmkdir: : No such file or directory\n************************************************************************\nError creating directory \n************************************************************************\n```\n\n\nCC:  @jhpalmieri @orlitzky\n\nBranch/Commit: 8ee7ee29ea4686a968846df1621f52adcd8f4173\n\nReviewer: Michael Orlitzky\n\nAuthor: Matthias Koeppe\n\nDependencies: #29500\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/30657\n\n",
    "closed_at": "2020-10-05T20:13:29Z",
    "created_at": "2020-09-24T21:51:59Z",
    "labels": [
        "component: build",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "Fix up \"sage -p\"",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30657",
    "user": "https://github.com/mkoeppe"
}
```

```
$ ./sage -p sagetex
Found local metadata for sagetex-3.5
Using cached file /Users/mkoeppe/s/sage/sage-rebasing/upstream/sagetex-3.5.tar.gz
mkdir: : No such file or directory
************************************************************************
Error creating directory 
************************************************************************
```


CC:  @jhpalmieri @orlitzky

Branch/Commit: 8ee7ee29ea4686a968846df1621f52adcd8f4173

Reviewer: Michael Orlitzky

Author: Matthias Koeppe

Dependencies: #29500

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/30657





---

archive/issue_comments_606377.json:
```json
{
    "body": "Changing branch from \"\" to \"u/mkoeppe/fix_up__sage__p_\"",
    "created_at": "2020-09-24T21:57:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30657#issuecomment-606377",
    "user": "https://github.com/mkoeppe"
}
```

Changing branch from "" to "u/mkoeppe/fix_up__sage__p_"



---

archive/issue_comments_606378.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#29500\"",
    "created_at": "2020-09-24T22:05:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30657#issuecomment-606378",
    "user": "https://github.com/mkoeppe"
}
```

Changing dependencies from "" to "#29500"



---

archive/issue_comments_606379.json:
```json
{
    "body": "<a id='comment:2'></a>\nBranch is on top of #29500 because it touches the same code\n\n---\nLast 10 new commits:\n|                                                                                                                                          |                                                            |\n|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------|\n|[0a64674](https://git.sagemath.org/sage.git/commit?id=0a646747dbf7c823030e1b23419348ff795a0661)|`build/pkgs/gambit/spkg-install.in: Install via bdist_wheel`|\n|[ca58693](https://git.sagemath.org/sage.git/commit?id=ca586938cbdd91114a10dd3364201c8076412485)|`build/pkgs/pillow/spkg-install.in: Install via bdist_wheel`|\n|[5a747c4](https://git.sagemath.org/sage.git/commit?id=5a747c48eca1be0104c202e4922e5386aa794d08)|`build/bin/sage-pip-{install,uninstall}: Remove pip2 support`|\n|[9ee2110](https://git.sagemath.org/sage.git/commit?id=9ee21109dfb001feec2b032c197defb91cc75783)|`build/bin/sage-dist-helpers: Also use $sudo for storing the wheel file`|\n|[d7aac84](https://git.sagemath.org/sage.git/commit?id=d7aac84ab4dd86ad6203a99eb82371c1d2a46363)|`src/doc/en/developer/packaging.rst: Update sdh_... documentation`|\n|[9b7c7a0](https://git.sagemath.org/sage.git/commit?id=9b7c7a04d658838ce511e352edb9c03f42c4a7f2)|`build/bin/sage-pip-{install,uninstall}: Fix typo in comment`|\n|[4135e8b](https://git.sagemath.org/sage.git/commit?id=4135e8b236d2e5491b3ee96cbd00196dc5b6e036)|`build/bin/sage-pip-install: Remove an outdated comment`|\n|[f2e7075](https://git.sagemath.org/sage.git/commit?id=f2e707561ab3044221b57151ae4cc67d502fe9f8)|`Merge tag '9.2.beta13' into t/29500/install_all_python_packages_via_pip_wheel__create_pep_503_simple_repository_for_wheels`|\n|[bd0fd2f](https://git.sagemath.org/sage.git/commit?id=bd0fd2f3142b08a906ebdbe3e2f37be6bec5f135)|`Merge branch 't/29500/install_all_python_packages_via_pip_wheel__create_pep_503_simple_repository_for_wheels' into t/30657/fix_up__sage__p_`|\n|[2e20f23](https://git.sagemath.org/sage.git/commit?id=2e20f230c0ac0b24c14b04b180217db68a2b7278)|`build/bin/sage-spkg: Move SAGE_SPKG_{INST,SCRIPTS,WHEELS} setting here from build/bin/install, make them relative to SAGE_INST_LOCAL`|",
    "created_at": "2020-09-24T22:05:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30657#issuecomment-606379",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'></a>
Branch is on top of #29500 because it touches the same code

---
Last 10 new commits:
|                                                                                                                                          |                                                            |
|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------|
|[0a64674](https://git.sagemath.org/sage.git/commit?id=0a646747dbf7c823030e1b23419348ff795a0661)|`build/pkgs/gambit/spkg-install.in: Install via bdist_wheel`|
|[ca58693](https://git.sagemath.org/sage.git/commit?id=ca586938cbdd91114a10dd3364201c8076412485)|`build/pkgs/pillow/spkg-install.in: Install via bdist_wheel`|
|[5a747c4](https://git.sagemath.org/sage.git/commit?id=5a747c48eca1be0104c202e4922e5386aa794d08)|`build/bin/sage-pip-{install,uninstall}: Remove pip2 support`|
|[9ee2110](https://git.sagemath.org/sage.git/commit?id=9ee21109dfb001feec2b032c197defb91cc75783)|`build/bin/sage-dist-helpers: Also use $sudo for storing the wheel file`|
|[d7aac84](https://git.sagemath.org/sage.git/commit?id=d7aac84ab4dd86ad6203a99eb82371c1d2a46363)|`src/doc/en/developer/packaging.rst: Update sdh_... documentation`|
|[9b7c7a0](https://git.sagemath.org/sage.git/commit?id=9b7c7a04d658838ce511e352edb9c03f42c4a7f2)|`build/bin/sage-pip-{install,uninstall}: Fix typo in comment`|
|[4135e8b](https://git.sagemath.org/sage.git/commit?id=4135e8b236d2e5491b3ee96cbd00196dc5b6e036)|`build/bin/sage-pip-install: Remove an outdated comment`|
|[f2e7075](https://git.sagemath.org/sage.git/commit?id=f2e707561ab3044221b57151ae4cc67d502fe9f8)|`Merge tag '9.2.beta13' into t/29500/install_all_python_packages_via_pip_wheel__create_pep_503_simple_repository_for_wheels`|
|[bd0fd2f](https://git.sagemath.org/sage.git/commit?id=bd0fd2f3142b08a906ebdbe3e2f37be6bec5f135)|`Merge branch 't/29500/install_all_python_packages_via_pip_wheel__create_pep_503_simple_repository_for_wheels' into t/30657/fix_up__sage__p_`|
|[2e20f23](https://git.sagemath.org/sage.git/commit?id=2e20f230c0ac0b24c14b04b180217db68a2b7278)|`build/bin/sage-spkg: Move SAGE_SPKG_{INST,SCRIPTS,WHEELS} setting here from build/bin/install, make them relative to SAGE_INST_LOCAL`|



---

archive/issue_comments_606380.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-09-24T22:05:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30657#issuecomment-606380",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_606381.json:
```json
{
    "body": "Changing commit from \"\" to \"2e20f230c0ac0b24c14b04b180217db68a2b7278\"",
    "created_at": "2020-09-24T22:05:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30657#issuecomment-606381",
    "user": "https://github.com/mkoeppe"
}
```

Changing commit from "" to "2e20f230c0ac0b24c14b04b180217db68a2b7278"



---

archive/issue_comments_606382.json:
```json
{
    "body": "Changing author from \"\" to \"Matthias Koeppe\"",
    "created_at": "2020-09-24T22:07:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30657#issuecomment-606382",
    "user": "https://github.com/mkoeppe"
}
```

Changing author from "" to "Matthias Koeppe"



---

archive/issue_comments_606383.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Michael Orlitzky\"",
    "created_at": "2020-09-25T13:40:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30657#issuecomment-606383",
    "user": "https://github.com/orlitzky"
}
```

Changing reviewer from "" to "Michael Orlitzky"



---

archive/issue_comments_606384.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-09-25T13:40:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30657#issuecomment-606384",
    "user": "https://github.com/orlitzky"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_606385.json:
```json
{
    "body": "<a id='comment:5'></a>\nLooks OK I guess. The `build/bin/sage-spkg` script obviously needs these variables set, so it makes sense to move them \"up\" out of `build/make/install` where they are not used directly.",
    "created_at": "2020-09-25T13:40:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30657#issuecomment-606385",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:5'></a>
Looks OK I guess. The `build/bin/sage-spkg` script obviously needs these variables set, so it makes sense to move them "up" out of `build/make/install` where they are not used directly.



---

archive/issue_comments_606386.json:
```json
{
    "body": "<a id='comment:6'></a>\nThanks.",
    "created_at": "2020-09-25T14:39:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30657#issuecomment-606386",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:6'></a>
Thanks.



---

archive/issue_comments_606387.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2020-10-01T23:16:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30657#issuecomment-606387",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_606388.json:
```json
{
    "body": "<a id='comment:7'></a>\nFails while building `sage_conf-none` for me... do incremental builds work?",
    "created_at": "2020-10-01T23:16:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30657#issuecomment-606388",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:7'></a>
Fails while building `sage_conf-none` for me... do incremental builds work?



---

archive/issue_comments_606389.json:
```json
{
    "body": "<a id='comment:8'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                      |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------|\n|[be2417c](https://git.sagemath.org/sage.git/commit/?id=be2417cd48549b2c1a9fa29bcd362b08c2a6fda7)|`Merge tag '9.2.beta14' into t/30657/fix_up__sage__p_`|\n|[8ee7ee2](https://git.sagemath.org/sage.git/commit/?id=8ee7ee29ea4686a968846df1621f52adcd8f4173)|`build/make/install: Set SAGE_SPKG_WHEELS also here so that script packages still work`|",
    "created_at": "2020-10-02T02:05:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30657#issuecomment-606389",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                      |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------|
|[be2417c](https://git.sagemath.org/sage.git/commit/?id=be2417cd48549b2c1a9fa29bcd362b08c2a6fda7)|`Merge tag '9.2.beta14' into t/30657/fix_up__sage__p_`|
|[8ee7ee2](https://git.sagemath.org/sage.git/commit/?id=8ee7ee29ea4686a968846df1621f52adcd8f4173)|`build/make/install: Set SAGE_SPKG_WHEELS also here so that script packages still work`|



---

archive/issue_comments_606390.json:
```json
{
    "body": "Changing commit from \"2e20f230c0ac0b24c14b04b180217db68a2b7278\" to \"8ee7ee29ea4686a968846df1621f52adcd8f4173\"",
    "created_at": "2020-10-02T02:05:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30657#issuecomment-606390",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "2e20f230c0ac0b24c14b04b180217db68a2b7278" to "8ee7ee29ea4686a968846df1621f52adcd8f4173"



---

archive/issue_comments_606391.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-10-02T02:06:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30657#issuecomment-606391",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_606392.json:
```json
{
    "body": "<a id='comment:10'></a>\nThe new commit is reverted on the #29386 branch, but looks good for now.",
    "created_at": "2020-10-02T13:11:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30657#issuecomment-606392",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:10'></a>
The new commit is reverted on the #29386 branch, but looks good for now.



---

archive/issue_comments_606393.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-10-02T13:11:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30657#issuecomment-606393",
    "user": "https://github.com/orlitzky"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_606394.json:
```json
{
    "body": "<a id='comment:11'></a>\nThanks!",
    "created_at": "2020-10-02T18:08:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30657#issuecomment-606394",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:11'></a>
Thanks!



---

archive/issue_events_079746.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-10-05T20:13:29Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/30657",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30657#event-79746"
}
```



---

archive/issue_comments_606395.json:
```json
{
    "body": "Changing branch from \"u/mkoeppe/fix_up__sage__p_\" to \"8ee7ee29ea4686a968846df1621f52adcd8f4173\"",
    "created_at": "2020-10-05T20:13:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30657#issuecomment-606395",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/mkoeppe/fix_up__sage__p_" to "8ee7ee29ea4686a968846df1621f52adcd8f4173"



---

archive/issue_comments_606396.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-10-05T20:13:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30657#issuecomment-606396",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
