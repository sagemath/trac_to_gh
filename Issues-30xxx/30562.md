# Issue 30562: Gap downloads from wrong upstream directory

archive/issues_030325.json:
```json
{
    "body": "It should download $HOST/upstream/gap/gap-4.11.0.tar.bz2, but goes for /upstream/gap_packages/ instead:\n\n```\n[gap-4.11.0.p0] Found local metadata for gap-4.11.0.p0\n[gap-4.11.0.p0] Attempting to download package gap-4.11.0.tar.bz2 from mirrors\n[gap-4.11.0.p0] http://sagepad.org/spkg/upstream/gap_packages/gap-4.11.0.tar.bz2\n[gap-4.11.0.p0] [xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx]\n[gap-4.11.0.p0] ERROR [transfer|run:135]: [Errno 404] Not Found: '//sagepad.org/spkg/upstream/gap_packages/gap-4.11.0.tar.bz2'\n[gap-4.11.0.p0] https://mirror.koddos.net/sagemath/spkg/upstream/gap_packages/gap-4.11.0.tar.bz2\n[gap-4.11.0.p0] [xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx]\n[gap-4.11.0.p0] ERROR [transfer|run:135]: [Errno 404] Not Found: '//mirror.koddos.net/sagemath/spkg/upstream/gap_packages/gap-4.11.0.tar.bz2'\n[gap-4.11.0.p0] http://www.mirrorservice.org/sites/www.sagemath.org/spkg/upstream/gap_packages/gap-4.11.0.tar.bz2\n```\nFor now I'm manually copying the gap tarball to /gap_packages/, but would be nice to get this fixed.\n\nCC:  @dimpase\n\nBranch/Commit: 6b0551918aa66216cf167ddb512b89d41641455c\n\nReviewer: Dima Pasechnik\n\nAuthor: Matthias Koeppe\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/30562\n\n",
    "closed_at": "2020-09-27T09:09:35Z",
    "created_at": "2020-09-12T11:51:03Z",
    "labels": [
        "component: packages: standard",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "Gap downloads from wrong upstream directory",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30562",
    "user": "https://github.com/vbraun"
}
```
It should download $HOST/upstream/gap/gap-4.11.0.tar.bz2, but goes for /upstream/gap_packages/ instead:

```
[gap-4.11.0.p0] Found local metadata for gap-4.11.0.p0
[gap-4.11.0.p0] Attempting to download package gap-4.11.0.tar.bz2 from mirrors
[gap-4.11.0.p0] http://sagepad.org/spkg/upstream/gap_packages/gap-4.11.0.tar.bz2
[gap-4.11.0.p0] [xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx]
[gap-4.11.0.p0] ERROR [transfer|run:135]: [Errno 404] Not Found: '//sagepad.org/spkg/upstream/gap_packages/gap-4.11.0.tar.bz2'
[gap-4.11.0.p0] https://mirror.koddos.net/sagemath/spkg/upstream/gap_packages/gap-4.11.0.tar.bz2
[gap-4.11.0.p0] [xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx]
[gap-4.11.0.p0] ERROR [transfer|run:135]: [Errno 404] Not Found: '//mirror.koddos.net/sagemath/spkg/upstream/gap_packages/gap-4.11.0.tar.bz2'
[gap-4.11.0.p0] http://www.mirrorservice.org/sites/www.sagemath.org/spkg/upstream/gap_packages/gap-4.11.0.tar.bz2
```
For now I'm manually copying the gap tarball to /gap_packages/, but would be nice to get this fixed.

CC:  @dimpase

Branch/Commit: 6b0551918aa66216cf167ddb512b89d41641455c

Reviewer: Dima Pasechnik

Author: Matthias Koeppe

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/30562





---

archive/issue_events_079441.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-12T21:24:02Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30562",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30562#event-79441"
}
```



---

archive/issue_comments_461405.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-09-12T21:24:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30562#issuecomment-461405",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_461406.json:
```json
{
    "body": "<a id='comment:1'></a>Fixed this in #29314 by using symlinks instead of duplicating the checksums.ini file",
    "created_at": "2020-09-12T21:24:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30562#issuecomment-461406",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:1'></a>Fixed this in #29314 by using symlinks instead of duplicating the checksums.ini file



---

archive/issue_comments_461407.json:
```json
{
    "body": "<a id='comment:2'></a>Except that #29314 is hit by a swarm of open cans of worms. Makes me willing to redo the Sage's docbuild using the standard modern sphinx, I don't care if it will get slower.",
    "created_at": "2020-09-13T07:09:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30562#issuecomment-461407",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:2'></a>Except that #29314 is hit by a swarm of open cans of worms. Makes me willing to redo the Sage's docbuild using the standard modern sphinx, I don't care if it will get slower.



---

archive/issue_events_079442.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-13T16:34:22Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30562",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30562#event-79442"
}
```



---

archive/issue_events_079443.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-13T16:34:22Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30562",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30562#event-79443"
}
```



---

archive/issue_comments_461408.json:
```json
{
    "body": "<a id='comment:4'></a>New commits:",
    "created_at": "2020-09-13T16:34:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30562#issuecomment-461408",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:4'></a>New commits:



---

archive/issue_comments_461409.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-09-14T12:00:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30562#issuecomment-461409",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_461410.json:
```json
{
    "body": "<a id='comment:5'></a>It works if I already have the GAP tarball in upstream.\nI believe it's usually will be the case, as gap is a dependency of gap_packages, thus the tarball will be fetched for gap, if gap is not installed.\n\nI've also tested that removing the tarball from upstream triggers its downloading if gap is already installed, but gap_packages is not.\n\nSo, all good.",
    "created_at": "2020-09-14T12:00:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30562#issuecomment-461410",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:5'></a>It works if I already have the GAP tarball in upstream.
I believe it's usually will be the case, as gap is a dependency of gap_packages, thus the tarball will be fetched for gap, if gap is not installed.

I've also tested that removing the tarball from upstream triggers its downloading if gap is already installed, but gap_packages is not.

So, all good.



---

archive/issue_comments_461411.json:
```json
{
    "body": "<a id='comment:6'></a>Thanks.",
    "created_at": "2020-09-14T12:13:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30562#issuecomment-461411",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:6'></a>Thanks.



---

archive/issue_comments_461412.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-09-27T09:09:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30562#issuecomment-461412",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_079444.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-09-27T09:09:35Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/30562",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30562#event-79444"
}
```
