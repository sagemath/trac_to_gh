# Issue 30097: Second instance of MaximaLib

archive/issues_029860.json:
```json
{
    "assignees": [],
    "body": "Maxima essentially just uses a single Common Lisp package `:MAXIMA`.\n\nAfter loading Maxima into ECL at the beginning of `sage.interfaces.maxima_lib`, we just rename the package `:MAXIMA` to `:MAXIMA_LIB` and remove maxima from `*MODULES*`. \n\nBecause `maxima_lib.py` is written in a style using lots of global variables, we duplicate this module using a symlink.  (This can be improved in a follow-up ticket.)\nImporting `sage.interfaces.maxima_lib_2` loads another copy of Maxima using `REQUIRE`, and renames the package `:MAXIMA` to `:MAXIMA_LIB_2`.\n\nThe global name `maxima` is now imported from `sage.interfaces.maxima_lib_2` instead of `sage.interfaces.maxima`, so it uses the 2nd copy of the maxima library interface.\n\nThe two copies of maxima are isolated from each other::\n\n```\nsage: maxima(\"xyz: 123\")\n123\nsage: maxima_calculus(\"xyz\")\nxyz\nsage: maxima(\"xyz\")\n123\n```\n\nThe global name `Maxima` still refers to the pexpect interface class.\n\nDetails:\n\nWe make `:COMMON-LISP-USER` the default package. During `maxima_eval`, we bind `*PACKAGE*` to the correct package object. We replace the use of the `#$` read macro by a direct use of `MREAD` (while binding `*PACKAGE`). During `$LOAD`, we temporarily set up a package nickname `:MAXIMA` so that the loaded Lisp files can do `(IN-PACKAGE :MAXIMA)`. \n\n\n\nDepends on #30105\n\nCC:  @dimpase @nbruin @jpflori @EmmanuelCharpentier\n\nBranch/Commit: **[u/mkoeppe/several_instances_of_maximalib](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/several_instances_of_maximalib) @ [`a3b58ad`](https://github.com/sagemath/sagetrac-mirror/commit/a3b58ad46c77173591e3151a860b2bde53e11c91)**\n\nAuthor: **Matthias Koeppe**\n\nComponent: **interfaces**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/30097_\n\n",
    "created_at": "2020-07-09T03:08:25Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20interfaces",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement",
        "https://github.com/sagemath/sage/labels/needs%20work"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.9",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Second instance of MaximaLib",
    "type": "issue",
    "updated_at": "2023-01-07T21:39:40Z",
    "url": "https://github.com/sagemath/sage/issues/30097",
    "user": "https://github.com/mkoeppe"
}
```
Maxima essentially just uses a single Common Lisp package `:MAXIMA`.

After loading Maxima into ECL at the beginning of `sage.interfaces.maxima_lib`, we just rename the package `:MAXIMA` to `:MAXIMA_LIB` and remove maxima from `*MODULES*`. 

Because `maxima_lib.py` is written in a style using lots of global variables, we duplicate this module using a symlink.  (This can be improved in a follow-up ticket.)
Importing `sage.interfaces.maxima_lib_2` loads another copy of Maxima using `REQUIRE`, and renames the package `:MAXIMA` to `:MAXIMA_LIB_2`.

The global name `maxima` is now imported from `sage.interfaces.maxima_lib_2` instead of `sage.interfaces.maxima`, so it uses the 2nd copy of the maxima library interface.

The two copies of maxima are isolated from each other::

```
sage: maxima("xyz: 123")
123
sage: maxima_calculus("xyz")
xyz
sage: maxima("xyz")
123
```

The global name `Maxima` still refers to the pexpect interface class.

Details:

We make `:COMMON-LISP-USER` the default package. During `maxima_eval`, we bind `*PACKAGE*` to the correct package object. We replace the use of the `#$` read macro by a direct use of `MREAD` (while binding `*PACKAGE`). During `$LOAD`, we temporarily set up a package nickname `:MAXIMA` so that the loaded Lisp files can do `(IN-PACKAGE :MAXIMA)`. 



Depends on #30105

CC:  @dimpase @nbruin @jpflori @EmmanuelCharpentier

Branch/Commit: **[u/mkoeppe/several_instances_of_maximalib](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/several_instances_of_maximalib) @ [`a3b58ad`](https://github.com/sagemath/sagetrac-mirror/commit/a3b58ad46c77173591e3151a860b2bde53e11c91)**

Author: **Matthias Koeppe**

Component: **interfaces**

_Issue created by migration from https://trac.sagemath.org/ticket/30097_





---

archive/issue_events_414459.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-07-09T03:08:25Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30097",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30097#event-414459"
}
```



---

archive/issue_events_414460.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-07-09T03:08:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30097",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20interfaces",
    "label_color": "0000ff",
    "label_name": "c: interfaces",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30097#event-414460"
}
```



---

archive/issue_events_414461.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-07-09T03:08:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30097",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30097#event-414461"
}
```



---

archive/issue_events_414462.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-07-09T03:08:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30097",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30097#event-414462"
}
```



---

archive/issue_comments_476597.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -24,3 +24,9 @@\n # loaded another copy!\n ```\n \n+In `maxima_eval`, we bind `*PACKAGE*` to the correct package object. We replace the use of the `#$` read macro by a direct use of `MACSYMA-READ-STRING` (from the correct package).\n+\n+Because `maxima_lib.py` is written in a style using lots of global variables, we duplicate this module using a symlink.  This can be improved in a follow-up ticket.\n+\n+\n+\n``````\n",
    "created_at": "2020-07-09T04:47:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30097#issuecomment-476597",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -24,3 +24,9 @@
 # loaded another copy!
 ```
 
+In `maxima_eval`, we bind `*PACKAGE*` to the correct package object. We replace the use of the `#$` read macro by a direct use of `MACSYMA-READ-STRING` (from the correct package).
+
+Because `maxima_lib.py` is written in a style using lots of global variables, we duplicate this module using a symlink.  This can be improved in a follow-up ticket.
+
+
+
``````




---

archive/issue_comments_476598.json:
```json
{
    "body": "Branch: **[u/mkoeppe/several_instances_of_maximalib](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/several_instances_of_maximalib)**",
    "created_at": "2020-07-09T06:00:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30097#issuecomment-476598",
    "user": "https://github.com/mkoeppe"
}
```

Branch: **[u/mkoeppe/several_instances_of_maximalib](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/several_instances_of_maximalib)**



---

archive/issue_comments_476599.json:
```json
{
    "body": "Commit: **[`177e903`](https://github.com/sagemath/sagetrac-mirror/commit/177e903b745b2dfd78bbbfe6cc5b3047ae4c6cd5)**",
    "created_at": "2020-07-09T06:00:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30097#issuecomment-476599",
    "user": "https://github.com/mkoeppe"
}
```

Commit: **[`177e903`](https://github.com/sagemath/sagetrac-mirror/commit/177e903b745b2dfd78bbbfe6cc5b3047ae4c6cd5)**



---

archive/issue_comments_476600.json:
```json
{
    "body": "<div id=\"comment:3\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/177e903b745b2dfd78bbbfe6cc5b3047ae4c6cd5\"><code>177e903</code></a></td><td><code>sage.interfaces.maxima_lib: Rename the MAXIMA Lisp package</code></td></tr></table>\n",
    "created_at": "2020-07-09T06:00:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30097#issuecomment-476600",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:3"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/177e903b745b2dfd78bbbfe6cc5b3047ae4c6cd5"><code>177e903</code></a></td><td><code>sage.interfaces.maxima_lib: Rename the MAXIMA Lisp package</code></td></tr></table>




---

archive/issue_comments_476601.json:
```json
{
    "body": "Author: **Matthias Koeppe**",
    "created_at": "2020-07-09T06:00:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30097#issuecomment-476601",
    "user": "https://github.com/mkoeppe"
}
```

Author: **Matthias Koeppe**



---

archive/issue_comments_476602.json:
```json
{
    "body": "<div id=\"comment:4\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/563aeb627b05c9ec2d8b288c4b60315e40890adf\"><code>563aeb6</code></a></td><td><code>Patch $LOAD, INTERN-INVERT-CASE, $GENSYM</code></td></tr></table>\n",
    "created_at": "2020-07-09T06:51:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30097#issuecomment-476602",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:4"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/563aeb627b05c9ec2d8b288c4b60315e40890adf"><code>563aeb6</code></a></td><td><code>Patch $LOAD, INTERN-INVERT-CASE, $GENSYM</code></td></tr></table>




---

archive/issue_comments_476603.json:
```json
{
    "body": "Changed commit from **[`177e903`](https://github.com/sagemath/sagetrac-mirror/commit/177e903b745b2dfd78bbbfe6cc5b3047ae4c6cd5)** to **[`563aeb6`](https://github.com/sagemath/sagetrac-mirror/commit/563aeb627b05c9ec2d8b288c4b60315e40890adf)**",
    "created_at": "2020-07-09T06:51:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30097#issuecomment-476603",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`177e903`](https://github.com/sagemath/sagetrac-mirror/commit/177e903b745b2dfd78bbbfe6cc5b3047ae4c6cd5)** to **[`563aeb6`](https://github.com/sagemath/sagetrac-mirror/commit/563aeb627b05c9ec2d8b288c4b60315e40890adf)**



---

archive/issue_comments_476604.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nUnfinished, setting it to needs-review so that the patchbot runs",
    "created_at": "2020-07-09T06:55:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30097#issuecomment-476604",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:5" align="right">comment:5</div>

Unfinished, setting it to needs-review so that the patchbot runs



---

archive/issue_events_414463.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-07-09T06:55:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30097",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30097#event-414463"
}
```



---

archive/issue_comments_476605.json:
```json
{
    "body": "Changed commit from **[`563aeb6`](https://github.com/sagemath/sagetrac-mirror/commit/563aeb627b05c9ec2d8b288c4b60315e40890adf)** to **[`9d4dc92`](https://github.com/sagemath/sagetrac-mirror/commit/9d4dc92c685826a252bb7d2b8b6ceafd2ffa0982)**",
    "created_at": "2020-07-09T07:55:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30097#issuecomment-476605",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`563aeb6`](https://github.com/sagemath/sagetrac-mirror/commit/563aeb627b05c9ec2d8b288c4b60315e40890adf)** to **[`9d4dc92`](https://github.com/sagemath/sagetrac-mirror/commit/9d4dc92c685826a252bb7d2b8b6ceafd2ffa0982)**



---

archive/issue_comments_476606.json:
```json
{
    "body": "<div id=\"comment:6\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9d4dc92c685826a252bb7d2b8b6ceafd2ffa0982\"><code>9d4dc92</code></a></td><td><code>Fix maxima_read_eval, use it for init_code</code></td></tr></table>\n",
    "created_at": "2020-07-09T07:55:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30097#issuecomment-476606",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:6"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9d4dc92c685826a252bb7d2b8b6ceafd2ffa0982"><code>9d4dc92</code></a></td><td><code>Fix maxima_read_eval, use it for init_code</code></td></tr></table>




---

archive/issue_comments_476607.json:
```json
{
    "body": "<div id=\"comment:7\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/08318df72741124202b57520807b82c4a42a2867\"><code>08318df</code></a></td><td><code>Get rid of some #$</code></td></tr></table>\n",
    "created_at": "2020-07-09T08:10:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30097#issuecomment-476607",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:7"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/08318df72741124202b57520807b82c4a42a2867"><code>08318df</code></a></td><td><code>Get rid of some #$</code></td></tr></table>




---

archive/issue_comments_476608.json:
```json
{
    "body": "Changed commit from **[`9d4dc92`](https://github.com/sagemath/sagetrac-mirror/commit/9d4dc92c685826a252bb7d2b8b6ceafd2ffa0982)** to **[`08318df`](https://github.com/sagemath/sagetrac-mirror/commit/08318df72741124202b57520807b82c4a42a2867)**",
    "created_at": "2020-07-09T08:10:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30097#issuecomment-476608",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`9d4dc92`](https://github.com/sagemath/sagetrac-mirror/commit/9d4dc92c685826a252bb7d2b8b6ceafd2ffa0982)** to **[`08318df`](https://github.com/sagemath/sagetrac-mirror/commit/08318df72741124202b57520807b82c4a42a2867)**



---

archive/issue_comments_476609.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nMore work to be done, but some preliminary testing makes sense",
    "created_at": "2020-07-09T08:10:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30097#issuecomment-476609",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:8" align="right">comment:8</div>

More work to be done, but some preliminary testing makes sense



---

archive/issue_comments_476610.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nAre you planning to use this to switch SR to maxima_lib ?",
    "created_at": "2020-07-09T13:40:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30097#issuecomment-476610",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:9" align="right">comment:9</div>

Are you planning to use this to switch SR to maxima_lib ?



---

archive/issue_comments_476611.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\n`SR` is already using maxima_lib.",
    "created_at": "2020-07-09T14:03:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30097#issuecomment-476611",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:10" align="right">comment:10</div>

`SR` is already using maxima_lib.



---

archive/issue_comments_476612.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nI hope to switch the remaining uses of maxima, mostly in doctests, to the second copy of `maxima_lib` when this ticket is ready, so that we can retire maxima_pexpect.",
    "created_at": "2020-07-09T14:05:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30097#issuecomment-476612",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:11" align="right">comment:11</div>

I hope to switch the remaining uses of maxima, mostly in doctests, to the second copy of `maxima_lib` when this ticket is ready, so that we can retire maxima_pexpect.



---

archive/issue_comments_476613.json:
```json
{
    "body": "Changed commit from **[`08318df`](https://github.com/sagemath/sagetrac-mirror/commit/08318df72741124202b57520807b82c4a42a2867)** to **[`bd555f5`](https://github.com/sagemath/sagetrac-mirror/commit/bd555f586feb606b0c1884c90e8044a0ac9b1dc3)**",
    "created_at": "2020-07-09T14:36:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30097#issuecomment-476613",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`08318df`](https://github.com/sagemath/sagetrac-mirror/commit/08318df72741124202b57520807b82c4a42a2867)** to **[`bd555f5`](https://github.com/sagemath/sagetrac-mirror/commit/bd555f586feb606b0c1884c90e8044a0ac9b1dc3)**



---

archive/issue_comments_476614.json:
```json
{
    "body": "<div id=\"comment:12\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fb166885dd79f4ec941b5286facdfe9fbf3c06ab\"><code>fb16688</code></a></td><td><code>: Make more robust: remove a possible nickname MAXIMA, use UNWIND-PROTECT to clean up</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bd555f586feb606b0c1884c90e8044a0ac9b1dc3\"><code>bd555f5</code></a></td><td><code>At the end of loading the module, switch back to :COMMON-LISP-USER</code></td></tr></table>\n",
    "created_at": "2020-07-09T14:36:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30097#issuecomment-476614",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:12"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fb166885dd79f4ec941b5286facdfe9fbf3c06ab"><code>fb16688</code></a></td><td><code>: Make more robust: remove a possible nickname MAXIMA, use UNWIND-PROTECT to clean up</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bd555f586feb606b0c1884c90e8044a0ac9b1dc3"><code>bd555f5</code></a></td><td><code>At the end of loading the module, switch back to :COMMON-LISP-USER</code></td></tr></table>




---

archive/issue_comments_476615.json:
```json
{
    "body": "<div id=\"comment:13\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e8672a4d1255d9f23f6e0dd34a423a3999935fa7\"><code>e8672a4</code></a></td><td><code>sage.interfaces.all: Import maxima from .maxima_lib_2</code></td></tr></table>\n",
    "created_at": "2020-07-09T14:57:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30097#issuecomment-476615",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:13"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e8672a4d1255d9f23f6e0dd34a423a3999935fa7"><code>e8672a4</code></a></td><td><code>sage.interfaces.all: Import maxima from .maxima_lib_2</code></td></tr></table>




---

archive/issue_comments_476616.json:
```json
{
    "body": "Changed commit from **[`bd555f5`](https://github.com/sagemath/sagetrac-mirror/commit/bd555f586feb606b0c1884c90e8044a0ac9b1dc3)** to **[`e8672a4`](https://github.com/sagemath/sagetrac-mirror/commit/e8672a4d1255d9f23f6e0dd34a423a3999935fa7)**",
    "created_at": "2020-07-09T14:57:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30097#issuecomment-476616",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`bd555f5`](https://github.com/sagemath/sagetrac-mirror/commit/bd555f586feb606b0c1884c90e8044a0ac9b1dc3)** to **[`e8672a4`](https://github.com/sagemath/sagetrac-mirror/commit/e8672a4d1255d9f23f6e0dd34a423a3999935fa7)**



---

archive/issue_comments_476617.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,32 +1,23 @@\n Maxima essentially just uses a single Common Lisp package `:MAXIMA`.\n \n-After loading Maxima, we just rename the package and remove maxima from `*MODULES*`\n-Then we can load another copy.\n+After loading Maxima, we just rename the package and remove maxima from `*MODULES*` Then we can load another copy.\n+\n+Because `maxima_lib.py` is written in a style using lots of global variables, we duplicate this module using a symlink.  (This can be improved in a follow-up ticket.)\n+\n+The global name `maxima` is now imported from `sage.interfaces.maxima_lib_2` (the second copy, which operates in the Common Lisp package `MAXIMA_LIB_2`.\n+\n+The two copies of maxima are isolated from each other::\n \n ```\n-sage: from sage.interfaces.maxima_lib import ecl_eval\n-sage: var('y', domain='real')\n-y\n-sage:  ecl_eval('''(symbol-package '$besselexpand)''')\n-<ECL: #<\"MAXIMA\" package>>\n-sage: ecl_eval('''(rename-package 'maxima \"MINIMA\")''')\n-<ECL: #<\"MINIMA\" package>>\n-sage:  ecl_eval('''(symbol-package '$besselexpand)''')\n-<ECL: #<\"MINIMA\" package>>\n-sage:  ecl_eval('''(require 'maxima)''')\n-<ECL: NIL>\n-sage: ecl_eval('''*modules*''')\n-<ECL: (\"CMP\" \"SB-BSD-SOCKETS\" \"SOCKETS\" \"MAXIMA\" \"ECL-CDB\" \"BYTECMP\")>\n-sage: ecl_eval('''(delete \"MAXIMA\" *modules* :test #'string=)''')\n-<ECL: (\"CMP\" \"SB-BSD-SOCKETS\" \"SOCKETS\" \"ECL-CDB\" \"BYTECMP\")>\n-sage:  ecl_eval('''(require 'maxima)''')\n-<ECL: (\"MAXIMA\")>\n-# loaded another copy!\n-```\n+sage: maxima(\"xyz: 123\")\n+123\n+sage: maxima_calculus(\"xyz\")\n+xyz\n+sage: maxima(\"xyz\")\n+123\n \n In `maxima_eval`, we bind `*PACKAGE*` to the correct package object. We replace the use of the `#$` read macro by a direct use of `MACSYMA-READ-STRING` (from the correct package).\n \n-Because `maxima_lib.py` is written in a style using lots of global variables, we duplicate this module using a symlink.  This can be improved in a follow-up ticket.\n \n \n \n``````\n",
    "created_at": "2020-07-09T14:57:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30097#issuecomment-476617",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,32 +1,23 @@
 Maxima essentially just uses a single Common Lisp package `:MAXIMA`.
 
-After loading Maxima, we just rename the package and remove maxima from `*MODULES*`
-Then we can load another copy.
+After loading Maxima, we just rename the package and remove maxima from `*MODULES*` Then we can load another copy.
+
+Because `maxima_lib.py` is written in a style using lots of global variables, we duplicate this module using a symlink.  (This can be improved in a follow-up ticket.)
+
+The global name `maxima` is now imported from `sage.interfaces.maxima_lib_2` (the second copy, which operates in the Common Lisp package `MAXIMA_LIB_2`.
+
+The two copies of maxima are isolated from each other::
 
 ```
-sage: from sage.interfaces.maxima_lib import ecl_eval
-sage: var('y', domain='real')
-y
-sage:  ecl_eval('''(symbol-package '$besselexpand)''')
-<ECL: #<"MAXIMA" package>>
-sage: ecl_eval('''(rename-package 'maxima "MINIMA")''')
-<ECL: #<"MINIMA" package>>
-sage:  ecl_eval('''(symbol-package '$besselexpand)''')
-<ECL: #<"MINIMA" package>>
-sage:  ecl_eval('''(require 'maxima)''')
-<ECL: NIL>
-sage: ecl_eval('''*modules*''')
-<ECL: ("CMP" "SB-BSD-SOCKETS" "SOCKETS" "MAXIMA" "ECL-CDB" "BYTECMP")>
-sage: ecl_eval('''(delete "MAXIMA" *modules* :test #'string=)''')
-<ECL: ("CMP" "SB-BSD-SOCKETS" "SOCKETS" "ECL-CDB" "BYTECMP")>
-sage:  ecl_eval('''(require 'maxima)''')
-<ECL: ("MAXIMA")>
-# loaded another copy!
-```
+sage: maxima("xyz: 123")
+123
+sage: maxima_calculus("xyz")
+xyz
+sage: maxima("xyz")
+123
 
 In `maxima_eval`, we bind `*PACKAGE*` to the correct package object. We replace the use of the `#$` read macro by a direct use of `MACSYMA-READ-STRING` (from the correct package).
 
-Because `maxima_lib.py` is written in a style using lots of global variables, we duplicate this module using a symlink.  This can be improved in a follow-up ticket.
 
 
 
``````




---

archive/issue_comments_476618.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,10 +1,11 @@\n Maxima essentially just uses a single Common Lisp package `:MAXIMA`.\n \n-After loading Maxima, we just rename the package and remove maxima from `*MODULES*` Then we can load another copy.\n+After loading Maxima into ECL at the beginning of `sage.interfaces.maxima_lib`, we just rename the package `:MAXIMA` to `:MAXIMA_LIB` and remove maxima from `*MODULES*`. \n \n Because `maxima_lib.py` is written in a style using lots of global variables, we duplicate this module using a symlink.  (This can be improved in a follow-up ticket.)\n+Importing `sage.interfaces.maxima_lib_2` loads another copy of Maxima using `REQUIRE`, and renames the package `:MAXIMA` to `:MAXIMA_LIB_2`.\n \n-The global name `maxima` is now imported from `sage.interfaces.maxima_lib_2` (the second copy, which operates in the Common Lisp package `MAXIMA_LIB_2`.\n+The global name `maxima` is now imported from `sage.interfaces.maxima_lib_2` instead of `sage.interfaces.maxima`, so it uses the 2nd copy of the maxima library interface.\n \n The two copies of maxima are isolated from each other::\n \n@@ -15,9 +16,12 @@\n xyz\n sage: maxima(\"xyz\")\n 123\n+```\n \n-In `maxima_eval`, we bind `*PACKAGE*` to the correct package object. We replace the use of the `#$` read macro by a direct use of `MACSYMA-READ-STRING` (from the correct package).\n+The global name `Maxima` still refers to the pexpect interface class.\n+\n+Details:\n+\n+We make `:COMMON-LISP-USER` the default package. During `maxima_eval`, we bind `*PACKAGE*` to the correct package object. We replace the use of the `#$` read macro by a direct use of `MREAD` (while binding `*PACKAGE`). During `$LOAD`, we temporarily set up a package nickname `:MAXIMA` so that the loaded Lisp files can do `(IN-PACKAGE :MAXIMA)`. \n \n \n-\n-\n``````\n",
    "created_at": "2020-07-09T15:09:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30097#issuecomment-476618",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,10 +1,11 @@
 Maxima essentially just uses a single Common Lisp package `:MAXIMA`.
 
-After loading Maxima, we just rename the package and remove maxima from `*MODULES*` Then we can load another copy.
+After loading Maxima into ECL at the beginning of `sage.interfaces.maxima_lib`, we just rename the package `:MAXIMA` to `:MAXIMA_LIB` and remove maxima from `*MODULES*`. 
 
 Because `maxima_lib.py` is written in a style using lots of global variables, we duplicate this module using a symlink.  (This can be improved in a follow-up ticket.)
+Importing `sage.interfaces.maxima_lib_2` loads another copy of Maxima using `REQUIRE`, and renames the package `:MAXIMA` to `:MAXIMA_LIB_2`.
 
-The global name `maxima` is now imported from `sage.interfaces.maxima_lib_2` (the second copy, which operates in the Common Lisp package `MAXIMA_LIB_2`.
+The global name `maxima` is now imported from `sage.interfaces.maxima_lib_2` instead of `sage.interfaces.maxima`, so it uses the 2nd copy of the maxima library interface.
 
 The two copies of maxima are isolated from each other::
 
@@ -15,9 +16,12 @@
 xyz
 sage: maxima("xyz")
 123
+```
 
-In `maxima_eval`, we bind `*PACKAGE*` to the correct package object. We replace the use of the `#$` read macro by a direct use of `MACSYMA-READ-STRING` (from the correct package).
+The global name `Maxima` still refers to the pexpect interface class.
+
+Details:
+
+We make `:COMMON-LISP-USER` the default package. During `maxima_eval`, we bind `*PACKAGE*` to the correct package object. We replace the use of the `#$` read macro by a direct use of `MREAD` (while binding `*PACKAGE`). During `$LOAD`, we temporarily set up a package nickname `:MAXIMA` so that the loaded Lisp files can do `(IN-PACKAGE :MAXIMA)`. 
 
 
-
-
``````




---

archive/issue_comments_476619.json:
```json
{
    "body": "<div id=\"comment:16\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9353d6a2e90b2f13a14d5194f28c7a30f8fd5a47\"><code>9353d6a</code></a></td><td><code>Robustness: Make sure MAXIMA is not in *MODULES* at the beginning</code></td></tr></table>\n",
    "created_at": "2020-07-09T15:10:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30097#issuecomment-476619",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:16"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9353d6a2e90b2f13a14d5194f28c7a30f8fd5a47"><code>9353d6a</code></a></td><td><code>Robustness: Make sure MAXIMA is not in *MODULES* at the beginning</code></td></tr></table>




---

archive/issue_comments_476620.json:
```json
{
    "body": "Changed commit from **[`e8672a4`](https://github.com/sagemath/sagetrac-mirror/commit/e8672a4d1255d9f23f6e0dd34a423a3999935fa7)** to **[`9353d6a`](https://github.com/sagemath/sagetrac-mirror/commit/9353d6a2e90b2f13a14d5194f28c7a30f8fd5a47)**",
    "created_at": "2020-07-09T15:10:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30097#issuecomment-476620",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`e8672a4`](https://github.com/sagemath/sagetrac-mirror/commit/e8672a4d1255d9f23f6e0dd34a423a3999935fa7)** to **[`9353d6a`](https://github.com/sagemath/sagetrac-mirror/commit/9353d6a2e90b2f13a14d5194f28c7a30f8fd5a47)**



---

archive/issue_events_414464.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-07-09T15:18:19Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/30097",
    "title_is": "Second instance of MaximaLib",
    "title_was": "Several instances of MaximaLib",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30097#event-414464"
}
```



---

archive/issue_comments_476621.json:
```json
{
    "body": "Changed commit from **[`9353d6a`](https://github.com/sagemath/sagetrac-mirror/commit/9353d6a2e90b2f13a14d5194f28c7a30f8fd5a47)** to **[`0ded2ff`](https://github.com/sagemath/sagetrac-mirror/commit/0ded2ffa622d63745b29756dbe734ee49f551081)**",
    "created_at": "2020-07-09T15:32:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30097#issuecomment-476621",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`9353d6a`](https://github.com/sagemath/sagetrac-mirror/commit/9353d6a2e90b2f13a14d5194f28c7a30f8fd5a47)** to **[`0ded2ff`](https://github.com/sagemath/sagetrac-mirror/commit/0ded2ffa622d63745b29756dbe734ee49f551081)**



---

archive/issue_comments_476622.json:
```json
{
    "body": "<div id=\"comment:18\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0ded2ffa622d63745b29756dbe734ee49f551081\"><code>0ded2ff</code></a></td><td><code>Remove remaining uses of the read macro</code></td></tr></table>\n",
    "created_at": "2020-07-09T15:32:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30097#issuecomment-476622",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:18"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0ded2ffa622d63745b29756dbe734ee49f551081"><code>0ded2ff</code></a></td><td><code>Remove remaining uses of the read macro</code></td></tr></table>




---

archive/issue_comments_476623.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nReady for testing/review",
    "created_at": "2020-07-09T15:44:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30097#issuecomment-476623",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:19" align="right">comment:19</div>

Ready for testing/review



---

archive/issue_comments_476624.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nSome details still need to be fixed: \n- When ECL objects are passed to an interface object, it needs to be checked that it is for the correct copy of the package. \n- The doctests do not really test the second copy\n- Some doctests fail because things now print with their package:\n\n```\nFile \"src/sage/interfaces/maxima_lib_2.py\", line 1509, in sage.interfaces.maxima_lib_2.dummy_integrate\nFailed example:\n    f.ecl()\nExpected:\n    <ECL: ((%INTEGRATE SIMP) (($F SIMP) $X) $X)>\nGot:\n    <ECL: ((MAXIMA_LIB::%INTEGRATE MAXIMA_LIB::SIMP)\n     ((MAXIMA_LIB::$F MAXIMA_LIB::SIMP) MAXIMA_LIB::$X) MAXIMA_LIB::$X)>\n```",
    "created_at": "2020-07-09T18:15:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30097#issuecomment-476624",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:20" align="right">comment:20</div>

Some details still need to be fixed: 
- When ECL objects are passed to an interface object, it needs to be checked that it is for the correct copy of the package. 
- The doctests do not really test the second copy
- Some doctests fail because things now print with their package:

```
File "src/sage/interfaces/maxima_lib_2.py", line 1509, in sage.interfaces.maxima_lib_2.dummy_integrate
Failed example:
    f.ecl()
Expected:
    <ECL: ((%INTEGRATE SIMP) (($F SIMP) $X) $X)>
Got:
    <ECL: ((MAXIMA_LIB::%INTEGRATE MAXIMA_LIB::SIMP)
     ((MAXIMA_LIB::$F MAXIMA_LIB::SIMP) MAXIMA_LIB::$X) MAXIMA_LIB::$X)>
```



---

archive/issue_comments_476625.json:
```json
{
    "body": "<div id=\"comment:21\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bcd79034f88270c9a6eb8318d614d7b1557326cc\"><code>bcd7903</code></a></td><td><code>Add HANDLER-CASE to MAXIMA-EVAL as a debugging aid</code></td></tr></table>\n",
    "created_at": "2020-07-09T19:51:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30097#issuecomment-476625",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:21"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bcd79034f88270c9a6eb8318d614d7b1557326cc"><code>bcd7903</code></a></td><td><code>Add HANDLER-CASE to MAXIMA-EVAL as a debugging aid</code></td></tr></table>




---

archive/issue_comments_476626.json:
```json
{
    "body": "Changed commit from **[`0ded2ff`](https://github.com/sagemath/sagetrac-mirror/commit/0ded2ffa622d63745b29756dbe734ee49f551081)** to **[`bcd7903`](https://github.com/sagemath/sagetrac-mirror/commit/bcd79034f88270c9a6eb8318d614d7b1557326cc)**",
    "created_at": "2020-07-09T19:51:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30097#issuecomment-476626",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`0ded2ff`](https://github.com/sagemath/sagetrac-mirror/commit/0ded2ffa622d63745b29756dbe734ee49f551081)** to **[`bcd7903`](https://github.com/sagemath/sagetrac-mirror/commit/bcd79034f88270c9a6eb8318d614d7b1557326cc)**



---

archive/issue_comments_476627.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nIt's nice you can do it, but do we need it? I suspect that the remaining uses of the maxima interface in library code don't actually need to be isolated from the calculus instance.\n\nIf you do think it's worth supporting multiple instances of maxima_lib interfaces, then I think it shouldn't be hardcoded at only 2 copies. I think it's possible (with some hackery) to have multiple instances of the same module in python:\n\nhttps://stackoverflow.com/questions/11170949/how-to-make-a-copy-of-a-python-module-at-runtime\n\nthe trick would now be to somehow parametrize the name of the corresponding package in ecl, but that should be quite solvable (if all else fails, we could park a global counter somewhere outside the maxima_lib package -- for instance in ECL if all else fails -- that it can use to see how many copies already exist)\n\nA thing to be careful about it that in CL, at least for the REPL, there is global state as to what the \"current package\" is. I'm not 100% sure that this isn't somewhere relied upon for maxima.\n\n---\n\nIf we're going down this route, you probably want reconsider the placement of some of the initialization code too. I think there might be some things in maxima_lib that prime it towards  \"calculus\" use. Having a \"vanilla\" maxima_lib interface would be one of the uses I could see.",
    "created_at": "2020-07-09T20:29:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30097#issuecomment-476627",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:22" align="right">comment:22</div>

It's nice you can do it, but do we need it? I suspect that the remaining uses of the maxima interface in library code don't actually need to be isolated from the calculus instance.

If you do think it's worth supporting multiple instances of maxima_lib interfaces, then I think it shouldn't be hardcoded at only 2 copies. I think it's possible (with some hackery) to have multiple instances of the same module in python:

https://stackoverflow.com/questions/11170949/how-to-make-a-copy-of-a-python-module-at-runtime

the trick would now be to somehow parametrize the name of the corresponding package in ecl, but that should be quite solvable (if all else fails, we could park a global counter somewhere outside the maxima_lib package -- for instance in ECL if all else fails -- that it can use to see how many copies already exist)

A thing to be careful about it that in CL, at least for the REPL, there is global state as to what the "current package" is. I'm not 100% sure that this isn't somewhere relied upon for maxima.

---

If we're going down this route, you probably want reconsider the placement of some of the initialization code too. I think there might be some things in maxima_lib that prime it towards  "calculus" use. Having a "vanilla" maxima_lib interface would be one of the uses I could see.



---

archive/issue_comments_476628.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nReplying to [@nbruin](#comment:22):\n> It's nice you can do it, but do we need it? I suspect that the remaining uses of the maxima interface in library code don't actually need to be isolated from the calculus instance.\n\nThat's a good point and certainly worth checking; I hope we can find and change such uses as part of #30071.\n\nBut there are lots of uses of maxima in doctests too.  If we switch these ones over to `maxima_calculus`, this might be advertising potentially unsafe uses to users. \n\nAnd the doctests are what have prompted this ticket -- we currently have problems with the Maxima pexpect on Cygwin on #22191 (update ECL to 20.4.24).\n\nLet's have this discussion -- on concrete uses of maxima -- on #30071.",
    "created_at": "2020-07-09T21:31:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30097#issuecomment-476628",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:23" align="right">comment:23</div>

Replying to [@nbruin](#comment:22):
> It's nice you can do it, but do we need it? I suspect that the remaining uses of the maxima interface in library code don't actually need to be isolated from the calculus instance.

That's a good point and certainly worth checking; I hope we can find and change such uses as part of #30071.

But there are lots of uses of maxima in doctests too.  If we switch these ones over to `maxima_calculus`, this might be advertising potentially unsafe uses to users. 

And the doctests are what have prompted this ticket -- we currently have problems with the Maxima pexpect on Cygwin on #22191 (update ECL to 20.4.24).

Let's have this discussion -- on concrete uses of maxima -- on #30071.



---

archive/issue_comments_476629.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nReplying to [@nbruin](#comment:22):\n> If you do think it's worth supporting multiple instances of maxima_lib interfaces, then I think it shouldn't be hardcoded at only 2 copies. I think it's possible (with some hackery) to have multiple instances of the same module in python:\n> \n> https://stackoverflow.com/questions/11170949/how-to-make-a-copy-of-a-python-module-at-runtime\n\nInstead of doing this, I think it would be better to rewrite the Python module so that the module globals are placed in the interface object instead. Trivial to do, but a huge patch, which is why I haven't done this on this ticket.\n\n> A thing to be careful about it that in CL, at least for the REPL, there is global state as to what the \"current package\" is. I'm not 100% sure that this isn't somewhere relied upon for maxima.\n\nYes, my current code is taking care of this already. There are just some minor details remaining.",
    "created_at": "2020-07-09T21:35:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30097#issuecomment-476629",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:24" align="right">comment:24</div>

Replying to [@nbruin](#comment:22):
> If you do think it's worth supporting multiple instances of maxima_lib interfaces, then I think it shouldn't be hardcoded at only 2 copies. I think it's possible (with some hackery) to have multiple instances of the same module in python:
> 
> https://stackoverflow.com/questions/11170949/how-to-make-a-copy-of-a-python-module-at-runtime

Instead of doing this, I think it would be better to rewrite the Python module so that the module globals are placed in the interface object instead. Trivial to do, but a huge patch, which is why I haven't done this on this ticket.

> A thing to be careful about it that in CL, at least for the REPL, there is global state as to what the "current package" is. I'm not 100% sure that this isn't somewhere relied upon for maxima.

Yes, my current code is taking care of this already. There are just some minor details remaining.



---

archive/issue_comments_476630.json:
```json
{
    "body": "Changed commit from **[`bcd7903`](https://github.com/sagemath/sagetrac-mirror/commit/bcd79034f88270c9a6eb8318d614d7b1557326cc)** to **[`e4ba567`](https://github.com/sagemath/sagetrac-mirror/commit/e4ba567e70b1e28dbea29a441f67c4fee98a50d4)**",
    "created_at": "2020-07-10T05:07:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30097#issuecomment-476630",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`bcd7903`](https://github.com/sagemath/sagetrac-mirror/commit/bcd79034f88270c9a6eb8318d614d7b1557326cc)** to **[`e4ba567`](https://github.com/sagemath/sagetrac-mirror/commit/e4ba567e70b1e28dbea29a441f67c4fee98a50d4)**



---

archive/issue_comments_476631.json:
```json
{
    "body": "<div id=\"comment:25\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e4ba567e70b1e28dbea29a441f67c4fee98a50d4\"><code>e4ba567</code></a></td><td><code>Rename also the :BIGFLOAT, :BIGFLOAT-IMPL packages</code></td></tr></table>\n",
    "created_at": "2020-07-10T05:07:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30097#issuecomment-476631",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:25"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e4ba567e70b1e28dbea29a441f67c4fee98a50d4"><code>e4ba567</code></a></td><td><code>Rename also the :BIGFLOAT, :BIGFLOAT-IMPL packages</code></td></tr></table>




---

archive/issue_comments_476632.json:
```json
{
    "body": "Dependencies: **#30105**",
    "created_at": "2020-07-10T21:43:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30097#issuecomment-476632",
    "user": "https://github.com/mkoeppe"
}
```

Dependencies: **#30105**



---

archive/issue_comments_476633.json:
```json
{
    "body": "<div id=\"comment:27\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/70a6351c733c505722268bf0ba730f5bea6323be\"><code>70a6351</code></a></td><td><code>sage.libs.ecl.EclObject.__init__: Add optional argument read_strings</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/70082c651dcb0159a1e1145f941b2a4c5b4aaa87\"><code>70082c6</code></a></td><td><code>Merge branch 't/30105/sage_libs_ecl__add_python_function_ecl_make_string' into t/30097/several_instances_of_maximalib</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0df4595fc0a2b42d4518c5bc104f0f0a78b43d4f\"><code>0df4595</code></a></td><td><code>src/sage/interfaces/maxima_lib.py: Use new conversion to Lisp strings</code></td></tr></table>\n",
    "created_at": "2020-07-10T21:51:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30097#issuecomment-476633",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:27"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/70a6351c733c505722268bf0ba730f5bea6323be"><code>70a6351</code></a></td><td><code>sage.libs.ecl.EclObject.__init__: Add optional argument read_strings</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/70082c651dcb0159a1e1145f941b2a4c5b4aaa87"><code>70082c6</code></a></td><td><code>Merge branch 't/30105/sage_libs_ecl__add_python_function_ecl_make_string' into t/30097/several_instances_of_maximalib</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0df4595fc0a2b42d4518c5bc104f0f0a78b43d4f"><code>0df4595</code></a></td><td><code>src/sage/interfaces/maxima_lib.py: Use new conversion to Lisp strings</code></td></tr></table>




---

archive/issue_comments_476634.json:
```json
{
    "body": "Changed commit from **[`e4ba567`](https://github.com/sagemath/sagetrac-mirror/commit/e4ba567e70b1e28dbea29a441f67c4fee98a50d4)** to **[`0df4595`](https://github.com/sagemath/sagetrac-mirror/commit/0df4595fc0a2b42d4518c5bc104f0f0a78b43d4f)**",
    "created_at": "2020-07-10T21:51:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30097#issuecomment-476634",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`e4ba567`](https://github.com/sagemath/sagetrac-mirror/commit/e4ba567e70b1e28dbea29a441f67c4fee98a50d4)** to **[`0df4595`](https://github.com/sagemath/sagetrac-mirror/commit/0df4595fc0a2b42d4518c5bc104f0f0a78b43d4f)**



---

archive/issue_comments_476635.json:
```json
{
    "body": "Changed commit from **[`0df4595`](https://github.com/sagemath/sagetrac-mirror/commit/0df4595fc0a2b42d4518c5bc104f0f0a78b43d4f)** to **[`a3b58ad`](https://github.com/sagemath/sagetrac-mirror/commit/a3b58ad46c77173591e3151a860b2bde53e11c91)**",
    "created_at": "2020-07-11T19:51:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30097#issuecomment-476635",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`0df4595`](https://github.com/sagemath/sagetrac-mirror/commit/0df4595fc0a2b42d4518c5bc104f0f0a78b43d4f)** to **[`a3b58ad`](https://github.com/sagemath/sagetrac-mirror/commit/a3b58ad46c77173591e3151a860b2bde53e11c91)**



---

archive/issue_comments_476636.json:
```json
{
    "body": "<div id=\"comment:28\"></div>\n\nBranch pushed to git repo; I updated commit sha1. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a3e0eca1690d463a8aeef9cac915f9fe6ff8baea\"><code>a3e0eca</code></a></td><td><code>add upstream fix from MR 215</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/89b006b106ca050240f580cb80d2a6320e5ade2e\"><code>89b006b</code></a></td><td><code>add the patch from upstream MR 214</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0b777377289ba21166ea8d4f647e38e8b6ea1d23\"><code>0b77737</code></a></td><td><code>add upstream MR 216 (to fix cygwin fork)</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8ca1c0e5223d3e94ed36da2bfc22c9e608283074\"><code>8ca1c0e</code></a></td><td><code>Merge tag '9.2.beta2' into t/22191/public/packages/ecl20</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f82c716fdf9c6e91a07166d36b6329a15ecfb41d\"><code>f82c716</code></a></td><td><code>Commit 75877dd8 from upstream</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2d87ee362ed1ea6c7833e1e8509456927c82c23b\"><code>2d87ee3</code></a></td><td><code>Merge commit 'f82c716fdf9c6e91a07166d36b6329a15ecfb41d' of git://trac.sagemath.org/sage into t/30106/sage_libs_ecl__fix_unicode_handling</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/828a727915e1920964c7bdbdd52e50b84e731a62\"><code>828a727</code></a></td><td><code>Add doctests</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0bfaccf1141b61768290c20a1bb47e846081c7e4\"><code>0bfaccf</code></a></td><td><code>Merge branch 't/30106/sage_libs_ecl__fix_unicode_handling' into t/30105/sage_libs_ecl__add_python_function_ecl_make_string</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dd27b331b73bba9b2ee1a522b0b047f5fa1ffedb\"><code>dd27b33</code></a></td><td><code>sage.libs.ecl: Update uses of python_to_ecl</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a3b58ad46c77173591e3151a860b2bde53e11c91\"><code>a3b58ad</code></a></td><td><code>Merge branch 't/30105/sage_libs_ecl__add_python_function_ecl_make_string' into t/30097/several_instances_of_maximalib</code></td></tr></table>\n",
    "created_at": "2020-07-11T19:51:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30097#issuecomment-476636",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:28"></div>

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a3e0eca1690d463a8aeef9cac915f9fe6ff8baea"><code>a3e0eca</code></a></td><td><code>add upstream fix from MR 215</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/89b006b106ca050240f580cb80d2a6320e5ade2e"><code>89b006b</code></a></td><td><code>add the patch from upstream MR 214</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0b777377289ba21166ea8d4f647e38e8b6ea1d23"><code>0b77737</code></a></td><td><code>add upstream MR 216 (to fix cygwin fork)</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8ca1c0e5223d3e94ed36da2bfc22c9e608283074"><code>8ca1c0e</code></a></td><td><code>Merge tag '9.2.beta2' into t/22191/public/packages/ecl20</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f82c716fdf9c6e91a07166d36b6329a15ecfb41d"><code>f82c716</code></a></td><td><code>Commit 75877dd8 from upstream</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2d87ee362ed1ea6c7833e1e8509456927c82c23b"><code>2d87ee3</code></a></td><td><code>Merge commit 'f82c716fdf9c6e91a07166d36b6329a15ecfb41d' of git://trac.sagemath.org/sage into t/30106/sage_libs_ecl__fix_unicode_handling</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/828a727915e1920964c7bdbdd52e50b84e731a62"><code>828a727</code></a></td><td><code>Add doctests</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0bfaccf1141b61768290c20a1bb47e846081c7e4"><code>0bfaccf</code></a></td><td><code>Merge branch 't/30106/sage_libs_ecl__fix_unicode_handling' into t/30105/sage_libs_ecl__add_python_function_ecl_make_string</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dd27b331b73bba9b2ee1a522b0b047f5fa1ffedb"><code>dd27b33</code></a></td><td><code>sage.libs.ecl: Update uses of python_to_ecl</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a3b58ad46c77173591e3151a860b2bde53e11c91"><code>a3b58ad</code></a></td><td><code>Merge branch 't/30105/sage_libs_ecl__add_python_function_ecl_make_string' into t/30097/several_instances_of_maximalib</code></td></tr></table>




---

archive/issue_comments_476637.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nthere are things like\n\n```\nsage -t --long --warn-long 177.3 src/doc/en/constructions/plotting.rst\n**********************************************************************\nFile \"src/doc/en/constructions/plotting.rst\", line 216, in doc.en.constructions.plotting\nFailed example:\n    maxima.eval('load(\"plotdf\");')\nExpected:\n    '\".../share/maxima/.../share/dynamics/plotdf.lisp\"'\nGot:\n    '\\\\\"/home/scratch2/dimpase/sage/sage/local/share/maxima/5.42.2/share/dynamics/plotdf.lisp\\\\\"'\n**********************************************************************\n```\nand LISP errors such as\n\n```\nFile \"src/sage/symbolic/expression.pyx\", line 12389, in sage.symbolic.expression.Expression.integral\nFailed example:\n    sin(x).integral(x)\nException raised:\n    Traceback (most recent call last):\n      File \"/home/scratch2/dimpase/sage/sage/local/lib64/python3.7/site-packages/sage/doctest/forker.py\", line 707, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/scratch2/dimpase/sage/sage/local/lib64/python3.7/site-packages/sage/doctest/forker.py\", line 1131, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.symbolic.expression.Expression.integral[1]>\", line 1, in <module>\n        sin(x).integral(x)\n      File \"sage/symbolic/expression.pyx\", line 12437, in sage.symbolic.expression.Expression.integral (build/cythonized/sage/symbolic/expression.cpp:64526)\n        return integral(self, *args, **kwds)\n      File \"/home/scratch2/dimpase/sage/sage/local/lib64/python3.7/site-packages/sage/symbolic/integration/integral.py\", line 963, in integrate\n        return indefinite_integral(expression, v, hold=hold)\n      File \"sage/symbolic/function.pyx\", line 1138, in sage.symbolic.function.BuiltinFunction.__call__ (build/cythonized/sage/symbolic/function.cpp:12274)\n        res = super(BuiltinFunction, self).__call__(\n      File \"sage/symbolic/function.pyx\", line 602, in sage.symbolic.function.Function.__call__ (build/cythonized/sage/symbolic/function.cpp:7051)\n        res = g_function_eval2(self._serial, (<Expression>args[0])._gobj,\n      File \"/home/scratch2/dimpase/sage/sage/local/lib64/python3.7/site-packages/sage/symbolic/integration/integral.py\", line 117, in _eval_\n        A = integrator(f, x)\n      File \"/home/scratch2/dimpase/sage/sage/local/lib64/python3.7/site-packages/sage/symbolic/integration/external.py\", line 44, in maxima_integrator\n        result = maxima.sr_integral(expression,v)\n      File \"/home/scratch2/dimpase/sage/sage/local/lib64/python3.7/site-packages/sage/interfaces/maxima_lib.py\", line 877, in sr_integral\n        return max_to_sr(maxima_eval(([max_integrate],[sr_to_max(SR(a)) for a in args])))\n      File \"/home/scratch2/dimpase/sage/sage/local/lib64/python3.7/site-packages/sage/interfaces/maxima_lib.py\", line 1763, in max_to_sr\n        sage_expr=SR(maxima(expr))\n      File \"/home/scratch2/dimpase/sage/sage/local/lib64/python3.7/site-packages/sage/interfaces/interface.py\", line 303, in __call__\n        result = self._coerce_from_special_method(x)\n      File \"/home/scratch2/dimpase/sage/sage/local/lib64/python3.7/site-packages/sage/interfaces/maxima_lib.py\", line 472, in _coerce_from_special_method\n        return MaximaLibElement(self,self._create(x))\n      File \"/home/scratch2/dimpase/sage/sage/local/lib64/python3.7/site-packages/sage/interfaces/maxima_lib.py\", line 690, in _create\n        maxima_eval([[msetq], maxima_read(name), value])\n      File \"sage/libs/ecl.pyx\", line 852, in sage.libs.ecl.EclObject.__call__ (build/cythonized/sage/libs/ecl.c:8507)\n        return ecl_wrap(ecl_safe_apply(self.obj,(<EclObject>lispargs).obj))\n      File \"sage/libs/ecl.pyx\", line 365, in sage.libs.ecl.ecl_safe_apply (build/cythonized/sage/libs/ecl.c:5835)\n        raise RuntimeError(\"ECL says: {}\".format(\n    RuntimeError: ECL says: In form\n    ((MAXIMA_LIB_2::%COS MAXIMA_LIB_2::SIMP) MAXIMA_LIB::|$_SAGE_VAR_x|)\n    FUNCTION: Not a valid argument (MAXIMA_LIB_2::%COS MAXIMA_LIB_2::SIMP).\n```",
    "created_at": "2020-07-18T12:04:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30097#issuecomment-476637",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:29" align="right">comment:29</div>

there are things like

```
sage -t --long --warn-long 177.3 src/doc/en/constructions/plotting.rst
**********************************************************************
File "src/doc/en/constructions/plotting.rst", line 216, in doc.en.constructions.plotting
Failed example:
    maxima.eval('load("plotdf");')
Expected:
    '".../share/maxima/.../share/dynamics/plotdf.lisp"'
Got:
    '\\"/home/scratch2/dimpase/sage/sage/local/share/maxima/5.42.2/share/dynamics/plotdf.lisp\\"'
**********************************************************************
```
and LISP errors such as

```
File "src/sage/symbolic/expression.pyx", line 12389, in sage.symbolic.expression.Expression.integral
Failed example:
    sin(x).integral(x)
Exception raised:
    Traceback (most recent call last):
      File "/home/scratch2/dimpase/sage/sage/local/lib64/python3.7/site-packages/sage/doctest/forker.py", line 707, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/scratch2/dimpase/sage/sage/local/lib64/python3.7/site-packages/sage/doctest/forker.py", line 1131, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.symbolic.expression.Expression.integral[1]>", line 1, in <module>
        sin(x).integral(x)
      File "sage/symbolic/expression.pyx", line 12437, in sage.symbolic.expression.Expression.integral (build/cythonized/sage/symbolic/expression.cpp:64526)
        return integral(self, *args, **kwds)
      File "/home/scratch2/dimpase/sage/sage/local/lib64/python3.7/site-packages/sage/symbolic/integration/integral.py", line 963, in integrate
        return indefinite_integral(expression, v, hold=hold)
      File "sage/symbolic/function.pyx", line 1138, in sage.symbolic.function.BuiltinFunction.__call__ (build/cythonized/sage/symbolic/function.cpp:12274)
        res = super(BuiltinFunction, self).__call__(
      File "sage/symbolic/function.pyx", line 602, in sage.symbolic.function.Function.__call__ (build/cythonized/sage/symbolic/function.cpp:7051)
        res = g_function_eval2(self._serial, (<Expression>args[0])._gobj,
      File "/home/scratch2/dimpase/sage/sage/local/lib64/python3.7/site-packages/sage/symbolic/integration/integral.py", line 117, in _eval_
        A = integrator(f, x)
      File "/home/scratch2/dimpase/sage/sage/local/lib64/python3.7/site-packages/sage/symbolic/integration/external.py", line 44, in maxima_integrator
        result = maxima.sr_integral(expression,v)
      File "/home/scratch2/dimpase/sage/sage/local/lib64/python3.7/site-packages/sage/interfaces/maxima_lib.py", line 877, in sr_integral
        return max_to_sr(maxima_eval(([max_integrate],[sr_to_max(SR(a)) for a in args])))
      File "/home/scratch2/dimpase/sage/sage/local/lib64/python3.7/site-packages/sage/interfaces/maxima_lib.py", line 1763, in max_to_sr
        sage_expr=SR(maxima(expr))
      File "/home/scratch2/dimpase/sage/sage/local/lib64/python3.7/site-packages/sage/interfaces/interface.py", line 303, in __call__
        result = self._coerce_from_special_method(x)
      File "/home/scratch2/dimpase/sage/sage/local/lib64/python3.7/site-packages/sage/interfaces/maxima_lib.py", line 472, in _coerce_from_special_method
        return MaximaLibElement(self,self._create(x))
      File "/home/scratch2/dimpase/sage/sage/local/lib64/python3.7/site-packages/sage/interfaces/maxima_lib.py", line 690, in _create
        maxima_eval([[msetq], maxima_read(name), value])
      File "sage/libs/ecl.pyx", line 852, in sage.libs.ecl.EclObject.__call__ (build/cythonized/sage/libs/ecl.c:8507)
        return ecl_wrap(ecl_safe_apply(self.obj,(<EclObject>lispargs).obj))
      File "sage/libs/ecl.pyx", line 365, in sage.libs.ecl.ecl_safe_apply (build/cythonized/sage/libs/ecl.c:5835)
        raise RuntimeError("ECL says: {}".format(
    RuntimeError: ECL says: In form
    ((MAXIMA_LIB_2::%COS MAXIMA_LIB_2::SIMP) MAXIMA_LIB::|$_SAGE_VAR_x|)
    FUNCTION: Not a valid argument (MAXIMA_LIB_2::%COS MAXIMA_LIB_2::SIMP).
```



---

archive/issue_events_414465.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-07-18T16:38:46Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30097",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30097#event-414465"
}
```



---

archive/issue_events_414466.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-07-18T16:38:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30097",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30097#event-414466"
}
```



---

archive/issue_events_414467.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-05T19:21:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30097",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30097#event-414467"
}
```



---

archive/issue_events_414468.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-05T19:21:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30097",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30097#event-414468"
}
```



---

archive/issue_comments_476638.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nSetting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-02-13T20:51:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30097#issuecomment-476638",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:32" align="right">comment:32</div>

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_events_414469.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T20:51:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30097",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30097#event-414469"
}
```



---

archive/issue_events_414470.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T20:51:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30097",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30097#event-414470"
}
```



---

archive/issue_comments_476639.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nSetting a new milestone for this ticket based on a cursory review.",
    "created_at": "2021-07-19T00:44:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30097#issuecomment-476639",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:34" align="right">comment:34</div>

Setting a new milestone for this ticket based on a cursory review.



---

archive/issue_events_414471.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30097",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30097#event-414471"
}
```



---

archive/issue_events_414472.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30097",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30097#event-414472"
}
```



---

archive/issue_events_414473.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-14T02:04:49Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30097",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30097#event-414473"
}
```



---

archive/issue_events_414474.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-14T02:04:49Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30097",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30097#event-414474"
}
```



---

archive/issue_events_414475.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-03-05T00:06:20Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30097",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30097#event-414475"
}
```



---

archive/issue_events_414476.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-03-05T00:06:20Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30097",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30097#event-414476"
}
```



---

archive/issue_events_414477.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30097",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30097#event-414477"
}
```



---

archive/issue_events_414478.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30097",
    "milestone_number": null,
    "milestone_title": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30097#event-414478"
}
```



---

archive/issue_events_414479.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2023-01-07T21:39:40Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30097",
    "milestone_number": null,
    "milestone_title": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30097#event-414479"
}
```



---

archive/issue_events_414480.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2023-01-07T21:39:40Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30097",
    "milestone_number": null,
    "milestone_title": "sage-9.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30097#event-414480"
}
```
