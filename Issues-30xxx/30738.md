# Issue 30738: Replace custom Sage unit test discovery by pytest

archive/issues_030501.json:
```json
{
    "body": "Currently, Sage code contains `_test_xyz` methods that are invoked via doctests and discovered via a custom `TestSuite` class. This ticket is to replace this custom test discovery by the use of the established **pytest** framework https://docs.pytest.org/ (this is in line with #28936 - using mainstream Python test infrastructure).\n\nAdvantages of this approach:\n- Reuse standard test infrastructure instead of a custom test discovery interface (this is a big maintenance relief, especially given the large list of todos in the `TestSuite` code).\n- Better error messages in case a test fails.\n- Easier onboarding of new Python developers.\n- Clear separation of test methods vs production code. For example, the `*_test.py` files can easily be excluded from distribution.\n- Good support by IDEs (auto completion, test discovery and easier invocation). For example, VSCode automatically discovers all pytest tests, provides a convenient interface to run them (all, a selection, only failed ones) and allows to directly start a debug session for a failing test. See https://code.visualstudio.com/docs/python/testing\n- Less and clearer code (no hidden assumptions).\n\nDisadvantages of this approach:\n- Current developers have to learn pytest and its conventions (files must be named `*_test.py` and test methods must start with `test_`).\n- Tests no longer live in the same file as the code (I would call this an advantage, but some people may prefer to have them really close together).\n\nIn order to migrate, the following changes are necessary:\n- Move `_test_xyz` from a category `module` to new file `<module>_test.py` (e.g. `finite_semigroups_test.py`).\n- Rewrite tests using pytest (which is straightforward and more or less only amounts to removing all the custom code involving `self_tester`).\n- Create a new test class for the parent class under test (e.g `TestFiniteSemigroup`).\n- Create a static method `category_instances()` in this test class returning a list of instances to test.\n\nFor the moment, I did this only for a few test methods in `sets_cat` using finite semigroups as example to illustrate the process.\n\nThe new implementation is as follows:\n- The test class for the category (e.g. in `sets_cat_test.py`) defines generic tests that should pass for every object in that category. Moreover, the test class may provides instances (objects) to test via the method `category_instances`.\n- Running pytest finds the test file `finite_semigroups_test.py`, then determines the categories of the objects (returned from `category_instances`) and adds all generic test methods for that category to the test class (this happens in `conftest.py`).\n- Each test method can have the parameter `category_instance` which is bound to the return value of the `category_instances` method.\n\nRunning `cd src && pytest --verbose` (from a virtual env with sage and pytest installed), the output is as follows:\n\n```\nsage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_contains[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                         [  2%]\nsage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_contains[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                    [  4%]\nsage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_contains[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                               [  6%]\nsage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_iter_list[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                        [  8%]\nsage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_iter_list[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                   [ 10%]\nsage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_iter_list[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                              [ 13%]\nsage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_iter_cardinality[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                 [ 15%]\nsage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_iter_cardinality[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                            [ 17%]\nsage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_iter_cardinality[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                       [ 19%]\nsage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_associativity[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                                   [ 21%]\nsage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_associativity[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                              [ 23%]\nsage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_associativity[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                         [ 26%]\nsage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_an_element[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                                      [ 28%]\nsage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_an_element[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                                 [ 30%]\nsage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_an_element[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                            [ 32%]\nsage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_an_element_idempotent[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                           [ 34%]\nsage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_an_element_idempotent[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                      [ 36%]\nsage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_an_element_idempotent[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                 [ 39%]\nsage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_cardinality_return_type[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                         [ 41%]\nsage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_cardinality_return_type[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                    [ 43%]\nsage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_cardinality_return_type[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                               [ 45%]\nsage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_construction[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                                    [ 47%]\nsage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_construction[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                               [ 50%]\nsage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_construction[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                          [ 52%]\nsage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_element_eq_reflexive[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                            [ 54%]\nsage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_element_eq_reflexive[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                       [ 56%]\nsage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_element_eq_reflexive[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                  [ 58%]\nsage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_eq_symmetric[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                           [ 60%]\nsage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_eq_symmetric[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                      [ 63%]\nsage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_eq_symmetric[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                 [ 65%]\nsage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_eq_transitive[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                          [ 67%]\nsage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_eq_transitive[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                     [ 69%]\nsage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_eq_transitive[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                [ 71%]\nsage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_neq[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                                    [ 73%]\nsage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_neq[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                               [ 76%]\nsage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_neq[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                          [ 78%]\n...\n```\nAs one can see, each general test method is invoked for the three examples.\n\n\nTODO (in follow-up tickets):\n- Complete migration to pytest.\n- Once that is done, stop invoking `TestSuite` in doctests and remove the `TestSuite` class.\n\nSee also:\n- #33546 Replace custom Sage doctest discovery by pytest (using pytest_collect_file)\n\n\nCC:  @mkoeppe @tscrim @nthiery @slel\n\nKeywords: testsuite\n\nAuthor: Tobias Diez\n\nBranch: public/refactoring/pytest\n\nStatus: needs_review\n\nCommit: b047abeae5c3f3bf755afa37bf65a0ed4bc61d97\n\nIssue created by migration from https://trac.sagemath.org/ticket/30738\n\n",
    "created_at": "2020-10-07T18:06:19Z",
    "labels": [
        "component: refactoring"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Replace custom Sage unit test discovery by pytest",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30738",
    "user": "https://github.com/tobiasdiez"
}
```
Currently, Sage code contains `_test_xyz` methods that are invoked via doctests and discovered via a custom `TestSuite` class. This ticket is to replace this custom test discovery by the use of the established **pytest** framework https://docs.pytest.org/ (this is in line with #28936 - using mainstream Python test infrastructure).

Advantages of this approach:
- Reuse standard test infrastructure instead of a custom test discovery interface (this is a big maintenance relief, especially given the large list of todos in the `TestSuite` code).
- Better error messages in case a test fails.
- Easier onboarding of new Python developers.
- Clear separation of test methods vs production code. For example, the `*_test.py` files can easily be excluded from distribution.
- Good support by IDEs (auto completion, test discovery and easier invocation). For example, VSCode automatically discovers all pytest tests, provides a convenient interface to run them (all, a selection, only failed ones) and allows to directly start a debug session for a failing test. See https://code.visualstudio.com/docs/python/testing
- Less and clearer code (no hidden assumptions).

Disadvantages of this approach:
- Current developers have to learn pytest and its conventions (files must be named `*_test.py` and test methods must start with `test_`).
- Tests no longer live in the same file as the code (I would call this an advantage, but some people may prefer to have them really close together).

In order to migrate, the following changes are necessary:
- Move `_test_xyz` from a category `module` to new file `<module>_test.py` (e.g. `finite_semigroups_test.py`).
- Rewrite tests using pytest (which is straightforward and more or less only amounts to removing all the custom code involving `self_tester`).
- Create a new test class for the parent class under test (e.g `TestFiniteSemigroup`).
- Create a static method `category_instances()` in this test class returning a list of instances to test.

For the moment, I did this only for a few test methods in `sets_cat` using finite semigroups as example to illustrate the process.

The new implementation is as follows:
- The test class for the category (e.g. in `sets_cat_test.py`) defines generic tests that should pass for every object in that category. Moreover, the test class may provides instances (objects) to test via the method `category_instances`.
- Running pytest finds the test file `finite_semigroups_test.py`, then determines the categories of the objects (returned from `category_instances`) and adds all generic test methods for that category to the test class (this happens in `conftest.py`).
- Each test method can have the parameter `category_instance` which is bound to the return value of the `category_instances` method.

Running `cd src && pytest --verbose` (from a virtual env with sage and pytest installed), the output is as follows:

```
sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_contains[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                         [  2%]
sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_contains[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                    [  4%]
sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_contains[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                               [  6%]
sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_iter_list[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                        [  8%]
sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_iter_list[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                   [ 10%]
sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_iter_list[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                              [ 13%]
sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_iter_cardinality[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                 [ 15%]
sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_iter_cardinality[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                            [ 17%]
sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_iter_cardinality[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                       [ 19%]
sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_associativity[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                                   [ 21%]
sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_associativity[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                              [ 23%]
sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_associativity[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                         [ 26%]
sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_an_element[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                                      [ 28%]
sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_an_element[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                                 [ 30%]
sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_an_element[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                            [ 32%]
sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_an_element_idempotent[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                           [ 34%]
sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_an_element_idempotent[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                      [ 36%]
sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_an_element_idempotent[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                 [ 39%]
sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_cardinality_return_type[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                         [ 41%]
sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_cardinality_return_type[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                    [ 43%]
sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_cardinality_return_type[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                               [ 45%]
sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_construction[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                                    [ 47%]
sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_construction[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                               [ 50%]
sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_construction[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                          [ 52%]
sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_element_eq_reflexive[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                            [ 54%]
sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_element_eq_reflexive[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                       [ 56%]
sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_element_eq_reflexive[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                  [ 58%]
sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_eq_symmetric[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                           [ 60%]
sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_eq_symmetric[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                      [ 63%]
sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_eq_symmetric[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                 [ 65%]
sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_eq_transitive[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                          [ 67%]
sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_eq_transitive[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                     [ 69%]
sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_eq_transitive[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                [ 71%]
sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_neq[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                                    [ 73%]
sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_neq[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                               [ 76%]
sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_neq[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                          [ 78%]
...
```
As one can see, each general test method is invoked for the three examples.


TODO (in follow-up tickets):
- Complete migration to pytest.
- Once that is done, stop invoking `TestSuite` in doctests and remove the `TestSuite` class.

See also:
- #33546 Replace custom Sage doctest discovery by pytest (using pytest_collect_file)


CC:  @mkoeppe @tscrim @nthiery @slel

Keywords: testsuite

Author: Tobias Diez

Branch: public/refactoring/pytest

Status: needs_review

Commit: b047abeae5c3f3bf755afa37bf65a0ed4bc61d97

Issue created by migration from https://trac.sagemath.org/ticket/30738





---

archive/issue_comments_464392.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -15,6 +15,7 @@\n - Easier onboarding of new Python developers\n - Clear separation of test methods vs production code. For example, the \\`test_*.py\\` files can easily be excluded from distribution.\n - Good support by IDE (auto completion, test discovery and easier invocation)\n+- Less and clearer code (no hidden assumptions)\n \n Disadvantages of this approach:\n - Current developer have to learn the new conventions (files need to be named \\`test_*.py\\` and tests methods need to start with \\`test_\\`) and pytest\n@@ -22,6 +23,7 @@\n \n \n What do you think? (Please feel free to add more people to cc if you think they may be interested.)\n+\n \n Author: Tobias Diez\n \n```\n",
    "created_at": "2020-10-07T18:09:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464392",
    "user": "https://github.com/tobiasdiez"
}
```

Description changed:
```diff
--- 
+++ 
@@ -15,6 +15,7 @@
 - Easier onboarding of new Python developers
 - Clear separation of test methods vs production code. For example, the \`test_*.py\` files can easily be excluded from distribution.
 - Good support by IDE (auto completion, test discovery and easier invocation)
+- Less and clearer code (no hidden assumptions)
 
 Disadvantages of this approach:
 - Current developer have to learn the new conventions (files need to be named \`test_*.py\` and tests methods need to start with \`test_\`) and pytest
@@ -22,6 +23,7 @@
 
 
 What do you think? (Please feel free to add more people to cc if you think they may be interested.)
+
 
 Author: Tobias Diez
 
```




---

archive/issue_comments_464393.json:
```json
{
    "body": "<a id='comment:2'></a>Are you aware that the crucial point of our _test methods, in particular those provided in the category framework, is that objects of subclasses run these tests?",
    "created_at": "2020-10-07T18:13:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464393",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'></a>Are you aware that the crucial point of our _test methods, in particular those provided in the category framework, is that objects of subclasses run these tests?



---

archive/issue_comments_464394.json:
```json
{
    "body": "<a id='comment:3'></a>Yes, and this structure is also somewhat reflected in the new code as the tests for the subclasses inherit from the general base test class. If I understood the code correctly, then the main purpose of these subclasses (with respect to the tests) is to provide the examples (e.g. using the `example()` convention). This can be archived in a more transparent and cleaner way using parameterized test fixtures of pytest.",
    "created_at": "2020-10-07T18:31:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464394",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:3'></a>Yes, and this structure is also somewhat reflected in the new code as the tests for the subclasses inherit from the general base test class. If I understood the code correctly, then the main purpose of these subclasses (with respect to the tests) is to provide the examples (e.g. using the `example()` convention). This can be archived in a more transparent and cleaner way using parameterized test fixtures of pytest.



---

archive/issue_comments_464395.json:
```json
{
    "body": "<a id='comment:4'></a>Replying to [comment:3 gh-tobiasdiez]:\n> If I understood the code correctly, then the main purpose of these subclasses (with respect to the tests) is to provide the examples (e.g. using the `example()` convention).\n\n\nNo, the category classes provide mixins for dynamically generated classes for all `Parent` and `Element` objects. The `example()` are just additional documentation.",
    "created_at": "2020-10-07T19:10:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464395",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:4'></a>Replying to [comment:3 gh-tobiasdiez]:
> If I understood the code correctly, then the main purpose of these subclasses (with respect to the tests) is to provide the examples (e.g. using the `example()` convention).


No, the category classes provide mixins for dynamically generated classes for all `Parent` and `Element` objects. The `example()` are just additional documentation.



---

archive/issue_comments_464396.json:
```json
{
    "body": "<a id='comment:5'></a>Sure, but that doesn't seem to be important for the tests itself. Take for example the tests in `sets_cat`. Almost all of them simply call `tester.some_elements()` and then run certain assertions against the returned elements. Thus, there is no semantical difference to having one general test method accepting an element as argument, and then testing the elements returned by `some_elements()` using this method. This is exactly what is proposed in this ticket.\n\nOne question though: is the purpose of these tests to check that one general implementation is correct for all these examples (e.g `sets_cat` provides a general equality implementation which is checked), or that the subclasses provide an implementation that adheres to general principles (e.g. `finitely_generated_semigroups` provides an implementation of equality that is checked). Just so that I know where to best place these tests (test_sets_cat vs test_finitely_generated_semigroups).",
    "created_at": "2020-10-08T07:05:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464396",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:5'></a>Sure, but that doesn't seem to be important for the tests itself. Take for example the tests in `sets_cat`. Almost all of them simply call `tester.some_elements()` and then run certain assertions against the returned elements. Thus, there is no semantical difference to having one general test method accepting an element as argument, and then testing the elements returned by `some_elements()` using this method. This is exactly what is proposed in this ticket.

One question though: is the purpose of these tests to check that one general implementation is correct for all these examples (e.g `sets_cat` provides a general equality implementation which is checked), or that the subclasses provide an implementation that adheres to general principles (e.g. `finitely_generated_semigroups` provides an implementation of equality that is checked). Just so that I know where to best place these tests (test_sets_cat vs test_finitely_generated_semigroups).



---

archive/issue_comments_464397.json:
```json
{
    "body": "<a id='comment:6'></a>Replying to [comment:5 gh-tobiasdiez]:\n> One question though: is the purpose of these tests to check that one general implementation is correct for all these examples (e.g `sets_cat` provides a general equality implementation which is checked), or that the subclasses provide an implementation that adheres to general principles (e.g. `finitely_generated_semigroups` provides an implementation of equality that is checked).\n\nThe latter.",
    "created_at": "2020-10-08T16:22:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464397",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:6'></a>Replying to [comment:5 gh-tobiasdiez]:
> One question though: is the purpose of these tests to check that one general implementation is correct for all these examples (e.g `sets_cat` provides a general equality implementation which is checked), or that the subclasses provide an implementation that adheres to general principles (e.g. `finitely_generated_semigroups` provides an implementation of equality that is checked).

The latter.



---

archive/issue_comments_464398.json:
```json
{
    "body": "<a id='comment:7'></a>Thanks, I thought so too. Then the current file structure should be right.\nShould I go ahead and convert the other test methods to pytest as well? (As part of this ticket, or open a new ticket for every method?)",
    "created_at": "2020-10-08T16:45:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464398",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:7'></a>Thanks, I thought so too. Then the current file structure should be right.
Should I go ahead and convert the other test methods to pytest as well? (As part of this ticket, or open a new ticket for every method?)



---

archive/issue_comments_464399.json:
```json
{
    "body": "<a id='comment:8'></a>I do not know enough about pytest. Can you expand the ticket description to explain how the test discovery works after the ticket, and how it ensures that still the same things get tested?",
    "created_at": "2020-10-08T17:45:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464399",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:8'></a>I do not know enough about pytest. Can you expand the ticket description to explain how the test discovery works after the ticket, and how it ensures that still the same things get tested?



---

archive/issue_events_080102.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-24T20:15:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30738#event-80102"
}
```



---

archive/issue_comments_464400.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,38 @@\n+Currently, the sage code contains \\`_test_xyz\\` methods that are invoked via doctests and discovered via a custom \\`TestSuit\\` class. In this ticket, we are proposing to replace this custom designed test discovery by using the established pytest framework https://docs.pytest.org/ (this is inline with #28936 - using mainstraim Python test infrastructure).\n \n+The changes are as follows:\n+- Move \\`_test_xyz\\` from \\`module\\` to new file \\`test_module\\`\n+- Rewrite test using pytest (which is straightforward and more or less only amounts to removing all the custom code involving \\`self_tester\\`)\n+- Remove invoking the \\`TestSuit\\` in the doctests\n+- Instead, add the corresponding test elements as parameterized fixtures for pytest\n+\n+For the moment, I did this only for one test method in \\`sets_cat\\` to illustrate the process.\n+What is still remaining is to call \\`pytest\\` as part of the build process so that the newly added tests are found and checked.\n+\n+Advantages of this approach:\n+- Reuse standard test infrastructure instead of a custom test discovery interface (this is a big plus as we do not have to maintain it ourself, especially given the large list of todo's in the TestSuite code)\n+- With this there also comes better error messages in case a test fails.\n+- Easier onboarding of new Python developers\n+- Clear separation of test methods vs production code. For example, the \\`test_*.py\\` files can easily be excluded from distribution.\n+- Good support by IDE (auto completion, test discovery and easier invocation)\n+- Less and clearer code (no hidden assumptions)\n+\n+Disadvantages of this approach:\n+- Current developer have to learn the new conventions (files need to be named \\`test_*.py\\` and tests methods need to start with \\`test_\\`) and pytest\n+- Tests no longer live in the same file as the code (I would say this is an advantage, but some people may prefer to have them really close together).\n+\n+By default, pytest implements the following standard test discovery:\n+\n+- Search for \\`test_*.py\\` or \\`*_test.py\\` files (I would stick to the \\`test\\` prefix).\n+- From those files, collect test items:\n+   - Functions or methods with prefix \\`test\\`\n+   - If the functions are inside of classes, then the class name has to start with \\`test\\` as well.\n+\n+What do you think? (Please feel free to add more people to cc if you think they may be interested.)\n+\n+TOOD:\n+- Complete migration of tests to pytest\n+- Integrate \\`pytest\\` in \\`sage -t\\` and tox (and patchbot?)\n \n Author: Tobias Diez\n \n```\n",
    "created_at": "2020-10-24T20:59:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464400",
    "user": "https://github.com/tobiasdiez"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,38 @@
+Currently, the sage code contains \`_test_xyz\` methods that are invoked via doctests and discovered via a custom \`TestSuit\` class. In this ticket, we are proposing to replace this custom designed test discovery by using the established pytest framework https://docs.pytest.org/ (this is inline with #28936 - using mainstraim Python test infrastructure).
 
+The changes are as follows:
+- Move \`_test_xyz\` from \`module\` to new file \`test_module\`
+- Rewrite test using pytest (which is straightforward and more or less only amounts to removing all the custom code involving \`self_tester\`)
+- Remove invoking the \`TestSuit\` in the doctests
+- Instead, add the corresponding test elements as parameterized fixtures for pytest
+
+For the moment, I did this only for one test method in \`sets_cat\` to illustrate the process.
+What is still remaining is to call \`pytest\` as part of the build process so that the newly added tests are found and checked.
+
+Advantages of this approach:
+- Reuse standard test infrastructure instead of a custom test discovery interface (this is a big plus as we do not have to maintain it ourself, especially given the large list of todo's in the TestSuite code)
+- With this there also comes better error messages in case a test fails.
+- Easier onboarding of new Python developers
+- Clear separation of test methods vs production code. For example, the \`test_*.py\` files can easily be excluded from distribution.
+- Good support by IDE (auto completion, test discovery and easier invocation)
+- Less and clearer code (no hidden assumptions)
+
+Disadvantages of this approach:
+- Current developer have to learn the new conventions (files need to be named \`test_*.py\` and tests methods need to start with \`test_\`) and pytest
+- Tests no longer live in the same file as the code (I would say this is an advantage, but some people may prefer to have them really close together).
+
+By default, pytest implements the following standard test discovery:
+
+- Search for \`test_*.py\` or \`*_test.py\` files (I would stick to the \`test\` prefix).
+- From those files, collect test items:
+   - Functions or methods with prefix \`test\`
+   - If the functions are inside of classes, then the class name has to start with \`test\` as well.
+
+What do you think? (Please feel free to add more people to cc if you think they may be interested.)
+
+TOOD:
+- Complete migration of tests to pytest
+- Integrate \`pytest\` in \`sage -t\` and tox (and patchbot?)
 
 Author: Tobias Diez
 
```




---

archive/issue_comments_464401.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-10-24T20:59:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464401",
    "user": "https://github.com/tobiasdiez"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_464402.json:
```json
{
    "body": "<a id='comment:11'></a>I've extended the ticket description. Does this clarify your questions?\n\nThe test `test_element_eq_reflexive` (and other similar tests to be added) are invoked for each element of `test_elements`. Thus, by adding all the instances currently covered by the unit tests we make sure that the test coverage stays the same.",
    "created_at": "2020-10-24T21:01:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464402",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:11'></a>I've extended the ticket description. Does this clarify your questions?

The test `test_element_eq_reflexive` (and other similar tests to be added) are invoked for each element of `test_elements`. Thus, by adding all the instances currently covered by the unit tests we make sure that the test coverage stays the same.



---

archive/issue_comments_464403.json:
```json
{
    "body": "<a id='comment:12'></a>Sorry, I still don't get it. The branch as it is on the ticket - do you claim that it still tests the same objects as before?",
    "created_at": "2020-10-24T21:31:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464403",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:12'></a>Sorry, I still don't get it. The branch as it is on the ticket - do you claim that it still tests the same objects as before?



---

archive/issue_comments_464404.json:
```json
{
    "body": "<a id='comment:13'></a>If you run `pytest` on this branch, it invokes `test_elements_eq_reflexive` with the arguments `['a', 'b', 'c', 'ab', 'ac', 'ba', 'bc', 'ca', 'cb', 'abc']`. \nThis is the same as the doctest for `finite_semigroups`:\n\n```\nNow, let us look at the structure of the semigroup::\n\n        sage: S = FiniteSemigroups().example(alphabet = ('a','b','c'))\n        sage: S.cayley_graph(side=\"left\", simple=True).plot()\n        Graphics object consisting of 60 graphics primitives\n        sage: S.j_transversal_of_idempotents() # random (arbitrary choice)\n        ['acb', 'ac', 'ab', 'bc', 'a', 'c', 'b']\n\n    We conclude by running systematic tests on this semigroup::\n\n        sage: TestSuite(S).run(verbose = True)\n        running ._test_an_element() . . . pass\n        running ._test_associativity() . . . pass\n        running ._test_cardinality() . . . pass\n        running ._test_category() . . . pass\n        running ._test_construction() . . . pass\n        running ._test_elements() . . .\n          Running the test suite of self.an_element()\n          running ._test_category() . . . pass\n          running ._test_eq() . . . pass\n          running ._test_new() . . . pass\n          running ._test_not_implemented_methods() . . . pass\n          running ._test_pickling() . . . pass\n          pass\n        running ._test_elements_eq_reflexive() . . . pass\n        running ._test_elements_eq_symmetric() . . . pass\n        running ._test_elements_eq_transitive() . . . pass\n        running ._test_elements_neq() . . . pass\n        running ._test_enumerated_set_contains() . . . pass\n        running ._test_enumerated_set_iter_cardinality() . . . pass\n        running ._test_enumerated_set_iter_list() . . . pass\n        running ._test_eq() . . . pass\n        running ._test_new() . . . pass\n        running ._test_not_implemented_methods() . . . pass\n        running ._test_pickling() . . . pass\n        running ._test_some_elements() . . . pass\n```\nSo the idea would be to replace this doctest by `pytest`. There are a few more doctests of this form that can be replaced in a similar vain by adding the corresponding elements to the `test_elements` list.",
    "created_at": "2020-10-24T21:54:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464404",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:13'></a>If you run `pytest` on this branch, it invokes `test_elements_eq_reflexive` with the arguments `['a', 'b', 'c', 'ab', 'ac', 'ba', 'bc', 'ca', 'cb', 'abc']`. 
This is the same as the doctest for `finite_semigroups`:

```
Now, let us look at the structure of the semigroup::

        sage: S = FiniteSemigroups().example(alphabet = ('a','b','c'))
        sage: S.cayley_graph(side="left", simple=True).plot()
        Graphics object consisting of 60 graphics primitives
        sage: S.j_transversal_of_idempotents() # random (arbitrary choice)
        ['acb', 'ac', 'ab', 'bc', 'a', 'c', 'b']

    We conclude by running systematic tests on this semigroup::

        sage: TestSuite(S).run(verbose = True)
        running ._test_an_element() . . . pass
        running ._test_associativity() . . . pass
        running ._test_cardinality() . . . pass
        running ._test_category() . . . pass
        running ._test_construction() . . . pass
        running ._test_elements() . . .
          Running the test suite of self.an_element()
          running ._test_category() . . . pass
          running ._test_eq() . . . pass
          running ._test_new() . . . pass
          running ._test_not_implemented_methods() . . . pass
          running ._test_pickling() . . . pass
          pass
        running ._test_elements_eq_reflexive() . . . pass
        running ._test_elements_eq_symmetric() . . . pass
        running ._test_elements_eq_transitive() . . . pass
        running ._test_elements_neq() . . . pass
        running ._test_enumerated_set_contains() . . . pass
        running ._test_enumerated_set_iter_cardinality() . . . pass
        running ._test_enumerated_set_iter_list() . . . pass
        running ._test_eq() . . . pass
        running ._test_new() . . . pass
        running ._test_not_implemented_methods() . . . pass
        running ._test_pickling() . . . pass
        running ._test_some_elements() . . . pass
```
So the idea would be to replace this doctest by `pytest`. There are a few more doctests of this form that can be replaced in a similar vain by adding the corresponding elements to the `test_elements` list.



---

archive/issue_comments_464405.json:
```json
{
    "body": "<a id='comment:14'></a>Replying to [comment:13 gh-tobiasdiez]:\n> There are a few more doctests of this form that can be replaced in a similar vain by adding the corresponding elements to the `test_elements` list.\n\n\nA few? Currently `_test_elements_eq_reflexive` is invoked by `TestSuite(object).run()` whenever `object` happens to be in the category of sets. This is a huge, dynamically determined list.",
    "created_at": "2020-10-24T22:01:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464405",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:14'></a>Replying to [comment:13 gh-tobiasdiez]:
> There are a few more doctests of this form that can be replaced in a similar vain by adding the corresponding elements to the `test_elements` list.


A few? Currently `_test_elements_eq_reflexive` is invoked by `TestSuite(object).run()` whenever `object` happens to be in the category of sets. This is a huge, dynamically determined list.



---

archive/issue_comments_464406.json:
```json
{
    "body": "<a id='comment:15'></a>Sure, there are quite a lot of instances where a `TestSuite` is run from the doctest. Each one would need to be replaced by a test file similar to `test_finite_semigroups.py`. Pytest is not a magician and the information which examples to test still needs to be provided.\n\nSo the replacement dictionary roughly speaking looks like:\n- `TestSuite` -> `pytest`\n- `TestSuite(S).run(verbose = True)` -> ``@`pytest.fixture(params=S)`\n\nThe idea is not to change the way the tests cases are provided (although that may certainly be improved in the future) but to replace sage's only implementation of test discovery and invocation by what is probably the most establish Python testing framework.",
    "created_at": "2020-10-24T22:20:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464406",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:15'></a>Sure, there are quite a lot of instances where a `TestSuite` is run from the doctest. Each one would need to be replaced by a test file similar to `test_finite_semigroups.py`. Pytest is not a magician and the information which examples to test still needs to be provided.

So the replacement dictionary roughly speaking looks like:
- `TestSuite` -> `pytest`
- `TestSuite(S).run(verbose = True)` -> ``@`pytest.fixture(params=S)`

The idea is not to change the way the tests cases are provided (although that may certainly be improved in the future) but to replace sage's only implementation of test discovery and invocation by what is probably the most establish Python testing framework.



---

archive/issue_comments_464407.json:
```json
{
    "body": "<a id='comment:16'></a>So in your design, there would be a hierarchy of `Tests` classes parallel to the hierarchy of, say, parent classes in sage?",
    "created_at": "2020-10-24T22:29:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464407",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:16'></a>So in your design, there would be a hierarchy of `Tests` classes parallel to the hierarchy of, say, parent classes in sage?



---

archive/issue_comments_464408.json:
```json
{
    "body": "<a id='comment:17'></a>Yes! Every parent class would have a corresponding test class which specifies which general axioms this parent class wants to adhere to. This is done by deriving from one or more generic test classes (the one in the branch should probably be renamed to `GenericSetTests`).",
    "created_at": "2020-10-24T22:44:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464408",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:17'></a>Yes! Every parent class would have a corresponding test class which specifies which general axioms this parent class wants to adhere to. This is done by deriving from one or more generic test classes (the one in the branch should probably be renamed to `GenericSetTests`).



---

archive/issue_comments_464409.json:
```json
{
    "body": "<a id='comment:18'></a>Okay, but the parent classes are dynamic classes formed by mixing in axioms.\nSo the test classes would also be determined dynamically?",
    "created_at": "2020-10-24T22:45:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464409",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:18'></a>Okay, but the parent classes are dynamic classes formed by mixing in axioms.
So the test classes would also be determined dynamically?



---

archive/issue_comments_464410.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-10-24T22:55:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464410",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_464411.json:
```json
{
    "body": "<a id='comment:19'></a>Replying to [comment:15 gh-tobiasdiez]:\n> here are quite a lot of instances where a `TestSuite` is run from the doctest. Each one would need to be replaced by a test file similar to `test_finite_semigroups.py`. Pytest is not a magician and the information which examples to test still needs to be provided.\n\n\nThanks for this clarification. I'm setting this ticket to \"needs_work\" because the branch in this form is not complete -- it effectively removes existing tests for  `_test_elements_eq_reflexive`. Without a much more complete branch that reaches test parity, this idea is difficult to evaluate.\n\nOverall I think there is a conflict here between the dynamic nature of our category system and what seems to amount to a static determination of what objects to test for what properties (in the proposed changes).",
    "created_at": "2020-10-24T22:55:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464411",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:19'></a>Replying to [comment:15 gh-tobiasdiez]:
> here are quite a lot of instances where a `TestSuite` is run from the doctest. Each one would need to be replaced by a test file similar to `test_finite_semigroups.py`. Pytest is not a magician and the information which examples to test still needs to be provided.


Thanks for this clarification. I'm setting this ticket to "needs_work" because the branch in this form is not complete -- it effectively removes existing tests for  `_test_elements_eq_reflexive`. Without a much more complete branch that reaches test parity, this idea is difficult to evaluate.

Overall I think there is a conflict here between the dynamic nature of our category system and what seems to amount to a static determination of what objects to test for what properties (in the proposed changes).



---

archive/issue_comments_464412.json:
```json
{
    "body": "<a id='comment:20'></a>I'm not that familiar yet with the category framework. When you say \"dynamic classes formed by mixing in axioms\" you mean something like `Parent.__init__(self, category = Semigroups().Finite().FinitelyGenerated())`? But, in general, yes the idea is to mixin the tests. I don't see any reason why this couldn't be done dynamically.\n\nI agree, this branch has not yet feature parity with the master branch. Before I invest more time into it, I just wanted to confirm that this idea would be worth looking at in general.",
    "created_at": "2020-10-24T23:00:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464412",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:20'></a>I'm not that familiar yet with the category framework. When you say "dynamic classes formed by mixing in axioms" you mean something like `Parent.__init__(self, category = Semigroups().Finite().FinitelyGenerated())`? But, in general, yes the idea is to mixin the tests. I don't see any reason why this couldn't be done dynamically.

I agree, this branch has not yet feature parity with the master branch. Before I invest more time into it, I just wanted to confirm that this idea would be worth looking at in general.



---

archive/issue_comments_464413.json:
```json
{
    "body": "<a id='comment:21'></a>Replying to [comment:20 gh-tobiasdiez]:\n> When you say \"dynamic classes formed by mixing in axioms\" you mean something like `Parent.__init__(self, category = Semigroups().Finite().FinitelyGenerated())`?\n\n\nYes, things like this.",
    "created_at": "2020-10-24T23:05:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464413",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:21'></a>Replying to [comment:20 gh-tobiasdiez]:
> When you say "dynamic classes formed by mixing in axioms" you mean something like `Parent.__init__(self, category = Semigroups().Finite().FinitelyGenerated())`?


Yes, things like this.



---

archive/issue_comments_464414.json:
```json
{
    "body": "<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-11-08T12:53:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464414",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_464415.json:
```json
{
    "body": "<a id='comment:23'></a>Thanks for the input. I've now reworked the code completely. The generic category tests are now dynamically mixed in the test class. The new approach is explained in the ticket description in more detail. The upshot is that it is very easy to add new generic test methods (simply add them to the category test class, e.g. `test_sets_cat`) and to add new examples (simply create a new test class implementing `category_instances`).",
    "created_at": "2020-11-08T13:15:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464415",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:23'></a>Thanks for the input. I've now reworked the code completely. The generic category tests are now dynamically mixed in the test class. The new approach is explained in the ticket description in more detail. The upshot is that it is very easy to add new generic test methods (simply add them to the category test class, e.g. `test_sets_cat`) and to add new examples (simply create a new test class implementing `category_instances`).



---

archive/issue_comments_464416.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,54 @@\n+Currently, the sage code contains \\`_test_xyz\\` methods that are invoked via doctests and discovered via a custom \\`TestSuit\\` class. In this ticket, we are proposing to replace this custom designed test discovery by using the established pytest framework https://docs.pytest.org/ (this is inline with #28936 - using mainstraim Python test infrastructure).\n+\n+Advantages of this approach:\n+- Reuse standard test infrastructure instead of a custom test discovery interface (this is a big plus as we do not have to maintain it ourself, especially given the large list of todo's in the TestSuite code)\n+- With this there also comes better error messages in case a test fails.\n+- Easier onboarding of new Python developers\n+- Clear separation of test methods vs production code. For example, the \\`test_*.py\\` files can easily be excluded from distribution.\n+- Good support by IDE (auto completion, test discovery and easier invocation)\n+- Less and clearer code (no hidden assumptions)\n+\n+Disadvantages of this approach:\n+- Current developer have to learn the new conventions (files need to be named \\`test_*.py\\` and tests methods need to start with \\`test_\\`) and pytest\n+- Tests no longer live in the same file as the code (I would say this is an advantage, but some people may prefer to have them really close together).\n+\n+In order to migrate the following changes are necessary:\n+- Move \\`_test_xyz\\` from a category \\`module\\` to new file \\`test_module\\` (e.g. \\`test_sets_cat\\`)\n+- Rewrite test using pytest (which is straightforward and more or less only amounts to removing all the custom code involving \\`self_tester\\`)\n+- Create a new test class for the parent class under test (e.g \\`test_finite_semigroups\\`)\n+- Create a static method \\`category_instances()\\` in this test class returning a list of instances to test.\n+\n+For the moment, I did this only for two test methods in \\`sets_cat\\` to illustrate the process.\n+\n+The new implementation is as follows:\n+- The test class for the category (e.g. \\`test_sets_cat\\`) defines generic tests that should pass for every object in that category.\n+- For every object in the category there is a test class (e.g. \\`test_finite_semigroups\\`) that provides instances to test via the method \\`category_instances\\`\n+- Running pytest finds the test class \\`test_finite_semigroups\\`, then determines the categories of the object and adds all generic test methods for that category to the test class (this happens in \\`conftest.py\\`).\n+- Each test method can have the parameter \\`category_instance\\` which is bound to the return value of the \\`category_instances\\` method.\n+- Thus, the output is as follows:\n+\n+\\`\\`\\`\n+sage/categories/test_finite_semigroups.py::TestFiniteSemigroup::test_element_eq_reflexive[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED [ 25%]\n+sage/categories/test_finite_semigroups.py::TestFiniteSemigroup::test_element_eq_reflexive[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED [ 50%]\n+sage/categories/test_finite_semigroups.py::TestFiniteSemigroup::test_cardinality_return_type[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED [ 75%]\n+sage/categories/test_finite_semigroups.py::TestFiniteSemigroup::test_cardinality_return_type[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED [100%]\n+\\`\\`\\`\n+\n+\n+TOOD (as follow-up tickets):\n+- Complete migration of tests to pytest\n+- Integrate \\`pytest\\` in \\`sage -t\\` and tox\n+- Call \\`pytest\\` as part of the build process so that the newly added tests are found and checked\n+- After the migration is done, remove invoking the \\`TestSuit\\` in the doctests and remove the \\`TestSuit\\` class.\n+\n+---\n+\n+By default, pytest implements the following standard test discovery:\n+\n+- Search for \\`test_*.py\\` or \\`*_test.py\\` files (I would stick to the \\`test\\` prefix).\n+- From those files, collect test items:\n+   - Functions or methods with prefix \\`test\\`\n+   - If the functions are inside of classes, then the class name has to start with \\`test\\` as well.\n \n \n Author: Tobias Diez\n```\n",
    "created_at": "2020-11-08T13:15:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464416",
    "user": "https://github.com/tobiasdiez"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,54 @@
+Currently, the sage code contains \`_test_xyz\` methods that are invoked via doctests and discovered via a custom \`TestSuit\` class. In this ticket, we are proposing to replace this custom designed test discovery by using the established pytest framework https://docs.pytest.org/ (this is inline with #28936 - using mainstraim Python test infrastructure).
+
+Advantages of this approach:
+- Reuse standard test infrastructure instead of a custom test discovery interface (this is a big plus as we do not have to maintain it ourself, especially given the large list of todo's in the TestSuite code)
+- With this there also comes better error messages in case a test fails.
+- Easier onboarding of new Python developers
+- Clear separation of test methods vs production code. For example, the \`test_*.py\` files can easily be excluded from distribution.
+- Good support by IDE (auto completion, test discovery and easier invocation)
+- Less and clearer code (no hidden assumptions)
+
+Disadvantages of this approach:
+- Current developer have to learn the new conventions (files need to be named \`test_*.py\` and tests methods need to start with \`test_\`) and pytest
+- Tests no longer live in the same file as the code (I would say this is an advantage, but some people may prefer to have them really close together).
+
+In order to migrate the following changes are necessary:
+- Move \`_test_xyz\` from a category \`module\` to new file \`test_module\` (e.g. \`test_sets_cat\`)
+- Rewrite test using pytest (which is straightforward and more or less only amounts to removing all the custom code involving \`self_tester\`)
+- Create a new test class for the parent class under test (e.g \`test_finite_semigroups\`)
+- Create a static method \`category_instances()\` in this test class returning a list of instances to test.
+
+For the moment, I did this only for two test methods in \`sets_cat\` to illustrate the process.
+
+The new implementation is as follows:
+- The test class for the category (e.g. \`test_sets_cat\`) defines generic tests that should pass for every object in that category.
+- For every object in the category there is a test class (e.g. \`test_finite_semigroups\`) that provides instances to test via the method \`category_instances\`
+- Running pytest finds the test class \`test_finite_semigroups\`, then determines the categories of the object and adds all generic test methods for that category to the test class (this happens in \`conftest.py\`).
+- Each test method can have the parameter \`category_instance\` which is bound to the return value of the \`category_instances\` method.
+- Thus, the output is as follows:
+
+\`\`\`
+sage/categories/test_finite_semigroups.py::TestFiniteSemigroup::test_element_eq_reflexive[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED [ 25%]
+sage/categories/test_finite_semigroups.py::TestFiniteSemigroup::test_element_eq_reflexive[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED [ 50%]
+sage/categories/test_finite_semigroups.py::TestFiniteSemigroup::test_cardinality_return_type[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED [ 75%]
+sage/categories/test_finite_semigroups.py::TestFiniteSemigroup::test_cardinality_return_type[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED [100%]
+\`\`\`
+
+
+TOOD (as follow-up tickets):
+- Complete migration of tests to pytest
+- Integrate \`pytest\` in \`sage -t\` and tox
+- Call \`pytest\` as part of the build process so that the newly added tests are found and checked
+- After the migration is done, remove invoking the \`TestSuit\` in the doctests and remove the \`TestSuit\` class.
+
+---
+
+By default, pytest implements the following standard test discovery:
+
+- Search for \`test_*.py\` or \`*_test.py\` files (I would stick to the \`test\` prefix).
+- From those files, collect test items:
+   - Functions or methods with prefix \`test\`
+   - If the functions are inside of classes, then the class name has to start with \`test\` as well.
 
 
 Author: Tobias Diez
```




---

archive/issue_comments_464417.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-11-08T13:15:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464417",
    "user": "https://github.com/tobiasdiez"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_464418.json:
```json
{
    "body": "<a id='comment:24'></a>It's really hard to see from this ticket how this is intended to go.\n\nThe previous version that I reviewed was removing existing doctests and reimplementing a small subset of them using pytest.\n\nNow the new version is only adding some new tests using pytest that seem to duplicate some existing tests run by the doctest framework.",
    "created_at": "2020-12-05T18:30:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464418",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:24'></a>It's really hard to see from this ticket how this is intended to go.

The previous version that I reviewed was removing existing doctests and reimplementing a small subset of them using pytest.

Now the new version is only adding some new tests using pytest that seem to duplicate some existing tests run by the doctest framework.



---

archive/issue_comments_464419.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-12-05T18:30:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464419",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_464420.json:
```json
{
    "body": "<a id='comment:25'></a>The current version is meant as a starting point for discussion whether this approach is ok.  So it is a fully working prototype that indeed reimplements a subset of the current category framework tests, and is flexible enough to be extended to cover everything.\nGetting full parity with the current category tests needs a bit of work by extending `test_sets_cat` with the remaining test functions.\n\nI'm not sure what I should do now. The only open point is that pytest needs to be run during the normal test run (on user systems as well as on the ci pipeline). But that's not really the purpose of this ticket. I think, it's clear that one cannot reimplement the complete category tests in one ticket, so this is why I opted for a minimal version. What is your proposal to proceed from here?",
    "created_at": "2020-12-05T20:42:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464420",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:25'></a>The current version is meant as a starting point for discussion whether this approach is ok.  So it is a fully working prototype that indeed reimplements a subset of the current category framework tests, and is flexible enough to be extended to cover everything.
Getting full parity with the current category tests needs a bit of work by extending `test_sets_cat` with the remaining test functions.

I'm not sure what I should do now. The only open point is that pytest needs to be run during the normal test run (on user systems as well as on the ci pipeline). But that's not really the purpose of this ticket. I think, it's clear that one cannot reimplement the complete category tests in one ticket, so this is why I opted for a minimal version. What is your proposal to proceed from here?



---

archive/issue_comments_464421.json:
```json
{
    "body": "<a id='comment:26'></a>Feedback/review still needed.",
    "created_at": "2020-12-20T22:42:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464421",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:26'></a>Feedback/review still needed.



---

archive/issue_comments_464422.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-12-20T22:42:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464422",
    "user": "https://github.com/tobiasdiez"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_464423.json:
```json
{
    "body": "<a id='comment:27'></a>Replying to [comment:25 gh-tobiasdiez]:\n> Getting full parity with the current category tests needs a bit of work by extending `test_sets_cat` with the remaining test functions.\n\n\nBut even for the test function that you already added, it is only testing a few objects.\n\nSo to get parity even for this one test function, `category_instances` would have to be extended vastly -- if I understand the design correctly.\n\nIt is unclear who should do this work and why.",
    "created_at": "2020-12-21T01:37:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464423",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:27'></a>Replying to [comment:25 gh-tobiasdiez]:
> Getting full parity with the current category tests needs a bit of work by extending `test_sets_cat` with the remaining test functions.


But even for the test function that you already added, it is only testing a few objects.

So to get parity even for this one test function, `category_instances` would have to be extended vastly -- if I understand the design correctly.

It is unclear who should do this work and why.



---

archive/issue_comments_464424.json:
```json
{
    "body": "<a id='comment:29'></a>I've now vastly extended the tests, and replaced some of the TestSuite calls by pytest. A handful of test methods are still missing to get full feature parity (will do this later), but I hope the idea and design get clearer now (at the cost that there are bigger changes).\n\nThe following change is characteristic for the aim of migrating from Sage's custom TestSuite framework to pytest:\n\n```\n-        sage: TestSuite(C).run()\n+        sage: import pytest\n+        sage: pytest.main([\"-r\", \"test_finite_semigroups.py\"])\n```\n(calling pytest from the doctests is only a temporary work-around until it's properly integrated into the build chain)",
    "created_at": "2020-12-21T11:14:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464424",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:29'></a>I've now vastly extended the tests, and replaced some of the TestSuite calls by pytest. A handful of test methods are still missing to get full feature parity (will do this later), but I hope the idea and design get clearer now (at the cost that there are bigger changes).

The following change is characteristic for the aim of migrating from Sage's custom TestSuite framework to pytest:

```
-        sage: TestSuite(C).run()
+        sage: import pytest
+        sage: pytest.main(["-r", "test_finite_semigroups.py"])
```
(calling pytest from the doctests is only a temporary work-around until it's properly integrated into the build chain)



---

archive/issue_comments_464425.json:
```json
{
    "body": "<a id='comment:30'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2020-12-21T11:14:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464425",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:30'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_464426.json:
```json
{
    "body": "<a id='comment:31'></a>Replying to [comment:27 mkoeppe]:\n> But even for the test function that you already added, it is only testing a few objects.\n> \n> So to get parity even for this one test function, `category_instances` would have to be extended vastly -- if I understand the design correctly.\n\n\nThese changes do not seem to address the above comment? You added more test functions, instead of showing how one would achieve parity for what one test function covers. Or maybe I'm misunderstanding.",
    "created_at": "2020-12-21T18:16:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464426",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:31'></a>Replying to [comment:27 mkoeppe]:
> But even for the test function that you already added, it is only testing a few objects.
> 
> So to get parity even for this one test function, `category_instances` would have to be extended vastly -- if I understand the design correctly.


These changes do not seem to address the above comment? You added more test functions, instead of showing how one would achieve parity for what one test function covers. Or maybe I'm misunderstanding.



---

archive/issue_comments_464427.json:
```json
{
    "body": "<a id='comment:32'></a>I guess there are two ways for migration:\n- Replace one test in the category framework by a pytest, and then make sure that this test is invoked for every example. Do this again for every test.\n- Duplicate all tests in the category framework using pytest, and then replace one `TestSuite(...).run` statement by its pytest equivalent. Do this again for every test invocation.\n\nSince there are only a small number of tests (order of 10) but way more examples (order of 1000), my idea was follow the second approach since this can be done easier in steps.\n\nOf course, the complete migration is quite a huge project. This ticket was meant to as a starting point.\n\nThe advantages I see of pytest over a custom testsuite implementation are in the ticket description.",
    "created_at": "2020-12-21T20:26:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464427",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:32'></a>I guess there are two ways for migration:
- Replace one test in the category framework by a pytest, and then make sure that this test is invoked for every example. Do this again for every test.
- Duplicate all tests in the category framework using pytest, and then replace one `TestSuite(...).run` statement by its pytest equivalent. Do this again for every test invocation.

Since there are only a small number of tests (order of 10) but way more examples (order of 1000), my idea was follow the second approach since this can be done easier in steps.

Of course, the complete migration is quite a huge project. This ticket was meant to as a starting point.

The advantages I see of pytest over a custom testsuite implementation are in the ticket description.



---

archive/issue_comments_464428.json:
```json
{
    "body": "<a id='comment:33'></a>If I understand the proposed design correctly, for each category you would manually maintain a list of category instances to test. To me this seems like a huge step backward: The categories of an object are computed dynamically - and thus all test methods that come with the categories are run.",
    "created_at": "2020-12-23T19:25:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464428",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:33'></a>If I understand the proposed design correctly, for each category you would manually maintain a list of category instances to test. To me this seems like a huge step backward: The categories of an object are computed dynamically - and thus all test methods that come with the categories are run.



---

archive/issue_comments_464429.json:
```json
{
    "body": "<a id='comment:34'></a>(Feel free to add this to \"disadvantages of the approach\" in the ticket description.)",
    "created_at": "2020-12-23T19:25:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464429",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:34'></a>(Feel free to add this to "disadvantages of the approach" in the ticket description.)



---

archive/issue_comments_464430.json:
```json
{
    "body": "<a id='comment:35'></a>From \"advantages\" in the ticket description:\n> Clear separation of test methods vs production code. For example, the test_*.py files can easily be excluded from distribution.\n\nWe definitely would not want to exclude them from the distribution! Also user-defined classes will want to run the test methods that are provided by the categories as part of their tests.",
    "created_at": "2020-12-23T19:27:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464430",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:35'></a>From "advantages" in the ticket description:
> Clear separation of test methods vs production code. For example, the test_*.py files can easily be excluded from distribution.

We definitely would not want to exclude them from the distribution! Also user-defined classes will want to run the test methods that are provided by the categories as part of their tests.



---

archive/issue_comments_464431.json:
```json
{
    "body": "<a id='comment:36'></a>Could you elaborate on this in the ticket description:\n> Good support by IDE (auto completion, test discovery and easier invocation)",
    "created_at": "2020-12-23T19:29:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464431",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:36'></a>Could you elaborate on this in the ticket description:
> Good support by IDE (auto completion, test discovery and easier invocation)



---

archive/issue_comments_464432.json:
```json
{
    "body": "<a id='comment:37'></a>Replying to [comment:33 mkoeppe]:\n> If I understand the proposed design correctly, for each category you would manually maintain a list of category instances to test.\n\n\nYes, but that's not different from the current code. There you also create the examples and then run the testsuite (which makes sure to run the correct tests for this category). This is the same in the proposed design, except that you now define the examples in the test file. I would even argue that the proposed design is more flexible and makes it very transparent which examples are used to test a given category.",
    "created_at": "2020-12-23T19:37:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464432",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:37'></a>Replying to [comment:33 mkoeppe]:
> If I understand the proposed design correctly, for each category you would manually maintain a list of category instances to test.


Yes, but that's not different from the current code. There you also create the examples and then run the testsuite (which makes sure to run the correct tests for this category). This is the same in the proposed design, except that you now define the examples in the test file. I would even argue that the proposed design is more flexible and makes it very transparent which examples are used to test a given category.



---

archive/issue_comments_464433.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,54 @@\n+Currently, the sage code contains \\`_test_xyz\\` methods that are invoked via doctests and discovered via a custom \\`TestSuit\\` class. In this ticket, we are proposing to replace this custom designed test discovery by using the established pytest framework https://docs.pytest.org/ (this is inline with #28936 - using mainstraim Python test infrastructure).\n+\n+Advantages of this approach:\n+- Reuse standard test infrastructure instead of a custom test discovery interface (this is a big plus as we do not have to maintain it ourself, especially given the large list of todo's in the TestSuite code)\n+- With this there also comes better error messages in case a test fails.\n+- Easier onboarding of new Python developers\n+- Clear separation of test methods vs production code. For example, the \\`test_*.py\\` files can easily be excluded from distribution.\n+- Good support by IDE (auto completion, test discovery and easier invocation). For example, VS code automatically discovers all pytest tests, provides a convenient interface to run them (all, subselection, only failed ones) and allows to directly start a debug session for a failing test. See https://code.visualstudio.com/docs/python/testing\n+- Less and clearer code (no hidden assumptions)\n+\n+Disadvantages of this approach:\n+- Current developer have to learn the new conventions (files need to be named \\`test_*.py\\` and tests methods need to start with \\`test_\\`) and pytest\n+- Tests no longer live in the same file as the code (I would say this is an advantage, but some people may prefer to have them really close together).\n+\n+In order to migrate the following changes are necessary:\n+- Move \\`_test_xyz\\` from a category \\`module\\` to new file \\`test_module\\` (e.g. \\`test_sets_cat\\`)\n+- Rewrite test using pytest (which is straightforward and more or less only amounts to removing all the custom code involving \\`self_tester\\`)\n+- Create a new test class for the parent class under test (e.g \\`test_finite_semigroups\\`)\n+- Create a static method \\`category_instances()\\` in this test class returning a list of instances to test.\n+\n+For the moment, I did this only for two test methods in \\`sets_cat\\` to illustrate the process.\n+\n+The new implementation is as follows:\n+- The test class for the category (e.g. \\`test_sets_cat\\`) defines generic tests that should pass for every object in that category.\n+- For every object in the category there is a test class (e.g. \\`test_finite_semigroups\\`) that provides instances to test via the method \\`category_instances\\`\n+- Running pytest finds the test class \\`test_finite_semigroups\\`, then determines the categories of the object and adds all generic test methods for that category to the test class (this happens in \\`conftest.py\\`).\n+- Each test method can have the parameter \\`category_instance\\` which is bound to the return value of the \\`category_instances\\` method.\n+- Thus, the output is as follows:\n+\n+\\`\\`\\`\n+sage/categories/test_finite_semigroups.py::TestFiniteSemigroup::test_element_eq_reflexive[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED [ 25%]\n+sage/categories/test_finite_semigroups.py::TestFiniteSemigroup::test_element_eq_reflexive[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED [ 50%]\n+sage/categories/test_finite_semigroups.py::TestFiniteSemigroup::test_cardinality_return_type[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED [ 75%]\n+sage/categories/test_finite_semigroups.py::TestFiniteSemigroup::test_cardinality_return_type[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED [100%]\n+\\`\\`\\`\n+\n+\n+TOOD (as follow-up tickets):\n+- Complete migration of tests to pytest\n+- Integrate \\`pytest\\` in \\`sage -t\\` and tox\n+- Call \\`pytest\\` as part of the build process so that the newly added tests are found and checked\n+- After the migration is done, remove invoking the \\`TestSuit\\` in the doctests and remove the \\`TestSuit\\` class.\n+\n+---\n+\n+By default, pytest implements the following standard test discovery:\n+\n+- Search for \\`test_*.py\\` or \\`*_test.py\\` files (I would stick to the \\`test\\` prefix).\n+- From those files, collect test items:\n+   - Functions or methods with prefix \\`test\\`\n+   - If the functions are inside of classes, then the class name has to start with \\`test\\` as well.\n \n \n Author: Tobias Diez\n```\n",
    "created_at": "2020-12-23T19:39:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464433",
    "user": "https://github.com/tobiasdiez"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,54 @@
+Currently, the sage code contains \`_test_xyz\` methods that are invoked via doctests and discovered via a custom \`TestSuit\` class. In this ticket, we are proposing to replace this custom designed test discovery by using the established pytest framework https://docs.pytest.org/ (this is inline with #28936 - using mainstraim Python test infrastructure).
+
+Advantages of this approach:
+- Reuse standard test infrastructure instead of a custom test discovery interface (this is a big plus as we do not have to maintain it ourself, especially given the large list of todo's in the TestSuite code)
+- With this there also comes better error messages in case a test fails.
+- Easier onboarding of new Python developers
+- Clear separation of test methods vs production code. For example, the \`test_*.py\` files can easily be excluded from distribution.
+- Good support by IDE (auto completion, test discovery and easier invocation). For example, VS code automatically discovers all pytest tests, provides a convenient interface to run them (all, subselection, only failed ones) and allows to directly start a debug session for a failing test. See https://code.visualstudio.com/docs/python/testing
+- Less and clearer code (no hidden assumptions)
+
+Disadvantages of this approach:
+- Current developer have to learn the new conventions (files need to be named \`test_*.py\` and tests methods need to start with \`test_\`) and pytest
+- Tests no longer live in the same file as the code (I would say this is an advantage, but some people may prefer to have them really close together).
+
+In order to migrate the following changes are necessary:
+- Move \`_test_xyz\` from a category \`module\` to new file \`test_module\` (e.g. \`test_sets_cat\`)
+- Rewrite test using pytest (which is straightforward and more or less only amounts to removing all the custom code involving \`self_tester\`)
+- Create a new test class for the parent class under test (e.g \`test_finite_semigroups\`)
+- Create a static method \`category_instances()\` in this test class returning a list of instances to test.
+
+For the moment, I did this only for two test methods in \`sets_cat\` to illustrate the process.
+
+The new implementation is as follows:
+- The test class for the category (e.g. \`test_sets_cat\`) defines generic tests that should pass for every object in that category.
+- For every object in the category there is a test class (e.g. \`test_finite_semigroups\`) that provides instances to test via the method \`category_instances\`
+- Running pytest finds the test class \`test_finite_semigroups\`, then determines the categories of the object and adds all generic test methods for that category to the test class (this happens in \`conftest.py\`).
+- Each test method can have the parameter \`category_instance\` which is bound to the return value of the \`category_instances\` method.
+- Thus, the output is as follows:
+
+\`\`\`
+sage/categories/test_finite_semigroups.py::TestFiniteSemigroup::test_element_eq_reflexive[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED [ 25%]
+sage/categories/test_finite_semigroups.py::TestFiniteSemigroup::test_element_eq_reflexive[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED [ 50%]
+sage/categories/test_finite_semigroups.py::TestFiniteSemigroup::test_cardinality_return_type[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED [ 75%]
+sage/categories/test_finite_semigroups.py::TestFiniteSemigroup::test_cardinality_return_type[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED [100%]
+\`\`\`
+
+
+TOOD (as follow-up tickets):
+- Complete migration of tests to pytest
+- Integrate \`pytest\` in \`sage -t\` and tox
+- Call \`pytest\` as part of the build process so that the newly added tests are found and checked
+- After the migration is done, remove invoking the \`TestSuit\` in the doctests and remove the \`TestSuit\` class.
+
+---
+
+By default, pytest implements the following standard test discovery:
+
+- Search for \`test_*.py\` or \`*_test.py\` files (I would stick to the \`test\` prefix).
+- From those files, collect test items:
+   - Functions or methods with prefix \`test\`
+   - If the functions are inside of classes, then the class name has to start with \`test\` as well.
 
 
 Author: Tobias Diez
```




---

archive/issue_comments_464434.json:
```json
{
    "body": "<a id='comment:38'></a>Replying to [comment:36 mkoeppe]:\n> Could you elaborate on this in the ticket description:\n> > Good support by IDE (auto completion, test discovery and easier invocation)\n\n\nDone.",
    "created_at": "2020-12-23T19:39:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464434",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:38'></a>Replying to [comment:36 mkoeppe]:
> Could you elaborate on this in the ticket description:
> > Good support by IDE (auto completion, test discovery and easier invocation)


Done.



---

archive/issue_comments_464435.json:
```json
{
    "body": "<a id='comment:39'></a>Replying to [comment:35 mkoeppe]:\n> From \"advantages\" in the ticket description:\n> > Clear separation of test methods vs production code. For example, the test_*.py files can easily be excluded from distribution.\n\n> We definitely would not want to exclude them from the distribution! Also user-defined classes will want to run the test methods that are provided by the categories as part of their tests.\n\nProbably depends on the context. People using sagelib only as a (calculation) library may not need these tests. One could for example easily split them out into a new sage.testing package (or sage.categories.testing) once everything is modularized nicely.",
    "created_at": "2020-12-23T19:43:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464435",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:39'></a>Replying to [comment:35 mkoeppe]:
> From "advantages" in the ticket description:
> > Clear separation of test methods vs production code. For example, the test_*.py files can easily be excluded from distribution.

> We definitely would not want to exclude them from the distribution! Also user-defined classes will want to run the test methods that are provided by the categories as part of their tests.

Probably depends on the context. People using sagelib only as a (calculation) library may not need these tests. One could for example easily split them out into a new sage.testing package (or sage.categories.testing) once everything is modularized nicely.



---

archive/issue_comments_464436.json:
```json
{
    "body": "<a id='comment:40'></a>Replying to [comment:37 gh-tobiasdiez]:\n> Replying to [comment:33 mkoeppe]:\n> > If I understand the proposed design correctly, for each category you would manually maintain a list of category instances to test.\n\n> \n> Yes, but that's not different from the current code. There you also create the examples and then run the testsuite (which makes sure to run the correct tests for this category). This is the same in the proposed design, except that you now define the examples in the test file.\n\n\nI think you may be missing that the category of an object is not statically known but is computed by code.",
    "created_at": "2020-12-23T19:47:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464436",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:40'></a>Replying to [comment:37 gh-tobiasdiez]:
> Replying to [comment:33 mkoeppe]:
> > If I understand the proposed design correctly, for each category you would manually maintain a list of category instances to test.

> 
> Yes, but that's not different from the current code. There you also create the examples and then run the testsuite (which makes sure to run the correct tests for this category). This is the same in the proposed design, except that you now define the examples in the test file.


I think you may be missing that the category of an object is not statically known but is computed by code.



---

archive/issue_comments_464437.json:
```json
{
    "body": "<a id='comment:41'></a>No, I'm not. The `test_some_category.py` says only \"please check the category tests for the following examples\" and pytest automatically determines based on the category of these examples which tests to run. In fact, the latter is done here\n\n```\n+def pytest_pycollect_makeitem(collector: PyCollector, name: str, obj: type):\n+    if inspect.isclass(obj) and \"category_instances\" in dir(obj):\n+        # Enrich test class by functions from the corresponding category test class\n+        for category, category_test_class in categories_with_tests.items():\n+            if category() in obj.category_instances()[0].category().all_super_categories():\n+                methods= [method for method in dir(category_test_class)\n+                        if not method.startswith('__') and callable(getattr(category_test_class, method))]\n+            \n+                for method in methods:\n+                    setattr(obj, method, getattr(category_test_class, method))\n+\n+        return pytest.Class.from_parent(collector, name=name, obj=obj)\n+    else:\n+        return None\n```",
    "created_at": "2020-12-23T19:51:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464437",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:41'></a>No, I'm not. The `test_some_category.py` says only "please check the category tests for the following examples" and pytest automatically determines based on the category of these examples which tests to run. In fact, the latter is done here

```
+def pytest_pycollect_makeitem(collector: PyCollector, name: str, obj: type):
+    if inspect.isclass(obj) and "category_instances" in dir(obj):
+        # Enrich test class by functions from the corresponding category test class
+        for category, category_test_class in categories_with_tests.items():
+            if category() in obj.category_instances()[0].category().all_super_categories():
+                methods= [method for method in dir(category_test_class)
+                        if not method.startswith('__') and callable(getattr(category_test_class, method))]
+            
+                for method in methods:
+                    setattr(obj, method, getattr(category_test_class, method))
+
+        return pytest.Class.from_parent(collector, name=name, obj=obj)
+    else:
+        return None
```



---

archive/issue_comments_464438.json:
```json
{
    "body": "<a id='comment:42'></a>OK, but how is this compatible with your design to list the test objects in `category_instances`?",
    "created_at": "2020-12-23T19:59:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464438",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:42'></a>OK, but how is this compatible with your design to list the test objects in `category_instances`?



---

archive/issue_comments_464439.json:
```json
{
    "body": "<a id='comment:43'></a>The design is as follows. Say you have a category `LieGroups` combining the categories `Manifolds` and `Groups`.\nThen you:\n1. Create `manifolds_test` and `groups_test` files, specifying the category tests that should hold for all objects of this category.\n2. Create a `liegroups_test` file, specifying in `category_instances` the examples of Lie groups you want to test, say `SO(3)` and `SU(2)`. Moreover, add test methods that are particular for the cateogory of Lie groups.\n\nWhen run, the code then looks at these examples, determines that they are objects of the categories Manifolds, Groups and Lie Groups and collects all tests from `manifolds_test`, `groups_test` and `liegroups_test`.\n\nThis can already be seen in action in the code, where the finite semigroups inhert tests from the category of sets and of finite sets.",
    "created_at": "2020-12-23T20:11:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464439",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:43'></a>The design is as follows. Say you have a category `LieGroups` combining the categories `Manifolds` and `Groups`.
Then you:
1. Create `manifolds_test` and `groups_test` files, specifying the category tests that should hold for all objects of this category.
2. Create a `liegroups_test` file, specifying in `category_instances` the examples of Lie groups you want to test, say `SO(3)` and `SU(2)`. Moreover, add test methods that are particular for the cateogory of Lie groups.

When run, the code then looks at these examples, determines that they are objects of the categories Manifolds, Groups and Lie Groups and collects all tests from `manifolds_test`, `groups_test` and `liegroups_test`.

This can already be seen in action in the code, where the finite semigroups inhert tests from the category of sets and of finite sets.



---

archive/issue_comments_464440.json:
```json
{
    "body": "<a id='comment:44'></a>So in the end it does not matter at all in which method `category_instances` an object is put?",
    "created_at": "2020-12-23T20:45:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464440",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:44'></a>So in the end it does not matter at all in which method `category_instances` an object is put?



---

archive/issue_comments_464441.json:
```json
{
    "body": "<a id='comment:45'></a>Replying to [comment:43 gh-tobiasdiez]:\n> This can already be seen in action in the code, where the finite semigroups inhert tests from the category of sets and of finite sets.\n\n\nBut having `test_associativity` supplied by `TestFiniteSemigroup` surely can't be the final design?!",
    "created_at": "2020-12-23T20:54:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464441",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:45'></a>Replying to [comment:43 gh-tobiasdiez]:
> This can already be seen in action in the code, where the finite semigroups inhert tests from the category of sets and of finite sets.


But having `test_associativity` supplied by `TestFiniteSemigroup` surely can't be the final design?!



---

archive/issue_comments_464442.json:
```json
{
    "body": "<a id='comment:46'></a>Replying to [comment:44 mkoeppe]:\n> So in the end it does not matter at all in which method `category_instances` an object is put?\n\n\nNo, it doesn't really matter. One could also have one big test file listing all these examples. But I would advocate to have one test file for each category, because then one can easily also write additional tests (not related to the category framework). It's also consistent with the usual conventions where one usually has one test file for each module file.",
    "created_at": "2020-12-23T21:06:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464442",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:46'></a>Replying to [comment:44 mkoeppe]:
> So in the end it does not matter at all in which method `category_instances` an object is put?


No, it doesn't really matter. One could also have one big test file listing all these examples. But I would advocate to have one test file for each category, because then one can easily also write additional tests (not related to the category framework). It's also consistent with the usual conventions where one usually has one test file for each module file.



---

archive/issue_comments_464443.json:
```json
{
    "body": "<a id='comment:47'></a>Replying to [comment:45 mkoeppe]:\n> But having `test_associativity` supplied by `TestFiniteSemigroup` surely can't be the final design?!\n\n\nI think this was a mistake on my side, it should be in a new test file for the \"Semigroup\" category.",
    "created_at": "2020-12-23T21:09:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464443",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:47'></a>Replying to [comment:45 mkoeppe]:
> But having `test_associativity` supplied by `TestFiniteSemigroup` surely can't be the final design?!


I think this was a mistake on my side, it should be in a new test file for the "Semigroup" category.



---

archive/issue_comments_464444.json:
```json
{
    "body": "<a id='comment:48'></a>Replying to [comment:46 gh-tobiasdiez]:\n> Replying to [comment:44 mkoeppe]:\n> > So in the end it does not matter at all in which method `category_instances` an object is put?\n\n> \n> No, it doesn't really matter. One could also have one big test file listing all these examples. \n\n\nOK, this is an important clarification, thanks.\n\n> But I would advocate to have one test file for each category, because then one can easily also write additional tests (not related to the category framework). \n\n\nWould it not be better to have one test file for each module (... whose doctest currently has calls to `TestSuite`)? I really don't see what is gained by grouping the test objects by category -- which is coarser than how things are grouped currently (i.e., by module) and also arbitrary (because for join categories you would be making an arbitrary choice into which test file to put an object).",
    "created_at": "2020-12-23T21:28:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464444",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:48'></a>Replying to [comment:46 gh-tobiasdiez]:
> Replying to [comment:44 mkoeppe]:
> > So in the end it does not matter at all in which method `category_instances` an object is put?

> 
> No, it doesn't really matter. One could also have one big test file listing all these examples. 


OK, this is an important clarification, thanks.

> But I would advocate to have one test file for each category, because then one can easily also write additional tests (not related to the category framework). 


Would it not be better to have one test file for each module (... whose doctest currently has calls to `TestSuite`)? I really don't see what is gained by grouping the test objects by category -- which is coarser than how things are grouped currently (i.e., by module) and also arbitrary (because for join categories you would be making an arbitrary choice into which test file to put an object).



---

archive/issue_comments_464445.json:
```json
{
    "body": "<a id='comment:49'></a>Replying to [comment:48 mkoeppe]:\n> Would it not be better to have one test file for each module (... whose doctest currently has calls to `TestSuite`)? I really don't see what is gained by grouping the test objects by category -- which is coarser than how things are grouped currently (i.e., by module) and also arbitrary (because for join categories you would be making an arbitrary choice into which test file to put an object).\n> \n\n\nIt depends on what you want to test. If you want to test that the implementation of the category is correct, you put it in the test file of the category. If you want to test the implementation of an example, you put it in the test file of the example.",
    "created_at": "2020-12-23T21:48:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464445",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:49'></a>Replying to [comment:48 mkoeppe]:
> Would it not be better to have one test file for each module (... whose doctest currently has calls to `TestSuite`)? I really don't see what is gained by grouping the test objects by category -- which is coarser than how things are grouped currently (i.e., by module) and also arbitrary (because for join categories you would be making an arbitrary choice into which test file to put an object).
> 


It depends on what you want to test. If you want to test that the implementation of the category is correct, you put it in the test file of the category. If you want to test the implementation of an example, you put it in the test file of the example.



---

archive/issue_comments_464446.json:
```json
{
    "body": "<a id='comment:50'></a>Hello!\n\nThanks for bringing me in the conversation. It's been\nten years since I designed TestSuite (with the help\nfrom many). Since that time, Python and the available\ntesting tools have evolved a lot. I am\nglad to see efforts going into rethinking the design\nin this new context, questioning the implementation,\nand studying alternatives that would reach the\nsame design goals but better suit the context.\nEspecially toward using\nnow standard infrastructure and practice to reduce\nboth the technical debt and the entry barrier for\nnew devs and/or for integration with other software.",
    "created_at": "2020-12-23T22:37:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464446",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:50'></a>Hello!

Thanks for bringing me in the conversation. It's been
ten years since I designed TestSuite (with the help
from many). Since that time, Python and the available
testing tools have evolved a lot. I am
glad to see efforts going into rethinking the design
in this new context, questioning the implementation,
and studying alternatives that would reach the
same design goals but better suit the context.
Especially toward using
now standard infrastructure and practice to reduce
both the technical debt and the entry barrier for
new devs and/or for integration with other software.



---

archive/issue_comments_464447.json:
```json
{
    "body": "<a id='comment:51'></a>(the rant may be a bit long, so I am splitting this into several comments).\n\nSo, what were these design goals:\n\n(I) Hardening library and user defined algebraic structures, and beyond\n\nThe tests are there for checking the internal consistency\nof category code and for checking that parents (and their\nelements, morphisms, ...) satisfy the specifications of their\ncategories (e.g. axioms). Supporting user defined algebraic structures is\na must. In my research area we routinely create new algebraic\nstructures, and when doing so TestSuite is a daily tool:\npractice has told me that, once the implementation of\nthat algebraic structure pass the testsuite, most of the time\nit's actually correct (certainly something that is research\narea dependent!).\n\nIn some cases, it even becomes a research tool: I am not\nsure whether the newly defined algebraic structure actually\nsatisfy the axioms I want it to satisfy, and I use TestSuite\nto actually run checks. And use post-mortem instrospection\nwith the debugger to actually recover the counter examples ot\nmy conjectures.\n\nThe next step in this direction is to work toward merging\nthe `_test_xxx` methods and `_is_xxx` methods: most of the time,\nthe code is mostly the same: checking whether axiom xxx is\nsatisfied. What changes is how thorough the test is, and\nhow failures are reported. I have toyed around with the idea\nwith prototypes in sage-semigroups. Alas I never got to actually\nconverge to a proposal for Sage. But this is something we want\nto keep in mind.",
    "created_at": "2020-12-23T22:58:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464447",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:51'></a>(the rant may be a bit long, so I am splitting this into several comments).

So, what were these design goals:

(I) Hardening library and user defined algebraic structures, and beyond

The tests are there for checking the internal consistency
of category code and for checking that parents (and their
elements, morphisms, ...) satisfy the specifications of their
categories (e.g. axioms). Supporting user defined algebraic structures is
a must. In my research area we routinely create new algebraic
structures, and when doing so TestSuite is a daily tool:
practice has told me that, once the implementation of
that algebraic structure pass the testsuite, most of the time
it's actually correct (certainly something that is research
area dependent!).

In some cases, it even becomes a research tool: I am not
sure whether the newly defined algebraic structure actually
satisfy the axioms I want it to satisfy, and I use TestSuite
to actually run checks. And use post-mortem instrospection
with the debugger to actually recover the counter examples ot
my conjectures.

The next step in this direction is to work toward merging
the `_test_xxx` methods and `_is_xxx` methods: most of the time,
the code is mostly the same: checking whether axiom xxx is
satisfied. What changes is how thorough the test is, and
how failures are reported. I have toyed around with the idea
with prototypes in sage-semigroups. Alas I never got to actually
converge to a proposal for Sage. But this is something we want
to keep in mind.



---

archive/issue_comments_464448.json:
```json
{
    "body": "<a id='comment:52'></a>Something else I want to clarify is that the category examples are generally meant to minimal working examples of what needs to be implemented for a particular category. However, some categories actually use other existing objects in Sage, which is something many of the categories do, but such a WME is not essential to defining a category.",
    "created_at": "2020-12-23T23:07:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464448",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:52'></a>Something else I want to clarify is that the category examples are generally meant to minimal working examples of what needs to be implemented for a particular category. However, some categories actually use other existing objects in Sage, which is something many of the categories do, but such a WME is not essential to defining a category.



---

archive/issue_comments_464449.json:
```json
{
    "body": "<a id='comment:53'></a>(II) Categories as bookshelves of code, documentation and tests\n\nEach category models some algebraic realm. \nLike the bookshelf about Group Theory in a library,\nthe category of groups in GAP or Sage ties together\neverything that applies to all groups: code, documentation,\nand tests. In a perfect world where the same system would\nbe used for computations and proofs, I would include here\nmathematical statements (e.g. formulae for the axioms)\nand proofs! Then, there are subshelves for group elements,\ngroup morphisms, ... Subshelves for particular types of\ngroups, and so on.\n\nThere are several ways to implement that tying together.\nIn GAP, categories are a mere filters; each method is\ntied to a category through an individual declaration.\nAnd the language uses a bespoke method resolution that\ndata. In [SageMath](SageMath) instead, we decided to rely on\nstandard OO method resolution, grouping together methods\nin classes. Both approaches have their advantages notably\nin terms of flexibility left to organize the code, and\nenable user extensions to existing categories.\n\n\nTwo features are required for testing purposes:\n\n(a) Recovering all the tests that one wants to run to check an object in category A\n\n(b) For each of them, resolving which test method is to be called. Indeed, a subcategory may overload a _test_xxx method when, for example, it has a more efficient way to check xxx.\n\n\nNote that (b) is of the same nature as when resolving a usual method call. It thus seems highly desirable to use the exact same resolution mechanism as for code.",
    "created_at": "2020-12-23T23:22:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464449",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:53'></a>(II) Categories as bookshelves of code, documentation and tests

Each category models some algebraic realm. 
Like the bookshelf about Group Theory in a library,
the category of groups in GAP or Sage ties together
everything that applies to all groups: code, documentation,
and tests. In a perfect world where the same system would
be used for computations and proofs, I would include here
mathematical statements (e.g. formulae for the axioms)
and proofs! Then, there are subshelves for group elements,
group morphisms, ... Subshelves for particular types of
groups, and so on.

There are several ways to implement that tying together.
In GAP, categories are a mere filters; each method is
tied to a category through an individual declaration.
And the language uses a bespoke method resolution that
data. In [SageMath](SageMath) instead, we decided to rely on
standard OO method resolution, grouping together methods
in classes. Both approaches have their advantages notably
in terms of flexibility left to organize the code, and
enable user extensions to existing categories.


Two features are required for testing purposes:

(a) Recovering all the tests that one wants to run to check an object in category A

(b) For each of them, resolving which test method is to be called. Indeed, a subcategory may overload a _test_xxx method when, for example, it has a more efficient way to check xxx.


Note that (b) is of the same nature as when resolving a usual method call. It thus seems highly desirable to use the exact same resolution mechanism as for code.



---

archive/issue_comments_464450.json:
```json
{
    "body": "<a id='comment:54'></a>(III) Scalability\n\nNothing much to say here: whatever design is chosen should scale to\nthe rich hierarchy of categories in [SageMath](SageMath), with all the mantras\n(axioms, ...) that were implemented to support that richness.\n\nA critical bit is to satisfy as much as possible the Single Source\nOf Truth principle. E.g. if at some point I want to refine the\ncategory of a parent (e.g. because a new category was created),\nI should only need to update a single location in the code.",
    "created_at": "2020-12-23T23:31:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464450",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:54'></a>(III) Scalability

Nothing much to say here: whatever design is chosen should scale to
the rich hierarchy of categories in [SageMath](SageMath), with all the mantras
(axioms, ...) that were implemented to support that richness.

A critical bit is to satisfy as much as possible the Single Source
Of Truth principle. E.g. if at some point I want to refine the
category of a parent (e.g. because a new category was created),
I should only need to update a single location in the code.



---

archive/issue_comments_464451.json:
```json
{
    "body": "<a id='comment:55'></a>Sorry for the rant; I am trying to clarify for myself what\nguided -- implicitly or explicitly -- the design back then :-)\nHopefully this is useful food for thought for a redesign.",
    "created_at": "2020-12-23T23:39:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464451",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:55'></a>Sorry for the rant; I am trying to clarify for myself what
guided -- implicitly or explicitly -- the design back then :-)
Hopefully this is useful food for thought for a redesign.



---

archive/issue_comments_464452.json:
```json
{
    "body": "<a id='comment:56'></a>Oh, one piece of information in case it would be relevant: for the longest time\nit's been on my pile to instrument TestSuite so that, by running the Sage\ntests, one would get a relatively thorough list of all Sage parents together\nwith their categories.\n\nA typical applications would be to enable inverse lookup: given a category, suggest to the user a relatively thorough list of parents implementing that category; e.g. for documentation purposes.",
    "created_at": "2020-12-23T23:44:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464452",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:56'></a>Oh, one piece of information in case it would be relevant: for the longest time
it's been on my pile to instrument TestSuite so that, by running the Sage
tests, one would get a relatively thorough list of all Sage parents together
with their categories.

A typical applications would be to enable inverse lookup: given a category, suggest to the user a relatively thorough list of parents implementing that category; e.g. for documentation purposes.



---

archive/issue_comments_464453.json:
```json
{
    "body": "<a id='comment:57'></a>Oh, that's wonderful feedback! This kind of deep insight is hard to get if you only read the existing code and don't know the story behind it's origin. Thanks a lot for your detailed account.\n\nPlease don't take this proposal as a critics of your work on the TestSuite. I was actually amazed when I discovered that Sage has it's own testing framework. The main idea behind this ticket was to outsource the cost of maintenance of such a framework to the broader Python community, so that we can focus on the math-related elements.\n\nConcerning your points, I'm happy to report that the proposed design should fit all the points you mentioned. In short:\n\n(I): It is flexible enough to accommodate new user-defined categories and examples.\n\n(II): It relies on pytest's discovery mechanism, which makes it very transparent which tests are run for a given category object.\n\n(III): Scalability is a bit hard to judge for me, since I'm not that familiar with all the possible edge cases. But so far I had no problems migrating the existing code.\nIn particular, the \"single source of truth principle\" applies, since the testing code only relies on the calculated super categories.\n\n\nHence, I would like to invite you to play around with the new design and see if it's works for your use cases. Basic documentation about pytest is added in #31003. Let me know if you encounter any problems.\n\nMerry Christmas!",
    "created_at": "2020-12-24T11:18:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464453",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:57'></a>Oh, that's wonderful feedback! This kind of deep insight is hard to get if you only read the existing code and don't know the story behind it's origin. Thanks a lot for your detailed account.

Please don't take this proposal as a critics of your work on the TestSuite. I was actually amazed when I discovered that Sage has it's own testing framework. The main idea behind this ticket was to outsource the cost of maintenance of such a framework to the broader Python community, so that we can focus on the math-related elements.

Concerning your points, I'm happy to report that the proposed design should fit all the points you mentioned. In short:

(I): It is flexible enough to accommodate new user-defined categories and examples.

(II): It relies on pytest's discovery mechanism, which makes it very transparent which tests are run for a given category object.

(III): Scalability is a bit hard to judge for me, since I'm not that familiar with all the possible edge cases. But so far I had no problems migrating the existing code.
In particular, the "single source of truth principle" applies, since the testing code only relies on the calculated super categories.


Hence, I would like to invite you to play around with the new design and see if it's works for your use cases. Basic documentation about pytest is added in #31003. Let me know if you encounter any problems.

Merry Christmas!



---

archive/issue_comments_464454.json:
```json
{
    "body": "<a id='comment:58'></a>Red branch.",
    "created_at": "2020-12-29T09:25:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464454",
    "user": "https://github.com/kliem"
}
```

<a id='comment:58'></a>Red branch.



---

archive/issue_comments_464455.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-12-29T09:25:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464455",
    "user": "https://github.com/kliem"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_464456.json:
```json
{
    "body": "<a id='comment:59'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-12-29T10:15:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464456",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:59'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_464457.json:
```json
{
    "body": "<a id='comment:60'></a>New commits:",
    "created_at": "2020-12-29T10:15:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464457",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:60'></a>New commits:



---

archive/issue_comments_464458.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-12-29T10:15:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464458",
    "user": "https://github.com/tobiasdiez"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_464459.json:
```json
{
    "body": "<a id='comment:61'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-12-29T10:20:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464459",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:61'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_464460.json:
```json
{
    "body": "<a id='comment:62'></a>Merged develop branch and removed the (unnecessary) dependencies.",
    "created_at": "2020-12-29T10:21:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464460",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:62'></a>Merged develop branch and removed the (unnecessary) dependencies.



---

archive/issue_comments_464461.json:
```json
{
    "body": "<a id='comment:63'></a>Setting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-03-15T22:07:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464461",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:63'></a>Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_events_080103.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-15T22:07:04Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30738#event-80103"
}
```



---

archive/issue_events_080104.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-15T22:07:04Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30738#event-80104"
}
```



---

archive/issue_comments_464462.json:
```json
{
    "body": "<a id='comment:64'></a>red branch => needs work",
    "created_at": "2021-07-13T13:15:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464462",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:64'></a>red branch => needs work



---

archive/issue_comments_464463.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-07-13T13:15:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464463",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_events_080105.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T02:58:13Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30738#event-80105"
}
```



---

archive/issue_events_080106.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T02:58:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30738#event-80106"
}
```



---

archive/issue_comments_464464.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,52 @@\n+Currently, the sage code contains \\`_test_xyz\\` methods that are invoked via doctests and discovered via a custom \\`TestSuit\\` class. In this ticket, we are proposing to replace this custom designed test discovery by using the established pytest framework https://docs.pytest.org/ (this is inline with #28936 - using mainstraim Python test infrastructure).\n+\n+Advantages of this approach:\n+- Reuse standard test infrastructure instead of a custom test discovery interface (this is a big plus as we do not have to maintain it ourself, especially given the large list of todo's in the TestSuite code)\n+- With this there also comes better error messages in case a test fails.\n+- Easier onboarding of new Python developers\n+- Clear separation of test methods vs production code. For example, the \\`test_*.py\\` files can easily be excluded from distribution.\n+- Good support by IDE (auto completion, test discovery and easier invocation). For example, VS code automatically discovers all pytest tests, provides a convenient interface to run them (all, subselection, only failed ones) and allows to directly start a debug session for a failing test. See https://code.visualstudio.com/docs/python/testing\n+- Less and clearer code (no hidden assumptions)\n+\n+Disadvantages of this approach:\n+- Current developer have to learn the new conventions (files need to be named \\`test_*.py\\` and tests methods need to start with \\`test_\\`) and pytest\n+- Tests no longer live in the same file as the code (I would say this is an advantage, but some people may prefer to have them really close together).\n+\n+In order to migrate the following changes are necessary:\n+- Move \\`_test_xyz\\` from a category \\`module\\` to new file \\`test_module\\` (e.g. \\`test_sets_cat\\`)\n+- Rewrite test using pytest (which is straightforward and more or less only amounts to removing all the custom code involving \\`self_tester\\`)\n+- Create a new test class for the parent class under test (e.g \\`test_finite_semigroups\\`)\n+- Create a static method \\`category_instances()\\` in this test class returning a list of instances to test.\n+\n+For the moment, I did this only for two test methods in \\`sets_cat\\` to illustrate the process.\n+\n+The new implementation is as follows:\n+- The test class for the category (e.g. \\`test_sets_cat\\`) defines generic tests that should pass for every object in that category.\n+- For every object in the category there is a test class (e.g. \\`test_finite_semigroups\\`) that provides instances to test via the method \\`category_instances\\`\n+- Running pytest finds the test class \\`test_finite_semigroups\\`, then determines the categories of the object and adds all generic test methods for that category to the test class (this happens in \\`conftest.py\\`).\n+- Each test method can have the parameter \\`category_instance\\` which is bound to the return value of the \\`category_instances\\` method.\n+- Thus, the output is as follows:\n+\n+\\`\\`\\`\n+sage/categories/test_finite_semigroups.py::TestFiniteSemigroup::test_element_eq_reflexive[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED [ 25%]\n+sage/categories/test_finite_semigroups.py::TestFiniteSemigroup::test_element_eq_reflexive[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED [ 50%]\n+sage/categories/test_finite_semigroups.py::TestFiniteSemigroup::test_cardinality_return_type[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED [ 75%]\n+sage/categories/test_finite_semigroups.py::TestFiniteSemigroup::test_cardinality_return_type[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED [100%]\n+\\`\\`\\`\n+\n+\n+TOOD (as follow-up tickets):\n+- Complete migration of tests to pytest\n+- After the migration is done, remove invoking the \\`TestSuite\\` in the doctests and remove the \\`TestSuite\\` class.\n+\n+---\n+\n+By default, pytest implements the following standard test discovery:\n+\n+- Search for \\`test_*.py\\` or \\`*_test.py\\` files (I would stick to the \\`test\\` prefix).\n+- From those files, collect test items:\n+   - Functions or methods with prefix \\`test\\`\n+   - If the functions are inside of classes, then the class name has to start with \\`test\\` as well.\n \n \n Author: Tobias Diez\n```\n",
    "created_at": "2021-11-28T17:11:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464464",
    "user": "https://github.com/tobiasdiez"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,52 @@
+Currently, the sage code contains \`_test_xyz\` methods that are invoked via doctests and discovered via a custom \`TestSuit\` class. In this ticket, we are proposing to replace this custom designed test discovery by using the established pytest framework https://docs.pytest.org/ (this is inline with #28936 - using mainstraim Python test infrastructure).
+
+Advantages of this approach:
+- Reuse standard test infrastructure instead of a custom test discovery interface (this is a big plus as we do not have to maintain it ourself, especially given the large list of todo's in the TestSuite code)
+- With this there also comes better error messages in case a test fails.
+- Easier onboarding of new Python developers
+- Clear separation of test methods vs production code. For example, the \`test_*.py\` files can easily be excluded from distribution.
+- Good support by IDE (auto completion, test discovery and easier invocation). For example, VS code automatically discovers all pytest tests, provides a convenient interface to run them (all, subselection, only failed ones) and allows to directly start a debug session for a failing test. See https://code.visualstudio.com/docs/python/testing
+- Less and clearer code (no hidden assumptions)
+
+Disadvantages of this approach:
+- Current developer have to learn the new conventions (files need to be named \`test_*.py\` and tests methods need to start with \`test_\`) and pytest
+- Tests no longer live in the same file as the code (I would say this is an advantage, but some people may prefer to have them really close together).
+
+In order to migrate the following changes are necessary:
+- Move \`_test_xyz\` from a category \`module\` to new file \`test_module\` (e.g. \`test_sets_cat\`)
+- Rewrite test using pytest (which is straightforward and more or less only amounts to removing all the custom code involving \`self_tester\`)
+- Create a new test class for the parent class under test (e.g \`test_finite_semigroups\`)
+- Create a static method \`category_instances()\` in this test class returning a list of instances to test.
+
+For the moment, I did this only for two test methods in \`sets_cat\` to illustrate the process.
+
+The new implementation is as follows:
+- The test class for the category (e.g. \`test_sets_cat\`) defines generic tests that should pass for every object in that category.
+- For every object in the category there is a test class (e.g. \`test_finite_semigroups\`) that provides instances to test via the method \`category_instances\`
+- Running pytest finds the test class \`test_finite_semigroups\`, then determines the categories of the object and adds all generic test methods for that category to the test class (this happens in \`conftest.py\`).
+- Each test method can have the parameter \`category_instance\` which is bound to the return value of the \`category_instances\` method.
+- Thus, the output is as follows:
+
+\`\`\`
+sage/categories/test_finite_semigroups.py::TestFiniteSemigroup::test_element_eq_reflexive[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED [ 25%]
+sage/categories/test_finite_semigroups.py::TestFiniteSemigroup::test_element_eq_reflexive[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED [ 50%]
+sage/categories/test_finite_semigroups.py::TestFiniteSemigroup::test_cardinality_return_type[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED [ 75%]
+sage/categories/test_finite_semigroups.py::TestFiniteSemigroup::test_cardinality_return_type[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED [100%]
+\`\`\`
+
+
+TOOD (as follow-up tickets):
+- Complete migration of tests to pytest
+- After the migration is done, remove invoking the \`TestSuite\` in the doctests and remove the \`TestSuite\` class.
+
+---
+
+By default, pytest implements the following standard test discovery:
+
+- Search for \`test_*.py\` or \`*_test.py\` files (I would stick to the \`test\` prefix).
+- From those files, collect test items:
+   - Functions or methods with prefix \`test\`
+   - If the functions are inside of classes, then the class name has to start with \`test\` as well.
 
 
 Author: Tobias Diez
```




---

archive/issue_comments_464465.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-11-28T17:42:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464465",
    "user": "https://github.com/tobiasdiez"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_464466.json:
```json
{
    "body": "<a id='comment:67'></a>Rebased, so ready-for-review again.",
    "created_at": "2021-11-28T17:42:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464466",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:67'></a>Rebased, so ready-for-review again.



---

archive/issue_comments_464467.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,78 @@\n+Currently, the sage code contains \\`_test_xyz\\` methods that are invoked via doctests and discovered via a custom \\`TestSuit\\` class. In this ticket, we are proposing to replace this custom designed test discovery by using the established pytest framework https://docs.pytest.org/ (this is inline with #28936 - using mainstraim Python test infrastructure).\n+\n+Advantages of this approach:\n+- Reuse standard test infrastructure instead of a custom test discovery interface (this is a big plus as we do not have to maintain it ourself, especially given the large list of todo's in the TestSuite code)\n+- With this there also comes better error messages in case a test fails.\n+- Easier onboarding of new Python developers\n+- Clear separation of test methods vs production code. For example, the \\`*_test.py\\` files can easily be excluded from distribution.\n+- Good support by IDE (auto completion, test discovery and easier invocation). For example, VS code automatically discovers all pytest tests, provides a convenient interface to run them (all, subselection, only failed ones) and allows to directly start a debug session for a failing test. See https://code.visualstudio.com/docs/python/testing\n+- Less and clearer code (no hidden assumptions)\n+\n+Disadvantages of this approach:\n+- Current developer have to learn the new conventions (files need to be named \\`*_test.py\\` and tests methods need to start with \\`test_\\`) and pytest\n+- Tests no longer live in the same file as the code (I would say this is an advantage, but some people may prefer to have them really close together).\n+\n+In order to migrate the following changes are necessary:\n+- Move \\`_test_xyz\\` from a category \\`module\\` to new file \\`<module>_test.py\\` (e.g. \\`finite_semigroups_test.py\\`)\n+- Rewrite test using pytest (which is straightforward and more or less only amounts to removing all the custom code involving \\`self_tester\\`)\n+- Create a new test class for the parent class under test (e.g \\`TestFiniteSemigroup\\`)\n+- Create a static method \\`category_instances()\\` in this test class returning a list of instances to test.\n+\n+For the moment, I did this only for two test methods in \\`sets_cat\\` to illustrate the process.\n+\n+The new implementation is as follows:\n+- The test class for the category (e.g. in \\`sets_cat_test.py\\`) defines generic tests that should pass for every object in that category. Moreover, the test class may provides instances (objects) to test via the method \\`category_instances\\`.\n+- Running pytest finds the test file \\`finite_semigroups_test.py\\`, then determines the categories of the objects (returned from \\`category_instances\\`) and adds all generic test methods for that category to the test class (this happens in \\`conftest.py\\`).\n+- Each test method can have the parameter \\`category_instance\\` which is bound to the return value of the \\`category_instances\\` method.\n+\n+Running \\`cd src && pytest --verbose\\` (from a virtual env with sage and pytest installed), the output is as follows:\n+\n+\\`\\`\\`\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_contains[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                         [  2%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_contains[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                    [  4%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_contains[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                               [  6%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_iter_list[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                        [  8%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_iter_list[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                   [ 10%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_iter_list[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                              [ 13%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_iter_cardinality[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                 [ 15%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_iter_cardinality[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                            [ 17%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_iter_cardinality[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                       [ 19%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_associativity[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                                   [ 21%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_associativity[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                              [ 23%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_associativity[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                         [ 26%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_an_element[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                                      [ 28%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_an_element[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                                 [ 30%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_an_element[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                            [ 32%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_an_element_idempotent[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                           [ 34%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_an_element_idempotent[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                      [ 36%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_an_element_idempotent[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                 [ 39%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_cardinality_return_type[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                         [ 41%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_cardinality_return_type[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                    [ 43%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_cardinality_return_type[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                               [ 45%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_construction[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                                    [ 47%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_construction[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                               [ 50%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_construction[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                          [ 52%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_element_eq_reflexive[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                            [ 54%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_element_eq_reflexive[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                       [ 56%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_element_eq_reflexive[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                  [ 58%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_eq_symmetric[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                           [ 60%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_eq_symmetric[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                      [ 63%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_eq_symmetric[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                 [ 65%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_eq_transitive[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                          [ 67%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_eq_transitive[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                     [ 69%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_eq_transitive[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                [ 71%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_neq[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                                    [ 73%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_neq[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                               [ 76%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_neq[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                          [ 78%]\n+...\n+\\`\\`\\`\n+As one can see, each general test method is invoked for the three examples.\n+\n+\n+TOOD (as follow-up tickets):\n+- Complete migration of tests to pytest\n+- After the migration is done, remove invoking the \\`TestSuite\\` in the doctests and remove the \\`TestSuite\\` class.\n+\n \n \n Author: Tobias Diez\n```\n",
    "created_at": "2021-11-28T17:42:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464467",
    "user": "https://github.com/tobiasdiez"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,78 @@
+Currently, the sage code contains \`_test_xyz\` methods that are invoked via doctests and discovered via a custom \`TestSuit\` class. In this ticket, we are proposing to replace this custom designed test discovery by using the established pytest framework https://docs.pytest.org/ (this is inline with #28936 - using mainstraim Python test infrastructure).
+
+Advantages of this approach:
+- Reuse standard test infrastructure instead of a custom test discovery interface (this is a big plus as we do not have to maintain it ourself, especially given the large list of todo's in the TestSuite code)
+- With this there also comes better error messages in case a test fails.
+- Easier onboarding of new Python developers
+- Clear separation of test methods vs production code. For example, the \`*_test.py\` files can easily be excluded from distribution.
+- Good support by IDE (auto completion, test discovery and easier invocation). For example, VS code automatically discovers all pytest tests, provides a convenient interface to run them (all, subselection, only failed ones) and allows to directly start a debug session for a failing test. See https://code.visualstudio.com/docs/python/testing
+- Less and clearer code (no hidden assumptions)
+
+Disadvantages of this approach:
+- Current developer have to learn the new conventions (files need to be named \`*_test.py\` and tests methods need to start with \`test_\`) and pytest
+- Tests no longer live in the same file as the code (I would say this is an advantage, but some people may prefer to have them really close together).
+
+In order to migrate the following changes are necessary:
+- Move \`_test_xyz\` from a category \`module\` to new file \`<module>_test.py\` (e.g. \`finite_semigroups_test.py\`)
+- Rewrite test using pytest (which is straightforward and more or less only amounts to removing all the custom code involving \`self_tester\`)
+- Create a new test class for the parent class under test (e.g \`TestFiniteSemigroup\`)
+- Create a static method \`category_instances()\` in this test class returning a list of instances to test.
+
+For the moment, I did this only for two test methods in \`sets_cat\` to illustrate the process.
+
+The new implementation is as follows:
+- The test class for the category (e.g. in \`sets_cat_test.py\`) defines generic tests that should pass for every object in that category. Moreover, the test class may provides instances (objects) to test via the method \`category_instances\`.
+- Running pytest finds the test file \`finite_semigroups_test.py\`, then determines the categories of the objects (returned from \`category_instances\`) and adds all generic test methods for that category to the test class (this happens in \`conftest.py\`).
+- Each test method can have the parameter \`category_instance\` which is bound to the return value of the \`category_instances\` method.
+
+Running \`cd src && pytest --verbose\` (from a virtual env with sage and pytest installed), the output is as follows:
+
+\`\`\`
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_contains[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                         [  2%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_contains[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                    [  4%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_contains[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                               [  6%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_iter_list[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                        [  8%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_iter_list[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                   [ 10%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_iter_list[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                              [ 13%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_iter_cardinality[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                 [ 15%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_iter_cardinality[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                            [ 17%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_iter_cardinality[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                       [ 19%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_associativity[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                                   [ 21%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_associativity[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                              [ 23%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_associativity[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                         [ 26%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_an_element[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                                      [ 28%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_an_element[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                                 [ 30%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_an_element[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                            [ 32%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_an_element_idempotent[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                           [ 34%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_an_element_idempotent[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                      [ 36%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_an_element_idempotent[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                 [ 39%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_cardinality_return_type[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                         [ 41%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_cardinality_return_type[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                    [ 43%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_cardinality_return_type[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                               [ 45%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_construction[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                                    [ 47%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_construction[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                               [ 50%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_construction[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                          [ 52%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_element_eq_reflexive[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                            [ 54%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_element_eq_reflexive[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                       [ 56%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_element_eq_reflexive[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                  [ 58%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_eq_symmetric[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                           [ 60%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_eq_symmetric[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                      [ 63%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_eq_symmetric[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                 [ 65%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_eq_transitive[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                          [ 67%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_eq_transitive[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                     [ 69%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_eq_transitive[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                [ 71%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_neq[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                                    [ 73%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_neq[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                               [ 76%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_neq[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                          [ 78%]
+...
+\`\`\`
+As one can see, each general test method is invoked for the three examples.
+
+
+TOOD (as follow-up tickets):
+- Complete migration of tests to pytest
+- After the migration is done, remove invoking the \`TestSuite\` in the doctests and remove the \`TestSuite\` class.
+
 
 
 Author: Tobias Diez
```




---

archive/issue_comments_464468.json:
```json
{
    "body": "<a id='comment:68'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-11-28T17:42:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464468",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:68'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_464469.json:
```json
{
    "body": "<a id='comment:69'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-11-28T17:46:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464469",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:69'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_464470.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,78 @@\n+Currently, the sage code contains \\`_test_xyz\\` methods that are invoked via doctests and discovered via a custom \\`TestSuit\\` class. In this ticket, we are proposing to replace this custom designed test discovery by using the established pytest framework https://docs.pytest.org/ (this is inline with #28936 - using mainstraim Python test infrastructure).\n+\n+Advantages of this approach:\n+- Reuse standard test infrastructure instead of a custom test discovery interface (this is a big plus as we do not have to maintain it ourself, especially given the large list of todo's in the TestSuite code)\n+- With this there also comes better error messages in case a test fails.\n+- Easier onboarding of new Python developers\n+- Clear separation of test methods vs production code. For example, the \\`*_test.py\\` files can easily be excluded from distribution.\n+- Good support by IDE (auto completion, test discovery and easier invocation). For example, VS code automatically discovers all pytest tests, provides a convenient interface to run them (all, subselection, only failed ones) and allows to directly start a debug session for a failing test. See https://code.visualstudio.com/docs/python/testing\n+- Less and clearer code (no hidden assumptions)\n+\n+Disadvantages of this approach:\n+- Current developer have to learn the new conventions (files need to be named \\`*_test.py\\` and tests methods need to start with \\`test_\\`) and pytest\n+- Tests no longer live in the same file as the code (I would say this is an advantage, but some people may prefer to have them really close together).\n+\n+In order to migrate the following changes are necessary:\n+- Move \\`_test_xyz\\` from a category \\`module\\` to new file \\`<module>_test.py\\` (e.g. \\`finite_semigroups_test.py\\`)\n+- Rewrite test using pytest (which is straightforward and more or less only amounts to removing all the custom code involving \\`self_tester\\`)\n+- Create a new test class for the parent class under test (e.g \\`TestFiniteSemigroup\\`)\n+- Create a static method \\`category_instances()\\` in this test class returning a list of instances to test.\n+\n+For the moment, I did this only for a few test methods in \\`sets_cat\\` using finite semigroups as example to illustrate the process.\n+\n+The new implementation is as follows:\n+- The test class for the category (e.g. in \\`sets_cat_test.py\\`) defines generic tests that should pass for every object in that category. Moreover, the test class may provides instances (objects) to test via the method \\`category_instances\\`.\n+- Running pytest finds the test file \\`finite_semigroups_test.py\\`, then determines the categories of the objects (returned from \\`category_instances\\`) and adds all generic test methods for that category to the test class (this happens in \\`conftest.py\\`).\n+- Each test method can have the parameter \\`category_instance\\` which is bound to the return value of the \\`category_instances\\` method.\n+\n+Running \\`cd src && pytest --verbose\\` (from a virtual env with sage and pytest installed), the output is as follows:\n+\n+\\`\\`\\`\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_contains[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                         [  2%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_contains[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                    [  4%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_contains[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                               [  6%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_iter_list[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                        [  8%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_iter_list[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                   [ 10%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_iter_list[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                              [ 13%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_iter_cardinality[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                 [ 15%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_iter_cardinality[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                            [ 17%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_iter_cardinality[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                       [ 19%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_associativity[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                                   [ 21%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_associativity[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                              [ 23%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_associativity[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                         [ 26%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_an_element[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                                      [ 28%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_an_element[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                                 [ 30%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_an_element[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                            [ 32%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_an_element_idempotent[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                           [ 34%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_an_element_idempotent[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                      [ 36%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_an_element_idempotent[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                 [ 39%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_cardinality_return_type[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                         [ 41%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_cardinality_return_type[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                    [ 43%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_cardinality_return_type[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                               [ 45%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_construction[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                                    [ 47%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_construction[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                               [ 50%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_construction[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                          [ 52%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_element_eq_reflexive[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                            [ 54%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_element_eq_reflexive[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                       [ 56%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_element_eq_reflexive[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                  [ 58%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_eq_symmetric[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                           [ 60%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_eq_symmetric[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                      [ 63%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_eq_symmetric[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                 [ 65%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_eq_transitive[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                          [ 67%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_eq_transitive[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                     [ 69%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_eq_transitive[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                [ 71%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_neq[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                                    [ 73%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_neq[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                               [ 76%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_neq[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                          [ 78%]\n+...\n+\\`\\`\\`\n+As one can see, each general test method is invoked for the three examples.\n+\n+\n+TOOD (as follow-up tickets):\n+- Complete migration of tests to pytest\n+- After the migration is done, remove invoking the \\`TestSuite\\` in the doctests and remove the \\`TestSuite\\` class.\n+\n \n \n Author: Tobias Diez\n```\n",
    "created_at": "2021-11-28T17:47:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464470",
    "user": "https://github.com/tobiasdiez"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,78 @@
+Currently, the sage code contains \`_test_xyz\` methods that are invoked via doctests and discovered via a custom \`TestSuit\` class. In this ticket, we are proposing to replace this custom designed test discovery by using the established pytest framework https://docs.pytest.org/ (this is inline with #28936 - using mainstraim Python test infrastructure).
+
+Advantages of this approach:
+- Reuse standard test infrastructure instead of a custom test discovery interface (this is a big plus as we do not have to maintain it ourself, especially given the large list of todo's in the TestSuite code)
+- With this there also comes better error messages in case a test fails.
+- Easier onboarding of new Python developers
+- Clear separation of test methods vs production code. For example, the \`*_test.py\` files can easily be excluded from distribution.
+- Good support by IDE (auto completion, test discovery and easier invocation). For example, VS code automatically discovers all pytest tests, provides a convenient interface to run them (all, subselection, only failed ones) and allows to directly start a debug session for a failing test. See https://code.visualstudio.com/docs/python/testing
+- Less and clearer code (no hidden assumptions)
+
+Disadvantages of this approach:
+- Current developer have to learn the new conventions (files need to be named \`*_test.py\` and tests methods need to start with \`test_\`) and pytest
+- Tests no longer live in the same file as the code (I would say this is an advantage, but some people may prefer to have them really close together).
+
+In order to migrate the following changes are necessary:
+- Move \`_test_xyz\` from a category \`module\` to new file \`<module>_test.py\` (e.g. \`finite_semigroups_test.py\`)
+- Rewrite test using pytest (which is straightforward and more or less only amounts to removing all the custom code involving \`self_tester\`)
+- Create a new test class for the parent class under test (e.g \`TestFiniteSemigroup\`)
+- Create a static method \`category_instances()\` in this test class returning a list of instances to test.
+
+For the moment, I did this only for a few test methods in \`sets_cat\` using finite semigroups as example to illustrate the process.
+
+The new implementation is as follows:
+- The test class for the category (e.g. in \`sets_cat_test.py\`) defines generic tests that should pass for every object in that category. Moreover, the test class may provides instances (objects) to test via the method \`category_instances\`.
+- Running pytest finds the test file \`finite_semigroups_test.py\`, then determines the categories of the objects (returned from \`category_instances\`) and adds all generic test methods for that category to the test class (this happens in \`conftest.py\`).
+- Each test method can have the parameter \`category_instance\` which is bound to the return value of the \`category_instances\` method.
+
+Running \`cd src && pytest --verbose\` (from a virtual env with sage and pytest installed), the output is as follows:
+
+\`\`\`
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_contains[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                         [  2%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_contains[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                    [  4%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_contains[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                               [  6%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_iter_list[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                        [  8%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_iter_list[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                   [ 10%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_iter_list[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                              [ 13%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_iter_cardinality[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                 [ 15%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_iter_cardinality[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                            [ 17%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_iter_cardinality[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                       [ 19%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_associativity[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                                   [ 21%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_associativity[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                              [ 23%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_associativity[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                         [ 26%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_an_element[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                                      [ 28%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_an_element[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                                 [ 30%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_an_element[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                            [ 32%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_an_element_idempotent[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                           [ 34%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_an_element_idempotent[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                      [ 36%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_an_element_idempotent[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                 [ 39%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_cardinality_return_type[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                         [ 41%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_cardinality_return_type[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                    [ 43%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_cardinality_return_type[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                               [ 45%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_construction[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                                    [ 47%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_construction[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                               [ 50%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_construction[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                          [ 52%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_element_eq_reflexive[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                            [ 54%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_element_eq_reflexive[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                       [ 56%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_element_eq_reflexive[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                  [ 58%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_eq_symmetric[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                           [ 60%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_eq_symmetric[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                      [ 63%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_eq_symmetric[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                 [ 65%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_eq_transitive[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                          [ 67%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_eq_transitive[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                     [ 69%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_eq_transitive[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                [ 71%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_neq[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                                    [ 73%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_neq[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                               [ 76%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_neq[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                          [ 78%]
+...
+\`\`\`
+As one can see, each general test method is invoked for the three examples.
+
+
+TOOD (as follow-up tickets):
+- Complete migration of tests to pytest
+- After the migration is done, remove invoking the \`TestSuite\` in the doctests and remove the \`TestSuite\` class.
+
 
 
 Author: Tobias Diez
```




---

archive/issue_comments_464471.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,78 @@\n+Currently, Sage code contains \\`_test_xyz\\` methods that are invoked via doctests and discovered via a custom \\`TestSuite\\` class. This ticket is to replace this custom test discovery by the use of the established **pytest** framework https://docs.pytest.org/ (this is in line with #28936 - using mainstream Python test infrastructure).\n+\n+Advantages of this approach:\n+- Reuse standard test infrastructure instead of a custom test discovery interface (this is a big maintenance relief, especially given the large list of todos in the \\`TestSuite\\` code).\n+- Better error messages in case a test fails.\n+- Easier onboarding of new Python developers.\n+- Clear separation of test methods vs production code. For example, the \\`*_test.py\\` files can easily be excluded from distribution.\n+- Good support by IDEs (auto completion, test discovery and easier invocation). For example, VSCode automatically discovers all pytest tests, provides a convenient interface to run them (all, a selection, only failed ones) and allows to directly start a debug session for a failing test. See https://code.visualstudio.com/docs/python/testing\n+- Less and clearer code (no hidden assumptions).\n+\n+Disadvantages of this approach:\n+- Current developers have to learn pytest and its conventions (files must be named \\`*_test.py\\` and test methods must start with \\`test_\\`).\n+- Tests no longer live in the same file as the code (I would call this an advantage, but some people may prefer to have them really close together).\n+\n+In order to migrate, the following changes are necessary:\n+- Move \\`_test_xyz\\` from a category \\`module\\` to new file \\`<module>_test.py\\` (e.g. \\`finite_semigroups_test.py\\`).\n+- Rewrite tests using pytest (which is straightforward and more or less only amounts to removing all the custom code involving \\`self_tester\\`).\n+- Create a new test class for the parent class under test (e.g \\`TestFiniteSemigroup\\`).\n+- Create a static method \\`category_instances()\\` in this test class returning a list of instances to test.\n+\n+For the moment, I did this only for a few test methods in \\`sets_cat\\` using finite semigroups as example to illustrate the process.\n+\n+The new implementation is as follows:\n+- The test class for the category (e.g. in \\`sets_cat_test.py\\`) defines generic tests that should pass for every object in that category. Moreover, the test class may provides instances (objects) to test via the method \\`category_instances\\`.\n+- Running pytest finds the test file \\`finite_semigroups_test.py\\`, then determines the categories of the objects (returned from \\`category_instances\\`) and adds all generic test methods for that category to the test class (this happens in \\`conftest.py\\`).\n+- Each test method can have the parameter \\`category_instance\\` which is bound to the return value of the \\`category_instances\\` method.\n+\n+Running \\`cd src && pytest --verbose\\` (from a virtual env with sage and pytest installed), the output is as follows:\n+\n+\\`\\`\\`\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_contains[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                         [  2%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_contains[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                    [  4%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_contains[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                               [  6%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_iter_list[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                        [  8%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_iter_list[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                   [ 10%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_iter_list[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                              [ 13%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_iter_cardinality[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                 [ 15%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_iter_cardinality[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                            [ 17%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_iter_cardinality[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                       [ 19%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_associativity[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                                   [ 21%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_associativity[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                              [ 23%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_associativity[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                         [ 26%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_an_element[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                                      [ 28%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_an_element[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                                 [ 30%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_an_element[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                            [ 32%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_an_element_idempotent[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                           [ 34%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_an_element_idempotent[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                      [ 36%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_an_element_idempotent[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                 [ 39%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_cardinality_return_type[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                         [ 41%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_cardinality_return_type[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                    [ 43%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_cardinality_return_type[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                               [ 45%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_construction[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                                    [ 47%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_construction[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                               [ 50%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_construction[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                          [ 52%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_element_eq_reflexive[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                            [ 54%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_element_eq_reflexive[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                       [ 56%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_element_eq_reflexive[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                  [ 58%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_eq_symmetric[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                           [ 60%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_eq_symmetric[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                      [ 63%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_eq_symmetric[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                 [ 65%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_eq_transitive[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                          [ 67%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_eq_transitive[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                     [ 69%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_eq_transitive[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                [ 71%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_neq[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                                    [ 73%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_neq[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                               [ 76%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_neq[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                          [ 78%]\n+...\n+\\`\\`\\`\n+As one can see, each general test method is invoked for the three examples.\n+\n+\n+TODO (in follow-up tickets):\n+- Complete migration to pytest.\n+- Once that is done, stop invoking \\`TestSuite\\` in doctests and remove the \\`TestSuite\\` class.\n+\n \n \n Author: Tobias Diez\n```\n",
    "created_at": "2021-12-09T23:10:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464471",
    "user": "https://github.com/slel"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,78 @@
+Currently, Sage code contains \`_test_xyz\` methods that are invoked via doctests and discovered via a custom \`TestSuite\` class. This ticket is to replace this custom test discovery by the use of the established **pytest** framework https://docs.pytest.org/ (this is in line with #28936 - using mainstream Python test infrastructure).
+
+Advantages of this approach:
+- Reuse standard test infrastructure instead of a custom test discovery interface (this is a big maintenance relief, especially given the large list of todos in the \`TestSuite\` code).
+- Better error messages in case a test fails.
+- Easier onboarding of new Python developers.
+- Clear separation of test methods vs production code. For example, the \`*_test.py\` files can easily be excluded from distribution.
+- Good support by IDEs (auto completion, test discovery and easier invocation). For example, VSCode automatically discovers all pytest tests, provides a convenient interface to run them (all, a selection, only failed ones) and allows to directly start a debug session for a failing test. See https://code.visualstudio.com/docs/python/testing
+- Less and clearer code (no hidden assumptions).
+
+Disadvantages of this approach:
+- Current developers have to learn pytest and its conventions (files must be named \`*_test.py\` and test methods must start with \`test_\`).
+- Tests no longer live in the same file as the code (I would call this an advantage, but some people may prefer to have them really close together).
+
+In order to migrate, the following changes are necessary:
+- Move \`_test_xyz\` from a category \`module\` to new file \`<module>_test.py\` (e.g. \`finite_semigroups_test.py\`).
+- Rewrite tests using pytest (which is straightforward and more or less only amounts to removing all the custom code involving \`self_tester\`).
+- Create a new test class for the parent class under test (e.g \`TestFiniteSemigroup\`).
+- Create a static method \`category_instances()\` in this test class returning a list of instances to test.
+
+For the moment, I did this only for a few test methods in \`sets_cat\` using finite semigroups as example to illustrate the process.
+
+The new implementation is as follows:
+- The test class for the category (e.g. in \`sets_cat_test.py\`) defines generic tests that should pass for every object in that category. Moreover, the test class may provides instances (objects) to test via the method \`category_instances\`.
+- Running pytest finds the test file \`finite_semigroups_test.py\`, then determines the categories of the objects (returned from \`category_instances\`) and adds all generic test methods for that category to the test class (this happens in \`conftest.py\`).
+- Each test method can have the parameter \`category_instance\` which is bound to the return value of the \`category_instances\` method.
+
+Running \`cd src && pytest --verbose\` (from a virtual env with sage and pytest installed), the output is as follows:
+
+\`\`\`
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_contains[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                         [  2%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_contains[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                    [  4%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_contains[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                               [  6%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_iter_list[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                        [  8%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_iter_list[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                   [ 10%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_iter_list[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                              [ 13%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_iter_cardinality[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                 [ 15%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_iter_cardinality[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                            [ 17%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_iter_cardinality[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                       [ 19%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_associativity[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                                   [ 21%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_associativity[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                              [ 23%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_associativity[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                         [ 26%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_an_element[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                                      [ 28%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_an_element[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                                 [ 30%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_an_element[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                            [ 32%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_an_element_idempotent[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                           [ 34%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_an_element_idempotent[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                      [ 36%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_an_element_idempotent[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                 [ 39%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_cardinality_return_type[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                         [ 41%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_cardinality_return_type[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                    [ 43%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_cardinality_return_type[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                               [ 45%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_construction[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                                    [ 47%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_construction[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                               [ 50%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_construction[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                          [ 52%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_element_eq_reflexive[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                            [ 54%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_element_eq_reflexive[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                       [ 56%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_element_eq_reflexive[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                  [ 58%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_eq_symmetric[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                           [ 60%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_eq_symmetric[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                      [ 63%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_eq_symmetric[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                 [ 65%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_eq_transitive[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                          [ 67%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_eq_transitive[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                     [ 69%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_eq_transitive[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                [ 71%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_neq[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                                    [ 73%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_neq[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                               [ 76%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_neq[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                          [ 78%]
+...
+\`\`\`
+As one can see, each general test method is invoked for the three examples.
+
+
+TODO (in follow-up tickets):
+- Complete migration to pytest.
+- Once that is done, stop invoking \`TestSuite\` in doctests and remove the \`TestSuite\` class.
+
 
 
 Author: Tobias Diez
```




---

archive/issue_comments_464472.json:
```json
{
    "body": "Changing keywords from \"\" to \"testsuite\".",
    "created_at": "2021-12-09T23:10:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464472",
    "user": "https://github.com/slel"
}
```

Changing keywords from "" to "testsuite".



---

archive/issue_events_080107.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-21T17:52:16Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30738#event-80107"
}
```



---

archive/issue_events_080108.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-21T17:52:16Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30738#event-80108"
}
```



---

archive/issue_events_080109.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-02-23T18:03:59Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30738#event-80109"
}
```



---

archive/issue_events_080110.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-02-23T18:03:59Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "milestone": "sage-pending",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30738#event-80110"
}
```



---

archive/issue_comments_464473.json:
```json
{
    "body": "<a id='comment:74'></a>Why did you change the milestone? I don't see anything that would prevent this being merged soon (except for the missing review).",
    "created_at": "2022-02-23T21:54:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464473",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:74'></a>Why did you change the milestone? I don't see anything that would prevent this being merged soon (except for the missing review).



---

archive/issue_comments_464474.json:
```json
{
    "body": "<a id='comment:75'></a>There's been no activity, and it's not clear if there are any developers who would be interested in rewriting the entirety of our test suite.",
    "created_at": "2022-02-23T23:50:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464474",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:75'></a>There's been no activity, and it's not clear if there are any developers who would be interested in rewriting the entirety of our test suite.



---

archive/issue_events_080111.json:
```json
{
    "actor": "https://github.com/tobiasdiez",
    "created_at": "2022-03-20T17:22:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "milestone": "sage-pending",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30738#event-80111"
}
```



---

archive/issue_events_080112.json:
```json
{
    "actor": "https://github.com/tobiasdiez",
    "created_at": "2022-03-20T17:22:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30738#event-80112"
}
```



---

archive/issue_comments_464475.json:
```json
{
    "body": "<a id='comment:76'></a>While being a relatively huge project, I think, a completely migration can be done in a relatively straightforward way with an overseeable time investment. I would definitely up for doing this alone if necessary. So I'm appreciate if this ticket could be reviewed soon. Thanks!",
    "created_at": "2022-03-20T17:22:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464475",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:76'></a>While being a relatively huge project, I think, a completely migration can be done in a relatively straightforward way with an overseeable time investment. I would definitely up for doing this alone if necessary. So I'm appreciate if this ticket could be reviewed soon. Thanks!



---

archive/issue_comments_464476.json:
```json
{
    "body": "<a id='comment:77'></a>You have received review comments: comment:45, comment:48, etc.",
    "created_at": "2022-03-21T23:52:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464476",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:77'></a>You have received review comments: comment:45, comment:48, etc.



---

archive/issue_comments_464477.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,80 @@\n+Currently, Sage code contains \\`_test_xyz\\` methods that are invoked via doctests and discovered via a custom \\`TestSuite\\` class. This ticket is to replace this custom test discovery by the use of the established **pytest** framework https://docs.pytest.org/ (this is in line with #28936 - using mainstream Python test infrastructure).\n+\n+Advantages of this approach:\n+- Reuse standard test infrastructure instead of a custom test discovery interface (this is a big maintenance relief, especially given the large list of todos in the \\`TestSuite\\` code).\n+- Better error messages in case a test fails.\n+- Easier onboarding of new Python developers.\n+- Clear separation of test methods vs production code. For example, the \\`*_test.py\\` files can easily be excluded from distribution.\n+- Good support by IDEs (auto completion, test discovery and easier invocation). For example, VSCode automatically discovers all pytest tests, provides a convenient interface to run them (all, a selection, only failed ones) and allows to directly start a debug session for a failing test. See https://code.visualstudio.com/docs/python/testing\n+- Less and clearer code (no hidden assumptions).\n+\n+Disadvantages of this approach:\n+- Current developers have to learn pytest and its conventions (files must be named \\`*_test.py\\` and test methods must start with \\`test_\\`).\n+- Tests no longer live in the same file as the code (I would call this an advantage, but some people may prefer to have them really close together).\n+\n+In order to migrate, the following changes are necessary:\n+- Move \\`_test_xyz\\` from a category \\`module\\` to new file \\`<module>_test.py\\` (e.g. \\`finite_semigroups_test.py\\`).\n+- Rewrite tests using pytest (which is straightforward and more or less only amounts to removing all the custom code involving \\`self_tester\\`).\n+- Create a new test class for the parent class under test (e.g \\`TestFiniteSemigroup\\`).\n+- Create a static method \\`category_instances()\\` in this test class returning a list of instances to test.\n+\n+For the moment, I did this only for a few test methods in \\`sets_cat\\` using finite semigroups as example to illustrate the process.\n+\n+The new implementation is as follows:\n+- The test class for the category (e.g. in \\`sets_cat_test.py\\`) defines generic tests that should pass for every object in that category. Moreover, the test class may provides instances (objects) to test via the method \\`category_instances\\`.\n+- Running pytest finds the test file \\`finite_semigroups_test.py\\`, then determines the categories of the objects (returned from \\`category_instances\\`) and adds all generic test methods for that category to the test class (this happens in \\`conftest.py\\`).\n+- Each test method can have the parameter \\`category_instance\\` which is bound to the return value of the \\`category_instances\\` method.\n+\n+Running \\`cd src && pytest --verbose\\` (from a virtual env with sage and pytest installed), the output is as follows:\n+\n+\\`\\`\\`\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_contains[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                         [  2%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_contains[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                    [  4%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_contains[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                               [  6%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_iter_list[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                        [  8%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_iter_list[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                   [ 10%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_iter_list[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                              [ 13%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_iter_cardinality[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                 [ 15%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_iter_cardinality[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                            [ 17%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_iter_cardinality[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                       [ 19%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_associativity[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                                   [ 21%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_associativity[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                              [ 23%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_associativity[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                         [ 26%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_an_element[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                                      [ 28%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_an_element[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                                 [ 30%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_an_element[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                            [ 32%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_an_element_idempotent[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                           [ 34%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_an_element_idempotent[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                      [ 36%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_an_element_idempotent[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                 [ 39%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_cardinality_return_type[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                         [ 41%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_cardinality_return_type[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                    [ 43%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_cardinality_return_type[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                               [ 45%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_construction[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                                    [ 47%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_construction[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                               [ 50%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_construction[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                          [ 52%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_element_eq_reflexive[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                            [ 54%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_element_eq_reflexive[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                       [ 56%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_element_eq_reflexive[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                  [ 58%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_eq_symmetric[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                           [ 60%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_eq_symmetric[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                      [ 63%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_eq_symmetric[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                 [ 65%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_eq_transitive[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                          [ 67%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_eq_transitive[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                     [ 69%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_eq_transitive[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                [ 71%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_neq[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                                    [ 73%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_neq[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                               [ 76%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_neq[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                          [ 78%]\n+...\n+\\`\\`\\`\n+As one can see, each general test method is invoked for the three examples.\n+\n+\n+TODO (in follow-up tickets):\n+- Complete migration to pytest.\n+- Once that is done, stop invoking \\`TestSuite\\` in doctests and remove the \\`TestSuite\\` class.\n+\n+See also:\n+- #33546 Replace custom Sage doctest discovery by pytest (using pytest_collect_file)\n \n \n Author: Tobias Diez\n```\n",
    "created_at": "2022-03-21T23:59:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464477",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,80 @@
+Currently, Sage code contains \`_test_xyz\` methods that are invoked via doctests and discovered via a custom \`TestSuite\` class. This ticket is to replace this custom test discovery by the use of the established **pytest** framework https://docs.pytest.org/ (this is in line with #28936 - using mainstream Python test infrastructure).
+
+Advantages of this approach:
+- Reuse standard test infrastructure instead of a custom test discovery interface (this is a big maintenance relief, especially given the large list of todos in the \`TestSuite\` code).
+- Better error messages in case a test fails.
+- Easier onboarding of new Python developers.
+- Clear separation of test methods vs production code. For example, the \`*_test.py\` files can easily be excluded from distribution.
+- Good support by IDEs (auto completion, test discovery and easier invocation). For example, VSCode automatically discovers all pytest tests, provides a convenient interface to run them (all, a selection, only failed ones) and allows to directly start a debug session for a failing test. See https://code.visualstudio.com/docs/python/testing
+- Less and clearer code (no hidden assumptions).
+
+Disadvantages of this approach:
+- Current developers have to learn pytest and its conventions (files must be named \`*_test.py\` and test methods must start with \`test_\`).
+- Tests no longer live in the same file as the code (I would call this an advantage, but some people may prefer to have them really close together).
+
+In order to migrate, the following changes are necessary:
+- Move \`_test_xyz\` from a category \`module\` to new file \`<module>_test.py\` (e.g. \`finite_semigroups_test.py\`).
+- Rewrite tests using pytest (which is straightforward and more or less only amounts to removing all the custom code involving \`self_tester\`).
+- Create a new test class for the parent class under test (e.g \`TestFiniteSemigroup\`).
+- Create a static method \`category_instances()\` in this test class returning a list of instances to test.
+
+For the moment, I did this only for a few test methods in \`sets_cat\` using finite semigroups as example to illustrate the process.
+
+The new implementation is as follows:
+- The test class for the category (e.g. in \`sets_cat_test.py\`) defines generic tests that should pass for every object in that category. Moreover, the test class may provides instances (objects) to test via the method \`category_instances\`.
+- Running pytest finds the test file \`finite_semigroups_test.py\`, then determines the categories of the objects (returned from \`category_instances\`) and adds all generic test methods for that category to the test class (this happens in \`conftest.py\`).
+- Each test method can have the parameter \`category_instance\` which is bound to the return value of the \`category_instances\` method.
+
+Running \`cd src && pytest --verbose\` (from a virtual env with sage and pytest installed), the output is as follows:
+
+\`\`\`
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_contains[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                         [  2%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_contains[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                    [  4%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_contains[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                               [  6%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_iter_list[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                        [  8%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_iter_list[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                   [ 10%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_iter_list[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                              [ 13%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_iter_cardinality[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                 [ 15%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_iter_cardinality[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                            [ 17%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_iter_cardinality[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                       [ 19%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_associativity[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                                   [ 21%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_associativity[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                              [ 23%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_associativity[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                         [ 26%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_an_element[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                                      [ 28%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_an_element[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                                 [ 30%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_an_element[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                            [ 32%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_an_element_idempotent[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                           [ 34%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_an_element_idempotent[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                      [ 36%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_an_element_idempotent[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                 [ 39%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_cardinality_return_type[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                         [ 41%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_cardinality_return_type[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                    [ 43%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_cardinality_return_type[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                               [ 45%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_construction[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                                    [ 47%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_construction[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                               [ 50%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_construction[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                          [ 52%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_element_eq_reflexive[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                            [ 54%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_element_eq_reflexive[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                       [ 56%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_element_eq_reflexive[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                  [ 58%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_eq_symmetric[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                           [ 60%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_eq_symmetric[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                      [ 63%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_eq_symmetric[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                 [ 65%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_eq_transitive[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                          [ 67%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_eq_transitive[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                     [ 69%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_eq_transitive[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                [ 71%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_neq[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                                    [ 73%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_neq[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                               [ 76%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_neq[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                          [ 78%]
+...
+\`\`\`
+As one can see, each general test method is invoked for the three examples.
+
+
+TODO (in follow-up tickets):
+- Complete migration to pytest.
+- Once that is done, stop invoking \`TestSuite\` in doctests and remove the \`TestSuite\` class.
+
+See also:
+- #33546 Replace custom Sage doctest discovery by pytest (using pytest_collect_file)
 
 
 Author: Tobias Diez
```




---

archive/issue_comments_464478.json:
```json
{
    "body": "<a id='comment:79'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-29T12:51:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464478",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:79'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_464479.json:
```json
{
    "body": "<a id='comment:80'></a>Replying to [comment:77 mkoeppe]:\n> You have received review comments: comment:45, comment:48, etc. \n> \n\n\nI've fixed comment:45. To comment:48 I've already reacted in comment:49.",
    "created_at": "2022-03-29T13:13:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464479",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:80'></a>Replying to [comment:77 mkoeppe]:
> You have received review comments: comment:45, comment:48, etc. 
> 


I've fixed comment:45. To comment:48 I've already reacted in comment:49.



---

archive/issue_comments_464480.json:
```json
{
    "body": "<a id='comment:81'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-04-08T21:28:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30738#issuecomment-464480",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:81'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_events_080113.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-11T17:19:39Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30738#event-80113"
}
```



---

archive/issue_events_080114.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-11T17:19:39Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30738#event-80114"
}
```



---

archive/issue_events_080115.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30738#event-80115"
}
```



---

archive/issue_events_080116.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30738",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30738#event-80116"
}
```
