# Issue 30738: Replace custom Sage unit test discovery by pytest

archive/issues_030501.json:
```json
{
    "assignees": [],
    "body": "Currently, Sage code contains `_test_xyz` methods that are invoked via doctests and discovered via a custom `TestSuite` class. This ticket is to replace this custom test discovery by the use of the established **pytest** framework https://docs.pytest.org/ (this is in line with #28936 - using mainstream Python test infrastructure).\n\nAdvantages of this approach:\n- Reuse standard test infrastructure instead of a custom test discovery interface (this is a big maintenance relief, especially given the large list of todos in the `TestSuite` code).\n- Better error messages in case a test fails.\n- Easier onboarding of new Python developers.\n- Clear separation of test methods vs production code. For example, the `*_test.py` files can easily be excluded from distribution.\n- Good support by IDEs (auto completion, test discovery and easier invocation). For example, VSCode automatically discovers all pytest tests, provides a convenient interface to run them (all, a selection, only failed ones) and allows to directly start a debug session for a failing test. See https://code.visualstudio.com/docs/python/testing\n- Less and clearer code (no hidden assumptions).\n\nDisadvantages of this approach:\n- Current developers have to learn pytest and its conventions (files must be named `*_test.py` and test methods must start with `test_`).\n- Tests no longer live in the same file as the code (I would call this an advantage, but some people may prefer to have them really close together).\n\nIn order to migrate, the following changes are necessary:\n- Move `_test_xyz` from a category `module` to new file `<module>_test.py` (e.g. `finite_semigroups_test.py`).\n- Rewrite tests using pytest (which is straightforward and more or less only amounts to removing all the custom code involving `self_tester`).\n- Create a new test class for the parent class under test (e.g `TestFiniteSemigroup`).\n- Create a static method `category_instances()` in this test class returning a list of instances to test.\n\nFor the moment, I did this only for a few test methods in `sets_cat` using finite semigroups as example to illustrate the process.\n\nThe new implementation is as follows:\n- The test class for the category (e.g. in `sets_cat_test.py`) defines generic tests that should pass for every object in that category. Moreover, the test class may provides instances (objects) to test via the method `category_instances`.\n- Running pytest finds the test file `finite_semigroups_test.py`, then determines the categories of the objects (returned from `category_instances`) and adds all generic test methods for that category to the test class (this happens in `conftest.py`).\n- Each test method can have the parameter `category_instance` which is bound to the return value of the `category_instances` method.\n\nRunning `cd src && pytest --verbose` (from a virtual env with sage and pytest installed), the output is as follows:\n\n```\nsage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_contains[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                         [  2%]\nsage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_contains[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                    [  4%]\nsage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_contains[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                               [  6%]\nsage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_iter_list[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                        [  8%]\nsage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_iter_list[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                   [ 10%]\nsage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_iter_list[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                              [ 13%]\nsage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_iter_cardinality[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                 [ 15%]\nsage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_iter_cardinality[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                            [ 17%]\nsage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_iter_cardinality[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                       [ 19%]\nsage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_associativity[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                                   [ 21%]\nsage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_associativity[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                              [ 23%]\nsage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_associativity[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                         [ 26%]\nsage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_an_element[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                                      [ 28%]\nsage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_an_element[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                                 [ 30%]\nsage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_an_element[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                            [ 32%]\nsage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_an_element_idempotent[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                           [ 34%]\nsage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_an_element_idempotent[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                      [ 36%]\nsage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_an_element_idempotent[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                 [ 39%]\nsage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_cardinality_return_type[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                         [ 41%]\nsage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_cardinality_return_type[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                    [ 43%]\nsage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_cardinality_return_type[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                               [ 45%]\nsage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_construction[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                                    [ 47%]\nsage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_construction[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                               [ 50%]\nsage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_construction[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                          [ 52%]\nsage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_element_eq_reflexive[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                            [ 54%]\nsage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_element_eq_reflexive[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                       [ 56%]\nsage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_element_eq_reflexive[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                  [ 58%]\nsage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_eq_symmetric[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                           [ 60%]\nsage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_eq_symmetric[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                      [ 63%]\nsage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_eq_symmetric[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                 [ 65%]\nsage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_eq_transitive[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                          [ 67%]\nsage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_eq_transitive[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                     [ 69%]\nsage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_eq_transitive[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                [ 71%]\nsage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_neq[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                                    [ 73%]\nsage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_neq[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                               [ 76%]\nsage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_neq[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                          [ 78%]\n...\n```\nAs one can see, each general test method is invoked for the three examples.\n\n\nTODO (in follow-up tickets):\n- Complete migration to pytest.\n- Once that is done, stop invoking `TestSuite` in doctests and remove the `TestSuite` class.\n\nSee also:\n- #33546 Replace custom Sage doctest discovery by pytest (using pytest_collect_file)\n\n\nCC:  @mkoeppe @tscrim @nthiery @slel\n\nKeywords: **testsuite**\n\nBranch/Commit: **[public/refactoring/pytest](https://github.com/sagemath/sagetrac-mirror/tree/public/refactoring/pytest) @ [b047abe](https://github.com/sagemath/sagetrac-mirror/commit/b047abeae5c3f3bf755afa37bf65a0ed4bc61d97)**\n\nAuthor: **Tobias Diez**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/30738_\n\n",
    "created_at": "2020-10-07T18:06:19Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/refactoring",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement",
        "https://github.com/sagemath/sage/labels/needs%20review"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.9",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Replace custom Sage unit test discovery by pytest",
    "type": "issue",
    "updated_at": "2023-01-07T21:39:40Z",
    "url": "https://github.com/sagemath/sage/issues/30738",
    "user": "https://github.com/tobiasdiez"
}
```
Currently, Sage code contains `_test_xyz` methods that are invoked via doctests and discovered via a custom `TestSuite` class. This ticket is to replace this custom test discovery by the use of the established **pytest** framework https://docs.pytest.org/ (this is in line with #28936 - using mainstream Python test infrastructure).

Advantages of this approach:
- Reuse standard test infrastructure instead of a custom test discovery interface (this is a big maintenance relief, especially given the large list of todos in the `TestSuite` code).
- Better error messages in case a test fails.
- Easier onboarding of new Python developers.
- Clear separation of test methods vs production code. For example, the `*_test.py` files can easily be excluded from distribution.
- Good support by IDEs (auto completion, test discovery and easier invocation). For example, VSCode automatically discovers all pytest tests, provides a convenient interface to run them (all, a selection, only failed ones) and allows to directly start a debug session for a failing test. See https://code.visualstudio.com/docs/python/testing
- Less and clearer code (no hidden assumptions).

Disadvantages of this approach:
- Current developers have to learn pytest and its conventions (files must be named `*_test.py` and test methods must start with `test_`).
- Tests no longer live in the same file as the code (I would call this an advantage, but some people may prefer to have them really close together).

In order to migrate, the following changes are necessary:
- Move `_test_xyz` from a category `module` to new file `<module>_test.py` (e.g. `finite_semigroups_test.py`).
- Rewrite tests using pytest (which is straightforward and more or less only amounts to removing all the custom code involving `self_tester`).
- Create a new test class for the parent class under test (e.g `TestFiniteSemigroup`).
- Create a static method `category_instances()` in this test class returning a list of instances to test.

For the moment, I did this only for a few test methods in `sets_cat` using finite semigroups as example to illustrate the process.

The new implementation is as follows:
- The test class for the category (e.g. in `sets_cat_test.py`) defines generic tests that should pass for every object in that category. Moreover, the test class may provides instances (objects) to test via the method `category_instances`.
- Running pytest finds the test file `finite_semigroups_test.py`, then determines the categories of the objects (returned from `category_instances`) and adds all generic test methods for that category to the test class (this happens in `conftest.py`).
- Each test method can have the parameter `category_instance` which is bound to the return value of the `category_instances` method.

Running `cd src && pytest --verbose` (from a virtual env with sage and pytest installed), the output is as follows:

```
sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_contains[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                         [  2%]
sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_contains[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                    [  4%]
sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_contains[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                               [  6%]
sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_iter_list[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                        [  8%]
sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_iter_list[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                   [ 10%]
sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_iter_list[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                              [ 13%]
sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_iter_cardinality[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                 [ 15%]
sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_iter_cardinality[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                            [ 17%]
sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_iter_cardinality[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                       [ 19%]
sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_associativity[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                                   [ 21%]
sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_associativity[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                              [ 23%]
sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_associativity[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                         [ 26%]
sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_an_element[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                                      [ 28%]
sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_an_element[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                                 [ 30%]
sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_an_element[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                            [ 32%]
sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_an_element_idempotent[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                           [ 34%]
sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_an_element_idempotent[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                      [ 36%]
sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_an_element_idempotent[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                 [ 39%]
sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_cardinality_return_type[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                         [ 41%]
sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_cardinality_return_type[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                    [ 43%]
sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_cardinality_return_type[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                               [ 45%]
sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_construction[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                                    [ 47%]
sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_construction[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                               [ 50%]
sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_construction[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                          [ 52%]
sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_element_eq_reflexive[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                            [ 54%]
sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_element_eq_reflexive[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                       [ 56%]
sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_element_eq_reflexive[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                  [ 58%]
sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_eq_symmetric[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                           [ 60%]
sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_eq_symmetric[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                      [ 63%]
sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_eq_symmetric[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                 [ 65%]
sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_eq_transitive[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                          [ 67%]
sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_eq_transitive[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                     [ 69%]
sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_eq_transitive[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                [ 71%]
sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_neq[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                                    [ 73%]
sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_neq[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                               [ 76%]
sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_neq[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                          [ 78%]
...
```
As one can see, each general test method is invoked for the three examples.


TODO (in follow-up tickets):
- Complete migration to pytest.
- Once that is done, stop invoking `TestSuite` in doctests and remove the `TestSuite` class.

See also:
- #33546 Replace custom Sage doctest discovery by pytest (using pytest_collect_file)


CC:  @mkoeppe @tscrim @nthiery @slel

Keywords: **testsuite**

Branch/Commit: **[public/refactoring/pytest](https://github.com/sagemath/sagetrac-mirror/tree/public/refactoring/pytest) @ [b047abe](https://github.com/sagemath/sagetrac-mirror/commit/b047abeae5c3f3bf755afa37bf65a0ed4bc61d97)**

Author: **Tobias Diez**

_Issue created by migration from https://trac.sagemath.org/ticket/30738_





---

archive/issue_events_391853.json:
```json
{
    "actor": "https://github.com/tobiasdiez",
    "created_at": "2020-10-07T18:06:19Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "milestone_number": null,
    "milestone_title": "sage-9.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30738#event-391853"
}
```



---

archive/issue_events_391854.json:
```json
{
    "actor": "https://github.com/tobiasdiez",
    "created_at": "2020-10-07T18:06:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "label": "https://github.com/sagemath/sage/labels/refactoring",
    "label_color": "696969",
    "label_name": "refactoring",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30738#event-391854"
}
```



---

archive/issue_events_391855.json:
```json
{
    "actor": "https://github.com/tobiasdiez",
    "created_at": "2020-10-07T18:06:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30738#event-391855"
}
```



---

archive/issue_events_391856.json:
```json
{
    "actor": "https://github.com/tobiasdiez",
    "created_at": "2020-10-07T18:06:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30738#event-391856"
}
```



---

archive/issue_comments_494076.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -15,6 +15,7 @@\n - Easier onboarding of new Python developers\n - Clear separation of test methods vs production code. For example, the `test_*.py` files can easily be excluded from distribution.\n - Good support by IDE (auto completion, test discovery and easier invocation)\n+- Less and clearer code (no hidden assumptions)\n \n Disadvantages of this approach:\n - Current developer have to learn the new conventions (files need to be named `test_*.py` and tests methods need to start with `test_`) and pytest\n``````\n",
    "created_at": "2020-10-07T18:09:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494076",
    "user": "https://github.com/tobiasdiez"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -15,6 +15,7 @@
 - Easier onboarding of new Python developers
 - Clear separation of test methods vs production code. For example, the `test_*.py` files can easily be excluded from distribution.
 - Good support by IDE (auto completion, test discovery and easier invocation)
+- Less and clearer code (no hidden assumptions)
 
 Disadvantages of this approach:
 - Current developer have to learn the new conventions (files need to be named `test_*.py` and tests methods need to start with `test_`) and pytest
``````




---

archive/issue_comments_494077.json:
```json
{
    "body": "<a id='comment:2'>Comment 2:</a>\nAre you aware that the crucial point of our _test methods, in particular those provided in the category framework, is that objects of subclasses run these tests?",
    "created_at": "2020-10-07T18:13:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494077",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'>Comment 2:</a>
Are you aware that the crucial point of our _test methods, in particular those provided in the category framework, is that objects of subclasses run these tests?



---

archive/issue_comments_494078.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nYes, and this structure is also somewhat reflected in the new code as the tests for the subclasses inherit from the general base test class. If I understood the code correctly, then the main purpose of these subclasses (with respect to the tests) is to provide the examples (e.g. using the `example()` convention). This can be archived in a more transparent and cleaner way using parameterized test fixtures of pytest.",
    "created_at": "2020-10-07T18:31:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494078",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:3'>Comment 3:</a>
Yes, and this structure is also somewhat reflected in the new code as the tests for the subclasses inherit from the general base test class. If I understood the code correctly, then the main purpose of these subclasses (with respect to the tests) is to provide the examples (e.g. using the `example()` convention). This can be archived in a more transparent and cleaner way using parameterized test fixtures of pytest.



---

archive/issue_comments_494079.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nReplying to [@tobiasdiez](#comment%3A3):\n> If I understood the code correctly, then the main purpose of these subclasses (with respect to the tests) is to provide the examples (e.g. using the `example()` convention).\n\nNo, the category classes provide mixins for dynamically generated classes for all `Parent` and `Element` objects. The `example()` are just additional documentation.",
    "created_at": "2020-10-07T19:10:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494079",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:4'>Comment 4:</a>
Replying to [@tobiasdiez](#comment%3A3):
> If I understood the code correctly, then the main purpose of these subclasses (with respect to the tests) is to provide the examples (e.g. using the `example()` convention).

No, the category classes provide mixins for dynamically generated classes for all `Parent` and `Element` objects. The `example()` are just additional documentation.



---

archive/issue_comments_494080.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nSure, but that doesn't seem to be important for the tests itself. Take for example the tests in `sets_cat`. Almost all of them simply call `tester.some_elements()` and then run certain assertions against the returned elements. Thus, there is no semantical difference to having one general test method accepting an element as argument, and then testing the elements returned by `some_elements()` using this method. This is exactly what is proposed in this ticket.\n\nOne question though: is the purpose of these tests to check that one general implementation is correct for all these examples (e.g `sets_cat` provides a general equality implementation which is checked), or that the subclasses provide an implementation that adheres to general principles (e.g. `finitely_generated_semigroups` provides an implementation of equality that is checked). Just so that I know where to best place these tests (test_sets_cat vs test_finitely_generated_semigroups).",
    "created_at": "2020-10-08T07:05:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494080",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:5'>Comment 5:</a>
Sure, but that doesn't seem to be important for the tests itself. Take for example the tests in `sets_cat`. Almost all of them simply call `tester.some_elements()` and then run certain assertions against the returned elements. Thus, there is no semantical difference to having one general test method accepting an element as argument, and then testing the elements returned by `some_elements()` using this method. This is exactly what is proposed in this ticket.

One question though: is the purpose of these tests to check that one general implementation is correct for all these examples (e.g `sets_cat` provides a general equality implementation which is checked), or that the subclasses provide an implementation that adheres to general principles (e.g. `finitely_generated_semigroups` provides an implementation of equality that is checked). Just so that I know where to best place these tests (test_sets_cat vs test_finitely_generated_semigroups).



---

archive/issue_comments_494081.json:
```json
{
    "body": "<a id='comment:6'>Comment 6:</a>\nReplying to [@tobiasdiez](#comment%3A5):\n> One question though: is the purpose of these tests to check that one general implementation is correct for all these examples (e.g `sets_cat` provides a general equality implementation which is checked), or that the subclasses provide an implementation that adheres to general principles (e.g. `finitely_generated_semigroups` provides an implementation of equality that is checked).\n\nThe latter.",
    "created_at": "2020-10-08T16:22:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494081",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:6'>Comment 6:</a>
Replying to [@tobiasdiez](#comment%3A5):
> One question though: is the purpose of these tests to check that one general implementation is correct for all these examples (e.g `sets_cat` provides a general equality implementation which is checked), or that the subclasses provide an implementation that adheres to general principles (e.g. `finitely_generated_semigroups` provides an implementation of equality that is checked).

The latter.



---

archive/issue_comments_494082.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nThanks, I thought so too. Then the current file structure should be right.\nShould I go ahead and convert the other test methods to pytest as well? (As part of this ticket, or open a new ticket for every method?)",
    "created_at": "2020-10-08T16:45:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494082",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:7'>Comment 7:</a>
Thanks, I thought so too. Then the current file structure should be right.
Should I go ahead and convert the other test methods to pytest as well? (As part of this ticket, or open a new ticket for every method?)



---

archive/issue_comments_494083.json:
```json
{
    "body": "<a id='comment:8'>Comment 8:</a>\nI do not know enough about pytest. Can you expand the ticket description to explain how the test discovery works after the ticket, and how it ensures that still the same things get tested?",
    "created_at": "2020-10-08T17:45:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494083",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:8'>Comment 8:</a>
I do not know enough about pytest. Can you expand the ticket description to explain how the test discovery works after the ticket, and how it ensures that still the same things get tested?



---

archive/issue_events_391857.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-24T20:15:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30738#event-391857"
}
```



---

archive/issue_events_391858.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-24T20:15:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30738#event-391858"
}
```



---

archive/issue_comments_494084.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -21,6 +21,15 @@\n - Current developer have to learn the new conventions (files need to be named `test_*.py` and tests methods need to start with `test_`) and pytest\n - Tests no longer live in the same file as the code (I would say this is an advantage, but some people may prefer to have them really close together).\n \n+By default, pytest implements the following standard test discovery:\n+\n+- Search for `test_*.py` or `*_test.py` files (I would stick to the `test` prefix).\n+- From those files, collect test items:\n+   - Functions or methods with prefix `test`\n+   - If the functions are inside of classes, then the class name has to start with `test` as well.\n \n What do you think? (Please feel free to add more people to cc if you think they may be interested.)\n \n+TOOD:\n+- Complete migration of tests to pytest\n+- Integrate `pytest` in `sage -t` and tox (and patchbot?)\n``````\n",
    "created_at": "2020-10-24T20:59:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494084",
    "user": "https://github.com/tobiasdiez"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -21,6 +21,15 @@
 - Current developer have to learn the new conventions (files need to be named `test_*.py` and tests methods need to start with `test_`) and pytest
 - Tests no longer live in the same file as the code (I would say this is an advantage, but some people may prefer to have them really close together).
 
+By default, pytest implements the following standard test discovery:
+
+- Search for `test_*.py` or `*_test.py` files (I would stick to the `test` prefix).
+- From those files, collect test items:
+   - Functions or methods with prefix `test`
+   - If the functions are inside of classes, then the class name has to start with `test` as well.
 
 What do you think? (Please feel free to add more people to cc if you think they may be interested.)
 
+TOOD:
+- Complete migration of tests to pytest
+- Integrate `pytest` in `sage -t` and tox (and patchbot?)
``````




---

archive/issue_events_391859.json:
```json
{
    "actor": "https://github.com/tobiasdiez",
    "created_at": "2020-10-24T20:59:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30738#event-391859"
}
```



---

archive/issue_comments_494085.json:
```json
{
    "body": "<a id='comment:11'>Comment 11:</a>\nI've extended the ticket description. Does this clarify your questions?\n\nThe test `test_element_eq_reflexive` (and other similar tests to be added) are invoked for each element of `test_elements`. Thus, by adding all the instances currently covered by the unit tests we make sure that the test coverage stays the same.",
    "created_at": "2020-10-24T21:01:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494085",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:11'>Comment 11:</a>
I've extended the ticket description. Does this clarify your questions?

The test `test_element_eq_reflexive` (and other similar tests to be added) are invoked for each element of `test_elements`. Thus, by adding all the instances currently covered by the unit tests we make sure that the test coverage stays the same.



---

archive/issue_comments_494086.json:
```json
{
    "body": "<a id='comment:12'>Comment 12:</a>\nSorry, I still don't get it. The branch as it is on the ticket - do you claim that it still tests the same objects as before?",
    "created_at": "2020-10-24T21:31:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494086",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:12'>Comment 12:</a>
Sorry, I still don't get it. The branch as it is on the ticket - do you claim that it still tests the same objects as before?



---

archive/issue_comments_494087.json:
```json
{
    "body": "<a id='comment:13'>Comment 13:</a>\nIf you run `pytest` on this branch, it invokes `test_elements_eq_reflexive` with the arguments `['a', 'b', 'c', 'ab', 'ac', 'ba', 'bc', 'ca', 'cb', 'abc']`. \nThis is the same as the doctest for `finite_semigroups`:\n\n```\nNow, let us look at the structure of the semigroup::\n\n        sage: S = FiniteSemigroups().example(alphabet = ('a','b','c'))\n        sage: S.cayley_graph(side=\"left\", simple=True).plot()\n        Graphics object consisting of 60 graphics primitives\n        sage: S.j_transversal_of_idempotents() # random (arbitrary choice)\n        ['acb', 'ac', 'ab', 'bc', 'a', 'c', 'b']\n\n    We conclude by running systematic tests on this semigroup::\n\n        sage: TestSuite(S).run(verbose = True)\n        running ._test_an_element() . . . pass\n        running ._test_associativity() . . . pass\n        running ._test_cardinality() . . . pass\n        running ._test_category() . . . pass\n        running ._test_construction() . . . pass\n        running ._test_elements() . . .\n          Running the test suite of self.an_element()\n          running ._test_category() . . . pass\n          running ._test_eq() . . . pass\n          running ._test_new() . . . pass\n          running ._test_not_implemented_methods() . . . pass\n          running ._test_pickling() . . . pass\n          pass\n        running ._test_elements_eq_reflexive() . . . pass\n        running ._test_elements_eq_symmetric() . . . pass\n        running ._test_elements_eq_transitive() . . . pass\n        running ._test_elements_neq() . . . pass\n        running ._test_enumerated_set_contains() . . . pass\n        running ._test_enumerated_set_iter_cardinality() . . . pass\n        running ._test_enumerated_set_iter_list() . . . pass\n        running ._test_eq() . . . pass\n        running ._test_new() . . . pass\n        running ._test_not_implemented_methods() . . . pass\n        running ._test_pickling() . . . pass\n        running ._test_some_elements() . . . pass\n```\nSo the idea would be to replace this doctest by `pytest`. There are a few more doctests of this form that can be replaced in a similar vain by adding the corresponding elements to the `test_elements` list.",
    "created_at": "2020-10-24T21:54:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494087",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:13'>Comment 13:</a>
If you run `pytest` on this branch, it invokes `test_elements_eq_reflexive` with the arguments `['a', 'b', 'c', 'ab', 'ac', 'ba', 'bc', 'ca', 'cb', 'abc']`. 
This is the same as the doctest for `finite_semigroups`:

```
Now, let us look at the structure of the semigroup::

        sage: S = FiniteSemigroups().example(alphabet = ('a','b','c'))
        sage: S.cayley_graph(side="left", simple=True).plot()
        Graphics object consisting of 60 graphics primitives
        sage: S.j_transversal_of_idempotents() # random (arbitrary choice)
        ['acb', 'ac', 'ab', 'bc', 'a', 'c', 'b']

    We conclude by running systematic tests on this semigroup::

        sage: TestSuite(S).run(verbose = True)
        running ._test_an_element() . . . pass
        running ._test_associativity() . . . pass
        running ._test_cardinality() . . . pass
        running ._test_category() . . . pass
        running ._test_construction() . . . pass
        running ._test_elements() . . .
          Running the test suite of self.an_element()
          running ._test_category() . . . pass
          running ._test_eq() . . . pass
          running ._test_new() . . . pass
          running ._test_not_implemented_methods() . . . pass
          running ._test_pickling() . . . pass
          pass
        running ._test_elements_eq_reflexive() . . . pass
        running ._test_elements_eq_symmetric() . . . pass
        running ._test_elements_eq_transitive() . . . pass
        running ._test_elements_neq() . . . pass
        running ._test_enumerated_set_contains() . . . pass
        running ._test_enumerated_set_iter_cardinality() . . . pass
        running ._test_enumerated_set_iter_list() . . . pass
        running ._test_eq() . . . pass
        running ._test_new() . . . pass
        running ._test_not_implemented_methods() . . . pass
        running ._test_pickling() . . . pass
        running ._test_some_elements() . . . pass
```
So the idea would be to replace this doctest by `pytest`. There are a few more doctests of this form that can be replaced in a similar vain by adding the corresponding elements to the `test_elements` list.



---

archive/issue_comments_494088.json:
```json
{
    "body": "<a id='comment:14'>Comment 14:</a>\nReplying to [@tobiasdiez](#comment%3A13):\n> There are a few more doctests of this form that can be replaced in a similar vain by adding the corresponding elements to the `test_elements` list.\n\nA few? Currently `_test_elements_eq_reflexive` is invoked by `TestSuite(object).run()` whenever `object` happens to be in the category of sets. This is a huge, dynamically determined list.",
    "created_at": "2020-10-24T22:01:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494088",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:14'>Comment 14:</a>
Replying to [@tobiasdiez](#comment%3A13):
> There are a few more doctests of this form that can be replaced in a similar vain by adding the corresponding elements to the `test_elements` list.

A few? Currently `_test_elements_eq_reflexive` is invoked by `TestSuite(object).run()` whenever `object` happens to be in the category of sets. This is a huge, dynamically determined list.



---

archive/issue_comments_494089.json:
```json
{
    "body": "<a id='comment:15'>Comment 15:</a>\nSure, there are quite a lot of instances where a `TestSuite` is run from the doctest. Each one would need to be replaced by a test file similar to `test_finite_semigroups.py`. Pytest is not a magician and the information which examples to test still needs to be provided.\n\nSo the replacement dictionary roughly speaking looks like:\n- `TestSuite` -> `pytest`\n- `TestSuite(S).run(verbose = True)` -> `@pytest.fixture(params=S)`\n\nThe idea is not to change the way the tests cases are provided (although that may certainly be improved in the future) but to replace sage's only implementation of test discovery and invocation by what is probably the most establish Python testing framework.",
    "created_at": "2020-10-24T22:20:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494089",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:15'>Comment 15:</a>
Sure, there are quite a lot of instances where a `TestSuite` is run from the doctest. Each one would need to be replaced by a test file similar to `test_finite_semigroups.py`. Pytest is not a magician and the information which examples to test still needs to be provided.

So the replacement dictionary roughly speaking looks like:
- `TestSuite` -> `pytest`
- `TestSuite(S).run(verbose = True)` -> `@pytest.fixture(params=S)`

The idea is not to change the way the tests cases are provided (although that may certainly be improved in the future) but to replace sage's only implementation of test discovery and invocation by what is probably the most establish Python testing framework.



---

archive/issue_comments_494090.json:
```json
{
    "body": "<a id='comment:16'>Comment 16:</a>\nSo in your design, there would be a hierarchy of `Tests` classes parallel to the hierarchy of, say, parent classes in sage?",
    "created_at": "2020-10-24T22:29:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494090",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:16'>Comment 16:</a>
So in your design, there would be a hierarchy of `Tests` classes parallel to the hierarchy of, say, parent classes in sage?



---

archive/issue_comments_494091.json:
```json
{
    "body": "<a id='comment:17'>Comment 17:</a>\nYes! Every parent class would have a corresponding test class which specifies which general axioms this parent class wants to adhere to. This is done by deriving from one or more generic test classes (the one in the branch should probably be renamed to `GenericSetTests`).",
    "created_at": "2020-10-24T22:44:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494091",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:17'>Comment 17:</a>
Yes! Every parent class would have a corresponding test class which specifies which general axioms this parent class wants to adhere to. This is done by deriving from one or more generic test classes (the one in the branch should probably be renamed to `GenericSetTests`).



---

archive/issue_comments_494092.json:
```json
{
    "body": "<a id='comment:18'>Comment 18:</a>\nOkay, but the parent classes are dynamic classes formed by mixing in axioms.\nSo the test classes would also be determined dynamically?",
    "created_at": "2020-10-24T22:45:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494092",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:18'>Comment 18:</a>
Okay, but the parent classes are dynamic classes formed by mixing in axioms.
So the test classes would also be determined dynamically?



---

archive/issue_events_391860.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-24T22:55:46Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30738#event-391860"
}
```



---

archive/issue_events_391861.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-24T22:55:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30738#event-391861"
}
```



---

archive/issue_comments_494093.json:
```json
{
    "body": "<a id='comment:19'>Comment 19:</a>\nReplying to [@tobiasdiez](#comment%3A15):\n> here are quite a lot of instances where a `TestSuite` is run from the doctest. Each one would need to be replaced by a test file similar to `test_finite_semigroups.py`. Pytest is not a magician and the information which examples to test still needs to be provided.\n\nThanks for this clarification. I'm setting this ticket to \"needs_work\" because the branch in this form is not complete -- it effectively removes existing tests for  `_test_elements_eq_reflexive`. Without a much more complete branch that reaches test parity, this idea is difficult to evaluate.\n\nOverall I think there is a conflict here between the dynamic nature of our category system and what seems to amount to a static determination of what objects to test for what properties (in the proposed changes).",
    "created_at": "2020-10-24T22:55:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494093",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:19'>Comment 19:</a>
Replying to [@tobiasdiez](#comment%3A15):
> here are quite a lot of instances where a `TestSuite` is run from the doctest. Each one would need to be replaced by a test file similar to `test_finite_semigroups.py`. Pytest is not a magician and the information which examples to test still needs to be provided.

Thanks for this clarification. I'm setting this ticket to "needs_work" because the branch in this form is not complete -- it effectively removes existing tests for  `_test_elements_eq_reflexive`. Without a much more complete branch that reaches test parity, this idea is difficult to evaluate.

Overall I think there is a conflict here between the dynamic nature of our category system and what seems to amount to a static determination of what objects to test for what properties (in the proposed changes).



---

archive/issue_comments_494094.json:
```json
{
    "body": "<a id='comment:20'>Comment 20:</a>\nI'm not that familiar yet with the category framework. When you say \"dynamic classes formed by mixing in axioms\" you mean something like `Parent.__init__(self, category = Semigroups().Finite().FinitelyGenerated())`? But, in general, yes the idea is to mixin the tests. I don't see any reason why this couldn't be done dynamically.\n\nI agree, this branch has not yet feature parity with the master branch. Before I invest more time into it, I just wanted to confirm that this idea would be worth looking at in general.",
    "created_at": "2020-10-24T23:00:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494094",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:20'>Comment 20:</a>
I'm not that familiar yet with the category framework. When you say "dynamic classes formed by mixing in axioms" you mean something like `Parent.__init__(self, category = Semigroups().Finite().FinitelyGenerated())`? But, in general, yes the idea is to mixin the tests. I don't see any reason why this couldn't be done dynamically.

I agree, this branch has not yet feature parity with the master branch. Before I invest more time into it, I just wanted to confirm that this idea would be worth looking at in general.



---

archive/issue_comments_494095.json:
```json
{
    "body": "<a id='comment:21'>Comment 21:</a>\nReplying to [@tobiasdiez](#comment%3A20):\n> When you say \"dynamic classes formed by mixing in axioms\" you mean something like `Parent.__init__(self, category = Semigroups().Finite().FinitelyGenerated())`?\n\nYes, things like this.",
    "created_at": "2020-10-24T23:05:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494095",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:21'>Comment 21:</a>
Replying to [@tobiasdiez](#comment%3A20):
> When you say "dynamic classes formed by mixing in axioms" you mean something like `Parent.__init__(self, category = Semigroups().Finite().FinitelyGenerated())`?

Yes, things like this.



---

archive/issue_comments_494096.json:
```json
{
    "body": "<a id='comment:22'>Comment 22:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1df0a95c5cfdb4852ab1688a7b30187e095bc110\">1df0a95</a></td><td><code>Merge branch 'develop' of git://github.com/sagemath/sage into public/refactoring/pytest</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b12608b7937ece65ba0bafdf0c7306e31213cb06\">b12608b</a></td><td><code>Readd test</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/79abf0d315c0b274e98783b9d8bce4bd9c9c2ea8\">79abf0d</a></td><td><code>Refactor</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/99ae00c2ecb1ffcb8895697f34861f05dea840e6\">99ae00c</a></td><td><code>Replace startup exception by warning</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/11882e531bc80f6397f00d6a5a095b97a9e93804\">11882e5</a></td><td><code>Use context manager</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6a52fbf72d83b2488845f4caeb15798ed5a217e7\">6a52fbf</a></td><td><code>Remove lazy import finish startup</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f96025e08caeb0b747a391243860c562ebd515a1\">f96025e</a></td><td><code>Merge branch 'develop' of git://github.com/sagemath/sage into public/build/startupWarning</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b952bb5661206b5614dfe6117c27021627b19616\">b952bb5</a></td><td><code>Fix doctests</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5de08cde41f990491e9cbd11efa6e522a73c4035\">5de08cd</a></td><td><code>Merge branch 'public/build/startupWarning' of git://trac.sagemath.org/sage into public/refactoring/pytest</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e198d1cca15b1a4e262ff625d8725d44fb8b7703\">e198d1c</a></td><td><code>Make tests mixins dynamic</code></td></tr></table>\n",
    "created_at": "2020-11-08T12:53:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494096",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:22'>Comment 22:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1df0a95c5cfdb4852ab1688a7b30187e095bc110">1df0a95</a></td><td><code>Merge branch 'develop' of git://github.com/sagemath/sage into public/refactoring/pytest</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b12608b7937ece65ba0bafdf0c7306e31213cb06">b12608b</a></td><td><code>Readd test</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/79abf0d315c0b274e98783b9d8bce4bd9c9c2ea8">79abf0d</a></td><td><code>Refactor</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/99ae00c2ecb1ffcb8895697f34861f05dea840e6">99ae00c</a></td><td><code>Replace startup exception by warning</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/11882e531bc80f6397f00d6a5a095b97a9e93804">11882e5</a></td><td><code>Use context manager</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6a52fbf72d83b2488845f4caeb15798ed5a217e7">6a52fbf</a></td><td><code>Remove lazy import finish startup</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f96025e08caeb0b747a391243860c562ebd515a1">f96025e</a></td><td><code>Merge branch 'develop' of git://github.com/sagemath/sage into public/build/startupWarning</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b952bb5661206b5614dfe6117c27021627b19616">b952bb5</a></td><td><code>Fix doctests</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5de08cde41f990491e9cbd11efa6e522a73c4035">5de08cd</a></td><td><code>Merge branch 'public/build/startupWarning' of git://trac.sagemath.org/sage into public/refactoring/pytest</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e198d1cca15b1a4e262ff625d8725d44fb8b7703">e198d1c</a></td><td><code>Make tests mixins dynamic</code></td></tr></table>




---

archive/issue_comments_494097.json:
```json
{
    "body": "Changed commit from **[3b243d0](https://github.com/sagemath/sagetrac-mirror/commit/3b243d0e8c790de8987f81dcf877d7b07ead4a11)** to **[e198d1c](https://github.com/sagemath/sagetrac-mirror/commit/e198d1cca15b1a4e262ff625d8725d44fb8b7703)**",
    "created_at": "2020-11-08T12:53:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494097",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[3b243d0](https://github.com/sagemath/sagetrac-mirror/commit/3b243d0e8c790de8987f81dcf877d7b07ead4a11)** to **[e198d1c](https://github.com/sagemath/sagetrac-mirror/commit/e198d1cca15b1a4e262ff625d8725d44fb8b7703)**



---

archive/issue_comments_494098.json:
```json
{
    "body": "Dependencies: **#30748**",
    "created_at": "2020-11-08T13:15:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494098",
    "user": "https://github.com/tobiasdiez"
}
```

Dependencies: **#30748**



---

archive/issue_comments_494099.json:
```json
{
    "body": "<a id='comment:23'>Comment 23:</a>\nThanks for the input. I've now reworked the code completely. The generic category tests are now dynamically mixed in the test class. The new approach is explained in the ticket description in more detail. The upshot is that it is very easy to add new generic test methods (simply add them to the category test class, e.g. `test_sets_cat`) and to add new examples (simply create a new test class implementing `category_instances`).",
    "created_at": "2020-11-08T13:15:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494099",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:23'>Comment 23:</a>
Thanks for the input. I've now reworked the code completely. The generic category tests are now dynamically mixed in the test class. The new approach is explained in the ticket description in more detail. The upshot is that it is very easy to add new generic test methods (simply add them to the category test class, e.g. `test_sets_cat`) and to add new examples (simply create a new test class implementing `category_instances`).



---

archive/issue_comments_494100.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,13 +1,4 @@\n Currently, the sage code contains `_test_xyz` methods that are invoked via doctests and discovered via a custom `TestSuit` class. In this ticket, we are proposing to replace this custom designed test discovery by using the established pytest framework https://docs.pytest.org/ (this is inline with #28936 - using mainstraim Python test infrastructure).\n-\n-The changes are as follows:\n-- Move `_test_xyz` from `module` to new file `test_module`\n-- Rewrite test using pytest (which is straightforward and more or less only amounts to removing all the custom code involving `self_tester`)\n-- Remove invoking the `TestSuit` in the doctests\n-- Instead, add the corresponding test elements as parameterized fixtures for pytest\n-\n-For the moment, I did this only for one test method in `sets_cat` to illustrate the process.\n-What is still remaining is to call `pytest` as part of the build process so that the newly added tests are found and checked.\n \n Advantages of this approach:\n - Reuse standard test infrastructure instead of a custom test discovery interface (this is a big plus as we do not have to maintain it ourself, especially given the large list of todo's in the TestSuite code)\n@@ -21,6 +12,37 @@\n - Current developer have to learn the new conventions (files need to be named `test_*.py` and tests methods need to start with `test_`) and pytest\n - Tests no longer live in the same file as the code (I would say this is an advantage, but some people may prefer to have them really close together).\n \n+In order to migrate the following changes are necessary:\n+- Move `_test_xyz` from a category `module` to new file `test_module` (e.g. `test_sets_cat`)\n+- Rewrite test using pytest (which is straightforward and more or less only amounts to removing all the custom code involving `self_tester`)\n+- Create a new test class for the parent class under test (e.g `test_finite_semigroups`)\n+- Create a static method `category_instances()` in this test class returning a list of instances to test.\n+\n+For the moment, I did this only for two test methods in `sets_cat` to illustrate the process.\n+\n+The new implementation is as follows:\n+- The test class for the category (e.g. `test_sets_cat`) defines generic tests that should pass for every object in that category.\n+- For every object in the category there is a test class (e.g. `test_finite_semigroups`) that provides instances to test via the method `category_instances`\n+- Running pytest finds the test class `test_finite_semigroups`, then determines the categories of the object and adds all generic test methods for that category to the test class (this happens in `conftest.py`).\n+- Each test method can have the parameter `category_instance` which is bound to the return value of the `category_instances` method.\n+- Thus, the output is as follows:\n+\n+```\n+sage/categories/test_finite_semigroups.py::TestFiniteSemigroup::test_element_eq_reflexive[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED [ 25%]\n+sage/categories/test_finite_semigroups.py::TestFiniteSemigroup::test_element_eq_reflexive[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED [ 50%]\n+sage/categories/test_finite_semigroups.py::TestFiniteSemigroup::test_cardinality_return_type[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED [ 75%]\n+sage/categories/test_finite_semigroups.py::TestFiniteSemigroup::test_cardinality_return_type[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED [100%]\n+```\n+\n+\n+TOOD (as follow-up tickets):\n+- Complete migration of tests to pytest\n+- Integrate `pytest` in `sage -t` and tox\n+- Call `pytest` as part of the build process so that the newly added tests are found and checked\n+- After the migration is done, remove invoking the `TestSuit` in the doctests and remove the `TestSuit` class.\n+\n+---\n+\n By default, pytest implements the following standard test discovery:\n \n - Search for `test_*.py` or `*_test.py` files (I would stick to the `test` prefix).\n@@ -28,8 +50,3 @@\n    - Functions or methods with prefix `test`\n    - If the functions are inside of classes, then the class name has to start with `test` as well.\n \n-What do you think? (Please feel free to add more people to cc if you think they may be interested.)\n-\n-TOOD:\n-- Complete migration of tests to pytest\n-- Integrate `pytest` in `sage -t` and tox (and patchbot?)\n``````\n",
    "created_at": "2020-11-08T13:15:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494100",
    "user": "https://github.com/tobiasdiez"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,13 +1,4 @@
 Currently, the sage code contains `_test_xyz` methods that are invoked via doctests and discovered via a custom `TestSuit` class. In this ticket, we are proposing to replace this custom designed test discovery by using the established pytest framework https://docs.pytest.org/ (this is inline with #28936 - using mainstraim Python test infrastructure).
-
-The changes are as follows:
-- Move `_test_xyz` from `module` to new file `test_module`
-- Rewrite test using pytest (which is straightforward and more or less only amounts to removing all the custom code involving `self_tester`)
-- Remove invoking the `TestSuit` in the doctests
-- Instead, add the corresponding test elements as parameterized fixtures for pytest
-
-For the moment, I did this only for one test method in `sets_cat` to illustrate the process.
-What is still remaining is to call `pytest` as part of the build process so that the newly added tests are found and checked.
 
 Advantages of this approach:
 - Reuse standard test infrastructure instead of a custom test discovery interface (this is a big plus as we do not have to maintain it ourself, especially given the large list of todo's in the TestSuite code)
@@ -21,6 +12,37 @@
 - Current developer have to learn the new conventions (files need to be named `test_*.py` and tests methods need to start with `test_`) and pytest
 - Tests no longer live in the same file as the code (I would say this is an advantage, but some people may prefer to have them really close together).
 
+In order to migrate the following changes are necessary:
+- Move `_test_xyz` from a category `module` to new file `test_module` (e.g. `test_sets_cat`)
+- Rewrite test using pytest (which is straightforward and more or less only amounts to removing all the custom code involving `self_tester`)
+- Create a new test class for the parent class under test (e.g `test_finite_semigroups`)
+- Create a static method `category_instances()` in this test class returning a list of instances to test.
+
+For the moment, I did this only for two test methods in `sets_cat` to illustrate the process.
+
+The new implementation is as follows:
+- The test class for the category (e.g. `test_sets_cat`) defines generic tests that should pass for every object in that category.
+- For every object in the category there is a test class (e.g. `test_finite_semigroups`) that provides instances to test via the method `category_instances`
+- Running pytest finds the test class `test_finite_semigroups`, then determines the categories of the object and adds all generic test methods for that category to the test class (this happens in `conftest.py`).
+- Each test method can have the parameter `category_instance` which is bound to the return value of the `category_instances` method.
+- Thus, the output is as follows:
+
+```
+sage/categories/test_finite_semigroups.py::TestFiniteSemigroup::test_element_eq_reflexive[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED [ 25%]
+sage/categories/test_finite_semigroups.py::TestFiniteSemigroup::test_element_eq_reflexive[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED [ 50%]
+sage/categories/test_finite_semigroups.py::TestFiniteSemigroup::test_cardinality_return_type[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED [ 75%]
+sage/categories/test_finite_semigroups.py::TestFiniteSemigroup::test_cardinality_return_type[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED [100%]
+```
+
+
+TOOD (as follow-up tickets):
+- Complete migration of tests to pytest
+- Integrate `pytest` in `sage -t` and tox
+- Call `pytest` as part of the build process so that the newly added tests are found and checked
+- After the migration is done, remove invoking the `TestSuit` in the doctests and remove the `TestSuit` class.
+
+---
+
 By default, pytest implements the following standard test discovery:
 
 - Search for `test_*.py` or `*_test.py` files (I would stick to the `test` prefix).
@@ -28,8 +50,3 @@
    - Functions or methods with prefix `test`
    - If the functions are inside of classes, then the class name has to start with `test` as well.
 
-What do you think? (Please feel free to add more people to cc if you think they may be interested.)
-
-TOOD:
-- Complete migration of tests to pytest
-- Integrate `pytest` in `sage -t` and tox (and patchbot?)
``````




---

archive/issue_events_391862.json:
```json
{
    "actor": "https://github.com/tobiasdiez",
    "created_at": "2020-11-08T13:15:20Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30738#event-391862"
}
```



---

archive/issue_events_391863.json:
```json
{
    "actor": "https://github.com/tobiasdiez",
    "created_at": "2020-11-08T13:15:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30738#event-391863"
}
```



---

archive/issue_comments_494101.json:
```json
{
    "body": "<a id='comment:24'>Comment 24:</a>\nIt's really hard to see from this ticket how this is intended to go.\n\nThe previous version that I reviewed was removing existing doctests and reimplementing a small subset of them using pytest.\n\nNow the new version is only adding some new tests using pytest that seem to duplicate some existing tests run by the doctest framework.",
    "created_at": "2020-12-05T18:30:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494101",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:24'>Comment 24:</a>
It's really hard to see from this ticket how this is intended to go.

The previous version that I reviewed was removing existing doctests and reimplementing a small subset of them using pytest.

Now the new version is only adding some new tests using pytest that seem to duplicate some existing tests run by the doctest framework.



---

archive/issue_events_391864.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-12-05T18:30:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30738#event-391864"
}
```



---

archive/issue_events_391865.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-12-05T18:30:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30738#event-391865"
}
```



---

archive/issue_comments_494102.json:
```json
{
    "body": "<a id='comment:25'>Comment 25:</a>\nThe current version is meant as a starting point for discussion whether this approach is ok.  So it is a fully working prototype that indeed reimplements a subset of the current category framework tests, and is flexible enough to be extended to cover everything.\nGetting full parity with the current category tests needs a bit of work by extending `test_sets_cat` with the remaining test functions.\n\nI'm not sure what I should do now. The only open point is that pytest needs to be run during the normal test run (on user systems as well as on the ci pipeline). But that's not really the purpose of this ticket. I think, it's clear that one cannot reimplement the complete category tests in one ticket, so this is why I opted for a minimal version. What is your proposal to proceed from here?",
    "created_at": "2020-12-05T20:42:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494102",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:25'>Comment 25:</a>
The current version is meant as a starting point for discussion whether this approach is ok.  So it is a fully working prototype that indeed reimplements a subset of the current category framework tests, and is flexible enough to be extended to cover everything.
Getting full parity with the current category tests needs a bit of work by extending `test_sets_cat` with the remaining test functions.

I'm not sure what I should do now. The only open point is that pytest needs to be run during the normal test run (on user systems as well as on the ci pipeline). But that's not really the purpose of this ticket. I think, it's clear that one cannot reimplement the complete category tests in one ticket, so this is why I opted for a minimal version. What is your proposal to proceed from here?



---

archive/issue_comments_494103.json:
```json
{
    "body": "<a id='comment:26'>Comment 26:</a>\nFeedback/review still needed.",
    "created_at": "2020-12-20T22:42:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494103",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:26'>Comment 26:</a>
Feedback/review still needed.



---

archive/issue_events_391866.json:
```json
{
    "actor": "https://github.com/tobiasdiez",
    "created_at": "2020-12-20T22:42:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30738#event-391866"
}
```



---

archive/issue_events_391867.json:
```json
{
    "actor": "https://github.com/tobiasdiez",
    "created_at": "2020-12-20T22:42:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30738#event-391867"
}
```



---

archive/issue_comments_494104.json:
```json
{
    "body": "<a id='comment:27'>Comment 27:</a>\nReplying to [@tobiasdiez](#comment%3A25):\n> Getting full parity with the current category tests needs a bit of work by extending `test_sets_cat` with the remaining test functions.\n\nBut even for the test function that you already added, it is only testing a few objects.\n\nSo to get parity even for this one test function, `category_instances` would have to be extended vastly -- if I understand the design correctly.\n\nIt is unclear who should do this work and why.",
    "created_at": "2020-12-21T01:37:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494104",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:27'>Comment 27:</a>
Replying to [@tobiasdiez](#comment%3A25):
> Getting full parity with the current category tests needs a bit of work by extending `test_sets_cat` with the remaining test functions.

But even for the test function that you already added, it is only testing a few objects.

So to get parity even for this one test function, `category_instances` would have to be extended vastly -- if I understand the design correctly.

It is unclear who should do this work and why.



---

archive/issue_comments_494105.json:
```json
{
    "body": "Changed dependencies from **#30748** to **#30748, #30901**",
    "created_at": "2020-12-21T08:54:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494105",
    "user": "https://github.com/tobiasdiez"
}
```

Changed dependencies from **#30748** to **#30748, #30901**



---

archive/issue_comments_494106.json:
```json
{
    "body": "<a id='comment:29'>Comment 29:</a>\nI've now vastly extended the tests, and replaced some of the TestSuite calls by pytest. A handful of test methods are still missing to get full feature parity (will do this later), but I hope the idea and design get clearer now (at the cost that there are bigger changes).\n\nThe following change is characteristic for the aim of migrating from Sage's custom TestSuite framework to pytest:\n\n```\n-        sage: TestSuite(C).run()\n+        sage: import pytest\n+        sage: pytest.main([\"-r\", \"test_finite_semigroups.py\"])\n```\n(calling pytest from the doctests is only a temporary work-around until it's properly integrated into the build chain)",
    "created_at": "2020-12-21T11:14:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494106",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:29'>Comment 29:</a>
I've now vastly extended the tests, and replaced some of the TestSuite calls by pytest. A handful of test methods are still missing to get full feature parity (will do this later), but I hope the idea and design get clearer now (at the cost that there are bigger changes).

The following change is characteristic for the aim of migrating from Sage's custom TestSuite framework to pytest:

```
-        sage: TestSuite(C).run()
+        sage: import pytest
+        sage: pytest.main(["-r", "test_finite_semigroups.py"])
```
(calling pytest from the doctests is only a temporary work-around until it's properly integrated into the build chain)



---

archive/issue_comments_494107.json:
```json
{
    "body": "<a id='comment:30'>Comment 30:</a>\nBranch pushed to git repo; I updated commit sha1. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/94e20c704da01082ace2da5a192ee158e091bc78\">94e20c7</a></td><td><code>Revert some of the changes</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6dd6e5cc427b056efc3a4a65d59234493a95f04c\">6dd6e5c</a></td><td><code>Fix compilation</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/eceefb3713d7dc87d0e81cc44b21d150a07d4ee1\">eceefb3</a></td><td><code>Remove string wrap</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d345bff9596c5e513aba8076a6c531fc9a366092\">d345bff</a></td><td><code>Fix test</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c47c4bf7352b13764a0ec1aa497a6f24f3913ad9\">c47c4bf</a></td><td><code>Correct indent</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3fcaf5f4408c946f5423d42facb5bb666635db35\">3fcaf5f</a></td><td><code>Merge branch 'develop' of git://github.com/sagemath/sage into public/build/multiarchsimple</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/090e6f10f1135062d1f65a1f1fa7a366e51ac388\">090e6f1</a></td><td><code>Simplify code</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fa4556ac2815bffa2d7866d94b3e061ba787d816\">fa4556a</a></td><td><code>Remove _get_sage_local</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7b8be0d057dde8b8768df3973e38ec33a043bfc2\">7b8be0d</a></td><td><code>Merge branch 'public/build/multiarchsimple' of git://trac.sagemath.org/sage into public/refactoring/pytest</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1488582a6c48583565f28432a465cbc0ea40d314\">1488582</a></td><td><code>Towards full feature parity</code></td></tr></table>\n",
    "created_at": "2020-12-21T11:14:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494107",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:30'>Comment 30:</a>
Branch pushed to git repo; I updated commit sha1. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/94e20c704da01082ace2da5a192ee158e091bc78">94e20c7</a></td><td><code>Revert some of the changes</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6dd6e5cc427b056efc3a4a65d59234493a95f04c">6dd6e5c</a></td><td><code>Fix compilation</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/eceefb3713d7dc87d0e81cc44b21d150a07d4ee1">eceefb3</a></td><td><code>Remove string wrap</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d345bff9596c5e513aba8076a6c531fc9a366092">d345bff</a></td><td><code>Fix test</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c47c4bf7352b13764a0ec1aa497a6f24f3913ad9">c47c4bf</a></td><td><code>Correct indent</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3fcaf5f4408c946f5423d42facb5bb666635db35">3fcaf5f</a></td><td><code>Merge branch 'develop' of git://github.com/sagemath/sage into public/build/multiarchsimple</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/090e6f10f1135062d1f65a1f1fa7a366e51ac388">090e6f1</a></td><td><code>Simplify code</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fa4556ac2815bffa2d7866d94b3e061ba787d816">fa4556a</a></td><td><code>Remove _get_sage_local</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7b8be0d057dde8b8768df3973e38ec33a043bfc2">7b8be0d</a></td><td><code>Merge branch 'public/build/multiarchsimple' of git://trac.sagemath.org/sage into public/refactoring/pytest</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1488582a6c48583565f28432a465cbc0ea40d314">1488582</a></td><td><code>Towards full feature parity</code></td></tr></table>




---

archive/issue_comments_494108.json:
```json
{
    "body": "Changed commit from **[e198d1c](https://github.com/sagemath/sagetrac-mirror/commit/e198d1cca15b1a4e262ff625d8725d44fb8b7703)** to **[1488582](https://github.com/sagemath/sagetrac-mirror/commit/1488582a6c48583565f28432a465cbc0ea40d314)**",
    "created_at": "2020-12-21T11:14:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494108",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[e198d1c](https://github.com/sagemath/sagetrac-mirror/commit/e198d1cca15b1a4e262ff625d8725d44fb8b7703)** to **[1488582](https://github.com/sagemath/sagetrac-mirror/commit/1488582a6c48583565f28432a465cbc0ea40d314)**



---

archive/issue_comments_494109.json:
```json
{
    "body": "<a id='comment:31'>Comment 31:</a>\nReplying to [@mkoeppe](#comment%3A27):\n> But even for the test function that you already added, it is only testing a few objects.\n> \n> So to get parity even for this one test function, `category_instances` would have to be extended vastly -- if I understand the design correctly.\n\nThese changes do not seem to address the above comment? You added more test functions, instead of showing how one would achieve parity for what one test function covers. Or maybe I'm misunderstanding.",
    "created_at": "2020-12-21T18:16:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494109",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:31'>Comment 31:</a>
Replying to [@mkoeppe](#comment%3A27):
> But even for the test function that you already added, it is only testing a few objects.
> 
> So to get parity even for this one test function, `category_instances` would have to be extended vastly -- if I understand the design correctly.

These changes do not seem to address the above comment? You added more test functions, instead of showing how one would achieve parity for what one test function covers. Or maybe I'm misunderstanding.



---

archive/issue_comments_494110.json:
```json
{
    "body": "<a id='comment:32'>Comment 32:</a>\nI guess there are two ways for migration:\n- Replace one test in the category framework by a pytest, and then make sure that this test is invoked for every example. Do this again for every test.\n- Duplicate all tests in the category framework using pytest, and then replace one `TestSuite(...).run` statement by its pytest equivalent. Do this again for every test invocation.\n\nSince there are only a small number of tests (order of 10) but way more examples (order of 1000), my idea was follow the second approach since this can be done easier in steps.\n\nOf course, the complete migration is quite a huge project. This ticket was meant to as a starting point.\n\nThe advantages I see of pytest over a custom testsuite implementation are in the ticket description.",
    "created_at": "2020-12-21T20:26:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494110",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:32'>Comment 32:</a>
I guess there are two ways for migration:
- Replace one test in the category framework by a pytest, and then make sure that this test is invoked for every example. Do this again for every test.
- Duplicate all tests in the category framework using pytest, and then replace one `TestSuite(...).run` statement by its pytest equivalent. Do this again for every test invocation.

Since there are only a small number of tests (order of 10) but way more examples (order of 1000), my idea was follow the second approach since this can be done easier in steps.

Of course, the complete migration is quite a huge project. This ticket was meant to as a starting point.

The advantages I see of pytest over a custom testsuite implementation are in the ticket description.



---

archive/issue_comments_494111.json:
```json
{
    "body": "<a id='comment:33'>Comment 33:</a>\nIf I understand the proposed design correctly, for each category you would manually maintain a list of category instances to test. To me this seems like a huge step backward: The categories of an object are computed dynamically - and thus all test methods that come with the categories are run.",
    "created_at": "2020-12-23T19:25:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494111",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:33'>Comment 33:</a>
If I understand the proposed design correctly, for each category you would manually maintain a list of category instances to test. To me this seems like a huge step backward: The categories of an object are computed dynamically - and thus all test methods that come with the categories are run.



---

archive/issue_comments_494112.json:
```json
{
    "body": "<a id='comment:34'>Comment 34:</a>\n(Feel free to add this to \"disadvantages of the approach\" in the ticket description.)",
    "created_at": "2020-12-23T19:25:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494112",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:34'>Comment 34:</a>
(Feel free to add this to "disadvantages of the approach" in the ticket description.)



---

archive/issue_comments_494113.json:
```json
{
    "body": "<a id='comment:35'>Comment 35:</a>\nFrom \"advantages\" in the ticket description:\n> Clear separation of test methods vs production code. For example, the test_*.py files can easily be excluded from distribution.\n\nWe definitely would not want to exclude them from the distribution! Also user-defined classes will want to run the test methods that are provided by the categories as part of their tests.",
    "created_at": "2020-12-23T19:27:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494113",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:35'>Comment 35:</a>
From "advantages" in the ticket description:
> Clear separation of test methods vs production code. For example, the test_*.py files can easily be excluded from distribution.

We definitely would not want to exclude them from the distribution! Also user-defined classes will want to run the test methods that are provided by the categories as part of their tests.



---

archive/issue_comments_494114.json:
```json
{
    "body": "<a id='comment:36'>Comment 36:</a>\nCould you elaborate on this in the ticket description:\n> Good support by IDE (auto completion, test discovery and easier invocation)",
    "created_at": "2020-12-23T19:29:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494114",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:36'>Comment 36:</a>
Could you elaborate on this in the ticket description:
> Good support by IDE (auto completion, test discovery and easier invocation)



---

archive/issue_comments_494115.json:
```json
{
    "body": "<a id='comment:37'>Comment 37:</a>\nReplying to [@mkoeppe](#comment%3A33):\n> If I understand the proposed design correctly, for each category you would manually maintain a list of category instances to test.\n\nYes, but that's not different from the current code. There you also create the examples and then run the testsuite (which makes sure to run the correct tests for this category). This is the same in the proposed design, except that you now define the examples in the test file. I would even argue that the proposed design is more flexible and makes it very transparent which examples are used to test a given category.",
    "created_at": "2020-12-23T19:37:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494115",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:37'>Comment 37:</a>
Replying to [@mkoeppe](#comment%3A33):
> If I understand the proposed design correctly, for each category you would manually maintain a list of category instances to test.

Yes, but that's not different from the current code. There you also create the examples and then run the testsuite (which makes sure to run the correct tests for this category). This is the same in the proposed design, except that you now define the examples in the test file. I would even argue that the proposed design is more flexible and makes it very transparent which examples are used to test a given category.



---

archive/issue_comments_494116.json:
```json
{
    "body": "<a id='comment:38'>Comment 38:</a>\nReplying to [@mkoeppe](#comment%3A36):\n> Could you elaborate on this in the ticket description:\n> > Good support by IDE (auto completion, test discovery and easier invocation)\n\nDone.",
    "created_at": "2020-12-23T19:39:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494116",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:38'>Comment 38:</a>
Replying to [@mkoeppe](#comment%3A36):
> Could you elaborate on this in the ticket description:
> > Good support by IDE (auto completion, test discovery and easier invocation)

Done.



---

archive/issue_comments_494117.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -5,7 +5,7 @@\n - With this there also comes better error messages in case a test fails.\n - Easier onboarding of new Python developers\n - Clear separation of test methods vs production code. For example, the `test_*.py` files can easily be excluded from distribution.\n-- Good support by IDE (auto completion, test discovery and easier invocation)\n+- Good support by IDE (auto completion, test discovery and easier invocation). For example, VS code automatically discovers all pytest tests, provides a convenient interface to run them (all, subselection, only failed ones) and allows to directly start a debug session for a failing test. See https://code.visualstudio.com/docs/python/testing\n - Less and clearer code (no hidden assumptions)\n \n Disadvantages of this approach:\n``````\n",
    "created_at": "2020-12-23T19:39:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494117",
    "user": "https://github.com/tobiasdiez"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -5,7 +5,7 @@
 - With this there also comes better error messages in case a test fails.
 - Easier onboarding of new Python developers
 - Clear separation of test methods vs production code. For example, the `test_*.py` files can easily be excluded from distribution.
-- Good support by IDE (auto completion, test discovery and easier invocation)
+- Good support by IDE (auto completion, test discovery and easier invocation). For example, VS code automatically discovers all pytest tests, provides a convenient interface to run them (all, subselection, only failed ones) and allows to directly start a debug session for a failing test. See https://code.visualstudio.com/docs/python/testing
 - Less and clearer code (no hidden assumptions)
 
 Disadvantages of this approach:
``````




---

archive/issue_comments_494118.json:
```json
{
    "body": "<a id='comment:39'>Comment 39:</a>\nReplying to [@mkoeppe](#comment%3A35):\n> From \"advantages\" in the ticket description:\n> > Clear separation of test methods vs production code. For example, the test_*.py files can easily be excluded from distribution.\n\n> We definitely would not want to exclude them from the distribution! Also user-defined classes will want to run the test methods that are provided by the categories as part of their tests.\n\nProbably depends on the context. People using sagelib only as a (calculation) library may not need these tests. One could for example easily split them out into a new sage.testing package (or sage.categories.testing) once everything is modularized nicely.",
    "created_at": "2020-12-23T19:43:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494118",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:39'>Comment 39:</a>
Replying to [@mkoeppe](#comment%3A35):
> From "advantages" in the ticket description:
> > Clear separation of test methods vs production code. For example, the test_*.py files can easily be excluded from distribution.

> We definitely would not want to exclude them from the distribution! Also user-defined classes will want to run the test methods that are provided by the categories as part of their tests.

Probably depends on the context. People using sagelib only as a (calculation) library may not need these tests. One could for example easily split them out into a new sage.testing package (or sage.categories.testing) once everything is modularized nicely.



---

archive/issue_comments_494119.json:
```json
{
    "body": "<a id='comment:40'>Comment 40:</a>\nReplying to [@tobiasdiez](#comment%3A37):\n> Replying to [@mkoeppe](#comment%3A33):\n> > If I understand the proposed design correctly, for each category you would manually maintain a list of category instances to test.\n\n> \n> Yes, but that's not different from the current code. There you also create the examples and then run the testsuite (which makes sure to run the correct tests for this category). This is the same in the proposed design, except that you now define the examples in the test file.\n\nI think you may be missing that the category of an object is not statically known but is computed by code.",
    "created_at": "2020-12-23T19:47:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494119",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:40'>Comment 40:</a>
Replying to [@tobiasdiez](#comment%3A37):
> Replying to [@mkoeppe](#comment%3A33):
> > If I understand the proposed design correctly, for each category you would manually maintain a list of category instances to test.

> 
> Yes, but that's not different from the current code. There you also create the examples and then run the testsuite (which makes sure to run the correct tests for this category). This is the same in the proposed design, except that you now define the examples in the test file.

I think you may be missing that the category of an object is not statically known but is computed by code.



---

archive/issue_comments_494120.json:
```json
{
    "body": "<a id='comment:41'>Comment 41:</a>\nNo, I'm not. The `test_some_category.py` says only \"please check the category tests for the following examples\" and pytest automatically determines based on the category of these examples which tests to run. In fact, the latter is done here\n\n```\n+def pytest_pycollect_makeitem(collector: PyCollector, name: str, obj: type):\n+    if inspect.isclass(obj) and \"category_instances\" in dir(obj):\n+        # Enrich test class by functions from the corresponding category test class\n+        for category, category_test_class in categories_with_tests.items():\n+            if category() in obj.category_instances()[0].category().all_super_categories():\n+                methods= [method for method in dir(category_test_class)\n+                        if not method.startswith('__') and callable(getattr(category_test_class, method))]\n+            \n+                for method in methods:\n+                    setattr(obj, method, getattr(category_test_class, method))\n+\n+        return pytest.Class.from_parent(collector, name=name, obj=obj)\n+    else:\n+        return None\n```",
    "created_at": "2020-12-23T19:51:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494120",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:41'>Comment 41:</a>
No, I'm not. The `test_some_category.py` says only "please check the category tests for the following examples" and pytest automatically determines based on the category of these examples which tests to run. In fact, the latter is done here

```
+def pytest_pycollect_makeitem(collector: PyCollector, name: str, obj: type):
+    if inspect.isclass(obj) and "category_instances" in dir(obj):
+        # Enrich test class by functions from the corresponding category test class
+        for category, category_test_class in categories_with_tests.items():
+            if category() in obj.category_instances()[0].category().all_super_categories():
+                methods= [method for method in dir(category_test_class)
+                        if not method.startswith('__') and callable(getattr(category_test_class, method))]
+            
+                for method in methods:
+                    setattr(obj, method, getattr(category_test_class, method))
+
+        return pytest.Class.from_parent(collector, name=name, obj=obj)
+    else:
+        return None
```



---

archive/issue_comments_494121.json:
```json
{
    "body": "<a id='comment:42'>Comment 42:</a>\nOK, but how is this compatible with your design to list the test objects in `category_instances`?",
    "created_at": "2020-12-23T19:59:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494121",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:42'>Comment 42:</a>
OK, but how is this compatible with your design to list the test objects in `category_instances`?



---

archive/issue_comments_494122.json:
```json
{
    "body": "<a id='comment:43'>Comment 43:</a>\nThe design is as follows. Say you have a category `LieGroups` combining the categories `Manifolds` and `Groups`.\nThen you:\n1. Create `manifolds_test` and `groups_test` files, specifying the category tests that should hold for all objects of this category.\n2. Create a `liegroups_test` file, specifying in `category_instances` the examples of Lie groups you want to test, say `SO(3)` and `SU(2)`. Moreover, add test methods that are particular for the cateogory of Lie groups.\n\nWhen run, the code then looks at these examples, determines that they are objects of the categories Manifolds, Groups and Lie Groups and collects all tests from `manifolds_test`, `groups_test` and `liegroups_test`.\n\nThis can already be seen in action in the code, where the finite semigroups inhert tests from the category of sets and of finite sets.",
    "created_at": "2020-12-23T20:11:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494122",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:43'>Comment 43:</a>
The design is as follows. Say you have a category `LieGroups` combining the categories `Manifolds` and `Groups`.
Then you:
1. Create `manifolds_test` and `groups_test` files, specifying the category tests that should hold for all objects of this category.
2. Create a `liegroups_test` file, specifying in `category_instances` the examples of Lie groups you want to test, say `SO(3)` and `SU(2)`. Moreover, add test methods that are particular for the cateogory of Lie groups.

When run, the code then looks at these examples, determines that they are objects of the categories Manifolds, Groups and Lie Groups and collects all tests from `manifolds_test`, `groups_test` and `liegroups_test`.

This can already be seen in action in the code, where the finite semigroups inhert tests from the category of sets and of finite sets.



---

archive/issue_comments_494123.json:
```json
{
    "body": "<a id='comment:44'>Comment 44:</a>\nSo in the end it does not matter at all in which method `category_instances` an object is put?",
    "created_at": "2020-12-23T20:45:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494123",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:44'>Comment 44:</a>
So in the end it does not matter at all in which method `category_instances` an object is put?



---

archive/issue_comments_494124.json:
```json
{
    "body": "<a id='comment:45'>Comment 45:</a>\nReplying to [@tobiasdiez](#comment%3A43):\n> This can already be seen in action in the code, where the finite semigroups inhert tests from the category of sets and of finite sets.\n\nBut having `test_associativity` supplied by `TestFiniteSemigroup` surely can't be the final design?!",
    "created_at": "2020-12-23T20:54:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494124",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:45'>Comment 45:</a>
Replying to [@tobiasdiez](#comment%3A43):
> This can already be seen in action in the code, where the finite semigroups inhert tests from the category of sets and of finite sets.

But having `test_associativity` supplied by `TestFiniteSemigroup` surely can't be the final design?!



---

archive/issue_comments_494125.json:
```json
{
    "body": "<a id='comment:46'>Comment 46:</a>\nReplying to [@mkoeppe](#comment%3A44):\n> So in the end it does not matter at all in which method `category_instances` an object is put?\n\nNo, it doesn't really matter. One could also have one big test file listing all these examples. But I would advocate to have one test file for each category, because then one can easily also write additional tests (not related to the category framework). It's also consistent with the usual conventions where one usually has one test file for each module file.",
    "created_at": "2020-12-23T21:06:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494125",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:46'>Comment 46:</a>
Replying to [@mkoeppe](#comment%3A44):
> So in the end it does not matter at all in which method `category_instances` an object is put?

No, it doesn't really matter. One could also have one big test file listing all these examples. But I would advocate to have one test file for each category, because then one can easily also write additional tests (not related to the category framework). It's also consistent with the usual conventions where one usually has one test file for each module file.



---

archive/issue_comments_494126.json:
```json
{
    "body": "<a id='comment:47'>Comment 47:</a>\nReplying to [@mkoeppe](#comment%3A45):\n> But having `test_associativity` supplied by `TestFiniteSemigroup` surely can't be the final design?!\n\nI think this was a mistake on my side, it should be in a new test file for the \"Semigroup\" category.",
    "created_at": "2020-12-23T21:09:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494126",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:47'>Comment 47:</a>
Replying to [@mkoeppe](#comment%3A45):
> But having `test_associativity` supplied by `TestFiniteSemigroup` surely can't be the final design?!

I think this was a mistake on my side, it should be in a new test file for the "Semigroup" category.



---

archive/issue_comments_494127.json:
```json
{
    "body": "<a id='comment:48'>Comment 48:</a>\nReplying to [@tobiasdiez](#comment%3A46):\n> Replying to [@mkoeppe](#comment%3A44):\n> > So in the end it does not matter at all in which method `category_instances` an object is put?\n\n> \n> No, it doesn't really matter. One could also have one big test file listing all these examples. \n\nOK, this is an important clarification, thanks.\n\n> But I would advocate to have one test file for each category, because then one can easily also write additional tests (not related to the category framework). \n\nWould it not be better to have one test file for each module (... whose doctest currently has calls to `TestSuite`)? I really don't see what is gained by grouping the test objects by category -- which is coarser than how things are grouped currently (i.e., by module) and also arbitrary (because for join categories you would be making an arbitrary choice into which test file to put an object).",
    "created_at": "2020-12-23T21:28:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494127",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:48'>Comment 48:</a>
Replying to [@tobiasdiez](#comment%3A46):
> Replying to [@mkoeppe](#comment%3A44):
> > So in the end it does not matter at all in which method `category_instances` an object is put?

> 
> No, it doesn't really matter. One could also have one big test file listing all these examples. 

OK, this is an important clarification, thanks.

> But I would advocate to have one test file for each category, because then one can easily also write additional tests (not related to the category framework). 

Would it not be better to have one test file for each module (... whose doctest currently has calls to `TestSuite`)? I really don't see what is gained by grouping the test objects by category -- which is coarser than how things are grouped currently (i.e., by module) and also arbitrary (because for join categories you would be making an arbitrary choice into which test file to put an object).



---

archive/issue_comments_494128.json:
```json
{
    "body": "<a id='comment:49'>Comment 49:</a>\nReplying to [@mkoeppe](#comment%3A48):\n> Would it not be better to have one test file for each module (... whose doctest currently has calls to `TestSuite`)? I really don't see what is gained by grouping the test objects by category -- which is coarser than how things are grouped currently (i.e., by module) and also arbitrary (because for join categories you would be making an arbitrary choice into which test file to put an object).\n> \n\nIt depends on what you want to test. If you want to test that the implementation of the category is correct, you put it in the test file of the category. If you want to test the implementation of an example, you put it in the test file of the example.",
    "created_at": "2020-12-23T21:48:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494128",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:49'>Comment 49:</a>
Replying to [@mkoeppe](#comment%3A48):
> Would it not be better to have one test file for each module (... whose doctest currently has calls to `TestSuite`)? I really don't see what is gained by grouping the test objects by category -- which is coarser than how things are grouped currently (i.e., by module) and also arbitrary (because for join categories you would be making an arbitrary choice into which test file to put an object).
> 

It depends on what you want to test. If you want to test that the implementation of the category is correct, you put it in the test file of the category. If you want to test the implementation of an example, you put it in the test file of the example.



---

archive/issue_comments_494129.json:
```json
{
    "body": "<a id='comment:50'>Comment 50:</a>\nHello!\n\nThanks for bringing me in the conversation. It's been\nten years since I designed TestSuite (with the help\nfrom many). Since that time, Python and the available\ntesting tools have evolved a lot. I am\nglad to see efforts going into rethinking the design\nin this new context, questioning the implementation,\nand studying alternatives that would reach the\nsame design goals but better suit the context.\nEspecially toward using\nnow standard infrastructure and practice to reduce\nboth the technical debt and the entry barrier for\nnew devs and/or for integration with other software.",
    "created_at": "2020-12-23T22:37:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494129",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:50'>Comment 50:</a>
Hello!

Thanks for bringing me in the conversation. It's been
ten years since I designed TestSuite (with the help
from many). Since that time, Python and the available
testing tools have evolved a lot. I am
glad to see efforts going into rethinking the design
in this new context, questioning the implementation,
and studying alternatives that would reach the
same design goals but better suit the context.
Especially toward using
now standard infrastructure and practice to reduce
both the technical debt and the entry barrier for
new devs and/or for integration with other software.



---

archive/issue_comments_494130.json:
```json
{
    "body": "<a id='comment:51'>Comment 51:</a>\n(the rant may be a bit long, so I am splitting this into several comments).\n\nSo, what were these design goals:\n\n(I) Hardening library and user defined algebraic structures, and beyond\n\nThe tests are there for checking the internal consistency\nof category code and for checking that parents (and their\nelements, morphisms, ...) satisfy the specifications of their\ncategories (e.g. axioms). Supporting user defined algebraic structures is\na must. In my research area we routinely create new algebraic\nstructures, and when doing so TestSuite is a daily tool:\npractice has told me that, once the implementation of\nthat algebraic structure pass the testsuite, most of the time\nit's actually correct (certainly something that is research\narea dependent!).\n\nIn some cases, it even becomes a research tool: I am not\nsure whether the newly defined algebraic structure actually\nsatisfy the axioms I want it to satisfy, and I use TestSuite\nto actually run checks. And use post-mortem instrospection\nwith the debugger to actually recover the counter examples ot\nmy conjectures.\n\nThe next step in this direction is to work toward merging\nthe `_test_xxx` methods and `_is_xxx` methods: most of the time,\nthe code is mostly the same: checking whether axiom xxx is\nsatisfied. What changes is how thorough the test is, and\nhow failures are reported. I have toyed around with the idea\nwith prototypes in sage-semigroups. Alas I never got to actually\nconverge to a proposal for Sage. But this is something we want\nto keep in mind.",
    "created_at": "2020-12-23T22:58:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494130",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:51'>Comment 51:</a>
(the rant may be a bit long, so I am splitting this into several comments).

So, what were these design goals:

(I) Hardening library and user defined algebraic structures, and beyond

The tests are there for checking the internal consistency
of category code and for checking that parents (and their
elements, morphisms, ...) satisfy the specifications of their
categories (e.g. axioms). Supporting user defined algebraic structures is
a must. In my research area we routinely create new algebraic
structures, and when doing so TestSuite is a daily tool:
practice has told me that, once the implementation of
that algebraic structure pass the testsuite, most of the time
it's actually correct (certainly something that is research
area dependent!).

In some cases, it even becomes a research tool: I am not
sure whether the newly defined algebraic structure actually
satisfy the axioms I want it to satisfy, and I use TestSuite
to actually run checks. And use post-mortem instrospection
with the debugger to actually recover the counter examples ot
my conjectures.

The next step in this direction is to work toward merging
the `_test_xxx` methods and `_is_xxx` methods: most of the time,
the code is mostly the same: checking whether axiom xxx is
satisfied. What changes is how thorough the test is, and
how failures are reported. I have toyed around with the idea
with prototypes in sage-semigroups. Alas I never got to actually
converge to a proposal for Sage. But this is something we want
to keep in mind.



---

archive/issue_comments_494131.json:
```json
{
    "body": "<a id='comment:52'>Comment 52:</a>\nSomething else I want to clarify is that the category examples are generally meant to minimal working examples of what needs to be implemented for a particular category. However, some categories actually use other existing objects in Sage, which is something many of the categories do, but such a WME is not essential to defining a category.",
    "created_at": "2020-12-23T23:07:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494131",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:52'>Comment 52:</a>
Something else I want to clarify is that the category examples are generally meant to minimal working examples of what needs to be implemented for a particular category. However, some categories actually use other existing objects in Sage, which is something many of the categories do, but such a WME is not essential to defining a category.



---

archive/issue_comments_494132.json:
```json
{
    "body": "<a id='comment:53'>Comment 53:</a>\n(II) Categories as bookshelves of code, documentation and tests\n\nEach category models some algebraic realm. \nLike the bookshelf about Group Theory in a library,\nthe category of groups in GAP or Sage ties together\neverything that applies to all groups: code, documentation,\nand tests. In a perfect world where the same system would\nbe used for computations and proofs, I would include here\nmathematical statements (e.g. formulae for the axioms)\nand proofs! Then, there are subshelves for group elements,\ngroup morphisms, ... Subshelves for particular types of\ngroups, and so on.\n\nThere are several ways to implement that tying together.\nIn GAP, categories are a mere filters; each method is\ntied to a category through an individual declaration.\nAnd the language uses a bespoke method resolution that\ndata. In [SageMath](../wiki/SageMath) instead, we decided to rely on\nstandard OO method resolution, grouping together methods\nin classes. Both approaches have their advantages notably\nin terms of flexibility left to organize the code, and\nenable user extensions to existing categories.\n\n\nTwo features are required for testing purposes:\n\n(a) Recovering all the tests that one wants to run to check an object in category A\n\n(b) For each of them, resolving which test method is to be called. Indeed, a subcategory may overload a _test_xxx method when, for example, it has a more efficient way to check xxx.\n\n\nNote that (b) is of the same nature as when resolving a usual method call. It thus seems highly desirable to use the exact same resolution mechanism as for code.",
    "created_at": "2020-12-23T23:22:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494132",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:53'>Comment 53:</a>
(II) Categories as bookshelves of code, documentation and tests

Each category models some algebraic realm. 
Like the bookshelf about Group Theory in a library,
the category of groups in GAP or Sage ties together
everything that applies to all groups: code, documentation,
and tests. In a perfect world where the same system would
be used for computations and proofs, I would include here
mathematical statements (e.g. formulae for the axioms)
and proofs! Then, there are subshelves for group elements,
group morphisms, ... Subshelves for particular types of
groups, and so on.

There are several ways to implement that tying together.
In GAP, categories are a mere filters; each method is
tied to a category through an individual declaration.
And the language uses a bespoke method resolution that
data. In [SageMath](../wiki/SageMath) instead, we decided to rely on
standard OO method resolution, grouping together methods
in classes. Both approaches have their advantages notably
in terms of flexibility left to organize the code, and
enable user extensions to existing categories.


Two features are required for testing purposes:

(a) Recovering all the tests that one wants to run to check an object in category A

(b) For each of them, resolving which test method is to be called. Indeed, a subcategory may overload a _test_xxx method when, for example, it has a more efficient way to check xxx.


Note that (b) is of the same nature as when resolving a usual method call. It thus seems highly desirable to use the exact same resolution mechanism as for code.



---

archive/issue_comments_494133.json:
```json
{
    "body": "<a id='comment:54'>Comment 54:</a>\n(III) Scalability\n\nNothing much to say here: whatever design is chosen should scale to\nthe rich hierarchy of categories in [SageMath](../wiki/SageMath), with all the mantras\n(axioms, ...) that were implemented to support that richness.\n\nA critical bit is to satisfy as much as possible the Single Source\nOf Truth principle. E.g. if at some point I want to refine the\ncategory of a parent (e.g. because a new category was created),\nI should only need to update a single location in the code.",
    "created_at": "2020-12-23T23:31:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494133",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:54'>Comment 54:</a>
(III) Scalability

Nothing much to say here: whatever design is chosen should scale to
the rich hierarchy of categories in [SageMath](../wiki/SageMath), with all the mantras
(axioms, ...) that were implemented to support that richness.

A critical bit is to satisfy as much as possible the Single Source
Of Truth principle. E.g. if at some point I want to refine the
category of a parent (e.g. because a new category was created),
I should only need to update a single location in the code.



---

archive/issue_comments_494134.json:
```json
{
    "body": "<a id='comment:55'>Comment 55:</a>\nSorry for the rant; I am trying to clarify for myself what\nguided -- implicitly or explicitly -- the design back then :-)\nHopefully this is useful food for thought for a redesign.",
    "created_at": "2020-12-23T23:39:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494134",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:55'>Comment 55:</a>
Sorry for the rant; I am trying to clarify for myself what
guided -- implicitly or explicitly -- the design back then :-)
Hopefully this is useful food for thought for a redesign.



---

archive/issue_comments_494135.json:
```json
{
    "body": "<a id='comment:56'>Comment 56:</a>\nOh, one piece of information in case it would be relevant: for the longest time\nit's been on my pile to instrument TestSuite so that, by running the Sage\ntests, one would get a relatively thorough list of all Sage parents together\nwith their categories.\n\nA typical applications would be to enable inverse lookup: given a category, suggest to the user a relatively thorough list of parents implementing that category; e.g. for documentation purposes.",
    "created_at": "2020-12-23T23:44:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494135",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:56'>Comment 56:</a>
Oh, one piece of information in case it would be relevant: for the longest time
it's been on my pile to instrument TestSuite so that, by running the Sage
tests, one would get a relatively thorough list of all Sage parents together
with their categories.

A typical applications would be to enable inverse lookup: given a category, suggest to the user a relatively thorough list of parents implementing that category; e.g. for documentation purposes.



---

archive/issue_comments_494136.json:
```json
{
    "body": "<a id='comment:57'>Comment 57:</a>\nOh, that's wonderful feedback! This kind of deep insight is hard to get if you only read the existing code and don't know the story behind it's origin. Thanks a lot for your detailed account.\n\nPlease don't take this proposal as a critics of your work on the TestSuite. I was actually amazed when I discovered that Sage has it's own testing framework. The main idea behind this ticket was to outsource the cost of maintenance of such a framework to the broader Python community, so that we can focus on the math-related elements.\n\nConcerning your points, I'm happy to report that the proposed design should fit all the points you mentioned. In short:\n\n(I): It is flexible enough to accommodate new user-defined categories and examples.\n\n(II): It relies on pytest's discovery mechanism, which makes it very transparent which tests are run for a given category object.\n\n(III): Scalability is a bit hard to judge for me, since I'm not that familiar with all the possible edge cases. But so far I had no problems migrating the existing code.\nIn particular, the \"single source of truth principle\" applies, since the testing code only relies on the calculated super categories.\n\n\nHence, I would like to invite you to play around with the new design and see if it's works for your use cases. Basic documentation about pytest is added in #31003. Let me know if you encounter any problems.\n\nMerry Christmas!",
    "created_at": "2020-12-24T11:18:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494136",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:57'>Comment 57:</a>
Oh, that's wonderful feedback! This kind of deep insight is hard to get if you only read the existing code and don't know the story behind it's origin. Thanks a lot for your detailed account.

Please don't take this proposal as a critics of your work on the TestSuite. I was actually amazed when I discovered that Sage has it's own testing framework. The main idea behind this ticket was to outsource the cost of maintenance of such a framework to the broader Python community, so that we can focus on the math-related elements.

Concerning your points, I'm happy to report that the proposed design should fit all the points you mentioned. In short:

(I): It is flexible enough to accommodate new user-defined categories and examples.

(II): It relies on pytest's discovery mechanism, which makes it very transparent which tests are run for a given category object.

(III): Scalability is a bit hard to judge for me, since I'm not that familiar with all the possible edge cases. But so far I had no problems migrating the existing code.
In particular, the "single source of truth principle" applies, since the testing code only relies on the calculated super categories.


Hence, I would like to invite you to play around with the new design and see if it's works for your use cases. Basic documentation about pytest is added in #31003. Let me know if you encounter any problems.

Merry Christmas!



---

archive/issue_events_391868.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-12-29T09:25:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30738#event-391868"
}
```



---

archive/issue_events_391869.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-12-29T09:25:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30738#event-391869"
}
```



---

archive/issue_comments_494137.json:
```json
{
    "body": "<a id='comment:58'>Comment 58:</a>\nRed branch.",
    "created_at": "2020-12-29T09:25:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494137",
    "user": "https://github.com/kliem"
}
```

<a id='comment:58'>Comment 58:</a>
Red branch.



---

archive/issue_comments_494138.json:
```json
{
    "body": "Changed commit from **[1488582](https://github.com/sagemath/sagetrac-mirror/commit/1488582a6c48583565f28432a465cbc0ea40d314)** to **[7692b09](https://github.com/sagemath/sagetrac-mirror/commit/7692b09eb35b21cc38a326a49bff2f2f241d2fb4)**",
    "created_at": "2020-12-29T10:15:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494138",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[1488582](https://github.com/sagemath/sagetrac-mirror/commit/1488582a6c48583565f28432a465cbc0ea40d314)** to **[7692b09](https://github.com/sagemath/sagetrac-mirror/commit/7692b09eb35b21cc38a326a49bff2f2f241d2fb4)**



---

archive/issue_comments_494139.json:
```json
{
    "body": "<a id='comment:59'>Comment 59:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7692b09eb35b21cc38a326a49bff2f2f241d2fb4\">7692b09</a></td><td><code>Merge branch 'develop' of git://github.com/sagemath/sage into public/refactoring/pytest</code></td></tr></table>\n",
    "created_at": "2020-12-29T10:15:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494139",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:59'>Comment 59:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7692b09eb35b21cc38a326a49bff2f2f241d2fb4">7692b09</a></td><td><code>Merge branch 'develop' of git://github.com/sagemath/sage into public/refactoring/pytest</code></td></tr></table>




---

archive/issue_comments_494140.json:
```json
{
    "body": "<a id='comment:60'>Comment 60:</a>\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7692b09eb35b21cc38a326a49bff2f2f241d2fb4\">7692b09</a></td><td><code>Merge branch 'develop' of git://github.com/sagemath/sage into public/refactoring/pytest</code></td></tr></table>\n",
    "created_at": "2020-12-29T10:15:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494140",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:60'>Comment 60:</a>
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7692b09eb35b21cc38a326a49bff2f2f241d2fb4">7692b09</a></td><td><code>Merge branch 'develop' of git://github.com/sagemath/sage into public/refactoring/pytest</code></td></tr></table>




---

archive/issue_comments_494141.json:
```json
{
    "body": "Changed dependencies from **#30748, #30901** to none",
    "created_at": "2020-12-29T10:15:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494141",
    "user": "https://github.com/tobiasdiez"
}
```

Changed dependencies from **#30748, #30901** to none



---

archive/issue_events_391870.json:
```json
{
    "actor": "https://github.com/tobiasdiez",
    "created_at": "2020-12-29T10:15:55Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30738#event-391870"
}
```



---

archive/issue_events_391871.json:
```json
{
    "actor": "https://github.com/tobiasdiez",
    "created_at": "2020-12-29T10:15:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30738#event-391871"
}
```



---

archive/issue_comments_494142.json:
```json
{
    "body": "Changed commit from **[7692b09](https://github.com/sagemath/sagetrac-mirror/commit/7692b09eb35b21cc38a326a49bff2f2f241d2fb4)** to **[de78054](https://github.com/sagemath/sagetrac-mirror/commit/de780549b6b6baba9e14798595eb3f5091c574d4)**",
    "created_at": "2020-12-29T10:20:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494142",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[7692b09](https://github.com/sagemath/sagetrac-mirror/commit/7692b09eb35b21cc38a326a49bff2f2f241d2fb4)** to **[de78054](https://github.com/sagemath/sagetrac-mirror/commit/de780549b6b6baba9e14798595eb3f5091c574d4)**



---

archive/issue_comments_494143.json:
```json
{
    "body": "<a id='comment:61'>Comment 61:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3d5dd33a13df4519ca454591fdae190a6fdd7e25\">3d5dd33</a></td><td><code>Revert \"Remove lazy import finish startup\"</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/de780549b6b6baba9e14798595eb3f5091c574d4\">de78054</a></td><td><code>Revert \"Use context manager\"</code></td></tr></table>\n",
    "created_at": "2020-12-29T10:20:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494143",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:61'>Comment 61:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3d5dd33a13df4519ca454591fdae190a6fdd7e25">3d5dd33</a></td><td><code>Revert "Remove lazy import finish startup"</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/de780549b6b6baba9e14798595eb3f5091c574d4">de78054</a></td><td><code>Revert "Use context manager"</code></td></tr></table>




---

archive/issue_comments_494144.json:
```json
{
    "body": "<a id='comment:62'>Comment 62:</a>\nMerged develop branch and removed the (unnecessary) dependencies.",
    "created_at": "2020-12-29T10:21:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494144",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:62'>Comment 62:</a>
Merged develop branch and removed the (unnecessary) dependencies.



---

archive/issue_events_391872.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-15T22:07:04Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30738#event-391872"
}
```



---

archive/issue_events_391873.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-15T22:07:04Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30738#event-391873"
}
```



---

archive/issue_comments_494145.json:
```json
{
    "body": "<a id='comment:63'>Comment 63:</a>\nSetting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-03-15T22:07:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494145",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:63'>Comment 63:</a>
Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_comments_494146.json:
```json
{
    "body": "<a id='comment:64'>Comment 64:</a>\nred branch => needs work",
    "created_at": "2021-07-13T13:15:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494146",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:64'>Comment 64:</a>
red branch => needs work



---

archive/issue_events_391874.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2021-07-13T13:15:19Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30738#event-391874"
}
```



---

archive/issue_events_391875.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2021-07-13T13:15:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30738#event-391875"
}
```



---

archive/issue_events_391876.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T02:58:13Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30738#event-391876"
}
```



---

archive/issue_events_391877.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T02:58:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30738#event-391877"
}
```



---

archive/issue_comments_494147.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -37,9 +37,7 @@\n \n TOOD (as follow-up tickets):\n - Complete migration of tests to pytest\n-- Integrate `pytest` in `sage -t` and tox\n-- Call `pytest` as part of the build process so that the newly added tests are found and checked\n-- After the migration is done, remove invoking the `TestSuit` in the doctests and remove the `TestSuit` class.\n+- After the migration is done, remove invoking the `TestSuite` in the doctests and remove the `TestSuite` class.\n \n ---\n \n``````\n",
    "created_at": "2021-11-28T17:11:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494147",
    "user": "https://github.com/tobiasdiez"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -37,9 +37,7 @@
 
 TOOD (as follow-up tickets):
 - Complete migration of tests to pytest
-- Integrate `pytest` in `sage -t` and tox
-- Call `pytest` as part of the build process so that the newly added tests are found and checked
-- After the migration is done, remove invoking the `TestSuit` in the doctests and remove the `TestSuit` class.
+- After the migration is done, remove invoking the `TestSuite` in the doctests and remove the `TestSuite` class.
 
 ---
 
``````




---

archive/issue_comments_494148.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -4,47 +4,73 @@\n - Reuse standard test infrastructure instead of a custom test discovery interface (this is a big plus as we do not have to maintain it ourself, especially given the large list of todo's in the TestSuite code)\n - With this there also comes better error messages in case a test fails.\n - Easier onboarding of new Python developers\n-- Clear separation of test methods vs production code. For example, the `test_*.py` files can easily be excluded from distribution.\n+- Clear separation of test methods vs production code. For example, the `*_test.py` files can easily be excluded from distribution.\n - Good support by IDE (auto completion, test discovery and easier invocation). For example, VS code automatically discovers all pytest tests, provides a convenient interface to run them (all, subselection, only failed ones) and allows to directly start a debug session for a failing test. See https://code.visualstudio.com/docs/python/testing\n - Less and clearer code (no hidden assumptions)\n \n Disadvantages of this approach:\n-- Current developer have to learn the new conventions (files need to be named `test_*.py` and tests methods need to start with `test_`) and pytest\n+- Current developer have to learn the new conventions (files need to be named `*_test.py` and tests methods need to start with `test_`) and pytest\n - Tests no longer live in the same file as the code (I would say this is an advantage, but some people may prefer to have them really close together).\n \n In order to migrate the following changes are necessary:\n-- Move `_test_xyz` from a category `module` to new file `test_module` (e.g. `test_sets_cat`)\n+- Move `_test_xyz` from a category `module` to new file `<module>_test.py` (e.g. `finite_semigroups_test.py`)\n - Rewrite test using pytest (which is straightforward and more or less only amounts to removing all the custom code involving `self_tester`)\n-- Create a new test class for the parent class under test (e.g `test_finite_semigroups`)\n+- Create a new test class for the parent class under test (e.g `TestFiniteSemigroup`)\n - Create a static method `category_instances()` in this test class returning a list of instances to test.\n \n For the moment, I did this only for two test methods in `sets_cat` to illustrate the process.\n \n The new implementation is as follows:\n-- The test class for the category (e.g. `test_sets_cat`) defines generic tests that should pass for every object in that category.\n-- For every object in the category there is a test class (e.g. `test_finite_semigroups`) that provides instances to test via the method `category_instances`\n-- Running pytest finds the test class `test_finite_semigroups`, then determines the categories of the object and adds all generic test methods for that category to the test class (this happens in `conftest.py`).\n+- The test class for the category (e.g. in `sets_cat_test.py`) defines generic tests that should pass for every object in that category. Moreover, the test class may provides instances (objects) to test via the method `category_instances`.\n+- Running pytest finds the test file `finite_semigroups_test.py`, then determines the categories of the objects (returned from `category_instances`) and adds all generic test methods for that category to the test class (this happens in `conftest.py`).\n - Each test method can have the parameter `category_instance` which is bound to the return value of the `category_instances` method.\n-- Thus, the output is as follows:\n+\n+Running `cd src && pytest --verbose` (from a virtual env with sage and pytest installed), the output is as follows:\n \n ```\n-sage/categories/test_finite_semigroups.py::TestFiniteSemigroup::test_element_eq_reflexive[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED [ 25%]\n-sage/categories/test_finite_semigroups.py::TestFiniteSemigroup::test_element_eq_reflexive[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED [ 50%]\n-sage/categories/test_finite_semigroups.py::TestFiniteSemigroup::test_cardinality_return_type[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED [ 75%]\n-sage/categories/test_finite_semigroups.py::TestFiniteSemigroup::test_cardinality_return_type[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED [100%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_contains[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                         [  2%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_contains[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                    [  4%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_contains[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                               [  6%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_iter_list[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                        [  8%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_iter_list[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                   [ 10%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_iter_list[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                              [ 13%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_iter_cardinality[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                 [ 15%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_iter_cardinality[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                            [ 17%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_iter_cardinality[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                       [ 19%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_associativity[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                                   [ 21%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_associativity[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                              [ 23%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_associativity[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                         [ 26%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_an_element[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                                      [ 28%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_an_element[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                                 [ 30%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_an_element[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                            [ 32%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_an_element_idempotent[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                           [ 34%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_an_element_idempotent[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                      [ 36%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_an_element_idempotent[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                 [ 39%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_cardinality_return_type[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                         [ 41%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_cardinality_return_type[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                    [ 43%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_cardinality_return_type[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                               [ 45%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_construction[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                                    [ 47%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_construction[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                               [ 50%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_construction[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                          [ 52%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_element_eq_reflexive[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                            [ 54%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_element_eq_reflexive[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                       [ 56%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_element_eq_reflexive[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                  [ 58%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_eq_symmetric[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                           [ 60%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_eq_symmetric[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                      [ 63%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_eq_symmetric[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                 [ 65%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_eq_transitive[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                          [ 67%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_eq_transitive[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                     [ 69%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_eq_transitive[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                [ 71%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_neq[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                                    [ 73%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_neq[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                               [ 76%]\n+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_neq[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                          [ 78%]\n+...\n ```\n+As one can see, each general test method is invoked for the three examples.\n \n \n TOOD (as follow-up tickets):\n - Complete migration of tests to pytest\n - After the migration is done, remove invoking the `TestSuite` in the doctests and remove the `TestSuite` class.\n \n----\n \n-By default, pytest implements the following standard test discovery:\n-\n-- Search for `test_*.py` or `*_test.py` files (I would stick to the `test` prefix).\n-- From those files, collect test items:\n-   - Functions or methods with prefix `test`\n-   - If the functions are inside of classes, then the class name has to start with `test` as well.\n-\n``````\n",
    "created_at": "2021-11-28T17:42:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494148",
    "user": "https://github.com/tobiasdiez"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -4,47 +4,73 @@
 - Reuse standard test infrastructure instead of a custom test discovery interface (this is a big plus as we do not have to maintain it ourself, especially given the large list of todo's in the TestSuite code)
 - With this there also comes better error messages in case a test fails.
 - Easier onboarding of new Python developers
-- Clear separation of test methods vs production code. For example, the `test_*.py` files can easily be excluded from distribution.
+- Clear separation of test methods vs production code. For example, the `*_test.py` files can easily be excluded from distribution.
 - Good support by IDE (auto completion, test discovery and easier invocation). For example, VS code automatically discovers all pytest tests, provides a convenient interface to run them (all, subselection, only failed ones) and allows to directly start a debug session for a failing test. See https://code.visualstudio.com/docs/python/testing
 - Less and clearer code (no hidden assumptions)
 
 Disadvantages of this approach:
-- Current developer have to learn the new conventions (files need to be named `test_*.py` and tests methods need to start with `test_`) and pytest
+- Current developer have to learn the new conventions (files need to be named `*_test.py` and tests methods need to start with `test_`) and pytest
 - Tests no longer live in the same file as the code (I would say this is an advantage, but some people may prefer to have them really close together).
 
 In order to migrate the following changes are necessary:
-- Move `_test_xyz` from a category `module` to new file `test_module` (e.g. `test_sets_cat`)
+- Move `_test_xyz` from a category `module` to new file `<module>_test.py` (e.g. `finite_semigroups_test.py`)
 - Rewrite test using pytest (which is straightforward and more or less only amounts to removing all the custom code involving `self_tester`)
-- Create a new test class for the parent class under test (e.g `test_finite_semigroups`)
+- Create a new test class for the parent class under test (e.g `TestFiniteSemigroup`)
 - Create a static method `category_instances()` in this test class returning a list of instances to test.
 
 For the moment, I did this only for two test methods in `sets_cat` to illustrate the process.
 
 The new implementation is as follows:
-- The test class for the category (e.g. `test_sets_cat`) defines generic tests that should pass for every object in that category.
-- For every object in the category there is a test class (e.g. `test_finite_semigroups`) that provides instances to test via the method `category_instances`
-- Running pytest finds the test class `test_finite_semigroups`, then determines the categories of the object and adds all generic test methods for that category to the test class (this happens in `conftest.py`).
+- The test class for the category (e.g. in `sets_cat_test.py`) defines generic tests that should pass for every object in that category. Moreover, the test class may provides instances (objects) to test via the method `category_instances`.
+- Running pytest finds the test file `finite_semigroups_test.py`, then determines the categories of the objects (returned from `category_instances`) and adds all generic test methods for that category to the test class (this happens in `conftest.py`).
 - Each test method can have the parameter `category_instance` which is bound to the return value of the `category_instances` method.
-- Thus, the output is as follows:
+
+Running `cd src && pytest --verbose` (from a virtual env with sage and pytest installed), the output is as follows:
 
 ```
-sage/categories/test_finite_semigroups.py::TestFiniteSemigroup::test_element_eq_reflexive[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED [ 25%]
-sage/categories/test_finite_semigroups.py::TestFiniteSemigroup::test_element_eq_reflexive[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED [ 50%]
-sage/categories/test_finite_semigroups.py::TestFiniteSemigroup::test_cardinality_return_type[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED [ 75%]
-sage/categories/test_finite_semigroups.py::TestFiniteSemigroup::test_cardinality_return_type[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED [100%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_contains[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                         [  2%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_contains[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                    [  4%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_contains[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                               [  6%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_iter_list[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                        [  8%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_iter_list[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                   [ 10%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_iter_list[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                              [ 13%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_iter_cardinality[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                 [ 15%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_iter_cardinality[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                            [ 17%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_enumerated_set_iter_cardinality[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                       [ 19%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_associativity[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                                   [ 21%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_associativity[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                              [ 23%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_associativity[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                         [ 26%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_an_element[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                                      [ 28%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_an_element[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                                 [ 30%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_an_element[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                            [ 32%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_an_element_idempotent[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                           [ 34%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_an_element_idempotent[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                      [ 36%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_an_element_idempotent[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                 [ 39%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_cardinality_return_type[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                         [ 41%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_cardinality_return_type[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                    [ 43%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_cardinality_return_type[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                               [ 45%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_construction[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                                    [ 47%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_construction[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                               [ 50%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_construction[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                          [ 52%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_element_eq_reflexive[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                            [ 54%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_element_eq_reflexive[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                       [ 56%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_element_eq_reflexive[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                  [ 58%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_eq_symmetric[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                           [ 60%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_eq_symmetric[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                      [ 63%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_eq_symmetric[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                 [ 65%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_eq_transitive[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                          [ 67%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_eq_transitive[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                     [ 69%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_eq_transitive[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                [ 71%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_neq[An example of a finite semigroup: the left regular band generated by ('a', 'b')] PASSED                                                                    [ 73%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_neq[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c')] PASSED                                                               [ 76%]
+sage/categories/finite_semigroups_test.py::TestFiniteSemigroup::test_elements_neq[An example of a finite semigroup: the left regular band generated by ('a', 'b', 'c', 'd')] PASSED                                                          [ 78%]
+...
 ```
+As one can see, each general test method is invoked for the three examples.
 
 
 TOOD (as follow-up tickets):
 - Complete migration of tests to pytest
 - After the migration is done, remove invoking the `TestSuite` in the doctests and remove the `TestSuite` class.
 
----
 
-By default, pytest implements the following standard test discovery:
-
-- Search for `test_*.py` or `*_test.py` files (I would stick to the `test` prefix).
-- From those files, collect test items:
-   - Functions or methods with prefix `test`
-   - If the functions are inside of classes, then the class name has to start with `test` as well.
-
``````




---

archive/issue_events_391878.json:
```json
{
    "actor": "https://github.com/tobiasdiez",
    "created_at": "2021-11-28T17:42:25Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30738#event-391878"
}
```



---

archive/issue_events_391879.json:
```json
{
    "actor": "https://github.com/tobiasdiez",
    "created_at": "2021-11-28T17:42:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30738#event-391879"
}
```



---

archive/issue_comments_494149.json:
```json
{
    "body": "<a id='comment:67'>Comment 67:</a>\nRebased, so ready-for-review again.",
    "created_at": "2021-11-28T17:42:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494149",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:67'>Comment 67:</a>
Rebased, so ready-for-review again.



---

archive/issue_comments_494150.json:
```json
{
    "body": "<a id='comment:68'>Comment 68:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6d4152d6c198dd3863561efc25a67cd7b5f06202\">6d4152d</a></td><td><code>Merge branch 'develop' of https://github.com/sagemath/sage into public/refactoring/pytest</code></td></tr></table>\n",
    "created_at": "2021-11-28T17:42:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494150",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:68'>Comment 68:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6d4152d6c198dd3863561efc25a67cd7b5f06202">6d4152d</a></td><td><code>Merge branch 'develop' of https://github.com/sagemath/sage into public/refactoring/pytest</code></td></tr></table>




---

archive/issue_comments_494151.json:
```json
{
    "body": "Changed commit from **[de78054](https://github.com/sagemath/sagetrac-mirror/commit/de780549b6b6baba9e14798595eb3f5091c574d4)** to **[6d4152d](https://github.com/sagemath/sagetrac-mirror/commit/6d4152d6c198dd3863561efc25a67cd7b5f06202)**",
    "created_at": "2021-11-28T17:42:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494151",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[de78054](https://github.com/sagemath/sagetrac-mirror/commit/de780549b6b6baba9e14798595eb3f5091c574d4)** to **[6d4152d](https://github.com/sagemath/sagetrac-mirror/commit/6d4152d6c198dd3863561efc25a67cd7b5f06202)**



---

archive/issue_comments_494152.json:
```json
{
    "body": "<a id='comment:69'>Comment 69:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2cef6374eaad61ce0739c7a37987c69e0185dfbe\">2cef637</a></td><td><code>Remove test output</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/161e2f4b4bf21ffbbc7bceb7fe085def84350e7c\">161e2f4</a></td><td><code>Reorder imports</code></td></tr></table>\n",
    "created_at": "2021-11-28T17:46:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494152",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:69'>Comment 69:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2cef6374eaad61ce0739c7a37987c69e0185dfbe">2cef637</a></td><td><code>Remove test output</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/161e2f4b4bf21ffbbc7bceb7fe085def84350e7c">161e2f4</a></td><td><code>Reorder imports</code></td></tr></table>




---

archive/issue_comments_494153.json:
```json
{
    "body": "Changed commit from **[6d4152d](https://github.com/sagemath/sagetrac-mirror/commit/6d4152d6c198dd3863561efc25a67cd7b5f06202)** to **[161e2f4](https://github.com/sagemath/sagetrac-mirror/commit/161e2f4b4bf21ffbbc7bceb7fe085def84350e7c)**",
    "created_at": "2021-11-28T17:46:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494153",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[6d4152d](https://github.com/sagemath/sagetrac-mirror/commit/6d4152d6c198dd3863561efc25a67cd7b5f06202)** to **[161e2f4](https://github.com/sagemath/sagetrac-mirror/commit/161e2f4b4bf21ffbbc7bceb7fe085def84350e7c)**



---

archive/issue_comments_494154.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -18,7 +18,7 @@\n - Create a new test class for the parent class under test (e.g `TestFiniteSemigroup`)\n - Create a static method `category_instances()` in this test class returning a list of instances to test.\n \n-For the moment, I did this only for two test methods in `sets_cat` to illustrate the process.\n+For the moment, I did this only for a few test methods in `sets_cat` using finite semigroups as example to illustrate the process.\n \n The new implementation is as follows:\n - The test class for the category (e.g. in `sets_cat_test.py`) defines generic tests that should pass for every object in that category. Moreover, the test class may provides instances (objects) to test via the method `category_instances`.\n``````\n",
    "created_at": "2021-11-28T17:47:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494154",
    "user": "https://github.com/tobiasdiez"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -18,7 +18,7 @@
 - Create a new test class for the parent class under test (e.g `TestFiniteSemigroup`)
 - Create a static method `category_instances()` in this test class returning a list of instances to test.
 
-For the moment, I did this only for two test methods in `sets_cat` to illustrate the process.
+For the moment, I did this only for a few test methods in `sets_cat` using finite semigroups as example to illustrate the process.
 
 The new implementation is as follows:
 - The test class for the category (e.g. in `sets_cat_test.py`) defines generic tests that should pass for every object in that category. Moreover, the test class may provides instances (objects) to test via the method `category_instances`.
``````




---

archive/issue_comments_494155.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,21 +1,21 @@\n-Currently, the sage code contains `_test_xyz` methods that are invoked via doctests and discovered via a custom `TestSuit` class. In this ticket, we are proposing to replace this custom designed test discovery by using the established pytest framework https://docs.pytest.org/ (this is inline with #28936 - using mainstraim Python test infrastructure).\n+Currently, Sage code contains `_test_xyz` methods that are invoked via doctests and discovered via a custom `TestSuite` class. This ticket is to replace this custom test discovery by the use of the established **pytest** framework https://docs.pytest.org/ (this is in line with #28936 - using mainstream Python test infrastructure).\n \n Advantages of this approach:\n-- Reuse standard test infrastructure instead of a custom test discovery interface (this is a big plus as we do not have to maintain it ourself, especially given the large list of todo's in the TestSuite code)\n-- With this there also comes better error messages in case a test fails.\n-- Easier onboarding of new Python developers\n+- Reuse standard test infrastructure instead of a custom test discovery interface (this is a big maintenance relief, especially given the large list of todos in the `TestSuite` code).\n+- Better error messages in case a test fails.\n+- Easier onboarding of new Python developers.\n - Clear separation of test methods vs production code. For example, the `*_test.py` files can easily be excluded from distribution.\n-- Good support by IDE (auto completion, test discovery and easier invocation). For example, VS code automatically discovers all pytest tests, provides a convenient interface to run them (all, subselection, only failed ones) and allows to directly start a debug session for a failing test. See https://code.visualstudio.com/docs/python/testing\n-- Less and clearer code (no hidden assumptions)\n+- Good support by IDEs (auto completion, test discovery and easier invocation). For example, VSCode automatically discovers all pytest tests, provides a convenient interface to run them (all, a selection, only failed ones) and allows to directly start a debug session for a failing test. See https://code.visualstudio.com/docs/python/testing\n+- Less and clearer code (no hidden assumptions).\n \n Disadvantages of this approach:\n-- Current developer have to learn the new conventions (files need to be named `*_test.py` and tests methods need to start with `test_`) and pytest\n-- Tests no longer live in the same file as the code (I would say this is an advantage, but some people may prefer to have them really close together).\n+- Current developers have to learn pytest and its conventions (files must be named `*_test.py` and test methods must start with `test_`).\n+- Tests no longer live in the same file as the code (I would call this an advantage, but some people may prefer to have them really close together).\n \n-In order to migrate the following changes are necessary:\n-- Move `_test_xyz` from a category `module` to new file `<module>_test.py` (e.g. `finite_semigroups_test.py`)\n-- Rewrite test using pytest (which is straightforward and more or less only amounts to removing all the custom code involving `self_tester`)\n-- Create a new test class for the parent class under test (e.g `TestFiniteSemigroup`)\n+In order to migrate, the following changes are necessary:\n+- Move `_test_xyz` from a category `module` to new file `<module>_test.py` (e.g. `finite_semigroups_test.py`).\n+- Rewrite tests using pytest (which is straightforward and more or less only amounts to removing all the custom code involving `self_tester`).\n+- Create a new test class for the parent class under test (e.g `TestFiniteSemigroup`).\n - Create a static method `category_instances()` in this test class returning a list of instances to test.\n \n For the moment, I did this only for a few test methods in `sets_cat` using finite semigroups as example to illustrate the process.\n@@ -69,8 +69,8 @@\n As one can see, each general test method is invoked for the three examples.\n \n \n-TOOD (as follow-up tickets):\n-- Complete migration of tests to pytest\n-- After the migration is done, remove invoking the `TestSuite` in the doctests and remove the `TestSuite` class.\n+TODO (in follow-up tickets):\n+- Complete migration to pytest.\n+- Once that is done, stop invoking `TestSuite` in doctests and remove the `TestSuite` class.\n \n \n``````\n",
    "created_at": "2021-12-09T23:10:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494155",
    "user": "https://github.com/slel"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,21 +1,21 @@
-Currently, the sage code contains `_test_xyz` methods that are invoked via doctests and discovered via a custom `TestSuit` class. In this ticket, we are proposing to replace this custom designed test discovery by using the established pytest framework https://docs.pytest.org/ (this is inline with #28936 - using mainstraim Python test infrastructure).
+Currently, Sage code contains `_test_xyz` methods that are invoked via doctests and discovered via a custom `TestSuite` class. This ticket is to replace this custom test discovery by the use of the established **pytest** framework https://docs.pytest.org/ (this is in line with #28936 - using mainstream Python test infrastructure).
 
 Advantages of this approach:
-- Reuse standard test infrastructure instead of a custom test discovery interface (this is a big plus as we do not have to maintain it ourself, especially given the large list of todo's in the TestSuite code)
-- With this there also comes better error messages in case a test fails.
-- Easier onboarding of new Python developers
+- Reuse standard test infrastructure instead of a custom test discovery interface (this is a big maintenance relief, especially given the large list of todos in the `TestSuite` code).
+- Better error messages in case a test fails.
+- Easier onboarding of new Python developers.
 - Clear separation of test methods vs production code. For example, the `*_test.py` files can easily be excluded from distribution.
-- Good support by IDE (auto completion, test discovery and easier invocation). For example, VS code automatically discovers all pytest tests, provides a convenient interface to run them (all, subselection, only failed ones) and allows to directly start a debug session for a failing test. See https://code.visualstudio.com/docs/python/testing
-- Less and clearer code (no hidden assumptions)
+- Good support by IDEs (auto completion, test discovery and easier invocation). For example, VSCode automatically discovers all pytest tests, provides a convenient interface to run them (all, a selection, only failed ones) and allows to directly start a debug session for a failing test. See https://code.visualstudio.com/docs/python/testing
+- Less and clearer code (no hidden assumptions).
 
 Disadvantages of this approach:
-- Current developer have to learn the new conventions (files need to be named `*_test.py` and tests methods need to start with `test_`) and pytest
-- Tests no longer live in the same file as the code (I would say this is an advantage, but some people may prefer to have them really close together).
+- Current developers have to learn pytest and its conventions (files must be named `*_test.py` and test methods must start with `test_`).
+- Tests no longer live in the same file as the code (I would call this an advantage, but some people may prefer to have them really close together).
 
-In order to migrate the following changes are necessary:
-- Move `_test_xyz` from a category `module` to new file `<module>_test.py` (e.g. `finite_semigroups_test.py`)
-- Rewrite test using pytest (which is straightforward and more or less only amounts to removing all the custom code involving `self_tester`)
-- Create a new test class for the parent class under test (e.g `TestFiniteSemigroup`)
+In order to migrate, the following changes are necessary:
+- Move `_test_xyz` from a category `module` to new file `<module>_test.py` (e.g. `finite_semigroups_test.py`).
+- Rewrite tests using pytest (which is straightforward and more or less only amounts to removing all the custom code involving `self_tester`).
+- Create a new test class for the parent class under test (e.g `TestFiniteSemigroup`).
 - Create a static method `category_instances()` in this test class returning a list of instances to test.
 
 For the moment, I did this only for a few test methods in `sets_cat` using finite semigroups as example to illustrate the process.
@@ -69,8 +69,8 @@
 As one can see, each general test method is invoked for the three examples.
 
 
-TOOD (as follow-up tickets):
-- Complete migration of tests to pytest
-- After the migration is done, remove invoking the `TestSuite` in the doctests and remove the `TestSuite` class.
+TODO (in follow-up tickets):
+- Complete migration to pytest.
+- Once that is done, stop invoking `TestSuite` in doctests and remove the `TestSuite` class.
 
 
``````




---

archive/issue_comments_494156.json:
```json
{
    "body": "Changed keywords from **** to **testsuite**",
    "created_at": "2021-12-09T23:10:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494156",
    "user": "https://github.com/slel"
}
```

Changed keywords from **** to **testsuite**



---

archive/issue_events_391880.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-21T17:52:16Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30738#event-391880"
}
```



---

archive/issue_events_391881.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-21T17:52:16Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30738#event-391881"
}
```



---

archive/issue_events_391882.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-02-23T18:03:59Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30738#event-391882"
}
```



---

archive/issue_events_391883.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-02-23T18:03:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "label": "https://github.com/sagemath/sage/labels/pending",
    "label_color": "008080",
    "label_name": "pending",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30738#event-391883"
}
```



---

archive/issue_comments_494157.json:
```json
{
    "body": "<a id='comment:74'>Comment 74:</a>\nWhy did you change the milestone? I don't see anything that would prevent this being merged soon (except for the missing review).",
    "created_at": "2022-02-23T21:54:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494157",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:74'>Comment 74:</a>
Why did you change the milestone? I don't see anything that would prevent this being merged soon (except for the missing review).



---

archive/issue_comments_494158.json:
```json
{
    "body": "<a id='comment:75'>Comment 75:</a>\nThere's been no activity, and it's not clear if there are any developers who would be interested in rewriting the entirety of our test suite.",
    "created_at": "2022-02-23T23:50:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494158",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:75'>Comment 75:</a>
There's been no activity, and it's not clear if there are any developers who would be interested in rewriting the entirety of our test suite.



---

archive/issue_events_391884.json:
```json
{
    "actor": "https://github.com/tobiasdiez",
    "created_at": "2022-03-20T17:22:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30738#event-391884"
}
```



---

archive/issue_events_391885.json:
```json
{
    "actor": "https://github.com/tobiasdiez",
    "created_at": "2022-03-20T17:22:01Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "label": "https://github.com/sagemath/sage/labels/pending",
    "label_color": "008080",
    "label_name": "pending",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30738#event-391885"
}
```



---

archive/issue_comments_494159.json:
```json
{
    "body": "<a id='comment:76'>Comment 76:</a>\nWhile being a relatively huge project, I think, a completely migration can be done in a relatively straightforward way with an overseeable time investment. I would definitely up for doing this alone if necessary. So I'm appreciate if this ticket could be reviewed soon. Thanks!",
    "created_at": "2022-03-20T17:22:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494159",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:76'>Comment 76:</a>
While being a relatively huge project, I think, a completely migration can be done in a relatively straightforward way with an overseeable time investment. I would definitely up for doing this alone if necessary. So I'm appreciate if this ticket could be reviewed soon. Thanks!



---

archive/issue_comments_494160.json:
```json
{
    "body": "<a id='comment:77'>Comment 77:</a>\nYou have received review comments: [comment:45](#comment%3A45), [comment:48](#comment%3A48), etc.",
    "created_at": "2022-03-21T23:52:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494160",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:77'>Comment 77:</a>
You have received review comments: [comment:45](#comment%3A45), [comment:48](#comment%3A48), etc.



---

archive/issue_events_391886.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-03-21T23:59:18Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "title_is": "Replace custom Sage unit test discovery by pytest",
    "title_was": "Replace custom test discovery by pytest",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30738#event-391886"
}
```



---

archive/issue_comments_494161.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -73,4 +73,6 @@\n - Complete migration to pytest.\n - Once that is done, stop invoking `TestSuite` in doctests and remove the `TestSuite` class.\n \n+See also:\n+- #33546 Replace custom Sage doctest discovery by pytest (using pytest_collect_file)\n \n``````\n",
    "created_at": "2022-03-21T23:59:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494161",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -73,4 +73,6 @@
 - Complete migration to pytest.
 - Once that is done, stop invoking `TestSuite` in doctests and remove the `TestSuite` class.
 
+See also:
+- #33546 Replace custom Sage doctest discovery by pytest (using pytest_collect_file)
 
``````




---

archive/issue_comments_494162.json:
```json
{
    "body": "<a id='comment:79'>Comment 79:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/36cfdfceb267ea4faf2b0254a511ff54362671ad\">36cfdfc</a></td><td><code>Merge remote-tracking branch 'origin/develop' into public/refactoring/pytest</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fab57938380110184825ccf2db6bc431e81ded51\">fab5793</a></td><td><code>Move test_associativity</code></td></tr></table>\n",
    "created_at": "2022-03-29T12:51:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494162",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:79'>Comment 79:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/36cfdfceb267ea4faf2b0254a511ff54362671ad">36cfdfc</a></td><td><code>Merge remote-tracking branch 'origin/develop' into public/refactoring/pytest</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fab57938380110184825ccf2db6bc431e81ded51">fab5793</a></td><td><code>Move test_associativity</code></td></tr></table>




---

archive/issue_comments_494163.json:
```json
{
    "body": "Changed commit from **[161e2f4](https://github.com/sagemath/sagetrac-mirror/commit/161e2f4b4bf21ffbbc7bceb7fe085def84350e7c)** to **[fab5793](https://github.com/sagemath/sagetrac-mirror/commit/fab57938380110184825ccf2db6bc431e81ded51)**",
    "created_at": "2022-03-29T12:51:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494163",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[161e2f4](https://github.com/sagemath/sagetrac-mirror/commit/161e2f4b4bf21ffbbc7bceb7fe085def84350e7c)** to **[fab5793](https://github.com/sagemath/sagetrac-mirror/commit/fab57938380110184825ccf2db6bc431e81ded51)**



---

archive/issue_comments_494164.json:
```json
{
    "body": "<a id='comment:80'>Comment 80:</a>\nReplying to [@mkoeppe](#comment%3A77):\n> You have received review comments: [comment:45](#comment%3A45), [comment:48](#comment%3A48), etc. \n> \n\nI've fixed [comment:45](#comment%3A45). To [comment:48](#comment%3A48) I've already reacted in [comment:49](#comment%3A49).",
    "created_at": "2022-03-29T13:13:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494164",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:80'>Comment 80:</a>
Replying to [@mkoeppe](#comment%3A77):
> You have received review comments: [comment:45](#comment%3A45), [comment:48](#comment%3A48), etc. 
> 

I've fixed [comment:45](#comment%3A45). To [comment:48](#comment%3A48) I've already reacted in [comment:49](#comment%3A49).



---

archive/issue_comments_494165.json:
```json
{
    "body": "<a id='comment:81'>Comment 81:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b047abeae5c3f3bf755afa37bf65a0ed4bc61d97\">b047abe</a></td><td><code>Merge branch 'develop' into public/refactoring/pytest</code></td></tr></table>\n",
    "created_at": "2022-04-08T21:28:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494165",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:81'>Comment 81:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b047abeae5c3f3bf755afa37bf65a0ed4bc61d97">b047abe</a></td><td><code>Merge branch 'develop' into public/refactoring/pytest</code></td></tr></table>




---

archive/issue_comments_494166.json:
```json
{
    "body": "Changed commit from **[fab5793](https://github.com/sagemath/sagetrac-mirror/commit/fab57938380110184825ccf2db6bc431e81ded51)** to **[b047abe](https://github.com/sagemath/sagetrac-mirror/commit/b047abeae5c3f3bf755afa37bf65a0ed4bc61d97)**",
    "created_at": "2022-04-08T21:28:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30738#issuecomment-494166",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[fab5793](https://github.com/sagemath/sagetrac-mirror/commit/fab57938380110184825ccf2db6bc431e81ded51)** to **[b047abe](https://github.com/sagemath/sagetrac-mirror/commit/b047abeae5c3f3bf755afa37bf65a0ed4bc61d97)**



---

archive/issue_events_391887.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-11T17:19:39Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30738#event-391887"
}
```



---

archive/issue_events_391888.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-11T17:19:39Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30738#event-391888"
}
```



---

archive/issue_events_391889.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30738#event-391889"
}
```



---

archive/issue_events_391890.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "milestone_number": null,
    "milestone_title": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30738#event-391890"
}
```



---

archive/issue_events_391891.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2023-01-07T21:39:40Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "milestone_number": null,
    "milestone_title": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30738#event-391891"
}
```



---

archive/issue_events_391892.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2023-01-07T21:39:40Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30738",
    "milestone_number": null,
    "milestone_title": "sage-9.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30738#event-391892"
}
```
