# Issue 30267: Coercion via restriction of chart functions

archive/issues_030030.json:
```json
{
    "body": "At this stage, scalar fields (and tensor fields) support coercions via restrictions:\n\n```\nsage: M = Manifold(2, 'M')\nsage: c.<x,y> = M.chart()\nsage: D = M.open_subset('D')\nsage: A = M.scalar_field_algebra(); A_D = D.scalar_field_algebra()\nsage: A_D.has_coerce_map_from(A)\nTrue\n```\n\nBut the chart function ring does not support that coercion, even for derived charts:\n\n```\nsage: c_D = c.restrict(D, x^2+y^2<1)\nsage: R = c.function_ring(); R_D = c_D.function_ring()\nsage: R_D.has_coerce_map_from(R)\nFalse\n```\n\nConsequently, this should be treated the same way as scalar fields since chart functions are the very foundation of scalar fields.\n\nI suggest we add that coercion in case one chart (here `c_D`) is the restriction of the other (here `c`).\n\n**CC:**  @egourgoulhon @tscrim\n\n**Branch/Commit:** [d494bbd912c42ca2386664c597b15de117dd52a9](https://github.com/sagemath/sagetrac-mirror/commit/d494bbd912c42ca2386664c597b15de117dd52a9)\n\n**Reviewer:** Travis Scrimshaw, Eric Gourgoulhon\n\n**Author:** Michael Jung\n\n**Resolution:** fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/30267\n\n",
    "closed_at": "2020-08-07T19:05:40Z",
    "created_at": "2020-08-01T21:20:42Z",
    "labels": [
        "component: manifolds",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "Coercion via restriction of chart functions",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30267",
    "user": "https://github.com/mjungmath"
}
```
At this stage, scalar fields (and tensor fields) support coercions via restrictions:

```
sage: M = Manifold(2, 'M')
sage: c.<x,y> = M.chart()
sage: D = M.open_subset('D')
sage: A = M.scalar_field_algebra(); A_D = D.scalar_field_algebra()
sage: A_D.has_coerce_map_from(A)
True
```

But the chart function ring does not support that coercion, even for derived charts:

```
sage: c_D = c.restrict(D, x^2+y^2<1)
sage: R = c.function_ring(); R_D = c_D.function_ring()
sage: R_D.has_coerce_map_from(R)
False
```

Consequently, this should be treated the same way as scalar fields since chart functions are the very foundation of scalar fields.

I suggest we add that coercion in case one chart (here `c_D`) is the restriction of the other (here `c`).

**CC:**  @egourgoulhon @tscrim

**Branch/Commit:** [d494bbd912c42ca2386664c597b15de117dd52a9](https://github.com/sagemath/sagetrac-mirror/commit/d494bbd912c42ca2386664c597b15de117dd52a9)

**Reviewer:** Travis Scrimshaw, Eric Gourgoulhon

**Author:** Michael Jung

**Resolution:** fixed

Issue created by migration from https://trac.sagemath.org/ticket/30267





---

archive/issue_comments_596381.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2020-08-01T22:09:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30267#issuecomment-596381",
    "user": "https://github.com/mjungmath"
}
```


**Changing status** from new to needs_review.



---

archive/issue_comments_596382.json:
```json
{
    "body": "**Author:** Michael Jung",
    "created_at": "2020-08-01T22:09:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30267#issuecomment-596382",
    "user": "https://github.com/mjungmath"
}
```


**Author:** Michael Jung



---

archive/issue_comments_596383.json:
```json
{
    "body": "**Branch:** [u/gh-mjungmath/coercion_via_restriction_of_chart_functions](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-mjungmath/coercion_via_restriction_of_chart_functions)",
    "created_at": "2020-08-01T22:12:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30267#issuecomment-596383",
    "user": "https://github.com/mjungmath"
}
```


**Branch:** [u/gh-mjungmath/coercion_via_restriction_of_chart_functions](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-mjungmath/coercion_via_restriction_of_chart_functions)



---

archive/issue_comments_596384.json:
```json
{
    "body": "**Commit:** [4bcd2eeb367909eef66de8f0390f4fa7abea22c9](https://github.com/sagemath/sagetrac-mirror/commit/4bcd2eeb367909eef66de8f0390f4fa7abea22c9)",
    "created_at": "2020-08-01T22:23:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30267#issuecomment-596384",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```


**Commit:** [4bcd2eeb367909eef66de8f0390f4fa7abea22c9](https://github.com/sagemath/sagetrac-mirror/commit/4bcd2eeb367909eef66de8f0390f4fa7abea22c9)



---

archive/issue_comments_596385.json:
```json
{
    "body": "<a id='comment:3'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4bcd2eeb367909eef66de8f0390f4fa7abea22c9\">4bcd2ee</a></td><td><code>Trac #30267: coercion via restriction added</code></td></tr></table>\n",
    "created_at": "2020-08-01T22:23:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30267#issuecomment-596385",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```


<a id='comment:3'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4bcd2eeb367909eef66de8f0390f4fa7abea22c9">4bcd2ee</a></td><td><code>Trac #30267: coercion via restriction added</code></td></tr></table>




---

archive/issue_comments_596386.json:
```json
{
    "body": "<a id='comment:4'></a>\nLGTM.",
    "created_at": "2020-08-02T05:59:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30267#issuecomment-596386",
    "user": "https://github.com/tscrim"
}
```


<a id='comment:4'></a>
LGTM.



---

archive/issue_comments_596387.json:
```json
{
    "body": "**Reviewer:** Travis Scrimshaw",
    "created_at": "2020-08-02T05:59:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30267#issuecomment-596387",
    "user": "https://github.com/tscrim"
}
```


**Reviewer:** Travis Scrimshaw



---

archive/issue_comments_596388.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2020-08-02T05:59:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30267#issuecomment-596388",
    "user": "https://github.com/tscrim"
}
```


**Changing status** from needs_review to positive_review.



---

archive/issue_comments_596389.json:
```json
{
    "body": "<a id='comment:5'></a>\nThanks.",
    "created_at": "2020-08-02T07:13:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30267#issuecomment-596389",
    "user": "https://github.com/mjungmath"
}
```


<a id='comment:5'></a>
Thanks.



---

archive/issue_comments_596390.json:
```json
{
    "body": "<a id='comment:6'></a>\nThanks for this ticket.\nMay I suggest to correct a typo:\n\n```diff\n-    The ring of all chart function w.r.t. to a chart::\n+    The ring of all chart functions w.r.t. to a chart::\n```",
    "created_at": "2020-08-02T08:10:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30267#issuecomment-596390",
    "user": "https://github.com/egourgoulhon"
}
```


<a id='comment:6'></a>
Thanks for this ticket.
May I suggest to correct a typo:

```diff
-    The ring of all chart function w.r.t. to a chart::
+    The ring of all chart functions w.r.t. to a chart::
```



---

archive/issue_comments_596391.json:
```json
{
    "body": "**Changing status** from positive_review to needs_review.",
    "created_at": "2020-08-02T09:29:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30267#issuecomment-596391",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```


**Changing status** from positive_review to needs_review.



---

archive/issue_comments_596392.json:
```json
{
    "body": "<a id='comment:7'></a>\n**Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d494bbd912c42ca2386664c597b15de117dd52a9\">d494bbd</a></td><td><code>Trac #30267: docstring typo fixed</code></td></tr></table>\n",
    "created_at": "2020-08-02T09:29:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30267#issuecomment-596392",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```


<a id='comment:7'></a>
**Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d494bbd912c42ca2386664c597b15de117dd52a9">d494bbd</a></td><td><code>Trac #30267: docstring typo fixed</code></td></tr></table>




---

archive/issue_comments_596393.json:
```json
{
    "body": "**Changing commit** from \"[4bcd2eeb367909eef66de8f0390f4fa7abea22c9](https://github.com/sagemath/sagetrac-mirror/commit/4bcd2eeb367909eef66de8f0390f4fa7abea22c9)\" to \"[d494bbd912c42ca2386664c597b15de117dd52a9](https://github.com/sagemath/sagetrac-mirror/commit/d494bbd912c42ca2386664c597b15de117dd52a9)\".",
    "created_at": "2020-08-02T09:29:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30267#issuecomment-596393",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```


**Changing commit** from "[4bcd2eeb367909eef66de8f0390f4fa7abea22c9](https://github.com/sagemath/sagetrac-mirror/commit/4bcd2eeb367909eef66de8f0390f4fa7abea22c9)" to "[d494bbd912c42ca2386664c597b15de117dd52a9](https://github.com/sagemath/sagetrac-mirror/commit/d494bbd912c42ca2386664c597b15de117dd52a9)".



---

archive/issue_comments_596394.json:
```json
{
    "body": "<a id='comment:8'></a>\nReplying to [egourgoulhon](#comment%3A6):\n> Thanks for this ticket.\n> May I suggest to correct a typo:\n> \n> ```diff\n> -    The ring of all chart function w.r.t. to a chart::\n> +    The ring of all chart functions w.r.t. to a chart::\n> ```\n\n\nDone. Thank you.",
    "created_at": "2020-08-02T09:30:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30267#issuecomment-596394",
    "user": "https://github.com/mjungmath"
}
```


<a id='comment:8'></a>
Replying to [egourgoulhon](#comment%3A6):
> Thanks for this ticket.
> May I suggest to correct a typo:
> 
> ```diff
> -    The ring of all chart function w.r.t. to a chart::
> +    The ring of all chart functions w.r.t. to a chart::
> ```


Done. Thank you.



---

archive/issue_comments_596395.json:
```json
{
    "body": "**Changing reviewer** from \"Travis Scrimshaw\" to \"Travis Scrimshaw, Eric Gourgoulhon\".",
    "created_at": "2020-08-02T09:48:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30267#issuecomment-596395",
    "user": "https://github.com/tscrim"
}
```


**Changing reviewer** from "Travis Scrimshaw" to "Travis Scrimshaw, Eric Gourgoulhon".



---

archive/issue_comments_596396.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2020-08-02T09:48:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30267#issuecomment-596396",
    "user": "https://github.com/tscrim"
}
```


**Changing status** from needs_review to positive_review.



---

archive/issue_comments_596397.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2020-08-07T19:05:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30267#issuecomment-596397",
    "user": "https://github.com/vbraun"
}
```


**Resolution:** fixed



---

archive/issue_comments_596398.json:
```json
{
    "body": "**Changing branch** from \"[u/gh-mjungmath/coercion_via_restriction_of_chart_functions](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-mjungmath/coercion_via_restriction_of_chart_functions)\" to \"[d494bbd912c42ca2386664c597b15de117dd52a9](https://github.com/sagemath/sagetrac-mirror/commit/d494bbd912c42ca2386664c597b15de117dd52a9)\".",
    "created_at": "2020-08-07T19:05:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30267#issuecomment-596398",
    "user": "https://github.com/vbraun"
}
```


**Changing branch** from "[u/gh-mjungmath/coercion_via_restriction_of_chart_functions](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-mjungmath/coercion_via_restriction_of_chart_functions)" to "[d494bbd912c42ca2386664c597b15de117dd52a9](https://github.com/sagemath/sagetrac-mirror/commit/d494bbd912c42ca2386664c597b15de117dd52a9)".



---

archive/issue_events_088255.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-08-07T19:05:40Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/30267",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30267#event-88255"
}
```

