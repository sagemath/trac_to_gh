# Issue 30518: eigenvectors over QQbar are incorrectly conjugated

archive/issues_030281.json:
```json
{
    "assignees": [],
    "body": "<div id=\"comment:0\"></div>\n\nEigenvectors over QQbar could get incorrectly conjugated. In the following example from [devel](https://groups.google.com/g/sage-devel/c/9Ss98-XKR9c), the eigenvectors of a matrix over `QuadraticField(-1)` are computed in two ways, one of which incorrectly returns the conjugate of some eigenvectors.\n\nBy converting the matrix to `QQbar` first:\n\n```\nsage: K.<i> = QuadraticField(-1)\nsage: m = matrix(K, 4, [2,4*i,-i,0, -4*i,2,-1,0, 2*i,-2,0,0, 4*i+4, 4*i-4,1-i,-2])\nsage: sorted([(e, matrix.column(vs)) for e, vs, _ in m.change_ring(QQbar).eigenvectors_right()])\n[(\n    [  1   0]\n    [1*I   0]\n    [  0   0]\n-2, [  0   1]\n),\n (\n                      [           1.000000000000000? + 0.?e-16*I]\n                      [           0.?e-16 - 1.000000000000000?*I]\n                      [           0.?e-16 - 6.605551275463989?*I]\n-0.6055512754639893?, [1.000000000000000? + 1.000000000000000?*I]\n),\n (\n                    [           1.000000000000000? + 0.?e-17*I]\n                    [           0.?e-17 - 1.000000000000000?*I]\n                    [          0.?e-17 + 0.6055512754639893?*I]\n6.605551275463989?, [1.000000000000000? + 1.000000000000000?*I]\n)]\n```\n\nSupposedly, this result is correct. In contrast, computing the eigenvectors directly, without first converting to `QQbar`, leads to some eigenvectors getting conjugated:\n\n```\nsage: sorted([(QQbar(e), matrix.column(QQbar, vs)) for e, vs, _ in m.eigenvectors_right()])\n[(\n    [1 0]\n    [I 0]\n    [0 0]\n-2, [0 1]\n),\n (\n                      [                                        1]\n                      [           0.?e-54 + 1.000000000000000?*I]\n                      [           0.?e-53 + 6.605551275463989?*I]\n-0.6055512754639893?, [1.000000000000000? - 1.000000000000000?*I]\n),\n (\n                    [                                        1]\n                    [           0.?e-53 + 1.000000000000000?*I]\n                    [          0.?e-52 - 0.6055512754639893?*I]\n6.605551275463989?, [1.000000000000000? - 1.000000000000000?*I]\n)]\n```\n\nNote that the `QuadraticField` constructor automatically sets an embedding.\n\n```\nsage: K.coerce_embedding()\nGeneric morphism:\n  From: Number Field in i with defining polynomial x^2 + 1 with i = 1*I\n  To:   Complex Lazy Field\n  Defn: i -> 1*I\n```\n\nDepends on #31628\n\nCC:  @videlec\n\nComponent: **number fields**\n\nAuthor: **Vincent Delecroix**\n\nBranch/Commit: **[`c227dad`](https://github.com/sagemath/sagetrac-mirror/commit/c227dad03dbef66c5ab1b2ba3c3cd9e7155c8bed)**\n\nReviewer: **Marc Mezzarobba**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/30518_\n\n",
    "closed_at": "2021-04-29T21:06:01Z",
    "created_at": "2020-09-06T15:55:35Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20number%20fields",
        "https://github.com/sagemath/sage/labels/p%3A%20blocker%20/%201",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.3",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "eigenvectors over QQbar are incorrectly conjugated",
    "type": "issue",
    "updated_at": "2021-04-29T21:06:01Z",
    "url": "https://github.com/sagemath/sage/issues/30518",
    "user": "https://github.com/mwageringel"
}
```
<div id="comment:0"></div>

Eigenvectors over QQbar could get incorrectly conjugated. In the following example from [devel](https://groups.google.com/g/sage-devel/c/9Ss98-XKR9c), the eigenvectors of a matrix over `QuadraticField(-1)` are computed in two ways, one of which incorrectly returns the conjugate of some eigenvectors.

By converting the matrix to `QQbar` first:

```
sage: K.<i> = QuadraticField(-1)
sage: m = matrix(K, 4, [2,4*i,-i,0, -4*i,2,-1,0, 2*i,-2,0,0, 4*i+4, 4*i-4,1-i,-2])
sage: sorted([(e, matrix.column(vs)) for e, vs, _ in m.change_ring(QQbar).eigenvectors_right()])
[(
    [  1   0]
    [1*I   0]
    [  0   0]
-2, [  0   1]
),
 (
                      [           1.000000000000000? + 0.?e-16*I]
                      [           0.?e-16 - 1.000000000000000?*I]
                      [           0.?e-16 - 6.605551275463989?*I]
-0.6055512754639893?, [1.000000000000000? + 1.000000000000000?*I]
),
 (
                    [           1.000000000000000? + 0.?e-17*I]
                    [           0.?e-17 - 1.000000000000000?*I]
                    [          0.?e-17 + 0.6055512754639893?*I]
6.605551275463989?, [1.000000000000000? + 1.000000000000000?*I]
)]
```

Supposedly, this result is correct. In contrast, computing the eigenvectors directly, without first converting to `QQbar`, leads to some eigenvectors getting conjugated:

```
sage: sorted([(QQbar(e), matrix.column(QQbar, vs)) for e, vs, _ in m.eigenvectors_right()])
[(
    [1 0]
    [I 0]
    [0 0]
-2, [0 1]
),
 (
                      [                                        1]
                      [           0.?e-54 + 1.000000000000000?*I]
                      [           0.?e-53 + 6.605551275463989?*I]
-0.6055512754639893?, [1.000000000000000? - 1.000000000000000?*I]
),
 (
                    [                                        1]
                    [           0.?e-53 + 1.000000000000000?*I]
                    [          0.?e-52 - 0.6055512754639893?*I]
6.605551275463989?, [1.000000000000000? - 1.000000000000000?*I]
)]
```

Note that the `QuadraticField` constructor automatically sets an embedding.

```
sage: K.coerce_embedding()
Generic morphism:
  From: Number Field in i with defining polynomial x^2 + 1 with i = 1*I
  To:   Complex Lazy Field
  Defn: i -> 1*I
```

Depends on #31628

CC:  @videlec

Component: **number fields**

Author: **Vincent Delecroix**

Branch/Commit: **[`c227dad`](https://github.com/sagemath/sagetrac-mirror/commit/c227dad03dbef66c5ab1b2ba3c3cd9e7155c8bed)**

Reviewer: **Marc Mezzarobba**

_Issue created by migration from https://trac.sagemath.org/ticket/30518_





---

archive/issue_events_417587.json:
```json
{
    "actor": "https://github.com/mwageringel",
    "created_at": "2020-09-06T15:55:35Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30518",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30518#event-417587"
}
```



---

archive/issue_events_417588.json:
```json
{
    "actor": "https://github.com/mwageringel",
    "created_at": "2020-09-06T15:55:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30518",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20number%20fields",
    "label_color": "0000ff",
    "label_name": "c: number fields",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30518#event-417588"
}
```



---

archive/issue_events_417589.json:
```json
{
    "actor": "https://github.com/mwageringel",
    "created_at": "2020-09-06T15:55:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30518",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30518#event-417589"
}
```



---

archive/issue_events_417590.json:
```json
{
    "actor": "https://github.com/mwageringel",
    "created_at": "2020-09-06T15:55:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30518",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30518#event-417590"
}
```



---

archive/issue_comments_486361.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nPossibly related:\n\n- #31551: Incorrect conversion from \u211a[-i] to SR",
    "created_at": "2021-03-24T21:38:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30518#issuecomment-486361",
    "user": "https://github.com/slel"
}
```

<div id="comment:1" align="right">comment:1</div>

Possibly related:

- #31551: Incorrect conversion from ℚ[-i] to SR



---

archive/issue_comments_486362.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nReplying to [@slel](#comment%3A1):\n> Possibly related:\n> \n> - #31551: Incorrect conversion from \u211a[-i] to SR\n\nUnlike #31551, this happens with Sage 9.2 too. (The root cause may nevertheless be the same.)",
    "created_at": "2021-03-25T09:30:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30518#issuecomment-486362",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:2" align="right">comment:2</div>

Replying to [@slel](#comment%3A1):
> Possibly related:
> 
> - #31551: Incorrect conversion from ℚ[-i] to SR

Unlike #31551, this happens with Sage 9.2 too. (The root cause may nevertheless be the same.)



---

archive/issue_comments_486363.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nThe fix now at #31551 does not solve this issue.",
    "created_at": "2021-03-25T10:17:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30518#issuecomment-486363",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:3" align="right">comment:3</div>

The fix now at #31551 does not solve this issue.



---

archive/issue_comments_486364.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nI think this is better illustrated with\n\n```\nsage: for e, vs, _ in m.change_ring(QQbar).eigenvectors_right():\n....:     for v in vs:\n....:         print(m*v == e*v)\nTrue\nTrue\nTrue\nTrue\nsage: for e, vs, _ in m.eigenvectors_right():\n....:     for v in vs:\n....:         print(m*v == e*v)\nTrue\nTrue\nFalse\nFalse\n```",
    "created_at": "2021-03-25T12:11:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30518#issuecomment-486364",
    "user": "https://github.com/videlec"
}
```

<div id="comment:4" align="right">comment:4</div>

I think this is better illustrated with

```
sage: for e, vs, _ in m.change_ring(QQbar).eigenvectors_right():
....:     for v in vs:
....:         print(m*v == e*v)
True
True
True
True
sage: for e, vs, _ in m.eigenvectors_right():
....:     for v in vs:
....:         print(m*v == e*v)
True
True
False
False
```



---

archive/issue_comments_486365.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nThe problem somehow comes from line 6638 in `matrix2.pyx`\n\n```\nm = hom(eigval.parent(), e.parent(), e)\n```\nWhat happens here is that the eigenvalue is quadratic over `QQ` (not over the base field `QQ[i]`) and that the above code does not construct the embedding that preserves the one of the base field. This can be reproduced as follows\n\n```\nsage: K.<i> = QuadraticField(-1)\nsage: L = K.extension(x^2 - 6*x - 4, 'a1')\nsage: eigval = L.gen()\nsage: eigval_conj = eigval.galois_conjugates(QQbar)\nsage: f0 = hom(eigval.parent(), QQbar, eigval_conj[0])\nsage: f1 = hom(eigval.parent(), QQbar, eigval_conj[1])\nsage: f0(i)  # wrong embedding!!\n0.?e-54 - 1.000000000000000?*I\nsage: f1(i)  # wrong embedding!!\n0.?e-54 - 1.000000000000000?*I\n```",
    "created_at": "2021-03-25T12:30:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30518#issuecomment-486365",
    "user": "https://github.com/videlec"
}
```

<div id="comment:5" align="right">comment:5</div>

The problem somehow comes from line 6638 in `matrix2.pyx`

```
m = hom(eigval.parent(), e.parent(), e)
```
What happens here is that the eigenvalue is quadratic over `QQ` (not over the base field `QQ[i]`) and that the above code does not construct the embedding that preserves the one of the base field. This can be reproduced as follows

```
sage: K.<i> = QuadraticField(-1)
sage: L = K.extension(x^2 - 6*x - 4, 'a1')
sage: eigval = L.gen()
sage: eigval_conj = eigval.galois_conjugates(QQbar)
sage: f0 = hom(eigval.parent(), QQbar, eigval_conj[0])
sage: f1 = hom(eigval.parent(), QQbar, eigval_conj[1])
sage: f0(i)  # wrong embedding!!
0.?e-54 - 1.000000000000000?*I
sage: f1(i)  # wrong embedding!!
0.?e-54 - 1.000000000000000?*I
```



---

archive/issue_comments_486366.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nCould be fixed by\n\n```\nsage: H = Hom(eigval.parent(), QQbar)\nsage: f0 = H(eigval_conj[0], base_map=QQbar.coerce_map_from(K))\nsage: f0(i)\n0.?e-54 + 1.000000000000000?*I\n```\nBut maybe hom should consider the embedding of the base by default when it exists?",
    "created_at": "2021-03-25T12:37:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30518#issuecomment-486366",
    "user": "https://github.com/videlec"
}
```

<div id="comment:6" align="right">comment:6</div>

Could be fixed by

```
sage: H = Hom(eigval.parent(), QQbar)
sage: f0 = H(eigval_conj[0], base_map=QQbar.coerce_map_from(K))
sage: f0(i)
0.?e-54 + 1.000000000000000?*I
```
But maybe hom should consider the embedding of the base by default when it exists?



---

archive/issue_comments_486367.json:
```json
{
    "body": "<div id=\"comment:7\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fddaa2c0b55dffaa4d3b1c616d291da18c583d98\"><code>fddaa2c</code></a></td><td><code>#31151 support both embeddings in NumberFieldElement_gaussian</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/852c89e335056d10cdefa6e25d9266c22b406e04\"><code>852c89e</code></a></td><td><code>30518: choose coerce embedding for the base when it exists</code></td></tr></table>\n",
    "created_at": "2021-03-25T12:43:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30518#issuecomment-486367",
    "user": "https://github.com/videlec"
}
```

<div id="comment:7"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fddaa2c0b55dffaa4d3b1c616d291da18c583d98"><code>fddaa2c</code></a></td><td><code>#31151 support both embeddings in NumberFieldElement_gaussian</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/852c89e335056d10cdefa6e25d9266c22b406e04"><code>852c89e</code></a></td><td><code>30518: choose coerce embedding for the base when it exists</code></td></tr></table>




---

archive/issue_events_417591.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2021-03-25T12:43:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30518",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30518#event-417591"
}
```



---

archive/issue_comments_486368.json:
```json
{
    "body": "Branch: **[u/vdelecroix/30518](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/30518)**",
    "created_at": "2021-03-25T12:43:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30518#issuecomment-486368",
    "user": "https://github.com/videlec"
}
```

Branch: **[u/vdelecroix/30518](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/30518)**



---

archive/issue_comments_486369.json:
```json
{
    "body": "Author: **Vincent Delecroix**",
    "created_at": "2021-03-25T12:43:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30518#issuecomment-486369",
    "user": "https://github.com/videlec"
}
```

Author: **Vincent Delecroix**



---

archive/issue_comments_486370.json:
```json
{
    "body": "Commit: **[`852c89e`](https://github.com/sagemath/sagetrac-mirror/commit/852c89e335056d10cdefa6e25d9266c22b406e04)**",
    "created_at": "2021-03-25T12:43:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30518#issuecomment-486370",
    "user": "https://github.com/videlec"
}
```

Commit: **[`852c89e`](https://github.com/sagemath/sagetrac-mirror/commit/852c89e335056d10cdefa6e25d9266c22b406e04)**



---

archive/issue_comments_486371.json:
```json
{
    "body": "Changed commit from **[`852c89e`](https://github.com/sagemath/sagetrac-mirror/commit/852c89e335056d10cdefa6e25d9266c22b406e04)** to **[`cf66800`](https://github.com/sagemath/sagetrac-mirror/commit/cf668005799173205566b30be5bf0559752f14c9)**",
    "created_at": "2021-03-25T12:44:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30518#issuecomment-486371",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`852c89e`](https://github.com/sagemath/sagetrac-mirror/commit/852c89e335056d10cdefa6e25d9266c22b406e04)** to **[`cf66800`](https://github.com/sagemath/sagetrac-mirror/commit/cf668005799173205566b30be5bf0559752f14c9)**



---

archive/issue_comments_486372.json:
```json
{
    "body": "<div id=\"comment:8\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cf668005799173205566b30be5bf0559752f14c9\"><code>cf66800</code></a></td><td><code>30518: choose coerce embedding for the base when it exists</code></td></tr></table>\n",
    "created_at": "2021-03-25T12:44:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30518#issuecomment-486372",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:8"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cf668005799173205566b30be5bf0559752f14c9"><code>cf66800</code></a></td><td><code>30518: choose coerce embedding for the base when it exists</code></td></tr></table>




---

archive/issue_comments_486373.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,18 @@\n-In the following example from [devel](https://groups.google.com/g/sage-devel/c/9Ss98-XKR9c), the eigenvectors of a matrix over `QuadraticField(-1)` are computed in two ways, one of which incorrectly returns the conjugate of some eigenvectors.\n+\n+```\n+sage: K.<i> = QuadraticField(-1)\n+sage: L = K.extension(x^2 - 6*x - 4, 'a1')\n+sage: eigval = L.gen()\n+sage: eigval_conj = eigval.galois_conjugates(QQbar)\n+sage: f0 = hom(eigval.parent(), QQbar, eigval_conj[0])\n+sage: f1 = hom(eigval.parent(), QQbar, eigval_conj[1])\n+sage: f0(i)  # wrong embedding!!\n+0.?e-54 - 1.000000000000000?*I\n+sage: f1(i)  # wrong embedding!!\n+0.?e-54 - 1.000000000000000?*I\n+```\n+\n+As the consequence eigenvectors over QQbar could get incorrectly conjugated. In the following example from [devel](https://groups.google.com/g/sage-devel/c/9Ss98-XKR9c), the eigenvectors of a matrix over `QuadraticField(-1)` are computed in two ways, one of which incorrectly returns the conjugate of some eigenvectors.\n \n By converting the matrix to `QQbar` first:\n \n``````\n",
    "created_at": "2021-03-25T12:46:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30518#issuecomment-486373",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,18 @@
-In the following example from [devel](https://groups.google.com/g/sage-devel/c/9Ss98-XKR9c), the eigenvectors of a matrix over `QuadraticField(-1)` are computed in two ways, one of which incorrectly returns the conjugate of some eigenvectors.
+
+```
+sage: K.<i> = QuadraticField(-1)
+sage: L = K.extension(x^2 - 6*x - 4, 'a1')
+sage: eigval = L.gen()
+sage: eigval_conj = eigval.galois_conjugates(QQbar)
+sage: f0 = hom(eigval.parent(), QQbar, eigval_conj[0])
+sage: f1 = hom(eigval.parent(), QQbar, eigval_conj[1])
+sage: f0(i)  # wrong embedding!!
+0.?e-54 - 1.000000000000000?*I
+sage: f1(i)  # wrong embedding!!
+0.?e-54 - 1.000000000000000?*I
+```
+
+As the consequence eigenvectors over QQbar could get incorrectly conjugated. In the following example from [devel](https://groups.google.com/g/sage-devel/c/9Ss98-XKR9c), the eigenvectors of a matrix over `QuadraticField(-1)` are computed in two ways, one of which incorrectly returns the conjugate of some eigenvectors.
 
 By converting the matrix to `QQbar` first:
 
``````




---

archive/issue_events_417592.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2021-03-25T12:46:19Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/30518",
    "title_is": "homomorphism of extension fields do not preserve canonical embeddings of the base",
    "title_was": "eigenvectors over QQbar are incorrectly conjugated",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30518#event-417592"
}
```



---

archive/issue_events_417593.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2021-03-25T12:49:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30518",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30518#event-417593"
}
```



---

archive/issue_events_417594.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2021-03-25T12:49:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30518",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30518#event-417594"
}
```



---

archive/issue_comments_486374.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nThis is actually only a \"partial\" fix. It solves the following (that also used to fail)\n\n```\nsage: K.<i> = QuadraticField(-1, embedding=QQbar.gen())\nsage: m = matrix(K, 4, [2,4*i,-i,0, -4*i,2,-1,0, 2*i,-2,0,0, 4*i+4, 4*i-4,1-i,-2])\nsage: for e, vs, _ in m.eigenvectors_right():\n....:     for v in vs:\n....:         print(m*v == e*v)\nTrue\nTrue\nTrue\nTrue\n```\nBut since\n\n```\nsage: K.<i> = QuadraticField(-1)                                                   \nsage: QQbar.coerce_map_from(K) is None\nTrue\n```\nthe original example of the ticket is not solved.",
    "created_at": "2021-03-25T12:49:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30518#issuecomment-486374",
    "user": "https://github.com/videlec"
}
```

<div id="comment:10" align="right">comment:10</div>

This is actually only a "partial" fix. It solves the following (that also used to fail)

```
sage: K.<i> = QuadraticField(-1, embedding=QQbar.gen())
sage: m = matrix(K, 4, [2,4*i,-i,0, -4*i,2,-1,0, 2*i,-2,0,0, 4*i+4, 4*i-4,1-i,-2])
sage: for e, vs, _ in m.eigenvectors_right():
....:     for v in vs:
....:         print(m*v == e*v)
True
True
True
True
```
But since

```
sage: K.<i> = QuadraticField(-1)                                                   
sage: QQbar.coerce_map_from(K) is None
True
```
the original example of the ticket is not solved.



---

archive/issue_events_417595.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2021-03-25T12:52:31Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/30518",
    "title_is": "eigenvectors over QQbar are incorrectly conjugated",
    "title_was": "homomorphism of extension fields do not preserve canonical embeddings of the base",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30518#event-417595"
}
```



---

archive/issue_comments_486375.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,18 +1,4 @@\n-\n-```\n-sage: K.<i> = QuadraticField(-1)\n-sage: L = K.extension(x^2 - 6*x - 4, 'a1')\n-sage: eigval = L.gen()\n-sage: eigval_conj = eigval.galois_conjugates(QQbar)\n-sage: f0 = hom(eigval.parent(), QQbar, eigval_conj[0])\n-sage: f1 = hom(eigval.parent(), QQbar, eigval_conj[1])\n-sage: f0(i)  # wrong embedding!!\n-0.?e-54 - 1.000000000000000?*I\n-sage: f1(i)  # wrong embedding!!\n-0.?e-54 - 1.000000000000000?*I\n-```\n-\n-As the consequence eigenvectors over QQbar could get incorrectly conjugated. In the following example from [devel](https://groups.google.com/g/sage-devel/c/9Ss98-XKR9c), the eigenvectors of a matrix over `QuadraticField(-1)` are computed in two ways, one of which incorrectly returns the conjugate of some eigenvectors.\n+Eigenvectors over QQbar could get incorrectly conjugated. In the following example from [devel](https://groups.google.com/g/sage-devel/c/9Ss98-XKR9c), the eigenvectors of a matrix over `QuadraticField(-1)` are computed in two ways, one of which incorrectly returns the conjugate of some eigenvectors.\n \n By converting the matrix to `QQbar` first:\n \n``````\n",
    "created_at": "2021-03-25T12:52:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30518#issuecomment-486375",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,18 +1,4 @@
-
-```
-sage: K.<i> = QuadraticField(-1)
-sage: L = K.extension(x^2 - 6*x - 4, 'a1')
-sage: eigval = L.gen()
-sage: eigval_conj = eigval.galois_conjugates(QQbar)
-sage: f0 = hom(eigval.parent(), QQbar, eigval_conj[0])
-sage: f1 = hom(eigval.parent(), QQbar, eigval_conj[1])
-sage: f0(i)  # wrong embedding!!
-0.?e-54 - 1.000000000000000?*I
-sage: f1(i)  # wrong embedding!!
-0.?e-54 - 1.000000000000000?*I
-```
-
-As the consequence eigenvectors over QQbar could get incorrectly conjugated. In the following example from [devel](https://groups.google.com/g/sage-devel/c/9Ss98-XKR9c), the eigenvectors of a matrix over `QuadraticField(-1)` are computed in two ways, one of which incorrectly returns the conjugate of some eigenvectors.
+Eigenvectors over QQbar could get incorrectly conjugated. In the following example from [devel](https://groups.google.com/g/sage-devel/c/9Ss98-XKR9c), the eigenvectors of a matrix over `QuadraticField(-1)` are computed in two ways, one of which incorrectly returns the conjugate of some eigenvectors.
 
 By converting the matrix to `QQbar` first:
 
``````




---

archive/issue_comments_486376.json:
```json
{
    "body": "Changed author from **Vincent Delecroix** to none",
    "created_at": "2021-03-25T12:52:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30518#issuecomment-486376",
    "user": "https://github.com/videlec"
}
```

Changed author from **Vincent Delecroix** to none



---

archive/issue_comments_486377.json:
```json
{
    "body": "Dependencies: **#31558**",
    "created_at": "2021-03-25T12:52:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30518#issuecomment-486377",
    "user": "https://github.com/videlec"
}
```

Dependencies: **#31558**



---

archive/issue_comments_486378.json:
```json
{
    "body": "Changed commit from **[`cf66800`](https://github.com/sagemath/sagetrac-mirror/commit/cf668005799173205566b30be5bf0559752f14c9)** to none",
    "created_at": "2021-03-25T12:52:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30518#issuecomment-486378",
    "user": "https://github.com/videlec"
}
```

Changed commit from **[`cf66800`](https://github.com/sagemath/sagetrac-mirror/commit/cf668005799173205566b30be5bf0559752f14c9)** to none



---

archive/issue_comments_486379.json:
```json
{
    "body": "Changed branch from **[u/vdelecroix/30518](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/30518)** to none",
    "created_at": "2021-03-25T12:52:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30518#issuecomment-486379",
    "user": "https://github.com/videlec"
}
```

Changed branch from **[u/vdelecroix/30518](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/30518)** to none



---

archive/issue_comments_486380.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nAs a start, you can review #31558.",
    "created_at": "2021-03-25T12:52:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30518#issuecomment-486380",
    "user": "https://github.com/videlec"
}
```

<div id="comment:12" align="right">comment:12</div>

As a start, you can review #31558.



---

archive/issue_comments_486381.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nNot fixed in Sage 9.3.rc2, in which #31551 and #31558 were merged.",
    "created_at": "2021-04-08T09:07:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30518#issuecomment-486381",
    "user": "https://github.com/slel"
}
```

<div id="comment:13" align="right">comment:13</div>

Not fixed in Sage 9.3.rc2, in which #31551 and #31558 were merged.



---

archive/issue_comments_486382.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReplying to [@slel](#comment%3A13):\n> Not fixed in Sage 9.3.rc2, in which #31551 and #31558 were merged.\n\nSee [comment:10].",
    "created_at": "2021-04-08T09:15:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30518#issuecomment-486382",
    "user": "https://github.com/videlec"
}
```

<div id="comment:14" align="right">comment:14</div>

Replying to [@slel](#comment%3A13):
> Not fixed in Sage 9.3.rc2, in which #31551 and #31558 were merged.

See [comment:10].



---

archive/issue_comments_486383.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nTo my mind, the following should raise an error\n\n```\nsage: K.<i> = QuadraticField(-1)\nsage: QQbar(i)\n```\n(as there is no specified embedding in QQbar)",
    "created_at": "2021-04-08T09:40:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30518#issuecomment-486383",
    "user": "https://github.com/videlec"
}
```

<div id="comment:15" align="right">comment:15</div>

To my mind, the following should raise an error

```
sage: K.<i> = QuadraticField(-1)
sage: QQbar(i)
```
(as there is no specified embedding in QQbar)



---

archive/issue_events_417596.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2021-04-08T12:04:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30518",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30518#event-417596"
}
```



---

archive/issue_events_417597.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2021-04-08T12:04:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30518",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30518#event-417597"
}
```



---

archive/issue_comments_486384.json:
```json
{
    "body": "<div id=\"comment:16\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0b387f7f9b9189e3cffefb7c8ba8ea81eefb4b0e\"><code>0b387f7</code></a></td><td><code>30518: raise errors in eigenspace/eigenvector in more cases</code></td></tr></table>\n",
    "created_at": "2021-04-08T12:04:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30518#issuecomment-486384",
    "user": "https://github.com/videlec"
}
```

<div id="comment:16"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0b387f7f9b9189e3cffefb7c8ba8ea81eefb4b0e"><code>0b387f7</code></a></td><td><code>30518: raise errors in eigenspace/eigenvector in more cases</code></td></tr></table>




---

archive/issue_comments_486385.json:
```json
{
    "body": "Author: **Vincent Delecroix**",
    "created_at": "2021-04-08T12:04:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30518#issuecomment-486385",
    "user": "https://github.com/videlec"
}
```

Author: **Vincent Delecroix**



---

archive/issue_comments_486386.json:
```json
{
    "body": "Changed dependencies from **#31558** to none",
    "created_at": "2021-04-08T12:04:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30518#issuecomment-486386",
    "user": "https://github.com/videlec"
}
```

Changed dependencies from **#31558** to none



---

archive/issue_comments_486387.json:
```json
{
    "body": "Branch: **[u/vdelecroix/30518](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/30518)**",
    "created_at": "2021-04-08T12:04:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30518#issuecomment-486387",
    "user": "https://github.com/videlec"
}
```

Branch: **[u/vdelecroix/30518](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/30518)**



---

archive/issue_comments_486388.json:
```json
{
    "body": "Commit: **[`0b387f7`](https://github.com/sagemath/sagetrac-mirror/commit/0b387f7f9b9189e3cffefb7c8ba8ea81eefb4b0e)**",
    "created_at": "2021-04-08T12:04:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30518#issuecomment-486388",
    "user": "https://github.com/videlec"
}
```

Commit: **[`0b387f7`](https://github.com/sagemath/sagetrac-mirror/commit/0b387f7f9b9189e3cffefb7c8ba8ea81eefb4b0e)**



---

archive/issue_comments_486389.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\npatchbot is green! please review.",
    "created_at": "2021-04-08T14:39:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30518#issuecomment-486389",
    "user": "https://github.com/videlec"
}
```

<div id="comment:17" align="right">comment:17</div>

patchbot is green! please review.



---

archive/issue_comments_486390.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nBut `QuadraticField(-1)` has a `coerce_embedding` into `CC`. So it seems to me that the issue with the original example is that the conversion to `QQbar` ignores the embedding. If it did not do that, the conversion could be declared as a coercion, even if with the `coerce_embedding` going to `CC`.",
    "created_at": "2021-04-08T14:50:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30518#issuecomment-486390",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:18" align="right">comment:18</div>

But `QuadraticField(-1)` has a `coerce_embedding` into `CC`. So it seems to me that the issue with the original example is that the conversion to `QQbar` ignores the embedding. If it did not do that, the conversion could be declared as a coercion, even if with the `coerce_embedding` going to `CC`.



---

archive/issue_comments_486391.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nTo my mind, the way number fields handle their coercions is far beyond the scope of this ticket. Even though I definitely agree that it is problematic. As soon as `QQbar.has_coerce_map_from(K)` answers `True` the eigenvalue/eigenvector code will work.\n\nThe minimal fix I provided turns wrong answers to errors. Together with #31551 and #31558, wrong answers are turned into right answers  when coerce embeddings to the algebraic closure are available.",
    "created_at": "2021-04-08T15:03:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30518#issuecomment-486391",
    "user": "https://github.com/videlec"
}
```

<div id="comment:19" align="right">comment:19</div>

To my mind, the way number fields handle their coercions is far beyond the scope of this ticket. Even though I definitely agree that it is problematic. As soon as `QQbar.has_coerce_map_from(K)` answers `True` the eigenvalue/eigenvector code will work.

The minimal fix I provided turns wrong answers to errors. Together with #31551 and #31558, wrong answers are turned into right answers  when coerce embeddings to the algebraic closure are available.



---

archive/issue_comments_486392.json:
```json
{
    "body": "Reviewer: **Marc Mezzarobba**",
    "created_at": "2021-04-09T08:25:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30518#issuecomment-486392",
    "user": "https://github.com/mezzarobba"
}
```

Reviewer: **Marc Mezzarobba**



---

archive/issue_comments_486393.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nOk, I tried to fix the problematic conversion and make it a coercion in #31628. You can set the present ticket to positive_review on my behalf if you want, or merge in my branch and adapt the tests.",
    "created_at": "2021-04-09T08:25:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30518#issuecomment-486393",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:20" align="right">comment:20</div>

Ok, I tried to fix the problematic conversion and make it a coercion in #31628. You can set the present ticket to positive_review on my behalf if you want, or merge in my branch and adapt the tests.



---

archive/issue_comments_486394.json:
```json
{
    "body": "Dependencies: **#31628**",
    "created_at": "2021-04-09T10:40:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30518#issuecomment-486394",
    "user": "https://github.com/videlec"
}
```

Dependencies: **#31628**



---

archive/issue_events_417598.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2021-04-09T10:40:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30518",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30518#event-417598"
}
```



---

archive/issue_events_417599.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2021-04-09T10:40:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30518",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30518#event-417599"
}
```



---

archive/issue_comments_486395.json:
```json
{
    "body": "<div id=\"comment:22\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/43511e4dbd22454094975bd32b89df00bd57e663\"><code>43511e4</code></a></td><td><code>fix conversion from QQ[-i] to QQbar</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cf5228bf29d5f3e5bd913c23feec854cdb09abd1\"><code>cf5228b</code></a></td><td><code>new implicit coercions to QQbar and AA</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6430356bdd45a63ebc847ca1284aac7abaf441d7\"><code>6430356</code></a></td><td><code>#31628 one more test</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c227dad03dbef66c5ab1b2ba3c3cd9e7155c8bed\"><code>c227dad</code></a></td><td><code>30518: additional test for eigenvectors over nf</code></td></tr></table>\n",
    "created_at": "2021-04-09T10:56:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30518#issuecomment-486395",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:22"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/43511e4dbd22454094975bd32b89df00bd57e663"><code>43511e4</code></a></td><td><code>fix conversion from QQ[-i] to QQbar</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cf5228bf29d5f3e5bd913c23feec854cdb09abd1"><code>cf5228b</code></a></td><td><code>new implicit coercions to QQbar and AA</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6430356bdd45a63ebc847ca1284aac7abaf441d7"><code>6430356</code></a></td><td><code>#31628 one more test</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c227dad03dbef66c5ab1b2ba3c3cd9e7155c8bed"><code>c227dad</code></a></td><td><code>30518: additional test for eigenvectors over nf</code></td></tr></table>




---

archive/issue_comments_486396.json:
```json
{
    "body": "Changed commit from **[`0b387f7`](https://github.com/sagemath/sagetrac-mirror/commit/0b387f7f9b9189e3cffefb7c8ba8ea81eefb4b0e)** to **[`c227dad`](https://github.com/sagemath/sagetrac-mirror/commit/c227dad03dbef66c5ab1b2ba3c3cd9e7155c8bed)**",
    "created_at": "2021-04-09T10:56:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30518#issuecomment-486396",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`0b387f7`](https://github.com/sagemath/sagetrac-mirror/commit/0b387f7f9b9189e3cffefb7c8ba8ea81eefb4b0e)** to **[`c227dad`](https://github.com/sagemath/sagetrac-mirror/commit/c227dad03dbef66c5ab1b2ba3c3cd9e7155c8bed)**



---

archive/issue_events_417600.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2021-04-09T10:56:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30518",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30518#event-417600"
}
```



---

archive/issue_events_417601.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2021-04-09T10:56:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30518",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30518#event-417601"
}
```



---

archive/issue_comments_486397.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nActually, some of my changes made sense (were more generic, only relying on the existence of algebraic closure and not assuming that it was QQbar). I opened #31631.",
    "created_at": "2021-04-09T11:03:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30518#issuecomment-486397",
    "user": "https://github.com/videlec"
}
```

<div id="comment:24" align="right">comment:24</div>

Actually, some of my changes made sense (were more generic, only relying on the existence of algebraic closure and not assuming that it was QQbar). I opened #31631.



---

archive/issue_comments_486398.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nI am not sure I understand: do you want to drop your original fix (0b387f7) from this ticket and recycle it in #31631? That's fine with me, but we could also keep 0b387f7 and just update it to use number fields with no complex embedding.",
    "created_at": "2021-04-09T11:21:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30518#issuecomment-486398",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:25" align="right">comment:25</div>

I am not sure I understand: do you want to drop your original fix (0b387f7) from this ticket and recycle it in #31631? That's fine with me, but we could also keep 0b387f7 and just update it to use number fields with no complex embedding.



---

archive/issue_comments_486399.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nI want to drop it here (since it is not necessary anymore). However, going through `.algebraic_closure` (instead of hard coding `QQbar`) and checking coercion to the algebraic closure make sense. The reason why I opened #31631. I also would like to add examples related to finite field, reason why I opened an independent ticket.",
    "created_at": "2021-04-09T15:02:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30518#issuecomment-486399",
    "user": "https://github.com/videlec"
}
```

<div id="comment:26" align="right">comment:26</div>

I want to drop it here (since it is not necessary anymore). However, going through `.algebraic_closure` (instead of hard coding `QQbar`) and checking coercion to the algebraic closure make sense. The reason why I opened #31631. I also would like to add examples related to finite field, reason why I opened an independent ticket.



---

archive/issue_events_417602.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2021-04-10T09:33:51Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30518",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30518#event-417602"
}
```



---

archive/issue_events_417603.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2021-04-10T09:33:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30518",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30518#event-417603"
}
```



---

archive/issue_comments_486400.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nOk, thanks!",
    "created_at": "2021-04-10T09:34:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30518#issuecomment-486400",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:28" align="right">comment:28</div>

Ok, thanks!



---

archive/issue_events_417604.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-04-18T16:13:17Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30518",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30518#event-417604"
}
```



---

archive/issue_events_417605.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-04-18T16:13:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30518",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20blocker%20/%201",
    "label_color": "ff0000",
    "label_name": "p: blocker / 1",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30518#event-417605"
}
```



---

archive/issue_comments_486401.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nDoes the fix here provide inspiration for these somewhat similar issues?\n\n- [sage-support, 2021-03, NumberFieldEmbedding gets confused with relative number fields](https://groups.google.com/g/sage-support/c/tRRJ-yEPLu4/m/49UuX8i1BQAJ)\n- #22008: complex_embedding on relative number fields\n  is inconsistent with the base field\n- #17524: polynomial for relative number field elements",
    "created_at": "2021-04-24T13:52:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30518#issuecomment-486401",
    "user": "https://github.com/slel"
}
```

<div id="comment:30" align="right">comment:30</div>

Does the fix here provide inspiration for these somewhat similar issues?

- [sage-support, 2021-03, NumberFieldEmbedding gets confused with relative number fields](https://groups.google.com/g/sage-support/c/tRRJ-yEPLu4/m/49UuX8i1BQAJ)
- #22008: complex_embedding on relative number fields
  is inconsistent with the base field
- #17524: polynomial for relative number field elements



---

archive/issue_events_417606.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-04-25T12:14:07Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30518",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30518#event-417606"
}
```



---

archive/issue_events_417607.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "bd3334c774c429982c901dda08425d9f7b0896d4",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2021-04-25T12:14:07Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/30518",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30518#event-417607"
}
```



---

archive/issue_comments_486402.json:
```json
{
    "body": "Changed branch from **[u/vdelecroix/30518](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/30518)** to **[`c227dad`](https://github.com/sagemath/sagetrac-mirror/commit/c227dad03dbef66c5ab1b2ba3c3cd9e7155c8bed)**",
    "created_at": "2021-04-25T12:14:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30518#issuecomment-486402",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/vdelecroix/30518](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/30518)** to **[`c227dad`](https://github.com/sagemath/sagetrac-mirror/commit/c227dad03dbef66c5ab1b2ba3c3cd9e7155c8bed)**



---

archive/issue_comments_486403.json:
```json
{
    "body": "Changed commit from **[`c227dad`](https://github.com/sagemath/sagetrac-mirror/commit/c227dad03dbef66c5ab1b2ba3c3cd9e7155c8bed)** to none",
    "created_at": "2021-04-25T20:23:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30518#issuecomment-486403",
    "user": "https://github.com/vbraun"
}
```

Changed commit from **[`c227dad`](https://github.com/sagemath/sagetrac-mirror/commit/c227dad03dbef66c5ab1b2ba3c3cd9e7155c8bed)** to none



---

archive/issue_events_417608.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-04-25T20:23:17Z",
    "event": "reopened",
    "issue": "https://github.com/sagemath/sage/issues/30518",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30518#event-417608"
}
```



---

archive/issue_comments_486404.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\n(back to needs review as its dependency has been hopefully fixed)\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/43511e4dbd22454094975bd32b89df00bd57e663\"><code>43511e4</code></a></td><td><code>fix conversion from QQ[-i] to QQbar</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cf5228bf29d5f3e5bd913c23feec854cdb09abd1\"><code>cf5228b</code></a></td><td><code>new implicit coercions to QQbar and AA</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6430356bdd45a63ebc847ca1284aac7abaf441d7\"><code>6430356</code></a></td><td><code>#31628 one more test</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c227dad03dbef66c5ab1b2ba3c3cd9e7155c8bed\"><code>c227dad</code></a></td><td><code>30518: additional test for eigenvectors over nf</code></td></tr></table>\n",
    "created_at": "2021-04-25T21:00:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30518#issuecomment-486404",
    "user": "https://github.com/videlec"
}
```

<div id="comment:33" align="right">comment:33</div>

(back to needs review as its dependency has been hopefully fixed)

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/43511e4dbd22454094975bd32b89df00bd57e663"><code>43511e4</code></a></td><td><code>fix conversion from QQ[-i] to QQbar</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cf5228bf29d5f3e5bd913c23feec854cdb09abd1"><code>cf5228b</code></a></td><td><code>new implicit coercions to QQbar and AA</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6430356bdd45a63ebc847ca1284aac7abaf441d7"><code>6430356</code></a></td><td><code>#31628 one more test</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c227dad03dbef66c5ab1b2ba3c3cd9e7155c8bed"><code>c227dad</code></a></td><td><code>30518: additional test for eigenvectors over nf</code></td></tr></table>




---

archive/issue_events_417609.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2021-04-25T21:00:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30518",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30518#event-417609"
}
```



---

archive/issue_comments_486405.json:
```json
{
    "body": "Commit: **[`c227dad`](https://github.com/sagemath/sagetrac-mirror/commit/c227dad03dbef66c5ab1b2ba3c3cd9e7155c8bed)**",
    "created_at": "2021-04-25T21:00:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30518#issuecomment-486405",
    "user": "https://github.com/videlec"
}
```

Commit: **[`c227dad`](https://github.com/sagemath/sagetrac-mirror/commit/c227dad03dbef66c5ab1b2ba3c3cd9e7155c8bed)**



---

archive/issue_comments_486406.json:
```json
{
    "body": "Changed branch from **[`c227dad`](https://github.com/sagemath/sagetrac-mirror/commit/c227dad03dbef66c5ab1b2ba3c3cd9e7155c8bed)** to **[u/vdelecroix/30518](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/30518)**",
    "created_at": "2021-04-25T21:00:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30518#issuecomment-486406",
    "user": "https://github.com/videlec"
}
```

Changed branch from **[`c227dad`](https://github.com/sagemath/sagetrac-mirror/commit/c227dad03dbef66c5ab1b2ba3c3cd9e7155c8bed)** to **[u/vdelecroix/30518](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/30518)**



---

archive/issue_comments_486407.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nMove to positive review since its dependency has been fixed.",
    "created_at": "2021-04-26T16:46:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30518#issuecomment-486407",
    "user": "https://github.com/videlec"
}
```

<div id="comment:34" align="right">comment:34</div>

Move to positive review since its dependency has been fixed.



---

archive/issue_events_417610.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2021-04-26T16:46:15Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30518",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30518#event-417610"
}
```



---

archive/issue_events_417611.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2021-04-26T16:46:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30518",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30518#event-417611"
}
```



---

archive/issue_events_417612.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-04-29T21:06:01Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30518",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30518#event-417612"
}
```



---

archive/issue_events_417613.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-04-29T21:06:01Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/30518",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30518#event-417613"
}
```



---

archive/issue_comments_486408.json:
```json
{
    "body": "Changed branch from **[u/vdelecroix/30518](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/30518)** to **[`c227dad`](https://github.com/sagemath/sagetrac-mirror/commit/c227dad03dbef66c5ab1b2ba3c3cd9e7155c8bed)**",
    "created_at": "2021-04-29T21:06:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30518",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30518#issuecomment-486408",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/vdelecroix/30518](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/30518)** to **[`c227dad`](https://github.com/sagemath/sagetrac-mirror/commit/c227dad03dbef66c5ab1b2ba3c3cd9e7155c8bed)**
