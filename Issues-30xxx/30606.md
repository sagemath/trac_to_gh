# Issue 30606: sage.features.Feature.resolution: If SAGE_ROOT is available, recommend system packages

archive/issues_030369.json:
```json
{
    "assignees": [],
    "body": "Currently, if a `Feature` is keyed to an `spkg`, a `FeatureNotPresentError` recommends to use `sage -i` to install the package.\n\nWhen `SAGE_ROOT` (or `sage_bootstrap`, see #29039) is available, we can do better: \n\n1. We can recommend equivalent system packages for package systems available on the present system.\n\n2. Moreover, if `SAGE_ROOT/bin/sage-spkg` is not available, then we remove the recommendation to use `sage -i`. This is for the benefit of distribution packaging.\n\n   (Distribution packages would typically not install `sage-spkg`, so this information is automatically suppressed -- no more patching is necessary.)\n\n3. Finally, for Python packages that have a `requirements.txt` (see #30024), we also show a `pip` invocation.\n \n(1. and 3. depend on a few scripts from `SAGE_ROOT/build/bin` to be available in the `PATH`. Distribution packages could consider to install these scripts; perhaps, in some libexec-style directory.  Also, `SAGE_ROOT/build/pkgs/*/requirements.txt` and `SAGE_ROOT/build/pkgs/*/distros/` need to be made available at runtime.)\n\n\nWe also add the names of the detected package systems to the default optional tags in use by doctests.\n\n\nCC:  @kiwifb @jhpalmieri @slel @seblabbe\n\nBranch: **[`68a8e2a`](https://github.com/sagemath/sagetrac-mirror/commit/68a8e2afd6c091267d161f55bc4838ad32148d8f)**\n\nReviewer: **S\u00e9bastien Labb\u00e9**\n\nAuthor: **Matthias Koeppe**\n\nComponent: **build: configure**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/30606_\n\n",
    "closed_at": "2020-10-05T20:13:19Z",
    "created_at": "2020-09-18T20:53:02Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20build%3A%20configure",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "sage.features.Feature.resolution: If SAGE_ROOT is available, recommend system packages",
    "type": "issue",
    "updated_at": "2020-10-07T19:33:20Z",
    "url": "https://github.com/sagemath/sage/issues/30606",
    "user": "https://github.com/mkoeppe"
}
```
Currently, if a `Feature` is keyed to an `spkg`, a `FeatureNotPresentError` recommends to use `sage -i` to install the package.

When `SAGE_ROOT` (or `sage_bootstrap`, see #29039) is available, we can do better: 

1. We can recommend equivalent system packages for package systems available on the present system.

2. Moreover, if `SAGE_ROOT/bin/sage-spkg` is not available, then we remove the recommendation to use `sage -i`. This is for the benefit of distribution packaging.

   (Distribution packages would typically not install `sage-spkg`, so this information is automatically suppressed -- no more patching is necessary.)

3. Finally, for Python packages that have a `requirements.txt` (see #30024), we also show a `pip` invocation.
 
(1. and 3. depend on a few scripts from `SAGE_ROOT/build/bin` to be available in the `PATH`. Distribution packages could consider to install these scripts; perhaps, in some libexec-style directory.  Also, `SAGE_ROOT/build/pkgs/*/requirements.txt` and `SAGE_ROOT/build/pkgs/*/distros/` need to be made available at runtime.)


We also add the names of the detected package systems to the default optional tags in use by doctests.


CC:  @kiwifb @jhpalmieri @slel @seblabbe

Branch: **[`68a8e2a`](https://github.com/sagemath/sagetrac-mirror/commit/68a8e2afd6c091267d161f55bc4838ad32148d8f)**

Reviewer: **Sébastien Labbé**

Author: **Matthias Koeppe**

Component: **build: configure**

_Issue created by migration from https://trac.sagemath.org/ticket/30606_





---

archive/issue_events_418835.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-18T20:53:02Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30606",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30606#event-418835"
}
```



---

archive/issue_events_418836.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-18T20:53:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30606",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20build%3A%20configure",
    "label_color": "0000b0",
    "label_name": "c: build: configure",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30606#event-418836"
}
```



---

archive/issue_events_418837.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-18T20:53:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30606",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30606#event-418837"
}
```



---

archive/issue_events_418838.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-18T20:53:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30606",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30606#event-418838"
}
```



---

archive/issue_comments_488272.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,4 +2,7 @@\n \n When `SAGE_ROOT` (or `sage_bootstrap`) is available, we can do better: We can recommend equivalent system packages.\n \n+Moreover, if `SAGE_ROOT/bin/sage-spkg` is not available, then we remove the recommendation to use `sage -i`. This is for the benefit of distribution packaging.\n \n+\n+\n``````\n",
    "created_at": "2020-09-18T22:51:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30606#issuecomment-488272",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,4 +2,7 @@
 
 When `SAGE_ROOT` (or `sage_bootstrap`) is available, we can do better: We can recommend equivalent system packages.
 
+Moreover, if `SAGE_ROOT/bin/sage-spkg` is not available, then we remove the recommendation to use `sage -i`. This is for the benefit of distribution packaging.
 
+
+
``````




---

archive/issue_comments_488273.json:
```json
{
    "body": "Branch: **[u/mkoeppe/sage_features_feature_resolution__if_sage_root_is_available__recommend_system_packages](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/sage_features_feature_resolution__if_sage_root_is_available__recommend_system_packages)**",
    "created_at": "2020-09-19T03:11:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30606#issuecomment-488273",
    "user": "https://github.com/mkoeppe"
}
```

Branch: **[u/mkoeppe/sage_features_feature_resolution__if_sage_root_is_available__recommend_system_packages](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/sage_features_feature_resolution__if_sage_root_is_available__recommend_system_packages)**



---

archive/issue_comments_488274.json:
```json
{
    "body": "Author: **Matthias Koeppe**",
    "created_at": "2020-09-19T03:14:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30606#issuecomment-488274",
    "user": "https://github.com/mkoeppe"
}
```

Author: **Matthias Koeppe**



---

archive/issue_comments_488275.json:
```json
{
    "body": "<div id=\"comment:3\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2a8e3b7a47f42d46a10334756d11fc51921db254\"><code>2a8e3b7</code></a></td><td><code>Feature.resolution: If spkg is given, try to give system package information; only show 'sage -i' if sage-spkg is available</code></td></tr></table>\n",
    "created_at": "2020-09-19T03:14:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30606#issuecomment-488275",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:3"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2a8e3b7a47f42d46a10334756d11fc51921db254"><code>2a8e3b7</code></a></td><td><code>Feature.resolution: If spkg is given, try to give system package information; only show 'sage -i' if sage-spkg is available</code></td></tr></table>




---

archive/issue_comments_488276.json:
```json
{
    "body": "Commit: **[`2a8e3b7`](https://github.com/sagemath/sagetrac-mirror/commit/2a8e3b7a47f42d46a10334756d11fc51921db254)**",
    "created_at": "2020-09-19T03:14:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30606#issuecomment-488276",
    "user": "https://github.com/mkoeppe"
}
```

Commit: **[`2a8e3b7`](https://github.com/sagemath/sagetrac-mirror/commit/2a8e3b7a47f42d46a10334756d11fc51921db254)**



---

archive/issue_events_418839.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-19T03:14:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30606",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30606#event-418839"
}
```



---

archive/issue_comments_488277.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nresolution should be lazier",
    "created_at": "2020-09-19T13:44:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30606#issuecomment-488277",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:4" align="right">comment:4</div>

resolution should be lazier



---

archive/issue_events_418840.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-19T13:44:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30606",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30606#event-418840"
}
```



---

archive/issue_events_418841.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-19T13:44:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30606",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30606#event-418841"
}
```



---

archive/issue_comments_488278.json:
```json
{
    "body": "<div id=\"comment:5\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/febf5e6e153fc826c4ad77ee822766a41c945ddf\"><code>febf5e6</code></a></td><td><code>Feature.resolution: Use lazy strings to delay system package lookup</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/081e7367d6b2081d37a25b73ba3d3333eb8956f0\"><code>081e736</code></a></td><td><code>sage.features.package_systems: New, use it in Feature.resolution</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/36772a5cf26c7a80cd2730c2fdea009e18e7a550\"><code>36772a5</code></a></td><td><code>Feature.resolution: Fix up</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/04fa02da502df29f00c12c92bdc828e8b1948dc2\"><code>04fa02d</code></a></td><td><code>build/bin/{sage-get-system-packages,sage-print-system-package-command}: Handle pip</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3f66ab7d60f1e5e8aee8be19d7680410fdb51f93\"><code>3f66ab7</code></a></td><td><code>build/bin/sage-print-system-package-command: Handle --prompt=PROMPT, fix error reporting</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d2055ac0443b48b20c0f12b5b810cda1e42f77d5\"><code>d2055ac</code></a></td><td><code>sage.features: Add features PackageSystem, SagePackageSystem, PipPackageSystem, use them in Feature.resolution</code></td></tr></table>\n",
    "created_at": "2020-09-19T18:29:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30606#issuecomment-488278",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:5"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/febf5e6e153fc826c4ad77ee822766a41c945ddf"><code>febf5e6</code></a></td><td><code>Feature.resolution: Use lazy strings to delay system package lookup</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/081e7367d6b2081d37a25b73ba3d3333eb8956f0"><code>081e736</code></a></td><td><code>sage.features.package_systems: New, use it in Feature.resolution</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/36772a5cf26c7a80cd2730c2fdea009e18e7a550"><code>36772a5</code></a></td><td><code>Feature.resolution: Fix up</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/04fa02da502df29f00c12c92bdc828e8b1948dc2"><code>04fa02d</code></a></td><td><code>build/bin/{sage-get-system-packages,sage-print-system-package-command}: Handle pip</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3f66ab7d60f1e5e8aee8be19d7680410fdb51f93"><code>3f66ab7</code></a></td><td><code>build/bin/sage-print-system-package-command: Handle --prompt=PROMPT, fix error reporting</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d2055ac0443b48b20c0f12b5b810cda1e42f77d5"><code>d2055ac</code></a></td><td><code>sage.features: Add features PackageSystem, SagePackageSystem, PipPackageSystem, use them in Feature.resolution</code></td></tr></table>




---

archive/issue_comments_488279.json:
```json
{
    "body": "Changed commit from **[`2a8e3b7`](https://github.com/sagemath/sagetrac-mirror/commit/2a8e3b7a47f42d46a10334756d11fc51921db254)** to **[`d2055ac`](https://github.com/sagemath/sagetrac-mirror/commit/d2055ac0443b48b20c0f12b5b810cda1e42f77d5)**",
    "created_at": "2020-09-19T18:29:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30606#issuecomment-488279",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`2a8e3b7`](https://github.com/sagemath/sagetrac-mirror/commit/2a8e3b7a47f42d46a10334756d11fc51921db254)** to **[`d2055ac`](https://github.com/sagemath/sagetrac-mirror/commit/d2055ac0443b48b20c0f12b5b810cda1e42f77d5)**



---

archive/issue_comments_488280.json:
```json
{
    "body": "<div id=\"comment:6\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fa10a901256c0c133b5957a48cc57fd5a8a9832f\"><code>fa10a90</code></a></td><td><code>src/sage/features/__init__.py: Add doctests</code></td></tr></table>\n",
    "created_at": "2020-09-19T19:02:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30606#issuecomment-488280",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:6"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fa10a901256c0c133b5957a48cc57fd5a8a9832f"><code>fa10a90</code></a></td><td><code>src/sage/features/__init__.py: Add doctests</code></td></tr></table>




---

archive/issue_comments_488281.json:
```json
{
    "body": "Changed commit from **[`d2055ac`](https://github.com/sagemath/sagetrac-mirror/commit/d2055ac0443b48b20c0f12b5b810cda1e42f77d5)** to **[`fa10a90`](https://github.com/sagemath/sagetrac-mirror/commit/fa10a901256c0c133b5957a48cc57fd5a8a9832f)**",
    "created_at": "2020-09-19T19:02:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30606#issuecomment-488281",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`d2055ac`](https://github.com/sagemath/sagetrac-mirror/commit/d2055ac0443b48b20c0f12b5b810cda1e42f77d5)** to **[`fa10a90`](https://github.com/sagemath/sagetrac-mirror/commit/fa10a901256c0c133b5957a48cc57fd5a8a9832f)**



---

archive/issue_comments_488282.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -4,5 +4,6 @@\n \n Moreover, if `SAGE_ROOT/bin/sage-spkg` is not available, then we remove the recommendation to use `sage -i`. This is for the benefit of distribution packaging.\n \n+Finally, for Python packages that have a `requirements.txt` (see #30024), we also show a `pip` invocation.\n+ \n \n-\n``````\n",
    "created_at": "2020-09-19T19:04:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30606#issuecomment-488282",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -4,5 +4,6 @@
 
 Moreover, if `SAGE_ROOT/bin/sage-spkg` is not available, then we remove the recommendation to use `sage -i`. This is for the benefit of distribution packaging.
 
+Finally, for Python packages that have a `requirements.txt` (see #30024), we also show a `pip` invocation.
+ 
 
-
``````




---

archive/issue_events_418842.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-19T19:04:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30606",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30606#event-418842"
}
```



---

archive/issue_events_418843.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-19T19:04:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30606",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30606#event-418843"
}
```



---

archive/issue_comments_488283.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nI immediately thought that the doctests would fail in sage-on-gentoo and more generally in sage-on-distros. And I was right.\n\n```\nsage -t --long --warn-long 112.3 --random-seed=0 /usr/lib/python3.7/site-packages/sage/features/__init__.py\n**********************************************************************\nFile \"/usr/lib/python3.7/site-packages/sage/features/__init__.py\", line 43, in sage.features\nFailed example:\n    Executable(name=\"random\", executable=\"randomOochoz6x\", spkg=\"random\", url=\"http://rand.om\").require()\nExpected:\n    Traceback (most recent call last):\n    ...\n    FeatureNotPresentError: random is not available.\n    Executable 'randomOochoz6x' not found on PATH.\n    ...try to run...sage -i random...\n    Further installation instructions might be available at http://rand.om.\nGot:\n    <BLANKLINE>\n    Traceback (most recent call last):\n      File \"/usr/lib/python3.7/site-packages/sage/doctest/forker.py\", line 720, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/usr/lib/python3.7/site-packages/sage/doctest/forker.py\", line 1145, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.features[5]>\", line 1, in <module>\n        Executable(name=\"random\", executable=\"randomOochoz6x\", spkg=\"random\", url=\"http://rand.om\").require()\n      File \"/usr/lib/python3.7/site-packages/sage/features/__init__.py\", line 192, in require\n        raise FeatureNotPresentError(self, presence.reason, presence.resolution)\n    sage.features.FeatureNotPresentError: random is not available.\n    Executable 'randomOochoz6x' not found on PATH.\n    No equivalent system packages for pip are known to Sage.\n    Further installation instructions might be available at http://rand.om.\n**********************************************************************\nFile \"/usr/lib/python3.7/site-packages/sage/features/__init__.py\", line 219, in sage.features.Feature.resolution\nFailed example:\n    Executable(name=\"CSDP\", spkg=\"csdp\", executable=\"theta\", url=\"http://github.org/dimpase/csdp\").resolution()\nExpected:\n    l'...To install CSDP...you can try to run...sage -i csdp...Further installation instructions might be available at http://github.org/dimpase/csdp.'\nGot:\n    l'No equivalent system packages for pip are known to Sage.\\nFurther installation instructions might be available at http://github.org/dimpase/csdp.'\n**********************************************************************\nFile \"/usr/lib/python3.7/site-packages/sage/features/__init__.py\", line 307, in sage.features.FeatureTestResult\nFailed example:\n    str(FeatureTestResult(package, True).resolution)\nExpected:\n    '...To install GAP package NOT_A_PACKAGE...you can try to run...sage -i no_package...'\nGot:\n    'No equivalent system packages for pip are known to Sage.'\n**********************************************************************\nFile \"/usr/lib/python3.7/site-packages/sage/features/__init__.py\", line 309, in sage.features.FeatureTestResult\nFailed example:\n    str(FeatureTestResult(package, False).resolution)\nExpected:\n    '...To install GAP package NOT_A_PACKAGE...you can try to run...sage -i no_package...'\nGot:\n    'No equivalent system packages for pip are known to Sage.'\n**********************************************************************\nFile \"/usr/lib/python3.7/site-packages/sage/features/__init__.py\", line 623, in sage.features.StaticFile\nFailed example:\n    StaticFile(name=\"no_such_file\", filename=\"KaT1aihu\", search_path=(\"/\",), spkg=\"some_spkg\", url=\"http://rand.om\").require()\nExpected:\n    Traceback (most recent call last):\n    ...\n    FeatureNotPresentError: no_such_file is not available.\n    'KaT1aihu' not found in any of ['/']...\n    To install no_such_file...you can try to run...sage -i some_spkg...\n    Further installation instructions might be available at http://rand.om.\nGot:\n    <BLANKLINE>\n    Traceback (most recent call last):\n      File \"/usr/lib/python3.7/site-packages/sage/doctest/forker.py\", line 720, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/usr/lib/python3.7/site-packages/sage/doctest/forker.py\", line 1145, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.features.StaticFile[1]>\", line 1, in <module>\n        StaticFile(name=\"no_such_file\", filename=\"KaT1aihu\", search_path=(\"/\",), spkg=\"some_spkg\", url=\"http://rand.om\").require()\n      File \"/usr/lib/python3.7/site-packages/sage/features/__init__.py\", line 192, in require\n        raise FeatureNotPresentError(self, presence.reason, presence.resolution)\n    sage.features.FeatureNotPresentError: no_such_file is not available.\n    'KaT1aihu' not found in any of ['/']\n    No equivalent system packages for pip are known to Sage.\n    Further installation instructions might be available at http://rand.om.\n**********************************************************************\nFile \"/usr/lib/python3.7/site-packages/sage/features/__init__.py\", line 673, in sage.features.StaticFile.absolute_path\nFailed example:\n    StaticFile(name=\"no_such_file\", filename=\"KaT1aihu\", search_path=(), spkg=\"some_spkg\", url=\"http://rand.om\").absolute_path()\nExpected:\n    Traceback (most recent call last):\n    ...\n    FeatureNotPresentError: no_such_file is not available.\n    'KaT1aihu' not found in any of []...\n    To install no_such_file...you can try to run...sage -i some_spkg...\n    Further installation instructions might be available at http://rand.om.\nGot:\n    <BLANKLINE>\n    Traceback (most recent call last):\n      File \"/usr/lib/python3.7/site-packages/sage/doctest/forker.py\", line 720, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/usr/lib/python3.7/site-packages/sage/doctest/forker.py\", line 1145, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.features.StaticFile.absolute_path[2]>\", line 1, in <module>\n        StaticFile(name=\"no_such_file\", filename=\"KaT1aihu\", search_path=(), spkg=\"some_spkg\", url=\"http://rand.om\").absolute_path()\n      File \"/usr/lib/python3.7/site-packages/sage/features/__init__.py\", line 687, in absolute_path\n        resolution=self.resolution())\n    sage.features.FeatureNotPresentError: no_such_file is not available.\n    'KaT1aihu' not found in any of []\n    No equivalent system packages for pip are known to Sage.\n    Further installation instructions might be available at http://rand.om.\n**********************************************************************\n5 items had failures:\n   1 of   7 in sage.features\n   1 of   3 in sage.features.Feature.resolution\n   2 of  11 in sage.features.FeatureTestResult\n   1 of   3 in sage.features.StaticFile\n   1 of   4 in sage.features.StaticFile.absolute_path\n    [118 tests, 6 failures, 9.26 s]\n----------------------------------------------------------------------\nsage -t --long --warn-long 112.3 --random-seed=0 /usr/lib/python3.7/site-packages/sage/features/__init__.py  # 6 doctests failed\n```\nAt least that may tell you if things are working as you expected them.",
    "created_at": "2020-09-19T20:23:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30606#issuecomment-488283",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:8" align="right">comment:8</div>

I immediately thought that the doctests would fail in sage-on-gentoo and more generally in sage-on-distros. And I was right.

```
sage -t --long --warn-long 112.3 --random-seed=0 /usr/lib/python3.7/site-packages/sage/features/__init__.py
**********************************************************************
File "/usr/lib/python3.7/site-packages/sage/features/__init__.py", line 43, in sage.features
Failed example:
    Executable(name="random", executable="randomOochoz6x", spkg="random", url="http://rand.om").require()
Expected:
    Traceback (most recent call last):
    ...
    FeatureNotPresentError: random is not available.
    Executable 'randomOochoz6x' not found on PATH.
    ...try to run...sage -i random...
    Further installation instructions might be available at http://rand.om.
Got:
    <BLANKLINE>
    Traceback (most recent call last):
      File "/usr/lib/python3.7/site-packages/sage/doctest/forker.py", line 720, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/lib/python3.7/site-packages/sage/doctest/forker.py", line 1145, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.features[5]>", line 1, in <module>
        Executable(name="random", executable="randomOochoz6x", spkg="random", url="http://rand.om").require()
      File "/usr/lib/python3.7/site-packages/sage/features/__init__.py", line 192, in require
        raise FeatureNotPresentError(self, presence.reason, presence.resolution)
    sage.features.FeatureNotPresentError: random is not available.
    Executable 'randomOochoz6x' not found on PATH.
    No equivalent system packages for pip are known to Sage.
    Further installation instructions might be available at http://rand.om.
**********************************************************************
File "/usr/lib/python3.7/site-packages/sage/features/__init__.py", line 219, in sage.features.Feature.resolution
Failed example:
    Executable(name="CSDP", spkg="csdp", executable="theta", url="http://github.org/dimpase/csdp").resolution()
Expected:
    l'...To install CSDP...you can try to run...sage -i csdp...Further installation instructions might be available at http://github.org/dimpase/csdp.'
Got:
    l'No equivalent system packages for pip are known to Sage.\nFurther installation instructions might be available at http://github.org/dimpase/csdp.'
**********************************************************************
File "/usr/lib/python3.7/site-packages/sage/features/__init__.py", line 307, in sage.features.FeatureTestResult
Failed example:
    str(FeatureTestResult(package, True).resolution)
Expected:
    '...To install GAP package NOT_A_PACKAGE...you can try to run...sage -i no_package...'
Got:
    'No equivalent system packages for pip are known to Sage.'
**********************************************************************
File "/usr/lib/python3.7/site-packages/sage/features/__init__.py", line 309, in sage.features.FeatureTestResult
Failed example:
    str(FeatureTestResult(package, False).resolution)
Expected:
    '...To install GAP package NOT_A_PACKAGE...you can try to run...sage -i no_package...'
Got:
    'No equivalent system packages for pip are known to Sage.'
**********************************************************************
File "/usr/lib/python3.7/site-packages/sage/features/__init__.py", line 623, in sage.features.StaticFile
Failed example:
    StaticFile(name="no_such_file", filename="KaT1aihu", search_path=("/",), spkg="some_spkg", url="http://rand.om").require()
Expected:
    Traceback (most recent call last):
    ...
    FeatureNotPresentError: no_such_file is not available.
    'KaT1aihu' not found in any of ['/']...
    To install no_such_file...you can try to run...sage -i some_spkg...
    Further installation instructions might be available at http://rand.om.
Got:
    <BLANKLINE>
    Traceback (most recent call last):
      File "/usr/lib/python3.7/site-packages/sage/doctest/forker.py", line 720, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/lib/python3.7/site-packages/sage/doctest/forker.py", line 1145, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.features.StaticFile[1]>", line 1, in <module>
        StaticFile(name="no_such_file", filename="KaT1aihu", search_path=("/",), spkg="some_spkg", url="http://rand.om").require()
      File "/usr/lib/python3.7/site-packages/sage/features/__init__.py", line 192, in require
        raise FeatureNotPresentError(self, presence.reason, presence.resolution)
    sage.features.FeatureNotPresentError: no_such_file is not available.
    'KaT1aihu' not found in any of ['/']
    No equivalent system packages for pip are known to Sage.
    Further installation instructions might be available at http://rand.om.
**********************************************************************
File "/usr/lib/python3.7/site-packages/sage/features/__init__.py", line 673, in sage.features.StaticFile.absolute_path
Failed example:
    StaticFile(name="no_such_file", filename="KaT1aihu", search_path=(), spkg="some_spkg", url="http://rand.om").absolute_path()
Expected:
    Traceback (most recent call last):
    ...
    FeatureNotPresentError: no_such_file is not available.
    'KaT1aihu' not found in any of []...
    To install no_such_file...you can try to run...sage -i some_spkg...
    Further installation instructions might be available at http://rand.om.
Got:
    <BLANKLINE>
    Traceback (most recent call last):
      File "/usr/lib/python3.7/site-packages/sage/doctest/forker.py", line 720, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/lib/python3.7/site-packages/sage/doctest/forker.py", line 1145, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.features.StaticFile.absolute_path[2]>", line 1, in <module>
        StaticFile(name="no_such_file", filename="KaT1aihu", search_path=(), spkg="some_spkg", url="http://rand.om").absolute_path()
      File "/usr/lib/python3.7/site-packages/sage/features/__init__.py", line 687, in absolute_path
        resolution=self.resolution())
    sage.features.FeatureNotPresentError: no_such_file is not available.
    'KaT1aihu' not found in any of []
    No equivalent system packages for pip are known to Sage.
    Further installation instructions might be available at http://rand.om.
**********************************************************************
5 items had failures:
   1 of   7 in sage.features
   1 of   3 in sage.features.Feature.resolution
   2 of  11 in sage.features.FeatureTestResult
   1 of   3 in sage.features.StaticFile
   1 of   4 in sage.features.StaticFile.absolute_path
    [118 tests, 6 failures, 9.26 s]
----------------------------------------------------------------------
sage -t --long --warn-long 112.3 --random-seed=0 /usr/lib/python3.7/site-packages/sage/features/__init__.py  # 6 doctests failed
```
At least that may tell you if things are working as you expected them.



---

archive/issue_comments_488284.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nThanks for testing! This code is meant to work also on distributions without patching. I'll try to fix it.",
    "created_at": "2020-09-19T20:25:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30606#issuecomment-488284",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:9" align="right">comment:9</div>

Thanks for testing! This code is meant to work also on distributions without patching. I'll try to fix it.



---

archive/issue_comments_488285.json:
```json
{
    "body": "Changed commit from **[`fa10a90`](https://github.com/sagemath/sagetrac-mirror/commit/fa10a901256c0c133b5957a48cc57fd5a8a9832f)** to **[`c01aa8f`](https://github.com/sagemath/sagetrac-mirror/commit/c01aa8f97a6258d671f07bc7bde518f8442bdd40)**",
    "created_at": "2020-09-19T20:43:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30606#issuecomment-488285",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`fa10a90`](https://github.com/sagemath/sagetrac-mirror/commit/fa10a901256c0c133b5957a48cc57fd5a8a9832f)** to **[`c01aa8f`](https://github.com/sagemath/sagetrac-mirror/commit/c01aa8f97a6258d671f07bc7bde518f8442bdd40)**



---

archive/issue_comments_488286.json:
```json
{
    "body": "<div id=\"comment:10\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/14e93956e63aa917cde4c3cf83a655088f146a41\"><code>14e9395</code></a></td><td><code>SagePackageSystem: Rename to sage_spkg (underscore) to make it an allowed optional tag</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5c0da17fbb9f450db16addd151e3f6f1a6a62045\"><code>5c0da17</code></a></td><td><code>src/sage/doctest/control.py: Add available package systems to optional tags</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c01aa8f97a6258d671f07bc7bde518f8442bdd40\"><code>c01aa8f</code></a></td><td><code>src/sage/features/__init__.py: Mark tests that check for 'sage -i' optional - sage_spkg</code></td></tr></table>\n",
    "created_at": "2020-09-19T20:43:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30606#issuecomment-488286",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:10"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/14e93956e63aa917cde4c3cf83a655088f146a41"><code>14e9395</code></a></td><td><code>SagePackageSystem: Rename to sage_spkg (underscore) to make it an allowed optional tag</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5c0da17fbb9f450db16addd151e3f6f1a6a62045"><code>5c0da17</code></a></td><td><code>src/sage/doctest/control.py: Add available package systems to optional tags</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c01aa8f97a6258d671f07bc7bde518f8442bdd40"><code>c01aa8f</code></a></td><td><code>src/sage/features/__init__.py: Mark tests that check for 'sage -i' optional - sage_spkg</code></td></tr></table>




---

archive/issue_comments_488287.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,9 +1,12 @@\n Currently, if a `Feature` is keyed to an `spkg`, a `FeatureNotPresentError` recommends to use `sage -i` to install the package.\n \n-When `SAGE_ROOT` (or `sage_bootstrap`) is available, we can do better: We can recommend equivalent system packages.\n+When `SAGE_ROOT` (or `sage_bootstrap`) is available, we can do better: \n \n-Moreover, if `SAGE_ROOT/bin/sage-spkg` is not available, then we remove the recommendation to use `sage -i`. This is for the benefit of distribution packaging.\n+1. We can recommend equivalent system packages.\n \n-Finally, for Python packages that have a `requirements.txt` (see #30024), we also show a `pip` invocation.\n+2. Moreover, if `SAGE_ROOT/bin/sage-spkg` is not available, then we remove the recommendation to use `sage -i`. This is for the benefit of distribution packaging.\n+\n+3. Finally, for Python packages that have a `requirements.txt` (see #30024), we also show a `pip` invocation.\n  \n \n+We also add the names of the detected package systems to the default optional tags in use by doctests.\n``````\n",
    "created_at": "2020-09-19T20:44:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30606#issuecomment-488287",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,9 +1,12 @@
 Currently, if a `Feature` is keyed to an `spkg`, a `FeatureNotPresentError` recommends to use `sage -i` to install the package.
 
-When `SAGE_ROOT` (or `sage_bootstrap`) is available, we can do better: We can recommend equivalent system packages.
+When `SAGE_ROOT` (or `sage_bootstrap`) is available, we can do better: 
 
-Moreover, if `SAGE_ROOT/bin/sage-spkg` is not available, then we remove the recommendation to use `sage -i`. This is for the benefit of distribution packaging.
+1. We can recommend equivalent system packages.
 
-Finally, for Python packages that have a `requirements.txt` (see #30024), we also show a `pip` invocation.
+2. Moreover, if `SAGE_ROOT/bin/sage-spkg` is not available, then we remove the recommendation to use `sage -i`. This is for the benefit of distribution packaging.
+
+3. Finally, for Python packages that have a `requirements.txt` (see #30024), we also show a `pip` invocation.
  
 
+We also add the names of the detected package systems to the default optional tags in use by doctests.
``````




---

archive/issue_comments_488288.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,11 +2,16 @@\n \n When `SAGE_ROOT` (or `sage_bootstrap`) is available, we can do better: \n \n-1. We can recommend equivalent system packages.\n+1. We can recommend equivalent system packages for package systems available on the present system.\n \n 2. Moreover, if `SAGE_ROOT/bin/sage-spkg` is not available, then we remove the recommendation to use `sage -i`. This is for the benefit of distribution packaging.\n \n+   (Distribution packages would typically not install `sage-spkg`, so this information is automatically suppressed -- no more patching is necessary.)\n+\n 3. Finally, for Python packages that have a `requirements.txt` (see #30024), we also show a `pip` invocation.\n  \n+(1. and 3. depend on a few scripts from `SAGE_ROOT/build/bin` to be available in the `PATH`. Distribution packages could consider to install these scripts; perhaps, in some libexec-style directory.  Also, `SAGE_ROOT/build/pkgs/*/requirements.txt` and `SAGE_ROOT/build/pkgs/*/distros/` need to be made available at runtime.)\n+\n \n We also add the names of the detected package systems to the default optional tags in use by doctests.\n+\n``````\n",
    "created_at": "2020-09-19T20:55:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30606#issuecomment-488288",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,11 +2,16 @@
 
 When `SAGE_ROOT` (or `sage_bootstrap`) is available, we can do better: 
 
-1. We can recommend equivalent system packages.
+1. We can recommend equivalent system packages for package systems available on the present system.
 
 2. Moreover, if `SAGE_ROOT/bin/sage-spkg` is not available, then we remove the recommendation to use `sage -i`. This is for the benefit of distribution packaging.
 
+   (Distribution packages would typically not install `sage-spkg`, so this information is automatically suppressed -- no more patching is necessary.)
+
 3. Finally, for Python packages that have a `requirements.txt` (see #30024), we also show a `pip` invocation.
  
+(1. and 3. depend on a few scripts from `SAGE_ROOT/build/bin` to be available in the `PATH`. Distribution packages could consider to install these scripts; perhaps, in some libexec-style directory.  Also, `SAGE_ROOT/build/pkgs/*/requirements.txt` and `SAGE_ROOT/build/pkgs/*/distros/` need to be made available at runtime.)
+
 
 We also add the names of the detected package systems to the default optional tags in use by doctests.
+
``````




---

archive/issue_comments_488289.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,6 @@\n Currently, if a `Feature` is keyed to an `spkg`, a `FeatureNotPresentError` recommends to use `sage -i` to install the package.\n \n-When `SAGE_ROOT` (or `sage_bootstrap`) is available, we can do better: \n+When `SAGE_ROOT` (or `sage_bootstrap`, see #29039) is available, we can do better: \n \n 1. We can recommend equivalent system packages for package systems available on the present system.\n \n``````\n",
    "created_at": "2020-09-19T20:58:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30606#issuecomment-488289",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,6 @@
 Currently, if a `Feature` is keyed to an `spkg`, a `FeatureNotPresentError` recommends to use `sage -i` to install the package.
 
-When `SAGE_ROOT` (or `sage_bootstrap`) is available, we can do better: 
+When `SAGE_ROOT` (or `sage_bootstrap`, see #29039) is available, we can do better: 
 
 1. We can recommend equivalent system packages for package systems available on the present system.
 
``````




---

archive/issue_comments_488290.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nWith Ubuntu 18.04 + 9.2beta12 + #30053 (so that it uses sage's python 3.8 instead of system 3.6 which can't get the doc to build) + #30606, I obtain what's below.\n\nI don't know if it is noise yet, so, I pasted it here instead: https://groups.google.com/g/sage-devel/c/_8oQ4T9WxD4/m/S0ywrlUNAwAJ",
    "created_at": "2020-09-21T07:42:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30606#issuecomment-488290",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:15" align="right">comment:15</div>

With Ubuntu 18.04 + 9.2beta12 + #30053 (so that it uses sage's python 3.8 instead of system 3.6 which can't get the doc to build) + #30606, I obtain what's below.

I don't know if it is noise yet, so, I pasted it here instead: https://groups.google.com/g/sage-devel/c/_8oQ4T9WxD4/m/S0ywrlUNAwAJ



---

archive/issue_comments_488291.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nReplying to [@seblabbe](#comment%3A15):\n> With Ubuntu 18.04 + 9.2beta12 + #30053 (so that it uses sage's python 3.8 instead of system 3.6 which can't get the doc to build) + #30606, I obtain what's below.\n> \n> I don't know if it is noise yet, so, I pasted it here instead: https://groups.google.com/g/sage-devel/c/_8oQ4T9WxD4/m/S0ywrlUNAwAJ\n\nIMHO it's better to put \"noise\" here - you can edit later on - than on a list with a much larger readership.\n\nAnyhow, changing Python needs a big rebuild (of everything depending on Python), so the error looks unsurprising.",
    "created_at": "2020-09-21T08:01:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30606#issuecomment-488291",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:16" align="right">comment:16</div>

Replying to [@seblabbe](#comment%3A15):
> With Ubuntu 18.04 + 9.2beta12 + #30053 (so that it uses sage's python 3.8 instead of system 3.6 which can't get the doc to build) + #30606, I obtain what's below.
> 
> I don't know if it is noise yet, so, I pasted it here instead: https://groups.google.com/g/sage-devel/c/_8oQ4T9WxD4/m/S0ywrlUNAwAJ

IMHO it's better to put "noise" here - you can edit later on - than on a list with a much larger readership.

Anyhow, changing Python needs a big rebuild (of everything depending on Python), so the error looks unsurprising.



---

archive/issue_comments_488292.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nIt was noise, sorry. Yes, you are right, I should have put it here, and erased it after...",
    "created_at": "2020-09-21T09:02:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30606#issuecomment-488292",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:17" align="right">comment:17</div>

It was noise, sorry. Yes, you are right, I should have put it here, and erased it after...



---

archive/issue_events_418844.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2020-09-21T09:03:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30606",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30606#event-418844"
}
```



---

archive/issue_events_418845.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2020-09-21T09:03:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30606",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30606#event-418845"
}
```



---

archive/issue_comments_488293.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nI get error building the documentation:\n\n```\n[dochtml] OSError: /home/slabbe/GitBox/sage/local/lib/python3.8/site-packages/sage/features/__init__.py:docstrin\ng of sage.features.PackageSystem.spkg_installation_hint:9: WARNING: Block quote ends without a blank line; unexp\nected unindent.\n```",
    "created_at": "2020-09-21T09:03:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30606#issuecomment-488293",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:18" align="right">comment:18</div>

I get error building the documentation:

```
[dochtml] OSError: /home/slabbe/GitBox/sage/local/lib/python3.8/site-packages/sage/features/__init__.py:docstrin
g of sage.features.PackageSystem.spkg_installation_hint:9: WARNING: Block quote ends without a blank line; unexp
ected unindent.
```



---

archive/issue_comments_488294.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nMany docstrings are starting with `\"\"\"` instead of `r\"\"\"`. Maybe that's the issue?",
    "created_at": "2020-09-21T09:08:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30606#issuecomment-488294",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:19" align="right">comment:19</div>

Many docstrings are starting with `"""` instead of `r"""`. Maybe that's the issue?



---

archive/issue_comments_488295.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nYes it is. I pushed my current branch #30053 + #30606 rebased on top of #30053 + 1 commit fixing the docstring here: u/slabbe/30606 on which doc builds.",
    "created_at": "2020-09-21T09:29:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30606#issuecomment-488295",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:20" align="right">comment:20</div>

Yes it is. I pushed my current branch #30053 + #30606 rebased on top of #30053 + 1 commit fixing the docstring here: u/slabbe/30606 on which doc builds.



---

archive/issue_comments_488296.json:
```json
{
    "body": "<div id=\"comment:21\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5ef159c13139a1aee142cce1c34cf1ba2ff01a83\"><code>5ef159c</code></a></td><td><code>30606: fixing docstring \"\"\" -> r\"\"\"</code></td></tr></table>\n",
    "created_at": "2020-09-21T15:50:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30606#issuecomment-488296",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:21"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5ef159c13139a1aee142cce1c34cf1ba2ff01a83"><code>5ef159c</code></a></td><td><code>30606: fixing docstring """ -> r"""</code></td></tr></table>




---

archive/issue_comments_488297.json:
```json
{
    "body": "Changed commit from **[`c01aa8f`](https://github.com/sagemath/sagetrac-mirror/commit/c01aa8f97a6258d671f07bc7bde518f8442bdd40)** to **[`5ef159c`](https://github.com/sagemath/sagetrac-mirror/commit/5ef159c13139a1aee142cce1c34cf1ba2ff01a83)**",
    "created_at": "2020-09-21T15:50:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30606#issuecomment-488297",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`c01aa8f`](https://github.com/sagemath/sagetrac-mirror/commit/c01aa8f97a6258d671f07bc7bde518f8442bdd40)** to **[`5ef159c`](https://github.com/sagemath/sagetrac-mirror/commit/5ef159c13139a1aee142cce1c34cf1ba2ff01a83)**



---

archive/issue_comments_488298.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nThank you! I have cherry-picked your commit onto my branch.",
    "created_at": "2020-09-21T15:50:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30606#issuecomment-488298",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:22" align="right">comment:22</div>

Thank you! I have cherry-picked your commit onto my branch.



---

archive/issue_events_418846.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-21T15:50:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30606",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30606#event-418846"
}
```



---

archive/issue_events_418847.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-21T15:50:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30606",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30606#event-418847"
}
```



---

archive/issue_comments_488299.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nPatchbot shows the following doctest failing:\n\n```\nsage -t --long --random-seed=0 src/sage/doctest/control.py\n**********************************************************************\nFile \"src/sage/doctest/control.py\", line 777, in sage.doctest.control.DocTestController.expand_files_into_sources\nFailed example:\n    sorted(DC.sources[0].options.optional)  # abs tol 1\nExpected:\n    ['guava', 'magma', 'py2']\nGot:\n    ['debian', 'guava', 'magma', 'pip', 'py3', 'sage_spkg']\n**********************************************************************\nFile \"src/sage/doctest/control.py\", line 1009, in sage.doctest.control.DocTestController._optional_tags_string\nFailed example:\n    DC._optional_tags_string()\nExpected:\n    'openssl,sage'\nGot:\n    'debian,openssl,pip,sage,sage_spkg'\n**********************************************************************\n2 items had failures:\n   1 of   8 in sage.doctest.control.DocTestController._optional_tags_string\n   1 of  23 in sage.doctest.control.DocTestController.expand_files_into_sources\n    [208 tests, 2 failures, 4.49 s]\n----------------------------------------------------------------------\nsage -t --long --random-seed=0 src/sage/doctest/control.py  # 2 doctests failed\n----------------------------------------------------------------------\n```\n\nAlso reported by the patchbot, `EXAMPLE::` should always be plural `EXAMPLES::`.",
    "created_at": "2020-09-23T11:14:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30606#issuecomment-488299",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:24" align="right">comment:24</div>

Patchbot shows the following doctest failing:

```
sage -t --long --random-seed=0 src/sage/doctest/control.py
**********************************************************************
File "src/sage/doctest/control.py", line 777, in sage.doctest.control.DocTestController.expand_files_into_sources
Failed example:
    sorted(DC.sources[0].options.optional)  # abs tol 1
Expected:
    ['guava', 'magma', 'py2']
Got:
    ['debian', 'guava', 'magma', 'pip', 'py3', 'sage_spkg']
**********************************************************************
File "src/sage/doctest/control.py", line 1009, in sage.doctest.control.DocTestController._optional_tags_string
Failed example:
    DC._optional_tags_string()
Expected:
    'openssl,sage'
Got:
    'debian,openssl,pip,sage,sage_spkg'
**********************************************************************
2 items had failures:
   1 of   8 in sage.doctest.control.DocTestController._optional_tags_string
   1 of  23 in sage.doctest.control.DocTestController.expand_files_into_sources
    [208 tests, 2 failures, 4.49 s]
----------------------------------------------------------------------
sage -t --long --random-seed=0 src/sage/doctest/control.py  # 2 doctests failed
----------------------------------------------------------------------
```

Also reported by the patchbot, `EXAMPLE::` should always be plural `EXAMPLES::`.



---

archive/issue_events_418848.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2020-09-23T11:16:33Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30606",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30606#event-418848"
}
```



---

archive/issue_events_418849.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2020-09-23T11:16:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30606",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30606#event-418849"
}
```



---

archive/issue_comments_488300.json:
```json
{
    "body": "Changed commit from **[`5ef159c`](https://github.com/sagemath/sagetrac-mirror/commit/5ef159c13139a1aee142cce1c34cf1ba2ff01a83)** to **[`68a8e2a`](https://github.com/sagemath/sagetrac-mirror/commit/68a8e2afd6c091267d161f55bc4838ad32148d8f)**",
    "created_at": "2020-09-23T11:51:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30606#issuecomment-488300",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`5ef159c`](https://github.com/sagemath/sagetrac-mirror/commit/5ef159c13139a1aee142cce1c34cf1ba2ff01a83)** to **[`68a8e2a`](https://github.com/sagemath/sagetrac-mirror/commit/68a8e2afd6c091267d161f55bc4838ad32148d8f)**



---

archive/issue_comments_488301.json:
```json
{
    "body": "<div id=\"comment:26\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d344adff9fc49cc09a68ad496f10cd15a023e871\"><code>d344adf</code></a></td><td><code>Merge tag '9.2.beta13' into t/30606/sage_features_feature_resolution__if_sage_root_is_available__recommend_system_packages</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a854438114e06147248cd413b483e5f11b4e2aff\"><code>a854438</code></a></td><td><code>DocTestController.__init__: Only add package systems when 'optional' is used</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/68a8e2afd6c091267d161f55bc4838ad32148d8f\"><code>68a8e2a</code></a></td><td><code>src/sage/features/__init__.py: Fix patchbot / relint warnings</code></td></tr></table>\n",
    "created_at": "2020-09-23T11:51:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30606#issuecomment-488301",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:26"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d344adff9fc49cc09a68ad496f10cd15a023e871"><code>d344adf</code></a></td><td><code>Merge tag '9.2.beta13' into t/30606/sage_features_feature_resolution__if_sage_root_is_available__recommend_system_packages</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a854438114e06147248cd413b483e5f11b4e2aff"><code>a854438</code></a></td><td><code>DocTestController.__init__: Only add package systems when 'optional' is used</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/68a8e2afd6c091267d161f55bc4838ad32148d8f"><code>68a8e2a</code></a></td><td><code>src/sage/features/__init__.py: Fix patchbot / relint warnings</code></td></tr></table>




---

archive/issue_events_418850.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-23T11:51:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30606",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30606#event-418850"
}
```



---

archive/issue_events_418851.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-23T11:51:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30606",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30606#event-418851"
}
```



---

archive/issue_comments_488302.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nI did few tests, I get:\n\n```\nsage: from sage.features import package_systems\nsage: package_systems()\n[Feature('debian'), Feature('sage_spkg'), Feature('pip')]\n```\n\nSo this looks good:\n\n```\nsage: from sage.features import PackageSystem\nsage: PackageSystem('condaa').is_present()\nFeatureTestResult('condaa', False)\nsage: PackageSystem('conda').is_present()\nFeatureTestResult('conda', False)\nsage: PackageSystem('debian').is_present()\nFeatureTestResult('debian', True)\n```\n\nIt seems one needs to avoid `PackageSystem('sage_spkg')`:\n\n```\nsage: from sage.features import SagePackageSystem\nsage: A = PackageSystem('sage_spkg')\nsage: B = SagePackageSystem()\nsage: A\nFeature('sage_spkg')\nsage: B\nFeature('sage_spkg')\nsage: A.is_present()        # expecting True\nFeatureTestResult('sage_spkg', False)\nsage: B.is_present()\nFeatureTestResult('sage_spkg', True)\n```\n\nSimilarly, \n\n```\nsage: PackageSystem('pip').is_present()   # I was expecting True here\nFeatureTestResult('pip', False)\n```\n\nThe following looks good:\n\n```\nsage: PackageSystem('pip').spkg_installation_hint('jupyterlab')\n'To install jupyterlab using the pip package manager, you can try to run:\\n!sage -pip install jupyterlab~=2.2.5'\nsage: from sage.features import PipPackageSystem\nsage: PipPackageSystem().is_present()\nFeatureTestResult('pip', True)\nsage: PipPackageSystem().spkg_installation_hint('jupyterlab')\n'To install jupyterlab using the pip package manager, you can try to run:\\n!sage -pip install jupyterlab~=2.2.5'\nsage: SagePackageSystem().spkg_installation_hint('jupyterlab')\n'To install jupyterlab using the Sage package manager, you can try to run:\\n  !sage -i jupyterlab'\n```\n\nThe following does not look good (or maybe it is?):\n\n```\nsage: PackageSystem('debian').spkg_installation_hint('jupyterlab')\n'No equivalent system packages for debian are known to Sage.'\n```",
    "created_at": "2020-09-23T12:51:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30606#issuecomment-488302",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:28" align="right">comment:28</div>

I did few tests, I get:

```
sage: from sage.features import package_systems
sage: package_systems()
[Feature('debian'), Feature('sage_spkg'), Feature('pip')]
```

So this looks good:

```
sage: from sage.features import PackageSystem
sage: PackageSystem('condaa').is_present()
FeatureTestResult('condaa', False)
sage: PackageSystem('conda').is_present()
FeatureTestResult('conda', False)
sage: PackageSystem('debian').is_present()
FeatureTestResult('debian', True)
```

It seems one needs to avoid `PackageSystem('sage_spkg')`:

```
sage: from sage.features import SagePackageSystem
sage: A = PackageSystem('sage_spkg')
sage: B = SagePackageSystem()
sage: A
Feature('sage_spkg')
sage: B
Feature('sage_spkg')
sage: A.is_present()        # expecting True
FeatureTestResult('sage_spkg', False)
sage: B.is_present()
FeatureTestResult('sage_spkg', True)
```

Similarly, 

```
sage: PackageSystem('pip').is_present()   # I was expecting True here
FeatureTestResult('pip', False)
```

The following looks good:

```
sage: PackageSystem('pip').spkg_installation_hint('jupyterlab')
'To install jupyterlab using the pip package manager, you can try to run:\n!sage -pip install jupyterlab~=2.2.5'
sage: from sage.features import PipPackageSystem
sage: PipPackageSystem().is_present()
FeatureTestResult('pip', True)
sage: PipPackageSystem().spkg_installation_hint('jupyterlab')
'To install jupyterlab using the pip package manager, you can try to run:\n!sage -pip install jupyterlab~=2.2.5'
sage: SagePackageSystem().spkg_installation_hint('jupyterlab')
'To install jupyterlab using the Sage package manager, you can try to run:\n  !sage -i jupyterlab'
```

The following does not look good (or maybe it is?):

```
sage: PackageSystem('debian').spkg_installation_hint('jupyterlab')
'No equivalent system packages for debian are known to Sage.'
```



---

archive/issue_comments_488303.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nWell, I understand the idea is to use `SagePackageSystem()` instead of `PackageSystem('sage_spkg')`\nand `PipPackageSystem()` instead of `PackageSystem('pip')`.",
    "created_at": "2020-09-23T18:30:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30606#issuecomment-488303",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:29" align="right">comment:29</div>

Well, I understand the idea is to use `SagePackageSystem()` instead of `PackageSystem('sage_spkg')`
and `PipPackageSystem()` instead of `PackageSystem('pip')`.



---

archive/issue_events_418852.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2020-09-23T18:35:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30606",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30606#event-418852"
}
```



---

archive/issue_events_418853.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2020-09-23T18:35:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30606",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30606#event-418853"
}
```



---

archive/issue_comments_488304.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nLooks good. Doc builds ok. doctests failures are fixed.",
    "created_at": "2020-09-23T18:35:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30606#issuecomment-488304",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:30" align="right">comment:30</div>

Looks good. Doc builds ok. doctests failures are fixed.



---

archive/issue_comments_488305.json:
```json
{
    "body": "Reviewer: **S\u00e9bastien Labb\u00e9**",
    "created_at": "2020-09-23T18:35:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30606#issuecomment-488305",
    "user": "https://github.com/seblabbe"
}
```

Reviewer: **Sébastien Labbé**



---

archive/issue_comments_488306.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nReplying to [@seblabbe](#comment%3A28):\n> It seems one needs to avoid `PackageSystem('sage_spkg')`:\n> \n> ```\n> sage: from sage.features import SagePackageSystem\n> sage: A = PackageSystem('sage_spkg')\n> sage: B = SagePackageSystem()\n> sage: A\n> Feature('sage_spkg')\n> sage: B\n> Feature('sage_spkg')\n> sage: A.is_present()        # expecting True\n> FeatureTestResult('sage_spkg', False)\n> sage: B.is_present()\n> FeatureTestResult('sage_spkg', True)\n> ```\n> \n> Similarly, \n> \n> ```\n> sage: PackageSystem('pip').is_present()   # I was expecting True here\n> FeatureTestResult('pip', False)\n> ```\n\nI didn't implement delegation to the correct class by name -- note that also `Feature` does not do that even though the default repr seems to suggest unique representation behavior of this kind:\n\n```\nsage: from sage.features.bliss import Bliss                                                                                                                                                                               \nsage: Bliss()                                                                                                                                                                                                             \nFeature('sage.graphs.bliss')\nsage: Bliss() is Bliss()                                                                                                                                                                                                  \nTrue\nsage: from sage.features import Feature                                                                                                                                                                                   \nsage: Bliss() is Feature('sage.graphs.bliss')                                                                                                                                                                             \nFalse\n```",
    "created_at": "2020-09-23T18:45:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30606#issuecomment-488306",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:32" align="right">comment:32</div>

Replying to [@seblabbe](#comment%3A28):
> It seems one needs to avoid `PackageSystem('sage_spkg')`:
> 
> ```
> sage: from sage.features import SagePackageSystem
> sage: A = PackageSystem('sage_spkg')
> sage: B = SagePackageSystem()
> sage: A
> Feature('sage_spkg')
> sage: B
> Feature('sage_spkg')
> sage: A.is_present()        # expecting True
> FeatureTestResult('sage_spkg', False)
> sage: B.is_present()
> FeatureTestResult('sage_spkg', True)
> ```
> 
> Similarly, 
> 
> ```
> sage: PackageSystem('pip').is_present()   # I was expecting True here
> FeatureTestResult('pip', False)
> ```

I didn't implement delegation to the correct class by name -- note that also `Feature` does not do that even though the default repr seems to suggest unique representation behavior of this kind:

```
sage: from sage.features.bliss import Bliss                                                                                                                                                                               
sage: Bliss()                                                                                                                                                                                                             
Feature('sage.graphs.bliss')
sage: Bliss() is Bliss()                                                                                                                                                                                                  
True
sage: from sage.features import Feature                                                                                                                                                                                   
sage: Bliss() is Feature('sage.graphs.bliss')                                                                                                                                                                             
False
```



---

archive/issue_comments_488307.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nReplying to [@seblabbe](#comment%3A28):\n> The following does not look good (or maybe it is?):\n> \n> ```\n> sage: PackageSystem('debian').spkg_installation_hint('jupyterlab')\n> 'No equivalent system packages for debian are known to Sage.'\n> ```\n\nIt is correct because so far there is no system package information for this package -- `build/pkgs/jupyterlab/distros` does not exist.  \n\n(See #30124 - System package information, `spkg-configure` for Jupyter `notebook` package, `rst2ipynb`, and dependencies)",
    "created_at": "2020-09-23T18:48:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30606#issuecomment-488307",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:33" align="right">comment:33</div>

Replying to [@seblabbe](#comment%3A28):
> The following does not look good (or maybe it is?):
> 
> ```
> sage: PackageSystem('debian').spkg_installation_hint('jupyterlab')
> 'No equivalent system packages for debian are known to Sage.'
> ```

It is correct because so far there is no system package information for this package -- `build/pkgs/jupyterlab/distros` does not exist.  

(See #30124 - System package information, `spkg-configure` for Jupyter `notebook` package, `rst2ipynb`, and dependencies)



---

archive/issue_comments_488308.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nReplying to [@seblabbe](#comment%3A29):\n> I understand the idea is to use `SagePackageSystem()` instead of `PackageSystem('sage_spkg')`\n> and `PipPackageSystem()` instead of `PackageSystem('pip')`.\n\nThat's right.",
    "created_at": "2020-09-23T18:49:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30606#issuecomment-488308",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:34" align="right">comment:34</div>

Replying to [@seblabbe](#comment%3A29):
> I understand the idea is to use `SagePackageSystem()` instead of `PackageSystem('sage_spkg')`
> and `PipPackageSystem()` instead of `PackageSystem('pip')`.

That's right.



---

archive/issue_comments_488309.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nThanks for the review!",
    "created_at": "2020-09-23T18:49:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30606#issuecomment-488309",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:35" align="right">comment:35</div>

Thanks for the review!



---

archive/issue_comments_488310.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nI was wanting to have another go at this but I am flat out right now. I'll open follow up as needed if it gets merged as is.",
    "created_at": "2020-09-23T21:21:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30606#issuecomment-488310",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:36" align="right">comment:36</div>

I was wanting to have another go at this but I am flat out right now. I'll open follow up as needed if it gets merged as is.



---

archive/issue_comments_488311.json:
```json
{
    "body": "Changed branch from **[u/mkoeppe/sage_features_feature_resolution__if_sage_root_is_available__recommend_system_packages](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/sage_features_feature_resolution__if_sage_root_is_available__recommend_system_packages)** to **[`68a8e2a`](https://github.com/sagemath/sagetrac-mirror/commit/68a8e2afd6c091267d161f55bc4838ad32148d8f)**",
    "created_at": "2020-10-05T20:13:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30606#issuecomment-488311",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/mkoeppe/sage_features_feature_resolution__if_sage_root_is_available__recommend_system_packages](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/sage_features_feature_resolution__if_sage_root_is_available__recommend_system_packages)** to **[`68a8e2a`](https://github.com/sagemath/sagetrac-mirror/commit/68a8e2afd6c091267d161f55bc4838ad32148d8f)**



---

archive/issue_events_418854.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-10-05T20:13:19Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30606",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30606#event-418854"
}
```



---

archive/issue_events_418855.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "e8631a7eac7db80f7b50be3eefaf1cf2807d1d26",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2020-10-05T20:13:19Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/30606",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30606#event-418855"
}
```



---

archive/issue_comments_488312.json:
```json
{
    "body": "Changed commit from **[`68a8e2a`](https://github.com/sagemath/sagetrac-mirror/commit/68a8e2afd6c091267d161f55bc4838ad32148d8f)** to none",
    "created_at": "2020-10-07T19:33:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30606#issuecomment-488312",
    "user": "https://github.com/slel"
}
```

Changed commit from **[`68a8e2a`](https://github.com/sagemath/sagetrac-mirror/commit/68a8e2afd6c091267d161f55bc4838ad32148d8f)** to none



---

archive/issue_comments_488313.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nThis breaks some tests when building with system Python 3.6.x, see\n\n- [2020-10-07 post on sage-release in 9.2.rc0 release thread](https://groups.google.com/d/msg/sage-release/0MnZQYItCYc/yhXDenfMAAAJ)\n\nFollow-up ticket for that: #30740.",
    "created_at": "2020-10-07T19:33:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30606#issuecomment-488313",
    "user": "https://github.com/slel"
}
```

<div id="comment:38" align="right">comment:38</div>

This breaks some tests when building with system Python 3.6.x, see

- [2020-10-07 post on sage-release in 9.2.rc0 release thread](https://groups.google.com/d/msg/sage-release/0MnZQYItCYc/yhXDenfMAAAJ)

Follow-up ticket for that: #30740.
