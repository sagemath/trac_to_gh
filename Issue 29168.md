# Issue 29168: Reject broken system package symmetrica on fedora-28

Issue created by migration from https://trac.sagemath.org/ticket/29405

Original creator: mkoeppe

Original creation time: 2020-03-25 03:04:26

CC:  dimpase embray fbissey isuruf tscrim mjo @kliem vbraun

fedora-28 (https://github.com/mkoeppe/sage/runs/531096029), 
fedora-28-python2 (https://github.com/mkoeppe/sage/runs/531096040):

Many test failures that seem like they are related to symmetrica:

```
sage -t src/sage/combinat/sf/hall_littlewood.py  # 3 doctests failed
sage -t src/sage/combinat/sf/homogeneous.py  # 1 doctest failed
sage -t src/sage/combinat/sf/jack.py  # Timed out
sage -t src/sage/combinat/sf/dual.py  # Timed out
sage -t src/sage/combinat/sf/hecke.py  # Timed out
sage -t src/sage/combinat/sf/k_dual.py  # Timed out
sage -t src/sage/combinat/sf/macdonald.py  # Timed out
sage -t src/sage/combinat/sf/llt.py  # Timed out
```



---

Comment by dimpase created at 2020-03-25 03:20:25

#28208 does include a check for an old Symmetrica (to e.g. rule out the one on Fedora 26)
Perhaps Fedora 28 has yet another broken Symmetrica version?


---

Comment by mkoeppe created at 2020-03-29 12:45:59

It is using

```
  symmetrica-devel            x86_64 2.0-19.fc28                   fedora
```



---

Comment by mkoeppe created at 2020-03-29 12:49:08

Changing priority from major to critical.


---

Comment by mjo created at 2020-04-03 10:24:36

Symmetrica is tricky because, until recently, we were testing for the existence of certain patches because there were no new releases. Now that we moved symmetrica to sage's gitlab, we should be able to trust that symmetrica >= 3.0 will work. While there's no pkg-config file, we bumped the soname to 2.0.0 in that version.


---

Comment by @kliem created at 2020-04-08 10:20:24

It appears to me that the situation is no different on fedora 29. At least according to this run
[https://github.com/mkoeppe/sage/runs/542655990](https://github.com/mkoeppe/sage/runs/542655990)

Debian/Ubuntu use release names like 2.0+ds-3, where this is the minimum around, which is also working fine. (For this reason it seems wrong to reject anything below 3.0).

Now fedora has names like symmetrica-2.0-22.fc30, where everything below 22 appears to be not working. What is even more strange is that it appears that the check for the bug fix is not working properly. Maybe one has to extend it to first obtain kostka tafel 3 and then 4. I could try this and see if that helps.


---

Comment by @kliem created at 2020-04-08 10:20:38

New commits:


---

Comment by @kliem created at 2020-04-08 10:58:04

The other thing we could do is to reject symmetrica always on fedora < 30.


---

Comment by mkoeppe created at 2020-04-08 13:21:16

Replying to [comment:10 gh-kliem]:
> The other thing we could do is to reject symmetrica always on fedora < 30.
No, let's not make things depend on distribution versions.


---

Comment by mkoeppe created at 2020-04-08 23:04:28

Testing at https://github.com/mkoeppe/sage/actions/runs/73955490


---

Comment by mkoeppe created at 2020-04-09 04:06:42

This does not seem to reject symmetrica on `fedora-27` - https://github.com/mkoeppe/sage/runs/572337719


---

Comment by dimpase created at 2020-04-12 04:35:51

I don't feel like supporting past-EOL Fedoras, this seems like a perfect timesink.
https://fedoraproject.org/wiki/End_of_life


---

Comment by mkoeppe created at 2020-04-15 03:24:46

Changing priority from critical to blocker.


---

Comment by vbraun created at 2020-04-18 08:40:26

Its better to exclude too many than not enough... for that reason I'd think its perfectly reasonable to require the new symmetrica 3+ with a reasonable release process. In any case, something needs to happen real fast if you want to make it into Sage 9.1


---

Comment by dimpase created at 2020-04-18 10:44:57

the problem is that I don't know how to test  for the issue. Writing a C program that tests for the underlying error, that is.


---

Comment by mkoeppe created at 2020-04-18 16:11:35

Replying to [comment:16 vbraun]:
> Its better to exclude too many than not enough... for that reason I'd think its perfectly reasonable to require the new symmetrica 3+ with a reasonable release process.
+1


---

Comment by mkoeppe created at 2020-04-18 18:21:48

Surely one of the broken doctests can be turned into a configure test?


---

Comment by dimpase created at 2020-04-19 03:29:30

well I can try with e.g. this:

```
2020-04-19T00:50:07.7304684Z File "src/sage/libs/symmetrica/kostka.pxi", line 130, in sage.libs.symmetrica.kostka.kostka_tafel_symmetrica
2020-04-19T00:50:07.7304802Z Failed example:
2020-04-19T00:50:07.7304899Z     symmetrica.kostka_tafel(3)
2020-04-19T00:50:07.7304983Z Exception raised:
2020-04-19T00:50:07.7305076Z     Traceback (most recent call last):
2020-04-19T00:50:07.7305538Z       File "/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 681, in _run
2020-04-19T00:50:07.7305666Z         self.compile_and_execute(example, compiler, test.globs)
2020-04-19T00:50:07.7305999Z       File "/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 1123, in compile_and_execute
2020-04-19T00:50:07.7306116Z         exec(compiled, globs)
2020-04-19T00:50:07.7306226Z       File "<doctest sage.libs.symmetrica.kostka.kostka_tafel_symmetrica[2]>", line 1, in <module>
2020-04-19T00:50:07.7306341Z         symmetrica.kostka_tafel(Integer(3))
2020-04-19T00:50:07.7306468Z       File "sage/libs/symmetrica/kostka.pxi", line 156, in sage.libs.symmetrica.symmetrica.kostka_tafel_symmetrica (build/cythonized/sage/libs/symmetrica/symmetrica.c:12305)
2020-04-19T00:50:07.7306578Z         sig_on()
2020-04-19T00:50:07.7306682Z     cysignals.signals.SignalError: Segmentation fault
```

I hope it would also detect problems in

```
File "sage/libs/symmetrica/schur.pxi", line 645, in sage.libs.symmetrica.symmetrica.t_MONOMIAL_POWSYM_symmetrica (build/cythonized/sage/libs/symmetrica/symmetrica.c:22659)
```

and

```
File "sage/libs/symmetrica/schur.pxi", line 583, in sage.libs.symmetrica.symmetrica.t_MONOMIAL_HOMSYM_symmetrica (build/cythonized/sage/libs/symmetrica/symmetrica.c:22236)
```

which come from many other tests.


---

Comment by dimpase created at 2020-04-19 07:57:08

funny thing is that this is more or less the same test we have in spkg-configure, although it is for kostka_tafel(4) there, so I really don't know how to fix it :-(


---

Comment by dimpase created at 2020-04-19 13:44:41

Changing status from new to needs_review.


---

Comment by dimpase created at 2020-04-19 13:44:41

this seems to do the job. It appers to be necessary to do more memory management to trigger the crash.
----
New commits:


---

Comment by mkoeppe created at 2020-04-19 16:28:28

Tests running at https://github.com/mkoeppe/sage/actions/runs/82150949


---

Comment by mkoeppe created at 2020-04-19 21:51:14

Correctly rejects symmetrica on fedora-27-standard and fedora-28-standard.
Also rejects it on fedora-29-standard.
Accepts it on fedora-30-standard and newer.


---

Comment by mkoeppe created at 2020-04-19 21:54:00

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2020-04-19 21:54:00

New commits:


---

Comment by vbraun created at 2020-04-23 22:33:25

Resolution: fixed
