# Issue 29168: Reject broken system package symmetrica on fedora-28

archive/issues_029168.json:
```json
{
    "body": "CC:  dimpase embray fbissey isuruf tscrim mjo @kliem vbraun\n\nfedora-28 (https://github.com/mkoeppe/sage/runs/531096029), \nfedora-28-python2 (https://github.com/mkoeppe/sage/runs/531096040):\n\nMany test failures that seem like they are related to symmetrica:\n\n```\nsage -t src/sage/combinat/sf/hall_littlewood.py  # 3 doctests failed\nsage -t src/sage/combinat/sf/homogeneous.py  # 1 doctest failed\nsage -t src/sage/combinat/sf/jack.py  # Timed out\nsage -t src/sage/combinat/sf/dual.py  # Timed out\nsage -t src/sage/combinat/sf/hecke.py  # Timed out\nsage -t src/sage/combinat/sf/k_dual.py  # Timed out\nsage -t src/sage/combinat/sf/macdonald.py  # Timed out\nsage -t src/sage/combinat/sf/llt.py  # Timed out\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/29405\n\n",
    "created_at": "2020-03-25T03:04:26Z",
    "labels": [
        "build: configure",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.1",
    "title": "Reject broken system package symmetrica on fedora-28",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29168",
    "user": "mkoeppe"
}
```
CC:  dimpase embray fbissey isuruf tscrim mjo @kliem vbraun

fedora-28 (https://github.com/mkoeppe/sage/runs/531096029), 
fedora-28-python2 (https://github.com/mkoeppe/sage/runs/531096040):

Many test failures that seem like they are related to symmetrica:

```
sage -t src/sage/combinat/sf/hall_littlewood.py  # 3 doctests failed
sage -t src/sage/combinat/sf/homogeneous.py  # 1 doctest failed
sage -t src/sage/combinat/sf/jack.py  # Timed out
sage -t src/sage/combinat/sf/dual.py  # Timed out
sage -t src/sage/combinat/sf/hecke.py  # Timed out
sage -t src/sage/combinat/sf/k_dual.py  # Timed out
sage -t src/sage/combinat/sf/macdonald.py  # Timed out
sage -t src/sage/combinat/sf/llt.py  # Timed out
```


Issue created by migration from https://trac.sagemath.org/ticket/29405





---

archive/issue_comments_413103.json:
```json
{
    "body": "#28208 does include a check for an old Symmetrica (to e.g. rule out the one on Fedora 26)\nPerhaps Fedora 28 has yet another broken Symmetrica version?",
    "created_at": "2020-03-25T03:20:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29168",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29168#issuecomment-413103",
    "user": "dimpase"
}
```

#28208 does include a check for an old Symmetrica (to e.g. rule out the one on Fedora 26)
Perhaps Fedora 28 has yet another broken Symmetrica version?



---

archive/issue_comments_413104.json:
```json
{
    "body": "It is using\n\n```\n  symmetrica-devel            x86_64 2.0-19.fc28                   fedora\n```\n",
    "created_at": "2020-03-29T12:45:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29168",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29168#issuecomment-413104",
    "user": "mkoeppe"
}
```

It is using

```
  symmetrica-devel            x86_64 2.0-19.fc28                   fedora
```




---

archive/issue_comments_413105.json:
```json
{
    "body": "Changing priority from major to critical.",
    "created_at": "2020-03-29T12:49:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29168",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29168#issuecomment-413105",
    "user": "mkoeppe"
}
```

Changing priority from major to critical.



---

archive/issue_comments_413106.json:
```json
{
    "body": "Symmetrica is tricky because, until recently, we were testing for the existence of certain patches because there were no new releases. Now that we moved symmetrica to sage's gitlab, we should be able to trust that symmetrica >= 3.0 will work. While there's no pkg-config file, we bumped the soname to 2.0.0 in that version.",
    "created_at": "2020-04-03T10:24:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29168",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29168#issuecomment-413106",
    "user": "mjo"
}
```

Symmetrica is tricky because, until recently, we were testing for the existence of certain patches because there were no new releases. Now that we moved symmetrica to sage's gitlab, we should be able to trust that symmetrica >= 3.0 will work. While there's no pkg-config file, we bumped the soname to 2.0.0 in that version.



---

archive/issue_comments_413107.json:
```json
{
    "body": "It appears to me that the situation is no different on fedora 29. At least according to this run\n[https://github.com/mkoeppe/sage/runs/542655990](https://github.com/mkoeppe/sage/runs/542655990)\n\nDebian/Ubuntu use release names like 2.0+ds-3, where this is the minimum around, which is also working fine. (For this reason it seems wrong to reject anything below 3.0).\n\nNow fedora has names like symmetrica-2.0-22.fc30, where everything below 22 appears to be not working. What is even more strange is that it appears that the check for the bug fix is not working properly. Maybe one has to extend it to first obtain kostka tafel 3 and then 4. I could try this and see if that helps.",
    "created_at": "2020-04-08T10:20:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29168",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29168#issuecomment-413107",
    "user": "@kliem"
}
```

It appears to me that the situation is no different on fedora 29. At least according to this run
[https://github.com/mkoeppe/sage/runs/542655990](https://github.com/mkoeppe/sage/runs/542655990)

Debian/Ubuntu use release names like 2.0+ds-3, where this is the minimum around, which is also working fine. (For this reason it seems wrong to reject anything below 3.0).

Now fedora has names like symmetrica-2.0-22.fc30, where everything below 22 appears to be not working. What is even more strange is that it appears that the check for the bug fix is not working properly. Maybe one has to extend it to first obtain kostka tafel 3 and then 4. I could try this and see if that helps.



---

archive/issue_comments_413108.json:
```json
{
    "body": "New commits:",
    "created_at": "2020-04-08T10:20:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29168",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29168#issuecomment-413108",
    "user": "@kliem"
}
```

New commits:



---

archive/issue_comments_413109.json:
```json
{
    "body": "The other thing we could do is to reject symmetrica always on fedora < 30.",
    "created_at": "2020-04-08T10:58:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29168",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29168#issuecomment-413109",
    "user": "@kliem"
}
```

The other thing we could do is to reject symmetrica always on fedora < 30.



---

archive/issue_comments_413110.json:
```json
{
    "body": "Replying to [comment:10 gh-kliem]:\n> The other thing we could do is to reject symmetrica always on fedora < 30.\nNo, let's not make things depend on distribution versions.",
    "created_at": "2020-04-08T13:21:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29168",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29168#issuecomment-413110",
    "user": "mkoeppe"
}
```

Replying to [comment:10 gh-kliem]:
> The other thing we could do is to reject symmetrica always on fedora < 30.
No, let's not make things depend on distribution versions.



---

archive/issue_comments_413111.json:
```json
{
    "body": "Testing at https://github.com/mkoeppe/sage/actions/runs/73955490",
    "created_at": "2020-04-08T23:04:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29168",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29168#issuecomment-413111",
    "user": "mkoeppe"
}
```

Testing at https://github.com/mkoeppe/sage/actions/runs/73955490



---

archive/issue_comments_413112.json:
```json
{
    "body": "This does not seem to reject symmetrica on `fedora-27` - https://github.com/mkoeppe/sage/runs/572337719",
    "created_at": "2020-04-09T04:06:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29168",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29168#issuecomment-413112",
    "user": "mkoeppe"
}
```

This does not seem to reject symmetrica on `fedora-27` - https://github.com/mkoeppe/sage/runs/572337719



---

archive/issue_comments_413113.json:
```json
{
    "body": "I don't feel like supporting past-EOL Fedoras, this seems like a perfect timesink.\nhttps://fedoraproject.org/wiki/End_of_life",
    "created_at": "2020-04-12T04:35:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29168",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29168#issuecomment-413113",
    "user": "dimpase"
}
```

I don't feel like supporting past-EOL Fedoras, this seems like a perfect timesink.
https://fedoraproject.org/wiki/End_of_life



---

archive/issue_comments_413114.json:
```json
{
    "body": "Changing priority from critical to blocker.",
    "created_at": "2020-04-15T03:24:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29168",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29168#issuecomment-413114",
    "user": "mkoeppe"
}
```

Changing priority from critical to blocker.



---

archive/issue_comments_413115.json:
```json
{
    "body": "Its better to exclude too many than not enough... for that reason I'd think its perfectly reasonable to require the new symmetrica 3+ with a reasonable release process. In any case, something needs to happen real fast if you want to make it into Sage 9.1",
    "created_at": "2020-04-18T08:40:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29168",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29168#issuecomment-413115",
    "user": "vbraun"
}
```

Its better to exclude too many than not enough... for that reason I'd think its perfectly reasonable to require the new symmetrica 3+ with a reasonable release process. In any case, something needs to happen real fast if you want to make it into Sage 9.1



---

archive/issue_comments_413116.json:
```json
{
    "body": "the problem is that I don't know how to test  for the issue. Writing a C program that tests for the underlying error, that is.",
    "created_at": "2020-04-18T10:44:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29168",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29168#issuecomment-413116",
    "user": "dimpase"
}
```

the problem is that I don't know how to test  for the issue. Writing a C program that tests for the underlying error, that is.



---

archive/issue_comments_413117.json:
```json
{
    "body": "Replying to [comment:16 vbraun]:\n> Its better to exclude too many than not enough... for that reason I'd think its perfectly reasonable to require the new symmetrica 3+ with a reasonable release process.\n+1",
    "created_at": "2020-04-18T16:11:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29168",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29168#issuecomment-413117",
    "user": "mkoeppe"
}
```

Replying to [comment:16 vbraun]:
> Its better to exclude too many than not enough... for that reason I'd think its perfectly reasonable to require the new symmetrica 3+ with a reasonable release process.
+1



---

archive/issue_comments_413118.json:
```json
{
    "body": "Surely one of the broken doctests can be turned into a configure test?",
    "created_at": "2020-04-18T18:21:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29168",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29168#issuecomment-413118",
    "user": "mkoeppe"
}
```

Surely one of the broken doctests can be turned into a configure test?



---

archive/issue_comments_413119.json:
```json
{
    "body": "well I can try with e.g. this:\n\n```\n2020-04-19T00:50:07.7304684Z File \"src/sage/libs/symmetrica/kostka.pxi\", line 130, in sage.libs.symmetrica.kostka.kostka_tafel_symmetrica\n2020-04-19T00:50:07.7304802Z Failed example:\n2020-04-19T00:50:07.7304899Z     symmetrica.kostka_tafel(3)\n2020-04-19T00:50:07.7304983Z Exception raised:\n2020-04-19T00:50:07.7305076Z     Traceback (most recent call last):\n2020-04-19T00:50:07.7305538Z       File \"/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 681, in _run\n2020-04-19T00:50:07.7305666Z         self.compile_and_execute(example, compiler, test.globs)\n2020-04-19T00:50:07.7305999Z       File \"/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 1123, in compile_and_execute\n2020-04-19T00:50:07.7306116Z         exec(compiled, globs)\n2020-04-19T00:50:07.7306226Z       File \"<doctest sage.libs.symmetrica.kostka.kostka_tafel_symmetrica[2]>\", line 1, in <module>\n2020-04-19T00:50:07.7306341Z         symmetrica.kostka_tafel(Integer(3))\n2020-04-19T00:50:07.7306468Z       File \"sage/libs/symmetrica/kostka.pxi\", line 156, in sage.libs.symmetrica.symmetrica.kostka_tafel_symmetrica (build/cythonized/sage/libs/symmetrica/symmetrica.c:12305)\n2020-04-19T00:50:07.7306578Z         sig_on()\n2020-04-19T00:50:07.7306682Z     cysignals.signals.SignalError: Segmentation fault\n```\n\nI hope it would also detect problems in\n\n```\nFile \"sage/libs/symmetrica/schur.pxi\", line 645, in sage.libs.symmetrica.symmetrica.t_MONOMIAL_POWSYM_symmetrica (build/cythonized/sage/libs/symmetrica/symmetrica.c:22659)\n```\n\nand\n\n```\nFile \"sage/libs/symmetrica/schur.pxi\", line 583, in sage.libs.symmetrica.symmetrica.t_MONOMIAL_HOMSYM_symmetrica (build/cythonized/sage/libs/symmetrica/symmetrica.c:22236)\n```\n\nwhich come from many other tests.",
    "created_at": "2020-04-19T03:29:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29168",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29168#issuecomment-413119",
    "user": "dimpase"
}
```

well I can try with e.g. this:

```
2020-04-19T00:50:07.7304684Z File "src/sage/libs/symmetrica/kostka.pxi", line 130, in sage.libs.symmetrica.kostka.kostka_tafel_symmetrica
2020-04-19T00:50:07.7304802Z Failed example:
2020-04-19T00:50:07.7304899Z     symmetrica.kostka_tafel(3)
2020-04-19T00:50:07.7304983Z Exception raised:
2020-04-19T00:50:07.7305076Z     Traceback (most recent call last):
2020-04-19T00:50:07.7305538Z       File "/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 681, in _run
2020-04-19T00:50:07.7305666Z         self.compile_and_execute(example, compiler, test.globs)
2020-04-19T00:50:07.7305999Z       File "/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 1123, in compile_and_execute
2020-04-19T00:50:07.7306116Z         exec(compiled, globs)
2020-04-19T00:50:07.7306226Z       File "<doctest sage.libs.symmetrica.kostka.kostka_tafel_symmetrica[2]>", line 1, in <module>
2020-04-19T00:50:07.7306341Z         symmetrica.kostka_tafel(Integer(3))
2020-04-19T00:50:07.7306468Z       File "sage/libs/symmetrica/kostka.pxi", line 156, in sage.libs.symmetrica.symmetrica.kostka_tafel_symmetrica (build/cythonized/sage/libs/symmetrica/symmetrica.c:12305)
2020-04-19T00:50:07.7306578Z         sig_on()
2020-04-19T00:50:07.7306682Z     cysignals.signals.SignalError: Segmentation fault
```

I hope it would also detect problems in

```
File "sage/libs/symmetrica/schur.pxi", line 645, in sage.libs.symmetrica.symmetrica.t_MONOMIAL_POWSYM_symmetrica (build/cythonized/sage/libs/symmetrica/symmetrica.c:22659)
```

and

```
File "sage/libs/symmetrica/schur.pxi", line 583, in sage.libs.symmetrica.symmetrica.t_MONOMIAL_HOMSYM_symmetrica (build/cythonized/sage/libs/symmetrica/symmetrica.c:22236)
```

which come from many other tests.



---

archive/issue_comments_413120.json:
```json
{
    "body": "funny thing is that this is more or less the same test we have in spkg-configure, although it is for kostka_tafel(4) there, so I really don't know how to fix it :-(",
    "created_at": "2020-04-19T07:57:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29168",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29168#issuecomment-413120",
    "user": "dimpase"
}
```

funny thing is that this is more or less the same test we have in spkg-configure, although it is for kostka_tafel(4) there, so I really don't know how to fix it :-(



---

archive/issue_comments_413121.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-04-19T13:44:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29168",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29168#issuecomment-413121",
    "user": "dimpase"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_413122.json:
```json
{
    "body": "this seems to do the job. It appers to be necessary to do more memory management to trigger the crash.\n----\nNew commits:",
    "created_at": "2020-04-19T13:44:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29168",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29168#issuecomment-413122",
    "user": "dimpase"
}
```

this seems to do the job. It appers to be necessary to do more memory management to trigger the crash.
----
New commits:



---

archive/issue_comments_413123.json:
```json
{
    "body": "Tests running at https://github.com/mkoeppe/sage/actions/runs/82150949",
    "created_at": "2020-04-19T16:28:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29168",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29168#issuecomment-413123",
    "user": "mkoeppe"
}
```

Tests running at https://github.com/mkoeppe/sage/actions/runs/82150949



---

archive/issue_comments_413124.json:
```json
{
    "body": "Correctly rejects symmetrica on fedora-27-standard and fedora-28-standard.\nAlso rejects it on fedora-29-standard.\nAccepts it on fedora-30-standard and newer.",
    "created_at": "2020-04-19T21:51:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29168",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29168#issuecomment-413124",
    "user": "mkoeppe"
}
```

Correctly rejects symmetrica on fedora-27-standard and fedora-28-standard.
Also rejects it on fedora-29-standard.
Accepts it on fedora-30-standard and newer.



---

archive/issue_comments_413125.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-04-19T21:54:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29168",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29168#issuecomment-413125",
    "user": "mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_413126.json:
```json
{
    "body": "New commits:",
    "created_at": "2020-04-19T21:54:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29168",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29168#issuecomment-413126",
    "user": "mkoeppe"
}
```

New commits:



---

archive/issue_comments_413127.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-04-23T22:33:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29168",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29168#issuecomment-413127",
    "user": "vbraun"
}
```

Resolution: fixed
