# Issue 13342: Bug in is_perfect

archive/issues_013342.json:
```json
{
    "body": "Assignee: jason, ncohen, rlm\n\nCC:  rbeezer\n\nKeywords: is_perfect,graph theory\n\nThe method for recognizing perfect graphs if flawed. Consider the following sage function:\n\n```\ndef f(n):\n    c= 0\n    for g in graphs.nauty_geng(str(n)):\n        if g.is_perfect():\n            c+=1\n    return c\n\n```\n\n\none can readily see that f(7) = 607 and f(8) = 8899 which is, (according to oeis http://oeis.org/A052431) incorrect. What should be true is that f(7) = 906 and f(7) = 8887.\n\nI propose to rewrite a correct algorithm perhaps using the  polynomial algorithm (www.comp.leeds.ac.uk/vuskovi/FOCS03final.ps).\n\nIssue created by migration from https://trac.sagemath.org/ticket/13546\n\n",
    "created_at": "2012-09-28T17:06:28Z",
    "labels": [
        "graph theory",
        "critical",
        "bug"
    ],
    "title": "Bug in is_perfect",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13342",
    "user": "azi"
}
```
Assignee: jason, ncohen, rlm

CC:  rbeezer

Keywords: is_perfect,graph theory

The method for recognizing perfect graphs if flawed. Consider the following sage function:

```
def f(n):
    c= 0
    for g in graphs.nauty_geng(str(n)):
        if g.is_perfect():
            c+=1
    return c

```


one can readily see that f(7) = 607 and f(8) = 8899 which is, (according to oeis http://oeis.org/A052431) incorrect. What should be true is that f(7) = 906 and f(7) = 8887.

I propose to rewrite a correct algorithm perhaps using the  polynomial algorithm (www.comp.leeds.ac.uk/vuskovi/FOCS03final.ps).

Issue created by migration from https://trac.sagemath.org/ticket/13546





---

archive/issue_comments_163925.json:
```json
{
    "body": "Hmmmmmmmmm `O_o;;;`\n\n\n```\nsage: def f(n):\n....:         c= 0\n....:     for g in graphs.nauty_geng(str(n)):\n....:             if g.is_perfect():\n....:                 c+=1\n....:     return c\n....: \nsage: f(7)\n907\n```\n",
    "created_at": "2012-10-01T10:14:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13342",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13342#issuecomment-163925",
    "user": "ncohen"
}
```

Hmmmmmmmmm `O_o;;;`


```
sage: def f(n):
....:         c= 0
....:     for g in graphs.nauty_geng(str(n)):
....:             if g.is_perfect():
....:                 c+=1
....:     return c
....: 
sage: f(7)
907
```




---

archive/issue_comments_163926.json:
```json
{
    "body": "Yes and the interesting part is that you get more perfect graphs on 7 nodes and less graph of order 8.",
    "created_at": "2012-10-01T11:06:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13342",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13342#issuecomment-163926",
    "user": "azi"
}
```

Yes and the interesting part is that you get more perfect graphs on 7 nodes and less graph of order 8.



---

archive/issue_comments_163927.json:
```json
{
    "body": "I have modified is perfect in the following way: \n\n\n```\n        ret = self.is_odd_hole_free(certificate = certificate)\n     \n        if ret == False or (certificate and ret != None):\n            return ret\n     \n        self_complement = self.complement()\n     \n        ret = self.is_odd_hole_free(certificate = certificate)\n     \n        if ret == False or (certificate and ret != None):\n            return ret\n    \n        return True \n```\n\n\nThe error is still there so I suppose there is a bug in is_odd_hole_free. I will try to spot the bug there and make a temporary patch",
    "created_at": "2012-10-01T11:19:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13342",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13342#issuecomment-163927",
    "user": "azi"
}
```

I have modified is perfect in the following way: 


```
        ret = self.is_odd_hole_free(certificate = certificate)
     
        if ret == False or (certificate and ret != None):
            return ret
     
        self_complement = self.complement()
     
        ret = self.is_odd_hole_free(certificate = certificate)
     
        if ret == False or (certificate and ret != None):
            return ret
    
        return True 
```


The error is still there so I suppose there is a bug in is_odd_hole_free. I will try to spot the bug there and make a temporary patch



---

archive/issue_comments_163928.json:
```json
{
    "body": "Ahahaahah... Stupid bug `:-)`\n\nOk, it is now fixed by the following patch. Here's what it does :\n\n* It tests if the graph's complement is bipartite. Just a potential speed improvement.\n* Returns a result immediately if the girth is odd and > 3, and not only if it is equal to 5\nAnd ... more importantly `:-D`\n\n* replaces an occurrence of ``self`` which should have been ``self_complement`` from the beginning `:-DDDDDDD`\n\nNathann",
    "created_at": "2012-10-01T12:36:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13342",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13342#issuecomment-163928",
    "user": "ncohen"
}
```

Ahahaahah... Stupid bug `:-)`

Ok, it is now fixed by the following patch. Here's what it does :

* It tests if the graph's complement is bipartite. Just a potential speed improvement.
* Returns a result immediately if the girth is odd and > 3, and not only if it is equal to 5
And ... more importantly `:-D`

* replaces an occurrence of ``self`` which should have been ``self_complement`` from the beginning `:-DDDDDDD`

Nathann



---

archive/issue_comments_163929.json:
```json
{
    "body": "(but of course if you feel like implementing the polynomial algorithm, this is still a very interesting (not to mention courageous) thing to do `:-D`\n\nNathann",
    "created_at": "2012-10-01T12:37:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13342",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13342#issuecomment-163929",
    "user": "ncohen"
}
```

(but of course if you feel like implementing the polynomial algorithm, this is still a very interesting (not to mention courageous) thing to do `:-D`

Nathann



---

archive/issue_comments_163930.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-10-01T12:37:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13342",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13342#issuecomment-163930",
    "user": "ncohen"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_163931.json:
```json
{
    "body": "What about the is_odd_hole_free function? isn't it better if is_perfect directly calls it? Otherwise we have duplicated code?",
    "created_at": "2012-10-01T16:11:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13342",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13342#issuecomment-163931",
    "user": "azi"
}
```

What about the is_odd_hole_free function? isn't it better if is_perfect directly calls it? Otherwise we have duplicated code?



---

archive/issue_comments_163932.json:
```json
{
    "body": "Well, I thought while writing this code that it was better to check all odd holes and antiholes from small sizes to larger ones, than to test first ALL HOLES (all sizes) then all antiholes (all sizes).\n\nThat's the difference between this code and yours. Probably that's just a matter of taste after all `O_o`. What do you think ?\n\nNathann",
    "created_at": "2012-10-01T16:14:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13342",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13342#issuecomment-163932",
    "user": "ncohen"
}
```

Well, I thought while writing this code that it was better to check all odd holes and antiholes from small sizes to larger ones, than to test first ALL HOLES (all sizes) then all antiholes (all sizes).

That's the difference between this code and yours. Probably that's just a matter of taste after all `O_o`. What do you think ?

Nathann



---

archive/issue_comments_163933.json:
```json
{
    "body": "I completely agree with you. This is just a minor stylistic difference. \n\nI am still inclined towards \"the less duplicated solution\" especially since the algorithm has exponential complexity and when it \"dies\" it dies.",
    "created_at": "2012-10-02T11:05:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13342",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13342#issuecomment-163933",
    "user": "azi"
}
```

I completely agree with you. This is just a minor stylistic difference. 

I am still inclined towards "the less duplicated solution" especially since the algorithm has exponential complexity and when it "dies" it dies.



---

archive/issue_comments_163934.json:
```json
{
    "body": "Ok.. Well, here is a new patch that depends on 8952. The other difference between your code and the current one is that your code cannot use the \"girth\" computation to avoid looking for useless cycles. I updated 8952 so that is_odd_hole_free first computes the graph's odd_girth before anything, and then begins to check the existence of odd cycles.\n\nAnd I can now update this patch. I was not too keen on replacing the code at first, but I have to admit that it is muuuuuuch cleaner like that. You're right ! `;-)`\n\nNathann",
    "created_at": "2012-10-02T13:35:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13342",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13342#issuecomment-163934",
    "user": "ncohen"
}
```

Ok.. Well, here is a new patch that depends on 8952. The other difference between your code and the current one is that your code cannot use the "girth" computation to avoid looking for useless cycles. I updated 8952 so that is_odd_hole_free first computes the graph's odd_girth before anything, and then begins to check the existence of odd cycles.

And I can now update this patch. I was not too keen on replacing the code at first, but I have to admit that it is muuuuuuch cleaner like that. You're right ! `;-)`

Nathann



---

archive/issue_comments_163935.json:
```json
{
    "body": "Trying to understand the bug... with sage-5.6.rc0 I get:\n\n\n```\nsage: time s_907 = set(g.sparse6_string() for g in graphs.nauty_geng('7') if g.is_perfect())\nTime: CPU 29.02 s, Wall: 29.74 s\nsage: len(s_907)\n907\nsave(s_907, '907_perfect_graph.sobj') \n```\n\n\nWith sage-5.6.rc0 + the patch:\n\n\n```\nsage: time s_906 = set(g.sparse6_string() for g in graphs.nauty_geng('7') if g.is_perfect())\nTime: CPU 25.30 s, Wall: 26.32 s\nsage: len(s_906)\n906\nsage: s_907 = load('907_perfect_graph.sobj')\nsage: s_906.issubset(s_907)\nTrue\nsage: len(s_907.difference(s_906))\n1\nsage: a = s_907.difference(s_906).pop()\nsage: a\n':FgGE@I@GxGs'\nsage: Graph(a)\nLooped multi-graph on 7 vertices\nsage: Graph(a).show()\n```\n\n\nWith sage-5.6.rc0 and no patch applied:\n\n\n```\nsage: for g in graphs.nauty_geng('7'):\n....:     if g.sparse6_string() == ':FgGE@I@GxGs':\n....:         break\n....:         \nsage: g\nGraph on 7 vertices\nsage: g.to_dictionary()\n{0: [2, 3, 4, 5], 1: [3, 4, 5, 6], 2: [0, 4, 5, 6], 3: [0, 1, 5, 6], 4: [0, 1, 2, 6], 5: [0, 1, 2, 3], 6: [1, 2, 3, 4]}\n```\n\n\nStarting from scratch. With sage-5.6.rc0, I get True with this graph:\n\n\n```\nsage: g = Graph({0: [2, 3, 4, 5], 1: [3, 4, 5, 6], 2: [0, 4, 5, 6], 3: [0, 1, 5, 6], 4: [0, 1, 2, 6], 5: [0, 1, 2, 3], 6: [1, 2, 3, 4]})\nsage: g.is_perfect()\nTrue\n```\n\n\nStrangely, I get a runtime error if I reconstruct the graph from the sparse string:\n\n\n```\nsage: Graph(':FgGE@I@GxGs').is_perfect()\nTraceback (most recent call last):\n...\nRuntimeError: Segmentation fault\n```\n\n\nI don't know what this sparse string is doing... It does not seem to be injective for instance... Anyway.\n\nWith sage-5.6.rc0 + the patch, everything is fine:\n\n\n```\nsage: Graph(':FgGE@I@GxGs').is_perfect()\nFalse\nsage: g = Graph({0: [2, 3, 4, 5], 1: [3, 4, 5, 6], 2: [0, 4, 5, 6], 3: [0, 1, 5, 6], 4: [0, 1, 2, 6], 5: [0, 1, 2, 3], 6: [1, 2, 3, 4]})\nsage: g.is_perfect()\nFalse\n```\n\n\nCan we add this previous doctest in the patch? because there is no doctest in the patch in its actual version. It would have to be an optional one since it depends on the optional package nauty....\n\nThere is something I still do not understand (related to sparse string). `is_perfect` does not seem to be preserve under the passage to the `sparse6_string`... Only 818 of the graph are still perfect after the recovery... All this would be more easy if graphs were hashable... Anyways...\n\n\n```\nage: time s = set(g.sparse6_string() for g in graphs.nauty_geng('7') if g.is_perfect())\nTime: CPU 24.94 s, Wall: 24.99 s\nsage: L = [Graph(g).is_perfect() for g in s]\nsage: all(L)\nFalse\nsage: import collections\nsage: collections.Counter(L)\nCounter({False: 818, True: 88})\n```\n",
    "created_at": "2013-01-24T17:19:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13342",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13342#issuecomment-163935",
    "user": "slabbe"
}
```

Trying to understand the bug... with sage-5.6.rc0 I get:


```
sage: time s_907 = set(g.sparse6_string() for g in graphs.nauty_geng('7') if g.is_perfect())
Time: CPU 29.02 s, Wall: 29.74 s
sage: len(s_907)
907
save(s_907, '907_perfect_graph.sobj') 
```


With sage-5.6.rc0 + the patch:


```
sage: time s_906 = set(g.sparse6_string() for g in graphs.nauty_geng('7') if g.is_perfect())
Time: CPU 25.30 s, Wall: 26.32 s
sage: len(s_906)
906
sage: s_907 = load('907_perfect_graph.sobj')
sage: s_906.issubset(s_907)
True
sage: len(s_907.difference(s_906))
1
sage: a = s_907.difference(s_906).pop()
sage: a
':FgGE@I@GxGs'
sage: Graph(a)
Looped multi-graph on 7 vertices
sage: Graph(a).show()
```


With sage-5.6.rc0 and no patch applied:


```
sage: for g in graphs.nauty_geng('7'):
....:     if g.sparse6_string() == ':FgGE@I@GxGs':
....:         break
....:         
sage: g
Graph on 7 vertices
sage: g.to_dictionary()
{0: [2, 3, 4, 5], 1: [3, 4, 5, 6], 2: [0, 4, 5, 6], 3: [0, 1, 5, 6], 4: [0, 1, 2, 6], 5: [0, 1, 2, 3], 6: [1, 2, 3, 4]}
```


Starting from scratch. With sage-5.6.rc0, I get True with this graph:


```
sage: g = Graph({0: [2, 3, 4, 5], 1: [3, 4, 5, 6], 2: [0, 4, 5, 6], 3: [0, 1, 5, 6], 4: [0, 1, 2, 6], 5: [0, 1, 2, 3], 6: [1, 2, 3, 4]})
sage: g.is_perfect()
True
```


Strangely, I get a runtime error if I reconstruct the graph from the sparse string:


```
sage: Graph(':FgGE@I@GxGs').is_perfect()
Traceback (most recent call last):
...
RuntimeError: Segmentation fault
```


I don't know what this sparse string is doing... It does not seem to be injective for instance... Anyway.

With sage-5.6.rc0 + the patch, everything is fine:


```
sage: Graph(':FgGE@I@GxGs').is_perfect()
False
sage: g = Graph({0: [2, 3, 4, 5], 1: [3, 4, 5, 6], 2: [0, 4, 5, 6], 3: [0, 1, 5, 6], 4: [0, 1, 2, 6], 5: [0, 1, 2, 3], 6: [1, 2, 3, 4]})
sage: g.is_perfect()
False
```


Can we add this previous doctest in the patch? because there is no doctest in the patch in its actual version. It would have to be an optional one since it depends on the optional package nauty....

There is something I still do not understand (related to sparse string). `is_perfect` does not seem to be preserve under the passage to the `sparse6_string`... Only 818 of the graph are still perfect after the recovery... All this would be more easy if graphs were hashable... Anyways...


```
age: time s = set(g.sparse6_string() for g in graphs.nauty_geng('7') if g.is_perfect())
Time: CPU 24.94 s, Wall: 24.99 s
sage: L = [Graph(g).is_perfect() for g in s]
sage: all(L)
False
sage: import collections
sage: collections.Counter(L)
Counter({False: 818, True: 88})
```




---

archive/issue_comments_163936.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-01-24T17:19:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13342",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13342#issuecomment-163936",
    "user": "slabbe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_163937.json:
```json
{
    "body": "Updated ! `:-)`\n\nNathann",
    "created_at": "2013-01-24T17:36:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13342",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13342#issuecomment-163937",
    "user": "ncohen"
}
```

Updated ! `:-)`

Nathann



---

archive/issue_comments_163938.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-01-24T17:36:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13342",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13342#issuecomment-163938",
    "user": "ncohen"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_163939.json:
```json
{
    "body": "All test passed on `sage/graphs/generic_graph.py`. Documentation builds fine. Doctests which were broken before were added in the latest patch. To me it is a positive review. I let  \tJernej Azarija say a last word on it.",
    "created_at": "2013-01-24T18:48:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13342",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13342#issuecomment-163939",
    "user": "slabbe"
}
```

All test passed on `sage/graphs/generic_graph.py`. Documentation builds fine. Doctests which were broken before were added in the latest patch. To me it is a positive review. I let  	Jernej Azarija say a last word on it.



---

archive/issue_comments_163940.json:
```json
{
    "body": "Jernej told me he has a question!\n\nWhat is the purpose of removing loops and multiple edges from the complement? Given a simple graph, does't sage produce a simple complement?",
    "created_at": "2013-01-25T11:12:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13342",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13342#issuecomment-163940",
    "user": "azi"
}
```

Jernej told me he has a question!

What is the purpose of removing loops and multiple edges from the complement? Given a simple graph, does't sage produce a simple complement?



---

archive/issue_comments_163941.json:
```json
{
    "body": "Well... Because Sebastien told me yesterday that \"there was a bug\" when he typed `Graph(mygraph.sparse6_string()).is_perfect`, and the reason is that when you build a graph from a sparse6 string, the graph (even tough it does not have loops nor multiple edges) *allows them*. And when you compute the complement of that graph, you get multiple edges and loops, which was a problem.\n\nWell. It's up to you, really. I don't care either way. And I hate labels, multiple edges, and loops `:-P`\n\nNathann",
    "created_at": "2013-01-25T11:24:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13342",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13342#issuecomment-163941",
    "user": "ncohen"
}
```

Well... Because Sebastien told me yesterday that "there was a bug" when he typed `Graph(mygraph.sparse6_string()).is_perfect`, and the reason is that when you build a graph from a sparse6 string, the graph (even tough it does not have loops nor multiple edges) *allows them*. And when you compute the complement of that graph, you get multiple edges and loops, which was a problem.

Well. It's up to you, really. I don't care either way. And I hate labels, multiple edges, and loops `:-P`

Nathann



---

archive/issue_comments_163942.json:
```json
{
    "body": "I see!\n\nWell this looks more like a bug of the Graph constructor handling sparse6/graph6 strings. The named formats are used for simple graphs hence it is pointless to have them return non-simple graphs?",
    "created_at": "2013-01-25T11:30:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13342",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13342#issuecomment-163942",
    "user": "azi"
}
```

I see!

Well this looks more like a bug of the Graph constructor handling sparse6/graph6 strings. The named formats are used for simple graphs hence it is pointless to have them return non-simple graphs?



---

archive/issue_comments_163943.json:
```json
{
    "body": "Oh ! They can't store graphs with multiples labels, nor loops ? Then I'd be glad to make them simple graphs by default `:-D`\n\nNathann",
    "created_at": "2013-01-25T11:36:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13342",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13342#issuecomment-163943",
    "user": "ncohen"
}
```

Oh ! They can't store graphs with multiples labels, nor loops ? Then I'd be glad to make them simple graphs by default `:-D`

Nathann



---

archive/issue_comments_163944.json:
```json
{
    "body": "Well, unfortunately sparse6 string supports multiple edges `:-P`\n\nNathann",
    "created_at": "2013-01-25T11:38:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13342",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13342#issuecomment-163944",
    "user": "ncohen"
}
```

Well, unfortunately sparse6 string supports multiple edges `:-P`

Nathann



---

archive/issue_comments_163945.json:
```json
{
    "body": "Hello!\n\nSince someone may be using this thing on simple and non-simple graphs and expect the non-simple case to yield something different than we currently do (automatically false?) I propose to either\n\n* Document that non-simple graphs are going to be treated as simple\n\n* Simply test at the beginning if the graph is simple and return an exception if it is not. \n\nI like this last option better since the notion of a perfect graph is defined for simple graphs so if the user is sending something that is non-simple it is his problem to handle that!",
    "created_at": "2013-01-29T23:13:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13342",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13342#issuecomment-163945",
    "user": "azi"
}
```

Hello!

Since someone may be using this thing on simple and non-simple graphs and expect the non-simple case to yield something different than we currently do (automatically false?) I propose to either

* Document that non-simple graphs are going to be treated as simple

* Simply test at the beginning if the graph is simple and return an exception if it is not. 

I like this last option better since the notion of a perfect graph is defined for simple graphs so if the user is sending something that is non-simple it is his problem to handle that!



---

archive/issue_comments_163946.json:
```json
{
    "body": "Hello !!\n\n> Since someone may be using this thing on simple and non-simple graphs and expect the non-simple case to yield something different than we currently do\n\nNo way. If somebody calls this method, he/she wants to test a simple graph. No other way. If they expect anything by giving non-simple digraphs, it would be getting incoherent results.\n\n> * Document that non-simple graphs are going to be treated as simple\n\nPerfect graphs are only defined for simple graphs.\n\n> * Simply test at the beginning if the graph is simple and return an exception if it is not. \n> \n> I like this last option better since the notion of a perfect graph is defined for simple graphs so if the user is sending something that is non-simple it is his problem to handle that!\n\nThe point is that in the situation of sparse6 strings, the graph given is simple but *allows* loops and multiple edges.\n\nNathann",
    "created_at": "2013-01-30T13:35:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13342",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13342#issuecomment-163946",
    "user": "ncohen"
}
```

Hello !!

> Since someone may be using this thing on simple and non-simple graphs and expect the non-simple case to yield something different than we currently do

No way. If somebody calls this method, he/she wants to test a simple graph. No other way. If they expect anything by giving non-simple digraphs, it would be getting incoherent results.

> * Document that non-simple graphs are going to be treated as simple

Perfect graphs are only defined for simple graphs.

> * Simply test at the beginning if the graph is simple and return an exception if it is not. 
> 
> I like this last option better since the notion of a perfect graph is defined for simple graphs so if the user is sending something that is non-simple it is his problem to handle that!

The point is that in the situation of sparse6 strings, the graph given is simple but *allows* loops and multiple edges.

Nathann



---

archive/issue_comments_163947.json:
```json
{
    "body": "Patch updated to filter non-simple graphs !\n\nNathann",
    "created_at": "2013-01-30T13:44:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13342",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13342#issuecomment-163947",
    "user": "ncohen"
}
```

Patch updated to filter non-simple graphs !

Nathann



---

archive/issue_comments_163948.json:
```json
{
    "body": "Eeeh... I should refrain from posting things late at night - I am writing confusing stuff...\n\nAnyhow. I am aware of the sparse6 issue but in my opinion that is an issue of how we currently handle sparse6 strings! So if we enforce the simplicity rule in is_perfect then at some point someone will perhaps get annoyed and want an option of the form \n\n\n```\nGraph('sparse6_string',force_simplicity=True)\n```\n\n\ninstead of Sage having to guess if the user sent a sparse6 graph that was converted to a non-simple graph etc... Or perhaps the Graph() constructor could check if the resulting graph is simple and automatically flag it as such.\n\nThank you for taking my comment into relevance! \n\nAs far as I see, the patch need not remove loops and multiple edges from the complement now?",
    "created_at": "2013-01-30T14:11:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13342",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13342#issuecomment-163948",
    "user": "azi"
}
```

Eeeh... I should refrain from posting things late at night - I am writing confusing stuff...

Anyhow. I am aware of the sparse6 issue but in my opinion that is an issue of how we currently handle sparse6 strings! So if we enforce the simplicity rule in is_perfect then at some point someone will perhaps get annoyed and want an option of the form 


```
Graph('sparse6_string',force_simplicity=True)
```


instead of Sage having to guess if the user sent a sparse6 graph that was converted to a non-simple graph etc... Or perhaps the Graph() constructor could check if the resulting graph is simple and automatically flag it as such.

Thank you for taking my comment into relevance! 

As far as I see, the patch need not remove loops and multiple edges from the complement now?



---

archive/issue_comments_163949.json:
```json
{
    "body": "> Anyhow. I am aware of the sparse6 issue but in my opinion that is an issue of how we currently handle sparse6 strings! So if we enforce the simplicity rule in is_perfect then at some point someone will perhaps get annoyed and want an option of the form \n\nRight now there is no problem with sparse6 strings, because the functions does not check whether the graph ALLOWS loops and multiple edges, but whether it HAS some. So the exception is not raised for sparse6 string, and is only raised if there is a loop in the graph, or multiple edges.\n\n> As far as I see, the patch need not remove loops and multiple edges from the complement now?\n\nIt is still needed, for instance for graphs coming from sparse6, because even though they contain no multiple edges and loops they allow it. So the complement will have multiple edges.\n\nActually, the problem is probably that taking the complement of a graph that allows loops will add loops and multiple edges to the graph, and I don't really think that's a good behaviour.\n\nNathann",
    "created_at": "2013-01-30T17:29:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13342",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13342#issuecomment-163949",
    "user": "ncohen"
}
```

> Anyhow. I am aware of the sparse6 issue but in my opinion that is an issue of how we currently handle sparse6 strings! So if we enforce the simplicity rule in is_perfect then at some point someone will perhaps get annoyed and want an option of the form 

Right now there is no problem with sparse6 strings, because the functions does not check whether the graph ALLOWS loops and multiple edges, but whether it HAS some. So the exception is not raised for sparse6 string, and is only raised if there is a loop in the graph, or multiple edges.

> As far as I see, the patch need not remove loops and multiple edges from the complement now?

It is still needed, for instance for graphs coming from sparse6, because even though they contain no multiple edges and loops they allow it. So the complement will have multiple edges.

Actually, the problem is probably that taking the complement of a graph that allows loops will add loops and multiple edges to the graph, and I don't really think that's a good behaviour.

Nathann



---

archive/issue_comments_163950.json:
```json
{
    "body": "I see !\n\nWell if a graph *allows* multiple edges and loops isn't it then by definition a non-simple graph?\n\nThings see, pretty messy to me if this is not so :-)",
    "created_at": "2013-01-30T17:58:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13342",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13342#issuecomment-163950",
    "user": "azi"
}
```

I see !

Well if a graph *allows* multiple edges and loops isn't it then by definition a non-simple graph?

Things see, pretty messy to me if this is not so :-)



---

archive/issue_comments_163951.json:
```json
{
    "body": "> Well if a graph *allows* multiple edges and loops isn't it then by definition a non-simple graph?\n\nWell, you will not find any math book telling you when a Sage graph is simple or not, so the usual definition is \"does it have a loop or an edge\" ?\n\nNathann",
    "created_at": "2013-01-30T18:06:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13342",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13342#issuecomment-163951",
    "user": "ncohen"
}
```

> Well if a graph *allows* multiple edges and loops isn't it then by definition a non-simple graph?

Well, you will not find any math book telling you when a Sage graph is simple or not, so the usual definition is "does it have a loop or an edge" ?

Nathann



---

archive/issue_comments_163952.json:
```json
{
    "body": "Yeah but IMO this is not natural and consistent. \n\nSomehow it would imply that a DiGraph with 1 vertex (and any arc-less DiGraph for that matter) is in fact a Graph and hence that all generic methods for graphs should apply?\n\nHopefully my remarks do not sound like being too pedantic or impolite or something! I would just like to get a clear picture of why this needs be so",
    "created_at": "2013-01-30T18:11:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13342",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13342#issuecomment-163952",
    "user": "azi"
}
```

Yeah but IMO this is not natural and consistent. 

Somehow it would imply that a DiGraph with 1 vertex (and any arc-less DiGraph for that matter) is in fact a Graph and hence that all generic methods for graphs should apply?

Hopefully my remarks do not sound like being too pedantic or impolite or something! I would just like to get a clear picture of why this needs be so



---

archive/issue_comments_163953.json:
```json
{
    "body": "The question is this : if you have a graph and add the same edge twice, do you necessarily want your graph to have it twice or did you just add it twice by mistake ? Currently, in Sage :\n\n\n```\nsage: g = Graph()\nsage: g.add_edge(0,1)\nsage: g.add_edge(0,1)\nsage: g.add_edge(0,1)\nsage: g.size()\n1\nsage: g.edges()\n[(0, 1, None)]\n```\n\n\nIf we were to change this way of doing, then that graph would have multiple edges, while at the moment you would have to insist on allowing multiple edges if you want.\n\nNathann",
    "created_at": "2013-01-30T18:13:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13342",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13342#issuecomment-163953",
    "user": "ncohen"
}
```

The question is this : if you have a graph and add the same edge twice, do you necessarily want your graph to have it twice or did you just add it twice by mistake ? Currently, in Sage :


```
sage: g = Graph()
sage: g.add_edge(0,1)
sage: g.add_edge(0,1)
sage: g.add_edge(0,1)
sage: g.size()
1
sage: g.edges()
[(0, 1, None)]
```


If we were to change this way of doing, then that graph would have multiple edges, while at the moment you would have to insist on allowing multiple edges if you want.

Nathann



---

archive/issue_comments_163954.json:
```json
{
    "body": "Yes!\n\nWhat confuses me is this. Suppose I allow multiple edges from a graph G why is it then not treated as being non-simple.\n\nWhat about the remark on handling sparse6 strings? If a sparse6 string represents a simple graph there is no need to return a graph allowing multiple edges?",
    "created_at": "2013-01-30T18:20:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13342",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13342#issuecomment-163954",
    "user": "azi"
}
```

Yes!

What confuses me is this. Suppose I allow multiple edges from a graph G why is it then not treated as being non-simple.

What about the remark on handling sparse6 strings? If a sparse6 string represents a simple graph there is no need to return a graph allowing multiple edges?



---

archive/issue_comments_163955.json:
```json
{
    "body": "Yo !\n\n> What confuses me is this. Suppose I allow multiple edges from a graph G why is it then not treated as being non-simple.\n\nThere's nothing called \"simple\" graph is Sage. What we have is 4 methods : has_loops, allows_loops, has_multiple_edges, allows_multiple_edges. I don't know why that's how it got written, but that's how it is. We can change that of course, and even define a is_simple function. But well, that's how it is.\n\n> What about the remark on handling sparse6 strings? If a sparse6 string represents a simple graph there is no need to return a graph allowing multiple edges?\n\nIt means that whether a graph allows loops depends on whether the sparse6 string you feed it with allows it. So if you store 1000 sparse6 string and load them all, some of the graphs you get will allow multiple edges and loops, some others will not. I think that this would be dirty.\n\nWhat could be done is this :\n\n```\nGraph(my_string, allow_loops = True, allow_multiple_edges = True)\n```\n\nreturs graphs allowing loops and multiple edges.\n\n```\nGraph(my_string, allow_loops = False)\n```\n\nraises an exception if the string does not correspond to a non-simple graph.\n\nThe point is that you wouldn't create graphs allowing loops and multiple edges by mistake.\n\nNathann",
    "created_at": "2013-01-30T18:49:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13342",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13342#issuecomment-163955",
    "user": "ncohen"
}
```

Yo !

> What confuses me is this. Suppose I allow multiple edges from a graph G why is it then not treated as being non-simple.

There's nothing called "simple" graph is Sage. What we have is 4 methods : has_loops, allows_loops, has_multiple_edges, allows_multiple_edges. I don't know why that's how it got written, but that's how it is. We can change that of course, and even define a is_simple function. But well, that's how it is.

> What about the remark on handling sparse6 strings? If a sparse6 string represents a simple graph there is no need to return a graph allowing multiple edges?

It means that whether a graph allows loops depends on whether the sparse6 string you feed it with allows it. So if you store 1000 sparse6 string and load them all, some of the graphs you get will allow multiple edges and loops, some others will not. I think that this would be dirty.

What could be done is this :

```
Graph(my_string, allow_loops = True, allow_multiple_edges = True)
```

returs graphs allowing loops and multiple edges.

```
Graph(my_string, allow_loops = False)
```

raises an exception if the string does not correspond to a non-simple graph.

The point is that you wouldn't create graphs allowing loops and multiple edges by mistake.

Nathann



---

archive/issue_comments_163956.json:
```json
{
    "body": "Hello!\n\nThanks for the clarifications.\n\nWhat I don't like is this. The \"looped\" here implies as if the graph is non-simple.\n\n\n```\nsage: G = graphs.PetersenGraph()  \nsage: G\nPetersen graph: Graph on 10 vertices\nsage: Graph(G.sparse6_string())   \nLooped multi-graph on 10 vertices\n```\n\n\nI see that this is not an issue with is_perfect hence I'll flag this ticket with a positive review. But I really don't like the current way we are handling multigraphs as it introduces messy situations and I would really like to get a clear distinctions for this.",
    "created_at": "2013-02-01T10:38:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13342",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13342#issuecomment-163956",
    "user": "azi"
}
```

Hello!

Thanks for the clarifications.

What I don't like is this. The "looped" here implies as if the graph is non-simple.


```
sage: G = graphs.PetersenGraph()  
sage: G
Petersen graph: Graph on 10 vertices
sage: Graph(G.sparse6_string())   
Looped multi-graph on 10 vertices
```


I see that this is not an issue with is_perfect hence I'll flag this ticket with a positive review. But I really don't like the current way we are handling multigraphs as it introduces messy situations and I would really like to get a clear distinctions for this.



---

archive/issue_comments_163957.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-02-01T10:38:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13342",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13342#issuecomment-163957",
    "user": "azi"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_163958.json:
```json
{
    "body": "What would you thing of modifying the constructor as I said above ?\n\nThanks for the review !\n\nNathann",
    "created_at": "2013-02-01T12:13:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13342",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13342#issuecomment-163958",
    "user": "ncohen"
}
```

What would you thing of modifying the constructor as I said above ?

Thanks for the review !

Nathann



---

archive/issue_comments_163959.json:
```json
{
    "body": "This would definitely solve part of the problem but I am not sure how elegant it'd be. I am afraid this would increase the complexity of all these constructors while not solving the problem at the root - which somehow I think is related to a design issue handling simple and non-simple graphs together!",
    "created_at": "2013-02-01T12:22:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13342",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13342#issuecomment-163959",
    "user": "azi"
}
```

This would definitely solve part of the problem but I am not sure how elegant it'd be. I am afraid this would increase the complexity of all these constructors while not solving the problem at the root - which somehow I think is related to a design issue handling simple and non-simple graphs together!



---

archive/issue_comments_163960.json:
```json
{
    "body": "This needs to be rebased to sage-5.7.beta2.",
    "created_at": "2013-02-01T16:33:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13342",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13342#issuecomment-163960",
    "user": "jdemeyer"
}
```

This needs to be rebased to sage-5.7.beta2.



---

archive/issue_comments_163961.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2013-02-01T16:33:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13342",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13342#issuecomment-163961",
    "user": "jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_163962.json:
```json
{
    "body": "Well, because of that segfault with Sage I can't run tests, be it on my office's computer or on my laptop `:-/`\n\nNathann",
    "created_at": "2013-02-02T10:07:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13342",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13342#issuecomment-163962",
    "user": "ncohen"
}
```

Well, because of that segfault with Sage I can't run tests, be it on my office's computer or on my laptop `:-/`

Nathann



---

archive/issue_comments_163963.json:
```json
{
    "body": "Apply trac_13546.2.patch",
    "created_at": "2013-02-03T20:56:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13342",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13342#issuecomment-163963",
    "user": "ncohen"
}
```

Apply trac_13546.2.patch



---

archive/issue_comments_163964.json:
```json
{
    "body": "Attachment [trac_13546.2.patch](tarball://root/attachments/some-uuid/ticket13546/trac_13546.2.patch) by ncohen created at 2013-02-04 10:20:29",
    "created_at": "2013-02-04T10:20:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13342",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13342#issuecomment-163964",
    "user": "ncohen"
}
```

Attachment [trac_13546.2.patch](tarball://root/attachments/some-uuid/ticket13546/trac_13546.2.patch) by ncohen created at 2013-02-04 10:20:29



---

archive/issue_comments_163965.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2013-02-04T10:48:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13342",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13342#issuecomment-163965",
    "user": "ncohen"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_163966.json:
```json
{
    "body": "Good to go ! I had to ask David to check it on his computer as Sage segfaults on mine on exit,  which prevents me from running tests `:-/`\n\nNathann",
    "created_at": "2013-02-04T10:48:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13342",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13342#issuecomment-163966",
    "user": "ncohen"
}
```

Good to go ! I had to ask David to check it on his computer as Sage segfaults on mine on exit,  which prevents me from running tests `:-/`

Nathann



---

archive/issue_comments_163967.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-02-09T12:12:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13342",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13342#issuecomment-163967",
    "user": "jdemeyer"
}
```

Resolution: fixed
