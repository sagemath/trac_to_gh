# Issue 18398: Move WeylGroups.ElementMethods.reflection_to_root to WeylGroups.ParentMethods.reflection_to_positive_root

Issue created by migration from https://trac.sagemath.org/ticket/18635

Original creator: stumpc5

Original creation time: 2015-06-08 11:10:56

CC:  nthiery aschilling chapoton mshimo

Keywords: wely groups, coxeter groups

I think that `WeylGroups.ElementMethods.reflection_to_root` should be a parent method because this method should not be available for non-reflections.

Also, I suggest the cleaner name `WeylGroups.ElementMethods.reflection_to_positive_root` to clarify which root is picked.

Or am I misinterpreting something here -- what do you think?

This came up while implementing #18597 inside `FiniteCoxeterGroups` (**not** inside `FiniteWeylGroups`), also related is #18634.

Thanks, Christian


---

Comment by stumpc5 created at 2015-06-08 11:14:10

Another technical reason (though this should not spoil the reasoning for moving or not moving the method) is that I would like to use `CoxeterGroupChevie.reflection_to_positive_root` (to come hopefully soon) and those roots are only vectors so far, without any additional parent (because there is no root system - at least not implemented - for complex reflection groups in general).


---

Comment by mshimo created at 2015-06-08 21:40:58

I don't really see a clear win nor rationale in making this a parent method.
You still have to specify the Weyl group element
and now in addition the parent must be accessed.
In the parent method there is still the danger that the
element is not a reflection and the method call "doesn't make sense".

In the Weyl groups case, from my viewpoint it is useful to give the
result in the combination-of-simple-roots form, so I would prefer to keep this.

If you are worried about having a uniform kind of output
after generalizing to complex reflection groups,
you can always coerce the answer from the 
root lattice to the ambient space and then coerce further to
just a vector. 

One big reason for keeping the integer-combination-of-simple-roots
form is that it is by definition integral.
The ambient spaces are only rational and therefore cannot be
straightforwardly coerced back to the integer lattices.
Final comment: someone should think about using general retractions to recognize when
a rational vector is integral or when an element of the weight lattice is in the root lattice,
etc.


---

Comment by stumpc5 created at 2015-06-09 09:34:52

> In the Weyl groups case, from my viewpoint it is useful to give the result in the combination-of-simple-roots form, so I would prefer to keep this.

I also wanted to have it that way, even for complex reflection groups (by `vector` I meant the Sage class, not the mathematical term). The only difference there was that I can access the method `reflection_to_root` from the parent, without having to implement an element class.

> In the parent method there is still the danger that the element is not a reflection and the method call "doesn't make sense".

True, but giving an object additional input that "doesn't make sense" is a typical `ValueError`, while having a method attached to an instance of the element class that does not make sense for this element is a more fundamental error.

The reason for asking this question in the first place was that I would like to add generic code (#18597) to the `FiniteCoxeterGroups` category which makes use of this method. If it stays an element method, I cannot perform that code if I want to call this method from a complex reflection group that happens to be a Coxeter group because it lacks this method (but, as mentioned above, I can easily add this method to the `ParentMethods`, while it is hard to add to the `ElementsMethods`.


---

Comment by mshimo created at 2015-06-09 11:30:46

I am surprised that you aren't automatically implementing `ElementMethods` for Coxeter group elements for complex reflection groups, in parallel with the parents.

At any rate, I will move this method to the parent as it may be helpful for you.


---

Comment by mshimo created at 2015-06-09 13:53:34

Set assignee to mshimo.


---

Comment by mshimo created at 2015-06-09 13:53:34

New commits:


---

Comment by mshimo created at 2015-06-09 13:54:35

We can get rid of 18634 as I just made the above changes on top of it.


---

Comment by tscrim created at 2015-06-09 14:01:51

I strongly disagree with moving this to the parent. As Mark said, there is still a possibility of the input not being a reflection, and the root is associated with the _element_, not a property of the parent. There are other instances where we've raised a `ValueError` (or `TypeError`) when an element doesn't satisfy the requirements for the method (e.g., mutating a non-mutable matrix).

You will still have the issue of not being able to call this method if your complex reflection group doesn't know it's a Coxeter group, as you'll still need to create the corresponding Coxeter group parent (or set the correct category). So the only difference is you'll need to coerce the element, but that should be natural from what you said.


---

Comment by stumpc5 created at 2015-06-09 14:10:32

Okay agreed -- if Travis says this is standard than let's leave it as is (and I said that my implementation detail should not spoil the discussion). I will find a way around.

Last question: would it make sense to make `weyl_action` a method of the Weyl group elements rather than of the root (or having both)? At the moment there is `beta.weyl_action(w)`, but not `w.weyl_action(beta)`. Could I get the second as well, or would that conflict with whether you act on (co)-roots or -weights?


---

Comment by tscrim created at 2015-06-09 14:18:22

The issue with `w.weyl_action(beta)` is that `w` does not know where `beta` lives so it can't give a reasonable output (there are some ways around it, but IMO the action is more naturally associated with the root). Although you should be able to do `w * beta`.


---

Comment by chapoton created at 2015-06-09 19:07:18

Changing keywords from "wely groups, coxeter groups" to "weyl groups, coxeter groups".


---

Comment by mshimo created at 2015-06-09 21:49:00

So are we going to mark this ticket as closed (not really a defect) ?


---

Comment by stumpc5 created at 2015-06-10 14:31:25

Replying to [comment:10 tscrim]:
> Although you should be able to do `w * beta`.

Are you claiming this works already, or that this _should_ work?

```
sage: W = WeylGroup(['A',2])
sage: w = W.simple_reflection(1)
sage: beta = w.reflection_to_root()
sage: w*beta
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
...
TypeError: unsupported operand parent(s) for '*': 'Weyl Group of type ['A', 2] (as a matrix group acting on the ambient space)' and 'Root lattice of the Root system of type ['A', 2]'
```



---

Comment by tscrim created at 2015-06-10 15:32:36

Hmm...I thought I had done that at some point... However I believe that this should work:

```
sage: Q = RootSystem(['A',2]).root_lattice()
sage: W = Q.weyl_group()
sage: w = W.simple_reflection(1)
sage: beta = w.reflection_to_root()
sage: w * b
```

Your example is debatable if it work because W is acting on the ambient space, but I think it should.


---

Comment by stumpc5 created at 2015-06-10 17:38:10

Replying to [comment:14 tscrim]:
> Hmm...I thought I had done that at some point... However I believe that this should work:

same error there.


---

Comment by tscrim created at 2015-06-10 17:57:01

Replying to [comment:15 stumpc5]:
> Replying to [comment:14 tscrim]:
> > Hmm...I thought I had done that at some point... However I believe that this should work:
> 
> same error there.

Sorry, my wording was ambiguous. I meant that this should be working as it is natural, but isn't.


---

Comment by stumpc5 created at 2016-04-09 20:32:00

Changing status from new to needs_review.


---

Comment by stumpc5 created at 2016-04-09 20:32:44

Changing status from needs_review to positive_review.


---

Comment by stumpc5 created at 2016-04-09 20:33:12

Frederic and I agree it to be closed.


---

Comment by vbraun created at 2016-06-12 12:02:30

Resolution: fixed
