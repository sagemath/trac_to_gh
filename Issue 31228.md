# Issue 31228: Division with remainder for univariate polynomial matrices

archive/issues_031228.json:
```json
{
    "body": "CC:  @ke456\n\nKeywords: polynomial matrix; division with remainder\n\nNew functionality: division with remainder for matrices over the univariate polynomials. The existing functions for weak Popov form, and the forthcoming functions for Popov form and truncated matrix inverse expansions, should allow to easily add this tool, in good generality:\n* left division or right division,\n* core tool: handling a divisor matrix in square, nonsingular, reduced form (column reduced if right division),\n* general case (rectangular, arbitrary-rank divisor) reducing to the core tool via computing the Popov form and the associated transformation.\n\nIssue created by migration from https://trac.sagemath.org/ticket/31465\n\n",
    "created_at": "2021-03-07T20:22:22Z",
    "labels": [
        "algebra",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.5",
    "title": "Division with remainder for univariate polynomial matrices",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31228",
    "user": "@vneiger"
}
```
CC:  @ke456

Keywords: polynomial matrix; division with remainder

New functionality: division with remainder for matrices over the univariate polynomials. The existing functions for weak Popov form, and the forthcoming functions for Popov form and truncated matrix inverse expansions, should allow to easily add this tool, in good generality:
* left division or right division,
* core tool: handling a divisor matrix in square, nonsingular, reduced form (column reduced if right division),
* general case (rectangular, arbitrary-rank divisor) reducing to the core tool via computing the Popov form and the associated transformation.

Issue created by migration from https://trac.sagemath.org/ticket/31465





---

archive/issue_comments_446386.json:
```json
{
    "body": "Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-03-24T02:04:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31228#issuecomment-446386",
    "user": "@mkoeppe"
}
```

Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_comments_446387.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-02T08:46:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31228#issuecomment-446387",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_446388.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-02T23:38:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31228#issuecomment-446388",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_446389.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-04T09:46:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31228#issuecomment-446389",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_446390.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-04T11:14:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31228#issuecomment-446390",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_446391.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-08-04T11:16:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31228#issuecomment-446391",
    "user": "@vneiger"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_446392.json:
```json
{
    "body": "Functionalities are done, as expected, with an extra method for ``reduce`` in order to provide this directly to the user. Documentation is written, along with many tests.\n\nThere might still be some minor doc improvements to do, but a first round of review could be useful at this stage.",
    "created_at": "2021-08-04T11:16:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31228#issuecomment-446392",
    "user": "@vneiger"
}
```

Functionalities are done, as expected, with an extra method for ``reduce`` in order to provide this directly to the user. Documentation is written, along with many tests.

There might still be some minor doc improvements to do, but a first round of review could be useful at this stage.



---

archive/issue_comments_446393.json:
```json
{
    "body": "Kevin agreed to review the ticket.",
    "created_at": "2021-08-04T21:59:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31228#issuecomment-446393",
    "user": "@vneiger"
}
```

Kevin agreed to review the ticket.



---

archive/issue_comments_446394.json:
```json
{
    "body": "Set assignee to @ke456.",
    "created_at": "2021-08-04T21:59:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31228#issuecomment-446394",
    "user": "@vneiger"
}
```

Set assignee to @ke456.



---

archive/issue_comments_446395.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-07T16:44:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31228#issuecomment-446395",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_446396.json:
```json
{
    "body": "After small fixes and improvements in the documentation and examples, this is ready for review. One question: is the doc clear enough on the use of `reduce` for `right_quo_rem` in the third situation described in the function documentation? Should it be better if more detailed, or less detailed? Thanks.",
    "created_at": "2021-08-07T16:47:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31228#issuecomment-446396",
    "user": "@vneiger"
}
```

After small fixes and improvements in the documentation and examples, this is ready for review. One question: is the doc clear enough on the use of `reduce` for `right_quo_rem` in the third situation described in the function documentation? Should it be better if more detailed, or less detailed? Thanks.



---

archive/issue_comments_446397.json:
```json
{
    "body": "The documentation and tests look good. To answer the question above, I think it's the use of reduce is clear and well outlined. However, the approach of using the appropriate shifts should be verified.",
    "created_at": "2021-08-08T00:27:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31228#issuecomment-446397",
    "user": "@ke456"
}
```

The documentation and tests look good. To answer the question above, I think it's the use of reduce is clear and well outlined. However, the approach of using the appropriate shifts should be verified.



---

archive/issue_comments_446398.json:
```json
{
    "body": "Ok, I just checked the details (unfortunately I am not aware of a reference for this), and here is the proof of correctness.\n\nStarting from any pair of matrices `A` and `B` with the same number of columns (recall `A` is `self`), we want to prove that: there is a \"valid remainder `R`\" in the division of `A` by `B` if and only if the `s`-normal form of `A` with respect to `B` is such a valid remainder, for the shift `s` chosen as the negation of the column degrees of `B`. Recall that \"valid remainder\" means that `A = QB + R` for some matrices `Q` and `R` and `R` has column degrees (strictly) bounded from above by the column degrees of `B`, or equivalently, `R` has (strictly) negative `s`-row degree.\n\nWithout loss of generality we can prove this for the case of a vector `A`, instead of a matrix (just apply the following argument to each row separately).\n\n* First case: there is no valid remainder. Then, obviously, the `s`-normal form of `A` cannot be a valid remainder.\n* Second case: there is a valid remainder. That means we can write `A = QB + R` with `R` having negative `s`-row degree. We want to prove that the `s`-normal form `N` of `A` with respect to `B` is also a valid remainder, i.e. `N` has negative `s`-row degree. If `N` has `s`-row degree smaller than or equal to that of `R`, then the conclusion follows by definition of `R`. Now assume `N` has `s`-row degree strictly larger than that of `R`. So the `s`-row degree and `s`-leading position of `N-R` are equal respectively to `s`-row degree and `s`-leading position of `N`. On the other hand, since both `R` and `N` are equal up to a left-multiple of `B`, `N-R` is in the row space of `B`, so the `s`-leading position of `N-R` is among the `s`-leading positions of the rows of the `s`-Popov form `P` of `B` (this is a consequence of the extended predictable degree property). This means that the `s`-leading position of `N` is among the `s`-leading positions of the rows of `P`; and since `N` is reduced modulo `P`, the `s`-row degree of `N` is less than the `s`-row degree of the row of `P` having that same `s`-leading position. Since `P` is the `s`-Popov form of `B`, and the `s`-row degree of `B` is uniformly zero, `P` has nonpositive `s`-row degree, and therefore `N` has negative `s`-row degree, which contradicts our assumption.",
    "created_at": "2021-08-08T16:35:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31228#issuecomment-446398",
    "user": "@vneiger"
}
```

Ok, I just checked the details (unfortunately I am not aware of a reference for this), and here is the proof of correctness.

Starting from any pair of matrices `A` and `B` with the same number of columns (recall `A` is `self`), we want to prove that: there is a "valid remainder `R`" in the division of `A` by `B` if and only if the `s`-normal form of `A` with respect to `B` is such a valid remainder, for the shift `s` chosen as the negation of the column degrees of `B`. Recall that "valid remainder" means that `A = QB + R` for some matrices `Q` and `R` and `R` has column degrees (strictly) bounded from above by the column degrees of `B`, or equivalently, `R` has (strictly) negative `s`-row degree.

Without loss of generality we can prove this for the case of a vector `A`, instead of a matrix (just apply the following argument to each row separately).

* First case: there is no valid remainder. Then, obviously, the `s`-normal form of `A` cannot be a valid remainder.
* Second case: there is a valid remainder. That means we can write `A = QB + R` with `R` having negative `s`-row degree. We want to prove that the `s`-normal form `N` of `A` with respect to `B` is also a valid remainder, i.e. `N` has negative `s`-row degree. If `N` has `s`-row degree smaller than or equal to that of `R`, then the conclusion follows by definition of `R`. Now assume `N` has `s`-row degree strictly larger than that of `R`. So the `s`-row degree and `s`-leading position of `N-R` are equal respectively to `s`-row degree and `s`-leading position of `N`. On the other hand, since both `R` and `N` are equal up to a left-multiple of `B`, `N-R` is in the row space of `B`, so the `s`-leading position of `N-R` is among the `s`-leading positions of the rows of the `s`-Popov form `P` of `B` (this is a consequence of the extended predictable degree property). This means that the `s`-leading position of `N` is among the `s`-leading positions of the rows of `P`; and since `N` is reduced modulo `P`, the `s`-row degree of `N` is less than the `s`-row degree of the row of `P` having that same `s`-leading position. Since `P` is the `s`-Popov form of `B`, and the `s`-row degree of `B` is uniformly zero, `P` has nonpositive `s`-row degree, and therefore `N` has negative `s`-row degree, which contradicts our assumption.



---

archive/issue_comments_446399.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-08-08T16:43:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31228#issuecomment-446399",
    "user": "@ke456"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_446400.json:
```json
{
    "body": "I have not read the proof in great detail, but it seems correct. With this, I believe the goal of the ticket has been met.",
    "created_at": "2021-08-08T16:43:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31228#issuecomment-446400",
    "user": "@ke456"
}
```

I have not read the proof in great detail, but it seems correct. With this, I believe the goal of the ticket has been met.



---

archive/issue_comments_446401.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2021-08-08T20:14:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31228#issuecomment-446401",
    "user": "git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_446402.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2021-08-08T20:14:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31228#issuecomment-446402",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_446403.json:
```json
{
    "body": "Thanks for reviewing. I see there were minor issues with the doc code style (if I understood the log correctly). This commit tries to fix this.",
    "created_at": "2021-08-08T20:17:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31228#issuecomment-446403",
    "user": "@vneiger"
}
```

Thanks for reviewing. I see there were minor issues with the doc code style (if I understood the log correctly). This commit tries to fix this.



---

archive/issue_comments_446404.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-08-08T22:28:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31228#issuecomment-446404",
    "user": "@vneiger"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_446405.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-08-29T09:37:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31228#issuecomment-446405",
    "user": "@vbraun"
}
```

Resolution: fixed
