# Issue 15520: Make sage.misc.superseded independent of sage.rings.integer_ring

archive/issues_015520.json:
```json
{
    "body": "This ticket makes sage.misc.superseded less dependent on\nsage.rings.integer_ring.is_IntegerRing for type checking. This allows\nfor using the functions in this module in code that is imported early\nupon Sage startup, in particular in category code.\n\nIssue created by migration from https://trac.sagemath.org/ticket/15757\n\n",
    "created_at": "2014-01-29T06:48:06Z",
    "labels": [
        "misc",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.2",
    "title": "Make sage.misc.superseded independent of sage.rings.integer_ring",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15520",
    "user": "nthiery"
}
```
This ticket makes sage.misc.superseded less dependent on
sage.rings.integer_ring.is_IntegerRing for type checking. This allows
for using the functions in this module in code that is imported early
upon Sage startup, in particular in category code.

Issue created by migration from https://trac.sagemath.org/ticket/15757





---

archive/issue_comments_200501.json:
```json
{
    "body": "Changing type from defect to enhancement.",
    "created_at": "2014-01-29T07:10:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15520",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15520#issuecomment-200501",
    "user": "nthiery"
}
```

Changing type from defect to enhancement.



---

archive/issue_comments_200502.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-01-29T07:10:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15520",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15520#issuecomment-200502",
    "user": "nthiery"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_200503.json:
```json
{
    "body": "New commits:",
    "created_at": "2014-01-29T07:10:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15520",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15520#issuecomment-200503",
    "user": "nthiery"
}
```

New commits:



---

archive/issue_comments_200504.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-01-29T08:38:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15520",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15520#issuecomment-200504",
    "user": "ncohen"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_200505.json:
```json
{
    "body": "Yo !\n\nLooks good, no problem. All tests in combinat/ pass on my computer, and the patchbot will check the rest. This being said, you wrote your patch on top of `5.13.rc0` and we are on `6.1.rc0` at the moment ! Are you using 'develop'  (and not 'master') ? This caused no conflict here.\n\nNathann",
    "created_at": "2014-01-29T08:38:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15520",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15520#issuecomment-200505",
    "user": "ncohen"
}
```

Yo !

Looks good, no problem. All tests in combinat/ pass on my computer, and the patchbot will check the rest. This being said, you wrote your patch on top of `5.13.rc0` and we are on `6.1.rc0` at the moment ! Are you using 'develop'  (and not 'master') ? This caused no conflict here.

Nathann



---

archive/issue_comments_200506.json:
```json
{
    "body": "Thanks Nathann!\n\n> This being said, you wrote your patch on top of `5.13.rc0` and we\n> are on `6.1.rc0` at the moment ! Are you using 'develop' (and not\n> 'master') ? This caused no conflict here.\n\nOops! I was using develop, but had apparently not pulled on that\nbranch in a (very) long while. Thanks for the notice!\n\nCheers,\n                          Nicolas",
    "created_at": "2014-01-29T10:14:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15520",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15520#issuecomment-200506",
    "user": "nthiery"
}
```

Thanks Nathann!

> This being said, you wrote your patch on top of `5.13.rc0` and we
> are on `6.1.rc0` at the moment ! Are you using 'develop' (and not
> 'master') ? This caused no conflict here.

Oops! I was using develop, but had apparently not pulled on that
branch in a (very) long while. Thanks for the notice!

Cheers,
                          Nicolas



---

archive/issue_comments_200507.json:
```json
{
    "body": "Why not remove `_check_trac_number(trac_number)` altogether? Perhaps convert the number to `int()` or use `__index__()`, which will throw an exception if needed.",
    "created_at": "2014-01-29T16:34:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15520",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15520#issuecomment-200507",
    "user": "jdemeyer"
}
```

Why not remove `_check_trac_number(trac_number)` altogether? Perhaps convert the number to `int()` or use `__index__()`, which will throw an exception if needed.



---

archive/issue_comments_200508.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2014-01-29T16:38:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15520",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15520#issuecomment-200508",
    "user": "ncohen"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_200509.json:
```json
{
    "body": "Yep. And as it looks like it is only used once, really ...\n\nWhat is `__index__()` though ? `O_o`\n\nNathann",
    "created_at": "2014-01-29T16:38:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15520",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15520#issuecomment-200509",
    "user": "ncohen"
}
```

Yep. And as it looks like it is only used once, really ...

What is `__index__()` though ? `O_o`

Nathann



---

archive/issue_comments_200510.json:
```json
{
    "body": "Oh, it is used several times in the file, sorry. But yeah, looks like we do not need a function just to check that something is a positive integer `:-P`\n\nThere will be false positives anyway as there is no ticket number 9999999999.\nYet.\n\nNathann",
    "created_at": "2014-01-29T16:40:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15520",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15520#issuecomment-200510",
    "user": "ncohen"
}
```

Oh, it is used several times in the file, sorry. But yeah, looks like we do not need a function just to check that something is a positive integer `:-P`

There will be false positives anyway as there is no ticket number 9999999999.
Yet.

Nathann



---

archive/issue_comments_200511.json:
```json
{
    "body": "`__index__()` converts to a Python `int`, but only if the object really is a kind of integer. `x.__index__()` is a more strict version of `int(x)`. For example::\n\n```\nsage: ZZ(1).__index__()\n1\nsage: RR(1).__index__()\n---------------------------------------------------------------------------\nAttributeError                            Traceback (most recent call last)\n<ipython-input-2-9d1cfb1a099d> in <module>()\n----> 1 RR(Integer(1)).__index__()\n\n/usr/local/src/sage-git/local/lib/python2.7/site-packages/sage/structure/element.so in sage.structure.element.Element.__getattr__ (sage/structure/element.c:3874)()\n\n/usr/local/src/sage-git/local/lib/python2.7/site-packages/sage/structure/misc.so in sage.structure.misc.getattr_from_other_class (sage/structure/misc.c:1696)()\n\nAttributeError: 'sage.rings.real_mpfr.RealNumber' object has no attribute '__index__'\nsage: \"1\".__index__()\n---------------------------------------------------------------------------\nAttributeError                            Traceback (most recent call last)\n<ipython-input-4-8e5c2bcfbfe8> in <module>()\n----> 1 \"1\".__index__()\n\nAttributeError: 'str' object has no attribute '__index__'\n```\n",
    "created_at": "2014-01-29T16:44:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15520",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15520#issuecomment-200511",
    "user": "jdemeyer"
}
```

`__index__()` converts to a Python `int`, but only if the object really is a kind of integer. `x.__index__()` is a more strict version of `int(x)`. For example::

```
sage: ZZ(1).__index__()
1
sage: RR(1).__index__()
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
<ipython-input-2-9d1cfb1a099d> in <module>()
----> 1 RR(Integer(1)).__index__()

/usr/local/src/sage-git/local/lib/python2.7/site-packages/sage/structure/element.so in sage.structure.element.Element.__getattr__ (sage/structure/element.c:3874)()

/usr/local/src/sage-git/local/lib/python2.7/site-packages/sage/structure/misc.so in sage.structure.misc.getattr_from_other_class (sage/structure/misc.c:1696)()

AttributeError: 'sage.rings.real_mpfr.RealNumber' object has no attribute '__index__'
sage: "1".__index__()
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
<ipython-input-4-8e5c2bcfbfe8> in <module>()
----> 1 "1".__index__()

AttributeError: 'str' object has no attribute '__index__'
```




---

archive/issue_comments_200512.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-01-29T20:41:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15520",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15520#issuecomment-200512",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_200513.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-01-29T20:43:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15520",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15520#issuecomment-200513",
    "user": "nthiery"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_200514.json:
```json
{
    "body": "Replying to [comment:7 jdemeyer]:\n> Why not remove `_check_trac_number(trac_number)` altogether? Perhaps convert the number to `int()` or use `__index__()`, which will throw an exception if needed.\n\nAh, thanks for the pointer to __index__! That's exactly what I was\nlooking for. In a first version, I was using int(), but then \"10963\"\nwas accepted.\n\nI left `_check_trac_number` though, since someone had taken the\ntime to write a nice error message, and a .__index__ AttributeError is\nnot super informative in this case.\n\nOh, big improvement: now the number must be bigger than 1 :-)\n\nCheers,\n                                Nicolas",
    "created_at": "2014-01-29T20:48:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15520",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15520#issuecomment-200514",
    "user": "nthiery"
}
```

Replying to [comment:7 jdemeyer]:
> Why not remove `_check_trac_number(trac_number)` altogether? Perhaps convert the number to `int()` or use `__index__()`, which will throw an exception if needed.

Ah, thanks for the pointer to __index__! That's exactly what I was
looking for. In a first version, I was using int(), but then "10963"
was accepted.

I left `_check_trac_number` though, since someone had taken the
time to write a nice error message, and a .__index__ AttributeError is
not super informative in this case.

Oh, big improvement: now the number must be bigger than 1 :-)

Cheers,
                                Nicolas



---

archive/issue_comments_200515.json:
```json
{
    "body": "Added a small reviewer patch and merged sage-6.1.rc0.",
    "created_at": "2014-01-29T21:36:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15520",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15520#issuecomment-200515",
    "user": "jdemeyer"
}
```

Added a small reviewer patch and merged sage-6.1.rc0.



---

archive/issue_comments_200516.json:
```json
{
    "body": "Replying to [comment:15 jdemeyer]:\n> Added a small reviewer patch and merged sage-6.1.rc0.\n\nI just checked out your change, and am happy with them. Thanks!\n\nSo I guess that's a positive review assuming the patchpot goes green.\n----\nNew commits:",
    "created_at": "2014-01-29T22:00:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15520",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15520#issuecomment-200516",
    "user": "nthiery"
}
```

Replying to [comment:15 jdemeyer]:
> Added a small reviewer patch and merged sage-6.1.rc0.

I just checked out your change, and am happy with them. Thanks!

So I guess that's a positive review assuming the patchpot goes green.
----
New commits:



---

archive/issue_comments_200517.json:
```json
{
    "body": "We hit a race condition :-) Unlike what the order above suggests, my comment applies to the latest commit.\n\nHmm, how to you like the term \"patchpot\" ?",
    "created_at": "2014-01-29T22:03:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15520",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15520#issuecomment-200517",
    "user": "nthiery"
}
```

We hit a race condition :-) Unlike what the order above suggests, my comment applies to the latest commit.

Hmm, how to you like the term "patchpot" ?



---

archive/issue_comments_200518.json:
```json
{
    "body": "Replying to [comment:18 nthiery]:\n> We hit a race condition :-)\nIs it really a race condition? I think it's just a plain bug. Changing the branch doesn't automatically add a \"new commits\" message.",
    "created_at": "2014-01-29T22:05:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15520",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15520#issuecomment-200518",
    "user": "jdemeyer"
}
```

Replying to [comment:18 nthiery]:
> We hit a race condition :-)
Is it really a race condition? I think it's just a plain bug. Changing the branch doesn't automatically add a "new commits" message.



---

archive/issue_comments_200519.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-01-29T22:13:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15520",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15520#issuecomment-200519",
    "user": "jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_200520.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-02-02T16:57:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15520",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15520#issuecomment-200520",
    "user": "vbraun"
}
```

Resolution: fixed
