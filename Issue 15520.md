# Issue 15520: Make sage.misc.superseded independent of sage.rings.integer_ring

Issue created by migration from Trac.

Original creator: nthiery

Original creation time: 2014-01-29 06:48:06

This ticket makes sage.misc.superseded less dependent on
sage.rings.integer_ring.is_IntegerRing for type checking. This allows
for using the functions in this module in code that is imported early
upon Sage startup, in particular in category code.


---

Comment by nthiery created at 2014-01-29 07:10:06

Changing type from defect to enhancement.


---

Comment by nthiery created at 2014-01-29 07:10:06

Changing status from new to needs_review.


---

Comment by nthiery created at 2014-01-29 07:10:55

New commits:


---

Comment by ncohen created at 2014-01-29 08:38:50

Changing status from needs_review to positive_review.


---

Comment by ncohen created at 2014-01-29 08:38:50

Yo !

Looks good, no problem. All tests in combinat/ pass on my computer, and the patchbot will check the rest. This being said, you wrote your patch on top of `5.13.rc0` and we are on `6.1.rc0` at the moment ! Are you using 'develop'  (and not 'master') ? This caused no conflict here.

Nathann


---

Comment by nthiery created at 2014-01-29 10:14:20

Thanks Nathann!

> This being said, you wrote your patch on top of `5.13.rc0` and we
> are on `6.1.rc0` at the moment ! Are you using 'develop' (and not
> 'master') ? This caused no conflict here.

Oops! I was using develop, but had apparently not pulled on that
branch in a (very) long while. Thanks for the notice!

Cheers,
                          Nicolas


---

Comment by jdemeyer created at 2014-01-29 16:34:55

Why not remove `_check_trac_number(trac_number)` altogether? Perhaps convert the number to `int()` or use `__index__()`, which will throw an exception if needed.


---

Comment by ncohen created at 2014-01-29 16:38:11

Changing status from positive_review to needs_work.


---

Comment by ncohen created at 2014-01-29 16:38:11

Yep. And as it looks like it is only used once, really ...

What is `__index__()` though ? `O_o`

Nathann


---

Comment by ncohen created at 2014-01-29 16:40:52

Oh, it is used several times in the file, sorry. But yeah, looks like we do not need a function just to check that something is a positive integer `:-P`

There will be false positives anyway as there is no ticket number 9999999999.
Yet.

Nathann


---

Comment by jdemeyer created at 2014-01-29 16:44:40

`__index__()` converts to a Python `int`, but only if the object really is a kind of integer. `x.__index__()` is a more strict version of `int(x)`. For example::

```
sage: ZZ(1).__index__()
1
sage: RR(1).__index__()
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
<ipython-input-2-9d1cfb1a099d> in <module>()
----> 1 RR(Integer(1)).__index__()

/usr/local/src/sage-git/local/lib/python2.7/site-packages/sage/structure/element.so in sage.structure.element.Element.__getattr__ (sage/structure/element.c:3874)()

/usr/local/src/sage-git/local/lib/python2.7/site-packages/sage/structure/misc.so in sage.structure.misc.getattr_from_other_class (sage/structure/misc.c:1696)()

AttributeError: 'sage.rings.real_mpfr.RealNumber' object has no attribute '__index__'
sage: "1".__index__()
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
<ipython-input-4-8e5c2bcfbfe8> in <module>()
----> 1 "1".__index__()

AttributeError: 'str' object has no attribute '__index__'
```



---

Comment by git created at 2014-01-29 20:41:30

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by nthiery created at 2014-01-29 20:43:18

Changing status from needs_work to needs_review.


---

Comment by nthiery created at 2014-01-29 20:48:01

Replying to [comment:7 jdemeyer]:
> Why not remove `_check_trac_number(trac_number)` altogether? Perhaps convert the number to `int()` or use `__index__()`, which will throw an exception if needed.

Ah, thanks for the pointer to __index__! That's exactly what I was
looking for. In a first version, I was using int(), but then "10963"
was accepted.

I left `_check_trac_number` though, since someone had taken the
time to write a nice error message, and a .__index__ AttributeError is
not super informative in this case.

Oh, big improvement: now the number must be bigger than 1 :-)

Cheers,
                                Nicolas


---

Comment by jdemeyer created at 2014-01-29 21:36:19

Added a small reviewer patch and merged sage-6.1.rc0.


---

Comment by nthiery created at 2014-01-29 22:00:43

Replying to [comment:15 jdemeyer]:
> Added a small reviewer patch and merged sage-6.1.rc0.

I just checked out your change, and am happy with them. Thanks!

So I guess that's a positive review assuming the patchpot goes green.
----
New commits:


---

Comment by nthiery created at 2014-01-29 22:03:30

We hit a race condition :-) Unlike what the order above suggests, my comment applies to the latest commit.

Hmm, how to you like the term "patchpot" ?


---

Comment by jdemeyer created at 2014-01-29 22:05:57

Replying to [comment:18 nthiery]:
> We hit a race condition :-)
Is it really a race condition? I think it's just a plain bug. Changing the branch doesn't automatically add a "new commits" message.


---

Comment by jdemeyer created at 2014-01-29 22:13:56

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2014-02-02 16:57:17

Resolution: fixed
