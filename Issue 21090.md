# Issue 21090: fix/improve linbox binding

archive/issues_021090.json:
```json
{
    "body": "CC:  @ClementPernet\n\nLinbox has a sage interface, exploited by sage's linbox interface. This unpleasant situation (upstream had to be modified to fit inside sage) was necessary: Linbox is a C++ library heavily using templates, and at that time Cython was not capable of handling C++ libraries. Thus a C-only interface had to be built into LinBox.\n\nCython has improved, and sage's linbox binding should now be capable of accessing LinBox directly, removing the need for a dedicated interface upstream.\n\nIssue created by migration from https://trac.sagemath.org/ticket/21327\n\n",
    "created_at": "2016-08-24T15:24:07Z",
    "labels": [
        "component: interfaces"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.4",
    "title": "fix/improve linbox binding",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21090",
    "user": "https://trac.sagemath.org/admin/accounts/users/Bouillaguet"
}
```
CC:  @ClementPernet

Linbox has a sage interface, exploited by sage's linbox interface. This unpleasant situation (upstream had to be modified to fit inside sage) was necessary: Linbox is a C++ library heavily using templates, and at that time Cython was not capable of handling C++ libraries. Thus a C-only interface had to be built into LinBox.

Cython has improved, and sage's linbox binding should now be capable of accessing LinBox directly, removing the need for a dedicated interface upstream.

Issue created by migration from https://trac.sagemath.org/ticket/21327





---

archive/issue_comments_291894.json:
```json
{
    "body": "Changing keywords from \"\" to \"sd75\".",
    "created_at": "2016-08-24T15:48:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21090",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21090#issuecomment-291894",
    "user": "https://trac.sagemath.org/admin/accounts/users/Bouillaguet"
}
```

Changing keywords from "" to "sd75".



---

archive/issue_comments_291895.json:
```json
{
    "body": "Last 10 new commits:",
    "created_at": "2016-08-24T15:48:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21090",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21090#issuecomment-291895",
    "user": "https://trac.sagemath.org/admin/accounts/users/Bouillaguet"
}
```

Last 10 new commits:



---

archive/issue_comments_291896.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-25T10:40:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21090",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21090#issuecomment-291896",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_291897.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-09-05T15:36:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21090",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21090#issuecomment-291897",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_291898.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-09-05T15:37:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21090",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21090#issuecomment-291898",
    "user": "https://trac.sagemath.org/admin/accounts/users/Bouillaguet"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_291899.json:
```json
{
    "body": "Just a quick comment for now: this branch contains a lot of commented-out code that I don't see the point of. Also several TODO's where it is not clear why you cannot just do them. It is OK to have a TODO, but you should comment them better.",
    "created_at": "2016-09-05T21:18:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21090",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21090#issuecomment-291899",
    "user": "https://github.com/jdemeyer"
}
```

Just a quick comment for now: this branch contains a lot of commented-out code that I don't see the point of. Also several TODO's where it is not clear why you cannot just do them. It is OK to have a TODO, but you should comment them better.



---

archive/issue_comments_291900.json:
```json
{
    "body": "OK, Giavro/linbox/fflas have been updated in an incompatible way.",
    "created_at": "2016-09-06T03:24:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21090",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21090#issuecomment-291900",
    "user": "https://trac.sagemath.org/admin/accounts/users/Bouillaguet"
}
```

OK, Giavro/linbox/fflas have been updated in an incompatible way.



---

archive/issue_comments_291901.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-09-06T03:24:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21090",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21090#issuecomment-291901",
    "user": "https://trac.sagemath.org/admin/accounts/users/Bouillaguet"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_291902.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-09-16T08:23:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21090",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21090#issuecomment-291902",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_291903.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-09-16T08:23:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21090",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21090#issuecomment-291903",
    "user": "https://trac.sagemath.org/admin/accounts/users/Bouillaguet"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_291904.json:
```json
{
    "body": "Rebased onto new versions of Givaro/Linbox/etc. Ready for review.",
    "created_at": "2016-09-16T08:23:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21090",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21090#issuecomment-291904",
    "user": "https://trac.sagemath.org/admin/accounts/users/Bouillaguet"
}
```

Rebased onto new versions of Givaro/Linbox/etc. Ready for review.



---

archive/issue_comments_291905.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-09-16T09:05:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21090",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21090#issuecomment-291905",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_291906.json:
```json
{
    "body": "Please remove silly commented-out code like\n\n```\n# ``this`` should replace:\n#from libcpp.vector cimport vector, list\n\n# ``that``\n```\n(I have no idea what you are trying to say here)",
    "created_at": "2016-09-16T12:42:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21090",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21090#issuecomment-291906",
    "user": "https://github.com/jdemeyer"
}
```

Please remove silly commented-out code like

```
# ``this`` should replace:
#from libcpp.vector cimport vector, list

# ``that``
```
(I have no idea what you are trying to say here)



---

archive/issue_comments_291907.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-09-16T12:50:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21090",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21090#issuecomment-291907",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_291908.json:
```json
{
    "body": "1. Trailing comma: `SparseElimination,`\n\n2. Don't put Python code in `sig_on()`. This is wrong:\n\n```\nsig_on()\nif typ == 'minpoly':\n    [...]\nsig_off()\n```\n\n3. Instead of using `<SparseMatrixGFp *> self._M` everywhere, why not declare `_M` as `SparseMatrixGFp*` (or even just `SparseMatrixGFp` if that works to avoid the explicit `del`)?",
    "created_at": "2016-09-16T13:09:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21090",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21090#issuecomment-291908",
    "user": "https://github.com/jdemeyer"
}
```

1. Trailing comma: `SparseElimination,`

2. Don't put Python code in `sig_on()`. This is wrong:

```
sig_on()
if typ == 'minpoly':
    [...]
sig_off()
```

3. Instead of using `<SparseMatrixGFp *> self._M` everywhere, why not declare `_M` as `SparseMatrixGFp*` (or even just `SparseMatrixGFp` if that works to avoid the explicit `del`)?



---

archive/issue_comments_291909.json:
```json
{
    "body": "3. The problem is that because of the LinBox <--> IML incompatibility, the various `*.h` files from linbox must not be pulled into `matrix_integer_dense.pyx`. Thus, they must not appear in `linbox.pxd`. This makes it impossible (or at least more contrived) to describe the type of sparse matrices in LinBox.pxd. And because the class has to be defined in `linbox.pxd`, I did not see any other solution. This is indeed a workaround.\n\nThe idea I tried to follow is that `linbox.pyx` *only* deals with linbox datastructures. The rest deals with `linbox.pyx`.",
    "created_at": "2016-09-16T13:15:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21090",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21090#issuecomment-291909",
    "user": "https://trac.sagemath.org/admin/accounts/users/Bouillaguet"
}
```

3. The problem is that because of the LinBox <--> IML incompatibility, the various `*.h` files from linbox must not be pulled into `matrix_integer_dense.pyx`. Thus, they must not appear in `linbox.pxd`. This makes it impossible (or at least more contrived) to describe the type of sparse matrices in LinBox.pxd. And because the class has to be defined in `linbox.pxd`, I did not see any other solution. This is indeed a workaround.

The idea I tried to follow is that `linbox.pyx` *only* deals with linbox datastructures. The rest deals with `linbox.pyx`.



---

archive/issue_comments_291910.json:
```json
{
    "body": "Replying to [comment:18 Bouillaguet]:\n> 3. The problem is that because of the LinBox <--> IML incompatibility, the various `*.h` files from linbox must not be pulled into `matrix_integer_dense.pyx`. Thus, they must not appear in `linbox.pxd`. This makes it impossible (or at least more contrived) to describe the type of sparse matrices in LinBox.pxd. And because the class has to be defined in `linbox.pxd`, I did not see any other solution. This is indeed a workaround.\n\n\n\nI would rather like to fix this problem than to workaround it.",
    "created_at": "2016-09-16T13:39:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21090",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21090#issuecomment-291910",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:18 Bouillaguet]:
> 3. The problem is that because of the LinBox <--> IML incompatibility, the various `*.h` files from linbox must not be pulled into `matrix_integer_dense.pyx`. Thus, they must not appear in `linbox.pxd`. This makes it impossible (or at least more contrived) to describe the type of sparse matrices in LinBox.pxd. And because the class has to be defined in `linbox.pxd`, I did not see any other solution. This is indeed a workaround.



I would rather like to fix this problem than to workaround it.



---

archive/issue_comments_291911.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-09-16T13:39:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21090",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21090#issuecomment-291911",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_291912.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-09-16T19:48:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21090",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21090#issuecomment-291912",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_291913.json:
```json
{
    "body": "Replying to [comment:20 jdemeyer]:\n> I would rather like to fix this problem than to workaround it.\n\n\nI understand, however, as you know, fixing the problem requires:\na. Fixing upstream\nb. Opening, reviewing and merging a new ticket for the new upstream package\n\nUpstream evolves slowly (the previous version in sage, 1.3.2, was released in 2012...). I'm afraid that this whole process will take a long time, and I'm worried that this ticket will stall for reasons that are beyond my control. I started working on this 3 weeks ago, and backward-incompatible changes were introduced in both the Givaro and Linbox packages, that have been upgraded in sage recently. As such, I had to figure that out when I rebased.\n\nI'd rather see this ticket go through quickly, instead of seeing it rot.",
    "created_at": "2016-09-16T19:50:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21090",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21090#issuecomment-291913",
    "user": "https://trac.sagemath.org/admin/accounts/users/Bouillaguet"
}
```

Replying to [comment:20 jdemeyer]:
> I would rather like to fix this problem than to workaround it.


I understand, however, as you know, fixing the problem requires:
a. Fixing upstream
b. Opening, reviewing and merging a new ticket for the new upstream package

Upstream evolves slowly (the previous version in sage, 1.3.2, was released in 2012...). I'm afraid that this whole process will take a long time, and I'm worried that this ticket will stall for reasons that are beyond my control. I started working on this 3 weeks ago, and backward-incompatible changes were introduced in both the Givaro and Linbox packages, that have been upgraded in sage recently. As such, I had to figure that out when I rebased.

I'd rather see this ticket go through quickly, instead of seeing it rot.



---

archive/issue_comments_291914.json:
```json
{
    "body": "Replying to [comment:22 Bouillaguet]:\n> Replying to [comment:20 jdemeyer]:\n> > I would rather like to fix this problem than to workaround it.\n\n> \n> I understand, however, as you know, fixing the problem requires:\n> a. Fixing upstream\n> b. Opening, reviewing and merging a new ticket for the new upstream package\n> \n> Upstream evolves slowly (the previous version in sage, 1.3.2, was released in 2012...). I'm afraid that this whole process will take a long time\n\n\nFor me personally, you don't have to wait for a new official upstream package. You can just add a patch to the Sage package. In https://github.com/linbox-team/linbox/issues/35 I proposed some solutions.",
    "created_at": "2016-09-16T20:13:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21090",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21090#issuecomment-291914",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:22 Bouillaguet]:
> Replying to [comment:20 jdemeyer]:
> > I would rather like to fix this problem than to workaround it.

> 
> I understand, however, as you know, fixing the problem requires:
> a. Fixing upstream
> b. Opening, reviewing and merging a new ticket for the new upstream package
> 
> Upstream evolves slowly (the previous version in sage, 1.3.2, was released in 2012...). I'm afraid that this whole process will take a long time


For me personally, you don't have to wait for a new official upstream package. You can just add a patch to the Sage package. In https://github.com/linbox-team/linbox/issues/35 I proposed some solutions.



---

archive/issue_comments_291915.json:
```json
{
    "body": "OK, I will patch it.",
    "created_at": "2016-09-17T09:55:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21090",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21090#issuecomment-291915",
    "user": "https://trac.sagemath.org/admin/accounts/users/Bouillaguet"
}
```

OK, I will patch it.



---

archive/issue_comments_291916.json:
```json
{
    "body": "I applied Jeroen's patch upstream.",
    "created_at": "2016-09-19T13:26:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21090",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21090#issuecomment-291916",
    "user": "https://github.com/ClementPernet"
}
```

I applied Jeroen's patch upstream.



---

archive/issue_comments_291917.json:
```json
{
    "body": "Hello,\n\nI just discovered this ticket while working on #22924 (see also #22872 and [cylinbox](https://github.com/videlec/cylinbox)). My original aim was actually to use linbox for solving sparse integer systems. However, a cleanup was needed before.\n\nI will read what is in the branch `u/Bouillaguet/linbox_cpp` before going further. Charles, do you plan continuing working on it?",
    "created_at": "2017-05-03T06:45:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21090",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21090#issuecomment-291917",
    "user": "https://github.com/videlec"
}
```

Hello,

I just discovered this ticket while working on #22924 (see also #22872 and [cylinbox](https://github.com/videlec/cylinbox)). My original aim was actually to use linbox for solving sparse integer systems. However, a cleanup was needed before.

I will read what is in the branch `u/Bouillaguet/linbox_cpp` before going further. Charles, do you plan continuing working on it?



---

archive/issue_comments_291918.json:
```json
{
    "body": "Oops, my bad, I should have remembered this ticket when Vincent told me about his work on #22872.",
    "created_at": "2017-05-03T07:06:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21090",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21090#issuecomment-291918",
    "user": "https://github.com/ClementPernet"
}
```

Oops, my bad, I should have remembered this ticket when Vincent told me about his work on #22872.



---

archive/issue_comments_291919.json:
```json
{
    "body": "Ticket #24544 will finish moving the Sage interface to LinBox inside Sage ([commit 7ec9610](https://git.sagemath.org/sage.git/commit/?id=7ec96109cfd54cf129d934139a5a0f006b8708dd) removes the `--enable-sage` option). I am only facing a strange missing symbol issue, see [#24554comment:8](https://trac.sagemath.org/ticket/24544#comment:8).",
    "created_at": "2018-02-03T16:10:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21090",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21090#issuecomment-291919",
    "user": "https://github.com/videlec"
}
```

Ticket #24544 will finish moving the Sage interface to LinBox inside Sage ([commit 7ec9610](https://git.sagemath.org/sage.git/commit/?id=7ec96109cfd54cf129d934139a5a0f006b8708dd) removes the `--enable-sage` option). I am only facing a strange missing symbol issue, see [#24554comment:8](https://trac.sagemath.org/ticket/24544#comment:8).
