# Issue 21090: fix/improve linbox binding

Issue created by migration from Trac.

Original creator: Bouillaguet

Original creation time: 2016-08-24 15:24:07

CC:  cpernet

Linbox has a sage interface, exploited by sage's linbox interface. This unpleasant situation (upstream had to be modified to fit inside sage) was necessary: Linbox is a C++ library heavily using templates, and at that time Cython was not capable of handling C++ libraries. Thus a C-only interface had to be built into LinBox.

Cython has improved, and sage's linbox binding should now be capable of accessing LinBox directly, removing the need for a dedicated interface upstream.


---

Comment by Bouillaguet created at 2016-08-24 15:48:14

Changing keywords from "" to "sd75".


---

Comment by Bouillaguet created at 2016-08-24 15:48:14

Last 10 new commits:


---

Comment by git created at 2016-08-25 10:40:10

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-09-05 15:36:22

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by Bouillaguet created at 2016-09-05 15:37:23

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2016-09-05 21:18:52

Just a quick comment for now: this branch contains a lot of commented-out code that I don't see the point of. Also several TODO's where it is not clear why you cannot just do them. It is OK to have a TODO, but you should comment them better.


---

Comment by Bouillaguet created at 2016-09-06 03:24:35

OK, Giavro/linbox/fflas have been updated in an incompatible way.


---

Comment by Bouillaguet created at 2016-09-06 03:24:35

Changing status from needs_review to needs_work.


---

Comment by git created at 2016-09-16 08:23:07

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by Bouillaguet created at 2016-09-16 08:23:54

Changing status from needs_work to needs_review.


---

Comment by Bouillaguet created at 2016-09-16 08:23:54

Rebased onto new versions of Givaro/Linbox/etc. Ready for review.


---

Comment by git created at 2016-09-16 09:05:34

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2016-09-16 12:42:36

Please remove silly commented-out code like

```
# ``this`` should replace:
#from libcpp.vector cimport vector, list

# ``that``
```

(I have no idea what you are trying to say here)


---

Comment by git created at 2016-09-16 12:50:42

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2016-09-16 13:09:36

1. Trailing comma: `SparseElimination,`

2. Don't put Python code in `sig_on()`. This is wrong:

```
sig_on()
if typ == 'minpoly':
    [...]
sig_off()
```


3. Instead of using `<SparseMatrixGFp *> self._M` everywhere, why not declare `_M` as `SparseMatrixGFp*` (or even just `SparseMatrixGFp` if that works to avoid the explicit `del`)?


---

Comment by Bouillaguet created at 2016-09-16 13:15:38

3. The problem is that because of the LinBox <--> IML incompatibility, the various `*.h` files from linbox must not be pulled into `matrix_integer_dense.pyx`. Thus, they must not appear in `linbox.pxd`. This makes it impossible (or at least more contrived) to describe the type of sparse matrices in LinBox.pxd. And because the class has to be defined in `linbox.pxd`, I did not see any other solution. This is indeed a workaround.

The idea I tried to follow is that `linbox.pyx` *only* deals with linbox datastructures. The rest deals with `linbox.pyx`.


---

Comment by jdemeyer created at 2016-09-16 13:39:59

Replying to [comment:18 Bouillaguet]:
> 3. The problem is that because of the LinBox <--> IML incompatibility, the various `*.h` files from linbox must not be pulled into `matrix_integer_dense.pyx`. Thus, they must not appear in `linbox.pxd`. This makes it impossible (or at least more contrived) to describe the type of sparse matrices in LinBox.pxd. And because the class has to be defined in `linbox.pxd`, I did not see any other solution. This is indeed a workaround.


I would rather like to fix this problem than to workaround it.


---

Comment by jdemeyer created at 2016-09-16 13:39:59

Changing status from needs_review to needs_work.


---

Comment by git created at 2016-09-16 19:48:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by Bouillaguet created at 2016-09-16 19:50:40

Replying to [comment:20 jdemeyer]:
> I would rather like to fix this problem than to workaround it.

I understand, however, as you know, fixing the problem requires:
a. Fixing upstream
b. Opening, reviewing and merging a new ticket for the new upstream package

Upstream evolves slowly (the previous version in sage, 1.3.2, was released in 2012...). I'm afraid that this whole process will take a long time, and I'm worried that this ticket will stall for reasons that are beyond my control. I started working on this 3 weeks ago, and backward-incompatible changes were introduced in both the Givaro and Linbox packages, that have been upgraded in sage recently. As such, I had to figure that out when I rebased.

I'd rather see this ticket go through quickly, instead of seeing it rot.


---

Comment by jdemeyer created at 2016-09-16 20:13:00

Replying to [comment:22 Bouillaguet]:
> Replying to [comment:20 jdemeyer]:
> > I would rather like to fix this problem than to workaround it.
> 
> I understand, however, as you know, fixing the problem requires:
> a. Fixing upstream
> b. Opening, reviewing and merging a new ticket for the new upstream package
> 
> Upstream evolves slowly (the previous version in sage, 1.3.2, was released in 2012...). I'm afraid that this whole process will take a long time

For me personally, you don't have to wait for a new official upstream package. You can just add a patch to the Sage package. In https://github.com/linbox-team/linbox/issues/35 I proposed some solutions.


---

Comment by Bouillaguet created at 2016-09-17 09:55:50

OK, I will patch it.


---

Comment by cpernet created at 2016-09-19 13:26:31

I applied Jeroen's patch upstream.


---

Comment by vdelecroix created at 2017-05-03 06:45:53

Hello,

I just discovered this ticket while working on #22924 (see also #22872 and [cylinbox](https://github.com/videlec/cylinbox)). My original aim was actually to use linbox for solving sparse integer systems. However, a cleanup was needed before.

I will read what is in the branch `u/Bouillaguet/linbox_cpp` before going further. Charles, do you plan continuing working on it?


---

Comment by cpernet created at 2017-05-03 07:06:53

Oops, my bad, I should have remembered this ticket when Vincent told me about his work on #22872.


---

Comment by vdelecroix created at 2018-02-03 16:10:37

Ticket #24544 will finish moving the Sage interface to LinBox inside Sage ([commit 7ec9610](https://git.sagemath.org/sage.git/commit/?id=7ec96109cfd54cf129d934139a5a0f006b8708dd) removes the `--enable-sage` option). I am only facing a strange missing symbol issue, see [#24554comment:8](https://trac.sagemath.org/ticket/24544#comment:8).
