# Issue 15592: Ray class groups

Issue created by migration from Trac.

Original creator: pbruin

Original creation time: 2014-02-17 23:34:47

CC:  argaezg cremona davidloeffler slelievre

Keywords: ray class group pari

Sage's support for ray class groups of number fields is currently limited to `NumberFieldFractionalIdeal.ray_class_number()`.

The purpose of this ticket is to implement ray class groups using PARI's `bnrinit0()` and related functions.


---

Comment by robharron created at 2016-08-16 20:35:56

Changing keywords from "ray class group pari" to "ray class group, pari, Hecke character, Sage Days 81".


---

Comment by git created at 2016-08-16 20:39:07

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-08-16 20:58:26

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2016-08-16 22:28:55

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by robharron created at 2016-08-16 23:21:17

I've pushed some code with some basic functionality for computing ray class groups, Hecke characters, and their L-functions. I'll be working on this over the next week at Sage Days 81. First off is a rewrite to avoid keeping track of an ideal representing a ray class.


---

Comment by git created at 2016-08-17 11:55:32

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-08-17 21:55:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-08-19 11:09:03

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-08-20 08:18:53

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-08-24 03:12:59

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-08-26 00:34:54

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-08-30 02:33:43

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-09-03 01:52:30

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-09-07 10:44:51

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-10-15 07:31:41

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2017-02-13 21:06:24

rebased on 7.6.b3
----
New commits:


---

Comment by git created at 2017-02-13 21:10:51

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by cremona created at 2017-02-15 13:33:18

Is there an estimate for when this will be ready for review?


---

Comment by robharron created at 2017-02-17 08:41:43

Hi John,

No plan right now, I've been swamped. If there are people very interested in seeing this move forward, I can try to carve more time out for it. It's pretty much functional, but still requires several doctests.


---

Comment by cremona created at 2017-02-17 08:53:30

One thing which could work well would be for a potential user to try it out and come with some doctests of their own.  I have a student who might do that but he is a novice at Sage development and I would have to walk him through the process of building this branch of Sage.  I'll see what I can do -- but we do have a use in mind.  Thanks.


---

Comment by robharron created at 2017-02-17 09:06:32

Yes, that would work well. There are several doctests already, especially for the more important functions, but it's definitely not complete. I'll try to take a look at the code soon to see what big things if any really need to be done. There are certainly some changes that would be good to do if a newer version of pari has been added to sage since last I worked on this. And hopefully, I won't get confused by the rebasing that occurred, as I know little about this git+trac stuff!


---

Comment by cremona created at 2017-02-17 16:18:55

I checked out the branch, which had been rebased to 7.6.beta3, and merged in 7.6.beta4; no problem with the merge but the resulting code did not build: there was a cython compilation error in the file cypari2/gen.pyx.  I don't have time to troubleshoot this...


---

Comment by chapoton created at 2017-02-17 16:49:05

Replying to [comment:25 cremona]:
> I checked out the branch, which had been rebased to 7.6.beta3, and merged in 7.6.beta4; no problem with the merge but the resulting code did not build: there was a cython compilation error in the file cypari2/gen.pyx.  I don't have time to troubleshoot this...

This is my fault, I did the merge, but I do not know how to fix that.


---

Comment by roed created at 2017-07-17 17:41:08

Changing keywords from "ray class group, pari, Hecke character, Sage Days 81" to "ray class group, pari, Hecke character, Sage Days 81, sd87".


---

Comment by robharron created at 2017-07-18 04:58:52

I'm at sage days 87 rebasing this on top of 8.0.rc1. It runs now, though the doctests are giving different answers, possibly because pari has been updated. Re cypari2: the issue was that the pari interface (if that's the right word) was being separated from sage and so gen.pyx was moved. Now that the separation has been completed, this patch will likely require that the cypari2 package be modified separately (at https://github.com/defeo/cypari2).


---

Comment by git created at 2017-07-18 20:28:22

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by robharron created at 2017-07-18 20:34:42

I've pushed a new commit (to a new branch, really) that runs on sage 8.0.rc1. It also requires a change to the cypari2 package; for this I have made a pull request to the package on github (https://github.com/defeo/cypari2/pull/16), and I also opened a ticket there (https://github.com/defeo/cypari2/issues/17).


---

Comment by robharron created at 2017-07-23 17:25:17

The pull request I made to cypari2 was accepted. I've created a new ticket on trac (#23518) to update the cypari2 version in sage and added it as a dependency of this ticket.


---

Comment by jdemeyer created at 2017-08-22 14:56:05

Does this really require the Dokchitser script? Did you try the new L-function package in upstream PARI/GP?


---

Comment by cremona created at 2017-08-22 16:29:53

One day we'll have a proper L-functions package in Sage (I am not volunteering but quite a lot of relevant code is being written by LMFDB people).   Meanwhile, I am waiting to use this new code and am happy for it to start out using Dokchitser even if an improvement is possible using the new PARI/GP stuff, as that would be a lot of extra work (I think).


---

Comment by robharron created at 2017-08-22 18:32:54

It shouldn't require the script. I only recently noticed that pari could do this, and so I haven't tried it. I don't think it would be difficult to switch to the pari library, but maybe I'll put that low priority since John is awaiting.

And John, sorry this is taking so long, I have a lot of other things on my plate. Have you tried it out? It works (at least on 8.0rc1). There's mostly just a bunch of doctests to write.


---

Comment by cremona created at 2017-08-23 09:36:27

Sorry Rob, I have no right to ask you to work harder than you have been!  I have many other things to do, and I had not tested this yet (I was going to wait until there was no dependency on the cypari ticket #23518).


---

Comment by chapoton created at 2018-04-17 09:19:28

Last 10 new commits:


---

Comment by chapoton created at 2018-04-17 09:21:03

rebased on 8.2.rc3
----
New commits:


---

Comment by git created at 2018-04-17 09:29:20

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-04-18 06:51:15

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-04-20 06:50:46

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-04-21 15:52:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-04-22 06:43:10

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-04-22 09:51:07

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-04-22 12:17:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-04-22 15:09:47

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-04-22 19:23:56

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by cremona created at 2018-06-11 15:53:20

Why is this not marked as ready for review? What is left to do?


---

Comment by chapoton created at 2018-06-11 18:14:49

well, many failing doctests, and a lot of missing documentation..


---

Comment by cremona created at 2018-06-11 19:48:33

OK, just checking.  Rob?


---

Comment by git created at 2018-06-30 06:50:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2018-08-03 19:20:18

update milestone 8.3 -> 8.4


---

Comment by chapoton created at 2019-06-06 19:47:02

I have made a rebased, squashed and refreshed branch.
----
New commits:


---

Comment by embray created at 2019-06-14 14:54:19

As the Sage-8.8 release milestone is pending, we should delete the sage-8.8 milestone for tickets that are not actively being worked on or that still require significant work to move forward.  If you feel that this ticket should be included in the next Sage release at the soonest please set its milestone to the next release milestone (sage-8.9).


---

Comment by slelievre created at 2021-05-29 16:52:05

Related:

- [Ask Sage question 57338: Computing Ray class numbers?](https://ask.sagemath.org/question/57338)
- [Ask Sage question 9127: Computing the order of an ideal in a ray class group](https://ask.sagemath.org/question/9127)


---

Comment by git created at 2021-05-31 09:55:01

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by slelievre created at 2021-05-31 15:50:31

Thanks Frédéric, is this just a rebase?

The branch provides a lot of new functionality.

Do the author and reviewers have time to see this through?

Can the ticket be split into smaller chunks to make the review easier?

The `conductor` method of the `HeckeCharacter` class has this:

```
        modulus = bnr.bnrconductor(self._log_values_on_gens())
        # in a newer version of pari, this is replaced with bnrconductor
```

Is the comment obsolete since `bnrconductor` is already used?

On the other hand, the `is_primitive` method goes:

```
        # When a newer version of pari is part of Sage, call
        # bnrisconductor instead.
        return self.conductor() == self.modulus()
```

and the `root_number` method goes:

```
        # try-except only necessary because of
        # http://pari.math.u-bordeaux.fr/cgi-bin/bugreport.cgi?bug=1848
        # According to Belabas this bug seems to occur because of
        # a problem dealing with imprimitive characters, thus the code
        # in the except clause below. Once we incorporate a version
        # of pari where this bug is fixed, the command in the try
        # itself should be sufficient. The first example above
        # (with Q(cubert(3))) fails without the except clause
        # and so can be used to test if the pari bug has been fixed.
        try:
            rn = self.parent().group().pari_bnr().bnrrootnumber(self._log_values_on_gens())
        except PariError:
            chi = self.primitive_character()
            rn = chi.parent().group().pari_bnr().bnrrootnumber(chi._log_values_on_gens())
        return rn.sage()
```

but it would seem the pari bug in question is long fixed, right?

The examples block for `primitive_character` needs care:

```diff
-        Examples::
+        EXAMPLES::
```


There are some unwanted spaces before `::` in other example blocks.

Is all the commented-out code waiting for some other ticket to be in?

- method `_pari_finite_factors` in the class `Modulus`
- method `_element_constructor_` in the class `HeckeCharacterGroup_class`
- lots of code in the class `RayClassGroupElement`


---

Comment by git created at 2021-05-31 16:28:53

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-06-07 06:19:04

Branch pushed to git repo; I updated commit sha1. New commits:
