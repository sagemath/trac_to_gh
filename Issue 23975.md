# Issue 23975: Fresnel integrals

archive/issues_023975.json:
```json
{
    "body": "CC:  mforets\n\nThe SymPy-Sage interface raises an error because there are no Fresnel integral functions in Sage: \n\n```\nintegrate(sin(x^2), x, algorithm='sympy')\n...\nAttributeError: \n\nsee:\n\nsage: import sympy\nsage: x = sympy.Symbol('x')\nsage: sympy.integrate(sympy.sin(x^2), x)\n3*sqrt(2)*sqrt(pi)*fresnels(sqrt(2)*x/sqrt(pi))*gamma(3/4)/(8*gamma(7/4))\n```\n\nThey are holonomic so they should be in Sage.\n\nIssue created by migration from https://trac.sagemath.org/ticket/24212\n\n",
    "created_at": "2017-11-13T13:59:09Z",
    "labels": [
        "symbolics",
        "major",
        "bug"
    ],
    "title": "Fresnel integrals",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23975",
    "user": "rws"
}
```
CC:  mforets

The SymPy-Sage interface raises an error because there are no Fresnel integral functions in Sage: 

```
integrate(sin(x^2), x, algorithm='sympy')
...
AttributeError: 

see:

sage: import sympy
sage: x = sympy.Symbol('x')
sage: sympy.integrate(sympy.sin(x^2), x)
3*sqrt(2)*sqrt(pi)*fresnels(sqrt(2)*x/sqrt(pi))*gamma(3/4)/(8*gamma(7/4))
```

They are holonomic so they should be in Sage.

Issue created by migration from https://trac.sagemath.org/ticket/24212





---

archive/issue_comments_335793.json:
```json
{
    "body": "This is a tentative implementation of sine Fresnel integral. The numerical evaluation relies on mpmath. I doubted\u00a0about how to write the custom evaluation `_eval_` method. In fact I have two failing doctests. I expect:\n\n\n```python\nsage: fresnel_sin(0)\n0\nsage: fresnel_sin(x).subs(x==0)\n0\n```\n\n\nwhereas i get `fresnel_sin(0)` in both cases. Any hints?",
    "created_at": "2017-11-19T23:28:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23975",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23975#issuecomment-335793",
    "user": "mforets"
}
```

This is a tentative implementation of sine Fresnel integral. The numerical evaluation relies on mpmath. I doubtedÂ about how to write the custom evaluation `_eval_` method. In fact I have two failing doctests. I expect:


```python
sage: fresnel_sin(0)
0
sage: fresnel_sin(x).subs(x==0)
0
```


whereas i get `fresnel_sin(0)` in both cases. Any hints?



---

archive/issue_comments_335794.json:
```json
{
    "body": "Oh, and the `beta(...` --> `beta...` is because the missing parentheses were confusing my text editor, so that the entire file from that line on was shown as comments. I should remember to undo this change :)",
    "created_at": "2017-11-19T23:30:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23975",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23975#issuecomment-335794",
    "user": "mforets"
}
```

Oh, and the `beta(...` --> `beta...` is because the missing parentheses were confusing my text editor, so that the entire file from that line on was shown as comments. I should remember to undo this change :)



---

archive/issue_comments_335795.json:
```json
{
    "body": "Returning `None` (or just passing) in `_eval_` amounts to returning a held expression. `_evalf_` is only used for inexact arguments or `.n()`:\n\n```\nsage: fresnel_sin(0.)\n0.000000000000000\nsage: fresnel_sin(0).n()\n0.000000000000000\n```\n\nFor results to exact or symbolic arguments you need to implement them in `_eval_`.",
    "created_at": "2017-11-20T09:56:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23975",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23975#issuecomment-335795",
    "user": "rws"
}
```

Returning `None` (or just passing) in `_eval_` amounts to returning a held expression. `_evalf_` is only used for inexact arguments or `.n()`:

```
sage: fresnel_sin(0.)
0.000000000000000
sage: fresnel_sin(0).n()
0.000000000000000
```

For results to exact or symbolic arguments you need to implement them in `_eval_`.



---

archive/issue_comments_335796.json:
```json
{
    "body": "You would just need to handle `0` and `oo` in `_eval_`, and handle oddness before it, i.e. `if arg.is_negative(): return -fresnel_sin(-arg)`.",
    "created_at": "2017-11-20T14:27:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23975",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23975#issuecomment-335796",
    "user": "rws"
}
```

You would just need to handle `0` and `oo` in `_eval_`, and handle oddness before it, i.e. `if arg.is_negative(): return -fresnel_sin(-arg)`.



---

archive/issue_comments_335797.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-11-21T07:43:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23975",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23975#issuecomment-335797",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_335798.json:
```json
{
    "body": "ok, that fixed the 0, oo and -oo evaluations. i added two new tests for the `I*oo` cases, but this is still wrong. since\n\n\n```\nsage: SR(I*oo).is_infinity()\nTrue\n```\n\n\nprobably i could use `x.is_real()` too.",
    "created_at": "2017-11-21T07:47:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23975",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23975#issuecomment-335798",
    "user": "mforets"
}
```

ok, that fixed the 0, oo and -oo evaluations. i added two new tests for the `I*oo` cases, but this is still wrong. since


```
sage: SR(I*oo).is_infinity()
True
```


probably i could use `x.is_real()` too.



---

archive/issue_comments_335799.json:
```json
{
    "body": "You mean `unsigned_infinity`?",
    "created_at": "2017-11-21T08:30:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23975",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23975#issuecomment-335799",
    "user": "rws"
}
```

You mean `unsigned_infinity`?



---

archive/issue_comments_335800.json:
```json
{
    "body": "i should relate `unsigned_infinity` to test if the argument is complex and infinite? the doc of `unsigned_infinity` is precarious:\n\n\n```\nsage: unsigned_infinity?\nType:           UnsignedInfinity\nString form:    Infinity\nFile:           ~/Tools/sage-master/local/lib/python2.7/site-packages/sage/rings/infinity.py\nDocstring:         Initialize \"self\".\nInit docstring:    Initialize \"self\". \n```\n\n\ni'm tempted to add a ticket to explain this object more.",
    "created_at": "2017-11-21T09:24:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23975",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23975#issuecomment-335800",
    "user": "mforets"
}
```

i should relate `unsigned_infinity` to test if the argument is complex and infinite? the doc of `unsigned_infinity` is precarious:


```
sage: unsigned_infinity?
Type:           UnsignedInfinity
String form:    Infinity
File:           ~/Tools/sage-master/local/lib/python2.7/site-packages/sage/rings/infinity.py
Docstring:         Initialize "self".
Init docstring:    Initialize "self". 
```


i'm tempted to add a ticket to explain this object more.



---

archive/issue_comments_335801.json:
```json
{
    "body": "Replying to [comment:9 mforets]:\n> i should relate `unsigned_infinity` to test if the argument is complex and infinite? \n\nNo, I was not sure what you had in mind. If you want to test if the argument is complex and infinite then do: `if arg.is_infinity() and not arg.is_real()`. Technically a False for `arg.is_real()` just means \"I don't know\" so you get `True` for `SR(unsigned_infinity).is_real()`, but the correct behaviour must wait until we have `is_complex()`. Just use `not arg.is_real()` for now.",
    "created_at": "2017-11-21T10:02:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23975",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23975#issuecomment-335801",
    "user": "rws"
}
```

Replying to [comment:9 mforets]:
> i should relate `unsigned_infinity` to test if the argument is complex and infinite? 

No, I was not sure what you had in mind. If you want to test if the argument is complex and infinite then do: `if arg.is_infinity() and not arg.is_real()`. Technically a False for `arg.is_real()` just means "I don't know" so you get `True` for `SR(unsigned_infinity).is_real()`, but the correct behaviour must wait until we have `is_complex()`. Just use `not arg.is_real()` for now.



---

archive/issue_comments_335802.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-11-22T07:15:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23975",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23975#issuecomment-335802",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_335803.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-11-22T07:34:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23975",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23975#issuecomment-335803",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_335804.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-11-22T07:34:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23975",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23975#issuecomment-335804",
    "user": "mforets"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_335805.json:
```json
{
    "body": "oh, there's no conversion back to sage:\n\n\n```\nsage: fresnel_sin(x)._sympy_() # ok\nfresnels(x)\nsage: fresnel_sin(x)._sympy_()._sage_() # not working!\n```\n",
    "created_at": "2017-11-22T07:41:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23975",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23975#issuecomment-335805",
    "user": "mforets"
}
```

oh, there's no conversion back to sage:


```
sage: fresnel_sin(x)._sympy_() # ok
fresnels(x)
sage: fresnel_sin(x)._sympy_()._sage_() # not working!
```




---

archive/issue_comments_335806.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-11-22T07:57:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23975",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23975#issuecomment-335806",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_335807.json:
```json
{
    "body": "See how easy it is to add conversions now.",
    "created_at": "2017-11-22T07:58:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23975",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23975#issuecomment-335807",
    "user": "rws"
}
```

See how easy it is to add conversions now.



---

archive/issue_comments_335808.json:
```json
{
    "body": "> See how easy it is to add conversions now.\n\nawesome! it took me what, 15 minutes? and it was the first time i was doing that.",
    "created_at": "2017-11-22T08:00:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23975",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23975#issuecomment-335808",
    "user": "mforets"
}
```

> See how easy it is to add conversions now.

awesome! it took me what, 15 minutes? and it was the first time i was doing that.



---

archive/issue_comments_335809.json:
```json
{
    "body": "Patchbot has relevant doctest errors.",
    "created_at": "2017-11-26T17:05:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23975",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23975#issuecomment-335809",
    "user": "rws"
}
```

Patchbot has relevant doctest errors.



---

archive/issue_comments_335810.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-11-26T17:05:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23975",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23975#issuecomment-335810",
    "user": "rws"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_335811.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-11-26T23:04:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23975",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23975#issuecomment-335811",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_335812.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-11-26T23:14:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23975",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23975#issuecomment-335812",
    "user": "mforets"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_335813.json:
```json
{
    "body": "Indeed, thanks for noticing it!\n\nSome patchbots reported an error `RuntimeError: cases argument not a sequence` happening with some random tests. This seems to me unrelated to this ticket, but maybe i'm wrong.",
    "created_at": "2017-11-26T23:14:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23975",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23975#issuecomment-335813",
    "user": "mforets"
}
```

Indeed, thanks for noticing it!

Some patchbots reported an error `RuntimeError: cases argument not a sequence` happening with some random tests. This seems to me unrelated to this ticket, but maybe i'm wrong.



---

archive/issue_comments_335814.json:
```json
{
    "body": "Indeed, the cases fail has nothing to do with this ticket. It's a bug that is rare and happens randomly (#24284).",
    "created_at": "2017-11-27T07:05:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23975",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23975#issuecomment-335814",
    "user": "rws"
}
```

Indeed, the cases fail has nothing to do with this ticket. It's a bug that is rare and happens randomly (#24284).



---

archive/issue_comments_335815.json:
```json
{
    "body": "Docs are looking good. The patchbot errors are unrelated so I would be positive. However, the derivative is missing and there is a typo in the docs: write `\\operatorname{C}` not `\\operatorname(C)` in the formula. Could you please add that?",
    "created_at": "2017-11-28T07:30:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23975",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23975#issuecomment-335815",
    "user": "rws"
}
```

Docs are looking good. The patchbot errors are unrelated so I would be positive. However, the derivative is missing and there is a typo in the docs: write `\operatorname{C}` not `\operatorname(C)` in the formula. Could you please add that?



---

archive/issue_comments_335816.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-11-28T07:30:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23975",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23975#issuecomment-335816",
    "user": "rws"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_335817.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-11-29T00:15:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23975",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23975#issuecomment-335817",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_335818.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-11-29T00:17:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23975",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23975#issuecomment-335818",
    "user": "mforets"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_335819.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-11-29T06:42:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23975",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23975#issuecomment-335819",
    "user": "rws"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_335820.json:
```json
{
    "body": "Thanks for your work.",
    "created_at": "2017-11-29T06:42:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23975",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23975#issuecomment-335820",
    "user": "rws"
}
```

Thanks for your work.



---

archive/issue_comments_335821.json:
```json
{
    "body": "well, thanks for the review and all your help.",
    "created_at": "2017-11-29T06:49:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23975",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23975#issuecomment-335821",
    "user": "mforets"
}
```

well, thanks for the review and all your help.



---

archive/issue_comments_335822.json:
```json
{
    "body": "Merge conflict",
    "created_at": "2017-12-09T12:37:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23975",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23975#issuecomment-335822",
    "user": "vbraun"
}
```

Merge conflict



---

archive/issue_comments_335823.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-12-09T12:37:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23975",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23975#issuecomment-335823",
    "user": "vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_335824.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2017-12-14T07:09:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23975",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23975#issuecomment-335824",
    "user": "rws"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_335825.json:
```json
{
    "body": "I merged with 8.2.beta0 + #24171 to avoid another conflict.\n----\nNew commits:",
    "created_at": "2017-12-14T07:09:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23975",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23975#issuecomment-335825",
    "user": "rws"
}
```

I merged with 8.2.beta0 + #24171 to avoid another conflict.
----
New commits:



---

archive/issue_comments_335826.json:
```json
{
    "body": "well done, thanks.",
    "created_at": "2017-12-14T11:46:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23975",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23975#issuecomment-335826",
    "user": "mforets"
}
```

well done, thanks.



---

archive/issue_comments_335827.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-12-17T17:52:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23975",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23975#issuecomment-335827",
    "user": "vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_335828.json:
```json
{
    "body": "See patchbot",
    "created_at": "2017-12-17T17:52:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23975",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23975#issuecomment-335828",
    "user": "vbraun"
}
```

See patchbot



---

archive/issue_comments_335829.json:
```json
{
    "body": "The depended-on #24171 needs a patch so I'll squash it all, keeping authorship info correct.",
    "created_at": "2017-12-18T07:54:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23975",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23975#issuecomment-335829",
    "user": "rws"
}
```

The depended-on #24171 needs a patch so I'll squash it all, keeping authorship info correct.



---

archive/issue_comments_335830.json:
```json
{
    "body": "Actually the fails are due to the blockers #24284 and #24378 but they are not reviewed yet.",
    "created_at": "2017-12-18T08:11:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23975",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23975#issuecomment-335830",
    "user": "rws"
}
```

Actually the fails are due to the blockers #24284 and #24378 but they are not reviewed yet.



---

archive/issue_comments_335831.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2017-12-21T15:58:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23975",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23975#issuecomment-335831",
    "user": "rws"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_335832.json:
```json
{
    "body": "I moved the code into `error.py` as the Fresnel integrals are related to error functions. This also makes it independent from other tickets.\n----\nNew commits:",
    "created_at": "2017-12-21T15:58:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23975",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23975#issuecomment-335832",
    "user": "rws"
}
```

I moved the code into `error.py` as the Fresnel integrals are related to error functions. This also makes it independent from other tickets.
----
New commits:



---

archive/issue_comments_335833.json:
```json
{
    "body": "\n```\nFile \"src/sage/symbolic/random_tests.py\", line 265, in sage.symbolic.random_tests.?\nFailed example:\n    random_expr(50, nvars=3, coeff_generator=CDF.random_element) # random\nException raised:\n    Traceback (most recent call last):\n      File \"/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 517, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 920, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.symbolic.random_tests.?[2]>\", line 1, in <module>\n        random_expr(Integer(50), nvars=Integer(3), coeff_generator=CDF.random_element) # random\n      File \"/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/symbolic/random_tests.py\", line 288, in random_expr\n        return random_expr_helper(size, internal, leaves, verbose)\n      File \"/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/symbolic/random_tests.py\", line 232, in random_expr_helper\n        children = [random_expr_helper(n+1, internal, leaves, verbose) for n in nodes_per_child]\n      File \"/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/symbolic/random_tests.py\", line 232, in random_expr_helper\n        children = [random_expr_helper(n+1, internal, leaves, verbose) for n in nodes_per_child]\n      File \"/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/symbolic/random_tests.py\", line 232, in random_expr_helper\n        children = [random_expr_helper(n+1, internal, leaves, verbose) for n in nodes_per_child]\n      File \"/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/symbolic/random_tests.py\", line 232, in random_expr_helper\n        children = [random_expr_helper(n+1, internal, leaves, verbose) for n in nodes_per_child]\n      File \"/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/symbolic/random_tests.py\", line 232, in random_expr_helper\n        children = [random_expr_helper(n+1, internal, leaves, verbose) for n in nodes_per_child]\n      File \"/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/symbolic/random_tests.py\", line 232, in random_expr_helper\n        children = [random_expr_helper(n+1, internal, leaves, verbose) for n in nodes_per_child]\n      File \"/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/symbolic/random_tests.py\", line 235, in random_expr_helper\n        return r[1](*children)\n      File \"sage/symbolic/expression.pyx\", line 3537, in sage.symbolic.expression.Expression.__invert__ (build/cythonized/sage/symbolic/expression.cpp:25798)\n        return 1/self\n      File \"sage/structure/element.pyx\", line 1660, in sage.structure.element.Element.__div__ (build/cythonized/sage/structure/element.c:12835)\n        return coercion_model.bin_op(left, right, div)\n      File \"sage/structure/coerce.pyx\", line 1081, in sage.structure.coerce.CoercionModel_cache_maps.bin_op (build/cythonized/sage/structure/coerce.c:9515)\n        return PyObject_CallObject(op, xy)\n      File \"sage/structure/element.pyx\", line 1655, in sage.structure.element.Element.__div__ (build/cythonized/sage/structure/element.c:12758)\n        return (<Element>left)._div_(right)\n      File \"sage/symbolic/expression.pyx\", line 3518, in sage.symbolic.expression.Expression._div_ (build/cythonized/sage/symbolic/expression.cpp:25588)\n        raise ZeroDivisionError(\"Symbolic division by zero\")\n    ZeroDivisionError: Symbolic division by zero\n**********************************************************************\n1 item had failures:\n   1 of   5 in sage.symbolic.random_tests.?\n    [35 tests, 1 failure, 22.02 s]\n----------------------------------------------------------------------\nsage -t --long src/sage/symbolic/random_tests.py  # 1 doctest failed\n```\n",
    "created_at": "2017-12-23T06:49:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23975",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23975#issuecomment-335833",
    "user": "vbraun"
}
```


```
File "src/sage/symbolic/random_tests.py", line 265, in sage.symbolic.random_tests.?
Failed example:
    random_expr(50, nvars=3, coeff_generator=CDF.random_element) # random
Exception raised:
    Traceback (most recent call last):
      File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 517, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 920, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.symbolic.random_tests.?[2]>", line 1, in <module>
        random_expr(Integer(50), nvars=Integer(3), coeff_generator=CDF.random_element) # random
      File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/symbolic/random_tests.py", line 288, in random_expr
        return random_expr_helper(size, internal, leaves, verbose)
      File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/symbolic/random_tests.py", line 232, in random_expr_helper
        children = [random_expr_helper(n+1, internal, leaves, verbose) for n in nodes_per_child]
      File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/symbolic/random_tests.py", line 232, in random_expr_helper
        children = [random_expr_helper(n+1, internal, leaves, verbose) for n in nodes_per_child]
      File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/symbolic/random_tests.py", line 232, in random_expr_helper
        children = [random_expr_helper(n+1, internal, leaves, verbose) for n in nodes_per_child]
      File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/symbolic/random_tests.py", line 232, in random_expr_helper
        children = [random_expr_helper(n+1, internal, leaves, verbose) for n in nodes_per_child]
      File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/symbolic/random_tests.py", line 232, in random_expr_helper
        children = [random_expr_helper(n+1, internal, leaves, verbose) for n in nodes_per_child]
      File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/symbolic/random_tests.py", line 232, in random_expr_helper
        children = [random_expr_helper(n+1, internal, leaves, verbose) for n in nodes_per_child]
      File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/symbolic/random_tests.py", line 235, in random_expr_helper
        return r[1](*children)
      File "sage/symbolic/expression.pyx", line 3537, in sage.symbolic.expression.Expression.__invert__ (build/cythonized/sage/symbolic/expression.cpp:25798)
        return 1/self
      File "sage/structure/element.pyx", line 1660, in sage.structure.element.Element.__div__ (build/cythonized/sage/structure/element.c:12835)
        return coercion_model.bin_op(left, right, div)
      File "sage/structure/coerce.pyx", line 1081, in sage.structure.coerce.CoercionModel_cache_maps.bin_op (build/cythonized/sage/structure/coerce.c:9515)
        return PyObject_CallObject(op, xy)
      File "sage/structure/element.pyx", line 1655, in sage.structure.element.Element.__div__ (build/cythonized/sage/structure/element.c:12758)
        return (<Element>left)._div_(right)
      File "sage/symbolic/expression.pyx", line 3518, in sage.symbolic.expression.Expression._div_ (build/cythonized/sage/symbolic/expression.cpp:25588)
        raise ZeroDivisionError("Symbolic division by zero")
    ZeroDivisionError: Symbolic division by zero
**********************************************************************
1 item had failures:
   1 of   5 in sage.symbolic.random_tests.?
    [35 tests, 1 failure, 22.02 s]
----------------------------------------------------------------------
sage -t --long src/sage/symbolic/random_tests.py  # 1 doctest failed
```




---

archive/issue_comments_335834.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-12-23T06:49:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23975",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23975#issuecomment-335834",
    "user": "vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_335835.json:
```json
{
    "body": "`random_expr` is really interesting. It should be made easier to debug, and errors caught/not caught should be reviewed because `TypeError`s from ECL represent real bugs and `RuntimeError`s from Pynac should be rebranded in the Python layer. Also sometimes it takes really really long time. After that, someone should do a day-long run to catch any remaining problems.",
    "created_at": "2017-12-23T08:17:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23975",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23975#issuecomment-335835",
    "user": "rws"
}
```

`random_expr` is really interesting. It should be made easier to debug, and errors caught/not caught should be reviewed because `TypeError`s from ECL represent real bugs and `RuntimeError`s from Pynac should be rebranded in the Python layer. Also sometimes it takes really really long time. After that, someone should do a day-long run to catch any remaining problems.



---

archive/issue_comments_335836.json:
```json
{
    "body": "The reason why the doctest fails is that, despite fixing the random seed, the functions and symbols picked by `random_expr` are different. This, at some point in the buildup of the expression, leads to the sub-expression `kronecker_delta(-0.6165326641917295 + 0.15117833554974136*I, e)` which immediately evaluates to `0`. The `0` progresses eventually into a denominator, causing the error. `random_expr` is not written to avoid such errors if they happen, nor does it avoid other exceptions thrown. The author of the doctest apparently just chose a random seed that happens to not throw errors.\n\nOf course the actual bug is that `random_expr` changes behaviour when unrelated code is changed.",
    "created_at": "2017-12-24T06:59:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23975",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23975#issuecomment-335836",
    "user": "rws"
}
```

The reason why the doctest fails is that, despite fixing the random seed, the functions and symbols picked by `random_expr` are different. This, at some point in the buildup of the expression, leads to the sub-expression `kronecker_delta(-0.6165326641917295 + 0.15117833554974136*I, e)` which immediately evaluates to `0`. The `0` progresses eventually into a denominator, causing the error. `random_expr` is not written to avoid such errors if they happen, nor does it avoid other exceptions thrown. The author of the doctest apparently just chose a random seed that happens to not throw errors.

Of course the actual bug is that `random_expr` changes behaviour when unrelated code is changed.



---

archive/issue_comments_335837.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-12-26T08:22:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23975",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23975#issuecomment-335837",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_335838.json:
```json
{
    "body": "Dependency needs review.",
    "created_at": "2017-12-26T08:23:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23975",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23975#issuecomment-335838",
    "user": "rws"
}
```

Dependency needs review.



---

archive/issue_comments_335839.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-12-26T08:23:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23975",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23975#issuecomment-335839",
    "user": "rws"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_335840.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-02-24T06:58:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23975",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23975#issuecomment-335840",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_335841.json:
```json
{
    "body": "The dependency has been approved and merged. Thanks.\n\nI've merged with the latest development version and now i'm checking if the branch applies.",
    "created_at": "2018-06-05T12:48:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23975",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23975#issuecomment-335841",
    "user": "mforets"
}
```

The dependency has been approved and merged. Thanks.

I've merged with the latest development version and now i'm checking if the branch applies.



---

archive/issue_comments_335842.json:
```json
{
    "body": "New commits:",
    "created_at": "2018-06-05T13:46:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23975",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23975#issuecomment-335842",
    "user": "mforets"
}
```

New commits:



---

archive/issue_comments_335843.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-06-06T01:27:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23975",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23975#issuecomment-335843",
    "user": "mforets"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_335844.json:
```json
{
    "body": "\n```\n$ ./sage -t src/sage/calculus/calculus.py src/sage/functions/*\n...\nGit branch: t/24212/24212-2\nUsing --optional=mpir,python2,sage\n...\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\nTotal time for all tests: 106.7 seconds\n    cpu time: 111.3 seconds\n    cumulative wall time: 104.6 seconds\n```\n",
    "created_at": "2018-06-06T01:27:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23975",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23975#issuecomment-335844",
    "user": "mforets"
}
```


```
$ ./sage -t src/sage/calculus/calculus.py src/sage/functions/*
...
Git branch: t/24212/24212-2
Using --optional=mpir,python2,sage
...
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 106.7 seconds
    cpu time: 111.3 seconds
    cumulative wall time: 104.6 seconds
```




---

archive/issue_comments_335845.json:
```json
{
    "body": "Quick question: do you want to change the test in `calculus.py`? In particular, do you still want to test that Sage handles the case when something in sympy gives something Sage doesn't know how to handle?",
    "created_at": "2018-06-06T01:44:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23975",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23975#issuecomment-335845",
    "user": "tscrim"
}
```

Quick question: do you want to change the test in `calculus.py`? In particular, do you still want to test that Sage handles the case when something in sympy gives something Sage doesn't know how to handle?



---

archive/issue_comments_335846.json:
```json
{
    "body": "Alright. I found this one:\n\n\n```\nsage: laplace(cos(-1/t), t, s, algorithm='sympy')\n...\nAttributeError: Unable to convert SymPy result (=meijerg(((), ()), ((-1/2, 0, 1/2), (0,)), s**2/16)/4) into Sage\n```\n\n\n(side note: i didn't read the syntax of sympy's meijerg function, but here is a quick comparison to [WA's answer](http://www.wolframalpha.com/input/?i=laplace(cos(-1%2Ft))&rawformassumption=%7B%22C%22,+%22t%22%7D+-%3E+%7B%22Variable%22%7D&rawformassumption=%7B%22FunClash%22,+%22laplace%22%7D+-%3E+%7B%22CalculateLaplaceTransform%22%7D))",
    "created_at": "2018-06-06T02:29:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23975",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23975#issuecomment-335846",
    "user": "mforets"
}
```

Alright. I found this one:


```
sage: laplace(cos(-1/t), t, s, algorithm='sympy')
...
AttributeError: Unable to convert SymPy result (=meijerg(((), ()), ((-1/2, 0, 1/2), (0,)), s**2/16)/4) into Sage
```


(side note: i didn't read the syntax of sympy's meijerg function, but here is a quick comparison to [WA's answer](http://www.wolframalpha.com/input/?i=laplace(cos(-1%2Ft))&rawformassumption=%7B%22C%22,+%22t%22%7D+-%3E+%7B%22Variable%22%7D&rawformassumption=%7B%22FunClash%22,+%22laplace%22%7D+-%3E+%7B%22CalculateLaplaceTransform%22%7D))



---

archive/issue_comments_335847.json:
```json
{
    "body": "Replying to [comment:50 mforets]:\n> {{{\n> sage: laplace(cos(-1/t), t, s, algorithm='sympy')\n> ...\n> AttributeError: Unable to convert SymPy result (=meijerg(((), ()), ((-1/2, 0, 1/2), (0,)), s**2/16)/4) into Sage\n> }}}\n\nFor that, there is #17970.",
    "created_at": "2018-06-06T06:16:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23975",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23975#issuecomment-335847",
    "user": "rws"
}
```

Replying to [comment:50 mforets]:
> {{{
> sage: laplace(cos(-1/t), t, s, algorithm='sympy')
> ...
> AttributeError: Unable to convert SymPy result (=meijerg(((), ()), ((-1/2, 0, 1/2), (0,)), s**2/16)/4) into Sage
> }}}

For that, there is #17970.



---

archive/issue_comments_335848.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2018-06-06T13:03:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23975",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23975#issuecomment-335848",
    "user": "mforets"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_335849.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-06-06T13:03:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23975",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23975#issuecomment-335849",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_335850.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-06-06T13:18:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23975",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23975#issuecomment-335850",
    "user": "rws"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_335851.json:
```json
{
    "body": "When we have #17970 we'll likely convert the G expression to the Fresnel expression in Sage.",
    "created_at": "2018-06-06T13:18:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23975",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23975#issuecomment-335851",
    "user": "rws"
}
```

When we have #17970 we'll likely convert the G expression to the Fresnel expression in Sage.



---

archive/issue_comments_335852.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-06-07T22:15:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23975",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23975#issuecomment-335852",
    "user": "vbraun"
}
```

Resolution: fixed
