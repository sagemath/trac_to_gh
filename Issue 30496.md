# Issue 30496: GH Actions: Remove use of deprecated set-env command

Issue created by migration from https://trac.sagemath.org/ticket/30733

Original creator: mkoeppe

Original creation time: 2020-10-06 19:02:52

CC:  @kliem dimpase @tobiasdiez

The `set-env` command is deprecated and will be disabled soon. Please upgrade to using Environment Files. For more information see: https://github.blog/changelog/2020-10-01-github-actions-deprecating-set-env-and-add-path-commands/


---

Comment by mkoeppe created at 2020-11-17 01:44:57

Changing priority from major to critical.


---

Comment by mkoeppe created at 2020-11-17 02:49:20

New commits:


---

Comment by mkoeppe created at 2020-11-17 02:49:20

Changing status from new to needs_review.


---

Comment by @tobiasdiez created at 2020-11-17 11:20:11

Is this really working? According to https://docs.github.com/en/free-pro-team`@`latest/actions/reference/workflow-commands-for-github-actions#environment-files the syntax is slightly different: `echo "action_state=yellow" >> $GITHUB_ENV`, that is, no `name=` prefix and `=` instead of `::`.


---

Comment by @tobiasdiez created at 2020-11-17 11:20:11

Changing status from needs_review to needs_info.


---

Comment by mkoeppe created at 2020-11-17 16:04:31

You are right, sorry!


---

Comment by mkoeppe created at 2020-11-17 16:05:43

Wait, isn't this exactly the change that I have done?


---

Comment by @tobiasdiez created at 2020-11-17 17:45:25

I think instead of 

```
echo "name=DOCKER_PUSH_REPOSITORY::docker.pkg.github.com/${{ github.repository }}/" >> $GITHUB_ENV
```

it should be 

```
echo "DOCKER_PUSH_REPOSITORY=docker.pkg.github.com/${{ github.repository }}/" >> $GITHUB_ENV
```


It would be good if you could trigger these workflows and see if they still work.


---

Comment by mkoeppe created at 2020-11-17 18:44:23

OK, thanks, now after enough coffee I see the mistake that you pointed out.


---

Comment by git created at 2020-11-17 19:00:22

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by mkoeppe created at 2020-11-17 19:07:28

Changing status from needs_info to needs_review.


---

Comment by mkoeppe created at 2020-11-17 19:10:38

This now seems to work, as can be seen in https://github.com/mkoeppe/sage/runs/1414148202:

```
Pushing docker.pkg.github.com/mkoeppe/sage/sage-docker-debian-bullseye-standard-configured:9.1.rc4-71302-ga75c9b7518-failed
The push refers to repository [docker.pkg.github.com/mkoeppe/sage/sage-docker-debian-bullseye-standard-configured]
1414c2322460: Preparing
```


(That the actual docker push is failing with `no basic auth credentials` is a separate issue -- this has already been failing for a while and will be addressed in another ticket.)


---

Comment by @tobiasdiez created at 2020-11-17 21:07:53

Changing status from needs_review to positive_review.


---

Comment by @tobiasdiez created at 2020-11-17 21:07:53

LGTM! (Not sure if the github url should stay in Reviewers comment.)

Just for reference, a different solution would use the recently added feature that steps (and jobs) can have return values: https://docs.github.com/en/free-pro-team`@`latest/actions/reference/workflow-syntax-for-github-actions#jobsjob_idoutputs


---

Comment by mkoeppe created at 2020-11-17 21:31:14

Thanks for reviewing!


---

Comment by mkoeppe created at 2020-11-17 21:31:51

Replying to [comment:14 gh-tobiasdiez]:
> Just for reference, a different solution would use the recently added feature that steps (and jobs) can have return values: https://docs.github.com/en/free-pro-team`@`latest/actions/reference/workflow-syntax-for-github-actions#jobsjob_idoutputs

Yes, thanks, this is good to know


---

Comment by vbraun created at 2020-11-22 15:06:57

Resolution: fixed
