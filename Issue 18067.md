# Issue 18067: Integer and Rational comparisons

archive/issues_018067.json:
```json
{
    "body": "CC:  @jdemeyer\n\nComparing integers is very fast, comparing rationals is very fast but comparing integer with rational is about 5x slower:\n\n```\nsage: a = 1; b = 18\nsage: timeit(\"a < b\", number=500000, repeat=100)\n500000 loops, best of 100: 64.3 ns per loop\nsage: a = QQ(1); b = QQ(18)\nsage: timeit(\"a < b\", number=500000, repeat=100)\n500000 loops, best of 100: 88.4 ns per loop\nsage: a = 1; b = QQ(18)\nsage: timeit(\"a < b\", number=500000, repeat=100)\n500000 loops, best of 100: 416 ns per loop\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/18304\n\n",
    "created_at": "2015-04-26T11:05:02Z",
    "labels": [
        "performance",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.0",
    "title": "Integer and Rational comparisons",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18067",
    "user": "@videlec"
}
```
CC:  @jdemeyer

Comparing integers is very fast, comparing rationals is very fast but comparing integer with rational is about 5x slower:

```
sage: a = 1; b = 18
sage: timeit("a < b", number=500000, repeat=100)
500000 loops, best of 100: 64.3 ns per loop
sage: a = QQ(1); b = QQ(18)
sage: timeit("a < b", number=500000, repeat=100)
500000 loops, best of 100: 88.4 ns per loop
sage: a = 1; b = QQ(18)
sage: timeit("a < b", number=500000, repeat=100)
500000 loops, best of 100: 416 ns per loop
```


Issue created by migration from https://trac.sagemath.org/ticket/18304





---

archive/issue_comments_243411.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-26T15:44:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18067#issuecomment-243411",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_243412.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-04-26T15:49:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18067#issuecomment-243412",
    "user": "@videlec"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_243413.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-04-28T21:56:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18067#issuecomment-243413",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_243414.json:
```json
{
    "body": "It's not really a big deal, but I'm not much of a fan of these global `mpz_tmp`/`mpq_tmp`: this is one more thing that will break if it ever becomes possible to have multi-threaded sage code... Did you check if there is a measurable performance benefit?\n\nAlso, couldn't `__richcmp__` just call itself instead of having duplicate code to handle the case where `right` is of the type defined by the class?\n\nBy the way, if you make further changes, perhaps you could take the occasion to make `_cmp_` use `rich_to_bool_sign` too.",
    "created_at": "2015-05-03T08:54:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18067#issuecomment-243414",
    "user": "@mezzarobba"
}
```

It's not really a big deal, but I'm not much of a fan of these global `mpz_tmp`/`mpq_tmp`: this is one more thing that will break if it ever becomes possible to have multi-threaded sage code... Did you check if there is a measurable performance benefit?

Also, couldn't `__richcmp__` just call itself instead of having duplicate code to handle the case where `right` is of the type defined by the class?

By the way, if you make further changes, perhaps you could take the occasion to make `_cmp_` use `rich_to_bool_sign` too.



---

archive/issue_comments_243415.json:
```json
{
    "body": "Hello,\n\nReplying to [comment:6 mmezzarobba]:\n> It's not really a big deal, but I'm not much of a fan of these global `mpz_tmp`/`mpq_tmp`: this is one more thing that will break if it ever becomes possible to have multi-threaded sage code...\n\nMe neither (and there is actually one in `sage.rings.integer` that is not from me). The ideal would be for gmp/mpir to provide a `mpq_cmp_mpz`. Do you think that it is reasonable to ask them?\n\n> Did you check if there is a measurable performance benefit?\n\nIt is minor but timings are in the ticket description. In a more concrete situation\n\n```\nsage: l = [ZZ.random_element() for _ in range(100)]\nsage: l.extend(QQ.random_element() for _ in range(100))\nsage: shuffle(l)\nsage: %time l.sort()\nCPU times: user 0 ns, sys: 0 ns, total: 0 ns\nWall time: 1.21 ms\n```\n\ncompared to\n\n```\nsage: %time l.sort()\nCPU times: user 0 ns, sys: 0 ns, total: 0 ns\nWall time: 247 \u00b5s\n```\n\n\n> Also, couldn't `__richcmp__` just call itself instead of having duplicate code to handle the case where `right` is of the type defined by the class?\n\nI do not know why it was done this way for integers. I just naively used the implementation of `Integer.__richcmp__` as a template.\n\n> By the way, if you make further changes, perhaps you could take the occasion to make `_cmp_` use `rich_to_bool_sign` too.\n\nYes.",
    "created_at": "2015-05-03T09:05:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18067#issuecomment-243415",
    "user": "@videlec"
}
```

Hello,

Replying to [comment:6 mmezzarobba]:
> It's not really a big deal, but I'm not much of a fan of these global `mpz_tmp`/`mpq_tmp`: this is one more thing that will break if it ever becomes possible to have multi-threaded sage code...

Me neither (and there is actually one in `sage.rings.integer` that is not from me). The ideal would be for gmp/mpir to provide a `mpq_cmp_mpz`. Do you think that it is reasonable to ask them?

> Did you check if there is a measurable performance benefit?

It is minor but timings are in the ticket description. In a more concrete situation

```
sage: l = [ZZ.random_element() for _ in range(100)]
sage: l.extend(QQ.random_element() for _ in range(100))
sage: shuffle(l)
sage: %time l.sort()
CPU times: user 0 ns, sys: 0 ns, total: 0 ns
Wall time: 1.21 ms
```

compared to

```
sage: %time l.sort()
CPU times: user 0 ns, sys: 0 ns, total: 0 ns
Wall time: 247 Âµs
```


> Also, couldn't `__richcmp__` just call itself instead of having duplicate code to handle the case where `right` is of the type defined by the class?

I do not know why it was done this way for integers. I just naively used the implementation of `Integer.__richcmp__` as a template.

> By the way, if you make further changes, perhaps you could take the occasion to make `_cmp_` use `rich_to_bool_sign` too.

Yes.



---

archive/issue_comments_243416.json:
```json
{
    "body": "Replying to [comment:7 vdelecroix]:\n> > By the way, if you make further changes, perhaps you could take the occasion to make `_cmp_` use `rich_to_bool_sign` too.\n> \n> Yes.\n\nActually, no. Because it is **not** a rich comparison but just comparison.",
    "created_at": "2015-05-03T09:09:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18067#issuecomment-243416",
    "user": "@videlec"
}
```

Replying to [comment:7 vdelecroix]:
> > By the way, if you make further changes, perhaps you could take the occasion to make `_cmp_` use `rich_to_bool_sign` too.
> 
> Yes.

Actually, no. Because it is **not** a rich comparison but just comparison.



---

archive/issue_comments_243417.json:
```json
{
    "body": "Replying to [comment:7 vdelecroix]:\n> Me neither (and there is actually one in `sage.rings.integer` that is not from me).\n\nYes, I saw that.\n\n> The ideal would be for gmp/mpir to provide a `mpq_cmp_mpz`. Do you think that it is reasonable to ask them?\n\nI have no idea.\n\n> > Did you check if there is a measurable performance benefit?\n> \n> It is minor but timings are in the ticket description.\n\nNo, I mean specifically for using a global temporary variable instead of creating a new one each time.",
    "created_at": "2015-05-03T09:13:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18067#issuecomment-243417",
    "user": "@mezzarobba"
}
```

Replying to [comment:7 vdelecroix]:
> Me neither (and there is actually one in `sage.rings.integer` that is not from me).

Yes, I saw that.

> The ideal would be for gmp/mpir to provide a `mpq_cmp_mpz`. Do you think that it is reasonable to ask them?

I have no idea.

> > Did you check if there is a measurable performance benefit?
> 
> It is minor but timings are in the ticket description.

No, I mean specifically for using a global temporary variable instead of creating a new one each time.



---

archive/issue_comments_243418.json:
```json
{
    "body": "Replying to [comment:8 vdelecroix]:\n> Replying to [comment:7 vdelecroix]:\n> > > By the way, if you make further changes, perhaps you could take the occasion to make `_cmp_` use `rich_to_bool_sign` too.\n> > \n> > Yes.\n> \n> Actually, no. Because it is **not** a rich comparison but just comparison.\n\nRight, sorry.",
    "created_at": "2015-05-03T09:16:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18067#issuecomment-243418",
    "user": "@mezzarobba"
}
```

Replying to [comment:8 vdelecroix]:
> Replying to [comment:7 vdelecroix]:
> > > By the way, if you make further changes, perhaps you could take the occasion to make `_cmp_` use `rich_to_bool_sign` too.
> > 
> > Yes.
> 
> Actually, no. Because it is **not** a rich comparison but just comparison.

Right, sorry.



---

archive/issue_comments_243419.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-05-03T09:57:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18067#issuecomment-243419",
    "user": "@videlec"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_243420.json:
```json
{
    "body": "With \n\n```\nsage: l = [ZZ.random_element() for _ in range(100)]\nsage: l.extend(QQ.random_element() for _ in range(100))\n```\n\n\ndeclaring global `mpz_tmp` and `mpq_tmp` I got\n\n```\ntimeit(\"shuffle(l); l.sort()\", number=5000, repeat=10)\n5000 loops, best of 10: 131 \u00b5s per loop\n```\n\nand with local ones\n\n```\nsage: timeit(\"shuffle(l); l.sort()\", number=5000, repeat=10)\n5000 loops, best of 10: 177 \u00b5s per loop\n```\n\n\nNote that this bad scenario only occurs for comparisons of:\n- Python long with Sage Integer\n- Sage Rationals with Sage Integer, Python int, Python long\n\nThere is a slightly another annoying thing with the global `mpz_tmp/mpq_tmp`: `mpir/gmp` do not free the memory of a `mpz/mpq` if it is not asked explicitely. So if you compare a very big rational with a very big integer you will occupy some memory for the rest of the Sage session (similarly for a big Python long with a big Sage Integer).\n\nI will try harder to see if there is a way to tweak `mpir` to avoid the creation of anything when we want to compare `mpz` to `mpq`. I think that having slow comparison Python long / Sage integer is not an issue. In other words, we should get rid of these global variables.\n\nVincent",
    "created_at": "2015-05-03T09:57:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18067#issuecomment-243420",
    "user": "@videlec"
}
```

With 

```
sage: l = [ZZ.random_element() for _ in range(100)]
sage: l.extend(QQ.random_element() for _ in range(100))
```


declaring global `mpz_tmp` and `mpq_tmp` I got

```
timeit("shuffle(l); l.sort()", number=5000, repeat=10)
5000 loops, best of 10: 131 Âµs per loop
```

and with local ones

```
sage: timeit("shuffle(l); l.sort()", number=5000, repeat=10)
5000 loops, best of 10: 177 Âµs per loop
```


Note that this bad scenario only occurs for comparisons of:
- Python long with Sage Integer
- Sage Rationals with Sage Integer, Python int, Python long

There is a slightly another annoying thing with the global `mpz_tmp/mpq_tmp`: `mpir/gmp` do not free the memory of a `mpz/mpq` if it is not asked explicitely. So if you compare a very big rational with a very big integer you will occupy some memory for the rest of the Sage session (similarly for a big Python long with a big Sage Integer).

I will try harder to see if there is a way to tweak `mpir` to avoid the creation of anything when we want to compare `mpz` to `mpq`. I think that having slow comparison Python long / Sage integer is not an issue. In other words, we should get rid of these global variables.

Vincent



---

archive/issue_comments_243421.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-08-14T17:07:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18067#issuecomment-243421",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_243422.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-08-14T17:10:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18067#issuecomment-243422",
    "user": "@videlec"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_243423.json:
```json
{
    "body": "Hi Vincent,\n\nDo you still want to patch mpir after the answers you got on mpir-devel and gmp-devel? If you do: would the code from this ticket still work if sage is built with gmp?",
    "created_at": "2015-08-18T14:48:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18067#issuecomment-243423",
    "user": "@mezzarobba"
}
```

Hi Vincent,

Do you still want to patch mpir after the answers you got on mpir-devel and gmp-devel? If you do: would the code from this ticket still work if sage is built with gmp?



---

archive/issue_comments_243424.json:
```json
{
    "body": "Hi Marc,\n\nThanks for having a look.\n\nReplying to [comment:15 mmezzarobba]:\n> Do you still want to patch mpir after the answers you got on mpir-devel and gmp-devel? If you do: would the code from this ticket still work if sage is built with gmp?\n\nLast news from GMP: they kind to agree that a `mpq_cmp_z` would be good (note that it is `mpq_cmp_mpz` in my branch). But I am not sure anything concrete already happened.\n\nYou are right, I need to also patch gmp in order to make Sage works. Another option is to wait for upstream upgrading from both GMP and mpir. What do you think? I mostly wanted to test it.",
    "created_at": "2015-08-18T15:39:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18067#issuecomment-243424",
    "user": "@videlec"
}
```

Hi Marc,

Thanks for having a look.

Replying to [comment:15 mmezzarobba]:
> Do you still want to patch mpir after the answers you got on mpir-devel and gmp-devel? If you do: would the code from this ticket still work if sage is built with gmp?

Last news from GMP: they kind to agree that a `mpq_cmp_z` would be good (note that it is `mpq_cmp_mpz` in my branch). But I am not sure anything concrete already happened.

You are right, I need to also patch gmp in order to make Sage works. Another option is to wait for upstream upgrading from both GMP and mpir. What do you think? I mostly wanted to test it.



---

archive/issue_comments_243425.json:
```json
{
    "body": "Replying to [comment:16 vdelecroix]:\n> You are right, I need to also patch gmp in order to make Sage works. Another option is to wait for upstream upgrading from both GMP and mpir. What do you think? I mostly wanted to test it.\n\nI'd wait.",
    "created_at": "2015-08-18T15:45:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18067#issuecomment-243425",
    "user": "@mezzarobba"
}
```

Replying to [comment:16 vdelecroix]:
> You are right, I need to also patch gmp in order to make Sage works. Another option is to wait for upstream upgrading from both GMP and mpir. What do you think? I mostly wanted to test it.

I'd wait.



---

archive/issue_comments_243426.json:
```json
{
    "body": "Replying to [comment:17 mmezzarobba]:\n> Replying to [comment:16 vdelecroix]:\n> > You are right, I need to also patch gmp in order to make Sage works. Another option is to wait for upstream upgrading from both GMP and mpir. What do you think? I mostly wanted to test it.\n> \n> I'd wait.\n\nLooks more reasonable to me as well (I do not like to patch upstream). So I will push harder upstream to have these functions in the next releases.",
    "created_at": "2015-08-18T15:57:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18067#issuecomment-243426",
    "user": "@videlec"
}
```

Replying to [comment:17 mmezzarobba]:
> Replying to [comment:16 vdelecroix]:
> > You are right, I need to also patch gmp in order to make Sage works. Another option is to wait for upstream upgrading from both GMP and mpir. What do you think? I mostly wanted to test it.
> 
> I'd wait.

Looks more reasonable to me as well (I do not like to patch upstream). So I will push harder upstream to have these functions in the next releases.



---

archive/issue_comments_243427.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-08-18T15:57:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18067#issuecomment-243427",
    "user": "@videlec"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_243428.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-05-04T06:34:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18067#issuecomment-243428",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_243429.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-05-04T06:35:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18067#issuecomment-243429",
    "user": "@videlec"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_243430.json:
```json
{
    "body": "does not apply",
    "created_at": "2017-05-31T06:34:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18067#issuecomment-243430",
    "user": "@fchapoton"
}
```

does not apply



---

archive/issue_comments_243431.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-05-31T06:34:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18067#issuecomment-243431",
    "user": "@fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_243432.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2017-05-31T07:26:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18067#issuecomment-243432",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_243433.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-05-31T07:26:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18067#issuecomment-243433",
    "user": "@videlec"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_243434.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-06-03T16:07:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18067#issuecomment-243434",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_243435.json:
```json
{
    "body": "Overall, I think this is ready to go into Sage. However, close to the realm of bikeshedding, I would change:\n\n```diff\n-if not isinstance(left, Rational):\n-   raise RuntimeError('this should not happen')\n+assert isinstance(left, Rational)\n```\n",
    "created_at": "2017-06-03T22:16:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18067#issuecomment-243435",
    "user": "@tscrim"
}
```

Overall, I think this is ready to go into Sage. However, close to the realm of bikeshedding, I would change:

```diff
-if not isinstance(left, Rational):
-   raise RuntimeError('this should not happen')
+assert isinstance(left, Rational)
```




---

archive/issue_comments_243436.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-06-12T15:59:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18067#issuecomment-243436",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_243437.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-06-12T16:00:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18067#issuecomment-243437",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_243438.json:
```json
{
    "body": "rebased on 8.0.beta10 (and incorported your [comment:28 comment:28])",
    "created_at": "2017-06-12T16:01:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18067#issuecomment-243438",
    "user": "@videlec"
}
```

rebased on 8.0.beta10 (and incorported your [comment:28 comment:28])



---

archive/issue_comments_243439.json:
```json
{
    "body": "Thanks. However, I just had a strong sense of dread come over me when I thought about why the old code was checking left/right. In code like `__eq__`, Python will sometimes swap the arguments, see:\n\nhttps://eev.ee/blog/2012/03/24/python-faq-equality/\n\nI do not know if this is done for `__richcmp__` with extension classes, but I probably won't be able to look into this until tomorrow.",
    "created_at": "2017-06-12T23:00:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18067#issuecomment-243439",
    "user": "@tscrim"
}
```

Thanks. However, I just had a strong sense of dread come over me when I thought about why the old code was checking left/right. In code like `__eq__`, Python will sometimes swap the arguments, see:

https://eev.ee/blog/2012/03/24/python-faq-equality/

I do not know if this is done for `__richcmp__` with extension classes, but I probably won't be able to look into this until tomorrow.



---

archive/issue_comments_243440.json:
```json
{
    "body": "does not build, due to a changed import (richcmp stuff is now in sage.structure.richcmp)",
    "created_at": "2017-06-16T06:34:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18067#issuecomment-243440",
    "user": "@fchapoton"
}
```

does not build, due to a changed import (richcmp stuff is now in sage.structure.richcmp)



---

archive/issue_comments_243441.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-06-16T06:34:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18067#issuecomment-243441",
    "user": "@fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_243442.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-06-16T07:53:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18067#issuecomment-243442",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_243443.json:
```json
{
    "body": "Indeed. I rebased on 8.0.beta11.",
    "created_at": "2017-06-16T07:54:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18067#issuecomment-243443",
    "user": "@videlec"
}
```

Indeed. I rebased on 8.0.beta11.



---

archive/issue_comments_243444.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-06-16T07:54:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18067#issuecomment-243444",
    "user": "@videlec"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_243445.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-06-16T15:35:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18067#issuecomment-243445",
    "user": "@tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_243446.json:
```json
{
    "body": "Hmm...I could've sworn Python sometimes flips inputs for something like `__eq__`, but maybe I am thinking of some other operation. Anyways, looks good and ready to be merged.",
    "created_at": "2017-06-16T15:35:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18067#issuecomment-243446",
    "user": "@tscrim"
}
```

Hmm...I could've sworn Python sometimes flips inputs for something like `__eq__`, but maybe I am thinking of some other operation. Anyways, looks good and ready to be merged.



---

archive/issue_comments_243447.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-06-17T10:29:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18067#issuecomment-243447",
    "user": "@vbraun"
}
```

Resolution: fixed
