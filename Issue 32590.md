# Issue 32590: Segmentation fault in face iterator

archive/issues_032590.json:
```json
{
    "body": "CC:  tmonteil @tscrim @vbraun\n\nSome patchbots are reporting consistent segmentation faults with combinatorial polyhedron:\n\nE.g.\n\nhttps://patchbot.sagemath.org/log/32788/Linux/1_SMP_Debian_5.10.70-1_(2021-09-30)/x86_64/5.10.0-9-amd64/tmonteil-lxc1/2021-10-30%2023:39:45\n\nIssue created by migration from https://trac.sagemath.org/ticket/32827\n\n",
    "created_at": "2021-11-05T07:14:03Z",
    "labels": [
        "component: geometry",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.5",
    "title": "Segmentation fault in face iterator",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32590",
    "user": "https://github.com/kliem"
}
```
CC:  tmonteil @tscrim @vbraun

Some patchbots are reporting consistent segmentation faults with combinatorial polyhedron:

E.g.

https://patchbot.sagemath.org/log/32788/Linux/1_SMP_Debian_5.10.70-1_(2021-09-30)/x86_64/5.10.0-9-amd64/tmonteil-lxc1/2021-10-30%2023:39:45

Issue created by migration from https://trac.sagemath.org/ticket/32827





---

archive/issue_comments_464241.json:
```json
{
    "body": "`@`tmonteil:\n\nCould you perhaps inspect that bot and the sage version, if it is still running. It could be a bug with #32666 or a bug that shows now, because something is compiled differently, due to code change.\n\nEither way, it would greatly help, if you could inspect a few things:\n\nDoes this work:\n\n\n```\nsage: Asso = polytopes.associahedron(['A',3])\nsage: Asso.vertex_adjacency_matrix()\n[0 1 0 0 0 1 0 0 1 0 0 0 0 0]\n[1 0 1 0 0 0 0 1 0 0 0 0 0 0]\n[0 1 0 1 0 1 0 0 0 0 0 0 0 0]\n[0 0 1 0 1 0 0 0 0 0 0 1 0 0]\n[0 0 0 1 0 0 0 1 0 0 0 0 1 0]\n[1 0 1 0 0 0 0 0 0 0 0 0 0 1]\n[0 0 0 0 0 0 0 1 1 0 1 0 0 0]\n[0 1 0 0 1 0 1 0 0 0 0 0 0 0]\n[1 0 0 0 0 0 1 0 0 1 0 0 0 0]\n[0 0 0 0 0 0 0 0 1 0 1 0 0 1]\n[0 0 0 0 0 0 1 0 0 1 0 0 1 0]\n[0 0 0 1 0 0 0 0 0 0 0 0 1 1]\n[0 0 0 0 1 0 0 0 0 0 1 1 0 0]\n[0 0 0 0 0 1 0 0 0 1 0 1 0 0]\n```\n\n\nI guess not.\n\nNow, the combinatorial polyhedron is probably still obtained fine:\n\n\n```\nsage: Asso = polytopes.associahedron(['A',3])\nsage: C = Asso.combinatorial_polyhedron()\n```\n\n\nOnce you have it, there are a number of things to test:\n\n\n```\nsage: C.edges()\n```\n\n\n\n```\nsage: for f in C.face_iter():\n....:     print(f)\n```\n\n\nSame for `C.face_iter(dual=True)`, `C.face_iter(0)`, `C.face_iter(0, dual=True)`.\n\nIt should help a lot in catching that bug, seeing exactly when there is a segmentation fault.\n\nPlease do not recompile, as the bug might hide then. But I don't know.",
    "created_at": "2021-11-05T07:26:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32590#issuecomment-464241",
    "user": "https://github.com/kliem"
}
```

`@`tmonteil:

Could you perhaps inspect that bot and the sage version, if it is still running. It could be a bug with #32666 or a bug that shows now, because something is compiled differently, due to code change.

Either way, it would greatly help, if you could inspect a few things:

Does this work:


```
sage: Asso = polytopes.associahedron(['A',3])
sage: Asso.vertex_adjacency_matrix()
[0 1 0 0 0 1 0 0 1 0 0 0 0 0]
[1 0 1 0 0 0 0 1 0 0 0 0 0 0]
[0 1 0 1 0 1 0 0 0 0 0 0 0 0]
[0 0 1 0 1 0 0 0 0 0 0 1 0 0]
[0 0 0 1 0 0 0 1 0 0 0 0 1 0]
[1 0 1 0 0 0 0 0 0 0 0 0 0 1]
[0 0 0 0 0 0 0 1 1 0 1 0 0 0]
[0 1 0 0 1 0 1 0 0 0 0 0 0 0]
[1 0 0 0 0 0 1 0 0 1 0 0 0 0]
[0 0 0 0 0 0 0 0 1 0 1 0 0 1]
[0 0 0 0 0 0 1 0 0 1 0 0 1 0]
[0 0 0 1 0 0 0 0 0 0 0 0 1 1]
[0 0 0 0 1 0 0 0 0 0 1 1 0 0]
[0 0 0 0 0 1 0 0 0 1 0 1 0 0]
```


I guess not.

Now, the combinatorial polyhedron is probably still obtained fine:


```
sage: Asso = polytopes.associahedron(['A',3])
sage: C = Asso.combinatorial_polyhedron()
```


Once you have it, there are a number of things to test:


```
sage: C.edges()
```



```
sage: for f in C.face_iter():
....:     print(f)
```


Same for `C.face_iter(dual=True)`, `C.face_iter(0)`, `C.face_iter(0, dual=True)`.

It should help a lot in catching that bug, seeing exactly when there is a segmentation fault.

Please do not recompile, as the bug might hide then. But I don't know.



---

archive/issue_comments_464242.json:
```json
{
    "body": "Replying to [comment:1 gh-kliem]:\n> `@`tmonteil:\n> \n> Could you perhaps inspect that bot and the sage version, if it is still running. It could be a bug with #32666 or a bug that shows now, because something is compiled differently, due to code change.\n> \n> Either way, it would greatly help, if you could inspect a few things:\n> \n> Does this work:\n\nOn the current state of `tmonteil-lxc1`, wich is a merge between `9.5.beta5` and the branch of #32320 i do not have any error.\n\nOn `tmonteil-lxc3`, which is a merge between `9.5.beta5` and the branch of #31635, i have:\n\n> {{{\n> sage: Asso = polytopes.associahedron(['A',3])\n> sage: Asso.vertex_adjacency_matrix()\n> [0 1 0 0 0 1 0 0 1 0 0 0 0 0]\n> [1 0 1 0 0 0 0 1 0 0 0 0 0 0]\n> [0 1 0 1 0 1 0 0 0 0 0 0 0 0]\n> [0 0 1 0 1 0 0 0 0 0 0 1 0 0]\n> [0 0 0 1 0 0 0 1 0 0 0 0 1 0]\n> [1 0 1 0 0 0 0 0 0 0 0 0 0 1]\n> [0 0 0 0 0 0 0 1 1 0 1 0 0 0]\n> [0 1 0 0 1 0 1 0 0 0 0 0 0 0]\n> [1 0 0 0 0 0 1 0 0 1 0 0 0 0]\n> [0 0 0 0 0 0 0 0 1 0 1 0 0 1]\n> [0 0 0 0 0 0 1 0 0 1 0 0 1 0]\n> [0 0 0 1 0 0 0 0 0 0 0 0 1 1]\n> [0 0 0 0 1 0 0 0 0 0 1 1 0 0]\n> [0 0 0 0 0 1 0 0 0 1 0 1 0 0]\n> }}}\n> \n> I guess not.\n\n\nIndeed:\n\n\n```\nsage: Asso = polytopes.associahedron(['A',3])\nsage: Asso.vertex_adjacency_matrix()\n------------------------------------------------------------------------\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0x947b)[0x7f2d6c21947b]\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0xf2d8)[0x7f2d6c21f2d8]\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0xfff0)[0x7f2d6c21fff0]\n/lib/x86_64-linux-gnu/libpthread.so.0(+0x12730)[0x7f2d6fc47730]\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.cpython-37m-x86_64-linux-gnu.so(+0xe4d0)[0x7f2d112f54d0]\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.cpython-37m-x86_64-linux-gnu.so(+0x14466)[0x7f2d112fb466]\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/base.cpython-37m-x86_64-linux-gnu.so(+0x1d3d2)[0x7f2d113723d2]\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/base.cpython-37m-x86_64-linux-gnu.so(+0x1f1d7)[0x7f2d113741d7]\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/base.cpython-37m-x86_64-linux-gnu.so(+0x49d7b)[0x7f2d1139ed7b]\npython3(_PyMethodDef_RawFastCallDict+0x22a)[0x5d8c6a]\npython3[0x4d743e]\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/misc/cachefunc.cpython-37m-x86_64-linux-gnu.so(+0x134cd)[0x7f2d6cdb64cd]\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/misc/cachefunc.cpython-37m-x86_64-linux-gnu.so(+0x287eb)[0x7f2d6cdcb7eb]\npython3(_PyObject_FastCallKeywords+0x4eb)[0x5da01b]\npython3[0x54b3c1]\npython3(_PyEval_EvalFrameDefault+0x441d)[0x5524cd]\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/misc/cachefunc.cpython-37m-x86_64-linux-gnu.so(+0x10c13)[0x7f2d6cdb3c13]\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/misc/cachefunc.cpython-37m-x86_64-linux-gnu.so(+0x10dba)[0x7f2d6cdb3dba]\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/misc/cachefunc.cpython-37m-x86_64-linux-gnu.so(+0x287d0)[0x7f2d6cdcb7d0]\npython3(_PyObject_FastCallKeywords+0x4eb)[0x5da01b]\npython3[0x54b3c1]\npython3(_PyEval_EvalFrameDefault+0x441d)[0x5524cd]\npython3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]\npython3[0x558f25]\npython3(_PyMethodDef_RawFastCallKeywords+0x1b3)[0x5d8833]\npython3(_PyEval_EvalFrameDefault+0x42c3)[0x552373]\npython3[0x4d37a6]\npython3(_PyEval_EvalFrameDefault+0x1a75)[0x54fb25]\npython3[0x4d37a6]\npython3(_PyEval_EvalFrameDefault+0x1a75)[0x54fb25]\npython3[0x4d37a6]\npython3(_PyMethodDescr_FastCallKeywords+0x151)[0x4d76a1]\npython3(_PyEval_EvalFrameDefault+0x45f8)[0x5526a8]\npython3(_PyFunction_FastCallKeywords+0x18c)[0x5d91fc]\npython3(_PyEval_EvalFrameDefault+0x4fc)[0x54e5ac]\npython3(_PyFunction_FastCallKeywords+0x18c)[0x5d91fc]\npython3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]\npython3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]\npython3(_PyFunction_FastCallKeywords+0x482)[0x5d94f2]\npython3[0x54b1f0]\npython3(_PyEval_EvalFrameDefault+0x13ae)[0x54f45e]\npython3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]\npython3(_PyFunction_FastCallKeywords+0x482)[0x5d94f2]\npython3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]\npython3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]\npython3(_PyFunction_FastCallKeywords+0x482)[0x5d94f2]\npython3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]\npython3(_PyFunction_FastCallKeywords+0x18c)[0x5d91fc]\npython3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]\npython3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]\npython3(PyEval_EvalCode+0x23)[0x54e0a3]\npython3[0x630ce2]\npython3(PyRun_FileExFlags+0x97)[0x630d97]\npython3(PyRun_SimpleFileExFlags+0x17f)[0x6319ff]\npython3[0x65432e]\npython3(_Py_UnixMain+0x2e)[0x65468e]\n/lib/x86_64-linux-gnu/libc.so.6(__libc_start_main+0xeb)[0x7f2d6f6ae09b]\npython3(_start+0x2a)[0x5e0e8a]\n------------------------------------------------------------------------\nAttaching gdb to process id 1024695.\nCannot find gdb installed\nGDB is not installed.\nInstall gdb for enhanced tracebacks.\n------------------------------------------------------------------------\nUnhandled SIGSEGV: A segmentation fault occurred.\nThis probably occurred because a *compiled* module has a bug\nin it and is not properly wrapped with sig_on(), sig_off().\nPython will now terminate.\n------------------------------------------------------------------------\nSegmentation fault\n```\n\n\n\n> Now, the combinatorial polyhedron is probably still obtained fine:\n> \n> {{{\n> sage: Asso = polytopes.associahedron(['A',3])\n> sage: C = Asso.combinatorial_polyhedron()\n> }}}\n> \n> Once you have it, there are a number of things to test:\n> \n> {{{\n> sage: C.edges()\n> }}}\n\n\n\n```\nsage: Asso = polytopes.associahedron(['A',3])\nsage: C = Asso.combinatorial_polyhedron()\nsage: C.edges()\n------------------------------------------------------------------------\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0x947b)[0x7f4e6052547b]\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0xf2d8)[0x7f4e6052b2d8]\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0xfff0)[0x7f4e6052bff0]\n/lib/x86_64-linux-gnu/libpthread.so.0(+0x12730)[0x7f4e63513730]\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.cpython-37m-x86_64-linux-gnu.so(+0xe4d0)[0x7f4e04bc24d0]\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.cpython-37m-x86_64-linux-gnu.so(+0x14466)[0x7f4e04bc8466]\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/base.cpython-37m-x86_64-linux-gnu.so(+0x1d3d2)[0x7f4e04c3f3d2]\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/base.cpython-37m-x86_64-linux-gnu.so(+0x1f1d7)[0x7f4e04c411d7]\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/base.cpython-37m-x86_64-linux-gnu.so(+0x4d73d)[0x7f4e04c6f73d]\npython3(_PyMethodDescr_FastCallKeywords+0x3c4)[0x4d7914]\npython3(_PyEval_EvalFrameDefault+0x45f8)[0x5526a8]\npython3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]\npython3[0x558f25]\npython3(_PyMethodDef_RawFastCallKeywords+0x1b3)[0x5d8833]\npython3(_PyEval_EvalFrameDefault+0x42c3)[0x552373]\npython3[0x4d37a6]\npython3(_PyEval_EvalFrameDefault+0x1a75)[0x54fb25]\npython3[0x4d37a6]\npython3(_PyEval_EvalFrameDefault+0x1a75)[0x54fb25]\npython3[0x4d37a6]\npython3(_PyMethodDescr_FastCallKeywords+0x151)[0x4d76a1]\npython3(_PyEval_EvalFrameDefault+0x45f8)[0x5526a8]\npython3(_PyFunction_FastCallKeywords+0x18c)[0x5d91fc]\npython3(_PyEval_EvalFrameDefault+0x4fc)[0x54e5ac]\npython3(_PyFunction_FastCallKeywords+0x18c)[0x5d91fc]\npython3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]\npython3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]\npython3(_PyFunction_FastCallKeywords+0x482)[0x5d94f2]\npython3[0x54b1f0]\npython3(_PyEval_EvalFrameDefault+0x13ae)[0x54f45e]\npython3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]\npython3(_PyFunction_FastCallKeywords+0x482)[0x5d94f2]\npython3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]\npython3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]\npython3(_PyFunction_FastCallKeywords+0x482)[0x5d94f2]\npython3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]\npython3(_PyFunction_FastCallKeywords+0x18c)[0x5d91fc]\npython3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]\npython3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]\npython3(PyEval_EvalCode+0x23)[0x54e0a3]\npython3[0x630ce2]\npython3(PyRun_FileExFlags+0x97)[0x630d97]\npython3(PyRun_SimpleFileExFlags+0x17f)[0x6319ff]\npython3[0x65432e]\npython3(_Py_UnixMain+0x2e)[0x65468e]\n/lib/x86_64-linux-gnu/libc.so.6(__libc_start_main+0xeb)[0x7f4e62f7a09b]\npython3(_start+0x2a)[0x5e0e8a]\n------------------------------------------------------------------------\nAttaching gdb to process id 1024859.\nCannot find gdb installed\nGDB is not installed.\nInstall gdb for enhanced tracebacks.\n------------------------------------------------------------------------\nUnhandled SIGSEGV: A segmentation fault occurred.\nThis probably occurred because a *compiled* module has a bug\nin it and is not properly wrapped with sig_on(), sig_off().\nPython will now terminate.\n------------------------------------------------------------------------\nSegmentation fault\n```\n\n\n\n> {{{\n> sage: for f in C.face_iter():\n> ....:     print(f)\n> }}}\n\n\n```\nsage: Asso = polytopes.associahedron(['A',3])\nsage: C = Asso.combinatorial_polyhedron()\nsage: for f in C.face_iter():\n....:     print(f)\n....: \n------------------------------------------------------------------------\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0x947b)[0x7f31646b547b]\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0xf2d8)[0x7f31646bb2d8]\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0xfff0)[0x7f31646bbff0]\n/lib/x86_64-linux-gnu/libpthread.so.0(+0x12730)[0x7f31676a3730]\n/lib/x86_64-linux-gnu/libc.so.6(+0x15cb0d)[0x7f3167242b0d]\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/combinatorial_face.cpython-37m-x86_64-linux-gnu.so(+0x1305a)[0x7f3108d8b05a]\npython3[0x599551]\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.cpython-37m-x86_64-linux-gnu.so(+0xc9ac)[0x7f3108d529ac]\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.cpython-37m-x86_64-linux-gnu.so(+0x15948)[0x7f3108d5b948]\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.cpython-37m-x86_64-linux-gnu.so(+0x1a2ef)[0x7f3108d602ef]\npython3(_PyEval_EvalFrameDefault+0x8cd)[0x54e97d]\npython3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]\npython3[0x558f25]\npython3(_PyMethodDef_RawFastCallKeywords+0x1b3)[0x5d8833]\npython3(_PyEval_EvalFrameDefault+0x42c3)[0x552373]\npython3[0x4d37a6]\npython3(_PyEval_EvalFrameDefault+0x1a75)[0x54fb25]\npython3[0x4d37a6]\npython3(_PyEval_EvalFrameDefault+0x1a75)[0x54fb25]\npython3[0x4d37a6]\npython3(_PyMethodDescr_FastCallKeywords+0x151)[0x4d76a1]\npython3(_PyEval_EvalFrameDefault+0x45f8)[0x5526a8]\npython3(_PyFunction_FastCallKeywords+0x18c)[0x5d91fc]\npython3(_PyEval_EvalFrameDefault+0x4fc)[0x54e5ac]\npython3(_PyFunction_FastCallKeywords+0x18c)[0x5d91fc]\npython3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]\npython3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]\npython3(_PyFunction_FastCallKeywords+0x482)[0x5d94f2]\npython3[0x54b1f0]\npython3(_PyEval_EvalFrameDefault+0x13ae)[0x54f45e]\npython3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]\npython3(_PyFunction_FastCallKeywords+0x482)[0x5d94f2]\npython3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]\npython3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]\npython3(_PyFunction_FastCallKeywords+0x482)[0x5d94f2]\npython3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]\npython3(_PyFunction_FastCallKeywords+0x18c)[0x5d91fc]\npython3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]\npython3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]\npython3(PyEval_EvalCode+0x23)[0x54e0a3]\npython3[0x630ce2]\npython3(PyRun_FileExFlags+0x97)[0x630d97]\npython3(PyRun_SimpleFileExFlags+0x17f)[0x6319ff]\npython3[0x65432e]\npython3(_Py_UnixMain+0x2e)[0x65468e]\n/lib/x86_64-linux-gnu/libc.so.6(__libc_start_main+0xeb)[0x7f316710a09b]\npython3(_start+0x2a)[0x5e0e8a]\n------------------------------------------------------------------------\nAttaching gdb to process id 1025024.\nCannot find gdb installed\nGDB is not installed.\nInstall gdb for enhanced tracebacks.\n------------------------------------------------------------------------\nUnhandled SIGSEGV: A segmentation fault occurred.\nThis probably occurred because a *compiled* module has a bug\nin it and is not properly wrapped with sig_on(), sig_off().\nPython will now terminate.\n------------------------------------------------------------------------\nSegmentation fault\n```\n\n\n\n> Same for `C.face_iter(dual=True)`,\n\n\n```\nsage: Asso = polytopes.associahedron(['A',3])\nsage: C = Asso.combinatorial_polyhedron()\nsage: for f in C.face_iter(dual=True):\n....:     print(f)\n....: \n------------------------------------------------------------------------\nSegmentation fault\n```\n\n\n> `C.face_iter(0)`,\n\n\n```\nsage: Asso = polytopes.associahedron(['A',3])\nsage: C = Asso.combinatorial_polyhedron()\nsage: for f in C.face_iter(0):\n....:     print(f)\n....: \nA 0-dimensional face of a 3-dimensional combinatorial polyhedron\nA 0-dimensional face of a 3-dimensional combinatorial polyhedron\nA 0-dimensional face of a 3-dimensional combinatorial polyhedron\nA 0-dimensional face of a 3-dimensional combinatorial polyhedron\nA 0-dimensional face of a 3-dimensional combinatorial polyhedron\nA 0-dimensional face of a 3-dimensional combinatorial polyhedron\nA 0-dimensional face of a 3-dimensional combinatorial polyhedron\nA 0-dimensional face of a 3-dimensional combinatorial polyhedron\nA 0-dimensional face of a 3-dimensional combinatorial polyhedron\nA 0-dimensional face of a 3-dimensional combinatorial polyhedron\nA 0-dimensional face of a 3-dimensional combinatorial polyhedron\nA 0-dimensional face of a 3-dimensional combinatorial polyhedron\nA 0-dimensional face of a 3-dimensional combinatorial polyhedron\nA 0-dimensional face of a 3-dimensional combinatorial polyhedron\n```\n\n\n> `C.face_iter(0, dual=True)`.\n\n\n```\nsage: for f in C.face_iter(0, dual=True):\n....:     print(f)\n....: \n------------------------------------------------------------------------\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0x947b)[0x7f6886f5547b]\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0xf2d8)[0x7f6886f5b2d8]\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0xfff0)[0x7f6886f5bff0]\n/lib/x86_64-linux-gnu/libpthread.so.0(+0x12730)[0x7f688a983730]\n/lib/x86_64-linux-gnu/libc.so.6(+0x15cb0d)[0x7f688a522b0d]\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/combinatorial_face.cpython-37m-x86_64-linux-gnu.so(+0x1305a)[0x7f682c06a05a]\npython3[0x599551]\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.cpython-37m-x86_64-linux-gnu.so(+0xc9ac)[0x7f682c0319ac]\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.cpython-37m-x86_64-linux-gnu.so(+0x15948)[0x7f682c03a948]\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.cpython-37m-x86_64-linux-gnu.so(+0x1a2ef)[0x7f682c03f2ef]\npython3(_PyEval_EvalFrameDefault+0x8cd)[0x54e97d]\npython3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]\npython3[0x558f25]\npython3(_PyMethodDef_RawFastCallKeywords+0x1b3)[0x5d8833]\npython3(_PyEval_EvalFrameDefault+0x42c3)[0x552373]\npython3[0x4d37a6]\npython3(_PyEval_EvalFrameDefault+0x1a75)[0x54fb25]\npython3[0x4d37a6]\npython3(_PyEval_EvalFrameDefault+0x1a75)[0x54fb25]\npython3[0x4d37a6]\npython3(_PyMethodDescr_FastCallKeywords+0x151)[0x4d76a1]\npython3(_PyEval_EvalFrameDefault+0x45f8)[0x5526a8]\npython3(_PyFunction_FastCallKeywords+0x18c)[0x5d91fc]\npython3(_PyEval_EvalFrameDefault+0x4fc)[0x54e5ac]\npython3(_PyFunction_FastCallKeywords+0x18c)[0x5d91fc]\npython3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]\npython3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]\npython3(_PyFunction_FastCallKeywords+0x482)[0x5d94f2]\npython3[0x54b1f0]\npython3(_PyEval_EvalFrameDefault+0x13ae)[0x54f45e]\npython3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]\npython3(_PyFunction_FastCallKeywords+0x482)[0x5d94f2]\npython3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]\npython3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]\npython3(_PyFunction_FastCallKeywords+0x482)[0x5d94f2]\npython3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]\npython3(_PyFunction_FastCallKeywords+0x18c)[0x5d91fc]\npython3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]\npython3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]\npython3(PyEval_EvalCode+0x23)[0x54e0a3]\npython3[0x630ce2]\npython3(PyRun_FileExFlags+0x97)[0x630d97]\npython3(PyRun_SimpleFileExFlags+0x17f)[0x6319ff]\npython3[0x65432e]\npython3(_Py_UnixMain+0x2e)[0x65468e]\n/lib/x86_64-linux-gnu/libc.so.6(__libc_start_main+0xeb)[0x7f688a3ea09b]\npython3(_start+0x2a)[0x5e0e8a]\n------------------------------------------------------------------------\nAttaching gdb to process id 1025356.\nCannot find gdb installed\nGDB is not installed.\nInstall gdb for enhanced tracebacks.\n------------------------------------------------------------------------\nUnhandled SIGSEGV: A segmentation fault occurred.\nThis probably occurred because a *compiled* module has a bug\nin it and is not properly wrapped with sig_on(), sig_off().\nPython will now terminate.\n------------------------------------------------------------------------\nSegmentation fault\n```\n\n\n> It should help a lot in catching that bug, seeing exactly when there is a segmentation fault.\n> \n> Please do not recompile, as the bug might hide then. But I don't know.",
    "created_at": "2021-11-05T13:10:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32590#issuecomment-464242",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Replying to [comment:1 gh-kliem]:
> `@`tmonteil:
> 
> Could you perhaps inspect that bot and the sage version, if it is still running. It could be a bug with #32666 or a bug that shows now, because something is compiled differently, due to code change.
> 
> Either way, it would greatly help, if you could inspect a few things:
> 
> Does this work:

On the current state of `tmonteil-lxc1`, wich is a merge between `9.5.beta5` and the branch of #32320 i do not have any error.

On `tmonteil-lxc3`, which is a merge between `9.5.beta5` and the branch of #31635, i have:

> {{{
> sage: Asso = polytopes.associahedron(['A',3])
> sage: Asso.vertex_adjacency_matrix()
> [0 1 0 0 0 1 0 0 1 0 0 0 0 0]
> [1 0 1 0 0 0 0 1 0 0 0 0 0 0]
> [0 1 0 1 0 1 0 0 0 0 0 0 0 0]
> [0 0 1 0 1 0 0 0 0 0 0 1 0 0]
> [0 0 0 1 0 0 0 1 0 0 0 0 1 0]
> [1 0 1 0 0 0 0 0 0 0 0 0 0 1]
> [0 0 0 0 0 0 0 1 1 0 1 0 0 0]
> [0 1 0 0 1 0 1 0 0 0 0 0 0 0]
> [1 0 0 0 0 0 1 0 0 1 0 0 0 0]
> [0 0 0 0 0 0 0 0 1 0 1 0 0 1]
> [0 0 0 0 0 0 1 0 0 1 0 0 1 0]
> [0 0 0 1 0 0 0 0 0 0 0 0 1 1]
> [0 0 0 0 1 0 0 0 0 0 1 1 0 0]
> [0 0 0 0 0 1 0 0 0 1 0 1 0 0]
> }}}
> 
> I guess not.


Indeed:


```
sage: Asso = polytopes.associahedron(['A',3])
sage: Asso.vertex_adjacency_matrix()
------------------------------------------------------------------------
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0x947b)[0x7f2d6c21947b]
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0xf2d8)[0x7f2d6c21f2d8]
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0xfff0)[0x7f2d6c21fff0]
/lib/x86_64-linux-gnu/libpthread.so.0(+0x12730)[0x7f2d6fc47730]
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.cpython-37m-x86_64-linux-gnu.so(+0xe4d0)[0x7f2d112f54d0]
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.cpython-37m-x86_64-linux-gnu.so(+0x14466)[0x7f2d112fb466]
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/base.cpython-37m-x86_64-linux-gnu.so(+0x1d3d2)[0x7f2d113723d2]
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/base.cpython-37m-x86_64-linux-gnu.so(+0x1f1d7)[0x7f2d113741d7]
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/base.cpython-37m-x86_64-linux-gnu.so(+0x49d7b)[0x7f2d1139ed7b]
python3(_PyMethodDef_RawFastCallDict+0x22a)[0x5d8c6a]
python3[0x4d743e]
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/misc/cachefunc.cpython-37m-x86_64-linux-gnu.so(+0x134cd)[0x7f2d6cdb64cd]
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/misc/cachefunc.cpython-37m-x86_64-linux-gnu.so(+0x287eb)[0x7f2d6cdcb7eb]
python3(_PyObject_FastCallKeywords+0x4eb)[0x5da01b]
python3[0x54b3c1]
python3(_PyEval_EvalFrameDefault+0x441d)[0x5524cd]
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/misc/cachefunc.cpython-37m-x86_64-linux-gnu.so(+0x10c13)[0x7f2d6cdb3c13]
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/misc/cachefunc.cpython-37m-x86_64-linux-gnu.so(+0x10dba)[0x7f2d6cdb3dba]
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/misc/cachefunc.cpython-37m-x86_64-linux-gnu.so(+0x287d0)[0x7f2d6cdcb7d0]
python3(_PyObject_FastCallKeywords+0x4eb)[0x5da01b]
python3[0x54b3c1]
python3(_PyEval_EvalFrameDefault+0x441d)[0x5524cd]
python3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]
python3[0x558f25]
python3(_PyMethodDef_RawFastCallKeywords+0x1b3)[0x5d8833]
python3(_PyEval_EvalFrameDefault+0x42c3)[0x552373]
python3[0x4d37a6]
python3(_PyEval_EvalFrameDefault+0x1a75)[0x54fb25]
python3[0x4d37a6]
python3(_PyEval_EvalFrameDefault+0x1a75)[0x54fb25]
python3[0x4d37a6]
python3(_PyMethodDescr_FastCallKeywords+0x151)[0x4d76a1]
python3(_PyEval_EvalFrameDefault+0x45f8)[0x5526a8]
python3(_PyFunction_FastCallKeywords+0x18c)[0x5d91fc]
python3(_PyEval_EvalFrameDefault+0x4fc)[0x54e5ac]
python3(_PyFunction_FastCallKeywords+0x18c)[0x5d91fc]
python3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]
python3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]
python3(_PyFunction_FastCallKeywords+0x482)[0x5d94f2]
python3[0x54b1f0]
python3(_PyEval_EvalFrameDefault+0x13ae)[0x54f45e]
python3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]
python3(_PyFunction_FastCallKeywords+0x482)[0x5d94f2]
python3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]
python3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]
python3(_PyFunction_FastCallKeywords+0x482)[0x5d94f2]
python3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]
python3(_PyFunction_FastCallKeywords+0x18c)[0x5d91fc]
python3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]
python3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]
python3(PyEval_EvalCode+0x23)[0x54e0a3]
python3[0x630ce2]
python3(PyRun_FileExFlags+0x97)[0x630d97]
python3(PyRun_SimpleFileExFlags+0x17f)[0x6319ff]
python3[0x65432e]
python3(_Py_UnixMain+0x2e)[0x65468e]
/lib/x86_64-linux-gnu/libc.so.6(__libc_start_main+0xeb)[0x7f2d6f6ae09b]
python3(_start+0x2a)[0x5e0e8a]
------------------------------------------------------------------------
Attaching gdb to process id 1024695.
Cannot find gdb installed
GDB is not installed.
Install gdb for enhanced tracebacks.
------------------------------------------------------------------------
Unhandled SIGSEGV: A segmentation fault occurred.
This probably occurred because a *compiled* module has a bug
in it and is not properly wrapped with sig_on(), sig_off().
Python will now terminate.
------------------------------------------------------------------------
Segmentation fault
```



> Now, the combinatorial polyhedron is probably still obtained fine:
> 
> {{{
> sage: Asso = polytopes.associahedron(['A',3])
> sage: C = Asso.combinatorial_polyhedron()
> }}}
> 
> Once you have it, there are a number of things to test:
> 
> {{{
> sage: C.edges()
> }}}



```
sage: Asso = polytopes.associahedron(['A',3])
sage: C = Asso.combinatorial_polyhedron()
sage: C.edges()
------------------------------------------------------------------------
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0x947b)[0x7f4e6052547b]
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0xf2d8)[0x7f4e6052b2d8]
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0xfff0)[0x7f4e6052bff0]
/lib/x86_64-linux-gnu/libpthread.so.0(+0x12730)[0x7f4e63513730]
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.cpython-37m-x86_64-linux-gnu.so(+0xe4d0)[0x7f4e04bc24d0]
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.cpython-37m-x86_64-linux-gnu.so(+0x14466)[0x7f4e04bc8466]
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/base.cpython-37m-x86_64-linux-gnu.so(+0x1d3d2)[0x7f4e04c3f3d2]
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/base.cpython-37m-x86_64-linux-gnu.so(+0x1f1d7)[0x7f4e04c411d7]
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/base.cpython-37m-x86_64-linux-gnu.so(+0x4d73d)[0x7f4e04c6f73d]
python3(_PyMethodDescr_FastCallKeywords+0x3c4)[0x4d7914]
python3(_PyEval_EvalFrameDefault+0x45f8)[0x5526a8]
python3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]
python3[0x558f25]
python3(_PyMethodDef_RawFastCallKeywords+0x1b3)[0x5d8833]
python3(_PyEval_EvalFrameDefault+0x42c3)[0x552373]
python3[0x4d37a6]
python3(_PyEval_EvalFrameDefault+0x1a75)[0x54fb25]
python3[0x4d37a6]
python3(_PyEval_EvalFrameDefault+0x1a75)[0x54fb25]
python3[0x4d37a6]
python3(_PyMethodDescr_FastCallKeywords+0x151)[0x4d76a1]
python3(_PyEval_EvalFrameDefault+0x45f8)[0x5526a8]
python3(_PyFunction_FastCallKeywords+0x18c)[0x5d91fc]
python3(_PyEval_EvalFrameDefault+0x4fc)[0x54e5ac]
python3(_PyFunction_FastCallKeywords+0x18c)[0x5d91fc]
python3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]
python3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]
python3(_PyFunction_FastCallKeywords+0x482)[0x5d94f2]
python3[0x54b1f0]
python3(_PyEval_EvalFrameDefault+0x13ae)[0x54f45e]
python3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]
python3(_PyFunction_FastCallKeywords+0x482)[0x5d94f2]
python3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]
python3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]
python3(_PyFunction_FastCallKeywords+0x482)[0x5d94f2]
python3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]
python3(_PyFunction_FastCallKeywords+0x18c)[0x5d91fc]
python3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]
python3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]
python3(PyEval_EvalCode+0x23)[0x54e0a3]
python3[0x630ce2]
python3(PyRun_FileExFlags+0x97)[0x630d97]
python3(PyRun_SimpleFileExFlags+0x17f)[0x6319ff]
python3[0x65432e]
python3(_Py_UnixMain+0x2e)[0x65468e]
/lib/x86_64-linux-gnu/libc.so.6(__libc_start_main+0xeb)[0x7f4e62f7a09b]
python3(_start+0x2a)[0x5e0e8a]
------------------------------------------------------------------------
Attaching gdb to process id 1024859.
Cannot find gdb installed
GDB is not installed.
Install gdb for enhanced tracebacks.
------------------------------------------------------------------------
Unhandled SIGSEGV: A segmentation fault occurred.
This probably occurred because a *compiled* module has a bug
in it and is not properly wrapped with sig_on(), sig_off().
Python will now terminate.
------------------------------------------------------------------------
Segmentation fault
```



> {{{
> sage: for f in C.face_iter():
> ....:     print(f)
> }}}


```
sage: Asso = polytopes.associahedron(['A',3])
sage: C = Asso.combinatorial_polyhedron()
sage: for f in C.face_iter():
....:     print(f)
....: 
------------------------------------------------------------------------
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0x947b)[0x7f31646b547b]
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0xf2d8)[0x7f31646bb2d8]
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0xfff0)[0x7f31646bbff0]
/lib/x86_64-linux-gnu/libpthread.so.0(+0x12730)[0x7f31676a3730]
/lib/x86_64-linux-gnu/libc.so.6(+0x15cb0d)[0x7f3167242b0d]
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/combinatorial_face.cpython-37m-x86_64-linux-gnu.so(+0x1305a)[0x7f3108d8b05a]
python3[0x599551]
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.cpython-37m-x86_64-linux-gnu.so(+0xc9ac)[0x7f3108d529ac]
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.cpython-37m-x86_64-linux-gnu.so(+0x15948)[0x7f3108d5b948]
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.cpython-37m-x86_64-linux-gnu.so(+0x1a2ef)[0x7f3108d602ef]
python3(_PyEval_EvalFrameDefault+0x8cd)[0x54e97d]
python3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]
python3[0x558f25]
python3(_PyMethodDef_RawFastCallKeywords+0x1b3)[0x5d8833]
python3(_PyEval_EvalFrameDefault+0x42c3)[0x552373]
python3[0x4d37a6]
python3(_PyEval_EvalFrameDefault+0x1a75)[0x54fb25]
python3[0x4d37a6]
python3(_PyEval_EvalFrameDefault+0x1a75)[0x54fb25]
python3[0x4d37a6]
python3(_PyMethodDescr_FastCallKeywords+0x151)[0x4d76a1]
python3(_PyEval_EvalFrameDefault+0x45f8)[0x5526a8]
python3(_PyFunction_FastCallKeywords+0x18c)[0x5d91fc]
python3(_PyEval_EvalFrameDefault+0x4fc)[0x54e5ac]
python3(_PyFunction_FastCallKeywords+0x18c)[0x5d91fc]
python3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]
python3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]
python3(_PyFunction_FastCallKeywords+0x482)[0x5d94f2]
python3[0x54b1f0]
python3(_PyEval_EvalFrameDefault+0x13ae)[0x54f45e]
python3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]
python3(_PyFunction_FastCallKeywords+0x482)[0x5d94f2]
python3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]
python3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]
python3(_PyFunction_FastCallKeywords+0x482)[0x5d94f2]
python3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]
python3(_PyFunction_FastCallKeywords+0x18c)[0x5d91fc]
python3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]
python3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]
python3(PyEval_EvalCode+0x23)[0x54e0a3]
python3[0x630ce2]
python3(PyRun_FileExFlags+0x97)[0x630d97]
python3(PyRun_SimpleFileExFlags+0x17f)[0x6319ff]
python3[0x65432e]
python3(_Py_UnixMain+0x2e)[0x65468e]
/lib/x86_64-linux-gnu/libc.so.6(__libc_start_main+0xeb)[0x7f316710a09b]
python3(_start+0x2a)[0x5e0e8a]
------------------------------------------------------------------------
Attaching gdb to process id 1025024.
Cannot find gdb installed
GDB is not installed.
Install gdb for enhanced tracebacks.
------------------------------------------------------------------------
Unhandled SIGSEGV: A segmentation fault occurred.
This probably occurred because a *compiled* module has a bug
in it and is not properly wrapped with sig_on(), sig_off().
Python will now terminate.
------------------------------------------------------------------------
Segmentation fault
```



> Same for `C.face_iter(dual=True)`,


```
sage: Asso = polytopes.associahedron(['A',3])
sage: C = Asso.combinatorial_polyhedron()
sage: for f in C.face_iter(dual=True):
....:     print(f)
....: 
------------------------------------------------------------------------
Segmentation fault
```


> `C.face_iter(0)`,


```
sage: Asso = polytopes.associahedron(['A',3])
sage: C = Asso.combinatorial_polyhedron()
sage: for f in C.face_iter(0):
....:     print(f)
....: 
A 0-dimensional face of a 3-dimensional combinatorial polyhedron
A 0-dimensional face of a 3-dimensional combinatorial polyhedron
A 0-dimensional face of a 3-dimensional combinatorial polyhedron
A 0-dimensional face of a 3-dimensional combinatorial polyhedron
A 0-dimensional face of a 3-dimensional combinatorial polyhedron
A 0-dimensional face of a 3-dimensional combinatorial polyhedron
A 0-dimensional face of a 3-dimensional combinatorial polyhedron
A 0-dimensional face of a 3-dimensional combinatorial polyhedron
A 0-dimensional face of a 3-dimensional combinatorial polyhedron
A 0-dimensional face of a 3-dimensional combinatorial polyhedron
A 0-dimensional face of a 3-dimensional combinatorial polyhedron
A 0-dimensional face of a 3-dimensional combinatorial polyhedron
A 0-dimensional face of a 3-dimensional combinatorial polyhedron
A 0-dimensional face of a 3-dimensional combinatorial polyhedron
```


> `C.face_iter(0, dual=True)`.


```
sage: for f in C.face_iter(0, dual=True):
....:     print(f)
....: 
------------------------------------------------------------------------
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0x947b)[0x7f6886f5547b]
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0xf2d8)[0x7f6886f5b2d8]
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0xfff0)[0x7f6886f5bff0]
/lib/x86_64-linux-gnu/libpthread.so.0(+0x12730)[0x7f688a983730]
/lib/x86_64-linux-gnu/libc.so.6(+0x15cb0d)[0x7f688a522b0d]
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/combinatorial_face.cpython-37m-x86_64-linux-gnu.so(+0x1305a)[0x7f682c06a05a]
python3[0x599551]
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.cpython-37m-x86_64-linux-gnu.so(+0xc9ac)[0x7f682c0319ac]
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.cpython-37m-x86_64-linux-gnu.so(+0x15948)[0x7f682c03a948]
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.cpython-37m-x86_64-linux-gnu.so(+0x1a2ef)[0x7f682c03f2ef]
python3(_PyEval_EvalFrameDefault+0x8cd)[0x54e97d]
python3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]
python3[0x558f25]
python3(_PyMethodDef_RawFastCallKeywords+0x1b3)[0x5d8833]
python3(_PyEval_EvalFrameDefault+0x42c3)[0x552373]
python3[0x4d37a6]
python3(_PyEval_EvalFrameDefault+0x1a75)[0x54fb25]
python3[0x4d37a6]
python3(_PyEval_EvalFrameDefault+0x1a75)[0x54fb25]
python3[0x4d37a6]
python3(_PyMethodDescr_FastCallKeywords+0x151)[0x4d76a1]
python3(_PyEval_EvalFrameDefault+0x45f8)[0x5526a8]
python3(_PyFunction_FastCallKeywords+0x18c)[0x5d91fc]
python3(_PyEval_EvalFrameDefault+0x4fc)[0x54e5ac]
python3(_PyFunction_FastCallKeywords+0x18c)[0x5d91fc]
python3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]
python3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]
python3(_PyFunction_FastCallKeywords+0x482)[0x5d94f2]
python3[0x54b1f0]
python3(_PyEval_EvalFrameDefault+0x13ae)[0x54f45e]
python3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]
python3(_PyFunction_FastCallKeywords+0x482)[0x5d94f2]
python3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]
python3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]
python3(_PyFunction_FastCallKeywords+0x482)[0x5d94f2]
python3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]
python3(_PyFunction_FastCallKeywords+0x18c)[0x5d91fc]
python3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]
python3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]
python3(PyEval_EvalCode+0x23)[0x54e0a3]
python3[0x630ce2]
python3(PyRun_FileExFlags+0x97)[0x630d97]
python3(PyRun_SimpleFileExFlags+0x17f)[0x6319ff]
python3[0x65432e]
python3(_Py_UnixMain+0x2e)[0x65468e]
/lib/x86_64-linux-gnu/libc.so.6(__libc_start_main+0xeb)[0x7f688a3ea09b]
python3(_start+0x2a)[0x5e0e8a]
------------------------------------------------------------------------
Attaching gdb to process id 1025356.
Cannot find gdb installed
GDB is not installed.
Install gdb for enhanced tracebacks.
------------------------------------------------------------------------
Unhandled SIGSEGV: A segmentation fault occurred.
This probably occurred because a *compiled* module has a bug
in it and is not properly wrapped with sig_on(), sig_off().
Python will now terminate.
------------------------------------------------------------------------
Segmentation fault
```


> It should help a lot in catching that bug, seeing exactly when there is a segmentation fault.
> 
> Please do not recompile, as the bug might hide then. But I don't know.



---

archive/issue_comments_464243.json:
```json
{
    "body": "Thank you.\n\nThat is even worse than I thought, but on the upside this might make debugging easier.\n\nHow about:\n\n\n```\nsage: Asso = polytopes.associahedron(['A',3])\nsage: C = Asso.combinatorial_polyhedron()\nsage: C.face_iter()\nIterator over the proper faces of a 3-dimensional combinatorial polyhedron\n```\n\n\nIf this works:\n\n\n```\nsage: Asso = polytopes.associahedron(['A',3])\nsage: C = Asso.combinatorial_polyhedron()\nsage: it = C.face_iter()\nsage: cython('''\n....: from sage.geometry.polyhedron.combinatorial_polyhedron.face_iterator cimport FaceIterator\n....: def foo(FaceIterator it):\n....:     cdef int d = it.next_dimension()\n....:     while d < it.structure.dimension:\n....:         print(d)\n....:         print(it.n_atom_rep())\n....:         a = it.set_atom_rep()\n....:         print([it.structure.atom_rep[i] for i in range(a)])\n....:         b = it.set_coatom_rep()\n....:         print([it.structure.coatom_rep[i] for i in range(b)])\n....:         d = it.next_dimension()\n....: ''')\nsage: foo(it)\n```\n",
    "created_at": "2021-11-05T13:50:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32590#issuecomment-464243",
    "user": "https://github.com/kliem"
}
```

Thank you.

That is even worse than I thought, but on the upside this might make debugging easier.

How about:


```
sage: Asso = polytopes.associahedron(['A',3])
sage: C = Asso.combinatorial_polyhedron()
sage: C.face_iter()
Iterator over the proper faces of a 3-dimensional combinatorial polyhedron
```


If this works:


```
sage: Asso = polytopes.associahedron(['A',3])
sage: C = Asso.combinatorial_polyhedron()
sage: it = C.face_iter()
sage: cython('''
....: from sage.geometry.polyhedron.combinatorial_polyhedron.face_iterator cimport FaceIterator
....: def foo(FaceIterator it):
....:     cdef int d = it.next_dimension()
....:     while d < it.structure.dimension:
....:         print(d)
....:         print(it.n_atom_rep())
....:         a = it.set_atom_rep()
....:         print([it.structure.atom_rep[i] for i in range(a)])
....:         b = it.set_coatom_rep()
....:         print([it.structure.coatom_rep[i] for i in range(b)])
....:         d = it.next_dimension()
....: ''')
sage: foo(it)
```




---

archive/issue_comments_464244.json:
```json
{
    "body": "On both machines, i got: \n\n\n```\nsage: sage: Asso = polytopes.associahedron(['A',3])\n....: sage: C = Asso.combinatorial_polyhedron()\n....: sage: C.face_iter()\nIterator over the proper faces of a 3-dimensional combinatorial polyhedron\nsage: sage: Asso = polytopes.associahedron(['A',3])\n....: sage: C = Asso.combinatorial_polyhedron()\n....: sage: it = C.face_iter()\n....: sage: cython('''\n....: ....: from sage.geometry.polyhedron.combinatorial_polyhedron.face_iterator cimport FaceIterator\n....: ....: def foo(FaceIterator it):\n....: ....:     cdef int d = it.next_dimension()\n....: ....:     while d < it.structure.dimension:\n....: ....:         print(d)\n....: ....:         print(it.n_atom_rep())\n....: ....:         a = it.set_atom_rep()\n....: ....:         print([it.structure.atom_rep[i] for i in range(a)])\n....: ....:         b = it.set_coatom_rep()\n....: ....:         print([it.structure.coatom_rep[i] for i in range(b)])\n....: ....:         d = it.next_dimension()\n....: ....: ''')\n....: sage: foo(it)\n2\n5\n[0, 5, 8, 9, 13]\n[8]\n2\n4\n[6, 8, 9, 10]\n[7]\n2\n5\n[4, 6, 7, 10, 12]\n[6]\n2\n4\n[3, 4, 11, 12]\n[5]\n\n\n\n\n2\n5\n[9, 10, 11, 12, 13]\n[3]\n2\n5\n[2, 3, 5, 11, 13]\n[2]\n2\n4\n[0, 1, 2, 5]\n[1]\n2\n5\n[1, 2, 3, 4, 7]\n[0]\n1\n2\n[8, 9]\n[7, 8]\n1\n2\n[0, 8]\n[4, 8]\n1\n2\n[9, 13]\n[3, 8]\n1\n2\n[5, 13]\n[2, 8]\n1\n2\n[0, 5]\n[1, 8]\n0\n1\n[8]\n[4, 7, 8]\n0\n1\n[9]\n[3, 7, 8]\n0\n1\n[0]\n[1, 4, 8]\n0\n1\n[13]\n[2, 3, 8]\n0\n1\n[5]\n[1, 2, 8]\n1\n2\n[6, 10]\n[6, 7]\n1\n2\n[6, 8]\n[4, 7]\n1\n2\n[9, 10]\n[3, 7]\n0\n1\n[6]\n[4, 6, 7]\n0\n1\n[10]\n[3, 6, 7]\n1\n2\n[4, 12]\n[5, 6]\n1\n2\n[6, 7]\n[4, 6]\n1\n2\n[10, 12]\n[3, 6]\n1\n2\n[4, 7]\n[0, 6]\n0\n1\n[12]\n[3, 5, 6]\n0\n1\n[4]\n[0, 5, 6]\n0\n1\n[7]\n[0, 4, 6]\n1\n2\n[11, 12]\n[3, 5]\n1\n2\n[3, 11]\n[2, 5]\n1\n2\n[3, 4]\n[0, 5]\n0\n1\n[11]\n[2, 3, 5]\n0\n1\n[3]\n[0, 2, 5]\n1\n2\n[0, 1]\n[1, 4]\n1\n2\n[1, 7]\n[0, 4]\n0\n1\n[1]\n[0, 1, 4]\n1\n2\n[11, 13]\n[2, 3]\n1\n2\n[2, 5]\n[1, 2]\n1\n2\n[2, 3]\n[0, 2]\n0\n1\n[2]\n[0, 1, 2]\n1\n2\n[1, 2]\n[0, 1]\n```\n",
    "created_at": "2021-11-05T14:56:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32590#issuecomment-464244",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

On both machines, i got: 


```
sage: sage: Asso = polytopes.associahedron(['A',3])
....: sage: C = Asso.combinatorial_polyhedron()
....: sage: C.face_iter()
Iterator over the proper faces of a 3-dimensional combinatorial polyhedron
sage: sage: Asso = polytopes.associahedron(['A',3])
....: sage: C = Asso.combinatorial_polyhedron()
....: sage: it = C.face_iter()
....: sage: cython('''
....: ....: from sage.geometry.polyhedron.combinatorial_polyhedron.face_iterator cimport FaceIterator
....: ....: def foo(FaceIterator it):
....: ....:     cdef int d = it.next_dimension()
....: ....:     while d < it.structure.dimension:
....: ....:         print(d)
....: ....:         print(it.n_atom_rep())
....: ....:         a = it.set_atom_rep()
....: ....:         print([it.structure.atom_rep[i] for i in range(a)])
....: ....:         b = it.set_coatom_rep()
....: ....:         print([it.structure.coatom_rep[i] for i in range(b)])
....: ....:         d = it.next_dimension()
....: ....: ''')
....: sage: foo(it)
2
5
[0, 5, 8, 9, 13]
[8]
2
4
[6, 8, 9, 10]
[7]
2
5
[4, 6, 7, 10, 12]
[6]
2
4
[3, 4, 11, 12]
[5]




2
5
[9, 10, 11, 12, 13]
[3]
2
5
[2, 3, 5, 11, 13]
[2]
2
4
[0, 1, 2, 5]
[1]
2
5
[1, 2, 3, 4, 7]
[0]
1
2
[8, 9]
[7, 8]
1
2
[0, 8]
[4, 8]
1
2
[9, 13]
[3, 8]
1
2
[5, 13]
[2, 8]
1
2
[0, 5]
[1, 8]
0
1
[8]
[4, 7, 8]
0
1
[9]
[3, 7, 8]
0
1
[0]
[1, 4, 8]
0
1
[13]
[2, 3, 8]
0
1
[5]
[1, 2, 8]
1
2
[6, 10]
[6, 7]
1
2
[6, 8]
[4, 7]
1
2
[9, 10]
[3, 7]
0
1
[6]
[4, 6, 7]
0
1
[10]
[3, 6, 7]
1
2
[4, 12]
[5, 6]
1
2
[6, 7]
[4, 6]
1
2
[10, 12]
[3, 6]
1
2
[4, 7]
[0, 6]
0
1
[12]
[3, 5, 6]
0
1
[4]
[0, 5, 6]
0
1
[7]
[0, 4, 6]
1
2
[11, 12]
[3, 5]
1
2
[3, 11]
[2, 5]
1
2
[3, 4]
[0, 5]
0
1
[11]
[2, 3, 5]
0
1
[3]
[0, 2, 5]
1
2
[0, 1]
[1, 4]
1
2
[1, 7]
[0, 4]
0
1
[1]
[0, 1, 4]
1
2
[11, 13]
[2, 3]
1
2
[2, 5]
[1, 2]
1
2
[2, 3]
[0, 2]
0
1
[2]
[0, 1, 2]
1
2
[1, 2]
[0, 1]
```




---

archive/issue_comments_464245.json:
```json
{
    "body": "Thank you. Apparently the face iterator works and something with `CombinatorialFace` is failing.\n\nCan you please try the following:\n\n\n```\nsage: cython('''\n....: from sage.geometry.polyhedron.combinatorial_polyhedron.face_list_data_structure cimport *\n....: \n....: cdef class foo:\n....:     cdef face_t face\n....:     cdef MemoryAllocator mem\n....:     \n....:     def __cinit__(self):\n....:         self.mem = MemoryAllocator()\n....:         face_init(self.face, 9, 14, self.mem)\n....:         \n....:     def test(self):\n....:         cdef face_t new_face\n....:         cdef mem = MemoryAllocator()\n....:         print('a')\n....:         face_init(new_face, 9, 14, mem)\n....:         print('b')\n....:         face_copy(self.face, new_face)\n....:         \n....:     def test2(self):\n....:         cdef face_list_t faces\n....:         cdef mem = MemoryAllocator()\n....:         print('a')\n....:         face_list_init(faces, 9, 9, 14, mem)\n....:         cdef face_t new_face\n....:         for i in range(9):\n....:             print(i)\n....:             new_face[0] = faces.faces[i][0]\n....:             print(i, 'b')\n....:             face_copy(self.face, new_face)\n....: ''')\nsage: a = foo()\nsage: a.test()\nsage: a.test2()\n```\n",
    "created_at": "2021-11-05T15:46:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32590#issuecomment-464245",
    "user": "https://github.com/kliem"
}
```

Thank you. Apparently the face iterator works and something with `CombinatorialFace` is failing.

Can you please try the following:


```
sage: cython('''
....: from sage.geometry.polyhedron.combinatorial_polyhedron.face_list_data_structure cimport *
....: 
....: cdef class foo:
....:     cdef face_t face
....:     cdef MemoryAllocator mem
....:     
....:     def __cinit__(self):
....:         self.mem = MemoryAllocator()
....:         face_init(self.face, 9, 14, self.mem)
....:         
....:     def test(self):
....:         cdef face_t new_face
....:         cdef mem = MemoryAllocator()
....:         print('a')
....:         face_init(new_face, 9, 14, mem)
....:         print('b')
....:         face_copy(self.face, new_face)
....:         
....:     def test2(self):
....:         cdef face_list_t faces
....:         cdef mem = MemoryAllocator()
....:         print('a')
....:         face_list_init(faces, 9, 9, 14, mem)
....:         cdef face_t new_face
....:         for i in range(9):
....:             print(i)
....:             new_face[0] = faces.faces[i][0]
....:             print(i, 'b')
....:             face_copy(self.face, new_face)
....: ''')
sage: a = foo()
sage: a.test()
sage: a.test2()
```




---

archive/issue_comments_464246.json:
```json
{
    "body": "I got : \n\n\n```\nsage: sage: cython('''\n....: ....: from sage.geometry.polyhedron.combinatorial_polyhedron.face_list_data_structure cimport *\n....: ....: \n....: ....: cdef class foo:\n....: ....:     cdef face_t face\n....: ....:     cdef MemoryAllocator mem\n....: ....:     \n....: ....:     def __cinit__(self):\n....: ....:         self.mem = MemoryAllocator()\n....: ....:         face_init(self.face, 9, 14, self.mem)\n....: ....:         \n....: ....:     def test(self):\n....: ....:         cdef face_t new_face\n....: ....:         cdef mem = MemoryAllocator()\n....: ....:         print('a')\n....: ....:         face_init(new_face, 9, 14, mem)\n....: ....:         print('b')\n....: ....:         face_copy(self.face, new_face)\n....: ....:         \n....: ....:     def test2(self):\n....: ....:         cdef face_list_t faces\n....: ....:         cdef mem = MemoryAllocator()\n....: ....:         print('a')\n....: ....:         face_list_init(faces, 9, 9, 14, mem)\n....: ....:         cdef face_t new_face\n....: ....:         for i in range(9):\n....: ....:             print(i)\n....: ....:             new_face[0] = faces.faces[i][0]\n....: ....:             print(i, 'b')\n....: ....:             face_copy(self.face, new_face)\n....: ....: ''')\n....: sage: a = foo()\n....: sage: a.test()\n....: sage: a.test2()\n....: \na\nb\na\n0\n0 b\n1\n1 b\n2\n2 b\n3\n3 b\n4\n4 b\n5\n5 b\n6\n6 b\n7\n7 b\n8\n8 b\n```\n",
    "created_at": "2021-11-05T16:55:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32590#issuecomment-464246",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

I got : 


```
sage: sage: cython('''
....: ....: from sage.geometry.polyhedron.combinatorial_polyhedron.face_list_data_structure cimport *
....: ....: 
....: ....: cdef class foo:
....: ....:     cdef face_t face
....: ....:     cdef MemoryAllocator mem
....: ....:     
....: ....:     def __cinit__(self):
....: ....:         self.mem = MemoryAllocator()
....: ....:         face_init(self.face, 9, 14, self.mem)
....: ....:         
....: ....:     def test(self):
....: ....:         cdef face_t new_face
....: ....:         cdef mem = MemoryAllocator()
....: ....:         print('a')
....: ....:         face_init(new_face, 9, 14, mem)
....: ....:         print('b')
....: ....:         face_copy(self.face, new_face)
....: ....:         
....: ....:     def test2(self):
....: ....:         cdef face_list_t faces
....: ....:         cdef mem = MemoryAllocator()
....: ....:         print('a')
....: ....:         face_list_init(faces, 9, 9, 14, mem)
....: ....:         cdef face_t new_face
....: ....:         for i in range(9):
....: ....:             print(i)
....: ....:             new_face[0] = faces.faces[i][0]
....: ....:             print(i, 'b')
....: ....:             face_copy(self.face, new_face)
....: ....: ''')
....: sage: a = foo()
....: sage: a.test()
....: sage: a.test2()
....: 
a
b
a
0
0 b
1
1 b
2
2 b
3
3 b
4
4 b
5
5 b
6
6 b
7
7 b
8
8 b
```




---

archive/issue_comments_464247.json:
```json
{
    "body": "Ok, thanks. Sorry this is taking so long.\n\nThe only thing that I can think of right now, is that one needs to be careful with `__cinit__` and `__init__`.\n\nCan you please try:\n\n\n```\nsage: cython('''\n....: from sage.geometry.polyhedron.combinatorial_polyhedron.face_list_data_structure cimport *\n....: \n....: cdef class foo:\n....:     cdef face_t face\n....:     cdef MemoryAllocator mem\n....:     \n....:     def __init__(self):\n....:         self.mem = MemoryAllocator()\n....:         face_init(self.face, 9, 14, self.mem)\n....:         \n....:     def test(self):\n....:         cdef face_t new_face\n....:         cdef mem = MemoryAllocator()\n....:         print('a')\n....:         face_init(new_face, 9, 14, mem)\n....:         print('b')\n....:         face_copy(self.face, new_face)\n....:         \n....:     def test2(self):\n....:         cdef face_list_t faces\n....:         cdef mem = MemoryAllocator()\n....:         print('a')\n....:         face_list_init(faces, 9, 9, 14, mem)\n....:         cdef face_t new_face\n....:         for i in range(9):\n....:             print(i)\n....:             new_face[0] = faces.faces[i][0]\n....:             print(i, 'b')\n....:             face_copy(self.face, new_face)\n....: ''')\nsage: a = foo()\nsage: a.test()\nsage: a.test2()\n```\n\n\nAlso just to confirm:\n\n\n```\nsage: sage: Asso = polytopes.associahedron(['A',3])\nsage: it = Asso.face_generator()\nsage: f = next(it)\nsage: f\nA 3-dimensional face of a Polyhedron in QQ^3 defined as the convex hull of 14 vertices\nsage: f = next(it)\nsage: f\nA -1-dimensional face of a Polyhedron in QQ^3\nsage: f = next(it)\nsage: f\nA 2-dimensional face of a Polyhedron in QQ^3 defined as the convex hull of 5 vertices\n```\n\n\nAnd:\n\n\n```\nsage: Asso = polytopes.associahedron(['A',3])\nsage: C = Asso.combinatorial_polyhedron()\nsage: it = C.face_iter()\nsage: f = next(it)\nsage: f\nA 2-dimensional face of a 3-dimensional combinatorial polyhedron\nsage: f = next(it)\nsage: f\nA 2-dimensional face of a 3-dimensional combinatorial polyhedron\n```\n\n\n\n```\nsage: Asso = polytopes.associahedron(['A',3])\nsage: C = Asso.combinatorial_polyhedron()\nsage: it = C.face_iter()\nsage: cython('''\n....: from sage.geometry.polyhedron.combinatorial_polyhedron.face_iterator cimport *\n....: def foo(FaceIterator_base it):\n....:     it.next_dimension()\n....:     print('a')\n....:     cdef CombinatorialFace face = CombinatorialFace.__new__(CombinatorialFace)\n....:     print('b')\n....:     face.__init__(it)\n....:     print('c')\n....:     return face\n....: ''')\nsage: foo(it)\na\nb\nc\nA 2-dimensional face of a 3-dimensional combinatorial polyhedron\n```\n\n\n\n\nThere is definitely a problem with init and cinit as the following shoud not lead to a segmentationfault (but does and also for me):\n\n\n```\nsage: from sage.geometry.polyhedron.combinatorial_polyhedron.combinatorial_face import CombinatorialFace\nsage: face = CombinatorialFace.__new__(CombinatorialFace)\nsage: face.ambient_H_indices()\n```\n\n\nI don't know if this is the issue. I can try to fix this `__init__` and `__cinit__` things and see if this solves something.",
    "created_at": "2021-11-05T18:04:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32590#issuecomment-464247",
    "user": "https://github.com/kliem"
}
```

Ok, thanks. Sorry this is taking so long.

The only thing that I can think of right now, is that one needs to be careful with `__cinit__` and `__init__`.

Can you please try:


```
sage: cython('''
....: from sage.geometry.polyhedron.combinatorial_polyhedron.face_list_data_structure cimport *
....: 
....: cdef class foo:
....:     cdef face_t face
....:     cdef MemoryAllocator mem
....:     
....:     def __init__(self):
....:         self.mem = MemoryAllocator()
....:         face_init(self.face, 9, 14, self.mem)
....:         
....:     def test(self):
....:         cdef face_t new_face
....:         cdef mem = MemoryAllocator()
....:         print('a')
....:         face_init(new_face, 9, 14, mem)
....:         print('b')
....:         face_copy(self.face, new_face)
....:         
....:     def test2(self):
....:         cdef face_list_t faces
....:         cdef mem = MemoryAllocator()
....:         print('a')
....:         face_list_init(faces, 9, 9, 14, mem)
....:         cdef face_t new_face
....:         for i in range(9):
....:             print(i)
....:             new_face[0] = faces.faces[i][0]
....:             print(i, 'b')
....:             face_copy(self.face, new_face)
....: ''')
sage: a = foo()
sage: a.test()
sage: a.test2()
```


Also just to confirm:


```
sage: sage: Asso = polytopes.associahedron(['A',3])
sage: it = Asso.face_generator()
sage: f = next(it)
sage: f
A 3-dimensional face of a Polyhedron in QQ^3 defined as the convex hull of 14 vertices
sage: f = next(it)
sage: f
A -1-dimensional face of a Polyhedron in QQ^3
sage: f = next(it)
sage: f
A 2-dimensional face of a Polyhedron in QQ^3 defined as the convex hull of 5 vertices
```


And:


```
sage: Asso = polytopes.associahedron(['A',3])
sage: C = Asso.combinatorial_polyhedron()
sage: it = C.face_iter()
sage: f = next(it)
sage: f
A 2-dimensional face of a 3-dimensional combinatorial polyhedron
sage: f = next(it)
sage: f
A 2-dimensional face of a 3-dimensional combinatorial polyhedron
```



```
sage: Asso = polytopes.associahedron(['A',3])
sage: C = Asso.combinatorial_polyhedron()
sage: it = C.face_iter()
sage: cython('''
....: from sage.geometry.polyhedron.combinatorial_polyhedron.face_iterator cimport *
....: def foo(FaceIterator_base it):
....:     it.next_dimension()
....:     print('a')
....:     cdef CombinatorialFace face = CombinatorialFace.__new__(CombinatorialFace)
....:     print('b')
....:     face.__init__(it)
....:     print('c')
....:     return face
....: ''')
sage: foo(it)
a
b
c
A 2-dimensional face of a 3-dimensional combinatorial polyhedron
```




There is definitely a problem with init and cinit as the following shoud not lead to a segmentationfault (but does and also for me):


```
sage: from sage.geometry.polyhedron.combinatorial_polyhedron.combinatorial_face import CombinatorialFace
sage: face = CombinatorialFace.__new__(CombinatorialFace)
sage: face.ambient_H_indices()
```


I don't know if this is the issue. I can try to fix this `__init__` and `__cinit__` things and see if this solves something.



---

archive/issue_comments_464248.json:
```json
{
    "body": "Here is a raw log, the problem are on `tmonteil-lxc3`, not `tmonteil-lxc1`, sorry for the confusion:\n\n\n```\nsagemath@tmonteil-lxc3:~/sage-9.1$ ./sage \n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 SageMath version 9.5.beta5, Release Date: 2021-10-28               \u2502\n\u2502 Using Python 3.7.3. Type \"help()\" for help.                        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250f\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n\u2503 Warning: this is a prerelease version, and it may be unstable.     \u2503\n\u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251b\nsage: sage: cython('''\n....: ....: from sage.geometry.polyhedron.combinatorial_polyhedron.face_list_data_structure cimport *\n....: ....: \n....: ....: cdef class foo:\n....: ....:     cdef face_t face\n....: ....:     cdef MemoryAllocator mem\n....: ....:     \n....: ....:     def __init__(self):\n....: ....:         self.mem = MemoryAllocator()\n....: ....:         face_init(self.face, 9, 14, self.mem)\n....: ....:         \n....: ....:     def test(self):\n....: ....:         cdef face_t new_face\n....: ....:         cdef mem = MemoryAllocator()\n....: ....:         print('a')\n....: ....:         face_init(new_face, 9, 14, mem)\n....: ....:         print('b')\n....: ....:         face_copy(self.face, new_face)\n....: ....:         \n....: ....:     def test2(self):\n....: ....:         cdef face_list_t faces\n....: ....:         cdef mem = MemoryAllocator()\n....: ....:         print('a')\n....: ....:         face_list_init(faces, 9, 9, 14, mem)\n....: ....:         cdef face_t new_face\n....: ....:         for i in range(9):\n....: ....:             print(i)\n....: ....:             new_face[0] = faces.faces[i][0]\n....: ....:             print(i, 'b')\n....: ....:             face_copy(self.face, new_face)\n....: ....: ''')\n....: sage: a = foo()\n....: sage: a.test()\n....: sage: a.test2()\na\nb\na\n0\n0 b\n1\n1 b\n2\n2 b\n3\n3 b\n4\n4 b\n5\n5 b\n6\n6 b\n7\n7 b\n8\n8 b\nsage: sage: sage: Asso = polytopes.associahedron(['A',3])\n....: sage: it = Asso.face_generator()\n....: sage: f = next(it)\n....: sage: f\nA 3-dimensional face of a Polyhedron in QQ^3 defined as the convex hull of 14 vertices\nsage: sage: f = next(it)\n....: sage: f\nA -1-dimensional face of a Polyhedron in QQ^3\nsage: sage: f = next(it)\n....: sage: f\n------------------------------------------------------------------------\nSegmentation fault\nsagemath@tmonteil-lxc3:~/sage-9.1$ ./sage \n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 SageMath version 9.5.beta5, Release Date: 2021-10-28               \u2502\n\u2502 Using Python 3.7.3. Type \"help()\" for help.                        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250f\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n\u2503 Warning: this is a prerelease version, and it may be unstable.     \u2503\n\u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251b\nsage: sage: Asso = polytopes.associahedron(['A',3])\n....: sage: C = Asso.combinatorial_polyhedron()\n....: sage: it = C.face_iter()\n....: sage: f = next(it)\n....: sage: f\n------------------------------------------------------------------------\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0x947b)[0x7fc34e97b47b]\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0xf2d8)[0x7fc34e9812d8]\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0xfff0)[0x7fc34e981ff0]\n/lib/x86_64-linux-gnu/libpthread.so.0(+0x12730)[0x7fc3523a9730]\n/lib/x86_64-linux-gnu/libc.so.6(+0x15cb0d)[0x7fc351f48b0d]\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/combinatorial_face.cpython-37m-x86_64-linux-gnu.so(+0x1305a)[0x7fc2f3a8605a]\npython3[0x599551]\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.cpython-37m-x86_64-linux-gnu.so(+0xc9ac)[0x7fc2f3a4d9ac]\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.cpython-37m-x86_64-linux-gnu.so(+0x15948)[0x7fc2f3a56948]\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.cpython-37m-x86_64-linux-gnu.so(+0x1a2ef)[0x7fc2f3a5b2ef]\npython3[0x556216]\npython3(_PyMethodDef_RawFastCallKeywords+0x1b3)[0x5d8833]\npython3(_PyEval_EvalFrameDefault+0x42c3)[0x552373]\npython3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]\npython3[0x558f25]\npython3(_PyMethodDef_RawFastCallKeywords+0x1b3)[0x5d8833]\npython3(_PyEval_EvalFrameDefault+0x42c3)[0x552373]\npython3[0x4d37a6]\npython3(_PyEval_EvalFrameDefault+0x1a75)[0x54fb25]\npython3[0x4d37a6]\npython3(_PyEval_EvalFrameDefault+0x1a75)[0x54fb25]\npython3[0x4d37a6]\npython3(_PyMethodDescr_FastCallKeywords+0x151)[0x4d76a1]\npython3(_PyEval_EvalFrameDefault+0x45f8)[0x5526a8]\npython3(_PyFunction_FastCallKeywords+0x18c)[0x5d91fc]\npython3(_PyEval_EvalFrameDefault+0x4fc)[0x54e5ac]\npython3(_PyFunction_FastCallKeywords+0x18c)[0x5d91fc]\npython3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]\npython3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]\npython3(_PyFunction_FastCallKeywords+0x482)[0x5d94f2]\npython3[0x54b1f0]\npython3(_PyEval_EvalFrameDefault+0x13ae)[0x54f45e]\npython3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]\npython3(_PyFunction_FastCallKeywords+0x482)[0x5d94f2]\npython3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]\npython3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]\npython3(_PyFunction_FastCallKeywords+0x482)[0x5d94f2]\npython3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]\npython3(_PyFunction_FastCallKeywords+0x18c)[0x5d91fc]\npython3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]\npython3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]\npython3(PyEval_EvalCode+0x23)[0x54e0a3]\npython3[0x630ce2]\npython3(PyRun_FileExFlags+0x97)[0x630d97]\npython3(PyRun_SimpleFileExFlags+0x17f)[0x6319ff]\npython3[0x65432e]\npython3(_Py_UnixMain+0x2e)[0x65468e]\n[1 0 1 0 0 0 0 1 0 0 0 0 0 0]\n[0 1 0 1 0 1 0 0 0 0 0 0 0 0]\n[0 0 1 0 1 0 0 0 0 0 0 1 0 0]\n/lib/x86_64-linux-gnu/libc.so.6(__libc_start_main+0xeb)[0x7fc351e1009b]\npython3(_start+0x2a)[0x5e0e8a]\n------------------------------------------------------------------------\nAttaching gdb to process id 1027349.\nCannot find gdb installed\nGDB is not installed.\nInstall gdb for enhanced tracebacks.\n------------------------------------------------------------------------\nUnhandled SIGSEGV: A segmentation fault occurred.\nThis probably occurred because a *compiled* module has a bug\nin it and is not properly wrapped with sig_on(), sig_off().\nPython will now terminate.\n------------------------------------------------------------------------\nSegmentation fault\nsagemath@tmonteil-lxc3:~/sage-9.1$ ./sage \n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 SageMath version 9.5.beta5, Release Date: 2021-10-28               \u2502\n\u2502 Using Python 3.7.3. Type \"help()\" for help.                        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250f\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n\u2503 Warning: this is a prerelease version, and it may be unstable.     \u2503\n\u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251b\nsage: sage: Asso = polytopes.associahedron(['A',3])\n....: sage: C = Asso.combinatorial_polyhedron()\n....: sage: it = C.face_iter()\n....: sage: cython('''\n....: ....: from sage.geometry.polyhedron.combinatorial_polyhedron.face_iterator cimport *\n....: ....: def foo(FaceIterator_base it):\n....: ....:     it.next_dimension()\n....: ....:     print('a')\n....: ....:     cdef CombinatorialFace face = CombinatorialFace.__new__(CombinatorialFace)\n....: ....:     print('b')\n....: ....:     face.__init__(it)\n....: ....:     print('c')\n....: ....:     return face\n....: ....: ''')\n....: sage: foo(it)\na\nb\n------------------------------------------------------------------------\nSegmentation fault\nsagemath@tmonteil-lxc3:~/sage-9.1$ ./sage \n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 SageMath version 9.5.beta5, Release Date: 2021-10-28               \u2502\n\u2502 Using Python 3.7.3. Type \"help()\" for help.                        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250f\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n\u2503 Warning: this is a prerelease version, and it may be unstable.     \u2503\n\u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251b\nsage: sage: from sage.geometry.polyhedron.combinatorial_polyhedron.combinatorial_face import CombinatorialFace\n....: sage: face = CombinatorialFace.__new__(CombinatorialFace)\n....: sage: face.ambient_H_indices()\n------------------------------------------------------------------------\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0x947b)[0x7f644a84747b]\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0xf2d8)[0x7f644a84d2d8]\n/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0xfff0)[0x7f644a84dff0]\n/lib/x86_64-linux-gnu/libpthread.so.0(+0x12730)[0x7f644e275730]\n------------------------------------------------------------------------\nAttaching gdb to process id 1027750.\nCannot find gdb installed\nGDB is not installed.\nInstall gdb for enhanced tracebacks.\n------------------------------------------------------------------------\nUnhandled SIGSEGV: A segmentation fault occurred.\nThis probably occurred because a *compiled* module has a bug\nin it and is not properly wrapped with sig_on(), sig_off().\nPython will now terminate.\n------------------------------------------------------------------------\nSegmentation fault\n\n```\n",
    "created_at": "2021-11-05T19:16:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32590#issuecomment-464248",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Here is a raw log, the problem are on `tmonteil-lxc3`, not `tmonteil-lxc1`, sorry for the confusion:


```
sagemath@tmonteil-lxc3:~/sage-9.1$ ./sage 

 SageMath version 9.5.beta5, Release Date: 2021-10-28               
 Using Python 3.7.3. Type "help()" for help.                        


 Warning: this is a prerelease version, and it may be unstable.     

sage: sage: cython('''
....: ....: from sage.geometry.polyhedron.combinatorial_polyhedron.face_list_data_structure cimport *
....: ....: 
....: ....: cdef class foo:
....: ....:     cdef face_t face
....: ....:     cdef MemoryAllocator mem
....: ....:     
....: ....:     def __init__(self):
....: ....:         self.mem = MemoryAllocator()
....: ....:         face_init(self.face, 9, 14, self.mem)
....: ....:         
....: ....:     def test(self):
....: ....:         cdef face_t new_face
....: ....:         cdef mem = MemoryAllocator()
....: ....:         print('a')
....: ....:         face_init(new_face, 9, 14, mem)
....: ....:         print('b')
....: ....:         face_copy(self.face, new_face)
....: ....:         
....: ....:     def test2(self):
....: ....:         cdef face_list_t faces
....: ....:         cdef mem = MemoryAllocator()
....: ....:         print('a')
....: ....:         face_list_init(faces, 9, 9, 14, mem)
....: ....:         cdef face_t new_face
....: ....:         for i in range(9):
....: ....:             print(i)
....: ....:             new_face[0] = faces.faces[i][0]
....: ....:             print(i, 'b')
....: ....:             face_copy(self.face, new_face)
....: ....: ''')
....: sage: a = foo()
....: sage: a.test()
....: sage: a.test2()
a
b
a
0
0 b
1
1 b
2
2 b
3
3 b
4
4 b
5
5 b
6
6 b
7
7 b
8
8 b
sage: sage: sage: Asso = polytopes.associahedron(['A',3])
....: sage: it = Asso.face_generator()
....: sage: f = next(it)
....: sage: f
A 3-dimensional face of a Polyhedron in QQ^3 defined as the convex hull of 14 vertices
sage: sage: f = next(it)
....: sage: f
A -1-dimensional face of a Polyhedron in QQ^3
sage: sage: f = next(it)
....: sage: f
------------------------------------------------------------------------
Segmentation fault
sagemath@tmonteil-lxc3:~/sage-9.1$ ./sage 

 SageMath version 9.5.beta5, Release Date: 2021-10-28               
 Using Python 3.7.3. Type "help()" for help.                        


 Warning: this is a prerelease version, and it may be unstable.     

sage: sage: Asso = polytopes.associahedron(['A',3])
....: sage: C = Asso.combinatorial_polyhedron()
....: sage: it = C.face_iter()
....: sage: f = next(it)
....: sage: f
------------------------------------------------------------------------
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0x947b)[0x7fc34e97b47b]
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0xf2d8)[0x7fc34e9812d8]
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0xfff0)[0x7fc34e981ff0]
/lib/x86_64-linux-gnu/libpthread.so.0(+0x12730)[0x7fc3523a9730]
/lib/x86_64-linux-gnu/libc.so.6(+0x15cb0d)[0x7fc351f48b0d]
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/combinatorial_face.cpython-37m-x86_64-linux-gnu.so(+0x1305a)[0x7fc2f3a8605a]
python3[0x599551]
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.cpython-37m-x86_64-linux-gnu.so(+0xc9ac)[0x7fc2f3a4d9ac]
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.cpython-37m-x86_64-linux-gnu.so(+0x15948)[0x7fc2f3a56948]
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.cpython-37m-x86_64-linux-gnu.so(+0x1a2ef)[0x7fc2f3a5b2ef]
python3[0x556216]
python3(_PyMethodDef_RawFastCallKeywords+0x1b3)[0x5d8833]
python3(_PyEval_EvalFrameDefault+0x42c3)[0x552373]
python3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]
python3[0x558f25]
python3(_PyMethodDef_RawFastCallKeywords+0x1b3)[0x5d8833]
python3(_PyEval_EvalFrameDefault+0x42c3)[0x552373]
python3[0x4d37a6]
python3(_PyEval_EvalFrameDefault+0x1a75)[0x54fb25]
python3[0x4d37a6]
python3(_PyEval_EvalFrameDefault+0x1a75)[0x54fb25]
python3[0x4d37a6]
python3(_PyMethodDescr_FastCallKeywords+0x151)[0x4d76a1]
python3(_PyEval_EvalFrameDefault+0x45f8)[0x5526a8]
python3(_PyFunction_FastCallKeywords+0x18c)[0x5d91fc]
python3(_PyEval_EvalFrameDefault+0x4fc)[0x54e5ac]
python3(_PyFunction_FastCallKeywords+0x18c)[0x5d91fc]
python3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]
python3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]
python3(_PyFunction_FastCallKeywords+0x482)[0x5d94f2]
python3[0x54b1f0]
python3(_PyEval_EvalFrameDefault+0x13ae)[0x54f45e]
python3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]
python3(_PyFunction_FastCallKeywords+0x482)[0x5d94f2]
python3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]
python3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]
python3(_PyFunction_FastCallKeywords+0x482)[0x5d94f2]
python3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]
python3(_PyFunction_FastCallKeywords+0x18c)[0x5d91fc]
python3(_PyEval_EvalFrameDefault+0x730)[0x54e7e0]
python3(_PyEval_EvalCodeWithName+0x252)[0x54bcc2]
python3(PyEval_EvalCode+0x23)[0x54e0a3]
python3[0x630ce2]
python3(PyRun_FileExFlags+0x97)[0x630d97]
python3(PyRun_SimpleFileExFlags+0x17f)[0x6319ff]
python3[0x65432e]
python3(_Py_UnixMain+0x2e)[0x65468e]
[1 0 1 0 0 0 0 1 0 0 0 0 0 0]
[0 1 0 1 0 1 0 0 0 0 0 0 0 0]
[0 0 1 0 1 0 0 0 0 0 0 1 0 0]
/lib/x86_64-linux-gnu/libc.so.6(__libc_start_main+0xeb)[0x7fc351e1009b]
python3(_start+0x2a)[0x5e0e8a]
------------------------------------------------------------------------
Attaching gdb to process id 1027349.
Cannot find gdb installed
GDB is not installed.
Install gdb for enhanced tracebacks.
------------------------------------------------------------------------
Unhandled SIGSEGV: A segmentation fault occurred.
This probably occurred because a *compiled* module has a bug
in it and is not properly wrapped with sig_on(), sig_off().
Python will now terminate.
------------------------------------------------------------------------
Segmentation fault
sagemath@tmonteil-lxc3:~/sage-9.1$ ./sage 

 SageMath version 9.5.beta5, Release Date: 2021-10-28               
 Using Python 3.7.3. Type "help()" for help.                        


 Warning: this is a prerelease version, and it may be unstable.     

sage: sage: Asso = polytopes.associahedron(['A',3])
....: sage: C = Asso.combinatorial_polyhedron()
....: sage: it = C.face_iter()
....: sage: cython('''
....: ....: from sage.geometry.polyhedron.combinatorial_polyhedron.face_iterator cimport *
....: ....: def foo(FaceIterator_base it):
....: ....:     it.next_dimension()
....: ....:     print('a')
....: ....:     cdef CombinatorialFace face = CombinatorialFace.__new__(CombinatorialFace)
....: ....:     print('b')
....: ....:     face.__init__(it)
....: ....:     print('c')
....: ....:     return face
....: ....: ''')
....: sage: foo(it)
a
b
------------------------------------------------------------------------
Segmentation fault
sagemath@tmonteil-lxc3:~/sage-9.1$ ./sage 

 SageMath version 9.5.beta5, Release Date: 2021-10-28               
 Using Python 3.7.3. Type "help()" for help.                        


 Warning: this is a prerelease version, and it may be unstable.     

sage: sage: from sage.geometry.polyhedron.combinatorial_polyhedron.combinatorial_face import CombinatorialFace
....: sage: face = CombinatorialFace.__new__(CombinatorialFace)
....: sage: face.ambient_H_indices()
------------------------------------------------------------------------
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0x947b)[0x7f644a84747b]
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0xf2d8)[0x7f644a84d2d8]
/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0xfff0)[0x7f644a84dff0]
/lib/x86_64-linux-gnu/libpthread.so.0(+0x12730)[0x7f644e275730]
------------------------------------------------------------------------
Attaching gdb to process id 1027750.
Cannot find gdb installed
GDB is not installed.
Install gdb for enhanced tracebacks.
------------------------------------------------------------------------
Unhandled SIGSEGV: A segmentation fault occurred.
This probably occurred because a *compiled* module has a bug
in it and is not properly wrapped with sig_on(), sig_off().
Python will now terminate.
------------------------------------------------------------------------
Segmentation fault

```




---

archive/issue_comments_464249.json:
```json
{
    "body": "I edited [comment:2 comment:2] to fix the typo between lxc1 and lxc3, the relative tickets are correct.",
    "created_at": "2021-11-05T19:18:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32590#issuecomment-464249",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

I edited [comment:2 comment:2] to fix the typo between lxc1 and lxc3, the relative tickets are correct.



---

archive/issue_comments_464250.json:
```json
{
    "body": "Thanks for all your help.\n\nI will make a branch, where I put things in `__cinit__` that belong there. I hope that helps.\n\nIn the meantime can you yet run the following:\n\n\n```\nsage: cython('''\n....: from sage.geometry.polyhedron.combinatorial_polyhedron.face_list_data_structure cimport *\n....: \n....: cdef class foo:\n....:     cdef face_t face\n....:     cdef MemoryAllocator mem\n....:     \n....:     def __init__(self):\n....:         self.mem = MemoryAllocator()\n....:         face_init(self.face, 9, 14, self.mem)\n....:         \n....:     def test(self):\n....:         cdef face_t new_face\n....:         cdef mem = MemoryAllocator()\n....:         print('a')\n....:         face_init(new_face, 9, 14, mem)\n....:         print('b')\n....:         face_copy(self.face, new_face)\n....:         \n....:     def test2(self):\n....:         cdef face_list_t faces\n....:         cdef mem = MemoryAllocator()\n....:         print('a')\n....:         face_list_init(faces, 9, 9, 14, mem)\n....:         cdef face_t new_face\n....:         for i in range(9):\n....:             print(i)\n....:             new_face[0] = faces.faces[i][0]\n....:             print(i, 'b')\n....:             face_copy(self.face, new_face)\n....: ''')\nsage: a = foo()\nsage: a.test()\nsage: a.test2()\nsage: a = foo.__new__(foo)\nsage: a.__init__()\nsage: a.test()\nsage: a.test2()\n```\n\n\nIt's different from the above, as it now uses incorrectly `__init__` instead of `__cinit__` as done throughout the module `combinatorial_polyhedron`.",
    "created_at": "2021-11-05T20:04:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32590#issuecomment-464250",
    "user": "https://github.com/kliem"
}
```

Thanks for all your help.

I will make a branch, where I put things in `__cinit__` that belong there. I hope that helps.

In the meantime can you yet run the following:


```
sage: cython('''
....: from sage.geometry.polyhedron.combinatorial_polyhedron.face_list_data_structure cimport *
....: 
....: cdef class foo:
....:     cdef face_t face
....:     cdef MemoryAllocator mem
....:     
....:     def __init__(self):
....:         self.mem = MemoryAllocator()
....:         face_init(self.face, 9, 14, self.mem)
....:         
....:     def test(self):
....:         cdef face_t new_face
....:         cdef mem = MemoryAllocator()
....:         print('a')
....:         face_init(new_face, 9, 14, mem)
....:         print('b')
....:         face_copy(self.face, new_face)
....:         
....:     def test2(self):
....:         cdef face_list_t faces
....:         cdef mem = MemoryAllocator()
....:         print('a')
....:         face_list_init(faces, 9, 9, 14, mem)
....:         cdef face_t new_face
....:         for i in range(9):
....:             print(i)
....:             new_face[0] = faces.faces[i][0]
....:             print(i, 'b')
....:             face_copy(self.face, new_face)
....: ''')
sage: a = foo()
sage: a.test()
sage: a.test2()
sage: a = foo.__new__(foo)
sage: a.__init__()
sage: a.test()
sage: a.test2()
```


It's different from the above, as it now uses incorrectly `__init__` instead of `__cinit__` as done throughout the module `combinatorial_polyhedron`.



---

archive/issue_comments_464251.json:
```json
{
    "body": "Here it is:\n\n\n```\nsagemath@tmonteil-lxc3:~/sage-9.1$ ./sage \n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 SageMath version 9.5.beta5, Release Date: 2021-10-28               \u2502\n\u2502 Using Python 3.7.3. Type \"help()\" for help.                        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250f\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n\u2503 Warning: this is a prerelease version, and it may be unstable.     \u2503\n\u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251b\nsage: sage: cython('''\n....: ....: from sage.geometry.polyhedron.combinatorial_polyhedron.face_list_data_structure cimport *\n....: ....: \n....: ....: cdef class foo:\n....: ....:     cdef face_t face\n....: ....:     cdef MemoryAllocator mem\n....: ....:     \n....: ....:     def __init__(self):\n....: ....:         self.mem = MemoryAllocator()\n....: ....:         face_init(self.face, 9, 14, self.mem)\n....: ....:         \n....: ....:     def test(self):\n....: ....:         cdef face_t new_face\n....: ....:         cdef mem = MemoryAllocator()\n....: ....:         print('a')\n....: ....:         face_init(new_face, 9, 14, mem)\n....: ....:         print('b')\n....: ....:         face_copy(self.face, new_face)\n....: ....:         \n....: ....:     def test2(self):\n....: ....:         cdef face_list_t faces\n....: ....:         cdef mem = MemoryAllocator()\n....: ....:         print('a')\n....: ....:         face_list_init(faces, 9, 9, 14, mem)\n....: ....:         cdef face_t new_face\n....: ....:         for i in range(9):\n....: ....:             print(i)\n....: ....:             new_face[0] = faces.faces[i][0]\n....: ....:             print(i, 'b')\n....: ....:             face_copy(self.face, new_face)\n....: ....: ''')\n....: sage: a = foo()\n....: sage: a.test()\n....: sage: a.test2()\n....: sage: a = foo.__new__(foo)\n....: sage: a.__init__()\n....: sage: a.test()\n....: sage: a.test2()\na\nb\na\n0\n0 b\n1\n1 b\n2\n2 b\n3\n3 b\n4\n4 b\n5\n5 b\n6\n6 b\n7\n7 b\n8\n8 b\na\nb\na\n0\n0 b\n1\n1 b\n2\n2 b\n3\n3 b\n4\n4 b\n5\n5 b\n6\n6 b\n7\n7 b\n8\n8 b\n```\n",
    "created_at": "2021-11-05T21:04:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32590#issuecomment-464251",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Here it is:


```
sagemath@tmonteil-lxc3:~/sage-9.1$ ./sage 

 SageMath version 9.5.beta5, Release Date: 2021-10-28               
 Using Python 3.7.3. Type "help()" for help.                        


 Warning: this is a prerelease version, and it may be unstable.     

sage: sage: cython('''
....: ....: from sage.geometry.polyhedron.combinatorial_polyhedron.face_list_data_structure cimport *
....: ....: 
....: ....: cdef class foo:
....: ....:     cdef face_t face
....: ....:     cdef MemoryAllocator mem
....: ....:     
....: ....:     def __init__(self):
....: ....:         self.mem = MemoryAllocator()
....: ....:         face_init(self.face, 9, 14, self.mem)
....: ....:         
....: ....:     def test(self):
....: ....:         cdef face_t new_face
....: ....:         cdef mem = MemoryAllocator()
....: ....:         print('a')
....: ....:         face_init(new_face, 9, 14, mem)
....: ....:         print('b')
....: ....:         face_copy(self.face, new_face)
....: ....:         
....: ....:     def test2(self):
....: ....:         cdef face_list_t faces
....: ....:         cdef mem = MemoryAllocator()
....: ....:         print('a')
....: ....:         face_list_init(faces, 9, 9, 14, mem)
....: ....:         cdef face_t new_face
....: ....:         for i in range(9):
....: ....:             print(i)
....: ....:             new_face[0] = faces.faces[i][0]
....: ....:             print(i, 'b')
....: ....:             face_copy(self.face, new_face)
....: ....: ''')
....: sage: a = foo()
....: sage: a.test()
....: sage: a.test2()
....: sage: a = foo.__new__(foo)
....: sage: a.__init__()
....: sage: a.test()
....: sage: a.test2()
a
b
a
0
0 b
1
1 b
2
2 b
3
3 b
4
4 b
5
5 b
6
6 b
7
7 b
8
8 b
a
b
a
0
0 b
1
1 b
2
2 b
3
3 b
4
4 b
5
5 b
6
6 b
7
7 b
8
8 b
```




---

archive/issue_comments_464252.json:
```json
{
    "body": "The attached branch uses `__cinit__` to avoid having undefined objects around.\n----\nNew commits:",
    "created_at": "2021-11-06T20:57:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32590#issuecomment-464252",
    "user": "https://github.com/kliem"
}
```

The attached branch uses `__cinit__` to avoid having undefined objects around.
----
New commits:



---

archive/issue_comments_464253.json:
```json
{
    "body": "Does this help.\n\nIf not, if not or if it is not clear, if it helps, I can also do this in a seperate ticket.",
    "created_at": "2021-11-08T07:29:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32590#issuecomment-464253",
    "user": "https://github.com/kliem"
}
```

Does this help.

If not, if not or if it is not clear, if it helps, I can also do this in a seperate ticket.



---

archive/issue_comments_464254.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-11-08T07:29:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32590#issuecomment-464254",
    "user": "https://github.com/kliem"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_464255.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-11-29T00:29:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32590#issuecomment-464255",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_464256.json:
```json
{
    "body": "Patchbot shows failures:\n\n```\nsage -t --long --random-seed=116540483811314252179005456955637850102 src/sage/geometry/polyhedron/combinatorial_polyhedron/base.pyx\n**********************************************************************\nFile \"src/sage/geometry/polyhedron/combinatorial_polyhedron/base.pyx\", line 324, in sage.geometry.polyhedron.combinatorial_polyhedron.base.CombinatorialPolyhedron.__cinit__\nFailed example:\n    C.f_vector()\nExpected:\n    Traceback (most recent call last):\n    ...\n    MemoryError: failed to allocate ... bytes\nGot:\n    (1)\n**********************************************************************\nFile \"src/sage/geometry/polyhedron/combinatorial_polyhedron/base.pyx\", line 328, in sage.geometry.polyhedron.combinatorial_polyhedron.base.CombinatorialPolyhedron.__cinit__\nFailed example:\n    C.face_lattice()\nExpected:\n    Traceback (most recent call last):\n    ...\n    MemoryError: failed to allocate ... bytes\nGot:\n    Finite lattice containing 1 elements\n**********************************************************************\n```\n",
    "created_at": "2021-11-29T00:29:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32590#issuecomment-464256",
    "user": "https://github.com/mkoeppe"
}
```

Patchbot shows failures:

```
sage -t --long --random-seed=116540483811314252179005456955637850102 src/sage/geometry/polyhedron/combinatorial_polyhedron/base.pyx
**********************************************************************
File "src/sage/geometry/polyhedron/combinatorial_polyhedron/base.pyx", line 324, in sage.geometry.polyhedron.combinatorial_polyhedron.base.CombinatorialPolyhedron.__cinit__
Failed example:
    C.f_vector()
Expected:
    Traceback (most recent call last):
    ...
    MemoryError: failed to allocate ... bytes
Got:
    (1)
**********************************************************************
File "src/sage/geometry/polyhedron/combinatorial_polyhedron/base.pyx", line 328, in sage.geometry.polyhedron.combinatorial_polyhedron.base.CombinatorialPolyhedron.__cinit__
Failed example:
    C.face_lattice()
Expected:
    Traceback (most recent call last):
    ...
    MemoryError: failed to allocate ... bytes
Got:
    Finite lattice containing 1 elements
**********************************************************************
```




---

archive/issue_comments_464257.json:
```json
{
    "body": "I don't see this failures when trying out the ticket on macOS.",
    "created_at": "2021-11-29T00:30:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32590#issuecomment-464257",
    "user": "https://github.com/mkoeppe"
}
```

I don't see this failures when trying out the ticket on macOS.



---

archive/issue_comments_464258.json:
```json
{
    "body": "Changing priority from critical to blocker.",
    "created_at": "2021-11-29T00:30:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32590#issuecomment-464258",
    "user": "https://github.com/mkoeppe"
}
```

Changing priority from critical to blocker.



---

archive/issue_comments_464259.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-11-29T08:23:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32590#issuecomment-464259",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_464260.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-11-29T08:24:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32590#issuecomment-464260",
    "user": "https://github.com/kliem"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_464261.json:
```json
{
    "body": "The combinatorial what? I think you are missing `polyhedron` in the error message.",
    "created_at": "2021-11-29T09:53:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32590#issuecomment-464261",
    "user": "https://github.com/tscrim"
}
```

The combinatorial what? I think you are missing `polyhedron` in the error message.



---

archive/issue_comments_464262.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-11-29T10:52:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32590#issuecomment-464262",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_464263.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-11-29T20:03:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32590#issuecomment-464263",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_464264.json:
```json
{
    "body": "Thank you.",
    "created_at": "2021-11-30T06:31:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32590#issuecomment-464264",
    "user": "https://github.com/kliem"
}
```

Thank you.



---

archive/issue_comments_464265.json:
```json
{
    "body": "Changing status from positive_review to needs_info.",
    "created_at": "2021-11-30T10:23:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32590#issuecomment-464265",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Changing status from positive_review to needs_info.



---

archive/issue_comments_464266.json:
```json
{
    "body": "I rebuilt on the same machine `tmonteil-lxc3` with the new branch, many things were recompiled (so the problem might have disapeared for another reason).\n\nThe doctests of `src/sage/geometry/polyhedron/` pass, and all the previous tests that you let me try in that ticket now pass, except the following two:\n\n\n```\nsage: Asso = polytopes.associahedron(['A',3])\n....: C = Asso.combinatorial_polyhedron()\n....: it = C.face_iter()\n....: cython('''\n....: from sage.geometry.polyhedron.combinatorial_polyhedron.face_iterator cimport *\n....: def foo(FaceIterator_base it):\n....:     it.next_dimension()\n....:     print('a')  \n....:     cdef CombinatorialFace face = CombinatorialFace.__new__(CombinatorialFace)\n....:     print('b')  \n....:     face.__init__(it)\n....:     print('c')  \n....:     return face \n....: ''')\n....: foo(it)\n....: \na\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-1-4ddddb9717bb> in <module>\n     13     return face\n     14 ''')\n---> 15 foo(it)\n\n~/.sage/temp/tmonteil-lxc3/1115495/spyx/_home_sagemath__sage_temp_tmonteil_lxc3_1115495_tmp_jjkx1k56_pyx/_home_sagemath__sage_temp_tmonteil_lxc3_1115495_tmp_jjkx1k56_pyx_0.pyx in _home_sagemath__sage_temp_tmonteil_lxc3_1115495_tmp_jjkx1k56_pyx_0.foo()\n      4     it.next_dimension()\n      5     print('a')\n----> 6     cdef CombinatorialFace face = CombinatorialFace.__new__(CombinatorialFace)\n      7     print('b')\n      8     face.__init__(it)\n\n~/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/combinatorial_face.pyx in sage.geometry.polyhedron.combinatorial_polyhedron.combinatorial_face.CombinatorialFace.__cinit__ (build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/combinatorial_face.c:4022)()\n    141         11\n    142     \"\"\"\n--> 143     def __cinit__(self, data, dimension=None, index=None):\n    144         r\"\"\"\n    145         Initialize :class:`CombinatorialFace`.\n\nTypeError: __cinit__() takes at least 1 positional argument (0 given)\n```\n\n\n\n\n```\nsage: from sage.geometry.polyhedron.combinatorial_polyhedron.combinatorial_face import CombinatorialFace\n....: face = CombinatorialFace.__new__(CombinatorialFace)\n....: face.ambient_H_indices()\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-2-d41a0d4cfa81> in <module>\n      1 from sage.geometry.polyhedron.combinatorial_polyhedron.combinatorial_face import CombinatorialFace\n----> 2 face = CombinatorialFace.__new__(CombinatorialFace)\n      3 face.ambient_H_indices()\n\n~/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/combinatorial_face.pyx in sage.geometry.polyhedron.combinatorial_polyhedron.combinatorial_face.CombinatorialFace.__cinit__ (build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/combinatorial_face.c:4022)()\n    141         11\n    142     \"\"\"\n--> 143     def __cinit__(self, data, dimension=None, index=None):\n    144         r\"\"\"\n    145         Initialize :class:`CombinatorialFace`.\n\nTypeError: __cinit__() takes at least 1 positional argument (0 given)\n```\n\n\n\nAs they involve a new `__cinit__` method, it might be intended, is it OK ?",
    "created_at": "2021-11-30T10:23:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32590#issuecomment-464266",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

I rebuilt on the same machine `tmonteil-lxc3` with the new branch, many things were recompiled (so the problem might have disapeared for another reason).

The doctests of `src/sage/geometry/polyhedron/` pass, and all the previous tests that you let me try in that ticket now pass, except the following two:


```
sage: Asso = polytopes.associahedron(['A',3])
....: C = Asso.combinatorial_polyhedron()
....: it = C.face_iter()
....: cython('''
....: from sage.geometry.polyhedron.combinatorial_polyhedron.face_iterator cimport *
....: def foo(FaceIterator_base it):
....:     it.next_dimension()
....:     print('a')  
....:     cdef CombinatorialFace face = CombinatorialFace.__new__(CombinatorialFace)
....:     print('b')  
....:     face.__init__(it)
....:     print('c')  
....:     return face 
....: ''')
....: foo(it)
....: 
a
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-1-4ddddb9717bb> in <module>
     13     return face
     14 ''')
---> 15 foo(it)

~/.sage/temp/tmonteil-lxc3/1115495/spyx/_home_sagemath__sage_temp_tmonteil_lxc3_1115495_tmp_jjkx1k56_pyx/_home_sagemath__sage_temp_tmonteil_lxc3_1115495_tmp_jjkx1k56_pyx_0.pyx in _home_sagemath__sage_temp_tmonteil_lxc3_1115495_tmp_jjkx1k56_pyx_0.foo()
      4     it.next_dimension()
      5     print('a')
----> 6     cdef CombinatorialFace face = CombinatorialFace.__new__(CombinatorialFace)
      7     print('b')
      8     face.__init__(it)

~/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/combinatorial_face.pyx in sage.geometry.polyhedron.combinatorial_polyhedron.combinatorial_face.CombinatorialFace.__cinit__ (build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/combinatorial_face.c:4022)()
    141         11
    142     """
--> 143     def __cinit__(self, data, dimension=None, index=None):
    144         r"""
    145         Initialize :class:`CombinatorialFace`.

TypeError: __cinit__() takes at least 1 positional argument (0 given)
```




```
sage: from sage.geometry.polyhedron.combinatorial_polyhedron.combinatorial_face import CombinatorialFace
....: face = CombinatorialFace.__new__(CombinatorialFace)
....: face.ambient_H_indices()
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-2-d41a0d4cfa81> in <module>
      1 from sage.geometry.polyhedron.combinatorial_polyhedron.combinatorial_face import CombinatorialFace
----> 2 face = CombinatorialFace.__new__(CombinatorialFace)
      3 face.ambient_H_indices()

~/sage-9.1/local/lib/python3.7/site-packages/sage/geometry/polyhedron/combinatorial_polyhedron/combinatorial_face.pyx in sage.geometry.polyhedron.combinatorial_polyhedron.combinatorial_face.CombinatorialFace.__cinit__ (build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/combinatorial_face.c:4022)()
    141         11
    142     """
--> 143     def __cinit__(self, data, dimension=None, index=None):
    144         r"""
    145         Initialize :class:`CombinatorialFace`.

TypeError: __cinit__() takes at least 1 positional argument (0 given)
```



As they involve a new `__cinit__` method, it might be intended, is it OK ?



---

archive/issue_comments_464267.json:
```json
{
    "body": "Yes, this is intended. `CombinatorialFace` cannot be initialized without a `face_t`.\n\n`face_t` can be provided either by `FaceIterator` or by `PolyhedronFaceLattice`.\n\nYou need to run\n\n\n```\nsage: Asso = polytopes.associahedron(['A',3])\n....: C = Asso.combinatorial_polyhedron()\n....: it = C.face_iter()\n....: cython('''\n....: from sage.geometry.polyhedron.combinatorial_polyhedron.face_iterator cimport *\n....: def foo(FaceIterator_base it):\n....:     it.next_dimension()\n....:     print('a')  \n....:     cdef CombinatorialFace face = CombinatorialFace.__new__(CombinatorialFace, it)\n....:     print('b')  \n....:     face.__init__(it)\n....:     print('c')  \n....:     return face \n....: ''')\n....: foo(it)\n```\n\nnow. (Actually, you can also skip the `__init__` completely).",
    "created_at": "2021-11-30T10:43:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32590#issuecomment-464267",
    "user": "https://github.com/kliem"
}
```

Yes, this is intended. `CombinatorialFace` cannot be initialized without a `face_t`.

`face_t` can be provided either by `FaceIterator` or by `PolyhedronFaceLattice`.

You need to run


```
sage: Asso = polytopes.associahedron(['A',3])
....: C = Asso.combinatorial_polyhedron()
....: it = C.face_iter()
....: cython('''
....: from sage.geometry.polyhedron.combinatorial_polyhedron.face_iterator cimport *
....: def foo(FaceIterator_base it):
....:     it.next_dimension()
....:     print('a')  
....:     cdef CombinatorialFace face = CombinatorialFace.__new__(CombinatorialFace, it)
....:     print('b')  
....:     face.__init__(it)
....:     print('c')  
....:     return face 
....: ''')
....: foo(it)
```

now. (Actually, you can also skip the `__init__` completely).



---

archive/issue_comments_464268.json:
```json
{
    "body": "Great to hear that it works for now. Thanks for checking.",
    "created_at": "2021-11-30T10:44:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32590#issuecomment-464268",
    "user": "https://github.com/kliem"
}
```

Great to hear that it works for now. Thanks for checking.



---

archive/issue_comments_464269.json:
```json
{
    "body": "Changing status from needs_info to positive_review.",
    "created_at": "2021-11-30T10:44:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32590#issuecomment-464269",
    "user": "https://github.com/kliem"
}
```

Changing status from needs_info to positive_review.



---

archive/issue_comments_464270.json:
```json
{
    "body": "Replying to [comment:25 gh-kliem]:\n> Yes, this is intended. `CombinatorialFace` cannot be initialized without a `face_t`.\n> \n> `face_t` can be provided either by `FaceIterator` or by `PolyhedronFaceLattice`.\n> \n> You need to run\n> \n> {{{\n> sage: Asso = polytopes.associahedron(['A',3])\n> ....: C = Asso.combinatorial_polyhedron()\n> ....: it = C.face_iter()\n> ....: cython('''\n> ....: from sage.geometry.polyhedron.combinatorial_polyhedron.face_iterator cimport *\n> ....: def foo(FaceIterator_base it):\n> ....:     it.next_dimension()\n> ....:     print('a')  \n> ....:     cdef CombinatorialFace face = CombinatorialFace.__new__(CombinatorialFace, it)\n> ....:     print('b')  \n> ....:     face.__init__(it)\n> ....:     print('c')  \n> ....:     return face \n> ....: ''')\n> ....: foo(it)\n> }}}\n> now. (Actually, you can also skip the `__init__` completely).\n\nGreat, i got:\n\n\n```\nsage: sage: Asso = polytopes.associahedron(['A',3])\n....: ....: C = Asso.combinatorial_polyhedron()\n....: ....: it = C.face_iter()\n....: ....: cython('''\n....: ....: from sage.geometry.polyhedron.combinatorial_polyhedron.face_iterator cimport *\n....: ....: def foo(FaceIterator_base it):\n....: ....:     it.next_dimension()\n....: ....:     print('a')  \n....: ....:     cdef CombinatorialFace face = CombinatorialFace.__new__(CombinatorialFace, it)\n....: ....:     print('b')  \n....: ....:     face.__init__(it)\n....: ....:     print('c')  \n....: ....:     return face \n....: ....: ''')\n....: ....: foo(it)\na\nb\nc\nA 2-dimensional face of a 3-dimensional combinatorial polyhedron\n```\n",
    "created_at": "2021-11-30T10:56:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32590#issuecomment-464270",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Replying to [comment:25 gh-kliem]:
> Yes, this is intended. `CombinatorialFace` cannot be initialized without a `face_t`.
> 
> `face_t` can be provided either by `FaceIterator` or by `PolyhedronFaceLattice`.
> 
> You need to run
> 
> {{{
> sage: Asso = polytopes.associahedron(['A',3])
> ....: C = Asso.combinatorial_polyhedron()
> ....: it = C.face_iter()
> ....: cython('''
> ....: from sage.geometry.polyhedron.combinatorial_polyhedron.face_iterator cimport *
> ....: def foo(FaceIterator_base it):
> ....:     it.next_dimension()
> ....:     print('a')  
> ....:     cdef CombinatorialFace face = CombinatorialFace.__new__(CombinatorialFace, it)
> ....:     print('b')  
> ....:     face.__init__(it)
> ....:     print('c')  
> ....:     return face 
> ....: ''')
> ....: foo(it)
> }}}
> now. (Actually, you can also skip the `__init__` completely).

Great, i got:


```
sage: sage: Asso = polytopes.associahedron(['A',3])
....: ....: C = Asso.combinatorial_polyhedron()
....: ....: it = C.face_iter()
....: ....: cython('''
....: ....: from sage.geometry.polyhedron.combinatorial_polyhedron.face_iterator cimport *
....: ....: def foo(FaceIterator_base it):
....: ....:     it.next_dimension()
....: ....:     print('a')  
....: ....:     cdef CombinatorialFace face = CombinatorialFace.__new__(CombinatorialFace, it)
....: ....:     print('b')  
....: ....:     face.__init__(it)
....: ....:     print('c')  
....: ....:     return face 
....: ....: ''')
....: ....: foo(it)
a
b
c
A 2-dimensional face of a 3-dimensional combinatorial polyhedron
```




---

archive/issue_comments_464271.json:
```json
{
    "body": "Segfaults on 32-bit\n\n```\nsage: for _ in range(10):\n    points = tuple(tuple(randint(-1000,1000) for _ in range(10))\n                   for _ in range(randint(3,15)))\n    P = Polyhedron(vertices=points)\n    inc = P.incidence_matrix()\n    mod_inc = inc.delete_columns([i for i,V in enumerate(P.Hrepresentation()) if V.is_equation()])\n    facets = incidence_matrix_to_bit_rep_of_facets(mod_inc)\n    vertices = incidence_matrix_to_bit_rep_of_Vrep(mod_inc)\n    d1 = P.dimension()\n    if d1 == 0:\n        continue\n    d2 = facets.compute_dimension()\n    d3 = vertices.compute_dimension()\n    if not d1 == d2 == d3:\n        print('calculation_dimension() seems to be incorrect') ## line 235 ##\nfree(): invalid size\n------------------------------------------------------------------------\n/var/lib/buildbot/worker/sage_git/build/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/cysignals/signals.cpython-39-i386-linux-gnu.so(+0x5e62)[0xf67ace62]\n/var/lib/buildbot/worker/sage_git/build/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/cysignals/signals.cpython-39-i386-linux-gnu.so(+0x5f06)[0xf67acf06]\n/var/lib/buildbot/worker/sage_git/build/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/cysignals/signals.cpython-39-i386-linux-gnu.so(+0x88fe)[0xf67af8fe]\nlinux-gate.so.1(__kernel_sigreturn+0x0)[0xf7efa570]\nlinux-gate.so.1(__kernel_vsyscall+0x9)[0xf7efa559]\n/lib/i386-linux-gnu/libc.so.6(gsignal+0xc2)[0xf79b5e02]\n/lib/i386-linux-gnu/libc.so.6(abort+0x129)[0xf799e306]\n/lib/i386-linux-gnu/libc.so.6(+0x7899c)[0xf79f999c]\n/lib/i386-linux-gnu/libc.so.6(+0x80a5d)[0xf7a01a5d]\n/lib/i386-linux-gnu/libc.so.6(+0x81bef)[0xf7a02bef]\n/var/lib/buildbot/worker/sage_git/build/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/sage/ext/memory.cpython-39-i386-linux-gnu.so(+0x37b4)[0xafaf97b4]\n/var/lib/buildbot/worker/sage_git/build/local/lib/libgmp.so.10(__gmpz_clear+0x2a)[0xf6fecd0a]\n/var/lib/buildbot/worker/sage_git/build/local/lib/libppl.so.14(_ZN23Parma_Polyhedra_Library7CO_Tree7destroyEv+0x40)[0xa58e6290]\n/var/lib/buildbot/worker/sage_git/build/local/lib/libppl.so.14(_ZN23Parma_Polyhedra_Library22Linear_Expression_ImplINS_10Sparse_RowEED0Ev+0x28)[0xa585a5b8]\n/var/lib/buildbot/worker/sage_git/build/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/ppl/linear_algebra.cpython-39-i386-linux-gnu.so(+0xfca8)[0xa5948ca8]\n/var/lib/buildbot/worker/sage_git/build/local/var/lib/sage/venv-python3.9.7/lib/libpython3.9.so.1.0(+0x5c90f)[0xf7bcc90f]\n/var/lib/buildbot/worker/sage_git/build/local/var/lib/sage/venv-python3.9.7/lib/libpython3.9.so.1.0(PyNumber_InPlaceAdd+0x61)[0xf7bcf311]\n/var/lib/buildbot/worker/sage_git/build/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/ppl/linear_algebra.cpython-39-i386-linux-gnu.so(+0xbddc)[0xa5944ddc]\n/var/lib/buildbot/worker/sage_git/build/local/var/lib/sage/venv-python3.9.7/lib/libpython3.9.so.1.0(+0xce637)[0xf7c3e637]\n/var/lib/buildbot/worker/sage_git/build/local/var/lib/sage/venv-python3.9.7/lib/libpython3.9.so.1.0(_PyObject_MakeTpCall+0xa4)[0xf7be89a4]\n/var/lib/buildbot/worker/sage_git/build/local/var/lib/sage/venv-python3.9.7/lib/libpython3.9.so.1.0(_PyEval_EvalFrameDefault+0x7900)[0xf7bac170]\n/var/lib/buildbot/worker/sage_git/build/local/var/lib/sage/venv-python3.9.7/lib/libpython3.9.so.1.0(+0x140fcf)[0xf7cb0fcf]\n/var/lib/buildbot/worker/sage_git/build/local/var/lib/sage/venv-python3.9.7/lib/libpython3.9.so.1.0(_PyFunction_Vectorcall+0xde)[0xf7be864e]\n/var/lib/buildbot/worker/sage_git/build/local/var/lib/sage/venv-python3.9.7/lib/libpython3.9.so.1.0(_PyEval_EvalFrameDefault+0x5bd6)[0xf7baa446]\n/var/lib/buildbot/worker/sage_git/build/local/var/lib/sage/venv-python3.9.7/lib/libpython3.9.so.1.0(+0x140fcf)[0xf7cb0fcf]\n/var/lib/buildbot/worker/sage_git/build/local/var/lib/sage/venv-python3.9.7/lib/libpython3.9.so.1.0(_PyFunction_Vectorcall+0xde)[0xf7be864e]\n/var/lib/buildbot/worker/sage_git/build/local/var/lib/sage/venv-python3.9.7/lib/libpython3.9.so.1.0(+0x7af84)[0xf7beaf84]\n/var/lib/buildbot/worker/sage_git/build/local/var/lib/sage/venv-python3.9.7/lib/libpython3.9.so.1.0(PyVectorcall_Call+0xa9)[0xf7be8369]\n/var/lib/buildbot/worker/sage_git/build/local/var/lib/sage/venv-python3.9.7/lib/libpython3.9.so.1.0(_PyObject_Call+0xe9)[0xf7be84b9]\n```\n",
    "created_at": "2021-12-10T20:26:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32590#issuecomment-464271",
    "user": "https://github.com/vbraun"
}
```

Segfaults on 32-bit

```
sage: for _ in range(10):
    points = tuple(tuple(randint(-1000,1000) for _ in range(10))
                   for _ in range(randint(3,15)))
    P = Polyhedron(vertices=points)
    inc = P.incidence_matrix()
    mod_inc = inc.delete_columns([i for i,V in enumerate(P.Hrepresentation()) if V.is_equation()])
    facets = incidence_matrix_to_bit_rep_of_facets(mod_inc)
    vertices = incidence_matrix_to_bit_rep_of_Vrep(mod_inc)
    d1 = P.dimension()
    if d1 == 0:
        continue
    d2 = facets.compute_dimension()
    d3 = vertices.compute_dimension()
    if not d1 == d2 == d3:
        print('calculation_dimension() seems to be incorrect') ## line 235 ##
free(): invalid size
------------------------------------------------------------------------
/var/lib/buildbot/worker/sage_git/build/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/cysignals/signals.cpython-39-i386-linux-gnu.so(+0x5e62)[0xf67ace62]
/var/lib/buildbot/worker/sage_git/build/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/cysignals/signals.cpython-39-i386-linux-gnu.so(+0x5f06)[0xf67acf06]
/var/lib/buildbot/worker/sage_git/build/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/cysignals/signals.cpython-39-i386-linux-gnu.so(+0x88fe)[0xf67af8fe]
linux-gate.so.1(__kernel_sigreturn+0x0)[0xf7efa570]
linux-gate.so.1(__kernel_vsyscall+0x9)[0xf7efa559]
/lib/i386-linux-gnu/libc.so.6(gsignal+0xc2)[0xf79b5e02]
/lib/i386-linux-gnu/libc.so.6(abort+0x129)[0xf799e306]
/lib/i386-linux-gnu/libc.so.6(+0x7899c)[0xf79f999c]
/lib/i386-linux-gnu/libc.so.6(+0x80a5d)[0xf7a01a5d]
/lib/i386-linux-gnu/libc.so.6(+0x81bef)[0xf7a02bef]
/var/lib/buildbot/worker/sage_git/build/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/sage/ext/memory.cpython-39-i386-linux-gnu.so(+0x37b4)[0xafaf97b4]
/var/lib/buildbot/worker/sage_git/build/local/lib/libgmp.so.10(__gmpz_clear+0x2a)[0xf6fecd0a]
/var/lib/buildbot/worker/sage_git/build/local/lib/libppl.so.14(_ZN23Parma_Polyhedra_Library7CO_Tree7destroyEv+0x40)[0xa58e6290]
/var/lib/buildbot/worker/sage_git/build/local/lib/libppl.so.14(_ZN23Parma_Polyhedra_Library22Linear_Expression_ImplINS_10Sparse_RowEED0Ev+0x28)[0xa585a5b8]
/var/lib/buildbot/worker/sage_git/build/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/ppl/linear_algebra.cpython-39-i386-linux-gnu.so(+0xfca8)[0xa5948ca8]
/var/lib/buildbot/worker/sage_git/build/local/var/lib/sage/venv-python3.9.7/lib/libpython3.9.so.1.0(+0x5c90f)[0xf7bcc90f]
/var/lib/buildbot/worker/sage_git/build/local/var/lib/sage/venv-python3.9.7/lib/libpython3.9.so.1.0(PyNumber_InPlaceAdd+0x61)[0xf7bcf311]
/var/lib/buildbot/worker/sage_git/build/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/ppl/linear_algebra.cpython-39-i386-linux-gnu.so(+0xbddc)[0xa5944ddc]
/var/lib/buildbot/worker/sage_git/build/local/var/lib/sage/venv-python3.9.7/lib/libpython3.9.so.1.0(+0xce637)[0xf7c3e637]
/var/lib/buildbot/worker/sage_git/build/local/var/lib/sage/venv-python3.9.7/lib/libpython3.9.so.1.0(_PyObject_MakeTpCall+0xa4)[0xf7be89a4]
/var/lib/buildbot/worker/sage_git/build/local/var/lib/sage/venv-python3.9.7/lib/libpython3.9.so.1.0(_PyEval_EvalFrameDefault+0x7900)[0xf7bac170]
/var/lib/buildbot/worker/sage_git/build/local/var/lib/sage/venv-python3.9.7/lib/libpython3.9.so.1.0(+0x140fcf)[0xf7cb0fcf]
/var/lib/buildbot/worker/sage_git/build/local/var/lib/sage/venv-python3.9.7/lib/libpython3.9.so.1.0(_PyFunction_Vectorcall+0xde)[0xf7be864e]
/var/lib/buildbot/worker/sage_git/build/local/var/lib/sage/venv-python3.9.7/lib/libpython3.9.so.1.0(_PyEval_EvalFrameDefault+0x5bd6)[0xf7baa446]
/var/lib/buildbot/worker/sage_git/build/local/var/lib/sage/venv-python3.9.7/lib/libpython3.9.so.1.0(+0x140fcf)[0xf7cb0fcf]
/var/lib/buildbot/worker/sage_git/build/local/var/lib/sage/venv-python3.9.7/lib/libpython3.9.so.1.0(_PyFunction_Vectorcall+0xde)[0xf7be864e]
/var/lib/buildbot/worker/sage_git/build/local/var/lib/sage/venv-python3.9.7/lib/libpython3.9.so.1.0(+0x7af84)[0xf7beaf84]
/var/lib/buildbot/worker/sage_git/build/local/var/lib/sage/venv-python3.9.7/lib/libpython3.9.so.1.0(PyVectorcall_Call+0xa9)[0xf7be8369]
/var/lib/buildbot/worker/sage_git/build/local/var/lib/sage/venv-python3.9.7/lib/libpython3.9.so.1.0(_PyObject_Call+0xe9)[0xf7be84b9]
```




---

archive/issue_comments_464272.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2021-12-10T20:26:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32590#issuecomment-464272",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_464273.json:
```json
{
    "body": "I wonder if initializing `MemoryAllocator` with:\n\n\n```\n    self.mem = MemoryAllocator()\n```\n\n\nin `__init__` might a problem and if it would be better to use `__new__`?",
    "created_at": "2021-12-12T07:26:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32590#issuecomment-464273",
    "user": "https://github.com/kliem"
}
```

I wonder if initializing `MemoryAllocator` with:


```
    self.mem = MemoryAllocator()
```


in `__init__` might a problem and if it would be better to use `__new__`?



---

archive/issue_comments_464274.json:
```json
{
    "body": "One thing that I found is the following:\n\nhttps://gmplib.org/list-archives/gmp-bugs/2020-September/004888.html\n\nIn `bitset_intrinsics.h` I silently assume that `sizeof(mp_limb_t)` and `GMP_LIMB_BITS` are consistent. It would definitely be safer to just use `sizeof(mp_limb_t)` to compute `LIMBS_PER_64`.",
    "created_at": "2021-12-12T09:10:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32590#issuecomment-464274",
    "user": "https://github.com/kliem"
}
```

One thing that I found is the following:

https://gmplib.org/list-archives/gmp-bugs/2020-September/004888.html

In `bitset_intrinsics.h` I silently assume that `sizeof(mp_limb_t)` and `GMP_LIMB_BITS` are consistent. It would definitely be safer to just use `sizeof(mp_limb_t)` to compute `LIMBS_PER_64`.



---

archive/issue_comments_464275.json:
```json
{
    "body": "A small issue (I think) in method `_compute_edges_or_ridges` of `base.pyx`:\n\n```diff\n-        cdef size_t **edges = <size_t**> mem.malloc(sizeof(size_t**))\n+        cdef size_t **edges = <size_t**> mem.malloc(sizeof(size_t*))\n```\n",
    "created_at": "2021-12-12T10:03:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32590#issuecomment-464275",
    "user": "https://github.com/dcoudert"
}
```

A small issue (I think) in method `_compute_edges_or_ridges` of `base.pyx`:

```diff
-        cdef size_t **edges = <size_t**> mem.malloc(sizeof(size_t**))
+        cdef size_t **edges = <size_t**> mem.malloc(sizeof(size_t*))
```




---

archive/issue_comments_464276.json:
```json
{
    "body": "There seem to be multiple memory access issues here, my suggestion is to get comfortable with valgrind. Finding these things is generally pretty easy with it.",
    "created_at": "2021-12-12T10:18:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32590#issuecomment-464276",
    "user": "https://github.com/vbraun"
}
```

There seem to be multiple memory access issues here, my suggestion is to get comfortable with valgrind. Finding these things is generally pretty easy with it.



---

archive/issue_comments_464277.json:
```json
{
    "body": "Apparently, there is at least a bug in memory allocator.\n\nRunning the test suite, I get\n\n\n```\n==66729==  Address 0x6e7f020 is 528 bytes inside a block of size 800 free'd\n==66729==    at 0x483CABF: free (vg_replace_malloc.c:530)\n==66729==    by 0x5C01888: sig_free (memory_allocator.c:2764)\n==66729==    by 0x5C01888: __pyx_pf_16memory_allocator_16memory_allocator_15MemoryAllocator_2__dealloc__ (memory_allocator.c:2078)\n==66729==    by 0x5C01888: __pyx_pw_16memory_allocator_16memory_allocator_15MemoryAllocator_3__dealloc__ (memory_allocator.c:2044)\n==66729==    by 0x5C01888: __pyx_tp_dealloc_16memory_allocator_16memory_allocator_MemoryAllocator (memory_allocator.c:3652)\n==66729==    by 0x4859D9C: _Py_DECREF (object.h:478)\n==66729==    by 0x4859D9C: __pyx_tp_dealloc_16memory_allocator_4test_TestMemoryAllocator (test.c:3615)\n==66729==    by 0x5CF74A: PyDict_Clear (in /usr/bin/python3.8)\n==66729==    by 0x6A9C09: ??? (in /usr/bin/python3.8)\n==66729==    by 0x5045DA: ??? (in /usr/bin/python3.8)\n==66729==    by 0x56BF08: _PyEval_EvalFrameDefault (in /usr/bin/python3.8)\n==66729==    by 0x56A0B9: _PyEval_EvalCodeWithName (in /usr/bin/python3.8)\n==66729==    by 0x5F6342: _PyFunction_Vectorcall (in /usr/bin/python3.8)\n==66729==    by 0x56BF08: _PyEval_EvalFrameDefault (in /usr/bin/python3.8)\n==66729==    by 0x56A0B9: _PyEval_EvalCodeWithName (in /usr/bin/python3.8)\n==66729==    by 0x5F6342: _PyFunction_Vectorcall (in /usr/bin/python3.8)\n==66729==  Block was alloc'd at\n==66729==    at 0x483B873: malloc (vg_replace_malloc.c:299)\n==66729==    by 0x5C03224: sig_malloc (memory_allocator.c:2580)\n==66729==    by 0x5C03224: __pyx_f_16memory_allocator_6memory_check_allocarray (memory_allocator.c:2956)\n==66729==    by 0x5C03224: __pyx_f_16memory_allocator_16memory_allocator_15MemoryAllocator_allocarray (memory_allocator.c:1831)\n==66729==    by 0x4861189: __pyx_f_16memory_allocator_16memory_allocator_15MemoryAllocator_aligned_allocarray (test.c:3572)\n==66729==    by 0x4861189: __pyx_pf_16memory_allocator_4test_19TestMemoryAllocator_16aligned_allocarray (test.c:2394)\n==66729==    by 0x4861189: __pyx_pw_16memory_allocator_4test_19TestMemoryAllocator_17aligned_allocarray (test.c:2363)\n==66729==    by 0x503EA8: ??? (in /usr/bin/python3.8)\n==66729==    by 0x56BF08: _PyEval_EvalFrameDefault (in /usr/bin/python3.8)\n==66729==    by 0x56A0B9: _PyEval_EvalCodeWithName (in /usr/bin/python3.8)\n==66729==    by 0x68D5B6: PyEval_EvalCode (in /usr/bin/python3.8)\n==66729==    by 0x600F53: ??? (in /usr/bin/python3.8)\n==66729==    by 0x5C552F: ??? (in /usr/bin/python3.8)\n==66729==    by 0x56BDDC: _PyEval_EvalFrameDefault (in /usr/bin/python3.8)\n==66729==    by 0x5F6165: _PyFunction_Vectorcall (in /usr/bin/python3.8)\n==66729==    by 0x56BF08: _PyEval_EvalFrameDefault (in /usr/bin/python3.8)\n```\n\n\nAnd it is not deterministic:\n\n\n```\n==66727==  Address 0x6e7e020 is 96 bytes inside a block of size 1,600 free'd\n==66727==    at 0x483CABF: free (vg_replace_malloc.c:530)\n==66727==    by 0x5C01888: sig_free (memory_allocator.c:2764)\n==66727==    by 0x5C01888: __pyx_pf_16memory_allocator_16memory_allocator_15MemoryAllocator_2__dealloc__ (memory_allocator.c:2078)\n==66727==    by 0x5C01888: __pyx_pw_16memory_allocator_16memory_allocator_15MemoryAllocator_3__dealloc__ (memory_allocator.c:2044)\n==66727==    by 0x5C01888: __pyx_tp_dealloc_16memory_allocator_16memory_allocator_MemoryAllocator (memory_allocator.c:3652)\n==66727==    by 0x4859D9C: _Py_DECREF (object.h:478)\n==66727==    by 0x4859D9C: __pyx_tp_dealloc_16memory_allocator_4test_TestMemoryAllocator (test.c:3615)\n==66727==    by 0x5CF74A: PyDict_Clear (in /usr/bin/python3.8)\n==66727==    by 0x6A9C09: ??? (in /usr/bin/python3.8)\n==66727==    by 0x5045DA: ??? (in /usr/bin/python3.8)\n==66727==    by 0x56BF08: _PyEval_EvalFrameDefault (in /usr/bin/python3.8)\n==66727==    by 0x56A0B9: _PyEval_EvalCodeWithName (in /usr/bin/python3.8)\n==66727==    by 0x5F6342: _PyFunction_Vectorcall (in /usr/bin/python3.8)\n==66727==    by 0x56BF08: _PyEval_EvalFrameDefault (in /usr/bin/python3.8)\n==66727==    by 0x56A0B9: _PyEval_EvalCodeWithName (in /usr/bin/python3.8)\n==66727==    by 0x5F6342: _PyFunction_Vectorcall (in /usr/bin/python3.8)\n==66727==  Block was alloc'd at\n==66727==    at 0x483DE1A: calloc (vg_replace_malloc.c:752)\n==66727==    by 0x5C03798: sig_calloc (memory_allocator.c:2704)\n==66727==    by 0x5C03798: __pyx_f_16memory_allocator_6memory_check_calloc (memory_allocator.c:3540)\n==66727==    by 0x5C03798: __pyx_f_16memory_allocator_16memory_allocator_15MemoryAllocator_calloc (memory_allocator.c:1748)\n==66727==    by 0x48620F9: __pyx_f_16memory_allocator_16memory_allocator_15MemoryAllocator_aligned_calloc (test.c:3514)\n==66727==    by 0x48620F9: __pyx_pf_16memory_allocator_4test_19TestMemoryAllocator_14aligned_calloc (test.c:2260)\n==66727==    by 0x48620F9: __pyx_pw_16memory_allocator_4test_19TestMemoryAllocator_15aligned_calloc (test.c:2229)\n==66727==    by 0x503EA8: ??? (in /usr/bin/python3.8)\n==66727==    by 0x56BF08: _PyEval_EvalFrameDefault (in /usr/bin/python3.8)\n==66727==    by 0x56A0B9: _PyEval_EvalCodeWithName (in /usr/bin/python3.8)\n==66727==    by 0x68D5B6: PyEval_EvalCode (in /usr/bin/python3.8)\n==66727==    by 0x600F53: ??? (in /usr/bin/python3.8)\n==66727==    by 0x5C552F: ??? (in /usr/bin/python3.8)\n==66727==    by 0x56BDDC: _PyEval_EvalFrameDefault (in /usr/bin/python3.8)\n==66727==    by 0x5F6165: _PyFunction_Vectorcall (in /usr/bin/python3.8)\n==66727==    by 0x56BF08: _PyEval_EvalFrameDefault (in /usr/bin/python3.8)\n```\n\n\nAt a first glance it looks like its trying to free the aligned memory instead of the memory that was actually allocated.",
    "created_at": "2021-12-12T12:33:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32590#issuecomment-464277",
    "user": "https://github.com/kliem"
}
```

Apparently, there is at least a bug in memory allocator.

Running the test suite, I get


```
==66729==  Address 0x6e7f020 is 528 bytes inside a block of size 800 free'd
==66729==    at 0x483CABF: free (vg_replace_malloc.c:530)
==66729==    by 0x5C01888: sig_free (memory_allocator.c:2764)
==66729==    by 0x5C01888: __pyx_pf_16memory_allocator_16memory_allocator_15MemoryAllocator_2__dealloc__ (memory_allocator.c:2078)
==66729==    by 0x5C01888: __pyx_pw_16memory_allocator_16memory_allocator_15MemoryAllocator_3__dealloc__ (memory_allocator.c:2044)
==66729==    by 0x5C01888: __pyx_tp_dealloc_16memory_allocator_16memory_allocator_MemoryAllocator (memory_allocator.c:3652)
==66729==    by 0x4859D9C: _Py_DECREF (object.h:478)
==66729==    by 0x4859D9C: __pyx_tp_dealloc_16memory_allocator_4test_TestMemoryAllocator (test.c:3615)
==66729==    by 0x5CF74A: PyDict_Clear (in /usr/bin/python3.8)
==66729==    by 0x6A9C09: ??? (in /usr/bin/python3.8)
==66729==    by 0x5045DA: ??? (in /usr/bin/python3.8)
==66729==    by 0x56BF08: _PyEval_EvalFrameDefault (in /usr/bin/python3.8)
==66729==    by 0x56A0B9: _PyEval_EvalCodeWithName (in /usr/bin/python3.8)
==66729==    by 0x5F6342: _PyFunction_Vectorcall (in /usr/bin/python3.8)
==66729==    by 0x56BF08: _PyEval_EvalFrameDefault (in /usr/bin/python3.8)
==66729==    by 0x56A0B9: _PyEval_EvalCodeWithName (in /usr/bin/python3.8)
==66729==    by 0x5F6342: _PyFunction_Vectorcall (in /usr/bin/python3.8)
==66729==  Block was alloc'd at
==66729==    at 0x483B873: malloc (vg_replace_malloc.c:299)
==66729==    by 0x5C03224: sig_malloc (memory_allocator.c:2580)
==66729==    by 0x5C03224: __pyx_f_16memory_allocator_6memory_check_allocarray (memory_allocator.c:2956)
==66729==    by 0x5C03224: __pyx_f_16memory_allocator_16memory_allocator_15MemoryAllocator_allocarray (memory_allocator.c:1831)
==66729==    by 0x4861189: __pyx_f_16memory_allocator_16memory_allocator_15MemoryAllocator_aligned_allocarray (test.c:3572)
==66729==    by 0x4861189: __pyx_pf_16memory_allocator_4test_19TestMemoryAllocator_16aligned_allocarray (test.c:2394)
==66729==    by 0x4861189: __pyx_pw_16memory_allocator_4test_19TestMemoryAllocator_17aligned_allocarray (test.c:2363)
==66729==    by 0x503EA8: ??? (in /usr/bin/python3.8)
==66729==    by 0x56BF08: _PyEval_EvalFrameDefault (in /usr/bin/python3.8)
==66729==    by 0x56A0B9: _PyEval_EvalCodeWithName (in /usr/bin/python3.8)
==66729==    by 0x68D5B6: PyEval_EvalCode (in /usr/bin/python3.8)
==66729==    by 0x600F53: ??? (in /usr/bin/python3.8)
==66729==    by 0x5C552F: ??? (in /usr/bin/python3.8)
==66729==    by 0x56BDDC: _PyEval_EvalFrameDefault (in /usr/bin/python3.8)
==66729==    by 0x5F6165: _PyFunction_Vectorcall (in /usr/bin/python3.8)
==66729==    by 0x56BF08: _PyEval_EvalFrameDefault (in /usr/bin/python3.8)
```


And it is not deterministic:


```
==66727==  Address 0x6e7e020 is 96 bytes inside a block of size 1,600 free'd
==66727==    at 0x483CABF: free (vg_replace_malloc.c:530)
==66727==    by 0x5C01888: sig_free (memory_allocator.c:2764)
==66727==    by 0x5C01888: __pyx_pf_16memory_allocator_16memory_allocator_15MemoryAllocator_2__dealloc__ (memory_allocator.c:2078)
==66727==    by 0x5C01888: __pyx_pw_16memory_allocator_16memory_allocator_15MemoryAllocator_3__dealloc__ (memory_allocator.c:2044)
==66727==    by 0x5C01888: __pyx_tp_dealloc_16memory_allocator_16memory_allocator_MemoryAllocator (memory_allocator.c:3652)
==66727==    by 0x4859D9C: _Py_DECREF (object.h:478)
==66727==    by 0x4859D9C: __pyx_tp_dealloc_16memory_allocator_4test_TestMemoryAllocator (test.c:3615)
==66727==    by 0x5CF74A: PyDict_Clear (in /usr/bin/python3.8)
==66727==    by 0x6A9C09: ??? (in /usr/bin/python3.8)
==66727==    by 0x5045DA: ??? (in /usr/bin/python3.8)
==66727==    by 0x56BF08: _PyEval_EvalFrameDefault (in /usr/bin/python3.8)
==66727==    by 0x56A0B9: _PyEval_EvalCodeWithName (in /usr/bin/python3.8)
==66727==    by 0x5F6342: _PyFunction_Vectorcall (in /usr/bin/python3.8)
==66727==    by 0x56BF08: _PyEval_EvalFrameDefault (in /usr/bin/python3.8)
==66727==    by 0x56A0B9: _PyEval_EvalCodeWithName (in /usr/bin/python3.8)
==66727==    by 0x5F6342: _PyFunction_Vectorcall (in /usr/bin/python3.8)
==66727==  Block was alloc'd at
==66727==    at 0x483DE1A: calloc (vg_replace_malloc.c:752)
==66727==    by 0x5C03798: sig_calloc (memory_allocator.c:2704)
==66727==    by 0x5C03798: __pyx_f_16memory_allocator_6memory_check_calloc (memory_allocator.c:3540)
==66727==    by 0x5C03798: __pyx_f_16memory_allocator_16memory_allocator_15MemoryAllocator_calloc (memory_allocator.c:1748)
==66727==    by 0x48620F9: __pyx_f_16memory_allocator_16memory_allocator_15MemoryAllocator_aligned_calloc (test.c:3514)
==66727==    by 0x48620F9: __pyx_pf_16memory_allocator_4test_19TestMemoryAllocator_14aligned_calloc (test.c:2260)
==66727==    by 0x48620F9: __pyx_pw_16memory_allocator_4test_19TestMemoryAllocator_15aligned_calloc (test.c:2229)
==66727==    by 0x503EA8: ??? (in /usr/bin/python3.8)
==66727==    by 0x56BF08: _PyEval_EvalFrameDefault (in /usr/bin/python3.8)
==66727==    by 0x56A0B9: _PyEval_EvalCodeWithName (in /usr/bin/python3.8)
==66727==    by 0x68D5B6: PyEval_EvalCode (in /usr/bin/python3.8)
==66727==    by 0x600F53: ??? (in /usr/bin/python3.8)
==66727==    by 0x5C552F: ??? (in /usr/bin/python3.8)
==66727==    by 0x56BDDC: _PyEval_EvalFrameDefault (in /usr/bin/python3.8)
==66727==    by 0x5F6165: _PyFunction_Vectorcall (in /usr/bin/python3.8)
==66727==    by 0x56BF08: _PyEval_EvalFrameDefault (in /usr/bin/python3.8)
```


At a first glance it looks like its trying to free the aligned memory instead of the memory that was actually allocated.



---

archive/issue_comments_464278.json:
```json
{
    "body": "there was a bug fixed in #32590, that is merged in 9.5.beta4",
    "created_at": "2021-12-12T13:41:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32590#issuecomment-464278",
    "user": "https://github.com/vbraun"
}
```

there was a bug fixed in #32590, that is merged in 9.5.beta4



---

archive/issue_comments_464279.json:
```json
{
    "body": "Replying to [comment:34 vbraun]:\n> there was a bug fixed in #32590, that is merged in 9.5.beta4\n\nThanks for the reminder. Unfortunatly, this was only a test suite bug.",
    "created_at": "2021-12-12T13:52:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32590#issuecomment-464279",
    "user": "https://github.com/kliem"
}
```

Replying to [comment:34 vbraun]:
> there was a bug fixed in #32590, that is merged in 9.5.beta4

Thanks for the reminder. Unfortunatly, this was only a test suite bug.



---

archive/issue_comments_464280.json:
```json
{
    "body": "My guess is that `528 bytes inside a block of size 800` is too far in for this to be an alignment calculation bug.",
    "created_at": "2021-12-12T14:42:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32590#issuecomment-464280",
    "user": "https://github.com/vbraun"
}
```

My guess is that `528 bytes inside a block of size 800` is too far in for this to be an alignment calculation bug.



---

archive/issue_comments_464281.json:
```json
{
    "body": "Well, the problem only appeared for me when running the test suite on sage's memory_allocator. Not for the memory allocator installed through systems python.\n\nNow, I just ran `make memory_allocator-clean` and I don't get those errors anymore. I'm rerunning sage and will see, if it completely went away.",
    "created_at": "2021-12-13T08:23:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32590#issuecomment-464281",
    "user": "https://github.com/kliem"
}
```

Well, the problem only appeared for me when running the test suite on sage's memory_allocator. Not for the memory allocator installed through systems python.

Now, I just ran `make memory_allocator-clean` and I don't get those errors anymore. I'm rerunning sage and will see, if it completely went away.



---

archive/issue_comments_464282.json:
```json
{
    "body": "Yes, the problem went away. There are various possible conclusions here:\n\n- I don't know how to use valgrind. Very likely. Using `sage --valgrind` seems to be completely useless. Instead I just installed `valgrind` in the system and run\n\n```\nvalgrind --tool=memcheck --leak-check=full --show-leak-kinds=all python3 foo.py\n```\n\n  within the sage shell on various test files. This gives lots and lots of errors. Among them those errors listed above. But they seem to be gone now.\n  If I just run\n\n```\n   valgrind --tool=memcheck --leak-check=full --show-leak-kinds=all sage -t --long $SAGE_SRC/sage/geometry/polyhedron/combinatorial_polyhedron/\n```\n\n  I don't get useful output at all.\n- This problem actually goes away by running `make memory-allocator_clean` for whatever reason.\n- This problem is elsewhere. E.g. #32827#comment:30, but possibly somewhere else as well.",
    "created_at": "2021-12-13T09:33:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32590#issuecomment-464282",
    "user": "https://github.com/kliem"
}
```

Yes, the problem went away. There are various possible conclusions here:

- I don't know how to use valgrind. Very likely. Using `sage --valgrind` seems to be completely useless. Instead I just installed `valgrind` in the system and run

```
valgrind --tool=memcheck --leak-check=full --show-leak-kinds=all python3 foo.py
```

  within the sage shell on various test files. This gives lots and lots of errors. Among them those errors listed above. But they seem to be gone now.
  If I just run

```
   valgrind --tool=memcheck --leak-check=full --show-leak-kinds=all sage -t --long $SAGE_SRC/sage/geometry/polyhedron/combinatorial_polyhedron/
```

  I don't get useful output at all.
- This problem actually goes away by running `make memory-allocator_clean` for whatever reason.
- This problem is elsewhere. E.g. #32827#comment:30, but possibly somewhere else as well.



---

archive/issue_comments_464283.json:
```json
{
    "body": "Can we split the ticket in two tickets :\n\n- about moving `__init__` to `__cinit__` (current branch)\n- about memory allocator\n\nIf this is doable and the current branch can be merged soon, i will be able to restart my patchbots.",
    "created_at": "2021-12-13T14:19:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32590#issuecomment-464283",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Can we split the ticket in two tickets :

- about moving `__init__` to `__cinit__` (current branch)
- about memory allocator

If this is doable and the current branch can be merged soon, i will be able to restart my patchbots.



---

archive/issue_comments_464284.json:
```json
{
    "body": "I'm not sure that Volker will accept such a split. From what I understand from #32827#comment:28 he rejected the proposed changes not because they do not fix it, but because they lead to a new failure.\n\nWhat might not work is passing `MemoryAllocator` as an argument to functions for it to allocate memory. But I don't know. I could remove the usage of `MemoryAllocator` from bitsets alltogether and hope that this fixes something.\n\nAnother thing that should be fixed is the following: Currently `face_list_t` is only one type and depending on the context it is a shallow copy or not. This is not good practice. Instead one could use `fused_types` again to have a shallow list and a deep list. Depending on the type of the destination `face_list_copy` would then just to the correct thing and same with `face_list_init`.",
    "created_at": "2021-12-14T12:15:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32590#issuecomment-464284",
    "user": "https://github.com/kliem"
}
```

I'm not sure that Volker will accept such a split. From what I understand from #32827#comment:28 he rejected the proposed changes not because they do not fix it, but because they lead to a new failure.

What might not work is passing `MemoryAllocator` as an argument to functions for it to allocate memory. But I don't know. I could remove the usage of `MemoryAllocator` from bitsets alltogether and hope that this fixes something.

Another thing that should be fixed is the following: Currently `face_list_t` is only one type and depending on the context it is a shallow copy or not. This is not good practice. Instead one could use `fused_types` again to have a shallow list and a deep list. Depending on the type of the destination `face_list_copy` would then just to the correct thing and same with `face_list_init`.



---

archive/issue_comments_464285.json:
```json
{
    "body": "I don't have a full understanding of the code, but it's surprising to see methods with `MemoryAllocator` as parameter and also the use of tuple `_mem_tuple` to store several memory allocators. Is it really better this way ? Does it help reducing memory consumption significantly ?",
    "created_at": "2021-12-14T12:29:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32590#issuecomment-464285",
    "user": "https://github.com/dcoudert"
}
```

I don't have a full understanding of the code, but it's surprising to see methods with `MemoryAllocator` as parameter and also the use of tuple `_mem_tuple` to store several memory allocators. Is it really better this way ? Does it help reducing memory consumption significantly ?



---

archive/issue_comments_464286.json:
```json
{
    "body": "No, its purpose was not to reduce memory consumption, but to make it easier to take care of the resources. Apparently it is not working.",
    "created_at": "2021-12-14T12:34:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32590#issuecomment-464286",
    "user": "https://github.com/kliem"
}
```

No, its purpose was not to reduce memory consumption, but to make it easier to take care of the resources. Apparently it is not working.



---

archive/issue_comments_464287.json:
```json
{
    "body": "OK, i will keep `tmonteil-lxc1` and `tmonteil-lxc3` patchbots in their current state until this ticket is merged.",
    "created_at": "2021-12-14T12:39:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32590#issuecomment-464287",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

OK, i will keep `tmonteil-lxc1` and `tmonteil-lxc3` patchbots in their current state until this ticket is merged.



---

archive/issue_comments_464288.json:
```json
{
    "body": "Replying to [comment:42 gh-kliem]:\n> No, its purpose was not to reduce memory consumption, but to make it easier to take care of the resources. Apparently it is not working.\n\nThen you can have a single memory allocator for the class, except for methods where allocated objects are local.",
    "created_at": "2021-12-14T12:42:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32590#issuecomment-464288",
    "user": "https://github.com/dcoudert"
}
```

Replying to [comment:42 gh-kliem]:
> No, its purpose was not to reduce memory consumption, but to make it easier to take care of the resources. Apparently it is not working.

Then you can have a single memory allocator for the class, except for methods where allocated objects are local.



---

archive/issue_comments_464289.json:
```json
{
    "body": "This would still involve some work regarding interrupts. Currently I use the tuple to only keep the memory after success.",
    "created_at": "2021-12-14T13:00:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32590#issuecomment-464289",
    "user": "https://github.com/kliem"
}
```

This would still involve some work regarding interrupts. Currently I use the tuple to only keep the memory after success.



---

archive/issue_comments_464290.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-12-15T14:35:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32590#issuecomment-464290",
    "user": "https://github.com/kliem"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_464291.json:
```json
{
    "body": "Ok, new try. I completely removed the usage of `MemoryAllocator` as argument, hoping that this solves our problem.\n\nA future change would be to distinguish between `deep_face_list_t` and `shallow_face_list_t` (or similar). This would further clean up code. However, I hope it works now.\n\n(It requires slightly more memory now to run the face iterator, as the coatoms are deep copied now, such that all of `FaceIterator.new_faces[i]` are of the same type, namely deeply allocated face lists.)\n----\nNew commits:",
    "created_at": "2021-12-15T14:35:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32590#issuecomment-464291",
    "user": "https://github.com/kliem"
}
```

Ok, new try. I completely removed the usage of `MemoryAllocator` as argument, hoping that this solves our problem.

A future change would be to distinguish between `deep_face_list_t` and `shallow_face_list_t` (or similar). This would further clean up code. However, I hope it works now.

(It requires slightly more memory now to run the face iterator, as the coatoms are deep copied now, such that all of `FaceIterator.new_faces[i]` are of the same type, namely deeply allocated face lists.)
----
New commits:



---

archive/issue_comments_464292.json:
```json
{
    "body": "So the patchbot seems somewhat happy and complains about coverage.\n\nI will add doctests for `__dealloc__` illustrating that an error during initialization does not result in segmentation fault.\n\nAlso I will remove the hacks that tell us how far initialization worked out. This can be seen be properly setting values to zero.",
    "created_at": "2021-12-16T15:25:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32590#issuecomment-464292",
    "user": "https://github.com/kliem"
}
```

So the patchbot seems somewhat happy and complains about coverage.

I will add doctests for `__dealloc__` illustrating that an error during initialization does not result in segmentation fault.

Also I will remove the hacks that tell us how far initialization worked out. This can be seen be properly setting values to zero.



---

archive/issue_comments_464293.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-12-16T15:25:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32590#issuecomment-464293",
    "user": "https://github.com/kliem"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_464294.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-12-16T18:25:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32590#issuecomment-464294",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_464295.json:
```json
{
    "body": "Should be cleaner now.",
    "created_at": "2021-12-16T18:26:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32590#issuecomment-464295",
    "user": "https://github.com/kliem"
}
```

Should be cleaner now.



---

archive/issue_comments_464296.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-12-16T18:26:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32590#issuecomment-464296",
    "user": "https://github.com/kliem"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_464297.json:
```json
{
    "body": "One bot is happy and just reports to random failures:\n- #32782#comment:10\n- #33039",
    "created_at": "2021-12-17T15:32:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32590#issuecomment-464297",
    "user": "https://github.com/kliem"
}
```

One bot is happy and just reports to random failures:
- #32782#comment:10
- #33039



---

archive/issue_comments_464298.json:
```json
{
    "body": "With the last branch, on `tmonteil-lxc3`, the doctests of `src/sage/geometry/polyhedron/` pass, and all the previous tests that you let me try in that ticket that do not involve `MemoryAllocator` pass as well.",
    "created_at": "2021-12-18T00:47:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32590#issuecomment-464298",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

With the last branch, on `tmonteil-lxc3`, the doctests of `src/sage/geometry/polyhedron/` pass, and all the previous tests that you let me try in that ticket that do not involve `MemoryAllocator` pass as well.



---

archive/issue_comments_464299.json:
```json
{
    "body": "The tests on GH Actions that have completed so far also look good.",
    "created_at": "2021-12-18T04:00:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32590#issuecomment-464299",
    "user": "https://github.com/mkoeppe"
}
```

The tests on GH Actions that have completed so far also look good.



---

archive/issue_comments_464300.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-12-18T04:00:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32590#issuecomment-464300",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_464301.json:
```json
{
    "body": "Thank you.",
    "created_at": "2021-12-18T09:48:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32590#issuecomment-464301",
    "user": "https://github.com/kliem"
}
```

Thank you.



---

archive/issue_comments_464302.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-12-23T20:26:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32590#issuecomment-464302",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_464303.json:
```json
{
    "body": "This is still borked on 32-bit, I've made #33073 as a follow-up.",
    "created_at": "2021-12-23T20:35:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32590#issuecomment-464303",
    "user": "https://github.com/vbraun"
}
```

This is still borked on 32-bit, I've made #33073 as a follow-up.
