# Issue 18770: refactor_centrality_closeness

archive/issues_018770.json:
```json
{
    "body": "CC:  @nathanncohen @dcoudert\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/19007\n\n",
    "created_at": "2015-08-10T08:08:44Z",
    "labels": [],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.9",
    "title": "refactor_centrality_closeness",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18770",
    "user": "https://trac.sagemath.org/admin/accounts/users/borassi"
}
```
CC:  @nathanncohen @dcoudert



Issue created by migration from https://trac.sagemath.org/ticket/19007





---

archive/issue_comments_255999.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to graph theory.",
    "created_at": "2015-08-10T09:38:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18770#issuecomment-255999",
    "user": "https://trac.sagemath.org/admin/accounts/users/borassi"
}
```

Changing component from PLEASE CHANGE to graph theory.



---

archive/issue_comments_256000.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to enhancement.",
    "created_at": "2015-08-10T09:38:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18770#issuecomment-256000",
    "user": "https://trac.sagemath.org/admin/accounts/users/borassi"
}
```

Changing type from PLEASE CHANGE to enhancement.



---

archive/issue_comments_256001.json:
```json
{
    "body": "Changing keywords from \"\" to \"Closeness centrality\".",
    "created_at": "2015-08-10T09:38:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18770#issuecomment-256001",
    "user": "https://trac.sagemath.org/admin/accounts/users/borassi"
}
```

Changing keywords from "" to "Closeness centrality".



---

archive/issue_comments_256002.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-08-13T16:54:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18770#issuecomment-256002",
    "user": "https://trac.sagemath.org/admin/accounts/users/borassi"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_256003.json:
```json
{
    "body": "Hello!\n\nThis is the first version of the refactoring of closeness_centrality. Let me know if you like it!",
    "created_at": "2015-08-13T16:54:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18770#issuecomment-256003",
    "user": "https://trac.sagemath.org/admin/accounts/users/borassi"
}
```

Hello!

This is the first version of the refactoring of closeness_centrality. Let me know if you like it!



---

archive/issue_comments_256004.json:
```json
{
    "body": "I don't really understand what you are doing in this commit\nhttp://git.sagemath.org/sage.git/commit/?h=5c85793ccb8234ac668173620523f45dbae4b985\n\nIn the ticket description you say that you will move everything in `generic_graph`, but it might be more readable/clean to create a new file for centrality measures, no?\nAlso, you moved only references to the methods, right? (or the modifications are hidden in the merge with #18931).\n\n```\n+            - :meth:`~sage.graphs.graph.Graph.centrality_degree`\n+            - :meth:`~centrality_betweenness`\n```\n\nDavid.",
    "created_at": "2015-08-13T17:47:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18770#issuecomment-256004",
    "user": "https://github.com/dcoudert"
}
```

I don't really understand what you are doing in this commit
http://git.sagemath.org/sage.git/commit/?h=5c85793ccb8234ac668173620523f45dbae4b985

In the ticket description you say that you will move everything in `generic_graph`, but it might be more readable/clean to create a new file for centrality measures, no?
Also, you moved only references to the methods, right? (or the modifications are hidden in the merge with #18931).

```
+            - :meth:`~sage.graphs.graph.Graph.centrality_degree`
+            - :meth:`~centrality_betweenness`
```

David.



---

archive/issue_comments_256005.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-08-14T09:48:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18770#issuecomment-256005",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_256006.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-08-14T10:13:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18770#issuecomment-256006",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_256007.json:
```json
{
    "body": "Hello!\n\nThank you for the comment, I will try to address the main issues raised.\n\nI have put everything in a single commit, which simply removes the closeness centrality routine from `graph.py` and rewrites it in `generic_graph.py`. Now the ticket should be much easier to review. Since closeness centrality highly depends on shortest paths, the new routine follows all conventions in ticket #18931.\n\nAbout the creation of a new file: we already have file `centrality.pyx`, containing fast algorithms for betweenness centrality. However, these routines are called from a `centrality_betweenness` routine in file `generic_graph.py`, which should be used by the user. In this ticket, I just copied this policy.\n\nIn my opinion, if we want to create a new file, we should at least move also betweenness centrality and degree centrality: in my opinion, this goes beyond the scope of this ticket. Do you agree?\n\nBest,\n\nMichele\n\nReplying to [comment:4 dcoudert]:\n\n> I don't really understand what you are doing in this commit\n> http://git.sagemath.org/sage.git/commit/?h=5c85793ccb8234ac668173620523f45dbae4b985\n> \n> In the ticket description you say that you will move everything in `generic_graph`, but it might be more readable/clean to create a new file for centrality measures, no?\n> Also, you moved only references to the methods, right? (or the modifications are hidden in the merge with #18931).\n> \n> ```\n> +            - :meth:`~sage.graphs.graph.Graph.centrality_degree`\n> +            - :meth:`~centrality_betweenness`\n> ```\n> \n> David.",
    "created_at": "2015-08-14T12:25:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18770#issuecomment-256007",
    "user": "https://trac.sagemath.org/admin/accounts/users/borassi"
}
```

Hello!

Thank you for the comment, I will try to address the main issues raised.

I have put everything in a single commit, which simply removes the closeness centrality routine from `graph.py` and rewrites it in `generic_graph.py`. Now the ticket should be much easier to review. Since closeness centrality highly depends on shortest paths, the new routine follows all conventions in ticket #18931.

About the creation of a new file: we already have file `centrality.pyx`, containing fast algorithms for betweenness centrality. However, these routines are called from a `centrality_betweenness` routine in file `generic_graph.py`, which should be used by the user. In this ticket, I just copied this policy.

In my opinion, if we want to create a new file, we should at least move also betweenness centrality and degree centrality: in my opinion, this goes beyond the scope of this ticket. Do you agree?

Best,

Michele

Replying to [comment:4 dcoudert]:

> I don't really understand what you are doing in this commit
> http://git.sagemath.org/sage.git/commit/?h=5c85793ccb8234ac668173620523f45dbae4b985
> 
> In the ticket description you say that you will move everything in `generic_graph`, but it might be more readable/clean to create a new file for centrality measures, no?
> Also, you moved only references to the methods, right? (or the modifications are hidden in the merge with #18931).
> 
> ```
> +            - :meth:`~sage.graphs.graph.Graph.centrality_degree`
> +            - :meth:`~centrality_betweenness`
> ```
> 
> David.



---

archive/issue_comments_256008.json:
```json
{
    "body": "Something is wrong here\n\n```\n+            try:\n+                v_iter = iter(vert)\n+            except TypeError:\n+                v_iter = [v_iter]\n+                v_iter = iter(vert)\n```\nI assume you want first to have `v_vert = iter(list(vert))\n\nThe default of calling `distances = self.shortest_path_all_pairs(by_weight,algorithm, weight_function, check_weight)[0]` is that you get a dictionary of dictionary, that is a huge data structure for large graphs (lost of memory and long to create). At least the second part of this method should be cythonized to get the array of distances, as is done for `centrality_betweenness`.\n\nDavid.",
    "created_at": "2015-08-14T15:14:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18770#issuecomment-256008",
    "user": "https://github.com/dcoudert"
}
```

Something is wrong here

```
+            try:
+                v_iter = iter(vert)
+            except TypeError:
+                v_iter = [v_iter]
+                v_iter = iter(vert)
```
I assume you want first to have `v_vert = iter(list(vert))

The default of calling `distances = self.shortest_path_all_pairs(by_weight,algorithm, weight_function, check_weight)[0]` is that you get a dictionary of dictionary, that is a huge data structure for large graphs (lost of memory and long to create). At least the second part of this method should be cythonized to get the array of distances, as is done for `centrality_betweenness`.

David.



---

archive/issue_comments_256009.json:
```json
{
    "body": "> Something is wrong here\n> \n> ```\n> +            try:\n> +                v_iter = iter(vert)\n> +            except TypeError:\n> +                v_iter = [v_iter]\n> +                v_iter = iter(vert)\n> ```\n\n\n+1.\n\nIn some cases a vertex can be a pair, and thus is iterable. This would react badly with this code.\n\n```\nsage: g=graphs.KneserGraph(5,2)\nsage: v=g.vertices()[0]\nsage: g.centrality_closeness(v)\n<crash>\n```\n\nNathann",
    "created_at": "2015-08-14T15:18:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18770#issuecomment-256009",
    "user": "https://github.com/nathanncohen"
}
```

> Something is wrong here
> 
> ```
> +            try:
> +                v_iter = iter(vert)
> +            except TypeError:
> +                v_iter = [v_iter]
> +                v_iter = iter(vert)
> ```


+1.

In some cases a vertex can be a pair, and thus is iterable. This would react badly with this code.

```
sage: g=graphs.KneserGraph(5,2)
sage: v=g.vertices()[0]
sage: g.centrality_closeness(v)
<crash>
```

Nathann



---

archive/issue_comments_256010.json:
```json
{
    "body": "Right. My previous proposal is not a good solution.\nSomething like that might also be unsafe if some labels in `vert` are not in `G`, but this can be checked when trying to associate computed values and vertices.\n\n```\nv_vert = iter([vert]) if vert in G else iter(vert)\n```",
    "created_at": "2015-08-14T15:45:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18770#issuecomment-256010",
    "user": "https://github.com/dcoudert"
}
```

Right. My previous proposal is not a good solution.
Something like that might also be unsafe if some labels in `vert` are not in `G`, but this can be checked when trying to associate computed values and vertices.

```
v_vert = iter([vert]) if vert in G else iter(vert)
```



---

archive/issue_comments_256011.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-08-16T16:43:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18770#issuecomment-256011",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_256012.json:
```json
{
    "body": "Hello!\n\nI hope you spent a great Assumption day!\n\nWith this new commit, (hopefully) I solved the problems with\u00a0`v_vert`  and I cythonized the Johnson algorithm. In my opinion, it is not worth  cythonizing Floyd-Warshall, because it is much slower than Johnson,  especially on sparse graphs.\n\nThank you very much!\n\nMichele",
    "created_at": "2015-08-16T16:46:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18770#issuecomment-256012",
    "user": "https://trac.sagemath.org/admin/accounts/users/borassi"
}
```

Hello!

I hope you spent a great Assumption day!

With this new commit, (hopefully) I solved the problems withÂ `v_vert`  and I cythonized the Johnson algorithm. In my opinion, it is not worth  cythonizing Floyd-Warshall, because it is much slower than Johnson,  especially on sparse graphs.

Thank you very much!

Michele



---

archive/issue_comments_256013.json:
```json
{
    "body": "Hello,\n\nI'm trying to understand the behavior of the method on digraphs.\nYou wrote that the centrality of vertices of degree 0 is not reported. Does it means that for digraphs you don't report the centrality of vertices with out-degree 0?\nAlso, what's the expected behavior on strongly connected digraphs?\n\nDavid.",
    "created_at": "2015-08-17T09:41:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18770#issuecomment-256013",
    "user": "https://github.com/dcoudert"
}
```

Hello,

I'm trying to understand the behavior of the method on digraphs.
You wrote that the centrality of vertices of degree 0 is not reported. Does it means that for digraphs you don't report the centrality of vertices with out-degree 0?
Also, what's the expected behavior on strongly connected digraphs?

David.



---

archive/issue_comments_256014.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-08-17T11:09:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18770#issuecomment-256014",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_256015.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-08-17T11:09:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18770#issuecomment-256015",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_256016.json:
```json
{
    "body": "Hello!\n\nI tried to improve the documentation, answering your questions.\n\nMichele\n\nReplying to [comment:13 dcoudert]:\n\n> You wrote that the centrality of vertices of degree 0 is not reported. Does it means that for digraphs you don't report the centrality of vertices with out-degree 0?\n\n\nYes, I changed in the documentation \"degree\" with \"(out)degree\"\n\n> Also, what's the expected behavior on strongly connected digraphs?\n\n\nThe closeness centrality of a vertex v is 1/farn(v), where farn(v) is the average distance between v and a random vertex w different from v (as in the case of connected graphs). I added an example about this.",
    "created_at": "2015-08-17T11:13:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18770#issuecomment-256016",
    "user": "https://trac.sagemath.org/admin/accounts/users/borassi"
}
```

Hello!

I tried to improve the documentation, answering your questions.

Michele

Replying to [comment:13 dcoudert]:

> You wrote that the centrality of vertices of degree 0 is not reported. Does it means that for digraphs you don't report the centrality of vertices with out-degree 0?


Yes, I changed in the documentation "degree" with "(out)degree"

> Also, what's the expected behavior on strongly connected digraphs?


The closeness centrality of a vertex v is 1/farn(v), where farn(v) is the average distance between v and a random vertex w different from v (as in the case of connected graphs). I added an example about this.



---

archive/issue_comments_256017.json:
```json
{
    "body": "Hello,\n\nThis is much better now. The method works well, passes all tests and the doc build properly.\n\nOne possible modification is to move the method to file `centrality.pyx` which is made for  gathering centrality methods. Let me know.\n\nBest,\nDavid.",
    "created_at": "2015-08-17T12:03:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18770#issuecomment-256017",
    "user": "https://github.com/dcoudert"
}
```

Hello,

This is much better now. The method works well, passes all tests and the doc build properly.

One possible modification is to move the method to file `centrality.pyx` which is made for  gathering centrality methods. Let me know.

Best,
David.



---

archive/issue_comments_256018.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-08-17T14:23:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18770#issuecomment-256018",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_256019.json:
```json
{
    "body": "Done!\n\nHowever, I had to do some \"magic\" to avoid duplicate references... Hope it is ok!",
    "created_at": "2015-08-17T14:30:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18770#issuecomment-256019",
    "user": "https://trac.sagemath.org/admin/accounts/users/borassi"
}
```

Done!

However, I had to do some "magic" to avoid duplicate references... Hope it is ok!



---

archive/issue_comments_256020.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-08-17T15:11:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18770#issuecomment-256020",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_256021.json:
```json
{
    "body": "Yep, I add to `make doc-clean && make doc` to get it compiled.\n\nI just saw in the doc of `centrality_degree` in `graph.py`, in section See also, that the link to `centrality_closeness` is broken. In fact, the code is `:meth:`centrality_closeness``. Could you check that?\nIn fact we should also move this methode to `centrality.pyx`, but in another ticket.\n\nAfter that I think it will be ok.\n\nDavid.",
    "created_at": "2015-08-17T17:23:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18770#issuecomment-256021",
    "user": "https://github.com/dcoudert"
}
```

Yep, I add to `make doc-clean && make doc` to get it compiled.

I just saw in the doc of `centrality_degree` in `graph.py`, in section See also, that the link to `centrality_closeness` is broken. In fact, the code is `:meth:`centrality_closeness``. Could you check that?
In fact we should also move this methode to `centrality.pyx`, but in another ticket.

After that I think it will be ok.

David.



---

archive/issue_comments_256022.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-08-18T07:46:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18770#issuecomment-256022",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_256023.json:
```json
{
    "body": "Done!",
    "created_at": "2015-08-18T07:46:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18770#issuecomment-256023",
    "user": "https://trac.sagemath.org/admin/accounts/users/borassi"
}
```

Done!



---

archive/issue_comments_256024.json:
```json
{
    "body": "Hello,\n\ndo you understand why the patchbot reports some errors?\nI have no error when testing this patch on my computer (install, long tests, trials, docbuild html et pdf,...).\n\nBest,\nDavid.",
    "created_at": "2015-08-18T09:29:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18770#issuecomment-256024",
    "user": "https://github.com/dcoudert"
}
```

Hello,

do you understand why the patchbot reports some errors?
I have no error when testing this patch on my computer (install, long tests, trials, docbuild html et pdf,...).

Best,
David.



---

archive/issue_comments_256025.json:
```json
{
    "body": "What is the patchbot? How can I find these errors?",
    "created_at": "2015-08-18T09:30:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18770#issuecomment-256025",
    "user": "https://trac.sagemath.org/admin/accounts/users/borassi"
}
```

What is the patchbot? How can I find these errors?



---

archive/issue_comments_256026.json:
```json
{
    "body": "on the top of this page, you can see a blue disk (or red or green, etc.) with a link to http://patchbot.sagemath.org/ticket/19007/\nIt reports on automatic tests of your patch. Tests are performed on all modules.",
    "created_at": "2015-08-18T09:33:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18770#issuecomment-256026",
    "user": "https://github.com/dcoudert"
}
```

on the top of this page, you can see a blue disk (or red or green, etc.) with a link to http://patchbot.sagemath.org/ticket/19007/
It reports on automatic tests of your patch. Tests are performed on all modules.



---

archive/issue_comments_256027.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-08-18T12:21:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18770#issuecomment-256027",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_256028.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-08-18T12:25:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18770#issuecomment-256028",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_256029.json:
```json
{
    "body": "Note that the patchbot needs a lot of time: it is not tested instantaneously and it takes some hours of computations...",
    "created_at": "2015-08-18T12:27:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18770#issuecomment-256029",
    "user": "https://github.com/dcoudert"
}
```

Note that the patchbot needs a lot of time: it is not tested instantaneously and it takes some hours of computations...



---

archive/issue_comments_256030.json:
```json
{
    "body": "Ok, I will wait until it answers... In my opinion, the problem is that we need to import centrality.pyx in generic_graph at startup, and this slows down the startup time. I tried to change the imports, hoping the total time will decrease. If any of the two attempts work, we are fine, otherwise I probably have to mail sage-devel...",
    "created_at": "2015-08-18T12:31:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18770#issuecomment-256030",
    "user": "https://trac.sagemath.org/admin/accounts/users/borassi"
}
```

Ok, I will wait until it answers... In my opinion, the problem is that we need to import centrality.pyx in generic_graph at startup, and this slows down the startup time. I tried to change the imports, hoping the total time will decrease. If any of the two attempts work, we are fine, otherwise I probably have to mail sage-devel...



---

archive/issue_comments_256031.json:
```json
{
    "body": "Well, generic graph is becoming really really big with lots of tests.\nFor instance, do we really need the tests with `for i in range(100): `. Can't we have only one test we randomly chosen number of edges? That should be enough.\n\nDavid.",
    "created_at": "2015-08-18T12:37:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18770#issuecomment-256031",
    "user": "https://github.com/dcoudert"
}
```

Well, generic graph is becoming really really big with lots of tests.
For instance, do we really need the tests with `for i in range(100): `. Can't we have only one test we randomly chosen number of edges? That should be enough.

David.



---

archive/issue_comments_256032.json:
```json
{
    "body": "I'm afraid that all the attempts I have made were unsuccessful. The point is that importing module `centrality.pyx` at startup is expensive, and I need it to import it to add method `centrality_closeness` to `GenericGraph`. Hence, the startup time becomes 2 seconds (too much).\n\nIn my opinion, this might be a reason why it is better to leave method `centrality_closeness` in `generic_graph`, and put only Cython-related methods inside `centrality.pyx`, in order to use lazy imports. May I move method centrality_closeness back?\n\nIf we still want to move `centrality_closeness` and related methods to `centrality.pyx`, I think we should open another ticket, in order to find a way to use lazy imports (I have no idea how, though).",
    "created_at": "2015-08-19T09:58:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18770#issuecomment-256032",
    "user": "https://trac.sagemath.org/admin/accounts/users/borassi"
}
```

I'm afraid that all the attempts I have made were unsuccessful. The point is that importing module `centrality.pyx` at startup is expensive, and I need it to import it to add method `centrality_closeness` to `GenericGraph`. Hence, the startup time becomes 2 seconds (too much).

In my opinion, this might be a reason why it is better to leave method `centrality_closeness` in `generic_graph`, and put only Cython-related methods inside `centrality.pyx`, in order to use lazy imports. May I move method centrality_closeness back?

If we still want to move `centrality_closeness` and related methods to `centrality.pyx`, I think we should open another ticket, in order to find a way to use lazy imports (I have no idea how, though).



---

archive/issue_comments_256033.json:
```json
{
    "body": "ok, move it back to generic graph.\nDavid.",
    "created_at": "2015-08-19T10:01:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18770#issuecomment-256033",
    "user": "https://github.com/dcoudert"
}
```

ok, move it back to generic graph.
David.



---

archive/issue_comments_256034.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-08-19T12:55:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18770#issuecomment-256034",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_256035.json:
```json
{
    "body": "For me the patch is good to go, but I prefer to wait for the next patchbot answer.\nDavid.",
    "created_at": "2015-08-19T13:03:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18770#issuecomment-256035",
    "user": "https://github.com/dcoudert"
}
```

For me the patch is good to go, but I prefer to wait for the next patchbot answer.
David.



---

archive/issue_comments_256036.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-08-20T06:34:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18770#issuecomment-256036",
    "user": "https://github.com/dcoudert"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_256037.json:
```json
{
    "body": "Since the patchbot reports no error and that the patch passes all tests/docbuild/etc. on my computer, I set it to positive review.\nThanks.\nDavid.",
    "created_at": "2015-08-20T06:34:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18770#issuecomment-256037",
    "user": "https://github.com/dcoudert"
}
```

Since the patchbot reports no error and that the patch passes all tests/docbuild/etc. on my computer, I set it to positive review.
Thanks.
David.



---

archive/issue_events_052920.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-08-21T01:56:20Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/18770",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18770#event-52920"
}
```



---

archive/issue_comments_256038.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-08-21T01:56:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18770#issuecomment-256038",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
