# Issue 28484: Document sage-dist-helpers

Issue created by migration from https://trac.sagemath.org/ticket/28721

Original creator: jhpalmieri

Original creation time: 2019-11-12 04:15:06

Document the bash functions `sdh_make` and friends in the Sage developer's guide. (Currently they are only documented in their source file, `build/bin/sage-dist-helpers`.)


---

Comment by jhpalmieri created at 2019-11-12 04:15:56

Changing status from new to needs_review.


---

Comment by jhpalmieri created at 2019-11-12 04:15:56

New commits:


---

Comment by dimpase created at 2019-11-12 09:28:59

The pattern `sdh_XYZ || sdh_die ...` one sees in few places is not necessary, and `sdh_XYZ` alone suffices, isn't it?

By looking at the code of e.g. `sdh_configure`
one sees that `sdh_die` is actually called in `sdh_configure`, and so chaining them
as above is pointless (the part after `||` won't be called).

This should be mentioned in the docs.


---

Comment by embray created at 2019-11-12 14:05:16

By the way, there was already a ticket for this task at #24023.

Something I wanted to do for that was to have a way to automatically include the in-line docs in `sage-dist-helpers` into the Sphinx docs, but I would have needed to write a plugin, and didn't get to do it.


---

Comment by embray created at 2019-11-12 14:06:14

In any case, this is definitely good enough for now, thank you for taking care of it.


---

Comment by jhpalmieri created at 2019-11-12 16:46:56

Replying to [comment:4 embray]:
> By the way, there was already a ticket for this task at #24023.

Oops, sorry.

> Something I wanted to do for that was to have a way to automatically include the in-line docs in `sage-dist-helpers` into the Sphinx docs, but I would have needed to write a plugin, and didn't get to do it.

Maybe we can leave #24023 open for that.


---

Comment by embray created at 2019-11-12 16:48:27

Replying to [comment:6 jhpalmieri]:
> Replying to [comment:4 embray]:
> > By the way, there was already a ticket for this task at #24023.
> 
> Oops, sorry.

No problem.  Personally I sometimes even prefer opening separate tickets for specific solutions to a problem from the ticket for the problem itself.

> > Something I wanted to do for that was to have a way to automatically include the in-line docs in `sage-dist-helpers` into the Sphinx docs, but I would have needed to write a plugin, and didn't get to do it.
> 
> Maybe we can leave #24023 open for that.

That makes sense.


---

Comment by git created at 2019-11-12 16:56:55

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jhpalmieri created at 2019-11-12 16:57:30

Replying to [comment:3 dimpase]:
> The pattern `sdh_XYZ || sdh_die ...` one sees in few places is not necessary, and `sdh_XYZ` alone suffices, isn't it?
> 
> By looking at the code of e.g. `sdh_configure`
> one sees that `sdh_die` is actually called in `sdh_configure`, and so chaining them
> as above is pointless (the part after `||` won't be called).
> 
> This should be mentioned in the docs.

I added a note about this.


---

Comment by dimpase created at 2019-11-12 22:39:25

Changing status from needs_review to positive_review.


---

Comment by dimpase created at 2019-11-12 22:39:25

Thanks. Looks good to me; the still missing part is package de-installation, and the related JSON files, but it can be on another ticket.


---

Comment by dimpase created at 2019-11-12 22:51:10

specifically about JSON files, de-installation is handled by `build/sage_bootstrap/uninstall.py`, and there are good docs there, but I don't know where these JSON files are written.

I have a vague recollection I knew it once, but it's not clear to me now, without digging through the whole command chain and makefiles... :-(


---

Comment by jhpalmieri created at 2019-11-12 23:36:29

Seems to be written by `build/bin/sage-spkg`, starting at line 1000:

```
PKG_NAME_INSTALLED="$SAGE_SPKG_INST/$PKG_NAME"
cat > "$PKG_NAME_INSTALLED" << __EOF__
{
    "package_name": "$PKG_BASE",
    "package_version": "$PKG_VER",
    "install_date": "$(date)",
    "system_uname": "$(uname -a)",
    "sage_version": "$(cat "${SAGE_ROOT}/VERSION.txt")",
    "test_result": "$TEST_SUITE_RESULT",
    "files": [
        $FILE_LIST
    ]
}
__EOF__
```

The file manifest is constructed at line 899-900:

```
    # Generate installed file manifest
    FILE_LIST="$(cd "$PREFIX" && find . -type f -o -type l | sed 's|^\./||' | sort)"
```



---

Comment by vbraun created at 2019-11-16 20:15:23

Resolution: fixed
