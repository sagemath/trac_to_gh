# Issue 16502: is_weak_popov

Issue created by migration from https://trac.sagemath.org/ticket/16739

Original creator: ketzu

Original creation time: 2014-07-30 08:42:12

CC:  jsrn




---

Comment by ketzu created at 2014-08-19 11:24:12

Changing keywords from "" to "matrix".


---

Comment by ketzu created at 2014-08-19 11:24:12

Changing component from PLEASE CHANGE to linear algebra.


---

Comment by ketzu created at 2014-08-19 11:24:12

Changing priority from major to minor.


---

Comment by ketzu created at 2014-08-19 11:30:10

Changing keywords from "matrix" to "matrix weak-popov-form #16742".


---

Comment by ketzu created at 2014-08-19 12:01:22

Changing type from PLEASE CHANGE to enhancement.


---

Comment by git created at 2014-08-19 12:06:26

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jsrn created at 2014-08-20 09:17:20

Though the check is elegantly written in two lines, I think it has two
unnecessary downsides:

  - It allocates a new matrix in the apply_map, instead of calculating
    the degrees on inspection.

  - It doesn't fail fast: for instance, if the first two rows have the
    same leading position, we don't need to continue.

Both issues can be repaired by changing the outer list comprehension
into a loop, where one maintains an auxiliary set of already seen
leading positions.

Probably is_weak_popov will usually not be a performance bottleneck, but nonetheless.

Cheers,
jsrn


---

Comment by jsrn created at 2014-08-20 09:21:03

Btw. Sage usually has line wraps on doc strings, right? The line under OUTPUT is very long. Also, the last sentence there is missing a full stop.

Last pet peeve: can you change one or two of the doc tests to be
non-square matrices?

Come to think of it, if the matrix has more rows than cols, the function can immediately return False.


---

Comment by ketzu created at 2014-08-20 09:38:20

Line wraps are already in, but not pushed. 
A fast fail for more rows than cols only works if zero lines are not ignored.


---

Comment by ketzu created at 2014-08-20 09:51:47

Doctests and fast fail/less overhead is in progress.


---

Comment by git created at 2014-08-21 13:23:39

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by ketzu created at 2014-08-21 13:25:47

Some simple measures for the change from list comprehension (probably more "pythonic") to double loops:

list comprehension:

sage: PF = PolynomialRing(GF(2!^32,'a'),'x')

sage: A = random_matrix(PF,400,400,degree=10)
sage: %timeit A.is_weak_popov()
1 loops, best of 3: 7.57 s per loop

sage: B = random_matrix(PF,10,10,degree=800)
sage: %timeit B.is_weak_popov()
1000 loops, best of 3: 554 µs per loop

----
loops

sage: A = random_matrix(PF,400,400,degree=10)
sage: %timeit A.is_weak_popov()
1000 loops, best of 3: 251 µs per loop
sage: A.is_weak_popov()
False

sage: for x in range(A.nrows()):
....:     A[x,x] = A[x,x].shift(11)
....:     
sage: A.is_weak_popov()
True
sage: %timeit A.is_weak_popov()
10 loops, best of 3: 69.1 ms per loop

sage: B = random_matrix(PF,10,10,degree=800)
sage: %timeit B.is_weak_popov()
100000 loops, best of 3: 8.73 µs per loop
sage: B.is_weak_popov()
False

sage: for x in range(B.nrows()):
....:     B[x,x] = B[x,x].shift(801)
....:
# Now it's in wpf
sage: %timeit B.is_weak_popov()
10000 loops, best of 3: 46.7 µs per loop
sage: B.is_weak_popov()
True

----
New commits:
----
New commits:


---

Comment by jsrn created at 2014-08-21 13:37:59

Cool, looks good. And the timings are quite persuasive.

One thing: I don't see what you need the "p = self.ncols()-1" line for. p will always be reassigned if any element is non-zero. And if not, p will never be read.


---

Comment by git created at 2014-08-21 13:53:10

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2014-08-21 14:26:58

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jsrn created at 2014-08-21 14:31:46

Cool. Ready to mark as Needs Review? It might be too in-bred to make me review it...


---

Comment by ketzu created at 2014-08-21 14:44:43

Changing status from new to needs_review.


---

Comment by chapoton created at 2014-08-24 19:06:03

The doc syntax is not good. After any ::, the next line should be indented by 4. After any :, the next line should not be indented at all.

See http://www.sagemath.org/doc/developer/coding_basics.html


---

Comment by chapoton created at 2014-08-25 07:31:24

Changing status from needs_review to needs_work.


---

Comment by git created at 2014-08-25 09:09:45

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by ketzu created at 2014-08-25 09:10:36

Changing status from needs_work to needs_review.


---

Comment by git created at 2014-08-25 09:17:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2014-08-25 09:22:46

Looks good enough. A few more minor things:

- in the doc please start with: Return ``True`` etc (no s at the end of Return)
(recommended use of imperative mode)

- in the code, please put a space after the commas, and a space before and after == and <= 
(pep8 code formatting standard)


---

Comment by git created at 2014-08-25 10:03:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2014-08-25 12:05:29

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2014-08-25 12:33:34

Please write your real name in the Authors: field above.


---

Comment by chapoton created at 2014-08-25 17:27:48

I have made a reviewer's commit with small changes.

If you agree with my changes, you can set this to positive review on my behalf.
----
New commits:


---

Comment by ketzu created at 2014-08-25 19:48:41

Changing status from needs_review to positive_review.


---

Comment by ketzu created at 2014-08-25 19:49:19

I apreciate your help, thank you for these changes, since I am still uneasy in python and english.


---

Comment by vbraun created at 2014-08-26 13:02:44

Resolution: fixed
