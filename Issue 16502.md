# Issue 16502: is_weak_popov

archive/issues_016502.json:
```json
{
    "body": "CC:  @johanrosenkilde\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/16739\n\n",
    "created_at": "2014-07-30T08:42:12Z",
    "labels": [],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "is_weak_popov",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16502",
    "user": "https://trac.sagemath.org/admin/accounts/users/ketzu"
}
```
CC:  @johanrosenkilde



Issue created by migration from https://trac.sagemath.org/ticket/16739





---

archive/issue_events_049032.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/16502",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16502#event-49032"
}
```



---

archive/issue_comments_216778.json:
```json
{
    "body": "Changing keywords from \"\" to \"matrix\".",
    "created_at": "2014-08-19T11:24:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16502#issuecomment-216778",
    "user": "https://trac.sagemath.org/admin/accounts/users/ketzu"
}
```

Changing keywords from "" to "matrix".



---

archive/issue_comments_216779.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to linear algebra.",
    "created_at": "2014-08-19T11:24:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16502#issuecomment-216779",
    "user": "https://trac.sagemath.org/admin/accounts/users/ketzu"
}
```

Changing component from PLEASE CHANGE to linear algebra.



---

archive/issue_comments_216780.json:
```json
{
    "body": "Changing priority from major to minor.",
    "created_at": "2014-08-19T11:24:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16502#issuecomment-216780",
    "user": "https://trac.sagemath.org/admin/accounts/users/ketzu"
}
```

Changing priority from major to minor.



---

archive/issue_comments_216781.json:
```json
{
    "body": "Changing keywords from \"matrix\" to \"matrix weak-popov-form #16742\".",
    "created_at": "2014-08-19T11:30:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16502#issuecomment-216781",
    "user": "https://trac.sagemath.org/admin/accounts/users/ketzu"
}
```

Changing keywords from "matrix" to "matrix weak-popov-form #16742".



---

archive/issue_comments_216782.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to enhancement.",
    "created_at": "2014-08-19T12:01:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16502#issuecomment-216782",
    "user": "https://trac.sagemath.org/admin/accounts/users/ketzu"
}
```

Changing type from PLEASE CHANGE to enhancement.



---

archive/issue_comments_216783.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-08-19T12:06:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16502#issuecomment-216783",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_216784.json:
```json
{
    "body": "Though the check is elegantly written in two lines, I think it has two\nunnecessary downsides:\n\n- It allocates a new matrix in the apply_map, instead of calculating\n  the degrees on inspection.\n\n- It doesn't fail fast: for instance, if the first two rows have the\n  same leading position, we don't need to continue.\n\nBoth issues can be repaired by changing the outer list comprehension\ninto a loop, where one maintains an auxiliary set of already seen\nleading positions.\n\nProbably is_weak_popov will usually not be a performance bottleneck, but nonetheless.\n\nCheers,\njsrn",
    "created_at": "2014-08-20T09:17:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16502#issuecomment-216784",
    "user": "https://github.com/johanrosenkilde"
}
```

Though the check is elegantly written in two lines, I think it has two
unnecessary downsides:

- It allocates a new matrix in the apply_map, instead of calculating
  the degrees on inspection.

- It doesn't fail fast: for instance, if the first two rows have the
  same leading position, we don't need to continue.

Both issues can be repaired by changing the outer list comprehension
into a loop, where one maintains an auxiliary set of already seen
leading positions.

Probably is_weak_popov will usually not be a performance bottleneck, but nonetheless.

Cheers,
jsrn



---

archive/issue_comments_216785.json:
```json
{
    "body": "Btw. Sage usually has line wraps on doc strings, right? The line under OUTPUT is very long. Also, the last sentence there is missing a full stop.\n\nLast pet peeve: can you change one or two of the doc tests to be\nnon-square matrices?\n\nCome to think of it, if the matrix has more rows than cols, the function can immediately return False.",
    "created_at": "2014-08-20T09:21:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16502#issuecomment-216785",
    "user": "https://github.com/johanrosenkilde"
}
```

Btw. Sage usually has line wraps on doc strings, right? The line under OUTPUT is very long. Also, the last sentence there is missing a full stop.

Last pet peeve: can you change one or two of the doc tests to be
non-square matrices?

Come to think of it, if the matrix has more rows than cols, the function can immediately return False.



---

archive/issue_comments_216786.json:
```json
{
    "body": "Line wraps are already in, but not pushed. \nA fast fail for more rows than cols only works if zero lines are not ignored.",
    "created_at": "2014-08-20T09:38:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16502#issuecomment-216786",
    "user": "https://trac.sagemath.org/admin/accounts/users/ketzu"
}
```

Line wraps are already in, but not pushed. 
A fast fail for more rows than cols only works if zero lines are not ignored.



---

archive/issue_comments_216787.json:
```json
{
    "body": "Doctests and fast fail/less overhead is in progress.",
    "created_at": "2014-08-20T09:51:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16502#issuecomment-216787",
    "user": "https://trac.sagemath.org/admin/accounts/users/ketzu"
}
```

Doctests and fast fail/less overhead is in progress.



---

archive/issue_comments_216788.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-08-21T13:23:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16502#issuecomment-216788",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_216789.json:
```json
{
    "body": "Some simple measures for the change from list comprehension (probably more \"pythonic\") to double loops:\n\nlist comprehension:\n\nsage: PF = PolynomialRing(GF(2!^32,'a'),'x')\n\nsage: A = random_matrix(PF,400,400,degree=10)\nsage: %timeit A.is_weak_popov()\n1 loops, best of 3: 7.57 s per loop\n\nsage: B = random_matrix(PF,10,10,degree=800)\nsage: %timeit B.is_weak_popov()\n1000 loops, best of 3: 554 \u00b5s per loop\n\n----\nloops\n\nsage: A = random_matrix(PF,400,400,degree=10)\nsage: %timeit A.is_weak_popov()\n1000 loops, best of 3: 251 \u00b5s per loop\nsage: A.is_weak_popov()\nFalse\n\nsage: for x in range(A.nrows()):\n....:\u00a0\u00a0\u00a0\u00a0 A[x,x] = A[x,x].shift(11)\n....:\u00a0\u00a0\u00a0\u00a0 \nsage: A.is_weak_popov()\nTrue\nsage: %timeit A.is_weak_popov()\n10 loops, best of 3: 69.1 ms per loop\n\nsage: B = random_matrix(PF,10,10,degree=800)\nsage: %timeit B.is_weak_popov()\n100000 loops, best of 3: 8.73 \u00b5s per loop\nsage: B.is_weak_popov()\nFalse\n\nsage: for x in range(B.nrows()):\n....:\u00a0\u00a0\u00a0\u00a0 B[x,x] = B[x,x].shift(801)\n....:\n# Now it's in wpf\nsage: %timeit B.is_weak_popov()\n10000 loops, best of 3: 46.7 \u00b5s per loop\nsage: B.is_weak_popov()\nTrue\n\n----\nNew commits:\n----\nNew commits:",
    "created_at": "2014-08-21T13:25:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16502#issuecomment-216789",
    "user": "https://trac.sagemath.org/admin/accounts/users/ketzu"
}
```

Some simple measures for the change from list comprehension (probably more "pythonic") to double loops:

list comprehension:

sage: PF = PolynomialRing(GF(2!^32,'a'),'x')

sage: A = random_matrix(PF,400,400,degree=10)
sage: %timeit A.is_weak_popov()
1 loops, best of 3: 7.57 s per loop

sage: B = random_matrix(PF,10,10,degree=800)
sage: %timeit B.is_weak_popov()
1000 loops, best of 3: 554 µs per loop

----
loops

sage: A = random_matrix(PF,400,400,degree=10)
sage: %timeit A.is_weak_popov()
1000 loops, best of 3: 251 µs per loop
sage: A.is_weak_popov()
False

sage: for x in range(A.nrows()):
....:     A[x,x] = A[x,x].shift(11)
....:     
sage: A.is_weak_popov()
True
sage: %timeit A.is_weak_popov()
10 loops, best of 3: 69.1 ms per loop

sage: B = random_matrix(PF,10,10,degree=800)
sage: %timeit B.is_weak_popov()
100000 loops, best of 3: 8.73 µs per loop
sage: B.is_weak_popov()
False

sage: for x in range(B.nrows()):
....:     B[x,x] = B[x,x].shift(801)
....:
# Now it's in wpf
sage: %timeit B.is_weak_popov()
10000 loops, best of 3: 46.7 µs per loop
sage: B.is_weak_popov()
True

----
New commits:
----
New commits:



---

archive/issue_comments_216790.json:
```json
{
    "body": "Cool, looks good. And the timings are quite persuasive.\n\nOne thing: I don't see what you need the \"p = self.ncols()-1\" line for. p will always be reassigned if any element is non-zero. And if not, p will never be read.",
    "created_at": "2014-08-21T13:37:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16502#issuecomment-216790",
    "user": "https://github.com/johanrosenkilde"
}
```

Cool, looks good. And the timings are quite persuasive.

One thing: I don't see what you need the "p = self.ncols()-1" line for. p will always be reassigned if any element is non-zero. And if not, p will never be read.



---

archive/issue_comments_216791.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-08-21T13:53:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16502#issuecomment-216791",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_216792.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-08-21T14:26:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16502#issuecomment-216792",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_216793.json:
```json
{
    "body": "Cool. Ready to mark as Needs Review? It might be too in-bred to make me review it...",
    "created_at": "2014-08-21T14:31:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16502#issuecomment-216793",
    "user": "https://github.com/johanrosenkilde"
}
```

Cool. Ready to mark as Needs Review? It might be too in-bred to make me review it...



---

archive/issue_comments_216794.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-08-21T14:44:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16502#issuecomment-216794",
    "user": "https://trac.sagemath.org/admin/accounts/users/ketzu"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_216795.json:
```json
{
    "body": "The doc syntax is not good. After any ::, the next line should be indented by 4. After any :, the next line should not be indented at all.\n\nSee http://www.sagemath.org/doc/developer/coding_basics.html",
    "created_at": "2014-08-24T19:06:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16502#issuecomment-216795",
    "user": "https://github.com/fchapoton"
}
```

The doc syntax is not good. After any ::, the next line should be indented by 4. After any :, the next line should not be indented at all.

See http://www.sagemath.org/doc/developer/coding_basics.html



---

archive/issue_comments_216796.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-08-25T07:31:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16502#issuecomment-216796",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_216797.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-08-25T09:09:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16502#issuecomment-216797",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_216798.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-08-25T09:10:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16502#issuecomment-216798",
    "user": "https://trac.sagemath.org/admin/accounts/users/ketzu"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_216799.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-08-25T09:17:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16502#issuecomment-216799",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_216800.json:
```json
{
    "body": "Looks good enough. A few more minor things:\n\n- in the doc please start with: Return ``True`` etc (no s at the end of Return)\n(recommended use of imperative mode)\n\n- in the code, please put a space after the commas, and a space before and after == and <= \n(pep8 code formatting standard)",
    "created_at": "2014-08-25T09:22:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16502#issuecomment-216800",
    "user": "https://github.com/fchapoton"
}
```

Looks good enough. A few more minor things:

- in the doc please start with: Return ``True`` etc (no s at the end of Return)
(recommended use of imperative mode)

- in the code, please put a space after the commas, and a space before and after == and <= 
(pep8 code formatting standard)



---

archive/issue_comments_216801.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-08-25T10:03:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16502#issuecomment-216801",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_216802.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-08-25T12:05:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16502#issuecomment-216802",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_216803.json:
```json
{
    "body": "Please write your real name in the Authors: field above.",
    "created_at": "2014-08-25T12:33:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16502#issuecomment-216803",
    "user": "https://github.com/fchapoton"
}
```

Please write your real name in the Authors: field above.



---

archive/issue_comments_216804.json:
```json
{
    "body": "I have made a reviewer's commit with small changes.\n\nIf you agree with my changes, you can set this to positive review on my behalf.\n----\nNew commits:",
    "created_at": "2014-08-25T17:27:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16502#issuecomment-216804",
    "user": "https://github.com/fchapoton"
}
```

I have made a reviewer's commit with small changes.

If you agree with my changes, you can set this to positive review on my behalf.
----
New commits:



---

archive/issue_comments_216805.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-08-25T19:48:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16502#issuecomment-216805",
    "user": "https://trac.sagemath.org/admin/accounts/users/ketzu"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_216806.json:
```json
{
    "body": "I apreciate your help, thank you for these changes, since I am still uneasy in python and english.",
    "created_at": "2014-08-25T19:49:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16502#issuecomment-216806",
    "user": "https://trac.sagemath.org/admin/accounts/users/ketzu"
}
```

I apreciate your help, thank you for these changes, since I am still uneasy in python and english.



---

archive/issue_events_049033.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-08-26T13:02:44Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/16502",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16502#event-49033"
}
```



---

archive/issue_comments_216807.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-08-26T13:02:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16502",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16502#issuecomment-216807",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
