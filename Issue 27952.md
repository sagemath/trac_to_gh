# Issue 27952: prefer "X in Fields()" rather than "X.is_field()"

Issue created by migration from https://trac.sagemath.org/ticket/28189

Original creator: vdelecroix

Original creation time: 2019-07-13 14:58:40

`X.is_field()` fails for many parent `X`. The matrix code relies a lot on the distinction ring/field. We change the code in the matrix folder to make the functions work for more base rings.


---

Comment by vdelecroix created at 2019-07-13 15:55:24

New commits:


---

Comment by vdelecroix created at 2019-07-13 15:55:24

Changing status from new to needs_review.


---

Comment by git created at 2019-07-13 15:56:37

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2019-07-17 16:54:39

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2019-07-17 16:58:31

Kwankyu: this branch introduces a serious speedup in `function_field` code that I hardly explain... you might want to investigate.

```
Git branch: matrices2                             Git branch: develop
sage -t rings/function_field/differential.py      sage -t rings/function_field/differential.py
    [220 tests, 2.46 s]                               [220 tests, 2.81 s]
sage -t rings/function_field/divisor.py           sage -t rings/function_field/divisor.py
    [200 tests, 3.42 s]                               [200 tests, 3.72 s]
sage -t rings/function_field/ideal.py             sage -t rings/function_field/ideal.py
    [915 tests, 8.90 s]                               [915 tests, 9.51 s]
sage -t rings/function_field/valuation_ring.py    sage -t rings/function_field/valuation_ring.py
    [52 tests, 0.23 s]                                [52 tests, 0.33 s]
sage -t rings/function_field/order.py             sage -t rings/function_field/order.py
    [421 tests, 1.71 s]                               [421 tests, 2.18 s]
sage -t rings/function_field/maps.py              sage -t rings/function_field/maps.py
    [378 tests, 3.77 s]                               [378 tests, 5.44 s]
sage -t rings/function_field/constructor.py       sage -t rings/function_field/constructor.py
    [42 tests, 0.08 s]                                [42 tests, 0.10 s]
sage -t rings/function_field/element.pyx          sage -t rings/function_field/element.pyx
    [275 tests, 1.27 s]                               [275 tests, 1.88 s]
sage -t rings/function_field/function_field.py    sage -t rings/function_field/function_field.py
    [743 tests, 33.02 s]                              [743 tests, 34.50 s]
sage -t rings/function_field/function_field_valua sage -t rings/function_field/function_field_valua
    [338 tests, 1.97 s]                               [338 tests, 1.97 s]
sage -t rings/function_field/place.py             sage -t rings/function_field/place.py
    [197 tests, 4.61 s]                               [197 tests, 5.24 s]
```



---

Comment by chapoton created at 2019-08-24 18:57:39

ok, looks good.


---

Comment by chapoton created at 2019-08-24 18:57:39

Changing status from needs_review to positive_review.


---

Comment by vdelecroix created at 2019-08-24 22:16:38

Merci Frédéric!


---

Comment by vbraun created at 2019-08-25 22:38:49

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2019-08-25 22:38:49

Merge conflict


---

Comment by chapoton created at 2019-08-27 06:56:13

probably with #27473


---

Comment by git created at 2019-08-27 11:30:06

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by vdelecroix created at 2019-08-27 11:30:32

Changing status from needs_work to needs_review.


---

Comment by chapoton created at 2019-08-28 07:42:31

Not clear to me what conflict was resolved and how. Could you explain, please ?


---

Comment by vdelecroix created at 2019-08-28 07:45:12

Oh I see. The conflict is not merged yet.


---

Comment by vdelecroix created at 2019-08-28 07:45:12

Changing status from needs_review to needs_work.


---

Comment by chapoton created at 2019-09-06 19:03:13

now you can see and fix the conflict


---

Comment by chapoton created at 2019-09-07 19:17:45

Changing status from needs_work to needs_review.


---

Comment by chapoton created at 2019-09-07 19:17:45

I have merged.
----
New commits:


---

Comment by git created at 2019-09-08 07:02:52

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2019-09-08 07:03:18

And I made a mistake in the merge, now fixed.


---

Comment by chapoton created at 2019-09-08 15:17:23

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2019-09-08 15:17:23

and set to positive again.


---

Comment by vdelecroix created at 2019-09-08 15:29:45

Merci Frédéric!


---

Comment by vbraun created at 2019-09-09 21:32:34

Merge conflict


---

Comment by vbraun created at 2019-09-09 21:32:34

Changing status from positive_review to needs_work.


---

Comment by chapoton created at 2019-09-12 07:23:21

and the merge is not trivial at all. Vincent, would you do it please ?


---

Comment by @DeRhamSource created at 2019-09-24 12:09:37

Is a merge into 8.9 planned? I really need this ticket for vector bundles and therefore my master thesis. A merge is highly appreciated!


---

Comment by vdelecroix created at 2019-09-24 12:16:45

I can rebase but I will not spend my life doing it. Volker, could you merge it first in the 9.0.beta0 if I rebase?


---

Comment by vbraun created at 2019-09-24 13:06:54

Can do...


---

Comment by @DeRhamSource created at 2019-09-24 13:17:44

Nice, thank you very much! :)


---

Comment by vdelecroix created at 2019-09-24 13:32:33

Changing status from needs_work to needs_review.


---

Comment by vdelecroix created at 2019-09-24 13:32:53

New commits:


---

Comment by chapoton created at 2019-09-24 18:08:13

New: a failing doctest in `src/sage/matrix/matrix0.pyx`


---

Comment by jhpalmieri created at 2019-09-24 19:00:51

Is this a py2-only failure? From my limited experimentation, it looks like `build_inverse_from_augmented_sparse` behaves differently in Python 2 vs. 3.


---

Comment by @mwageringel created at 2019-09-24 19:38:41

Replying to [comment:29 jhpalmieri]:
> Is this a py2-only failure? From my limited experimentation, it looks like `build_inverse_from_augmented_sparse` behaves differently in Python 2 vs. 3.
Yes, see also #28402. It looks like the fix there was accidentally undone here.


---

Comment by git created at 2019-09-24 21:23:37

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2019-09-25 06:39:24

now fixed


---

Comment by chapoton created at 2019-09-25 07:51:17

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2019-09-25 07:51:17

ok, bien


---

Comment by vbraun created at 2019-10-03 17:58:04

Resolution: fixed


---

Comment by chapoton created at 2019-10-06 15:29:53

This has broken the inversion of matrices over ZZ, see sage-devel thread.


---

Comment by jhpalmieri created at 2019-10-06 17:07:15

I think the problem is that the new matrix `inverse_of_unit` is shadowing the old one from `categories.rings`.


---

Comment by chapoton created at 2019-10-08 20:08:02

follow-up ticket in #28570 to try and fix the broken things ; please help
