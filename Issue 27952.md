# Issue 27952: prefer "X in Fields()" rather than "X.is_field()"

archive/issues_027952.json:
```json
{
    "body": "`X.is_field()` fails for many parent `X`. The matrix code relies a lot on the distinction ring/field. We change the code in the matrix folder to make the functions work for more base rings.\n\nIssue created by migration from https://trac.sagemath.org/ticket/28189\n\n",
    "created_at": "2019-07-13T14:58:40Z",
    "labels": [
        "algebra",
        "major",
        "enhancement"
    ],
    "title": "prefer \"X in Fields()\" rather than \"X.is_field()\"",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27952",
    "user": "vdelecroix"
}
```
`X.is_field()` fails for many parent `X`. The matrix code relies a lot on the distinction ring/field. We change the code in the matrix folder to make the functions work for more base rings.

Issue created by migration from https://trac.sagemath.org/ticket/28189





---

archive/issue_comments_394841.json:
```json
{
    "body": "New commits:",
    "created_at": "2019-07-13T15:55:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27952#issuecomment-394841",
    "user": "vdelecroix"
}
```

New commits:



---

archive/issue_comments_394842.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-07-13T15:55:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27952#issuecomment-394842",
    "user": "vdelecroix"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_394843.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-07-13T15:56:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27952#issuecomment-394843",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_394844.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-07-17T16:54:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27952#issuecomment-394844",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_394845.json:
```json
{
    "body": "Kwankyu: this branch introduces a serious speedup in `function_field` code that I hardly explain... you might want to investigate.\n\n```\nGit branch: matrices2                             Git branch: develop\nsage -t rings/function_field/differential.py      sage -t rings/function_field/differential.py\n    [220 tests, 2.46 s]                               [220 tests, 2.81 s]\nsage -t rings/function_field/divisor.py           sage -t rings/function_field/divisor.py\n    [200 tests, 3.42 s]                               [200 tests, 3.72 s]\nsage -t rings/function_field/ideal.py             sage -t rings/function_field/ideal.py\n    [915 tests, 8.90 s]                               [915 tests, 9.51 s]\nsage -t rings/function_field/valuation_ring.py    sage -t rings/function_field/valuation_ring.py\n    [52 tests, 0.23 s]                                [52 tests, 0.33 s]\nsage -t rings/function_field/order.py             sage -t rings/function_field/order.py\n    [421 tests, 1.71 s]                               [421 tests, 2.18 s]\nsage -t rings/function_field/maps.py              sage -t rings/function_field/maps.py\n    [378 tests, 3.77 s]                               [378 tests, 5.44 s]\nsage -t rings/function_field/constructor.py       sage -t rings/function_field/constructor.py\n    [42 tests, 0.08 s]                                [42 tests, 0.10 s]\nsage -t rings/function_field/element.pyx          sage -t rings/function_field/element.pyx\n    [275 tests, 1.27 s]                               [275 tests, 1.88 s]\nsage -t rings/function_field/function_field.py    sage -t rings/function_field/function_field.py\n    [743 tests, 33.02 s]                              [743 tests, 34.50 s]\nsage -t rings/function_field/function_field_valua sage -t rings/function_field/function_field_valua\n    [338 tests, 1.97 s]                               [338 tests, 1.97 s]\nsage -t rings/function_field/place.py             sage -t rings/function_field/place.py\n    [197 tests, 4.61 s]                               [197 tests, 5.24 s]\n```\n",
    "created_at": "2019-07-17T16:58:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27952#issuecomment-394845",
    "user": "vdelecroix"
}
```

Kwankyu: this branch introduces a serious speedup in `function_field` code that I hardly explain... you might want to investigate.

```
Git branch: matrices2                             Git branch: develop
sage -t rings/function_field/differential.py      sage -t rings/function_field/differential.py
    [220 tests, 2.46 s]                               [220 tests, 2.81 s]
sage -t rings/function_field/divisor.py           sage -t rings/function_field/divisor.py
    [200 tests, 3.42 s]                               [200 tests, 3.72 s]
sage -t rings/function_field/ideal.py             sage -t rings/function_field/ideal.py
    [915 tests, 8.90 s]                               [915 tests, 9.51 s]
sage -t rings/function_field/valuation_ring.py    sage -t rings/function_field/valuation_ring.py
    [52 tests, 0.23 s]                                [52 tests, 0.33 s]
sage -t rings/function_field/order.py             sage -t rings/function_field/order.py
    [421 tests, 1.71 s]                               [421 tests, 2.18 s]
sage -t rings/function_field/maps.py              sage -t rings/function_field/maps.py
    [378 tests, 3.77 s]                               [378 tests, 5.44 s]
sage -t rings/function_field/constructor.py       sage -t rings/function_field/constructor.py
    [42 tests, 0.08 s]                                [42 tests, 0.10 s]
sage -t rings/function_field/element.pyx          sage -t rings/function_field/element.pyx
    [275 tests, 1.27 s]                               [275 tests, 1.88 s]
sage -t rings/function_field/function_field.py    sage -t rings/function_field/function_field.py
    [743 tests, 33.02 s]                              [743 tests, 34.50 s]
sage -t rings/function_field/function_field_valua sage -t rings/function_field/function_field_valua
    [338 tests, 1.97 s]                               [338 tests, 1.97 s]
sage -t rings/function_field/place.py             sage -t rings/function_field/place.py
    [197 tests, 4.61 s]                               [197 tests, 5.24 s]
```




---

archive/issue_comments_394846.json:
```json
{
    "body": "ok, looks good.",
    "created_at": "2019-08-24T18:57:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27952#issuecomment-394846",
    "user": "chapoton"
}
```

ok, looks good.



---

archive/issue_comments_394847.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-08-24T18:57:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27952#issuecomment-394847",
    "user": "chapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_394848.json:
```json
{
    "body": "Merci Fr\u00e9d\u00e9ric!",
    "created_at": "2019-08-24T22:16:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27952#issuecomment-394848",
    "user": "vdelecroix"
}
```

Merci Frédéric!



---

archive/issue_comments_394849.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2019-08-25T22:38:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27952#issuecomment-394849",
    "user": "vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_394850.json:
```json
{
    "body": "Merge conflict",
    "created_at": "2019-08-25T22:38:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27952#issuecomment-394850",
    "user": "vbraun"
}
```

Merge conflict



---

archive/issue_comments_394851.json:
```json
{
    "body": "probably with #27473",
    "created_at": "2019-08-27T06:56:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27952#issuecomment-394851",
    "user": "chapoton"
}
```

probably with #27473



---

archive/issue_comments_394852.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-08-27T11:30:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27952#issuecomment-394852",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_394853.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-08-27T11:30:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27952#issuecomment-394853",
    "user": "vdelecroix"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_394854.json:
```json
{
    "body": "Not clear to me what conflict was resolved and how. Could you explain, please ?",
    "created_at": "2019-08-28T07:42:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27952#issuecomment-394854",
    "user": "chapoton"
}
```

Not clear to me what conflict was resolved and how. Could you explain, please ?



---

archive/issue_comments_394855.json:
```json
{
    "body": "Oh I see. The conflict is not merged yet.",
    "created_at": "2019-08-28T07:45:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27952#issuecomment-394855",
    "user": "vdelecroix"
}
```

Oh I see. The conflict is not merged yet.



---

archive/issue_comments_394856.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-08-28T07:45:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27952#issuecomment-394856",
    "user": "vdelecroix"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_394857.json:
```json
{
    "body": "now you can see and fix the conflict",
    "created_at": "2019-09-06T19:03:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27952#issuecomment-394857",
    "user": "chapoton"
}
```

now you can see and fix the conflict



---

archive/issue_comments_394858.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-09-07T19:17:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27952#issuecomment-394858",
    "user": "chapoton"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_394859.json:
```json
{
    "body": "I have merged.\n----\nNew commits:",
    "created_at": "2019-09-07T19:17:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27952#issuecomment-394859",
    "user": "chapoton"
}
```

I have merged.
----
New commits:



---

archive/issue_comments_394860.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-09-08T07:02:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27952#issuecomment-394860",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_394861.json:
```json
{
    "body": "And I made a mistake in the merge, now fixed.",
    "created_at": "2019-09-08T07:03:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27952#issuecomment-394861",
    "user": "chapoton"
}
```

And I made a mistake in the merge, now fixed.



---

archive/issue_comments_394862.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-09-08T15:17:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27952#issuecomment-394862",
    "user": "chapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_394863.json:
```json
{
    "body": "and set to positive again.",
    "created_at": "2019-09-08T15:17:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27952#issuecomment-394863",
    "user": "chapoton"
}
```

and set to positive again.



---

archive/issue_comments_394864.json:
```json
{
    "body": "Merci Fr\u00e9d\u00e9ric!",
    "created_at": "2019-09-08T15:29:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27952#issuecomment-394864",
    "user": "vdelecroix"
}
```

Merci Frédéric!



---

archive/issue_comments_394865.json:
```json
{
    "body": "Merge conflict",
    "created_at": "2019-09-09T21:32:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27952#issuecomment-394865",
    "user": "vbraun"
}
```

Merge conflict



---

archive/issue_comments_394866.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2019-09-09T21:32:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27952#issuecomment-394866",
    "user": "vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_394867.json:
```json
{
    "body": "and the merge is not trivial at all. Vincent, would you do it please ?",
    "created_at": "2019-09-12T07:23:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27952#issuecomment-394867",
    "user": "chapoton"
}
```

and the merge is not trivial at all. Vincent, would you do it please ?



---

archive/issue_comments_394868.json:
```json
{
    "body": "Is a merge into 8.9 planned? I really need this ticket for vector bundles and therefore my master thesis. A merge is highly appreciated!",
    "created_at": "2019-09-24T12:09:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27952#issuecomment-394868",
    "user": "@DeRhamSource"
}
```

Is a merge into 8.9 planned? I really need this ticket for vector bundles and therefore my master thesis. A merge is highly appreciated!



---

archive/issue_comments_394869.json:
```json
{
    "body": "I can rebase but I will not spend my life doing it. Volker, could you merge it first in the 9.0.beta0 if I rebase?",
    "created_at": "2019-09-24T12:16:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27952#issuecomment-394869",
    "user": "vdelecroix"
}
```

I can rebase but I will not spend my life doing it. Volker, could you merge it first in the 9.0.beta0 if I rebase?



---

archive/issue_comments_394870.json:
```json
{
    "body": "Can do...",
    "created_at": "2019-09-24T13:06:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27952#issuecomment-394870",
    "user": "vbraun"
}
```

Can do...



---

archive/issue_comments_394871.json:
```json
{
    "body": "Nice, thank you very much! :)",
    "created_at": "2019-09-24T13:17:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27952#issuecomment-394871",
    "user": "@DeRhamSource"
}
```

Nice, thank you very much! :)



---

archive/issue_comments_394872.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-09-24T13:32:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27952#issuecomment-394872",
    "user": "vdelecroix"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_394873.json:
```json
{
    "body": "New commits:",
    "created_at": "2019-09-24T13:32:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27952#issuecomment-394873",
    "user": "vdelecroix"
}
```

New commits:



---

archive/issue_comments_394874.json:
```json
{
    "body": "New: a failing doctest in `src/sage/matrix/matrix0.pyx`",
    "created_at": "2019-09-24T18:08:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27952#issuecomment-394874",
    "user": "chapoton"
}
```

New: a failing doctest in `src/sage/matrix/matrix0.pyx`



---

archive/issue_comments_394875.json:
```json
{
    "body": "Is this a py2-only failure? From my limited experimentation, it looks like `build_inverse_from_augmented_sparse` behaves differently in Python 2 vs. 3.",
    "created_at": "2019-09-24T19:00:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27952#issuecomment-394875",
    "user": "jhpalmieri"
}
```

Is this a py2-only failure? From my limited experimentation, it looks like `build_inverse_from_augmented_sparse` behaves differently in Python 2 vs. 3.



---

archive/issue_comments_394876.json:
```json
{
    "body": "Replying to [comment:29 jhpalmieri]:\n> Is this a py2-only failure? From my limited experimentation, it looks like `build_inverse_from_augmented_sparse` behaves differently in Python 2 vs. 3.\nYes, see also #28402. It looks like the fix there was accidentally undone here.",
    "created_at": "2019-09-24T19:38:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27952#issuecomment-394876",
    "user": "@mwageringel"
}
```

Replying to [comment:29 jhpalmieri]:
> Is this a py2-only failure? From my limited experimentation, it looks like `build_inverse_from_augmented_sparse` behaves differently in Python 2 vs. 3.
Yes, see also #28402. It looks like the fix there was accidentally undone here.



---

archive/issue_comments_394877.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-09-24T21:23:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27952#issuecomment-394877",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_394878.json:
```json
{
    "body": "now fixed",
    "created_at": "2019-09-25T06:39:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27952#issuecomment-394878",
    "user": "vdelecroix"
}
```

now fixed



---

archive/issue_comments_394879.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-09-25T07:51:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27952#issuecomment-394879",
    "user": "chapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_394880.json:
```json
{
    "body": "ok, bien",
    "created_at": "2019-09-25T07:51:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27952#issuecomment-394880",
    "user": "chapoton"
}
```

ok, bien



---

archive/issue_comments_394881.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-10-03T17:58:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27952#issuecomment-394881",
    "user": "vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_394882.json:
```json
{
    "body": "This has broken the inversion of matrices over ZZ, see sage-devel thread.",
    "created_at": "2019-10-06T15:29:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27952#issuecomment-394882",
    "user": "chapoton"
}
```

This has broken the inversion of matrices over ZZ, see sage-devel thread.



---

archive/issue_comments_394883.json:
```json
{
    "body": "I think the problem is that the new matrix `inverse_of_unit` is shadowing the old one from `categories.rings`.",
    "created_at": "2019-10-06T17:07:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27952#issuecomment-394883",
    "user": "jhpalmieri"
}
```

I think the problem is that the new matrix `inverse_of_unit` is shadowing the old one from `categories.rings`.



---

archive/issue_comments_394884.json:
```json
{
    "body": "follow-up ticket in #28570 to try and fix the broken things ; please help",
    "created_at": "2019-10-08T20:08:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27952",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27952#issuecomment-394884",
    "user": "chapoton"
}
```

follow-up ticket in #28570 to try and fix the broken things ; please help
