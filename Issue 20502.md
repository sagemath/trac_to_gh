# Issue 20502: Make snappy an optional package

Issue created by migration from https://trac.sagemath.org/ticket/20739

Original creator: vdelecroix

Original creation time: 2016-05-31 20:31:45

CC:  culler mgoerner dunfield mmarco tscrim slelievre

Keywords: days74

Make [SnapPy](http://www.math.uic.edu/t3m/SnapPy/) an "official" optional package. That could be the occasion of ensuring compatibility of the Sage Link class and the SnapPy link class.


---

Comment by vdelecroix created at 2016-05-31 20:32:46

New commits:


---

Comment by mmarco created at 2016-05-31 20:46:51

Nice!

How exactly do you imagine the integration with our Link class?


---

Comment by vdelecroix created at 2016-06-01 00:49:51

As a first step, Nathan tought us the `sage_link` method

```
sage: 
sage: import snappy
sage: L = snappy.Link('K10n11')
sage: K = L.sage_link()
sage: K.alexander_polynomial()
-t^-3 + 5*t^-2 - 9*t^-1 + 11 - 9*t + 5*t^2 - t^3
sage: L.alexander_polynomial()
t^6 - 5*t^5 + 9*t^4 - 11*t^3 + 9*t^2 - 5*t + 1
```

And there is a nice conversion from Sage link to SnapPy handled automatically

```
sage: B = BraidGroup(8)
sage: K = Link(B([-1, -1, -1, -2, 1, -2, 3, -2, 3]))
sage: L = snappy.Link(K)
```


This might already help for:
 - double checking the outputs (from both sides)
 - comparing the implementations

To enhance it further we could make work the natural conversion the other way around

```
sage: L = snappy.Link('K10n11')
sage: Link(L)
```



---

Comment by tscrim created at 2016-06-01 05:42:59

Something that would be good to have upstream is a `_sage_` method as that is the standard way to call something back to something Sage knows about. In any case, our `Link` code should just call the appropriate method in the SnapPy `Link` (and as a bonus, we can pass strings to SnapPy and convert those back to Sage so the knot names work).

As for passing the `--user` option, we should talk to Jeroen or Volker about that.


---

Comment by dunfield created at 2016-06-01 13:06:16

Replying to [comment:5 tscrim]:
> Something that would be good to have upstream is a `_sage_` method as that is the standard way to call something back to something Sage knows about. 

I just added the `_sage_` method to Spherogram, essentially as an alias for the `sage_link` method mentioned above.


---

Comment by jdemeyer created at 2016-06-01 16:12:20

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2016-06-01 16:12:29

Changing status from needs_review to positive_review.


---

Comment by dunfield created at 2016-06-01 20:03:02

I'm concerned that pip is not being passed the flag `--no-binary :all:` (which is equivalent to the old `--no-use-wheel`).   On OS X, the binary wheel we post on PyPI is built against a "Frameworks" Python rather than the "plain Unix" Python that ships with Sage.  I couldn't reproduce this when I tried right now, but I have observed in the past where "sage -pip install snappy" on OS X results in  installing the binary wheel from PyPI; this results in a fatal linking error when trying to load the module.  

This is not a problem on Linux simply because we currently don't ship binary wheels for Linux --- the standard for that was only recently finalized --- but that will change soon.


---

Comment by dunfield created at 2016-06-01 20:03:02

Changing status from positive_review to needs_work.


---

Comment by dimpase created at 2016-09-26 09:43:26

Please take note of this [SMC issue](https://github.com/sagemathinc/smc/issues/510) and my proposal there. The problem is that `snappy` is also the name of a Python module for the compression library [python-snappy](https://pypi.python.org/pypi/python-snappy), which is used in the very popular machine-learning package [tensorflow](https://www.tensorflow.org/). 

I propose there to use relative imports to avoid this clash.


---

Comment by slelievre created at 2018-01-05 18:48:06

Adding the following note to the ticket description, for reference.

Note: a Docker image for Sage + SnapPy + Regina + PHCPack + more is available:
- Docker image: https://hub.docker.com/r/computop/sage/
- code repository: https://bitbucket.org/t3m/sagedocker
- dockerfile: https://bitbucket.org/t3m/sagedocker/src/tip/sage/Dockerfile


---

Comment by slelievre created at 2018-01-05 18:48:06

Changing keywords from "days74" to "days74, snappy".


---

Comment by slelievre created at 2021-03-07 03:08:40

Probably superseded by #31180.

If you agree, remove the branch and set the milestone to "duplicate".


---

Comment by mkoeppe created at 2021-03-07 03:25:05

Changing status from needs_work to positive_review.


---

Comment by slelievre created at 2021-03-07 17:45:00

Resolution: duplicate
