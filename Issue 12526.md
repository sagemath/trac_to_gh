# Issue 12526: Add a warning not to install packages using the Sage shell

archive/issues_012526.json:
```json
{
    "body": "Assignee: @nexttime\n\nAs we found out in [http://trac.sagemath.org/sage_trac/ticket/12369#comment:189](http://trac.sagemath.org/sage_trac/ticket/12369#comment:189), you cannot use the Sage shell to install Sage packages.\n\nThe problem is that `sage-env` has some conditional commands.  One of these commands is setting `LD_LIBRARY_PATH`.  With #12405, only existing directories are added to `LD_LIBRARY_PATH`.  Upon entering the Sage shell, `$SAGE_LOCAL/lib` might not exist yet, so that directory isn't added. Since now `SAGE_ENV_SOURCED=1`, the variable `LD_LIBRARY_PATH` is not changed anymore.  Similarly, `PYTHONHOME` and `PYTHONPATH` are only set when Python has been installed.\n\nThis ticket is about adding a warning when running `sage --sh`.\n\nIssue created by migration from https://trac.sagemath.org/ticket/12698\n\n",
    "created_at": "2012-03-19T14:50:18Z",
    "labels": [
        "component: scripts"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.0",
    "title": "Add a warning not to install packages using the Sage shell",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12526",
    "user": "https://github.com/jdemeyer"
}
```
Assignee: @nexttime

As we found out in [http://trac.sagemath.org/sage_trac/ticket/12369#comment:189](http://trac.sagemath.org/sage_trac/ticket/12369#comment:189), you cannot use the Sage shell to install Sage packages.

The problem is that `sage-env` has some conditional commands.  One of these commands is setting `LD_LIBRARY_PATH`.  With #12405, only existing directories are added to `LD_LIBRARY_PATH`.  Upon entering the Sage shell, `$SAGE_LOCAL/lib` might not exist yet, so that directory isn't added. Since now `SAGE_ENV_SOURCED=1`, the variable `LD_LIBRARY_PATH` is not changed anymore.  Similarly, `PYTHONHOME` and `PYTHONPATH` are only set when Python has been installed.

This ticket is about adding a warning when running `sage --sh`.

Issue created by migration from https://trac.sagemath.org/ticket/12698





---

archive/issue_comments_148161.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-03-19T15:05:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12526",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12526#issuecomment-148161",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_148162.json:
```json
{
    "body": "The comment about not running `make` seems to conflict with the error message in `sage-spkg`:\n\n```\nInstead, the following commands setup all environment variables\ncorrectly and load a subshell for you to debug the error:\n  (cd '`pwd`' && '$SAGE_ROOT/sage' -sh)\nWhen you are done debugging, you can type \"exit\" to leave the subshell.\n```\n(It's not clear what should be done to \"debug the error\", but running `make` seems like a natural thing to do.)  Not running `sage -i ...` makes sense, but can you clarify the issue about running `make`?",
    "created_at": "2012-03-19T18:04:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12526",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12526#issuecomment-148162",
    "user": "https://github.com/jhpalmieri"
}
```

The comment about not running `make` seems to conflict with the error message in `sage-spkg`:

```
Instead, the following commands setup all environment variables
correctly and load a subshell for you to debug the error:
  (cd '`pwd`' && '$SAGE_ROOT/sage' -sh)
When you are done debugging, you can type "exit" to leave the subshell.
```
(It's not clear what should be done to "debug the error", but running `make` seems like a natural thing to do.)  Not running `sage -i ...` makes sense, but can you clarify the issue about running `make`?



---

archive/issue_comments_148163.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-03-20T07:31:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12526",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12526#issuecomment-148163",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_148164.json:
```json
{
    "body": "Replying to [comment:2 jhpalmieri]:\n> Not running `sage -i ...` makes sense, but can you clarify the issue about running `make`?\n\nI meant Sage's top-level \"make\" (or \"make\" inside `SAGE_ROOT/spkg` with #10492).  Running \"make\" inside a spkg directory is fine, and indeed one is encouraged to use the Sage shell for that.\n\nSo the wording should be improved.",
    "created_at": "2012-03-20T07:31:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12526",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12526#issuecomment-148164",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:2 jhpalmieri]:
> Not running `sage -i ...` makes sense, but can you clarify the issue about running `make`?

I meant Sage's top-level "make" (or "make" inside `SAGE_ROOT/spkg` with #10492).  Running "make" inside a spkg directory is fine, and indeed one is encouraged to use the Sage shell for that.

So the wording should be improved.



---

archive/issue_comments_148165.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-03-20T09:19:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12526",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12526#issuecomment-148165",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_148166.json:
```json
{
    "body": "Attachment [12698_sh_beware.patch](tarball://root/attachments/some-uuid/ticket12698/12698_sh_beware.patch) by @jhpalmieri created at 2012-03-20 18:34:04\n\nI think this is okay now.",
    "created_at": "2012-03-20T18:34:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12526",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12526#issuecomment-148166",
    "user": "https://github.com/jhpalmieri"
}
```

Attachment [12698_sh_beware.patch](tarball://root/attachments/some-uuid/ticket12698/12698_sh_beware.patch) by @jhpalmieri created at 2012-03-20 18:34:04

I think this is okay now.



---

archive/issue_comments_148167.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-03-20T18:34:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12526",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12526#issuecomment-148167",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_034437.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-03-23T15:23:56Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/12526",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12526#event-34437"
}
```



---

archive/issue_comments_148168.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-03-23T15:23:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12526",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12526#issuecomment-148168",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed
