# Issue 14524: cython dependency tracking

archive/issues_014524.json:
```json
{
    "body": "Assignee: felixs\n\nCC:  @robertwb @jondo\n\nKeywords: dependencies, cython, makefile\n\ncython does not write out make rules for dependencies, like other code-processors to.\nthis complicates dependency tracking a lot.\n\nthis is a known bug, http://trac.cython.org/cython_trac/ticket/655\n\nmy patch (minimal changes required in frontend) might need some scrubbing, but it works well for me.\n\nIssue created by migration from https://trac.sagemath.org/ticket/14728\n\n",
    "created_at": "2013-06-12T08:40:09Z",
    "labels": [
        "component: cython"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "cython dependency tracking",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/14524",
    "user": "https://trac.sagemath.org/admin/accounts/users/felixs"
}
```
Assignee: felixs

CC:  @robertwb @jondo

Keywords: dependencies, cython, makefile

cython does not write out make rules for dependencies, like other code-processors to.
this complicates dependency tracking a lot.

this is a known bug, http://trac.cython.org/cython_trac/ticket/655

my patch (minimal changes required in frontend) might need some scrubbing, but it works well for me.

Issue created by migration from https://trac.sagemath.org/ticket/14728





---

archive/issue_comments_184147.json:
```json
{
    "body": "Minor comments:\n\nI'd go / stay with single-letter short options (i.e., `-M <makefile>` or e.g. `--makefile <makefile>`).\n\nI'd use tabs (which is also the portable way) instead of hardcoded `\"    \"` (four spaces).",
    "created_at": "2013-06-12T12:24:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14524#issuecomment-184147",
    "user": "https://github.com/nexttime"
}
```

Minor comments:

I'd go / stay with single-letter short options (i.e., `-M <makefile>` or e.g. `--makefile <makefile>`).

I'd use tabs (which is also the portable way) instead of hardcoded `"    "` (four spaces).



---

archive/issue_comments_184148.json:
```json
{
    "body": "Replying to [comment:2 leif]:\n> Minor comments:\n> \n> I'd go / stay with single-letter short options (i.e., `-M <makefile>` or e.g. `--makefile <makefile>`).\n\ni dont like -MF either (does it violate POSIX?), but thats what gcc (and others) do. -M is something else -- related but different -- and will cause confusion. there are even other -M[A-Z] options that might be useful. i would just stick to long options, if they didn't waste so much space...\n\n> I'd use tabs (which is also the portable way) instead of hardcoded `\"    \"` (four spaces).\n\ngcc writes exactly one space character. i will do it like that, as it minimizes wrapping.",
    "created_at": "2013-06-12T20:48:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14524#issuecomment-184148",
    "user": "https://trac.sagemath.org/admin/accounts/users/felixs"
}
```

Replying to [comment:2 leif]:
> Minor comments:
> 
> I'd go / stay with single-letter short options (i.e., `-M <makefile>` or e.g. `--makefile <makefile>`).

i dont like -MF either (does it violate POSIX?), but thats what gcc (and others) do. -M is something else -- related but different -- and will cause confusion. there are even other -M[A-Z] options that might be useful. i would just stick to long options, if they didn't waste so much space...

> I'd use tabs (which is also the portable way) instead of hardcoded `"    "` (four spaces).

gcc writes exactly one space character. i will do it like that, as it minimizes wrapping.



---

archive/issue_comments_184149.json:
```json
{
    "body": "Replying to [comment:3 felixs]:\n> Replying to [comment:2 leif]:\n> > I'd go / stay with single-letter short options (i.e., `-M <makefile>` or e.g. `--makefile <makefile>`).\n> \n> i dont like -MF either (does it violate POSIX?)\n\nMF is at least not politically correct.\n\n> but thats what gcc (and others) do.\n\nWell, that's `cython`, not GCC, and Cython (so far) uses either single-letter short options or long options, so one day<sup>TM</sup> `-MF` might get interpreted as `-M -F`, with a different meaning.\n\n> -M is something else -- related but different\n\nIt just outputs the dependencies to `stdout`.\n\n\n\n\n> > I'd use tabs (which is also the portable way) instead of hardcoded `\"    \"` (four spaces).\n> \n> gcc writes exactly one space character. i will do it like that, as it minimizes wrapping.\n\nOh, you're right; we're writing just (escaped single-line) dependencies as opposed to receipts.",
    "created_at": "2013-06-12T22:04:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14524#issuecomment-184149",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:3 felixs]:
> Replying to [comment:2 leif]:
> > I'd go / stay with single-letter short options (i.e., `-M <makefile>` or e.g. `--makefile <makefile>`).
> 
> i dont like -MF either (does it violate POSIX?)

MF is at least not politically correct.

> but thats what gcc (and others) do.

Well, that's `cython`, not GCC, and Cython (so far) uses either single-letter short options or long options, so one day<sup>TM</sup> `-MF` might get interpreted as `-M -F`, with a different meaning.

> -M is something else -- related but different

It just outputs the dependencies to `stdout`.




> > I'd use tabs (which is also the portable way) instead of hardcoded `"    "` (four spaces).
> 
> gcc writes exactly one space character. i will do it like that, as it minimizes wrapping.

Oh, you're right; we're writing just (escaped single-line) dependencies as opposed to receipts.



---

archive/issue_comments_184150.json:
```json
{
    "body": "> MF is at least not politically correct.\nExactly, that's why i dont like it. on second thought it cannot cause problems, if -MF (gcc) translates to -F (cython, unused) and -M (gcc) will be implemented as -M (on cython side, currently unused).\n\n> > but thats what gcc (and others) do.\n> `-MF` might get interpreted as `-M -F`, with a different meaning.\n\nclearly, -MF will be interpreted as -M -F but not with a different meaning.\nFor gcc \"-M -MF <file>\" is also equal to \"-MF <file>\". thats the same with the other -M[A-Z] options as far as i can see.\n\nI would favor wasting the -F short option to implement gcc-style, rather than choosing new option names for well established functionality. but my patch needs to reflect that, and allow \"-F\" as well.\n\nunfortunately i'm not the one who will decide, so i will have to contact upstream about it.",
    "created_at": "2013-06-13T15:21:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14524#issuecomment-184150",
    "user": "https://trac.sagemath.org/admin/accounts/users/felixs"
}
```

> MF is at least not politically correct.
Exactly, that's why i dont like it. on second thought it cannot cause problems, if -MF (gcc) translates to -F (cython, unused) and -M (gcc) will be implemented as -M (on cython side, currently unused).

> > but thats what gcc (and others) do.
> `-MF` might get interpreted as `-M -F`, with a different meaning.

clearly, -MF will be interpreted as -M -F but not with a different meaning.
For gcc "-M -MF <file>" is also equal to "-MF <file>". thats the same with the other -M[A-Z] options as far as i can see.

I would favor wasting the -F short option to implement gcc-style, rather than choosing new option names for well established functionality. but my patch needs to reflect that, and allow "-F" as well.

unfortunately i'm not the one who will decide, so i will have to contact upstream about it.



---

archive/issue_comments_184151.json:
```json
{
    "body": "Replying to [comment:3 felixs]:\n> Replying to [comment:2 leif]:\n> > I'd go / stay with single-letter short options (i.e., `-M <makefile>` or e.g. `--makefile <makefile>`).\n> \n> i dont like -MF either (does it violate POSIX?)\n\n[Single Unix Specification Utility Syntax Guidelines](http://pubs.opengroup.org/onlinepubs/7908799/xbd/utilconv.html#usg)\n\n  *\"It is recommended that all future utilities and applications use these guidelines to enhance user portability. The fact that some historical utilities could not be changed (to avoid breaking existing applications) should not deter this future goal.\"*\n\n:-)",
    "created_at": "2013-06-13T17:37:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14524#issuecomment-184151",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:3 felixs]:
> Replying to [comment:2 leif]:
> > I'd go / stay with single-letter short options (i.e., `-M <makefile>` or e.g. `--makefile <makefile>`).
> 
> i dont like -MF either (does it violate POSIX?)

[Single Unix Specification Utility Syntax Guidelines](http://pubs.opengroup.org/onlinepubs/7908799/xbd/utilconv.html#usg)

  *"It is recommended that all future utilities and applications use these guidelines to enhance user portability. The fact that some historical utilities could not be changed (to avoid breaking existing applications) should not deter this future goal."*

:-)



---

archive/issue_comments_184152.json:
```json
{
    "body": "Replying to [comment:6 leif]:\n> [Single Unix Specification Utility Syntax Guidelines](http://pubs.opengroup.org/onlinepubs/7908799/xbd/utilconv.html#usg)\n\nThanks. I was looking for something like it. \n\nYou are not implying that the quote is opposed to my previous post, are you?",
    "created_at": "2013-06-13T18:15:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14524#issuecomment-184152",
    "user": "https://trac.sagemath.org/admin/accounts/users/felixs"
}
```

Replying to [comment:6 leif]:
> [Single Unix Specification Utility Syntax Guidelines](http://pubs.opengroup.org/onlinepubs/7908799/xbd/utilconv.html#usg)

Thanks. I was looking for something like it. 

You are not implying that the quote is opposed to my previous post, are you?



---

archive/issue_comments_184153.json:
```json
{
    "body": "Replying to [comment:7 felixs]:\n> Replying to [comment:6 leif]:\n> > [Single Unix Specification Utility Syntax Guidelines](http://pubs.opengroup.org/onlinepubs/7908799/xbd/utilconv.html#usg)\n> \n> Thanks. I was looking for something like it.\n\nSee also `man 3 getopt` (and for the GNU version, especially `POSIXLY_CORRECT` ;-) )\n\n\n\n\n> You are not implying that the quote is opposed to my previous post, are you?\n\nI leave that to your interpretation.\n\nNote that GNU `cpp` / `gcc` / `g++` do not accept `-MF <outputfile>` alone; you have to also give `-M` or `-MM` in addition.\n\n(And you'd probably also have to support `-FM ...`, and ignore `-F`.)",
    "created_at": "2013-06-13T18:29:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14524#issuecomment-184153",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:7 felixs]:
> Replying to [comment:6 leif]:
> > [Single Unix Specification Utility Syntax Guidelines](http://pubs.opengroup.org/onlinepubs/7908799/xbd/utilconv.html#usg)
> 
> Thanks. I was looking for something like it.

See also `man 3 getopt` (and for the GNU version, especially `POSIXLY_CORRECT` ;-) )




> You are not implying that the quote is opposed to my previous post, are you?

I leave that to your interpretation.

Note that GNU `cpp` / `gcc` / `g++` do not accept `-MF <outputfile>` alone; you have to also give `-M` or `-MM` in addition.

(And you'd probably also have to support `-FM ...`, and ignore `-F`.)



---

archive/issue_comments_184154.json:
```json
{
    "body": "> Note that GNU `cpp` / `gcc` / `g++` do not accept `-MF <outputfile>` alone; you have to also give `-M` or `-MM` in addition.\n\nIndeed. Particularly I am wrong in post number 5 about the gcc options.\n-MM is be not very much needed nor useful, so defaulting to -M might be sufferable.\n\n> (And you'd probably also have to support `-FM ...`, and ignore `-F`.)\n\n-FM sets the output filename to \"M\", standalone -F will not require one of -M and -MM. if there is no -MM, it should just be equivalent to -MF...\n\n(I'm getting closer, thanks for your help)",
    "created_at": "2013-06-13T19:03:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14524#issuecomment-184154",
    "user": "https://trac.sagemath.org/admin/accounts/users/felixs"
}
```

> Note that GNU `cpp` / `gcc` / `g++` do not accept `-MF <outputfile>` alone; you have to also give `-M` or `-MM` in addition.

Indeed. Particularly I am wrong in post number 5 about the gcc options.
-MM is be not very much needed nor useful, so defaulting to -M might be sufferable.

> (And you'd probably also have to support `-FM ...`, and ignore `-F`.)

-FM sets the output filename to "M", standalone -F will not require one of -M and -MM. if there is no -MM, it should just be equivalent to -MF...

(I'm getting closer, thanks for your help)



---

archive/issue_comments_184155.json:
```json
{
    "body": "Since this is an upstream feature, I think it would be better to submit a pull request at Cython's github with a cleaned-up version of your patch. Really, we should only patch cython for bug fixes or for features not included in the latest release that we want/need.",
    "created_at": "2013-06-17T06:31:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14524#issuecomment-184155",
    "user": "https://github.com/ohanar"
}
```

Since this is an upstream feature, I think it would be better to submit a pull request at Cython's github with a cleaned-up version of your patch. Really, we should only patch cython for bug fixes or for features not included in the latest release that we want/need.



---

archive/issue_comments_184156.json:
```json
{
    "body": "Replying to [comment:10 ohanar]:\n> Since this is an upstream feature, I think it would be better to submit a pull request at Cython's github with a cleaned-up version of your patch.\n\nI was assuming that's exactly what Felix was finally going to do (once the patch is in a submittable state); at least the \"Report upstream\" field is already set...",
    "created_at": "2013-06-17T15:04:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14524#issuecomment-184156",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:10 ohanar]:
> Since this is an upstream feature, I think it would be better to submit a pull request at Cython's github with a cleaned-up version of your patch.

I was assuming that's exactly what Felix was finally going to do (once the patch is in a submittable state); at least the "Report upstream" field is already set...



---

archive/issue_comments_184157.json:
```json
{
    "body": "Replying to [comment:10 ohanar]:\n> Since this is an upstream feature, I think it would be better to submit a pull request at Cython's github with a cleaned-up version of your patch. Really, we should only patch cython for bug fixes or for features not included in the latest release that we want/need.\n\nIts a bugfix, it's not included in the latest release and I want/need it. I've just added a -D switch and noticed cython-devel.",
    "created_at": "2013-06-19T06:42:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14524#issuecomment-184157",
    "user": "https://trac.sagemath.org/admin/accounts/users/felixs"
}
```

Replying to [comment:10 ohanar]:
> Since this is an upstream feature, I think it would be better to submit a pull request at Cython's github with a cleaned-up version of your patch. Really, we should only patch cython for bug fixes or for features not included in the latest release that we want/need.

Its a bugfix, it's not included in the latest release and I want/need it. I've just added a -D switch and noticed cython-devel.



---

archive/issue_comments_184158.json:
```json
{
    "body": "Considering it is marked 'wishlist' upstream, they definitely consider it a feature, not a bug. Also, at least from my perspective (correct me if I'm wrong Robert), but it seems like using the cython command line utility is not the recommended way to use cython -- rather it seems that cythonize+distutils/setuptools/distribute seems like the recommended way going forward. So I imagine adding this functionality to cython is not even on the radar for upstream. To avoid bitrot, I would seriously suggest submitting something upstream at least to get the ball rolling.",
    "created_at": "2013-06-19T20:18:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14524#issuecomment-184158",
    "user": "https://github.com/ohanar"
}
```

Considering it is marked 'wishlist' upstream, they definitely consider it a feature, not a bug. Also, at least from my perspective (correct me if I'm wrong Robert), but it seems like using the cython command line utility is not the recommended way to use cython -- rather it seems that cythonize+distutils/setuptools/distribute seems like the recommended way going forward. So I imagine adding this functionality to cython is not even on the radar for upstream. To avoid bitrot, I would seriously suggest submitting something upstream at least to get the ball rolling.



---

archive/issue_comments_184159.json:
```json
{
    "body": "Replying to [comment:13 ohanar]:\n> Considering it is marked 'wishlist' upstream, they definitely consider it a feature, not a bug. Also, at least from my perspective (correct me if I'm wrong Robert), but it seems like using the cython command line utility is not the recommended way to use cython -- rather it seems that cythonize+distutils/setuptools/distribute seems like the recommended way going forward.\n\nWell, it's perhaps Cython upstream's \"recommended way\", but in fact it is currently the *only way* because of the missing feature this ticket is supposed to add... ;-)",
    "created_at": "2013-06-20T00:54:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14524#issuecomment-184159",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:13 ohanar]:
> Considering it is marked 'wishlist' upstream, they definitely consider it a feature, not a bug. Also, at least from my perspective (correct me if I'm wrong Robert), but it seems like using the cython command line utility is not the recommended way to use cython -- rather it seems that cythonize+distutils/setuptools/distribute seems like the recommended way going forward.

Well, it's perhaps Cython upstream's "recommended way", but in fact it is currently the *only way* because of the missing feature this ticket is supposed to add... ;-)



---

archive/issue_comments_184160.json:
```json
{
    "body": "It might be just 'wishlist' upstream. Since it breaks anything that requires plain dependencies for cython generated files, and since there is no better option in the dropdown, i'll leave it like this.\n\n(The patch has moved to git, it looks like i cannot remove the attached file)",
    "created_at": "2013-08-29T11:19:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14524#issuecomment-184160",
    "user": "https://trac.sagemath.org/admin/accounts/users/felixs"
}
```

It might be just 'wishlist' upstream. Since it breaks anything that requires plain dependencies for cython generated files, and since there is no better option in the dropdown, i'll leave it like this.

(The patch has moved to git, it looks like i cannot remove the attached file)



---

archive/issue_comments_184161.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-09-03T08:21:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14524#issuecomment-184161",
    "user": "https://trac.sagemath.org/admin/accounts/users/felixs"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_184162.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-09-03T18:37:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14524#issuecomment-184162",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_184163.json:
```json
{
    "body": "cython patches do not apply",
    "created_at": "2015-09-03T18:37:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14524#issuecomment-184163",
    "user": "https://github.com/fchapoton"
}
```

cython patches do not apply



---

archive/issue_comments_184164.json:
```json
{
    "body": "Given that upstream Cython has no plans for this and given that nobody uses automake for Python projects, I suggest to close this as \"wontfix\".",
    "created_at": "2017-09-07T12:19:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14524#issuecomment-184164",
    "user": "https://github.com/jdemeyer"
}
```

Given that upstream Cython has no plans for this and given that nobody uses automake for Python projects, I suggest to close this as "wontfix".



---

archive/issue_comments_184165.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2017-09-07T12:19:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14524#issuecomment-184165",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_184166.json:
```json
{
    "body": "Resolution: wontfix",
    "created_at": "2017-12-12T08:23:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14524#issuecomment-184166",
    "user": "https://github.com/embray"
}
```

Resolution: wontfix
