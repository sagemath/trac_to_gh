# Issue 31397: discrete_log may fail when valid "ord" parameter is provided although log exists

archive/issues_031397.json:
```json
{
    "body": "CC:  @yyyyx4\n\nKeywords: discrete_log, babystep-giantstep\n\nWhen `discrete_log` is called with an `order` parameter (i.e., in the form `discrete_log(a, b, order)`), it can fail throwing an exception triggered by the call to Babystep-Giantstep `bsgs`, even though the provided `order` is valid according to the documentation (being equal to a proper multiple of the exact order of `b`), and the log itself exists.\n\nIf the `order` parameter is omitted or equal to the exact order of `b`, the bug does not seem to be triggered.\n\n\n```\nsage: version()                                                                                                                                \n'SageMath version 9.2, Release Date: 2020-10-24'\nsage: p = 3571                                                                                                                                 \nsage: p in Primes()                                                                                                                            \nTrue\nsage: F = GF(p)                                                                                                                                \nsage: a = F(2213)                                                                                                                              \nsage: b = F(650)                                                                                                                               \nsage: discrete_log(a, b)                                                                                                                       \n319\nsage: b.multiplicative_order()                                                                                                                 \n510\nsage: discrete_log(a, b, 510)                                                                                                                  \n319\nsage: discrete_log(a, b, 4*510)\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n/ext/sage/sage-9.2/local/lib/python3.8/site-packages/sage/groups/generic.py in discrete_log(a, base, ord, bounds, operation, identity, inverse, op)\n    828                 if operation in multiplication_names:\n--> 829                     c=bsgs(base**(ord//pi),(a/base**l[i])**(ord//pi**(j+1)),(0,pi),operation=operation)\n    830                     l[i] += c*(pi**j)\n\n/ext/sage/sage-9.2/local/lib/python3.8/site-packages/sage/groups/generic.py in bsgs(a, b, bounds, operation, identity, inverse, op)\n    485             d = op(a,d)\n--> 486         raise ValueError(\"No solution in bsgs()\")\n    487 \n\nValueError: No solution in bsgs()\n\nDuring handling of the above exception, another exception occurred:\n\nValueError                                Traceback (most recent call last)\n<ipython-input-13-d289f24fe9c3> in <module>\n----> 1 discrete_log(a, b, Integer(4)*Integer(510))\n\n/ext/sage/sage-9.2/local/lib/python3.8/site-packages/sage/groups/generic.py in discrete_log(a, base, ord, bounds, operation, identity, inverse, op)\n    835         return  CRT_list(l,[pi**ri for pi,ri in f])\n    836     except ValueError:\n--> 837         raise ValueError(\"No discrete log of %s found to base %s\"%(a,base))\n    838 \n    839 \n\nValueError: No discrete log of 2213 found to base 650\nsage:   \n```\n\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/31634\n\n",
    "created_at": "2021-04-09T22:00:01Z",
    "labels": [
        "component: group theory",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "discrete_log may fail when valid \"ord\" parameter is provided although log exists",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31397",
    "user": "https://github.com/eduenez"
}
```
CC:  @yyyyx4

Keywords: discrete_log, babystep-giantstep

When `discrete_log` is called with an `order` parameter (i.e., in the form `discrete_log(a, b, order)`), it can fail throwing an exception triggered by the call to Babystep-Giantstep `bsgs`, even though the provided `order` is valid according to the documentation (being equal to a proper multiple of the exact order of `b`), and the log itself exists.

If the `order` parameter is omitted or equal to the exact order of `b`, the bug does not seem to be triggered.


```
sage: version()                                                                                                                                
'SageMath version 9.2, Release Date: 2020-10-24'
sage: p = 3571                                                                                                                                 
sage: p in Primes()                                                                                                                            
True
sage: F = GF(p)                                                                                                                                
sage: a = F(2213)                                                                                                                              
sage: b = F(650)                                                                                                                               
sage: discrete_log(a, b)                                                                                                                       
319
sage: b.multiplicative_order()                                                                                                                 
510
sage: discrete_log(a, b, 510)                                                                                                                  
319
sage: discrete_log(a, b, 4*510)
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
/ext/sage/sage-9.2/local/lib/python3.8/site-packages/sage/groups/generic.py in discrete_log(a, base, ord, bounds, operation, identity, inverse, op)
    828                 if operation in multiplication_names:
--> 829                     c=bsgs(base**(ord//pi),(a/base**l[i])**(ord//pi**(j+1)),(0,pi),operation=operation)
    830                     l[i] += c*(pi**j)

/ext/sage/sage-9.2/local/lib/python3.8/site-packages/sage/groups/generic.py in bsgs(a, b, bounds, operation, identity, inverse, op)
    485             d = op(a,d)
--> 486         raise ValueError("No solution in bsgs()")
    487 

ValueError: No solution in bsgs()

During handling of the above exception, another exception occurred:

ValueError                                Traceback (most recent call last)
<ipython-input-13-d289f24fe9c3> in <module>
----> 1 discrete_log(a, b, Integer(4)*Integer(510))

/ext/sage/sage-9.2/local/lib/python3.8/site-packages/sage/groups/generic.py in discrete_log(a, base, ord, bounds, operation, identity, inverse, op)
    835         return  CRT_list(l,[pi**ri for pi,ri in f])
    836     except ValueError:
--> 837         raise ValueError("No discrete log of %s found to base %s"%(a,base))
    838 
    839 

ValueError: No discrete log of 2213 found to base 650
sage:   
```




Issue created by migration from https://trac.sagemath.org/ticket/31634





---

archive/issue_comments_448616.json:
```json
{
    "body": "Moving to 9.4, as 9.3 has been released.",
    "created_at": "2021-05-10T17:42:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31397#issuecomment-448616",
    "user": "https://github.com/mkoeppe"
}
```

Moving to 9.4, as 9.3 has been released.



---

archive/issue_events_083296.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-05-10T17:42:09Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31397",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31397#event-83296"
}
```



---

archive/issue_events_083297.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-22T20:35:10Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31397",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31397#event-83297"
}
```



---

archive/issue_events_083298.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-22T20:35:10Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31397",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31397#event-83298"
}
```



---

archive/issue_events_083299.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T20:12:32Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31397",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31397#event-83299"
}
```



---

archive/issue_events_083300.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T20:12:32Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31397",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31397#event-83300"
}
```



---

archive/issue_events_083301.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-05-03T15:17:06Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31397",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31397#event-83301"
}
```



---

archive/issue_events_083302.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-05-03T15:17:06Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31397",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31397#event-83302"
}
```



---

archive/issue_events_083303.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31397",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31397#event-83303"
}
```



---

archive/issue_events_083304.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31397",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31397#event-83304"
}
```
