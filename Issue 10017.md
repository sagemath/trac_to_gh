# Issue 10017: Unhandled SIGSEGV after bnfcertify()

archive/issues_010017.json:
```json
{
    "body": "Assignee: tba\n\nCC:  leif\n\nKeywords: segfault segmentation fault bnfcertify\n\nDo the following in Sage:\n\n```\nsage: K.<z> = CyclotomicField(23); bnf=K.pari_bnf(certify=False)\nsage: bnf.bnfcertify()\n```\n\nAfter typing the second line `bnf.bnfcertify()`, hit CTRL-c after 10 seconds or so. It will take a long time before the interrupt registers, but eventually a KeyboardInterrupt will show up.  However, something is wrong after this KeyboardInterrupt, because typing\n\n```\nK.<z> = CyclotomicField(23)\n```\n\nimmediately gives the dreaded\n\n```\n------------------------------------------------------------\nUnhandled SIGSEGV: A segmentation fault occurred in Sage.\nThis probably occurred because a *compiled* component\nof Sage has a bug in it (typically accessing invalid memory)\nor is not properly wrapped with _sig_on, _sig_off.\nYou might want to run Sage under gdb with 'sage -gdb' to debug this.\nSage will now terminate (sorry).\n------------------------------------------------------------\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/10018\n\n",
    "created_at": "2010-09-26T11:49:57Z",
    "labels": [
        "c_lib",
        "critical",
        "bug"
    ],
    "title": "Unhandled SIGSEGV after bnfcertify()",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10017",
    "user": "jdemeyer"
}
```
Assignee: tba

CC:  leif

Keywords: segfault segmentation fault bnfcertify

Do the following in Sage:

```
sage: K.<z> = CyclotomicField(23); bnf=K.pari_bnf(certify=False)
sage: bnf.bnfcertify()
```

After typing the second line `bnf.bnfcertify()`, hit CTRL-c after 10 seconds or so. It will take a long time before the interrupt registers, but eventually a KeyboardInterrupt will show up.  However, something is wrong after this KeyboardInterrupt, because typing

```
K.<z> = CyclotomicField(23)
```

immediately gives the dreaded

```
------------------------------------------------------------
Unhandled SIGSEGV: A segmentation fault occurred in Sage.
This probably occurred because a *compiled* component
of Sage has a bug in it (typically accessing invalid memory)
or is not properly wrapped with _sig_on, _sig_off.
You might want to run Sage under gdb with 'sage -gdb' to debug this.
Sage will now terminate (sorry).
------------------------------------------------------------
```


Issue created by migration from https://trac.sagemath.org/ticket/10018





---

archive/issue_comments_100639.json:
```json
{
    "body": "Changing keywords from \"segfault segmentation fault bnfcertify\" to \"segfault segmentation fault bnfcertify allocatemem\".",
    "created_at": "2010-09-26T12:11:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10017#issuecomment-100639",
    "user": "jdemeyer"
}
```

Changing keywords from "segfault segmentation fault bnfcertify" to "segfault segmentation fault bnfcertify allocatemem".



---

archive/issue_comments_100640.json:
```json
{
    "body": "This might be a bug with the handling of `allocatemem()` in PARI.  The same computation in `gp` gives:\n\n```\nbash$ sage -gp --fast --stacksize=10000000\n                                      GP/PARI CALCULATOR Version 2.4.3 (development svn-12577:12605)\n                                       amd64 running linux (x86-64/GMP-4.2.1 kernel) 64-bit version\n                                     compiled: Sep 24 2010, gcc-4.6.0 20100705 (experimental) (GCC)\n                                              (readline v6.0 enabled, extended help enabled)\n\n                                                  Copyright (C) 2000-2008 The PARI Group\n\nPARI/GP is free software, covered by the GNU General Public License, and comes WITHOUT ANY WARRANTY WHATSOEVER.\n\nType ? for help, \\q to quit.\nType ?12 for how to get moral (and possibly technical) support.\n\nparisize = 10000000, primelimit = 500509\n? bnf = bnfinit(polcyclo(23));\n? bnfcertify(bnf)\n  ***   at top-level: bnfcertify(bnf)\n  ***                 ^---------------\n  *** bnfcertify: the PARI stack overflows !\n  current stack size: 10000000 (9.537 Mbytes)\n  [hint] you can increase GP stack with allocatemem()\n\n  ***   Break loop: type 'break' to go back to GP\nbreak>\n```\n",
    "created_at": "2010-09-26T12:11:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10017#issuecomment-100640",
    "user": "jdemeyer"
}
```

This might be a bug with the handling of `allocatemem()` in PARI.  The same computation in `gp` gives:

```
bash$ sage -gp --fast --stacksize=10000000
                                      GP/PARI CALCULATOR Version 2.4.3 (development svn-12577:12605)
                                       amd64 running linux (x86-64/GMP-4.2.1 kernel) 64-bit version
                                     compiled: Sep 24 2010, gcc-4.6.0 20100705 (experimental) (GCC)
                                              (readline v6.0 enabled, extended help enabled)

                                                  Copyright (C) 2000-2008 The PARI Group

PARI/GP is free software, covered by the GNU General Public License, and comes WITHOUT ANY WARRANTY WHATSOEVER.

Type ? for help, \q to quit.
Type ?12 for how to get moral (and possibly technical) support.

parisize = 10000000, primelimit = 500509
? bnf = bnfinit(polcyclo(23));
? bnfcertify(bnf)
  ***   at top-level: bnfcertify(bnf)
  ***                 ^---------------
  *** bnfcertify: the PARI stack overflows !
  current stack size: 10000000 (9.537 Mbytes)
  [hint] you can increase GP stack with allocatemem()

  ***   Break loop: type 'break' to go back to GP
break>
```




---

archive/issue_comments_100641.json:
```json
{
    "body": "Changing keywords from \"segfault segmentation fault bnfcertify allocatemem\" to \"segfault segmentation fault allocatemem interrupt _sig_on _sig_retry\".",
    "created_at": "2010-09-27T09:02:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10017#issuecomment-100641",
    "user": "jdemeyer"
}
```

Changing keywords from "segfault segmentation fault bnfcertify allocatemem" to "segfault segmentation fault allocatemem interrupt _sig_on _sig_retry".



---

archive/issue_comments_100642.json:
```json
{
    "body": "A good place to also add some more case distinctions on PARI's `errnum`... ;-)",
    "created_at": "2010-09-27T09:57:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10017#issuecomment-100642",
    "user": "leif"
}
```

A good place to also add some more case distinctions on PARI's `errnum`... ;-)



---

archive/issue_comments_100643.json:
```json
{
    "body": "Replying to [comment:7 leif]:\n> A good place to also add some more case distinctions on PARI's `errnum`... ;-)\n\nThis is planned for #9640 (in the not-so-near future though).",
    "created_at": "2010-09-27T10:55:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10017#issuecomment-100643",
    "user": "jdemeyer"
}
```

Replying to [comment:7 leif]:
> A good place to also add some more case distinctions on PARI's `errnum`... ;-)

This is planned for #9640 (in the not-so-near future though).



---

archive/issue_comments_100644.json:
```json
{
    "body": "Changing assignee from tba to jdemeyer.",
    "created_at": "2010-09-27T11:09:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10017#issuecomment-100644",
    "user": "jdemeyer"
}
```

Changing assignee from tba to jdemeyer.



---

archive/issue_comments_100645.json:
```json
{
    "body": "Apply on top of #9898",
    "created_at": "2010-09-27T11:23:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10017#issuecomment-100645",
    "user": "jdemeyer"
}
```

Apply on top of #9898



---

archive/issue_comments_100646.json:
```json
{
    "body": "Attachment\n\nReplying to [comment:8 jdemeyer]:\n> Replying to [comment:7 leif]:\n> > A good place to also add some more case distinctions on PARI's `errnum`... ;-)\n> \n> This is planned for #9640 (in the not-so-near future though).\n\nOk. I thought of just adding number 5 (`talker`?) here, mapping it to `ValueError`, which comes nearest (could also be `TypeError` (domain) or `RangeError` etc.).",
    "created_at": "2010-09-27T12:00:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10017#issuecomment-100646",
    "user": "leif"
}
```

Attachment

Replying to [comment:8 jdemeyer]:
> Replying to [comment:7 leif]:
> > A good place to also add some more case distinctions on PARI's `errnum`... ;-)
> 
> This is planned for #9640 (in the not-so-near future though).

Ok. I thought of just adding number 5 (`talker`?) here, mapping it to `ValueError`, which comes nearest (could also be `TypeError` (domain) or `RangeError` etc.).



---

archive/issue_comments_100647.json:
```json
{
    "body": "... because of #9640 *\"not-so-near future\"*.",
    "created_at": "2010-09-27T12:02:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10017#issuecomment-100647",
    "user": "leif"
}
```

... because of #9640 *"not-so-near future"*.



---

archive/issue_comments_100648.json:
```json
{
    "body": "Replying to [comment:10 leif]:\n> Ok. I thought of just adding number 5 (`talker`?) here, mapping it to `ValueError`, which comes nearest (could also be `TypeError` (domain) or `RangeError` etc.). \n\nI think it is good that now all errors thrown by PARI are of the type `PariError`.  If you want to raise a different exception, I think it should be done by higher-level code, like:\n\n\n```\ntry:\n    # do something with PARI\nexcept PariError, err:\n    if err.errnum() == talker:\n        raise ValueError\n    raise err\n```\n\n\n(this currently only works with Cython because `talker` is defined in a PARI C header).",
    "created_at": "2010-09-27T12:56:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10017#issuecomment-100648",
    "user": "jdemeyer"
}
```

Replying to [comment:10 leif]:
> Ok. I thought of just adding number 5 (`talker`?) here, mapping it to `ValueError`, which comes nearest (could also be `TypeError` (domain) or `RangeError` etc.). 

I think it is good that now all errors thrown by PARI are of the type `PariError`.  If you want to raise a different exception, I think it should be done by higher-level code, like:


```
try:
    # do something with PARI
except PariError, err:
    if err.errnum() == talker:
        raise ValueError
    raise err
```


(this currently only works with Cython because `talker` is defined in a PARI C header).



---

archive/issue_comments_100649.json:
```json
{
    "body": "Replying to [comment:12 jdemeyer]:\n> (this currently only works with Cython because `talker` is defined in a PARI C header).\n\n... and would require changing much more code. ;-)\n\nThe actual error message should be `vsnprintf()`'ed into a buffer (upstream) such that we can also propagate the real cause.",
    "created_at": "2010-09-27T13:15:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10017#issuecomment-100649",
    "user": "leif"
}
```

Replying to [comment:12 jdemeyer]:
> (this currently only works with Cython because `talker` is defined in a PARI C header).

... and would require changing much more code. ;-)

The actual error message should be `vsnprintf()`'ed into a buffer (upstream) such that we can also propagate the real cause.



---

archive/issue_comments_100650.json:
```json
{
    "body": "Replying to [comment:13 leif]:\n> The actual error message should be `vsnprintf()`'ed into a buffer (upstream) such that we can also propagate the real cause.\n\nThat is more or less the idea of #9640.\n\nBut I also noticed that the whole exception-catching mechanism can be vastly improved (for example, now there is a general signal-handling facility in Sage and a specific error-handling facility for PARI which should be merged into one system).  Also, there is essentially no testing code for this Cython error handling.  Good testing code should have caught #10018.  All this should eventually be in #9678.",
    "created_at": "2010-09-27T13:24:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10017#issuecomment-100650",
    "user": "jdemeyer"
}
```

Replying to [comment:13 leif]:
> The actual error message should be `vsnprintf()`'ed into a buffer (upstream) such that we can also propagate the real cause.

That is more or less the idea of #9640.

But I also noticed that the whole exception-catching mechanism can be vastly improved (for example, now there is a general signal-handling facility in Sage and a specific error-handling facility for PARI which should be merged into one system).  Also, there is essentially no testing code for this Cython error handling.  Good testing code should have caught #10018.  All this should eventually be in #9678.



---

archive/issue_comments_100651.json:
```json
{
    "body": "Replying to [comment:13 leif]:\n> The actual error message should be `vsnprintf()`'ed into a buffer (upstream) such that we can also propagate the real cause.\n\nI added the following in `src/language/init.c` to debug PARI:\n\n```C\nvoid\npari_err(int numerr, ...)\n{\n  PariOUT *out = pariOut;\n  va_list ap;\n\n  va_start(ap,numerr);\n\n  if (numerr==talker) /* added part */\n  {\n    va_list ap2;\n    const char *fmt;\n\n    va_copy(ap2,ap);\n    fmt=(char*)va_arg(ap2,char*);\n\n    vfprintf(stderr,fmt,ap2); /* we can equally well write into a global buffer here */\n    fflush(stderr);           /* with vsnprintf() to propagate the error message */\n  }\n\n  ...\n```\n",
    "created_at": "2010-09-27T13:29:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10017#issuecomment-100651",
    "user": "leif"
}
```

Replying to [comment:13 leif]:
> The actual error message should be `vsnprintf()`'ed into a buffer (upstream) such that we can also propagate the real cause.

I added the following in `src/language/init.c` to debug PARI:

```C
void
pari_err(int numerr, ...)
{
  PariOUT *out = pariOut;
  va_list ap;

  va_start(ap,numerr);

  if (numerr==talker) /* added part */
  {
    va_list ap2;
    const char *fmt;

    va_copy(ap2,ap);
    fmt=(char*)va_arg(ap2,char*);

    vfprintf(stderr,fmt,ap2); /* we can equally well write into a global buffer here */
    fflush(stderr);           /* with vsnprintf() to propagate the error message */
  }

  ...
```




---

archive/issue_comments_100652.json:
```json
{
    "body": "I actually added some more `printf()`s:\n\n```C\n    ...\n    fprintf(stderr,\n      \"\\n******************** PARI ERROR: ********************\\n\");\n    vfprintf(stderr,fmt,ap2);\n    fprintf(stderr,\n      \"\\n*****************************************************\\n\");\n    fflush(stderr);\n    ...\n```\n\n\nOf course a temporary hack (and a bit odd in the interpreter), but an improvement to just\n\n```\n      File \"gen.pyx\", line 9460, in sage.libs.pari.gen._pari_trap (sage/libs/pari/gen.c:45047)\n    PariError:  (5)\n```\n\nand trivial enough s.t. it could be merged without any risk. ;-)\n\n(PARI's messages of course aren't always that informative without examining the stack.)",
    "created_at": "2010-09-27T14:34:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10017#issuecomment-100652",
    "user": "leif"
}
```

I actually added some more `printf()`s:

```C
    ...
    fprintf(stderr,
      "\n******************** PARI ERROR: ********************\n");
    vfprintf(stderr,fmt,ap2);
    fprintf(stderr,
      "\n*****************************************************\n");
    fflush(stderr);
    ...
```


Of course a temporary hack (and a bit odd in the interpreter), but an improvement to just

```
      File "gen.pyx", line 9460, in sage.libs.pari.gen._pari_trap (sage/libs/pari/gen.c:45047)
    PariError:  (5)
```

and trivial enough s.t. it could be merged without any risk. ;-)

(PARI's messages of course aren't always that informative without examining the stack.)



---

archive/issue_comments_100653.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2010-09-27T21:16:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10017#issuecomment-100653",
    "user": "jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_100654.json:
```json
{
    "body": "With `10018_sig_retry.patch`, all long doctests pass on a 32-bit PPC OS X 10.4, now testing on `sage.math.washington.edu` (64-bit Intel Linux).\n\nI also tried very hard to break things in PARI using many different combinations of pari.allocatemem(), other PARI functions and CTRL-C and I did not manage :-)",
    "created_at": "2010-09-27T21:16:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10017#issuecomment-100654",
    "user": "jdemeyer"
}
```

With `10018_sig_retry.patch`, all long doctests pass on a 32-bit PPC OS X 10.4, now testing on `sage.math.washington.edu` (64-bit Intel Linux).

I also tried very hard to break things in PARI using many different combinations of pari.allocatemem(), other PARI functions and CTRL-C and I did not manage :-)



---

archive/issue_comments_100655.json:
```json
{
    "body": "Changing keywords from \"segfault segmentation fault allocatemem interrupt _sig_on _sig_retry\" to \"pari segfault segmentation fault allocatemem interrupt _sig_on _sig_retry\".",
    "created_at": "2010-09-28T13:06:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10017#issuecomment-100655",
    "user": "jdemeyer"
}
```

Changing keywords from "segfault segmentation fault allocatemem interrupt _sig_on _sig_retry" to "pari segfault segmentation fault allocatemem interrupt _sig_on _sig_retry".



---

archive/issue_comments_100656.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2010-10-13T13:27:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10017#issuecomment-100656",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_100657.json:
```json
{
    "body": "Probably this will be absorbed by #9678.",
    "created_at": "2010-10-13T13:27:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10017#issuecomment-100657",
    "user": "jdemeyer"
}
```

Probably this will be absorbed by #9678.



---

archive/issue_comments_100658.json:
```json
{
    "body": "Changing keywords from \"pari segfault segmentation fault allocatemem interrupt _sig_on _sig_retry\" to \"pari segfault segmentation fault allocatemem interrupt sig_on sig_retry\".",
    "created_at": "2010-10-17T18:43:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10017#issuecomment-100658",
    "user": "jdemeyer"
}
```

Changing keywords from "pari segfault segmentation fault allocatemem interrupt _sig_on _sig_retry" to "pari segfault segmentation fault allocatemem interrupt sig_on sig_retry".



---

archive/issue_comments_100659.json:
```json
{
    "body": "Attachment\n\nNew patch, ignore previous",
    "created_at": "2011-04-13T12:19:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10017#issuecomment-100659",
    "user": "jdemeyer"
}
```

Attachment

New patch, ignore previous



---

archive/issue_comments_100660.json:
```json
{
    "body": "I cannot reproduce this bug.  Has it been fixed in another ticket?",
    "created_at": "2011-11-12T17:23:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10017#issuecomment-100660",
    "user": "johanbosman"
}
```

I cannot reproduce this bug.  Has it been fixed in another ticket?



---

archive/issue_comments_100661.json:
```json
{
    "body": "I tried and I also can't reproduce it. The comments mention #9678 which may have fixed it. I suggest figuring out how this bug was fixed before closing it.",
    "created_at": "2013-09-08T13:27:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10017#issuecomment-100661",
    "user": "itaibn"
}
```

I tried and I also can't reproduce it. The comments mention #9678 which may have fixed it. I suggest figuring out how this bug was fixed before closing it.



---

archive/issue_comments_100662.json:
```json
{
    "body": "Changing status from needs_work to needs_info.",
    "created_at": "2013-09-09T18:55:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10017#issuecomment-100662",
    "user": "pbruin"
}
```

Changing status from needs_work to needs_info.



---

archive/issue_comments_100663.json:
```json
{
    "body": "I can't reproduce it either.  I don't really see the point of trying to find out why this bug existed, since #9678 essentially rewrote the whole error-handling code.\n\nWhat is the status of [attachment:10018_pari_sig_retry.patch]?  Assuming that this bug has indeed disappeared, is the patch still relevant for the general plan to improve the PARI error handling mechanism (cf. #9640, #14894)?",
    "created_at": "2013-09-09T18:55:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10017#issuecomment-100663",
    "user": "pbruin"
}
```

I can't reproduce it either.  I don't really see the point of trying to find out why this bug existed, since #9678 essentially rewrote the whole error-handling code.

What is the status of [attachment:10018_pari_sig_retry.patch]?  Assuming that this bug has indeed disappeared, is the patch still relevant for the general plan to improve the PARI error handling mechanism (cf. #9640, #14894)?



---

archive/issue_comments_100664.json:
```json
{
    "body": "#9678 changed a lot of the error-handling code, but it doesn't seem to make any changes to Pari. That's why I'm cautious. That said, I notice that both of these patches are by jdemeyer. He probably understands how these changes interact and if he abandoned this it's probably safe to close this.\n\nAlso, attachment:10018_pari_sig_retry.patch looks like it's many changing the memory management in Pari, while the tickets you mention look like they're about the interaction between error management in sage and in pari. They seem unrelated.",
    "created_at": "2013-09-11T22:47:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10017#issuecomment-100664",
    "user": "itaibn"
}
```

#9678 changed a lot of the error-handling code, but it doesn't seem to make any changes to Pari. That's why I'm cautious. That said, I notice that both of these patches are by jdemeyer. He probably understands how these changes interact and if he abandoned this it's probably safe to close this.

Also, attachment:10018_pari_sig_retry.patch looks like it's many changing the memory management in Pari, while the tickets you mention look like they're about the interaction between error management in sage and in pari. They seem unrelated.



---

archive/issue_comments_100665.json:
```json
{
    "body": "I don't have much time to think of this now, but [attachment:10018_pari_sig_retry.patch\u200b] is indeed changing the PARI error handling mechanism. Let's first look at #9640 and then at this patch.",
    "created_at": "2013-09-12T00:20:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10017#issuecomment-100665",
    "user": "jdemeyer"
}
```

I don't have much time to think of this now, but [attachment:10018_pari_sig_retry.patchâ€‹] is indeed changing the PARI error handling mechanism. Let's first look at #9640 and then at this patch.



---

archive/issue_comments_100666.json:
```json
{
    "body": "Changing status from needs_info to needs_work.",
    "created_at": "2013-11-01T22:52:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10017#issuecomment-100666",
    "user": "jdemeyer"
}
```

Changing status from needs_info to needs_work.



---

archive/issue_comments_100667.json:
```json
{
    "body": "Changing keywords from \"pari segfault segmentation fault allocatemem interrupt sig_on sig_retry\" to \"pari init_stack\".",
    "created_at": "2013-11-01T22:52:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10017#issuecomment-100667",
    "user": "jdemeyer"
}
```

Changing keywords from "pari segfault segmentation fault allocatemem interrupt sig_on sig_retry" to "pari init_stack".



---

archive/issue_comments_100668.json:
```json
{
    "body": "Changing priority from critical to minor.",
    "created_at": "2013-11-02T11:07:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10017#issuecomment-100668",
    "user": "jdemeyer"
}
```

Changing priority from critical to minor.



---

archive/issue_comments_100669.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-11-02T11:17:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10017#issuecomment-100669",
    "user": "jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_100670.json:
```json
{
    "body": "Attachment",
    "created_at": "2013-11-03T07:53:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10017#issuecomment-100670",
    "user": "jdemeyer"
}
```

Attachment



---

archive/issue_comments_100671.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-11-04T12:06:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10017#issuecomment-100671",
    "user": "pbruin"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_100672.json:
```json
{
    "body": "This looks good, it passes doctests, and I agree with the deprecation of `init_pari_stack()`.",
    "created_at": "2013-11-04T12:06:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10017#issuecomment-100672",
    "user": "pbruin"
}
```

This looks good, it passes doctests, and I agree with the deprecation of `init_pari_stack()`.



---

archive/issue_comments_100673.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-11-22T15:49:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10017",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10017#issuecomment-100673",
    "user": "jdemeyer"
}
```

Resolution: fixed
