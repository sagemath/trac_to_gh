# Issue 29349: Improve configure's recommendations

archive/issues_029349.json:
```json
{
    "body": "CC:  @mkoeppe @slel @mwageringel @dimpase @EmmanuelCharpentier\n\nOn macOS with `ppl` installed via Homebrew,\nthe `configure` script reported the following:\n\n```\n## ---------------------------------------------------- ##\n## Checking whether SageMath should install SPKG ppl... ##\n## ---------------------------------------------------- ##\nconfigure:27878: checking whether any of glpk gmp mpir\nis installed as or will be installed as SPKG\nconfigure:27882: result: yes; install ppl as well\nconfigure:28277: no suitable system package found for SPKG ppl\n```\n\nand eventually recommended to `brew install ppl`.\n\nIt would seem that, in the above, this is correct:\n\n```\nconfigure:27878: checking whether any of glpk gmp mpir\nis installed as or will be installed as SPKG\nconfigure:27882: result: yes; install ppl as well\n```\nbut this does not really follow:\n\n```\nconfigure:28277: no suitable system package found for SPKG ppl\n```\n\n\nIn this case, because at least one of (glpk, gmp, mpir)\neither was or would be installed as an SPKG, the script\nconcluded ppl should be installed as an SPKG too.\n\nSo the decision to install ppl was based on that,\nnot on the absence of ppl. In such a case, maybe\nthe script should not recommend installing ppl\n(at least not without checking if it is actually there).\n\nInitial report:\n[sage-release](https://groups.google.com/d/msg/sage-release/aTSxEyE9Mrc/NggXIR1oBAAJ).\n\nIssue created by migration from https://trac.sagemath.org/ticket/29586\n\n",
    "created_at": "2020-04-26T03:32:38Z",
    "labels": [
        "component: build: configure"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Improve configure's recommendations",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29349",
    "user": "https://github.com/slel"
}
```
CC:  @mkoeppe @slel @mwageringel @dimpase @EmmanuelCharpentier

On macOS with `ppl` installed via Homebrew,
the `configure` script reported the following:

```
## ---------------------------------------------------- ##
## Checking whether SageMath should install SPKG ppl... ##
## ---------------------------------------------------- ##
configure:27878: checking whether any of glpk gmp mpir
is installed as or will be installed as SPKG
configure:27882: result: yes; install ppl as well
configure:28277: no suitable system package found for SPKG ppl
```

and eventually recommended to `brew install ppl`.

It would seem that, in the above, this is correct:

```
configure:27878: checking whether any of glpk gmp mpir
is installed as or will be installed as SPKG
configure:27882: result: yes; install ppl as well
```
but this does not really follow:

```
configure:28277: no suitable system package found for SPKG ppl
```


In this case, because at least one of (glpk, gmp, mpir)
either was or would be installed as an SPKG, the script
concluded ppl should be installed as an SPKG too.

So the decision to install ppl was based on that,
not on the absence of ppl. In such a case, maybe
the script should not recommend installing ppl
(at least not without checking if it is actually there).

Initial report:
[sage-release](https://groups.google.com/d/msg/sage-release/aTSxEyE9Mrc/NggXIR1oBAAJ).

Issue created by migration from https://trac.sagemath.org/ticket/29586





---

archive/issue_comments_415800.json:
```json
{
    "body": "To reformulate:\n- don't recommend installing a package via the system's\n  package manager in case the decision to install as spkg\n  was based on some dependency being installed,\n  or about to be installed, as spkg\n\nThe relevant logic seems to be in `m4/sage_spkg_collect.m4`\nor `m4/sage_spkg_configure.m4`.",
    "created_at": "2020-04-26T03:43:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29349",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29349#issuecomment-415800",
    "user": "https://github.com/slel"
}
```

To reformulate:
- don't recommend installing a package via the system's
  package manager in case the decision to install as spkg
  was based on some dependency being installed,
  or about to be installed, as spkg

The relevant logic seems to be in `m4/sage_spkg_collect.m4`
or `m4/sage_spkg_configure.m4`.



---

archive/issue_comments_415801.json:
```json
{
    "body": "Thanks for creating the ticket! I've linked to it from #29146",
    "created_at": "2020-04-26T03:48:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29349",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29349#issuecomment-415801",
    "user": "https://github.com/mkoeppe"
}
```

Thanks for creating the ticket! I've linked to it from #29146



---

archive/issue_comments_415802.json:
```json
{
    "body": "I think in this case we should change `build/pkgs/glpk/distros/homebrew.txt` to uncomment `glpk`. Then its installation would be recommended, and once it's found, homebrew's `ppl` would be used, too.",
    "created_at": "2020-04-26T04:06:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29349",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29349#issuecomment-415802",
    "user": "https://github.com/jhpalmieri"
}
```

I think in this case we should change `build/pkgs/glpk/distros/homebrew.txt` to uncomment `glpk`. Then its installation would be recommended, and once it's found, homebrew's `ppl` would be used, too.



---

archive/issue_comments_415803.json:
```json
{
    "body": "Or a bug report to homebrew should be made",
    "created_at": "2020-04-26T04:11:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29349",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29349#issuecomment-415803",
    "user": "https://github.com/mkoeppe"
}
```

Or a bug report to homebrew should be made



---

archive/issue_comments_415804.json:
```json
{
    "body": "Reporting what bug? The messages that glpk prints that we in turn filter out?",
    "created_at": "2020-04-26T04:21:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29349",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29349#issuecomment-415804",
    "user": "https://github.com/jhpalmieri"
}
```

Reporting what bug? The messages that glpk prints that we in turn filter out?



---

archive/issue_comments_415805.json:
```json
{
    "body": "Right... The comment \"glpk 4.65 should not be used by Sage as long as it is not patched by Homebrew\" comes from #24824.\nWe now (as of #29317) filter the messages out for the doctests -- but they are of course still an annoyance for users. I have not kept track of whether we have convinced any distributor to accept our GLPK patches that upstream didn't want. But we seem to be using the system package on all of arch, cygwin, debian, feora, gentoo -- so I guess with the filtered doctest messages it's good enough and we can re-enable the use of the homebrew package. I've opened #29587 for this.",
    "created_at": "2020-04-26T04:48:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29349",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29349#issuecomment-415805",
    "user": "https://github.com/mkoeppe"
}
```

Right... The comment "glpk 4.65 should not be used by Sage as long as it is not patched by Homebrew" comes from #24824.
We now (as of #29317) filter the messages out for the doctests -- but they are of course still an annoyance for users. I have not kept track of whether we have convinced any distributor to accept our GLPK patches that upstream didn't want. But we seem to be using the system package on all of arch, cygwin, debian, feora, gentoo -- so I guess with the filtered doctest messages it's good enough and we can re-enable the use of the homebrew package. I've opened #29587 for this.



---

archive/issue_comments_415806.json:
```json
{
    "body": "The main GLPK dev seems to be too busy with other things. Last time he was talking about transferring maintainership to FSF, or something like this.",
    "created_at": "2020-04-26T06:19:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29349",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29349#issuecomment-415806",
    "user": "https://github.com/dimpase"
}
```

The main GLPK dev seems to be too busy with other things. Last time he was talking about transferring maintainership to FSF, or something like this.



---

archive/issue_comments_415807.json:
```json
{
    "body": "Thanks for opening and giving positive review to #29587, it's good we can use Homebrew's GLPK again.\nI expanded the description at #29587 to include context and links about this GLPK issue.\n\nThe present ticket would still make sense, and is not specifically about the glpk or ppl issue.",
    "created_at": "2020-04-26T17:21:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29349",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29349#issuecomment-415807",
    "user": "https://github.com/slel"
}
```

Thanks for opening and giving positive review to #29587, it's good we can use Homebrew's GLPK again.
I expanded the description at #29587 to include context and links about this GLPK issue.

The present ticket would still make sense, and is not specifically about the glpk or ppl issue.



---

archive/issue_comments_415808.json:
```json
{
    "body": "Replying to [comment:8 slelievre]:\n> Thanks for opening and giving positive review to #29587, it's good we can use Homebrew's GLPK again.\n> I expanded the description at #29587 to include context and links about this GLPK issue.\n\n\nThanks a lot.\n\n> The present ticket would still make sense, and is not specifically about the glpk or ppl issue.\n\n\nI agree.",
    "created_at": "2020-04-26T17:36:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29349",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29349#issuecomment-415808",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:8 slelievre]:
> Thanks for opening and giving positive review to #29587, it's good we can use Homebrew's GLPK again.
> I expanded the description at #29587 to include context and links about this GLPK issue.


Thanks a lot.

> The present ticket would still make sense, and is not specifically about the glpk or ppl issue.


I agree.



---

archive/issue_events_075536.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-29T16:37:33Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29349",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29349#event-75536"
}
```



---

archive/issue_events_075537.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T20:51:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29349",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29349#event-75537"
}
```



---

archive/issue_events_075538.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T20:51:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29349",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29349#event-75538"
}
```



---

archive/issue_comments_415809.json:
```json
{
    "body": "Setting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-02-13T20:51:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29349",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29349#issuecomment-415809",
    "user": "https://github.com/mkoeppe"
}
```

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_comments_415810.json:
```json
{
    "body": "New related report:\n\n- [sage-devel, 2021-02-26](https://groups.google.com/g/sage-devel/c/CHKjJ4urIoE/m/ApZcXBwXAAAJ)",
    "created_at": "2021-02-26T10:30:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29349",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29349#issuecomment-415810",
    "user": "https://github.com/slel"
}
```

New related report:

- [sage-devel, 2021-02-26](https://groups.google.com/g/sage-devel/c/CHKjJ4urIoE/m/ApZcXBwXAAAJ)



---

archive/issue_events_075539.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T01:43:17Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29349",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29349#event-75539"
}
```



---

archive/issue_events_075540.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T01:43:17Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29349",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29349#event-75540"
}
```



---

archive/issue_events_075541.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-14T02:04:49Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29349",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29349#event-75541"
}
```



---

archive/issue_events_075542.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-14T02:04:49Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29349",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29349#event-75542"
}
```



---

archive/issue_events_075543.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-01T21:16:35Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29349",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29349#event-75543"
}
```



---

archive/issue_events_075544.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-01T21:16:35Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29349",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29349#event-75544"
}
```



---

archive/issue_events_075545.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29349",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29349#event-75545"
}
```



---

archive/issue_events_075546.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/29349",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29349#event-75546"
}
```
