# Issue 29349: Improve configure's recommendations

Issue created by migration from https://trac.sagemath.org/ticket/29586

Original creator: slelievre

Original creation time: 2020-04-26 03:32:38

CC:  mkoeppe slelievre @mwageringel dimpase charpent

On macOS with `ppl` installed via Homebrew,
the `configure` script reported the following:


```
## ---------------------------------------------------- ##
## Checking whether SageMath should install SPKG ppl... ##
## ---------------------------------------------------- ##
configure:27878: checking whether any of glpk gmp mpir
is installed as or will be installed as SPKG
configure:27882: result: yes; install ppl as well
configure:28277: no suitable system package found for SPKG ppl
```


and eventually recommended to `brew install ppl`.

It would seem that, in the above, this is correct:

```
configure:27878: checking whether any of glpk gmp mpir
is installed as or will be installed as SPKG
configure:27882: result: yes; install ppl as well
```

but this does not really follow:

```
configure:28277: no suitable system package found for SPKG ppl
```



In this case, because at least one of (glpk, gmp, mpir)
either was or would be installed as an SPKG, the script
concluded ppl should be installed as an SPKG too.

So the decision to install ppl was based on that,
not on the absence of ppl. In such a case, maybe
the script should not recommend installing ppl
(at least not without checking if it is actually there).

Initial report:
[sage-release](https://groups.google.com/d/msg/sage-release/aTSxEyE9Mrc/NggXIR1oBAAJ).


---

Comment by slelievre created at 2020-04-26 03:43:31

To reformulate:
- don't recommend installing a package via the system's
  package manager in case the decision to install as spkg
  was based on some dependency being installed,
  or about to be installed, as spkg

The relevant logic seems to be in `m4/sage_spkg_collect.m4`
or `m4/sage_spkg_configure.m4`.


---

Comment by mkoeppe created at 2020-04-26 03:48:08

Thanks for creating the ticket! I've linked to it from #29146


---

Comment by jhpalmieri created at 2020-04-26 04:06:26

I think in this case we should change `build/pkgs/glpk/distros/homebrew.txt` to uncomment `glpk`. Then its installation would be recommended, and once it's found, homebrew's `ppl` would be used, too.


---

Comment by mkoeppe created at 2020-04-26 04:11:28

Or a bug report to homebrew should be made


---

Comment by jhpalmieri created at 2020-04-26 04:21:36

Reporting what bug? The messages that glpk prints that we in turn filter out?


---

Comment by mkoeppe created at 2020-04-26 04:48:10

Right... The comment "glpk 4.65 should not be used by Sage as long as it is not patched by Homebrew" comes from #24824.
We now (as of #29317) filter the messages out for the doctests -- but they are of course still an annoyance for users. I have not kept track of whether we have convinced any distributor to accept our GLPK patches that upstream didn't want. But we seem to be using the system package on all of arch, cygwin, debian, feora, gentoo -- so I guess with the filtered doctest messages it's good enough and we can re-enable the use of the homebrew package. I've opened #29587 for this.


---

Comment by dimpase created at 2020-04-26 06:19:56

The main GLPK dev seems to be too busy with other things. Last time he was talking about transferring maintainership to FSF, or something like this.


---

Comment by slelievre created at 2020-04-26 17:21:49

Thanks for opening and giving positive review to #29587, it's good we can use Homebrew's GLPK again.
I expanded the description at #29587 to include context and links about this GLPK issue.

The present ticket would still make sense, and is not specifically about the glpk or ppl issue.


---

Comment by mkoeppe created at 2020-04-26 17:36:05

Replying to [comment:8 slelievre]:
> Thanks for opening and giving positive review to #29587, it's good we can use Homebrew's GLPK again.
> I expanded the description at #29587 to include context and links about this GLPK issue.

Thanks a lot.

> The present ticket would still make sense, and is not specifically about the glpk or ppl issue.

I agree.


---

Comment by mkoeppe created at 2021-02-13 20:51:01

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.


---

Comment by slelievre created at 2021-02-26 10:30:28

New related report:

- [sage-devel, 2021-02-26](https://groups.google.com/g/sage-devel/c/CHKjJ4urIoE/m/ApZcXBwXAAAJ)
