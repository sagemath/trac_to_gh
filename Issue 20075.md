# Issue 20075: parent of argument lost with GinacFunctions

archive/issues_020075.json:
```json
{
    "body": "CC:  jdemeyer\n\nExcept for some classes, Python objects as function arguments are coerced into SR, but with `GinacFunction`s the parent gets lost, i.e. the result is not converted back. Ths violates the rule that function input and output should be of the same type.\n\n```\nsage: S.<y> = PolynomialRing(RR)\nsage: ex = sin(asin(y)); ex\ny\nsage: type(ex)\n<type 'sage.symbolic.expression.Expression'>\nsage: ex.is_symbol()\nTrue\n```\n\nThis also shows that the notion \"SR encapsulates all Sage objects\" is wrong because everything coerces into SR. SR only encapsulates certain \"numeric\" objects. Pynac can't be blamed as it only sees expressions. The problem is in `symbolic/function.pyx` where the parent of function arguments is lost.\n\nIssue created by migration from https://trac.sagemath.org/ticket/20312\n\n",
    "created_at": "2016-03-28T07:52:37Z",
    "labels": [
        "symbolics",
        "major",
        "bug"
    ],
    "title": "parent of argument lost with GinacFunctions",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/20075",
    "user": "rws"
}
```
CC:  jdemeyer

Except for some classes, Python objects as function arguments are coerced into SR, but with `GinacFunction`s the parent gets lost, i.e. the result is not converted back. Ths violates the rule that function input and output should be of the same type.

```
sage: S.<y> = PolynomialRing(RR)
sage: ex = sin(asin(y)); ex
y
sage: type(ex)
<type 'sage.symbolic.expression.Expression'>
sage: ex.is_symbol()
True
```

This also shows that the notion "SR encapsulates all Sage objects" is wrong because everything coerces into SR. SR only encapsulates certain "numeric" objects. Pynac can't be blamed as it only sees expressions. The problem is in `symbolic/function.pyx` where the parent of function arguments is lost.

Issue created by migration from https://trac.sagemath.org/ticket/20312





---

archive/issue_comments_276592.json:
```json
{
    "body": "`@`Jeroen: I really would appreciate any input you can give me here. If it is not possible to decide which argument of the function determines the return type, a small database of functions with more than one argument could be used that contains that information.",
    "created_at": "2016-03-28T13:01:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20075",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20075#issuecomment-276592",
    "user": "rws"
}
```

`@`Jeroen: I really would appreciate any input you can give me here. If it is not possible to decide which argument of the function determines the return type, a small database of functions with more than one argument could be used that contains that information.



---

archive/issue_comments_276593.json:
```json
{
    "body": "It looks like the first version here can handle the binomial example of #20060 as well as the symbolic poly functions. It works by adding a field `_preserved_arg` to every `BuiltinFunction` that is set on function creation and says which of the function arguments is the one where we try to preserve the arg's parent. Then `Expression.polynomial()` is used to convert back in case of polynomial rings. Also, by not setting a default `preserved_arg` the functionality is limited to the cases where the developer has given this parameter in the function init call.\n\nThis does not work however with the title example because there the functions are nested. Since it seems we cannot decide where in a nested expression the specific element is whose parent we want to preserve I tend to exclude the nested case.\n----\nNew commits:",
    "created_at": "2016-04-22T14:53:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20075",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20075#issuecomment-276593",
    "user": "rws"
}
```

It looks like the first version here can handle the binomial example of #20060 as well as the symbolic poly functions. It works by adding a field `_preserved_arg` to every `BuiltinFunction` that is set on function creation and says which of the function arguments is the one where we try to preserve the arg's parent. Then `Expression.polynomial()` is used to convert back in case of polynomial rings. Also, by not setting a default `preserved_arg` the functionality is limited to the cases where the developer has given this parameter in the function init call.

This does not work however with the title example because there the functions are nested. Since it seems we cannot decide where in a nested expression the specific element is whose parent we want to preserve I tend to exclude the nested case.
----
New commits:



---

archive/issue_comments_276594.json:
```json
{
    "body": "Tests pass.",
    "created_at": "2016-04-23T06:29:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20075",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20075#issuecomment-276594",
    "user": "rws"
}
```

Tests pass.



---

archive/issue_comments_276595.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-04-23T06:29:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20075",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20075#issuecomment-276595",
    "user": "rws"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_276596.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-04-23T06:47:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20075",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20075#issuecomment-276596",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_276597.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-05-06T05:19:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20075",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20075#issuecomment-276597",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_276598.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-05-06T22:06:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20075",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20075#issuecomment-276598",
    "user": "vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_276599.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-05-06T22:10:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20075",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20075#issuecomment-276599",
    "user": "vbraun"
}
```

Resolution: fixed
