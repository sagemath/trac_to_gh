# Issue 20075: parent of argument lost with GinacFunctions

Issue created by migration from Trac.

Original creator: rws

Original creation time: 2016-03-28 07:52:37

CC:  jdemeyer

Except for some classes, Python objects as function arguments are coerced into SR, but with `GinacFunction`s the parent gets lost, i.e. the result is not converted back. Ths violates the rule that function input and output should be of the same type.

```
sage: S.<y> = PolynomialRing(RR)
sage: ex = sin(asin(y)); ex
y
sage: type(ex)
<type 'sage.symbolic.expression.Expression'>
sage: ex.is_symbol()
True
```

This also shows that the notion "SR encapsulates all Sage objects" is wrong because everything coerces into SR. SR only encapsulates certain "numeric" objects. Pynac can't be blamed as it only sees expressions. The problem is in `symbolic/function.pyx` where the parent of function arguments is lost.


---

Comment by rws created at 2016-03-28 13:01:23

`@`Jeroen: I really would appreciate any input you can give me here. If it is not possible to decide which argument of the function determines the return type, a small database of functions with more than one argument could be used that contains that information.


---

Comment by rws created at 2016-04-22 14:53:40

It looks like the first version here can handle the binomial example of #20060 as well as the symbolic poly functions. It works by adding a field `_preserved_arg` to every `BuiltinFunction` that is set on function creation and says which of the function arguments is the one where we try to preserve the arg's parent. Then `Expression.polynomial()` is used to convert back in case of polynomial rings. Also, by not setting a default `preserved_arg` the functionality is limited to the cases where the developer has given this parameter in the function init call.

This does not work however with the title example because there the functions are nested. Since it seems we cannot decide where in a nested expression the specific element is whose parent we want to preserve I tend to exclude the nested case.
----
New commits:


---

Comment by rws created at 2016-04-23 06:29:18

Tests pass.


---

Comment by rws created at 2016-04-23 06:29:18

Changing status from new to needs_review.


---

Comment by git created at 2016-04-23 06:47:48

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-05-06 05:19:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vbraun created at 2016-05-06 22:06:41

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2016-05-06 22:10:39

Resolution: fixed
