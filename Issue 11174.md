# Issue 11174: major bug in the conductor function for elliptic curves over number fields

Issue created by migration from https://trac.sagemath.org/ticket/11346

Original creator: was

Original creation time: 2011-05-17 18:14:03

Assignee: cremona

Joanna Gaski found a serious bug in the function for computing conductors of elliptic curves over number fields, when the input curve is not integral.   Witness:

```
sage: K.<g> = NumberField(x^2 - x - 1) #, embedding=1.6)
sage: E1 = EllipticCurve(K,[0,0,0,-1/48,-161/864]); E1
Elliptic Curve defined by y^2 = x^3 + (-1/48)*x + (-161/864) over Number Field in g with defining polynomial x^2 - x - 1
sage: factor(E1.conductor())
(Fractional ideal (3)) * (Fractional ideal (-2*g + 1))
sage: factor(E1.integral_model().conductor())
(Fractional ideal (2))^4 * (Fractional ideal (3)) * (Fractional ideal (-2*g + 1))
```


The bug is actually in the local_data() function, which computes the possible primes of bad reduction by taking the support of the discriminant.  However, this is simply wrong if the input curve is not integral.  

```
sage: E1.discriminant().support()
[Fractional ideal (-2*g + 1), Fractional ideal (3)]
sage: E1.integral_model().discriminant().support()
[Fractional ideal (-2*g + 1), Fractional ideal (2), Fractional ideal (3)]
```


The one-line fix is to first compute an integral model, then ask for the discriminant of that model in the local_data function.


---

Attachment


---

Comment by was created at 2011-05-17 18:46:11

Changing status from new to needs_review.


---

Comment by robertwb created at 2011-05-18 05:19:44

Changing status from needs_review to positive_review.


---

Comment by cremona created at 2011-05-18 11:28:09

Additional comment on this and #11347.  I think a better fix would have been to add one line in the constructor for `EllipticCurveLocalData` in sage.schemes.elliptic_curves.ell_local_data, namely 

```
    E = E.integral_model()
```

rather than having a lot of separate functions have to remember to do this.  The fixes here and at #11347 are fine by themselves, but it remains the case that

```
sage: K.<g> = NumberField(x^2 - x - 1)          
sage: E = EllipticCurve(K,[0,0,0,-1/48,161/864])
sage: E.local_data()   
```

fails.

I don't have time to rework this right now, so have not tagged this "needs work"...


---

Attachment

I agree, followup patch does just that.


---

Comment by jdemeyer created at 2011-05-31 17:06:26

Resolution: fixed
