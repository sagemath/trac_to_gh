# Issue 21166: Race condition: Sage library now depends on pip

Issue created by migration from https://trac.sagemath.org/ticket/21403

Original creator: leif

Original creation time: 2016-09-02 20:00:35

Keywords: build error, OSError, Popen, optional_extension, list_packages

(We _might_ in the future allow to use a system-wide `pip` though, but that requires changing `configure[.ac]` as well.)


```
[sagelib-7.4.beta2] Building interpreters for fast_callable
[sagelib-7.4.beta2] python -u setup.py install
[sagelib-7.4.beta2] ************************************************************************
[sagelib-7.4.beta2] Traceback (most recent call last):
[sagelib-7.4.beta2]   File "setup.py", line 47, in <module>
[sagelib-7.4.beta2]     from module_list import ext_modules, library_order, aliases
[sagelib-7.4.beta2]   File "/home/agag/sbrandhorst/sage/sage/src/module_list.py", line 150, in <module>
[sagelib-7.4.beta2]     from sage_setup.optional_extension import OptionalExtension
[sagelib-7.4.beta2]   File "/home/agag/sbrandhorst/sage/sage/src/sage_setup/optional_extension.py", line 24, in <module>
[sagelib-7.4.beta2]     all_packages = list_packages(local=True)
[sagelib-7.4.beta2]   File "/home/agag/sbrandhorst/sage/sage/src/sage/misc/package.py", line 211, in list_packages
[sagelib-7.4.beta2]     installed = installed_packages()
[sagelib-7.4.beta2]   File "/home/agag/sbrandhorst/sage/sage/src/sage/misc/package.py", line 293, in installed_packages
[sagelib-7.4.beta2]     installed.update(pip_installed_packages())
[sagelib-7.4.beta2]   File "/home/agag/sbrandhorst/sage/sage/src/sage/misc/package.py", line 147, in pip_installed_packages
[sagelib-7.4.beta2]     proc = subprocess.Popen(["pip", "list"], stdout=subprocess.PIPE)
[sagelib-7.4.beta2]   File "/home/agag/sbrandhorst/sage/sage/local/lib/python/subprocess.py", line 710, in __init__
[sagelib-7.4.beta2]     errread, errwrite)
[sagelib-7.4.beta2]   File "/home/agag/sbrandhorst/sage/sage/local/lib/python/subprocess.py", line 1335, in _execute_child
[sagelib-7.4.beta2]     raise child_exception
[sagelib-7.4.beta2] OSError: [Errno 2] No such file or directory
[sagelib-7.4.beta2] ************************************************************************
[sagelib-7.4.beta2] Error building the Sage library
[sagelib-7.4.beta2] ************************************************************************
[sagelib-7.4.beta2] Please email sage-devel (http://groups.google.com/group/sage-devel)
[sagelib-7.4.beta2] explaining the problem and including the relevant part of the log file
[sagelib-7.4.beta2]   /home/agag/sbrandhorst/sage/sage/logs/pkgs/sagelib-7.4.beta2.log
[sagelib-7.4.beta2] Describe your computer, operating system, etc.
[sagelib-7.4.beta2] ************************************************************************
[sagelib-7.4.beta2] make[3]: *** [sage] Error 1
[sagelib-7.4.beta2] make[3]: Leaving directory `/home/agag/sbrandhorst/sage/sage/src'
[sagelib-7.4.beta2]
[sagelib-7.4.beta2] real    0m27.900s
[sagelib-7.4.beta2] user    0m17.900s
[sagelib-7.4.beta2] sys    0m4.588s
make[2]: *** [sagelib] Error 2
make[2]: Leaving directory `/home/agag/sbrandhorst/sage/sage/build/make'
make[1]: *** [all] Error 2
make[1]: Leaving directory `/home/agag/sbrandhorst/sage/sage/build/make'

real    303m54.652s
user    113m57.245s
sys    23m9.735s
***************************************************************
Error building Sage.
```

Cf. my post to sage-release, as well as the original report on sage-devel (of September 2nd).



---

Comment by leif created at 2016-09-02 20:22:19

New commits:


---

Comment by leif created at 2016-09-02 20:22:19

Changing status from new to needs_review.


---

Comment by vbraun created at 2016-09-02 20:36:01

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2016-09-04 00:13:25

Resolution: fixed
