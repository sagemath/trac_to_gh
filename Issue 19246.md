# Issue 19246: Crash with bliss when tesing posets.py

Issue created by migration from Trac.

Original creator: ncohen

Original creation time: 2015-10-27 09:42:21

CC:  azi

I traced this down to the following:


```
sage: DiGraph('GY`@`OQ?OW`@`?O?').canonical_label()
<crash>
```



---

Comment by azi created at 2015-10-27 09:44:04

Yes this is a bug in bliss (confirmed by the author) that was fixed in the recent version!

So the solution is simply to update the spkg to use the latest version from here http://www.tcs.hut.fi/Software/bliss/


---

Comment by ncohen created at 2015-10-27 10:11:30

Hello Jernej,

I updated the package but the bug remains. Could you look into it?

Nathann


---

Comment by git created at 2015-10-27 10:11:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-10-27 10:13:13

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by azi created at 2015-10-27 10:34:54

Hey there!

That is weird. As far as bliss is concerned I can reproduce the bug in bliss-0.72 but not in bliss-0.73


```
azi`@`bodysnatcher:~/bliss-0.72$ ./bliss -directed -can -sh=f /tmp/foo.dimacs 
bliss: graph.cc:3875: virtual bool bliss::Digraph::nucr_find_first_component(unsigned int, std::vector<unsigned int>&, unsigned int&, bliss::Partition::Cell*&): Assertion `sh_return' failed.
Aborted (core dumped)
```


And


```
azi`@`bodysnatcher:~/bliss-0.73$ ./bliss -directed -can -sh=f /tmp/foo.dimacs 
Generator: (2,3)(6,7)
Generator: (3,5)(4,6)
Canonical labeling: (1,8)(2,7)(3,6)
Nodes:          6
Leaf nodes:     4
Bad nodes:      0
Canrep updates: 1
Generators:     2
Max level:      2
Total time:	0.00 seconds
```

|Aut|:          6
Every other heuristic -sh works as well in bliss-0.73. So that makes me wonder, are we 100% that the spkg really installs bliss?


---

Comment by ncohen created at 2015-10-27 10:40:10

Mystery cleared: that's because installing the new bliss is not enough--> one also has to touch bliss.pyx, as otherwise the code is not recompiled.

Nathann


---

Comment by ncohen created at 2015-10-27 10:40:10

Changing status from new to needs_review.


---

Comment by azi created at 2015-10-27 10:46:10

Changing status from needs_review to positive_review.


---

Comment by ncohen created at 2015-10-27 10:46:45

Thanks,

Nathann


---

Comment by jdemeyer created at 2015-10-27 19:43:09

Replying to [comment:6 ncohen]:
> Mystery cleared: that's because installing the new bliss is not enough--> one also has to touch bliss.pyx, as otherwise the code is not recompiled.

That's a bug.


---

Comment by jdemeyer created at 2015-10-27 19:43:09

Changing status from positive_review to needs_work.


---

Comment by jdemeyer created at 2015-10-27 19:54:26

Use `cp` instead of `mv` in `spkg-install` (this is probably why you have the dependency issue).


---

Comment by jdemeyer created at 2015-10-27 19:56:36

Note that you still need an additional run of `make` or `./sage -b` after installing `bliss`. However, that's not the fault of the package.


---

Comment by git created at 2015-10-28 08:15:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by ncohen created at 2015-10-28 08:16:44

Sorry sorry, I am a bit sick these days and with half of my brain I did not realise that indeed this 'touch' thing was a problem. I added an empty line in the file.

I did not understand what you said about the mv/cp change but I did it anyway. Could you be more verbose about it? I do not know of which dependency problem you are talking.

Thanks, and sorry if the questions are stupid. Just slept 12 hours, and I may have to do the same tonight `:-/`

Nathann


---

Comment by ncohen created at 2015-10-28 08:16:52

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2015-10-28 08:38:19

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2015-10-28 08:38:19

Replying to [comment:13 ncohen]:
> I did not understand what you said about the mv/cp change but I did it anyway. Could you be more verbose about it? I do not know of which dependency problem you are talking.

Sorry, it wasn't clear indeed.

The "dependency problem" is the problem that you manually needed to touch the `.pyx` file. Let me explain more:
* with `mv`, the file is moved _with the same timestamp_, which in practice is the timestamp the package was made. So, Cython thinks this is an old file and sees no reason to recompile `bliss.pyx`.
* with `cp`, the new file really is a new file so it has a new timestamp. Cython will detect this file as changed and automatically recompile `bliss.pyx`.


---

Comment by ncohen created at 2015-10-28 08:41:23

Oh, I see. Cool. Then I added this empty line uselessly. It's a good news though, it felt weird that Cython would not detect that `:-)`

Thanks,

Nathann


---

Comment by vbraun created at 2015-10-28 17:59:41

Resolution: fixed
