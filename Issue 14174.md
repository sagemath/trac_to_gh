# Issue 14174: Upgrade GCC to 4.7.2

Issue created by migration from Trac.

Original creator: jdemeyer

Original creation time: 2013-03-29 03:54:56

Assignee: jdemeyer

CC:  jpflori




---

Comment by jpflori created at 2013-03-29 10:25:34

Could you include the Solaris fix to prevent debug things as we discussed on sage-???.
This is the same fix as for old OS X.


---

Comment by leif created at 2013-03-29 13:04:01

Changing keywords from "" to "spkg".


---

Comment by leif created at 2013-03-29 13:04:01

Afterwards create an optional GCC 4.8.0 spkg ... :-)

[Needs a C++ compiler to bootstrap, I know, but nvm.]

----

Haven't looked or tried whether that's still an issue, but at some point in the past the GCC spkg failed to build when encountering parts of CLooG and/or PPL.  (We may add `--without-*` and/or `--disable-lto`.)


---

Comment by jpflori created at 2013-03-29 16:24:21

I think we should also keep the 4.6.x series as optional spkg.
Jeroen proposed to do it IIRC, so consider this message to be just a reminder.


---

Comment by jpflori created at 2013-03-29 16:28:58

And I agree with the patch you posted for GCC versions checks.
Just a little typo:

```
echo >&2 "gcc <= 4.5 fails to compile PARI/GP om ia64." 
```



---

Comment by jdemeyer created at 2013-03-29 16:35:34

Replying to [comment:5 jpflori]:
> Could you include the Solaris fix to prevent debug things as we discussed on sage-???.
> This is the same fix as for old OS X.
Sorry, I don't know what you mean.


---

Comment by jpflori created at 2013-03-29 16:37:17

This fix:
https://groups.google.com/d/msg/sage-release/eNtnQ5jWuag/Yyce8bZgyUIJ


---

Attachment


---

Comment by jdemeyer created at 2013-03-29 20:33:55

Changing status from new to needs_review.


---

Comment by jpflori created at 2013-03-30 10:00:48

FYI, I rebuilt GCC more "correctly" using Sun as and ld and the BUILD_CONFIG trick was not needed anymore, not that I'm suggesting to do as before and only use it on OS X 10.4.


---

Comment by jdemeyer created at 2013-04-01 10:31:57

I have tested this on the buildbot and there are no problems at all.


---

Comment by vbraun created at 2013-04-01 10:44:28

Looks good to me.

How are we keeping gcc 4.6 as optional spkg? Rename it to `gcc46-4.6.3.spkg`?


---

Comment by vbraun created at 2013-04-01 10:44:28

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2013-04-01 10:48:19

Resolution: fixed


---

Comment by jdemeyer created at 2013-04-01 10:48:43

Replying to [comment:15 vbraun]:
> How are we keeping gcc 4.6 as optional spkg? Rename it to `gcc46-4.6.3.spkg`?
Just put it with the optional packages, no need to rename it.


---

Comment by vbraun created at 2013-04-01 12:37:45

Is there a way to disambiguate between standard and optional spkg when running `sage -f <package>`?


---

Comment by jdemeyer created at 2013-04-01 13:19:59

Replying to [comment:18 vbraun]:
> Is there a way to disambiguate between standard and optional spkg when running `sage -f <package>`?
You can always do

```
./sage -i spkg/standard/gcc-4.7.2.p1.spkg
```

or

```
./sage -i http://www.sagemath.org/packages/optional/gcc-4.6.3.spkg
```

No need to differentiate then.

Or also

```
./sage -i gcc-4.6.3.spkg
```



---

Comment by jdemeyer created at 2013-04-04 18:04:53

This doesn't actually build on OS X 10.4 PPC (as reported on sage-devel). But it seems that the problem lies with libitm, which is a non-critical part of GCC.


---

Comment by jdemeyer created at 2013-04-04 18:04:53

Changing status from closed to new.


---

Comment by jdemeyer created at 2013-04-04 18:04:53

Resolution changed from fixed to 


---

Attachment

Removed libitm, testing now on OS X 10.4 PPC.


---

Comment by jdemeyer created at 2013-04-05 08:41:50

Changing status from new to needs_review.


---

Comment by jpflori created at 2013-04-05 08:55:22

For future reference, the bug linked in the sage-devel post at https://groups.google.com/d/msg/sage-devel/DhJcPuFIlPo/wu3sv6nQLIgJ seems to be the upstream report:
http://gcc.gnu.org/bugzilla/show_bug.cgi?id=52482
(as reported in the post itself, nothing new here).


---

Comment by jpflori created at 2013-04-05 09:43:11

Changing status from needs_review to positive_review.


---

Comment by jpflori created at 2013-04-05 09:43:55

Looks fine, compile on a usual Linux and works there.
Also seems to be going fine on a Linux ppc, so positive review.


---

Comment by jdemeyer created at 2013-04-06 14:49:47

Resolution: fixed


---

Comment by jdemeyer created at 2013-04-11 11:25:48

Follow-up: #14441


---

Comment by jhpalmieri created at 2013-04-12 19:15:15

I can't get this to build in iras: see [log file](http://sage.math.washington.edu/home/palmieri/misc/iras-gcc-4.7.2.p1.log). Note that it actually creates the various binaries in local/bin, so that further attempts (using, say, the 4.7.3 package at #14441 fail because "configure: error: C compiler cannot create executables". I'm trying to clear out local/bin and try 4.7.3 again. Other suggestions?


---

Comment by jdemeyer created at 2013-04-12 19:23:56

Replying to [comment:30 jhpalmieri]:
> I can't get this to build in iras: see [log file](http://sage.math.washington.edu/home/palmieri/misc/iras-gcc-4.7.2.p1.log).
Could you please try a serial build (no MAKE -jN) and post the log file of that if it fails.

> I'm trying to clear out local/bin and try 4.7.3 again.
Removing just the `gcc`, `g++` and `gfortran` executables should be sufficient to force the use of the system gcc to build GCC.


---

Comment by jhpalmieri created at 2013-04-13 02:02:50

Replying to [comment:31 jdemeyer]:
> Replying to [comment:30 jhpalmieri]:
> > I can't get this to build in iras: see [log file](http://sage.math.washington.edu/home/palmieri/misc/iras-gcc-4.7.2.p1.log).
> Could you please try a serial build (no MAKE -jN) and post the log file of that if it fails.

A serial build of 4.7.2 succeeded. Should the spkg force that on ia64 machines?


---

Comment by leif created at 2013-04-16 17:34:46

Replying to [comment:32 jhpalmieri]:
> Replying to [comment:31 jdemeyer]:
> > Replying to [comment:30 jhpalmieri]:
> > > I can't get this to build in iras: see [log file](http://sage.math.washington.edu/home/palmieri/misc/iras-gcc-4.7.2.p1.log).
> > Could you please try a serial build (no MAKE -jN) and post the log file of that if it fails.
> 
> A serial build of 4.7.2 succeeded. Should the spkg force that on ia64 machines?

Without having looked at the log:  Are you sure this is related to the architecture (and not just caused by the usual clock skew on Skynet)?


---

Comment by jhpalmieri created at 2013-04-16 17:36:56

Replying to [comment:33 leif]:
> Replying to [comment:32 jhpalmieri]:
> > Replying to [comment:31 jdemeyer]:
> > > Replying to [comment:30 jhpalmieri]:
> > > > I can't get this to build in iras: see [log file](http://sage.math.washington.edu/home/palmieri/misc/iras-gcc-4.7.2.p1.log).
> > > Could you please try a serial build (no MAKE -jN) and post the log file of that if it fails.
> > 
> > A serial build of 4.7.2 succeeded. Should the spkg force that on ia64 machines?
> 
> Without having looked at the log:  Are you sure this is related to the architecture (and not just caused by the usual clock skew on Skynet)?

I have no idea. How would I check?


---

Comment by leif created at 2013-04-16 18:56:20

Replying to [comment:34 jhpalmieri]:
> Replying to [comment:33 leif]:
> > Replying to [comment:32 jhpalmieri]:
> > > Replying to [comment:31 jdemeyer]:
> > > > Replying to [comment:30 jhpalmieri]:
> > > > > I can't get this to build in iras: see [log file](http://sage.math.washington.edu/home/palmieri/misc/iras-gcc-4.7.2.p1.log).
> > > > Could you please try a serial build (no MAKE -jN) and post the log file of that if it fails.
> > > 
> > > A serial build of 4.7.2 succeeded. Should the spkg force that on ia64 machines?
> > 
> > Without having looked at the log:  Are you sure this is related to the architecture (and not just caused by the usual clock skew on Skynet)?
> 
> I have no idea. How would I check?

(Move the whole Sage installation and) build the GCC spkg (in parallel) below `/tmp` (which on Skynet is always on local media I think)?


---

Comment by jhpalmieri created at 2013-04-17 01:12:45

Replying to [comment:35 leif]:
> (Move the whole Sage installation and) build the GCC spkg (in parallel) below `/tmp` (which on Skynet is always on local media I think)?

I tried that, but it failed with "no space left on device". There are close to 40000 files and/or directories in /tmp on iras, most or all of which should be cleaned out...


---

Comment by leif created at 2013-04-17 12:18:52

Replying to [comment:36 jhpalmieri]:
> Replying to [comment:35 leif]:
> > (Move the whole Sage installation and) build the GCC spkg (in parallel) below `/tmp` (which on Skynet is always on local media I think)?
> 
> I tried that, but it failed with "no space left on device". There are close to 40000 files and/or directories in /tmp on iras, most or all of which should be cleaned out...

OMG, I see...

I deleted my own left-overs, but probably the buildbot, Volker and Jeroen should do so as well...

(FWIW, I reported Sage still leaving a lot of temporary crap a couple of times on sage-devel.)


---

Comment by vbraun created at 2013-04-17 12:42:32

Oh boy, no tmpwatch %-)
