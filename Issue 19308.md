# Issue 19308: Mathon's pseudocylic strongly regular graphs.

Issue created by migration from Trac.

Original creator: dimpase

Original creation time: 2015-11-07 16:59:07

CC:  ncohen

Implement a construction by Mathon of s.r.g's with parameters
`((4t+1)(4t-1)^2, 2t(4t(4t-1)-1), t(4t(4t-1)-1)-1, t(4t(4t-1)-1))` given that
`4t-1` is a prime power and there exists an s.r.g. with parameters `(4t+1,2t,t-1,t)` from

R. A. Mathon,
Symmetric conference matrices of order `pq^2 + 1`,
Canad. J. Math. 30 (1978) 321-331


---

Comment by dimpase created at 2015-11-07 17:56:22

New commits:


---

Comment by ncohen created at 2015-11-07 18:44:24

Coooooool ! `:-D`


---

Comment by ncohen created at 2015-11-07 18:48:27

A couple of remarks:

- Bad indentation in the 'reference' blocks.
- This is ridiculous
  {{{
  sum(map(lambda i: P[a.index(g**(2*i))], xrange(1, 2*t)))
  }}}
  Forget these lambda functions and use Python. It will be easier to read, and less costly in memory/computations. What you want is `sum(P[a.index(g**(2*i))] for i in range(1,2*t))`.

- You did the right thing when you defined the function `B(m)`. Please do the same for the lambda function that you use to define `A`.

Nathann


---

Comment by dimpase created at 2015-11-07 21:45:29

Should we have a function that attempts to construct an SRG with parameters `(4z+1,2z,z-1,z)` ?

One can do this either for `4z+1` a prime power (then it could be Paley graph), or
`4z+1=(4t+1)(4t-1)^2`, for `t` for which the construction of this ticket works, in particular so that there is an SRG with parameters `(4t+1,2t,t-1,t)`. I.e. there is a recursion.


---

Comment by dimpase created at 2015-11-07 23:36:25

Replying to [comment:5 dimpase]:
> Should we have a function that attempts to construct an SRG with parameters `(4z+1,2z,z-1,z)` ?
> 
> One can do this either for `4z+1` a prime power (then it could be Paley graph), or
> `4z+1=(4t+1)(4t-1)^2`, for `t` for which the construction of this ticket works, in particular so that there is an SRG with parameters `(4t+1,2t,t-1,t)`. I.e. there is a recursion.
> 
so if we want a proper `is_whatever()` function (which will absorb `is_paley()`) dealing with such graphs, we need to be able to say with certainty that we can build it, before returning a promise (i.e. that `t[0](*t[1:])` thing) to build it.

This will need something like what we do for (skew) Hadamard matrices; where should such functions for graphs go?


---

Comment by git created at 2015-11-08 00:24:23

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2015-11-08 00:45:42

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by ncohen created at 2015-11-08 08:11:57

Hello Dima,

I don't think that we need some specific function that would manage both paley graphs and these ones, but that's probably up to you given that I have not read the code yet. I usually prefer to keep things as simple as possible, so one `is_` function by constructor is fine with me.

About your `is_` function, I do not understand why you would need something different from the usual output: it *does* tell you with certainty that there is a way to build the function.

Nathann


---

Comment by dimpase created at 2015-11-08 09:07:25

Replying to [comment:9 ncohen]:
> Hello Dima,
> 
> I don't think that we need some specific function that would manage both paley graphs and these ones, but that's probably up to you given that I have not read the code yet. I usually prefer to keep things as simple as possible, so one `is_` function by constructor is fine with me.
> 
> About your `is_` function, I do not understand why you would need something different from the usual output: it *does* tell you with certainty that there is a way to build the function.

The situation with (4z+1,2z,z-1,z)-graphs is akin to these ones that come from Hadamard matrices only in this case we have conference matrices, of size 2 (mod 4), which is the number `v` of
graph vertices +1.

With Hadamard graphs, we have these RHCD (sp?) recursive constructions of yours; for conference
matrices, we have yet to code such a recursive construction).
Apart from Paley and the construction of this ticket, there are potentially more (e.g. some OAs
can give such graphs, when `v` is a square).

Where do we put such a construction?


---

Comment by ncohen created at 2015-11-08 09:23:39

In a `combinat/matrix/conference.py` module?


---

Comment by dimpase created at 2015-11-08 10:09:23

Replying to [comment:11 ncohen]:
> In a `combinat/matrix/conference.py` module?

Right. Although I'd rather do this later, and for the time being just add two graphs (on 45 and 441 vertices) explicitly.


---

Comment by ncohen created at 2015-11-08 11:21:17

Okay. Then please add a warning in the doc somewhere that we can't miss, so that we remember that this should be a family and not two graphs only.

Nathann


---

Comment by git created at 2015-11-08 23:31:34

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2015-11-08 23:34:05

OK, I did a bit more than just adding explicit graph parameters 

```
+    .. TODO::
+
+        The current implementation only gives a subset of all possible graphs that can be
+        obtained using this construction. A  full implementation should rely on a database
+        of conference matrices (or, equivalently, on a database of s.r.g.'s with parameters
+        `(4t+1,2t,t-1,t)`. Currently we make an extra assumtion that `4t+1` is a prime power.
+        The first case where we miss a construction is `t=11`, where we could (recursively)
+        use the graph for `t=1` to construct a graph on 83205 vertices.
```



---

Comment by git created at 2015-11-09 00:39:23

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by ncohen created at 2015-11-09 09:41:45

Helloooooooooooooooo Dima,

Thank you for this strongly regular graph. Here is a first-pass review:

- The `G` parameter scared me a bit, but it seems that you don't use it at
  all. Same for `L`. Could you remove them?

- That's one useless lambda function `:-P`
  {{{
  #!diff
  -return (lambda q : MathonPseudocyclicStronglyRegularGraph(q),t)
  +return (MathonPseudocyclicStronglyRegularGraph,t)
  }}}

- (not important) you split 'import' blocks when they are longer than 80
  characters. I believe that in those cases the code is more readable if you
  leave it on it line.
  {{{
  +    from sage.matrix.constructor import matrix, block_matrix, \
  +        ones_matrix, identity_matrix
  }}}
  If it were me I wouldn't have split this one. Just a remark, it's up to you.

- I don't think that you need to import `ValueError` (or any of the common
  Python exceptions). It's always around.

- Misleading index:
  {{{
  +    # Order the elements of K in K_list
  +    # so that K_list[i] = -K_list[n-i-1], and 0 comes last
  }}}
  `n-i-2`?

- You really don't find the latter more legible?...
  {{{
  P = map(lambda b: matrix(ZZ,q,q,lambda i,j: 1 if a[j]==a[i]+b else 0), a)
  P = [matrix(ZZ,q,q,lambda i,j: 1 if a[j]==a[i]+b else 0)
       for b in a]
  }}}

- There is a missing ')' in your TODO block.

Nathann


---

Comment by ncohen created at 2015-11-09 09:41:45

Changing status from new to needs_info.


---

Comment by dimpase created at 2015-11-09 10:13:42

Replying to [comment:17 ncohen]:
thanks!

> Thank you for this strongly regular graph. Here is a first-pass review:
> 
> - The `G` parameter scared me a bit, but it seems that you don't use it at
>   all. Same for `L`. Could you remove them? 

well, I plan to provide an example of how to use L (for `v=441` (t=2) one can get an interesting example). The smallest example where one can provide G  different from the default has `v=25*23^2` (t=4). I can do this too (although it would be tagged `# very long time an' lotsa RAM`).

> 
> - That's one useless lambda function `:-P`
>   {{{
>   #!diff
>   -return (lambda q : MathonPseudocyclicStronglyRegularGraph(q),t)
>   +return (MathonPseudocyclicStronglyRegularGraph,t)
>   }}}
> 
there are more places like this there - this one was copied from `is_paley`...


> - (not important) you split 'import' blocks when they are longer than 80
>   characters. I believe that in those cases the code is more readable if you
>   leave it on it line.

unless it's a violation of something, I don't mind

>   {{{
>   +    from sage.matrix.constructor import matrix, block_matrix, \
>   +        ones_matrix, identity_matrix
>   }}}
>   If it were me I wouldn't have split this one. Just a remark, it's up to you.
> 
> - I don't think that you need to import `ValueError` (or any of the common
>   Python exceptions). It's always around.
> 
> - Misleading index:
>   {{{
>   +    # Order the elements of K in K_list
>   +    # so that K_list[i] = -K_list[n-i-1], and 0 comes last
>   }}}
>   `n-i-2`?

oh right, it's from your comments to something a bit different -- I'll fix this.

> 
> - You really don't find the latter more legible?...
>   {{{
>   P = map(lambda b: matrix(ZZ,q,q,lambda i,j: 1 if a[j]==a[i]+b else 0), a)
>   P = [matrix(ZZ,q,q,lambda i,j: 1 if a[j]==a[i]+b else 0)
>        for b in a]
>   }}} 

`\begin{rant}`
I lived under various dictators, some more benevolent, some less. Often one has to speak Aesop's (Esope, Ezop) language in order not to get in trouble. Please consider this Aesope's language code my hidden protest against Python's BDFL. (for I hate index variables and loops, while he seems to enjoy pushing them down my throat :-)) 
`\end{rant}`



> 
> - There is a missing ')' in your TODO block.
> 
> Nathann


---

Comment by ncohen created at 2015-11-09 14:16:13

Hellooooo Dima,

> well, I plan to provide an example of how to use L (for `v=441` (t=2) one can
> get an interesting example). The smallest example where one can provide G
> different from the default has `v=25*23^2` (t=4). I can do this too (although
> it would be tagged `# very long time an' lotsa RAM`).

HMmmmmmmmm. Well, my problem with those arguments is that it is very hard for an
end-user to understand what exactly they do. You say that the construction is
"parameterized" by a skew latin square, and that one can provide one, but
well.. Does not look very appealing.

Okay, let's say that I agree. I'll blame it on your unnatural obsession with
having 'all SRGs of each parameter set' and not 'just any of them' `:-P`

> there are more places like this there - this one was copied from `is_paley`...

Well, please fix this one at least `:-P`

> unless it's a violation of something, I don't mind

It's probably a violation of something, but that something is just "another
guy's advice". Decide for yourself `:-P`

> `\begin{rant}` I lived under various dictators, some more benevolent, some
> less. Often one has to speak Aesop's (Esope, Ezop) language in order not to
> get in trouble. Please consider this Aesope's language code my hidden protest
> against Python's BDFL. (for I hate index variables and loops, while he seems
> to enjoy pushing them down my throat :-)) `\end{rant}`

I forgive you, but please think of the childr----- of the cost in memory and cpu
usage of what you do, for those lambda functions which you like for their
'efficiency and simplicity' waste both of them, uselessly. When you write code,
think of what the computer does with it `:-P`

HAve fuuuuuuuuuun,

Nathann


---

Comment by git created at 2015-11-09 22:46:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2015-11-09 22:48:39

Replying to [comment:19 ncohen]:

> > well, I plan to provide an example of how to use L (for `v=441` (t=2) one can
> > get an interesting example). The smallest example where one can provide G
> > different from the default has `v=25*23^2` (t=4). I can do this too (although
> > it would be tagged `# very long time an' lotsa RAM`).

I created such an `L`, and was surprised (see last commits)
> 
> > there are more places like this there - this one was copied from `is_paley`...
> 
> Well, please fix this one at least `:-P`

ok. Ready for another round I suppose.
----
New commits:


---

Comment by dimpase created at 2015-11-09 22:48:39

Changing status from needs_info to needs_review.


---

Comment by ncohen created at 2015-11-10 10:30:54

Hellooooooooo Dima,

Thanks for this additional details in the doc.

About your example: you say in the doc that `that non-isomorphic Latin squares still lead to isomorphic graphs`, and I have two questions about it:

1) Are you sure that the latin squares are not isomorphic?

2) Would you mind inserting a 'can' in the sentence above, i.e. 'that non-isomorphic Latin squares *CAN* still lead to isomorphic graphs'?

Other remarks

1) You should add two backquotes around 'None' in the doc, as they appear in LaTeX script

2) Funny, that's the first time I see a time-consuming call to is_isomorphic. Note that computing .automorphism_group (with 'bliss' installed) is much faster! So far 'bliss' is not automatically called for isomorphism test, however, but I expect that it would perform much better if the time taken by automorphism_group is a good indicator

3) About your 'language' issues and the variety of dictators: it's another matter of taste, but I find your endline '\' quite distateful. Note that you do not need them when there is an unclosed parenthesis, e.g. the following works both in the console and in .py code.


```
sage: print (1+
....:        1)
2
```


Nathann


---

Comment by git created at 2015-11-10 13:08:08

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2015-11-10 13:12:15

in fact, G9 and G3x3 cannot be isomorphic, as they have automorphism groups of different orders (checked with bliss too, just in case). 

Probably when I tried checking for isomorphism yesterday, either my laptop or me, or both, had a heisenbug issue... Sorry for confusion - I also was talking nonsense in the class I taught yesterday...


---

Comment by git created at 2015-11-10 13:17:55

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by ncohen created at 2015-11-10 13:44:46

Hello Dima,

Sorry, but you can't replace your 'not tested' doctest with a 'long time' just because it goes fast on your computer `^^;`

You told me that you just installed bliss, and because of that `.automorphism_group` is faster, but if you call `.automorphism_group(algorithm='sage')` the first instance still takes 17s (on my computer) to run `^^;`

Nathann


---

Comment by ncohen created at 2015-11-10 13:45:04

(and this is how long it will take for whoever does not have 'bliss' installed.

Nathann


---

Comment by ncohen created at 2015-11-10 13:46:49

(you can turn them into `optional - bliss` if you *really* want to have them)


---

Comment by dimpase created at 2015-11-10 15:06:05

Replying to [comment:26 ncohen]:
> Hello Dima,
> 
> Sorry, but you can't replace your 'not tested' doctest with a 'long time' just because it goes fast on your computer `^^;`
> 
> You told me that you just installed bliss, and because of that `.automorphism_group` is faster, but if you call `.automorphism_group(algorithm='sage')` the first instance still takes 17s (on my computer) to run `^^;`
> 

Do you mean that installation of bliss automatically makes bliss the default?! WTF?


---

Comment by ncohen created at 2015-11-10 15:08:47

> Do you mean that installation of bliss automatically makes bliss the default?! WTF?

Yep. This way any function that calls 'automorphism_group' benefits from the speedup, and we don't have to propagate a 'use_bliss=True' argument up every function that calls it.

Nathann


---

Comment by dimpase created at 2015-11-10 15:13:18

Replying to [comment:30 ncohen]:
> > Do you mean that installation of bliss automatically makes bliss the default?! WTF?
> 
> Yep. This way any function that calls 'automorphism_group' benefits from the speedup, and we don't have to propagate a 'use_bliss=True' argument up every function that calls it.

This sucks. There must be a global way to control this. There is one with the (MI)LP backend.
The last thing you want is that the underlying implementation changes SILENTLY.


---

Comment by ncohen created at 2015-11-10 15:15:38

> This sucks.

If you make it manual, you would install the software and get absolutely no speedup.

> There must be a global way to control this. There is one with the (MI)LP backend.

You can implement it, but I don't see the point. You are unhappy because installing an optional package makes Sage run faster?...

Nathann


---

Comment by ncohen created at 2015-11-10 15:16:00

Note that you can still tune which algorithms gets run whenever you call automorphism_group *directly*.

Nathann


---

Comment by dimpase created at 2015-11-10 15:31:25

Replying to [comment:33 ncohen]:
> Note that you can still tune which algorithms gets run whenever you call automorphism_group *directly*.

given that there is no way to uninstall a package in Sage, one can get nuked by, say, a bug discovered in a backend... there must be a manual control over this, akin to default LP solver control.

Or, say, I want to compare two backends - do you tell me I must insert that `algorithm=...` in every freaking place, including the Sage library?! 

I'm not saying that installation of an extra backend must not flip this manual control - why not, it can do it.


---

Comment by ncohen created at 2015-11-10 15:35:41

You can add a global switch to disable this automatic detection if you like. I don't need one, and I just wanted to make Sage faster if it can find in its surrounding better libraries than what it ships by default.

Nathann


---

Comment by git created at 2015-11-10 15:46:49

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by ncohen created at 2015-11-10 15:52:18

Yo Dima !

Thanks, it looks good. There is a broken doctest, however, for the SRG on 45 vertices appears in one of them `^^;`

Nathann


---

Comment by git created at 2015-11-10 17:37:05

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by ncohen created at 2015-11-10 20:44:48

Changing status from needs_review to positive_review.


---

Comment by ncohen created at 2015-11-10 20:44:48

Let's go !

Nathann


---

Comment by vbraun created at 2015-11-11 19:40:44

Resolution: fixed
