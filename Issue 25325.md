# Issue 25325: Posets: Optimize dimension()

archive/issues_025325.json:
```json
{
    "body": "CC:  @fchapoton @tscrim\n\nDone now:\n\n- For dimension 1 check if the poset is chain; for dimension 2 check if the incomparability graph is a comparability graph for some other poset. Only then proceed to use MILP and hypergraphs.\n\n- Remove internal check from the function.\n\nDone earlier:\n\n- To doc add a mention about this being NP-complete.\n\n- Add a randomized check to `tests/*`.\n\nTo be done later:\n\n- Do at least series-parallel decomposition first, compute by parts.\n\n- For lattices run `irreducibles_poset()` first.\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/25562\n\n",
    "closed_at": "2018-06-29T22:33:55Z",
    "created_at": "2018-06-12T04:03:32Z",
    "labels": [
        "component: combinatorics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.3",
    "title": "Posets: Optimize dimension()",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25325",
    "user": "https://github.com/jm58660"
}
```
CC:  @fchapoton @tscrim

Done now:

- For dimension 1 check if the poset is chain; for dimension 2 check if the incomparability graph is a comparability graph for some other poset. Only then proceed to use MILP and hypergraphs.

- Remove internal check from the function.

Done earlier:

- To doc add a mention about this being NP-complete.

- Add a randomized check to `tests/*`.

To be done later:

- Do at least series-parallel decomposition first, compute by parts.

- For lattices run `irreducibles_poset()` first.


Issue created by migration from https://trac.sagemath.org/ticket/25562





---

archive/issue_comments_356611.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-06-25T09:20:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25325",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25325#issuecomment-356611",
    "user": "https://github.com/jm58660"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_356612.json:
```json
{
    "body": "New commits:",
    "created_at": "2018-06-25T09:20:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25325",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25325#issuecomment-356612",
    "user": "https://github.com/jm58660"
}
```

New commits:



---

archive/issue_comments_356613.json:
```json
{
    "body": "I forgot timings. I tested with `PP = list(Posets(7))` and before the patch it took about 17 seconds to run `sum(P.dimension() for P in PP)`. After the patch it dropped below 4 seconds.",
    "created_at": "2018-06-25T11:06:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25325",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25325#issuecomment-356613",
    "user": "https://github.com/jm58660"
}
```

I forgot timings. I tested with `PP = list(Posets(7))` and before the patch it took about 17 seconds to run `sum(P.dimension() for P in PP)`. After the patch it dropped below 4 seconds.



---

archive/issue_comments_356614.json:
```json
{
    "body": "Hi Jori,\n\nI tried your patch, it looks good.  I have a few very minor and trivial documentation suggestions, reproduced below, use them as you see fit.\n\n```\ndiff --git a/src/sage/combinat/posets/posets.py b/src/sage/combinat/posets/posets.py\nindex 022e95e668..f64827d098 100644\n--- a/src/sage/combinat/posets/posets.py\n+++ b/src/sage/combinat/posets/posets.py\n@@ -2968,11 +2968,11 @@ class FinitePoset(UniqueRepresentation, Parent):\n         Return the dimension of the Poset.\n \n         The (Dushnik-Miller) dimension of a poset is the minimal\n-        number of total orders so that the poset can be defined as\n-        \"intersection\" of all of them. Mathematically said, dimension\n-        of a poset defined on a set `X` of points is the smallest\n-        integer `n` such that there exists `P_1,...,P_n` linear\n-        extensions of `P` satisfying the following property:\n+        number of total orders so that the poset is their\n+        \"intersection\".  More precisely, the dimension of a poset\n+        defined on a set `X` of points is the smallest integer `n`\n+        such that there exist linear extensions `P_1,...,P_n` of `P`\n+        satisfying:\n \n         .. MATH::\n \n@@ -3035,8 +3035,9 @@ class FinitePoset(UniqueRepresentation, Parent):\n             sage: Poset( (L[0], lambda x, y: all(l.index(x) < l.index(y) for l in L)) ) == P\n             True\n \n-        According to Schnyder's theorem, the poset (of height 2) of a graph has\n-        dimension `\\leq 3` if and only if the graph is planar::\n+        According to Schnyder's theorem, the incidence poset (of\n+        height 2) of a graph has dimension `\\leq 3` if and only if\n+        the graph is planar::\n \n             sage: G = graphs.CompleteGraph(4)\n             sage: P = Poset(DiGraph({(u,v):[u,v] for u,v,_ in G.edges()}))\n@@ -3048,6 +3049,13 @@ class FinitePoset(UniqueRepresentation, Parent):\n             sage: P.dimension() # not tested - around 4s with CPLEX\n             4\n \n+        The smallest poset of dimension 4, all other posets with at\n+        most 8 elements have smaller dimension::\n+\n+            sage: P = Poset((range(8), sorted([[i,j+4] for i in range(4) for j in range(4) if i != j])))\n+            sage: P.dimension()\n+            4\n+\n         TESTS:\n \n         Empty Poset::\n@@ -3056,22 +3064,23 @@ class FinitePoset(UniqueRepresentation, Parent):\n             0\n             sage: Poset().dimension(certificate=True)\n             (0, [])\n+\n         \"\"\"\n         if self.cardinality() == 0:\n             return (0, []) if certificate else 0\n         if self.is_chain():\n             return (1, self.list()) if certificate else 1\n \n-        # Current bound on the chromatic number of the hypergraph\n+        # current bound on the chromatic number of the hypergraph\n         k = 2\n-        # If a realizer is not needed, we can optimize little\n+        # if a realizer is not needed, we can optimize a little\n         if not certificate:\n-            # Polynomial time check for dimension 2\n+            # polynomial time check for dimension 2\n             from sage.graphs.comparability import greedy_is_comparability as is_comparability\n             if is_comparability(self._hasse_diagram.transitive_closure().to_undirected().complement()):\n                 return 2\n             k = 3\n-            # Know max values for dimension\n+            # known upper bound for dimension\n             max_value = max(self.cardinality() // 2, self.width())\n \n         from sage.numerical.mip import MixedIntegerLinearProgram, MIPSolverException\n```",
    "created_at": "2018-06-25T19:26:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25325",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25325#issuecomment-356614",
    "user": "https://github.com/mantepse"
}
```

Hi Jori,

I tried your patch, it looks good.  I have a few very minor and trivial documentation suggestions, reproduced below, use them as you see fit.

```
diff --git a/src/sage/combinat/posets/posets.py b/src/sage/combinat/posets/posets.py
index 022e95e668..f64827d098 100644
--- a/src/sage/combinat/posets/posets.py
+++ b/src/sage/combinat/posets/posets.py
@@ -2968,11 +2968,11 @@ class FinitePoset(UniqueRepresentation, Parent):
         Return the dimension of the Poset.
 
         The (Dushnik-Miller) dimension of a poset is the minimal
-        number of total orders so that the poset can be defined as
-        "intersection" of all of them. Mathematically said, dimension
-        of a poset defined on a set `X` of points is the smallest
-        integer `n` such that there exists `P_1,...,P_n` linear
-        extensions of `P` satisfying the following property:
+        number of total orders so that the poset is their
+        "intersection".  More precisely, the dimension of a poset
+        defined on a set `X` of points is the smallest integer `n`
+        such that there exist linear extensions `P_1,...,P_n` of `P`
+        satisfying:
 
         .. MATH::
 
@@ -3035,8 +3035,9 @@ class FinitePoset(UniqueRepresentation, Parent):
             sage: Poset( (L[0], lambda x, y: all(l.index(x) < l.index(y) for l in L)) ) == P
             True
 
-        According to Schnyder's theorem, the poset (of height 2) of a graph has
-        dimension `\leq 3` if and only if the graph is planar::
+        According to Schnyder's theorem, the incidence poset (of
+        height 2) of a graph has dimension `\leq 3` if and only if
+        the graph is planar::
 
             sage: G = graphs.CompleteGraph(4)
             sage: P = Poset(DiGraph({(u,v):[u,v] for u,v,_ in G.edges()}))
@@ -3048,6 +3049,13 @@ class FinitePoset(UniqueRepresentation, Parent):
             sage: P.dimension() # not tested - around 4s with CPLEX
             4
 
+        The smallest poset of dimension 4, all other posets with at
+        most 8 elements have smaller dimension::
+
+            sage: P = Poset((range(8), sorted([[i,j+4] for i in range(4) for j in range(4) if i != j])))
+            sage: P.dimension()
+            4
+
         TESTS:
 
         Empty Poset::
@@ -3056,22 +3064,23 @@ class FinitePoset(UniqueRepresentation, Parent):
             0
             sage: Poset().dimension(certificate=True)
             (0, [])
+
         """
         if self.cardinality() == 0:
             return (0, []) if certificate else 0
         if self.is_chain():
             return (1, self.list()) if certificate else 1
 
-        # Current bound on the chromatic number of the hypergraph
+        # current bound on the chromatic number of the hypergraph
         k = 2
-        # If a realizer is not needed, we can optimize little
+        # if a realizer is not needed, we can optimize a little
         if not certificate:
-            # Polynomial time check for dimension 2
+            # polynomial time check for dimension 2
             from sage.graphs.comparability import greedy_is_comparability as is_comparability
             if is_comparability(self._hasse_diagram.transitive_closure().to_undirected().complement()):
                 return 2
             k = 3
-            # Know max values for dimension
+            # known upper bound for dimension
             max_value = max(self.cardinality() // 2, self.width())
 
         from sage.numerical.mip import MixedIntegerLinearProgram, MIPSolverException
```



---

archive/issue_comments_356615.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-06-26T04:46:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25325",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25325#issuecomment-356615",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_356616.json:
```json
{
    "body": "Replying to [comment:4 mantepse]:\n\n> I have a few very minor and trivial documentation suggestions, reproduced below, use them as you see fit.\n\n\nGood points. I used all of them, except one that is quite slow. Btw, there is ready-made posets.StandardExample available.\n\nContains a trivial non-related change to `relations_number` example.",
    "created_at": "2018-06-26T04:48:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25325",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25325#issuecomment-356616",
    "user": "https://github.com/jm58660"
}
```

Replying to [comment:4 mantepse]:

> I have a few very minor and trivial documentation suggestions, reproduced below, use them as you see fit.


Good points. I used all of them, except one that is quite slow. Btw, there is ready-made posets.StandardExample available.

Contains a trivial non-related change to `relations_number` example.



---

archive/issue_comments_356617.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-06-26T07:31:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25325",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25325#issuecomment-356617",
    "user": "https://github.com/mantepse"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_356618.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-06-29T22:33:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25325",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25325#issuecomment-356618",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_064093.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-06-29T22:33:55Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/25325",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25325#event-64093"
}
```
