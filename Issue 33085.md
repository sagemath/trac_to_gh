# Issue 33085: Several ImageMagick tests need "long time"

Issue created by migration from https://trac.sagemath.org/ticket/33322

Original creator: mjo

Original creation time: 2022-02-10 21:30:25

The slightly unusual output is from #32981.

I set the limit at 30 seconds of cputime on this run so there may be others that should arguably be tagged. (The developer's guide says that even "long time" tests should run in under 5s, but it's referring to "wall time" which is pretty meaningless.)


```
File "src/sage/plot/animate.py", line 53, in sage.plot.animate
Warning, slow doctest:
    E.show()  # optional -- ImageMagick
Test ran for 41.89 cpu seconds
```


```
File "src/sage/plot/animate.py", line 81, in sage.plot.animate
Warning, slow doctest:
    a.show()   # optional -- ImageMagick
Test ran for 94.02 cpu seconds
```


```
File "src/sage/plot/animate.py", line 166, in sage.plot.animate.Animation
Warning, slow doctest:
    a                 # optional -- ImageMagick
Test ran for 32.07 cpu seconds
```


```
File "src/sage/plot/animate.py", line 205, in sage.plot.animate.Animation
Warning, slow doctest:
    a.show() # optional -- ImageMagick
Test ran for 38.46 cpu seconds
```


```
File "src/sage/plot/animate.py", line 234, in sage.plot.animate.Animation.__init__
Warning, slow doctest:
    a           # optional -- ImageMagick
Test ran for 31.57 cpu seconds
```


```
File "src/sage/combinat/words/paths.py", line 1638, in sage.combinat.words.paths.FiniteWordPath_2d.animate
Warning, slow doctest:
    (a*b*c*d).show()  # optional -- ImageMagick
```


```
File "src/sage/combinat/tiling.py", line 2421, in sage.combinat.tiling.TilingSolver.animate
Warning, slow doctest:
    a                   # optional -- ImageMagick
Test ran for 41.68 cpu seconds
```


```
File "src/sage/combinat/tiling.py", line 2428, in sage.combinat.tiling.TilingSolver.animate
Warning, slow doctest:
    a             # optional -- ImageMagick
Test ran for 49.04 cpu seconds
```



---

Comment by slabbe created at 2022-02-11 09:29:26

New commits:


---

Comment by slabbe created at 2022-02-11 09:29:26

Changing status from new to needs_review.


---

Comment by mjo created at 2022-02-11 13:14:15

That was fast =)

Most of those (except maybe the first) do inherently take a long time. But there's another problem: the feature detection takes a long time. So as soon as you mark "the first" imagemagick test `# long time`, some other imagemagick test becomes the first one to get executed. And then that test performs the feature detection, and takes a long time....

So ultimately they all need to be marked `# long time` to avoid the first one taking an unusually long time when `--long` is not used.


---

Comment by slabbe created at 2022-02-11 15:46:22

That was an easy one =)

The `is_functional` for ffmpeg may be long because of the for loops which check every format. But the `is_functional` for imagemagick should be fast. Do you know what part is slow?


---

Comment by mjo created at 2022-02-11 18:45:01

You're right, the feature test itself is relatively short. I think I just had bad luck, combined with a few tests that just happen to hover around 30s.

As soon as I applied the patch, two different tests started running long. So I fixed those; then another one. Fixed that, and another one. Then I jumped to the wrong conclusion.

I think this is all of the remaining ones:


```diff
diff --git a/src/sage/combinat/tiling.py b/src/sage/combinat/tiling.py
index 57d3931d3a..1eefbec0e6 100644
--- a/src/sage/combinat/tiling.py
+++ b/src/sage/combinat/tiling.py
@@ -2436,14 +2436,14 @@ class TilingSolver(SageObject):
 
         ::
 
-            sage: a.show()                 # optional -- ImageMagick
+            sage: a.show()                 # optional -- ImageMagick, long time
 
         The ``show`` function takes arguments to specify the delay between
         frames (measured in hundredths of a second, default value 20) and
         the number of iterations (default value 0, which means to iterate
         forever). To iterate 4 times with half a second between each frame::
 
-            sage: a.show(delay=50, iterations=4)  # optional -- ImageMagick
+            sage: a.show(delay=50, iterations=4)  # optional -- ImageMagick, long time
 
         Limit the number of frames::
 
diff --git a/src/sage/plot/animate.py b/src/sage/plot/animate.py
index fbe3c7ade2..4d17730c29 100644
--- a/src/sage/plot/animate.py
+++ b/src/sage/plot/animate.py
@@ -167,7 +167,7 @@ class Animation(WithEqualityById, SageObject):
         Animation with 21 frames
         sage: a[:5]             # optional -- ImageMagick
         Animation with 5 frames
-        sage: a.show()          # optional -- ImageMagick
+        sage: a.show()          # optional -- ImageMagick, long time
         sage: a[:5].show()      # optional -- ImageMagick
 
     The :meth:`show` method takes arguments to specify the
@@ -176,7 +176,7 @@ class Animation(WithEqualityById, SageObject):
     means to iterate forever). To iterate 4 times with half a second
     between each frame::
 
-        sage: a.show(delay=50, iterations=4) # optional -- ImageMagick
+        sage: a.show(delay=50, iterations=4) # optional -- ImageMagick, long time
 
     An animation of drawing a parabola::
 

```



---

Comment by git created at 2022-02-17 09:04:18

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by slabbe created at 2022-02-17 09:04:53

I fixed the remaining missing tags and I rebased on top of 9.6.beta1.


---

Comment by mjo created at 2022-02-17 11:59:23

Thank you!


---

Comment by mjo created at 2022-02-17 11:59:23

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2022-03-03 22:19:31

Resolution: fixed
