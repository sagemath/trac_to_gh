# Issue 25789: Updates to Huffman codings

Issue created by migration from https://trac.sagemath.org/ticket/26026

Original creator: embray

Original creation time: 2018-08-08 10:53:19

CC:  tscrim

The main goal of these changes were to make this class work on Python 3, which previously it didn't due to comparisons failing while manipulating the heap queue data structures when building the tree.  The other problem was that the use of dict iterators meant that the codings weren't quite predictable; sometimes the codes for two characters could be swapped, leading to different test results (granted, not in a way that affects the length of the encodings).

This reimplements building the tree in a way that's deterministic and works the same on Python 2 and 3, and fixes a few other minor issues I noticed.


---

Comment by git created at 2018-08-08 10:53:44

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by embray created at 2018-08-08 10:57:05

Changing status from new to needs_review.


---

Comment by @bryangingechen created at 2018-08-08 13:00:34

The ticket #18315 also makes extensive changes to the Huffman coding algorithm.


---

Comment by embray created at 2018-08-08 13:03:54

Oops, I didn't see that one; it is quite old.  Are you trying to revive it?


---

Comment by embray created at 2018-08-08 13:08:27

Looking at the implementation in #18315, it would suffer from the same problems this is trying to fix, so I think this ticket is still relevant, albeit obviously not directly compatible with #18315.

I haven't looked closely at the other coding algorithms added in that ticket but they might have some of the same kinds of problems too.  I have a few other nitpicks with that ticket but it looks good on the whole.


---

Comment by @bryangingechen created at 2018-08-08 13:10:28

Replying to [comment:4 embray]:
> Oops, I didn't see that one; it is quite old.  Are you trying to revive it?
I haven't looked at it in any real detail yet, and I'm also not knowledgeable on the subject. It did seem worthy of a little more attention though.


---

Comment by chapoton created at 2018-11-06 14:37:59

one trivial failing doctest


---

Comment by chapoton created at 2018-11-06 14:37:59

Changing status from needs_review to needs_work.


---

Comment by chapoton created at 2018-11-10 13:23:36

Changing status from needs_work to needs_review.


---

Comment by chapoton created at 2018-11-10 13:23:36

I fixed the doctest
----
New commits:


---

Comment by chapoton created at 2018-11-11 15:25:46

green bot, please review


---

Comment by chapoton created at 2018-11-16 17:15:59

please review (this is about a file with many failing doctest in python 3)


---

Comment by tscrim created at 2018-11-17 16:54:54

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2018-11-17 16:54:54

LGTM.


---

Comment by vbraun created at 2018-11-19 18:01:14

Resolution: fixed
