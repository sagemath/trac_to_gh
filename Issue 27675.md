# Issue 27675: Add GAP package PackageManager to gap_packages

archive/issues_027675.json:
```json
{
    "body": "CC:  @dimpase @tscrim @vbraun @embray\n\nThe recent GAP `PackageManager` package makes it much much easier to install new GAP packages. It seems to work smoothly from within Sage (up to the caveat of #27911), with e.g.:\n\n```\n    sage: libgap.InstallPackage(\"Semigroups\")\n```\n\n\nSo this seems like a valuable low hanging fruit.\n\nOf course, the user still needs to have compiler tools and write access to the Sage install; but there is only so much we can do.\n\nIssue created by migration from https://trac.sagemath.org/ticket/27912\n\n",
    "created_at": "2019-05-31T22:07:18Z",
    "labels": [
        "component: interfaces"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.8",
    "title": "Add GAP package PackageManager to gap_packages",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27675",
    "user": "https://github.com/nthiery"
}
```
CC:  @dimpase @tscrim @vbraun @embray

The recent GAP `PackageManager` package makes it much much easier to install new GAP packages. It seems to work smoothly from within Sage (up to the caveat of #27911), with e.g.:

```
    sage: libgap.InstallPackage("Semigroups")
```


So this seems like a valuable low hanging fruit.

Of course, the user still needs to have compiler tools and write access to the Sage install; but there is only so much we can do.

Issue created by migration from https://trac.sagemath.org/ticket/27912





---

archive/issue_comments_390278.json:
```json
{
    "body": "Oh, it's already bundled in the gap tarball. So it would be just a question of listing it in `spkg-install`?",
    "created_at": "2019-05-31T22:32:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27675#issuecomment-390278",
    "user": "https://github.com/nthiery"
}
```

Oh, it's already bundled in the gap tarball. So it would be just a question of listing it in `spkg-install`?



---

archive/issue_comments_390279.json:
```json
{
    "body": "it is more of a question whether it does the right thing, as out directory configuration for GAP is not the original GAP\u2019s one.",
    "created_at": "2019-05-31T22:48:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27675#issuecomment-390279",
    "user": "https://github.com/dimpase"
}
```

it is more of a question whether it does the right thing, as out directory configuration for GAP is not the original GAPâ€™s one.



---

archive/issue_comments_390280.json:
```json
{
    "body": "Ok, I'll give it a shot. It's a very recent package and in pure GAP, so the odds are probably good.",
    "created_at": "2019-05-31T23:00:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27675#issuecomment-390280",
    "user": "https://github.com/nthiery"
}
```

Ok, I'll give it a shot. It's a very recent package and in pure GAP, so the odds are probably good.



---

archive/issue_comments_390281.json:
```json
{
    "body": "Btw: in case this is relevant, e.g. to discuss with Michael Torpey who wrote `PackageManager`, I'll be in St Andrews Monday-Thursday (and in fact hiking with James this week-end).",
    "created_at": "2019-05-31T23:07:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27675#issuecomment-390281",
    "user": "https://github.com/nthiery"
}
```

Btw: in case this is relevant, e.g. to discuss with Michael Torpey who wrote `PackageManager`, I'll be in St Andrews Monday-Thursday (and in fact hiking with James this week-end).



---

archive/issue_comments_390282.json:
```json
{
    "body": "Oh, maybe I see what you mean: the packages get installed in ~/.gap/pkg rather than in Sage's directory. Kind of `pip install --user`. Well, the bonus is that it does not require special permissions. And the same installation can be reused across several installs of GAP. The caveat being to guarantee that it's compatible with all those installations.\n\nAt least it seems to work smoothly for now. I'll discuss with Michael about this.",
    "created_at": "2019-05-31T23:19:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27675#issuecomment-390282",
    "user": "https://github.com/nthiery"
}
```

Oh, maybe I see what you mean: the packages get installed in ~/.gap/pkg rather than in Sage's directory. Kind of `pip install --user`. Well, the bonus is that it does not require special permissions. And the same installation can be reused across several installs of GAP. The caveat being to guarantee that it's compatible with all those installations.

At least it seems to work smoothly for now. I'll discuss with Michael about this.



---

archive/issue_comments_390283.json:
```json
{
    "body": "Adding `PackageManager` to spkg-install seems to do the trick :-)",
    "created_at": "2019-05-31T23:20:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27675#issuecomment-390283",
    "user": "https://github.com/nthiery"
}
```

Adding `PackageManager` to spkg-install seems to do the trick :-)



---

archive/issue_comments_390284.json:
```json
{
    "body": "New commits:",
    "created_at": "2019-05-31T23:27:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27675#issuecomment-390284",
    "user": "https://github.com/nthiery"
}
```

New commits:



---

archive/issue_comments_390285.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-05-31T23:27:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27675#issuecomment-390285",
    "user": "https://github.com/nthiery"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_390286.json:
```json
{
    "body": "For the record: all tests passed (with #27911+#27912).",
    "created_at": "2019-06-01T05:07:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27675#issuecomment-390286",
    "user": "https://github.com/nthiery"
}
```

For the record: all tests passed (with #27911+#27912).



---

archive/issue_comments_390287.json:
```json
{
    "body": "Replying to [comment:7 nthiery]:\n> Oh, maybe I see what you mean: the packages get installed in ~/.gap/pkg rather than in Sage's directory. \n\nI meant packages that do require compilation - especially ones that build GAP kernel modules are tricky.",
    "created_at": "2019-06-01T06:08:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27675#issuecomment-390287",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:7 nthiery]:
> Oh, maybe I see what you mean: the packages get installed in ~/.gap/pkg rather than in Sage's directory. 

I meant packages that do require compilation - especially ones that build GAP kernel modules are tricky.



---

archive/issue_comments_390288.json:
```json
{
    "body": "Ah, ok. This seems to have worked smoothly with Semigroup (which requires compilation). I'll be banging on it more seriously all week long so this will be a good test. Do you have suggestions of other complex / more oldish packages to try out?",
    "created_at": "2019-06-01T07:44:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27675#issuecomment-390288",
    "user": "https://github.com/nthiery"
}
```

Ah, ok. This seems to have worked smoothly with Semigroup (which requires compilation). I'll be banging on it more seriously all week long so this will be a good test. Do you have suggestions of other complex / more oldish packages to try out?



---

archive/issue_comments_390289.json:
```json
{
    "body": "Replying to [comment:14 nthiery]:\n> Ah, ok. This seems to have worked smoothly with Semigroup (which requires compilation). I'll be banging on it more seriously all week long so this will be a good test. Do you have suggestions of other complex / more oldish packages to try out?\n\n\n[EDIM](https://www.gap-system.org/Packages/edim.html) might be a good test, as it builds a GAP kernel module, and has not been worked on in the context of Sage yet (that is, unlike Semigroup)\n\nYou might also want to experiment with e.g. removing GRAPE from `gap_packages` and trying to install it via PackageManager.\n\nTry things  on OSX and Cygwin, try not to pull your hair out in the process :-)\n(perhaps we might want to spend ODK money on OSX and Windows hardware, so that we can have more boxes to run buildbots, try things on, etc)\n\nI presume that the present GAP 4.10.1 tarball contains a rather old version of PackageManager - I'd really wait for a newer realese.",
    "created_at": "2019-06-01T08:00:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27675#issuecomment-390289",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:14 nthiery]:
> Ah, ok. This seems to have worked smoothly with Semigroup (which requires compilation). I'll be banging on it more seriously all week long so this will be a good test. Do you have suggestions of other complex / more oldish packages to try out?


[EDIM](https://www.gap-system.org/Packages/edim.html) might be a good test, as it builds a GAP kernel module, and has not been worked on in the context of Sage yet (that is, unlike Semigroup)

You might also want to experiment with e.g. removing GRAPE from `gap_packages` and trying to install it via PackageManager.

Try things  on OSX and Cygwin, try not to pull your hair out in the process :-)
(perhaps we might want to spend ODK money on OSX and Windows hardware, so that we can have more boxes to run buildbots, try things on, etc)

I presume that the present GAP 4.10.1 tarball contains a rather old version of PackageManager - I'd really wait for a newer realese.



---

archive/issue_comments_390290.json:
```json
{
    "body": "Trying things out with Michael. Current status:\n- `libgap.InstallPackage(\"PackageManager\")` nicely upgrades to the latest version\n- In a standard GAP on Linux `InstallPackage(\"EGIM\")` seems to work smoothly\n- With Sage's GAP, the compilation fails. There seems to be some missing build artefact, starting from a missing link `sysinfo.gap-default64` -> `sysinfo.gap` presumably due to out-of-source installation. Michael is trying such an out of source installation with plain GAP now.",
    "created_at": "2019-06-04T11:49:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27675#issuecomment-390290",
    "user": "https://github.com/nthiery"
}
```

Trying things out with Michael. Current status:
- `libgap.InstallPackage("PackageManager")` nicely upgrades to the latest version
- In a standard GAP on Linux `InstallPackage("EGIM")` seems to work smoothly
- With Sage's GAP, the compilation fails. There seems to be some missing build artefact, starting from a missing link `sysinfo.gap-default64` -> `sysinfo.gap` presumably due to out-of-source installation. Michael is trying such an out of source installation with plain GAP now.



---

archive/issue_comments_390291.json:
```json
{
    "body": "It could be that EDIM needs a patch to be installable in Sage's GAP.\n\nOne may try adding it to the list of packages to be installed in gap_packages, and\nsee how it goes there.",
    "created_at": "2019-06-04T11:57:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27675#issuecomment-390291",
    "user": "https://github.com/dimpase"
}
```

It could be that EDIM needs a patch to be installable in Sage's GAP.

One may try adding it to the list of packages to be installed in gap_packages, and
see how it goes there.



---

archive/issue_comments_390292.json:
```json
{
    "body": "Replying to [comment:17 dimpase]:\n> It could be that EDIM needs a patch to be installable in Sage's GAP.\n\nIndeed; or that our current out-of-source installation procedure for GAP is missing to install some build artefacts. Eventually, this will all be resolved when GAP will provide a native \"make install\" feature, and the build system of all packages will be updated. I can't wait :-)",
    "created_at": "2019-06-04T19:50:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27675#issuecomment-390292",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:17 dimpase]:
> It could be that EDIM needs a patch to be installable in Sage's GAP.

Indeed; or that our current out-of-source installation procedure for GAP is missing to install some build artefacts. Eventually, this will all be resolved when GAP will provide a native "make install" feature, and the build system of all packages will be updated. I can't wait :-)



---

archive/issue_comments_390293.json:
```json
{
    "body": "Thinking about it a bit more, here is my perspective. \n\nThings have gone much much better recently on the use of GAP package in Sage, which is great. Indeed, and that's unfortunate, there are still GAP packages that can't be installed in Sage's GAP due to different problems. But somehow, that's none of `PackageManager`'s business.\n\n`PackageManager` is about automating the installation of GAP packages that can already be installed smoothly. As such, it's immediately useful for many packages. We should help our users by making it available.",
    "created_at": "2019-06-04T20:12:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27675#issuecomment-390293",
    "user": "https://github.com/nthiery"
}
```

Thinking about it a bit more, here is my perspective. 

Things have gone much much better recently on the use of GAP package in Sage, which is great. Indeed, and that's unfortunate, there are still GAP packages that can't be installed in Sage's GAP due to different problems. But somehow, that's none of `PackageManager`'s business.

`PackageManager` is about automating the installation of GAP packages that can already be installed smoothly. As such, it's immediately useful for many packages. We should help our users by making it available.



---

archive/issue_comments_390294.json:
```json
{
    "body": "OK, why not, indeed.",
    "created_at": "2019-06-04T20:15:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27675#issuecomment-390294",
    "user": "https://github.com/dimpase"
}
```

OK, why not, indeed.



---

archive/issue_comments_390295.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-06-04T20:15:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27675#issuecomment-390295",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_390296.json:
```json
{
    "body": "Thanks Dima for the review",
    "created_at": "2019-06-05T14:04:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27675#issuecomment-390296",
    "user": "https://github.com/nthiery"
}
```

Thanks Dima for the review



---

archive/issue_comments_390297.json:
```json
{
    "body": "For the record: one optional test failure by the patchbot; I don't see how this can be related, so I assume it's noise.\n\n```\nsage -t --long src/sage/sat/boolean_polynomials.py\n**********************************************************************\nFile \"src/sage/sat/boolean_polynomials.py\", line 146, in sage.sat.boolean_polynomials.solve\nFailed example:\n    len(sls_aes)                                                                      # optional - cryptominisat, long time\nExpected:\n    256\nGot:\n    16\n```\n",
    "created_at": "2019-06-05T14:08:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27675#issuecomment-390297",
    "user": "https://github.com/nthiery"
}
```

For the record: one optional test failure by the patchbot; I don't see how this can be related, so I assume it's noise.

```
sage -t --long src/sage/sat/boolean_polynomials.py
**********************************************************************
File "src/sage/sat/boolean_polynomials.py", line 146, in sage.sat.boolean_polynomials.solve
Failed example:
    len(sls_aes)                                                                      # optional - cryptominisat, long time
Expected:
    256
Got:
    16
```




---

archive/issue_events_069186.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-06-06T22:26:40Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/27675",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27675#event-69186"
}
```



---

archive/issue_comments_390298.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-06-06T22:26:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27675#issuecomment-390298",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_390299.json:
```json
{
    "body": "When installing packages through this interface, do they go into `local/share/gap`, or into `.gap`, or somewhere else?\n\nSomething I'd already been thinking of previously is that it would be handy to have an additional GAP_ROOT outside of `$SAGE_LOCAL` (which I'm trying as hard as possible to make more manageable) where user-installed packages can go.  Certainly `.gap` is a possibility or this, but it would be nice to have a place where additional user-installed packages can be made available 'globally' to a Sage installation, without actually putting them in `$SAGE_LOCAL` or at least not in `$SAGE_LOCAL/share/gap`.",
    "created_at": "2019-06-07T18:13:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27675#issuecomment-390299",
    "user": "https://github.com/embray"
}
```

When installing packages through this interface, do they go into `local/share/gap`, or into `.gap`, or somewhere else?

Something I'd already been thinking of previously is that it would be handy to have an additional GAP_ROOT outside of `$SAGE_LOCAL` (which I'm trying as hard as possible to make more manageable) where user-installed packages can go.  Certainly `.gap` is a possibility or this, but it would be nice to have a place where additional user-installed packages can be made available 'globally' to a Sage installation, without actually putting them in `$SAGE_LOCAL` or at least not in `$SAGE_LOCAL/share/gap`.



---

archive/issue_comments_390300.json:
```json
{
    "body": "It currently goes by default to ~/.gap (so the analogue of --user in pip). It can be configured with any alternative directory (which should be in GAP's path to be relevant). After discussions with Michael, he will implement a shorthand for \"the pkg directory of the current gap\".",
    "created_at": "2019-06-07T20:38:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27675#issuecomment-390300",
    "user": "https://github.com/nthiery"
}
```

It currently goes by default to ~/.gap (so the analogue of --user in pip). It can be configured with any alternative directory (which should be in GAP's path to be relevant). After discussions with Michael, he will implement a shorthand for "the pkg directory of the current gap".
