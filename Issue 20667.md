# Issue 20667: Deprecate Matrix.I

Issue created by migration from https://trac.sagemath.org/ticket/20904

Original creator: jsrn

Original creation time: 2016-06-29 07:29:31

Keywords: property, consistency

Following two long discussions on sage-devel about ``@`property`: https://groups.google.com/forum/#!searchin/sage-devel/heavy/sage-devel/tVa8vs_PHH0/60QajUDYBQAJ
https://groups.google.com/forum/#!searchin/sage-devel/heavy/sage-devel/b-u-0WqrtcY/SWhdeoO_BgAJ

No consensus was reached, except that mostly everyone agreed that `Matrix.I` was bad (in particular, there was people both for and against Matrix.T and Matrix.H).

So this ticket aims to deprecate just `Matrix.I`, so we can take it out
completely at some point in the future.



---

Comment by jsrn created at 2016-06-30 12:42:00

I'm setting this for needs_review. Note that I tried to run the doctests but that I'm getting a gazillion errors all over the place, unrelated to this ticket, for some reason, and so it's difficult for me to check whether this ticket causes new failures.
----
New commits:


---

Comment by jsrn created at 2016-06-30 12:42:00

Changing status from new to needs_review.


---

Comment by git created at 2016-06-30 13:25:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jsrn created at 2016-06-30 13:26:02

Fix a doc-test problem. Still open for review.


---

Comment by jmantysalo created at 2016-07-05 11:36:37

I got no deprecation warning at all from this code.


---

Comment by jsrn created at 2016-07-05 12:12:24

Perhaps it is due to this: https://groups.google.com/forum/#!topic/sage-devel/NCuA7F4YOLk


---

Comment by jmantysalo created at 2016-07-06 06:30:19

Changing status from needs_review to needs_work.


---

Comment by jmantysalo created at 2016-07-06 06:30:19

OK. Maybe it works after #20948, but for now I mark this as needs_work. I can review this then. Please also fill in author name.


---

Comment by jmantysalo created at 2016-07-21 09:34:10

This should work, as #20948 has been closet. But installing this will force big recompiling, so I guess this needs rebasing or merging.


---

Comment by git created at 2016-07-27 12:45:03

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jsrn created at 2016-07-27 12:45:37

Rebased. The warnings work correctly for me now.


---

Comment by jmantysalo created at 2016-07-27 19:42:57

Works. Thanks.

Please add your real name to Authors-field and put this to needs_review so I can mark my positive review.


---

Comment by jsrn created at 2016-07-27 23:02:40

Changing status from needs_work to needs_review.


---

Comment by jsrn created at 2016-07-27 23:02:40

Thanks. I always forget...


---

Comment by jmantysalo created at 2016-07-28 04:28:33

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2016-08-05 21:08:01

See patchbot


---

Comment by vbraun created at 2016-08-05 21:08:01

Changing status from positive_review to needs_work.


---

Comment by jdemeyer created at 2016-08-06 09:02:54

Why the changes to `src/sage/structure/sage_object.pyx` anyway?


---

Comment by git created at 2016-08-06 09:08:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jsrn created at 2016-08-06 09:16:07

Changing status from needs_work to needs_review.


---

Comment by jsrn created at 2016-08-06 09:16:07

OK, fixed: the bug was due to not properly reinstating warnings in `_test_not_implemented_methods` if that method threw an `AssertionError`.

`@`jdemeyer: the reason is that `_test_not_implemented_methods` accesses every attribute on an object. A gazillion `TESTS`-blocks in `sage.matrix` runs `TestSuite` on matrices, which will run `_test_not_implemented_methods`, which will access every attribute, in particular `Matrix.I`. Since this is a property, accessing it will "call" it, thus triggering the deprecation warning. Since `_test_not_implemented_methods` is not about warnings, I thought that disabling *all* warnings would be OK for the duration of the test.

A more efficient version of `_test_not_implemented_methods` shouldn't actually call properties, of course, and then I wouldn't have to modify the warnings filter. Do you have a suggestion for an alternative version that would behave like this?

Best,
Johan


---

Comment by jdemeyer created at 2016-08-06 10:38:58

OK, got it. One detail: I think it is better to use a `try`/`finally` to restore the warnings. That is more robust than adding `warnings.filters.pop(0)` at every exit point of the function.


---

Comment by git created at 2016-08-06 12:21:56

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jsrn created at 2016-08-06 12:23:27

Agreed, fixed now.


---

Comment by jmantysalo created at 2016-08-11 09:05:15

Changing status from needs_review to positive_review.


---

Comment by jmantysalo created at 2016-08-11 09:05:15

Works. (But too late to 7.3, changed milestone.)


---

Comment by vbraun created at 2016-08-13 22:51:08

Resolution: fixed
