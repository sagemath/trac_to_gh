# Issue 34418: SloaneEncyclopedia.find and some other SloaneEncyclopedia.* are broken

Issue created by migration from https://trac.sagemath.org/ticket/34655

Original creator: dimpase

Original creation time: 2022-10-13 16:04:00

CC:  pluschny

As described in https://groups.google.com/d/msgid/sage-support/67ce17aa-056b-49c1-95ad-e5cb75e25ba9n%40googlegroups.com


```
> SloaneEncyclopedia.find([1,2,3,4,5], 1)

TypeError                     Traceback (most recent call last)
/tmp/ipykernel_447/420583060.py in <cell line: 1>()
----> 1 SloaneEncyclopedia.find([Integer(1),Integer(2),Integer(3),Integer(4),Integer(5)], Integer(1))
~/mambaforge/envs/sage/lib/python3.10/site-packages/sage/databases/sloane.py in find(self, seq, maxresults)
    166         a subsequence.
    167         """
--> 168         self.load()
    169
    170         answer, nanswer = [], 0
~/mambaforge/envs/sage/lib/python3.10/site-packages/sage/databases/sloane.py in load(self)
    275             if len(L) == 0:
    276                 continue
--> 277             m = entry.search(L)
    278             if m:
    279                 seqnum = int(m.group('num'))

TypeError: cannot use a string pattern on a bytes-like object

```



---

Comment by @sheerluck created at 2022-10-15 16:42:20


```diff
--- a/sage/databases/sloane.py
+++ b/sage/databases/sloane.py
@@ -274,7 +274,7 @@
         for L in file_seq:
             if len(L) == 0:
                 continue
-            m = entry.search(L)
+            m = entry.search(L.decode("utf-8"))
             if m:
                 seqnum = int(m.group('num'))
                 msg = m.group('body').strip()
@@ -287,10 +287,13 @@
             for L in file_names:
                 if not L:
                     continue
-                m = entry.search(L)
+                m = entry.search(L.decode("utf-8"))
                 if m:
                     seqnum = int(m.group('num'))
-                    self.__data__[seqnum][3] = m.group('body').strip()
+                    if seqnum in self.__data__:
+                        self.__data__[seqnum][3] = m.group('body').strip()
+                    else:
+                        self.__data__[seqnum] = [seqnum, None, 'unknown', m.group('body').strip()]
             file_names.close()
             self.__loaded_names__ = True
         except KeyError:
```

