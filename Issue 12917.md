# Issue 12917: Implement weighted projective spaces.

Issue created by migration from https://trac.sagemath.org/ticket/13089

Original creator: davideklund

Original creation time: 2012-06-06 01:07:40

Assignee: AlexGhitza

This ticket aims at an implementation of weighted projective spaces in Sage. This was discussed on sage-devel here: https://groups.google.com/d/topic/sage-devel/rahI8ewn1_c/discussion. 

One approach is to implement weighted projective spaces as toric varieties.


---

Comment by novoselt created at 2012-06-06 19:25:04

At least for spaces that have a variable of weight 1 there should be a conversion to current toric varieties (for general ones in quotient lattices current implementation may be less canonical).


---

Comment by davideklund created at 2012-06-06 21:50:30

The attached patch is intended as a starting point to be revised and expanded upon. 

It might make sense to give weighted projective spaces a class of their own. 

Also, it might be suitable to make them as CPR Fano toric varieties (I think they are all of this type). When making polytopes with LatticePolytope there seems to be a limit on the dimension (<=6)  and I think it might make sense to allow weighted projective spaces of bigger dimension than that.


---

Comment by davideklund created at 2012-06-06 22:03:03

I'm not sure what you mean. Are you saying that, when one of the weights is equal to 1 we could make the fan (in a kind of canonical way) and create a toric variety from that, but that the general case is more messy? 

The attached patch constructs the fan using quotient lattices, so Sage chooses a basis for the lattice. I like the basis it picks except that (in the present context) one might prefer a different order of the basis vectors.

Replying to [comment:1 novoselt]:
> At least for spaces that have a variable of weight 1 there should be a conversion to current toric varieties (for general ones in quotient lattices current implementation may be less canonical).


---

Comment by novoselt created at 2012-06-07 08:55:52

Not all WPs are (singular) Fano and general toric varieties are handled by PPL so there are no dimension limits.

If one of the weights is one, e.g. WP(1,1,4,6), then one can take for the fan rays the standard basis plus "negative weights except for one 1", i.e. (-1,-4,-6).

In general you take the standard basis of dimension+1 and quotient by the weights. If this works - great, I just was not sure if there are still problems with fans in quotient lattices in Sage - there were some but we were gradually improving the situation.


---

Comment by novoselt created at 2012-06-07 11:10:49

A few more comments:
 * Please base the patch on top of #13023.
 * It would be nice to call `toric_varieties.WP(1,2,3)` without packing weights into a list or a tuple.
 * To be more in the spirit of other constructors, `names` keyword parameter should be recognized for coordinate names (and be handled in the same way as others).


---

Comment by davideklund created at 2012-06-13 16:23:10

Right now I apply coordinate_vector() to the images in the quotient of the basis in dimension +1. Then I make the fan from this data, so I guess the fan does not live in the quotient lattice but some other lattice of the same rank. This seems to work. Interesting if one can, as I gather from your reply, simply tell Sage to construct the fan (with these and these rays and cones) in the quotient lattice. If there were problems with this feature perhaps a good way of debugging is to use it, here for example.

Replying to [comment:5 novoselt]:
> Not all WPs are (singular) Fano and general toric varieties are handled by PPL so there are no dimension limits.
> 
> If one of the weights is one, e.g. WP(1,1,4,6), then one can take for the fan rays the standard basis plus "negative weights except for one 1", i.e. (-1,-4,-6).
> 
> In general you take the standard basis of dimension+1 and quotient by the weights. If this works - great, I just was not sure if there are still problems with fans in quotient lattices in Sage - there were some but we were gradually improving the situation.


---

Comment by davideklund created at 2012-06-13 16:24:40

Ok, thanks for pointing this out. I will make these changes.

Replying to [comment:6 novoselt]:
> A few more comments:
>  * Please base the patch on top of #13023.
>  * It would be nice to call `toric_varieties.WP(1,2,3)` without packing weights into a list or a tuple.
>  * To be more in the spirit of other constructors, `names` keyword parameter should be recognized for coordinate names (and be handled in the same way as others).


---

Comment by davideklund created at 2012-06-26 16:29:40

New patch attached. 

It is based on Sage 5.1.beta5 (so should be consistent with #13023).

The weights need no longer be packed into a tuple or list.

Added keyword 'names' for user defined coordinate names.


---

Comment by davideklund created at 2012-06-26 16:33:23

For the patchbot:

Apply trac_13089_weighted_proj_space.patch


---

Comment by novoselt created at 2012-07-14 16:16:40

As a side effect of #13183, the handling of quotients is improved and it may be possible to construct fans of WPs in quotient lattices directly.

I also think that the patchbot does not test tickets unless they are in `needs_review` status.


---

Comment by davideklund created at 2012-07-19 07:20:25

Replying to [comment:11 novoselt]:
> As a side effect of #13183, the handling of quotients is improved and it may be possible to construct fans of WPs in quotient lattices directly.
> 
> I also think that the patchbot does not test tickets unless they are in `needs_review` status.
Ok, cool. I will try to change the patch in the this ticket to take advantage of #13183.


---

Comment by davideklund created at 2012-07-23 16:49:36

It seems that quotient lattice are not quite ready for fans. For example, there seems to be a need for a length function for elements of quotients. I did not look at this very carefully though.

In either case, I think it would be good to get the weighted projective space code into the toric varieties library and then simplifications can be made later as functionality of lattice quotients is expanded.


---

Comment by davideklund created at 2012-07-23 16:51:41

Attached a new patch with minor changes and some comments in the code.


---

Comment by davideklund created at 2012-07-23 16:52:26

Changing priority from minor to major.


---

Comment by davideklund created at 2012-07-23 16:52:26

Changing status from new to needs_review.


---

Comment by novoselt created at 2012-07-23 17:37:55

Changing status from needs_review to needs_work.


---

Comment by novoselt created at 2012-07-23 17:37:55

Thanks for trying to use quotient lattices, I though I took care of length, but apparently not for all cases. Let's move on with WPs as is, just a couple little picks:

Instead of 

```
print "keyword argument %s (value %s) will be ignored" % (key,kw[key]) 
```

you should raise an exception, since ideally we want

```
def WP(self, *q, K=QQ, names="z+"): 
```

and it would. (Showing the traceback that lead to it instead of just the error.)

It is also deprecated in Python to use `raise Error, "message"`, rather it should be `raise Error("message")`.


---

Comment by davideklund created at 2012-07-24 13:27:06

Implements weighted projective spaces as toric varieties.


---

Attachment

Good points! I have made the suggested changes and replaced the patch.


---

Comment by davideklund created at 2012-07-24 13:30:35

Changing status from needs_work to needs_review.


---

Comment by novoselt created at 2012-07-24 17:12:37

Changing keywords from "" to "toric".


---

Comment by novoselt created at 2012-07-24 17:12:37

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2012-08-01 12:11:41

Resolution: fixed
