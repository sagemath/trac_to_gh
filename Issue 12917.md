# Issue 12917: Implement weighted projective spaces.

archive/issues_012917.json:
```json
{
    "body": "Assignee: @aghitza\n\nThis ticket aims at an implementation of weighted projective spaces in Sage. This was discussed on sage-devel here: https://groups.google.com/d/topic/sage-devel/rahI8ewn1_c/discussion. \n\nOne approach is to implement weighted projective spaces as toric varieties.\n\nIssue created by migration from https://trac.sagemath.org/ticket/13089\n\n",
    "created_at": "2012-06-06T01:07:40Z",
    "labels": [
        "component: algebraic geometry",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.3",
    "title": "Implement weighted projective spaces.",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12917",
    "user": "https://trac.sagemath.org/admin/accounts/users/davideklund"
}
```
Assignee: @aghitza

This ticket aims at an implementation of weighted projective spaces in Sage. This was discussed on sage-devel here: https://groups.google.com/d/topic/sage-devel/rahI8ewn1_c/discussion. 

One approach is to implement weighted projective spaces as toric varieties.

Issue created by migration from https://trac.sagemath.org/ticket/13089





---

archive/issue_comments_155322.json:
```json
{
    "body": "At least for spaces that have a variable of weight 1 there should be a conversion to current toric varieties (for general ones in quotient lattices current implementation may be less canonical).",
    "created_at": "2012-06-06T19:25:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12917#issuecomment-155322",
    "user": "https://github.com/novoselt"
}
```

At least for spaces that have a variable of weight 1 there should be a conversion to current toric varieties (for general ones in quotient lattices current implementation may be less canonical).



---

archive/issue_comments_155323.json:
```json
{
    "body": "The attached patch is intended as a starting point to be revised and expanded upon. \n\nIt might make sense to give weighted projective spaces a class of their own. \n\nAlso, it might be suitable to make them as CPR Fano toric varieties (I think they are all of this type). When making polytopes with LatticePolytope there seems to be a limit on the dimension (<=6)  and I think it might make sense to allow weighted projective spaces of bigger dimension than that.",
    "created_at": "2012-06-06T21:50:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12917#issuecomment-155323",
    "user": "https://trac.sagemath.org/admin/accounts/users/davideklund"
}
```

The attached patch is intended as a starting point to be revised and expanded upon. 

It might make sense to give weighted projective spaces a class of their own. 

Also, it might be suitable to make them as CPR Fano toric varieties (I think they are all of this type). When making polytopes with LatticePolytope there seems to be a limit on the dimension (<=6)  and I think it might make sense to allow weighted projective spaces of bigger dimension than that.



---

archive/issue_comments_155324.json:
```json
{
    "body": "I'm not sure what you mean. Are you saying that, when one of the weights is equal to 1 we could make the fan (in a kind of canonical way) and create a toric variety from that, but that the general case is more messy? \n\nThe attached patch constructs the fan using quotient lattices, so Sage chooses a basis for the lattice. I like the basis it picks except that (in the present context) one might prefer a different order of the basis vectors.\n\nReplying to [comment:1 novoselt]:\n> At least for spaces that have a variable of weight 1 there should be a conversion to current toric varieties (for general ones in quotient lattices current implementation may be less canonical).",
    "created_at": "2012-06-06T22:03:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12917#issuecomment-155324",
    "user": "https://trac.sagemath.org/admin/accounts/users/davideklund"
}
```

I'm not sure what you mean. Are you saying that, when one of the weights is equal to 1 we could make the fan (in a kind of canonical way) and create a toric variety from that, but that the general case is more messy? 

The attached patch constructs the fan using quotient lattices, so Sage chooses a basis for the lattice. I like the basis it picks except that (in the present context) one might prefer a different order of the basis vectors.

Replying to [comment:1 novoselt]:
> At least for spaces that have a variable of weight 1 there should be a conversion to current toric varieties (for general ones in quotient lattices current implementation may be less canonical).



---

archive/issue_comments_155325.json:
```json
{
    "body": "Not all WPs are (singular) Fano and general toric varieties are handled by PPL so there are no dimension limits.\n\nIf one of the weights is one, e.g. WP(1,1,4,6), then one can take for the fan rays the standard basis plus \"negative weights except for one 1\", i.e. (-1,-4,-6).\n\nIn general you take the standard basis of dimension+1 and quotient by the weights. If this works - great, I just was not sure if there are still problems with fans in quotient lattices in Sage - there were some but we were gradually improving the situation.",
    "created_at": "2012-06-07T08:55:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12917#issuecomment-155325",
    "user": "https://github.com/novoselt"
}
```

Not all WPs are (singular) Fano and general toric varieties are handled by PPL so there are no dimension limits.

If one of the weights is one, e.g. WP(1,1,4,6), then one can take for the fan rays the standard basis plus "negative weights except for one 1", i.e. (-1,-4,-6).

In general you take the standard basis of dimension+1 and quotient by the weights. If this works - great, I just was not sure if there are still problems with fans in quotient lattices in Sage - there were some but we were gradually improving the situation.



---

archive/issue_comments_155326.json:
```json
{
    "body": "A few more comments:\n* Please base the patch on top of #13023.\n* It would be nice to call `toric_varieties.WP(1,2,3)` without packing weights into a list or a tuple.\n* To be more in the spirit of other constructors, `names` keyword parameter should be recognized for coordinate names (and be handled in the same way as others).",
    "created_at": "2012-06-07T11:10:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12917#issuecomment-155326",
    "user": "https://github.com/novoselt"
}
```

A few more comments:
* Please base the patch on top of #13023.
* It would be nice to call `toric_varieties.WP(1,2,3)` without packing weights into a list or a tuple.
* To be more in the spirit of other constructors, `names` keyword parameter should be recognized for coordinate names (and be handled in the same way as others).



---

archive/issue_comments_155327.json:
```json
{
    "body": "Right now I apply coordinate_vector() to the images in the quotient of the basis in dimension +1. Then I make the fan from this data, so I guess the fan does not live in the quotient lattice but some other lattice of the same rank. This seems to work. Interesting if one can, as I gather from your reply, simply tell Sage to construct the fan (with these and these rays and cones) in the quotient lattice. If there were problems with this feature perhaps a good way of debugging is to use it, here for example.\n\nReplying to [comment:5 novoselt]:\n> Not all WPs are (singular) Fano and general toric varieties are handled by PPL so there are no dimension limits.\n> \n> If one of the weights is one, e.g. WP(1,1,4,6), then one can take for the fan rays the standard basis plus \"negative weights except for one 1\", i.e. (-1,-4,-6).\n> \n> In general you take the standard basis of dimension+1 and quotient by the weights. If this works - great, I just was not sure if there are still problems with fans in quotient lattices in Sage - there were some but we were gradually improving the situation.",
    "created_at": "2012-06-13T16:23:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12917#issuecomment-155327",
    "user": "https://trac.sagemath.org/admin/accounts/users/davideklund"
}
```

Right now I apply coordinate_vector() to the images in the quotient of the basis in dimension +1. Then I make the fan from this data, so I guess the fan does not live in the quotient lattice but some other lattice of the same rank. This seems to work. Interesting if one can, as I gather from your reply, simply tell Sage to construct the fan (with these and these rays and cones) in the quotient lattice. If there were problems with this feature perhaps a good way of debugging is to use it, here for example.

Replying to [comment:5 novoselt]:
> Not all WPs are (singular) Fano and general toric varieties are handled by PPL so there are no dimension limits.
> 
> If one of the weights is one, e.g. WP(1,1,4,6), then one can take for the fan rays the standard basis plus "negative weights except for one 1", i.e. (-1,-4,-6).
> 
> In general you take the standard basis of dimension+1 and quotient by the weights. If this works - great, I just was not sure if there are still problems with fans in quotient lattices in Sage - there were some but we were gradually improving the situation.



---

archive/issue_comments_155328.json:
```json
{
    "body": "Ok, thanks for pointing this out. I will make these changes.\n\nReplying to [comment:6 novoselt]:\n> A few more comments:\n>  * Please base the patch on top of #13023.\n>  * It would be nice to call `toric_varieties.WP(1,2,3)` without packing weights into a list or a tuple.\n>  * To be more in the spirit of other constructors, `names` keyword parameter should be recognized for coordinate names (and be handled in the same way as others).",
    "created_at": "2012-06-13T16:24:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12917#issuecomment-155328",
    "user": "https://trac.sagemath.org/admin/accounts/users/davideklund"
}
```

Ok, thanks for pointing this out. I will make these changes.

Replying to [comment:6 novoselt]:
> A few more comments:
>  * Please base the patch on top of #13023.
>  * It would be nice to call `toric_varieties.WP(1,2,3)` without packing weights into a list or a tuple.
>  * To be more in the spirit of other constructors, `names` keyword parameter should be recognized for coordinate names (and be handled in the same way as others).



---

archive/issue_comments_155329.json:
```json
{
    "body": "New patch attached. \n\nIt is based on Sage 5.1.beta5 (so should be consistent with #13023).\n\nThe weights need no longer be packed into a tuple or list.\n\nAdded keyword 'names' for user defined coordinate names.",
    "created_at": "2012-06-26T16:29:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12917#issuecomment-155329",
    "user": "https://trac.sagemath.org/admin/accounts/users/davideklund"
}
```

New patch attached. 

It is based on Sage 5.1.beta5 (so should be consistent with #13023).

The weights need no longer be packed into a tuple or list.

Added keyword 'names' for user defined coordinate names.



---

archive/issue_comments_155330.json:
```json
{
    "body": "For the patchbot:\n\nApply trac_13089_weighted_proj_space.patch",
    "created_at": "2012-06-26T16:33:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12917#issuecomment-155330",
    "user": "https://trac.sagemath.org/admin/accounts/users/davideklund"
}
```

For the patchbot:

Apply trac_13089_weighted_proj_space.patch



---

archive/issue_comments_155331.json:
```json
{
    "body": "As a side effect of #13183, the handling of quotients is improved and it may be possible to construct fans of WPs in quotient lattices directly.\n\nI also think that the patchbot does not test tickets unless they are in `needs_review` status.",
    "created_at": "2012-07-14T16:16:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12917#issuecomment-155331",
    "user": "https://github.com/novoselt"
}
```

As a side effect of #13183, the handling of quotients is improved and it may be possible to construct fans of WPs in quotient lattices directly.

I also think that the patchbot does not test tickets unless they are in `needs_review` status.



---

archive/issue_comments_155332.json:
```json
{
    "body": "Replying to [comment:11 novoselt]:\n> As a side effect of #13183, the handling of quotients is improved and it may be possible to construct fans of WPs in quotient lattices directly.\n> \n> I also think that the patchbot does not test tickets unless they are in `needs_review` status.\nOk, cool. I will try to change the patch in the this ticket to take advantage of #13183.",
    "created_at": "2012-07-19T07:20:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12917#issuecomment-155332",
    "user": "https://trac.sagemath.org/admin/accounts/users/davideklund"
}
```

Replying to [comment:11 novoselt]:
> As a side effect of #13183, the handling of quotients is improved and it may be possible to construct fans of WPs in quotient lattices directly.
> 
> I also think that the patchbot does not test tickets unless they are in `needs_review` status.
Ok, cool. I will try to change the patch in the this ticket to take advantage of #13183.



---

archive/issue_comments_155333.json:
```json
{
    "body": "It seems that quotient lattice are not quite ready for fans. For example, there seems to be a need for a length function for elements of quotients. I did not look at this very carefully though.\n\nIn either case, I think it would be good to get the weighted projective space code into the toric varieties library and then simplifications can be made later as functionality of lattice quotients is expanded.",
    "created_at": "2012-07-23T16:49:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12917#issuecomment-155333",
    "user": "https://trac.sagemath.org/admin/accounts/users/davideklund"
}
```

It seems that quotient lattice are not quite ready for fans. For example, there seems to be a need for a length function for elements of quotients. I did not look at this very carefully though.

In either case, I think it would be good to get the weighted projective space code into the toric varieties library and then simplifications can be made later as functionality of lattice quotients is expanded.



---

archive/issue_comments_155334.json:
```json
{
    "body": "Attached a new patch with minor changes and some comments in the code.",
    "created_at": "2012-07-23T16:51:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12917#issuecomment-155334",
    "user": "https://trac.sagemath.org/admin/accounts/users/davideklund"
}
```

Attached a new patch with minor changes and some comments in the code.



---

archive/issue_comments_155335.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-07-23T16:52:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12917#issuecomment-155335",
    "user": "https://trac.sagemath.org/admin/accounts/users/davideklund"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_155336.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-07-23T17:37:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12917#issuecomment-155336",
    "user": "https://github.com/novoselt"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_155337.json:
```json
{
    "body": "Thanks for trying to use quotient lattices, I though I took care of length, but apparently not for all cases. Let's move on with WPs as is, just a couple little picks:\n\nInstead of \n\n```\nprint \"keyword argument %s (value %s) will be ignored\" % (key,kw[key]) \n```\n\nyou should raise an exception, since ideally we want\n\n```\ndef WP(self, *q, K=QQ, names=\"z+\"): \n```\n\nand it would. (Showing the traceback that lead to it instead of just the error.)\n\nIt is also deprecated in Python to use `raise Error, \"message\"`, rather it should be `raise Error(\"message\")`.",
    "created_at": "2012-07-23T17:37:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12917#issuecomment-155337",
    "user": "https://github.com/novoselt"
}
```

Thanks for trying to use quotient lattices, I though I took care of length, but apparently not for all cases. Let's move on with WPs as is, just a couple little picks:

Instead of 

```
print "keyword argument %s (value %s) will be ignored" % (key,kw[key]) 
```

you should raise an exception, since ideally we want

```
def WP(self, *q, K=QQ, names="z+"): 
```

and it would. (Showing the traceback that lead to it instead of just the error.)

It is also deprecated in Python to use `raise Error, "message"`, rather it should be `raise Error("message")`.



---

archive/issue_comments_155338.json:
```json
{
    "body": "Implements weighted projective spaces as toric varieties.",
    "created_at": "2012-07-24T13:27:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12917#issuecomment-155338",
    "user": "https://trac.sagemath.org/admin/accounts/users/davideklund"
}
```

Implements weighted projective spaces as toric varieties.



---

archive/issue_comments_155339.json:
```json
{
    "body": "Attachment [trac_13089_weighted_proj_space.patch](tarball://root/attachments/some-uuid/ticket13089/trac_13089_weighted_proj_space.patch) by davideklund created at 2012-07-24 13:28:52\n\nGood points! I have made the suggested changes and replaced the patch.",
    "created_at": "2012-07-24T13:28:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12917#issuecomment-155339",
    "user": "https://trac.sagemath.org/admin/accounts/users/davideklund"
}
```

Attachment [trac_13089_weighted_proj_space.patch](tarball://root/attachments/some-uuid/ticket13089/trac_13089_weighted_proj_space.patch) by davideklund created at 2012-07-24 13:28:52

Good points! I have made the suggested changes and replaced the patch.



---

archive/issue_comments_155340.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-07-24T13:30:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12917#issuecomment-155340",
    "user": "https://trac.sagemath.org/admin/accounts/users/davideklund"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_155341.json:
```json
{
    "body": "Changing keywords from \"\" to \"toric\".",
    "created_at": "2012-07-24T17:12:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12917#issuecomment-155341",
    "user": "https://github.com/novoselt"
}
```

Changing keywords from "" to "toric".



---

archive/issue_comments_155342.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-07-24T17:12:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12917#issuecomment-155342",
    "user": "https://github.com/novoselt"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_012864.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-08-01T12:11:41Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/12917",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12917#event-12864"
}
```



---

archive/issue_comments_155343.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-08-01T12:11:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12917#issuecomment-155343",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed
