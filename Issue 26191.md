# Issue 26191: improve is_weakly_chordal

archive/issues_026191.json:
```json
{
    "body": "This ticket do:\n- Remove recursion in methods `is_long_hole_free` and `is_long_antihole_free`\n- Avoid modifying the input graph (this is very bad)\n- Cythonize parts of the code\n\nIssue created by migration from https://trac.sagemath.org/ticket/26428\n\n",
    "created_at": "2018-10-07T15:15:04Z",
    "labels": [
        "component: graph theory"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.5",
    "title": "improve is_weakly_chordal",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/26191",
    "user": "https://github.com/dcoudert"
}
```
This ticket do:
- Remove recursion in methods `is_long_hole_free` and `is_long_antihole_free`
- Avoid modifying the input graph (this is very bad)
- Cythonize parts of the code

Issue created by migration from https://trac.sagemath.org/ticket/26428





---

archive/issue_comments_368623.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-10-07T15:17:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26191#issuecomment-368623",
    "user": "https://github.com/dcoudert"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_368624.json:
```json
{
    "body": "New commits:",
    "created_at": "2018-10-07T15:17:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26191#issuecomment-368624",
    "user": "https://github.com/dcoudert"
}
```

New commits:



---

archive/issue_comments_368625.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-10-07T15:20:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26191#issuecomment-368625",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_368626.json:
```json
{
    "body": "I think you should move `process` out as a separate `cdef inline` function and pass the data you need. It is likely equivalent to a Python function call, and since it is in the heart of the algorithm, it should be made to be called quickly (the inline hopefully will make it avoid the function call altogether).\n\nI was going to say the same thing for the `dist`, but since that is processing on the way out, it is only done once and should not contribute much time.\n\nA few quick notes on style. For pointers, the `*` is better next to the type, e.g., `int*` as it makes it look less like multiplication. Also `lambda X : foo` -> `lambda X: foo`.\n\nOtherwise LGTM. Have you run some timings?",
    "created_at": "2018-10-07T22:46:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26191#issuecomment-368626",
    "user": "https://github.com/tscrim"
}
```

I think you should move `process` out as a separate `cdef inline` function and pass the data you need. It is likely equivalent to a Python function call, and since it is in the heart of the algorithm, it should be made to be called quickly (the inline hopefully will make it avoid the function call altogether).

I was going to say the same thing for the `dist`, but since that is processing on the way out, it is only done once and should not contribute much time.

A few quick notes on style. For pointers, the `*` is better next to the type, e.g., `int*` as it makes it look less like multiplication. Also `lambda X : foo` -> `lambda X: foo`.

Otherwise LGTM. Have you run some timings?



---

archive/issue_comments_368627.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-10-08T13:25:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26191#issuecomment-368627",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_368628.json:
```json
{
    "body": "I have cdef the methods `process` and perform other suggestions.\n\nI have not done clear timings. It is now faster on large cliques for instance, but very similar for graphs like the Petersen graph. My main motivation was not timing but 1) no sorting on original vertex labels, 2) no modification of the input graph (very bad), and 3) avoid recursive calls.\n\nI also tried to use the `has_edge` method of `short_digraph` to avoid copying the graph in a `n^2` length bitset (`dense_graph`), but it was slightly slower. This is certainly something to consider if we have very large sparse graphs (i.e., when memory matters).",
    "created_at": "2018-10-08T13:33:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26191#issuecomment-368628",
    "user": "https://github.com/dcoudert"
}
```

I have cdef the methods `process` and perform other suggestions.

I have not done clear timings. It is now faster on large cliques for instance, but very similar for graphs like the Petersen graph. My main motivation was not timing but 1) no sorting on original vertex labels, 2) no modification of the input graph (very bad), and 3) avoid recursive calls.

I also tried to use the `has_edge` method of `short_digraph` to avoid copying the graph in a `n^2` length bitset (`dense_graph`), but it was slightly slower. This is certainly something to consider if we have very large sparse graphs (i.e., when memory matters).



---

archive/issue_comments_368629.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-10-08T22:44:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26191#issuecomment-368629",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_368630.json:
```json
{
    "body": "Replying to [comment:5 dcoudert]:\n> I have cdef the methods `process` and perform other suggestions.\n\nThank you for doing that. I didn't realize `process` needed so many of the local variables.\n\n> I have not done clear timings. It is now faster on large cliques for instance, but very similar for graphs like the Petersen graph. My main motivation was not timing but 1) no sorting on original vertex labels, 2) no modification of the input graph (very bad), and 3) avoid recursive calls.\n\nSpeed gains is a consequence of all of those things. <sup>_</sup>\n\n> I also tried to use the `has_edge` method of `short_digraph` to avoid copying the graph in a `n^2` length bitset (`dense_graph`), but it was slightly slower. This is certainly something to consider if we have very large sparse graphs (i.e., when memory matters).\n\nIt is good to care about these things as well. Sometimes we do have to sacrifice speed so that sparse graphs will work well too. We can also potentially try to do things differently for each those cases, but I think what you have done here is more than enough.",
    "created_at": "2018-10-08T22:44:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26191#issuecomment-368630",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:5 dcoudert]:
> I have cdef the methods `process` and perform other suggestions.

Thank you for doing that. I didn't realize `process` needed so many of the local variables.

> I have not done clear timings. It is now faster on large cliques for instance, but very similar for graphs like the Petersen graph. My main motivation was not timing but 1) no sorting on original vertex labels, 2) no modification of the input graph (very bad), and 3) avoid recursive calls.

Speed gains is a consequence of all of those things. <sup>_</sup>

> I also tried to use the `has_edge` method of `short_digraph` to avoid copying the graph in a `n^2` length bitset (`dense_graph`), but it was slightly slower. This is certainly something to consider if we have very large sparse graphs (i.e., when memory matters).

It is good to care about these things as well. Sometimes we do have to sacrifice speed so that sparse graphs will work well too. We can also potentially try to do things differently for each those cases, but I think what you have done here is more than enough.



---

archive/issue_comments_368631.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-10-20T11:58:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26191#issuecomment-368631",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_065700.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-10-20T11:58:19Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/26191",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26191#event-65700"
}
```



---

archive/issue_events_065701.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-10-28T14:52:23Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26191",
    "milestone": "sage-8.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26191#event-65701"
}
```



---

archive/issue_comments_368632.json:
```json
{
    "body": "This should be re-targeted for 8.5.",
    "created_at": "2018-10-28T14:52:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26191#issuecomment-368632",
    "user": "https://github.com/embray"
}
```

This should be re-targeted for 8.5.
