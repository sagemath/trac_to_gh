# Issue 26191: improve is_weakly_chordal

Issue created by migration from https://trac.sagemath.org/ticket/26428

Original creator: dcoudert

Original creation time: 2018-10-07 15:15:04

This ticket do:
- Remove recursion in methods `is_long_hole_free` and `is_long_antihole_free`
- Avoid modifying the input graph (this is very bad)
- Cythonize parts of the code


---

Comment by dcoudert created at 2018-10-07 15:17:34

Changing status from new to needs_review.


---

Comment by dcoudert created at 2018-10-07 15:17:34

New commits:


---

Comment by git created at 2018-10-07 15:20:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2018-10-07 22:46:27

I think you should move `process` out as a separate `cdef inline` function and pass the data you need. It is likely equivalent to a Python function call, and since it is in the heart of the algorithm, it should be made to be called quickly (the inline hopefully will make it avoid the function call altogether).

I was going to say the same thing for the `dist`, but since that is processing on the way out, it is only done once and should not contribute much time.

A few quick notes on style. For pointers, the `*` is better next to the type, e.g., `int*` as it makes it look less like multiplication. Also `lambda X : foo` -> `lambda X: foo`.

Otherwise LGTM. Have you run some timings?


---

Comment by git created at 2018-10-08 13:25:55

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2018-10-08 13:33:14

I have cdef the methods `process` and perform other suggestions.

I have not done clear timings. It is now faster on large cliques for instance, but very similar for graphs like the Petersen graph. My main motivation was not timing but 1) no sorting on original vertex labels, 2) no modification of the input graph (very bad), and 3) avoid recursive calls.

I also tried to use the `has_edge` method of `short_digraph` to avoid copying the graph in a `n^2` length bitset (`dense_graph`), but it was slightly slower. This is certainly something to consider if we have very large sparse graphs (i.e., when memory matters).


---

Comment by tscrim created at 2018-10-08 22:44:52

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2018-10-08 22:44:52

Replying to [comment:5 dcoudert]:
> I have cdef the methods `process` and perform other suggestions.

Thank you for doing that. I didn't realize `process` needed so many of the local variables.

> I have not done clear timings. It is now faster on large cliques for instance, but very similar for graphs like the Petersen graph. My main motivation was not timing but 1) no sorting on original vertex labels, 2) no modification of the input graph (very bad), and 3) avoid recursive calls.

Speed gains is a consequence of all of those things. <sup>_</sup>

> I also tried to use the `has_edge` method of `short_digraph` to avoid copying the graph in a `n^2` length bitset (`dense_graph`), but it was slightly slower. This is certainly something to consider if we have very large sparse graphs (i.e., when memory matters).

It is good to care about these things as well. Sometimes we do have to sacrifice speed so that sparse graphs will work well too. We can also potentially try to do things differently for each those cases, but I think what you have done here is more than enough.


---

Comment by vbraun created at 2018-10-20 11:58:19

Resolution: fixed


---

Comment by embray created at 2018-10-28 14:52:23

This should be re-targeted for 8.5.
