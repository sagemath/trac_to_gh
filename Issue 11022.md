# Issue 11022: Missing parentheses when typesetting coefficients of multivariate polynomials over number fields

Issue created by migration from https://trac.sagemath.org/ticket/11186

Original creator: jsrn

Original creation time: 2011-04-13 08:58:36

Assignee: was

Keywords: latex, multivariate polynomials, singular

Notice the missing parenthesis when attempting to typeset a simple multivariate polynomial:


```
sage: K.<z> = QQ.extension(x^2 + x + 1)
sage: PK.<v,w> = K[]
sage: (z+1)*v
(z + 1)*v
sage: latex((z+1)*v)
z + 1 v
```


This, of course, means that typesetting in the Notebook will also be wrong.

The error seems not to happen with univariate polynomials. 


---

Comment by jsrn created at 2011-04-13 09:31:15

I wrote a simple patch to fix the issue and added a doctest for it.

However, sage.libs.singular.polynomial._latex_ (used for typesetting Singular polynomials) is still very different from -- and seemingly more simple -- than the generic sage.rings.polynomial.polynomial_element._latex_; this is perhaps a bit disconcerting and should be looked?


---

Comment by jsrn created at 2011-04-13 09:31:15

Changing status from new to needs_review.


---

Attachment

Patches sage.libs.singular.polynomial.pyx


---

Comment by jsrn created at 2011-04-13 14:31:51

Slightly improved my patch as I discovered that negative coefficients we typeset with a parenthesis. My fix simplifies some existing code as well.

I discovered simultaneously that in univariate polynomials, certain coefficients will get parentheses around them, even when not needed, such as sqrt{-1} (because it contains a '-' even though it's inside the squareroot). As I copied some code from there, multivariate polynomials now also have this behaviour. This broke a doctests, which I changed.

This is not optimal behaviour, but I didn't want to patch univariate polynomials here (the patch might not be simple either -- parsing TeX, eew). Also, I "introduced" the error in multivariate polynomials to this for two reasons: first of all, without a solution to this sqrt-problem, it's a side-effect of "doing the right thing most of the time"; namely in cases such as the one in the ticket description. And this error is worse than a superfluous parenthesis once in a while. Thirdly, I think that it's nice, if all polynomials render more or less the same way.


---

Comment by mariah created at 2011-06-07 19:59:17

Changing status from needs_review to positive_review.


---

Comment by mariah created at 2011-06-07 19:59:17

The patch fixes the reported problem.  Ran 'make testlong' and all tests passed.  Positive review!


---

Comment by jdemeyer created at 2011-06-15 20:14:24

Resolution: fixed
