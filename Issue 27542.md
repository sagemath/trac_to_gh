# Issue 27542: Py3: Fix dynamics.arithmetic_dynamics for python3

archive/issues_027542.json:
```json
{
    "body": "CC:  @bhutz\n\nFix dynamics.arithmetic_dynamics for python3.\nOne failling doctest remains.\n\nIssue created by migration from https://trac.sagemath.org/ticket/27779\n\n",
    "created_at": "2019-05-06T09:46:10Z",
    "labels": [
        "component: python3"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.8",
    "title": "Py3: Fix dynamics.arithmetic_dynamics for python3",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27542",
    "user": "https://github.com/vinklein"
}
```
CC:  @bhutz

Fix dynamics.arithmetic_dynamics for python3.
One failling doctest remains.

Issue created by migration from https://trac.sagemath.org/ticket/27779





---

archive/issue_comments_388158.json:
```json
{
    "body": "New commits:",
    "created_at": "2019-05-06T11:59:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27542",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27542#issuecomment-388158",
    "user": "https://github.com/vinklein"
}
```

New commits:



---

archive/issue_comments_388159.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-05-06T11:59:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27542",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27542#issuecomment-388159",
    "user": "https://github.com/vinklein"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_388160.json:
```json
{
    "body": "some of the new lines must be tagged `# long time` too, as they depend on #long results\n\n```\n+            sage: lst, label = f.automorphism_group(return_functions=True, iso_type=True) # long time\n+            sage: sorted(lst, key=str), label\n```\n",
    "created_at": "2019-05-07T05:50:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27542",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27542#issuecomment-388160",
    "user": "https://github.com/fchapoton"
}
```

some of the new lines must be tagged `# long time` too, as they depend on #long results

```
+            sage: lst, label = f.automorphism_group(return_functions=True, iso_type=True) # long time
+            sage: sorted(lst, key=str), label
```




---

archive/issue_comments_388161.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-05-07T06:53:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27542",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27542#issuecomment-388161",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_388162.json:
```json
{
    "body": "Thanks ! Missing tag added.",
    "created_at": "2019-05-07T06:54:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27542",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27542#issuecomment-388162",
    "user": "https://github.com/vinklein"
}
```

Thanks ! Missing tag added.



---

archive/issue_comments_388163.json:
```json
{
    "body": "maybe add `# abs tol 1e-11` to the last failing doctest ?",
    "created_at": "2019-05-07T08:52:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27542",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27542#issuecomment-388163",
    "user": "https://github.com/fchapoton"
}
```

maybe add `# abs tol 1e-11` to the last failing doctest ?



---

archive/issue_comments_388164.json:
```json
{
    "body": "It works. You mean values `(x^4 - 2.86348722511320e-12*y^4 : 1.41421356237310*y^4)` and `(x^4 + 7.74491581978509e-13*y^4 : 1.41421356237310*y^4)` are both valid results for this doctest ?",
    "created_at": "2019-05-07T09:03:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27542",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27542#issuecomment-388164",
    "user": "https://github.com/vinklein"
}
```

It works. You mean values `(x^4 - 2.86348722511320e-12*y^4 : 1.41421356237310*y^4)` and `(x^4 + 7.74491581978509e-13*y^4 : 1.41421356237310*y^4)` are both valid results for this doctest ?



---

archive/issue_comments_388165.json:
```json
{
    "body": "I thought so, but maybe this is not so clear. We should cc the authors of that piece of code.",
    "created_at": "2019-05-07T09:04:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27542",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27542#issuecomment-388165",
    "user": "https://github.com/fchapoton"
}
```

I thought so, but maybe this is not so clear. We should cc the authors of that piece of code.



---

archive/issue_comments_388166.json:
```json
{
    "body": "Git blame says it's from Ben Hutz but he is not listed in sage account list.",
    "created_at": "2019-05-07T09:11:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27542",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27542#issuecomment-388166",
    "user": "https://github.com/vinklein"
}
```

Git blame says it's from Ben Hutz but he is not listed in sage account list.



---

archive/issue_comments_388167.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-05-07T09:12:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27542",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27542#issuecomment-388167",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_388168.json:
```json
{
    "body": "Perhaps a cleaner fix here would be to change the doctest to\n\n\n```\ng,m = f.reduced_form(smallest_coeffs=False); m\n```\n\n\nThe matrix is it producing for the conjugation is always an integer matrix, but just working over RR to conjugate and then conjugate by the inverse is introducing numerical error, so the resulting function is not an exact match of the original. So, the error that is cropping up in the doctest actually has nothing to do with the functionality of .reduced_form(), rather it is just a consequence of conjugating over a numerical field.\n\nYou should probably do the same thing for the doctest immediately following as I would have expected the same kind of issue over CC.",
    "created_at": "2019-05-07T10:23:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27542",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27542#issuecomment-388168",
    "user": "https://github.com/bhutz"
}
```

Perhaps a cleaner fix here would be to change the doctest to


```
g,m = f.reduced_form(smallest_coeffs=False); m
```


The matrix is it producing for the conjugation is always an integer matrix, but just working over RR to conjugate and then conjugate by the inverse is introducing numerical error, so the resulting function is not an exact match of the original. So, the error that is cropping up in the doctest actually has nothing to do with the functionality of .reduced_form(), rather it is just a consequence of conjugating over a numerical field.

You should probably do the same thing for the doctest immediately following as I would have expected the same kind of issue over CC.



---

archive/issue_comments_388169.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-05-07T11:58:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27542",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27542#issuecomment-388169",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_388170.json:
```json
{
    "body": "Ok it's done.\\\\\nThank you for your help Ben.",
    "created_at": "2019-05-07T11:59:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27542",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27542#issuecomment-388170",
    "user": "https://github.com/vinklein"
}
```

Ok it's done.\\
Thank you for your help Ben.



---

archive/issue_comments_388171.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-05-08T06:03:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27542",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27542#issuecomment-388171",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_388172.json:
```json
{
    "body": "\u00c7a me parait correct.",
    "created_at": "2019-05-08T06:03:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27542",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27542#issuecomment-388172",
    "user": "https://github.com/fchapoton"
}
```

Ã‡a me parait correct.



---

archive/issue_comments_388173.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-05-12T21:30:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27542",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27542#issuecomment-388173",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
