# Issue 33977: Faster version of longest_increasing_subsequence_length

Issue created by migration from https://trac.sagemath.org/ticket/34214

Original creator: dcoudert

Original creation time: 2022-07-23 10:55:26

CC:  vdelecroix nadialafreniere

Keywords: permutation, subsequences

Before

```
sage: set_random_seed(0)
sage: P = Permutations(30)
sage: L = [P.random_element() for _ in range(1000)]
sage: %timeit [e.longest_increasing_subsequence_length() for e in L]
24.9 ms ± 953 µs per loop (mean ± std. dev. of 7 runs, 10 loops each)
```

After

```
sage: %timeit [longest_increasing_subsequence_length_v2(e) for e in L]
5.94 ms ± 133 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)
```



---

Comment by dcoudert created at 2022-07-23 10:56:55

Changing status from new to needs_review.


---

Comment by dcoudert created at 2022-07-23 10:56:55

New commits:


---

Comment by git created at 2022-07-23 10:58:10

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2022-07-23 11:00:41

Roughly, we replace the calls to `max`, `min` and `index` by a single call to `bisect`. The time complexity of the method is now `O(n log(n))`.


---

Comment by dcoudert created at 2022-07-23 14:33:16

Green bot.


---

Comment by vdelecroix created at 2022-07-24 13:14:36

Changing status from needs_review to positive_review.


---

Comment by vdelecroix created at 2022-07-24 13:14:36

This is indeed cleaner.

The algorithm is clever. Do you know if it possible to generate such subsequence in `O(n log n)` ? In the data generated by the algo, only `r[-1]` is guaranteed to be the last element of a longest increasing subsequence.


---

Comment by vdelecroix created at 2022-07-24 13:18:11

Apparently yes : https://en.wikipedia.org/wiki/Longest_increasing_subsequence


---

Comment by dcoudert created at 2022-07-24 13:23:31

Indeed for a single sequence. Not sure how to extend to find all longest sequences.


---

Comment by vdelecroix created at 2022-07-25 07:12:56

Replying to [comment:7 dcoudert]:
> Indeed for a single sequence. Not sure how to extend to find all longest sequences.

There could be exponentially many longest sequences. Pick `p = [2,1,4,3,6,5,...,2n,2n-1]`. Then there are `2^n` longest increasing sequences (they are of length `n`). Note that building the automaton that stores them all is what Nadia proposed in #31451. Not sure about complexity, but it is for sure polynomial.

It would be interesting to implement something fast to count the number of such sequence. This could be obtained for example from #31451 as the coefficient `(0,n+1)` of the `n+1`-th power of the adjacency matrix of `D`.


---

Comment by vbraun created at 2022-08-01 20:22:52

Resolution: fixed
