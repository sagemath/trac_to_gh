# Issue 33977: Faster version of longest_increasing_subsequence_length

archive/issues_033977.json:
```json
{
    "body": "CC:  vdelecroix nadialafreniere\n\nKeywords: permutation, subsequences\n\nBefore\n\n```\nsage: set_random_seed(0)\nsage: P = Permutations(30)\nsage: L = [P.random_element() for _ in range(1000)]\nsage: %timeit [e.longest_increasing_subsequence_length() for e in L]\n24.9 ms \u00b1 953 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 10 loops each)\n```\n\nAfter\n\n```\nsage: %timeit [longest_increasing_subsequence_length_v2(e) for e in L]\n5.94 ms \u00b1 133 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 100 loops each)\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/34214\n\n",
    "created_at": "2022-07-23T10:55:26Z",
    "labels": [
        "combinatorics",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.7",
    "title": "Faster version of longest_increasing_subsequence_length",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33977",
    "user": "dcoudert"
}
```
CC:  vdelecroix nadialafreniere

Keywords: permutation, subsequences

Before

```
sage: set_random_seed(0)
sage: P = Permutations(30)
sage: L = [P.random_element() for _ in range(1000)]
sage: %timeit [e.longest_increasing_subsequence_length() for e in L]
24.9 ms ± 953 µs per loop (mean ± std. dev. of 7 runs, 10 loops each)
```

After

```
sage: %timeit [longest_increasing_subsequence_length_v2(e) for e in L]
5.94 ms ± 133 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)
```


Issue created by migration from https://trac.sagemath.org/ticket/34214





---

archive/issue_comments_482441.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-07-23T10:56:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33977#issuecomment-482441",
    "user": "dcoudert"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_482442.json:
```json
{
    "body": "New commits:",
    "created_at": "2022-07-23T10:56:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33977#issuecomment-482442",
    "user": "dcoudert"
}
```

New commits:



---

archive/issue_comments_482443.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-07-23T10:58:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33977#issuecomment-482443",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_482444.json:
```json
{
    "body": "Roughly, we replace the calls to `max`, `min` and `index` by a single call to `bisect`. The time complexity of the method is now `O(n log(n))`.",
    "created_at": "2022-07-23T11:00:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33977#issuecomment-482444",
    "user": "dcoudert"
}
```

Roughly, we replace the calls to `max`, `min` and `index` by a single call to `bisect`. The time complexity of the method is now `O(n log(n))`.



---

archive/issue_comments_482445.json:
```json
{
    "body": "Green bot.",
    "created_at": "2022-07-23T14:33:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33977#issuecomment-482445",
    "user": "dcoudert"
}
```

Green bot.



---

archive/issue_comments_482446.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-07-24T13:14:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33977#issuecomment-482446",
    "user": "vdelecroix"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_482447.json:
```json
{
    "body": "This is indeed cleaner.\n\nThe algorithm is clever. Do you know if it possible to generate such subsequence in `O(n log n)` ? In the data generated by the algo, only `r[-1]` is guaranteed to be the last element of a longest increasing subsequence.",
    "created_at": "2022-07-24T13:14:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33977#issuecomment-482447",
    "user": "vdelecroix"
}
```

This is indeed cleaner.

The algorithm is clever. Do you know if it possible to generate such subsequence in `O(n log n)` ? In the data generated by the algo, only `r[-1]` is guaranteed to be the last element of a longest increasing subsequence.



---

archive/issue_comments_482448.json:
```json
{
    "body": "Apparently yes : https://en.wikipedia.org/wiki/Longest_increasing_subsequence",
    "created_at": "2022-07-24T13:18:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33977#issuecomment-482448",
    "user": "vdelecroix"
}
```

Apparently yes : https://en.wikipedia.org/wiki/Longest_increasing_subsequence



---

archive/issue_comments_482449.json:
```json
{
    "body": "Indeed for a single sequence. Not sure how to extend to find all longest sequences.",
    "created_at": "2022-07-24T13:23:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33977#issuecomment-482449",
    "user": "dcoudert"
}
```

Indeed for a single sequence. Not sure how to extend to find all longest sequences.



---

archive/issue_comments_482450.json:
```json
{
    "body": "Replying to [comment:7 dcoudert]:\n> Indeed for a single sequence. Not sure how to extend to find all longest sequences.\n\nThere could be exponentially many longest sequences. Pick `p = [2,1,4,3,6,5,...,2n,2n-1]`. Then there are `2^n` longest increasing sequences (they are of length `n`). Note that building the automaton that stores them all is what Nadia proposed in #31451. Not sure about complexity, but it is for sure polynomial.\n\nIt would be interesting to implement something fast to count the number of such sequence. This could be obtained for example from #31451 as the coefficient `(0,n+1)` of the `n+1`-th power of the adjacency matrix of `D`.",
    "created_at": "2022-07-25T07:12:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33977#issuecomment-482450",
    "user": "vdelecroix"
}
```

Replying to [comment:7 dcoudert]:
> Indeed for a single sequence. Not sure how to extend to find all longest sequences.

There could be exponentially many longest sequences. Pick `p = [2,1,4,3,6,5,...,2n,2n-1]`. Then there are `2^n` longest increasing sequences (they are of length `n`). Note that building the automaton that stores them all is what Nadia proposed in #31451. Not sure about complexity, but it is for sure polynomial.

It would be interesting to implement something fast to count the number of such sequence. This could be obtained for example from #31451 as the coefficient `(0,n+1)` of the `n+1`-th power of the adjacency matrix of `D`.



---

archive/issue_comments_482451.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-08-01T20:22:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33977#issuecomment-482451",
    "user": "vbraun"
}
```

Resolution: fixed
