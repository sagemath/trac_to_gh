# Issue 15243: Words.__eq__ returns wrong answers

archive/issues_015243.json:
```json
{
    "body": "CC:  @seblabbe @videlec sage-combinat @saliola\n\nRight now equality between sets of words only compare the alphabets\n\n\n```\nsage: Words(3, 10) == Words(3,900)\nTrue\nsage: Words(2, finite=False) == Words(2)    \nTrue\nsage: Words(2) == Words(2,30)           \nTrue\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/15480\n\n",
    "created_at": "2013-12-03T11:30:38Z",
    "labels": [
        "component: combinatorics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.1",
    "title": "Words.__eq__ returns wrong answers",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15243",
    "user": "https://github.com/nathanncohen"
}
```
CC:  @seblabbe @videlec sage-combinat @saliola

Right now equality between sets of words only compare the alphabets


```
sage: Words(3, 10) == Words(3,900)
True
sage: Words(2, finite=False) == Words(2)    
True
sage: Words(2) == Words(2,30)           
True
```


Issue created by migration from https://trac.sagemath.org/ticket/15480





---

archive/issue_comments_195647.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-12-03T12:06:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15243#issuecomment-195647",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_195648.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2013-12-03T12:38:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15243#issuecomment-195648",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_195649.json:
```json
{
    "body": "Oh. I see. That's for \n\n```\nsage: Words(\"abcd\") == WordPaths(\"abcd\")\nTrue\n```\n\n\nThen for this case I will keep the old behaviour.\n\nReady for review ! This is only hacks, but it fixes the wrong results `:-/`\n\nNathann",
    "created_at": "2013-12-03T12:42:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15243#issuecomment-195649",
    "user": "https://github.com/nathanncohen"
}
```

Oh. I see. That's for 

```
sage: Words("abcd") == WordPaths("abcd")
True
```


Then for this case I will keep the old behaviour.

Ready for review ! This is only hacks, but it fixes the wrong results `:-/`

Nathann



---

archive/issue_comments_195650.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2013-12-03T12:44:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15243#issuecomment-195650",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_195651.json:
```json
{
    "body": "I was just looking at this and I agree it's a mess. I thought that you might be able to get away with just\n\n```python\n        if self.cardinality()!=other.cardinality():\n            return False\n        if self.cardinality()==1:\n            return True\n        if self.alphabet() != other.alphabet():\n            return False\n        return type(self)==type(other)\n```\n\nbut this does not catch \n\n```\nsage: Words(\"abcd\") == WordPaths(\"abcd\")\nTrue\n```\n\nAs I don't really play with these things it is not clear to me that these two should be equal. \n\nIs this really correct?",
    "created_at": "2013-12-03T23:48:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15243#issuecomment-195651",
    "user": "https://github.com/AndrewAtLarge"
}
```

I was just looking at this and I agree it's a mess. I thought that you might be able to get away with just

```python
        if self.cardinality()!=other.cardinality():
            return False
        if self.cardinality()==1:
            return True
        if self.alphabet() != other.alphabet():
            return False
        return type(self)==type(other)
```

but this does not catch 

```
sage: Words("abcd") == WordPaths("abcd")
True
```

As I don't really play with these things it is not clear to me that these two should be equal. 

Is this really correct?



---

archive/issue_comments_195652.json:
```json
{
    "body": "I did not know the existence of WordPaths either before this patch, but I think this has been done on purpose for there are 4 doctests in the `__eq__` function that test this kind of equalities. So it's not just a result of the code, it seems to be somebody wanted to get there. But that's just guessing.\n\nAs per the cardinality test I tried to avoid calling `self.cardinality()` twice. I was wondering if this could be costly from time to time, but it's defintely prettier without this caching, so if you think it's overkill let's rewrite it as you did as I cannot produce an word where `.cardinality()` takes time.\n\nNathann",
    "created_at": "2013-12-04T08:01:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15243#issuecomment-195652",
    "user": "https://github.com/nathanncohen"
}
```

I did not know the existence of WordPaths either before this patch, but I think this has been done on purpose for there are 4 doctests in the `__eq__` function that test this kind of equalities. So it's not just a result of the code, it seems to be somebody wanted to get there. But that's just guessing.

As per the cardinality test I tried to avoid calling `self.cardinality()` twice. I was wondering if this could be costly from time to time, but it's defintely prettier without this caching, so if you think it's overkill let's rewrite it as you did as I cannot produce an word where `.cardinality()` takes time.

Nathann



---

archive/issue_comments_195653.json:
```json
{
    "body": "Personnally, I would delete the file `combinat/words/paths.py` and rewrite it all. So if there is some problem with it, don't try too much to fix it...\n\nI am not familiar with the git process of reviewing a patch... Is it easy or difficult to learn? Is Sage ready for including git patches? I will have time to learn the git process in January or February.\n\nS\u00e9bastien",
    "created_at": "2013-12-04T10:29:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15243#issuecomment-195653",
    "user": "https://github.com/seblabbe"
}
```

Personnally, I would delete the file `combinat/words/paths.py` and rewrite it all. So if there is some problem with it, don't try too much to fix it...

I am not familiar with the git process of reviewing a patch... Is it easy or difficult to learn? Is Sage ready for including git patches? I will have time to learn the git process in January or February.

SÃ©bastien



---

archive/issue_comments_195654.json:
```json
{
    "body": "Yooooooo !\n\nWell, I can't put into Sage any code that breaks doctests, and I know absolutely nothing of what WordPaths is meant to do so I cannot really rewrite it `O_o`\n\nThe word.py file could very well do with a complete rewrite, to be honest. These class inheritances are hell to work with. Or perhaps we would just need to create additional classes, so that classes exposed to the user can't be Words_all or anything similar. My problem is that there is no class for infinite words which will not ALSO be inherited by classes of finite words. So it's pretty hard to write infinite-specific code.\nThis could be solved by only returning to the user new classes that also inherits from Words_all even when the user wants infinite words (which are handled by Words_all right now). This way we would have a way to know what each class deals with.\n\nLearning git takes a bit of time, though you can easily master it with a week-end's afternoon or something like that. It's funny, and new but not so complicated after all. And you can ask around if you have questions `:-)`\n\nAaaaaaand everything should be documented on #14481 as this will be the future dev documentation !\n\nNathann",
    "created_at": "2013-12-04T10:37:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15243#issuecomment-195654",
    "user": "https://github.com/nathanncohen"
}
```

Yooooooo !

Well, I can't put into Sage any code that breaks doctests, and I know absolutely nothing of what WordPaths is meant to do so I cannot really rewrite it `O_o`

The word.py file could very well do with a complete rewrite, to be honest. These class inheritances are hell to work with. Or perhaps we would just need to create additional classes, so that classes exposed to the user can't be Words_all or anything similar. My problem is that there is no class for infinite words which will not ALSO be inherited by classes of finite words. So it's pretty hard to write infinite-specific code.
This could be solved by only returning to the user new classes that also inherits from Words_all even when the user wants infinite words (which are handled by Words_all right now). This way we would have a way to know what each class deals with.

Learning git takes a bit of time, though you can easily master it with a week-end's afternoon or something like that. It's funny, and new but not so complicated after all. And you can ask around if you have questions `:-)`

Aaaaaaand everything should be documented on #14481 as this will be the future dev documentation !

Nathann



---

archive/issue_comments_195655.json:
```json
{
    "body": "Replying to [comment:7 slabbe]:\n> Personnally, I would delete the file `combinat/words/paths.py` and rewrite it all. So if there is some problem with it, don't try too much to fix it...\n\nUnfortunately because of sage's depreciation policy we can't just remove `paths.py`, even if this is the *right* thing to do. \n\nI was going to suggest that we instead remove the doc tests of the form\n\n```\nsage: Words(\"abcd\") == WordPaths(\"abcd\")\nTrue\n```\n\nWithout these we could have a more natural looking equality test.\n\nUnfortunately, with this \"more natural\" equiality test there are now multiple doctest failures in finite_word.py and in word_generators.py. So this is not a good solution. I have not drilled down to find out why these doctests fail because this does not happen with Nathann's patch. So, as unnatural as the code looks, it is perhaps the best way to go.\n\nAndrew",
    "created_at": "2013-12-04T12:05:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15243#issuecomment-195655",
    "user": "https://github.com/AndrewAtLarge"
}
```

Replying to [comment:7 slabbe]:
> Personnally, I would delete the file `combinat/words/paths.py` and rewrite it all. So if there is some problem with it, don't try too much to fix it...

Unfortunately because of sage's depreciation policy we can't just remove `paths.py`, even if this is the *right* thing to do. 

I was going to suggest that we instead remove the doc tests of the form

```
sage: Words("abcd") == WordPaths("abcd")
True
```

Without these we could have a more natural looking equality test.

Unfortunately, with this "more natural" equiality test there are now multiple doctest failures in finite_word.py and in word_generators.py. So this is not a good solution. I have not drilled down to find out why these doctests fail because this does not happen with Nathann's patch. So, as unnatural as the code looks, it is perhaps the best way to go.

Andrew



---

archive/issue_comments_195656.json:
```json
{
    "body": "ps. Git has a bit of a learning curve, but it is quite nice once you get use to it (of course, getting used to it and being able to use it \"properly\" are not quite the same thing.) I'm happy to review this ticket.",
    "created_at": "2013-12-04T12:09:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15243#issuecomment-195656",
    "user": "https://github.com/AndrewAtLarge"
}
```

ps. Git has a bit of a learning curve, but it is quite nice once you get use to it (of course, getting used to it and being able to use it "properly" are not quite the same thing.) I'm happy to review this ticket.



---

archive/issue_comments_195657.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-12-05T11:23:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15243#issuecomment-195657",
    "user": "https://github.com/AndrewAtLarge"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_195658.json:
```json
{
    "body": "I've pushed a new commit which adds a warning message to the documentation of `Words_all` about extending the class and potential problems with `__eq__` and elsewhere. \n\nAll doctests pass in sage/combinat so assuming that the patchbot is happy I give this a positive review.\n\nA.\n----\nNew commits:",
    "created_at": "2013-12-05T11:23:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15243#issuecomment-195658",
    "user": "https://github.com/AndrewAtLarge"
}
```

I've pushed a new commit which adds a warning message to the documentation of `Words_all` about extending the class and potential problems with `__eq__` and elsewhere. 

All doctests pass in sage/combinat so assuming that the patchbot is happy I give this a positive review.

A.
----
New commits:



---

archive/issue_comments_195659.json:
```json
{
    "body": "Works for me ! Thanks `;-)`\n\nLess wrong results in Sage.. Wuuhuuu.. `:-P`\n\nNathann",
    "created_at": "2013-12-05T11:25:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15243#issuecomment-195659",
    "user": "https://github.com/nathanncohen"
}
```

Works for me ! Thanks `;-)`

Less wrong results in Sage.. Wuuhuuu.. `:-P`

Nathann



---

archive/issue_comments_195660.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2013-12-05T11:35:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15243#issuecomment-195660",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_195661.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2013-12-05T11:35:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15243#issuecomment-195661",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_195662.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-12-05T11:39:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15243#issuecomment-195662",
    "user": "https://github.com/AndrewAtLarge"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_195663.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-12-18T12:21:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15243#issuecomment-195663",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
