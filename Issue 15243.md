# Issue 15243: Words.__eq__ returns wrong answers

Issue created by migration from Trac.

Original creator: ncohen

Original creation time: 2013-12-03 11:30:38

CC:  slabbe vdelecroix sage-combinat saliola

Right now equality between sets of words only compare the alphabets


```
sage: Words(3, 10) == Words(3,900)
True
sage: Words(2, finite=False) == Words(2)    
True
sage: Words(2) == Words(2,30)           
True
```



---

Comment by ncohen created at 2013-12-03 12:06:12

Changing status from new to needs_review.


---

Comment by git created at 2013-12-03 12:38:17

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by ncohen created at 2013-12-03 12:42:47

Oh. I see. That's for 

```
sage: Words("abcd") == WordPaths("abcd")
True
```


Then for this case I will keep the old behaviour.

Ready for review ! This is only hacks, but it fixes the wrong results `:-/`

Nathann


---

Comment by git created at 2013-12-03 12:44:49

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by andrew.mathas created at 2013-12-03 23:48:44

I was just looking at this and I agree it's a mess. I thought that you might be able to get away with just

```python
        if self.cardinality()!=other.cardinality():
            return False
        if self.cardinality()==1:
            return True
        if self.alphabet() != other.alphabet():
            return False
        return type(self)==type(other)
```

but this does not catch 

```
sage: Words("abcd") == WordPaths("abcd")
True
```

As I don't really play with these things it is not clear to me that these two should be equal. 

Is this really correct?


---

Comment by ncohen created at 2013-12-04 08:01:29

I did not know the existence of WordPaths either before this patch, but I think this has been done on purpose for there are 4 doctests in the `__eq__` function that test this kind of equalities. So it's not just a result of the code, it seems to be somebody wanted to get there. But that's just guessing.

As per the cardinality test I tried to avoid calling `self.cardinality()` twice. I was wondering if this could be costly from time to time, but it's defintely prettier without this caching, so if you think it's overkill let's rewrite it as you did as I cannot produce an word where `.cardinality()` takes time.

Nathann


---

Comment by slabbe created at 2013-12-04 10:29:45

Personnally, I would delete the file `combinat/words/paths.py` and rewrite it all. So if there is some problem with it, don't try too much to fix it...

I am not familiar with the git process of reviewing a patch... Is it easy or difficult to learn? Is Sage ready for including git patches? I will have time to learn the git process in January or February.

SÃ©bastien


---

Comment by ncohen created at 2013-12-04 10:37:34

Yooooooo !

Well, I can't put into Sage any code that breaks doctests, and I know absolutely nothing of what WordPaths is meant to do so I cannot really rewrite it `O_o`

The word.py file could very well do with a complete rewrite, to be honest. These class inheritances are hell to work with. Or perhaps we would just need to create additional classes, so that classes exposed to the user can't be Words_all or anything similar. My problem is that there is no class for infinite words which will not ALSO be inherited by classes of finite words. So it's pretty hard to write infinite-specific code.
This could be solved by only returning to the user new classes that also inherits from Words_all even when the user wants infinite words (which are handled by Words_all right now). This way we would have a way to know what each class deals with.

Learning git takes a bit of time, though you can easily master it with a week-end's afternoon or something like that. It's funny, and new but not so complicated after all. And you can ask around if you have questions `:-)`

Aaaaaaand everything should be documented on #14481 as this will be the future dev documentation !

Nathann


---

Comment by andrew.mathas created at 2013-12-04 12:05:57

Replying to [comment:7 slabbe]:
> Personnally, I would delete the file `combinat/words/paths.py` and rewrite it all. So if there is some problem with it, don't try too much to fix it...

Unfortunately because of sage's depreciation policy we can't just remove `paths.py`, even if this is the _right_ thing to do. 

I was going to suggest that we instead remove the doc tests of the form

```
sage: Words("abcd") == WordPaths("abcd")
True
```

Without these we could have a more natural looking equality test.

Unfortunately, with this "more natural" equiality test there are now multiple doctest failures in finite_word.py and in word_generators.py. So this is not a good solution. I have not drilled down to find out why these doctests fail because this does not happen with Nathann's patch. So, as unnatural as the code looks, it is perhaps the best way to go.

Andrew


---

Comment by andrew.mathas created at 2013-12-04 12:09:42

ps. Git has a bit of a learning curve, but it is quite nice once you get use to it (of course, getting used to it and being able to use it "properly" are not quite the same thing.) I'm happy to review this ticket.


---

Comment by andrew.mathas created at 2013-12-05 11:23:46

Changing status from needs_review to positive_review.


---

Comment by andrew.mathas created at 2013-12-05 11:23:46

I've pushed a new commit which adds a warning message to the documentation of `Words_all` about extending the class and potential problems with `__eq__` and elsewhere. 

All doctests pass in sage/combinat so assuming that the patchbot is happy I give this a positive review.

A.
----
New commits:


---

Comment by ncohen created at 2013-12-05 11:25:45

Works for me ! Thanks `;-)`

Less wrong results in Sage.. Wuuhuuu.. `:-P`

Nathann


---

Comment by git created at 2013-12-05 11:35:19

Changing status from positive_review to needs_review.


---

Comment by git created at 2013-12-05 11:35:19

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:


---

Comment by andrew.mathas created at 2013-12-05 11:39:18

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2013-12-18 12:21:58

Resolution: fixed
