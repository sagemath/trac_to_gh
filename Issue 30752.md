# Issue 30752: add some typing information to interval-posets

archive/issues_030752.json:
```json
{
    "body": "CC:  @tobiasdiez\n\njust as a little experiment\n\nIssue created by migration from https://trac.sagemath.org/ticket/30989\n\n",
    "created_at": "2020-12-01T13:09:19Z",
    "labels": [
        "combinatorics",
        "minor",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.3",
    "title": "add some typing information to interval-posets",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30752",
    "user": "@fchapoton"
}
```
CC:  @tobiasdiez

just as a little experiment

Issue created by migration from https://trac.sagemath.org/ticket/30989





---

archive/issue_comments_439552.json:
```json
{
    "body": "New commits:",
    "created_at": "2020-12-01T13:09:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30752",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30752#issuecomment-439552",
    "user": "@fchapoton"
}
```

New commits:



---

archive/issue_comments_439553.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-12-01T13:09:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30752",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30752#issuecomment-439553",
    "user": "@fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_439554.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-12-01T17:48:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30752",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30752#issuecomment-439554",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_439555.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-12-01T19:21:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30752",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30752#issuecomment-439555",
    "user": "@tobiasdiez"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_439556.json:
```json
{
    "body": "In general, this looks good to me (I have admit I didn't went through the code in detail to check whether the added typing information is correct.)\n\nOne suggestion for improvement: for lists, tuple and iterators there are special typing annotation that allow to specify also the type of elements in these lists, e.g. https://docs.python.org/3/library/typing.html#typing.Iterator\nAfter `from __future__ import annotations`, you can simply write `list[str]` for a list of strings.\n\nMoreover, it would be good to also annotate the method parameters. For example, https://github.com/microsoft/pyright/blob/master/docs/getting-started.md comments\n> The annotations that provide most value are on function input parameters, instance variables, and return parameters (in that order).",
    "created_at": "2020-12-01T19:21:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30752",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30752#issuecomment-439556",
    "user": "@tobiasdiez"
}
```

In general, this looks good to me (I have admit I didn't went through the code in detail to check whether the added typing information is correct.)

One suggestion for improvement: for lists, tuple and iterators there are special typing annotation that allow to specify also the type of elements in these lists, e.g. https://docs.python.org/3/library/typing.html#typing.Iterator
After `from __future__ import annotations`, you can simply write `list[str]` for a list of strings.

Moreover, it would be good to also annotate the method parameters. For example, https://github.com/microsoft/pyright/blob/master/docs/getting-started.md comments
> The annotations that provide most value are on function input parameters, instance variables, and return parameters (in that order).



---

archive/issue_comments_439557.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-12-01T20:44:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30752",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30752#issuecomment-439557",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_439558.json:
```json
{
    "body": "Thanks for the hint.\n\nI think it would be slightly premature to add more typing here, without thinking in general about the relationship with the Parent/Element framework.",
    "created_at": "2020-12-01T20:47:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30752",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30752#issuecomment-439558",
    "user": "@fchapoton"
}
```

Thanks for the hint.

I think it would be slightly premature to add more typing here, without thinking in general about the relationship with the Parent/Element framework.



---

archive/issue_comments_439559.json:
```json
{
    "body": "Sure, it's already better than no typing at all.\n\nFeel free to set it to \"positive review\" after the tests pass.",
    "created_at": "2020-12-01T22:45:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30752",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30752#issuecomment-439559",
    "user": "@tobiasdiez"
}
```

Sure, it's already better than no typing at all.

Feel free to set it to "positive review" after the tests pass.



---

archive/issue_comments_439560.json:
```json
{
    "body": "ok, thanks. For sure, only a first step.\n\nI was wondering how to add typing information explaining that the output type has the same \"Parent\" as self.",
    "created_at": "2020-12-02T07:56:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30752",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30752#issuecomment-439560",
    "user": "@fchapoton"
}
```

ok, thanks. For sure, only a first step.

I was wondering how to add typing information explaining that the output type has the same "Parent" as self.



---

archive/issue_comments_439561.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2020-12-02T07:56:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30752",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30752#issuecomment-439561",
    "user": "@fchapoton"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_439562.json:
```json
{
    "body": "Replying to [comment:8 chapoton]:\n> I was wondering how to add typing information explaining that the output type has the same \"Parent\" as self.\n\nIn general you can use ``@`overload` for methods to provide a more refined typing information depending on the type of the arguments, in particular, also of self.\nFor example,\n\n```\n    @overload\n    def method(self: 'MyClass', other: 'OtherClass') -> 'ReturnClass':\n        pass\n\n    def method(self: Any, other: Any) -> Any:\n        ....\n```\n\n\nThe category framework probably needs further work to be able to provide meaningful typing information. One way path would be to use generics. For example, [sage.categories.action.Action](https://doc.sagemath.org/html/en/reference/coercion/sage/categories/action.html) could be declared as\n\n```\nG = TypeVar('G') # possibly with some constraints\nS = TypeVar('S')\n\nclass Action(Generic[G, S]):\n\n   def __init__(G: G, S: S):\n       ....\n   \n   def actor(self) -> G:\n       ....\n\n   def codomain(self) -> S:\n       ...\n```\n",
    "created_at": "2020-12-02T11:12:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30752",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30752#issuecomment-439562",
    "user": "@tobiasdiez"
}
```

Replying to [comment:8 chapoton]:
> I was wondering how to add typing information explaining that the output type has the same "Parent" as self.

In general you can use ``@`overload` for methods to provide a more refined typing information depending on the type of the arguments, in particular, also of self.
For example,

```
    @overload
    def method(self: 'MyClass', other: 'OtherClass') -> 'ReturnClass':
        pass

    def method(self: Any, other: Any) -> Any:
        ....
```


The category framework probably needs further work to be able to provide meaningful typing information. One way path would be to use generics. For example, [sage.categories.action.Action](https://doc.sagemath.org/html/en/reference/coercion/sage/categories/action.html) could be declared as

```
G = TypeVar('G') # possibly with some constraints
S = TypeVar('S')

class Action(Generic[G, S]):

   def __init__(G: G, S: S):
       ....
   
   def actor(self) -> G:
       ....

   def codomain(self) -> S:
       ...
```




---

archive/issue_comments_439563.json:
```json
{
    "body": "To my understanding, type annotations themselves are supported in Python 3.6. \n`from __future__ import annotations` is for \"postponed evaluation of annotations\" (https://www.python.org/dev/peps/pep-0563/) \n\nI think the annotations added on this ticket do not need `from __future__ import annotations` - so this line can be removed and the dependency can be dropped",
    "created_at": "2020-12-04T19:52:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30752",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30752#issuecomment-439563",
    "user": "@mkoeppe"
}
```

To my understanding, type annotations themselves are supported in Python 3.6. 
`from __future__ import annotations` is for "postponed evaluation of annotations" (https://www.python.org/dev/peps/pep-0563/) 

I think the annotations added on this ticket do not need `from __future__ import annotations` - so this line can be removed and the dependency can be dropped



---

archive/issue_comments_439564.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. This was a forced push. New commits:",
    "created_at": "2020-12-05T08:09:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30752",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30752#issuecomment-439564",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. This was a forced push. New commits:



---

archive/issue_comments_439565.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2020-12-05T08:09:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30752",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30752#issuecomment-439565",
    "user": "git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_439566.json:
```json
{
    "body": "ok, here is a more basic annotation, without future import\n\nUsing python 3.8.5, I needed to change back `list[tuple]` to just `list`\n\nplease review again",
    "created_at": "2020-12-05T08:11:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30752",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30752#issuecomment-439566",
    "user": "@fchapoton"
}
```

ok, here is a more basic annotation, without future import

Using python 3.8.5, I needed to change back `list[tuple]` to just `list`

please review again



---

archive/issue_comments_439567.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-12-05T12:41:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30752",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30752#issuecomment-439567",
    "user": "@tobiasdiez"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_439568.json:
```json
{
    "body": "If you don't want to use `__future__`, then you have to use `List[Tuple[...]]` from `typing`, and also sometimes wrap typing information in strings (e.g. so that you don't run into issues with forward references).\nI'm in favor of using the future import, since this can easily be migrated once only >= python 3.9 is supported (by simply removing the import).\n\nI think it's a good idea to specify the complete typing information, so also specify the type of the list items, i.e. `List[str]` instead of only `List`. Same for the iterator.",
    "created_at": "2020-12-05T12:41:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30752",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30752#issuecomment-439568",
    "user": "@tobiasdiez"
}
```

If you don't want to use `__future__`, then you have to use `List[Tuple[...]]` from `typing`, and also sometimes wrap typing information in strings (e.g. so that you don't run into issues with forward references).
I'm in favor of using the future import, since this can easily be migrated once only >= python 3.9 is supported (by simply removing the import).

I think it's a good idea to specify the complete typing information, so also specify the type of the list items, i.e. `List[str]` instead of only `List`. Same for the iterator.



---

archive/issue_comments_439569.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-12-05T16:47:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30752",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30752#issuecomment-439569",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_439570.json:
```json
{
    "body": "ok, here is a commit for using List[Tuple]",
    "created_at": "2020-12-05T16:48:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30752",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30752#issuecomment-439570",
    "user": "@fchapoton"
}
```

ok, here is a commit for using List[Tuple]



---

archive/issue_comments_439571.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-12-05T16:48:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30752",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30752#issuecomment-439571",
    "user": "@fchapoton"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_439572.json:
```json
{
    "body": "There are merged conflicts now.",
    "created_at": "2020-12-07T23:34:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30752",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30752#issuecomment-439572",
    "user": "@tobiasdiez"
}
```

There are merged conflicts now.



---

archive/issue_comments_439573.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-12-07T23:34:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30752",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30752#issuecomment-439573",
    "user": "@tobiasdiez"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_439574.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-12-08T08:01:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30752",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30752#issuecomment-439574",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_439575.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-12-08T08:01:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30752",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30752#issuecomment-439575",
    "user": "@fchapoton"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_439576.json:
```json
{
    "body": "merged",
    "created_at": "2020-12-08T08:01:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30752",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30752#issuecomment-439576",
    "user": "@fchapoton"
}
```

merged



---

archive/issue_comments_439577.json:
```json
{
    "body": "LGTM. The patchbot fails, but the errors seem not relevant to the changes on the branch.",
    "created_at": "2020-12-08T12:46:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30752",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30752#issuecomment-439577",
    "user": "@tobiasdiez"
}
```

LGTM. The patchbot fails, but the errors seem not relevant to the changes on the branch.



---

archive/issue_comments_439578.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-12-08T12:46:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30752",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30752#issuecomment-439578",
    "user": "@tobiasdiez"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_439579.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-12-21T23:35:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30752",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30752#issuecomment-439579",
    "user": "@vbraun"
}
```

Resolution: fixed
