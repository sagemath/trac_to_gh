# Issue 30752: add some typing information to interval-posets

Issue created by migration from https://trac.sagemath.org/ticket/30989

Original creator: chapoton

Original creation time: 2020-12-01 13:09:19

CC:  @tobiasdiez

just as a little experiment


---

Comment by chapoton created at 2020-12-01 13:09:54

New commits:


---

Comment by chapoton created at 2020-12-01 13:09:54

Changing status from new to needs_review.


---

Comment by git created at 2020-12-01 17:48:20

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @tobiasdiez created at 2020-12-01 19:21:50

Changing status from needs_review to needs_work.


---

Comment by @tobiasdiez created at 2020-12-01 19:21:50

In general, this looks good to me (I have admit I didn't went through the code in detail to check whether the added typing information is correct.)

One suggestion for improvement: for lists, tuple and iterators there are special typing annotation that allow to specify also the type of elements in these lists, e.g. https://docs.python.org/3/library/typing.html#typing.Iterator
After `from __future__ import annotations`, you can simply write `list[str]` for a list of strings.

Moreover, it would be good to also annotate the method parameters. For example, https://github.com/microsoft/pyright/blob/master/docs/getting-started.md comments
> The annotations that provide most value are on function input parameters, instance variables, and return parameters (in that order).


---

Comment by git created at 2020-12-01 20:44:52

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by chapoton created at 2020-12-01 20:47:58

Thanks for the hint.

I think it would be slightly premature to add more typing here, without thinking in general about the relationship with the Parent/Element framework.


---

Comment by @tobiasdiez created at 2020-12-01 22:45:57

Sure, it's already better than no typing at all.

Feel free to set it to "positive review" after the tests pass.


---

Comment by chapoton created at 2020-12-02 07:56:28

ok, thanks. For sure, only a first step.

I was wondering how to add typing information explaining that the output type has the same "Parent" as self.


---

Comment by chapoton created at 2020-12-02 07:56:37

Changing status from needs_work to positive_review.


---

Comment by @tobiasdiez created at 2020-12-02 11:12:50

Replying to [comment:8 chapoton]:
> I was wondering how to add typing information explaining that the output type has the same "Parent" as self.

In general you can use ``@`overload` for methods to provide a more refined typing information depending on the type of the arguments, in particular, also of self.
For example,

```
    @overload
    def method(self: 'MyClass', other: 'OtherClass') -> 'ReturnClass':
        pass

    def method(self: Any, other: Any) -> Any:
        ....
```


The category framework probably needs further work to be able to provide meaningful typing information. One way path would be to use generics. For example, [sage.categories.action.Action](https://doc.sagemath.org/html/en/reference/coercion/sage/categories/action.html) could be declared as

```
G = TypeVar('G') # possibly with some constraints
S = TypeVar('S')

class Action(Generic[G, S]):

   def __init__(G: G, S: S):
       ....
   
   def actor(self) -> G:
       ....

   def codomain(self) -> S:
       ...
```



---

Comment by mkoeppe created at 2020-12-04 19:52:18

To my understanding, type annotations themselves are supported in Python 3.6. 
`from __future__ import annotations` is for "postponed evaluation of annotations" (https://www.python.org/dev/peps/pep-0563/) 

I think the annotations added on this ticket do not need `from __future__ import annotations` - so this line can be removed and the dependency can be dropped


---

Comment by git created at 2020-12-05 08:09:58

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. This was a forced push. New commits:


---

Comment by git created at 2020-12-05 08:09:58

Changing status from positive_review to needs_review.


---

Comment by chapoton created at 2020-12-05 08:11:58

ok, here is a more basic annotation, without future import

Using python 3.8.5, I needed to change back `list[tuple]` to just `list`

please review again


---

Comment by @tobiasdiez created at 2020-12-05 12:41:22

Changing status from needs_review to needs_work.


---

Comment by @tobiasdiez created at 2020-12-05 12:41:22

If you don't want to use `__future__`, then you have to use `List[Tuple[...]]` from `typing`, and also sometimes wrap typing information in strings (e.g. so that you don't run into issues with forward references).
I'm in favor of using the future import, since this can easily be migrated once only >= python 3.9 is supported (by simply removing the import).

I think it's a good idea to specify the complete typing information, so also specify the type of the list items, i.e. `List[str]` instead of only `List`. Same for the iterator.


---

Comment by git created at 2020-12-05 16:47:20

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2020-12-05 16:48:25

ok, here is a commit for using List[Tuple]


---

Comment by chapoton created at 2020-12-05 16:48:31

Changing status from needs_work to needs_review.


---

Comment by @tobiasdiez created at 2020-12-07 23:34:44

There are merged conflicts now.


---

Comment by @tobiasdiez created at 2020-12-07 23:34:44

Changing status from needs_review to needs_work.


---

Comment by git created at 2020-12-08 08:01:23

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2020-12-08 08:01:32

Changing status from needs_work to needs_review.


---

Comment by chapoton created at 2020-12-08 08:01:32

merged


---

Comment by @tobiasdiez created at 2020-12-08 12:46:21

LGTM. The patchbot fails, but the errors seem not relevant to the changes on the branch.


---

Comment by @tobiasdiez created at 2020-12-08 12:46:21

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2020-12-21 23:35:22

Resolution: fixed
