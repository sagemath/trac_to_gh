# Issue 13128: slice and __getitem__ do not work over unramified extensions of padics

archive/issues_013128.json:
```json
{
    "body": "Assignee: roed\n\nThere are some strange results when indexing into an element of an unramified extension.\n\nIn the following example, I think it would make more sense to return an element in the residue field:\n\n```\nsage: K=Qp(3,5)\nsage: R.<a> = K[]\nsage: L.<a> = K.extension(a^2+a-1)\nsage: a[0]\n[0, 1]\n```\n\n\nSlices do not work at all currently:\n\n```\nsage: a[0:2]\nTypeError\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/13300\n\n",
    "created_at": "2012-07-26T17:10:11Z",
    "labels": [
        "padics",
        "trivial",
        "enhancement"
    ],
    "title": "slice and __getitem__ do not work over unramified extensions of padics",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13128",
    "user": "saraedum"
}
```
Assignee: roed

There are some strange results when indexing into an element of an unramified extension.

In the following example, I think it would make more sense to return an element in the residue field:

```
sage: K=Qp(3,5)
sage: R.<a> = K[]
sage: L.<a> = K.extension(a^2+a-1)
sage: a[0]
[0, 1]
```


Slices do not work at all currently:

```
sage: a[0:2]
TypeError
```


Issue created by migration from https://trac.sagemath.org/ticket/13300





---

archive/issue_comments_159818.json:
```json
{
    "body": "The attached file (which has an extra 3 in the filename, sorry) fixes this.\n\nTo be consistent, indexing gives elements in the residue field. Mathematically, this seems to make sense, but is this really what one wants?\n\nI'm running all doctests now to see if this breaks anything.",
    "created_at": "2012-07-26T17:56:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13128",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13128#issuecomment-159818",
    "user": "saraedum"
}
```

The attached file (which has an extra 3 in the filename, sorry) fixes this.

To be consistent, indexing gives elements in the residue field. Mathematically, this seems to make sense, but is this really what one wants?

I'm running all doctests now to see if this breaks anything.



---

archive/issue_comments_159819.json:
```json
{
    "body": "The doctests worked, so I'm setting this to needs review.",
    "created_at": "2012-07-26T18:14:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13128",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13128#issuecomment-159819",
    "user": "saraedum"
}
```

The doctests worked, so I'm setting this to needs review.



---

archive/issue_comments_159820.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-07-26T18:14:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13128",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13128#issuecomment-159820",
    "user": "saraedum"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_159821.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2012-10-24T06:53:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13128",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13128#issuecomment-159821",
    "user": "roed"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_159822.json:
```json
{
    "body": "Attachment\n\nI don't think that giving elements of the residue field is what we want, though I agree that the current behavior for unramified extensions is silly.  I would like to be able to have \n\n```\nsage: K.<a> = Qq(7^2, 20)\nsage: z = K.random_element()\nsage: z == sum([z[i] * 7^i for i in range(20)])\nTrue\n```\n\nwithout having to lift from the residue field.\n\nOf course, sometimes you want to get at the coefficient of `a` in `z`, or the coefficient of `a` in `z[0]`.  Here's an idea.  For matrices, we have the following::\n\n\n```\nsage: M = matrix(ZZ,4,4,range(16))\nsage: M[0]\n(0, 1, 2, 3)\nsage: M[0,0]\n0\nsage: M[0,:]\n[0 1 2 3]\nsage: M[:,0]\n[ 0]\n[ 4]\n[ 8]\n[12]\nsage: M[1:3,1:4]\n[ 5  6  7]\n[ 9 10 11]\n```\n\n\nWhat if we used a similar tuple indexing scheme for p-adic elements?  For example:\n\n\n```\nsage: K.<a> = Qq(5^4,5)\nsage: z = K.random_element(); z\na^3*5^-2 + (3*a^3 + 3*a^2)*5^-1 + (3*a^3 + a^2 + 3*a) + 4*a^3*5 + (4*a + 2)*5^2 + O(5^3)\nsage: z[0]\n3*a^3 + a^2 + 3*a + O(5^3)\nsage: z[2]\n4*a + 2 + O(5)\nsage: z[2].parent()\nUnramified Extension of 5-adic Field with capped relative precision 5 in a defined by (1 + O(5^5))*x^4 + (O(5^5))*x^3 + (4 + O(5^5))*x^2 + (4 + O(5^5))*x + (2 + O(5^5))\nsage: z[0,0]\nO(5^3)\nsage: z[0,0].parent()\n5-adic Field with capped relative precision 5\nsage: z[2,0]\n2 + O(5)\nsage: z[2,1]\n4 + O(5)\nsage: z[:-1]\na^3*5^-2 + O(5^-1)\nsage: z[:1]\na^3*5^-2 + (3*a^3 + 3*a^2)*5^-1 + (3*a^3 + a^2 + 3*a) + O(5)\nsage: z[:] == z[:,:] == z\nTrue\nsage: all([z[i,:] == z[i] for i in range(-3,2)])\nTrue\nsage: z[:,0]\n2*5^2 + O(5^3)\nsage: z[:,0].parent()\n5-adic Field with capped relative precision 5\nsage: z[:,1]\n3 + 4*5^2 + O(5^3)\nsage: z[:,2]\n3*5^-1 + 1 + O(5^3)\nsage: z[:,3]\n5^-2 + 3*5^-1 + 3 + 4*5 + O(5^3)\nsage: sum([a^j * z[:,j] for j in range(4)]) == z\nTrue\nsage: z[-1:2,1:3]\n3*a^2*5^-1 + (a^2 + 3*a) + O(5^2)\n```\n\nThe parent of z[i], z[i,T] and z[S,T] (for integer i and slices S,T) would be the unramified extension; the parent of z[i,j] and z[S,j] would be the ground field (or ring).  Negative indices would never be considered as counting backward from a length, even for ring elements.\n\nWhat do you think?",
    "created_at": "2012-10-24T06:53:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13128",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13128#issuecomment-159822",
    "user": "roed"
}
```

Attachment

I don't think that giving elements of the residue field is what we want, though I agree that the current behavior for unramified extensions is silly.  I would like to be able to have 

```
sage: K.<a> = Qq(7^2, 20)
sage: z = K.random_element()
sage: z == sum([z[i] * 7^i for i in range(20)])
True
```

without having to lift from the residue field.

Of course, sometimes you want to get at the coefficient of `a` in `z`, or the coefficient of `a` in `z[0]`.  Here's an idea.  For matrices, we have the following::


```
sage: M = matrix(ZZ,4,4,range(16))
sage: M[0]
(0, 1, 2, 3)
sage: M[0,0]
0
sage: M[0,:]
[0 1 2 3]
sage: M[:,0]
[ 0]
[ 4]
[ 8]
[12]
sage: M[1:3,1:4]
[ 5  6  7]
[ 9 10 11]
```


What if we used a similar tuple indexing scheme for p-adic elements?  For example:


```
sage: K.<a> = Qq(5^4,5)
sage: z = K.random_element(); z
a^3*5^-2 + (3*a^3 + 3*a^2)*5^-1 + (3*a^3 + a^2 + 3*a) + 4*a^3*5 + (4*a + 2)*5^2 + O(5^3)
sage: z[0]
3*a^3 + a^2 + 3*a + O(5^3)
sage: z[2]
4*a + 2 + O(5)
sage: z[2].parent()
Unramified Extension of 5-adic Field with capped relative precision 5 in a defined by (1 + O(5^5))*x^4 + (O(5^5))*x^3 + (4 + O(5^5))*x^2 + (4 + O(5^5))*x + (2 + O(5^5))
sage: z[0,0]
O(5^3)
sage: z[0,0].parent()
5-adic Field with capped relative precision 5
sage: z[2,0]
2 + O(5)
sage: z[2,1]
4 + O(5)
sage: z[:-1]
a^3*5^-2 + O(5^-1)
sage: z[:1]
a^3*5^-2 + (3*a^3 + 3*a^2)*5^-1 + (3*a^3 + a^2 + 3*a) + O(5)
sage: z[:] == z[:,:] == z
True
sage: all([z[i,:] == z[i] for i in range(-3,2)])
True
sage: z[:,0]
2*5^2 + O(5^3)
sage: z[:,0].parent()
5-adic Field with capped relative precision 5
sage: z[:,1]
3 + 4*5^2 + O(5^3)
sage: z[:,2]
3*5^-1 + 1 + O(5^3)
sage: z[:,3]
5^-2 + 3*5^-1 + 3 + 4*5 + O(5^3)
sage: sum([a^j * z[:,j] for j in range(4)]) == z
True
sage: z[-1:2,1:3]
3*a^2*5^-1 + (a^2 + 3*a) + O(5^2)
```

The parent of z[i], z[i,T] and z[S,T] (for integer i and slices S,T) would be the unramified extension; the parent of z[i,j] and z[S,j] would be the ground field (or ring).  Negative indices would never be considered as counting backward from a length, even for ring elements.

What do you think?



---

archive/issue_comments_159823.json:
```json
{
    "body": "Changing status from needs_info to needs_work.",
    "created_at": "2014-06-25T16:58:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13128",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13128#issuecomment-159823",
    "user": "saraedum"
}
```

Changing status from needs_info to needs_work.



---

archive/issue_comments_159824.json:
```json
{
    "body": "Let's think about this again once #14304 has been merged.",
    "created_at": "2014-06-25T16:58:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13128",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13128#issuecomment-159824",
    "user": "saraedum"
}
```

Let's think about this again once #14304 has been merged.



---

archive/issue_comments_159825.json:
```json
{
    "body": "Changing status from needs_work to needs_info.",
    "created_at": "2016-11-29T07:47:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13128",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13128#issuecomment-159825",
    "user": "saraedum"
}
```

Changing status from needs_work to needs_info.



---

archive/issue_comments_159826.json:
```json
{
    "body": "I like your proposal. Let's discuss this at one of the IRC sessions.",
    "created_at": "2016-11-29T07:47:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13128",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13128#issuecomment-159826",
    "user": "saraedum"
}
```

I like your proposal. Let's discuss this at one of the IRC sessions.
