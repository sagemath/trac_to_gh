# Issue 26256: element_pari_ffelt: use PARI clones instead of deepcopy_to_python_heap()

Issue created by migration from https://trac.sagemath.org/ticket/26493

Original creator: jdemeyer

Original creation time: 2018-10-15 13:56:39

CC:  pbruin vdelecroix defeo

The PARI "clone" functionality is pretty close to what `deepcopy_to_python_heap()` does. Since it's handling PARI objects anyway, it makes sense to use the PARI `gclone()` functionality too.

That is what cypari2 will do starting from version 2.0, so for consistency `element_pari_ffelt` should do that too.


---

Comment by jdemeyer created at 2018-10-17 08:46:35

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2018-10-17 08:46:35

New commits:


---

Comment by git created at 2018-10-17 09:01:27

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2018-10-17 09:07:19

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2018-10-17 09:12:19

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by pbruin created at 2018-10-17 21:52:22

Looks good to me.  I noticed you use `gcloneref` rather than `gclone`.  This is of course faster in the case where the object is already on the heap, which as far as I can see only happens when copying an existing element or creating one from a compatible `pari_gen`.  It does seem to imply that `copy` will make a new Python object containing a reference to the same PARI object, but I guess this is perfectly fine since `copy` is not required to do a deep copy.


---

Comment by pbruin created at 2018-10-17 21:52:22

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2018-10-18 05:14:18

Replying to [comment:9 pbruin]:
> It does seem to imply that `copy` will make a new Python object containing a reference to the same PARI object

Exactly. But finite field elements are immutable (you cannot change them in-place, neither in PARI nor in Sage), so that should not be a problem.


---

Comment by vbraun created at 2018-10-20 19:02:38

Resolution: fixed


---

Comment by embray created at 2018-10-28 14:52:23

This should be re-targeted for 8.5.
