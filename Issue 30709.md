# Issue 30709: Add "minimal=True" option to affine_hull_projection

archive/issues_030709.json:
```json
{
    "body": "CC:  @kliem\n\nKeywords: affine_hull, polytope\n\nCurrently, the computation of the `affine_hull_projection` is done by default in `AA` which is not optimal sometimes.\n\nCurrently:\n\n\n```\nsage: A=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1],[1/4,1/4,1/4,1/4]]                                                                                                                                                \nsage: n=len(A)                                                                                                                                                                                                     \nsage: A=[vector(v) for v in A]                                                                                                                                                                                     \nsage: AP = Polyhedron(vertices=A)                                                                                                                                                                                  \nsage: M,b=AP.affine_hull_projection(orthonormal=True,extend=True,as_affine_map=True)                                                                                                                               \nsage: V=[] \n....: for i in range(n): \n....:     for j in range(i+1,n): \n....:             V.append((A[i]-A[j])/2) \n....:                                                                                                                                                                                                              \nsage: Z=polytopes.zonotope(V)                                                                                                                                                                                      \nsage: T = M.matrix().transpose()                                                                                                                                                                                   \nsage: timeit('T*Z')                                                                                                                                                                                                \n5 loops, best of 3: 78.5 ms per loop\n```\n\n\nWith this ticket:\n\n\n```\nsage: A=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1],[1/4,1/4,1/4,1/4]]                                                                                                                                                \nsage: n=len(A)                                                                                                                                                                                                     \nsage: A=[vector(v) for v in A]                                                                                                                                                                                     \nsage: AP = Polyhedron(vertices=A)                                                                                                                                                                                  \nsage: M,b=AP.affine_hull_projection(orthonormal=True,extend=True,as_affine_map=True,minimal=True)                                                                                                                  \nsage: V=[] \n....: for i in range(n): \n....:     for j in range(i+1,n): \n....:             V.append((A[i]-A[j])/2) \n....:                                                                                                                                                                                                              \nsage: Z=polytopes.zonotope(V)                                                                                                                                                                                      \nsage: T = M.matrix().transpose()                                                                                                                                                                                   \nsage: timeit('T*Z')                                                                                                                                                                                                \n25 loops, best of 3: 18 ms per loop\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/30946\n\n",
    "created_at": "2020-11-22T20:29:03Z",
    "labels": [
        "geometry",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.3",
    "title": "Add \"minimal=True\" option to affine_hull_projection",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30709",
    "user": "jipilab"
}
```
CC:  @kliem

Keywords: affine_hull, polytope

Currently, the computation of the `affine_hull_projection` is done by default in `AA` which is not optimal sometimes.

Currently:


```
sage: A=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1],[1/4,1/4,1/4,1/4]]                                                                                                                                                
sage: n=len(A)                                                                                                                                                                                                     
sage: A=[vector(v) for v in A]                                                                                                                                                                                     
sage: AP = Polyhedron(vertices=A)                                                                                                                                                                                  
sage: M,b=AP.affine_hull_projection(orthonormal=True,extend=True,as_affine_map=True)                                                                                                                               
sage: V=[] 
....: for i in range(n): 
....:     for j in range(i+1,n): 
....:             V.append((A[i]-A[j])/2) 
....:                                                                                                                                                                                                              
sage: Z=polytopes.zonotope(V)                                                                                                                                                                                      
sage: T = M.matrix().transpose()                                                                                                                                                                                   
sage: timeit('T*Z')                                                                                                                                                                                                
5 loops, best of 3: 78.5 ms per loop
```


With this ticket:


```
sage: A=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1],[1/4,1/4,1/4,1/4]]                                                                                                                                                
sage: n=len(A)                                                                                                                                                                                                     
sage: A=[vector(v) for v in A]                                                                                                                                                                                     
sage: AP = Polyhedron(vertices=A)                                                                                                                                                                                  
sage: M,b=AP.affine_hull_projection(orthonormal=True,extend=True,as_affine_map=True,minimal=True)                                                                                                                  
sage: V=[] 
....: for i in range(n): 
....:     for j in range(i+1,n): 
....:             V.append((A[i]-A[j])/2) 
....:                                                                                                                                                                                                              
sage: Z=polytopes.zonotope(V)                                                                                                                                                                                      
sage: T = M.matrix().transpose()                                                                                                                                                                                   
sage: timeit('T*Z')                                                                                                                                                                                                
25 loops, best of 3: 18 ms per loop
```


Issue created by migration from https://trac.sagemath.org/ticket/30946





---

archive/issue_comments_439046.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-11-22T20:29:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30709#issuecomment-439046",
    "user": "jipilab"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_439047.json:
```json
{
    "body": "\n```\nsage: %timeit M,b=AP.affine_hull_projection(orthonormal=True,extend=True,minimal=True,as_affine_map=True)                                                                           \n49 ms \u00b1 203 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 10 loops each)\n```\n\n\nLooks like you just outsourced the labor. But maybe in larger examples this pays of.",
    "created_at": "2020-11-22T20:36:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30709#issuecomment-439047",
    "user": "@kliem"
}
```


```
sage: %timeit M,b=AP.affine_hull_projection(orthonormal=True,extend=True,minimal=True,as_affine_map=True)                                                                           
49 ms ± 203 µs per loop (mean ± std. dev. of 7 runs, 10 loops each)
```


Looks like you just outsourced the labor. But maybe in larger examples this pays of.



---

archive/issue_comments_439048.json:
```json
{
    "body": "Apparently it is at least better asymptotically.\n\n\n```\nsage: P = polytopes.permutahedron(5)                                                                                                                                                \nsage: %timeit P.affine_hull_projection(orthonormal=True,extend=True)                                                                                                                \n78.9 ms \u00b1 216 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 10 loops each)\nsage: %timeit P.affine_hull_projection(orthonormal=True,extend=True,minimal=True)                                                                                                   \n119 ms \u00b1 362 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 10 loops each)\nsage: P = polytopes.permutahedron(6)                                                                                                                                                \nsage: %timeit P.affine_hull_projection(orthonormal=True,extend=True)                                                                                                                \n334 ms \u00b1 2.84 ms per loop (mean \u00b1 std. dev. of 7 runs, 1 loop each)\nsage: %timeit P.affine_hull_projection(orthonormal=True,extend=True,minimal=True)                                                                                                   \n276 ms \u00b1 1.68 ms per loop (mean \u00b1 std. dev. of 7 runs, 1 loop each)\n```\n",
    "created_at": "2020-11-22T20:39:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30709#issuecomment-439048",
    "user": "@kliem"
}
```

Apparently it is at least better asymptotically.


```
sage: P = polytopes.permutahedron(5)                                                                                                                                                
sage: %timeit P.affine_hull_projection(orthonormal=True,extend=True)                                                                                                                
78.9 ms ± 216 µs per loop (mean ± std. dev. of 7 runs, 10 loops each)
sage: %timeit P.affine_hull_projection(orthonormal=True,extend=True,minimal=True)                                                                                                   
119 ms ± 362 µs per loop (mean ± std. dev. of 7 runs, 10 loops each)
sage: P = polytopes.permutahedron(6)                                                                                                                                                
sage: %timeit P.affine_hull_projection(orthonormal=True,extend=True)                                                                                                                
334 ms ± 2.84 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)
sage: %timeit P.affine_hull_projection(orthonormal=True,extend=True,minimal=True)                                                                                                   
276 ms ± 1.68 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)
```




---

archive/issue_comments_439049.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-11-22T20:43:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30709#issuecomment-439049",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_439050.json:
```json
{
    "body": "... forgot to add an example. ;)",
    "created_at": "2020-11-22T20:43:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30709#issuecomment-439050",
    "user": "jipilab"
}
```

... forgot to add an example. ;)



---

archive/issue_comments_439051.json:
```json
{
    "body": "Replying to [comment:4 gh-kliem]:\n> Apparently it is at least better asymptotically.\n> \n> {{{\n> sage: P = polytopes.permutahedron(5)                                                                                                                                                \n> sage: %timeit P.affine_hull_projection(orthonormal=True,extend=True)                                                                                                                \n> 78.9 ms \u00b1 216 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 10 loops each)\n> sage: %timeit P.affine_hull_projection(orthonormal=True,extend=True,minimal=True)                                                                                                   \n> 119 ms \u00b1 362 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 10 loops each)\n> sage: P = polytopes.permutahedron(6)                                                                                                                                                \n> sage: %timeit P.affine_hull_projection(orthonormal=True,extend=True)                                                                                                                \n> 334 ms \u00b1 2.84 ms per loop (mean \u00b1 std. dev. of 7 runs, 1 loop each)\n> sage: %timeit P.affine_hull_projection(orthonormal=True,extend=True,minimal=True)                                                                                                   \n> 276 ms \u00b1 1.68 ms per loop (mean \u00b1 std. dev. of 7 runs, 1 loop each)\n> }}}\n\nYes, I am outsourcing of course. The point is of course to apply the matrix to other potential polytopes as it was the idea behind the problem that led to this ticket.\n\nFurther, it is an \"unfair\" comparison, since `minimal=True` **does** **more**, since it really computes the minimal polynomial (which is not done for polytopes if I am not mistaken, you might disagree here, it has been a while).\n\nBut cool that it seems to be a bit faster for larger stuff. :)",
    "created_at": "2020-11-22T20:50:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30709#issuecomment-439051",
    "user": "jipilab"
}
```

Replying to [comment:4 gh-kliem]:
> Apparently it is at least better asymptotically.
> 
> {{{
> sage: P = polytopes.permutahedron(5)                                                                                                                                                
> sage: %timeit P.affine_hull_projection(orthonormal=True,extend=True)                                                                                                                
> 78.9 ms ± 216 µs per loop (mean ± std. dev. of 7 runs, 10 loops each)
> sage: %timeit P.affine_hull_projection(orthonormal=True,extend=True,minimal=True)                                                                                                   
> 119 ms ± 362 µs per loop (mean ± std. dev. of 7 runs, 10 loops each)
> sage: P = polytopes.permutahedron(6)                                                                                                                                                
> sage: %timeit P.affine_hull_projection(orthonormal=True,extend=True)                                                                                                                
> 334 ms ± 2.84 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)
> sage: %timeit P.affine_hull_projection(orthonormal=True,extend=True,minimal=True)                                                                                                   
> 276 ms ± 1.68 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)
> }}}

Yes, I am outsourcing of course. The point is of course to apply the matrix to other potential polytopes as it was the idea behind the problem that led to this ticket.

Further, it is an "unfair" comparison, since `minimal=True` **does** **more**, since it really computes the minimal polynomial (which is not done for polytopes if I am not mistaken, you might disagree here, it has been a while).

But cool that it seems to be a bit faster for larger stuff. :)



---

archive/issue_comments_439052.json:
```json
{
    "body": "I modified the description of the ticket to make this more clear that the option \"minimal=True\" does not have the goal to be faster, but rather to simply provide a different type of output.",
    "created_at": "2020-11-22T20:54:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30709#issuecomment-439052",
    "user": "jipilab"
}
```

I modified the description of the ticket to make this more clear that the option "minimal=True" does not have the goal to be faster, but rather to simply provide a different type of output.



---

archive/issue_comments_439053.json:
```json
{
    "body": "Well, I would expect it to be asymptotically faster, as I was seeing those bad timings with matrix computations with `AA`.",
    "created_at": "2020-11-22T21:04:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30709#issuecomment-439053",
    "user": "@kliem"
}
```

Well, I would expect it to be asymptotically faster, as I was seeing those bad timings with matrix computations with `AA`.



---

archive/issue_comments_439054.json:
```json
{
    "body": "Could you perhaps fix this:\n\n```\n-found 0 pyflakes errors in the modified files\n+src/sage/geometry/polyhedron/base.py:4793:17 local variable 'R' is assigned to but never used\n```\n\n\nInstead of adopting this syntax\n\n```\n+        - ``minimal`` (boolean, default = False) --\n```\n\nI would propse changing `affine_hull_projection` to standard syntax.\n\nForgot spaces:\n\n```diff\n-                    new_ring = number_field_elements_from_algebraics(A.list(),embedded=True,minimal=True)[0]\n+                    new_ring = number_field_elements_from_algebraics(A.list(), embedded=True, minimal=True)[0]\n```\n\n\nAlso the previous is a super long line. Maybe you can change this along with\n\n```\n return linear_transformation(matrix(self.base_ring(), self.dim(), self.dim(), self.base_ring().one())), self.ambient_space().zero()\n```\n",
    "created_at": "2020-11-23T07:56:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30709#issuecomment-439054",
    "user": "@kliem"
}
```

Could you perhaps fix this:

```
-found 0 pyflakes errors in the modified files
+src/sage/geometry/polyhedron/base.py:4793:17 local variable 'R' is assigned to but never used
```


Instead of adopting this syntax

```
+        - ``minimal`` (boolean, default = False) --
```

I would propse changing `affine_hull_projection` to standard syntax.

Forgot spaces:

```diff
-                    new_ring = number_field_elements_from_algebraics(A.list(),embedded=True,minimal=True)[0]
+                    new_ring = number_field_elements_from_algebraics(A.list(), embedded=True, minimal=True)[0]
```


Also the previous is a super long line. Maybe you can change this along with

```
 return linear_transformation(matrix(self.base_ring(), self.dim(), self.dim(), self.base_ring().one())), self.ambient_space().zero()
```




---

archive/issue_comments_439055.json:
```json
{
    "body": "the pyflakes warning can be fixed by adding \"assert R\" just after the line",
    "created_at": "2020-11-23T08:38:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30709#issuecomment-439055",
    "user": "chapoton"
}
```

the pyflakes warning can be fixed by adding "assert R" just after the line



---

archive/issue_comments_439056.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-11-23T10:29:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30709#issuecomment-439056",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_439057.json:
```json
{
    "body": "LGTM.",
    "created_at": "2020-11-23T14:48:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30709#issuecomment-439057",
    "user": "@kliem"
}
```

LGTM.



---

archive/issue_comments_439058.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-11-23T14:48:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30709#issuecomment-439058",
    "user": "@kliem"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_439059.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-11-29T11:57:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30709",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30709#issuecomment-439059",
    "user": "vbraun"
}
```

Resolution: fixed
