# Issue 19319: upgrade matplotlib to 1.5.0

Issue created by migration from Trac.

Original creator: fbissey

Original creation time: 2015-11-08 22:45:23

I want to update matplotlib to 1.5.0 at the same time as updating numpy to 1.10.1 as this fixes a number of undesirable warnings.

Matplotlib 1.5.0 as a new unconditional dependency called cycler that needs to be included as well.

Sources:
 * [https://pypi.python.org/packages/source/C/Cycler/cycler-0.9.0.tar.gz](https://pypi.python.org/packages/source/C/Cycler/cycler-0.9.0.tar.gz)
 * [http://www.lmona.de/files/sage/matplotlib-1.5.0.tar.bz2](http://www.lmona.de/files/sage/matplotlib-1.5.0.tar.bz2)


---

Comment by fbissey created at 2015-11-08 22:46:32

Doctests still to be fixed.


---

Comment by git created at 2015-11-08 23:06:19

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-11-09 00:58:12

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-11-09 01:55:10

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by fbissey created at 2015-11-10 02:26:00

In `src/sage/plot/graphics.py` the deprecation warning is in the `add_primitive` method and more precisely `sage: G.add_primitive(A)` in 

```
sage: G = Graphics()
            sage: from sage.plot.line import Line
            sage: from sage.plot.arrow import Arrow
            sage: L = Line([3,4,2,7,-2],[1,2,e,4,5.],{'alpha':1,'thickness':2,'rgbcolor':(0,1,1),'legend_label':''})
            sage: A = Arrow(2,-5,.1,.2,{'width':3,'head':0,'rgbcolor':(1,0,0),'linestyle':'dashed','zorder':8,'legend_label':''})
            sage: G.add_primitive(L)
            sage: G.add_primitive(A)
            sage: G
            doctest:...: DeprecationWarning: elementwise == comparison failed; this will raise an error in the future.
            Graphics object consisting of 2 graphics primitives
```

I am trying to narrow down the offending code.


---

Comment by fbissey created at 2015-11-10 09:05:18

Guilty bit is in `sage/plot/arrow.py`

```
        if options['linestyle']!='solid':
            # The next few lines work around a design issue in matplotlib. Currently, the specified
            # linestyle is used to draw both the path and the arrowhead.  If linestyle is 'dashed', this
            # looks really odd.  This code is from Jae-Joon Lee in response to a post to the matplotlib mailing
            # list.  See http://sourceforge.net/mailarchive/forum.php?thread_name=CAG%3DuJ%2Bnw2dE05P9TOXTz_zp-mGP3cY801vMH7yt6vgP9_WzU8w%40mail.gmail.com&forum_name=matp$

            import matplotlib.patheffects as pe
            class CheckNthSubPath(object):
                def __init__(self, patch, n):
                    """
                    creates an callable object that returns True if the provided
                    path is the n-th path from the patch.
                    """
                    self._patch = patch
                    self._n = n

                def get_paths(self, renderer):
                    self._patch.set_dpi_cor(renderer.points_to_pixels(1.))
                    paths, fillables = self._patch.get_path_in_displaycoord()
                    return paths

                def __call__(self, renderer, gc, tpath, affine, rgbFace):
                    path = self.get_paths(renderer)[self._n]
                    vert1, code1 = path.vertices, path.codes
                    import numpy as np

                    if np.all(vert1 == tpath.vertices) and np.all(code1 == tpath.codes):
                        return True
                    else:
                        return False
```

`np.all(vert1 == tpath.vertices) and np.all(code1 == tpath.codes)` is the elementwise comparison(s). This will need replacing.


---

Comment by git created at 2015-11-10 11:51:25

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by fbissey created at 2015-11-10 11:55:34

Removed the commits from the scipy branch (#17643) that where incorrectly merged here and got a better fix for the doctest warning. It appears that they are coming from `sage` itself not `matplotlib`.


---

Comment by git created at 2015-11-10 22:21:42

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by fbissey created at 2015-11-11 00:21:26

New commits:


---

Comment by fbissey created at 2015-11-11 00:21:26

Changing status from new to needs_review.


---

Comment by git created at 2015-11-14 07:47:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vbraun created at 2015-11-22 21:07:59

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2015-11-23 18:08:17

Resolution: fixed


---

Comment by vbraun created at 2015-11-23 21:47:48

Resolution changed from fixed to 


---

Comment by vbraun created at 2015-11-23 21:47:48

Changing status from closed to new.


---

Comment by git created at 2015-11-23 22:02:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by fbissey created at 2015-11-23 22:06:46

Changing status from new to needs_review.


---

Comment by vbraun created at 2015-11-24 13:01:16

Resolution: fixed
