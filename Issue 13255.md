# Issue 13255: Numerical noise causing sage/numerical/optimize.py to fail on SPARC

archive/issues_013255.json:
```json
{
    "body": "Assignee: jason, jkantor\n\nCC:  @nathanncohen @jhpalmieri @jdemeyer\n\nKeywords: solaris, glpk\n\nUsing:\n\n* Sage 5.3.rc0 built with gcc 4.5.0 (i.e. NOT the gcc in Sage)\n* Solaris 10 3/05 s10_74L2a SPARC\n* Sun Blade 2000 with two 1200 MHz UltraSPARC III CPUs\n\n\n```\nFile \"/export/home/drkirkby/sage-5.3.rc0/devel/sage-main/sage/numerical/optimize.py\", line 135:\n\n  sage: find_local_maximum(fast_float(8*e^ (-x)*sin(x) - 1, x), 0, 8)^\n\nExpected:\n\n  (1.579175535558..., 0.78539817...)\n\nGot:\n\n  (1.5791755355586758, 0.78539816111340355)\n```\n\nActually, the result returned on SPARC is more accurate in this instance, as according to Mathematica 7 at least,\n\n\n```\nIn[3]:= FindMaximum[8 E^(-x) Sin[x] -1,{x,0,8},WorkingPrecision->50]\n\nOut[3]= {1.5791755355586755940189354764810356787023224274029, \n \n>    {x -> 0.78539816339744830961566077712689095303902649201882}}\n\nIn[4]:= \n```\n\nSo on SPARC, the relative error is 2.91x10<sup>-9</sup> and the absolute error of -2.28x10<sup>-9</sup> So the test needs changing to '0.7853981...' rather than '0.78539817...'\n\nI'll attach a patch later.\n\nDave\n\nIssue created by migration from https://trac.sagemath.org/ticket/13427\n\n",
    "created_at": "2012-09-04T07:05:08Z",
    "labels": [
        "component: numerical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.4",
    "title": "Numerical noise causing sage/numerical/optimize.py to fail on SPARC",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13255",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```
Assignee: jason, jkantor

CC:  @nathanncohen @jhpalmieri @jdemeyer

Keywords: solaris, glpk

Using:

* Sage 5.3.rc0 built with gcc 4.5.0 (i.e. NOT the gcc in Sage)
* Solaris 10 3/05 s10_74L2a SPARC
* Sun Blade 2000 with two 1200 MHz UltraSPARC III CPUs


```
File "/export/home/drkirkby/sage-5.3.rc0/devel/sage-main/sage/numerical/optimize.py", line 135:

  sage: find_local_maximum(fast_float(8*e^ (-x)*sin(x) - 1, x), 0, 8)^

Expected:

  (1.579175535558..., 0.78539817...)

Got:

  (1.5791755355586758, 0.78539816111340355)
```

Actually, the result returned on SPARC is more accurate in this instance, as according to Mathematica 7 at least,


```
In[3]:= FindMaximum[8 E^(-x) Sin[x] -1,{x,0,8},WorkingPrecision->50]

Out[3]= {1.5791755355586755940189354764810356787023224274029, 
 
>    {x -> 0.78539816339744830961566077712689095303902649201882}}

In[4]:= 
```

So on SPARC, the relative error is 2.91x10<sup>-9</sup> and the absolute error of -2.28x10<sup>-9</sup> So the test needs changing to '0.7853981...' rather than '0.78539817...'

I'll attach a patch later.

Dave

Issue created by migration from https://trac.sagemath.org/ticket/13427





---

archive/issue_comments_162239.json:
```json
{
    "body": "Finding that there's a local max at x=pi/4 is of course just a freshman's calculus exercise. I don't think this test is very good, though, because there is another local max at x=9/4*pi, which also lies in the interval (0,8). So you could get a wildly different answer that isn't wrong. Shortening the interval to (0,7) would do the trick. Or is this test for something in particular?",
    "created_at": "2012-09-04T08:14:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13255#issuecomment-162239",
    "user": "https://github.com/nbruin"
}
```

Finding that there's a local max at x=pi/4 is of course just a freshman's calculus exercise. I don't think this test is very good, though, because there is another local max at x=9/4*pi, which also lies in the interval (0,8). So you could get a wildly different answer that isn't wrong. Shortening the interval to (0,7) would do the trick. Or is this test for something in particular?



---

archive/issue_comments_162240.json:
```json
{
    "body": "There is indeed another maximum, and the function will find it if the range is set from 7 to 8, rather than 0 to 8.\n\n\n```\nsage: find_local_maximum(fast_float(8*e^ (-x)*sin(x) - 1, x), 0, 8)\n(1.5791755355586758, 0.78539816111340355)\nsage: find_local_maximum(fast_float(8*e^ (-x)*sin(x) - 1, x), 7, 8)\n(-0.9951835373923219, 7.0685835822289791)\n```\n\n\nSo perhaps the test does need two changes.",
    "created_at": "2012-09-04T09:00:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13255#issuecomment-162240",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

There is indeed another maximum, and the function will find it if the range is set from 7 to 8, rather than 0 to 8.


```
sage: find_local_maximum(fast_float(8*e^ (-x)*sin(x) - 1, x), 0, 8)
(1.5791755355586758, 0.78539816111340355)
sage: find_local_maximum(fast_float(8*e^ (-x)*sin(x) - 1, x), 7, 8)
(-0.9951835373923219, 7.0685835822289791)
```


So perhaps the test does need two changes.



---

archive/issue_comments_162241.json:
```json
{
    "body": "Attachment [13427.patch](tarball://root/attachments/some-uuid/ticket13427/13427.patch) by drkirkby created at 2012-09-04 10:37:48\n\nPatch to fix two issues - numerical noise, and the fact there are two maximum in the range 0 to 8.",
    "created_at": "2012-09-04T10:37:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13255#issuecomment-162241",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

Attachment [13427.patch](tarball://root/attachments/some-uuid/ticket13427/13427.patch) by drkirkby created at 2012-09-04 10:37:48

Patch to fix two issues - numerical noise, and the fact there are two maximum in the range 0 to 8.



---

archive/issue_comments_162242.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-09-04T10:39:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13255#issuecomment-162242",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_162243.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-09-04T11:42:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13255#issuecomment-162243",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_162244.json:
```json
{
    "body": "Looks good to me!",
    "created_at": "2012-09-04T11:42:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13255#issuecomment-162244",
    "user": "https://github.com/vbraun"
}
```

Looks good to me!



---

archive/issue_events_013159.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-09-10T06:31:27Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/13255",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13255#event-13159"
}
```



---

archive/issue_comments_162245.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-09-10T06:31:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13255#issuecomment-162245",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed
