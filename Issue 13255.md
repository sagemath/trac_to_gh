# Issue 13255: Numerical noise causing sage/numerical/optimize.py to fail on SPARC

Issue created by migration from Trac.

Original creator: drkirkby

Original creation time: 2012-09-04 07:05:08

Assignee: jason, jkantor

CC:  ncohen jhpalmieri jdemeyer

Keywords: solaris, glpk

Using:

 * Sage 5.3.rc0 built with gcc 4.5.0 (i.e. NOT the gcc in Sage)
 * Solaris 10 3/05 s10_74L2a SPARC
 * Sun Blade 2000 with two 1200 MHz UltraSPARC III CPUs


```
File "/export/home/drkirkby/sage-5.3.rc0/devel/sage-main/sage/numerical/optimize.py", line 135:

  sage: find_local_maximum(fast_float(8*e^ (-x)*sin(x) - 1, x), 0, 8)^

Expected:

  (1.579175535558..., 0.78539817...)

Got:

  (1.5791755355586758, 0.78539816111340355)
```

Actually, the result returned on SPARC is more accurate in this instance, as according to Mathematica 7 at least,


```
In[3]:= FindMaximum[8 E^(-x) Sin[x] -1,{x,0,8},WorkingPrecision->50]

Out[3]= {1.5791755355586755940189354764810356787023224274029, 
 
>    {x -> 0.78539816339744830961566077712689095303902649201882}}

In[4]:= 
```

So on SPARC, the relative error is 2.91x10<sup>-9</sup> and the absolute error of -2.28x10<sup>-9</sup> So the test needs changing to '0.7853981...' rather than '0.78539817...'

I'll attach a patch later.

Dave


---

Comment by nbruin created at 2012-09-04 08:14:20

Finding that there's a local max at x=pi/4 is of course just a freshman's calculus exercise. I don't think this test is very good, though, because there is another local max at x=9/4*pi, which also lies in the interval (0,8). So you could get a wildly different answer that isn't wrong. Shortening the interval to (0,7) would do the trick. Or is this test for something in particular?


---

Comment by drkirkby created at 2012-09-04 09:00:42

There is indeed another maximum, and the function will find it if the range is set from 7 to 8, rather than 0 to 8.


```
sage: find_local_maximum(fast_float(8*e^ (-x)*sin(x) - 1, x), 0, 8)
(1.5791755355586758, 0.78539816111340355)
sage: find_local_maximum(fast_float(8*e^ (-x)*sin(x) - 1, x), 7, 8)
(-0.9951835373923219, 7.0685835822289791)
```


So perhaps the test does need two changes.


---

Attachment

Patch to fix two issues - numerical noise, and the fact there are two maximum in the range 0 to 8.


---

Comment by drkirkby created at 2012-09-04 10:39:17

Changing status from new to needs_review.


---

Comment by vbraun created at 2012-09-04 11:42:12

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2012-09-04 11:42:12

Looks good to me!


---

Comment by jdemeyer created at 2012-09-10 06:31:27

Resolution: fixed
