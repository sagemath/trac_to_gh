# Issue 17483: failing primary decomposition with extension field coefficients

archive/issues_017483.json:
```json
{
    "body": "CC:  simonking @malb\n\nKeywords: Singular\n\nThe following bugs are likely Singular interface bugs (have to investigate):\nsince the same examples run using shipped Singular behave differently\n\nIt may also relate to Singular's variable shadowing issue, see next ticket\n\n0. working example:\n\n```\nsage: R.<b>=QQ[]\nsage: K.<b>=QQ.extension(b^2-b-1)\nsage: r.<x,z>=K[]\nsage: I=r.ideal(z)\nsage: L = I.primary_decomposition(\"gtz\")\nsage: [ J.gens() for J in L]\n#[[z]]\n```\n\n1. example with wrong result:\n\n```\nsage: R.<p>=QQ[]\nsage: K.<p>=QQ.extension(p^2-p-1)\nsage: r.<x,z>=K[]\nsage: I=r.ideal(z)\nsage: L = I.primary_decomposition(\"gtz\") # wrong!\nsage: [ J.gens() for J in L] \n#[[0, 0]]\n```\n\n2. crashing example:\n\n```\nsage: R.<p>=QQ[]\nsage: K.<p>=QQ.extension(p^2-p-1)\nsage: r.<x,z>=K[]\nsage:  \nsage: I=r.ideal(z)\nsage: I.primary_decomposition()\n#RuntimeError: Error in Singular function call 'primdecSY':\n# identifier pr not found in RH\n# error occurred in or before primdec.lib::algeDeco line 2732: `      list pr=imap(RH,pr);`\n# leaving primdec.lib::algeDeco\n# leaving primdec.lib::primdecSY\n```\n\n\ncorresponding Singular code:\n\n```\nLIB(\"primdec.lib\");\nring rng = (0,p),(x,z), dp;\nminpoly = p^2-p-1;\nideal I  = z;\nprimdecGTZ(I);\n\n\nLIB(\"primdec.lib\");\nring rng = (0,b),(x,z), dp;\nminpoly = b^2-b-1;\nideal I  = z;\nprimdecGTZ(I);\n\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/17720\n\n",
    "created_at": "2015-02-03T14:59:55Z",
    "labels": [
        "interfaces",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.3",
    "title": "failing primary decomposition with extension field coefficients",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17483",
    "user": "jakobkroeker"
}
```
CC:  simonking @malb

Keywords: Singular

The following bugs are likely Singular interface bugs (have to investigate):
since the same examples run using shipped Singular behave differently

It may also relate to Singular's variable shadowing issue, see next ticket

0. working example:

```
sage: R.<b>=QQ[]
sage: K.<b>=QQ.extension(b^2-b-1)
sage: r.<x,z>=K[]
sage: I=r.ideal(z)
sage: L = I.primary_decomposition("gtz")
sage: [ J.gens() for J in L]
#[[z]]
```

1. example with wrong result:

```
sage: R.<p>=QQ[]
sage: K.<p>=QQ.extension(p^2-p-1)
sage: r.<x,z>=K[]
sage: I=r.ideal(z)
sage: L = I.primary_decomposition("gtz") # wrong!
sage: [ J.gens() for J in L] 
#[[0, 0]]
```

2. crashing example:

```
sage: R.<p>=QQ[]
sage: K.<p>=QQ.extension(p^2-p-1)
sage: r.<x,z>=K[]
sage:  
sage: I=r.ideal(z)
sage: I.primary_decomposition()
#RuntimeError: Error in Singular function call 'primdecSY':
# identifier pr not found in RH
# error occurred in or before primdec.lib::algeDeco line 2732: `      list pr=imap(RH,pr);`
# leaving primdec.lib::algeDeco
# leaving primdec.lib::primdecSY
```


corresponding Singular code:

```
LIB("primdec.lib");
ring rng = (0,p),(x,z), dp;
minpoly = p^2-p-1;
ideal I  = z;
primdecGTZ(I);


LIB("primdec.lib");
ring rng = (0,b),(x,z), dp;
minpoly = b^2-b-1;
ideal I  = z;
primdecGTZ(I);

```


Issue created by migration from https://trac.sagemath.org/ticket/17720





---

archive/issue_comments_233608.json:
```json
{
    "body": "Tracked down to the shadowing bug ( see [Singular forum discussion](http://www.singular.uni-kl.de/forum/viewtopic.php?f=10&t=2482&sid=64e9f0044ed3cf5020d494a45172f3dc)):\nin cases we use `p` as parameter name minpoly gets lost in primdec.lib::algedeco() \nin `(execute(mp) := execute(\"poly p = p^2-p-1\"))` statement.\nThe strange thing about this is that while calling Singular from sage \nits losing `'p^2-p'` part , but when using standalone Singular, it is keeping `'p^2'` and losing `'-p'`.\nStrange.",
    "created_at": "2015-02-21T08:44:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17483#issuecomment-233608",
    "user": "jakobkroeker"
}
```

Tracked down to the shadowing bug ( see [Singular forum discussion](http://www.singular.uni-kl.de/forum/viewtopic.php?f=10&t=2482&sid=64e9f0044ed3cf5020d494a45172f3dc)):
in cases we use `p` as parameter name minpoly gets lost in primdec.lib::algedeco() 
in `(execute(mp) := execute("poly p = p^2-p-1"))` statement.
The strange thing about this is that while calling Singular from sage 
its losing `'p^2-p'` part , but when using standalone Singular, it is keeping `'p^2'` and losing `'-p'`.
Strange.



---

archive/issue_comments_233609.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-01-29T03:07:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17483#issuecomment-233609",
    "user": "@DaveWitteMorris"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_233610.json:
```json
{
    "body": "Changing priority from major to minor.",
    "created_at": "2021-01-29T03:07:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17483#issuecomment-233610",
    "user": "@DaveWitteMorris"
}
```

Changing priority from major to minor.



---

archive/issue_comments_233611.json:
```json
{
    "body": "The two previously failing examples work now, so the PR adds them as doctests.\n----\nNew commits:",
    "created_at": "2021-01-29T03:07:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17483#issuecomment-233611",
    "user": "@DaveWitteMorris"
}
```

The two previously failing examples work now, so the PR adds them as doctests.
----
New commits:



---

archive/issue_comments_233612.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-02-17T20:34:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17483#issuecomment-233612",
    "user": "@mwageringel"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_233613.json:
```json
{
    "body": "This looks good to me.",
    "created_at": "2021-02-17T20:34:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17483#issuecomment-233613",
    "user": "@mwageringel"
}
```

This looks good to me.



---

archive/issue_comments_233614.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-03-09T00:00:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17483#issuecomment-233614",
    "user": "@vbraun"
}
```

Resolution: fixed
