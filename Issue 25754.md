# Issue 25754: translation issue of erfc(x) to FriCAS

Issue created by migration from Trac.

Original creator: @nasser1

Original creation time: 2018-08-03 00:52:35

Keywords: erfc,fricas,integrate

Using [SageMath](SageMath) version 8.3.rc3, Release Date: 2018-07-28,
erfc() is translated OK to maxima and giac but not to Fricas



```
sage: var('x')
x
sage: integrate(erfc(x),x)
x*erfc(x) - e^(-x^2)/sqrt(pi)
sage: integrate(erfc(x),x,algorithm="giac")
-x*erf(x) + x - e^(-x^2)/sqrt(pi)
sage: integrate(erfc(x),x,algorithm="fricas")
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-4-2d8a308f29da> in <module>()
----> 1 integrate(erfc(x),x,algorithm="fricas")

/usr/lib/python2.7/site-packages/sage/misc/functional.py in integral(x, *args, **kwds)
    751     """
    752     if hasattr(x, 'integral'):
--> 753         return x.integral(*args, **kwds)
    754     else:
    755         from sage.symbolic.ring import SR

/usr/lib/python2.7/site-packages/sage/symbolic/expression.pyx in sage.symbolic.expression.Expression.integral (build/cythonized/sage/symbolic/expression.cpp:69759)()
  12364                     R = ring.SR
  12365             return R(integral(f, v, a, b, **kwds))
> 12366         return integral(self, *args, **kwds)
  12367 
  12368     integrate = integral

/usr/lib/python2.7/site-packages/sage/symbolic/integration/integral.py in integrate(expression, v, a, b, algorithm, hold)
    814         if not integrator:
    815             raise ValueError("Unknown algorithm: %s" % algorithm)
--> 816         return integrator(expression, v, a, b)
    817     if a is None:
    818         return indefinite_integral(expression, v, hold=hold)

/usr/lib/python2.7/site-packages/sage/symbolic/integration/external.py in fricas_integrator(expression, v, a, b, noPole)
    173 
    174     from sage.interfaces.fricas import fricas
--> 175     ex = fricas(expression)
    176 
    177     if a is None:

/usr/lib/python2.7/site-packages/sage/interfaces/interface.py in __call__(self, x, name)
    280             return cls(self, x, name=name)
    281         try:
--> 282             return self._coerce_from_special_method(x)
    283         except TypeError:
    284             raise

/usr/lib/python2.7/site-packages/sage/interfaces/interface.py in _coerce_from_special_method(self, x)
    306             s = '_gp_'
    307         try:
--> 308             return (x.__getattribute__(s))(self)
    309         except AttributeError:
    310             return self(x._interface_init_())

/usr/lib/python2.7/site-packages/sage/structure/sage_object.pyx in sage.structure.sage_object.SageObject._fricas_ (build/cythonized/sage/structure/sage_object.c:7729)()
    807             import sage.interfaces.fricas
    808             G = sage.interfaces.fricas.fricas
--> 809         return self._interface_(G)
    810 
    811     def _fricas_init_(self):

/usr/lib/python2.7/site-packages/sage/symbolic/expression.pyx in sage.symbolic.expression.Expression._interface_ (build/cythonized/sage/symbolic/expression.cpp:7825)()
    792         if is_a_constant(self._gobj):
    793             return self.pyobject()._interface_(I)
--> 794         return super(Expression, self)._interface_(I)
    795 
    796     def _maxima_(self, session=None):

/usr/lib/python2.7/site-packages/sage/structure/sage_object.pyx in sage.structure.sage_object.SageObject._interface_ (build/cythonized/sage/structure/sage_object.c:5895)()
    741             except Exception:
    742                 raise NotImplementedError("coercion of object %s to %s not implemented:\n%s\n%s" % (repr(self), I))
--> 743         X = I(s)
    744         if c:
    745             try:

/usr/lib/python2.7/site-packages/sage/interfaces/interface.py in __call__(self, x, name)
    278 
    279         if isinstance(x, string_types):
--> 280             return cls(self, x, name=name)
    281         try:
    282             return self._coerce_from_special_method(x)

/usr/lib/python2.7/site-packages/sage/interfaces/expect.py in __init__(self, parent, value, is_name, name)
   1443             except (RuntimeError, ValueError) as x:
   1444                 self._session_number = -1
-> 1445                 raise_(TypeError, TypeError(*x.args), sys.exc_info()[2])
   1446             except BaseException:
   1447                 self._session_number = -1

/usr/lib/python2.7/site-packages/sage/interfaces/expect.py in __init__(self, parent, value, is_name, name)
   1438         else:
   1439             try:
-> 1440                 self._name = parent._create(value, name=name)
   1441             # Convert ValueError and RuntimeError to TypeError for
   1442             # coercion to work properly.

/usr/lib/python2.7/site-packages/sage/interfaces/interface.py in _create(self, value, name)
    474     def _create(self, value, name=None):
    475         name = self._next_var_name() if name is None else name
--> 476         self.set(name, value)
    477         return name
    478 

/usr/lib/python2.7/site-packages/sage/interfaces/fricas.py in set(self, var, value)
    544         cmd = '%s%s%s;'%(var,self._assign_symbol(), value)
    545         output = self.eval(cmd, reformat=False)
--> 546         self._check_errors(value, output)
    547 
    548     def get(self, var):

/usr/lib/python2.7/site-packages/sage/interfaces/fricas.py in _check_errors(self, line, output)
    518             for old, new in replacements:
    519                 output = output.replace(old, new)
--> 520             raise RuntimeError("An error occurred when FriCAS evaluated '%s':\n%s" % (line, output))
    521 
    522         # or even an error

TypeError: An error occurred when FriCAS evaluated 'erfc(x)':
   There are no library operations named erfc 
      Use HyperDoc Browse or issue
                                 )what op erfc
      to learn if there is any operation containing " erfc " in its name.

 
   Cannot find a definition or applicable library operation named erfc 
      with argument type(s) 
                                  Variable(x)
      
      Perhaps you should use "`@`" to indicate the required return type, or 
      "$" to specify which version of the function you need.
```



The problem is that FriCAS itself does not have erfc(), but has only erf().

SageMath can translate `erfc()` to `1-erf()` to make this interface work.

This issue is causing many integrals to fail with changing the algorithm to fricas.


i.e. `erfc(x)` becomes `1-erf(x)` when the algorithm is fricas.

Thank you

--Nasser



---

Comment by mantepse created at 2018-09-08 18:28:25

Changing status from new to needs_review.


---

Comment by mantepse created at 2018-09-08 18:28:25

trivial fix.  pyflakes reports that very likely

```
from sage.structure.all import parent as s_parent
```

is missing, but I cannot produce a bug.  It would be called in `_evalf_` like

```
    def _evalf_(self, x, parent=None, algorithm=None):
        """
        EXAMPLES::

            sage: erfc(4).n()
            1.54172579002800e-8
            sage: erfc(4).n(100)
            1.5417257900280018852159673487e-8
            sage: erfc(4*I).n(100)
            1.0000000000000000000000000000 - 1.2969597307176392315279409506e6*I
        """
        R = parent or s_parent(x)
        import mpmath
        return mpmath_utils.call(mpmath.erfc, x, parent=R)
```

----
New commits:


---

Comment by mantepse created at 2018-09-08 18:28:25

Changing type from PLEASE CHANGE to enhancement.


---

Comment by tscrim created at 2018-09-08 21:23:49

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2018-09-08 21:23:49

My guess is that it always gets sent a `parent`, but that is an unrelated issue and can be dealt with when we have a genuine report.


---

Comment by vbraun created at 2018-09-10 19:14:55

Resolution: fixed


---

Comment by slelievre created at 2018-09-11 11:44:54

Watch out, you need `TESTS::` instead of `TESTS:`.

As is, the added test block does not actually get tested.

Might be worth a follow-up ticket.


---

Comment by mantepse created at 2018-09-11 15:38:22

Replying to [comment:5 slelievre]:
> Watch out, you need `TESTS::` instead of `TESTS:`.
> 
> As is, the added test block does not actually get tested.

Are you sure?  There are roughly 2000 occurrences of `TESTS:` without a second `:`!


---

Comment by slelievre created at 2018-09-11 23:20:45

If I understand correctly, there is a choice between two forms for
EXAMPLES blocks (and similarly for EXAMPLE or TESTS or TEST blocks).

Either use `EXAMPLES::` with double colon, followed by a blank line followed by a single block of examples:

```
    EXAMPLES::

        sage: 2 + 2
        4
        sage: 2*2
        4
        sage: 2^2
        4
```

(if the docstring continues with other stuff than the EXAMPLES block,
there should be a blank line between the EXAMPLES block and what follows;
if the docstring ends after the EXAMPLES block, no need for a blank line
between the EXAMPLES block and the `"""` that ends the docstring).

Or use `EXAMPLES:` with single colon, and sentences ending in `::`
for each "sub-block" of the EXAMPLES block:

```
    EXAMPLES:

    We perform addition. ::

        sage: 2 + 2
        4

    We perform multiplication. ::

        sage: 2*2
        4

    We perform exponentiation. ::

        sage: 2^2
        4
```


Occurrences of `TESTS:` without a second colon is okay,
if they are of the second type.


---

Comment by tscrim created at 2018-09-11 23:35:58

If what follows is text (and not suppose to be code, in particular, not indented), then it should not have the second colon. It is that second type you mentioned is what is in this ticket's changes.


---

Comment by slelievre created at 2018-09-12 06:48:54

Ooops, indeed... sorry for the noise.
