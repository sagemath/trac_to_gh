# Issue 10991: Add some patches to PARI

archive/issues_010991.json:
```json
{
    "body": "Assignee: tbd\n\nCC:  mstreng dimpase jpflori\n\nKeywords: pari spkg\n\nWe need to add bugfixes for\n1. [http://pari.math.u-bordeaux.fr/cgi-bin/bugreport.cgi?bug=1147](http://pari.math.u-bordeaux.fr/cgi-bin/bugreport.cgi?bug=1147) (#9334)\n2. [http://pari.math.u-bordeaux.fr/cgi-bin/bugreport.cgi?bug=1153](http://pari.math.u-bordeaux.fr/cgi-bin/bugreport.cgi?bug=1153) (#10195)\n\nIssue created by migration from https://trac.sagemath.org/ticket/11130\n\n",
    "created_at": "2011-04-05T15:01:00Z",
    "labels": [
        "packages: standard",
        "major",
        "bug"
    ],
    "title": "Add some patches to PARI",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10991",
    "user": "jdemeyer"
}
```
Assignee: tbd

CC:  mstreng dimpase jpflori

Keywords: pari spkg

We need to add bugfixes for
1. [http://pari.math.u-bordeaux.fr/cgi-bin/bugreport.cgi?bug=1147](http://pari.math.u-bordeaux.fr/cgi-bin/bugreport.cgi?bug=1147) (#9334)
2. [http://pari.math.u-bordeaux.fr/cgi-bin/bugreport.cgi?bug=1153](http://pari.math.u-bordeaux.fr/cgi-bin/bugreport.cgi?bug=1153) (#10195)

Issue created by migration from https://trac.sagemath.org/ticket/11130





---

archive/issue_comments_119195.json:
```json
{
    "body": "Changing status from new to needs_work.",
    "created_at": "2011-04-05T16:42:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119195",
    "user": "jdemeyer"
}
```

Changing status from new to needs_work.



---

archive/issue_comments_119196.json:
```json
{
    "body": "I am currently testing this.  To avoid duplication of effort, I'll fix things I find in the elliptic_curves directory only.",
    "created_at": "2011-04-23T10:00:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119196",
    "user": "cremona"
}
```

I am currently testing this.  To avoid duplication of effort, I'll fix things I find in the elliptic_curves directory only.



---

archive/issue_comments_119197.json:
```json
{
    "body": "After (1) Building a fresh 4.7.alpha5 from scratch, (2) installing the spkg lined here with \"sage -f\", (3) applying the patch here to the sage library and (4) running \"sage -b\", I find that the Sage build will not start up properly:\n\n```\nImportError                               Traceback (most recent call last)\n...\n\n/home/jec/sage-4.7.alpha5.11130/local/lib/python2.6/site-packages/sage/misc/functional.py in <module>()\n     36 \n     37 \n---> 38 from sage.rings.complex_double import CDF\n     39 from sage.rings.real_double import RDF, RealDoubleElement\n     40 \n\n/home/jec/sage-4.7.alpha5.11130/local/bin/gen.pxd in init sage.rings.complex_double (sage/rings/complex_double.c:15178)()\n\nImportError: /home/jec/sage-4.7.alpha5.11130/local/lib/python2.6/site-packages/sage/libs/pari/gen.so: undefined symbol: defaultOut\nError importing ipy_profile_sage - perhaps you should run %upgrade?\nWARNING: Loading of ipy_profile_sage failed.\n```\n\nso I cannot test anything.  \n\nDid I do something wrong?",
    "created_at": "2011-04-23T11:54:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119197",
    "user": "cremona"
}
```

After (1) Building a fresh 4.7.alpha5 from scratch, (2) installing the spkg lined here with "sage -f", (3) applying the patch here to the sage library and (4) running "sage -b", I find that the Sage build will not start up properly:

```
ImportError                               Traceback (most recent call last)
...

/home/jec/sage-4.7.alpha5.11130/local/lib/python2.6/site-packages/sage/misc/functional.py in <module>()
     36 
     37 
---> 38 from sage.rings.complex_double import CDF
     39 from sage.rings.real_double import RDF, RealDoubleElement
     40 

/home/jec/sage-4.7.alpha5.11130/local/bin/gen.pxd in init sage.rings.complex_double (sage/rings/complex_double.c:15178)()

ImportError: /home/jec/sage-4.7.alpha5.11130/local/lib/python2.6/site-packages/sage/libs/pari/gen.so: undefined symbol: defaultOut
Error importing ipy_profile_sage - perhaps you should run %upgrade?
WARNING: Loading of ipy_profile_sage failed.
```

so I cannot test anything.  

Did I do something wrong?



---

archive/issue_comments_119198.json:
```json
{
    "body": "Replying to [comment:18 cremona]:\n> Did I do something wrong?\n\nThis ticket depends on #11230.",
    "created_at": "2011-04-24T19:05:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119198",
    "user": "jdemeyer"
}
```

Replying to [comment:18 cremona]:
> Did I do something wrong?

This ticket depends on #11230.



---

archive/issue_comments_119199.json:
```json
{
    "body": "Replying to [comment:19 jdemeyer]:\n> Replying to [comment:18 cremona]:\n> > Did I do something wrong?\n> \n> This ticket depends on #11230.\n\nI see!  I'll have some time to spend on this tomorrow (Monday) so I'll have another go.",
    "created_at": "2011-04-24T19:31:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119199",
    "user": "cremona"
}
```

Replying to [comment:19 jdemeyer]:
> Replying to [comment:18 cremona]:
> > Did I do something wrong?
> 
> This ticket depends on #11230.

I see!  I'll have some time to spend on this tomorrow (Monday) so I'll have another go.



---

archive/issue_comments_119200.json:
```json
{
    "body": "Changing assignee from tbd to jdemeyer.",
    "created_at": "2011-04-25T11:01:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119200",
    "user": "jdemeyer"
}
```

Changing assignee from tbd to jdemeyer.



---

archive/issue_comments_119201.json:
```json
{
    "body": "Replying to [comment:17 cremona]:\n> I am currently testing this.  To avoid duplication of effort, I'll fix things I find in the elliptic_curves directory only.\n\nSounds good, I will look at everything else.",
    "created_at": "2011-04-25T13:27:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119201",
    "user": "jdemeyer"
}
```

Replying to [comment:17 cremona]:
> I am currently testing this.  To avoid duplication of effort, I'll fix things I find in the elliptic_curves directory only.

Sounds good, I will look at everything else.



---

archive/issue_comments_119202.json:
```json
{
    "body": "Attachment\n\nApplies after previous",
    "created_at": "2011-04-25T17:47:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119202",
    "user": "cremona"
}
```

Attachment

Applies after previous



---

archive/issue_comments_119203.json:
```json
{
    "body": "I added a patch which fixes the doctest failures in sage/rings/polynomial/polynomial_quotient_ring.py .  In all cases the new output was equivalent to the old.\n\nThere are now just some failures in sage/schemes/elliptic_curves/ell_rational_field.py  (2 doctests failed) and sage/schemes/elliptic_curves/ell_number_field.py (1 doctests failed).",
    "created_at": "2011-04-25T17:49:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119203",
    "user": "cremona"
}
```

I added a patch which fixes the doctest failures in sage/rings/polynomial/polynomial_quotient_ring.py .  In all cases the new output was equivalent to the old.

There are now just some failures in sage/schemes/elliptic_curves/ell_rational_field.py  (2 doctests failed) and sage/schemes/elliptic_curves/ell_number_field.py (1 doctests failed).



---

archive/issue_comments_119204.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-04-25T18:00:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119204",
    "user": "cremona"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_119205.json:
```json
{
    "body": "ell_rational_field.py: only one failure, looks completely trivial but will be left until #11005 to be fixed.\n\nell_number_field.py: one failure, even more trivial:  the final output is exactly the same as it was but the verbose output is a little different, so this can be easily cleaned up at #11005.\n\nAs far as I am concerned this needs *no more work* on this ticket, but I'll delay marking it positive review until the same is possible at #11005.  Still, it certainly gets \"needs review\" on that basis.",
    "created_at": "2011-04-25T18:00:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119205",
    "user": "cremona"
}
```

ell_rational_field.py: only one failure, looks completely trivial but will be left until #11005 to be fixed.

ell_number_field.py: one failure, even more trivial:  the final output is exactly the same as it was but the verbose output is a little different, so this can be easily cleaned up at #11005.

As far as I am concerned this needs *no more work* on this ticket, but I'll delay marking it positive review until the same is possible at #11005.  Still, it certainly gets "needs review" on that basis.



---

archive/issue_comments_119206.json:
```json
{
    "body": "This patch should also be tested on various systems first, PARI is known to produce different results on 32-bit and 64-bit systems.",
    "created_at": "2011-04-25T18:11:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119206",
    "user": "jdemeyer"
}
```

This patch should also be tested on various systems first, PARI is known to produce different results on 32-bit and 64-bit systems.



---

archive/issue_comments_119207.json:
```json
{
    "body": "Replying to [comment:25 jdemeyer]:\n> This patch should also be tested on various systems first, PARI is known to produce different results on 32-bit and 64-bit systems.\n\nGood point.  I can test it on my 32-bit laptop.",
    "created_at": "2011-04-25T19:20:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119207",
    "user": "cremona"
}
```

Replying to [comment:25 jdemeyer]:
> This patch should also be tested on various systems first, PARI is known to produce different results on 32-bit and 64-bit systems.

Good point.  I can test it on my 32-bit laptop.



---

archive/issue_comments_119208.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-04-26T08:38:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119208",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_119209.json:
```json
{
    "body": "In `sage/rings/number_field/number_field.py`, there is a test which fails *only* when `-long` is **not** used.",
    "created_at": "2011-04-26T08:38:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119209",
    "user": "jdemeyer"
}
```

In `sage/rings/number_field/number_field.py`, there is a test which fails *only* when `-long` is **not** used.



---

archive/issue_comments_119210.json:
```json
{
    "body": "New patch fixes the long time issue (by setting a random seed explicitly).  I will test on a Mac OS X 10.4 32-bit PPC system.",
    "created_at": "2011-04-26T15:22:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119210",
    "user": "jdemeyer"
}
```

New patch fixes the long time issue (by setting a random seed explicitly).  I will test on a Mac OS X 10.4 32-bit PPC system.



---

archive/issue_comments_119211.json:
```json
{
    "body": "Testing now on a 32-bit ubuntu system.",
    "created_at": "2011-04-26T20:04:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119211",
    "user": "cremona"
}
```

Testing now on a 32-bit ubuntu system.



---

archive/issue_comments_119212.json:
```json
{
    "body": "Replying to [comment:34 cremona]:\n> Testing now on a 32-bit ubuntu system.\n... which gave several more failures:\n\n```\n\tsage -t  devel/sage-main/sage/rings/number_field/number_field.py # 1 doctests failed\n\tsage -t  devel/sage-main/sage/schemes/elliptic_curves/ell_number_field.py # 2 doctests failed\n\tsage -t  devel/sage-main/sage/schemes/elliptic_curves/ell_rational_field.py # 1 doctests failed\n\tsage -t  devel/sage-main/sage/rings/number_field/number_field_element.pyx # 1 doctests failed\n\tsage -t  devel/sage-main/sage/rings/polynomial/polynomial_quotient_ring.py # 3 doctests failed\n\tsage -t  devel/sage-main/sage/rings/integer.pyx # 1 doctests failed\n```\n\n\nDetails:\n\n```\nsage -t  \"devel/sage-main/sage/rings/number_field/number_field.py\"\n**********************************************************************\nFile \"/home/john/sage-4.7.alpha5/devel/sage-main/sage/rings/number_field/number_field.py\", line 3616:\n    sage: L.factor(a + 1)\nExpected:\n    (Fractional ideal (1/2*a*b + a + 1/2)) * (Fractional ideal (-1/2*b - 1/2*a + 1))\nGot:\n    (Fractional ideal (-1/2*a*b - a - 1/2)) * (Fractional ideal (1/2*b + 1/2*a - 1))\n```\n\nis trivial,\n\n```\nsage -t  \"devel/sage-main/sage/rings/number_field/number_field_element.pyx\"\n**********************************************************************\nFile \"/home/john/sage-4.7.alpha5/devel/sage-main/sage/rings/number_field/number_field_element.pyx\", line 1142:\n    sage: t = (2*a + b)._rnfisnorm(L); t[1]\nExpected:\n    (b - 2)*a + 2*b - 3\nGot:\n    (-4*b - 5)*a + 5*b + 6\n```\n\nneeds looking at, \n\n```\nsage -t  \"devel/sage-main/sage/rings/polynomial/polynomial_quotient_ring.py\"\n```\n\nare just like the ones I fixed before on the other machine, and\n\n```\nsage -t  \"devel/sage-main/sage/rings/integer.pyx\"           \n**********************************************************************\nFile \"/home/john/sage-4.7.alpha5/devel/sage-main/sage/rings/integer.pyx\", line 4389:\n    sage: 7._bnfisnorm(CyclotomicField(7))\nExpected:\n    (-zeta7 + 1, 1)\nGot:\n    (-zeta7^5 + zeta7^4, 1)\n```\n\nis also trivial (multiplying by a power of zeta does not change the norm!).\n\nThat's all I have time for today, so I hope things look similar on the other 32-bit system being tested.",
    "created_at": "2011-04-26T21:40:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119212",
    "user": "cremona"
}
```

Replying to [comment:34 cremona]:
> Testing now on a 32-bit ubuntu system.
... which gave several more failures:

```
	sage -t  devel/sage-main/sage/rings/number_field/number_field.py # 1 doctests failed
	sage -t  devel/sage-main/sage/schemes/elliptic_curves/ell_number_field.py # 2 doctests failed
	sage -t  devel/sage-main/sage/schemes/elliptic_curves/ell_rational_field.py # 1 doctests failed
	sage -t  devel/sage-main/sage/rings/number_field/number_field_element.pyx # 1 doctests failed
	sage -t  devel/sage-main/sage/rings/polynomial/polynomial_quotient_ring.py # 3 doctests failed
	sage -t  devel/sage-main/sage/rings/integer.pyx # 1 doctests failed
```


Details:

```
sage -t  "devel/sage-main/sage/rings/number_field/number_field.py"
**********************************************************************
File "/home/john/sage-4.7.alpha5/devel/sage-main/sage/rings/number_field/number_field.py", line 3616:
    sage: L.factor(a + 1)
Expected:
    (Fractional ideal (1/2*a*b + a + 1/2)) * (Fractional ideal (-1/2*b - 1/2*a + 1))
Got:
    (Fractional ideal (-1/2*a*b - a - 1/2)) * (Fractional ideal (1/2*b + 1/2*a - 1))
```

is trivial,

```
sage -t  "devel/sage-main/sage/rings/number_field/number_field_element.pyx"
**********************************************************************
File "/home/john/sage-4.7.alpha5/devel/sage-main/sage/rings/number_field/number_field_element.pyx", line 1142:
    sage: t = (2*a + b)._rnfisnorm(L); t[1]
Expected:
    (b - 2)*a + 2*b - 3
Got:
    (-4*b - 5)*a + 5*b + 6
```

needs looking at, 

```
sage -t  "devel/sage-main/sage/rings/polynomial/polynomial_quotient_ring.py"
```

are just like the ones I fixed before on the other machine, and

```
sage -t  "devel/sage-main/sage/rings/integer.pyx"           
**********************************************************************
File "/home/john/sage-4.7.alpha5/devel/sage-main/sage/rings/integer.pyx", line 4389:
    sage: 7._bnfisnorm(CyclotomicField(7))
Expected:
    (-zeta7 + 1, 1)
Got:
    (-zeta7^5 + zeta7^4, 1)
```

is also trivial (multiplying by a power of zeta does not change the norm!).

That's all I have time for today, so I hope things look similar on the other 32-bit system being tested.



---

archive/issue_comments_119213.json:
```json
{
    "body": "Attachment\n\nApply after previous",
    "created_at": "2011-04-27T21:46:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119213",
    "user": "cremona"
}
```

Attachment

Apply after previous



---

archive/issue_comments_119214.json:
```json
{
    "body": "I have added a new patch (which affects 4 files in sage/rings) after which all doctests pass on both 32- and 64-bit, apart from the simon-related ones.\n\nThat means that it is time to check #11005 on top of all this.",
    "created_at": "2011-04-27T21:49:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119214",
    "user": "cremona"
}
```

I have added a new patch (which affects 4 files in sage/rings) after which all doctests pass on both 32- and 64-bit, apart from the simon-related ones.

That means that it is time to check #11005 on top of all this.



---

archive/issue_comments_119215.json:
```json
{
    "body": "lcalc fails to build with the new PARI:\n\n```\nLcommandline.cc: In function 'int main(int, char**)':\nLcommandline.cc:476:54: error: 'allocatemoremem' was not declared in this scope\nLcommandline.cc:403:16: warning: unused variable 'C' [-Wunused-variable]\nLcommandline.cc:38:9: warning: unused variable 'i' [-Wunused-variable]\nIn file included from ../include/L.h:537:0,\n                 from ../include/Lcommandline.h:36,\n                 from Lcommandline.cc:31:\n../include/Lvalue.h: In member function 'Complex L_function<ttype>::find_delta(Complex, Double) [with ttype = int, Complex = std::complex<double>, Double = double]':\nLcommandline.cc:463:50:   instantiated from here\n../include/Lvalue.h:37:21: warning: unused variable 'f2' [-Wunused-variable]\nmake[1]: *** [Lcommandline.o] Error 1\nmake[1]: Leaving directory `/usr/local/src/sage-4.7.alpha5/spkg/build/lcalc-20100428-1.23.p6/src/src'\nmake: *** [all] Error 2\nError building lcalc 'make'\n```\n",
    "created_at": "2011-05-10T07:37:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119215",
    "user": "jdemeyer"
}
```

lcalc fails to build with the new PARI:

```
Lcommandline.cc: In function 'int main(int, char**)':
Lcommandline.cc:476:54: error: 'allocatemoremem' was not declared in this scope
Lcommandline.cc:403:16: warning: unused variable 'C' [-Wunused-variable]
Lcommandline.cc:38:9: warning: unused variable 'i' [-Wunused-variable]
In file included from ../include/L.h:537:0,
                 from ../include/Lcommandline.h:36,
                 from Lcommandline.cc:31:
../include/Lvalue.h: In member function 'Complex L_function<ttype>::find_delta(Complex, Double) [with ttype = int, Complex = std::complex<double>, Double = double]':
Lcommandline.cc:463:50:   instantiated from here
../include/Lvalue.h:37:21: warning: unused variable 'f2' [-Wunused-variable]
make[1]: *** [Lcommandline.o] Error 1
make[1]: Leaving directory `/usr/local/src/sage-4.7.alpha5/spkg/build/lcalc-20100428-1.23.p6/src/src'
make: *** [all] Error 2
Error building lcalc 'make'
```




---

archive/issue_comments_119216.json:
```json
{
    "body": "Replying to [comment:41 jdemeyer]:\n> lcalc fails to build with the new PARI:\n\nMike Rubenstein needs to be made aware of this.",
    "created_at": "2011-05-10T08:36:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119216",
    "user": "cremona"
}
```

Replying to [comment:41 jdemeyer]:
> lcalc fails to build with the new PARI:

Mike Rubenstein needs to be made aware of this.



---

archive/issue_comments_119217.json:
```json
{
    "body": "What about genus2reduction? I am assuming John already made sure eclib is working.",
    "created_at": "2011-05-10T12:16:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119217",
    "user": "fbissey"
}
```

What about genus2reduction? I am assuming John already made sure eclib is working.



---

archive/issue_comments_119218.json:
```json
{
    "body": "Replying to [comment:43 fbissey]:\n> What about genus2reduction? I am assuming John already made sure eclib is working.\n\nA reasonable assumption, but...for a while now I have used Sage's Pari and NTL builds rather than building them myself independently, so I cannot yet confirm.  (However, eclib's use of Pari is minimal, it's only for integer factorization.)\n\nI am also preparing a new version of eclib, so I will combine these two tasks, though I don't have any time for this this week.",
    "created_at": "2011-05-10T13:06:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119218",
    "user": "cremona"
}
```

Replying to [comment:43 fbissey]:
> What about genus2reduction? I am assuming John already made sure eclib is working.

A reasonable assumption, but...for a while now I have used Sage's Pari and NTL builds rather than building them myself independently, so I cannot yet confirm.  (However, eclib's use of Pari is minimal, it's only for integer factorization.)

I am also preparing a new version of eclib, so I will combine these two tasks, though I don't have any time for this this week.



---

archive/issue_comments_119219.json:
```json
{
    "body": "Replying to [comment:42 cremona]:\n> Replying to [comment:41 jdemeyer]:\n> > lcalc fails to build with the new PARI:\n> \n> Mike Rubenstein needs to be made aware of this.\n\nFirst I will see if I can fix the error and then send the patches to him.",
    "created_at": "2011-05-10T15:04:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119219",
    "user": "jdemeyer"
}
```

Replying to [comment:42 cremona]:
> Replying to [comment:41 jdemeyer]:
> > lcalc fails to build with the new PARI:
> 
> Mike Rubenstein needs to be made aware of this.

First I will see if I can fix the error and then send the patches to him.



---

archive/issue_comments_119220.json:
```json
{
    "body": "See #11321 for lcalc.",
    "created_at": "2011-05-10T15:29:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119220",
    "user": "jdemeyer"
}
```

See #11321 for lcalc.



---

archive/issue_comments_119221.json:
```json
{
    "body": "I built Sage completely from scratch with the new PARI and lcalc packages, everything works.  All tests pass except for the ones related to simon_two_descent.",
    "created_at": "2011-05-15T14:39:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119221",
    "user": "jdemeyer"
}
```

I built Sage completely from scratch with the new PARI and lcalc packages, everything works.  All tests pass except for the ones related to simon_two_descent.



---

archive/issue_comments_119222.json:
```json
{
    "body": "Replying to [comment:48 jdemeyer]:\n> I built Sage completely from scratch with the new PARI and lcalc packages, everything works.  All tests pass except for the ones related to simon_two_descent.\n\nSo is the \"Needs work\" just because this ticket is dependent on #11005?  I am planning to look now at the doctest failures relating to the Simon scripts and fix them, so that this ticket can then be closed, and the additional work needed on #11005 can depend on this.",
    "created_at": "2011-05-18T15:34:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119222",
    "user": "cremona"
}
```

Replying to [comment:48 jdemeyer]:
> I built Sage completely from scratch with the new PARI and lcalc packages, everything works.  All tests pass except for the ones related to simon_two_descent.

So is the "Needs work" just because this ticket is dependent on #11005?  I am planning to look now at the doctest failures relating to the Simon scripts and fix them, so that this ticket can then be closed, and the additional work needed on #11005 can depend on this.



---

archive/issue_comments_119223.json:
```json
{
    "body": "Replying to [comment:49 cremona]:\n>  I am planning to look now at the doctest failures relating to the Simon scripts and fix them, so that this ticket can then be closed, and the additional work needed on #11005 can depend on this.\n\nThat's precisely what I proposed.",
    "created_at": "2011-05-18T16:45:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119223",
    "user": "jdemeyer"
}
```

Replying to [comment:49 cremona]:
>  I am planning to look now at the doctest failures relating to the Simon scripts and fix them, so that this ticket can then be closed, and the additional work needed on #11005 can depend on this.

That's precisely what I proposed.



---

archive/issue_comments_119224.json:
```json
{
    "body": "Replying to [comment:50 jdemeyer]:\n> Replying to [comment:49 cremona]:\n> >  I am planning to look now at the doctest failures relating to the Simon scripts and fix them, so that this ticket can then be closed, and the additional work needed on #11005 can depend on this.\n> \n> That's precisely what I proposed.\n\nOK, so that's what I am working on doing.  Patch up shortly.  However, I ran into something awkward:  the script ellQ.gp in data/extcode/pari/simon crashed randomly in the function ellredgen (using this new pari version).  I saw that the offending lines had been changed in the newer ellQ.gp as found in #11005, so I made the same changes.  This sorts the problem, but it means that for this ticket to be finished we need to also make a small patch to extcode.  Any problems with that?",
    "created_at": "2011-05-19T16:22:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119224",
    "user": "cremona"
}
```

Replying to [comment:50 jdemeyer]:
> Replying to [comment:49 cremona]:
> >  I am planning to look now at the doctest failures relating to the Simon scripts and fix them, so that this ticket can then be closed, and the additional work needed on #11005 can depend on this.
> 
> That's precisely what I proposed.

OK, so that's what I am working on doing.  Patch up shortly.  However, I ran into something awkward:  the script ellQ.gp in data/extcode/pari/simon crashed randomly in the function ellredgen (using this new pari version).  I saw that the offending lines had been changed in the newer ellQ.gp as found in #11005, so I made the same changes.  This sorts the problem, but it means that for this ticket to be finished we need to also make a small patch to extcode.  Any problems with that?



---

archive/issue_comments_119225.json:
```json
{
    "body": "Apply to sage library after previous",
    "created_at": "2011-05-19T16:26:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119225",
    "user": "cremona"
}
```

Apply to sage library after previous



---

archive/issue_comments_119226.json:
```json
{
    "body": "Attachment\n\nApply to extcode repository",
    "created_at": "2011-05-19T16:27:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119226",
    "user": "cremona"
}
```

Attachment

Apply to extcode repository



---

archive/issue_comments_119227.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-05-19T16:28:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119227",
    "user": "cremona"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_119228.json:
```json
{
    "body": "Is the only thing stopping this going forward the latest reviewer patch?",
    "created_at": "2011-05-30T15:51:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119228",
    "user": "cremona"
}
```

Is the only thing stopping this going forward the latest reviewer patch?



---

archive/issue_comments_119229.json:
```json
{
    "body": "As far as I know, **all** patches and spkgs still need review.  I can review your patches (but give me some time).",
    "created_at": "2011-05-31T08:09:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119229",
    "user": "jdemeyer"
}
```

As far as I know, **all** patches and spkgs still need review.  I can review your patches (but give me some time).



---

archive/issue_comments_119230.json:
```json
{
    "body": "Replying to [comment:56 jdemeyer]:\n> As far as I know, **all** patches and spkgs still need review.  I can review your patches (but give me some time).\n\nWell I considered that I had reviewed (positively) everything except my last patch fixing the Simon doctests so that's the only thing left needing a review (from you perhaps, especially as you made some extra fixes for 32/64 bit issues).",
    "created_at": "2011-05-31T08:26:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119230",
    "user": "cremona"
}
```

Replying to [comment:56 jdemeyer]:
> As far as I know, **all** patches and spkgs still need review.  I can review your patches (but give me some time).

Well I considered that I had reviewed (positively) everything except my last patch fixing the Simon doctests so that's the only thing left needing a review (from you perhaps, especially as you made some extra fixes for 32/64 bit issues).



---

archive/issue_comments_119231.json:
```json
{
    "body": "Also lcalc (#11321) needs review.",
    "created_at": "2011-05-31T08:31:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119231",
    "user": "jdemeyer"
}
```

Also lcalc (#11321) needs review.



---

archive/issue_comments_119232.json:
```json
{
    "body": "The part of the ticket that fixes #10240 is okay, I think.",
    "created_at": "2011-06-16T07:29:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119232",
    "user": "kcrisman"
}
```

The part of the ticket that fixes #10240 is okay, I think.



---

archive/issue_comments_119233.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-06-22T19:52:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119233",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_119234.json:
```json
{
    "body": "See #10240 for a request to merge that in 4.7.2 (or whatever the next version is) if this isn't getting merged quickly.",
    "created_at": "2011-06-30T14:57:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119234",
    "user": "kcrisman"
}
```

See #10240 for a request to merge that in 4.7.2 (or whatever the next version is) if this isn't getting merged quickly.



---

archive/issue_comments_119235.json:
```json
{
    "body": "See #11605 for a PARI 2.4.3.alpha.**p7** spkg with minor but important fixes to `spkg-install` (and some corrections in `SPKG.txt`). I've meanwhile based this on Dima's p6 (which just adds a small, harmless change for Cygwin) from #10240. \n\n(Haven't yet looked at *this* ticket / spkg here at all.)",
    "created_at": "2011-07-16T16:47:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119235",
    "user": "leif"
}
```

See #11605 for a PARI 2.4.3.alpha.**p7** spkg with minor but important fixes to `spkg-install` (and some corrections in `SPKG.txt`). I've meanwhile based this on Dima's p6 (which just adds a small, harmless change for Cygwin) from #10240. 

(Haven't yet looked at *this* ticket / spkg here at all.)



---

archive/issue_comments_119236.json:
```json
{
    "body": "Needs to be rebased to sage-2.4.3.alpha7.spkg (#11605).",
    "created_at": "2011-07-19T10:34:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119236",
    "user": "jdemeyer"
}
```

Needs to be rebased to sage-2.4.3.alpha7.spkg (#11605).



---

archive/issue_comments_119237.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-07-26T10:29:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119237",
    "user": "jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_119238.json:
```json
{
    "body": "The spkg does not build on Mac OS X because of an upstream bug.  There is a fix in PARI svn revision 13318 which I should add to this spkg.",
    "created_at": "2011-07-26T11:15:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119238",
    "user": "jdemeyer"
}
```

The spkg does not build on Mac OS X because of an upstream bug.  There is a fix in PARI svn revision 13318 which I should add to this spkg.



---

archive/issue_comments_119239.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-07-26T11:15:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119239",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_119240.json:
```json
{
    "body": "My comment refered to a Mac OS X 10.4 PPC machine, other machines might still work.",
    "created_at": "2011-07-26T11:16:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119240",
    "user": "jdemeyer"
}
```

My comment refered to a Mac OS X 10.4 PPC machine, other machines might still work.



---

archive/issue_comments_119241.json:
```json
{
    "body": "New spkg fixing the OS X issue: [http://boxen.math.washington.edu/home/jdemeyer/spkg/pari-2.5.0.p2.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/pari-2.5.0.p2.spkg)",
    "created_at": "2011-07-26T21:26:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119241",
    "user": "jdemeyer"
}
```

New spkg fixing the OS X issue: [http://boxen.math.washington.edu/home/jdemeyer/spkg/pari-2.5.0.p2.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/pari-2.5.0.p2.spkg)



---

archive/issue_comments_119242.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-07-26T21:26:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119242",
    "user": "jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_119243.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-07-26T21:34:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119243",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_119244.json:
```json
{
    "body": "Never mind, still doesn't work.  Need to also add revision 13330.",
    "created_at": "2011-07-26T21:34:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119244",
    "user": "jdemeyer"
}
```

Never mind, still doesn't work.  Need to also add revision 13330.



---

archive/issue_comments_119245.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-08-02T09:58:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119245",
    "user": "jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_119246.json:
```json
{
    "body": "New version which **does** build on OS X 10.4, same location: [http://boxen.math.washington.edu/home/jdemeyer/spkg/pari-2.5.0.p2.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/pari-2.5.0.p2.spkg)",
    "created_at": "2011-08-02T09:58:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119246",
    "user": "jdemeyer"
}
```

New version which **does** build on OS X 10.4, same location: [http://boxen.math.washington.edu/home/jdemeyer/spkg/pari-2.5.0.p2.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/pari-2.5.0.p2.spkg)



---

archive/issue_comments_119247.json:
```json
{
    "body": "Attachment\n\nDiff for the pari spkg, for reviewing only",
    "created_at": "2011-08-02T09:58:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119247",
    "user": "jdemeyer"
}
```

Attachment

Diff for the pari spkg, for reviewing only



---

archive/issue_comments_119248.json:
```json
{
    "body": "Changing priority from major to critical.",
    "created_at": "2011-08-02T10:12:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119248",
    "user": "jdemeyer"
}
```

Changing priority from major to critical.



---

archive/issue_comments_119249.json:
```json
{
    "body": "I did a small rebase of [attachment:11130_sagelib.patch] regarding sage/matrix/matrix2.pyx",
    "created_at": "2011-08-02T10:12:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119249",
    "user": "jdemeyer"
}
```

I did a small rebase of [attachment:11130_sagelib.patch] regarding sage/matrix/matrix2.pyx



---

archive/issue_comments_119250.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2011-08-02T10:24:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119250",
    "user": "cremona"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_119251.json:
```json
{
    "body": "Before I set about applying everything and testing, which I will do, can you tell me which Sage version I should be patching against?  I have 4.7.1.rc1, is that the best?  Or plain 4.7?",
    "created_at": "2011-08-02T10:24:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119251",
    "user": "cremona"
}
```

Before I set about applying everything and testing, which I will do, can you tell me which Sage version I should be patching against?  I have 4.7.1.rc1, is that the best?  Or plain 4.7?



---

archive/issue_comments_119252.json:
```json
{
    "body": "Replying to [comment:75 cremona]:\n> Before I set about applying everything and testing, which I will do, can you tell me which Sage version I should be patching against?  I have 4.7.1.rc1, is that the best?  Or plain 4.7?\n\nsage-4.7.1.rc1 for sure.\n\nI am also preparing a Sage tarball with all spkgs and patches already applied, it should appear in [http://boxen.math.washington.edu/home/jdemeyer/release/sage-4.7.1.rc1-pari-2.5.0/](http://boxen.math.washington.edu/home/jdemeyer/release/sage-4.7.1.rc1-pari-2.5.0/)",
    "created_at": "2011-08-02T10:29:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119252",
    "user": "jdemeyer"
}
```

Replying to [comment:75 cremona]:
> Before I set about applying everything and testing, which I will do, can you tell me which Sage version I should be patching against?  I have 4.7.1.rc1, is that the best?  Or plain 4.7?

sage-4.7.1.rc1 for sure.

I am also preparing a Sage tarball with all spkgs and patches already applied, it should appear in [http://boxen.math.washington.edu/home/jdemeyer/release/sage-4.7.1.rc1-pari-2.5.0/](http://boxen.math.washington.edu/home/jdemeyer/release/sage-4.7.1.rc1-pari-2.5.0/)



---

archive/issue_comments_119253.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2011-08-02T10:29:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119253",
    "user": "jdemeyer"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_119254.json:
```json
{
    "body": "Replying to [comment:76 jdemeyer]:\n> Replying to [comment:75 cremona]:\n> > Before I set about applying everything and testing, which I will do, can you tell me which Sage version I should be patching against?  I have 4.7.1.rc1, is that the best?  Or plain 4.7?\n> \n> sage-4.7.1.rc1 for sure.\n\nOK, I am testing against that right now... John\n\n> \n> I am also preparing a Sage tarball with all spkgs and patches already applied, it should appear in [http://boxen.math.washington.edu/home/jdemeyer/release/sage-4.7.1.rc1-pari-2.5.0/](http://boxen.math.washington.edu/home/jdemeyer/release/sage-4.7.1.rc1-pari-2.5.0/)",
    "created_at": "2011-08-02T10:58:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119254",
    "user": "cremona"
}
```

Replying to [comment:76 jdemeyer]:
> Replying to [comment:75 cremona]:
> > Before I set about applying everything and testing, which I will do, can you tell me which Sage version I should be patching against?  I have 4.7.1.rc1, is that the best?  Or plain 4.7?
> 
> sage-4.7.1.rc1 for sure.

OK, I am testing against that right now... John

> 
> I am also preparing a Sage tarball with all spkgs and patches already applied, it should appear in [http://boxen.math.washington.edu/home/jdemeyer/release/sage-4.7.1.rc1-pari-2.5.0/](http://boxen.math.washington.edu/home/jdemeyer/release/sage-4.7.1.rc1-pari-2.5.0/)



---

archive/issue_comments_119255.json:
```json
{
    "body": "Starting with a clean 4.7.1.rc1 (I think) I successfully applied both spkgs (using SAGE_CHECK=yes) and 5 patches to sagelib and 1 to data/extcode, and did sage -ba.\n\nSage now starts up OK but I'm having a lot of problems with any more testing.  For example, moving into devel/sage and doing \"../../sage -tp 20 ./sage\"  results in very many errors, looks like in every file, like this:\n\n```\nTraceback (most recent call last):\n  File \"/home/jec/.sage//tmp/facade_sets.py\", line 2, in <module>\n    from sage.all_cmdline import *; \n  File \"/home/jec/sage-4.7.1.rc1/local/lib/python/site-packages/sage/all_cmdline.py\", line 24, in <module>\n    raise ValueError, msg\nValueError: Attempted relative import in non-package\n```\n\nI checked (using bash's history) that I had remembered to hg qpush each patch.\n\nDoes this make any sense? I suppose I could rebuild 4.7.1.rc1 from scratch.",
    "created_at": "2011-08-02T11:36:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119255",
    "user": "cremona"
}
```

Starting with a clean 4.7.1.rc1 (I think) I successfully applied both spkgs (using SAGE_CHECK=yes) and 5 patches to sagelib and 1 to data/extcode, and did sage -ba.

Sage now starts up OK but I'm having a lot of problems with any more testing.  For example, moving into devel/sage and doing "../../sage -tp 20 ./sage"  results in very many errors, looks like in every file, like this:

```
Traceback (most recent call last):
  File "/home/jec/.sage//tmp/facade_sets.py", line 2, in <module>
    from sage.all_cmdline import *; 
  File "/home/jec/sage-4.7.1.rc1/local/lib/python/site-packages/sage/all_cmdline.py", line 24, in <module>
    raise ValueError, msg
ValueError: Attempted relative import in non-package
```

I checked (using bash's history) that I had remembered to hg qpush each patch.

Does this make any sense? I suppose I could rebuild 4.7.1.rc1 from scratch.



---

archive/issue_comments_119256.json:
```json
{
    "body": "hen trying to install this on Cygwin, I get a lot of errors while trying to create the binary gp-2.5.exe along the lines of the following three types.\n\n```\n.../libpari.a(default.o): In function `sd_prompt':\n.../default.c:962: multiple definition of `_sd_prompt'\ngp.o:.../gp/gp.c:2359: first defined here\n```\n\nand\n\n```\ngp.o:gp.c:(.text+0x9e2): undefined reference to `_err_printf'\n```\n\n(lots of this kind of thing, for many functions), and \n\n```\n.../libpari.a(mp.o): In function `umodiu':\n.../kernel/gmp/mp.c::567: undefined reference to `__imp____gmpn_mod_1'\n```\n\nThe latter type I've already seen while trying to ./sage -f the previous Pari (2.4.3.alpha.px), but I haven't seen the first kind or second kind before.   Something similar to the third one I've seen in some build notes of William's as being a problem with gmp being -I'ed before some other include directories, and the first one looks like one of these \"double inclusion\" problems.",
    "created_at": "2011-08-02T16:46:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119256",
    "user": "kcrisman"
}
```

hen trying to install this on Cygwin, I get a lot of errors while trying to create the binary gp-2.5.exe along the lines of the following three types.

```
.../libpari.a(default.o): In function `sd_prompt':
.../default.c:962: multiple definition of `_sd_prompt'
gp.o:.../gp/gp.c:2359: first defined here
```

and

```
gp.o:gp.c:(.text+0x9e2): undefined reference to `_err_printf'
```

(lots of this kind of thing, for many functions), and 

```
.../libpari.a(mp.o): In function `umodiu':
.../kernel/gmp/mp.c::567: undefined reference to `__imp____gmpn_mod_1'
```

The latter type I've already seen while trying to ./sage -f the previous Pari (2.4.3.alpha.px), but I haven't seen the first kind or second kind before.   Something similar to the third one I've seen in some build notes of William's as being a problem with gmp being -I'ed before some other include directories, and the first one looks like one of these "double inclusion" problems.



---

archive/issue_comments_119257.json:
```json
{
    "body": "Replying to [comment:79 kcrisman]:\n> When trying to install this on Cygwin, I get a lot of errors while trying to create the binary gp-2.5.exe along the lines of the following three types.\n\n```\n.../libpari.a(default.o): In function `sd_prompt':\n.../default.c:962: multiple definition of `_sd_prompt'\ngp.o:.../gp/gp.c:2359: first defined here\n```\n\n\nLooks as if you're *somehow<sup>TM</sup>* mixing the old PARI (at least the static library `libpari.a`) with the new one; PARI 2.5.0 doesn't have an `sd_prompt()` function in `default.c` at all.\n\n\n> and\n\n```\ngp.o:gp.c:(.text+0x9e2): undefined reference to `_err_printf'\n```\n\n\n... while this function doesn't exist in the older PARI.\n\n\n> (lots of this kind of thing, for many functions), and \n\n```\n.../libpari.a(mp.o): In function `umodiu':\n.../kernel/gmp/mp.c::567: undefined reference to `__imp____gmpn_mod_1'\n```\n\n> The latter type I've already seen while trying to ./sage -f the previous Pari (2.4.3.alpha.px), but I haven't seen the first kind or second kind before.   Something similar to the third one I've seen in some build notes of William's as being a problem with gmp being -I'ed before some other include directories, and the first one looks like one of these \"double inclusion\" problems.",
    "created_at": "2011-08-02T17:48:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119257",
    "user": "leif"
}
```

Replying to [comment:79 kcrisman]:
> When trying to install this on Cygwin, I get a lot of errors while trying to create the binary gp-2.5.exe along the lines of the following three types.

```
.../libpari.a(default.o): In function `sd_prompt':
.../default.c:962: multiple definition of `_sd_prompt'
gp.o:.../gp/gp.c:2359: first defined here
```


Looks as if you're *somehow<sup>TM</sup>* mixing the old PARI (at least the static library `libpari.a`) with the new one; PARI 2.5.0 doesn't have an `sd_prompt()` function in `default.c` at all.


> and

```
gp.o:gp.c:(.text+0x9e2): undefined reference to `_err_printf'
```


... while this function doesn't exist in the older PARI.


> (lots of this kind of thing, for many functions), and 

```
.../libpari.a(mp.o): In function `umodiu':
.../kernel/gmp/mp.c::567: undefined reference to `__imp____gmpn_mod_1'
```

> The latter type I've already seen while trying to ./sage -f the previous Pari (2.4.3.alpha.px), but I haven't seen the first kind or second kind before.   Something similar to the third one I've seen in some build notes of William's as being a problem with gmp being -I'ed before some other include directories, and the first one looks like one of these "double inclusion" problems.



---

archive/issue_comments_119258.json:
```json
{
    "body": "Replying to [comment:78 cremona]:\n> ValueError: Attempted relative import in non-package\n\nI have no idea why this happens.  Can you try to build [http://boxen.math.washington.edu/home/jdemeyer/release/sage-4.7.1.rc1-pari-2.5.0/sage-4.7.1.rc1-pari-2.5.0.tar](http://boxen.math.washington.edu/home/jdemeyer/release/sage-4.7.1.rc1-pari-2.5.0/sage-4.7.1.rc1-pari-2.5.0.tar) from scratch and test that?  If this works, probably you did something wrong in merging the spkgs/patches.",
    "created_at": "2011-08-02T19:39:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119258",
    "user": "jdemeyer"
}
```

Replying to [comment:78 cremona]:
> ValueError: Attempted relative import in non-package

I have no idea why this happens.  Can you try to build [http://boxen.math.washington.edu/home/jdemeyer/release/sage-4.7.1.rc1-pari-2.5.0/sage-4.7.1.rc1-pari-2.5.0.tar](http://boxen.math.washington.edu/home/jdemeyer/release/sage-4.7.1.rc1-pari-2.5.0/sage-4.7.1.rc1-pari-2.5.0.tar) from scratch and test that?  If this works, probably you did something wrong in merging the spkgs/patches.



---

archive/issue_comments_119259.json:
```json
{
    "body": "> Looks as if you're *somehow<sup>TM</sup>* mixing the old PARI (at least the static library `libpari.a`) with the new one; PARI 2.5.0 doesn't have an `sd_prompt()` function in `default.c` at all.\n\nInterestingly, it works fine from scratch (building)!  Sorry for the noise, if noise it was.\n\nIs there something about Pari that you shouldn't build it twice in the same location?  I notice that it removes and replaces various things in `$SAGE_LOCAL` before it's all done, so maybe that could happen.  In principle, one should be able to `./sage -f` a new version, have something break, and then be able to `./sage -f` the original version and have everything fine.  Or not even HAVE to `./sage -f` the original version.  The fact that this doesn't work is not good - shouldn't we only copy things over/delete things after the build has successfully completed?",
    "created_at": "2011-08-03T00:13:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119259",
    "user": "kcrisman"
}
```

> Looks as if you're *somehow<sup>TM</sup>* mixing the old PARI (at least the static library `libpari.a`) with the new one; PARI 2.5.0 doesn't have an `sd_prompt()` function in `default.c` at all.

Interestingly, it works fine from scratch (building)!  Sorry for the noise, if noise it was.

Is there something about Pari that you shouldn't build it twice in the same location?  I notice that it removes and replaces various things in `$SAGE_LOCAL` before it's all done, so maybe that could happen.  In principle, one should be able to `./sage -f` a new version, have something break, and then be able to `./sage -f` the original version and have everything fine.  Or not even HAVE to `./sage -f` the original version.  The fact that this doesn't work is not good - shouldn't we only copy things over/delete things after the build has successfully completed?



---

archive/issue_comments_119260.json:
```json
{
    "body": "Replying to [comment:82 kcrisman]:\n> \n> > Looks as if you're *somehow<sup>TM</sup>* mixing the old PARI (at least the static library `libpari.a`) with the new one; PARI 2.5.0 doesn't have an `sd_prompt()` function in `default.c` at all.\n> \n> Interestingly, it works fine from scratch (building)!  Sorry for the noise, if noise it was.\n> \n> Is there something about Pari that you shouldn't build it twice in the same location?  I notice that it removes and replaces various things in `$SAGE_LOCAL` before it's all done, so maybe that could happen.  In principle, one should be able to `./sage -f` a new version, have something break, and then be able to `./sage -f` the original version and have everything fine.  Or not even HAVE to `./sage -f` the original version.  The fact that this doesn't work is not good - shouldn't we only copy things over/delete things after the build has successfully completed?  \n\n\nWell the gp executable is linked against libpari and there is a danger that the old one will be used when linking if you are not careful enough. It should be ok in principle but the precaution of removing previous libpari is a good one.",
    "created_at": "2011-08-03T01:28:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119260",
    "user": "fbissey"
}
```

Replying to [comment:82 kcrisman]:
> 
> > Looks as if you're *somehow<sup>TM</sup>* mixing the old PARI (at least the static library `libpari.a`) with the new one; PARI 2.5.0 doesn't have an `sd_prompt()` function in `default.c` at all.
> 
> Interestingly, it works fine from scratch (building)!  Sorry for the noise, if noise it was.
> 
> Is there something about Pari that you shouldn't build it twice in the same location?  I notice that it removes and replaces various things in `$SAGE_LOCAL` before it's all done, so maybe that could happen.  In principle, one should be able to `./sage -f` a new version, have something break, and then be able to `./sage -f` the original version and have everything fine.  Or not even HAVE to `./sage -f` the original version.  The fact that this doesn't work is not good - shouldn't we only copy things over/delete things after the build has successfully completed?  


Well the gp executable is linked against libpari and there is a danger that the old one will be used when linking if you are not careful enough. It should be ok in principle but the precaution of removing previous libpari is a good one.



---

archive/issue_comments_119261.json:
```json
{
    "body": "Just a quick question to confirm: do we need to apply the patch to extcode without worrying about #11005? It is not a dependency of this bug.",
    "created_at": "2011-08-03T01:53:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119261",
    "user": "fbissey"
}
```

Just a quick question to confirm: do we need to apply the patch to extcode without worrying about #11005? It is not a dependency of this bug.



---

archive/issue_comments_119262.json:
```json
{
    "body": "Replying to [comment:83 fbissey]:\n> Replying to [comment:82 kcrisman]:\n> > \n> > > Looks as if you're *somehow<sup>TM</sup>* mixing the old PARI (at least the static library `libpari.a`) with the new one; PARI 2.5.0 doesn't have an `sd_prompt()` function in `default.c` at all.\n> > \n> > Interestingly, it works fine from scratch (building)!  Sorry for the noise, if noise it was.\n> > \n> > Is there something about Pari that you shouldn't build it twice in the same location?  I notice that it removes and replaces various things in `$SAGE_LOCAL` before it's all done, so maybe that could happen.\n\nThe PARI spkg doesn't delete anything of previous installs in advance. (The `.alpha`**`.p5`** though had a bug which caused the install script not to exit with an error if `make` failed. Also, on Cygwin `make -k` (\"keep going\") was used, but that shouldn't matter here, and has been removed in the 2.5.0 spkgs.)\n\n> > In principle, one should be able to `./sage -f` a new version, have something break, and then be able to `./sage -f` the original version and have everything fine.  Or not even HAVE to `./sage -f` the original version.\n\nBoth *should<sup>TM</sup>* be possible, at least unless the build succeeds but the actual installation fails at some point, in which case the former method should still work.\n\n> > The fact that this doesn't work is not good - shouldn't we only copy things over/delete things after the build has successfully completed?\n\nThat's what we do.\n \n> Well the gp executable is linked against libpari and there is a danger that the old one will be used when linking if you are not careful enough. It should be ok in principle but the precaution of removing previous libpari is a good one.\n\nThings are a little different on Cygwin, since *the Sage Cygwin developers* ;-) copy the DLL also to `$SAGE_LOCAL/bin` such that `gp` will find its *shared* library also there.\n\nPARI (2.4.3) **pre**pends its build path (with `-L`) when using `-lpari`, except for when it links `gp`[`-2.4`] \"in place\", but this happens *after* the new shared library (`.so*`, `*.dll` on Cygwin) has been copied and new symbolic links have been created. The new *static* library is built and copied later though, but that shouldn't matter unless `gp` is statically linked on Cygwin, which shouldn't be the case.\n\nIf despite that something weird happens, this is IMHO limited to Cygwin; you may attach your spkg install logs (`$SAGE_ROOT/spkg/logs/pari-*.log`) such that we can check this.\n\nWe also didn't have problems with upgrading **to** 2.4.3 btw., except that initially some dependencies of Sage's extension modules were missing such that those didn't get rebuilt in the first place (and used the old ones with a different version they had been linked to earlier).",
    "created_at": "2011-08-03T04:01:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119262",
    "user": "leif"
}
```

Replying to [comment:83 fbissey]:
> Replying to [comment:82 kcrisman]:
> > 
> > > Looks as if you're *somehow<sup>TM</sup>* mixing the old PARI (at least the static library `libpari.a`) with the new one; PARI 2.5.0 doesn't have an `sd_prompt()` function in `default.c` at all.
> > 
> > Interestingly, it works fine from scratch (building)!  Sorry for the noise, if noise it was.
> > 
> > Is there something about Pari that you shouldn't build it twice in the same location?  I notice that it removes and replaces various things in `$SAGE_LOCAL` before it's all done, so maybe that could happen.

The PARI spkg doesn't delete anything of previous installs in advance. (The `.alpha`**`.p5`** though had a bug which caused the install script not to exit with an error if `make` failed. Also, on Cygwin `make -k` ("keep going") was used, but that shouldn't matter here, and has been removed in the 2.5.0 spkgs.)

> > In principle, one should be able to `./sage -f` a new version, have something break, and then be able to `./sage -f` the original version and have everything fine.  Or not even HAVE to `./sage -f` the original version.

Both *should<sup>TM</sup>* be possible, at least unless the build succeeds but the actual installation fails at some point, in which case the former method should still work.

> > The fact that this doesn't work is not good - shouldn't we only copy things over/delete things after the build has successfully completed?

That's what we do.
 
> Well the gp executable is linked against libpari and there is a danger that the old one will be used when linking if you are not careful enough. It should be ok in principle but the precaution of removing previous libpari is a good one.

Things are a little different on Cygwin, since *the Sage Cygwin developers* ;-) copy the DLL also to `$SAGE_LOCAL/bin` such that `gp` will find its *shared* library also there.

PARI (2.4.3) **pre**pends its build path (with `-L`) when using `-lpari`, except for when it links `gp`[`-2.4`] "in place", but this happens *after* the new shared library (`.so*`, `*.dll` on Cygwin) has been copied and new symbolic links have been created. The new *static* library is built and copied later though, but that shouldn't matter unless `gp` is statically linked on Cygwin, which shouldn't be the case.

If despite that something weird happens, this is IMHO limited to Cygwin; you may attach your spkg install logs (`$SAGE_ROOT/spkg/logs/pari-*.log`) such that we can check this.

We also didn't have problems with upgrading **to** 2.4.3 btw., except that initially some dependencies of Sage's extension modules were missing such that those didn't get rebuilt in the first place (and used the old ones with a different version they had been linked to earlier).



---

archive/issue_comments_119263.json:
```json
{
    "body": "Replying to [comment:81 jdemeyer]:\n> Replying to [comment:78 cremona]:\n> > ValueError: Attempted relative import in non-package\n> \n> I have no idea why this happens.  Can you try to build [http://boxen.math.washington.edu/home/jdemeyer/release/sage-4.7.1.rc1-pari-2.5.0/sage-4.7.1.rc1-pari-2.5.0.tar](http://boxen.math.washington.edu/home/jdemeyer/release/sage-4.7.1.rc1-pari-2.5.0/sage-4.7.1.rc1-pari-2.5.0.tar) from scratch and test that?  If this works, probably you did something wrong in merging the spkgs/patches.\n\nI'm downloading that now and will report back.",
    "created_at": "2011-08-03T08:14:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119263",
    "user": "cremona"
}
```

Replying to [comment:81 jdemeyer]:
> Replying to [comment:78 cremona]:
> > ValueError: Attempted relative import in non-package
> 
> I have no idea why this happens.  Can you try to build [http://boxen.math.washington.edu/home/jdemeyer/release/sage-4.7.1.rc1-pari-2.5.0/sage-4.7.1.rc1-pari-2.5.0.tar](http://boxen.math.washington.edu/home/jdemeyer/release/sage-4.7.1.rc1-pari-2.5.0/sage-4.7.1.rc1-pari-2.5.0.tar) from scratch and test that?  If this works, probably you did something wrong in merging the spkgs/patches.

I'm downloading that now and will report back.



---

archive/issue_comments_119264.json:
```json
{
    "body": "Replying to [comment:86 cremona]:\n> Replying to [comment:81 jdemeyer]:\n> > Replying to [comment:78 cremona]:\n> > > ValueError: Attempted relative import in non-package\n> > \n> > I have no idea why this happens.  Can you try to build [http://boxen.math.washington.edu/home/jdemeyer/release/sage-4.7.1.rc1-pari-2.5.0/sage-4.7.1.rc1-pari-2.5.0.tar](http://boxen.math.washington.edu/home/jdemeyer/release/sage-4.7.1.rc1-pari-2.5.0/sage-4.7.1.rc1-pari-2.5.0.tar) from scratch and test that?  If this works, probably you did something wrong in merging the spkgs/patches.\n> \n> I'm downloading that now and will report back.\n\nBuilt with no problems.  But \"make ptestlong\" failed 100% just as before.  The install and ptestlong logs are at http://www.warwick.ac.uk/staff/J.E.Cremona/ptestlong.log and http://www.warwick.ac.uk/staff/J.E.Cremona/install.log",
    "created_at": "2011-08-03T10:56:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119264",
    "user": "cremona"
}
```

Replying to [comment:86 cremona]:
> Replying to [comment:81 jdemeyer]:
> > Replying to [comment:78 cremona]:
> > > ValueError: Attempted relative import in non-package
> > 
> > I have no idea why this happens.  Can you try to build [http://boxen.math.washington.edu/home/jdemeyer/release/sage-4.7.1.rc1-pari-2.5.0/sage-4.7.1.rc1-pari-2.5.0.tar](http://boxen.math.washington.edu/home/jdemeyer/release/sage-4.7.1.rc1-pari-2.5.0/sage-4.7.1.rc1-pari-2.5.0.tar) from scratch and test that?  If this works, probably you did something wrong in merging the spkgs/patches.
> 
> I'm downloading that now and will report back.

Built with no problems.  But "make ptestlong" failed 100% just as before.  The install and ptestlong logs are at http://www.warwick.ac.uk/staff/J.E.Cremona/ptestlong.log and http://www.warwick.ac.uk/staff/J.E.Cremona/install.log



---

archive/issue_comments_119265.json:
```json
{
    "body": "Replying to [comment:87 cremona]:\n> Built with no problems.  But \"make ptestlong\" failed 100% just as before.  The install and ptestlong logs are at http://www.warwick.ac.uk/staff/J.E.Cremona/ptestlong.log and http://www.warwick.ac.uk/staff/J.E.Cremona/install.log\n\nThe strange thing is that the traceback you get seems totally unrelated to PARI.",
    "created_at": "2011-08-03T11:34:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119265",
    "user": "jdemeyer"
}
```

Replying to [comment:87 cremona]:
> Built with no problems.  But "make ptestlong" failed 100% just as before.  The install and ptestlong logs are at http://www.warwick.ac.uk/staff/J.E.Cremona/ptestlong.log and http://www.warwick.ac.uk/staff/J.E.Cremona/install.log

The strange thing is that the traceback you get seems totally unrelated to PARI.



---

archive/issue_comments_119266.json:
```json
{
    "body": "Replying to [comment:88 jdemeyer]:\n> Replying to [comment:87 cremona]:\n> > Built with no problems.  But \"make ptestlong\" failed 100% just as before.  The install and ptestlong logs are at http://www.warwick.ac.uk/staff/J.E.Cremona/ptestlong.log and http://www.warwick.ac.uk/staff/J.E.Cremona/install.log\n> \n> The strange thing is that the traceback you get seems totally unrelated to PARI.\n\nI know, it is mad.  After this happened with my 4.7.1.rc1 yesterday I wanted to review something else, so I did that using my 4.7.1.rc0 which was untouched, and found the exact same errors arising whenever I tried \"sage -t\".  This is on a machine I have been using for Sage development and testing for a year, on which no-one but me installs stuff.\n\nHere are some possibly relevant environment variables (not changed recently):\n\nSAGE_PARALLEL_SPKG_BUILD=yes\nSHELL=/bin/bash\nLD_LIBRARY_PATH=:/usr/local/lib:/home/jec/sage-current/local/lib\n\nThe reason for the LD_LIBRARY_PATH is that I use Sage's built libraries for other work (libntl and libpari);  but seeting that to just /usr/local/lib made no difference anyway.",
    "created_at": "2011-08-03T12:03:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119266",
    "user": "cremona"
}
```

Replying to [comment:88 jdemeyer]:
> Replying to [comment:87 cremona]:
> > Built with no problems.  But "make ptestlong" failed 100% just as before.  The install and ptestlong logs are at http://www.warwick.ac.uk/staff/J.E.Cremona/ptestlong.log and http://www.warwick.ac.uk/staff/J.E.Cremona/install.log
> 
> The strange thing is that the traceback you get seems totally unrelated to PARI.

I know, it is mad.  After this happened with my 4.7.1.rc1 yesterday I wanted to review something else, so I did that using my 4.7.1.rc0 which was untouched, and found the exact same errors arising whenever I tried "sage -t".  This is on a machine I have been using for Sage development and testing for a year, on which no-one but me installs stuff.

Here are some possibly relevant environment variables (not changed recently):

SAGE_PARALLEL_SPKG_BUILD=yes
SHELL=/bin/bash
LD_LIBRARY_PATH=:/usr/local/lib:/home/jec/sage-current/local/lib

The reason for the LD_LIBRARY_PATH is that I use Sage's built libraries for other work (libntl and libpari);  but seeting that to just /usr/local/lib made no difference anyway.



---

archive/issue_comments_119267.json:
```json
{
    "body": "Same happens with just `./sage -t ...` or `make test[long]`, i.e. non-parallel?\n\nWe had strange errors with `ptest[long]` or `./sage -tp N ...` when `SAGE_PATH` was set (even to the empty string).",
    "created_at": "2011-08-03T12:38:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119267",
    "user": "leif"
}
```

Same happens with just `./sage -t ...` or `make test[long]`, i.e. non-parallel?

We had strange errors with `ptest[long]` or `./sage -tp N ...` when `SAGE_PATH` was set (even to the empty string).



---

archive/issue_comments_119268.json:
```json
{
    "body": "Replying to [comment:90 leif]:\n> Same happens with just `./sage -t ...` or `make test[long]`, i.e. non-parallel?\n> \n> We had strange errors with `ptest[long]` or `./sage -tp N ...` when `SAGE_PATH` was set (even to the empty string).\n\nThat is not set:\n\n```\njec@fermat%env | grep SAGE\nSAGE_PARALLEL_SPKG_BUILD=yes\n```\n\n\nmake testlong was no better, neither is testing a single file (e.g. ./sage -t devel/sage/sage/rings/infinity.py).  Sage does start up properly.\n\nLooking at the actual error message (why not?) I see that it complains that the line \n\n```\nfrom sage.all_cmdline import *;\n```\n\nwhich is presumably included in the testing framework, causes sage.all_cmdline.py to be imported, and then in line 24 of that file the line 24:\n\n```\n   raise ValueError, msg\n```\n\nraises the error, with the message coming from a few lines above where there is a try/except block containing\n\n```\n    from sage.all import *\n    from sage.calculus.predefined import x\n    preparser(on=True)\n```\n\nand this is causing some kind of circular import.\n\nAnyway, by 4.7 build which I have been using for weeks, and which passed all the tests when I built it, now gives rise to exactly the same problem.  So this is nothing to do with any of the code on this ticket, but instead something weird that has happened with my Sage installations.\n\nHere's an idea: I have several background jobs running sage;  is it possible that this is the problem?  They will also be writing to ~/.sage.  I'll try again when they have finished.",
    "created_at": "2011-08-03T13:19:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119268",
    "user": "cremona"
}
```

Replying to [comment:90 leif]:
> Same happens with just `./sage -t ...` or `make test[long]`, i.e. non-parallel?
> 
> We had strange errors with `ptest[long]` or `./sage -tp N ...` when `SAGE_PATH` was set (even to the empty string).

That is not set:

```
jec@fermat%env | grep SAGE
SAGE_PARALLEL_SPKG_BUILD=yes
```


make testlong was no better, neither is testing a single file (e.g. ./sage -t devel/sage/sage/rings/infinity.py).  Sage does start up properly.

Looking at the actual error message (why not?) I see that it complains that the line 

```
from sage.all_cmdline import *;
```

which is presumably included in the testing framework, causes sage.all_cmdline.py to be imported, and then in line 24 of that file the line 24:

```
   raise ValueError, msg
```

raises the error, with the message coming from a few lines above where there is a try/except block containing

```
    from sage.all import *
    from sage.calculus.predefined import x
    preparser(on=True)
```

and this is causing some kind of circular import.

Anyway, by 4.7 build which I have been using for weeks, and which passed all the tests when I built it, now gives rise to exactly the same problem.  So this is nothing to do with any of the code on this ticket, but instead something weird that has happened with my Sage installations.

Here's an idea: I have several background jobs running sage;  is it possible that this is the problem?  They will also be writing to ~/.sage.  I'll try again when they have finished.



---

archive/issue_comments_119269.json:
```json
{
    "body": "Replying to [comment:91 cremona]:\n> Here's an idea: I have several background jobs running sage;  is it possible that this is the problem?  They will also be writing to ~/.sage.  I'll try again when they have finished.\n\nWell, easily checked:\n\n```sh\n$ env DOT_SAGE=/tmp ./sage -t devel/sage/sage/rings/infinity.py\n```\n",
    "created_at": "2011-08-03T13:37:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119269",
    "user": "leif"
}
```

Replying to [comment:91 cremona]:
> Here's an idea: I have several background jobs running sage;  is it possible that this is the problem?  They will also be writing to ~/.sage.  I'll try again when they have finished.

Well, easily checked:

```sh
$ env DOT_SAGE=/tmp ./sage -t devel/sage/sage/rings/infinity.py
```




---

archive/issue_comments_119270.json:
```json
{
    "body": "considering the amount of broken test you have, does sage even start properly without wanting to test it.",
    "created_at": "2011-08-03T22:36:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119270",
    "user": "fbissey"
}
```

considering the amount of broken test you have, does sage even start properly without wanting to test it.



---

archive/issue_comments_119271.json:
```json
{
    "body": "Replying to [comment:93 fbissey]:\n> considering the amount of broken test you have, does sage even start properly without wanting to test it.\nYes, all the version I have start and run fine, but none of them cab run any tests.  I have never seen this before, but it's something to do with my setup (and several sage jobs running in the background on the same machine) so we should probably not fill up more of this ticket with it -- as long as someone else can do some testing!",
    "created_at": "2011-08-04T08:29:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119271",
    "user": "cremona"
}
```

Replying to [comment:93 fbissey]:
> considering the amount of broken test you have, does sage even start properly without wanting to test it.
Yes, all the version I have start and run fine, but none of them cab run any tests.  I have never seen this before, but it's something to do with my setup (and several sage jobs running in the background on the same machine) so we should probably not fill up more of this ticket with it -- as long as someone else can do some testing!



---

archive/issue_comments_119272.json:
```json
{
    "body": "Build against current 4.7.2_alpha0 on linux amd64. No problem that can be attributed to pari after running the long tests.",
    "created_at": "2011-08-05T02:32:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119272",
    "user": "fbissey"
}
```

Build against current 4.7.2_alpha0 on linux amd64. No problem that can be attributed to pari after running the long tests.



---

archive/issue_comments_119273.json:
```json
{
    "body": "Replying to [comment:94 cremona]:\n> Replying to [comment:93 fbissey]:\n> > considering the amount of broken test you have, does sage even start properly without wanting to test it.\n> Yes, all the version I have start and run fine, but none of them cab run any tests.  I have never seen this before, but it's something to do with my setup (and several sage jobs running in the background on the same machine) so we should probably not fill up more of this ticket with it -- as long as someone else can do some testing!\n\nBy deleting most of my ~/.sage I successfully ran all the tests (i.e. make ptestlong completed successfully).  This is on 64-bit ubuntu.\n\nSorry for the noise -- is there any reason not to give this a positive review and get it into the 4.7.2 series as soon as possible?",
    "created_at": "2011-08-12T08:21:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119273",
    "user": "cremona"
}
```

Replying to [comment:94 cremona]:
> Replying to [comment:93 fbissey]:
> > considering the amount of broken test you have, does sage even start properly without wanting to test it.
> Yes, all the version I have start and run fine, but none of them cab run any tests.  I have never seen this before, but it's something to do with my setup (and several sage jobs running in the background on the same machine) so we should probably not fill up more of this ticket with it -- as long as someone else can do some testing!

By deleting most of my ~/.sage I successfully ran all the tests (i.e. make ptestlong completed successfully).  This is on 64-bit ubuntu.

Sorry for the noise -- is there any reason not to give this a positive review and get it into the 4.7.2 series as soon as possible?



---

archive/issue_comments_119274.json:
```json
{
    "body": "Changing keywords from \"pari spkg\" to \"pari spkg sd32\".",
    "created_at": "2011-08-24T23:45:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119274",
    "user": "was"
}
```

Changing keywords from "pari spkg" to "pari spkg sd32".



---

archive/issue_comments_119275.json:
```json
{
    "body": "One doctest failure with sage-4.7.2.alpha2, fix included in new [attachment:11130_sagelib.patch]:\n\n```\nsage -t  -long -force_lib devel/sage/sage/rings/number_field/number_field_ideal.py\n**********************************************************************\nFile \"/mnt/usb1/scratch/jdemeyer/merger/sage-4.7.2.alpha2-pari-2.5.0/devel/sage-main/sage/rings/number_field/number_field_ideal.py\", line 1097:\n    sage: [P._S_ideal_class_log(S) for P in K.primes_above(11)]\nExpected:\n    [[5, 2], [1, 1]]\nGot:\n    [[3, 2], [3, 1]]\n**********************************************************************\n```\n",
    "created_at": "2011-09-19T13:03:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119275",
    "user": "jdemeyer"
}
```

One doctest failure with sage-4.7.2.alpha2, fix included in new [attachment:11130_sagelib.patch]:

```
sage -t  -long -force_lib devel/sage/sage/rings/number_field/number_field_ideal.py
**********************************************************************
File "/mnt/usb1/scratch/jdemeyer/merger/sage-4.7.2.alpha2-pari-2.5.0/devel/sage-main/sage/rings/number_field/number_field_ideal.py", line 1097:
    sage: [P._S_ideal_class_log(S) for P in K.primes_above(11)]
Expected:
    [[5, 2], [1, 1]]
Got:
    [[3, 2], [3, 1]]
**********************************************************************
```




---

archive/issue_comments_119276.json:
```json
{
    "body": "Positive review for [attachment:trac_11130-doctest-poly.patch] and [attachment:11130_sagelib32.patch].  To make things simpler, I have folded these two patches into my [attachment:11130_sagelib.patch] (in any case, the commit message of one of your patches needed to be fixed).  Together with John's earlier review of my [attachment:11130_sagelib.patch], this one patch now has positive review.",
    "created_at": "2011-09-21T08:59:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119276",
    "user": "jdemeyer"
}
```

Positive review for [attachment:trac_11130-doctest-poly.patch] and [attachment:11130_sagelib32.patch].  To make things simpler, I have folded these two patches into my [attachment:11130_sagelib.patch] (in any case, the commit message of one of your patches needed to be fixed).  Together with John's earlier review of my [attachment:11130_sagelib.patch], this one patch now has positive review.



---

archive/issue_comments_119277.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-09-21T09:54:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119277",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_119278.json:
```json
{
    "body": "Attachment\n\nJohn, your patch changes the *functionality* of the `simon_two_descent()` function by adding a new option ``store_gens``.  I have two problems with this:\n\n1. I think a ticket related to upgrading PARI is not the correct place to make such a change (or at least, it should be justified why).\n2. I don't like how `store_gens` changes the output of the function.  The name op this option does not imply that the output would be changed.  I can agree that you store the saturated points (as before), but why also *return* the saturated points?  This is a real functional change.",
    "created_at": "2011-09-21T09:54:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119278",
    "user": "jdemeyer"
}
```

Attachment

John, your patch changes the *functionality* of the `simon_two_descent()` function by adding a new option ``store_gens``.  I have two problems with this:

1. I think a ticket related to upgrading PARI is not the correct place to make such a change (or at least, it should be justified why).
2. I don't like how `store_gens` changes the output of the function.  The name op this option does not imply that the output would be changed.  I can agree that you store the saturated points (as before), but why also *return* the saturated points?  This is a real functional change.



---

archive/issue_comments_119279.json:
```json
{
    "body": "Attachment\n\ncremona's patch without the store_gens option and with some minor fixes",
    "created_at": "2011-09-21T11:39:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119279",
    "user": "jdemeyer"
}
```

Attachment

cremona's patch without the store_gens option and with some minor fixes



---

archive/issue_comments_119280.json:
```json
{
    "body": "Attachment",
    "created_at": "2011-09-21T11:39:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119280",
    "user": "jdemeyer"
}
```

Attachment



---

archive/issue_comments_119281.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-09-21T11:39:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119281",
    "user": "jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_119282.json:
```json
{
    "body": "I have a added a new patch [attachment:11130-sagelib-simon-v2.patch] which has parts of John Cremona's patch (those parts get positive review from me) with some minor fixes added.",
    "created_at": "2011-09-21T11:44:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119282",
    "user": "jdemeyer"
}
```

I have a added a new patch [attachment:11130-sagelib-simon-v2.patch] which has parts of John Cremona's patch (those parts get positive review from me) with some minor fixes added.



---

archive/issue_comments_119283.json:
```json
{
    "body": "Attachment",
    "created_at": "2011-09-23T19:37:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119283",
    "user": "jdemeyer"
}
```

Attachment



---

archive/issue_comments_119284.json:
```json
{
    "body": "Sorry for delay, I was on holiday.\n\nThe point about not adding new functionality on this specific ticket is a good one.  It was so long ago I had to look at my own patch to see what you were talking about!  I think I added that at someone's suggestion that after a successful 2-descent using simon_two_descent it was silly not to keep the point found.  This will be requested again at some point, so perhaps a new ticket should be made for it before we forget,\n\nBut *nothing* should be done which delays this ticket finally getting closed!",
    "created_at": "2011-09-26T09:50:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119284",
    "user": "cremona"
}
```

Sorry for delay, I was on holiday.

The point about not adding new functionality on this specific ticket is a good one.  It was so long ago I had to look at my own patch to see what you were talking about!  I think I added that at someone's suggestion that after a successful 2-descent using simon_two_descent it was silly not to keep the point found.  This will be requested again at some point, so perhaps a new ticket should be made for it before we forget,

But *nothing* should be done which delays this ticket finally getting closed!



---

archive/issue_comments_119285.json:
```json
{
    "body": "Replying to [comment:106 cremona]:\n> Sorry for delay, I was on holiday.\n\nNo apologies needed, I have also been away for a while...\n\nJohn, it would be great if you could review the remaining patches here.  They get positive_review from me, but since they contain a mixture of code of you and of me, you should also look at them.",
    "created_at": "2011-09-26T14:04:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119285",
    "user": "jdemeyer"
}
```

Replying to [comment:106 cremona]:
> Sorry for delay, I was on holiday.

No apologies needed, I have also been away for a while...

John, it would be great if you could review the remaining patches here.  They get positive_review from me, but since they contain a mixture of code of you and of me, you should also look at them.



---

archive/issue_comments_119286.json:
```json
{
    "body": "Starting with a build of 4.7.2.alpha1 (the latest I have built) I applied both spkgs OK, then the first two patches ok, but the third patch 11130_reviewer32.patch had 2 failed hunks.  It looks trivial, but as they are listed the patches do no apply cleanly.",
    "created_at": "2011-09-26T14:41:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119286",
    "user": "cremona"
}
```

Starting with a build of 4.7.2.alpha1 (the latest I have built) I applied both spkgs OK, then the first two patches ok, but the third patch 11130_reviewer32.patch had 2 failed hunks.  It looks trivial, but as they are listed the patches do no apply cleanly.



---

archive/issue_comments_119287.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-09-26T14:41:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119287",
    "user": "cremona"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_119288.json:
```json
{
    "body": "Replying to [comment:108 cremona]:\n> Starting with a build of 4.7.2.alpha1 (the latest I have built) I applied both spkgs OK, then the first two patches ok, but the third patch 11130_reviewer32.patch had 2 failed hunks.  It looks trivial, but as they are listed the patches do no apply cleanly.\n\nThe patches do apply to sage-4.7.2.**alpha2**.  Alternatively, try applying the patch from #11540 (merged in sage-4.7.2.alpha2) first.",
    "created_at": "2011-09-26T15:10:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119288",
    "user": "jdemeyer"
}
```

Replying to [comment:108 cremona]:
> Starting with a build of 4.7.2.alpha1 (the latest I have built) I applied both spkgs OK, then the first two patches ok, but the third patch 11130_reviewer32.patch had 2 failed hunks.  It looks trivial, but as they are listed the patches do no apply cleanly.

The patches do apply to sage-4.7.2.**alpha2**.  Alternatively, try applying the patch from #11540 (merged in sage-4.7.2.alpha2) first.



---

archive/issue_comments_119289.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-09-26T15:17:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119289",
    "user": "jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_119290.json:
```json
{
    "body": "Replying to [comment:109 jdemeyer]:\n> \n> The patches do apply to sage-4.7.2.**alpha2**.  Alternatively, try applying the patch from #11540 (merged in sage-4.7.2.alpha2) first.\n\nSorry, I missed alpha2.  I'll build that now and try again.",
    "created_at": "2011-09-26T15:44:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119290",
    "user": "cremona"
}
```

Replying to [comment:109 jdemeyer]:
> 
> The patches do apply to sage-4.7.2.**alpha2**.  Alternatively, try applying the patch from #11540 (merged in sage-4.7.2.alpha2) first.

Sorry, I missed alpha2.  I'll build that now and try again.



---

archive/issue_comments_119291.json:
```json
{
    "body": "OK, so with a freshly built 4.7.2.alpha2, I successfully installed both new spkgs and all patches, and rebuilt Sage using -ba.  Now doing a full test.\n\nQuestion:  in the extcode patch we refer to version 2.4.4 -- should that be 2.5.0?\n\nI'll be ready with a positive review as soon as the testing is done (assuming success!).",
    "created_at": "2011-09-26T20:57:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119291",
    "user": "cremona"
}
```

OK, so with a freshly built 4.7.2.alpha2, I successfully installed both new spkgs and all patches, and rebuilt Sage using -ba.  Now doing a full test.

Question:  in the extcode patch we refer to version 2.4.4 -- should that be 2.5.0?

I'll be ready with a positive review as soon as the testing is done (assuming success!).



---

archive/issue_comments_119292.json:
```json
{
    "body": "Replying to [comment:112 cremona]:\n> Question:  in the extcode patch we refer to version 2.4.4 -- should that be 2.5.0?\nThe patch was created for PARI version 2.4.4 but by now there is version 2.5.0.  So in fact both numbers are correct.  Since 2.4.4 is the first affected version, I say we use that version number.",
    "created_at": "2011-09-26T21:20:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119292",
    "user": "jdemeyer"
}
```

Replying to [comment:112 cremona]:
> Question:  in the extcode patch we refer to version 2.4.4 -- should that be 2.5.0?
The patch was created for PARI version 2.4.4 but by now there is version 2.5.0.  So in fact both numbers are correct.  Since 2.4.4 is the first affected version, I say we use that version number.



---

archive/issue_comments_119293.json:
```json
{
    "body": "Replying to [comment:113 jdemeyer]:\n> Replying to [comment:112 cremona]:\n> > Question:  in the extcode patch we refer to version 2.4.4 -- should that be 2.5.0?\n> The patch was created for PARI version 2.4.4 but by now there is version 2.5.0.  So in fact both numbers are correct.  Since 2.4.4 is the first affected version, I say we use that version number.\n\nOK -- and all tests pass (on a 64-bit machine) so I'll give this a positive review.  I'll also do a 32-bit test tomorrow.",
    "created_at": "2011-09-26T21:40:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119293",
    "user": "cremona"
}
```

Replying to [comment:113 jdemeyer]:
> Replying to [comment:112 cremona]:
> > Question:  in the extcode patch we refer to version 2.4.4 -- should that be 2.5.0?
> The patch was created for PARI version 2.4.4 but by now there is version 2.5.0.  So in fact both numbers are correct.  Since 2.4.4 is the first affected version, I say we use that version number.

OK -- and all tests pass (on a 64-bit machine) so I'll give this a positive review.  I'll also do a 32-bit test tomorrow.



---

archive/issue_comments_119294.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-09-26T21:40:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119294",
    "user": "cremona"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_119295.json:
```json
{
    "body": "Just a remark: I tried this out on Solaris, and all seems well -- it builds fine and the selection of tests that I ran (including everything in `sage/rings/number_field`,`sage/libs/pari` and `sage/interfaces/gp`) all worked.",
    "created_at": "2011-09-27T13:57:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119295",
    "user": "davidloeffler"
}
```

Just a remark: I tried this out on Solaris, and all seems well -- it builds fine and the selection of tests that I ran (including everything in `sage/rings/number_field`,`sage/libs/pari` and `sage/interfaces/gp`) all worked.



---

archive/issue_comments_119296.json:
```json
{
    "body": "Successfully built and applied everything on 32-bit linux, now testing.",
    "created_at": "2011-09-28T11:00:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119296",
    "user": "cremona"
}
```

Successfully built and applied everything on 32-bit linux, now testing.



---

archive/issue_comments_119297.json:
```json
{
    "body": "Replying to [comment:116 cremona]:\n> Successfully built and applied everything on 32-bit linux, now testing.\n\nAll tests pass (SuSE linux 32-bit).",
    "created_at": "2011-09-29T08:16:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119297",
    "user": "cremona"
}
```

Replying to [comment:116 cremona]:
> Successfully built and applied everything on 32-bit linux, now testing.

All tests pass (SuSE linux 32-bit).



---

archive/issue_comments_119298.json:
```json
{
    "body": "I'm confused: is #11321 a prerequisite for this ticket, or not? I'm puzzled because these two tickets are listed as prerequisites for each other, and yet this one is at \"positive review\" and the other at \"needs review\". Is the proposal to close this ticket and merge the lcalc 1.23.p8 spkg from #11321, but not the two subsequent patches on that ticket, and the \"needs review\" there applies to the subsequent patches? Or are we going to wait for a p9 spkg at #11321, in which case we would probably need to test everything here over again?",
    "created_at": "2011-09-29T09:13:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119298",
    "user": "davidloeffler"
}
```

I'm confused: is #11321 a prerequisite for this ticket, or not? I'm puzzled because these two tickets are listed as prerequisites for each other, and yet this one is at "positive review" and the other at "needs review". Is the proposal to close this ticket and merge the lcalc 1.23.p8 spkg from #11321, but not the two subsequent patches on that ticket, and the "needs review" there applies to the subsequent patches? Or are we going to wait for a p9 spkg at #11321, in which case we would probably need to test everything here over again?



---

archive/issue_comments_119299.json:
```json
{
    "body": "Replying to [comment:118 davidloeffler]:\n> I'm confused: is #11321 a prerequisite for this ticket, or not?\nYes, it is.\n> I'm puzzled because these two tickets are listed as prerequisites for each other.\nThat's correct.  These two tickets need to be merged together, one will not work without the other.  leif wants to change #11321 such that it does not depend on this ticket, but I think that's unnecessary.\n\n> Is the proposal to close this ticket and merge the lcalc 1.23.p8 spkg from #11321, but not the two subsequent patches on that ticket, and the \"needs review\" there applies to the subsequent patches?\nneeds_review on that ticket applies to everything.  I created the .p8, leif raised some concerns about the .p8 and is proposing a .p9 but it doesn't materialize.\n\n> Or are we going to wait for a p9 spkg at #11321, in which case we would probably need to test everything here over again?\nAs far as I'm concerned, we can merge the .p8 as it is but it still needs_review.  I don't believe leif's concerns are serious enough that they should prevent the spkg from being merged.",
    "created_at": "2011-09-29T09:33:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119299",
    "user": "jdemeyer"
}
```

Replying to [comment:118 davidloeffler]:
> I'm confused: is #11321 a prerequisite for this ticket, or not?
Yes, it is.
> I'm puzzled because these two tickets are listed as prerequisites for each other.
That's correct.  These two tickets need to be merged together, one will not work without the other.  leif wants to change #11321 such that it does not depend on this ticket, but I think that's unnecessary.

> Is the proposal to close this ticket and merge the lcalc 1.23.p8 spkg from #11321, but not the two subsequent patches on that ticket, and the "needs review" there applies to the subsequent patches?
needs_review on that ticket applies to everything.  I created the .p8, leif raised some concerns about the .p8 and is proposing a .p9 but it doesn't materialize.

> Or are we going to wait for a p9 spkg at #11321, in which case we would probably need to test everything here over again?
As far as I'm concerned, we can merge the .p8 as it is but it still needs_review.  I don't believe leif's concerns are serious enough that they should prevent the spkg from being merged.



---

archive/issue_comments_119300.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2011-10-04T08:41:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119300",
    "user": "jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_119301.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-10-04T08:42:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119301",
    "user": "jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_119302.json:
```json
{
    "body": "Wouldn't it be more natural to change the output of the doctest in [attachment:11130-4.7.2.alpha3.patch] instead of the input?",
    "created_at": "2011-10-05T16:02:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119302",
    "user": "mstreng"
}
```

Wouldn't it be more natural to change the output of the doctest in [attachment:11130-4.7.2.alpha3.patch] instead of the input?



---

archive/issue_comments_119303.json:
```json
{
    "body": "Replying to [comment:124 mstreng]:\n> Wouldn't it be more natural to change the output of the doctest in [attachment:11130-4.7.2.alpha3.patch] instead of the input?\n\nI guess in this case, it does not really matter.  I went for a minimal change.\n\nWith the test added, all short and long doctests pass on sage.math (x86_64 GNU/Linux).",
    "created_at": "2011-10-05T16:12:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119303",
    "user": "jdemeyer"
}
```

Replying to [comment:124 mstreng]:
> Wouldn't it be more natural to change the output of the doctest in [attachment:11130-4.7.2.alpha3.patch] instead of the input?

I guess in this case, it does not really matter.  I went for a minimal change.

With the test added, all short and long doctests pass on sage.math (x86_64 GNU/Linux).



---

archive/issue_comments_119304.json:
```json
{
    "body": "New lcalc package at #11321 needs review.",
    "created_at": "2011-10-06T09:44:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119304",
    "user": "jdemeyer"
}
```

New lcalc package at #11321 needs review.



---

archive/issue_comments_119305.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-10-08T09:28:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119305",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_119306.json:
```json
{
    "body": "Fix doctest for sage-4.7.2.alpha3",
    "created_at": "2011-10-08T09:34:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119306",
    "user": "jdemeyer"
}
```

Fix doctest for sage-4.7.2.alpha3



---

archive/issue_comments_119307.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-10-08T09:37:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119307",
    "user": "jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_119308.json:
```json
{
    "body": "Attachment\n\nNew patch, tested on 32-bit x86 Linux, 64-bit x86_64 Linux, OS X 10.4 PPC.",
    "created_at": "2011-10-08T09:37:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119308",
    "user": "jdemeyer"
}
```

Attachment

New patch, tested on 32-bit x86 Linux, 64-bit x86_64 Linux, OS X 10.4 PPC.



---

archive/issue_comments_119309.json:
```json
{
    "body": "I'm trying to apply all the spkgs and patches in this ticket so I can review #11948, but I can't build the Sage library. With everything applied, I get, after `./sage -b`:\n\n```\n[...]\ngcc -fno-strict-aliasing -g -O2 -DNDEBUG -g -O3 -Wall -Wstrict-prototypes -fPIC -I/home/drake/s/sage-4.7.2.rc0/local/include -I/home/drake/s/sage-4.7.2.rc0/local/include/csage -I/home/drake/s/sage-4.7.2.rc0/devel/sage/sage/ext -I/home/drake/s/sage-4.7.2.rc0/local/include/python2.6 -c sage/rings/real_mpfr.c -o build/temp.linux-x86_64-2.6/sage/rings/real_mpfr.o -w\nerror: command 'gcc' failed with exit status 1\n```\n\n\nIf I just rerun `./sage -b` (surely that will fix it, right? :), I get\n\n```\ngcc -fno-strict-aliasing -g -O2 -DNDEBUG -g -O3 -Wall -Wstrict-prototypes -fPIC -I/home/drake/s/sage-4.7.2.rc0/local/lib/python/site-packages/numpy/core/include -I/home/drake/s/sage-4.7.2.rc0/local/include -I/home/drake/s/sage-4.7.2.rc0/local/include/csage -I/home/drake/s/sage-4.7.2.rc0/devel/sage/sage/ext -I/home/drake/s/sage-4.7.2.rc0/local/include/python2.6 -c sage/rings/polynomial/real_roots.c -o build/temp.linux-x86_64-2.6/sage/rings/polynomial/real_roots.o -w\nsage/libs/pari/gen.c: In function \u2018__pyx_pf_4sage_4libs_4pari_3gen_3gen_81Ser\u2019:\nsage/libs/pari/gen.c:12094: error: too many arguments to function \u2018gtoser\u2019\nerror: command 'gcc' failed with exit status 1\n```\n\n\nThis is with 4.7.2.rc0 on amd64 Ubuntu 10.04.",
    "created_at": "2011-10-25T01:33:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119309",
    "user": "ddrake"
}
```

I'm trying to apply all the spkgs and patches in this ticket so I can review #11948, but I can't build the Sage library. With everything applied, I get, after `./sage -b`:

```
[...]
gcc -fno-strict-aliasing -g -O2 -DNDEBUG -g -O3 -Wall -Wstrict-prototypes -fPIC -I/home/drake/s/sage-4.7.2.rc0/local/include -I/home/drake/s/sage-4.7.2.rc0/local/include/csage -I/home/drake/s/sage-4.7.2.rc0/devel/sage/sage/ext -I/home/drake/s/sage-4.7.2.rc0/local/include/python2.6 -c sage/rings/real_mpfr.c -o build/temp.linux-x86_64-2.6/sage/rings/real_mpfr.o -w
error: command 'gcc' failed with exit status 1
```


If I just rerun `./sage -b` (surely that will fix it, right? :), I get

```
gcc -fno-strict-aliasing -g -O2 -DNDEBUG -g -O3 -Wall -Wstrict-prototypes -fPIC -I/home/drake/s/sage-4.7.2.rc0/local/lib/python/site-packages/numpy/core/include -I/home/drake/s/sage-4.7.2.rc0/local/include -I/home/drake/s/sage-4.7.2.rc0/local/include/csage -I/home/drake/s/sage-4.7.2.rc0/devel/sage/sage/ext -I/home/drake/s/sage-4.7.2.rc0/local/include/python2.6 -c sage/rings/polynomial/real_roots.c -o build/temp.linux-x86_64-2.6/sage/rings/polynomial/real_roots.o -w
sage/libs/pari/gen.c: In function ‘__pyx_pf_4sage_4libs_4pari_3gen_3gen_81Ser’:
sage/libs/pari/gen.c:12094: error: too many arguments to function ‘gtoser’
error: command 'gcc' failed with exit status 1
```


This is with 4.7.2.rc0 on amd64 Ubuntu 10.04.



---

archive/issue_comments_119310.json:
```json
{
    "body": "Sorry to ask the obvious, but can you double-check that you applied the new PARI spkg and all patches here?",
    "created_at": "2011-10-25T06:43:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119310",
    "user": "jdemeyer"
}
```

Sorry to ask the obvious, but can you double-check that you applied the new PARI spkg and all patches here?



---

archive/issue_comments_119311.json:
```json
{
    "body": "Replying to [comment:133 jdemeyer]:\n> Sorry to ask the obvious, but can you double-check that you applied the new PARI spkg and all patches here?\n\nNo need to apologize...I was certain I did everything right, but I just tried again, and Sage built and is well on its way to passing all \"ptestlong\" tests. So I must have made a mistake above; sorry for the noise.",
    "created_at": "2011-10-25T07:48:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119311",
    "user": "ddrake"
}
```

Replying to [comment:133 jdemeyer]:
> Sorry to ask the obvious, but can you double-check that you applied the new PARI spkg and all patches here?

No need to apologize...I was certain I did everything right, but I just tried again, and Sage built and is well on its way to passing all "ptestlong" tests. So I must have made a mistake above; sorry for the noise.



---

archive/issue_comments_119312.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-10-30T04:38:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119312",
    "user": "was"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_119313.json:
```json
{
    "body": "The new patch works for me (for the 64-bit test).  And I was definitely able to apply the patches and pari spkg here and get a working Sage.",
    "created_at": "2011-10-30T04:38:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119313",
    "user": "was"
}
```

The new patch works for me (for the 64-bit test).  And I was definitely able to apply the patches and pari spkg here and get a working Sage.



---

archive/issue_comments_119314.json:
```json
{
    "body": "Milestone sage-4.7.3 deleted",
    "created_at": "2011-11-03T16:14:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119314",
    "user": "jdemeyer"
}
```

Milestone sage-4.7.3 deleted



---

archive/issue_comments_119315.json:
```json
{
    "body": "Fix 32-bit doctest for sage-4.8.alpha1",
    "created_at": "2011-11-05T13:38:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119315",
    "user": "jdemeyer"
}
```

Fix 32-bit doctest for sage-4.8.alpha1



---

archive/issue_comments_119316.json:
```json
{
    "body": "Attachment\n\nAdded an additional patch [attachment:11130-4.8.alpha1.patch].  Not sure how this extra doctest failure happened, but in any case this trivial patch fixes it.  It simply sets the 32-bit result equal to the 64-bit result.  I hope nobody minds if I leave the positive_review (not to drag this ticket longer than necessary).",
    "created_at": "2011-11-05T13:41:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119316",
    "user": "jdemeyer"
}
```

Attachment

Added an additional patch [attachment:11130-4.8.alpha1.patch].  Not sure how this extra doctest failure happened, but in any case this trivial patch fixes it.  It simply sets the 32-bit result equal to the 64-bit result.  I hope nobody minds if I leave the positive_review (not to drag this ticket longer than necessary).



---

archive/issue_comments_119317.json:
```json
{
    "body": "Replying to [comment:141 jdemeyer]:\n> Added an additional patch [attachment:11130-4.8.alpha1.patch].  Not sure how this extra doctest failure happened, but in any case this trivial patch fixes it.  It simply sets the 32-bit result equal to the 64-bit result.  I hope nobody minds if I leave the positive_review (not to drag this ticket longer than necessary).\n\nFine with me.  The 32/64 bit differences in pari are such a nuisance, as I have told Karim more than once...",
    "created_at": "2011-11-05T13:52:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119317",
    "user": "cremona"
}
```

Replying to [comment:141 jdemeyer]:
> Added an additional patch [attachment:11130-4.8.alpha1.patch].  Not sure how this extra doctest failure happened, but in any case this trivial patch fixes it.  It simply sets the 32-bit result equal to the 64-bit result.  I hope nobody minds if I leave the positive_review (not to drag this ticket longer than necessary).

Fine with me.  The 32/64 bit differences in pari are such a nuisance, as I have told Karim more than once...



---

archive/issue_comments_119318.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2011-11-07T10:11:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10991#issuecomment-119318",
    "user": "jdemeyer"
}
```

Resolution: fixed
