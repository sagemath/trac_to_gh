# Issue 23839: Pep8-compliance, lattices.py as an example

Issue created by migration from Trac.

Original creator: jmantysalo

Original creation time: 2017-10-20 10:42:31

CC:  chapoton

This patch nominally tries to pep8fy `lattices.py`. The real question is discussion about pep8.



---

Comment by jmantysalo created at 2017-10-20 10:46:02

Frédéric, you might be interested in this.

What should we do to


```
if ((self.is_ranked() and len(self.meet_irreducibles()) == self.rank()) or
    self.cardinality() == 0):
    return (True, None) if certificate else True
```


I admit that it is not beatiful, pep8 got it right with E129.

Another thing, is `M[i + 1, j]` really more readabe than `M[i+1, j]`? There are also some other places where pep8fying things does not to seem help readability.


---

Comment by jmantysalo created at 2017-10-20 10:46:02

Changing status from new to needs_info.


---

Comment by tscrim created at 2017-10-20 15:54:47

Replying to [comment:2 jmantysalo]:
> What should we do to
> {{{
> if ((self.is_ranked() and len(self.meet_irreducibles()) == self.rank()) or
>     self.cardinality() == 0):
>     return (True, None) if certificate else True
> }}}

IMO, I wouldn't change this.

> Another thing, is `M[i + 1, j]` really more readabe than `M[i+1, j]`? There are also some other places where pep8fying things does not to seem help readability.

IMO, we should not be too strictly PEP8, which IIRC allows for breaking things for readability.

Also, while we are at it:

```diff
-if isinstance(data, FiniteMeetSemilattice) and len(args) == 0 and len(options) == 0:
+if isinstance(data, FiniteMeetSemilattice) and not args and not options:
```



---

Comment by git created at 2017-10-24 10:33:49

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-10-24 10:37:25

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jmantysalo created at 2017-10-24 10:47:37

I changed those `len(foo) == 0` -lines. (And merged to new beta, as I have a compilation problem.)

Now we have following pep warnings:


```
185 E501 line too long 
  6 E128 continuation line under-indented for visual indent
  4 E129 visually indented line with same indent as next logical line
  2 E731 do not assign a lambda expression, use a def
  2 E202 whitespace before ')'
  2 E201 whitespace after '('
```


Long lines are mostly impossible to avoid. As for E201/E202 I think it **adds** readability to use spaces in a long line where outer parentheses are used for line continuation, like


```
if ( (foor+bar)*zyzzy > 42 and
     some_value*2 < 101 ):
```


What about lambda expressions? Is there a real reason to use `def` instead of them? ...actually, why I would use Python in first place if I don't use lambdas...


---

Comment by tscrim created at 2017-10-24 12:33:39

Replying to [comment:7 jmantysalo]:
> Long lines are mostly impossible to avoid.

Yep, we just do what we can (and for readability of code, somethimes it is better, IMO, to break the limit).

> As for E201/E202 I think it **adds** readability to use spaces in a long line where outer parentheses are used for line continuation, like
> 
> {{{
> if ( (foor+bar)*zyzzy > 42 and
>      some_value*2 < 101 ):
> }}}

I agree; leave them be.

> What about lambda expressions? Is there a real reason to use `def` instead of them? ...actually, why I would use Python in first place if I don't use lambdas...

Well, a lambda function should be anonymous, so you should not assign it a (variable) name. It is mostly equivalent to the `def` function, but the `def` is a little more clear about itself and what things do. However, lambdas still serve a purpose for things like `map` or a key for `sort` because you can define the little functions that are not associated with a specific name but still need to be functions.


---

Comment by jmantysalo created at 2017-10-24 12:57:46

Changing status from needs_info to needs_review.


---

Comment by jmantysalo created at 2017-10-24 12:57:46

Replying to [comment:8 tscrim]:

>> What about lambda expressions? Is there a real reason to use `def` instead of them? ...actually, why I would use Python in first place if I don't use lambdas...

> Well, a lambda function should be anonymous, so you should not assign it a (variable) name.

Ah, that was what pep8 complains. First of all, there may be places where a lambda is used more than once. This is not case here. But still, to me


```
go_up = lambda v: [v_ for v_ in H.neighbors_out(v) if v_ not in above_a]
for v in H.depth_first_search(e, neighbors=go_up):
```


seems easier than


```
for v in H.depth_first_search(e, neighbors=lambda v: [v_ for v_ in H.neighbors_out(v) if v_ not in above_a]):
```


Hence I mark this as needs_review.

For the future it could be nice to pep8-check modified lines, i.e. combine the output with the output of `git diff develop`.


---

Comment by git created at 2017-10-24 13:14:05

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jmantysalo created at 2017-10-24 13:15:13

New commits:


---

Comment by jmantysalo created at 2017-10-24 13:15:53

Arghs, errors with git...


---

Comment by git created at 2017-10-24 13:21:50

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jmantysalo created at 2017-10-24 13:22:48

Replying to [comment:12 jmantysalo]:
> Arghs, errors with git...

Resolved, hopefully...


---

Comment by novoselt created at 2017-10-24 15:12:58

I'd like to clarify the purpose of this ticket: is it just an investigation of how pep8 should be applied to "real Sage code" so that we can put appropriate guidelines into the developers guide? That's fine, but I am very much against large scale change of code just for the sake of following guidelines - it does make it harder to track down where certain lines of code are coming from using blame.

Using some script to check NEW lines of code in patches to make sure that future additions/modifications are following good practices is of course a different (and nice) thing.


---

Comment by tscrim created at 2017-10-25 00:30:22

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2017-10-25 00:30:22

That's a good point about `git blame` that I haven't thought about. However, I have found it takes more to convince someone new to Sage that they should follow PEP8 if part of the rest of the file does not, in part because PEP8 says follow the local format. It also makes it easier to maintain the existing code because consistent style is easier to read and parse. So I think these sorts of changes have a net positive and giving the positive review.


---

Comment by jmantysalo created at 2017-10-25 04:32:46

Currently we have "Follow the standard Python formatting rules when writing code for Sage - - pep-0008" in the devel manual. From this experience I would say that at most we should add something to soften the tone. ", if there are no special reason to do otherwise." or similar. Maybe nothing.

`git blame` is hard to use in any case - Frédéric has already touched an enormous number of lines when doing modification for Python3 and has made many typo corrections in the same time.

More general: Should we have more visible way to automatically say "Hey! Please check this!" to a developer from trac? We can not reject the code for being not-pep8-compliant, but we could ask for confirmation.


---

Comment by vbraun created at 2017-11-02 11:05:34

Resolution: fixed
