# Issue 23839: Pep8-compliance, lattices.py as an example

archive/issues_023839.json:
```json
{
    "body": "CC:  @fchapoton\n\nThis patch nominally tries to pep8fy `lattices.py`. The real question is discussion about pep8.\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/24076\n\n",
    "created_at": "2017-10-20T10:42:31Z",
    "labels": [
        "component: combinatorics",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.1",
    "title": "Pep8-compliance, lattices.py as an example",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23839",
    "user": "https://github.com/jm58660"
}
```
CC:  @fchapoton

This patch nominally tries to pep8fy `lattices.py`. The real question is discussion about pep8.


Issue created by migration from https://trac.sagemath.org/ticket/24076





---

archive/issue_comments_333541.json:
```json
{
    "body": "Fr\u00e9d\u00e9ric, you might be interested in this.\n\nWhat should we do to\n\n```\nif ((self.is_ranked() and len(self.meet_irreducibles()) == self.rank()) or\n    self.cardinality() == 0):\n    return (True, None) if certificate else True\n```\n\nI admit that it is not beatiful, pep8 got it right with E129.\n\nAnother thing, is `M[i + 1, j]` really more readabe than `M[i+1, j]`? There are also some other places where pep8fying things does not to seem help readability.",
    "created_at": "2017-10-20T10:46:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23839#issuecomment-333541",
    "user": "https://github.com/jm58660"
}
```

Frédéric, you might be interested in this.

What should we do to

```
if ((self.is_ranked() and len(self.meet_irreducibles()) == self.rank()) or
    self.cardinality() == 0):
    return (True, None) if certificate else True
```

I admit that it is not beatiful, pep8 got it right with E129.

Another thing, is `M[i + 1, j]` really more readabe than `M[i+1, j]`? There are also some other places where pep8fying things does not to seem help readability.



---

archive/issue_comments_333542.json:
```json
{
    "body": "Changing status from new to needs_info.",
    "created_at": "2017-10-20T10:46:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23839#issuecomment-333542",
    "user": "https://github.com/jm58660"
}
```

Changing status from new to needs_info.



---

archive/issue_comments_333543.json:
```json
{
    "body": "Replying to [comment:2 jmantysalo]:\n> What should we do to\n> \n> ```\n> if ((self.is_ranked() and len(self.meet_irreducibles()) == self.rank()) or\n>     self.cardinality() == 0):\n>     return (True, None) if certificate else True\n> ```\n\n\nIMO, I wouldn't change this.\n\n> Another thing, is `M[i + 1, j]` really more readabe than `M[i+1, j]`? There are also some other places where pep8fying things does not to seem help readability.\n\n\nIMO, we should not be too strictly PEP8, which IIRC allows for breaking things for readability.\n\nAlso, while we are at it:\n\n```diff\n-if isinstance(data, FiniteMeetSemilattice) and len(args) == 0 and len(options) == 0:\n+if isinstance(data, FiniteMeetSemilattice) and not args and not options:\n```",
    "created_at": "2017-10-20T15:54:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23839#issuecomment-333543",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:2 jmantysalo]:
> What should we do to
> 
> ```
> if ((self.is_ranked() and len(self.meet_irreducibles()) == self.rank()) or
>     self.cardinality() == 0):
>     return (True, None) if certificate else True
> ```


IMO, I wouldn't change this.

> Another thing, is `M[i + 1, j]` really more readabe than `M[i+1, j]`? There are also some other places where pep8fying things does not to seem help readability.


IMO, we should not be too strictly PEP8, which IIRC allows for breaking things for readability.

Also, while we are at it:

```diff
-if isinstance(data, FiniteMeetSemilattice) and len(args) == 0 and len(options) == 0:
+if isinstance(data, FiniteMeetSemilattice) and not args and not options:
```



---

archive/issue_comments_333544.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-10-24T10:33:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23839#issuecomment-333544",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_333545.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-10-24T10:37:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23839#issuecomment-333545",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_333546.json:
```json
{
    "body": "I changed those `len(foo) == 0` -lines. (And merged to new beta, as I have a compilation problem.)\n\nNow we have following pep warnings:\n\n```\n185 E501 line too long \n  6 E128 continuation line under-indented for visual indent\n  4 E129 visually indented line with same indent as next logical line\n  2 E731 do not assign a lambda expression, use a def\n  2 E202 whitespace before ')'\n  2 E201 whitespace after '('\n```\n\nLong lines are mostly impossible to avoid. As for E201/E202 I think it **adds** readability to use spaces in a long line where outer parentheses are used for line continuation, like\n\n```\nif ( (foor+bar)*zyzzy > 42 and\n     some_value*2 < 101 ):\n```\n\nWhat about lambda expressions? Is there a real reason to use `def` instead of them? ...actually, why I would use Python in first place if I don't use lambdas...",
    "created_at": "2017-10-24T10:47:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23839#issuecomment-333546",
    "user": "https://github.com/jm58660"
}
```

I changed those `len(foo) == 0` -lines. (And merged to new beta, as I have a compilation problem.)

Now we have following pep warnings:

```
185 E501 line too long 
  6 E128 continuation line under-indented for visual indent
  4 E129 visually indented line with same indent as next logical line
  2 E731 do not assign a lambda expression, use a def
  2 E202 whitespace before ')'
  2 E201 whitespace after '('
```

Long lines are mostly impossible to avoid. As for E201/E202 I think it **adds** readability to use spaces in a long line where outer parentheses are used for line continuation, like

```
if ( (foor+bar)*zyzzy > 42 and
     some_value*2 < 101 ):
```

What about lambda expressions? Is there a real reason to use `def` instead of them? ...actually, why I would use Python in first place if I don't use lambdas...



---

archive/issue_comments_333547.json:
```json
{
    "body": "Replying to [comment:7 jmantysalo]:\n> Long lines are mostly impossible to avoid.\n\n\nYep, we just do what we can (and for readability of code, somethimes it is better, IMO, to break the limit).\n\n> As for E201/E202 I think it **adds** readability to use spaces in a long line where outer parentheses are used for line continuation, like\n> \n> \n> ```\n> if ( (foor+bar)*zyzzy > 42 and\n>      some_value*2 < 101 ):\n> ```\n\n\nI agree; leave them be.\n\n> What about lambda expressions? Is there a real reason to use `def` instead of them? ...actually, why I would use Python in first place if I don't use lambdas...\n\n\nWell, a lambda function should be anonymous, so you should not assign it a (variable) name. It is mostly equivalent to the `def` function, but the `def` is a little more clear about itself and what things do. However, lambdas still serve a purpose for things like `map` or a key for `sort` because you can define the little functions that are not associated with a specific name but still need to be functions.",
    "created_at": "2017-10-24T12:33:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23839#issuecomment-333547",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:7 jmantysalo]:
> Long lines are mostly impossible to avoid.


Yep, we just do what we can (and for readability of code, somethimes it is better, IMO, to break the limit).

> As for E201/E202 I think it **adds** readability to use spaces in a long line where outer parentheses are used for line continuation, like
> 
> 
> ```
> if ( (foor+bar)*zyzzy > 42 and
>      some_value*2 < 101 ):
> ```


I agree; leave them be.

> What about lambda expressions? Is there a real reason to use `def` instead of them? ...actually, why I would use Python in first place if I don't use lambdas...


Well, a lambda function should be anonymous, so you should not assign it a (variable) name. It is mostly equivalent to the `def` function, but the `def` is a little more clear about itself and what things do. However, lambdas still serve a purpose for things like `map` or a key for `sort` because you can define the little functions that are not associated with a specific name but still need to be functions.



---

archive/issue_comments_333548.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2017-10-24T12:57:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23839#issuecomment-333548",
    "user": "https://github.com/jm58660"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_333549.json:
```json
{
    "body": "Replying to [comment:8 tscrim]:\n\n>> What about lambda expressions? Is there a real reason to use `def` instead of them? ...actually, why I would use Python in first place if I don't use lambdas...\n\n\n> Well, a lambda function should be anonymous, so you should not assign it a (variable) name.\n\n\nAh, that was what pep8 complains. First of all, there may be places where a lambda is used more than once. This is not case here. But still, to me\n\n```\ngo_up = lambda v: [v_ for v_ in H.neighbors_out(v) if v_ not in above_a]\nfor v in H.depth_first_search(e, neighbors=go_up):\n```\n\nseems easier than\n\n```\nfor v in H.depth_first_search(e, neighbors=lambda v: [v_ for v_ in H.neighbors_out(v) if v_ not in above_a]):\n```\n\nHence I mark this as needs_review.\n\nFor the future it could be nice to pep8-check modified lines, i.e. combine the output with the output of `git diff develop`.",
    "created_at": "2017-10-24T12:57:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23839#issuecomment-333549",
    "user": "https://github.com/jm58660"
}
```

Replying to [comment:8 tscrim]:

>> What about lambda expressions? Is there a real reason to use `def` instead of them? ...actually, why I would use Python in first place if I don't use lambdas...


> Well, a lambda function should be anonymous, so you should not assign it a (variable) name.


Ah, that was what pep8 complains. First of all, there may be places where a lambda is used more than once. This is not case here. But still, to me

```
go_up = lambda v: [v_ for v_ in H.neighbors_out(v) if v_ not in above_a]
for v in H.depth_first_search(e, neighbors=go_up):
```

seems easier than

```
for v in H.depth_first_search(e, neighbors=lambda v: [v_ for v_ in H.neighbors_out(v) if v_ not in above_a]):
```

Hence I mark this as needs_review.

For the future it could be nice to pep8-check modified lines, i.e. combine the output with the output of `git diff develop`.



---

archive/issue_comments_333550.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-10-24T13:14:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23839#issuecomment-333550",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_333551.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-10-24T13:15:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23839#issuecomment-333551",
    "user": "https://github.com/jm58660"
}
```

New commits:



---

archive/issue_comments_333552.json:
```json
{
    "body": "Arghs, errors with git...",
    "created_at": "2017-10-24T13:15:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23839#issuecomment-333552",
    "user": "https://github.com/jm58660"
}
```

Arghs, errors with git...



---

archive/issue_comments_333553.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-10-24T13:21:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23839#issuecomment-333553",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_333554.json:
```json
{
    "body": "Replying to [comment:12 jmantysalo]:\n> Arghs, errors with git...\n\n\nResolved, hopefully...",
    "created_at": "2017-10-24T13:22:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23839#issuecomment-333554",
    "user": "https://github.com/jm58660"
}
```

Replying to [comment:12 jmantysalo]:
> Arghs, errors with git...


Resolved, hopefully...



---

archive/issue_comments_333555.json:
```json
{
    "body": "I'd like to clarify the purpose of this ticket: is it just an investigation of how pep8 should be applied to \"real Sage code\" so that we can put appropriate guidelines into the developers guide? That's fine, but I am very much against large scale change of code just for the sake of following guidelines - it does make it harder to track down where certain lines of code are coming from using blame.\n\nUsing some script to check NEW lines of code in patches to make sure that future additions/modifications are following good practices is of course a different (and nice) thing.",
    "created_at": "2017-10-24T15:12:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23839#issuecomment-333555",
    "user": "https://github.com/novoselt"
}
```

I'd like to clarify the purpose of this ticket: is it just an investigation of how pep8 should be applied to "real Sage code" so that we can put appropriate guidelines into the developers guide? That's fine, but I am very much against large scale change of code just for the sake of following guidelines - it does make it harder to track down where certain lines of code are coming from using blame.

Using some script to check NEW lines of code in patches to make sure that future additions/modifications are following good practices is of course a different (and nice) thing.



---

archive/issue_comments_333556.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-10-25T00:30:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23839#issuecomment-333556",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_333557.json:
```json
{
    "body": "That's a good point about `git blame` that I haven't thought about. However, I have found it takes more to convince someone new to Sage that they should follow PEP8 if part of the rest of the file does not, in part because PEP8 says follow the local format. It also makes it easier to maintain the existing code because consistent style is easier to read and parse. So I think these sorts of changes have a net positive and giving the positive review.",
    "created_at": "2017-10-25T00:30:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23839#issuecomment-333557",
    "user": "https://github.com/tscrim"
}
```

That's a good point about `git blame` that I haven't thought about. However, I have found it takes more to convince someone new to Sage that they should follow PEP8 if part of the rest of the file does not, in part because PEP8 says follow the local format. It also makes it easier to maintain the existing code because consistent style is easier to read and parse. So I think these sorts of changes have a net positive and giving the positive review.



---

archive/issue_comments_333558.json:
```json
{
    "body": "Currently we have \"Follow the standard Python formatting rules when writing code for Sage - - pep-0008\" in the devel manual. From this experience I would say that at most we should add something to soften the tone. \", if there are no special reason to do otherwise.\" or similar. Maybe nothing.\n\n`git blame` is hard to use in any case - Fr\u00e9d\u00e9ric has already touched an enormous number of lines when doing modification for Python3 and has made many typo corrections in the same time.\n\nMore general: Should we have more visible way to automatically say \"Hey! Please check this!\" to a developer from trac? We can not reject the code for being not-pep8-compliant, but we could ask for confirmation.",
    "created_at": "2017-10-25T04:32:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23839#issuecomment-333558",
    "user": "https://github.com/jm58660"
}
```

Currently we have "Follow the standard Python formatting rules when writing code for Sage - - pep-0008" in the devel manual. From this experience I would say that at most we should add something to soften the tone. ", if there are no special reason to do otherwise." or similar. Maybe nothing.

`git blame` is hard to use in any case - Frédéric has already touched an enormous number of lines when doing modification for Python3 and has made many typo corrections in the same time.

More general: Should we have more visible way to automatically say "Hey! Please check this!" to a developer from trac? We can not reject the code for being not-pep8-compliant, but we could ask for confirmation.



---

archive/issue_events_061149.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-11-02T11:05:34Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/23839",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23839#event-61149"
}
```



---

archive/issue_comments_333559.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-11-02T11:05:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23839",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23839#issuecomment-333559",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
