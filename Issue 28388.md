# Issue 28388: Let CombinatorialPolyhedron handle f_vector of polyhedra

archive/issues_028388.json:
```json
{
    "body": "CC:  jipilab @laisrast\n\n`CombinatorialPolyhedron` computes the `f_vector` much faster than the current algorithm. In addition it is very memory efficient.\n\nThe goal of this ticket is to replace the method in `Polyhedron_base` by the method in `CombinatorialPolyedron`.\n\nHere is a tiny example of the comparison:\n\n```\nsage: P = polytopes.permutahedron(6)\nsage: _ = P.incidence_matrix()\nsage: a = get_memory_usage()\nsage: %time P.f_vector()\nCPU times: user 8.19 s, sys: 4.46 ms, total: 8.19 s\nWall time: 8.19 s\n(1, 720, 1800, 1560, 540, 62, 1)\nsage: get_memory_usage(a)\n22.84765625\nsage: a = get_memory_usage()\nsage: C = CombinatorialPolyhedron(P)\nsage: %time C.f_vector()\nCPU times: user 889 \u00b5s, sys: 14 \u00b5s, total: 903 \u00b5s\nWall time: 905 \u00b5s\n(1, 720, 1800, 1560, 540, 62, 1)\nsage: get_memory_usage(a)\n0.81640625\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/28625\n\n",
    "created_at": "2019-10-18T06:57:30Z",
    "labels": [
        "PLEASE CHANGE",
        "major"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.0",
    "title": "Let CombinatorialPolyhedron handle f_vector of polyhedra",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28388",
    "user": "@kliem"
}
```
CC:  jipilab @laisrast

`CombinatorialPolyhedron` computes the `f_vector` much faster than the current algorithm. In addition it is very memory efficient.

The goal of this ticket is to replace the method in `Polyhedron_base` by the method in `CombinatorialPolyedron`.

Here is a tiny example of the comparison:

```
sage: P = polytopes.permutahedron(6)
sage: _ = P.incidence_matrix()
sage: a = get_memory_usage()
sage: %time P.f_vector()
CPU times: user 8.19 s, sys: 4.46 ms, total: 8.19 s
Wall time: 8.19 s
(1, 720, 1800, 1560, 540, 62, 1)
sage: get_memory_usage(a)
22.84765625
sage: a = get_memory_usage()
sage: C = CombinatorialPolyhedron(P)
sage: %time C.f_vector()
CPU times: user 889 µs, sys: 14 µs, total: 903 µs
Wall time: 905 µs
(1, 720, 1800, 1560, 540, 62, 1)
sage: get_memory_usage(a)
0.81640625
```


Issue created by migration from https://trac.sagemath.org/ticket/28625





---

archive/issue_comments_400931.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to enhancement.",
    "created_at": "2019-10-18T07:37:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28388#issuecomment-400931",
    "user": "jipilab"
}
```

Changing type from PLEASE CHANGE to enhancement.



---

archive/issue_comments_400932.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to geometry.",
    "created_at": "2019-10-18T07:37:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28388#issuecomment-400932",
    "user": "jipilab"
}
```

Changing component from PLEASE CHANGE to geometry.



---

archive/issue_comments_400933.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-10-18T08:28:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28388#issuecomment-400933",
    "user": "@kliem"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_400934.json:
```json
{
    "body": "New commits:",
    "created_at": "2019-10-18T08:30:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28388#issuecomment-400934",
    "user": "@kliem"
}
```

New commits:



---

archive/issue_comments_400935.json:
```json
{
    "body": "Running f_vector twice on truncated_dodecahedron will ignore the error and create a wrong f_vector\n\n```\nsage: tr = polytopes.truncated_dodecahedron(exact=False)\n  warn(\"This polyhedron data is numerically complicated; cdd could not convert between the inexact V and H representation without loss of data. The resulting object might show inconsistencies.\")\nsage: tr.f_vector()\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n...\nValueError: not all vertices are intersections of facets\nsage: tr.f_vector()\n(1, 36, 57, 22, 1)\nsage: tr\nA 3-dimensional polyhedron in RDF^3 defined as the convex hull of 60 vertices\n```\n",
    "created_at": "2019-10-18T08:57:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28388#issuecomment-400935",
    "user": "@LaisRast"
}
```

Running f_vector twice on truncated_dodecahedron will ignore the error and create a wrong f_vector

```
sage: tr = polytopes.truncated_dodecahedron(exact=False)
  warn("This polyhedron data is numerically complicated; cdd could not convert between the inexact V and H representation without loss of data. The resulting object might show inconsistencies.")
sage: tr.f_vector()
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
...
ValueError: not all vertices are intersections of facets
sage: tr.f_vector()
(1, 36, 57, 22, 1)
sage: tr
A 3-dimensional polyhedron in RDF^3 defined as the convex hull of 60 vertices
```




---

archive/issue_comments_400936.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-10-18T08:57:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28388#issuecomment-400936",
    "user": "@LaisRast"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_400937.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-10-18T09:16:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28388#issuecomment-400937",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_400938.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-10-18T09:16:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28388#issuecomment-400938",
    "user": "@kliem"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_400939.json:
```json
{
    "body": "It looks good now.",
    "created_at": "2019-10-18T09:31:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28388#issuecomment-400939",
    "user": "@LaisRast"
}
```

It looks good now.



---

archive/issue_comments_400940.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-10-18T09:31:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28388#issuecomment-400940",
    "user": "@LaisRast"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_400941.json:
```json
{
    "body": "missing author name",
    "created_at": "2019-10-18T09:33:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28388#issuecomment-400941",
    "user": "chapoton"
}
```

missing author name



---

archive/issue_comments_400942.json:
```json
{
    "body": "Just a comment. I have no idea where this was added due to the 1000 tickets:\n\n\n```\nraise ValueError(\"not all facets are joins of vertices\")\n```\n\n\nThis error message is very misleading. I would change this to something that does not use the word join. Usually, facet are convex hulls of vertices. Is this what fails here? If yes, then I would change it to that.",
    "created_at": "2019-10-19T10:25:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28388#issuecomment-400942",
    "user": "jipilab"
}
```

Just a comment. I have no idea where this was added due to the 1000 tickets:


```
raise ValueError("not all facets are joins of vertices")
```


This error message is very misleading. I would change this to something that does not use the word join. Usually, facet are convex hulls of vertices. Is this what fails here? If yes, then I would change it to that.



---

archive/issue_comments_400943.json:
```json
{
    "body": "Replying to [comment:11 jipilab]:\n> Just a comment. I have no idea where this was added due to the 1000 tickets:\n> \n> {{{\n> raise ValueError(\"not all facets are joins of vertices\")\n> }}}\n> \n> This error message is very misleading. I would change this to something that does not use the word join. Usually, facet are convex hulls of vertices. Is this what fails here? If yes, then I would change it to that.\n> \n\n`give an error message for polytopes in some cases; removed incorrect example`\n\nIt's an error message that was generated in `CombinatorialPolyhedron`. Convex hull isn't really defined there. But I guess people get what it means.\n\nIts a lot better than what we used to get. This was a very cryptic `KeyError` in hasse diagram and it took me a while to figure out what the error message is supposed to tell us.\n\nIf you think it should be changed now, you can put this ticket, #28605, #28606 and #28614 on needs work, because there will be merge conflicts. Otherwise, we can always fix this later.",
    "created_at": "2019-10-19T10:38:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28388#issuecomment-400943",
    "user": "@kliem"
}
```

Replying to [comment:11 jipilab]:
> Just a comment. I have no idea where this was added due to the 1000 tickets:
> 
> {{{
> raise ValueError("not all facets are joins of vertices")
> }}}
> 
> This error message is very misleading. I would change this to something that does not use the word join. Usually, facet are convex hulls of vertices. Is this what fails here? If yes, then I would change it to that.
> 

`give an error message for polytopes in some cases; removed incorrect example`

It's an error message that was generated in `CombinatorialPolyhedron`. Convex hull isn't really defined there. But I guess people get what it means.

Its a lot better than what we used to get. This was a very cryptic `KeyError` in hasse diagram and it took me a while to figure out what the error message is supposed to tell us.

If you think it should be changed now, you can put this ticket, #28605, #28606 and #28614 on needs work, because there will be merge conflicts. Otherwise, we can always fix this later.



---

archive/issue_comments_400944.json:
```json
{
    "body": "Replying to [comment:12 gh-kliem]:\n> Replying to [comment:11 jipilab]:\n> > Just a comment. I have no idea where this was added due to the 1000 tickets:\n> > \n> > {{{\n> > raise ValueError(\"not all facets are joins of vertices\")\n> > }}}\n> > \n> > This error message is very misleading. I would change this to something that does not use the word join. Usually, facet are convex hulls of vertices. Is this what fails here? If yes, then I would change it to that.\n> > \n> \n> `give an error message for polytopes in some cases; removed incorrect example`\n> \n> It's an error message that was generated in `CombinatorialPolyhedron`. Convex hull isn't really defined there. But I guess people get what it means.\n> \n> Its a lot better than what we used to get. This was a very cryptic `KeyError` in hasse diagram and it took me a while to figure out what the error message is supposed to tell us.\n> \n> If you think it should be changed now, you can put this ticket, #28605, #28606 and #28614 on needs work, because there will be merge conflicts. Otherwise, we can always fix this later.\n\nPlease let the positively reviewed tickets get into a beta before trying to shove them all at once. It's simply impossible to review otherwise.",
    "created_at": "2019-10-19T10:44:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28388#issuecomment-400944",
    "user": "jipilab"
}
```

Replying to [comment:12 gh-kliem]:
> Replying to [comment:11 jipilab]:
> > Just a comment. I have no idea where this was added due to the 1000 tickets:
> > 
> > {{{
> > raise ValueError("not all facets are joins of vertices")
> > }}}
> > 
> > This error message is very misleading. I would change this to something that does not use the word join. Usually, facet are convex hulls of vertices. Is this what fails here? If yes, then I would change it to that.
> > 
> 
> `give an error message for polytopes in some cases; removed incorrect example`
> 
> It's an error message that was generated in `CombinatorialPolyhedron`. Convex hull isn't really defined there. But I guess people get what it means.
> 
> Its a lot better than what we used to get. This was a very cryptic `KeyError` in hasse diagram and it took me a while to figure out what the error message is supposed to tell us.
> 
> If you think it should be changed now, you can put this ticket, #28605, #28606 and #28614 on needs work, because there will be merge conflicts. Otherwise, we can always fix this later.

Please let the positively reviewed tickets get into a beta before trying to shove them all at once. It's simply impossible to review otherwise.



---

archive/issue_comments_400945.json:
```json
{
    "body": "Replying to [comment:13 jipilab]:\n> Replying to [comment:12 gh-kliem]:\n> > Replying to [comment:11 jipilab]:\n> > > Just a comment. I have no idea where this was added due to the 1000 tickets:\n> > > \n> > > {{{\n> > > raise ValueError(\"not all facets are joins of vertices\")\n> > > }}}\n> > > \n> > > This error message is very misleading. I would change this to something that does not use the word join. Usually, facet are convex hulls of vertices. Is this what fails here? If yes, then I would change it to that.\n> > > \n> > \n> > `give an error message for polytopes in some cases; removed incorrect example`\n> > \n> > It's an error message that was generated in `CombinatorialPolyhedron`. Convex hull isn't really defined there. But I guess people get what it means.\n> > \n> > Its a lot better than what we used to get. This was a very cryptic `KeyError` in hasse diagram and it took me a while to figure out what the error message is supposed to tell us.\n> > \n> > If you think it should be changed now, you can put this ticket, #28605, #28606 and #28614 on needs work, because there will be merge conflicts. Otherwise, we can always fix this later.\n> \n> Please let the positively reviewed tickets get into a beta before trying to shove them all at once. It's simply impossible to review otherwise. \n\nI agree that it is a bit confusing. This ticket here has a total number of 7 commits and three of them belong to #28621 and #28607. I think this is doable.\n\nAs this ticket and #28605 conflict, we need to make one depend on the other. I just figured that this here is easier than #28605.",
    "created_at": "2019-10-19T11:58:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28388#issuecomment-400945",
    "user": "@kliem"
}
```

Replying to [comment:13 jipilab]:
> Replying to [comment:12 gh-kliem]:
> > Replying to [comment:11 jipilab]:
> > > Just a comment. I have no idea where this was added due to the 1000 tickets:
> > > 
> > > {{{
> > > raise ValueError("not all facets are joins of vertices")
> > > }}}
> > > 
> > > This error message is very misleading. I would change this to something that does not use the word join. Usually, facet are convex hulls of vertices. Is this what fails here? If yes, then I would change it to that.
> > > 
> > 
> > `give an error message for polytopes in some cases; removed incorrect example`
> > 
> > It's an error message that was generated in `CombinatorialPolyhedron`. Convex hull isn't really defined there. But I guess people get what it means.
> > 
> > Its a lot better than what we used to get. This was a very cryptic `KeyError` in hasse diagram and it took me a while to figure out what the error message is supposed to tell us.
> > 
> > If you think it should be changed now, you can put this ticket, #28605, #28606 and #28614 on needs work, because there will be merge conflicts. Otherwise, we can always fix this later.
> 
> Please let the positively reviewed tickets get into a beta before trying to shove them all at once. It's simply impossible to review otherwise. 

I agree that it is a bit confusing. This ticket here has a total number of 7 commits and three of them belong to #28621 and #28607. I think this is doable.

As this ticket and #28605 conflict, we need to make one depend on the other. I just figured that this here is easier than #28605.



---

archive/issue_comments_400946.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-10-21T22:43:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28388#issuecomment-400946",
    "user": "vbraun"
}
```

Resolution: fixed
