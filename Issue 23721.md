# Issue 23721: Allow rational inner_products for free quadratic ZZ-modules

Issue created by migration from https://trac.sagemath.org/ticket/23958

Original creator: sbrandhorst

Original creation time: 2017-10-02 23:08:47

CC:  roed

Keywords: sd91

FreeQuadraticModule(ZZ,1,matrix([1/2])
should work.


---

Comment by sbrandhorst created at 2017-10-04 10:17:39

New commits:


---

Comment by sbrandhorst created at 2017-10-04 10:17:39

Changing status from new to needs_review.


---

Comment by sbrandhorst created at 2017-10-06 17:49:28

Changing status from needs_review to needs_work.


---

Comment by sbrandhorst created at 2017-10-06 17:49:28

If we bring the inner_product_ring into play, we have to use it for comparison as well.
So first we should implement #23978


---

Comment by git created at 2018-02-20 06:50:16

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-02-20 18:17:53

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by sbrandhorst created at 2018-02-20 18:19:56

Changing status from needs_work to needs_review.


---

Comment by git created at 2018-03-20 11:06:39

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2018-05-05 23:44:36

I don't think this is scaling well. IMO, it would be better to have a class for inner products that holds its (co)domains and takes that into account for comparisons. This would have better separation-of-concerns and make the code easier to maintain.

Addendum: I might also have a use for such a class; plus it would allow you to use coercions.


---

Comment by sbrandhorst created at 2018-05-10 21:26:57

Maybe you are right. I guess calling the coercion model each time you compute the inner
product is too slow. So explicitly saving the ring might be better.
Though it might be a while till I have time for this.


---

Comment by sbrandhorst created at 2018-05-10 21:27:17

Changing status from needs_review to needs_work.


---

Comment by git created at 2018-05-18 15:18:08

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by sbrandhorst created at 2018-05-18 15:19:20

Is this what you had in mind?


---

Comment by sbrandhorst created at 2018-05-18 15:19:20

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2018-05-18 15:47:21

Somewhat. I was thinking of having a full class for bilinear forms along the lines of:

```python
class BilinearForm(object):
    def __init__(self, V, W, R, matrix):
        self._matrix = matrix
        self._V = V
        self._W = W
        self._codomain = R

    def __call__(self, v, w):
        v = self._V(v)
        w = self._W(w)
        return self._codomain(dot_product_wrt_matrix(v, w))

    def codomain(self):
        return self._codomain
```

Ideally it would inherit from `Morphism`, but we don't have tensor products of `FreeModule`s.

Also, I believe only the first check for a coercion between two objects should be slow and all other subsequent coercion checks between the same two parents are cached.


---

Comment by sbrandhorst created at 2018-05-20 05:40:49

This sounds like an almost complete rewrite of the `FreeQuadraticModule` class?


---

Comment by tscrim created at 2018-05-21 04:49:06

Replying to [comment:15 sbrandhorst]:
> This sounds like an almost complete rewrite of the `FreeQuadraticModule` class?

It shouldn't be. It is just extracting out one component: the bilinear form (matrix). However, you are putting more and more into one class that is not purely a concern for that class. Does the `FreeQuadraticModule` class care about the inner product ring or is that really a concern of the bilinear form? Think about it this way, mathematically you first define a bilinear form, then you define the quadratic module, correct?

Also, it would make it easier for other code that uses inner products to take advantage. In principle, all you should be doing is just wrapping the `inner_product_matrix` object, so there should be minimal change beyond that (maybe a few other redirects).


---

Comment by sbrandhorst created at 2018-10-02 10:22:32

Guess you are right. Though in the near future I will not have time for it.


---

Comment by sbrandhorst created at 2018-10-02 10:22:32

Changing status from needs_review to needs_work.


---

Comment by mkoeppe created at 2021-02-13 20:51:01

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.


---

Comment by mkoeppe created at 2021-07-19 00:44:56

Setting a new milestone for this ticket based on a cursory review.
