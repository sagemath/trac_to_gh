# Issue 23721: allow inner products of free modules to take values in rings different from the base ring.

archive/issues_023721.json:
```json
{
    "body": "CC:  @roed314\n\nKeywords: sd91\n\nInner products / bilinear forms  like\n\n`ZZ x ZZ --> CC , RR, QQ`\n\netc. make sense.\n\nMore general, let `M` be a free module over `R` and let `B` be a ring containing `R` then inner products\n`M x M --> B` make sense and can be allowed. \n\nIssue created by migration from https://trac.sagemath.org/ticket/23958\n\n",
    "created_at": "2017-10-02T23:08:47Z",
    "labels": [
        "component: linear algebra"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "allow inner products of free modules to take values in rings different from the base ring.",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23721",
    "user": "https://github.com/simonbrandhorst"
}
```
CC:  @roed314

Keywords: sd91

Inner products / bilinear forms  like

`ZZ x ZZ --> CC , RR, QQ`

etc. make sense.

More general, let `M` be a free module over `R` and let `B` be a ring containing `R` then inner products
`M x M --> B` make sense and can be allowed. 

Issue created by migration from https://trac.sagemath.org/ticket/23958





---

archive/issue_comments_331903.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-10-04T10:17:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23721#issuecomment-331903",
    "user": "https://github.com/simonbrandhorst"
}
```

New commits:



---

archive/issue_comments_331904.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-10-04T10:17:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23721#issuecomment-331904",
    "user": "https://github.com/simonbrandhorst"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_331905.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-10-06T17:49:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23721#issuecomment-331905",
    "user": "https://github.com/simonbrandhorst"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_331906.json:
```json
{
    "body": "If we bring the inner_product_ring into play, we have to use it for comparison as well.\nSo first we should implement #23978",
    "created_at": "2017-10-06T17:49:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23721#issuecomment-331906",
    "user": "https://github.com/simonbrandhorst"
}
```

If we bring the inner_product_ring into play, we have to use it for comparison as well.
So first we should implement #23978



---

archive/issue_comments_331907.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-02-20T06:50:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23721#issuecomment-331907",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_331908.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-02-20T18:17:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23721#issuecomment-331908",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_331909.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-02-20T18:19:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23721#issuecomment-331909",
    "user": "https://github.com/simonbrandhorst"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_331910.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-03-20T11:06:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23721#issuecomment-331910",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_events_060952.json:
```json
{
    "actor": "https://github.com/simonbrandhorst",
    "created_at": "2018-03-20T11:10:28Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/23721",
    "milestone": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23721#event-60952"
}
```



---

archive/issue_comments_331911.json:
```json
{
    "body": "I don't think this is scaling well. IMO, it would be better to have a class for inner products that holds its (co)domains and takes that into account for comparisons. This would have better separation-of-concerns and make the code easier to maintain.\n\nAddendum: I might also have a use for such a class; plus it would allow you to use coercions.",
    "created_at": "2018-05-05T23:44:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23721#issuecomment-331911",
    "user": "https://github.com/tscrim"
}
```

I don't think this is scaling well. IMO, it would be better to have a class for inner products that holds its (co)domains and takes that into account for comparisons. This would have better separation-of-concerns and make the code easier to maintain.

Addendum: I might also have a use for such a class; plus it would allow you to use coercions.



---

archive/issue_comments_331912.json:
```json
{
    "body": "Maybe you are right. I guess calling the coercion model each time you compute the inner\nproduct is too slow. So explicitly saving the ring might be better.\nThough it might be a while till I have time for this.",
    "created_at": "2018-05-10T21:26:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23721#issuecomment-331912",
    "user": "https://github.com/simonbrandhorst"
}
```

Maybe you are right. I guess calling the coercion model each time you compute the inner
product is too slow. So explicitly saving the ring might be better.
Though it might be a while till I have time for this.



---

archive/issue_comments_331913.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-05-10T21:27:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23721#issuecomment-331913",
    "user": "https://github.com/simonbrandhorst"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_331914.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-05-18T15:18:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23721#issuecomment-331914",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_331915.json:
```json
{
    "body": "Is this what you had in mind?",
    "created_at": "2018-05-18T15:19:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23721#issuecomment-331915",
    "user": "https://github.com/simonbrandhorst"
}
```

Is this what you had in mind?



---

archive/issue_comments_331916.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-05-18T15:19:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23721#issuecomment-331916",
    "user": "https://github.com/simonbrandhorst"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_331917.json:
```json
{
    "body": "Somewhat. I was thinking of having a full class for bilinear forms along the lines of:\n\n```python\nclass BilinearForm(object):\n    def __init__(self, V, W, R, matrix):\n        self._matrix = matrix\n        self._V = V\n        self._W = W\n        self._codomain = R\n\n    def __call__(self, v, w):\n        v = self._V(v)\n        w = self._W(w)\n        return self._codomain(dot_product_wrt_matrix(v, w))\n\n    def codomain(self):\n        return self._codomain\n```\nIdeally it would inherit from `Morphism`, but we don't have tensor products of `FreeModule`s.\n\nAlso, I believe only the first check for a coercion between two objects should be slow and all other subsequent coercion checks between the same two parents are cached.",
    "created_at": "2018-05-18T15:47:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23721#issuecomment-331917",
    "user": "https://github.com/tscrim"
}
```

Somewhat. I was thinking of having a full class for bilinear forms along the lines of:

```python
class BilinearForm(object):
    def __init__(self, V, W, R, matrix):
        self._matrix = matrix
        self._V = V
        self._W = W
        self._codomain = R

    def __call__(self, v, w):
        v = self._V(v)
        w = self._W(w)
        return self._codomain(dot_product_wrt_matrix(v, w))

    def codomain(self):
        return self._codomain
```
Ideally it would inherit from `Morphism`, but we don't have tensor products of `FreeModule`s.

Also, I believe only the first check for a coercion between two objects should be slow and all other subsequent coercion checks between the same two parents are cached.



---

archive/issue_comments_331918.json:
```json
{
    "body": "This sounds like an almost complete rewrite of the `FreeQuadraticModule` class?",
    "created_at": "2018-05-20T05:40:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23721#issuecomment-331918",
    "user": "https://github.com/simonbrandhorst"
}
```

This sounds like an almost complete rewrite of the `FreeQuadraticModule` class?



---

archive/issue_comments_331919.json:
```json
{
    "body": "Replying to [comment:15 sbrandhorst]:\n> This sounds like an almost complete rewrite of the `FreeQuadraticModule` class?\n\n\nIt shouldn't be. It is just extracting out one component: the bilinear form (matrix). However, you are putting more and more into one class that is not purely a concern for that class. Does the `FreeQuadraticModule` class care about the inner product ring or is that really a concern of the bilinear form? Think about it this way, mathematically you first define a bilinear form, then you define the quadratic module, correct?\n\nAlso, it would make it easier for other code that uses inner products to take advantage. In principle, all you should be doing is just wrapping the `inner_product_matrix` object, so there should be minimal change beyond that (maybe a few other redirects).",
    "created_at": "2018-05-21T04:49:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23721#issuecomment-331919",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:15 sbrandhorst]:
> This sounds like an almost complete rewrite of the `FreeQuadraticModule` class?


It shouldn't be. It is just extracting out one component: the bilinear form (matrix). However, you are putting more and more into one class that is not purely a concern for that class. Does the `FreeQuadraticModule` class care about the inner product ring or is that really a concern of the bilinear form? Think about it this way, mathematically you first define a bilinear form, then you define the quadratic module, correct?

Also, it would make it easier for other code that uses inner products to take advantage. In principle, all you should be doing is just wrapping the `inner_product_matrix` object, so there should be minimal change beyond that (maybe a few other redirects).



---

archive/issue_comments_331920.json:
```json
{
    "body": "Guess you are right. Though in the near future I will not have time for it.",
    "created_at": "2018-10-02T10:22:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23721#issuecomment-331920",
    "user": "https://github.com/simonbrandhorst"
}
```

Guess you are right. Though in the near future I will not have time for it.



---

archive/issue_comments_331921.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-10-02T10:22:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23721#issuecomment-331921",
    "user": "https://github.com/simonbrandhorst"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_events_060953.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-07-04T05:33:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/23721",
    "milestone": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23721#event-60953"
}
```



---

archive/issue_events_060954.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-07-04T05:33:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/23721",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23721#event-60954"
}
```



---

archive/issue_events_060955.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-13T17:11:30Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/23721",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23721#event-60955"
}
```



---

archive/issue_events_060956.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-13T17:11:30Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/23721",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23721#event-60956"
}
```



---

archive/issue_comments_331922.json:
```json
{
    "body": "Setting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-02-13T20:51:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23721#issuecomment-331922",
    "user": "https://github.com/mkoeppe"
}
```

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_events_060957.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T20:51:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/23721",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23721#event-60957"
}
```



---

archive/issue_events_060958.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T20:51:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/23721",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23721#event-60958"
}
```



---

archive/issue_events_060959.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/23721",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23721#event-60959"
}
```



---

archive/issue_events_060960.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/23721",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23721#event-60960"
}
```



---

archive/issue_comments_331923.json:
```json
{
    "body": "Setting a new milestone for this ticket based on a cursory review.",
    "created_at": "2021-07-19T00:44:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23721#issuecomment-331923",
    "user": "https://github.com/mkoeppe"
}
```

Setting a new milestone for this ticket based on a cursory review.



---

archive/issue_events_060961.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:24:17Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/23721",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23721#event-60961"
}
```



---

archive/issue_events_060962.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:24:17Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/23721",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23721#event-60962"
}
```



---

archive/issue_events_060963.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-02T20:27:49Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/23721",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23721#event-60963"
}
```



---

archive/issue_events_060964.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-02T20:27:49Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/23721",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23721#event-60964"
}
```



---

archive/issue_events_060965.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/23721",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23721#event-60965"
}
```



---

archive/issue_events_060966.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/23721",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23721#event-60966"
}
```
