# Issue 18987: swtich OA(k,n)+* strongly regular graphs

Issue created by migration from https://trac.sagemath.org/ticket/19224

Original creator: ncohen

Original creation time: 2015-09-16 13:25:29

CC:  dimpase

This branch adds the "switch OA(k,n)+*" graphs used in Andries Brouwer's database.

Nathann


---

Comment by ncohen created at 2015-09-16 13:26:09

New commits:


---

Comment by ncohen created at 2015-09-16 13:26:09

Changing status from new to needs_review.


---

Comment by vdelecroix created at 2015-09-19 03:16:32

Hello,

1. You wrote

```
from math import sqrt
cdef int n = int(sqrt(n_2_p_1-1))
```

  Sage integers do have a method `sqrtrem` that gives you the square root and the rest

```
sage: x = ZZ.random_element(0,10000)
sage: s,r = x.sqrtrem()
sage: x == s**2 + r
True
```

  But as you are using int from Cython you would better use standard C functions

```
from libc.math cimport sqrt, floor
```


2. Why are you testing withtout the option `resolvable=True`

```
if (k % n          or
   ...
   not orthogonal_array(c+1,n,existence=True)):
      return None
```

  while using in the function

```
def switch_OA_srg(c,n):
    ...
    OA = map(tuple, orthogonal_array(c+1,n,resolvable=True))
    ...
```


3. Use better spacings: `int v,int k,int l` -> `int v, int k, int l`.

4. Do you mind moving out the function `switch_OA_srg` into a global function? With such local definition you are generating again and again different Python functions with the very same code

```
sage: f1 = is_switch_OA_srg(290, 136, 63, 64)[0]
sage: f2 = is_switch_OA_srg(290, 136, 63, 64)[0]
sage: f1 is f2
False
```


5. Could you add an example of a SRG that was not available before?

Vincent


---

Comment by vdelecroix created at 2015-09-19 03:16:32

Changing status from needs_review to needs_work.


---

Comment by git created at 2015-09-19 06:55:28

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by ncohen created at 2015-09-19 07:02:07

Hello,

> 1. You wrote
> {{{
> from math import sqrt
> cdef int n = int(sqrt(n_2_p_1-1))
> }}}

I did that because sqrt(-4) raises an exception, while in C floor(-a) returns nan. I prefer this behaviour when I do not need the speed. As a reviewer, your job is to make sure that the code is correct an reliable, properly documented etc. These kind of comments are to me a matter of taste, and it would be cool if you proposed a commit rather than include as part of your review that the way it is done does not conform to your taste. As there isn't, I believe, any reason to prefer yours over mine in this context where the speed difference does not matter.

> 2. Why are you testing withtout the option `resolvable=True`

That's a mistake indeed.

> 3. Use better spacings: `int v,int k,int l` -> `int v, int k, int l`.

As previously, please propose a commit the next time you cannot tolerate a missing space.

> 4. Do you mind moving out the function `switch_OA_srg` into a global function? With such local definition you are generating again and again different Python functions with the very same code

It is not that I would mind, but mostly that I would not know how to write its documentation to my taste. The subfunction takes `c` and `n`  as parameters, whose role has to be explained. Plus 'c' is actually used twice in the function in "different ways" (it has two different meanings in the construction), so that the independent function should probably differenciate the two uses of 'c' instead of tying them to be equal (and I have no use for that generalization). The result would be unclear, look hardcoded, and the name of the function is hard to pick too as this class does not seem very standard.

More technically, I could not care less about returning functions which are not equal to each other. My job here is to build new graphs.

> 5. Could you add an example of a SRG that was not available before?

What about the 4 that already appear in the doctest?

Nathann


---

Comment by ncohen created at 2015-09-20 20:21:13

Changing status from needs_work to needs_review.


---

Comment by vdelecroix created at 2015-09-20 20:29:51

Replying to [comment:4 ncohen]:
> > 5. Could you add an example of a SRG that was not available before?
> 
> What about the 4 that already appear in the doctest?

I meant in the function `graphs.strongly_regular_graphs`.

Vincent


---

Comment by ncohen created at 2015-09-20 20:33:54

Do you mean that you want a doctest that checks that the new srg is available through the general constructor (like we did for designs)?

Nathann


---

Comment by vdelecroix created at 2015-09-20 20:36:51

Replying to [comment:7 ncohen]:
> Do you mean that you want a doctest that checks that the new srg is available through the general constructor (like we did for designs)?

Yes, would be good to check that the construction is actually useful...

```
sage: graphs.strongly_regular_graph(my_new_parameters)
!Got one!
```



---

Comment by git created at 2015-09-20 20:52:27

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2015-09-24 17:18:19

you do not test anywhere that graphs you construct in this functions are SRGs with parameters you claim they will have. IMHO such tests must be present.


---

Comment by dimpase created at 2015-09-24 17:18:19

Changing status from needs_review to needs_work.


---

Comment by ncohen created at 2015-09-24 18:07:43

I do in the doctest that builds the SRG by calling `graphs.strongly_regular_graph` (remember that it checks its output). Before, I had the usual "build the graph + test" doctest, but Vincent wanted me to query the general constructor instead.

So well, this doctest actually builds the graph and tests it. Like the one that was there before it.

Nathann


---

Comment by dimpase created at 2015-09-24 18:19:11

Replying to [comment:11 ncohen]:
> I do in the doctest that builds the SRG by calling `graphs.strongly_regular_graph` (remember that it checks its output). Before, I had the usual "build the graph + test" doctest, but Vincent wanted me to query the general constructor instead.
> 
> So well, this doctest actually builds the graph and tests it. Like the one that was there before it.

it does not strike me as a reliable way to test; if the implementation of `graphs.strongly_regular_graph` changes, you'd be SOL. And testing only one tuple of parameters looks a bit too weak, too...


---

Comment by git created at 2015-09-24 18:25:29

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by ncohen created at 2015-09-24 18:25:53

Changing status from needs_work to needs_review.


---

Comment by dimpase created at 2015-09-24 19:06:30

Changing status from needs_review to positive_review.


---

Comment by dimpase created at 2015-09-24 19:06:30

OK


---

Comment by vbraun created at 2015-10-11 09:04:35

Reviewer name


---

Comment by vbraun created at 2015-10-11 09:04:35

Changing status from positive_review to needs_work.


---

Comment by ncohen created at 2015-10-11 09:28:21

Changing status from needs_work to positive_review.


---

Comment by ncohen created at 2015-10-11 09:28:21

Dima. Please.. `-_-`


---

Comment by vbraun created at 2015-10-12 07:16:03

Resolution: fixed
