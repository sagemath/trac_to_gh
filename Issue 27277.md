# Issue 27277: Cygwin docbuild fails

Issue created by migration from https://trac.sagemath.org/ticket/27514

Original creator: vbraun

Original creation time: 2019-03-19 21:28:18

CC:  embray jdemeyer

This is on the cygwin buildbot:

```
**********************************************************************
File "src/sage_setup/docbuild/__init__.py", line 105, in sage_setup.docbuild.builder_helper
Failed example:
    build_many(build_ref_doc, [("docname", "en", "html", {})])
Expected:
    Traceback (most recent call last):
    ...
    Exception: ('Non-exception during docbuild: abort pool operation', BaseException('abort pool operation',))
Got:
    Process Process-3733:1:
    Traceback (most recent call last):
      File "/home/Admin/sage-buildbot-worker/sage_git/build/local/lib/python2.7/multiprocessing/process.py", line 267, in _bootstrap
        self.run()
      File "/home/Admin/sage-buildbot-worker/sage_git/build/local/lib/python2.7/multiprocessing/process.py", line 114, in run
        self._target(*self._args, **self._kwargs)
      File "/home/Admin/sage-buildbot-worker/sage_git/build/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py", line 80, in build_ref_doc
        getattr(ReferenceSubBuilder(doc, lang), format)(*args, **kwds)
      File "/home/Admin/sage-buildbot-worker/sage_git/build/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py", line 763, in _wrapper
        getattr(DocBuilder, build_type)(self, *args, **kwds)
      File "/home/Admin/sage-buildbot-worker/sage_git/build/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py", line 145, in f
        raise Exception("Non-exception during docbuild: %s"%(e,), e)
    Exception: ('Non-exception during docbuild: abort pool operation', BaseException('abort pool operation',))
    Traceback (most recent call last):
      File "/home/Admin/sage-buildbot-worker/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 671, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/Admin/sage-buildbot-worker/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1095, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage_setup.docbuild.builder_helper[7]>", line 1, in <module>
        build_many(build_ref_doc, [("docname", "en", "html", {})])
      File "/home/Admin/sage-buildbot-worker/sage_git/build/local/lib/python2.7/site-packages/sage_setup/docbuild/utils.py", line 214, in _build_many
        raise worker_exc
    WorkerDiedException: worker for ('docname', 'en', 'html', {}) died with non-zero exit code 1
**********************************************************************
1 item had failures:
   1 of  10 in sage_setup.docbuild.builder_helper
    [36 tests, 1 failure, 2.33 s]
----------------------------------------------------------------------
```



---

Comment by embray created at 2019-03-20 08:53:11

I'm not sure what to even do about this test since it's not applicable to the new `build_many` code.  This test is a regression test for behavior specific to `multiprocessing.Pool.map`.


---

Comment by embray created at 2019-04-17 10:15:03

Fixes the issue with a small bit of refactoring to ensure that the test in question is always actually testing the `build_many` implementation to which it applies.
----
New commits:


---

Comment by embray created at 2019-04-17 10:15:03

Changing status from new to needs_review.


---

Comment by embray created at 2019-06-12 09:40:54

Ping?


---

Comment by vbraun created at 2019-06-12 17:17:17

Changing status from needs_review to positive_review.


---

Comment by embray created at 2019-06-13 08:43:57

Thank you!


---

Comment by vbraun created at 2019-06-27 20:13:39

Resolution: fixed


---

Comment by embray created at 2019-07-03 11:34:48

Not in Sage 8.8.  Let's please to try keep tickets' milestones related to the release in which we actually intend to include them, and in particular the release in which they were _actually_ included, especially when closing tickets.
