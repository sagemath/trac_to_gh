# Issue 32689: Features for latex packages

Issue created by migration from https://trac.sagemath.org/ticket/32926

Original creator: mkoeppe

Original creation time: 2021-11-24 01:36:22

CC:  slabbe klee




---

Comment by mkoeppe created at 2021-11-24 02:07:11

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2021-11-24 02:07:11

Last 10 new commits:


---

Comment by slabbe created at 2021-11-25 11:08:50

Changing status from needs_review to needs_work.


---

Comment by slabbe created at 2021-11-25 11:08:50

When testing the feature, I get:

```
NameError: name 'FeatureNotPresentError' is not defined
```

an import is missing.


---

Comment by git created at 2021-11-25 18:02:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-11-25 18:02:44

Changing status from needs_work to needs_review.


---

Comment by klee created at 2021-11-30 12:50:06


```diff
diff --git a/src/sage/features/latex.py b/src/sage/features/latex.py
index 7b95796be4..7bd8d72164 100644
--- a/src/sage/features/latex.py
+++ b/src/sage/features/latex.py
@@ -147,7 +147,7 @@ class TeXFile(StaticFile):
         sage: from sage.features.latex import TeXFile
         sage: TeXFile('x', 'x.tex').is_present()  # optional: pdflatex
         FeatureTestResult('x', True)
-        sage: TeXFile('nonexisting', 'fajfhjdksf-nonexisting-file.tex').is_present()  # optional: pdflatex
+        sage: TeXFile('nonexisting', 'xxxxxx-nonexisting-file.tex').is_present()  # optional - pdflatex
         FeatureTestResult('nonexisting', False)
     """
     def __init__(self, name, filename, **kwds):
@@ -161,7 +161,7 @@ class TeXFile(StaticFile):
 
             sage: from sage.features.latex import TeXFile
             sage: feature = TeXFile('latex_class_article', 'article.cls')
-            sage: feature.absolute_path()  # optional: pdflatex
+            sage: feature.absolute_path()  # optional - pdflatex
             '.../latex/base/article.cls'
         """
         from subprocess import run, CalledProcessError, PIPE
@@ -183,7 +183,7 @@ class LaTeXPackage(TeXFile):
     EXAMPLES::
 
         sage: from sage.features.latex import LaTeXPackage
-        sage: LaTeXPackage('graphics').is_present()  # optional: pdflatex
+        sage: LaTeXPackage('graphics').is_present()  # optional - pdflatex
         FeatureTestResult('latex_package_graphics', True)
     """
     @staticmethod
```


Otherwise, looks good to me.


---

Comment by mkoeppe created at 2021-11-30 17:01:25

I agree with these changes, please push them to the ticket


---

Comment by git created at 2021-12-01 00:21:13

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by klee created at 2021-12-01 00:22:40

Changing status from needs_review to positive_review.


---

Comment by klee created at 2021-12-01 00:22:40

Okay. Done.


---

Comment by klee created at 2021-12-01 00:24:03

Changing status from positive_review to needs_work.


---

Comment by klee created at 2021-12-01 00:24:28

Let's wait for the patchbot run once more.


---

Comment by klee created at 2021-12-01 00:24:28

Changing status from needs_work to needs_review.


---

Comment by slabbe created at 2021-12-01 07:38:19

There are latex related failures on the patchbot, that may be caused by this ticket:


```
Using --optional=build,debian,dochtml,pip,sage,sage_spkg
Features to be detected: 4ti2,benzene,bliss,buckygen,conway_polynomials,csdp,database_cremona_ellcurve,database_cremona_mini_ellcurve,database_jones_numfield,database_knotinfo,dvipng,ffmpeg,graphviz,imagemagick,jupymake,kenzo,latex,latex_package_tkz_graph,latte_int,lrslib,lualatex,mcqd,meataxe,pandoc,pdf2svg,pdflatex,plantri,pynormaliz,rubiks,sage.combinat,sage.geometry.polyhedron,sage.graphs,sage.plot,sage.rings.number_field,sage.rings.real_double,sage.symbolic,sage_numerical_backends_coin,tdlib,xelatex
...
----------------------------------------------------------------------
sage -t --long --random-seed=178499729190442340371727389632049879918 src/sage/plot/plot.py  # 89 doctests failed
sage -t --long --random-seed=178499729190442340371727389632049879918 src/sage/plot/graphics.py  # 63 doctests failed
sage -t --long --random-seed=178499729190442340371727389632049879918 src/sage/misc/latex.py  # 1 doctest failed
----------------------------------------------------------------------
Features detected for doctesting: 4ti2,dvipng,ffmpeg,graphviz,latex,latex_package_tkz_graph,lrslib,lualatex,pdflatex,sage.combinat,sage.geometry.polyhedron,sage.graphs,sage.plot,sage.rings.number_field,sage.rings.real_double,sage.symbolic,xelatex
```


in particular:


```
sage -t --long --random-seed=178499729190442340371727389632049879918 src/sage/misc/latex.py
**********************************************************************
File "src/sage/misc/latex.py", line 1968, in sage.misc.latex.?
Failed example:
    png(ZZ[x], os.path.join(SAGE_TMP, "zz.png")) # random, optional - latex
Exception raised:
    Traceback (most recent call last):
      File "/home/debian/sage/local/lib/python3.9/site-packages/sage/doctest/forker.py", line 694, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/debian/sage/local/lib/python3.9/site-packages/sage/doctest/forker.py", line 1088, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.misc.latex.?[1]>", line 1, in <module>
        png(ZZ[x], os.path.join(SAGE_TMP, "zz.png")) # random, optional - latex
      File "/home/debian/sage/local/lib/python3.9/site-packages/sage/misc/latex.py", line 1990, in png
        e = _run_latex_(tex_file, density=density, debug=debug,
      File "/home/debian/sage/local/lib/python3.9/site-packages/sage/misc/latex.py", line 755, in _run_latex_
        ImageMagick().require()
      File "/home/debian/sage/local/lib/python3.9/site-packages/sage/features/__init__.py", line 205, in require
        raise FeatureNotPresentError(self, presence.reason, presence.resolution)
    sage.features.FeatureNotPresentError: imagemagick is not available.
    Executable 'convert' not found on PATH.
    To install imagemagick using the debian package manager, you can try to run:
    !sudo apt-get update 
      !sudo apt-get install  texlive-latex-extra texlive-xetex latexmk dvipng default-jdk ffmpeg libavdevice-dev
    To install imagemagick using the Sage package manager, you can try to run:
      !sage -i _recommended
    No equivalent system packages for pip are known to Sage.
    Further installation instructions might be available at https://www.imagemagick.org/.
**********************************************************************
1 item had failures:
   1 of  19 in sage.misc.latex.?
    [257 tests, 1 failure, 5.09 s]
```


Also notice:


```
To install imagemagick using the debian package manager, you can try to run:
    !sudo apt-get update 
    !sudo apt-get install  texlive-latex-extra texlive-xetex latexmk dvipng default-jdk ffmpeg libavdevice-dev
```



---

Comment by mkoeppe created at 2021-12-01 07:52:04

This failure in testing `src/sage/misc/latex.py` is probably already visible with #32174.


---

Comment by git created at 2021-12-01 07:54:41

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-12-01 08:01:50

Not sure what's going on in the other failures in `sage.plot`.


---

Comment by slabbe created at 2021-12-01 10:44:04

(_This comment was moved to_ #32174#comment:56)


---

Comment by slabbe created at 2021-12-01 10:50:31

Replying to [comment:17 mkoeppe]:
> This failure in testing `src/sage/misc/latex.py` is probably already visible with #32174.

Ok, so I confirm that the 89 + 63 failures are already seen by the patchbot `labri-vindelecroix-1` while testing #32174, so it is not related to the current ticket.


---

Comment by git created at 2021-12-01 18:17:47

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by mkoeppe created at 2021-12-01 18:17:59

rebased on top of updated #32174


---

Comment by slabbe created at 2021-12-01 21:15:17

Replying to [comment:16 slabbe]:
> Also notice:
> 
> {{{
> To install imagemagick using the debian package manager, you can try to run:
>     !sudo apt-get update 
>     !sudo apt-get install  texlive-latex-extra texlive-xetex latexmk dvipng default-jdk ffmpeg libavdevice-dev
> }}}

See #32956 to deal with that.


---

Comment by klee created at 2021-12-03 05:35:04

Changing status from needs_review to positive_review.


---

Comment by klee created at 2021-12-03 05:35:04

No more thing to do here. Right?


---

Comment by slelievre created at 2021-12-03 05:53:12

Maybe a short ticket description?

E.g. is there a meta-ticket or documentation page
or release tour item about "features"?

Other than that, this ticket depends on #32174
which still needs review.


---

Comment by klee created at 2021-12-03 06:48:48

Changing status from positive_review to needs_work.


---

Comment by klee created at 2021-12-03 06:48:48

Okay then.


---

Comment by klee created at 2021-12-03 07:41:49

Changing status from needs_work to needs_review.


---

Comment by klee created at 2021-12-03 08:06:19

As the dependency #32174 just got positive review.


---

Comment by klee created at 2021-12-03 08:06:19

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2021-12-12 15:59:45


```
sage -t --long --warn-long 41.2 --random-seed=90818346224792411697676027482246961463 src/sage/doctest/external.py
**********************************************************************
File "src/sage/doctest/external.py", line 379, in sage.doctest.external.AvailableSoftware
Failed example:
    external_software
Expected:
    ['cplex',
     'gurobi',
     'internet',
     'latex',
     'lualatex',
     'macaulay2',
     'magma',
     'maple',
     'mathematica',
     'matlab',
     'octave',
     'pdflatex',
     'scilab',
     'xelatex']
Got:
    ['cplex',
     'gurobi',
     'internet',
     'latex',
     'latex_package_tkz_graph',
     'lualatex',
     'macaulay2',
     'magma',
     'maple',
     'mathematica',
     'matlab',
     'octave',
     'pdflatex',
     'scilab',
     'xelatex']
**********************************************************************
1 item had failures:
   1 of   3 in sage.doctest.external.AvailableSoftware
    [40 tests, 1 failure, 0.02 s]
```



---

Comment by vbraun created at 2021-12-12 15:59:45

Changing status from positive_review to needs_work.


---

Comment by git created at 2021-12-12 17:39:57

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-12-12 17:40:07

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2021-12-19 11:46:46

Resolution: fixed
