# Issue 26018: coxeter_matrix of ReflectionGroup does not agree with the relations

archive/issues_026018.json:
```json
{
    "body": "CC:  stumpc5\n\nKeywords: Coxeter group\n\n\n```\nsage: R = ReflectionGroup(['B',8])\nsage: s = R.simple_reflections()\nsage: s[7]*s[8]*s[7] == s[8]*s[7]*s[8]\nTrue\nsage: s[1]*s[2]*s[1] == s[2]*s[1]*s[2]\nFalse\nsage: R.coxeter_matrix()\n[1 3 2 2 2 2 2 2]\n[3 1 3 2 2 2 2 2]\n[2 3 1 3 2 2 2 2]\n[2 2 3 1 3 2 2 2]\n[2 2 2 3 1 3 2 2]\n[2 2 2 2 3 1 3 2]\n[2 2 2 2 2 3 1 4]\n[2 2 2 2 2 2 4 1]\n```\n\nThis is due to the indexing convention of the simple roots.\n\nIssue created by migration from https://trac.sagemath.org/ticket/26255\n\n",
    "created_at": "2018-09-12T07:25:45Z",
    "labels": [
        "component: group theory",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.4",
    "title": "coxeter_matrix of ReflectionGroup does not agree with the relations",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/26018",
    "user": "https://github.com/tscrim"
}
```
CC:  stumpc5

Keywords: Coxeter group


```
sage: R = ReflectionGroup(['B',8])
sage: s = R.simple_reflections()
sage: s[7]*s[8]*s[7] == s[8]*s[7]*s[8]
True
sage: s[1]*s[2]*s[1] == s[2]*s[1]*s[2]
False
sage: R.coxeter_matrix()
[1 3 2 2 2 2 2 2]
[3 1 3 2 2 2 2 2]
[2 3 1 3 2 2 2 2]
[2 2 3 1 3 2 2 2]
[2 2 2 3 1 3 2 2]
[2 2 2 2 3 1 3 2]
[2 2 2 2 2 3 1 4]
[2 2 2 2 2 2 4 1]
```

This is due to the indexing convention of the simple roots.

Issue created by migration from https://trac.sagemath.org/ticket/26255





---

archive/issue_comments_366661.json:
```json
{
    "body": "Thanks for pointing this out -- I am totally annoyed by these issues! I will provide a solution by actually computing this matrix myself without any reference to the Cartan type.",
    "created_at": "2018-09-12T07:31:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26018#issuecomment-366661",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

Thanks for pointing this out -- I am totally annoyed by these issues! I will provide a solution by actually computing this matrix myself without any reference to the Cartan type.



---

archive/issue_comments_366662.json:
```json
{
    "body": "Sounds quite reasonable.",
    "created_at": "2018-09-12T07:34:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26018#issuecomment-366662",
    "user": "https://github.com/tscrim"
}
```

Sounds quite reasonable.



---

archive/issue_comments_366663.json:
```json
{
    "body": "Well, the disadvantage is that the outcome then is a plain matrix and not a `CoxeterMatrix`. But I am okay with this. What do you think?",
    "created_at": "2018-09-12T07:37:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26018#issuecomment-366663",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

Well, the disadvantage is that the outcome then is a plain matrix and not a `CoxeterMatrix`. But I am okay with this. What do you think?



---

archive/issue_comments_366664.json:
```json
{
    "body": "I indeed should probably also relabel the Cartan type accordingly...",
    "created_at": "2018-09-12T07:39:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26018#issuecomment-366664",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

I indeed should probably also relabel the Cartan type accordingly...



---

archive/issue_comments_366665.json:
```json
{
    "body": "If you pass the data to `CoxeterMatrix`, it should recognize it as type B<sub>n</sub> under the different labeling IIRC.",
    "created_at": "2018-09-12T07:59:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26018#issuecomment-366665",
    "user": "https://github.com/tscrim"
}
```

If you pass the data to `CoxeterMatrix`, it should recognize it as type B<sub>n</sub> under the different labeling IIRC.



---

archive/issue_comments_366666.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-09-17T12:37:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26018#issuecomment-366666",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_366667.json:
```json
{
    "body": "New commits:",
    "created_at": "2018-09-17T12:37:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26018#issuecomment-366667",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

New commits:



---

archive/issue_comments_366668.json:
```json
{
    "body": "Overall, LGTM, but the output of `coxeter_diagram` should be an immutable graph since it is cached. I would actually just build all of the data, then pass it in with the `immutable=True`, so\n\n```python\n        V = self.index_set()\n        S = self.simple_reflections()\n        E = []\n        for i,j in combinations(V, 2):\n            o = (S[i]*S[j]).order()\n            if o >= 3:\n                E.append((i,j,o))\n        return Graph([V,E], format='vertices_and_edges', immutable=True)\n```\n",
    "created_at": "2018-09-17T13:11:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26018#issuecomment-366668",
    "user": "https://github.com/tscrim"
}
```

Overall, LGTM, but the output of `coxeter_diagram` should be an immutable graph since it is cached. I would actually just build all of the data, then pass it in with the `immutable=True`, so

```python
        V = self.index_set()
        S = self.simple_reflections()
        E = []
        for i,j in combinations(V, 2):
            o = (S[i]*S[j]).order()
            if o >= 3:
                E.append((i,j,o))
        return Graph([V,E], format='vertices_and_edges', immutable=True)
```




---

archive/issue_comments_366669.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-09-17T13:16:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26018#issuecomment-366669",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_366670.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-09-17T21:56:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26018#issuecomment-366670",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_366671.json:
```json
{
    "body": "Thank you. LGTM.",
    "created_at": "2018-09-17T21:56:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26018#issuecomment-366671",
    "user": "https://github.com/tscrim"
}
```

Thank you. LGTM.



---

archive/issue_comments_366672.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-09-20T17:46:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26018#issuecomment-366672",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_065376.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-09-20T17:46:44Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/26018",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26018#event-65376"
}
```
