# Issue 26018: coxeter_matrix of ReflectionGroup does not agree with the relations

Issue created by migration from Trac.

Original creator: tscrim

Original creation time: 2018-09-12 07:25:45

CC:  stumpc5

Keywords: Coxeter group


```
sage: R = ReflectionGroup(['B',8])
sage: s = R.simple_reflections()
sage: s[7]*s[8]*s[7] == s[8]*s[7]*s[8]
True
sage: s[1]*s[2]*s[1] == s[2]*s[1]*s[2]
False
sage: R.coxeter_matrix()
[1 3 2 2 2 2 2 2]
[3 1 3 2 2 2 2 2]
[2 3 1 3 2 2 2 2]
[2 2 3 1 3 2 2 2]
[2 2 2 3 1 3 2 2]
[2 2 2 2 3 1 3 2]
[2 2 2 2 2 3 1 4]
[2 2 2 2 2 2 4 1]
```

This is due to the indexing convention of the simple roots.


---

Comment by stumpc5 created at 2018-09-12 07:31:25

Thanks for pointing this out -- I am totally annoyed by these issues! I will provide a solution by actually computing this matrix myself without any reference to the Cartan type.


---

Comment by tscrim created at 2018-09-12 07:34:18

Sounds quite reasonable.


---

Comment by stumpc5 created at 2018-09-12 07:37:39

Well, the disadvantage is that the outcome then is a plain matrix and not a `CoxeterMatrix`. But I am okay with this. What do you think?


---

Comment by stumpc5 created at 2018-09-12 07:39:21

I indeed should probably also relabel the Cartan type accordingly...


---

Comment by tscrim created at 2018-09-12 07:59:58

If you pass the data to `CoxeterMatrix`, it should recognize it as type B<sub>n</sub> under the different labeling IIRC.


---

Comment by stumpc5 created at 2018-09-17 12:37:13

Changing status from new to needs_review.


---

Comment by stumpc5 created at 2018-09-17 12:37:13

New commits:


---

Comment by tscrim created at 2018-09-17 13:11:38

Overall, LGTM, but the output of `coxeter_diagram` should be an immutable graph since it is cached. I would actually just build all of the data, then pass it in with the `immutable=True`, so

```python
        V = self.index_set()
        S = self.simple_reflections()
        E = []
        for i,j in combinations(V, 2):
            o = (S[i]*S[j]).order()
            if o >= 3:
                E.append((i,j,o))
        return Graph([V,E], format='vertices_and_edges', immutable=True)
```



---

Comment by git created at 2018-09-17 13:16:31

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2018-09-17 21:56:13

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2018-09-17 21:56:13

Thank you. LGTM.


---

Comment by vbraun created at 2018-09-20 17:46:44

Resolution: fixed
