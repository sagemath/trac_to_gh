# Issue 27458: Produce consistent graph6 and dig6 strings in python3

archive/issues_027458.json:
```json
{
    "body": "CC:  @dcoudert @fchapoton\n\nKeywords: python3\n\nCurrently given a `Graph` (or a `DiGraph`) `G` its graph6 (or dig6)\nrepresentation is produced via the auxiliary method `sage.graphs.generic_graph.GenericGraph._bit_vector`. This method converts vertices to integers from `range(n)` and then produces a binary string recording (directed) edges. The conversion is done basically via `enumerate(self)`. \n\nSuppose that `G` has already vertices labelled by `range(n)`. Then in Python 2 the\nabove conversion does nothing and the correspondence\nposition_in_the_resulting_string --- edges_of_`G` depends uniquely on `n`.\nOn the contrary, since in Python 3 dictionaries are read in insertion order, the\ncorrespondence depends heavily on the way in which `G` is created.\n\nThis makes the resulting string unreliable\n\n```\nsage: dg = DiGraph([(0,1,1)])\nsage: dg.relabel({0:1,1:0})\nsage: DiGraph(dg.dig6_string()) == dg # Python 3\nFalse\nsage: DiGraph(dg.dig6_string()) == dg # Python 2\nTrue\n```\nand creates several doctes failures in `sage.combinat.cluster_algebra_quiver`.\nThis ticket proposes two alternative solutions to this problem.\n\nSolution 1: replace `enumerate(self)` by `enumerate(sorted(self))` in\n`_bit_vector`. This keeps the current behaviour at the price of a (small?)\nslowdown.\n\nSolution 2: enforce the fact that graph6 and dig6 representations make sense\nonly for graphs with vertex set `range(n)` and raise an error otherwise. (The current code silently encodes an isomorphic graph.)\n\nTo put things in perspective, these representations are barely used outside of `cluster_algebra_quiver` so neither solution would have a big impact on other code. On the contrary in `cluster_algebra_quiver` they are used extensively as a way of comparing isomorphism classes of quivers. This is not the right way of doing so (one should use `sage.graphs.generic_graph.GenericGraph.canonical_label` instead) but, personally, I do not thing that reimplementing  `cluster_algebra_quiver` is worth the effort.\n\nIssue created by migration from https://trac.sagemath.org/ticket/27695\n\n",
    "created_at": "2019-04-17T19:31:56Z",
    "labels": [
        "component: graph theory",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.8",
    "title": "Produce consistent graph6 and dig6 strings in python3",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27458",
    "user": "https://github.com/etn40ff"
}
```
CC:  @dcoudert @fchapoton

Keywords: python3

Currently given a `Graph` (or a `DiGraph`) `G` its graph6 (or dig6)
representation is produced via the auxiliary method `sage.graphs.generic_graph.GenericGraph._bit_vector`. This method converts vertices to integers from `range(n)` and then produces a binary string recording (directed) edges. The conversion is done basically via `enumerate(self)`. 

Suppose that `G` has already vertices labelled by `range(n)`. Then in Python 2 the
above conversion does nothing and the correspondence
position_in_the_resulting_string --- edges_of_`G` depends uniquely on `n`.
On the contrary, since in Python 3 dictionaries are read in insertion order, the
correspondence depends heavily on the way in which `G` is created.

This makes the resulting string unreliable

```
sage: dg = DiGraph([(0,1,1)])
sage: dg.relabel({0:1,1:0})
sage: DiGraph(dg.dig6_string()) == dg # Python 3
False
sage: DiGraph(dg.dig6_string()) == dg # Python 2
True
```
and creates several doctes failures in `sage.combinat.cluster_algebra_quiver`.
This ticket proposes two alternative solutions to this problem.

Solution 1: replace `enumerate(self)` by `enumerate(sorted(self))` in
`_bit_vector`. This keeps the current behaviour at the price of a (small?)
slowdown.

Solution 2: enforce the fact that graph6 and dig6 representations make sense
only for graphs with vertex set `range(n)` and raise an error otherwise. (The current code silently encodes an isomorphic graph.)

To put things in perspective, these representations are barely used outside of `cluster_algebra_quiver` so neither solution would have a big impact on other code. On the contrary in `cluster_algebra_quiver` they are used extensively as a way of comparing isomorphism classes of quivers. This is not the right way of doing so (one should use `sage.graphs.generic_graph.GenericGraph.canonical_label` instead) but, personally, I do not thing that reimplementing  `cluster_algebra_quiver` is worth the effort.

Issue created by migration from https://trac.sagemath.org/ticket/27695





---

archive/issue_comments_386758.json:
```json
{
    "body": "Consider the following example with Python2 and Solution 1 (i.e., using `enumerate(sorted(self))`). You get:\n\n```\nsage: G = graphs.RandomTree(20)\nsage: G.graph6_string()\n'S??W??@???o??o@A?O?AG?CG??@_?A??W'\nsage: V = G.vertices()\nsage: shuffle(V)\nsage: G.relabel(perm=V, inplace=True)\nsage: G.graph6_string()\n'So??g??AA??GH???G??_Aa??@o?C???G?'\n```\nThe graph6 string depends on the way vertices are labeled and so cannot be used to check isomorphisms, unless you ask for the graph6 string of a canonical form.\n\nSo what should be done is:\n- fix `canonical_form` for Python3 (#27571)\n- rewrite `cluster_algebra_quiver` to properly check isomorphisms, that is using `canonical_form` and not graph6 string",
    "created_at": "2019-04-18T07:41:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27458",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27458#issuecomment-386758",
    "user": "https://github.com/dcoudert"
}
```

Consider the following example with Python2 and Solution 1 (i.e., using `enumerate(sorted(self))`). You get:

```
sage: G = graphs.RandomTree(20)
sage: G.graph6_string()
'S??W??@???o??o@A?O?AG?CG??@_?A??W'
sage: V = G.vertices()
sage: shuffle(V)
sage: G.relabel(perm=V, inplace=True)
sage: G.graph6_string()
'So??g??AA??GH???G??_Aa??@o?C???G?'
```
The graph6 string depends on the way vertices are labeled and so cannot be used to check isomorphisms, unless you ask for the graph6 string of a canonical form.

So what should be done is:
- fix `canonical_form` for Python3 (#27571)
- rewrite `cluster_algebra_quiver` to properly check isomorphisms, that is using `canonical_form` and not graph6 string



---

archive/issue_comments_386759.json:
```json
{
    "body": "I agree that graph6 can't be used to compare arbitrary graphs. Indeed what `cluster_algebra_seed` does is to compute first a \"canonical form\" using some in-house logic rather then using `canonical_form`. I do not know why it was implemented in this way and I am not willing to spend much time fixing this code since I consider it just a step above being deprecated.\n\nHaving said this, I think that the issue with ordered vertices and `_bit_vector` is somewhat orthogonal to the implementation of `canonical_form`. What I mean here is that there should be a way to reconstruct any (di)graph with vertices `range(n)` out of its string encoding and this can only be done if bits in the string encoding have a clear bijection to vertices of the graph. Both solutions I proposed achieve this.",
    "created_at": "2019-04-18T08:06:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27458",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27458#issuecomment-386759",
    "user": "https://github.com/etn40ff"
}
```

I agree that graph6 can't be used to compare arbitrary graphs. Indeed what `cluster_algebra_seed` does is to compute first a "canonical form" using some in-house logic rather then using `canonical_form`. I do not know why it was implemented in this way and I am not willing to spend much time fixing this code since I consider it just a step above being deprecated.

Having said this, I think that the issue with ordered vertices and `_bit_vector` is somewhat orthogonal to the implementation of `canonical_form`. What I mean here is that there should be a way to reconstruct any (di)graph with vertices `range(n)` out of its string encoding and this can only be done if bits in the string encoding have a clear bijection to vertices of the graph. Both solutions I proposed achieve this.



---

archive/issue_comments_386760.json:
```json
{
    "body": "You are confusing the labeling of the vertices and the canonical labels. \nIn the example of #comment:2, the vertices are labeled in [0..n-1], but we get different bit vectors.\n\nNow, if you take the canonical form, you get in Python2 with the current release of Sage:\n\n```\nsage: G = graphs.RandomTree(20)\nsage: G.graph6_string()\n'S?GG?A?GK??G????GO?O???G?IC_APA??'\nsage: V = G.vertices()\nsage: shuffle(V)\nsage: H = G.relabel(perm=V, inplace=False)\nsage: H.graph6_string()\n'SGAA?_???@?@?AQOG????C?A?_??`_P??'\nsage: G.canonical_label().graph6_string()\n'S???????C?GC?A?C???@_K?CK?_?E?E@C'\nsage: H.canonical_label().graph6_string()\n'S???????C?GC?A?C???@_K?CK?_?E?E@C'\n```\nThis is however not working in Python3 as `canonical_label` must be fixed.",
    "created_at": "2019-04-18T09:24:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27458",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27458#issuecomment-386760",
    "user": "https://github.com/dcoudert"
}
```

You are confusing the labeling of the vertices and the canonical labels. 
In the example of #comment:2, the vertices are labeled in [0..n-1], but we get different bit vectors.

Now, if you take the canonical form, you get in Python2 with the current release of Sage:

```
sage: G = graphs.RandomTree(20)
sage: G.graph6_string()
'S?GG?A?GK??G????GO?O???G?IC_APA??'
sage: V = G.vertices()
sage: shuffle(V)
sage: H = G.relabel(perm=V, inplace=False)
sage: H.graph6_string()
'SGAA?_???@?@?AQOG????C?A?_??`_P??'
sage: G.canonical_label().graph6_string()
'S???????C?GC?A?C???@_K?CK?_?E?E@C'
sage: H.canonical_label().graph6_string()
'S???????C?GC?A?C???@_K?CK?_?E?E@C'
```
This is however not working in Python3 as `canonical_label` must be fixed.



---

archive/issue_comments_386761.json:
```json
{
    "body": "No, I am not making this confusion but I am probably not explaining my point clearly enough. Let me try again.\n\nIn #comment:2 you build two *isomorphic* graphs both labelled by `range(n)` and  `graph6_string` gives different encodings. This is, I think, the correct behaviour.\n\nWhat I am saying is that in Python 3 if you take two copies of the *same* graph built differently you get different encodings. And this in not the correct behaviour.\n\nHere is an example (it is a bit convoluted because I need to force a different ordering of vertices in `H`):\n\n```\nsage: G = DiGraph()\nsage: G.add_vertices([0,1])\nsage: G.add_edge((0,1,'a'))\n\nsage: H = DiGraph()\nsage: H.add_vertices([1,0])\nsage: H.relabel({0:1,1:0})\nsage: H.add_edge((0,1,'a'))\n\nsage: H == G\nTrue\n\nsage: G.dig6_string() == H.dig6_string()\t# Python 2\nTrue\n\nsage: G.dig6_string() == H.dig6_string()\t# Python 3\nFalse\n```\n\nThis issue has nothing to do with `canonical_label`.",
    "created_at": "2019-04-18T10:48:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27458",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27458#issuecomment-386761",
    "user": "https://github.com/etn40ff"
}
```

No, I am not making this confusion but I am probably not explaining my point clearly enough. Let me try again.

In #comment:2 you build two *isomorphic* graphs both labelled by `range(n)` and  `graph6_string` gives different encodings. This is, I think, the correct behaviour.

What I am saying is that in Python 3 if you take two copies of the *same* graph built differently you get different encodings. And this in not the correct behaviour.

Here is an example (it is a bit convoluted because I need to force a different ordering of vertices in `H`):

```
sage: G = DiGraph()
sage: G.add_vertices([0,1])
sage: G.add_edge((0,1,'a'))

sage: H = DiGraph()
sage: H.add_vertices([1,0])
sage: H.relabel({0:1,1:0})
sage: H.add_edge((0,1,'a'))

sage: H == G
True

sage: G.dig6_string() == H.dig6_string()	# Python 2
True

sage: G.dig6_string() == H.dig6_string()	# Python 3
False
```

This issue has nothing to do with `canonical_label`.



---

archive/issue_comments_386762.json:
```json
{
    "body": "This will do what you ask for. On the way, it fixes the problems with the Petersen family generator (#26800).\n\nI'm wondering if we should add a specific doctest and what to put in. \n\n---\nNew commits:",
    "created_at": "2019-04-21T09:04:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27458",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27458#issuecomment-386762",
    "user": "https://github.com/dcoudert"
}
```

This will do what you ask for. On the way, it fixes the problems with the Petersen family generator (#26800).

I'm wondering if we should add a specific doctest and what to put in. 

---
New commits:



---

archive/issue_comments_386763.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-04-21T09:04:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27458",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27458#issuecomment-386763",
    "user": "https://github.com/dcoudert"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_386764.json:
```json
{
    "body": "The pyflakes error reported by the patchbot is fixed in #27628.",
    "created_at": "2019-04-21T15:49:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27458",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27458#issuecomment-386764",
    "user": "https://github.com/dcoudert"
}
```

The pyflakes error reported by the patchbot is fixed in #27628.



---

archive/issue_comments_386765.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-04-21T19:26:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27458",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27458#issuecomment-386765",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_386766.json:
```json
{
    "body": "Looks good to me. I added a test but it is only meaningful in python 3.\n\n---\nNew commits:",
    "created_at": "2019-04-21T19:27:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27458",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27458#issuecomment-386766",
    "user": "https://github.com/etn40ff"
}
```

Looks good to me. I added a test but it is only meaningful in python 3.

---
New commits:



---

archive/issue_comments_386767.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-04-22T07:01:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27458",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27458#issuecomment-386767",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_386768.json:
```json
{
    "body": "An extra doctest to show that #26800 is also fixed.\nFill free to finalize the review.",
    "created_at": "2019-04-22T07:02:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27458",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27458#issuecomment-386768",
    "user": "https://github.com/dcoudert"
}
```

An extra doctest to show that #26800 is also fixed.
Fill free to finalize the review.



---

archive/issue_comments_386769.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-04-22T16:36:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27458",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27458#issuecomment-386769",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_386770.json:
```json
{
    "body": "It looks to me that the _bit_string in the added test was wrong. I changed it.\nIf you agree on this change the ticket is good for me.",
    "created_at": "2019-04-22T16:38:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27458",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27458#issuecomment-386770",
    "user": "https://github.com/etn40ff"
}
```

It looks to me that the _bit_string in the added test was wrong. I changed it.
If you agree on this change the ticket is good for me.



---

archive/issue_comments_386771.json:
```json
{
    "body": "There is an inconsistency in between the results of the patchbot and my laptop concerning the above-mentioned bit string. I am recompiling sage just to make sure there is no problem on my side.",
    "created_at": "2019-04-22T18:19:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27458",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27458#issuecomment-386771",
    "user": "https://github.com/etn40ff"
}
```

There is an inconsistency in between the results of the patchbot and my laptop concerning the above-mentioned bit string. I am recompiling sage just to make sure there is no problem on my side.



---

archive/issue_comments_386772.json:
```json
{
    "body": "I have the same result than the patchbot (and it was in my commit).\nIf you have something different, we must find the cause.",
    "created_at": "2019-04-22T20:35:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27458",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27458#issuecomment-386772",
    "user": "https://github.com/dcoudert"
}
```

I have the same result than the patchbot (and it was in my commit).
If you have something different, we must find the cause.



---

archive/issue_comments_386773.json:
```json
{
    "body": "I can confirm that something is very wrong here. I compiled a fresh version on a different machine (with a similar undelying linux version for the record) and I get\n\n```\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 SageMath version 8.8.beta3, Release Date: 2019-04-18               \u2502\n\u2502 Using Python 2.7.15. Type \"help()\" for help.                       \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250f\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n\u2503 Warning: this is a prerelease version, and it may be unstable.     \u2503\n\u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251b\nsage: P = graphs.PetersenGraph()\n....: v = P.random_vertex()\n....: P.add_cycle(P.neighbors(v))\n....: P.delete_vertex(v)\n....: P.canonical_label()._bit_vector()\n'001100001111000000011010100110100011'\n```\n\nI am waiting for sage with python3 to compile just to make sure it is the same there as well.",
    "created_at": "2019-04-22T20:39:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27458",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27458#issuecomment-386773",
    "user": "https://github.com/etn40ff"
}
```

I can confirm that something is very wrong here. I compiled a fresh version on a different machine (with a similar undelying linux version for the record) and I get

```
┌────────────────────────────────────────────────────────────────────┐
│ SageMath version 8.8.beta3, Release Date: 2019-04-18               │
│ Using Python 2.7.15. Type "help()" for help.                       │
└────────────────────────────────────────────────────────────────────┘
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Warning: this is a prerelease version, and it may be unstable.     ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
sage: P = graphs.PetersenGraph()
....: v = P.random_vertex()
....: P.add_cycle(P.neighbors(v))
....: P.delete_vertex(v)
....: P.canonical_label()._bit_vector()
'001100001111000000011010100110100011'
```

I am waiting for sage with python3 to compile just to make sure it is the same there as well.



---

archive/issue_comments_386774.json:
```json
{
    "body": "The results are in and indeed I get the same result with python 3:\n\n```\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 SageMath version 8.8.beta3, Release Date: 2019-04-18               \u2502\n\u2502 Using Python 3.7.3. Type \"help()\" for help.                        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250f\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n\u2503 Warning: this is a prerelease version, and it may be unstable.     \u2503\n\u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251b\nsage: P = graphs.PetersenGraph()\n....: v = P.random_vertex()\n....: P.add_cycle(P.neighbors(v))\n....: P.delete_vertex(v)\n....: P.canonical_label()._bit_vector()\n....: \n'001100001111000000011010100110100011'\n```\n\nCould you please check that we get the same output from `canonical_label`? with both versions of Python I have:\n\n```\nsage: P.canonical_label().edges()\n[(0, 3, None),\n (0, 5, None),\n (0, 8, None),\n (1, 2, None),\n (1, 5, None),\n (1, 7, None),\n (2, 4, None),\n (2, 8, None),\n (3, 4, None),\n (3, 7, None),\n (4, 6, None),\n (5, 6, None),\n (6, 7, None),\n (6, 8, None),\n (7, 8, None)]\n```",
    "created_at": "2019-04-22T20:48:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27458",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27458#issuecomment-386774",
    "user": "https://github.com/etn40ff"
}
```

The results are in and indeed I get the same result with python 3:

```
┌────────────────────────────────────────────────────────────────────┐
│ SageMath version 8.8.beta3, Release Date: 2019-04-18               │
│ Using Python 3.7.3. Type "help()" for help.                        │
└────────────────────────────────────────────────────────────────────┘
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Warning: this is a prerelease version, and it may be unstable.     ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
sage: P = graphs.PetersenGraph()
....: v = P.random_vertex()
....: P.add_cycle(P.neighbors(v))
....: P.delete_vertex(v)
....: P.canonical_label()._bit_vector()
....: 
'001100001111000000011010100110100011'
```

Could you please check that we get the same output from `canonical_label`? with both versions of Python I have:

```
sage: P.canonical_label().edges()
[(0, 3, None),
 (0, 5, None),
 (0, 8, None),
 (1, 2, None),
 (1, 5, None),
 (1, 7, None),
 (2, 4, None),
 (2, 8, None),
 (3, 4, None),
 (3, 7, None),
 (4, 6, None),
 (5, 6, None),
 (6, 7, None),
 (6, 8, None),
 (7, 8, None)]
```



---

archive/issue_comments_386775.json:
```json
{
    "body": "Oupsss, I know, I have bliss... and canonical_label uses bliss by default if installed.\n\nI get with Python 2 and 3:\n\n```\nsage: P = graphs.PetersenGraph()\n....: v = P.random_vertex()\n....: P.add_cycle(P.neighbors(v))\n....: P.delete_vertex(v)\n....: P.canonical_label()._bit_vector()\n....: P.canonical_label().edges()\n....: \n'011010100000011100100010010100100111'\n[(0, 2, None),\n (0, 4, None),\n (0, 6, None),\n (1, 2, None),\n (1, 3, None),\n (1, 7, None),\n (2, 8, None),\n (3, 5, None),\n (3, 6, None),\n (4, 5, None),\n (4, 7, None),\n (5, 8, None),\n (6, 7, None),\n (6, 8, None),\n (7, 8, None)]\n....: P.canonical_label(algorithm='sage')._bit_vector()\n....: P.canonical_label(algorithm='sage').edges()\n'001100001111000000011010100110100011'\nsage: P.canonical_label(algorithm='sage').edges()\n[(0, 3, None),\n (0, 5, None),\n (0, 8, None),\n (1, 2, None),\n (1, 5, None),\n (1, 7, None),\n (2, 4, None),\n (2, 8, None),\n (3, 4, None),\n (3, 7, None),\n (4, 6, None),\n (5, 6, None),\n (6, 7, None),\n (6, 8, None),\n (7, 8, None)]\n```\nSo we must add `algorithm='sage'` to the doctest.\n\nNote that there is no error here with the canonical label. It is not unique and depends on the algorithm. It might become more consistent with #27571.",
    "created_at": "2019-04-22T21:00:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27458",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27458#issuecomment-386775",
    "user": "https://github.com/dcoudert"
}
```

Oupsss, I know, I have bliss... and canonical_label uses bliss by default if installed.

I get with Python 2 and 3:

```
sage: P = graphs.PetersenGraph()
....: v = P.random_vertex()
....: P.add_cycle(P.neighbors(v))
....: P.delete_vertex(v)
....: P.canonical_label()._bit_vector()
....: P.canonical_label().edges()
....: 
'011010100000011100100010010100100111'
[(0, 2, None),
 (0, 4, None),
 (0, 6, None),
 (1, 2, None),
 (1, 3, None),
 (1, 7, None),
 (2, 8, None),
 (3, 5, None),
 (3, 6, None),
 (4, 5, None),
 (4, 7, None),
 (5, 8, None),
 (6, 7, None),
 (6, 8, None),
 (7, 8, None)]
....: P.canonical_label(algorithm='sage')._bit_vector()
....: P.canonical_label(algorithm='sage').edges()
'001100001111000000011010100110100011'
sage: P.canonical_label(algorithm='sage').edges()
[(0, 3, None),
 (0, 5, None),
 (0, 8, None),
 (1, 2, None),
 (1, 5, None),
 (1, 7, None),
 (2, 4, None),
 (2, 8, None),
 (3, 4, None),
 (3, 7, None),
 (4, 6, None),
 (5, 6, None),
 (6, 7, None),
 (6, 8, None),
 (7, 8, None)]
```
So we must add `algorithm='sage'` to the doctest.

Note that there is no error here with the canonical label. It is not unique and depends on the algorithm. It might become more consistent with #27571.



---

archive/issue_comments_386776.json:
```json
{
    "body": "For me with Python 2 on OS X:\n\n```\n$ ./sage -c 'set_random_seed(0); P = graphs.PetersenGraph(); v = P.random_vertex(); P.add_cycle(P.neighbors(v)); P.delete_vertex(v); print(P.canonical_label(algorithm=\"sage\")._bit_vector())'\n001100001111000000011010100110100011\n```\nWith Python 3:\n\n```\n$ ./sage -c 'set_random_seed(0); P = graphs.PetersenGraph(); v = P.random_vertex(); P.add_cycle(P.neighbors(v)); P.delete_vertex(v); print(P.canonical_label(algorithm=\"sage\")._bit_vector())'\n101101100011000010010001011000010110\n```\nMaybe `set_random_seed(0)` is not necessary: I seem to get the same answers without it.",
    "created_at": "2019-04-22T21:20:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27458",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27458#issuecomment-386776",
    "user": "https://github.com/jhpalmieri"
}
```

For me with Python 2 on OS X:

```
$ ./sage -c 'set_random_seed(0); P = graphs.PetersenGraph(); v = P.random_vertex(); P.add_cycle(P.neighbors(v)); P.delete_vertex(v); print(P.canonical_label(algorithm="sage")._bit_vector())'
001100001111000000011010100110100011
```
With Python 3:

```
$ ./sage -c 'set_random_seed(0); P = graphs.PetersenGraph(); v = P.random_vertex(); P.add_cycle(P.neighbors(v)); P.delete_vertex(v); print(P.canonical_label(algorithm="sage")._bit_vector())'
101101100011000010010001011000010110
```
Maybe `set_random_seed(0)` is not necessary: I seem to get the same answers without it.



---

archive/issue_comments_386777.json:
```json
{
    "body": "Dumb question: do you have this patch applied in python 3?\n\nReplying to [comment:19 jhpalmieri]:\n> For me with Python 2 on OS X:\n> \n> ```\n> $ ./sage -c 'set_random_seed(0); P = graphs.PetersenGraph(); v = P.random_vertex(); P.add_cycle(P.neighbors(v)); P.delete_vertex(v); print(P.canonical_label(algorithm=\"sage\")._bit_vector())'\n> 001100001111000000011010100110100011\n> ```\n> With Python 3:\n> \n> ```\n> $ ./sage -c 'set_random_seed(0); P = graphs.PetersenGraph(); v = P.random_vertex(); P.add_cycle(P.neighbors(v)); P.delete_vertex(v); print(P.canonical_label(algorithm=\"sage\")._bit_vector())'\n> 101101100011000010010001011000010110\n> ```\n> Maybe `set_random_seed(0)` is not necessary: I seem to get the same answers without it.",
    "created_at": "2019-04-22T21:47:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27458",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27458#issuecomment-386777",
    "user": "https://github.com/etn40ff"
}
```

Dumb question: do you have this patch applied in python 3?

Replying to [comment:19 jhpalmieri]:
> For me with Python 2 on OS X:
> 
> ```
> $ ./sage -c 'set_random_seed(0); P = graphs.PetersenGraph(); v = P.random_vertex(); P.add_cycle(P.neighbors(v)); P.delete_vertex(v); print(P.canonical_label(algorithm="sage")._bit_vector())'
> 001100001111000000011010100110100011
> ```
> With Python 3:
> 
> ```
> $ ./sage -c 'set_random_seed(0); P = graphs.PetersenGraph(); v = P.random_vertex(); P.add_cycle(P.neighbors(v)); P.delete_vertex(v); print(P.canonical_label(algorithm="sage")._bit_vector())'
> 101101100011000010010001011000010110
> ```
> Maybe `set_random_seed(0)` is not necessary: I seem to get the same answers without it.



---

archive/issue_comments_386778.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-04-22T21:49:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27458",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27458#issuecomment-386778",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_386779.json:
```json
{
    "body": "I added the algorithm to use in the doctest. We should now all get the same result.",
    "created_at": "2019-04-22T21:50:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27458",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27458#issuecomment-386779",
    "user": "https://github.com/dcoudert"
}
```

I added the algorithm to use in the doctest. We should now all get the same result.



---

archive/issue_comments_386780.json:
```json
{
    "body": "Not a dumb question, I just lost my mind there for a bit. I'm back now. It looks good to me. (There are doctest failures with Python 3 for `generic_graph.py`, but I get the same ones with or without this branch, so at least this isn't creating more failures in that file. With this branch, doctests improve somewhat for `combinat/cluster_algebra_quiver/`: 10 total failures in 2 files instead of 19 failures in 3 files.)",
    "created_at": "2019-04-22T23:05:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27458",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27458#issuecomment-386780",
    "user": "https://github.com/jhpalmieri"
}
```

Not a dumb question, I just lost my mind there for a bit. I'm back now. It looks good to me. (There are doctest failures with Python 3 for `generic_graph.py`, but I get the same ones with or without this branch, so at least this isn't creating more failures in that file. With this branch, doctests improve somewhat for `combinat/cluster_algebra_quiver/`: 10 total failures in 2 files instead of 19 failures in 3 files.)



---

archive/issue_comments_386781.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-04-23T07:59:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27458",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27458#issuecomment-386781",
    "user": "https://github.com/etn40ff"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_386782.json:
```json
{
    "body": "LGTM\n\n`@`[comment:9 jhpalmieri] Thanks for checking, \"fixing\" cluster_algebra_seed is where this patch came from.",
    "created_at": "2019-04-23T07:59:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27458",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27458#issuecomment-386782",
    "user": "https://github.com/etn40ff"
}
```

LGTM

`@`[comment:9 jhpalmieri] Thanks for checking, "fixing" cluster_algebra_seed is where this patch came from.



---

archive/issue_events_068692.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-04-27T17:43:58Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/27458",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27458#event-68692"
}
```



---

archive/issue_comments_386783.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-04-27T17:43:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27458",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27458#issuecomment-386783",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
