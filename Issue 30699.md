# Issue 30699: Make arb config more flexible and find also flint-arb

archive/issues_030699.json:
```json
{
    "body": "CC:  @mkoeppe\n\nIf one has flint-arb installed but not arb as a system package, then compilation currently fails unless one explicitly sets `ARB_LIBRARY = flint-arb`. In this ticket, we also check for the existence of flint-arb making this manual step obsolete. This is similar in spirit to #30706, which does the same for CBLAS.\n\nThe config file `build/pgks/arb/spkg-configure.m4` does a similar check (I think) and maybe can/needs to be adapted as well. If that's the case I would like to ask if somebody else can implement the necessary changes, as I've no experience with these config files. Thanks!\n\nIssue created by migration from https://trac.sagemath.org/ticket/30936\n\n",
    "created_at": "2020-11-18T10:32:05Z",
    "labels": [
        "component: build"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-wishlist",
    "title": "Make arb config more flexible and find also flint-arb",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30699",
    "user": "https://github.com/tobiasdiez"
}
```
CC:  @mkoeppe

If one has flint-arb installed but not arb as a system package, then compilation currently fails unless one explicitly sets `ARB_LIBRARY = flint-arb`. In this ticket, we also check for the existence of flint-arb making this manual step obsolete. This is similar in spirit to #30706, which does the same for CBLAS.

The config file `build/pgks/arb/spkg-configure.m4` does a similar check (I think) and maybe can/needs to be adapted as well. If that's the case I would like to ask if somebody else can implement the necessary changes, as I've no experience with these config files. Thanks!

Issue created by migration from https://trac.sagemath.org/ticket/30936





---

archive/issue_comments_438388.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-11-18T10:32:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30699#issuecomment-438388",
    "user": "https://github.com/tobiasdiez"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_438389.json:
```json
{
    "body": "Merged the latest develop branch and version of #30901.",
    "created_at": "2020-12-18T22:01:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30699#issuecomment-438389",
    "user": "https://github.com/tobiasdiez"
}
```

Merged the latest develop branch and version of #30901.



---

archive/issue_comments_438390.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-12-18T22:01:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30699#issuecomment-438390",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_438391.json:
```json
{
    "body": "Debian renames `libarb` to `libflint-arb` because there is already a different library taking the name `libarb`.  So code that only checks the presence of `libarb` or `libflint-arb` (in whatever order) cannot be correct.",
    "created_at": "2020-12-21T03:12:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30699#issuecomment-438391",
    "user": "https://github.com/mkoeppe"
}
```

Debian renames `libarb` to `libflint-arb` because there is already a different library taking the name `libarb`.  So code that only checks the presence of `libarb` or `libflint-arb` (in whatever order) cannot be correct.



---

archive/issue_comments_438392.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-12-21T03:12:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30699#issuecomment-438392",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_438393.json:
```json
{
    "body": "The code only provides a reasonable fall-back if `SAGE_ARB_LIBRARY` doesn't exist. Thus users on debian just have to set `SAGE_ARB_LIBRARY = \"flint-arb\"` and everything works as before.  \nDo I miss something?\n\n(The purpose of this ticket was not to reimplement the checks in arb/spkg-configure in the setup.py file.)",
    "created_at": "2020-12-21T08:38:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30699#issuecomment-438393",
    "user": "https://github.com/tobiasdiez"
}
```

The code only provides a reasonable fall-back if `SAGE_ARB_LIBRARY` doesn't exist. Thus users on debian just have to set `SAGE_ARB_LIBRARY = "flint-arb"` and everything works as before.  
Do I miss something?

(The purpose of this ticket was not to reimplement the checks in arb/spkg-configure in the setup.py file.)



---

archive/issue_comments_438394.json:
```json
{
    "body": "The ticket tries to support a use case that is not currently supported (installation of `sagelib` without running `./configure`). Instead of putting more complicated defaults into `env.py`, it would be better to develop a proper solution in `sage.features`.",
    "created_at": "2020-12-21T17:43:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30699#issuecomment-438394",
    "user": "https://github.com/mkoeppe"
}
```

The ticket tries to support a use case that is not currently supported (installation of `sagelib` without running `./configure`). Instead of putting more complicated defaults into `env.py`, it would be better to develop a proper solution in `sage.features`.



---

archive/issue_comments_438395.json:
```json
{
    "body": "Want I want to support is installation of sagelib without the sage_conf package since I don't know how to install the latter with pipenv (I could install it by specifying the relative path in the pipfile, but that really ugly). It would be more practical if sage_conf would be a config file in src instead of a python package, but we discussed this already elsewhere...\n\nSo in this ticket I provided a reasonable fallback, similar to what is done for singular and gap. How would this be implemented with sage.features?",
    "created_at": "2020-12-22T09:00:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30699#issuecomment-438395",
    "user": "https://github.com/tobiasdiez"
}
```

Want I want to support is installation of sagelib without the sage_conf package since I don't know how to install the latter with pipenv (I could install it by specifying the relative path in the pipfile, but that really ugly). It would be more practical if sage_conf would be a config file in src instead of a python package, but we discussed this already elsewhere...

So in this ticket I provided a reasonable fallback, similar to what is done for singular and gap. How would this be implemented with sage.features?



---

archive/issue_comments_438396.json:
```json
{
    "body": "Replying to [comment:7 gh-tobiasdiez]:\n> Want I want to support is installation of sagelib without the sage_conf package since I don't know how to install the latter with pipenv (I could install it by specifying the relative path in the pipfile, but that really ugly).\n\nThe Sage distribution builds a wheel of it, you would just install from there.",
    "created_at": "2020-12-22T14:35:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30699#issuecomment-438396",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:7 gh-tobiasdiez]:
> Want I want to support is installation of sagelib without the sage_conf package since I don't know how to install the latter with pipenv (I could install it by specifying the relative path in the pipfile, but that really ugly).

The Sage distribution builds a wheel of it, you would just install from there.



---

archive/issue_comments_438397.json:
```json
{
    "body": "Replying to [comment:7 gh-tobiasdiez]:\n> How would this be implemented with sage.features?\n\nYou would write a class similar to `CythonFeature` (from `src/sage/features/__init__.py`) with a method revealing the library name.  The class would use the information from `sage.env.ARB_LIBRARY` (get rid of the default); but if unset, it would try to link a test program using `acb_mat_eig_simple` against the library. In fact, using `CythonFeature` for doing this test could pretty much work -- except that I'm not sure if `sage.misc.cython` perhaps pulls in too many modules at the moment.",
    "created_at": "2020-12-22T15:20:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30699#issuecomment-438397",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:7 gh-tobiasdiez]:
> How would this be implemented with sage.features?

You would write a class similar to `CythonFeature` (from `src/sage/features/__init__.py`) with a method revealing the library name.  The class would use the information from `sage.env.ARB_LIBRARY` (get rid of the default); but if unset, it would try to link a test program using `acb_mat_eig_simple` against the library. In fact, using `CythonFeature` for doing this test could pretty much work -- except that I'm not sure if `sage.misc.cython` perhaps pulls in too many modules at the moment.



---

archive/issue_comments_438398.json:
```json
{
    "body": "That sounds reasonable. But it's also more work than I planned to invest into this, so I'll leave this to somebody else to implement.",
    "created_at": "2020-12-23T13:07:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30699#issuecomment-438398",
    "user": "https://github.com/tobiasdiez"
}
```

That sounds reasonable. But it's also more work than I planned to invest into this, so I'll leave this to somebody else to implement.
