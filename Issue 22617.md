# Issue 22617: Generalize bruhat graphs

Issue created by migration from Trac.

Original creator: aram.dermenjian

Original creation time: 2017-04-21 18:32:13

CC:  nthiery tscrim chapoton

Move bruhat_graph from WeylGroups? to the CoxeterGroups? category and if the group is finite, allow bruhat_graph() to return the entire graph.


---

Comment by aram.dermenjian created at 2017-04-21 18:51:13

Changing keywords from "" to "sagedays86".


---

Comment by aram.dermenjian created at 2017-04-21 18:58:19

This should be ready for review.
----
New commits:


---

Comment by aram.dermenjian created at 2017-04-21 18:58:19

Changing status from new to needs_review.


---

Comment by tscrim created at 2017-04-22 02:24:50

Some comments:

-I think the extra doctests should not be in the block below saying `:trac:`17744``, but above it.
- Instead of this complicated check for the long element and you already test `self.is_finite()`, so just do the default being the long element there. This is better locality of code.
- A better error message would be `infinite groups must specify a maximal element`.
- `reflection_length` needs a doctest.
- Even though it is slight code duplication, it would be faster (and probably cleaner) to use code similar to `bruhat_interval`. While this could be done on a separate ticket, I think it would be better to do this here and now.


---

Comment by git created at 2017-04-22 13:06:13

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-04-22 13:07:38

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by aram.dermenjian created at 2017-04-22 13:09:35

So all the above corrections have been made.

I didn't understand what you meant by replicating bruhat_interval in your last comment. Do you mean using a similar while loop in bruhat_group to find all potential additional chains? The issue here is that if the group is infinite we can't go through "all" the reflections to test things out. Hence why this method was used (and I kept it over from the current version). Unless you mean something different?
----
New commits:


---

Comment by tscrim created at 2017-04-22 14:04:38

Actually, looking into this a bit more, I think we should have `bruhat_graph` be constructed from the transitive closure of the digraph of the Bruhat cover relations. This way we would not have to look at what is a reflection and what is not.

So what I would do is start with a hidden method `_bruhat_covers_digraph`, which builds the digraph of cover relations by using code from `bruhat_interval`. Then `bruhat_graph` would return `self._bruhat_covers_digraph(x,y).transitive_closure()`. Furthermore, `bruhat_poset` could be lifted and generalized to return `Poset(self._bruhat_covers_digraph(x,y), cover_relations=True, facade=facade)`.

I can do this is if you want me to.


---

Comment by git created at 2017-05-10 20:55:08

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by aram.dermenjian created at 2017-05-10 20:59:18

So one reason transitive closure isn't a good idea is because I'd like to keep track of the reflection used to make that transition (as added in my latest commit). Also, I'm not exactly sure how the transitive closure would work in this case. Do you want to do a run with the poset and if it works as expected I can merge the two with Bruhat graph? (Or you can add it into Bruhat graph directly if you'd prefer)


---

Comment by tscrim created at 2017-05-17 23:03:58

Actually, the transitive closure is too permissive as you can get differences that are products of reflections, which of course, are not always reflections. However, I was able to get a massive speed boost by sorting the `bruhat_interval` by length so we only have to do approx `n^2 / 2` checks and not have to do the length checks each time.

I also added a `bruhat_interval_poset`, which goes slightly beyond the scope of the ticket but is in the spirit of it, instead of lifting up `bruhat_poset` to keep that reserved for the entire Bruhat order poset.
----
New commits:


---

Comment by tscrim created at 2017-05-29 21:05:27

ping - Patchbot is (essentially) green.


---

Comment by chapoton created at 2017-05-30 07:37:20

ok, let it be (though I do not like that "reflection length" is not just an alias).


---

Comment by chapoton created at 2017-05-30 07:37:20

Changing status from needs_review to positive_review.


---

Comment by aram.dermenjian created at 2017-05-30 11:21:04

Looks good on my end too. I can always quickly alter reflection length to be an alias instead of a direct call if you'd prefer Chapoton. (I hadn't realised aliasing was possible) Just let me know and I'll quickly do it tonight.


---

Comment by chapoton created at 2017-05-30 11:35:22

No, let us keep things as they are, no need to re-open the ticket for that.


---

Comment by vbraun created at 2017-05-31 22:25:39

Resolution: fixed
