# Issue 27010: modular_decomposition should be able to return a tree

Issue created by migration from https://trac.sagemath.org/ticket/27247

Original creator: mantepse

Original creation time: 2019-02-09 19:17:41

CC:  dcoudert




---

Comment by deinst created at 2019-02-09 19:41:32

Changing type from PLEASE CHANGE to enhancement.


---

Comment by deinst created at 2019-02-09 19:41:32

Set assignee to deinst.


---

Comment by deinst created at 2019-02-09 19:41:32

Changing component from PLEASE CHANGE to graph theory.


---

Comment by mantepse created at 2019-02-09 20:59:32

Last 10 new commits:


---

Comment by mantepse created at 2019-02-09 20:59:32

Changing status from new to needs_review.


---

Comment by dcoudert created at 2019-02-10 18:56:51

I'm a bit lost here. What's the part you added ?

At least, the ascii_art tree is really nice ;)


---

Comment by mantepse created at 2019-02-10 19:02:53

I added [9e82fd6](https://git.sagemath.org/sage.git/commit?id=9e82fd6101e8f3d59cbd76725e756d63377512ab), all the rest is the dependency on #26496.


---

Comment by mantepse created at 2019-02-10 19:20:52

Thanks for the compliment!  The `style='tree'` is also useful, because you can, for example, easily collect graphs by equivalent modular decomposition:


```
def doit(n):
    from collections import defaultdict
    d = defaultdict(list)
    for g in graphs(n):
        m = g.modular_decomposition(algorithm='habib', style='tree')
        m = m.map_labels(lambda x: None if x in ZZ else x)
        d[m].append(g.canonical_label())
    return dict(d)
```

and then

```
sage: view(doit(5).items())
```



---

Comment by dcoudert created at 2019-02-11 07:41:21

Replying to [comment:6 mantepse]:
> I added [9e82fd6](https://git.sagemath.org/sage.git/commit?id=9e82fd6101e8f3d59cbd76725e756d63377512ab), all the rest is the dependency on #26496.

My concern is that I don't see the last commits of #26496 like [c0ca87b](https://git.sagemath.org/sage.git/commit/?id=c0ca87ba7d176d6ba3ba44de007395af03b9946c).


---

Comment by mantepse created at 2019-02-11 08:01:58

Replying to [comment:8 dcoudert]:
> Replying to [comment:6 mantepse]:
> > I added [9e82fd6](https://git.sagemath.org/sage.git/commit?id=9e82fd6101e8f3d59cbd76725e756d63377512ab), all the rest is the dependency on #26496.
> 
> My concern is that I don't see the last commits of #26496 like [c0ca87b](https://git.sagemath.org/sage.git/commit/?id=c0ca87ba7d176d6ba3ba44de007395af03b9946c).

Yes, as far as I know, trac doesn't do this for us.  In other words: first finish #26496, and wait until it is in the `develop`-branch.


---

Comment by embray created at 2019-03-25 10:56:15

Ticket retargeted after milestone closed (if you don't believe this ticket is appropriate for the Sage 8.8 release please retarget manually)


---

Comment by embray created at 2019-07-03 11:37:56

Moving tickets from the Sage 8.8 milestone that have been actively worked on in the last six months to the next release milestone (optimistically).


---

Comment by dcoudert created at 2019-10-07 10:10:01

Changing status from needs_review to needs_work.


---

Comment by dcoudert created at 2019-10-07 10:10:01

Now that #26496 is merge, we can restart working on this ticket


---

Comment by @vipul79321 created at 2020-03-22 09:00:21

Replying to [comment:12 dcoudert]:
> Now that #26496 is merge, we can restart working on this ticket
We can proceed by adding below code-block in `graph.py` as introduced in commit [9e82fd6](https://git.sagemath.org/sage.git/commit?id=9e82fd6101e8f3d59cbd76725e756d63377512ab) and modify documentation and doc-test accordingly.  

```
self._scream_if_not_simple()
 
if not self.order():
    D = None
elif self.order() == 1:
    D = create_prime_node()
    D.children.append(create_normal_node(self.vertices()[0]))
else:
    if algorithm == 'habib':
        D = habib_maurer_algorithm(self)
    elif algorithm == 'tedder':
        D = modular_decomposition(self)
    else:
        raise ValueError("unknown algorithm: %s" % algorithm)
if style == 'tuple':
    if D is None:
        return tuple()
    relabel = lambda x: ((x.node_type, map(relabel, x.children))
                         if x.node_type != NodeType.NORMAL
                         else x.children[0])
    return relabel(D)
elif style == 'tree':
    from sage.combinat.rooted_tree import LabelledRootedTree
    if D is None:
        return LabelledRootedTree([])
    to_tree = lambda x: (LabelledRootedTree(map(to_tree, x.children),
                                                    label=x.node_type)
                         if x.node_type != NodeType.NORMAL
                         else LabelledRootedTree([], label=x.children[0]))+            
    return to_tree(D)
else:
    raise ValueError("unknown style: %s" % style)
```


If Nobody is working on it currently, Can I proceed to implement proposed changes?


---

Comment by @vipul79321 created at 2020-03-22 11:56:48

Changing status from needs_work to needs_info.


---

Comment by dcoudert created at 2020-03-22 12:23:18

I don't know if the original author is willing to finalize this ticket or not. Let him some time to answer.


---

Comment by mantepse created at 2020-03-22 16:49:58

Please go ahead!  I have currently no time to work on this.


---

Comment by @vipul79321 created at 2020-03-23 08:04:53

New commits:


---

Comment by @vipul79321 created at 2020-03-23 08:13:09

Changing status from needs_info to needs_review.


---

Comment by dcoudert created at 2020-03-23 08:30:25

- I think format is more appropriate than form

```diff
-        - ``style`` -- string (default: ``'tuple'``); specifies the output form:
+        - ``style`` -- string (default: ``'tuple'``); specifies the output format:
```


- a minor correction

```diff
+          - ``'tree'`` -- as `LabelledRootedTree`.
+          - ``'tree'`` -- as :class:`<sage.combinat.rooted_tree.LabelledRootedTree>`.
```



---

Comment by git created at 2020-03-23 09:35:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @vipul79321 created at 2020-03-23 09:39:23

Replying to [comment:21 dcoudert]:
> 
> - I think format is more appropriate than form
> {{{#!diff
> -        - ``style`` -- string (default: ``'tuple'``); specifies the output form:
> +        - ``style`` -- string (default: ``'tuple'``); specifies the output format:
> }}}
> 
Ok.
> - a minor correction
> {{{#!diff
> +          - ``'tree'`` -- as `LabelledRootedTree`.
> +          - ``'tree'`` -- as :class:`<sage.combinat.rooted_tree.LabelledRootedTree>`.
> }}}
Instead of this, I think this would be better

```diff
-          - ``'tree'`` -- as `LabelledRootedTree`.
+          - ``'tree'`` -- as :class:`~sage.combinat.rooted_tree.LabelledRootedTree`.
```



---

Comment by @vipul79321 created at 2020-03-23 09:40:05

Replying to [comment:22 git]:
> Branch pushed to git repo; I updated commit sha1. New commits:
> ||[428c0bf](https://git.sagemath.org/sage.git/commit/?id=428c0bf3e684d7fa332a49ca6d05741d114fb382)||`documentation fixed`||
Updated according to `comment 23`


---

Comment by dcoudert created at 2020-03-23 09:58:35

Right, but you should change accordingly the part

```
+        We can choose output to be a
+        :class:`<sage.combinat.rooted_tree.LabelledRootedTree>`::
```



---

Comment by git created at 2020-03-23 12:28:57

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @vipul79321 created at 2020-03-23 12:30:52

Replying to [comment:25 dcoudert]:
> Right, but you should change accordingly the part
> {{{
> +        We can choose output to be a
> +        :class:`<sage.combinat.rooted_tree.LabelledRootedTree>`::
> }}}
sorry, my bad. How could I have missed it :(\\

I have updated it now


---

Comment by dcoudert created at 2020-03-23 18:05:16

Sorry I forgot this one: add an empty line after `Singleton Vertex::`.

And this could be nicer (to avoid \ )

```diff
-        from sage.graphs.graph_decompositions.modular_decomposition import modular_decomposition,\
-            NodeType, habib_maurer_algorithm, create_prime_node, create_normal_node
+        from sage.graphs.graph_decompositions.modular_decomposition import (modular_decomposition,
+                                                                            NodeType,
+                                                                            habib_maurer_algorithm,
+                                                                            create_prime_node,
+                                                                            create_normal_node)
```


Also, the patchbot reports an issue, but I'm not sure what it is. Can you investigate?


---

Comment by git created at 2020-03-24 13:27:34

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2020-03-24 13:34:30

LGTM. Please add your name in authors field (in addition to the name of Martin).


---

Comment by @vipul79321 created at 2020-03-24 15:20:23

I have one more doubt, how do we decide our branch passes patchbot tests, like on some systems it shows `all tests passes` but on some system `build failed`(current scenario).


---

Comment by dcoudert created at 2020-03-25 08:08:25

Replying to [comment:31 gh-vipul79321]:
> I have one more doubt, how do we decide our branch passes patchbot tests, like on some systems it shows `all tests passes` but on some system `build failed`(current scenario).
Check on the logs if a failure is related to the ticket.Here it is clearly not the case.


---

Comment by dcoudert created at 2020-03-25 08:08:41

Changing status from needs_review to positive_review.


---

Comment by dcoudert created at 2020-03-25 08:08:41

LGTM.


---

Comment by vbraun created at 2020-03-29 00:24:18

Resolution: fixed
