# Issue 12100: More # long time additions

Issue created by migration from https://trac.sagemath.org/ticket/12272

Original creator: jdemeyer

Original creation time: 2012-01-06 14:45:27

Assignee: mvngu




---

Comment by jdemeyer created at 2012-04-17 15:51:30

Changing priority from major to blocker.


---

Comment by hivert created at 2012-04-26 08:37:05

Should this one be reviewed ?

Florent


---

Comment by jdemeyer created at 2012-04-26 08:42:35

I'd like to wait until sage-5.0.beta14 is released.  But I think it's clear that this ticket should be totally trivial to review.


---

Comment by jdemeyer created at 2012-04-28 14:19:01

Ready for review.


---

Comment by jdemeyer created at 2012-04-28 14:19:01

Changing status from new to needs_review.


---

Comment by ppurka created at 2012-04-29 17:11:16

Looks mostly good to me. I have just two comments:
1. In `sage/modular/local_comp/type_space.py` line 42 do you want to add `# long time` in addition to the statement you wrote?
2. I am not sure what configuration the server sage.math has, and that configuration might change over time. I think it will be better if the processor is mentioned instead of the server name; like `on Intel corei7 (8 cores)`. Then you wouldn't need to mention the year also. What is your opinion on this?


---

Comment by mjo created at 2012-04-29 17:22:27

Some of these are behaving suspiciously. For example, this one obviously works:


```
gantu sage-main $ sage -t sage/combinat/root_system/root_system.py
sage -t  "devel/sage-main/sage/combinat/root_system/root_system.py"
	 [12.7 s]
 
----------------------------------------------------------------------
All tests passed!
Total time for all tests: 12.7 seconds

gantu sage-main $ sage -hg qpush
applying 12272_long_time.patch
now at: 12272_long_time.patch

gantu sage-main $ sage -t sage/combinat/root_system/root_system.py
sage -t  "devel/sage-main/sage/combinat/root_system/root_system.py"
	 [2.0 s]
 
----------------------------------------------------------------------
All tests passed!
Total time for all tests: 2.0 seconds
```


Down by around ten seconds. But this one?


```
gantu sage-main $ sage -t sage/categories/pushout.py 
sage -t  "devel/sage-main/sage/categories/pushout.py"       
	 [4.3 s]
 
----------------------------------------------------------------------
All tests passed!
Total time for all tests: 4.3 seconds

gantu sage-main $ sage -hg qpush
applying 12272_long_time.patch
now at: 12272_long_time.patch

gantu sage-main $ sage -t sage/categories/pushout.py 
sage -t  "devel/sage-main/sage/categories/pushout.py"       
	 [4.3 s]
 
----------------------------------------------------------------------
All tests passed!
Total time for all tests: 4.3 seconds
```



And what are these?


```
# sometimes very slow (up to 60s on sage.math, 2012)
```



```
# takes a while but caches stuff (21s on sage.math, 2012) 
```



---

Comment by benjaminfjones created at 2012-04-29 17:24:11

Since you updated the timing on the affected test in `sage/groups/matrix_gps/matrix_group.py` I guess that date should be updated to 2012 as well.


---

Comment by jdemeyer created at 2012-04-29 20:33:21

Replying to [comment:5 ppurka]:
> 2. I am not sure what configuration the server sage.math has, and that configuration might change over time. I think it will be better if the processor is mentioned instead of the server name; like `on Intel corei7 (8 cores)`.
"`sage.math, 2012` is pretty well-defined.  Agreed that it doesn't mean anything to the casual Sage user, but developers can get an account on sage.math so they can check timings.  And "Intel corei7" is way too little information.  You would need information on the precise processor type, the operation system version, maybe versions of glibc/gcc,...


---

Comment by jdemeyer created at 2012-04-29 20:53:35

Replying to [comment:6 mjo]:
> sage -t  "devel/sage-main/sage/categories/pushout.py"       
Agreed.  Probably it look a long time in some earlier Sage version.  I removed `# long time`.

> {{{
> # sometimes very slow (up to 60s on sage.math, 2012)
> }}}
> 
> {{{
> # takes a while but caches stuff (21s on sage.math, 2012) 
> }}}
I clarified these a bit with comments.  It is clear now?


---

Comment by jdemeyer created at 2012-04-29 20:57:36

Updated patch, needs review again.


---

Comment by mjo created at 2012-04-29 22:41:10

Here are the before (left) and after (right) timings on my desktop. There's obviously some deviation, but it looks like we can skip marking a few as `long time`.

I'll leave it up to your discretion. It's fine now, or if you want to remove any, I'll look it over again and give it a +review.

* sage/combinat/root_system/pieri_factors.py
* sage/crypto/mq/sr.py
* sage/geometry/triangulation/point_configuration.py
* sage/groups/matrix_gps/matrix_group.py
* sage/rings/function_field/function_field.py
* sage/schemes/elliptic_curves/gal_reps.py


```
sage/combinat/root_system/pieri_factors.py
	 [15.5 s]	 [16.4 s]
sage/combinat/root_system/root_system.py
	 [13.7 s]	 [2.0 s]
sage/crypto/mq/sr.py             
	 [7.2 s]	 [6.5 s]
sage/geometry/triangulation/point_configuration.py
	 [6.6 s]	 [5.6 s]
sage/graphs/generic_graph.py     
	 [37.6 s]	 [31.9 s]
sage/graphs/graph.py             
	 [20.3 s]	 [14.8 s]
sage/graphs/graph_generators.py  
	 [20.6 s]	 [16.1 s]
sage/groups/matrix_gps/matrix_group.py
	 [10.5 s]	 [10.2 s]
sage/interfaces/expect.py        
	 [68.3 s]	 [66.8 s]
sage/matrix/benchmark.py         
	 [29.0 s]	 [17.8 s]
sage/matrix/matrix_sparse.pyx    
	 [7.5 s]	 [2.7 s]
sage/misc/cython.py              
	 [9.6 s]	 [3.1 s]
sage/misc/sage_timeit_class.pyx  
	 [6.5 s]	 [1.9 s]
sage/misc/sagedoc.py             
	 [32.8 s]	 [21.4 s]
sage/modular/local_comp/local_comp.py
	 [31.8 s]	 [20.5 s]
sage/modular/local_comp/type_space.py
	 [53.2 s]	 [30.5 s]
sage/numerical/test.py           
	 [5.6 s]	 [1.4 s]
sage/rings/function_field/function_field.py
	 [2.7 s]	 [3.1 s]
sage/rings/polynomial/polynomial_rational_flint.pyx
	 [7.7 s]	 [5.0 s]
sage/schemes/elliptic_curves/gal_reps.py
	 [21.5 s]	 [21.0 s]
sage/schemes/elliptic_curves/heegner.py
	 [57.1 s]	 [53.1 s]
sage/symbolic/expression.pyx
	 [31.6 s]	 [23.0 s]
 

Before total: 497.1 seconds
After total: 375.2 seconds
```



---

Comment by cremona created at 2012-04-30 02:14:32

I got here too late to help, it seems.  I think we might want a discussion on sage-devel about the role of long tests.  Whenever I test a beta build I run all the long tests anyway (what's the point otherwise?), and casual users will not run any tests.


---

Comment by jdemeyer created at 2012-04-30 08:11:06

Replying to [comment:12 cremona]:
> I got here too late to help, it seems.  I think we might want a discussion on sage-devel about the role of long tests.  Whenever I test a beta build I run all the long tests anyway (what's the point otherwise?), and casual users will not run any tests.

`# long time` serves purposes beyond that:
 1. non-long tests are actually used, for example the patchbot does non-long tests only.
 2. "long time" serves as documentation to the user that some command is supposed to take a long time.
 3. keeping track of the runtime of these tests makes it possible to detect regressions.  For example, for the `integral_points()` tests, it was marked as taking 35s but I found it actually took 50s.  I agree "long time" isn't the best solution for this, but it's the best we currently have.


---

Comment by jdemeyer created at 2012-04-30 08:16:12

Replying to [comment:11 mjo]:
> Here are the before (left) and after (right) timings on my desktop. There's obviously some deviation, but it looks like we can skip marking a few as `long time`.
Thanks for checking.

> * sage/combinat/root_system/pieri_factors.py
Removed `# long time` here.

> * sage/crypto/mq/sr.py
> * sage/geometry/triangulation/point_configuration.py
> * sage/groups/matrix_gps/matrix_group.py
> * sage/rings/function_field/function_field.py
> * sage/schemes/elliptic_curves/gal_reps.py
These already had `# long time`, I just changed or added the time.  So the "before" and "after" are meaningless because they are both not running the changed tests.

Anybody feels like giving this a final review?


---

Attachment

I also removed one extra `# long time` from `sage/graphs/generic_graph.py` as #12888 considerably speeds it up.


---

Comment by GeorgSWeber created at 2012-04-30 08:55:28

Changing status from needs_review to positive_review.


---

Comment by GeorgSWeber created at 2012-04-30 08:55:28

Looks good to me.


---

Comment by cremona created at 2012-04-30 12:40:06

Replying to [comment:13 jdemeyer]:

> Replying to [comment:12 cremona]:
> > I got here too late to help, it seems.  I think we might want a discussion on sage-devel about the role of long tests.  Whenever I test a beta build I run all the long tests anyway (what's the point otherwise?), and casual users will not run any tests.
> `# long time` serves purposes beyond that: 1. non-long tests are actually used, for example the patchbot does non-long tests only. 2. "long time" serves as documentation to the user that some command is supposed to take a long time. 3. keeping track of the runtime of these tests makes it possible to detect regressions.  For example, for the `integral_points()` tests, it was marked as taking 35s but I found it actually took 50s.  I agree "long time" isn't the best solution for this, but it's the best we currently have.

Thanks -- all good reasons.


---

Comment by jdemeyer created at 2012-05-01 05:08:01

Resolution: fixed
