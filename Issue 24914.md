# Issue 24914: Implement Q-basis of WQSym

Issue created by migration from https://trac.sagemath.org/ticket/25151

Original creator: amypang

Original creation time: 2018-04-12 13:10:34

CC:  darij tscrim zabrocki saliola alauve

Keywords: IMA coding sprint, CHAs

Please implement the Q basis of WQSym, as in Bergeron-Zabrocki (â€‹https://arxiv.org/abs/math/0509265 start of section 6)


---

Comment by amypang created at 2018-04-12 13:50:27

I'll keep trying to code something but I think realistically this is beyond me.


---

Comment by @darijgr created at 2018-04-12 16:18:44

Last 10 new commits:


---

Comment by git created at 2018-04-12 20:25:37

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-04-12 20:57:50

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-04-12 21:44:42

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-04-12 21:55:49

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by @darijgr created at 2018-04-12 21:57:10

Done: both bases implemented, and product on Q-basis overloaded.

Worth doing: overload product and coproduct on Phi-basis (Novelli and Thibon give formulas for them, but they take some time to unravel), and search for a coproduct formula on Q-basis.


---

Comment by git created at 2018-04-12 22:01:26

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-04-12 22:29:20

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by amypang created at 2018-04-13 01:43:29

Ok, shall I try to understand the product and coproduct of Phi, and give that to you mathematically / pseudocode-ly?


---

Comment by @darijgr created at 2018-04-13 01:46:33

That would be great!


---

Comment by amypang created at 2018-04-13 03:26:23

Actually the product and coproduct on the Phi basis are quite easy to understand. But they are in terms of segmented permutations - i.e. think of the ordered set partition as a word/permutation with some bars. Because we need ideas like shuffle and deconcatenate.

* Product = sum of shifted shuffles - i.e. compute the shifted shuffle as words, then there is a bar between letters a and b if either a,b came from the same word and there was a bar in between, or if b comes from the first word and a from the second.
* Coproduct = deconcatenate and standardise. The deconcatenation can be within a block or between blocks.

My best idea for how to do this:

* we already have ordered-set-partition -> composition.
* make a function: ordered-set-partition -> permutation, that writes each block in increasing order and concatenates the blocks in the original order.
* make an "inverse" for these combined: i.e. given a permutation and a composition, make an ordered-set-partition whose blocks have sizes given by the composition, and the first block is the first few letters of the permutation, the second block is the next few letters, and so on.

Then we can compute shuffle and deconcatenation in the permutation/composition format.

If you think it is useful, I can try to code the functions osp->permutation and (permutation,composition)->osp . But it will be of the level at #25152. Not sure if that's too rudimentary to be useful.

Sorry not to be of much help. Thanks Darij for all the coding so far.


---

Comment by @darijgr created at 2018-04-13 03:30:27

Thank you! The coproduct (which I didn't understand due to the notation \cdot which N&T seem to have left undefined) looks easy enough to implement. The question is whether I can get the bars to work without talking about barred permutations.


---

Comment by amypang created at 2018-04-13 03:49:29

Replying to [comment:16 gh-darijgr]:
> Thank you! The coproduct (which I didn't understand due to the notation \cdot which N&T seem to have left undefined) looks easy enough to implement. 
I think \cdot means concatenation. At least it agrees with the example on line 61.

> The question is whether I can get the bars to work without talking about barred permutations.
Yeah, it might be neater/easier to make a new type of object called barred permutations (or segmented permutations, I think that's the technical term). And then for their deconcatenation, I'd imagine you would deconcatenate the permutations ignoring the bars first, and then "put the bars where they used to be" as it were. So if you think of segmented permutations as pairs (permtuation, composition), then you're deconcatenating them separately.

I don't know how to make a new type of combinatorial object like segmented permutations. Let me know if I can do anything useful.


---

Comment by @darijgr created at 2018-04-13 03:51:33

On a second thought, the product is doable without any new objects. I'll make a helper function that turns an ordered set partition into a list by reading its blocks in increasing order, but every entry `e` appearing in some block will be written as `(e, 1)` if it was the last entry of its block and as `(e, 0)` otherwise. Thus, the shuffle will "remember" the bars.

HOWEVER, I am still not 100% precise on the definition. If I shuffle 24|13|5 with 79|8|6 (already shifted) and get 247913856, then should there be a bar after the "4" or not?


---

Comment by amypang created at 2018-04-13 04:40:22

Replying to [comment:18 gh-darijgr]:
> On a second thought, the product is doable without any new objects. I'll make a helper function that turns an ordered set partition into a list by reading its blocks in increasing order, but every entry `e` appearing in some block will be written as `(e, 1)` if it was the last entry of its block and as `(e, 0)` otherwise. Thus, the shuffle will "remember" the bars.
This is clever. And it will do the coproduct too.

> 
> HOWEVER, I am still not 100% precise on the definition. If I shuffle 24|13|5 with 79|8|6 (already shifted) and get 247913856, then should there be a bar after the "4" or not?
I would say no bar after 4. I would say 2479|138|56. In the first term on the right hand side of line 60, there is no bar after 1.

Can we not ask Sage to check, at least in smaller examples? It can already compute products in Phi using the basis change to M's, no?


---

Comment by git created at 2018-04-13 15:48:32

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @darijgr created at 2018-04-13 15:49:03

Changing status from new to needs_review.


---

Comment by git created at 2018-04-13 15:51:16

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-04-16 01:44:53

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by darij created at 2018-04-16 01:55:10

Nothing wrong about that commit, but what's the purpose of the space in "W QSym"? It's not like LaTeX cares much.


---

Comment by zabrocki created at 2018-04-16 01:56:30

I'm happy to take it out, but try removing it... `W QSym` latex's fine, `WQSym` doesn't.

I added FQSym and WQSym to the list of combinatorial Hopf algebras.

Aaron and I were discussing about naming conventions on the way to the airport and I don't entirely remember if we came to the right conclusion: `WordQuasiSymmetricFunctions`/`WQSym` is somewhat artificial and arbitrary as a name, `HopfAlgebraOfPackedWords`, `HopfAlgebraOfOrderedSetPartitions` is not consistent.  I still prefer `NCQSym` because the Hopf algebra is realized as the subspace of words which are invariants under shifts of the indices of the variables.  We can make several entry points through a single `CombinatorialHopfAlgebras` entry in the global name space, but then we should add the full list.


---

Comment by darij created at 2018-04-16 02:04:59

I'm fine with NCQSym (I've also taken to calling its dual QCNSym), but I don't think WQSym is wrong either. Can we really rename everything without deprecation by now? We've got several tickets depending upon one another!


---

Comment by tscrim created at 2018-04-16 02:12:26

IMO, we don't have to deprecate if it is within release cycles. However, for something like this, if we are going to change the names, we should do so in the ticket that introduces it and percolate it up because of how fundamental it is. If it is just going to be an alias, then we can do that at anytime.


---

Comment by zabrocki created at 2018-04-16 02:12:57

I'm not suggesting that we change it here and now.  I am only making a note on this ticket that it was discussed


---

Comment by zabrocki created at 2018-04-17 11:53:16

I think that this looks really good.  Nice work.

Note: related tickets on WQSym that may have minor conflicts when merged together

#25152 - implement multiplicative bases

#25155 - Implement global options for WQSym

#25141 - Homomorphisms around FQSym, WQSym


---

Comment by zabrocki created at 2018-04-17 11:53:16

Changing status from needs_review to positive_review.


---

Comment by git created at 2018-05-06 23:20:02

Changing status from positive_review to needs_review.


---

Comment by git created at 2018-05-06 23:20:02

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. Last 10 new commits:


---

Comment by tscrim created at 2018-05-06 23:20:25

Essentially a trivial rebase over #25141.


---

Comment by tscrim created at 2018-05-06 23:20:35

Changing status from needs_review to positive_review.


---

Comment by git created at 2018-05-17 11:59:14

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:


---

Comment by git created at 2018-05-17 11:59:14

Changing status from positive_review to needs_review.


---

Comment by @darijgr created at 2018-05-17 12:00:35

Changing status from needs_review to positive_review.


---

Comment by @darijgr created at 2018-05-17 12:00:35

There was a conflict in reference/references/index.rst. Also I pulled in the most recent versions of the dependencies.


---

Comment by fbissey created at 2018-05-21 00:42:11

Changing status from positive_review to needs_work.


---

Comment by fbissey created at 2018-05-21 00:42:11

Documentation is not building with this branch. You introduced a duplicate of the `ber1991` reference in `doc/en/reference/references/index.rst`.


---

Comment by git created at 2018-05-21 04:35:56

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2018-05-21 04:36:27

Likely the result of a bad merge. Fixed (including verified the doc builds).


---

Comment by tscrim created at 2018-05-21 04:36:27

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2018-05-24 07:10:43

Resolution: fixed
