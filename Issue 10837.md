# Issue 10837: Avoid nfinit while factoring polynomials

Issue created by migration from https://trac.sagemath.org/ticket/10910

Original creator: lftabera

Original creation time: 2011-03-10 17:28:27

Assignee: tbd

Keywords: factorization, pari, nfinit, number field

In previous versions of pari the options to factor a univariate polynomial over a number field where Trager's or Van Hoeij modular algorithm. The second method is the preferred one, but it used to need a nf structure.

Hence Sage computed nfinit on the number field before factoring the polynomial via Pari.

With current pari version the whole nf structure is not needed. So, the factor routines should not call nfinit that can be a very expensive operation for large fields.

The patch modifies the factor method. If the nf structure is already computed we use it, as it will be faster. If the nf structure is not already computed then do not compute it to factor the polynomial.


---

Comment by lftabera created at 2011-03-10 23:37:41

Changing status from new to needs_review.


---

Comment by lftabera created at 2011-03-11 08:33:25

The doctest failure is known bug that is corrected in #2329.

Depends: #2329


---

Comment by mariah created at 2011-05-17 14:40:24

Minor edit of grammer.


---

Comment by mariah created at 2011-05-18 14:35:01

Changing status from needs_review to needs_work.


---

Comment by mariah created at 2011-05-18 14:35:01

The patch applied to sage-4.7.rc2 causes the following test to fail:


```
% ./sage -t  -long -force_lib "devel/sage/sage/rings/polynomial/polynomial_element.pyx"
sage -t -long -force_lib "devel/sage/sage/rings/polynomial/polynomial_element.pyx"
**********************************************************************
File "/home/mariah/sage/sage-4.7.rc2-x86_64-Linux-nehalem-fc-review-10910/devel/sage/sage/rings/polynomial/polynomial_element.pyx", line 2704:
    sage: hasattr(N, '_NumberField_generic__pari_nf')
Expected:
    False
Got:
    True
**********************************************************************
1 items had failures:
   1 of 143 in __main__.example_51
***Test Failed*** 1 failures.
For whitespace errors, see the file /home/mariah/.sage//tmp/.doctest_polynomial_element.py
         [23.1 s]
 
----------------------------------------------------------------------
The following tests failed:


        sage -t -long -force_lib "devel/sage/sage/rings/polynomial/polynomial_element.pyx"
Total time for all tests: 23.1 seconds
```



---

Comment by lftabera created at 2011-06-07 08:41:19

Just for the record, my patch introduces the following problem, so I need to add a doctest to it since it is an unapparent side effect.


```
sage: N = NumberField(x^3-2*x+3,'a')
sage: f = N[x](x^2-41943301)
sage: M = N.extension(f,'b')
sage: M.hom([M.gen()])
...
ValueError: no way to map base field to codomain.
```



---

Comment by lftabera created at 2011-06-09 14:32:27

I have tracked the latest problem and it is in fact a bug in pari. See upstream report
[#1207](http://pari.math.u-bordeaux.fr/cgi-bin/bugreport.cgi?bug=1207).

I have corrected some errors in the code and added another doctest.

I am unable to reproduce the doctest failing that Maria points out on sage-4.7

Note: doctest with this patch will fail until the pari bug is solved.


---

Comment by lftabera created at 2011-07-21 15:07:22

The problem with pari is solved in the last stable release.

This ticket now depends on #11130 until pari is not updated the patch is not safe.


---

Attachment

the good one


---

Comment by lftabera created at 2011-08-24 17:03:27

Rebase against 4.7.1


---

Comment by lftabera created at 2011-08-24 17:03:27

Changing status from needs_work to needs_review.


---

Comment by was created at 2011-08-24 23:45:28

Changing keywords from "factorization, pari, nfinit, number field" to "factorization, pari, nfinit, number field, sd32".


---

Comment by lftabera created at 2011-10-11 07:54:34

This ticked should be closed as a duplicate of #11890


---

Comment by jdemeyer created at 2011-10-11 07:56:56

Changing component from factorization to number fields.


---

Comment by jdemeyer created at 2011-10-11 07:56:56

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2011-10-16 16:10:45

Resolution: duplicate
