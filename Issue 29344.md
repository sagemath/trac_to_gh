# Issue 29344: New Algorithm for Characteristic Classes

Issue created by migration from https://trac.sagemath.org/ticket/29581

Original creator: @mjungmath

Original creation time: 2020-04-25 19:55:39

CC:  slelievre egourgoulhon tscrim mkoeppe @tobiasdiez




---

Comment by mkoeppe created at 2020-04-25 20:18:32

New commits:


---

Comment by slelievre created at 2020-04-26 02:22:46

Changing component from PLEASE CHANGE to geometry.


---

Comment by slelievre created at 2020-04-26 02:25:24

Please add a short description in the "Description" field of the ticket,
and the author's full name in the "Authors" field of the ticket. Don't forget
to set to `needs_review` when this is ready for review.


---

Comment by git created at 2020-04-28 19:22:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-04-28 19:26:31

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by @mjungmath created at 2020-04-28 20:16:19

Changing type from PLEASE CHANGE to enhancement.


---

Comment by @mjungmath created at 2020-04-28 20:16:19

Changing keywords from "" to "characteristic_classes, manifolds".


---

Comment by chapoton created at 2020-04-28 20:21:28

Correct syntax for crosslinks is

```
.. SEEALSO::
```



---

Comment by chapoton created at 2020-05-01 18:56:07

* do not use this:

```
if distinct_real == False
```

but

```
if not distinct_real
```

(at least in two places)


* The following change is wrong:

```diff
-        - ``cmatrix`` -- curvature matrix
-
+            - ``cmatrix`` -- curvature matrix
         OUTPUT:
 
-        - ``I/(2*pi)*cmatrix``
+            - ``I/(2*pi)*cmatrix``
```

as one should not indent inside INPUT or OUTPUT blocks (because they end with only one colon). And moreover, one does want empty lines to separate these things.

This is also incorrect:

```diff
-            self._dual_exterior_powers[p] = ExtPowerDualFreeModule(self, p)
+                self._dual_exterior_powers[p] = ExtPowerDualFreeModule(self, p)
```

Why did you change the indentation ? it was ok.


---

Comment by @mjungmath created at 2020-05-01 19:39:13

I am sorry. At this stage, this is just a draft. The indentations are typos coming from using alt+tab (at least I guess so). I will fix this soon.


---

Comment by @mjungmath created at 2020-05-01 19:43:42

Thanks for your advice. :)


---

Comment by git created at 2020-05-04 11:31:37

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @mjungmath created at 2020-05-04 11:38:46

Changing status from new to needs_review.


---

Comment by @mjungmath created at 2020-05-04 11:41:30

Changing status from needs_review to needs_info.


---

Comment by @mjungmath created at 2020-05-04 12:01:34

An example for the application of the new algorithm would be really nice. For instance a Todd class or A-Hat class. But I have no idea for a suitable one. If anyone does, or at least knows someone who does, I would really appreciate it. Thanks! :)


---

Comment by git created at 2020-05-08 17:51:43

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @mjungmath created at 2020-07-24 11:40:01

Changing component from geometry to manifolds.


---

Comment by mkoeppe created at 2021-03-15 22:07:04

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.


---

Comment by mkoeppe created at 2021-07-19 00:44:56

Setting a new milestone for this ticket based on a cursory review.


---

Comment by @mjungmath created at 2021-07-23 22:51:55

Changing status from needs_info to needs_work.


---

Comment by git created at 2021-07-23 22:53:14

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by @mjungmath created at 2021-07-23 22:56:00

Do you think it is necessary to give those cohomology classes an own parent or would `DeRhamCohomologyRing` as parent suffice?

The point is that addition and multiplication is performed differently among those elements. Moreover, it is possible to compare them.


---

Comment by @mjungmath created at 2021-07-23 22:58:40

Changing status from needs_work to needs_info.


---

Comment by git created at 2021-07-24 00:03:30

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-08-17 15:38:23

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by git created at 2021-08-17 17:13:53

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-08-17 17:20:34

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-08-17 20:52:09

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-08-18 08:51:40

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-08-18 08:55:06

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @mjungmath created at 2021-08-18 08:58:53

The ticket is not ready for review yet; the structure should be fixed though. Feedback at this stage is very much appreciated. :)


---

Comment by git created at 2021-08-18 09:07:07

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-08-18 16:59:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-08-18 16:59:51

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-08-18 20:22:23

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-08-18 21:01:27

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @mjungmath created at 2021-08-18 21:13:19

I am particularly curious what you think about my last commit. I want that the corresponding characteristic forms are only computed if really necessary. This essentially only matters for the Pontryagin-Euler algorithm when the characteristic cohomology class contains no Euler or Pontryagin part.

Is there any lazy-stuff to make this a bit nicer maybe?


---

Comment by git created at 2021-08-18 21:26:09

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @mjungmath created at 2021-08-19 07:36:20

Since I have implemented `fast_wedge_power`, which can be used separately of course, do we want a power method for differential forms or tensor fields respectively?


---

Comment by tscrim created at 2021-08-19 08:19:22

Replying to [comment:43 gh-mjungmath]:
> I am particularly curious what you think about my last commit. I want that the corresponding characteristic forms are only computed if really necessary. This essentially only matters for the Pontryagin-Euler algorithm when the characteristic cohomology class contains no Euler or Pontryagin part.

You would have to know that ahead of time I think. Naïvely, it seems like you need to know the answer before you can tell if the answer is the form you want.


---

Comment by @mjungmath created at 2021-08-19 08:36:20

Well, what I need to know is already encoded in the characteristic cohomology class itself. For example, if it contains no Euler class generator, then I don't need to invoke `EulerAlgorithm().get(nab)`. Like I said, this only matters for the "mixed" PontryaginEuler case because in any other case I have to do the full computation anyway.

One reason why this is important: in the odd-rank case, or for non-Levi-Civita connections, this algorithm for the Euler class is not working. But one may still want to compute the Pontryagin classes.

The current commit makes sure of that by asking for the power of a certain generator and returning the one scalar field right away if the exponent is zero. This works, but it feels rather dirty to me, and I ponder whether there might be a nicer solution to this.


---

Comment by git created at 2021-08-19 09:10:02

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2021-08-19 09:20:57

Unfortunately this is over my head mathematically, so I don't think I can really help with possible solutions at this point.


---

Comment by @mjungmath created at 2021-08-19 09:54:14

Replying to [comment:49 tscrim]:
> Unfortunately this is over my head mathematically, so I don't think I can really help with possible solutions at this point.

Mh okay. If you like, we can talk about it privately at some point.

I have another question though. I tried to establish a coercion from the characteristic cohomology class ring to the de Rham cohomology ring. For that, I need a representative which I only get if I've inserted a connection. Now I've read that coercions must always suceed. So throwing an error if no representative is available is not an option then?

Otherwise, we could return the same instance of `CharacteristicCohomologyClass` if we pass it to the `_element_constructor_` of `DeRhamCohomologyRing`. But I suppose that is against the coercion principles either, right?


---

Comment by git created at 2021-08-19 13:07:30

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2021-08-25 04:35:37

Replying to [comment:50 gh-mjungmath]:
> Replying to [comment:49 tscrim]:
> > Unfortunately this is over my head mathematically, so I don't think I can really help with possible solutions at this point.
> 
> Mh okay. If you like, we can talk about it privately at some point.

If you are still stuck with something, perhaps we can. Perhaps Éric can offer some wisdom here.

> I have another question though. I tried to establish a coercion from the characteristic cohomology class ring to the de Rham cohomology ring. For that, I need a representative which I only get if I've inserted a connection. Now I've read that coercions must always suceed. So throwing an error if no representative is available is not an option then?

Probably. Although you can say there is a coercion, but the data used to initialize it has not been specified. However, this map must also be unique too (in a mathematical sense; I think different representatives for the same element is fine), which means you cannot change the connection. This might be a place where we can justify having an exception because of the surrounding framework, but it is likely better to avoid that and make the user explicitly ask for a conversion.

> Otherwise, we could return the same instance of `CharacteristicCohomologyClass` if we pass it to the `_element_constructor_` of `DeRhamCohomologyRing`. But I suppose that is against the coercion principles either, right?

If we are passing it to the `_element_cosntructor_`, then it is a conversion, and there are essentially no rules at that point.


---

Comment by @mjungmath created at 2021-08-25 07:29:50

Thank you Travis for your comments. My original idea was to inherit from `DeRhamCohomologyClass`. Because both classes have the `representative` method in common, which is crucial to perform operations such as additions and cup-products. My "dream" would be that an element of `CharacteristicCohomologyClassRing` can be seen as member of `DeRhamCohomologyRing`, and whenever `representative` is invoked (even after coercions), you can still choose a connection.

One way to achieve this could be to allow the attribute `_representative` in `DeRhamCohomologyClass` to refer to a method. But I suppose this is rather spurious for the user?

Alternatively, if we drop my "dream" and still allow coercion: we can modify `DeRhamCohomologyClass` in such a way that we can give it a name and allow to leave the `_representative` attribute empty. Similar to scalar fields whose expressions are not set yet. Afterwards, the representative can be set dynamically, and we can make the instance immutable if desired.

What would you prefer Travis? Eric, do you have an opinion, too?


---

Comment by git created at 2021-08-29 16:00:10

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-08-29 16:09:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-08-29 16:10:16

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-09-05 10:40:50

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-09-05 14:12:36

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @mjungmath created at 2021-09-05 14:14:37

I think I made the constructor class `CharacteristicCohomologyClass` unnecessarily complicated. Do you have an idea to make it more clean?

Otherwise, the main parts should be finished except for coercion support w.r.t. de Rham cohomology (see comment:53).


---

Comment by git created at 2021-09-05 14:56:48

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-09-05 14:58:02

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-09-05 15:00:09

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2021-09-05 15:06:23

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-09-05 15:12:06

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @mjungmath created at 2021-09-05 17:30:57

Replying to [comment:52 tscrim]:
> Probably. Although you can say there is a coercion, but the data used to initialize it has not been specified. However, this map must also be unique too (in a mathematical sense; I think different representatives for the same element is fine), which means you cannot change the connection.

Wait. The cohomology class **_is_** independent of the connection. It just gives different representatives. Then it should be fine.


---

Comment by git created at 2021-09-05 19:17:47

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-09-05 19:21:27

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-09-05 19:23:52

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-09-05 19:28:17

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-09-07 17:38:37

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-09-07 17:47:20

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-09-08 12:20:23

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-09-08 12:46:47

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-09-09 12:17:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-09-09 12:48:58

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-09-09 14:24:26

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-09-09 15:49:48

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-09-11 20:12:11

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-09-11 20:47:25

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-09-12 10:23:16

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @mjungmath created at 2021-09-12 10:25:08

Changing status from needs_info to needs_review.


---

Comment by @mjungmath created at 2021-09-12 10:25:08

Ticket should be finally ready for review now. :)


---

Comment by @mjungmath created at 2021-09-12 10:26:36

By the way, comparing wall times within the notebook https://nbviewer.jupyter.org/github/sagemanifolds/SageManifolds/blob/master/Notebooks/SM_char_classes.ipynb yields very good results!


---

Comment by git created at 2021-09-12 20:00:01

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @mjungmath created at 2021-09-13 07:33:00

Patchbot is morally green.


---

Comment by git created at 2021-09-13 12:27:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-09-13 17:14:27

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-09-15 14:11:10

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2021-09-16 04:45:55

Since `CharacteristicCohomologyClass` is not a function nor user-facing, you should follow Python naming conventions and write it as `characteristic_cohomology_class`, perhaps adding `build_` in front. However, I think you are better off tying that to the ring, perhaps as a (cached) helper method. This ties the cache of classes to the lifecycle of the ring rather than globally (which also nails the rings in memory) and better links everything from a code-association perspective.

This isn't necessarily specific to this ticket (but maybe now with these changes this is now possible), but do we have an example where the entire cohomology ring of a manifold is computed, such as the sphere or torus?

Perhaps as a followup ticket, a thematic tutorial on how to compute with the cohomology classes of the manifold might be good (using the module-level doc as a starting point).


---

Comment by git created at 2021-09-16 12:26:19

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @mjungmath created at 2021-09-16 12:36:29

Replying to [comment:88 tscrim]:
> Since `CharacteristicCohomologyClass` is not a function nor user-facing, you should follow Python naming conventions and write it as `characteristic_cohomology_class`, perhaps adding `build_` in front. However, I think you are better off tying that to the ring, perhaps as a (cached) helper method. This ties the cache of classes to the lifecycle of the ring rather than globally (which also nails the rings in memory) and better links everything from a code-association perspective.

Thank you Travis for this feedback. I also tied it to the element constructor now. Is that what you had in mind?

> This isn't necessarily specific to this ticket (but maybe now with these changes this is now possible), but do we have an example where the entire cohomology ring of a manifold is computed, such as the sphere or torus?

Take for example `CP^1 = S^2` whose 2nd cohomology is generated by the first Chern class of the tautological bundle. But this is a rather special example.

> Perhaps as a followup ticket, a thematic tutorial on how to compute with the cohomology classes of the manifold might be good (using the module-level doc as a starting point).

module-level doc?


---

Comment by git created at 2021-09-16 21:35:27

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2021-09-21 04:37:08

Replying to [comment:90 gh-mjungmath]:
> Replying to [comment:88 tscrim]:
> > Since `CharacteristicCohomologyClass` is not a function nor user-facing, you should follow Python naming conventions and write it as `characteristic_cohomology_class`, perhaps adding `build_` in front. However, I think you are better off tying that to the ring, perhaps as a (cached) helper method. This ties the cache of classes to the lifecycle of the ring rather than globally (which also nails the rings in memory) and better links everything from a code-association perspective.
> 
> Thank you Travis for this feedback. I also tied it to the element constructor now. Is that what you had in mind?

Yea, that looks good. Thank you.

> > This isn't necessarily specific to this ticket (but maybe now with these changes this is now possible), but do we have an example where the entire cohomology ring of a manifold is computed, such as the sphere or torus?
> 
> Take for example `CP^1 = S^2` whose 2nd cohomology is generated by the first Chern class of the tautological bundle. But this is a rather special example.

Perhaps that is a bit special. The torus is a little more interesting example. Mainly what I am thinking is if can we compute the Betti numbers without necessarily knowing what the manifold is in advance.

> > Perhaps as a followup ticket, a thematic tutorial on how to compute with the cohomology classes of the manifold might be good (using the module-level doc as a starting point).
> 
> module-level doc?

The documentation at the top of the `characteristic_cohomology_class.py` file (a Python module).


---

Comment by @mjungmath created at 2021-09-21 20:03:18

Replying to [comment:92 tscrim]:
> Yea, that looks good. Thank you.

So, what's missing for a positive review then?

> Perhaps that is a bit special. The torus is a little more interesting example. Mainly what I am thinking is if can we compute the Betti numbers without necessarily knowing what the manifold is in advance.

I don't see how that should be possible with this implementation. Characteristic cohomology classes usually don't tell you anything about the cohomology of your underlying base space. For once, the characteristic cohomology classes in general don't generate the cohomology groups. Moreover, if a characteristic cohomology class has torsion in the ZZ-cohomology, its corresponding class in the de Rham cohomology vanishes. So you lose a lot of information on the way.

> > > Perhaps as a followup ticket, a thematic tutorial on how to compute with the cohomology classes of the manifold might be good (using the module-level doc as a starting point).
> > 
> > module-level doc?
> 
> The documentation at the top of the `characteristic_cohomology_class.py` file (a Python module).

Right. But this is indeed something for a follow-up. However, don't you think this fits better into a general tutorial?


---

Comment by tscrim created at 2021-09-23 03:57:47

Replying to [comment:93 gh-mjungmath]:
> Replying to [comment:92 tscrim]:
> > Yea, that looks good. Thank you.
> 
> So, what's missing for a positive review then?

You've answered all of my other questions, so nothing now. Thank you.

> > Perhaps that is a bit special. The torus is a little more interesting example. Mainly what I am thinking is if can we compute the Betti numbers without necessarily knowing what the manifold is in advance.
> 
> I don't see how that should be possible with this implementation. Characteristic cohomology classes usually don't tell you anything about the cohomology of your underlying base space. For once, the characteristic cohomology classes in general don't generate the cohomology groups. Moreover, if a characteristic cohomology class has torsion in the ZZ-cohomology, its corresponding class in the de Rham cohomology vanishes. So you lose a lot of information on the way.

Okay. Thank you for the explanation.

> > > > Perhaps as a followup ticket, a thematic tutorial on how to compute with the cohomology classes of the manifold might be good (using the module-level doc as a starting point).
> 
> Right. But this is indeed something for a follow-up. However, don't you think this fits better into a general tutorial?

I agree that it should be a followup. Yet, it is a bit specialized, so I think a thematic tutorial is better.


---

Comment by tscrim created at 2021-09-23 03:57:47

Changing status from needs_review to positive_review.


---

Comment by @mjungmath created at 2021-09-23 08:17:39

Thank you for the review Travis! :)


---

Comment by vbraun created at 2021-09-26 21:31:23

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2021-09-26 21:31:23

Merge conflict


---

Comment by git created at 2021-09-27 14:49:39

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @mjungmath created at 2021-09-27 14:51:22

I have no idea what caused the merge conflict. I hope it works now...


---

Comment by @mjungmath created at 2021-09-27 14:51:29

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2021-09-29 07:03:00

Changing status from needs_review to positive_review.


---

Comment by egourgoulhon created at 2021-09-29 08:07:43

Changing status from positive_review to needs_work.


---

Comment by egourgoulhon created at 2021-09-29 08:07:43

Sorry to interfere here, but the patchbot says

```
sage -t --long --random-seed=0 src/sage/manifolds/differentiable/characteristic_cohomology_class.py  # 9 doctests failed
```



---

Comment by tscrim created at 2021-09-29 09:06:16

Looks like an import location changed:

```
ImportError: cannot import name 'I' from 'sage.libs.pynac.pynac'
```



---

Comment by @mjungmath created at 2021-09-29 09:09:59

This is probably due to #32386. How do I import the imaginary unit now?


---

Comment by egourgoulhon created at 2021-09-29 09:18:36

Replying to [comment:103 gh-mjungmath]:
> This is probably due to #32386. How do I import the imaginary unit now?
`sage: import_statements("I")` says

```
from sage.rings.imaginary_unit import I
```

Indeed:

```
sage: from sage.rings.imaginary_unit import I as I2
sage: I2 is I
True
```



---

Comment by git created at 2021-09-29 09:21:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @mjungmath created at 2021-09-29 09:21:12

Changing status from needs_work to needs_review.


---

Comment by @mjungmath created at 2021-09-29 09:21:12

Here we go. Let's hope this works now.
----
New commits:


---

Comment by tscrim created at 2021-09-29 09:23:03

From #32386, they made this change:

```diff
-from sage.libs.pynac.pynac import I
+from sage.symbolic.expression import I
```



---

Comment by egourgoulhon created at 2021-09-29 09:24:35

Replying to [comment:104 egourgoulhon]:
> Replying to [comment:103 gh-mjungmath]:
> > This is probably due to #32386. How do I import the imaginary unit now?
> `sage: import_statements("I")` says
> {{{
> from sage.rings.imaginary_unit import I
> }}}
> Indeed:
> {{{
> sage: from sage.rings.imaginary_unit import I as I2
> sage: I2 is I
> True
> }}}

BTW, I've just noticed that

```
sage: from sage.symbolic.constants import I as I3
sage: I3 is I
False
```

However, 

```
sage: bool(I3 == I)
True
sage: I3^2
-1
sage: I + I3
2*I
```



---

Comment by egourgoulhon created at 2021-09-29 09:25:28

Replying to [comment:107 tscrim]:
> From #32386, they made this change:
> {{{#!diff
> -from sage.libs.pynac.pynac import I
> +from sage.symbolic.expression import I
> }}}
Here we have:

```
sage: from sage.symbolic.expression import I as I4
sage: I4 is I
False
```



---

Comment by egourgoulhon created at 2021-09-29 09:29:47

To summarize, there are at least 3 sources for `I`: `sage.rings.imaginary_unit`, `sage.symbolic.constants`, `sage.symbolic.expression`, but only the first one gives the same `I` as the Python variable predefined in the interactive shell. Moreover, we have

```
sage: I.parent()
Number Field in I with defining polynomial x^2 + 1 with I = 1*I
sage: from sage.symbolic.constants import I as I1
sage: I1.parent()
Symbolic Ring
sage: from sage.symbolic.expression import I as I2
sage: I2.parent()
Symbolic Ring
sage: I2 is I1
True
```



---

Comment by @mjungmath created at 2021-09-29 09:35:40

But `sage.symbolic.constants` and `sage.symbolic.expression` give the same `I`, don't they?


---

Comment by egourgoulhon created at 2021-09-29 09:37:57

#18036 is probably relevant here.


---

Comment by tscrim created at 2021-09-29 09:39:47

I think you want to follow the change from #32386 since you are wanting to do symbolic ring computations. Otherwise you end up with

```
sage: I.parent()
Number Field in I with defining polynomial x^2 + 1 with I = 1*I
```



---

Comment by egourgoulhon created at 2021-09-29 09:48:42

Replying to [comment:113 tscrim]:
> I think you want to follow the change from #32386 since you are wanting to do symbolic ring computations. Otherwise you end up with
> {{{
> sage: I.parent()
> Number Field in I with defining polynomial x^2 + 1 with I = 1*I
> }}}
In `src/sage/symbolic/all.py` there is a deprecation warning against `from sage.symbolic.expression import I`:

```
lazy_import("sage.symbolic.expression", "I", deprecation=(18036,
        "import I from sage.symbolic.constants for the imaginary unit viewed as an element of SR, or from sage.rings.imaginary_unit for the element of ZZ[i]"))
```

However, this warning does not seem effective...


---

Comment by egourgoulhon created at 2021-09-29 10:02:27

In a fresh Sage session, we have (since #18036 I guess)

```
sage: I.parent()
Number Field in I with defining polynomial x^2 + 1 with I = 1*I
sage: from sage.symbolic.constants import I as I_symb
sage: I_symb.parent()
Symbolic Ring
sage: SR(I) is I_symb
False
```

I would have expected `True` for the last output (i.e. to have `I` unique as a symbolic expression).


---

Comment by tscrim created at 2021-09-29 12:37:27

It's not so unnatural to have copies being made. It would also be a lot of work for SR to check that some potentially very complicated expression is equal to `I`.

Okay, then follow the deprecation and import from `sage.symbolic.constants`. The main thing is to not use the one from `from sage.rings.imaginary_unit import I`.


---

Comment by git created at 2021-09-29 13:53:48

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @mjungmath created at 2021-09-29 13:54:16

Okay, there we go. Thank you for this feedback!


---

Comment by tscrim created at 2021-09-29 22:51:56

Green bot. LGTM.


---

Comment by tscrim created at 2021-09-29 22:51:56

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2021-10-03 17:18:31


```
[docpdf] ! Package inputenc Error: Unicode character ϑ (U+03D1)
[docpdf] (inputenc)                not set up for use with LaTeX.
[docpdf] 
[docpdf] See the inputenc package documentation for explanation.
[docpdf] Type  H <return>  for immediate help.
[docpdf]  ...                                              
[docpdf]                                                   
[docpdf] l.73283 ...1}{\PYGZsh{} use spherical coordinates}
[docpdf]                                                   
[docpdf] ? 
[docpdf] ! Emergency stop.
```



---

Comment by vbraun created at 2021-10-03 17:18:31

Changing status from positive_review to needs_work.


---

Comment by egourgoulhon created at 2021-10-03 19:22:06

Indeed, any new Unicode character has to be declared in

```
src/sage/docs/conf.py
```

for the pdf doc to be generated successfully.


---

Comment by git created at 2021-10-03 22:08:45

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @mjungmath created at 2021-10-03 22:10:12

Changing status from needs_work to needs_review.


---

Comment by @mjungmath created at 2021-10-03 22:10:12

That should solve it. Hopefully.


---

Comment by tscrim created at 2021-10-03 23:25:18

That is one way to solve it.


---

Comment by tscrim created at 2021-10-03 23:25:18

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2021-10-10 10:17:21

Resolution: fixed
