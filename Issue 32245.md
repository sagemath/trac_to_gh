# Issue 32245: Update pip to 21.2.4

Issue created by migration from https://trac.sagemath.org/ticket/32482

Original creator: mkoeppe

Original creation time: 2021-09-06 19:02:12

CC:  dimpase jhpalmieri

https://pip.pypa.io/en/stable/news/


---

Comment by mkoeppe created at 2021-09-06 19:39:20

New commits:


---

Comment by git created at 2021-09-06 19:39:39

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by mkoeppe created at 2021-09-06 19:42:47

Our patch `build/pkgs/setuptools/patches/distutils-big-sur-6511bf56.patch` (workaround for `MACOSX_DEPLOYMENT_TARGET=11`, added in #31335) no longer applies. The code has changed a lot and is now in (https://github.com/pypa/setuptools/blob/1ba66c1d79bf2e89d1d7be426bde60298c9439cd/setuptools/_distutils/util.py#L140). I don't see the workaround reflected by the new code.


---

Comment by mkoeppe created at 2021-09-06 19:50:14

(from #31335#comment:36)
Upstream cpython issue:â€‹ https://bugs.python.org/issue42504


---

Comment by mkoeppe created at 2021-09-06 19:59:20

apparently fixed in upstream cpython 3.10 (https://github.com/python/cpython/pull/24341), 3.9.2 (https://github.com/python/cpython/pull/24410), 3.8.10 (https://github.com/python/cpython/pull/25806)


---

Comment by git created at 2021-09-06 20:06:48

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-09-06 20:38:54

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-09-06 20:42:29

Running into a strange circular dependency for `packaging`

```
packaging-21.0] Installing packaging-21.0
[packaging-21.0] Processing /Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/var/tmp/sage/build/packaging-21.0/src
[packaging-21.0]     Preparing wheel metadata: started
[packaging-21.0]     Running command /Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/bin/python3 /Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/lib/python3.9/site-packages/pip/_vendor/pep517/in_process/_in_process.py prepare_metadata_for_build_wheel /var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/tmpk9l4wmep
[packaging-21.0]     Traceback (most recent call last):
[packaging-21.0]       File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/lib/python3.9/site-packages/pip/_vendor/pep517/in_process/_in_process.py", line 349, in <module>
[packaging-21.0]         main()
[packaging-21.0]       File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/lib/python3.9/site-packages/pip/_vendor/pep517/in_process/_in_process.py", line 331, in main
[packaging-21.0]         json_out['return_val'] = hook(**hook_input['kwargs'])
[packaging-21.0]       File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/lib/python3.9/site-packages/pip/_vendor/pep517/in_process/_in_process.py", line 151, in prepare_metadata_for_build_wheel
[packaging-21.0]         return hook(metadata_directory, config_settings)
[packaging-21.0]       File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/lib/python3.9/site-packages/setuptools/build_meta.py", line 166, in prepare_metadata_for_build_wheel
[packaging-21.0]         self.run_setup()
[packaging-21.0]       File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/lib/python3.9/site-packages/setuptools/build_meta.py", line 150, in run_setup
[packaging-21.0]         exec(compile(code, __file__, 'exec'), locals())
[packaging-21.0]       File "setup.py", line 40, in <module>
[packaging-21.0]         setup(
[packaging-21.0]       File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/lib/python3.9/site-packages/setuptools/__init__.py", line 153, in setup
[packaging-21.0]         return distutils.core.setup(**attrs)
[packaging-21.0]       File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/lib/python3.9/site-packages/setuptools/_distutils/core.py", line 108, in setup
[packaging-21.0]         _setup_distribution = dist = klass(attrs)
[packaging-21.0]       File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/lib/python3.9/site-packages/setuptools/dist.py", line 450, in __init__
[packaging-21.0]         _Distribution.__init__(
[packaging-21.0]       File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/lib/python3.9/site-packages/setuptools/_distutils/dist.py", line 293, in __init__
[packaging-21.0]         self.finalize_options()
[packaging-21.0]       File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/lib/python3.9/site-packages/setuptools/dist.py", line 827, in finalize_options
[packaging-21.0]         for ep in sorted(loaded, key=by_order):
[packaging-21.0]       File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/lib/python3.9/site-packages/setuptools/dist.py", line 826, in <lambda>
[packaging-21.0]         loaded = map(lambda e: e.load(), filtered)
[packaging-21.0]       File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/lib/python3.9/site-packages/pkg_resources/__init__.py", line 2449, in load
[packaging-21.0]         self.require(*args, **kwargs)
[packaging-21.0]       File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/lib/python3.9/site-packages/pkg_resources/__init__.py", line 2472, in require
[packaging-21.0]         items = working_set.resolve(reqs, env, installer, extras=self.extras)
[packaging-21.0]       File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/lib/python3.9/site-packages/pkg_resources/__init__.py", line 772, in resolve
[packaging-21.0]         raise DistributionNotFound(req, requirers)
[packaging-21.0]     pkg_resources.DistributionNotFound: The 'packaging>=20.0' distribution was not found and is required by the application
[packaging-21.0]     Preparing wheel metadata: finished with status 'error'
[packaging-21.0] WARNING: Discarding file:///Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/var/tmp/sage/build/packaging-21.0/src. Command errored out with exit status 1: /Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/bin/python3 /Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/lib/python3.9/site-packages/pip/_vendor/pep517/in_process/_in_process.py prepare_metadata_for_build_wheel /var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/tmpk9l4wmep Check the logs for full command output.
[packaging-21.0] ERROR: Command errored out with exit status 1: /Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/bin/python3 /Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/lib/python3.9/site-packages/pip/_vendor/pep517/in_process/_in_process.py prepare_metadata_for_build_wheel /var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/tmpk9l4wmep Check the logs for full command output.
[packaging-21.0] ********************************************************************************
[packaging-21.0] Error building a wheel for packaging-21.0
```



---

Comment by mkoeppe created at 2021-09-06 20:48:59

This went away by doing `make setuptools_scm-clean`


---

Comment by mkoeppe created at 2021-09-06 20:53:10

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2021-09-07 00:42:45


```
  [tomli-1.2.1]   ModuleNotFoundError: No module named 'flit_core'
```



---

Comment by mkoeppe created at 2021-09-07 00:42:45

Changing status from needs_review to needs_work.


---

Comment by mkoeppe created at 2021-09-07 00:45:06

... so need #32483 or #31280


---

Comment by git created at 2021-09-09 03:29:57

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by git created at 2021-09-09 03:32:26

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-09-09 03:49:44

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-09-09 03:54:17

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-09-09 04:47:57

Changing status from needs_work to needs_review.


---

Comment by git created at 2021-09-14 02:08:39

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jhpalmieri created at 2021-09-15 20:04:42

Changing status from needs_review to positive_review.


---

Comment by jhpalmieri created at 2021-09-15 20:04:42

This looks good to me.


---

Comment by mkoeppe created at 2021-09-15 21:23:18

Thank you!


---

Comment by vbraun created at 2021-09-19 09:57:57

Resolution: fixed
