# Issue 32245: Update pip to 21.2.4

archive/issues_032245.json:
```json
{
    "body": "CC:  dimpase jhpalmieri\n\nhttps://pip.pypa.io/en/stable/news/\n\nIssue created by migration from https://trac.sagemath.org/ticket/32482\n\n",
    "created_at": "2021-09-06T19:02:12Z",
    "labels": [
        "packages: standard",
        "major",
        "enhancement"
    ],
    "title": "Update pip to 21.2.4",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32245",
    "user": "mkoeppe"
}
```
CC:  dimpase jhpalmieri

https://pip.pypa.io/en/stable/news/

Issue created by migration from https://trac.sagemath.org/ticket/32482





---

archive/issue_comments_460451.json:
```json
{
    "body": "New commits:",
    "created_at": "2021-09-06T19:39:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32245#issuecomment-460451",
    "user": "mkoeppe"
}
```

New commits:



---

archive/issue_comments_460452.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2021-09-06T19:39:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32245#issuecomment-460452",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_460453.json:
```json
{
    "body": "Our patch `build/pkgs/setuptools/patches/distutils-big-sur-6511bf56.patch` (workaround for `MACOSX_DEPLOYMENT_TARGET=11`, added in #31335) no longer applies. The code has changed a lot and is now in (https://github.com/pypa/setuptools/blob/1ba66c1d79bf2e89d1d7be426bde60298c9439cd/setuptools/_distutils/util.py#L140). I don't see the workaround reflected by the new code.",
    "created_at": "2021-09-06T19:42:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32245#issuecomment-460453",
    "user": "mkoeppe"
}
```

Our patch `build/pkgs/setuptools/patches/distutils-big-sur-6511bf56.patch` (workaround for `MACOSX_DEPLOYMENT_TARGET=11`, added in #31335) no longer applies. The code has changed a lot and is now in (https://github.com/pypa/setuptools/blob/1ba66c1d79bf2e89d1d7be426bde60298c9439cd/setuptools/_distutils/util.py#L140). I don't see the workaround reflected by the new code.



---

archive/issue_comments_460454.json:
```json
{
    "body": "(from #31335#comment:36)\nUpstream cpython issue:\u200b https://bugs.python.org/issue42504",
    "created_at": "2021-09-06T19:50:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32245#issuecomment-460454",
    "user": "mkoeppe"
}
```

(from #31335#comment:36)
Upstream cpython issue:â€‹ https://bugs.python.org/issue42504



---

archive/issue_comments_460455.json:
```json
{
    "body": "apparently fixed in upstream cpython 3.10 (https://github.com/python/cpython/pull/24341), 3.9.2 (https://github.com/python/cpython/pull/24410), 3.8.10 (https://github.com/python/cpython/pull/25806)",
    "created_at": "2021-09-06T19:59:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32245#issuecomment-460455",
    "user": "mkoeppe"
}
```

apparently fixed in upstream cpython 3.10 (https://github.com/python/cpython/pull/24341), 3.9.2 (https://github.com/python/cpython/pull/24410), 3.8.10 (https://github.com/python/cpython/pull/25806)



---

archive/issue_comments_460456.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-09-06T20:06:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32245#issuecomment-460456",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_460457.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-09-06T20:38:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32245#issuecomment-460457",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_460458.json:
```json
{
    "body": "Running into a strange circular dependency for `packaging`\n\n```\npackaging-21.0] Installing packaging-21.0\n[packaging-21.0] Processing /Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/var/tmp/sage/build/packaging-21.0/src\n[packaging-21.0]     Preparing wheel metadata: started\n[packaging-21.0]     Running command /Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/bin/python3 /Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/lib/python3.9/site-packages/pip/_vendor/pep517/in_process/_in_process.py prepare_metadata_for_build_wheel /var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/tmpk9l4wmep\n[packaging-21.0]     Traceback (most recent call last):\n[packaging-21.0]       File \"/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/lib/python3.9/site-packages/pip/_vendor/pep517/in_process/_in_process.py\", line 349, in <module>\n[packaging-21.0]         main()\n[packaging-21.0]       File \"/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/lib/python3.9/site-packages/pip/_vendor/pep517/in_process/_in_process.py\", line 331, in main\n[packaging-21.0]         json_out['return_val'] = hook(**hook_input['kwargs'])\n[packaging-21.0]       File \"/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/lib/python3.9/site-packages/pip/_vendor/pep517/in_process/_in_process.py\", line 151, in prepare_metadata_for_build_wheel\n[packaging-21.0]         return hook(metadata_directory, config_settings)\n[packaging-21.0]       File \"/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/lib/python3.9/site-packages/setuptools/build_meta.py\", line 166, in prepare_metadata_for_build_wheel\n[packaging-21.0]         self.run_setup()\n[packaging-21.0]       File \"/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/lib/python3.9/site-packages/setuptools/build_meta.py\", line 150, in run_setup\n[packaging-21.0]         exec(compile(code, __file__, 'exec'), locals())\n[packaging-21.0]       File \"setup.py\", line 40, in <module>\n[packaging-21.0]         setup(\n[packaging-21.0]       File \"/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/lib/python3.9/site-packages/setuptools/__init__.py\", line 153, in setup\n[packaging-21.0]         return distutils.core.setup(**attrs)\n[packaging-21.0]       File \"/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/lib/python3.9/site-packages/setuptools/_distutils/core.py\", line 108, in setup\n[packaging-21.0]         _setup_distribution = dist = klass(attrs)\n[packaging-21.0]       File \"/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/lib/python3.9/site-packages/setuptools/dist.py\", line 450, in __init__\n[packaging-21.0]         _Distribution.__init__(\n[packaging-21.0]       File \"/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/lib/python3.9/site-packages/setuptools/_distutils/dist.py\", line 293, in __init__\n[packaging-21.0]         self.finalize_options()\n[packaging-21.0]       File \"/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/lib/python3.9/site-packages/setuptools/dist.py\", line 827, in finalize_options\n[packaging-21.0]         for ep in sorted(loaded, key=by_order):\n[packaging-21.0]       File \"/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/lib/python3.9/site-packages/setuptools/dist.py\", line 826, in <lambda>\n[packaging-21.0]         loaded = map(lambda e: e.load(), filtered)\n[packaging-21.0]       File \"/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/lib/python3.9/site-packages/pkg_resources/__init__.py\", line 2449, in load\n[packaging-21.0]         self.require(*args, **kwargs)\n[packaging-21.0]       File \"/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/lib/python3.9/site-packages/pkg_resources/__init__.py\", line 2472, in require\n[packaging-21.0]         items = working_set.resolve(reqs, env, installer, extras=self.extras)\n[packaging-21.0]       File \"/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/lib/python3.9/site-packages/pkg_resources/__init__.py\", line 772, in resolve\n[packaging-21.0]         raise DistributionNotFound(req, requirers)\n[packaging-21.0]     pkg_resources.DistributionNotFound: The 'packaging>=20.0' distribution was not found and is required by the application\n[packaging-21.0]     Preparing wheel metadata: finished with status 'error'\n[packaging-21.0] WARNING: Discarding file:///Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/var/tmp/sage/build/packaging-21.0/src. Command errored out with exit status 1: /Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/bin/python3 /Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/lib/python3.9/site-packages/pip/_vendor/pep517/in_process/_in_process.py prepare_metadata_for_build_wheel /var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/tmpk9l4wmep Check the logs for full command output.\n[packaging-21.0] ERROR: Command errored out with exit status 1: /Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/bin/python3 /Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/lib/python3.9/site-packages/pip/_vendor/pep517/in_process/_in_process.py prepare_metadata_for_build_wheel /var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/tmpk9l4wmep Check the logs for full command output.\n[packaging-21.0] ********************************************************************************\n[packaging-21.0] Error building a wheel for packaging-21.0\n```\n",
    "created_at": "2021-09-06T20:42:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32245#issuecomment-460458",
    "user": "mkoeppe"
}
```

Running into a strange circular dependency for `packaging`

```
packaging-21.0] Installing packaging-21.0
[packaging-21.0] Processing /Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/var/tmp/sage/build/packaging-21.0/src
[packaging-21.0]     Preparing wheel metadata: started
[packaging-21.0]     Running command /Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/bin/python3 /Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/lib/python3.9/site-packages/pip/_vendor/pep517/in_process/_in_process.py prepare_metadata_for_build_wheel /var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/tmpk9l4wmep
[packaging-21.0]     Traceback (most recent call last):
[packaging-21.0]       File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/lib/python3.9/site-packages/pip/_vendor/pep517/in_process/_in_process.py", line 349, in <module>
[packaging-21.0]         main()
[packaging-21.0]       File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/lib/python3.9/site-packages/pip/_vendor/pep517/in_process/_in_process.py", line 331, in main
[packaging-21.0]         json_out['return_val'] = hook(**hook_input['kwargs'])
[packaging-21.0]       File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/lib/python3.9/site-packages/pip/_vendor/pep517/in_process/_in_process.py", line 151, in prepare_metadata_for_build_wheel
[packaging-21.0]         return hook(metadata_directory, config_settings)
[packaging-21.0]       File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/lib/python3.9/site-packages/setuptools/build_meta.py", line 166, in prepare_metadata_for_build_wheel
[packaging-21.0]         self.run_setup()
[packaging-21.0]       File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/lib/python3.9/site-packages/setuptools/build_meta.py", line 150, in run_setup
[packaging-21.0]         exec(compile(code, __file__, 'exec'), locals())
[packaging-21.0]       File "setup.py", line 40, in <module>
[packaging-21.0]         setup(
[packaging-21.0]       File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/lib/python3.9/site-packages/setuptools/__init__.py", line 153, in setup
[packaging-21.0]         return distutils.core.setup(**attrs)
[packaging-21.0]       File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/lib/python3.9/site-packages/setuptools/_distutils/core.py", line 108, in setup
[packaging-21.0]         _setup_distribution = dist = klass(attrs)
[packaging-21.0]       File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/lib/python3.9/site-packages/setuptools/dist.py", line 450, in __init__
[packaging-21.0]         _Distribution.__init__(
[packaging-21.0]       File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/lib/python3.9/site-packages/setuptools/_distutils/dist.py", line 293, in __init__
[packaging-21.0]         self.finalize_options()
[packaging-21.0]       File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/lib/python3.9/site-packages/setuptools/dist.py", line 827, in finalize_options
[packaging-21.0]         for ep in sorted(loaded, key=by_order):
[packaging-21.0]       File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/lib/python3.9/site-packages/setuptools/dist.py", line 826, in <lambda>
[packaging-21.0]         loaded = map(lambda e: e.load(), filtered)
[packaging-21.0]       File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/lib/python3.9/site-packages/pkg_resources/__init__.py", line 2449, in load
[packaging-21.0]         self.require(*args, **kwargs)
[packaging-21.0]       File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/lib/python3.9/site-packages/pkg_resources/__init__.py", line 2472, in require
[packaging-21.0]         items = working_set.resolve(reqs, env, installer, extras=self.extras)
[packaging-21.0]       File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/lib/python3.9/site-packages/pkg_resources/__init__.py", line 772, in resolve
[packaging-21.0]         raise DistributionNotFound(req, requirers)
[packaging-21.0]     pkg_resources.DistributionNotFound: The 'packaging>=20.0' distribution was not found and is required by the application
[packaging-21.0]     Preparing wheel metadata: finished with status 'error'
[packaging-21.0] WARNING: Discarding file:///Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/var/tmp/sage/build/packaging-21.0/src. Command errored out with exit status 1: /Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/bin/python3 /Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/lib/python3.9/site-packages/pip/_vendor/pep517/in_process/_in_process.py prepare_metadata_for_build_wheel /var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/tmpk9l4wmep Check the logs for full command output.
[packaging-21.0] ERROR: Command errored out with exit status 1: /Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/bin/python3 /Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/lib/python3.9/site-packages/pip/_vendor/pep517/in_process/_in_process.py prepare_metadata_for_build_wheel /var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/tmpk9l4wmep Check the logs for full command output.
[packaging-21.0] ********************************************************************************
[packaging-21.0] Error building a wheel for packaging-21.0
```




---

archive/issue_comments_460459.json:
```json
{
    "body": "This went away by doing `make setuptools_scm-clean`",
    "created_at": "2021-09-06T20:48:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32245#issuecomment-460459",
    "user": "mkoeppe"
}
```

This went away by doing `make setuptools_scm-clean`



---

archive/issue_comments_460460.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-09-06T20:53:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32245#issuecomment-460460",
    "user": "mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_460461.json:
```json
{
    "body": "\n```\n  [tomli-1.2.1]   ModuleNotFoundError: No module named 'flit_core'\n```\n",
    "created_at": "2021-09-07T00:42:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32245#issuecomment-460461",
    "user": "mkoeppe"
}
```


```
  [tomli-1.2.1]   ModuleNotFoundError: No module named 'flit_core'
```




---

archive/issue_comments_460462.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-09-07T00:42:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32245#issuecomment-460462",
    "user": "mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_460463.json:
```json
{
    "body": "... so need #32483 or #31280",
    "created_at": "2021-09-07T00:45:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32245#issuecomment-460463",
    "user": "mkoeppe"
}
```

... so need #32483 or #31280



---

archive/issue_comments_460464.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2021-09-09T03:29:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32245#issuecomment-460464",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_460465.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-09-09T03:32:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32245#issuecomment-460465",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_460466.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-09-09T03:49:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32245#issuecomment-460466",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_460467.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-09-09T03:54:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32245#issuecomment-460467",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_460468.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-09-09T04:47:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32245#issuecomment-460468",
    "user": "mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_460469.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-09-14T02:08:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32245#issuecomment-460469",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_460470.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-09-15T20:04:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32245#issuecomment-460470",
    "user": "jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_460471.json:
```json
{
    "body": "This looks good to me.",
    "created_at": "2021-09-15T20:04:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32245#issuecomment-460471",
    "user": "jhpalmieri"
}
```

This looks good to me.



---

archive/issue_comments_460472.json:
```json
{
    "body": "Thank you!",
    "created_at": "2021-09-15T21:23:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32245#issuecomment-460472",
    "user": "mkoeppe"
}
```

Thank you!



---

archive/issue_comments_460473.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-09-19T09:57:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32245",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32245#issuecomment-460473",
    "user": "vbraun"
}
```

Resolution: fixed
