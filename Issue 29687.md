# Issue 29687: sage_setup: Do not fail if sage.env, sage.* are not available

Issue created by migration from https://trac.sagemath.org/ticket/29924

Original creator: mkoeppe

Original creation time: 2020-06-21 01:30:21

... so that it can be used as a build system for the most fundamental distributions of parts of sagelib such as `sage-objects`, `sage-categories` without artificially including `sage.env` there (which is still done as of #29865).


This will require taking care of some dependencies:

We remove some dependencies on `sage.*` that are still in `sage_setup`: 

```
./library_order.py:77:from sage.env import cython_aliases
./command/sage_build_cython.py:21:from sage.env import (SAGE_INC, cython_aliases, sage_include_directories)
```

... by handling the case that the functions `sage_include_directories`, `cython_aliases` cannot be imported from sage.env

... and removing the use of `SAGE_INC` by using instead the environment variables set in `sage-build-env-config` (this is #29855; see also #29711).

Harmless dependencies on `sage.*`:

```
./docbuild/ ........
  (will be invoked later, when sage.* is installed)
./optional_extension.py:22:from sage.misc.package import list_packages
./optional_extension.py:44:    from sage.misc.package import is_package_installed
  (no longer used, only kept around in case user packages use it)
./autogen/interpreters/__main__.py:4:from sage.env import SAGE_SRC
  (only used when invoked interactively)
./command/sage_install.py:28:        from sage.repl.ipython_kernel.install import SageKernelSpec
  (just need to make sure that `sage_setup.command.sage_install` is only used by the distribution that installs `sage.repl.ipython_kernel`)
```




(split out from #29847)



---

Comment by mkoeppe created at 2020-11-14 06:36:06

New commits:


---

Comment by mkoeppe created at 2020-12-06 18:17:38

Hoping we can make progress on this ticket this week - https://wiki.sagemath.org/days111


---

Comment by mkoeppe created at 2020-12-06 18:17:38

Changing keywords from "" to "sd111".


---

Comment by mkoeppe created at 2022-08-27 23:04:11

obsolete with #33812


---

Comment by mkoeppe created at 2022-08-27 23:04:11

Changing status from new to needs_review.
