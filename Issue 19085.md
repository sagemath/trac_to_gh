# Issue 19085: a much faster longest_common_prefix for words

archive/issues_019085.json:
```json
{
    "body": "CC:  @seblabbe\n\nI had to do some computations of the following kind... which are damn slow\n\n```\nsage: w = words.FibonacciWord()[:10000]\nsage: %time L = [[len(w[n:].longest_common_prefix(w[n+fibonacci(i):])) for i in range(5,20)] for n in range(1,1000)]\nCPU times: user 20.6 s, sys: 44 ms, total: 20.7 s\nWall time: 20.5 s\n\nsage: w = Words([0,1])(list(words.FibonacciWord()[:10000]))\nsage: %time L = [[len(w[n:].longest_common_prefix(w[n+fibonacci(i):])) for i in range(5,20)] for n in range(1,1000)]\nCPU times: user 7.99 s, sys: 56 ms, total: 8.04 s\nWall time: 7.93 s\n```\nand with the branch\n\n```\nsage: w = Words([0,1])(list(words.FibonacciWord()[:10000]))\nsage: %time L = [[len(w[n:].longest_common_prefix(w[n+fibonacci(i):])) for i in range(5,20)] for n in range(1,1000)]\nCPU times: user 172 ms, sys: 0 ns, total: 172 ms\nWall time: 168 ms\n```\n\nWe also implement `longest_common_suffix` and fix the following annoying feature of `has_prefix`\n\n```\nsage: W = Words([0,1,2])\nsage: w = W([0,1,0,2])\nsage: w.has_prefix(words.FibonacciWord())\nFalse\n```\n\nIssue created by migration from https://trac.sagemath.org/ticket/19322\n\n",
    "closed_at": "2015-10-12T22:52:51Z",
    "created_at": "2015-10-01T02:47:25Z",
    "labels": [
        "component: combinatorics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.9",
    "title": "a much faster longest_common_prefix for words",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19085",
    "user": "https://github.com/videlec"
}
```
CC:  @seblabbe

I had to do some computations of the following kind... which are damn slow

```
sage: w = words.FibonacciWord()[:10000]
sage: %time L = [[len(w[n:].longest_common_prefix(w[n+fibonacci(i):])) for i in range(5,20)] for n in range(1,1000)]
CPU times: user 20.6 s, sys: 44 ms, total: 20.7 s
Wall time: 20.5 s

sage: w = Words([0,1])(list(words.FibonacciWord()[:10000]))
sage: %time L = [[len(w[n:].longest_common_prefix(w[n+fibonacci(i):])) for i in range(5,20)] for n in range(1,1000)]
CPU times: user 7.99 s, sys: 56 ms, total: 8.04 s
Wall time: 7.93 s
```
and with the branch

```
sage: w = Words([0,1])(list(words.FibonacciWord()[:10000]))
sage: %time L = [[len(w[n:].longest_common_prefix(w[n+fibonacci(i):])) for i in range(5,20)] for n in range(1,1000)]
CPU times: user 172 ms, sys: 0 ns, total: 172 ms
Wall time: 168 ms
```

We also implement `longest_common_suffix` and fix the following annoying feature of `has_prefix`

```
sage: W = Words([0,1,2])
sage: w = W([0,1,0,2])
sage: w.has_prefix(words.FibonacciWord())
False
```

Issue created by migration from https://trac.sagemath.org/ticket/19322





---

archive/issue_comments_261602.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-10-01T02:49:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19085#issuecomment-261602",
    "user": "https://github.com/videlec"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_261603.json:
```json
{
    "body": "New commits:",
    "created_at": "2015-10-01T02:49:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19085#issuecomment-261603",
    "user": "https://github.com/videlec"
}
```

New commits:



---

archive/issue_comments_261604.json:
```json
{
    "body": "Hello Vincent,\n\nLooks good. A couple of remarks:\n\n1) You *can* use min/max in Cython code. Contrary to Python `:-P`\n\n2) longest_suffix/Python case: what about 'caching' `len(other)` instead of recomputing it at every test?\n\n3) longest prefix/Python case: the code generated by python for this 'slice' is scary. Isn't it possible to reimplement it without it? Plus if you need to import 'islice' it is maybe better to do so at module level, it's not thaaat bad either and it may happen that the prefix be one character long, in which case importing stuff could be comparatively more expensive (?).\n\n4) Have you considered returning a 'new word' (through new_c) even when that new word is equal to one of self and other? It would simplify the code, and I don't know if it matters as it does not allocate new memory anyway?\n\n5) I do not understand your 'not able to initialize a word from [..]'. The code does not try to initialize a word, does it? It's more something like \"unsupported type\"?..\n\nNathann",
    "created_at": "2015-10-02T08:03:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19085#issuecomment-261604",
    "user": "https://github.com/nathanncohen"
}
```

Hello Vincent,

Looks good. A couple of remarks:

1) You *can* use min/max in Cython code. Contrary to Python `:-P`

2) longest_suffix/Python case: what about 'caching' `len(other)` instead of recomputing it at every test?

3) longest prefix/Python case: the code generated by python for this 'slice' is scary. Isn't it possible to reimplement it without it? Plus if you need to import 'islice' it is maybe better to do so at module level, it's not thaaat bad either and it may happen that the prefix be one character long, in which case importing stuff could be comparatively more expensive (?).

4) Have you considered returning a 'new word' (through new_c) even when that new word is equal to one of self and other? It would simplify the code, and I don't know if it matters as it does not allocate new memory anyway?

5) I do not understand your 'not able to initialize a word from [..]'. The code does not try to initialize a word, does it? It's more something like "unsupported type"?..

Nathann



---

archive/issue_comments_261605.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-10-04T22:33:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19085#issuecomment-261605",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_261606.json:
```json
{
    "body": "Hello Nathann,\n\nI implemented your remarks excepted 4. It does allocate memory to call `_new_c`: the one you need for a Python object. But I don't know whether it is justified or not (ie the ratio between \"simple code\" versus \"efficient code\").\n\nVincent",
    "created_at": "2015-10-04T22:34:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19085#issuecomment-261606",
    "user": "https://github.com/videlec"
}
```

Hello Nathann,

I implemented your remarks excepted 4. It does allocate memory to call `_new_c`: the one you need for a Python object. But I don't know whether it is justified or not (ie the ratio between "simple code" versus "efficient code").

Vincent



---

archive/issue_comments_261607.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-10-05T07:17:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19085#issuecomment-261607",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_261608.json:
```json
{
    "body": "Yoooooooooo !\n\n> I implemented your remarks excepted 4. It does allocate memory to call `_new_c`: the one you need for a Python object. But I don't know whether it is justified or not (ie the ratio between \"simple code\" versus \"efficient code\").\n\n\nOkay okay, you decide, just felt like bringing it up when I reviewed this code.\n\nStamped, and good to go.\n\nNathann",
    "created_at": "2015-10-05T07:17:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19085#issuecomment-261608",
    "user": "https://github.com/nathanncohen"
}
```

Yoooooooooo !

> I implemented your remarks excepted 4. It does allocate memory to call `_new_c`: the one you need for a Python object. But I don't know whether it is justified or not (ie the ratio between "simple code" versus "efficient code").


Okay okay, you decide, just felt like bringing it up when I reviewed this code.

Stamped, and good to go.

Nathann



---

archive/issue_comments_261609.json:
```json
{
    "body": "Thanks!",
    "created_at": "2015-10-05T10:06:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19085#issuecomment-261609",
    "user": "https://github.com/videlec"
}
```

Thanks!



---

archive/issue_comments_261610.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-10-12T22:52:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19085#issuecomment-261610",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_053490.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-10-12T22:52:51Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/19085",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19085#event-53490"
}
```
