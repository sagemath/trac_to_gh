# Issue 12559: Stopgap for #11590

archive/issues_012559.json:
```json
{
    "body": "Assignee: @burcin\n\nCC:  @nbruin @orlitzky @kcrisman @pjbruin @rwst @paulmasson @mforets\n\nCan someone more knowledgeable about using maxima for integration determine what the right warning to show is and when to show it?  See #12691 for what a stopgap is.\n\nIssue created by migration from https://trac.sagemath.org/ticket/12731\n\n",
    "created_at": "2012-03-22T19:01:34Z",
    "labels": [
        "component: calculus",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.9",
    "title": "Stopgap for #11590",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12559",
    "user": "https://github.com/roed314"
}
```
Assignee: @burcin

CC:  @nbruin @orlitzky @kcrisman @pjbruin @rwst @paulmasson @mforets

Can someone more knowledgeable about using maxima for integration determine what the right warning to show is and when to show it?  See #12691 for what a stopgap is.

Issue created by migration from https://trac.sagemath.org/ticket/12731





---

archive/issue_comments_149029.json:
```json
{
    "body": "I'm not really sure that this is appropriate for a stopgap.  I mean, unless we put in a catch for the *specific* form like `integrate(x * sgn(x^2 - 1/4), x, -1, 0)`, we would have to put in a stopgap for the entire integration, which is ridiculous.  \n\nUnless we checked for the signum function with nonlinear operands in it sometime... but that's more than I have time to parse now.",
    "created_at": "2012-03-23T01:02:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12559#issuecomment-149029",
    "user": "https://github.com/kcrisman"
}
```

I'm not really sure that this is appropriate for a stopgap.  I mean, unless we put in a catch for the *specific* form like `integrate(x * sgn(x^2 - 1/4), x, -1, 0)`, we would have to put in a stopgap for the entire integration, which is ridiculous.  

Unless we checked for the signum function with nonlinear operands in it sometime... but that's more than I have time to parse now.



---

archive/issue_comments_149030.json:
```json
{
    "body": "Naturally, if it becomes unnecessary to do so, we can just close this as wontfix.  This is the best equivalent to a stopgap I can come up with - or possibly we can raise a warning every time `abs_integrate` is used, though this won't stop the hangs and other weird interactions it causes.",
    "created_at": "2014-12-08T15:02:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12559#issuecomment-149030",
    "user": "https://github.com/kcrisman"
}
```

Naturally, if it becomes unnecessary to do so, we can just close this as wontfix.  This is the best equivalent to a stopgap I can come up with - or possibly we can raise a warning every time `abs_integrate` is used, though this won't stop the hangs and other weird interactions it causes.



---

archive/issue_comments_149031.json:
```json
{
    "body": "Unfortunately, a lot of the most popular such integrals are not computed with sympy (yet?).  Not even `abs(x)`.\n\n```\nIn [1]: from sympy import *\n\nIn [2]: x=Symbol('x')\n\nIn [3]: integrate( abs(x), x)\nOut[3]: Integral(Abs(x), x)\n\nIn [4]: integrate( abs(x), (x, 0, 1))\nOut[4]: Integral(Abs(x), (x, 0, 1))\n```\n",
    "created_at": "2014-12-15T20:05:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12559#issuecomment-149031",
    "user": "https://github.com/kcrisman"
}
```

Unfortunately, a lot of the most popular such integrals are not computed with sympy (yet?).  Not even `abs(x)`.

```
In [1]: from sympy import *

In [2]: x=Symbol('x')

In [3]: integrate( abs(x), x)
Out[3]: Integral(Abs(x), x)

In [4]: integrate( abs(x), (x, 0, 1))
Out[4]: Integral(Abs(x), (x, 0, 1))
```




---

archive/issue_comments_149032.json:
```json
{
    "body": "Useful comment from author of `abs_integrate`:\n> The assignments extra_definite_integration_methods : [] and  extra_integration_methods  : [] should render abs_integrate inoperative.\n> Resorting these lists to their defaults will revive abs_integrate. A kill(all) will remove all traces of abs_integrate--a reload is needed.\n\nSo we could conceivably do this in the case that Maxima (or whomever) returns an unevaluated integral, sort of like what we do with solving.",
    "created_at": "2014-12-15T20:09:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12559#issuecomment-149032",
    "user": "https://github.com/kcrisman"
}
```

Useful comment from author of `abs_integrate`:
> The assignments extra_definite_integration_methods : [] and  extra_integration_methods  : [] should render abs_integrate inoperative.
> Resorting these lists to their defaults will revive abs_integrate. A kill(all) will remove all traces of abs_integrate--a reload is needed.

So we could conceivably do this in the case that Maxima (or whomever) returns an unevaluated integral, sort of like what we do with solving.



---

archive/issue_comments_149033.json:
```json
{
    "body": "could all developers involved in this ticket eventually meditate on Williams comment:\n>And why are we using it (abs_integrate) if it is so broken -- it should\n>require an explicit flag to use at all.  Sage is supposed to **default**\n>to correct answers unless you otherwise explicitly request otherwise\n\nDoes that sound reasonable?",
    "created_at": "2015-02-10T00:50:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12559#issuecomment-149033",
    "user": "https://trac.sagemath.org/admin/accounts/users/jakobkroeker"
}
```

could all developers involved in this ticket eventually meditate on Williams comment:
>And why are we using it (abs_integrate) if it is so broken -- it should
>require an explicit flag to use at all.  Sage is supposed to **default**
>to correct answers unless you otherwise explicitly request otherwise

Does that sound reasonable?



---

archive/issue_comments_149034.json:
```json
{
    "body": "Changing priority from major to critical.",
    "created_at": "2015-03-07T07:05:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12559#issuecomment-149034",
    "user": "https://github.com/rwst"
}
```

Changing priority from major to critical.



---

archive/issue_comments_149035.json:
```json
{
    "body": "Replying to [comment:12 jakobkroeker]:\n> \n> could all developers involved in this ticket eventually meditate on Williams comment:\n> >And why are we using it (abs_integrate) if it is so broken -- it should\n> >require an explicit flag to use at all.  Sage is supposed to **default**\n> >to correct answers unless you otherwise explicitly request otherwise\n> \n> Does that sound reasonable?\nYes, and it's the only option because that package causes so much collateral damage, not only in `integrate`. Turning it off only triggers a few minor doctest failures, most of them (9) in `interfaces/maxima_lib.py`.",
    "created_at": "2015-03-07T10:01:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12559#issuecomment-149035",
    "user": "https://github.com/rwst"
}
```

Replying to [comment:12 jakobkroeker]:
> 
> could all developers involved in this ticket eventually meditate on Williams comment:
> >And why are we using it (abs_integrate) if it is so broken -- it should
> >require an explicit flag to use at all.  Sage is supposed to **default**
> >to correct answers unless you otherwise explicitly request otherwise
> 
> Does that sound reasonable?
Yes, and it's the only option because that package causes so much collateral damage, not only in `integrate`. Turning it off only triggers a few minor doctest failures, most of them (9) in `interfaces/maxima_lib.py`.



---

archive/issue_comments_149036.json:
```json
{
    "body": "This commit removes the package, fixes/moves doctests. I have put those doctests testing the `abs_integrate` package into the wishlist #17910.\n\nIf someone is not comfortable doing this \"silently\", using expression tree walking I could add checks for `abs` and `sgn` and output ... what? Note, some integrals are now solved by Maxima proper.\n----\nNew commits:",
    "created_at": "2015-03-07T16:02:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12559#issuecomment-149036",
    "user": "https://github.com/rwst"
}
```

This commit removes the package, fixes/moves doctests. I have put those doctests testing the `abs_integrate` package into the wishlist #17910.

If someone is not comfortable doing this "silently", using expression tree walking I could add checks for `abs` and `sgn` and output ... what? Note, some integrals are now solved by Maxima proper.
----
New commits:



---

archive/issue_comments_149037.json:
```json
{
    "body": "Changing status from new to needs_info.",
    "created_at": "2015-03-07T16:03:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12559#issuecomment-149037",
    "user": "https://github.com/rwst"
}
```

Changing status from new to needs_info.



---

archive/issue_comments_149038.json:
```json
{
    "body": "I think anybody using a computer algebra package for symbolic integration should be aware that results returned might not be correct (or require a different interpretation from what the user would have preferred). However, from the reports listed it seems abs_integrate has particularly numerous issues. It's just not ready for prime time yet. I'd be in favour of ditching it.\n\nIncidentally, all those abs_integrate doctests (and the loading of many of the packages) should probably be in calculus. It's got little to do with the interface. Plus, it used to be as simple as changing the assignment to the maxima interface in the calculus file to swap between the library and the expect interface.",
    "created_at": "2015-03-07T16:38:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12559#issuecomment-149038",
    "user": "https://github.com/nbruin"
}
```

I think anybody using a computer algebra package for symbolic integration should be aware that results returned might not be correct (or require a different interpretation from what the user would have preferred). However, from the reports listed it seems abs_integrate has particularly numerous issues. It's just not ready for prime time yet. I'd be in favour of ditching it.

Incidentally, all those abs_integrate doctests (and the loading of many of the packages) should probably be in calculus. It's got little to do with the interface. Plus, it used to be as simple as changing the assignment to the maxima interface in the calculus file to swap between the library and the expect interface.



---

archive/issue_comments_149039.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2015-03-07T17:27:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12559#issuecomment-149039",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_149040.json:
```json
{
    "body": "I'm really concerned about removing this completely.  Even with all the errors, this also introduces a very useful tool, and it makes Sage look just as bad to be constantly changing what functionality it has.  This has been in long enough that some sort of deprecation seems necessary, though I'm not sure myself what either.\n\nSee comment:11 for a tip on how to disable/enable it selectively.  I have essentially had no Sage development time, nor am likely to in the near future, so I am unable to implement this now.  But I think that it would be far better to add some kind of flag or algorithm argument (like with `solve()`) so that people who want it can still get it.  Especially if it still added a stopgap warning.\n\nPerhaps one could do a walk for relevant input, as you say in comment:16, and suggest using the flag... *or* one could check for that input and then send the stopgap message?\n\nAgain, I'm really sorry I'm unable to help concretely with code at this time (hopefully a little testing).",
    "created_at": "2015-03-07T23:42:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12559#issuecomment-149040",
    "user": "https://github.com/kcrisman"
}
```

I'm really concerned about removing this completely.  Even with all the errors, this also introduces a very useful tool, and it makes Sage look just as bad to be constantly changing what functionality it has.  This has been in long enough that some sort of deprecation seems necessary, though I'm not sure myself what either.

See comment:11 for a tip on how to disable/enable it selectively.  I have essentially had no Sage development time, nor am likely to in the near future, so I am unable to implement this now.  But I think that it would be far better to add some kind of flag or algorithm argument (like with `solve()`) so that people who want it can still get it.  Especially if it still added a stopgap warning.

Perhaps one could do a walk for relevant input, as you say in comment:16, and suggest using the flag... *or* one could check for that input and then send the stopgap message?

Again, I'm really sorry I'm unable to help concretely with code at this time (hopefully a little testing).



---

archive/issue_comments_149041.json:
```json
{
    "body": "So how do you address the fact that, once the package is used, it has destructive side effects on computations, even if you no longer use it and do completely different things. How will you know that an unrelated bug report is not caused by this? What language do you use to prepare the user that, from now on, there might be more problems ahead?",
    "created_at": "2015-03-08T06:47:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12559#issuecomment-149041",
    "user": "https://github.com/rwst"
}
```

So how do you address the fact that, once the package is used, it has destructive side effects on computations, even if you no longer use it and do completely different things. How will you know that an unrelated bug report is not caused by this? What language do you use to prepare the user that, from now on, there might be more problems ahead?



---

archive/issue_comments_149042.json:
```json
{
    "body": "> I'm really concerned about removing this completely.\n\nwhat is about a kind of  experimental mode in sage ?\nif enabled by the user, functions like above became available, otherwise they stay out.\n\nPersonally, I'm against accepting broken or half-baked functionality because as rws says, it is too destructive. I'm experiencing this everyday with Singular CAS. People start using new functionality (which is often only experimental ) and then  **almost everything** is broken and cannot be easily fixed. Tests? Ahahaha !! Mathematicians often consider a single  example or a couple of examples as as sufficient test...",
    "created_at": "2015-03-08T12:06:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12559#issuecomment-149042",
    "user": "https://trac.sagemath.org/admin/accounts/users/jakobkroeker"
}
```

> I'm really concerned about removing this completely.

what is about a kind of  experimental mode in sage ?
if enabled by the user, functions like above became available, otherwise they stay out.

Personally, I'm against accepting broken or half-baked functionality because as rws says, it is too destructive. I'm experiencing this everyday with Singular CAS. People start using new functionality (which is often only experimental ) and then  **almost everything** is broken and cannot be easily fixed. Tests? Ahahaha !! Mathematicians often consider a single  example or a couple of examples as as sufficient test...



---

archive/issue_comments_149043.json:
```json
{
    "body": "Replying to [comment:21 rws]:\n> So how do you address the fact that, once the package is used, it has destructive side effects on computations, even if you no longer use it and do completely different things. How will you know that an unrelated bug report is not caused by this? What language do you use to prepare the user that, from now on, there might be more problems ahead?\n\nI would rather disable this than have it give wrong answers, but it looks like it should be possible to emit a warning only when abs_integrate is actually used. According to the [Maxima documentation](http://maxima.sourceforge.net/docs/manual/de/maxima_31.html#SEC218), there is a list of extra integration methods that maxima will attempt if the standard `integrate` fails:\n\n\n```\nOption variable: extra_integration_methods\n\n    Default value: ['signum_int, 'abs_integrate_use_if]\n\n    The list extra_integration_methods is a list of functions for integration. When integrate is unable to find an antiderivative, Maxima uses the methods in extra_integration_methods to attempt to determine an antiderivative. \n```\n\n\nIf we set this variable to the empty list, then no additional integrations will be attempted by Maxima (by default). But, we can still try them ourselves. So we could,\n\n1. Try the standard Maxima `integrate`, and save the result.\n2. Try `signum_int`, and see if the result matches the first one. If it does, ignore it. Otherwise, emit a warning and return the answer.\n3. Try `abs_integrate_use_if`, and see if the result matches the first one. If it does, ignore it. Otherwise, emit a warning and return the answer.",
    "created_at": "2015-03-08T18:53:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12559#issuecomment-149043",
    "user": "https://github.com/orlitzky"
}
```

Replying to [comment:21 rws]:
> So how do you address the fact that, once the package is used, it has destructive side effects on computations, even if you no longer use it and do completely different things. How will you know that an unrelated bug report is not caused by this? What language do you use to prepare the user that, from now on, there might be more problems ahead?

I would rather disable this than have it give wrong answers, but it looks like it should be possible to emit a warning only when abs_integrate is actually used. According to the [Maxima documentation](http://maxima.sourceforge.net/docs/manual/de/maxima_31.html#SEC218), there is a list of extra integration methods that maxima will attempt if the standard `integrate` fails:


```
Option variable: extra_integration_methods

    Default value: ['signum_int, 'abs_integrate_use_if]

    The list extra_integration_methods is a list of functions for integration. When integrate is unable to find an antiderivative, Maxima uses the methods in extra_integration_methods to attempt to determine an antiderivative. 
```


If we set this variable to the empty list, then no additional integrations will be attempted by Maxima (by default). But, we can still try them ourselves. So we could,

1. Try the standard Maxima `integrate`, and save the result.
2. Try `signum_int`, and see if the result matches the first one. If it does, ignore it. Otherwise, emit a warning and return the answer.
3. Try `abs_integrate_use_if`, and see if the result matches the first one. If it does, ignore it. Otherwise, emit a warning and return the answer.



---

archive/issue_comments_149044.json:
```json
{
    "body": "Replying to [comment:23 mjo]: \n> 1. Try the standard Maxima `integrate`, and save the result.\n> 2. Try `signum_int`, and see if the result matches the first one. If it does, ignore it. Otherwise, emit a warning and return the answer.\n> 3. Try `abs_integrate_use_if`, and see if the result matches the first one. If it does, ignore it. Otherwise, emit a warning and return the answer.\n\n\nOh, and if `integrate` works, we can skip steps 2 and 3.",
    "created_at": "2015-03-08T19:09:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12559#issuecomment-149044",
    "user": "https://github.com/orlitzky"
}
```

Replying to [comment:23 mjo]: 
> 1. Try the standard Maxima `integrate`, and save the result.
> 2. Try `signum_int`, and see if the result matches the first one. If it does, ignore it. Otherwise, emit a warning and return the answer.
> 3. Try `abs_integrate_use_if`, and see if the result matches the first one. If it does, ignore it. Otherwise, emit a warning and return the answer.


Oh, and if `integrate` works, we can skip steps 2 and 3.



---

archive/issue_comments_149045.json:
```json
{
    "body": "Replying to [comment:23 mjo]:\n> If we set this variable to the empty list, then no additional integrations will be attempted by Maxima (by default). But, we can still try them ourselves. So we could,\n> \n> 1. Try the standard Maxima `integrate`, and save the result.\n> 2. Try `signum_int`, and see if the result matches the first one. If it does, ignore it. Otherwise, emit a warning and return the answer.\n> 3. Try `abs_integrate_use_if`, and see if the result matches the first one. If it does, ignore it. Otherwise, emit a warning and return the answer.\n\nThat's an excellent find and it allows us to have much finer grained control over what integration methods should be tried. However, I'm not so sure that \"printing a warning\" is the right solution. There's a problem with stopgap messages in general:\n- they just get printed. They can easily get lost if a lot of other output gets printed.\n- they only get printed once. We're dealing here with an issue that only applies to certain integrals. We assume you're OK as long as the message is printed. When you run into the message, then the result you're looking at at that moment is suspect. After that one, the message doesn't get printed anymore, so you should consider all subsequent results suspect. However, since the behaviour is much more similar to the pre-message situation, it's easy to think that fresh computations in the same session are NOT suspect.\n\nI think it is better to simply NOT try the suspect integration methods upon a normal integral invocation and only resort to them when a special command/flag is given, e.g.:\n\n```\nsage: integrate(abs(sin(x)),x,0,pi)\nintegrate(abs(sin(x)), x, 0, pi)\nsage: integrate(abs(sin(x)),x,0,pi, algorithm=\"spaced_out_maxima\")\n0\n```\n\nor whatever access method we want to use (and whatever result we get from that).\n\nIn any case, we also need to clear `extra_definite_integration_methods`.",
    "created_at": "2015-03-09T01:54:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12559#issuecomment-149045",
    "user": "https://github.com/nbruin"
}
```

Replying to [comment:23 mjo]:
> If we set this variable to the empty list, then no additional integrations will be attempted by Maxima (by default). But, we can still try them ourselves. So we could,
> 
> 1. Try the standard Maxima `integrate`, and save the result.
> 2. Try `signum_int`, and see if the result matches the first one. If it does, ignore it. Otherwise, emit a warning and return the answer.
> 3. Try `abs_integrate_use_if`, and see if the result matches the first one. If it does, ignore it. Otherwise, emit a warning and return the answer.

That's an excellent find and it allows us to have much finer grained control over what integration methods should be tried. However, I'm not so sure that "printing a warning" is the right solution. There's a problem with stopgap messages in general:
- they just get printed. They can easily get lost if a lot of other output gets printed.
- they only get printed once. We're dealing here with an issue that only applies to certain integrals. We assume you're OK as long as the message is printed. When you run into the message, then the result you're looking at at that moment is suspect. After that one, the message doesn't get printed anymore, so you should consider all subsequent results suspect. However, since the behaviour is much more similar to the pre-message situation, it's easy to think that fresh computations in the same session are NOT suspect.

I think it is better to simply NOT try the suspect integration methods upon a normal integral invocation and only resort to them when a special command/flag is given, e.g.:

```
sage: integrate(abs(sin(x)),x,0,pi)
integrate(abs(sin(x)), x, 0, pi)
sage: integrate(abs(sin(x)),x,0,pi, algorithm="spaced_out_maxima")
0
```

or whatever access method we want to use (and whatever result we get from that).

In any case, we also need to clear `extra_definite_integration_methods`.



---

archive/issue_comments_149046.json:
```json
{
    "body": "> > If we set this variable to the empty list, then no additional integrations will be attempted by Maxima (by default). But, we can still try them ourselves. So we could,\n> > \n> > 1. Try the standard Maxima `integrate`, and save the result.\n> > 2. Try `signum_int`, and see if the result matches the first one. If it does, ignore it. Otherwise, emit a warning and return the answer.\n> > 3. Try `abs_integrate_use_if`, and see if the result matches the first one. If it does, ignore it. Otherwise, emit a warning and return the answer.\n> \n> That's an excellent find and it allows us to have much finer grained control over what integration methods should be tried. However, I'm not so sure that \"printing a warning\" is the right solution. There's a problem with stopgap messages in general:\n>  - they just get printed. They can easily get lost if a lot of other output gets printed.\n>  - they only get printed once. We're dealing here with an issue that only applies to certain integrals. We assume you're OK as long as the message is printed. When you run into the message, then the result you're looking at at that moment is suspect. After that one, the message doesn't get printed anymore, so you should consider all subsequent results suspect. However, since the behaviour is much more similar to the pre-message situation, it's easy to think that fresh computations in the same session are NOT suspect.\n> \n> I think it is better to simply NOT try the suspect integration methods upon a normal integral invocation and only resort to them when a special command/flag is given, e.g.:\n> {{{\n> sage: integrate(abs(sin(x)),x,0,pi)\n> integrate(abs(sin(x)), x, 0, pi)\n> sage: integrate(abs(sin(x)),x,0,pi, algorithm=\"spaced_out_maxima\")\n> 0\n> }}}\n> or whatever access method we want to use (and whatever result we get from that).\n\n+1",
    "created_at": "2015-03-09T23:19:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12559#issuecomment-149046",
    "user": "https://github.com/kcrisman"
}
```

> > If we set this variable to the empty list, then no additional integrations will be attempted by Maxima (by default). But, we can still try them ourselves. So we could,
> > 
> > 1. Try the standard Maxima `integrate`, and save the result.
> > 2. Try `signum_int`, and see if the result matches the first one. If it does, ignore it. Otherwise, emit a warning and return the answer.
> > 3. Try `abs_integrate_use_if`, and see if the result matches the first one. If it does, ignore it. Otherwise, emit a warning and return the answer.
> 
> That's an excellent find and it allows us to have much finer grained control over what integration methods should be tried. However, I'm not so sure that "printing a warning" is the right solution. There's a problem with stopgap messages in general:
>  - they just get printed. They can easily get lost if a lot of other output gets printed.
>  - they only get printed once. We're dealing here with an issue that only applies to certain integrals. We assume you're OK as long as the message is printed. When you run into the message, then the result you're looking at at that moment is suspect. After that one, the message doesn't get printed anymore, so you should consider all subsequent results suspect. However, since the behaviour is much more similar to the pre-message situation, it's easy to think that fresh computations in the same session are NOT suspect.
> 
> I think it is better to simply NOT try the suspect integration methods upon a normal integral invocation and only resort to them when a special command/flag is given, e.g.:
> {{{
> sage: integrate(abs(sin(x)),x,0,pi)
> integrate(abs(sin(x)), x, 0, pi)
> sage: integrate(abs(sin(x)),x,0,pi, algorithm="spaced_out_maxima")
> 0
> }}}
> or whatever access method we want to use (and whatever result we get from that).

+1



---

archive/issue_comments_149047.json:
```json
{
    "body": "Is that ticket really needs_review ? The last comments point to a needs_work.\n\nAnd notice that a needs_review ticket with no author won't suit Volker :-P",
    "created_at": "2015-03-15T20:37:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12559#issuecomment-149047",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

Is that ticket really needs_review ? The last comments point to a needs_work.

And notice that a needs_review ticket with no author won't suit Volker :-P



---

archive/issue_comments_149048.json:
```json
{
    "body": "One failing doctest:\n\n```\nFile \"src/sage/functions/piecewise.py\", line 811, in sage.functions.piecewise.PiecewisePolynomial.integral\nFailed example:\n    f.integral()\nExpected:\n    Piecewise defined function with 1 parts, [[(-Infinity, +Infinity), x |--> -1/2*((sgn(x) - 1)*e^(2*x) - 2*e^x*sgn(x) + sgn(x) + 1)*e^(-x) - 1]]\nGot:\n    Piecewise defined function with 1 parts, [[(-Infinity, +Infinity), x |--> -integrate(e^(-abs(x)), x, x, +Infinity)]]\n```\n",
    "created_at": "2015-03-24T20:30:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12559#issuecomment-149048",
    "user": "https://github.com/fchapoton"
}
```

One failing doctest:

```
File "src/sage/functions/piecewise.py", line 811, in sage.functions.piecewise.PiecewisePolynomial.integral
Failed example:
    f.integral()
Expected:
    Piecewise defined function with 1 parts, [[(-Infinity, +Infinity), x |--> -1/2*((sgn(x) - 1)*e^(2*x) - 2*e^x*sgn(x) + sgn(x) + 1)*e^(-x) - 1]]
Got:
    Piecewise defined function with 1 parts, [[(-Infinity, +Infinity), x |--> -integrate(e^(-abs(x)), x, x, +Infinity)]]
```




---

archive/issue_comments_149049.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-03-24T20:30:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12559#issuecomment-149049",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_149050.json:
```json
{
    "body": "Related?  [This question.](http://ask.sagemath.org/question/26516/wrong-answer-for-integral/)",
    "created_at": "2015-04-13T18:39:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12559#issuecomment-149050",
    "user": "https://github.com/kcrisman"
}
```

Related?  [This question.](http://ask.sagemath.org/question/26516/wrong-answer-for-integral/)



---

archive/issue_comments_149051.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-06-17T15:17:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12559#issuecomment-149051",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_149052.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-06-17T15:18:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12559#issuecomment-149052",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_149053.json:
```json
{
    "body": "Replying to [comment:26 kcrisman]:\n> > > If we set this variable to the empty list, then no additional integrations will be attempted by Maxima (by default). But, we can still try them ourselves. So we could,\n> > > \n> > > 1. Try the standard Maxima `integrate`, and save the result.\n> > > 2. Try `signum_int`, and see if the result matches the first one. If it does, ignore it. Otherwise, emit a warning and return the answer.\n> > > 3. Try `abs_integrate_use_if`, and see if the result matches the first one. If it does, ignore it. Otherwise, emit a warning and return the answer.\n\nIt won't, because it will always return something like this:\n\n```\nsage: integrate(1/(1 + abs(x+1) + abs(x-1)),x)\nTypeError: unable to make sense of Maxima expression 'if(-(_SAGE_VAR_x+1)>0,-log(1-2*_SAGE_VAR_x)/2+log(3)-2/3,if(-(_SAGE_VAR_x-1)>0,_SAGE_VAR_x/3+log(3)/2-1/3,log(2*_SAGE_VAR_x+1)/2))' in Sage\n```\n\n\n> > I think it is better to simply NOT try the suspect integration methods upon a normal integral invocation and only resort to them when a special command/flag is given, e.g.:\n> > {{{\n> > sage: integrate(abs(sin(x)),x,0,pi)\n> > integrate(abs(sin(x)), x, 0, pi)\n> > sage: integrate(abs(sin(x)),x,0,pi, algorithm=\"spaced_out_maxima\")\n> > 0\n> > }}}\n> > or whatever access method we want to use (and whatever result we get from that).\n> \n> +1\n\nI would be in favor of this, and would give positive review to changes disabling by default but allowing this.  I think it would be pretty easy to implement, in fact.\n* Keep `abs_integrate` loading initially in `maxima_lib.py`.\n* Immediately set the two `methods` to `[]`, perhaps right with `init_code.append('nolabels : true')` a few lines later.\n* Then add an integrator in `src/sage/symbolic/integration/external.py`, something like\n\n```\ndef maxima_absint_integrator(expression, v, a=None, b=None):\n    from sage.calculus.calculus import maxima\n    maxima.eval(\"extra_definite_integration_methods=['abs_defint]\")\n    maxima.eval(\"extra_integration_methods=['signum_int]\") # NOT using the if variant\n    if not isinstance(expression, Expression):\n        expression = SR(expression)\n    if a is None:\n        result = maxima.sr_integral(expression,v)\n    else:\n        result = maxima.sr_integral(expression, v, a, b)\n    maxima.eval(\"extra_definite_integration_methods=[]\")\n    maxima.eval(\"extra_integration_methods=[]\") # NOT using the if variant\n    return result._sage_()\n```\n\n* Then in `src/sage/symbolic/integration/integral.py` just add\n\n```\nimport sage.symbolic.integration.external as external\navailable_integrators['maxima'] = external.maxima_integrator\navailable_integrators['maxima_absint'] = external.maxima_absint_integrator\navailable_integrators['sympy'] = external.sympy_integrator\navailable_integrators['mathematica_free'] = external.mma_free_integrator\navailable_integrators['fricas'] = external.fricas_integrator\n```\n\n  and port doctests, with a humongous warning not to use this unless you are willing to check answers numerically or something.\n\nThat could, in principle, be a separate ticket, but I would want them to depend upon each other.  Also, that wouldn't remove the necessity of #17910.\n\nBy the way, it's interesting that http://sourceforge.net/p/maxima/bugs/2242/#8ddc suggests that adding `'integrate` to the methods lists could actually do at least some of these integrals...",
    "created_at": "2015-06-17T15:48:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12559#issuecomment-149053",
    "user": "https://github.com/kcrisman"
}
```

Replying to [comment:26 kcrisman]:
> > > If we set this variable to the empty list, then no additional integrations will be attempted by Maxima (by default). But, we can still try them ourselves. So we could,
> > > 
> > > 1. Try the standard Maxima `integrate`, and save the result.
> > > 2. Try `signum_int`, and see if the result matches the first one. If it does, ignore it. Otherwise, emit a warning and return the answer.
> > > 3. Try `abs_integrate_use_if`, and see if the result matches the first one. If it does, ignore it. Otherwise, emit a warning and return the answer.

It won't, because it will always return something like this:

```
sage: integrate(1/(1 + abs(x+1) + abs(x-1)),x)
TypeError: unable to make sense of Maxima expression 'if(-(_SAGE_VAR_x+1)>0,-log(1-2*_SAGE_VAR_x)/2+log(3)-2/3,if(-(_SAGE_VAR_x-1)>0,_SAGE_VAR_x/3+log(3)/2-1/3,log(2*_SAGE_VAR_x+1)/2))' in Sage
```


> > I think it is better to simply NOT try the suspect integration methods upon a normal integral invocation and only resort to them when a special command/flag is given, e.g.:
> > {{{
> > sage: integrate(abs(sin(x)),x,0,pi)
> > integrate(abs(sin(x)), x, 0, pi)
> > sage: integrate(abs(sin(x)),x,0,pi, algorithm="spaced_out_maxima")
> > 0
> > }}}
> > or whatever access method we want to use (and whatever result we get from that).
> 
> +1

I would be in favor of this, and would give positive review to changes disabling by default but allowing this.  I think it would be pretty easy to implement, in fact.
* Keep `abs_integrate` loading initially in `maxima_lib.py`.
* Immediately set the two `methods` to `[]`, perhaps right with `init_code.append('nolabels : true')` a few lines later.
* Then add an integrator in `src/sage/symbolic/integration/external.py`, something like

```
def maxima_absint_integrator(expression, v, a=None, b=None):
    from sage.calculus.calculus import maxima
    maxima.eval("extra_definite_integration_methods=['abs_defint]")
    maxima.eval("extra_integration_methods=['signum_int]") # NOT using the if variant
    if not isinstance(expression, Expression):
        expression = SR(expression)
    if a is None:
        result = maxima.sr_integral(expression,v)
    else:
        result = maxima.sr_integral(expression, v, a, b)
    maxima.eval("extra_definite_integration_methods=[]")
    maxima.eval("extra_integration_methods=[]") # NOT using the if variant
    return result._sage_()
```

* Then in `src/sage/symbolic/integration/integral.py` just add

```
import sage.symbolic.integration.external as external
available_integrators['maxima'] = external.maxima_integrator
available_integrators['maxima_absint'] = external.maxima_absint_integrator
available_integrators['sympy'] = external.sympy_integrator
available_integrators['mathematica_free'] = external.mma_free_integrator
available_integrators['fricas'] = external.fricas_integrator
```

  and port doctests, with a humongous warning not to use this unless you are willing to check answers numerically or something.

That could, in principle, be a separate ticket, but I would want them to depend upon each other.  Also, that wouldn't remove the necessity of #17910.

By the way, it's interesting that http://sourceforge.net/p/maxima/bugs/2242/#8ddc suggests that adding `'integrate` to the methods lists could actually do at least some of these integrals...



---

archive/issue_comments_149054.json:
```json
{
    "body": "Never *remove* doctests, mark them as `# known bug (Trac #17910)`.",
    "created_at": "2015-06-17T16:57:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12559#issuecomment-149054",
    "user": "https://github.com/jdemeyer"
}
```

Never *remove* doctests, mark them as `# known bug (Trac #17910)`.



---

archive/issue_comments_149055.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-06-17T16:57:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12559#issuecomment-149055",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_149056.json:
```json
{
    "body": "New commits:",
    "created_at": "2019-04-24T19:23:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12559#issuecomment-149056",
    "user": "https://github.com/fchapoton"
}
```

New commits:



---

archive/issue_comments_149057.json:
```json
{
    "body": "my merge was incorrect, so undone",
    "created_at": "2019-04-24T19:32:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12559#issuecomment-149057",
    "user": "https://github.com/fchapoton"
}
```

my merge was incorrect, so undone



---

archive/issue_comments_149058.json:
```json
{
    "body": "Changing keywords from \"\" to \"abs_integrate\".",
    "created_at": "2019-05-17T17:52:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12559#issuecomment-149058",
    "user": "https://github.com/fchapoton"
}
```

Changing keywords from "" to "abs_integrate".



---

archive/issue_comments_149059.json:
```json
{
    "body": "Here is a fresh new branch\n----\nNew commits:",
    "created_at": "2019-05-17T18:29:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12559#issuecomment-149059",
    "user": "https://github.com/fchapoton"
}
```

Here is a fresh new branch
----
New commits:



---

archive/issue_comments_149060.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-05-17T18:29:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12559#issuecomment-149060",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_149061.json:
```json
{
    "body": "Thanks - I wish there was a better fix than disabling.   Can you briefly comment on \n* The removal of the radexpand example\n* the `known bug` ones\nI'm sure they are quite logical but a quick glance fails to reveal it, as opposed to where you put the unevaluated integral in to replace the `abs_integrate` behavior.\n\nOr maybe this was already present behavior and you really did just refresh this, in which case no worries.  It seems like comment:33 was the last substantive part of the discussion and memory fails.",
    "created_at": "2019-05-17T19:06:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12559#issuecomment-149061",
    "user": "https://github.com/kcrisman"
}
```

Thanks - I wish there was a better fix than disabling.   Can you briefly comment on 
* The removal of the radexpand example
* the `known bug` ones
I'm sure they are quite logical but a quick glance fails to reveal it, as opposed to where you put the unevaluated integral in to replace the `abs_integrate` behavior.

Or maybe this was already present behavior and you really did just refresh this, in which case no worries.  It seems like comment:33 was the last substantive part of the discussion and memory fails.



---

archive/issue_comments_149062.json:
```json
{
    "body": "Tagging by `known bug` allows to remember that one could hope for the answer displayed. I think Jeroen suggested to keep the doctest in this way, rather than remove them.\n\nAnd the `radexpand` example no longer works without `abs_integrate`, just returning unevaluated.",
    "created_at": "2019-05-17T19:50:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12559#issuecomment-149062",
    "user": "https://github.com/fchapoton"
}
```

Tagging by `known bug` allows to remember that one could hope for the answer displayed. I think Jeroen suggested to keep the doctest in this way, rather than remove them.

And the `radexpand` example no longer works without `abs_integrate`, just returning unevaluated.



---

archive/issue_comments_149063.json:
```json
{
    "body": "bot is morally green, please review",
    "created_at": "2019-05-18T13:39:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12559#issuecomment-149063",
    "user": "https://github.com/fchapoton"
}
```

bot is morally green, please review



---

archive/issue_comments_149064.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-05-22T08:21:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12559#issuecomment-149064",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_149065.json:
```json
{
    "body": "looks good to me. Please add yourself as authors/reviewers...",
    "created_at": "2019-05-22T08:21:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12559#issuecomment-149065",
    "user": "https://github.com/dimpase"
}
```

looks good to me. Please add yourself as authors/reviewers...



---

archive/issue_events_012535.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-05-24T18:29:59Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/12559",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12559#event-12535"
}
```



---

archive/issue_comments_149066.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-05-24T18:29:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12559#issuecomment-149066",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_149067.json:
```json
{
    "body": "At least according to github, the following stuff in `sage/maxima_lib.py` was not removed (probably because it still passes doctests as Maxima proper improved in the meantime):\n\n```\n        Make sure the abs_integrate package is being used,\n        :trac:`11483`. The following are examples from the Maxima\n        abs_integrate documentation::\n            sage: integrate(abs(x), x)\n            1/2*x*abs(x)\n```\n",
    "created_at": "2019-06-28T01:05:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12559#issuecomment-149067",
    "user": "https://github.com/kcrisman"
}
```

At least according to github, the following stuff in `sage/maxima_lib.py` was not removed (probably because it still passes doctests as Maxima proper improved in the meantime):

```
        Make sure the abs_integrate package is being used,
        :trac:`11483`. The following are examples from the Maxima
        abs_integrate documentation::
            sage: integrate(abs(x), x)
            1/2*x*abs(x)
```




---

archive/issue_comments_149068.json:
```json
{
    "body": "Not in Sage 8.8.  Let's please to try keep tickets' milestones related to the release in which we actually intend to include them, and in particular the release in which they were *actually* included, especially when closing tickets.",
    "created_at": "2019-07-03T11:34:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12559#issuecomment-149068",
    "user": "https://github.com/embray"
}
```

Not in Sage 8.8.  Let's please to try keep tickets' milestones related to the release in which we actually intend to include them, and in particular the release in which they were *actually* included, especially when closing tickets.
