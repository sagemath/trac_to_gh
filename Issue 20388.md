# Issue 20388: PyPI updates

Issue created by migration from https://trac.sagemath.org/ticket/20625

Original creator: vbraun

Original creation time: 2016-05-18 21:23:46

CC:  fbissey




---

Comment by vbraun created at 2016-05-18 21:26:36

New commits:


---

Comment by fbissey created at 2016-05-18 21:38:29

Weird bunch I just updated my sage-on-gentoo install to newer `notebook` and `nbconvert` than in sage. `ipywidgets` was just upped to 5.1.3 there and it pulled a new dependency `widgetsnbextension`, do you see it as being only optional?


---

Comment by vbraun created at 2016-05-19 07:17:35

Breaks sagenb with `RuntimeError: working outside of application context`

```
sage -t --long local/lib/python2.7/site-packages/sagenb/notebook/cell.py  # 2 doctests failed
sage -t --long local/lib/python2.7/site-packages/sagenb/notebook/worksheet.py  # 2 doctests failed
sage -t --long local/lib/python2.7/site-packages/sagenb/notebook/notebook.py  # 8 doctests failed
sage -t --long local/lib/python2.7/site-packages/sagenb/notebook/challenge.py  # 13 doctests failed
sage -t --long local/lib/python2.7/site-packages/sagenb/notebook/template.py  # 4 doctests failed
```



---

Comment by fbissey created at 2016-05-19 07:25:24

`werkzeug`, and `flask_*` are only used by `sagenb`, `twisted` too probably. In this particular case I am ok to let them rot a bit until we remove `sagenb` and remove them too.


---

Comment by git created at 2016-05-19 07:26:50

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vbraun created at 2016-05-19 07:27:23

Leaving out the apparently problematic flask_babel update, now tests pass


---

Comment by vbraun created at 2016-05-19 07:27:23

Changing status from new to needs_review.


---

Comment by vbraun created at 2016-05-19 07:29:12

I opened #20627 for flask-babel


---

Comment by fbissey created at 2016-05-19 07:39:18

Changing status from needs_review to positive_review.


---

Comment by fbissey created at 2016-05-19 07:39:18

OK, let's go with it. I'll have a look at `flask_babel`.


---

Comment by jdemeyer created at 2016-05-19 11:58:37

Replying to [comment:3 fbissey]:
> Weird bunch I just updated my sage-on-gentoo install to newer `notebook` and `nbconvert` than in sage. `ipywidgets` was just upped to 5.1.3 there and it pulled a new dependency `widgetsnbextension`, do you see it as being only optional? 

Good point.


---

Comment by jdemeyer created at 2016-05-19 11:58:37

Changing status from positive_review to needs_info.


---

Comment by jdemeyer created at 2016-05-19 12:01:13

I don't like these mindless mass-upgrade tickets since it gives a false impression that we can just upgrade without thinking about the consequences.

Especially for Jupyter-related packages, we really need to actually run Jupyter and check that stuff still works. It's not clear whether the author and/or reviewer of this ticket did that. Doctests are not sufficient for this.


---

Comment by fbissey created at 2016-05-19 23:02:10

Touch√© !

Last time I didn't insist on a dependency we had to add it later. 

Volker works on the assumptions that I may have add contact with most of those in sage-on-gentoo. Which used to be the case but since Volker has accelerated the rate it's a mixed bag.

We are now in a situation where Volker has just merged `ipython-4.2.0` and I don't have it. On the other hand I have `notebook` and `nbconvert` 4.2.0 and it is nowhere to be seen here.

As to `flask_babel` it has been in portage since the 11th of May but no user on ~arch complained about the problem Volker sees (may be not enough people running the doctests on ~arch).

To go back to properly testing `jupyter` do you have something in mind? A set of notebooks that would have to be tested or something?


---

Comment by vbraun created at 2016-05-19 23:06:08

Dependency checking is broken in ipywidgets, I opened https://github.com/ipython/ipywidgets/issues/597


---

Comment by vbraun created at 2016-05-19 23:07:56

IMHO if we need E2E testing for jupyter then we should have automated testing for it. Delaying package updates until some nebulous manual incantations are performed is not a sane workflow.


---

Comment by jdemeyer created at 2016-05-20 07:44:33

A good start would be actually running the testsuites of those Python packages. Related: #19680.

In any case, as long as we do not have automated testing, those "nebulous manual incantations" will need to be performed.


---

Comment by vbraun created at 2016-05-20 13:28:46

Upstream says that its not a bug that they don't check dependencies....


---

Comment by git created at 2016-05-21 09:56:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vbraun created at 2016-05-21 09:58:36

Changing status from needs_info to needs_review.


---

Comment by vbraun created at 2016-05-21 09:58:36

I tired a jupyter widget and it works.


---

Comment by fbissey created at 2016-05-21 10:13:28

Changing status from needs_review to positive_review.


---

Comment by fbissey created at 2016-05-21 10:13:28

ok, let's move this again and then work on #19680 and any other stuff needed for testing.


---

Comment by vbraun created at 2016-05-21 12:31:46

Apparently races against setuptools installation

```
IOError: zipimport: can not open file /home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/setuptools-20.3.1-py2.7.egg

real	0m0.182s
user	0m0.080s
sys	0m0.080s
************************************************************************
Error installing package widgetsnbextension-1.2.2
```



---

Comment by git created at 2016-05-21 12:33:56

Changing status from positive_review to needs_review.


---

Comment by git created at 2016-05-21 12:33:56

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:


---

Comment by vbraun created at 2016-05-21 16:40:26

Resolution: fixed


---

Comment by jdemeyer created at 2016-08-16 09:25:03

This broke `ipywidgets`, see #21256.
