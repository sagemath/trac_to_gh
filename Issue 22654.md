# Issue 22654: Add giac interface to integrate

Issue created by migration from https://trac.sagemath.org/ticket/22891

Original creator: mforets

Original creation time: 2017-04-27 17:46:58

Keywords: giac, integrate, symbolics

Provide a `giac_integrator` function, which relies on the external (but standard) Giac package.  

A test could be:


```
sage: integrate(abs(cos(x)), x, 0, 2*pi, algorithm='giac')
4
```

This test is chosen because (at the time or writing) Maxima gives a wrong result (`0`), SymPy gives i don't know (unevaluated), and Fricas (optional package) gives `'failed'`.


---

Comment by mforets created at 2017-04-27 17:49:41

(minor, documentation): in `symbolic/integration/integral.py`, the word `EXAMPLES` appears two times, first in the usual place, then just after the `ALIASES`. this is a bit strange. shall we remove the second one?


---

Comment by mforets created at 2017-04-27 18:04:23

Changing status from new to needs_review.


---

Comment by mforets created at 2017-04-27 18:04:23

setting to review; i've added the new optional keyword `algorithm='giac'`, and for the moment i wouldn't know if there is something else that needs to be done with respect to this ticket! feedback welcome 
----
New commits:


---

Comment by kcrisman created at 2017-04-27 18:15:58

Love this.  Don't see any obvious problems with the commit (I haven't tested it, though, just reading through).

On a related note, can you test out the various tickets at https://trac.sagemath.org/wiki/symbolics#Integrationtickets with this?  In particular the `abs_integrate` ones, see e.g. #12731.  If the integrator here is powerful enough, it might be time to replace the Maxima integrator with this one; the Maxima one has many errors (though in my opinion is still way better than not having one, as most of those are on relatively "interesting" functions like your example, abs and other stuff with branch issues).


---

Comment by mforets created at 2017-04-27 20:54:02

we may want to ensure a symbolic integral wrapper, for instance with (cf. #22138):


```
sage: n = var('n')
sage: integral(x^n*sin(x), x, algorithm='giac')
...
NotImplementedError: Unable to parse Giac output: integrate(x^n*sin(x),x)
```


but in other cases it already returns unevaluted:


```
sage: integrate(log(1+x)/x, x, 0, 1, algorithm='giac')
integrate(ln(x + 1)/x, x, 0, 1)
```



---

Comment by mforets created at 2017-04-27 21:22:22

Replying to [comment:4 kcrisman]:
> Love this.  Don't see any obvious problems with the commit (I haven't tested it, though, just reading through).
> 
> On a related note, can you test out the various tickets at https://trac.sagemath.org/wiki/symbolics#Integrationtickets with this?  In particular the `abs_integrate` ones, see e.g. #12731.  If the integrator here is powerful enough, it might be time to replace the Maxima integrator with this one; the Maxima one has many errors (though in my opinion is still way better than not having one, as most of those are on relatively "interesting" functions like your example, abs and other stuff with branch issues).

:) here are some [gist of hard integrals](https://gist.github.com/mforets/e82a3de96a17bc80a4a22ad787bdd104)


---

Comment by tscrim created at 2017-05-02 04:54:09

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2017-05-02 04:54:09

I think this is something that we should get into the next Sage, but we should discuss on another ticket, and possibly sage-devel, switching the default integrator.


---

Comment by mforets created at 2017-05-02 15:03:54

Replying to [comment:7 tscrim]:
> I think this is something that we should get into the next Sage, but we should discuss on another ticket, and possibly sage-devel, switching the default integrator.

thanks for the review!

yes, IMO some action should be taken (for example to double check with numerical integrator and show a warning if nonsense is detected / dispatch another integrator for known issues eg. abs-trig or some special functions). i am not a big fan of 'blatantly wrong' answers, because from the user's point of view, it makes you loose a lot of confidence on the software.


---

Comment by kcrisman created at 2017-05-02 16:00:33

Oh yeah, we would want some super testing if we switched the default.  But the problem is that currently Maxima's integration for anything involving branches or abs is weak, at least the way we interface with it.  

As a first approximation, perhaps we could have a system where we removed the `abs_integrate` option from Maxima and then had Sage use either Sympy or giac as a backup if "integral" was in the returned Maxima output... anyway, that's for sage-devel, for sure.


---

Comment by vbraun created at 2017-05-04 21:00:44

Resolution: fixed
