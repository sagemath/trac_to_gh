# Issue 23581: py3: hash for complex interval fields

archive/issues_023581.json:
```json
{
    "body": "CC:  embray jdemeyer jhpalmieri aapitzsch\n\nas a tiny step towards py3\n\nIssue created by migration from https://trac.sagemath.org/ticket/23818\n\n",
    "created_at": "2017-09-10T06:10:25Z",
    "labels": [
        "python3",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.1",
    "title": "py3: hash for complex interval fields",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23581",
    "user": "chapoton"
}
```
CC:  embray jdemeyer jhpalmieri aapitzsch

as a tiny step towards py3

Issue created by migration from https://trac.sagemath.org/ticket/23818





---

archive/issue_comments_330417.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-09-10T06:15:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23581",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23581#issuecomment-330417",
    "user": "chapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_330418.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-09-10T06:15:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23581",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23581#issuecomment-330418",
    "user": "chapoton"
}
```

New commits:



---

archive/issue_comments_330419.json:
```json
{
    "body": "ping ?",
    "created_at": "2017-09-11T18:54:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23581",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23581#issuecomment-330419",
    "user": "chapoton"
}
```

ping ?



---

archive/issue_comments_330420.json:
```json
{
    "body": "This looks okay to me. Any reason to worry about using `__repr__` to define the hash? Is there a better option here?\n\nI'll mark it as positive review, and anyone who objects can change it back.",
    "created_at": "2017-09-11T20:43:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23581",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23581#issuecomment-330420",
    "user": "jhpalmieri"
}
```

This looks okay to me. Any reason to worry about using `__repr__` to define the hash? Is there a better option here?

I'll mark it as positive review, and anyone who objects can change it back.



---

archive/issue_comments_330421.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-09-11T20:43:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23581",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23581#issuecomment-330421",
    "user": "jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_330422.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-09-12T20:08:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23581",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23581#issuecomment-330422",
    "user": "embray"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_330423.json:
```json
{
    "body": "I think a better value to use for hashing is something like: `(self.__class__, self._prec)` since that's closer to, for example, how the object would be reduced for pickling.",
    "created_at": "2017-09-12T20:08:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23581",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23581#issuecomment-330423",
    "user": "embray"
}
```

I think a better value to use for hashing is something like: `(self.__class__, self._prec)` since that's closer to, for example, how the object would be reduced for pickling.



---

archive/issue_comments_330424.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-09-13T06:40:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23581",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23581#issuecomment-330424",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_330425.json:
```json
{
    "body": "Here it is. The 32-bit hash needs to be checked. I just took the 64-bit hash mod `2**32`.",
    "created_at": "2017-09-13T06:41:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23581",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23581#issuecomment-330425",
    "user": "chapoton"
}
```

Here it is. The 32-bit hash needs to be checked. I just took the 64-bit hash mod `2**32`.



---

archive/issue_comments_330426.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-09-13T06:41:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23581",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23581#issuecomment-330426",
    "user": "chapoton"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_330427.json:
```json
{
    "body": "Hmm... just an aside, I didn't realize the doctester had a way to specify different results for 64-bit vs 32-bit.  It would be good to have other platform specifiers too, or perhaps general support for platform markers https://www.python.org/dev/peps/pep-0508/#environment-markers\n\nThat said, I don't know if it makes enormous sense to test the hash value, since the details of how specific objects are hashed in Python is implementation-specific and can change between Python versions and generally isn't guaranteed.  Instead, I would just test that `hash()` of two instances compares equal when it should.",
    "created_at": "2017-09-15T15:34:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23581",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23581#issuecomment-330427",
    "user": "embray"
}
```

Hmm... just an aside, I didn't realize the doctester had a way to specify different results for 64-bit vs 32-bit.  It would be good to have other platform specifiers too, or perhaps general support for platform markers https://www.python.org/dev/peps/pep-0508/#environment-markers

That said, I don't know if it makes enormous sense to test the hash value, since the details of how specific objects are hashed in Python is implementation-specific and can change between Python versions and generally isn't guaranteed.  Instead, I would just test that `hash()` of two instances compares equal when it should.



---

archive/issue_comments_330428.json:
```json
{
    "body": "Raah, you made me change the hash, and now the new hash does not make sense.. Can I set it back to use `_repr_` ?",
    "created_at": "2017-09-18T12:39:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23581",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23581#issuecomment-330428",
    "user": "chapoton"
}
```

Raah, you made me change the hash, and now the new hash does not make sense.. Can I set it back to use `_repr_` ?



---

archive/issue_comments_330429.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-09-18T12:50:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23581",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23581#issuecomment-330429",
    "user": "chapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_330430.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-10-10T17:23:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23581",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23581#issuecomment-330430",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_330431.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-10-10T17:28:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23581",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23581#issuecomment-330431",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_330432.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-10-10T17:29:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23581",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23581#issuecomment-330432",
    "user": "chapoton"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_330433.json:
```json
{
    "body": "Replying to [comment:9 chapoton]:\n> Raah, you made me change the hash, and now the new hash does not make sense.. Can I set it back to use `_repr_` ?\n\nWell I didn't *make* you do it, but I think it makes more sense this way.  In any case the actual numerical hash value is completely implementation and system dependent and shouldn't be tested unless you're actually testing the hash algorithm itself.  Instead just ensure that two immutable(?) instances of the same class have the same hash--which it seems you did.",
    "created_at": "2017-10-11T09:16:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23581",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23581#issuecomment-330433",
    "user": "embray"
}
```

Replying to [comment:9 chapoton]:
> Raah, you made me change the hash, and now the new hash does not make sense.. Can I set it back to use `_repr_` ?

Well I didn't *make* you do it, but I think it makes more sense this way.  In any case the actual numerical hash value is completely implementation and system dependent and shouldn't be tested unless you're actually testing the hash algorithm itself.  Instead just ensure that two immutable(?) instances of the same class have the same hash--which it seems you did.



---

archive/issue_comments_330434.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-10-11T09:16:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23581",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23581#issuecomment-330434",
    "user": "embray"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_330435.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-10-16T22:44:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23581",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23581#issuecomment-330435",
    "user": "vbraun"
}
```

Resolution: fixed
