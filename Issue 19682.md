# Issue 19682: upgrade nasty to version 26 and make it standard

Issue created by migration from Trac.

Original creator: dimpase

Original creation time: 2016-01-20 18:58:10

CC:  jmantysalo ncohen jdemeyer

We can now make nasty standard; tarball 
(made from https://github.com/dimpase/nauty_sagemath)

can be obtained from http://users.ox.ac.uk/~coml0531/sage/nauty-26b17.tar.bz2


---

Comment by dimpase created at 2016-01-20 20:56:50

Changing status from new to needs_review.


---

Comment by vbraun created at 2016-01-20 21:02:50

This branch doesn't make it standard, we should have a formal vote for that as well I guess. 

A spkg-check script that runs runalltests would be nice.


---

Comment by git created at 2016-01-20 21:14:06

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2016-01-20 21:36:43

Replying to [comment:3 vbraun]:
> This branch doesn't make it standard, we should have a formal vote for that as well I guess. 
> 
fixed and called up for vote...

> A spkg-check script that runs runalltests would be nice.

but that's what spkg-check already does, no?
{{{#!/usr/bin/env bash

if [ "$SAGE_LOCAL" = "" ]; then
   echo >&2 "SAGE_LOCAL undefined ... exiting";
   echo >&2 "Maybe run 'sage -sh'?"
   exit 1
fi

cd nauty*

# runalltests doesn't exit with a zero status.
# So we check $fails instead.

$MAKE checks
source ./runalltests

if [ "${fails}" -ne "0" ]; then
   echo >&2 "Error checking nauty."
   exit 1
fi
```



---

Comment by jdemeyer created at 2016-01-20 21:57:19

Why fork nauty?


---

Comment by jdemeyer created at 2016-01-20 21:57:19

Changing status from needs_review to needs_info.


---

Comment by jdemeyer created at 2016-01-20 21:59:05

And where does this version "26b17" come from?


---

Comment by dimpase created at 2016-01-20 22:02:37

Replying to [comment:7 jdemeyer]:
> And where does this version "26b17" come from?
https://github.com/dimpase/nauty_sagemath/blob/master/This_is_nauty26b17.

so this is still a beta, but we'll update as soon as we get a release


---

Comment by jdemeyer created at 2016-01-20 22:03:06

Typo: distrubting


---

Comment by jdemeyer created at 2016-01-20 22:03:39

Replying to [comment:8 dimpase]:
> https://github.com/dimpase/nauty_sagemath/blob/master/This_is_nauty26b17

404 page not found...


---

Comment by dimpase created at 2016-01-20 22:03:50

Replying to [comment:6 jdemeyer]:
> Why fork nauty?

cause that's what Brendan would like - he want to keep releasing with his original license, I suppose.


---

Comment by dimpase created at 2016-01-20 22:05:19

Replying to [comment:10 jdemeyer]:
> Replying to [comment:8 dimpase]:
> > https://github.com/dimpase/nauty_sagemath/blob/master/This_is_nauty26b17.
> 
> 404 page not found...

the dot at the end is part of the URL


---

Comment by jdemeyer created at 2016-01-20 22:10:41

Replying to [comment:11 dimpase]:
> Replying to [comment:6 jdemeyer]:
> > Why fork nauty?
> 
> cause that's what Brendan would like - he want to keep releasing with his original license, I suppose.

I don't think that justifies forking nauty. Why not just ship the official tarball and add Brendan's permission as a separate file in the repo (say, `build/pkgs/nauty/LICENSE`).


---

Comment by jdemeyer created at 2016-01-20 22:11:39

Replying to [comment:11 dimpase]:
> he want to keep releasing with his original license, I suppose.

For the record, does he know that is completely pointless since the nauty-in-Sage gives everybody permission to copy the code under the weaker license?


---

Comment by dimpase created at 2016-01-20 22:16:53

Replying to [comment:13 jdemeyer]:
> Replying to [comment:11 dimpase]:
> > Replying to [comment:6 jdemeyer]:
> > > Why fork nauty?
> > 
> > cause that's what Brendan would like - he want to keep releasing with his original license, I suppose.
> 
> I don't think that justifies forking nauty. Why not just ship the official tarball and add Brendan's permission as a separate file in the repo (say, `build/pkgs/nauty/LICENSE`).

there is no official tarball of this version available (we got the tarball by email), and the licence is in a .in file to be run with the tarball.


---

Comment by dimpase created at 2016-01-20 22:18:50

Replying to [comment:14 jdemeyer]:
> Replying to [comment:11 dimpase]:
> > he want to keep releasing with his original license, I suppose.
> 
> For the record, does he know that is completely pointless since the nauty-in-Sage gives everybody permission to copy the code under the weaker license?

I don't read his mind, but I imagine that a professor of CS in one of the best universities in Australia knows what he is doing.


---

Comment by jdemeyer created at 2016-01-20 22:22:58

Replying to [comment:15 dimpase]:
> there is no official tarball of this version available (we got the tarball by email)

That's a bit fishy. Can't you use the official tarball (+ patches if needed)?


---

Comment by git created at 2016-01-20 22:24:42

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by dimpase created at 2016-01-20 23:12:22

Replying to [comment:17 jdemeyer]:
> Replying to [comment:15 dimpase]:
> > there is no official tarball of this version available (we got the tarball by email)
> 
> That's a bit fishy. Can't you use the official tarball (+ patches if needed)?
Now the gihub repo has the 26b17 updates over the version 25r9 we have (and which is the current publicly available version)
You can take a look at a long diff...


---

Comment by git created at 2016-01-20 23:50:37

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by nbruin created at 2016-01-21 01:22:05

Replying to [comment:19 dimpase]:
> Now the gihub repo has the 26b17 updates over the version 25r9 we have (and which is the current publicly available version)
> You can take a look at a long diff...  

I've tried. The relevant diffs would be between 26b17 and your repository, but I can't figure out how to do that in github (the main problem is that 26b17 doesn't seem to be available in your repository).

I think the reason why Jeroen is a little hesitant of using a fork of nauty (it's certainly why I am) is maintainability. What process for upgrading to the next version of nauty do you propose?

The usual way is to start with "pristine" upstream and patch that. It may be doable to do this with git instead, but in that case I think the procedure would be to rebase your changes to 26b17, not merge 26b17 into your branch (which seems to be what happened now). In that case you'd have to ship your (limited) git history in the tarball as a certificate of what changes have been made relative to upstream, and to give maintainers in the future the means to perform an upgrade in a relatively automated fashion.


---

Comment by dimpase created at 2016-01-21 09:09:59

Replying to [comment:21 nbruin]:
> Replying to [comment:19 dimpase]:
> > Now the gihub repo has the 26b17 updates over the version 25r9 we have (and which is the current publicly available version)
> > You can take a look at a long diff...  
> 
> I've tried. The relevant diffs would be between 26b17 and your repository, but I can't figure out how to do that in github (the main problem is that 26b17 doesn't seem to be available in your repository).

26b17 is the 2nd commit, 25r9 is the 1st commit.
Diff is too big to be viewed online, thus check the repo out and do `git diff HEAD^`
I'll mention this in `SPKG.txt`.

> 
> I think the reason why Jeroen is a little hesitant of using a fork of nauty (it's certainly why I am) is maintainability. What process for upgrading to the next version of nauty do you propose?
> 
the relevant license file is in `nauty-h.in`.
Just make sure that whenever you pour over the next nauty release, the relevant part of the file containing the  license stays intact.
Suggestions how to make this foolproof are welcome. But releases are not frequent at all, so I am not worried. 



> The usual way is to start with "pristine" upstream and patch that. It may be doable to do this with git instead, but in that case I think the procedure would be to rebase your changes to 26b17, not merge 26b17 into your branch (which seems to be what happened now). In that case you'd have to ship your (limited) git history in the tarball as a certificate of what changes have been made relative to upstream, and to give maintainers in the future the means to perform an upgrade in a relatively automated fashion.

there is no "my" branch. The repo is the released version 25r9 patched by 26b17.


---

Comment by dimpase created at 2016-01-21 10:48:18

The git repo in question should be in https://github.com/sagemath and not in https://github.com/dimpase 

If we agree  that this should go forward at all then I'll do this.


---

Comment by git created at 2016-02-27 21:31:33

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2016-02-27 21:36:07

Changing status from needs_info to needs_review.


---

Comment by dimpase created at 2016-02-27 21:36:07

good to go, I think.


---

Comment by fbissey created at 2016-02-28 09:05:21

Should you install the new tools from this version? May not be useful in sage but as a general matter unless there is a reason I think we should install everything. This is my list

```
copyg listg labelg dretog amtog geng complg showg NRswitchg \
		biplabg addedgeg deledgeg countg pickg genrang newedgeg catg genbg \
		directg gentreeg genquarticg \
		ranlabg multig planarg gentourng linegraphg watercluster2 dretodot \
		subdivideg vcolg delptg cubhamg twohamg hamheuristic converseg \
		genspecialg genbgL \
		copyg listg labelg dretog amtog geng complg showg NRswitchg \
		dreadnaut
```

I'll sort it at some point.


---

Comment by dimpase created at 2016-02-28 09:26:56

Changing status from needs_review to needs_work.


---

Comment by dimpase created at 2016-02-28 09:29:27

Replying to [comment:27 fbissey]:
> Should you install the new tools from this version? May not be useful in sage but as a general matter unless there is a reason I think we should install everything. This is my list
> {{{
> copyg listg labelg dretog amtog geng complg showg NRswitchg \
> 		biplabg addedgeg deledgeg countg pickg genrang newedgeg catg genbg \
> 		directg gentreeg genquarticg \
> 		ranlabg multig planarg gentourng linegraphg watercluster2 dretodot \
> 		subdivideg vcolg delptg cubhamg twohamg hamheuristic converseg \
> 		genspecialg genbgL \
> 		copyg listg labelg dretog amtog geng complg showg NRswitchg \
> 		dreadnaut
> }}}
> I'll sort it at some point.

it's quite a handful; I should have read the announcement more carefully.


---

Comment by fbissey created at 2016-02-28 09:35:36

I had to go to the makefile to make a proper list. And it looks like I got duplicates in the previous one so care is needed there.

```
all : nauty gtools ;

nauty : dreadnaut nauty.a nauty1.a nautyW.a nautyW1.a nautyL.a nautyL1.a;

gtools : copyg listg labelg dretog amtog geng complg showg NRswitchg \
  biplabg addedgeg deledgeg countg pickg genrang newedgeg catg genbg \
  directg gentreeg genquarticg \
  ranlabg multig planarg gentourng linegraphg watercluster2 dretodot \
  subdivideg vcolg delptg cubhamg twohamg hamheuristic converseg \
  genspecialg genbgL shortg ;
```



---

Comment by git created at 2016-02-28 12:27:22

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2016-02-28 12:39:19

OK, all fixed, thanks for pointing these issues out.


---

Comment by dimpase created at 2016-02-28 12:39:19

Changing status from needs_work to needs_review.


---

Comment by fbissey created at 2016-02-29 00:32:18

Apart from the issue to moving to standard it is all ok from me, I am ready to put in positive review if we have a clear signal on "standard".


---

Comment by jdemeyer created at 2016-02-29 09:02:48

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2016-02-29 09:02:48


```
Not Found

The requested URL /~coml0531/sage/nauty-26r1.tar.bz2 was not found on this server.
```



---

Comment by jdemeyer created at 2016-02-29 09:06:27

One detail: you don't need to copy the whole license to `SPKG.txt`, just a link should be sufficient, perhaps mention that it is GPL-compatible.


---

Comment by dimpase created at 2016-02-29 12:36:22

oops, wrong suffix in the URL. Fixed now.


---

Comment by dimpase created at 2016-02-29 12:36:22

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2016-02-29 12:47:36

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2016-02-29 12:47:36

In `src/sage/graphs/graph_generators.py`:

```
    Also: see the use of the optional nauty package for generating graphs
    at the :meth:`nauty_geng` method.
```



---

Comment by jdemeyer created at 2016-02-29 12:47:50

Author name...


---

Comment by git created at 2016-03-01 19:16:55

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by git created at 2016-03-01 22:03:42

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by dimpase created at 2016-03-01 22:19:08

OK, done (and then fixed spurrious merge commits that were not needed...)


---

Comment by dimpase created at 2016-03-01 22:19:08

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2016-03-02 20:36:50

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2016-03-03 08:29:02

Resolution: fixed
