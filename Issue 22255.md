# Issue 22255: Make 'make V=0' behave the same as 'V=0 make'

archive/issues_022255.json:
```json
{
    "body": "CC:  @jdemeyer @jhpalmieri @dimpase\n\nThis is a follow-up on #22418.\n\nSetting `V=1` in the sub-makes works for `V=0 make` but not for `make V=0` because in the latter case `MAKEFLAGS` is set to `V=0` and can't be overridden by the environment variable. Need to edit `MAKEFLAGS` as well.\n\nIssue created by migration from https://trac.sagemath.org/ticket/22492\n\n",
    "created_at": "2017-03-02T11:34:22Z",
    "labels": [
        "build",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.0",
    "title": "Make 'make V=0' behave the same as 'V=0 make'",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22255",
    "user": "@mkoeppe"
}
```
CC:  @jdemeyer @jhpalmieri @dimpase

This is a follow-up on #22418.

Setting `V=1` in the sub-makes works for `V=0 make` but not for `make V=0` because in the latter case `MAKEFLAGS` is set to `V=0` and can't be overridden by the environment variable. Need to edit `MAKEFLAGS` as well.

Issue created by migration from https://trac.sagemath.org/ticket/22492





---

archive/issue_comments_309187.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-04-01T19:01:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22255#issuecomment-309187",
    "user": "@mkoeppe"
}
```

New commits:



---

archive/issue_comments_309188.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-04-01T19:01:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22255#issuecomment-309188",
    "user": "@mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_309189.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2017-04-18T08:35:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22255#issuecomment-309189",
    "user": "@jdemeyer"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_309190.json:
```json
{
    "body": "Why these conditions for setting `MAKEFLAGS`?\n\n```\nif [[ $use_prefix = true ]]; then\n```\n\nand\n\n```\nif [[ -n \"$MAKEFLAGS\" ]];\n```\n\n\nI would unconditionally always set `export MAKEFLAGS=\"$MAKEFLAGS V=1\"`.",
    "created_at": "2017-04-18T08:35:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22255#issuecomment-309190",
    "user": "@jdemeyer"
}
```

Why these conditions for setting `MAKEFLAGS`?

```
if [[ $use_prefix = true ]]; then
```

and

```
if [[ -n "$MAKEFLAGS" ]];
```


I would unconditionally always set `export MAKEFLAGS="$MAKEFLAGS V=1"`.



---

archive/issue_comments_309191.json:
```json
{
    "body": "`$use_prefix` distinguishes between the top-level logger (logging to `install.log`) and the nested loggers (for each package). \nThe top-level logger should not set `V=1`. (This is how #22418 broke the V=0 feature.)\n\nRegarding `iff [This is the Trac macro *-n \"$MAKEFLAGS\" * that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#-n \"$MAKEFLAGS\" -macro);`: This is not important, but my reasoning here is that nothing in the `sage-logger` is really make-specific, so it shouldn't touch such variables unless it has to.",
    "created_at": "2017-04-18T15:29:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22255#issuecomment-309191",
    "user": "@mkoeppe"
}
```

`$use_prefix` distinguishes between the top-level logger (logging to `install.log`) and the nested loggers (for each package). 
The top-level logger should not set `V=1`. (This is how #22418 broke the V=0 feature.)

Regarding `iff [This is the Trac macro *-n "$MAKEFLAGS" * that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#-n "$MAKEFLAGS" -macro);`: This is not important, but my reasoning here is that nothing in the `sage-logger` is really make-specific, so it shouldn't touch such variables unless it has to.



---

archive/issue_comments_309192.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2017-04-18T15:29:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22255#issuecomment-309192",
    "user": "@mkoeppe"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_309193.json:
```json
{
    "body": "Replying to [comment:7 mkoeppe]:\n> The top-level logger should not set `V=1`. (This is how #22418 broke the V=0 feature.)\n\nThat's not really correct. The correct statement is \"only the bottom-level logger should set `V=1`\". There can be situations where there is only one level and the top-level logger is also the bottom-level logger.",
    "created_at": "2017-04-18T15:41:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22255#issuecomment-309193",
    "user": "@jdemeyer"
}
```

Replying to [comment:7 mkoeppe]:
> The top-level logger should not set `V=1`. (This is how #22418 broke the V=0 feature.)

That's not really correct. The correct statement is "only the bottom-level logger should set `V=1`". There can be situations where there is only one level and the top-level logger is also the bottom-level logger.



---

archive/issue_comments_309194.json:
```json
{
    "body": "I don't know about such situations. In any case this just restores the status before #22418, which seemed to work fine.",
    "created_at": "2017-04-18T15:44:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22255#issuecomment-309194",
    "user": "@mkoeppe"
}
```

I don't know about such situations. In any case this just restores the status before #22418, which seemed to work fine.



---

archive/issue_comments_309195.json:
```json
{
    "body": "Replying to [comment:10 mkoeppe]:\n> I don't know about such situations.\n\nFor example, when you run `./sage -i $PKGNAME`. In that case, there will be only one level of logger.",
    "created_at": "2017-04-18T19:59:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22255#issuecomment-309195",
    "user": "@jdemeyer"
}
```

Replying to [comment:10 mkoeppe]:
> I don't know about such situations.

For example, when you run `./sage -i $PKGNAME`. In that case, there will be only one level of logger.



---

archive/issue_comments_309196.json:
```json
{
    "body": "I think this is a better solution to the original problem.\n----\nNew commits:",
    "created_at": "2017-04-18T20:17:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22255#issuecomment-309196",
    "user": "@jdemeyer"
}
```

I think this is a better solution to the original problem.
----
New commits:



---

archive/issue_comments_309197.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-04-18T23:12:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22255#issuecomment-309197",
    "user": "@mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_309198.json:
```json
{
    "body": "This seems to work fine for me. I agree with this implementation.",
    "created_at": "2017-04-18T23:12:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22255#issuecomment-309198",
    "user": "@mkoeppe"
}
```

This seems to work fine for me. I agree with this implementation.



---

archive/issue_comments_309199.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-04-23T12:58:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22255#issuecomment-309199",
    "user": "@vbraun"
}
```

Resolution: fixed
