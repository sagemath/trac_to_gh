# Issue 22255: Make 'make V=0' behave the same as 'V=0 make'

Issue created by migration from https://trac.sagemath.org/ticket/22492

Original creator: mkoeppe

Original creation time: 2017-03-02 11:34:22

CC:  jdemeyer jhpalmieri dimpase

This is a follow-up on #22418.

Setting `V=1` in the sub-makes works for `V=0 make` but not for `make V=0` because in the latter case `MAKEFLAGS` is set to `V=0` and can't be overridden by the environment variable. Need to edit `MAKEFLAGS` as well.


---

Comment by mkoeppe created at 2017-04-01 19:01:17

New commits:


---

Comment by mkoeppe created at 2017-04-01 19:01:17

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2017-04-18 08:35:01

Changing status from needs_review to needs_info.


---

Comment by jdemeyer created at 2017-04-18 08:35:01

Why these conditions for setting `MAKEFLAGS`?

```
if [[ $use_prefix = true ]]; then
```

and

```
if [[ -n "$MAKEFLAGS" ]];
```


I would unconditionally always set `export MAKEFLAGS="$MAKEFLAGS V=1"`.


---

Comment by mkoeppe created at 2017-04-18 15:29:33

`$use_prefix` distinguishes between the top-level logger (logging to `install.log`) and the nested loggers (for each package). 
The top-level logger should not set `V=1`. (This is how #22418 broke the V=0 feature.)

Regarding `iff [This is the Trac macro *-n "$MAKEFLAGS" * that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#-n "$MAKEFLAGS" -macro);`: This is not important, but my reasoning here is that nothing in the `sage-logger` is really make-specific, so it shouldn't touch such variables unless it has to.


---

Comment by mkoeppe created at 2017-04-18 15:29:43

Changing status from needs_info to needs_review.


---

Comment by jdemeyer created at 2017-04-18 15:41:22

Replying to [comment:7 mkoeppe]:
> The top-level logger should not set `V=1`. (This is how #22418 broke the V=0 feature.)

That's not really correct. The correct statement is "only the bottom-level logger should set `V=1`". There can be situations where there is only one level and the top-level logger is also the bottom-level logger.


---

Comment by mkoeppe created at 2017-04-18 15:44:11

I don't know about such situations. In any case this just restores the status before #22418, which seemed to work fine.


---

Comment by jdemeyer created at 2017-04-18 19:59:22

Replying to [comment:10 mkoeppe]:
> I don't know about such situations.

For example, when you run `./sage -i $PKGNAME`. In that case, there will be only one level of logger.


---

Comment by jdemeyer created at 2017-04-18 20:17:19

I think this is a better solution to the original problem.
----
New commits:


---

Comment by mkoeppe created at 2017-04-18 23:12:32

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2017-04-18 23:12:32

This seems to work fine for me. I agree with this implementation.


---

Comment by vbraun created at 2017-04-23 12:58:11

Resolution: fixed
