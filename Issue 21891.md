# Issue 21891: Fix pickling of FinitelyGeneratedMatrixGroup_generic

Issue created by migration from https://trac.sagemath.org/ticket/22128

Original creator: pbruin

Original creation time: 2017-01-03 12:04:59

CC:  vdelecroix

This bug was found in comment:6:ticket:22091:

```
sage: R = MatrixSpace(SR, 2)
sage: G = MatrixGroup([R([[1,1],[0,1]])])
sage: type(G)
<class 'sage.groups.matrix_gps.finitely_generated.FinitelyGeneratedMatrixGroup_generic_with_category'>
sage: G.register_embedding(R)  # declare coercion embedding
sage: loads(dumps(G))
Traceback (most recent call last):
...
AttributeError: 'NoneType' object has no attribute 'homset_category'
```

This ticket fixes the bug by implementing a `__reduce__` method similar to that of `FinitelyGeneratedMatrixGroup_gap`.

This ticket is a dependency of #22091.


---

Comment by pbruin created at 2017-01-03 12:16:02

At first I tried to simultaneously make `FinitelyGeneratedMatrixGroup_gap` a subclass of `FinitelyGeneratedMatrixGroup_generic`.  Unfortunately, this led to an annoying "interference" between multiple inheritance and the cached method `gens()`.


---

Comment by pbruin created at 2017-01-03 12:31:51

Changing status from new to needs_review.


---

Comment by pbruin created at 2017-01-03 12:35:34

The inheritance order in `CoxeterMatrixGroup` had to be changed to prevent the new `__reduce__` method from overriding the one from `UniqueRepresentation`.


---

Comment by tscrim created at 2017-01-03 13:33:56

Since matrix groups are not unique parents, when we do `loads(dumps(G))`, the embedding is not preserved and there is no coercion that can be found from the new copy of `G`. However, this seems to be a more general problem (that seems difficult and might require large-scale changes) and the behavior is consistent for other matrix groups. So, I'm giving this a positive review.


---

Comment by tscrim created at 2017-01-03 13:33:56

Changing status from needs_review to positive_review.


---

Comment by pbruin created at 2017-01-03 14:09:08

Replying to [comment:4 tscrim]:
> Since matrix groups are not unique parents, when we do `loads(dumps(G))`, the embedding is not preserved and there is no coercion that can be found from the new copy of `G`. However, this seems to be a more general problem (that seems difficult and might require large-scale changes) and the behavior is consistent for other matrix groups.
Indeed.  The first step towards solving that could be to make `MatrixGroup` into a `UniqueFactory`.
> So, I'm giving this a positive review.
Thanks!


---

Comment by vbraun created at 2017-01-21 21:21:48

Resolution: fixed
