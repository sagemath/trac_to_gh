# Issue 25460: Implement enumeration over QQ for product projective schemes

Issue created by migration from https://trac.sagemath.org/ticket/25697

Original creator: raghukul01

Original creation time: 2018-06-29 03:52:26

CC:  bhutz raghukul01

Keywords: gsoc2018

Currently if base ring is `QQ`, similar algorithm is used as in case of `NumberFields` (even basic enumeration is much faster than that).
Also there should be a separate file for rational point algorithms (as in the case of other schemes) to keep things universal.

Also sufficient examples should be present for each algorithm.


---

Comment by raghukul01 created at 2018-06-29 04:00:22

Changing status from new to needs_review.


---

Comment by raghukul01 created at 2018-06-29 04:00:22

I have added `Volker Braun and Ben Hutz (2014): initial version` for rational_points file. Since some algorithms are similar to one in homsets file. Is that correct?
----
New commits:


---

Comment by bhutz created at 2018-06-30 17:25:19

Changing status from needs_review to needs_work.


---

Comment by bhutz created at 2018-06-30 17:25:19

This looks like a good start. The one big thing is that the points_of_bounded_height should be a true iterator and not an iterator that you construct after creating the list of all points.

One other minor thing:


```
self._components[i]
```

can just be `self[i]' since it is better not to access the private data directly.


Once you make this an iterator I'll do some functionality testing.


---

Comment by git created at 2018-06-30 21:51:52

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by raghukul01 created at 2018-06-30 21:53:41

Changing status from needs_work to needs_review.


---

Comment by raghukul01 created at 2018-06-30 21:53:41

Added suggested changes.


---

Comment by bhutz created at 2018-07-01 21:27:56

Changing status from needs_review to needs_work.


---

Comment by bhutz created at 2018-07-01 21:27:56

Just adding the yield doesn't do it. The line

```
comp_points = [list(self[i].points_of_bounded_height(bound=B, tolerance=tol, precision=prec)) for i in range(m)]
```

is still creating the list of all points.

Take a look at how points_of_bounded_height works for affine_space.py where it is creating a list of iterators for the coordinates and the stepping through the iterators to yield the points in succession without ever creating the list of all points.


---

Comment by bhutz created at 2018-07-01 21:27:56

Changing priority from major to minor.


---

Comment by git created at 2018-07-02 22:34:39

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by raghukul01 created at 2018-07-02 22:35:29

Changing status from needs_work to needs_review.


---

Comment by bhutz created at 2018-07-05 14:43:05

Still having trouble here with creating true iterators and unnecessary lists of points.

In general the doc says then enum_* functions should return a list and the points_of_bounded_heigth functions should return an iterator.

----

in enum_product you are building off of the enum_projective function which is creating an entire list which you then turn into an iterator.


```
R = X.codomain().ambient_space()
m = R.num_components()
iters = [ iter(enum_projective_rational_field(R[i], B)) for i in range(m) ]
```


better would be to just start with iterators and never have the whole list

```
R = X.codomain().ambient_space()
iters = [P.points_of_bounded_height(bound=B) for P in R]
```


----

in points_of_bounded_height you'll need more significant changes. You have

```
comp_points = [list(self[i].points_of_bounded_height(bound=B, tolerance=tol, precision=prec)) for i in range(m)]
```

which is taking an iterator turning it into a list and then a couple lines later you turn it back into an iterator.

You should avoid the conversion to a list and use
the same type of logic as enum_product_projective_rational_field with

```
iters = [P.points_of_bounded_height(bound=B, tolerance=tol, precision=prec) for P in self]
```



---

Comment by bhutz created at 2018-07-05 14:43:05

Changing status from needs_review to needs_work.


---

Comment by git created at 2018-07-06 09:55:42

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by raghukul01 created at 2018-07-06 09:59:00

Sir, other change suggested (changing to points_of_bounded_height instead of enum_projective_rational_field) should be done after #25780, since doctest needs to be updated accordingly.


---

Comment by bhutz created at 2018-07-06 15:45:13

fyi, docs don't currently build


```
[dochtml] OSError: [schemes  ] /local/lib/python2.7/site-packages/sage/schemes/product_projective/rational_point.py:docstring of sage.schemes.product_projective.rational_point.enum_product_projective_number_field:30: WARNING: Bullet list ends without a blank line; unexpected unindent.
```



---

Comment by raghukul01 created at 2018-07-06 15:59:04

I think it is the same error, that was in #25529


---

Comment by git created at 2018-07-19 07:31:41

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by raghukul01 created at 2018-07-19 07:33:08

Changing status from needs_work to needs_review.


---

Comment by raghukul01 created at 2018-07-19 07:33:08

Merged positive reviewed dependency


---

Comment by git created at 2018-07-23 23:36:41

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-07-23 23:41:10

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by bhutz created at 2018-07-24 00:04:02

docs building and long tests are running...

----

From looking through the code only a few minor things

white space needed

```
dim_prefix = [0,dim[0]] # prefixes dim list

2 places - for i in range(1,len(dim)):

sage: enum_product_projective_number_field(X,bound=1.5)

sage: PP.<x,y,z,w> = ProductProjectiveSpaces([1, 1],GF(3))

sage: PP.<x0,x1,x2,x3> = ProductProjectiveSpaces([1, 1],GF(17))

sage: from sage.schemes.product_projective.rational_point import \
enum_product_projective_finite_field
```


Spelling

```
# add the intial point
```


extra word 'for'

```
Naive algorithms for enumerating rational points over `\QQ`, number fields or
finite fields over *for* general schemes.
```


It won't change anything for these functions but it would be better to use

```
R[i].dimension_relative()
```

instead of

```
R[i].dimension()
```

There are two places to change this.


---

Comment by git created at 2018-07-24 00:28:31

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by bhutz created at 2018-07-24 09:52:52

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2018-08-08 18:18:19

Resolution: fixed
