# Issue 25460: Implement enumeration over QQ for product projective schemes

archive/issues_025460.json:
```json
{
    "body": "CC:  @bhutz @raghukul01\n\nKeywords: gsoc2018\n\nCurrently if base ring is `QQ`, similar algorithm is used as in case of `NumberFields` (even basic enumeration is much faster than that).\nAlso there should be a separate file for rational point algorithms (as in the case of other schemes) to keep things universal.\n\nAlso sufficient examples should be present for each algorithm.\n\nIssue created by migration from https://trac.sagemath.org/ticket/25697\n\n",
    "created_at": "2018-06-29T03:52:26Z",
    "labels": [
        "component: algebraic geometry"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.3",
    "title": "Implement enumeration over QQ for product projective schemes",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25460",
    "user": "https://github.com/raghukul01"
}
```
CC:  @bhutz @raghukul01

Keywords: gsoc2018

Currently if base ring is `QQ`, similar algorithm is used as in case of `NumberFields` (even basic enumeration is much faster than that).
Also there should be a separate file for rational point algorithms (as in the case of other schemes) to keep things universal.

Also sufficient examples should be present for each algorithm.

Issue created by migration from https://trac.sagemath.org/ticket/25697





---

archive/issue_comments_358810.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-06-29T04:00:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25460#issuecomment-358810",
    "user": "https://github.com/raghukul01"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_358811.json:
```json
{
    "body": "I have added `Volker Braun and Ben Hutz (2014): initial version` for rational_points file. Since some algorithms are similar to one in homsets file. Is that correct?\n----\nNew commits:",
    "created_at": "2018-06-29T04:00:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25460#issuecomment-358811",
    "user": "https://github.com/raghukul01"
}
```

I have added `Volker Braun and Ben Hutz (2014): initial version` for rational_points file. Since some algorithms are similar to one in homsets file. Is that correct?
----
New commits:



---

archive/issue_comments_358812.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-06-30T17:25:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25460#issuecomment-358812",
    "user": "https://github.com/bhutz"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_358813.json:
```json
{
    "body": "This looks like a good start. The one big thing is that the points_of_bounded_height should be a true iterator and not an iterator that you construct after creating the list of all points.\n\nOne other minor thing:\n\n\n```\nself._components[i]\n```\n\ncan just be `self[i]' since it is better not to access the private data directly.\n\n\nOnce you make this an iterator I'll do some functionality testing.",
    "created_at": "2018-06-30T17:25:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25460#issuecomment-358813",
    "user": "https://github.com/bhutz"
}
```

This looks like a good start. The one big thing is that the points_of_bounded_height should be a true iterator and not an iterator that you construct after creating the list of all points.

One other minor thing:


```
self._components[i]
```

can just be `self[i]' since it is better not to access the private data directly.


Once you make this an iterator I'll do some functionality testing.



---

archive/issue_comments_358814.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-06-30T21:51:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25460#issuecomment-358814",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_358815.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-06-30T21:53:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25460#issuecomment-358815",
    "user": "https://github.com/raghukul01"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_358816.json:
```json
{
    "body": "Added suggested changes.",
    "created_at": "2018-06-30T21:53:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25460#issuecomment-358816",
    "user": "https://github.com/raghukul01"
}
```

Added suggested changes.



---

archive/issue_comments_358817.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-07-01T21:27:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25460#issuecomment-358817",
    "user": "https://github.com/bhutz"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_358818.json:
```json
{
    "body": "Just adding the yield doesn't do it. The line\n\n```\ncomp_points = [list(self[i].points_of_bounded_height(bound=B, tolerance=tol, precision=prec)) for i in range(m)]\n```\n\nis still creating the list of all points.\n\nTake a look at how points_of_bounded_height works for affine_space.py where it is creating a list of iterators for the coordinates and the stepping through the iterators to yield the points in succession without ever creating the list of all points.",
    "created_at": "2018-07-01T21:27:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25460#issuecomment-358818",
    "user": "https://github.com/bhutz"
}
```

Just adding the yield doesn't do it. The line

```
comp_points = [list(self[i].points_of_bounded_height(bound=B, tolerance=tol, precision=prec)) for i in range(m)]
```

is still creating the list of all points.

Take a look at how points_of_bounded_height works for affine_space.py where it is creating a list of iterators for the coordinates and the stepping through the iterators to yield the points in succession without ever creating the list of all points.



---

archive/issue_comments_358819.json:
```json
{
    "body": "Changing priority from major to minor.",
    "created_at": "2018-07-01T21:27:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25460#issuecomment-358819",
    "user": "https://github.com/bhutz"
}
```

Changing priority from major to minor.



---

archive/issue_comments_358820.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-02T22:34:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25460#issuecomment-358820",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_358821.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-07-02T22:35:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25460#issuecomment-358821",
    "user": "https://github.com/raghukul01"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_358822.json:
```json
{
    "body": "Still having trouble here with creating true iterators and unnecessary lists of points.\n\nIn general the doc says then enum_* functions should return a list and the points_of_bounded_heigth functions should return an iterator.\n\n----\n\nin enum_product you are building off of the enum_projective function which is creating an entire list which you then turn into an iterator.\n\n\n```\nR = X.codomain().ambient_space()\nm = R.num_components()\niters = [ iter(enum_projective_rational_field(R[i], B)) for i in range(m) ]\n```\n\n\nbetter would be to just start with iterators and never have the whole list\n\n```\nR = X.codomain().ambient_space()\niters = [P.points_of_bounded_height(bound=B) for P in R]\n```\n\n\n----\n\nin points_of_bounded_height you'll need more significant changes. You have\n\n```\ncomp_points = [list(self[i].points_of_bounded_height(bound=B, tolerance=tol, precision=prec)) for i in range(m)]\n```\n\nwhich is taking an iterator turning it into a list and then a couple lines later you turn it back into an iterator.\n\nYou should avoid the conversion to a list and use\nthe same type of logic as enum_product_projective_rational_field with\n\n```\niters = [P.points_of_bounded_height(bound=B, tolerance=tol, precision=prec) for P in self]\n```\n",
    "created_at": "2018-07-05T14:43:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25460#issuecomment-358822",
    "user": "https://github.com/bhutz"
}
```

Still having trouble here with creating true iterators and unnecessary lists of points.

In general the doc says then enum_* functions should return a list and the points_of_bounded_heigth functions should return an iterator.

----

in enum_product you are building off of the enum_projective function which is creating an entire list which you then turn into an iterator.


```
R = X.codomain().ambient_space()
m = R.num_components()
iters = [ iter(enum_projective_rational_field(R[i], B)) for i in range(m) ]
```


better would be to just start with iterators and never have the whole list

```
R = X.codomain().ambient_space()
iters = [P.points_of_bounded_height(bound=B) for P in R]
```


----

in points_of_bounded_height you'll need more significant changes. You have

```
comp_points = [list(self[i].points_of_bounded_height(bound=B, tolerance=tol, precision=prec)) for i in range(m)]
```

which is taking an iterator turning it into a list and then a couple lines later you turn it back into an iterator.

You should avoid the conversion to a list and use
the same type of logic as enum_product_projective_rational_field with

```
iters = [P.points_of_bounded_height(bound=B, tolerance=tol, precision=prec) for P in self]
```




---

archive/issue_comments_358823.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-07-05T14:43:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25460#issuecomment-358823",
    "user": "https://github.com/bhutz"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_358824.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-06T09:55:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25460#issuecomment-358824",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_358825.json:
```json
{
    "body": "Sir, other change suggested (changing to points_of_bounded_height instead of enum_projective_rational_field) should be done after #25780, since doctest needs to be updated accordingly.",
    "created_at": "2018-07-06T09:59:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25460#issuecomment-358825",
    "user": "https://github.com/raghukul01"
}
```

Sir, other change suggested (changing to points_of_bounded_height instead of enum_projective_rational_field) should be done after #25780, since doctest needs to be updated accordingly.



---

archive/issue_comments_358826.json:
```json
{
    "body": "fyi, docs don't currently build\n\n\n```\n[dochtml] OSError: [schemes  ] /local/lib/python2.7/site-packages/sage/schemes/product_projective/rational_point.py:docstring of sage.schemes.product_projective.rational_point.enum_product_projective_number_field:30: WARNING: Bullet list ends without a blank line; unexpected unindent.\n```\n",
    "created_at": "2018-07-06T15:45:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25460#issuecomment-358826",
    "user": "https://github.com/bhutz"
}
```

fyi, docs don't currently build


```
[dochtml] OSError: [schemes  ] /local/lib/python2.7/site-packages/sage/schemes/product_projective/rational_point.py:docstring of sage.schemes.product_projective.rational_point.enum_product_projective_number_field:30: WARNING: Bullet list ends without a blank line; unexpected unindent.
```




---

archive/issue_comments_358827.json:
```json
{
    "body": "I think it is the same error, that was in #25529",
    "created_at": "2018-07-06T15:59:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25460#issuecomment-358827",
    "user": "https://github.com/raghukul01"
}
```

I think it is the same error, that was in #25529



---

archive/issue_comments_358828.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-19T07:31:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25460#issuecomment-358828",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_358829.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-07-19T07:33:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25460#issuecomment-358829",
    "user": "https://github.com/raghukul01"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_358830.json:
```json
{
    "body": "Merged positive reviewed dependency",
    "created_at": "2018-07-19T07:33:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25460#issuecomment-358830",
    "user": "https://github.com/raghukul01"
}
```

Merged positive reviewed dependency



---

archive/issue_comments_358831.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-23T23:36:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25460#issuecomment-358831",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_358832.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-23T23:41:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25460#issuecomment-358832",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_358833.json:
```json
{
    "body": "docs building and long tests are running...\n\n----\n\nFrom looking through the code only a few minor things\n\nwhite space needed\n\n```\ndim_prefix = [0,dim[0]] # prefixes dim list\n\n2 places - for i in range(1,len(dim)):\n\nsage: enum_product_projective_number_field(X,bound=1.5)\n\nsage: PP.<x,y,z,w> = ProductProjectiveSpaces([1, 1],GF(3))\n\nsage: PP.<x0,x1,x2,x3> = ProductProjectiveSpaces([1, 1],GF(17))\n\nsage: from sage.schemes.product_projective.rational_point import \\\nenum_product_projective_finite_field\n```\n\n\nSpelling\n\n```\n# add the intial point\n```\n\n\nextra word 'for'\n\n```\nNaive algorithms for enumerating rational points over `\\QQ`, number fields or\nfinite fields over *for* general schemes.\n```\n\n\nIt won't change anything for these functions but it would be better to use\n\n```\nR[i].dimension_relative()\n```\n\ninstead of\n\n```\nR[i].dimension()\n```\n\nThere are two places to change this.",
    "created_at": "2018-07-24T00:04:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25460#issuecomment-358833",
    "user": "https://github.com/bhutz"
}
```

docs building and long tests are running...

----

From looking through the code only a few minor things

white space needed

```
dim_prefix = [0,dim[0]] # prefixes dim list

2 places - for i in range(1,len(dim)):

sage: enum_product_projective_number_field(X,bound=1.5)

sage: PP.<x,y,z,w> = ProductProjectiveSpaces([1, 1],GF(3))

sage: PP.<x0,x1,x2,x3> = ProductProjectiveSpaces([1, 1],GF(17))

sage: from sage.schemes.product_projective.rational_point import \
enum_product_projective_finite_field
```


Spelling

```
# add the intial point
```


extra word 'for'

```
Naive algorithms for enumerating rational points over `\QQ`, number fields or
finite fields over *for* general schemes.
```


It won't change anything for these functions but it would be better to use

```
R[i].dimension_relative()
```

instead of

```
R[i].dimension()
```

There are two places to change this.



---

archive/issue_comments_358834.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-24T00:28:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25460#issuecomment-358834",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_358835.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-07-24T09:52:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25460#issuecomment-358835",
    "user": "https://github.com/bhutz"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_064323.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-08-08T18:18:19Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/25460",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25460#event-64323"
}
```



---

archive/issue_comments_358836.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-08-08T18:18:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25460#issuecomment-358836",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
