# Issue 10848: is_gamma0_equiv on Cusps in wrong

Issue created by migration from Trac.

Original creator: wuthrich

Original creation time: 2011-03-13 15:24:57

Assignee: craigcitro

CC:  cremona

Keywords: cusps Gamma0

Here is a simple counter-example.


```
sage: Cusp(1/2).is_gamma0_equiv(1/3,11,transformation=True)
(True, 8)
```


Accoring to the documentation there should be a matrix in Gamma_0(11) sending 1/2 to 1/3 such that the upper left entry is 8. In fact all these matrices are given by


```
[ -3 + 22m    2 - 11m ]
[ 11 + 66m    7 - 33m ]
```


for some integer m.
The problem is that the very last line in the code reduces modulo N.

But while we are at it; it would be better if the matrix is given back rather than one of its coefficients.


---

Attachment

exported against 4.6.2.


---

Comment by wuthrich created at 2011-03-13 22:49:37

Changing status from new to needs_review.


---

Comment by wuthrich created at 2011-03-13 22:49:37

The patch solves the bug. It also changes the output of is_gamma0_equiv. Now, we give back all of the matrix , not just the upper left entry.
The patch does not change the output of _is_equiv in boundary.py of modular_symbols.

The disadvantage is that the computations may be slightly slower, but only by a few gcd calculations at worst. On the other hand I believe that the output now is much more useful for the user.


---

Comment by cremona created at 2011-03-15 17:24:38

Changing status from needs_review to needs_work.


---

Comment by cremona created at 2011-03-15 17:24:38

I approve of the changed output (despite lack of backwards compatibility and the risk of breaking people's code).  This is also consistent with cusps_nf.py (though for some reason there the returned transformation is give as a list [A,B,C,D] instead of an actual matrix).

I do have some other comments, mostly not about the changes (sorry!).

   1. A necessary condition for a1/b1 and a2/b2 to be equivalent is gcd(b1,N)=gcd(b2,N);  this is also sufficient when N is square-free.  So I would test this right at the start.  (In fact one should also check the case of *equality* of the cusps first, since this does occur quite often in practice!)  If no transformation is required then the extra condition needed for sufficiency is s1*b2=s2*b1 (mod gcd(N,b1*b2)) where s1, s2 are the inverses of a1,a2, as in the current code.  I do not really know why the code treats the cases 0/1, 1/0 specially in the definition of s1,s2:  it suffices to use xgcd to write a1*s1+b1*r1=1 and similarly for a2,b1.

   2. There are several occurrences of ZZ(0), ZZ(1).  It is probably more efficient to define zero=ZZ(0), one==ZZ(1) at the start;  even better, use ZZ.zero_element(), ZZ.one(element) since those are cached constants.

Finally, it may well be that the approach I use in the proof of that Lemma is not the most efficient for testing equivalence.

The patch applies fine to 4.7.alpha1 and all tests pass.


---

Comment by wuthrich created at 2011-03-16 10:26:17

I will do these changes. Would you think it better if the optional argument had three values like False, True, "matrix" and would give back None, an integer, a matrix respectively ? This would maintain the backwards compatibility.


---

Comment by wuthrich created at 2011-03-16 14:11:53

exported against 4.6.2; to be applied instead of the previous patch


---

Attachment

exported against 4.6.2; to be applied instead of the previous patches


---

Comment by wuthrich created at 2011-03-16 14:18:13

Changing status from needs_work to needs_review.


---

Comment by wuthrich created at 2011-03-16 14:18:13

Ignore the .2.patch, please.

Now the .3.patch adresses the points made by John. Also I changed it such that it is backwards compatible now. The optional argument can be True or False with the types from before, new it can also be "matrix" in which case the matrix is given back as well. This way also the speed does not slow down for the modular symbol computations.

I am suggesting this new patch for review. Only the .3.patch should be applied.


---

Comment by davidloeffler created at 2011-07-13 16:08:30

Looks good to me.


---

Comment by davidloeffler created at 2011-07-13 16:08:30

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2011-08-02 19:45:01

Resolution: fixed
