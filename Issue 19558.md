# Issue 19558: GAP3 does not have IsIdenticalObject

archive/issues_019558.json:
```json
{
    "body": "CC:  @jaanos @tscrim @anneschilling\n\nLooks like a regression introduced in #19585. Reported at https://groups.google.com/d/msg/sage-devel/MrXp43v3WP4/ju2LwTuvBAAJ\n\n```\nsage: gap=Gap3('/Applications/gap3r4p4/bin/gap')\nsage: gap.RequirePackage('\"specht\"')\n---------------------------------------------------------------------------\nRuntimeError                              Traceback (most recent call last)\n<ipython-input-22-c539883f0214> in <module>()\n----> 1 gap.RequirePackage('\"specht\"')\n\n/Applications/sage/local/lib/python2.7/site-packages/sage/interfaces/interface.pyc in __call__(self, *args, **kwds)\n    605 \n    606     def __call__(self, *args, **kwds):\n--> 607         return self._parent.function_call(self._name, list(args), kwds)\n    608 \n    609     def _sage_doc_(self):\n\n/Applications/sage/local/lib/python2.7/site-packages/sage/interfaces/gap.pyc in function_call(self, function, args, kwds)\n    919             self.eval(marker)\n    920             res = self.eval(cmd)\n--> 921         if self.eval('IsIdenticalObj(last,__SAGE_LAST__)') != 'true':\n    922             return self.new('last2;')\n    923         else:\n\n/Applications/sage/local/lib/python2.7/site-packages/sage/interfaces/gap.pyc in eval(self, x, newlines, strip, split_lines, **kwds)\n    567             if not input_line.endswith(';'):\n    568                 input_line += ';'\n--> 569         result = Expect.eval(self, input_line, **kwds)\n    570         if not newlines:\n    571             result = result.replace(\"\\\\\\n\",\"\")\n\n/Applications/sage/local/lib/python2.7/site-packages/sage/interfaces/expect.pyc in eval(self, code, strip, synchronize, locals, allow_use_file, split_lines, **kwds)\n   1237                 elif split_lines:\n   1238                     return '\\n'.join([self._eval_line(L, allow_use_file=allow_use_file, **kwds)\n-> 1239                                         for L in code.split('\\n') if L != ''])\n   1240                 else:\n   1241                     return self._eval_line(code, allow_use_file=allow_use_file, **kwds)\n\n/Applications/sage/local/lib/python2.7/site-packages/sage/interfaces/gap.pyc in _eval_line(self, line, allow_use_file, wait_for_prompt, restart_if_needed)\n    765                     return ''\n    766             else:\n--> 767                 raise RuntimeError(message)\n    768 \n    769         except KeyboardInterrupt:\n\nRuntimeError: Gap3 produced error output\nError, Variable: 'IsIdenticalObj' must have a value\n\n   executing IsIdenticalObj(last,__SAGE_LAST__);\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/19795\n\n",
    "created_at": "2015-12-28T23:34:13Z",
    "labels": [
        "component: packages: standard",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.0",
    "title": "GAP3 does not have IsIdenticalObject",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19558",
    "user": "https://github.com/vbraun"
}
```
CC:  @jaanos @tscrim @anneschilling

Looks like a regression introduced in #19585. Reported at https://groups.google.com/d/msg/sage-devel/MrXp43v3WP4/ju2LwTuvBAAJ

```
sage: gap=Gap3('/Applications/gap3r4p4/bin/gap')
sage: gap.RequirePackage('"specht"')
---------------------------------------------------------------------------
RuntimeError                              Traceback (most recent call last)
<ipython-input-22-c539883f0214> in <module>()
----> 1 gap.RequirePackage('"specht"')

/Applications/sage/local/lib/python2.7/site-packages/sage/interfaces/interface.pyc in __call__(self, *args, **kwds)
    605 
    606     def __call__(self, *args, **kwds):
--> 607         return self._parent.function_call(self._name, list(args), kwds)
    608 
    609     def _sage_doc_(self):

/Applications/sage/local/lib/python2.7/site-packages/sage/interfaces/gap.pyc in function_call(self, function, args, kwds)
    919             self.eval(marker)
    920             res = self.eval(cmd)
--> 921         if self.eval('IsIdenticalObj(last,__SAGE_LAST__)') != 'true':
    922             return self.new('last2;')
    923         else:

/Applications/sage/local/lib/python2.7/site-packages/sage/interfaces/gap.pyc in eval(self, x, newlines, strip, split_lines, **kwds)
    567             if not input_line.endswith(';'):
    568                 input_line += ';'
--> 569         result = Expect.eval(self, input_line, **kwds)
    570         if not newlines:
    571             result = result.replace("\\\n","")

/Applications/sage/local/lib/python2.7/site-packages/sage/interfaces/expect.pyc in eval(self, code, strip, synchronize, locals, allow_use_file, split_lines, **kwds)
   1237                 elif split_lines:
   1238                     return '\n'.join([self._eval_line(L, allow_use_file=allow_use_file, **kwds)
-> 1239                                         for L in code.split('\n') if L != ''])
   1240                 else:
   1241                     return self._eval_line(code, allow_use_file=allow_use_file, **kwds)

/Applications/sage/local/lib/python2.7/site-packages/sage/interfaces/gap.pyc in _eval_line(self, line, allow_use_file, wait_for_prompt, restart_if_needed)
    765                     return ''
    766             else:
--> 767                 raise RuntimeError(message)
    768 
    769         except KeyboardInterrupt:

RuntimeError: Gap3 produced error output
Error, Variable: 'IsIdenticalObj' must have a value

   executing IsIdenticalObj(last,__SAGE_LAST__);
```


Issue created by migration from https://trac.sagemath.org/ticket/19795





---

archive/issue_comments_268432.json:
```json
{
    "body": "So GAP3 has `IsIdentical`, which was changed to `IsIdenticalObj` in GAP4b3. I think what we need to do is either:\n\n- a subclass of the GAP interpreter for backwards compatibility with GAP3 which just has the one difference in `function_call()`,\n- check the GAP version in the `__init__` and set some private attribute which gets used in `function_call()`, or\n- store the GAP version as an attribute and use an `if` statement in `function_call()`.\n\n`@`aschilling For now you should be able to make that one line change mentioned above to `sage.interfaces.gap.function_call` (but I haven't tested it).",
    "created_at": "2015-12-29T04:32:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19558",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19558#issuecomment-268432",
    "user": "https://github.com/tscrim"
}
```

So GAP3 has `IsIdentical`, which was changed to `IsIdenticalObj` in GAP4b3. I think what we need to do is either:

- a subclass of the GAP interpreter for backwards compatibility with GAP3 which just has the one difference in `function_call()`,
- check the GAP version in the `__init__` and set some private attribute which gets used in `function_call()`, or
- store the GAP version as an attribute and use an `if` statement in `function_call()`.

`@`aschilling For now you should be able to make that one line change mentioned above to `sage.interfaces.gap.function_call` (but I haven't tested it).



---

archive/issue_comments_268433.json:
```json
{
    "body": "Hi!\n\n> - a subclass of the GAP interpreter for backwards compatibility with GAP3 which just has the one difference in `function_call()`,\n\nThere already is a separate class for GAP3 which inherits from `Gap_generic`. The cleanest solution IMO would be to have a method `_identical_function` in `Gap_generic` (parallel to `_equality_symbol` etc.), say:\n\n```python\ndef _identical_function(self):\n    return \"IsIdenticalObj\"\n```\n\nand then have it overridden in `Gap3`.",
    "created_at": "2015-12-29T17:25:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19558",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19558#issuecomment-268433",
    "user": "https://github.com/jaanos"
}
```

Hi!

> - a subclass of the GAP interpreter for backwards compatibility with GAP3 which just has the one difference in `function_call()`,

There already is a separate class for GAP3 which inherits from `Gap_generic`. The cleanest solution IMO would be to have a method `_identical_function` in `Gap_generic` (parallel to `_equality_symbol` etc.), say:

```python
def _identical_function(self):
    return "IsIdenticalObj"
```

and then have it overridden in `Gap3`.



---

archive/issue_comments_268434.json:
```json
{
    "body": "Replying to [comment:3 jaanos]:\n> > - a subclass of the GAP interpreter for backwards compatibility with GAP3 which just has the one difference in `function_call()`,\n> \n> There already is a separate class for GAP3 which inherits from `Gap_generic`.\n\nGood; let us use that.\n\n> The cleanest solution IMO would be to have a method `_identical_function` in `Gap_generic` (parallel to `_equality_symbol` etc.), say:\n> {{{\n> #!python\n> def _identical_function(self):\n>     return \"IsIdenticalObj\"\n> }}}\n> and then have it overridden in `Gap3`.\n\nI think it should be a class-level attribute instead of a method because it speed cost and a method is IMO somewhat overkill (because no work is done).\n\nAnne, can you check to see if this works?\n----\nNew commits:",
    "created_at": "2015-12-29T17:55:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19558",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19558#issuecomment-268434",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:3 jaanos]:
> > - a subclass of the GAP interpreter for backwards compatibility with GAP3 which just has the one difference in `function_call()`,
> 
> There already is a separate class for GAP3 which inherits from `Gap_generic`.

Good; let us use that.

> The cleanest solution IMO would be to have a method `_identical_function` in `Gap_generic` (parallel to `_equality_symbol` etc.), say:
> {{{
> #!python
> def _identical_function(self):
>     return "IsIdenticalObj"
> }}}
> and then have it overridden in `Gap3`.

I think it should be a class-level attribute instead of a method because it speed cost and a method is IMO somewhat overkill (because no work is done).

Anne, can you check to see if this works?
----
New commits:



---

archive/issue_comments_268435.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-12-29T17:55:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19558",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19558#issuecomment-268435",
    "user": "https://github.com/tscrim"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_268436.json:
```json
{
    "body": "Replying to [comment:4 tscrim]:\n> Replying to [comment:3 jaanos]:\n> > > - a subclass of the GAP interpreter for backwards compatibility with GAP3 which just has the one difference in `function_call()`,\n> > \n> > There already is a separate class for GAP3 which inherits from `Gap_generic`.\n> \n> Good; let us use that.\n> \n> > The cleanest solution IMO would be to have a method `_identical_function` in `Gap_generic` (parallel to `_equality_symbol` etc.), say:\n> > {{{\n> > #!python\n> > def _identical_function(self):\n> >     return \"IsIdenticalObj\"\n> > }}}\n> > and then have it overridden in `Gap3`.\n> \n> I think it should be a class-level attribute instead of a method because it speed cost and a method is IMO somewhat overkill (because no work is done).\n> \n> Anne, can you check to see if this works?\n> ----\n> New commits:\n> ||[8ff1fe8](http://git.sagemath.org/sage.git/commit/?id=8ff1fe8c5e9a3c1a3eaff48c4ef6b38333d5a82d)||`Adding an identical function class attribute.`||\n\nWith this branch applied, I still get an error\n\n```\nsage: gap=Gap3('/Applications/gap3r4p4/bin/gap')\nsage: gap.RequirePackage('\"specht\"')\n---------------------------------------------------------------------------\nRuntimeError                              Traceback (most recent call last)\n<ipython-input-2-c539883f0214> in <module>()\n----> 1 gap.RequirePackage('\"specht\"')\n\n/Applications/sage/local/lib/python2.7/site-packages/sage/interfaces/interface.pyc in __call__(self, *args, **kwds)\n    605 \n    606     def __call__(self, *args, **kwds):\n--> 607         return self._parent.function_call(self._name, list(args), kwds)\n    608 \n    609     def _sage_doc_(self):\n\n/Applications/sage/local/lib/python2.7/site-packages/sage/interfaces/gap.pyc in function_call(self, function, args, kwds)\n    920             self.eval(marker)\n    921             res = self.eval(cmd)\n--> 922         if self.eval(self._identical_function + '(last,__SAGE_LAST__)') != 'true':\n    923             return self.new('last2;')\n    924         else:\n\n/Applications/sage/local/lib/python2.7/site-packages/sage/interfaces/gap.pyc in eval(self, x, newlines, strip, split_lines, **kwds)\n    568             if not input_line.endswith(';'):\n    569                 input_line += ';'\n--> 570         result = Expect.eval(self, input_line, **kwds)\n    571         if not newlines:\n    572             result = result.replace(\"\\\\\\n\",\"\")\n\n/Applications/sage/local/lib/python2.7/site-packages/sage/interfaces/expect.pyc in eval(self, code, strip, synchronize, locals, allow_use_file, split_lines, **kwds)\n   1237                 elif split_lines:\n   1238                     return '\\n'.join([self._eval_line(L, allow_use_file=allow_use_file, **kwds)\n-> 1239                                         for L in code.split('\\n') if L != ''])\n   1240                 else:\n   1241                     return self._eval_line(code, allow_use_file=allow_use_file, **kwds)\n\n/Applications/sage/local/lib/python2.7/site-packages/sage/interfaces/gap.pyc in _eval_line(self, line, allow_use_file, wait_for_prompt, restart_if_needed)\n    766                     return ''\n    767             else:\n--> 768                 raise RuntimeError(message)\n    769 \n    770         except KeyboardInterrupt:\n\nRuntimeError: Gap3 produced error output\nError, Variable: 'IsIdenticalObj' must have a value\n\n   executing IsIdenticalObj(last,__SAGE_LAST__);\n```\n\n\nI will be traveling for at least 15 hours now and won't have any internet on the plane ....",
    "created_at": "2015-12-30T00:11:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19558",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19558#issuecomment-268436",
    "user": "https://github.com/anneschilling"
}
```

Replying to [comment:4 tscrim]:
> Replying to [comment:3 jaanos]:
> > > - a subclass of the GAP interpreter for backwards compatibility with GAP3 which just has the one difference in `function_call()`,
> > 
> > There already is a separate class for GAP3 which inherits from `Gap_generic`.
> 
> Good; let us use that.
> 
> > The cleanest solution IMO would be to have a method `_identical_function` in `Gap_generic` (parallel to `_equality_symbol` etc.), say:
> > {{{
> > #!python
> > def _identical_function(self):
> >     return "IsIdenticalObj"
> > }}}
> > and then have it overridden in `Gap3`.
> 
> I think it should be a class-level attribute instead of a method because it speed cost and a method is IMO somewhat overkill (because no work is done).
> 
> Anne, can you check to see if this works?
> ----
> New commits:
> ||[8ff1fe8](http://git.sagemath.org/sage.git/commit/?id=8ff1fe8c5e9a3c1a3eaff48c4ef6b38333d5a82d)||`Adding an identical function class attribute.`||

With this branch applied, I still get an error

```
sage: gap=Gap3('/Applications/gap3r4p4/bin/gap')
sage: gap.RequirePackage('"specht"')
---------------------------------------------------------------------------
RuntimeError                              Traceback (most recent call last)
<ipython-input-2-c539883f0214> in <module>()
----> 1 gap.RequirePackage('"specht"')

/Applications/sage/local/lib/python2.7/site-packages/sage/interfaces/interface.pyc in __call__(self, *args, **kwds)
    605 
    606     def __call__(self, *args, **kwds):
--> 607         return self._parent.function_call(self._name, list(args), kwds)
    608 
    609     def _sage_doc_(self):

/Applications/sage/local/lib/python2.7/site-packages/sage/interfaces/gap.pyc in function_call(self, function, args, kwds)
    920             self.eval(marker)
    921             res = self.eval(cmd)
--> 922         if self.eval(self._identical_function + '(last,__SAGE_LAST__)') != 'true':
    923             return self.new('last2;')
    924         else:

/Applications/sage/local/lib/python2.7/site-packages/sage/interfaces/gap.pyc in eval(self, x, newlines, strip, split_lines, **kwds)
    568             if not input_line.endswith(';'):
    569                 input_line += ';'
--> 570         result = Expect.eval(self, input_line, **kwds)
    571         if not newlines:
    572             result = result.replace("\\\n","")

/Applications/sage/local/lib/python2.7/site-packages/sage/interfaces/expect.pyc in eval(self, code, strip, synchronize, locals, allow_use_file, split_lines, **kwds)
   1237                 elif split_lines:
   1238                     return '\n'.join([self._eval_line(L, allow_use_file=allow_use_file, **kwds)
-> 1239                                         for L in code.split('\n') if L != ''])
   1240                 else:
   1241                     return self._eval_line(code, allow_use_file=allow_use_file, **kwds)

/Applications/sage/local/lib/python2.7/site-packages/sage/interfaces/gap.pyc in _eval_line(self, line, allow_use_file, wait_for_prompt, restart_if_needed)
    766                     return ''
    767             else:
--> 768                 raise RuntimeError(message)
    769 
    770         except KeyboardInterrupt:

RuntimeError: Gap3 produced error output
Error, Variable: 'IsIdenticalObj' must have a value

   executing IsIdenticalObj(last,__SAGE_LAST__);
```


I will be traveling for at least 15 hours now and won't have any internet on the plane ....



---

archive/issue_comments_268437.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-12-30T00:15:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19558",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19558#issuecomment-268437",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_268438.json:
```json
{
    "body": "Whoops. I put it in the wrong place. Try it now.\n\nHave a great flight!",
    "created_at": "2015-12-30T00:15:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19558",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19558#issuecomment-268438",
    "user": "https://github.com/tscrim"
}
```

Whoops. I put it in the wrong place. Try it now.

Have a great flight!



---

archive/issue_comments_268439.json:
```json
{
    "body": "Replying to [comment:7 tscrim]:\n> Whoops. I put it in the wrong place. Try it now.\n\nYes, now it works!\n\n```\nsage: gap=Gap3('/Applications/gap3r4p4/bin/gap')\nsage: gap.RequirePackage('\"specht\"')\n------------------------------------------------------\nSPECHT 3.1 - development edition                      \n    A package for calculating decomposition numbers of\n    Hecke algebras of the symmetric groups and q-Schur\n    algebras.\n\n    This is an unofficial release of SPECHT. There are\n    a significant number of  *undocumented*  functions\n    in this version. Fewer old bugs, and more new bugs\n    are also included.\n\n(C) Andrew Mathas  mathas@maths.usyd.edu.au     Sydney\n------------------------------------------------------\n```\n",
    "created_at": "2015-12-30T17:04:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19558",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19558#issuecomment-268439",
    "user": "https://github.com/anneschilling"
}
```

Replying to [comment:7 tscrim]:
> Whoops. I put it in the wrong place. Try it now.

Yes, now it works!

```
sage: gap=Gap3('/Applications/gap3r4p4/bin/gap')
sage: gap.RequirePackage('"specht"')
------------------------------------------------------
SPECHT 3.1 - development edition                      
    A package for calculating decomposition numbers of
    Hecke algebras of the symmetric groups and q-Schur
    algebras.

    This is an unofficial release of SPECHT. There are
    a significant number of  *undocumented*  functions
    in this version. Fewer old bugs, and more new bugs
    are also included.

(C) Andrew Mathas  mathas@maths.usyd.edu.au     Sydney
------------------------------------------------------
```




---

archive/issue_comments_268440.json:
```json
{
    "body": "Can we consider that a positive review then?",
    "created_at": "2016-01-01T08:52:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19558",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19558#issuecomment-268440",
    "user": "https://github.com/tscrim"
}
```

Can we consider that a positive review then?



---

archive/issue_comments_268441.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-01-01T17:11:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19558",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19558#issuecomment-268441",
    "user": "https://github.com/anneschilling"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_268442.json:
```json
{
    "body": "Changing keywords from \"\" to \"gap\".",
    "created_at": "2016-01-01T17:12:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19558",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19558#issuecomment-268442",
    "user": "https://github.com/anneschilling"
}
```

Changing keywords from "" to "gap".



---

archive/issue_comments_268443.json:
```json
{
    "body": "Replying to [comment:9 tscrim]:\n> Can we consider that a positive review then?\n\nThank you for fixing this! Happy New Year!",
    "created_at": "2016-01-01T17:13:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19558",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19558#issuecomment-268443",
    "user": "https://github.com/anneschilling"
}
```

Replying to [comment:9 tscrim]:
> Can we consider that a positive review then?

Thank you for fixing this! Happy New Year!



---

archive/issue_comments_268444.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-01-02T15:15:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19558",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19558#issuecomment-268444",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_054190.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-01-02T15:15:22Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/19558",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19558#event-54190"
}
```
