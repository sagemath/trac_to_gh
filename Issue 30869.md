# Issue 30869: refresh combinat.py

archive/issues_030869.json:
```json
{
    "body": "CC:  tscrim slelievre\n\n* full flake8\n* some typing annotation\n* using maxima_lib\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/31106\n\n",
    "created_at": "2020-12-25T14:44:01Z",
    "labels": [
        "combinatorics",
        "minor",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.3",
    "title": "refresh combinat.py",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30869",
    "user": "chapoton"
}
```
CC:  tscrim slelievre

* full flake8
* some typing annotation
* using maxima_lib


Issue created by migration from https://trac.sagemath.org/ticket/31106





---

archive/issue_comments_441181.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-12-25T14:44:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30869",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30869#issuecomment-441181",
    "user": "chapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_441182.json:
```json
{
    "body": "New commits:",
    "created_at": "2020-12-25T14:44:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30869",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30869#issuecomment-441182",
    "user": "chapoton"
}
```

New commits:



---

archive/issue_comments_441183.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-12-25T18:18:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30869",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30869#issuecomment-441183",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_441184.json:
```json
{
    "body": "green bot, please review",
    "created_at": "2020-12-26T08:26:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30869",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30869#issuecomment-441184",
    "user": "chapoton"
}
```

green bot, please review



---

archive/issue_comments_441185.json:
```json
{
    "body": "a small possible correction\n\n```diff\n-        if (self.first != self.__first_from_iterator and\n-                self.next != self.__next_from_iterator):\n+        if (self.first != self.__first_from_iterator and\n+            self.next != self.__next_from_iterator):\n```\n\notherwise, LGTM.",
    "created_at": "2020-12-26T10:08:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30869",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30869#issuecomment-441185",
    "user": "dcoudert"
}
```

a small possible correction

```diff
-        if (self.first != self.__first_from_iterator and
-                self.next != self.__next_from_iterator):
+        if (self.first != self.__first_from_iterator and
+            self.next != self.__next_from_iterator):
```

otherwise, LGTM.



---

archive/issue_comments_441186.json:
```json
{
    "body": "ben, je crois que flake8 n'aime pas trop les trucs alignes avec la ligne d'apres..",
    "created_at": "2020-12-26T10:34:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30869",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30869#issuecomment-441186",
    "user": "chapoton"
}
```

ben, je crois que flake8 n'aime pas trop les trucs alignes avec la ligne d'apres..



---

archive/issue_comments_441187.json:
```json
{
    "body": "Ca explique pourquoi emacs aligne par d\u00e9faut comme tu l'as fait.\n\nLGTM.",
    "created_at": "2020-12-26T10:39:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30869",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30869#issuecomment-441187",
    "user": "dcoudert"
}
```

Ca explique pourquoi emacs aligne par défaut comme tu l'as fait.

LGTM.



---

archive/issue_comments_441188.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-12-26T10:39:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30869",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30869#issuecomment-441188",
    "user": "dcoudert"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_441189.json:
```json
{
    "body": "En option, m\u00eame si ce n'est pas le propos principal du ticket,\ndans `bell_number` on pourrait changer `R(-1)` -> `(-R.one())`, comme\nc'est d\u00e9j\u00e0 fait dans `bernoulli_polynomial` pour `ZZ(1)` -> `ZZ.one()`.",
    "created_at": "2020-12-26T12:09:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30869",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30869#issuecomment-441189",
    "user": "slelievre"
}
```

En option, même si ce n'est pas le propos principal du ticket,
dans `bell_number` on pourrait changer `R(-1)` -> `(-R.one())`, comme
c'est déjà fait dans `bernoulli_polynomial` pour `ZZ(1)` -> `ZZ.one()`.



---

archive/issue_comments_441190.json:
```json
{
    "body": "Et dans `euler_number` on pourrait changer\n\n```diff\n-        sage: 2/(exp(x)+exp(-x))\n+        sage: x.cosh().inverse()\n         1 - 1/2*x^2 + 5/24*x^4 - 61/720*x^6 + 277/8064*x^8 + O(x^10)\n```\n\npour gagner quelques microsecondes \u00e0 chaque doctest\n\n```\nsage: sage: x = PowerSeriesRing(QQ, 'x').gen().O(10)\nsage: timeit('2/(exp(x) + exp(-x))')\n625 loops, best of 3: 439 \u03bcs per loop\nsage: timeit('x.cosh().inverse()')\n625 loops, best of 3: 250 \u03bcs per loop\n```\n\nmais je n'insiste bien s\u00fbr pas.",
    "created_at": "2020-12-26T12:18:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30869",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30869#issuecomment-441190",
    "user": "slelievre"
}
```

Et dans `euler_number` on pourrait changer

```diff
-        sage: 2/(exp(x)+exp(-x))
+        sage: x.cosh().inverse()
         1 - 1/2*x^2 + 5/24*x^4 - 61/720*x^6 + 277/8064*x^8 + O(x^10)
```

pour gagner quelques microsecondes à chaque doctest

```
sage: sage: x = PowerSeriesRing(QQ, 'x').gen().O(10)
sage: timeit('2/(exp(x) + exp(-x))')
625 loops, best of 3: 439 μs per loop
sage: timeit('x.cosh().inverse()')
625 loops, best of 3: 250 μs per loop
```

mais je n'insiste bien sûr pas.



---

archive/issue_comments_441191.json:
```json
{
    "body": "Dans `bernoulli_polynomial` on pourrait clarifier ainsi:\n\n\n```diff\n-    coeffs = [0] * k + sum(([n.binomial(i) * bernoulli(n - i), 0]\n-                            for i in range(k, n + 1, 2)), [])\n-    coeffs[-3] = -n / 2\n+    coeffs = [0] * (n + 1)\n+    coeffs[k::2] = (n.binomial(i) * bernoulli(n - i)\n+                    for i in range(k, n + 1, 2))\n+    coeffs[-2] = -n / 2\n```\n",
    "created_at": "2020-12-26T17:51:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30869",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30869#issuecomment-441191",
    "user": "slelievre"
}
```

Dans `bernoulli_polynomial` on pourrait clarifier ainsi:


```diff
-    coeffs = [0] * k + sum(([n.binomial(i) * bernoulli(n - i), 0]
-                            for i in range(k, n + 1, 2)), [])
-    coeffs[-3] = -n / 2
+    coeffs = [0] * (n + 1)
+    coeffs[k::2] = (n.binomial(i) * bernoulli(n - i)
+                    for i in range(k, n + 1, 2))
+    coeffs[-2] = -n / 2
```




---

archive/issue_comments_441192.json:
```json
{
    "body": "Merci pour les suggestions.\nCependant, ces changements ne me paraissent pas tr\u00e8s utiles, donc je pr\u00e9f\u00e8re en rester l\u00e0.",
    "created_at": "2020-12-27T08:51:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30869",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30869#issuecomment-441192",
    "user": "chapoton"
}
```

Merci pour les suggestions.
Cependant, ces changements ne me paraissent pas très utiles, donc je préfère en rester là.



---

archive/issue_comments_441193.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-12-27T23:25:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30869",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30869#issuecomment-441193",
    "user": "vbraun"
}
```

Resolution: fixed
