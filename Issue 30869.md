# Issue 30869: refresh combinat.py

Issue created by migration from https://trac.sagemath.org/ticket/31106

Original creator: chapoton

Original creation time: 2020-12-25 14:44:01

CC:  tscrim slelievre

* full flake8
* some typing annotation
* using maxima_lib



---

Comment by chapoton created at 2020-12-25 14:44:47

Changing status from new to needs_review.


---

Comment by chapoton created at 2020-12-25 14:44:47

New commits:


---

Comment by git created at 2020-12-25 18:18:38

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2020-12-26 08:26:13

green bot, please review


---

Comment by dcoudert created at 2020-12-26 10:08:42

a small possible correction

```diff
-        if (self.first != self.__first_from_iterator and
-                self.next != self.__next_from_iterator):
+        if (self.first != self.__first_from_iterator and
+            self.next != self.__next_from_iterator):
```

otherwise, LGTM.


---

Comment by chapoton created at 2020-12-26 10:34:09

ben, je crois que flake8 n'aime pas trop les trucs alignes avec la ligne d'apres..


---

Comment by dcoudert created at 2020-12-26 10:39:10

Ca explique pourquoi emacs aligne par défaut comme tu l'as fait.

LGTM.


---

Comment by dcoudert created at 2020-12-26 10:39:10

Changing status from needs_review to positive_review.


---

Comment by slelievre created at 2020-12-26 12:09:49

En option, même si ce n'est pas le propos principal du ticket,
dans `bell_number` on pourrait changer `R(-1)` -> `(-R.one())`, comme
c'est déjà fait dans `bernoulli_polynomial` pour `ZZ(1)` -> `ZZ.one()`.


---

Comment by slelievre created at 2020-12-26 12:18:21

Et dans `euler_number` on pourrait changer

```diff
-        sage: 2/(exp(x)+exp(-x))
+        sage: x.cosh().inverse()
         1 - 1/2*x^2 + 5/24*x^4 - 61/720*x^6 + 277/8064*x^8 + O(x^10)
```

pour gagner quelques microsecondes à chaque doctest

```
sage: sage: x = PowerSeriesRing(QQ, 'x').gen().O(10)
sage: timeit('2/(exp(x) + exp(-x))')
625 loops, best of 3: 439 μs per loop
sage: timeit('x.cosh().inverse()')
625 loops, best of 3: 250 μs per loop
```

mais je n'insiste bien sûr pas.


---

Comment by slelievre created at 2020-12-26 17:51:42

Dans `bernoulli_polynomial` on pourrait clarifier ainsi:


```diff
-    coeffs = [0] * k + sum(([n.binomial(i) * bernoulli(n - i), 0]
-                            for i in range(k, n + 1, 2)), [])
-    coeffs[-3] = -n / 2
+    coeffs = [0] * (n + 1)
+    coeffs[k::2] = (n.binomial(i) * bernoulli(n - i)
+                    for i in range(k, n + 1, 2))
+    coeffs[-2] = -n / 2
```



---

Comment by chapoton created at 2020-12-27 08:51:19

Merci pour les suggestions.
Cependant, ces changements ne me paraissent pas très utiles, donc je préfère en rester là.


---

Comment by vbraun created at 2020-12-27 23:25:26

Resolution: fixed
