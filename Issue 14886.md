# Issue 14886: autotools package

Issue created by migration from https://trac.sagemath.org/ticket/15123

Original creator: felixs

Original creation time: 2013-08-30 06:42:33

CC:  jondo

Keywords: autotools package git

When building from git, autotools is required to build sagelib. The autotools package in `u/ohnar/optional` almost works.


---

Comment by felixs created at 2013-08-30 06:42:50

Changing type from PLEASE CHANGE to enhancement.


---

Comment by git created at 2013-09-02 11:20:26

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by felixs created at 2013-09-03 08:15:22

`u/felixs/autotools` is dark red with "failed to determine common ancestor". That shouldn't be a problen, since no existing files are involved.


---

Comment by felixs created at 2013-09-03 08:15:22

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2013-09-04 08:25:09

What will happen with files like `spkg-write-makefile`? Will they still be part of the new spkg? They should be, because they are required to update the spkg.


---

Comment by felixs created at 2013-09-04 08:53:26

Replying to [comment:5 jdemeyer]:
> What will happen with files like `spkg-write-makefile`? Will they still be part of the new spkg? They should be, because they are required to update the spkg.

I didn't remove anything. e.g. `spkg-write-makefile` is still there and that makes sense. I just added the generated makefile, so I can build the package.

... or I didn't understand your question (sorry then).


---

Comment by jdemeyer created at 2013-12-29 18:16:36

Needs to be rebased.


---

Comment by jdemeyer created at 2013-12-29 18:16:36

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2014-01-14 17:16:07

New commits:


---

Comment by git created at 2014-01-14 17:40:15

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2014-01-14 17:40:36

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2014-01-15 10:33:26

This is a simple update and conversion to git which doesn't require the new build system.


---

Comment by git created at 2014-01-15 10:36:01

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by felixs created at 2014-01-15 11:32:54

autotools is worthless without executables named $program-$version. take any autogenerated makefile and look out for `AUTOMAKE=.*` or `ACLOCAL=.*`. these are used whenever autogenerated files need to be refreshed.

please readd my patch that provides those executables (or switch to a sane build process that correctly uses --program-suffix as intended upstream).

(yes 14804 is not required. note that 14804 is *not* a new build system but helper scripts that will also enhance the old one.)

thanks


---

Comment by jdemeyer created at 2014-01-15 13:30:41

Replying to [comment:17 felixs]:
> autotools is worthless without executables named $program-$version.
That's far from true, I have used this package many times. Perhaps the exacutables you mention are indeed needed for `automake` rules, but "worthless" is certainly not the right word.

> please readd my patch that provides those executables
I'm certainly not going to add your exact patch as it has some comments which sound offending (I assume the comment `next time RTFM` in `autofoo` is addressed at me). If you want to add comments, better make them say something useful such that people can understand the purpose of the code.

More to the point: I think those version numbers are surely also needed for `aclocal` (and perhaps only for `automake` and `aclocal`?) and it seems your patch doesn't add those.

TL;DR: stop offending people, stop thinking your opinion is the One and Only Truth. Then people will be more willing to work with your patches.


---

Comment by felixs created at 2014-01-15 13:57:06

Replying to [comment:18 jdemeyer]:
> Replying to [comment:17 felixs]:
> > autotools is worthless without executables named $program-$version.
> That's far from true, I have used this package many times. Perhaps the exacutables you mention are indeed needed for `automake` rules, but "worthless" is certainly not the right word.

recreating Makefiles is done via `automake` rules. worthless is a bit underrating, but it shouldn't require sage-autotools-environment-variable-expert-knowledge to get something simple done.

> I'm certainly not going to add your exact patch as it has some comments which sound offending (I assume the comment `next time RTFM` in `autofoo` is addressed at me). If you want to add comments, better make them say something useful such that people can understand the purpose of the code.

it took me two days to figure out and fix the autotools package, just for the sake of testing my demo on boxen. i was pretty pissed about the time wasted.

> More to the point: I think those version numbers are surely also needed for `aclocal` (and perhaps only for `automake` and `aclocal`?) and it seems your patch doesn't add those.

yes. it would be better to rewrite the autotools package. i almost had when i found the spkg :|

> TL;DR: stop offending people, stop thinking your opinion is the One and Only Truth. Then people will be more willing to work with your patches.

my apologies about the offense. maybe i should have removed the comment timely. apparently i didn't. i hope you still enjoy reading fine manuals :)


---

Comment by jpflori created at 2014-01-15 21:37:46

The new package works fine.
Just one question: why was the history in SPKG.Txt removed?
Ok, it's not so useful, but...

And I won't go through the flamewar here, I just want an uptodate, working, gitified autotools pkgs whic can be used to (be able to) produce (minimal) patches for sage dev.
Anything else can be postponed to a follow-up ticket.


---

Comment by jpflori created at 2014-01-15 21:37:46

Changing status from needs_review to needs_info.


---

Comment by jdemeyer created at 2014-01-15 22:09:50

Replying to [comment:20 jpflori]:
> The new package works fine.
> Just one question: why was the history in SPKG.Txt removed?
I think Volker told me that the history in `SPKG.txt` isn't going to be used anymore since the `git` transition.


---

Comment by jdemeyer created at 2014-01-15 22:09:59

Changing status from needs_info to needs_review.


---

Comment by jpflori created at 2014-01-15 22:16:24

Hummm, this means one will have to use git and scripting rather than opening a text file to get a quick overview of what happened to the package?
And what about ancien history where the automagically git commits taken from mercurial commits don't necessarily reflect what used to be indicated in the history part of SPKG.txt?
I expect to have to fight with Volker, but I don't really think its the best idea...


---

Comment by jdemeyer created at 2014-01-15 22:21:44

Replying to [comment:23 jpflori]:
> Hummm, this means one will have to use git and scripting rather than opening a text file to get a quick overview of what happened to the package?
> And what about ancien history where the automagically git commits taken from mercurial commits don't necessarily reflect what used to be indicated in the history part of SPKG.txt?
> I expect to have to fight with Volker, but I don't really think its the best idea...
I agree with Volker that having the same information in multiple places (version numbers, history) will lead to mistakes. For example, my Mercurial-era release management script checked that the version number in `SPKG.txt` matched the actual version number. You should see how many times that failed... If the information is not there, then it cannot be wrong.

Old `SPKG.txt` history can still be retrieved using the usual `git` tools.


---

Comment by jpflori created at 2014-01-15 22:25:33

Changing status from needs_review to positive_review.


---

Comment by jpflori created at 2014-01-15 22:25:33

Ok, two against one :)
(Then I guess we could get rid of the .p? part of package version as well and just check for changes in the build/pkgs/?/ folder to decide to rebuild a pkg.)


---

Comment by felixs created at 2014-01-15 22:28:17

`u/felixs/ticket/prior_15123` now points to my old branch rebased onto the ticket branch
to be on the safe side, i have removed (as in 'edited history') anything that might look offensive.

Replying to [comment:20 jpflori]:
> Anything else can be postponed to a follow-up ticket.

that's fine with me.


---

Comment by jdemeyer created at 2014-01-15 22:31:37

felixs, do you want to create a follow-up ticket for that?


---

Comment by felixs created at 2014-01-15 23:00:13

Replying to [comment:27 jdemeyer]:
> felixs, do you want to create a follow-up ticket for that?

if it turns out to make sense. i am unsure. i consider the package far too complex and nonstandard (wrt to how other packages work and wrt how autotools packages work on other platforms). perhaps it should better be replaced by simpler packages with simpler build rules...

maybe time will tell. but don't wait for me.

thanks


---

Comment by jdemeyer created at 2014-01-16 10:56:25

Replying to [comment:25 jpflori]:
> and just check for changes in the build/pkgs/?/ folder to decide to rebuild a pkg.
How would you "just check" for that?


---

Comment by jpflori created at 2014-01-16 10:57:05

Using git :)


---

Comment by jpflori created at 2014-01-16 10:58:45

Or just timestamps now things are not within a tarball anymore.


---

Comment by jdemeyer created at 2014-01-16 12:33:42

Replying to [comment:31 jpflori]:
> Or just timestamps now things are not within a tarball anymore.
"just timestamps"... timestamps of what? There isn't a single file who's timestamp could be used. Using multiple files (or all files under `build/pkgs/$PKG`) makes the implementation harder...


---

Comment by jpflori created at 2014-01-16 13:47:20

Come on, let's just stop that senseless discussion, that was just a joke (though with Makefile magic it should not be impossible to add all files within a directory as dependencies of a target).


---

Comment by jdemeyer created at 2014-01-16 14:26:42

Replying to [comment:33 jpflori]:
> Come on, let's just stop that senseless discussion

> though with Makefile magic it should not be impossible to add all files within a directory as dependencies of a target.

I hope you see the contradiction between these two sentences...


---

Comment by vbraun created at 2014-02-01 19:39:25

Resolution: fixed
