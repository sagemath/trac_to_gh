# Issue 23969: py3: change in CoercionException

Issue created by migration from Trac.

Original creator: chapoton

Original creation time: 2017-11-12 15:13:17

CC:  tscrim jdemeyer

make it inherit from BaseException


---

Comment by chapoton created at 2017-11-12 15:13:47

New commits:


---

Comment by chapoton created at 2017-11-12 15:13:47

Changing status from new to needs_review.


---

Comment by tscrim created at 2017-11-12 22:38:50

It already does that by inheriting from `TypeError` in both [Python2](https://docs.python.org/2/library/exceptions.html#exception-hierarchy) and [Python3](https://docs.python.org/3/library/exceptions.html#exception-hierarchy). So I don't understand what this ticket would change other than putting `BaseException` higher in the MRO.


---

Comment by chapoton created at 2017-11-13 07:00:06

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2017-11-13 07:00:06

ok, then ket us forget about that.


---

Comment by jdemeyer created at 2017-11-13 11:14:28

Resolution: invalid


---

Comment by chapoton created at 2017-11-20 09:57:23

I can now confirm that this hurts, because of lazy import.

In a python3 build sage, when

```
sage: C=Cone([[1,2],[33,-1]])
sage: C.face_lattice()
```

first call gives

```
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/categories/pushout.py in pushout(R, S)
   3987 
-> 3988         return all(Z)
   3989 

/home/chapoton/sage3/src/sage/categories/functor.pyx in sage.categories.functor.Functor.__call__ (build/cythonized/sage/categories/functor.c:3156)()

/home/chapoton/sage3/src/sage/categories/functor.pyx in sage.categories.functor.Functor._coerce_into_domain (build/cythonized/sage/categories/functor.c:2798)()

TypeError: x (=None) is not in Category of sets

During handling of the above exception, another exception occurred:

TypeError                                 Traceback (most recent call last)
<ipython-input-37-92b0fcd27f13> in <module>()
----> 1 C.face_lattice()

/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/geometry/cone.py in face_lattice(self)
   2354                 atom_to_ray = []
   2355                 atom_to_facets = []
-> 2356                 normals = self.facet_normals()
   2357                 facet_to_atoms = [[] for normal in normals]
   2358                 for i, ray in enumerate(self):

/home/chapoton/sage3/src/sage/misc/cachefunc.pyx in sage.misc.cachefunc.CachedMethodCallerNoArgs.__call__ (build/cythonized/sage/misc/cachefunc.c:13511)()

/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/geometry/cone.py in facet_normals(self)
   2659         if len(normals) > 1:
   2660             # Sort normals if they are rays
-> 2661             if self.dim() == 2 and normals[0]*self.ray(0) != 0:
   2662                 normals = (normals[1], normals[0])
   2663             else:

/home/chapoton/sage3/src/sage/structure/element.pyx in sage.structure.element.Vector.__mul__ (build/cythonized/sage/structure/element.c:20532)()

/home/chapoton/sage3/src/sage/structure/coerce.pyx in sage.structure.coerce.CoercionModel_cache_maps.bin_op (build/cythonized/sage/structure/coerce.c:9502)()

/home/chapoton/sage3/src/sage/structure/coerce.pyx in sage.structure.coerce.CoercionModel_cache_maps.get_action (build/cythonized/sage/structure/coerce.c:16769)()

/home/chapoton/sage3/src/sage/structure/coerce.pyx in sage.structure.coerce.CoercionModel_cache_maps.discover_action (build/cythonized/sage/structure/coerce.c:18328)()

/home/chapoton/sage3/src/sage/structure/parent.pyx in sage.structure.parent.Parent.get_action (build/cythonized/sage/structure/parent.c:21462)()

/home/chapoton/sage3/src/sage/structure/parent.pyx in sage.structure.parent.Parent.discover_action (build/cythonized/sage/structure/parent.c:22761)()

/home/chapoton/sage3/src/sage/structure/coerce_actions.pyx in sage.structure.coerce_actions.detect_element_action (build/cythonized/sage/structure/coerce_actions.c:5640)()

/home/chapoton/sage3/src/sage/structure/coerce_actions.pyx in sage.structure.coerce_actions.ModuleAction.__init__ (build/cythonized/sage/structure/coerce_actions.c:6527)()

/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/categories/pushout.py in pushout(R, S)
   3988         return all(Z)
   3989 
-> 3990     except CoercionException:
   3991         raise
   3992     except (TypeError, ValueError, AttributeError, NotImplementedError) as ex:

TypeError: catching classes that do not inherit from BaseException is not allowed

```

