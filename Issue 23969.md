# Issue 23969: py3: change in CoercionException

archive/issues_023969.json:
```json
{
    "body": "CC:  @tscrim @jdemeyer\n\nmake it inherit from BaseException\n\nIssue created by migration from https://trac.sagemath.org/ticket/24206\n\n",
    "created_at": "2017-11-12T15:13:17Z",
    "labels": [
        "component: python3"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "py3: change in CoercionException",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23969",
    "user": "https://github.com/fchapoton"
}
```
CC:  @tscrim @jdemeyer

make it inherit from BaseException

Issue created by migration from https://trac.sagemath.org/ticket/24206





---

archive/issue_comments_335375.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-11-12T15:13:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23969#issuecomment-335375",
    "user": "https://github.com/fchapoton"
}
```

New commits:



---

archive/issue_comments_335376.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-11-12T15:13:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23969#issuecomment-335376",
    "user": "https://github.com/fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_335377.json:
```json
{
    "body": "It already does that by inheriting from `TypeError` in both [Python2](https://docs.python.org/2/library/exceptions.html#exception-hierarchy) and [Python3](https://docs.python.org/3/library/exceptions.html#exception-hierarchy). So I don't understand what this ticket would change other than putting `BaseException` higher in the MRO.",
    "created_at": "2017-11-12T22:38:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23969#issuecomment-335377",
    "user": "https://github.com/tscrim"
}
```

It already does that by inheriting from `TypeError` in both [Python2](https://docs.python.org/2/library/exceptions.html#exception-hierarchy) and [Python3](https://docs.python.org/3/library/exceptions.html#exception-hierarchy). So I don't understand what this ticket would change other than putting `BaseException` higher in the MRO.



---

archive/issue_comments_335378.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-11-13T07:00:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23969#issuecomment-335378",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_061338.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-11-13T07:00:06Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/23969",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23969#event-61338"
}
```



---

archive/issue_comments_335379.json:
```json
{
    "body": "ok, then ket us forget about that.",
    "created_at": "2017-11-13T07:00:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23969#issuecomment-335379",
    "user": "https://github.com/fchapoton"
}
```

ok, then ket us forget about that.



---

archive/issue_comments_335380.json:
```json
{
    "body": "Resolution: invalid",
    "created_at": "2017-11-13T11:14:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23969#issuecomment-335380",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: invalid



---

archive/issue_events_061339.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-11-13T11:14:28Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/23969",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23969#event-61339"
}
```



---

archive/issue_comments_335381.json:
```json
{
    "body": "I can now confirm that this hurts, because of lazy import.\n\nIn a python3 build sage, when\n\n```\nsage: C=Cone([[1,2],[33,-1]])\nsage: C.face_lattice()\n```\n\nfirst call gives\n\n```\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/categories/pushout.py in pushout(R, S)\n   3987 \n-> 3988         return all(Z)\n   3989 \n\n/home/chapoton/sage3/src/sage/categories/functor.pyx in sage.categories.functor.Functor.__call__ (build/cythonized/sage/categories/functor.c:3156)()\n\n/home/chapoton/sage3/src/sage/categories/functor.pyx in sage.categories.functor.Functor._coerce_into_domain (build/cythonized/sage/categories/functor.c:2798)()\n\nTypeError: x (=None) is not in Category of sets\n\nDuring handling of the above exception, another exception occurred:\n\nTypeError                                 Traceback (most recent call last)\n<ipython-input-37-92b0fcd27f13> in <module>()\n----> 1 C.face_lattice()\n\n/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/geometry/cone.py in face_lattice(self)\n   2354                 atom_to_ray = []\n   2355                 atom_to_facets = []\n-> 2356                 normals = self.facet_normals()\n   2357                 facet_to_atoms = [[] for normal in normals]\n   2358                 for i, ray in enumerate(self):\n\n/home/chapoton/sage3/src/sage/misc/cachefunc.pyx in sage.misc.cachefunc.CachedMethodCallerNoArgs.__call__ (build/cythonized/sage/misc/cachefunc.c:13511)()\n\n/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/geometry/cone.py in facet_normals(self)\n   2659         if len(normals) > 1:\n   2660             # Sort normals if they are rays\n-> 2661             if self.dim() == 2 and normals[0]*self.ray(0) != 0:\n   2662                 normals = (normals[1], normals[0])\n   2663             else:\n\n/home/chapoton/sage3/src/sage/structure/element.pyx in sage.structure.element.Vector.__mul__ (build/cythonized/sage/structure/element.c:20532)()\n\n/home/chapoton/sage3/src/sage/structure/coerce.pyx in sage.structure.coerce.CoercionModel_cache_maps.bin_op (build/cythonized/sage/structure/coerce.c:9502)()\n\n/home/chapoton/sage3/src/sage/structure/coerce.pyx in sage.structure.coerce.CoercionModel_cache_maps.get_action (build/cythonized/sage/structure/coerce.c:16769)()\n\n/home/chapoton/sage3/src/sage/structure/coerce.pyx in sage.structure.coerce.CoercionModel_cache_maps.discover_action (build/cythonized/sage/structure/coerce.c:18328)()\n\n/home/chapoton/sage3/src/sage/structure/parent.pyx in sage.structure.parent.Parent.get_action (build/cythonized/sage/structure/parent.c:21462)()\n\n/home/chapoton/sage3/src/sage/structure/parent.pyx in sage.structure.parent.Parent.discover_action (build/cythonized/sage/structure/parent.c:22761)()\n\n/home/chapoton/sage3/src/sage/structure/coerce_actions.pyx in sage.structure.coerce_actions.detect_element_action (build/cythonized/sage/structure/coerce_actions.c:5640)()\n\n/home/chapoton/sage3/src/sage/structure/coerce_actions.pyx in sage.structure.coerce_actions.ModuleAction.__init__ (build/cythonized/sage/structure/coerce_actions.c:6527)()\n\n/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/categories/pushout.py in pushout(R, S)\n   3988         return all(Z)\n   3989 \n-> 3990     except CoercionException:\n   3991         raise\n   3992     except (TypeError, ValueError, AttributeError, NotImplementedError) as ex:\n\nTypeError: catching classes that do not inherit from BaseException is not allowed\n\n```\n",
    "created_at": "2017-11-20T09:57:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23969#issuecomment-335381",
    "user": "https://github.com/fchapoton"
}
```

I can now confirm that this hurts, because of lazy import.

In a python3 build sage, when

```
sage: C=Cone([[1,2],[33,-1]])
sage: C.face_lattice()
```

first call gives

```
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/categories/pushout.py in pushout(R, S)
   3987 
-> 3988         return all(Z)
   3989 

/home/chapoton/sage3/src/sage/categories/functor.pyx in sage.categories.functor.Functor.__call__ (build/cythonized/sage/categories/functor.c:3156)()

/home/chapoton/sage3/src/sage/categories/functor.pyx in sage.categories.functor.Functor._coerce_into_domain (build/cythonized/sage/categories/functor.c:2798)()

TypeError: x (=None) is not in Category of sets

During handling of the above exception, another exception occurred:

TypeError                                 Traceback (most recent call last)
<ipython-input-37-92b0fcd27f13> in <module>()
----> 1 C.face_lattice()

/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/geometry/cone.py in face_lattice(self)
   2354                 atom_to_ray = []
   2355                 atom_to_facets = []
-> 2356                 normals = self.facet_normals()
   2357                 facet_to_atoms = [[] for normal in normals]
   2358                 for i, ray in enumerate(self):

/home/chapoton/sage3/src/sage/misc/cachefunc.pyx in sage.misc.cachefunc.CachedMethodCallerNoArgs.__call__ (build/cythonized/sage/misc/cachefunc.c:13511)()

/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/geometry/cone.py in facet_normals(self)
   2659         if len(normals) > 1:
   2660             # Sort normals if they are rays
-> 2661             if self.dim() == 2 and normals[0]*self.ray(0) != 0:
   2662                 normals = (normals[1], normals[0])
   2663             else:

/home/chapoton/sage3/src/sage/structure/element.pyx in sage.structure.element.Vector.__mul__ (build/cythonized/sage/structure/element.c:20532)()

/home/chapoton/sage3/src/sage/structure/coerce.pyx in sage.structure.coerce.CoercionModel_cache_maps.bin_op (build/cythonized/sage/structure/coerce.c:9502)()

/home/chapoton/sage3/src/sage/structure/coerce.pyx in sage.structure.coerce.CoercionModel_cache_maps.get_action (build/cythonized/sage/structure/coerce.c:16769)()

/home/chapoton/sage3/src/sage/structure/coerce.pyx in sage.structure.coerce.CoercionModel_cache_maps.discover_action (build/cythonized/sage/structure/coerce.c:18328)()

/home/chapoton/sage3/src/sage/structure/parent.pyx in sage.structure.parent.Parent.get_action (build/cythonized/sage/structure/parent.c:21462)()

/home/chapoton/sage3/src/sage/structure/parent.pyx in sage.structure.parent.Parent.discover_action (build/cythonized/sage/structure/parent.c:22761)()

/home/chapoton/sage3/src/sage/structure/coerce_actions.pyx in sage.structure.coerce_actions.detect_element_action (build/cythonized/sage/structure/coerce_actions.c:5640)()

/home/chapoton/sage3/src/sage/structure/coerce_actions.pyx in sage.structure.coerce_actions.ModuleAction.__init__ (build/cythonized/sage/structure/coerce_actions.c:6527)()

/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/categories/pushout.py in pushout(R, S)
   3988         return all(Z)
   3989 
-> 3990     except CoercionException:
   3991         raise
   3992     except (TypeError, ValueError, AttributeError, NotImplementedError) as ex:

TypeError: catching classes that do not inherit from BaseException is not allowed

```

