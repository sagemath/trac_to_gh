# Issue 13655: Failure in gp pexpect interface when $COLUMN is exported to Sage

Issue created by migration from https://trac.sagemath.org/ticket/13859

Original creator: strogdon

Original creation time: 2012-12-23 04:32:43

Assignee: was

Keywords: gp pexpect

On certain operation systems (e.g. Debian) the $COLUMNS variable is exported to the Sage shell. This variable can interferes with the gp pexpect interface when $COLUMNS > 80 as indicated by the following:

```
sage: dict(os.environ)["COLUMNS"]
'91'
```



```
sage -t -long -force_lib "devel/sage-main/sage/schemes/elliptic_curves/ell_number_field.py"
**********************************************************************
File "/storage/sage/sage-5.5.rc1/devel/sage-main/sage/schemes/elliptic_curves/ell_number_field.py", line 277:
    sage: E.simon_two_descent()
Expected:
    Traceback (most recent call last):
    ...
    RuntimeError:
      ***   at top-level: ans=bnfellrank(K,[0,0,1,
      ***                     ^--------------------
      ***   in function bnfellrank: ...eqtheta,rnfeq,bbnf];rang=
      ***   bnfell2descent_gen(b
      ***   ^--------------------
      ***   in function bnfell2descent_gen: ...riv,r=nfsqrt(nf,norm(zc))
      ***   [1];if(DEBUGLEVEL_el
      ***   ^--------------------
      ***   array index (1) out of allowed range [none].
    An error occurred while running Simon's 2-descent program
Got:
    Traceback (most recent call last):
      File "/storage/sage/sage-5.5.rc1/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/storage/sage/sage-5.5.rc1/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/storage/sage/sage-5.5.rc1/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_3[17]>", line 1, in <module>
        E.simon_two_descent()###line 277:
    sage: E.simon_two_descent()
      File "/storage/sage/sage-5.5.rc1/local/lib/python/site-packages/sage/schemes/elliptic_curves/ell_number_field.py", line 305, in simon_two_descent
        maxprob=maxprob, limbigprime=limbigprime)
      File "/storage/sage/sage-5.5.rc1/local/lib/python/site-packages/sage/schemes/elliptic_curves/gp_simon.py", line 102, in simon_two_descent
        raise RuntimeError, "\n%s\nAn error occurred while running Simon's 2-descent program"%s
    RuntimeError: 
      ***   at top-level: ans=bnfellrank(K,[0,0,1,
      ***                     ^--------------------
      ***   in function bnfellrank: ...eqtheta,rnfeq,bbnf];rang=bnfell2descent_gen(b
      ***                                                       ^--------------------
      ***   in function bnfell2descent_gen: ...riv,r=nfsqrt(nf,norm(zc))[1];if(DEBUGLEVEL_el
      ***                                                               ^--------------------
      ***   array index (1) out of allowed range [none].
    An error occurred while running Simon's 2-descent program
**********************************************************************
```


and with

```
sage: dict(os.environ)["COLUMNS"]
'80'
```



```
sage -t -long -force_lib "devel/sage-main/sage/schemes/elliptic_curves/ell_number_field.py"
         [46.1 s]
 
----------------------------------------------------------------------
All tests passed!
```



---

Attachment

apply pexpect_unset_COLUMNS.patch


---

Comment by jdemeyer created at 2012-12-23 20:42:19

Changing type from PLEASE CHANGE to defect.


---

Comment by jdemeyer created at 2012-12-23 20:50:51

I assume this is ready for review? It looks good to me...


---

Comment by jdemeyer created at 2012-12-23 20:50:51

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2012-12-23 20:50:57

Changing status from needs_review to positive_review.


---

Attachment


---

Comment by jdemeyer created at 2012-12-23 20:54:11

Changing status from positive_review to needs_work.


---

Comment by jdemeyer created at 2012-12-23 20:54:30

My comment patch needs review.


---

Comment by jdemeyer created at 2012-12-23 20:54:30

Changing status from needs_work to needs_review.


---

Comment by strogdon created at 2012-12-23 21:47:52

The comments are good.


---

Comment by strogdon created at 2012-12-23 21:47:52

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2012-12-29 19:31:55

Resolution: fixed
