# Issue 16323: Upgrade lrcalc to 1.1.7

archive/issues_016323.json:
```json
{
    "body": "Assignee: sage-combinat\n\nCC:  sage-combinat nthiery\n\nKeywords: lrcalc\n\nUsing the upstream based off of here: http://www.math.rutgers.edu/~asbuch/lrcalc/\n\nThis should (help) fix #14625.\n\nIssue created by migration from https://trac.sagemath.org/ticket/16560\n\n",
    "created_at": "2014-06-27T00:47:59Z",
    "labels": [
        "packages: standard",
        "major",
        "enhancement"
    ],
    "title": "Upgrade lrcalc to 1.1.7",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16323",
    "user": "tscrim"
}
```
Assignee: sage-combinat

CC:  sage-combinat nthiery

Keywords: lrcalc

Using the upstream based off of here: http://www.math.rutgers.edu/~asbuch/lrcalc/

This should (help) fix #14625.

Issue created by migration from https://trac.sagemath.org/ticket/16560





---

archive/issue_comments_213832.json:
```json
{
    "body": "Attachment",
    "created_at": "2014-06-27T00:48:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16323",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16323#issuecomment-213832",
    "user": "tscrim"
}
```

Attachment



---

archive/issue_comments_213833.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-06-27T00:50:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16323",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16323#issuecomment-213833",
    "user": "tscrim"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_213834.json:
```json
{
    "body": "Running tests now...",
    "created_at": "2014-06-27T00:50:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16323",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16323#issuecomment-213834",
    "user": "tscrim"
}
```

Running tests now...



---

archive/issue_comments_213835.json:
```json
{
    "body": "All (long) tests pass for me.",
    "created_at": "2014-06-27T01:17:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16323",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16323#issuecomment-213835",
    "user": "tscrim"
}
```

All (long) tests pass for me.



---

archive/issue_comments_213836.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-06-27T01:17:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16323",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16323#issuecomment-213836",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_213837.json:
```json
{
    "body": "So the only difference between the two upstream tarballs is that one of them is properly autool=ed and the other is not?",
    "created_at": "2014-06-27T02:35:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16323",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16323#issuecomment-213837",
    "user": "fbissey"
}
```

So the only difference between the two upstream tarballs is that one of them is properly autool=ed and the other is not?



---

archive/issue_comments_213838.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-06-27T02:37:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16323",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16323#issuecomment-213838",
    "user": "fbissey"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_213839.json:
```json
{
    "body": "This version has otherwise been in use in sage-on-gentoo since December without any reported issue so I am putting that positive review.",
    "created_at": "2014-06-27T02:37:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16323",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16323#issuecomment-213839",
    "user": "fbissey"
}
```

This version has otherwise been in use in sage-on-gentoo since December without any reported issue so I am putting that positive review.



---

archive/issue_comments_213840.json:
```json
{
    "body": "Replying to [comment:4 fbissey]:\n> So the only difference between the two upstream tarballs is that one of them is properly autool=ed and the other is not?\n\nNicolas would be the best one to answer that since he helped create it.\n\nThanks for doing the review.",
    "created_at": "2014-06-27T03:21:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16323",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16323#issuecomment-213840",
    "user": "tscrim"
}
```

Replying to [comment:4 fbissey]:
> So the only difference between the two upstream tarballs is that one of them is properly autool=ed and the other is not?

Nicolas would be the best one to answer that since he helped create it.

Thanks for doing the review.



---

archive/issue_comments_213841.json:
```json
{
    "body": "Replying to [comment:6 tscrim]:\n> Replying to [comment:4 fbissey]:\n> > So the only difference between the two upstream tarballs is that one of them is properly autool=ed and the other is not?\n> \n> Nicolas would be the best one to answer that since he helped create it.\n\nAs far as I remember, yes. And this one is an official release by Anders rather than a tarball produced by myself.",
    "created_at": "2014-06-27T23:56:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16323",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16323#issuecomment-213841",
    "user": "nthiery"
}
```

Replying to [comment:6 tscrim]:
> Replying to [comment:4 fbissey]:
> > So the only difference between the two upstream tarballs is that one of them is properly autool=ed and the other is not?
> 
> Nicolas would be the best one to answer that since he helped create it.

As far as I remember, yes. And this one is an official release by Anders rather than a tarball produced by myself.



---

archive/issue_comments_213842.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2014-06-28T12:47:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16323",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16323#issuecomment-213842",
    "user": "vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_213843.json:
```json
{
    "body": "Fails on OSX\n\n```\nlibtool: link: gcc -dynamiclib -Wl,-undefined -Wl,dynamic_lookup -o .libs/liblrcalc.1.dylib   -Wl,-force_load,mathlib/.libs/libmath.a -Wl,-force_load,lrcoef/.libs/libsymfcn.a -Wl,-force_load,schubert/.libs/libschub.a   -O2   -install_name  /Users/buildslave-sage/slave/sage_git/build/local/lib/liblrcalc.1.dylib -compatibility_version 2 -current_version 2.0 -Wl,-single_module\nduplicate symbol _lrcalc_panic_frame in:\n    mathlib/.libs/libmath.a(alloc.o)\n    mathlib/.libs/libmath.a(hashtab.o)\nduplicate symbol _lrcalc_panic_frame in:\n    mathlib/.libs/libmath.a(alloc.o)\n    mathlib/.libs/libmath.a(list.o)\nduplicate symbol _lrcalc_panic_frame in:\n    mathlib/.libs/libmath.a(alloc.o)\n    mathlib/.libs/libmath.a(set.o)\nduplicate symbol _lrcalc_panic_frame in:\n    mathlib/.libs/libmath.a(alloc.o)\n    mathlib/.libs/libmath.a(vectarg.o)\nduplicate symbol _lrcalc_panic_frame in:\n    mathlib/.libs/libmath.a(alloc.o)\n    mathlib/.libs/libmath.a(vector.o)\nduplicate symbol _lrcalc_panic_frame in:\n    mathlib/.libs/libmath.a(alloc.o)\n    lrcoef/.libs/libsymfcn.a(symfcn.o)\nduplicate symbol _lrcalc_panic_frame in:\n    mathlib/.libs/libmath.a(alloc.o)\n    lrcoef/.libs/libsymfcn.a(maple.o)\nduplicate symbol _lrcalc_panic_frame in:\n    mathlib/.libs/libmath.a(alloc.o)\n    schubert/.libs/libschub.a(schublib.o)\nduplicate symbol _lrcalc_panic_frame in:\n    mathlib/.libs/libmath.a(alloc.o)\n    schubert/.libs/libschub.a(lincomb.o)\nld: 9 duplicate symbols for architecture x86_64\ncollect2: error: ld returned 1 exit status\nmake[5]: *** [liblrcalc.la] Error 1\nmake[5]: Target `all-am' not remade because of errors.\nmake[4]: *** [all-recursive] Error 1\nmake[3]: *** [all] Error 2\nError building lrcalc.\n```\n\nFull log: http://build.sagemath.org/sage/builders/%20%20fast%20Volker%20MiniMac%20%28OSX%2010.9%20x86_64%29%20incremental/builds/279/steps/compile/logs/stdio",
    "created_at": "2014-06-28T12:47:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16323",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16323#issuecomment-213843",
    "user": "vbraun"
}
```

Fails on OSX

```
libtool: link: gcc -dynamiclib -Wl,-undefined -Wl,dynamic_lookup -o .libs/liblrcalc.1.dylib   -Wl,-force_load,mathlib/.libs/libmath.a -Wl,-force_load,lrcoef/.libs/libsymfcn.a -Wl,-force_load,schubert/.libs/libschub.a   -O2   -install_name  /Users/buildslave-sage/slave/sage_git/build/local/lib/liblrcalc.1.dylib -compatibility_version 2 -current_version 2.0 -Wl,-single_module
duplicate symbol _lrcalc_panic_frame in:
    mathlib/.libs/libmath.a(alloc.o)
    mathlib/.libs/libmath.a(hashtab.o)
duplicate symbol _lrcalc_panic_frame in:
    mathlib/.libs/libmath.a(alloc.o)
    mathlib/.libs/libmath.a(list.o)
duplicate symbol _lrcalc_panic_frame in:
    mathlib/.libs/libmath.a(alloc.o)
    mathlib/.libs/libmath.a(set.o)
duplicate symbol _lrcalc_panic_frame in:
    mathlib/.libs/libmath.a(alloc.o)
    mathlib/.libs/libmath.a(vectarg.o)
duplicate symbol _lrcalc_panic_frame in:
    mathlib/.libs/libmath.a(alloc.o)
    mathlib/.libs/libmath.a(vector.o)
duplicate symbol _lrcalc_panic_frame in:
    mathlib/.libs/libmath.a(alloc.o)
    lrcoef/.libs/libsymfcn.a(symfcn.o)
duplicate symbol _lrcalc_panic_frame in:
    mathlib/.libs/libmath.a(alloc.o)
    lrcoef/.libs/libsymfcn.a(maple.o)
duplicate symbol _lrcalc_panic_frame in:
    mathlib/.libs/libmath.a(alloc.o)
    schubert/.libs/libschub.a(schublib.o)
duplicate symbol _lrcalc_panic_frame in:
    mathlib/.libs/libmath.a(alloc.o)
    schubert/.libs/libschub.a(lincomb.o)
ld: 9 duplicate symbols for architecture x86_64
collect2: error: ld returned 1 exit status
make[5]: *** [liblrcalc.la] Error 1
make[5]: Target `all-am' not remade because of errors.
make[4]: *** [all-recursive] Error 1
make[3]: *** [all] Error 2
Error building lrcalc.
```

Full log: http://build.sagemath.org/sage/builders/%20%20fast%20Volker%20MiniMac%20%28OSX%2010.9%20x86_64%29%20incremental/builds/279/steps/compile/logs/stdio



---

archive/issue_comments_213844.json:
```json
{
    "body": "Hum.... it seems it cannot cop with lrcalc_panic_frame being defined in mathlib/alloc.h\n\n```\n#include <setjmp.h>\n\n/*  Programs using the lrcalc library should set lrcalc_panic_frame\n *  with setjmp(lrcalc_panic_frame).  The lrcalc library will call\n *  longjmp(lrcalc_panic_frame, 1) if an \"out of memory\" event occurs.\n */\njmp_buf lrcalc_panic_frame;\n```\n\nAll the files for which the linker is complaining about are inheriting the declaration through multiple include statement but are not using it. I guess the proper course of action, from a correctness point of view, would be to create a specific header for it and include it only where needed. Looking for other options....",
    "created_at": "2014-06-28T20:53:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16323",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16323#issuecomment-213844",
    "user": "fbissey"
}
```

Hum.... it seems it cannot cop with lrcalc_panic_frame being defined in mathlib/alloc.h

```
#include <setjmp.h>

/*  Programs using the lrcalc library should set lrcalc_panic_frame
 *  with setjmp(lrcalc_panic_frame).  The lrcalc library will call
 *  longjmp(lrcalc_panic_frame, 1) if an "out of memory" event occurs.
 */
jmp_buf lrcalc_panic_frame;
```

All the files for which the linker is complaining about are inheriting the declaration through multiple include statement but are not using it. I guess the proper course of action, from a correctness point of view, would be to create a specific header for it and include it only where needed. Looking for other options....



---

archive/issue_comments_213845.json:
```json
{
    "body": "`@` nthiery: in configure.ac, oops:\n\n```\nAC_PREREQ([2.67])\nAC_INIT([lrcalc],[1.1.6],[asbuch at math rutgers edu])\n```\n\nNot hurtful of course.",
    "created_at": "2014-06-28T21:15:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16323",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16323#issuecomment-213845",
    "user": "fbissey"
}
```

`@` nthiery: in configure.ac, oops:

```
AC_PREREQ([2.67])
AC_INIT([lrcalc],[1.1.6],[asbuch at math rutgers edu])
```

Not hurtful of course.



---

archive/issue_comments_213846.json:
```json
{
    "body": "Attachment\n\nsolve the lrcalc_panic_frame definition problem",
    "created_at": "2014-06-28T22:47:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16323",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16323#issuecomment-213846",
    "user": "fbissey"
}
```

Attachment

solve the lrcalc_panic_frame definition problem



---

archive/issue_comments_213847.json:
```json
{
    "body": "OK the attached patch solve the problem on OS X, it should work on linux too but I haven't tested it there so far. It is a bit invasive and should be submitted upstream for consideration.",
    "created_at": "2014-06-28T22:49:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16323",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16323#issuecomment-213847",
    "user": "fbissey"
}
```

OK the attached patch solve the problem on OS X, it should work on linux too but I haven't tested it there so far. It is a bit invasive and should be submitted upstream for consideration.



---

archive/issue_comments_213848.json:
```json
{
    "body": "I will test it on my Ubuntu machine later tonight (if no one beats me to it).",
    "created_at": "2014-06-29T00:53:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16323",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16323#issuecomment-213848",
    "user": "tscrim"
}
```

I will test it on my Ubuntu machine later tonight (if no one beats me to it).



---

archive/issue_comments_213849.json:
```json
{
    "body": "Well I have now checked it builds and installs in sage-on-gentoo on linux and OS X but haven't run tests.",
    "created_at": "2014-06-29T01:16:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16323",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16323#issuecomment-213849",
    "user": "fbissey"
}
```

Well I have now checked it builds and installs in sage-on-gentoo on linux and OS X but haven't run tests.



---

archive/issue_comments_213850.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-06-29T13:06:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16323",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16323#issuecomment-213850",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_213851.json:
```json
{
    "body": "Git-a-fied and the spkg and sage checks passed for me.",
    "created_at": "2014-06-29T13:08:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16323",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16323#issuecomment-213851",
    "user": "tscrim"
}
```

Git-a-fied and the spkg and sage checks passed for me.



---

archive/issue_comments_213852.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2014-06-29T13:08:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16323",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16323#issuecomment-213852",
    "user": "tscrim"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_213853.json:
```json
{
    "body": "Thanks for figuring out the OSX Fran\u00e7ois (I couldn't do anything since I don't have access to one).",
    "created_at": "2014-06-29T13:09:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16323",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16323#issuecomment-213853",
    "user": "tscrim"
}
```

Thanks for figuring out the OSX François (I couldn't do anything since I don't have access to one).



---

archive/issue_comments_213854.json:
```json
{
    "body": "Well it is all a bit sloppy in my opinion. You have this variable that I put in separate header that needs to be global in the programs using it. Problems is it was put everywhere including the library parts. The gnu linker used in linux is infintely tolerant to some stuff and possibly has a way of dealing with it. But in this case I think the OS X linker is correct in saying \"please fix this up\". \n\nI also sent an email upstream along with the patch.",
    "created_at": "2014-06-30T10:30:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16323",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16323#issuecomment-213854",
    "user": "fbissey"
}
```

Well it is all a bit sloppy in my opinion. You have this variable that I put in separate header that needs to be global in the programs using it. Problems is it was put everywhere including the library parts. The gnu linker used in linux is infintely tolerant to some stuff and possibly has a way of dealing with it. But in this case I think the OS X linker is correct in saying "please fix this up". 

I also sent an email upstream along with the patch.



---

archive/issue_comments_213855.json:
```json
{
    "body": "So do you think we should hold off on merging this until we hear back?",
    "created_at": "2014-06-30T13:49:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16323",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16323#issuecomment-213855",
    "user": "tscrim"
}
```

So do you think we should hold off on merging this until we hear back?



---

archive/issue_comments_213856.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-06-30T16:33:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16323",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16323#issuecomment-213856",
    "user": "vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_213857.json:
```json
{
    "body": "Replying to [comment:18 tscrim]:\n> So do you think we should hold off on merging this until we hear back?\n\nDouble dose of no. One for me and one for Volker :)",
    "created_at": "2014-06-30T19:26:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16323",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16323#issuecomment-213857",
    "user": "fbissey"
}
```

Replying to [comment:18 tscrim]:
> So do you think we should hold off on merging this until we hear back?

Double dose of no. One for me and one for Volker :)
