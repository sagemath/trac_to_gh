# Issue 15508: The unit ideal is not prime or primary

Issue created by migration from https://trac.sagemath.org/ticket/15745

Original creator: cremona

Original creation time: 2014-01-27 14:45:00

CC:  pbruin

Keywords: unit prime primary ideal

On sage-support on 2014-01-27, Jack <kroeker`@`uni-math.gwdg.de> reported:

```
I'm a bit confused about Sage's answer if Ideal(1) is prime.

R.<x,y>= QQ[]
I = Ideal(R(1))
I.is_prime()

Sage (5.11, not only)  says yes,
conflicting to the definition, http://en.wikipedia.org/wiki/Prime_ideal
Has somebody an expanation of this behaviour?
```

and in the following discussion it was agreed that this is incorrect, as is `I.is_primary()}} (gives True not False) and {{{I.primary_decomposition()` (gives a nonempty list) and {{{I.is_maximal())}} (raises an error instead of returning False).

This originates with Singular, but could easily be fixed in Sage. 


---

Comment by pbruin created at 2014-01-29 23:16:48

Changing status from new to needs_review.


---

Comment by pbruin created at 2014-01-29 23:16:48

In this branch:
- return empty primary decomposition for the unit ideal
- fix a different bug uncovered by the above fix (comparison of ideals was wrong in some cases when using different term orders)
- improve documentation of `[complete_]primary_decomposition()`


---

Comment by cremona created at 2014-01-30 09:27:07

Looks good to me.  I am not sure why we need to have a primer about definition and existence of primary decompositions in the docstring at all, let alone three times!  But as long as they are correct (which they are, and I should know since I'll lecturing about all that later this term) I am certainly not going to suggest that they are removed.

Apart from tidying the documentation the patch just has two things, the easy one (deal with the unit ideal properly) and something else.  Would it be possible to have an example of how the second change corrects something which used to be wrong?


---

Comment by pbruin created at 2014-02-03 09:46:14

Replying to [comment:2 cremona]:
> Looks good to me.  I am not sure why we need to have a primer about definition and existence of primary decompositions in the docstring at all, let alone three times!  But as long as they are correct (which they are, and I should know since I'll lecturing about all that later this term) I am certainly not going to suggest that they are removed.

Yes, given that the small primer was already there I thought it made more sense to tidy it up than to remove it altogether.

> Apart from tidying the documentation the patch just has two things, the easy one (deal with the unit ideal properly) and something else.  Would it be possible to have an example of how the second change corrects something which used to be wrong?

The thing that failed after I made the first fix was a doctest that checked that the product of the primary ideals in the primary decomposition was equal to the original ideal.  The problem was that comparison of ideals was broken in the following situation: _I_ and _J_ are ideals of _R_ = *Q*[_x_,_y_], a Gröbner basis of _J_ has been computed for a different monomial ordering than the default one for _R_, and no Gröbner basis for _I_ has been computed.  The reason why it didn't work is that the equality _I_ = _J_ was tested using the default monomial ordering of _R_, but with the "wrong" Gröbner basis for _J_.  My fix makes sure that the comparison uses the monomial ordering of the cached Gröbner basis.

How was the bug triggered by the new check for the unit ideal?  At the point this check is done, no Gröbner bases have been computed for any ideal, so Sage decides to use the `degrevlex` ordering, while the _R_ in the doctest has the `lex` ordering.  So a Gröbner basis for the `degrevlex` ordering is cached, and on the other hand when the product of the ideals in the primary decomposition is made it has no cached Gröbner basis, which brings us in the situation above.

I could have written a new doctest, but since it is already tested by an existing doctest I thought it wasn't really necessary, and I didn't see a natural way of explaining the above problem in the patch.  I should have explained in my previous comment why there is no new doctest in the patch, though.


---

Comment by cremona created at 2014-02-03 09:49:40

That's certainly a good enough explanation for me!


---

Comment by cremona created at 2014-02-03 09:49:40

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2014-02-03 22:58:06

Resolution: fixed
