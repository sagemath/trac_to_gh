# Issue 18512: Groebner basis computations with the F4 algorithm

Issue created by migration from Trac.

Original creator: tcoladon

Original creation time: 2015-06-20 13:11:30

CC:  ncohen simonking jpflori zimmerma

Keywords: F4, groebner basis, ideal

We propose a new C++ library to compute Groebner basis over finite fields with the F4 algorithm.
This library works on prime fields of characteristic < 2^32 
and on binary field extensions of degree < 64.

The source code and a documentation are available on 
https://www-fourier.ujf-grenoble.fr/~viva/f4/html/index.html

The branch attached to this ticket contains a wrapper (Cython) for this library.
Place the f4 archive in the upstream directory, then use
sage -sh sage-fix-pkg-checksums
sage -i -c -f f4
before using this branch.

Informations on the new package:

-Speed (on my computer without vectorisation):

cyclic 8, GF(251): 
sage : 45.7 s
f4 : 30.8 s 

katsura 12, GF(251): 
sage : 12min 36s
f4 : 3min 16s

cyclic 8, GF(65521):
sage : 58.4
f4 : 25s

katsura 12, GF(65521):
sage : 15min 47s
f4 : 2min 46s

cyclic 8, GF(4294967291) : 
sage : does not work
f4 : 55.5 s

katsura 12, GF(4294967291) : 
sage : does not work
f4 : 11min 50s

Ideal in 8 variables over GF(2^15):
sage : 60 s
f4 : 10s

Ideal in 8 variables over GF(2^31): 
sage : 58.1 s
f4 : 15s

Ideal in 8 variables over GF(2^63):  
sage : 1min 18s
f4 : 30s


Documentation:

Available with the package (doxygen).
And in the updated file multi_polynomial_ideal.py, function groebner_basis.


Usability:

Can be used in the same way than other algorithms.
However only the grevlex order is available.
Detailed in the file multi_polynomial_ideal.py, function groebner_basis.


Absence of memory leaks:

Tested with valgrind.


Maintainable:

When the Givaro version of Sage will be updated, the package could be build with this dependency in order to handle the prime fields of big characteristics.


Portability:

In order to be efficient our package can use the SSE2 and SSE4 extensions (vectorisation).
This extensions are automatically detected at build time (configure).
However, even without these optimisations our package is more efficient than the current implemented algorithms in Sage.
The package was tested on:
- Ubuntu 12.04 (64 bits)
- Ubuntu 14.04 (64 bits)
- Debian 8 (32 bits)
- Arch Linux (64 bits)
- Mac OS X Yosemite (64 bits)


Reasonable build time, size, dependencies:

If the build time is a problem, examples can be removed from the makefile.am.
Size: 12Mo
Dependencies: Givaro is an optional dependency but a recent version is required.


Note:

The proposed wrapper in Cython is not very efficient and may be improved:
for instance, the computation of katsura 12 over GF(4294967291) takes only 2min 11s, 
and more than 9 min are spent in the cython wrapper to convert the result into sage polynomials.


---

Comment by malb created at 2015-06-20 16:02:54

This looks very interesting.

Can you clarify what you're trying to achieve with this ticket. Do you want your F4 code to be a standard or an optional package? Note that adding standard packages requires a vote on [sage-devel] and usually some time during which the package was an optional package.


Does your package have a name other than F4?

Also, do you have an idea why the performance of the wrapper is so poor?


---

Comment by tscrim created at 2015-06-20 16:14:01

With the latest beta versions of Sage, you'll need to add a file `type` which contains the word "optional" (as new Sage packages start as optional, but if you want to make this standard, you can make a request on Sage-devel). You also need to make in `module_list.pyx` an optional extension.

I'm guessing the conversion has to do with taking the basis as a vector of strings and you need to convert it to a better python type. You probably want to do this in a cdef function and have the python level function just do the final conversions. Conversions to strings is typically the slowest way to do things. It might be best to have a python data structure in the bindings file more closer to your internal data structures.


---

Comment by was created at 2015-06-20 18:08:09

I think they've put adding it as a standard package to a vote here: https://groups.google.com/forum/#!topic/sage-devel/CfZ8kzT8B2s


---

Comment by malb created at 2015-06-20 18:14:12

- f4 is rather generic for a software project implementing the F4 algorithm. If possible, it would be good to rename it (I know this is rather invasive). If you agree to rename this would affect the tarball, the file in the Sage library and the name of the algorithm when calling groebner_basis(). 


- I think the pyx file should be moved to `sage.libs.<libraryname>.<libraryname>.pyx`

- I improved conversion a bit:


```python
# before
sage: P = PolynomialRing(GF(next_prime(2^31)), 8, 'x')
sage: I = sage.rings.ideal.Cyclic(P)
sage: from sage.rings.polynomial.groebner_basis_f4 import groebner_basis_f4
sage: %time gb0 = groebner_basis_f4(I)
6.4465777874 # <- conversion time
CPU times: user 14.8 s, sys: 400 ms, total: 15.2 s
Wall time: 15.2 s

# after
sage: P = PolynomialRing(GF(next_prime(2^31)), 8, 'x')  
sage: I = sage.rings.ideal.Cyclic(P)                  
sage: %time gb0 = groebner_basis_f4(I)                
3.16141104698 # <- conversion time
CPU times: user 11.8 s, sys: 144 ms, total: 12 s
Wall time: 11.9 s
```


- I cleaned the module up a bit under u/malb/t18749_f4
----
Last 10 new commits:


---

Comment by git created at 2015-06-20 18:15:45

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vbraun created at 2015-06-20 18:42:30

The C++ code looks decent. Are you one of the upstream authors? 

I didn't see a public source repo or bug tracker. If you don't want to host it yourself there is always github or bitbucket. But just putting a tarball on your homepage hasn't been best practice since the 90s ;-)

Are the headers installed to $prefix/include/f4/include/f4.h? Why the extra /include/?


---

Comment by dimpase created at 2015-06-20 20:28:33

SPKG.txt says that `openmp` is a dependency. But this is not mentioned above...


---

Comment by git created at 2015-06-21 10:54:29

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2015-06-21 15:32:54

Replying to [ticket:18749 tcoladon]:
> Place the f4 archive in the upstream directory, then use
> sage -sh sage-fix-pkg-checksums

This shouldn't be needed. The branch should contain the correct checksum!


---

Comment by jdemeyer created at 2015-06-21 15:34:03

It seems that the branch makes `src/sage/rings/polynomial/multi_polynomial_ideal.py` executable??


---

Comment by jdemeyer created at 2015-06-21 15:34:43

At the same time, the files `spkg-install` and `spkg-check` should be executable.


---

Comment by jdemeyer created at 2015-06-21 15:35:09

`sage.rings.polynomial.groebner_basis_f4` should be an `OptionalExtension`.


---

Comment by malb created at 2015-06-21 20:39:10

I played around with this ticket some more. On a Intel(R) Xeon(R) CPU E5-2667 v2 `@` 3.30GHz with 16 real cores:


```python
sage: P = PolynomialRing(GF(previous_prime(2^31)), 9, 'x')
sage: I = sage.rings.ideal.Cyclic(P)                                                                                                                                                                                        
sage: %time gb = I.groebner_basis('magma')                                                                                                                                                                                  
CPU times: user 19.1 s, sys: 904 ms, total: 20 s
Wall time: 5h 22min 33s

sage: I = sage.rings.ideal.Cyclic(P) # avoid caching
sage: %time gb16 = I.groebner_basis('f4', threads=16)
CPU times: user 1h 23min 13s, sys: 33.6 s, total: 1h 23min 47s
Wall time: 9min 54s

sage: gb == gb16
True

sage: %time gb8 = I.groebner_basis('f4', threads=8)                                                                                                                                                                        
CPU times: user 1h 4min 55s, sys: 27.9 s, total: 1h 5min 23s
Wall time: 12min 23s

sage: gb == gb8
True

sage: %time gb1 = I.groebner_basis('f4', threads=1)                                                                                                                                                                         
CPU times: user 50min 26s, sys: 26.6 s, total: 50min 52s
Wall time: 50min 56s

sage: gb1 == gb
True
```



---

Comment by was created at 2015-06-21 21:30:45

I've been waiting 10 years for this!


---

Comment by malb created at 2015-06-22 08:50:05

The results over GF(2<sup>8</sup>) seem to be incorrect, though:


```python
sage: sr = mq.SR(1,1,1,4,gf2=False) # smallest scale small scale AES
sage: F,s = sr.polynomial_system()

sage: %time gb = F.groebner_basis()
CPU times: user 8 ms, sys: 0 ns, total: 8 ms
Wall time: 6.76 ms
sage: gb[0]
k003^2 + (a^2 + a + 1)*k003 + (a^3 + a^2 + 1)

sage: %time gbf4 = F.groebner_basis('f4')


GROEBNER BASIS : (1) # this output should not be here
---> 0 ms 


CPU times: user 8 ms, sys: 0 ns, total: 8 ms
Wall time: 10.9 ms
sage: gbf4 == gb # the output disagrees
False

sage: %time gbm = F.groebner_basis('magma') # checking who Magma agrees with
CPU times: user 68 ms, sys: 20 ms, total: 88 ms
Wall time: 997 ms
sage: gbm == gb
True

```



---

Comment by parisse created at 2015-06-22 12:19:10

I made a few benchmarks, compared to giac, *natively* (conversions to sage take a significative amount of time at least for f4), with 1 thread, using a prime of size 24 bits (giac can go up to 31 bits, add about 20% time).
For cyclic8, giac is a little faster (11s. vs 12)
For katsura12, f4 is faster (45s vs 69s)
For cyclic9: giac does it in about 15 minutes with 700M of RAM, I stopped the computation of f4 after about the same time because the memory used was reaching 23G (too much for my laptop). This is not specific to cyclic9, it also happens for katsura12.


---

Comment by frederichan created at 2015-06-22 13:02:05

I think that the time of conversion from F4 and giac to sage is quite similar. I also noticed that F4 is faster but the server I am working on has  16Go of ram and I had to interrupt the computation with F4 of cyclic9 mod prev_prime(2^31).

on sage with giac and giacpy the syntax is like this:

```
sage: P = PolynomialRing(GF(previous_prime(2^31)), 9, 'x')
sage: I = sage.rings.ideal.Cyclic(P)
sage: from giacpy import *

sage: p=previous_prime(2^31)
sage: time gb8B = (libgiac(I.gens()) % p).gbasis([P.gens()])
Time: CPU 1687.80 s, Wall: 1687.55 s
sage: # the saved file is 84M
sage: time gb8B.savegen('/home/han/cyclic9modp')
Time: CPU 8.90 s, Wall: 8.92 s
sage: #converting from giac to sage
sage: time BG=Sequence(gb8B,P)
Time: CPU 30.97 s, Wall: 30.97 s
sage: time gb8Bbis=loadgiacgen('/home/han/cyclic9modp')
Time: CPU 7.89 s, Wall: 7.89 s
```



---

Comment by frederichan created at 2015-06-22 14:17:22

Replying to [comment:17 malb]:
> The results over GF(2<sup>8</sup>) seem to be incorrect, though:
> 
> {{{#!python
> sage: sr = mq.SR(1,1,1,4,gf2=False) # smallest scale small scale AES
> sage: F,s = sr.polynomial_system()
> 
> sage: %time gb = F.groebner_basis()
> CPU times: user 8 ms, sys: 0 ns, total: 8 ms
> Wall time: 6.76 ms
> sage: gb[0]
> k003^2 + (a^2 + a + 1)*k003 + (a^3 + a^2 + 1)
> 
> sage: %time gbf4 = F.groebner_basis('f4')
> 
> 
> GROEBNER BASIS : (1) # this output should not be here
> ---> 0 ms 
> 
> 
> CPU times: user 8 ms, sys: 0 ns, total: 8 ms
> Wall time: 10.9 ms
> sage: gbf4 == gb # the output disagrees
> False
> 
> }}}
It is not clear for me that why gbf4 == gb should be True. I have nevertheless:

```
sage: gbf4==gb,gbf4.is_groebner(), gb.is_groebner()
(False, True, True)
```



---

Comment by tcoladon created at 2015-06-22 14:35:38

Thank you for the bug report and the wrapper improvement.

I have found the bug (due to SSE).

Does the name 
-f4lib
-openf4
may be a suitable ?

For the "extra /include":
I place in $prefix/include only libf4.h and f4.h,
the "real" sources are placed in the $prefix/include/f4 directory where the declarations are separed from the definitions.

I will set up a git soon with the fix.

Let me know if you have any other requirements.


---

Comment by malb created at 2015-06-22 15:38:16

Replying to [comment:21 tcoladon]:
> Does the name 
> -f4lib
> -openf4
> may be a suitable ?

I'd say anything which is a proper name should work. 'f4lib' doesn't really qualify by that criterion I'd say, but it's better than 'f4'; 'openf4' could do. It's really up to you, though.

> For the "extra /include":
> I place in $prefix/include only libf4.h and f4.h,
> the "real" sources are placed in the $prefix/include/f4 directory where the declarations are separed from the definitions.

Why do you install the sources at all? As far as I can see you instantiate all templates in `libf4.cpp` anyway, so is there a need to copy the whole source code in `local/include`?


---

Comment by dimpase created at 2015-06-22 16:26:11

Replying to [comment:22 malb]:
> Replying to [comment:21 tcoladon]:
> > Does the name 
> > -f4lib
> > -openf4
> > may be a suitable ?
> 
> I'd say anything which is a proper name should work. 'f4lib' doesn't really qualify by that criterion I'd say, but it's better than 'f4'; 'openf4' could do. It's really up to you, though.
> 
> > For the "extra /include":
> > I place in $prefix/include only libf4.h and f4.h,
> > the "real" sources are placed in the $prefix/include/f4 directory where the declarations are separed from the definitions.
> 
> Why do you install the sources at all? As far as I can see you instantiate all templates in `libf4.cpp` anyway, so is there a need to copy the whole source code in `local/include`?

Well, would you prefer a broken installation, that cannot be used at `sage -sh` prompt?


---

Comment by malb created at 2015-06-22 16:41:01

Why would that be a broken installation? The library is - as far as I can see - perfectly usable without dropping all `.inl` files in `local/include/f4/src`.


---

Comment by jdemeyer created at 2015-06-23 06:40:34

1. Is there an "upstream" page? It should be mentioned in `SPKG.txt`.

2. Is this right?

```
## License

 * GNU GPLv3
```

It would be much better if it was under GPL version 3 _or later_. If this isn't the case, you should ask upstream if they are willing to release under GPL version 3 or later.

3. Obviously, this shouldn't be there:

```
Put a bulleted list of dependencies here:
```


4. In `module_list.py`, this shouldn't be needed

```
depends = [SAGE_INC + "/libf4.h"]
```

since you're explicitly refering to `libf4.h` in the `.pyx` file.

5. For the copyright statement in `groebner_basis_f4.pyx`, please follow the format at
[http://doc.sagemath.org/html/en/developer/coding_basics.html#headings-of-sage-library-code-files](http://doc.sagemath.org/html/en/developer/coding_basics.html#headings-of-sage-library-code-files)

6. When you're done, remove `# commented out code`, in particular this funny thing:

```
#include <Python.h>
```


7. Format `INPUT` blocks like [http://doc.sagemath.org/html/en/developer/coding_basics.html#the-docstring-of-a-function-content](http://doc.sagemath.org/html/en/developer/coding_basics.html#the-docstring-of-a-function-content)


---

Comment by tcoladon created at 2015-06-25 13:55:50

I update the code on https://github.com/nauotit/openf4 (the bug is fixed)

and the Sage files in the branch u/tcoladon/f4.

The new upstream name is openf4.

I don't understand your question about the licence? 

If the sources installation is a problem, we can remove them (just change the Makefile.am in the src directory) in a special target dedicated to Sage?

I haven't deleted the # lines in file groebner_basis_f4.pyx in case Givaro version is updated.

For the comparison with Magma, I'm not sure that openf4 is better on smaller prime fields. Magma is very slow when the characteristic is higher than 2^24


---

Comment by jdemeyer created at 2015-06-25 14:13:55

Replying to [comment:26 tcoladon]:
> I don't understand your question about the licence? 
There is a difference between releasing between releasing a project under "*GPL version 3*" and "*GPL version 3 or any later version*". The latter is much preferred in case a GPL version 4 ever comes out and we want to be compatible with that.


---

Comment by tcoladon created at 2015-06-25 14:48:33

Thank you,
the upstream is under GPLv3 or any later version, I have updated the SPKG.txt.


---

Comment by malb created at 2015-06-25 18:06:41

Which tarball do the hashes in checksums.ini refer to?


---

Comment by tcoladon created at 2015-06-25 19:27:57

I have updated http://nauotit.github.io/openf4/ with the checksums.ini refered tarball.


---

Comment by git created at 2015-06-26 09:53:20

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-06-29 13:11:55

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by malb created at 2015-06-29 13:20:10

I should have addressed all issues raised on this ticket with respect to the Sage interface. As far as I can see, what remains to be done is to clean up Makefile.am to normalise what is installed where? Anything I overlooked?


---

Comment by git created at 2015-06-29 13:30:11

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-06-29 13:53:24

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-06-29 13:55:24

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2015-06-29 15:31:07

Replying to [comment:33 malb]:
> Anything I overlooked?
It looks pretty good indeed.

I just noticed this Cython warning:

```
warning: sage/libs/openf4.pyx:135:29: Unreachable code
```


Don't forget to set the ticket to needs_review when you really want this to be reviewed.


---

Comment by git created at 2015-06-29 15:50:34

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by malb created at 2015-06-29 15:51:52

Thanks, fixed the unreachable code thing. I'm in no position to set the ticket to "needs review". I think upstream should be cleaned up first (but not everyone agrees) and I'm also not the primary author anyway, just lending a hand on the Sage side.


---

Comment by malb created at 2015-06-29 15:52:03

Changing status from new to needs_info.


---

Comment by tcoladon created at 2015-06-30 13:03:31

The sources installation is indeed required. 
libopenf4.cpp includes ideal.h which needs some *.inl files.
If everything else is OK, I can change the ticket to "need review"?


---

Comment by malb created at 2015-07-01 09:17:17

Fine by me.


---

Comment by tcoladon created at 2015-07-01 21:49:14

Changing status from needs_info to needs_review.


---

Comment by dimpase created at 2015-07-06 16:23:03

why all this naming mess?
Would it be easier to call the package f4, just as the tarball is called?

No, really, it's totally unneeded complexity that is added this way.


---

Comment by malb created at 2015-07-06 16:46:22

The tarball is not called f4, please read the comments above.


---

Comment by dimpase created at 2015-07-06 17:05:31

Replying to [comment:46 malb]:
> The tarball is not called f4, please read the comments above.

I read the ticket description.
It tells you to get 
https://www-fourier.ujf-grenoble.fr/~viva/f4/f4-1.0.0.tar.gz
(or rather it doesn't really tell you this, it just gives you
https://www-fourier.ujf-grenoble.fr/~viva/f4/html/index.html)

When you set a ticket up for review, can you at least provide clear instructions on installing all the stuff needed?


---

Comment by dimpase created at 2015-07-06 17:05:31

Changing status from needs_review to needs_work.


---

Comment by malb created at 2015-07-09 13:20:38

Agreed, the description should be upgraded.


---

Comment by frederichan created at 2015-07-09 13:49:45

Could you also add some words about the ram needed by one or two examples? (the first time I tried I had difficulties with too much swapping)


---

Comment by malb created at 2015-07-13 14:29:55

Hi Titouan, can you update the description of this ticket so people can review it?


---

Comment by malb created at 2015-07-16 13:22:38

Changing status from needs_work to needs_review.


---

Comment by dimpase created at 2015-07-18 05:58:38

Changing status from needs_review to needs_work.


---

Comment by dimpase created at 2015-07-18 05:58:38

Ticket description still does not give a link to the tarball to be used, or otherwise not say how exactly to create one. Running `sage -sh sage-fix-pkg-checksums` must be done by the package creator, and not by the testers.

Sorry, but really, how much work is to fix this? Please, please, fix this quickly....


---

Comment by dimpase created at 2015-07-18 06:03:46

The checksum in the branch idenitifies the tarball to be used by the package. I don't see how without this  specified one can talk about testing and reviewing anything...


---

Comment by dimpase created at 2015-07-18 08:26:02

OK, that's better. Does one really need to do `sage -i -c -f openf4`? For me
`sage -i openf4` works just as well, and this is the way it must work, to be includeable into Sage.


---

Comment by dimpase created at 2015-07-18 08:29:58

Changing status from needs_work to needs_review.


---

Comment by dimpase created at 2015-07-18 09:11:32

Changing status from needs_review to needs_work.


---

Comment by dimpase created at 2015-07-18 09:11:32

Am I correct in thinking that C++ `vector[string]` things there are allocated on the stack, and are automatically freed, so we don't need to worry about dealloc?


---

Comment by dimpase created at 2015-07-18 09:12:42

Changing status from needs_work to positive_review.


---

Comment by zimmerma created at 2015-07-22 07:35:21


```
sage: I
Ideal (-32567592*x^2 - 134376780*x - 99453050, -102821173*x^2 - 133875255*x + 114754735) of Multivariate Polynomial Ring in x over Finite Field of size 273389687
sage: I.groebner_basis()
[1]
sage: I.groebner_basis('openf4')
[x]
```

The openf4 output seems wrong.


---

Comment by zimmerma created at 2015-07-22 07:43:31

another difference:

```
sage: P.<x1,x2,x3,x4,x5> = PolynomialRing(GF(143107493))
sage: I=ideal([-7253051*x1^2 + 52764828*x1*x2 - 1593629*x2^2 - 30491382*x1*x4 - 15421743, 2778386*x1^2 + 46128944*x2^2 - 28328699*x2*x3 + 35619408*x1*x4 - 47336793*x4^2, 50713151*x1^2 + 33804903*x1*x3 + 4639379*x3*x4 - 29371044*x1 - 55622885*x4, -17812925*x1*x2 - 60567702*x3^2 - 17218643*x2*x4 + 15189711*x1 + 683651*x4, 42755489*x1*x3 - 60418193*x2*x4 + 56537689*x4^2 - 6152933*x3 + 53988116])
sage: I.groebner_basis()
[1]
sage: I.groebner_basis('openf4')
[x1, x2, x3, x4]
```



---

Comment by dimpase created at 2015-07-22 07:49:47

Changing status from positive_review to needs_work.


---

Comment by zimmerma created at 2015-07-22 09:42:55

a simpler example in 3 variables where `I.groebner_basis()` and `I.groebner_basis('openf4')` disagree:

```
Ideal (-381588408*x0^2 + 476686997*x2^2 - 462809584*x0 + 257786256*x2 - 114361905, -165319008*x0^2 + 74443335*x0*x2 - 139862633*x2^2 - 274498434*x0 + 48302322, -462665673*x0^2 + 458273559*x2^2 - 602419172*x0 + 103972832*x2 - 383910315) of Multivariate Polynomial Ring in x0, x1, x2 over Finite Field of size 1217734367
[1]
[x0, x2]
```



---

Comment by zimmerma created at 2015-07-22 10:11:12

also:

```
sage: P = PolynomialRing(GF(2), 1, 'x')
sage: I = ideal([P(0)])
sage: I.groebner_basis('openf4')
...
SignalError: Segmentation fault
```



---

Comment by tcoladon created at 2015-07-26 13:45:59

Thank you for the bug reports.
They are solved. 
I have updated the tarball http://nauotit.github.io/openf4/openf4-1.0.0.tar.gz
and the corresponding checksums.ini on the branch u/tcoladon/f4.


---

Comment by dimpase created at 2015-07-27 22:10:21

Replying to [comment:67 tcoladon]:
> Thank you for the bug reports.
> They are solved. 
> I have updated the tarball http://nauotit.github.io/openf4/openf4-1.0.0.tar.gz
> and the corresponding checksums.ini on the branch u/tcoladon/f4.


----
New commits:


---

Comment by dimpase created at 2015-07-27 22:13:11

As far as I can see, examples from comments 62,63,65 and 66 were not added to the doctests. Can you do this, so that it can be checked automatically?


---

Comment by malb created at 2015-07-29 08:42:16

Also, the current branch ignores all my fixes from u/malb/t18749_f4


---

Comment by git created at 2015-07-31 11:12:49

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by tcoladon created at 2015-07-31 11:25:42

The doctests are added:
check-trivial1-64bits.cpp <-> comment 62
check-trivial2-64bits.cpp <-> comment 65
check-trivial3-64bits.cpp <-> comment 63
check-trivial5-64bits.cpp <-> comment 66

We can stay on u/malb/t18749_f4 if it is easier ?
I merge u/malb/t18749_f4 into u/tcoladon/f4, in order to add all the fixes.


---

Comment by malb created at 2015-07-31 11:34:09

- Merging my branch into yours is fine.

- Doctests refers to tests added to Sage in the documentation for a function. It might be good to add those tests there as well.


---

Comment by git created at 2015-07-31 13:10:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tcoladon created at 2015-07-31 13:20:42

I have added examples to the doctest.

However since I merge the branch u/malb/t18749_f4 into u/malb/t18749_f4, I have a problem with some unrelated files:

When I run ./sage -br, I get a lot of "Error compiling Cython file:" whose the first is:

Cythonizing sage/categories/map.pyx
Error compiling Cython file:
from cpython.object cimport Py_TYPE, PyTypeObject


---

Comment by zimmerma created at 2015-08-17 10:49:51

Replying to [comment:67 tcoladon]:
> I have updated the tarball http://nauotit.github.io/openf4/openf4-1.0.0.tar.gz

thanks. It would be good to use different numbers for different versions (1.0.0 was already used before, see comment [comment:47]).


---

Comment by jdemeyer created at 2016-01-11 10:34:33

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2016-01-11 10:34:33

Merged latest beta and added a few trivial fixes.
----
New commits:


---

Comment by git created at 2016-01-11 10:42:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2016-01-11 10:44:16

Replying to [ticket:18749 tcoladon]:
> The proposed wrapper in Cython is not very efficient and may be improved:
> for instance, the computation of katsura 12 over GF(4294967291) takes only 2min 11s, 
> and more than 9 min are spent in the cython wrapper to convert the result into sage polynomials.

Is this acceptable? Why are strings used for the conversion? Can't we access the C data structures?


---

Comment by git created at 2016-01-11 10:49:41

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jpflori created at 2016-01-11 11:05:00

Replying to [comment:81 jdemeyer]:
> Replying to [ticket:18749 tcoladon]:
> > The proposed wrapper in Cython is not very efficient and may be improved:
> > for instance, the computation of katsura 12 over GF(4294967291) takes only 2min 11s, 
> > and more than 9 min are spent in the cython wrapper to convert the result into sage polynomials.
> 
> Is this acceptable? Why are strings used for the conversion? Can't we access the C data structures?

I don't see any easy way to do this after quickly browsing `openf4` source code.

As far as initialization is concerned, the only constructor for polynomials on top of move and copy contructors takes a vector of strings.
You can init an empty polynomial and add terms one at a time but you have to sort the temrs first.

And to extract the result you have to do the same thing.

So my opinion is that such functions should be added to openf4, not the the sage wrapper.
They could for example eat and spit vectors of Element.


---

Comment by jdemeyer created at 2016-01-11 22:18:59

Another thing: if `openf4` is so much faster like you claim, it should be the default algorithm for Gröbner basis computations over rings which `openf4` can handle. That would also greatly increase the testing coverage.


---

Comment by jdemeyer created at 2016-01-11 22:18:59

Changing status from needs_review to needs_work.


---

Comment by parisse created at 2016-01-12 06:38:40

If the default choice is reconsidered, then I would recommend to run benchmarks in comparison with singular and giac. My own tests shows that for Z/pZ, giac is faster than openf4 and requires much less memory (e.g. less than 600M vs more than 20G for cyclic9). singular remains faster for very sparse problems where f4 is not appropriate. Cf. 
http://www.cecm.sfu.ca/~rpearcea/mgb.html


---

Comment by frederichan created at 2016-01-12 07:54:26

Replying to [comment:85 parisse]:
> If the default choice is reconsidered, then I would recommend to run benchmarks in comparison with singular and giac. My own tests shows that for Z/pZ, giac is faster than openf4 and requires much less memory (e.g. less than 600M vs more than 20G for cyclic9). singular remains faster for very sparse problems where f4 is not appropriate. Cf. 
> http://www.cecm.sfu.ca/~rpearcea/mgb.html
I think that you are talking of giac > 1.2.2. Note that I have not yet updated the spkg (giac 1.2.0.19) so it is a bit slower than openf4 for cyclic9, but ram usage are indeed very different (for cyclic9 over GF(101) top shows for giac 1.2.0 from sage around 1G  but I saw top around 60Go  with openf4 from sage.)


---

Comment by roed created at 2017-07-17 17:36:39

Changing keywords from "F4, groebner basis, ideal" to "F4, groebner basis, ideal, sd87".


---

Comment by mkoeppe created at 2020-06-19 18:16:00

Setting spkg proposals that have not seen recent activity to "sage-wishlist".


---

Comment by mkoeppe created at 2020-06-19 18:16:00

Changing status from needs_work to needs_info.
