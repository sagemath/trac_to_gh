# Issue 13039: Upgrade GAP to 4.5.4

archive/issues_013039.json:
```json
{
    "body": "Assignee: tbd\n\nCC:  @ppurka @dimpase @miguelmarco @jhpalmieri @rbeezer @vbraun @burcin\n\nAs title.\n\nIssue created by migration from https://trac.sagemath.org/ticket/13211\n\n",
    "created_at": "2012-07-07T13:28:54Z",
    "labels": [
        "component: packages: standard"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.6",
    "title": "Upgrade GAP to 4.5.4",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13039",
    "user": "https://github.com/kini"
}
```
Assignee: tbd

CC:  @ppurka @dimpase @miguelmarco @jhpalmieri @rbeezer @vbraun @burcin

As title.

Issue created by migration from https://trac.sagemath.org/ticket/13211





---

archive/issue_comments_157543.json:
```json
{
    "body": "From the GAP website:  \"The current version is GAP 4.5.5 released on July 17th, 2012.\"",
    "created_at": "2012-07-26T05:14:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157543",
    "user": "https://github.com/rbeezer"
}
```

From the GAP website:  "The current version is GAP 4.5.5 released on July 17th, 2012."



---

archive/issue_comments_157544.json:
```json
{
    "body": "And of course the random number generator (random group element) in GAP changed, yay!",
    "created_at": "2012-08-27T02:51:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157544",
    "user": "https://github.com/vbraun"
}
```

And of course the random number generator (random group element) in GAP changed, yay!



---

archive/issue_comments_157545.json:
```json
{
    "body": "Changing keywords from \"\" to \"rng\".",
    "created_at": "2012-08-27T02:51:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157545",
    "user": "https://github.com/vbraun"
}
```

Changing keywords from "" to "rng".



---

archive/issue_comments_157546.json:
```json
{
    "body": "It could also be a good moment to include as many gap packages as possible in the gap_packages spkg. I made a list with the licenses of some packages [1] and a spkg with those  packages that have gpl license and i was able to make install seamlessly [2].\n\nIt was all for 4.4.12 version, but should be easily ported to 4.5\n\n[1] https://docs.google.com/spreadsheet/ccc?key=0AvB7eBQ-W5NGdDN2X1NVQnUyQ24tQ05CQzRlVVh2Rmc\n[2] https://docs.google.com/open?id=0B_B7eBQ-W5NGWUUzQzYxdFRqaXM",
    "created_at": "2012-08-27T09:39:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157546",
    "user": "https://github.com/miguelmarco"
}
```

It could also be a good moment to include as many gap packages as possible in the gap_packages spkg. I made a list with the licenses of some packages [1] and a spkg with those  packages that have gpl license and i was able to make install seamlessly [2].

It was all for 4.4.12 version, but should be easily ported to 4.5

[1] https://docs.google.com/spreadsheet/ccc?key=0AvB7eBQ-W5NGdDN2X1NVQnUyQ24tQ05CQzRlVVh2Rmc
[2] https://docs.google.com/open?id=0B_B7eBQ-W5NGWUUzQzYxdFRqaXM



---

archive/issue_comments_157547.json:
```json
{
    "body": "No this is not a good moment to add features to gap. Make a separate ticket.",
    "created_at": "2012-08-27T10:56:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157547",
    "user": "https://github.com/vbraun"
}
```

No this is not a good moment to add features to gap. Make a separate ticket.



---

archive/issue_comments_157548.json:
```json
{
    "body": "Replying to [comment:8 vbraun]:\n> No this is not a good moment to add features to gap. Make a separate ticket.\n\nindeed, that can be done later. Let's upgrade first. \nBy the way, did you take care of #13341?",
    "created_at": "2012-08-27T11:19:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157548",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:8 vbraun]:
> No this is not a good moment to add features to gap. Make a separate ticket.

indeed, that can be done later. Let's upgrade first. 
By the way, did you take care of #13341?



---

archive/issue_comments_157549.json:
```json
{
    "body": "I've based it on #13341 and tried to not touch any cygwin stuff. Though its probably save to say that cygwin broke, I don't have a Windows machine to test on.",
    "created_at": "2012-08-27T13:49:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157549",
    "user": "https://github.com/vbraun"
}
```

I've based it on #13341 and tried to not touch any cygwin stuff. Though its probably save to say that cygwin broke, I don't have a Windows machine to test on.



---

archive/issue_comments_157550.json:
```json
{
    "body": "Also the new gap prints escape codes on Fedora 17, I've communicated this to the GAP devs here:\n\n```\n[vbraun@laptop ~]$ echo '1+1;' | sage -gap -q | od -c\n0000000 033   [   ?   1   0   3   4   h   2  \\n\n0000012\n```\n",
    "created_at": "2012-08-27T14:17:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157550",
    "user": "https://github.com/vbraun"
}
```

Also the new gap prints escape codes on Fedora 17, I've communicated this to the GAP devs here:

```
[vbraun@laptop ~]$ echo '1+1;' | sage -gap -q | od -c
0000000 033   [   ?   1   0   3   4   h   2  \n
0000012
```




---

archive/issue_comments_157551.json:
```json
{
    "body": "Here are test failures on my `OpenSUSE` laptop.\n\nMost of the tests fail because of changes in the random generator or because of slightly changed error messages or because of changing documentation in GAP or simply because of testing against the version number.\n\nHere are more serious problems:\n\n```\nFile \"/home/simon/SAGE/prerelease/sage-5.2.rc0/devel/sage-main/sage/interfaces/gap.py\", line 1330:\n    sage: 'Centralizer' in s5.trait_names()\nException raised:\n    Traceback (most recent call last):\n      File \"/home/simon/SAGE/prerelease/sage-5.2.rc0/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/home/simon/SAGE/prerelease/sage-5.2.rc0/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/home/simon/SAGE/prerelease/sage-5.2.rc0/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_46[3]>\", line 1, in <module>\n        'Centralizer' in s5.trait_names()###line 1330:\n    sage: 'Centralizer' in s5.trait_names()\n      File \"/home/simon/SAGE/prerelease/sage-5.2.rc0/local/lib/python/site-packages/sage/interfaces/gap.py\", line 1338, in trait_names\n        v = eval(v)\n      File \"<string>\", line 4\n        \"in\", \"ShallowCopy\", <Attribute \"Name\",\n                             ^\n    SyntaxError: invalid syntax\n```\n\n\nIn sage/coding/linear_code.py are a few crashes, like this:\n\n```\nFile \"/home/simon/SAGE/prerelease/sage-5.2.rc0/devel/sage-main/sage/coding/linear_code.py\", line 2047:\n    sage: G.order()\nException raised:\n    Traceback (most recent call last):\n...\n    RuntimeError: Gap produced error output\n    Error, Variable: '$sage16' must have a value\n\n       executing Size($sage16);\n**********************************************************************\nFile \"/home/simon/SAGE/prerelease/sage-5.2.rc0/devel/sage-main/sage/coding/linear_code.py\", line 2716:\n    sage: C.zeta_polynomial()\nException raised:\n    Traceback (most recent call last):\n...\n    RuntimeError: Gap produced error output\n    Error, Variable: '$sage24' must have a value\n\n       executing Print($sage24);\n**********************************************************************\nFile \"/home/simon/SAGE/prerelease/sage-5.2.rc0/devel/sage-main/sage/coding/linear_code.py\", line 599:\n    sage: for B in self_orthogonal_binary_codes(7,3,4):\n       print B; print B.gen_mat()\nExpected:\n    Linear code of length 4, dimension 1 over Finite Field of size 2\n    [1 1 1 1]\n    Linear code of length 6, dimension 2 over Finite Field of size 2\n    [1 1 1 1 0 0]\n    [0 1 0 1 1 1]\n    Linear code of length 7, dimension 3 over Finite Field of size 2\n    [1 0 1 1 0 1 0]\n    [0 1 0 1 1 1 0]\n    [0 0 1 0 1 1 1]\nGot:\n    Linear code of length 4, dimension 1 over Finite Field of size 2\n    [1 1 1 1]\n    ** Gap crashed or quit executing 'Read(\"/home/simon/.sage//temp/linux_sqwp.site/18857//interface//tmp18907\");' **\n    Restarting Gap and trying again\n    Linear code of length 6, dimension 2 over Finite Field of size 2\n    [1 1 1 1 0 0]\n    [0 1 0 1 1 1]\n    Linear code of length 7, dimension 3 over Finite Field of size 2\n    [1 0 1 1 0 1 0]\n    [0 1 0 1 1 1 0]\n    [0 0 1 0 1 1 1]\n**********************************************************************\n```\n\n\nNote the crash in the last example. A similar crash is:\n\n```\nFile \"/home/simon/SAGE/prerelease/sage-5.2.rc0/devel/sage-main/sage/coding/code_constructions.py\", line 530:\n    sage: C.minimum_distance()\nExpected:\n    4\nGot:\n    ** Gap crashed or quit executing 'Read(\"/home/simon/.sage//temp/linux_sqwp.site/18774//interface//tmp18791\");' **\n    Restarting Gap and trying again\n    4\n```\n\n\nSeveral tests in latin.py fail, probably because of changes in the random generator. Couldn't one test instead whether the squares really *are* latin?\n\nA strange one:\n\n```\nFile \"/home/simon/SAGE/prerelease/sage-5.2.rc0/devel/sage-main/sage/tests/cmdline.py\", line 359:\n    sage: out\nExpected:\n    '120\\n'\nGot:\n    '\\x1b[?1034h120\\n'\n```\n",
    "created_at": "2012-08-30T14:19:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157551",
    "user": "https://github.com/simon-king-jena"
}
```

Here are test failures on my `OpenSUSE` laptop.

Most of the tests fail because of changes in the random generator or because of slightly changed error messages or because of changing documentation in GAP or simply because of testing against the version number.

Here are more serious problems:

```
File "/home/simon/SAGE/prerelease/sage-5.2.rc0/devel/sage-main/sage/interfaces/gap.py", line 1330:
    sage: 'Centralizer' in s5.trait_names()
Exception raised:
    Traceback (most recent call last):
      File "/home/simon/SAGE/prerelease/sage-5.2.rc0/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/home/simon/SAGE/prerelease/sage-5.2.rc0/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/home/simon/SAGE/prerelease/sage-5.2.rc0/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_46[3]>", line 1, in <module>
        'Centralizer' in s5.trait_names()###line 1330:
    sage: 'Centralizer' in s5.trait_names()
      File "/home/simon/SAGE/prerelease/sage-5.2.rc0/local/lib/python/site-packages/sage/interfaces/gap.py", line 1338, in trait_names
        v = eval(v)
      File "<string>", line 4
        "in", "ShallowCopy", <Attribute "Name",
                             ^
    SyntaxError: invalid syntax
```


In sage/coding/linear_code.py are a few crashes, like this:

```
File "/home/simon/SAGE/prerelease/sage-5.2.rc0/devel/sage-main/sage/coding/linear_code.py", line 2047:
    sage: G.order()
Exception raised:
    Traceback (most recent call last):
...
    RuntimeError: Gap produced error output
    Error, Variable: '$sage16' must have a value

       executing Size($sage16);
**********************************************************************
File "/home/simon/SAGE/prerelease/sage-5.2.rc0/devel/sage-main/sage/coding/linear_code.py", line 2716:
    sage: C.zeta_polynomial()
Exception raised:
    Traceback (most recent call last):
...
    RuntimeError: Gap produced error output
    Error, Variable: '$sage24' must have a value

       executing Print($sage24);
**********************************************************************
File "/home/simon/SAGE/prerelease/sage-5.2.rc0/devel/sage-main/sage/coding/linear_code.py", line 599:
    sage: for B in self_orthogonal_binary_codes(7,3,4):
       print B; print B.gen_mat()
Expected:
    Linear code of length 4, dimension 1 over Finite Field of size 2
    [1 1 1 1]
    Linear code of length 6, dimension 2 over Finite Field of size 2
    [1 1 1 1 0 0]
    [0 1 0 1 1 1]
    Linear code of length 7, dimension 3 over Finite Field of size 2
    [1 0 1 1 0 1 0]
    [0 1 0 1 1 1 0]
    [0 0 1 0 1 1 1]
Got:
    Linear code of length 4, dimension 1 over Finite Field of size 2
    [1 1 1 1]
    ** Gap crashed or quit executing 'Read("/home/simon/.sage//temp/linux_sqwp.site/18857//interface//tmp18907");' **
    Restarting Gap and trying again
    Linear code of length 6, dimension 2 over Finite Field of size 2
    [1 1 1 1 0 0]
    [0 1 0 1 1 1]
    Linear code of length 7, dimension 3 over Finite Field of size 2
    [1 0 1 1 0 1 0]
    [0 1 0 1 1 1 0]
    [0 0 1 0 1 1 1]
**********************************************************************
```


Note the crash in the last example. A similar crash is:

```
File "/home/simon/SAGE/prerelease/sage-5.2.rc0/devel/sage-main/sage/coding/code_constructions.py", line 530:
    sage: C.minimum_distance()
Expected:
    4
Got:
    ** Gap crashed or quit executing 'Read("/home/simon/.sage//temp/linux_sqwp.site/18774//interface//tmp18791");' **
    Restarting Gap and trying again
    4
```


Several tests in latin.py fail, probably because of changes in the random generator. Couldn't one test instead whether the squares really *are* latin?

A strange one:

```
File "/home/simon/SAGE/prerelease/sage-5.2.rc0/devel/sage-main/sage/tests/cmdline.py", line 359:
    sage: out
Expected:
    '120\n'
Got:
    '\x1b[?1034h120\n'
```




---

archive/issue_comments_157552.json:
```json
{
    "body": "I've isolated a test case for the gap crashes and sent it to the GAP developers.",
    "created_at": "2012-08-30T15:51:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157552",
    "user": "https://github.com/vbraun"
}
```

I've isolated a test case for the gap crashes and sent it to the GAP developers.



---

archive/issue_comments_157553.json:
```json
{
    "body": "Changing keywords from \"rng\" to \"\".",
    "created_at": "2012-08-30T17:52:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157553",
    "user": "https://github.com/vbraun"
}
```

Changing keywords from "rng" to "".



---

archive/issue_comments_157554.json:
```json
{
    "body": "The crashes are all due to a GAP garbage collection bug in Z/2Z-specific code. I've fixed all other doctest errors. The only remaining ones are\n\n```\nsage -t  -force_lib devel/sage/sage/coding/code_constructions.py # 1 doctests failed\nsage -t  -force_lib devel/sage/sage/coding/linear_code.py # 3 doctests failed\n```\n",
    "created_at": "2012-08-30T17:52:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157554",
    "user": "https://github.com/vbraun"
}
```

The crashes are all due to a GAP garbage collection bug in Z/2Z-specific code. I've fixed all other doctest errors. The only remaining ones are

```
sage -t  -force_lib devel/sage/sage/coding/code_constructions.py # 1 doctests failed
sage -t  -force_lib devel/sage/sage/coding/linear_code.py # 3 doctests failed
```




---

archive/issue_comments_157555.json:
```json
{
    "body": "I received a patch from the upstream developers, to be included in gap-4.5.6. I've updated the gap spkg with the fix, now the Sage testsuite runs without errors. I also updated the gap_packages spkg with a fix for a function name clash in braid-1.1 that broke the GAP testsuite (i.e. SAGE_CHECK=yes). So as far as I'm concerned we are good to go.\n\nI would appreciate a speedy review of this ticket *nudge* *nudge*",
    "created_at": "2012-09-02T11:28:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157555",
    "user": "https://github.com/vbraun"
}
```

I received a patch from the upstream developers, to be included in gap-4.5.6. I've updated the gap spkg with the fix, now the Sage testsuite runs without errors. I also updated the gap_packages spkg with a fix for a function name clash in braid-1.1 that broke the GAP testsuite (i.e. SAGE_CHECK=yes). So as far as I'm concerned we are good to go.

I would appreciate a speedy review of this ticket *nudge* *nudge*



---

archive/issue_comments_157556.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-09-02T11:28:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157556",
    "user": "https://github.com/vbraun"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_157557.json:
```json
{
    "body": "Installing the gap-4.5.5 spkg, the new gap packages and database gap spkgs worked fine on `openSuse` with `SAGE_CHECK=yes`. Now I'll start the Sage test suite.",
    "created_at": "2012-09-02T14:20:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157557",
    "user": "https://github.com/simon-king-jena"
}
```

Installing the gap-4.5.5 spkg, the new gap packages and database gap spkgs worked fine on `openSuse` with `SAGE_CHECK=yes`. Now I'll start the Sage test suite.



---

archive/issue_comments_157558.json:
```json
{
    "body": "The Sage test suite passes as well. `hg status` has nothing to complain, in any of the three packages. And `SPKG.txt` is updated in all cases. Hence, from my perspective, it is a positive review. However, I'll repeat on bsd.math, and perhaps someone else can repeat on `openSolaris`.",
    "created_at": "2012-09-02T15:49:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157558",
    "user": "https://github.com/simon-king-jena"
}
```

The Sage test suite passes as well. `hg status` has nothing to complain, in any of the three packages. And `SPKG.txt` is updated in all cases. Hence, from my perspective, it is a positive review. However, I'll repeat on bsd.math, and perhaps someone else can repeat on `openSolaris`.



---

archive/issue_comments_157559.json:
```json
{
    "body": "PS: Unfortunately most test of the to-be-reviewed latest version of my p_group_cohomology spkg fail with the new versions of Singular and GAP. But I guess that's my own problem...",
    "created_at": "2012-09-02T15:51:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157559",
    "user": "https://github.com/simon-king-jena"
}
```

PS: Unfortunately most test of the to-be-reviewed latest version of my p_group_cohomology spkg fail with the new versions of Singular and GAP. But I guess that's my own problem...



---

archive/issue_comments_157560.json:
```json
{
    "body": "Dear Volker and Simon,\n\nThanks very much for your work on this one.  I've been becoming a lot more familiar with the GAP interface this summer and getting undergraduate students involved, so I really appreciate your work getting this organized and reviewed.\n\nRob",
    "created_at": "2012-09-02T18:29:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157560",
    "user": "https://github.com/rbeezer"
}
```

Dear Volker and Simon,

Thanks very much for your work on this one.  I've been becoming a lot more familiar with the GAP interface this summer and getting undergraduate students involved, so I really appreciate your work getting this organized and reviewed.

Rob



---

archive/issue_comments_157561.json:
```json
{
    "body": "On two different OS X 10.7 machines, there is one doctest failure:\n\n```\nsage -t --long \"devel/sage/sage/interfaces/gap.py\"          \n**********************************************************************\nFile \"/Users/palmieri/Desktop/Sage_stuff/sage_builds/sage-5.3.rc0-gap/devel/sage/sage/interfaces/gap.py\", line 521:\n    sage: a = gap(3)\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/palmieri/Desktop/Sage_stuff/sage_builds/sage-5.3.rc0-gap/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/Users/palmieri/Desktop/Sage_stuff/sage_builds/sage-5.3.rc0-gap/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/Users/palmieri/Desktop/Sage_stuff/sage_builds/sage-5.3.rc0-gap/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_9[8]>\", line 1, in <module>\n        a = gap(Integer(3))###line 521:\n    sage: a = gap(3)\n      File \"/Users/palmieri/Desktop/Sage_stuff/sage_builds/sage-5.3.rc0-gap/local/lib/python/site-packages/sage/interfaces/interface.py\", line 197, in __call__\n        return self._coerce_from_special_method(x)\n      File \"/Users/palmieri/Desktop/Sage_stuff/sage_builds/sage-5.3.rc0-gap/local/lib/python/site-packages/sage/interfaces/interface.py\", line 223, in _coerce_from_special_method\n        return (x.__getattribute__(s))(self)\n      File \"sage_object.pyx\", line 463, in sage.structure.sage_object.SageObject._gap_ (sage/structure/sage_object.c:4529)\n      File \"sage_object.pyx\", line 439, in sage.structure.sage_object.SageObject._interface_ (sage/structure/sage_object.c:4129)\n      File \"/Users/palmieri/Desktop/Sage_stuff/sage_builds/sage-5.3.rc0-gap/local/lib/python/site-packages/sage/interfaces/interface.py\", line 195, in __call__\n        return cls(self, x, name=name)\n      File \"/Users/palmieri/Desktop/Sage_stuff/sage_builds/sage-5.3.rc0-gap/local/lib/python/site-packages/sage/interfaces/expect.py\", line 1330, in __init__\n        raise TypeError, x\n    TypeError: Gap produced error output\n    Error, user interrupt\n\n       executing $sage4:=3;;\n**********************************************************************\n```\n\nI'll try to build on OpenSolaris, too.",
    "created_at": "2012-09-02T22:53:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157561",
    "user": "https://github.com/jhpalmieri"
}
```

On two different OS X 10.7 machines, there is one doctest failure:

```
sage -t --long "devel/sage/sage/interfaces/gap.py"          
**********************************************************************
File "/Users/palmieri/Desktop/Sage_stuff/sage_builds/sage-5.3.rc0-gap/devel/sage/sage/interfaces/gap.py", line 521:
    sage: a = gap(3)
Exception raised:
    Traceback (most recent call last):
      File "/Users/palmieri/Desktop/Sage_stuff/sage_builds/sage-5.3.rc0-gap/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/Users/palmieri/Desktop/Sage_stuff/sage_builds/sage-5.3.rc0-gap/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/Users/palmieri/Desktop/Sage_stuff/sage_builds/sage-5.3.rc0-gap/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_9[8]>", line 1, in <module>
        a = gap(Integer(3))###line 521:
    sage: a = gap(3)
      File "/Users/palmieri/Desktop/Sage_stuff/sage_builds/sage-5.3.rc0-gap/local/lib/python/site-packages/sage/interfaces/interface.py", line 197, in __call__
        return self._coerce_from_special_method(x)
      File "/Users/palmieri/Desktop/Sage_stuff/sage_builds/sage-5.3.rc0-gap/local/lib/python/site-packages/sage/interfaces/interface.py", line 223, in _coerce_from_special_method
        return (x.__getattribute__(s))(self)
      File "sage_object.pyx", line 463, in sage.structure.sage_object.SageObject._gap_ (sage/structure/sage_object.c:4529)
      File "sage_object.pyx", line 439, in sage.structure.sage_object.SageObject._interface_ (sage/structure/sage_object.c:4129)
      File "/Users/palmieri/Desktop/Sage_stuff/sage_builds/sage-5.3.rc0-gap/local/lib/python/site-packages/sage/interfaces/interface.py", line 195, in __call__
        return cls(self, x, name=name)
      File "/Users/palmieri/Desktop/Sage_stuff/sage_builds/sage-5.3.rc0-gap/local/lib/python/site-packages/sage/interfaces/expect.py", line 1330, in __init__
        raise TypeError, x
    TypeError: Gap produced error output
    Error, user interrupt

       executing $sage4:=3;;
**********************************************************************
```

I'll try to build on OpenSolaris, too.



---

archive/issue_comments_157562.json:
```json
{
    "body": "Replying to [comment:20 jhpalmieri]:\n> On two different OS X 10.7 machines, there is one doctest failure:\n> {{{\n> sage -t --long \"devel/sage/sage/interfaces/gap.py\"          \n> **********************************************************************\n> File \"/Users/palmieri/Desktop/Sage_stuff/sage_builds/sage-5.3.rc0-gap/devel/sage/sage/interfaces/gap.py\", line 521:\n>     sage: a = gap(3)\n> Exception raised:\n>     Traceback (most recent call last):\n> ...\n> }}}\n> I'll try to build on OpenSolaris, too.\n\nWow. That's not good. I suppose that there are a lot of further errors. If `gap(3)` breaks then I guess most other gap stuff will break, too.\n\nFWIW, make ptest worked on my laptop and make ptestlong worked on bsd.math. The spkgs look fine, in terms of `hg status` and `SPKG.txt`.",
    "created_at": "2012-09-03T05:24:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157562",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:20 jhpalmieri]:
> On two different OS X 10.7 machines, there is one doctest failure:
> {{{
> sage -t --long "devel/sage/sage/interfaces/gap.py"          
> **********************************************************************
> File "/Users/palmieri/Desktop/Sage_stuff/sage_builds/sage-5.3.rc0-gap/devel/sage/sage/interfaces/gap.py", line 521:
>     sage: a = gap(3)
> Exception raised:
>     Traceback (most recent call last):
> ...
> }}}
> I'll try to build on OpenSolaris, too.

Wow. That's not good. I suppose that there are a lot of further errors. If `gap(3)` breaks then I guess most other gap stuff will break, too.

FWIW, make ptest worked on my laptop and make ptestlong worked on bsd.math. The spkgs look fine, in terms of `hg status` and `SPKG.txt`.



---

archive/issue_comments_157563.json:
```json
{
    "body": "That is the only error, actually. I did `make ptestlong` and everything else passed.",
    "created_at": "2012-09-03T05:36:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157563",
    "user": "https://github.com/jhpalmieri"
}
```

That is the only error, actually. I did `make ptestlong` and everything else passed.



---

archive/issue_comments_157564.json:
```json
{
    "body": "A little more data: I can only get the doctest to fail if the system is somewhat loaded (for example, doing parallel doctests). If the system is idle, the doctest passes consistently; if it's loaded, the doctest fails consistently.\n\n(In more detail: I am remotely logging into the machine in my office at the university, and I know that no one else uses the machine. Running 'make ptestlong` gives a failure, running `./sage -tp 2 devel/sage/sage/interfaces/` gives a failure, running the doctest while I'm also building another installation of Sage gives a failure, while it passes when running the doctest by itself. It's quite repeatable.)",
    "created_at": "2012-09-03T05:53:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157564",
    "user": "https://github.com/jhpalmieri"
}
```

A little more data: I can only get the doctest to fail if the system is somewhat loaded (for example, doing parallel doctests). If the system is idle, the doctest passes consistently; if it's loaded, the doctest fails consistently.

(In more detail: I am remotely logging into the machine in my office at the university, and I know that no one else uses the machine. Running 'make ptestlong` gives a failure, running `./sage -tp 2 devel/sage/sage/interfaces/` gives a failure, running the doctest while I'm also building another installation of Sage gives a failure, while it passes when running the doctest by itself. It's quite repeatable.)



---

archive/issue_comments_157565.json:
```json
{
    "body": "Replying to [comment:21 SimonKing]:\n> Wow. That's not good. I suppose that there are a lot of further errors. If `gap(3)` breaks then I guess most other gap stuff will break, too.\n\nThis is where Ctrl-C is tested, for the record.\n\nEdit: where automatic restarting of the GAP interpreter is tested.",
    "created_at": "2012-09-03T08:24:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157565",
    "user": "https://github.com/vbraun"
}
```

Replying to [comment:21 SimonKing]:
> Wow. That's not good. I suppose that there are a lot of further errors. If `gap(3)` breaks then I guess most other gap stuff will break, too.

This is where Ctrl-C is tested, for the record.

Edit: where automatic restarting of the GAP interpreter is tested.



---

archive/issue_comments_157566.json:
```json
{
    "body": "Replying to [comment:24 vbraun]:\n> This is where Ctrl-C is tested, for the record.\n> \n> Edit: where automatic restarting of the GAP interpreter is tested.\n\nYou mean this one?\n\n```\n        The following tests against a bug fixed at trac ticket #10296:\n\n            sage: a = gap(3)\n            sage: gap.eval('quit;')\n            ''\n            sage: a = gap(3)\n            ** Gap crashed or quit executing '$sage...:=3;;' **\n            Restarting Gap and trying again\n            sage: a\n            3\n```\n\nDoes it fail in the first or in the second instance of `a = gap(3)`? Why does it report a user interrupt, when either nothing has happened at all (first instance) or GAP was not running (second instance)?",
    "created_at": "2012-09-03T09:12:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157566",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:24 vbraun]:
> This is where Ctrl-C is tested, for the record.
> 
> Edit: where automatic restarting of the GAP interpreter is tested.

You mean this one?

```
        The following tests against a bug fixed at trac ticket #10296:

            sage: a = gap(3)
            sage: gap.eval('quit;')
            ''
            sage: a = gap(3)
            ** Gap crashed or quit executing '$sage...:=3;;' **
            Restarting Gap and trying again
            sage: a
            3
```

Does it fail in the first or in the second instance of `a = gap(3)`? Why does it report a user interrupt, when either nothing has happened at all (first instance) or GAP was not running (second instance)?



---

archive/issue_comments_157567.json:
```json
{
    "body": "I could reproduce this in repeated testing on Linux. You actually need to scroll up a bit higher:\n\n```\n            sage: gap.interrupt(timeout=1) is not None\n            True\n            sage: gap._eval_using_file_cutoff = cutoff\n\n        The following tests against a bug fixed at trac ticket #10296:\n\n            sage: a = gap(3)\n```\n\nand it dies in the first `gap(3)`. Because our `interrupt()` method is crap, it sends the wrong quit string and GAP/readline interferes with Ctrl-C. \n\nThe updated patch fixes this. I still find a ~1% chance of failing `sage.interfaces.gap` doctests in random places, but thats probably on par for any pexpect interface.",
    "created_at": "2012-09-03T10:42:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157567",
    "user": "https://github.com/vbraun"
}
```

I could reproduce this in repeated testing on Linux. You actually need to scroll up a bit higher:

```
            sage: gap.interrupt(timeout=1) is not None
            True
            sage: gap._eval_using_file_cutoff = cutoff

        The following tests against a bug fixed at trac ticket #10296:

            sage: a = gap(3)
```

and it dies in the first `gap(3)`. Because our `interrupt()` method is crap, it sends the wrong quit string and GAP/readline interferes with Ctrl-C. 

The updated patch fixes this. I still find a ~1% chance of failing `sage.interfaces.gap` doctests in random places, but thats probably on par for any pexpect interface.



---

archive/issue_comments_157568.json:
```json
{
    "body": "Also `gap_console()` was broken. Fixed it and added a meaningful doctest.",
    "created_at": "2012-09-03T11:41:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157568",
    "user": "https://github.com/vbraun"
}
```

Also `gap_console()` was broken. Fixed it and added a meaningful doctest.



---

archive/issue_comments_157569.json:
```json
{
    "body": "On OpenSolaris, I am getting doctest failures in interfaces/expect.py. The failures are not always the same, but here is a sample:\n\n- http://sage.math.washington.edu/home/palmieri/misc/EXPECT1.log\n- http://sage.math.washington.edu/home/palmieri/misc/EXPECT2.log\n- http://sage.math.washington.edu/home/palmieri/misc/EXPECT3.log\n\nI don't know what these have to do with this ticket, but they certainly seem to be caused by the spkg here.\n\n--------\n\nBy the way, the new library patch seems to fix the issues on OS X.",
    "created_at": "2012-09-03T17:42:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157569",
    "user": "https://github.com/jhpalmieri"
}
```

On OpenSolaris, I am getting doctest failures in interfaces/expect.py. The failures are not always the same, but here is a sample:

- http://sage.math.washington.edu/home/palmieri/misc/EXPECT1.log
- http://sage.math.washington.edu/home/palmieri/misc/EXPECT2.log
- http://sage.math.washington.edu/home/palmieri/misc/EXPECT3.log

I don't know what these have to do with this ticket, but they certainly seem to be caused by the spkg here.

--------

By the way, the new library patch seems to fix the issues on OS X.



---

archive/issue_comments_157570.json:
```json
{
    "body": "\n```\nsage -t --long \"devel/sage/sage/interfaces/expect.py\"       \n**********************************************************************\nFile \"/export/home/palmieri/testing/clean/sage-5.3.rc0/devel/sage/sage/interfaces/expect.py\", line 608:\n    sage: L = [t[1] for t in f(range(5))]\nExpected nothing\nGot:\n    [Errno 12] Not enough space\n    Killing any remaining workers...\n```\n\nDisk is full, it seems.",
    "created_at": "2012-09-03T17:47:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157570",
    "user": "https://github.com/vbraun"
}
```


```
sage -t --long "devel/sage/sage/interfaces/expect.py"       
**********************************************************************
File "/export/home/palmieri/testing/clean/sage-5.3.rc0/devel/sage/sage/interfaces/expect.py", line 608:
    sage: L = [t[1] for t in f(range(5))]
Expected nothing
Got:
    [Errno 12] Not enough space
    Killing any remaining workers...
```

Disk is full, it seems.



---

archive/issue_comments_157571.json:
```json
{
    "body": "Replying to [comment:29 vbraun]:\n\n> Disk is full, it seems.\n\nIt looks like there is space to me, but which disk should I be looking at? I don't understand why after installing the spkg here, if I then do `./sage -f spkg/standard/gap-4.4.12.p7.spkg`, the doctest passes, and then if I do `./sage -f gap-4.5.5.spkg`, it fails again. Does the new version of GAP create temporary files somewhere new, compared to the old version?",
    "created_at": "2012-09-03T18:06:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157571",
    "user": "https://github.com/jhpalmieri"
}
```

Replying to [comment:29 vbraun]:

> Disk is full, it seems.

It looks like there is space to me, but which disk should I be looking at? I don't understand why after installing the spkg here, if I then do `./sage -f spkg/standard/gap-4.4.12.p7.spkg`, the doctest passes, and then if I do `./sage -f gap-4.5.5.spkg`, it fails again. Does the new version of GAP create temporary files somewhere new, compared to the old version?



---

archive/issue_comments_157572.json:
```json
{
    "body": "Replying to [comment:30 jhpalmieri]:\n> It looks like there is space to me, but which disk should I be looking at?\n\nI didn't change anything. All temp files should go to `$DOT_SAGE` as before.",
    "created_at": "2012-09-03T18:28:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157572",
    "user": "https://github.com/vbraun"
}
```

Replying to [comment:30 jhpalmieri]:
> It looks like there is space to me, but which disk should I be looking at?

I didn't change anything. All temp files should go to `$DOT_SAGE` as before.



---

archive/issue_comments_157573.json:
```json
{
    "body": "On bsd.math, at least when #12876 and its dependencies are added, I find:\n\n```\nsage -t -force_lib \"devel/sage/sage/interfaces/gap.py\"      \n**********************************************************************\nFile \"/scratch/sking/sage-5.3.rc1/devel/sage/sage/interfaces/gap.py\", line 809:\n    sage: gap(2)\nExpected:\n    2\nGot:\n    <BLANKLINE>\n**********************************************************************\n1 items had failures:\n   1 of   4 in __main__.example_21\n***Test Failed*** 1 failures.\nFor whitespace errors, see the file /Users/SimonKing/.sage//tmp/gap_70056.py\n         [29.6 s]\n \n----------------------------------------------------------------------\nThe following tests failed:\n\n\n        sage -t -force_lib \"devel/sage/sage/interfaces/gap.py\"\nTotal time for all tests: 29.7 seconds\n```\n\n\nI'd need to repeat without all the other patches, though, to be on the safe side.",
    "created_at": "2012-09-03T19:41:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157573",
    "user": "https://github.com/simon-king-jena"
}
```

On bsd.math, at least when #12876 and its dependencies are added, I find:

```
sage -t -force_lib "devel/sage/sage/interfaces/gap.py"      
**********************************************************************
File "/scratch/sking/sage-5.3.rc1/devel/sage/sage/interfaces/gap.py", line 809:
    sage: gap(2)
Expected:
    2
Got:
    <BLANKLINE>
**********************************************************************
1 items had failures:
   1 of   4 in __main__.example_21
***Test Failed*** 1 failures.
For whitespace errors, see the file /Users/SimonKing/.sage//tmp/gap_70056.py
         [29.6 s]
 
----------------------------------------------------------------------
The following tests failed:


        sage -t -force_lib "devel/sage/sage/interfaces/gap.py"
Total time for all tests: 29.7 seconds
```


I'd need to repeat without all the other patches, though, to be on the safe side.



---

archive/issue_comments_157574.json:
```json
{
    "body": "OpenSolaris: I tried setting DOT_SAGE to /tmp/palmieri, and I still see the same failures with the new spkg, no failures with the old one. Any ideas?",
    "created_at": "2012-09-03T19:44:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157574",
    "user": "https://github.com/jhpalmieri"
}
```

OpenSolaris: I tried setting DOT_SAGE to /tmp/palmieri, and I still see the same failures with the new spkg, no failures with the old one. Any ideas?



---

archive/issue_comments_157575.json:
```json
{
    "body": "Replying to [comment:32 SimonKing]:\n> On bsd.math, at least when #12876 and its dependencies are added, I find:\n> {{{\n> sage -t -force_lib \"devel/sage/sage/interfaces/gap.py\"      \n> **********************************************************************\n> File \"/scratch/sking/sage-5.3.rc1/devel/sage/sage/interfaces/gap.py\", line 809:\n>     sage: gap(2)\n> Expected:\n>     2\n> Got:\n>     <BLANKLINE>\n>> }}}\n\nThe error is reproducible, with just the new spkg and the doctest fix patch applied. That must be a really nasty side effect, because in an interactive session `gap(2)` returns 2.",
    "created_at": "2012-09-03T19:53:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157575",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:32 SimonKing]:
> On bsd.math, at least when #12876 and its dependencies are added, I find:
> {{{
> sage -t -force_lib "devel/sage/sage/interfaces/gap.py"      
> **********************************************************************
> File "/scratch/sking/sage-5.3.rc1/devel/sage/sage/interfaces/gap.py", line 809:
>     sage: gap(2)
> Expected:
>     2
> Got:
>     <BLANKLINE>
>> }}}

The error is reproducible, with just the new spkg and the doctest fix patch applied. That must be a really nasty side effect, because in an interactive session `gap(2)` returns 2.



---

archive/issue_comments_157576.json:
```json
{
    "body": "I took some time to understand the gap pexpect interface. Altogether, I think it would be better to base it on the normal interface which seems to be more stable and definitely has more exposure. But we are using the package mode (`gap -p`) and that is neither documented (apart from the source) nor does it behave particularly well when you send Ctrl-C. But that is definitely for another ticket. \n\nI did add more checks after `interrupt()` that the pexpect interface is in a sane state, and restart gap if it is not. I ran 500+ iterations of the doctest and do not get any failures anymore. I'm pretty confident that this is at least as good as we had before, so please review.",
    "created_at": "2012-09-05T14:20:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157576",
    "user": "https://github.com/vbraun"
}
```

I took some time to understand the gap pexpect interface. Altogether, I think it would be better to base it on the normal interface which seems to be more stable and definitely has more exposure. But we are using the package mode (`gap -p`) and that is neither documented (apart from the source) nor does it behave particularly well when you send Ctrl-C. But that is definitely for another ticket. 

I did add more checks after `interrupt()` that the pexpect interface is in a sane state, and restart gap if it is not. I ran 500+ iterations of the doctest and do not get any failures anymore. I'm pretty confident that this is at least as good as we had before, so please review.



---

archive/issue_comments_157577.json:
```json
{
    "body": "There was one doctest error is `sage/interfaces/expect.py` where there is a synchronization method for the expect interface. Since it doesn't know about the GAP package mode it actually desynchronizes the gap interface ;-) Fixed in the updated patch.",
    "created_at": "2012-09-05T16:25:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157577",
    "user": "https://github.com/vbraun"
}
```

There was one doctest error is `sage/interfaces/expect.py` where there is a synchronization method for the expect interface. Since it doesn't know about the GAP package mode it actually desynchronizes the gap interface ;-) Fixed in the updated patch.



---

archive/issue_comments_157578.json:
```json
{
    "body": "On skynet machine mark (Solaris on sparc, Sage built with `SAGE_INSTALL_GCC=yes`), this version of Gap doesn't work:\n\n```\n$ ./sage --gap\n *********   GAP, Version 4.5.5 of 16-Jul-2012 (free software, GPL)\n *  GAP  *   http://www.gap-system.org\n *********   Architecture: sparc-sun-solaris2.10-gcc-default32\n Libs used:  gmp\n Loading the library and packages ...\n/home/palmieri/mark/sage-5.3.rc1/spkg/bin/sage: line 400:  4079 Bus Error               (core dumped) \"$SAGE_LOCAL/bin/gap\" \"$@\"\n```\n",
    "created_at": "2012-09-05T18:42:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157578",
    "user": "https://github.com/jhpalmieri"
}
```

On skynet machine mark (Solaris on sparc, Sage built with `SAGE_INSTALL_GCC=yes`), this version of Gap doesn't work:

```
$ ./sage --gap
 *********   GAP, Version 4.5.5 of 16-Jul-2012 (free software, GPL)
 *  GAP  *   http://www.gap-system.org
 *********   Architecture: sparc-sun-solaris2.10-gcc-default32
 Libs used:  gmp
 Loading the library and packages ...
/home/palmieri/mark/sage-5.3.rc1/spkg/bin/sage: line 400:  4079 Bus Error               (core dumped) "$SAGE_LOCAL/bin/gap" "$@"
```




---

archive/issue_comments_157579.json:
```json
{
    "body": "I'm not surprised that it doesn't work on SPARC. I'll send the authors a bug report. But since its not a primary platform it shouldn't stop us from shipping the new GAP version.",
    "created_at": "2012-09-05T19:06:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157579",
    "user": "https://github.com/vbraun"
}
```

I'm not surprised that it doesn't work on SPARC. I'll send the authors a bug report. But since its not a primary platform it shouldn't stop us from shipping the new GAP version.



---

archive/issue_comments_157580.json:
```json
{
    "body": "I've investigated the SPARC issue and received a patch from the GAP developers. I've updated the spkg, now builds and tests fine on mark.",
    "created_at": "2012-09-06T13:55:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157580",
    "user": "https://github.com/vbraun"
}
```

I've investigated the SPARC issue and received a patch from the GAP developers. I've updated the spkg, now builds and tests fine on mark.



---

archive/issue_comments_157581.json:
```json
{
    "body": "Naturally, nobody dared to review this ticket. So GAP released the next version in the meantime. Updated to gap-4.5.6.",
    "created_at": "2012-09-22T11:27:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157581",
    "user": "https://github.com/vbraun"
}
```

Naturally, nobody dared to review this ticket. So GAP released the next version in the meantime. Updated to gap-4.5.6.



---

archive/issue_comments_157582.json:
```json
{
    "body": "Replying to [comment:40 vbraun]:\n> Naturally, nobody dared to review this ticket. So GAP released the next version in the meantime. Updated to gap-4.5.6.\n\nchallenge accepted :/ expect a review real soon...",
    "created_at": "2012-09-22T11:34:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157582",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:40 vbraun]:
> Naturally, nobody dared to review this ticket. So GAP released the next version in the meantime. Updated to gap-4.5.6.

challenge accepted :/ expect a review real soon...



---

archive/issue_comments_157583.json:
```json
{
    "body": "http://www.stp.dias.ie/~vbraun/Sage/spkg/gap-4.5.6.spkg has uncommitted changes in `SPKG.txt`\nand the spkg itself is not compressed, making it over 50MB instead of under 10MB.",
    "created_at": "2012-09-22T13:33:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157583",
    "user": "https://github.com/dimpase"
}
```

http://www.stp.dias.ie/~vbraun/Sage/spkg/gap-4.5.6.spkg has uncommitted changes in `SPKG.txt`
and the spkg itself is not compressed, making it over 50MB instead of under 10MB.



---

archive/issue_comments_157584.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-09-22T14:01:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157584",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_157585.json:
```json
{
    "body": "I've created the spkg file with checked in changes and compressed it. The link included in the modified ticket description. Otherwise, great stuff! Positive review.",
    "created_at": "2012-09-22T14:01:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157585",
    "user": "https://github.com/dimpase"
}
```

I've created the spkg file with checked in changes and compressed it. The link included in the modified ticket description. Otherwise, great stuff! Positive review.



---

archive/issue_comments_157586.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2012-09-23T17:44:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157586",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_157587.json:
```json
{
    "body": "This needs to be rebased to #13123.",
    "created_at": "2012-09-23T17:44:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157587",
    "user": "https://github.com/jdemeyer"
}
```

This needs to be rebased to #13123.



---

archive/issue_comments_157588.json:
```json
{
    "body": "I get the following errors on Mac OS X 10.4 PPC.  I think they are all about the seed for random tests.  Notice that they did pass in the past, and they are neither the old nor the new versions of the expected results from the patch here.  Could the little/big-endian have any impact on this?  I assume not, but otherwise it seems odd that they worked in the past and don't now.  Of course, they ARE \"random\"...\n\n```\nsage -t  \"devel/sage-main/sage/algebras/group_algebra_new.py\"\n**********************************************************************\nFile \"/Users/student/Desktop/sage-5.4.beta1/devel/sage-main/sage/algebras/group_algebra_new.py\", line 592:\n    sage: GroupAlgebra(DihedralGroup(6), QQ).random_element()\nExpected:\n    -1/95*(2,6)(3,5) - 1/2*(1,3)(4,6)\nGot:\n    -1/95*(1,3)(4,6) - 1/2*(1,5,3)(2,6,4)\n**********************************************************************\nFile \"/Users/student/Desktop/sage-5.4.beta1/devel/sage-main/sage/algebras/group_algebra_new.py\", line 594:\n    sage: GroupAlgebra(SU(2, 13), QQ).random_element(1)\nExpected:\n    1/2*[      1 9*a + 2]\n    [9*a + 2      12]\nGot:\n    1/2*[       4  9*a + 2]\n    [6*a + 10        1]\n**********************************************************************\n1 items had failures:\n   2 of   5 in __main__.example_23\n***Test Failed*** 2 failures.\nFor whitespace errors, see the file /Users/student/.sage//tmp/group_algebra_new_23167.py\n         [83.0 s]\nsage -t  \"devel/sage-main/sage/groups/matrix_gps/__init__.py\"\n         [2.8 s]\nsage -t  \"devel/sage-main/sage/groups/matrix_gps/all.py\"    \n         [0.9 s]\nsage -t  \"devel/sage-main/sage/groups/matrix_gps/general_linear.py\"\n         [93.5 s]\nsage -t  \"devel/sage-main/sage/groups/matrix_gps/homset.py\" \n         [30.6 s]\nsage -t  \"devel/sage-main/sage/groups/matrix_gps/linear.py\" \n         [21.4 s]\nsage -t  \"devel/sage-main/sage/groups/matrix_gps/matrix_group.py\"\n         [129.7 s]\nsage -t  \"devel/sage-main/sage/groups/matrix_gps/matrix_group_element.py\"\n         [53.0 s]\nsage -t  \"devel/sage-main/sage/groups/matrix_gps/matrix_group_morphism.py\"\n         [50.4 s]\nsage -t  \"devel/sage-main/sage/groups/matrix_gps/orthogonal.py\"\n**********************************************************************\nFile \"/Users/student/Desktop/sage-5.4.beta1/devel/sage-main/sage/groups/matrix_gps/orthogonal.py\", line 244:\n    sage: GO( 3, GF(7), 0).random_element()\nExpected:\n    [1 0 0]\n    [6 1 6]\n    [5 0 6]\nGot:\n    [1 5 3]\n    [0 1 0]\n    [0 6 6]\n**********************************************************************\nFile \"/Users/student/Desktop/sage-5.4.beta1/devel/sage-main/sage/groups/matrix_gps/orthogonal.py\", line 142:\n    sage: G.random_element()\nExpected:\n    [4 3 5 2]\n    [6 6 4 0]\n    [0 4 6 0]\n    [4 4 5 1]\nGot:\n    [0 6 4 6]\n    [2 5 0 2]\n    [5 5 4 0]\n    [1 0 3 4]\n**********************************************************************\n2 items had failures:\n   1 of   6 in __main__.example_10\n   1 of   6 in __main__.example_4\n***Test Failed*** 2 failures.\nFor whitespace errors, see the file /Users/student/.sage//tmp/orthogonal_23218.py\n         [39.1 s]\nsage -t  \"devel/sage-main/sage/groups/matrix_gps/special_linear.py\"\n         [42.5 s]\nsage -t  \"devel/sage-main/sage/groups/matrix_gps/symplectic.py\"\n**********************************************************************\nFile \"/Users/student/Desktop/sage-5.4.beta1/devel/sage-main/sage/groups/matrix_gps/symplectic.py\", line 16:\n    sage: G.random_element()\nExpected:\n    [5 4 6 0]\n    [1 1 6 2]\n    [5 5 0 6]\n    [5 4 5 1]\nGot:\n    [2 3 2 1]\n    [6 4 6 5]\n    [1 2 5 2]\n    [6 5 1 0]\n**********************************************************************\n1 items had failures:\n   1 of   8 in __main__.example_0\n***Test Failed*** 1 failures.\nFor whitespace errors, see the file /Users/student/.sage//tmp/symplectic_23230.py\n         [30.4 s]\nsage -t  \"devel/sage-main/sage/groups/matrix_gps/unitary.py\"\n**********************************************************************\nFile \"/Users/student/Desktop/sage-5.4.beta1/devel/sage-main/sage/groups/matrix_gps/unitary.py\", line 26:\n    sage: G.random_element()\nExpected:\n    [4*a + 1 4*a + 4   a + 4]\n    [3*a + 3       3       3]\n    [  a + 2 4*a + 1 3*a + 3]\nGot:\n    [2*a + 3       4 3*a + 2]\n    [3*a + 4       a 3*a + 1]\n    [    4*a 2*a + 2   a + 2]\n**********************************************************************\n1 items had failures:\n   1 of  10 in __main__.example_0\n***Test Failed*** 1 failures.\nFor whitespace errors, see the file /Users/student/.sage//tmp/unitary_23236.py\n         [31.7 s]\nsage -t  \"devel/sage-main/sage/misc/randstate.pyx\"          \n**********************************************************************\nFile \"/Users/student/Desktop/sage-5.4.beta1/devel/sage-main/sage/misc/randstate.pyx\", line 57:\n    sage: rtest()\nExpected:\n    (303, -0.266166246380421, 1/2*x^2 - 1/95*x - 1/2, (1,3,2), [ 0, 0, 0, 0, 1 ], 963229057, 8045, 0.9661911734708414)  \nGot:\n    (303, -0.266166246380421, 1/2*x^2 - 1/95*x - 1/2, (1,2)(4,5), [ 0, 0, 0, 0, 1 ], 963229057, 8045, 0.9661911734708414)\n**********************************************************************\nFile \"/Users/student/Desktop/sage-5.4.beta1/devel/sage-main/sage/misc/randstate.pyx\", line 61:\n    sage: rtest()\nExpected:\n    (978, 0.0557699430711638, -3*x^2 - 1/12, (1,3,2), [ 0, 1, 1, 0, 0 ], 1161603091, 60359, 0.8335077654199736)  \nGot:\n    (978, 0.0557699430711638, -3*x^2 - 1/12, (1,2,3), [ 0, 1, 1, 0, 0 ], 1161603091, 60359, 0.8335077654199736)\n**********************************************************************\nFile \"/Users/student/Desktop/sage-5.4.beta1/devel/sage-main/sage/misc/randstate.pyx\", line 65:\n    sage: rtest()\nExpected:\n    (207, -0.0141049486533456, 4*x^2 + 1/2, (1,3,2), [ 0, 0, 1, 0, 1 ],  637693405, 27695, 0.19982565117278328)  \nGot:\n    (207, -0.0141049486533456, 4*x^2 + 1/2, (2,3), [ 0, 0, 1, 0, 1 ], 637693405, 27695, 0.19982565117278328)\n**********************************************************************\nFile \"/Users/student/Desktop/sage-5.4.beta1/devel/sage-main/sage/misc/randstate.pyx\", line 69:\n    sage: rtest()\nExpected:\n    (303, -0.266166246380421, 1/2*x^2 - 1/95*x - 1/2, (1,3,2), [ 0, 0, 0, 0, 1 ], 963229057, 8045, 0.9661911734708414)  \nGot:\n    (303, -0.266166246380421, 1/2*x^2 - 1/95*x - 1/2, (1,2)(4,5), [ 0, 0, 0, 0, 1 ], 963229057, 8045, 0.9661911734708414)\n**********************************************************************\nFile \"/Users/student/Desktop/sage-5.4.beta1/devel/sage-main/sage/misc/randstate.pyx\", line 73:\n    sage: rtest()\nExpected:\n    (978, 0.0557699430711638, -3*x^2 - 1/12, (1,3,2), [ 0, 1, 1, 0, 0 ], 1161603091, 60359, 0.8335077654199736)  \nGot:\n    (978, 0.0557699430711638, -3*x^2 - 1/12, (1,2,3), [ 0, 1, 1, 0, 0 ], 1161603091, 60359, 0.8335077654199736)\n**********************************************************************\nFile \"/Users/student/Desktop/sage-5.4.beta1/devel/sage-main/sage/misc/randstate.pyx\", line 77:\n    sage: rtest()\nExpected:\n    (207, -0.0141049486533456, 4*x^2 + 1/2, (1,3,2), [ 0, 0, 1, 0, 1 ],  637693405, 27695, 0.19982565117278328)  \nGot:\n    (207, -0.0141049486533456, 4*x^2 + 1/2, (2,3), [ 0, 0, 1, 0, 1 ], 637693405, 27695, 0.19982565117278328)\n**********************************************************************\nFile \"/Users/student/Desktop/sage-5.4.beta1/devel/sage-main/sage/misc/randstate.pyx\", line 88:\n    sage: rtest()\nExpected:\n    (720, -0.612180244315804, x^2 - x, (2,3), [ 1, 0, 0, 0, 0 ], 912534076, 14005, 0.9205331599518184)   \nGot:\n    (720, -0.612180244315804, x^2 - x, (1,3), [ 1, 0, 0, 0, 0 ], 912534076, 14005, 0.9205331599518184)\n**********************************************************************\nFile \"/Users/student/Desktop/sage-5.4.beta1/devel/sage-main/sage/misc/randstate.pyx\", line 224:\n    sage: r1 = rtest(); r1\nExpected:\n    (303, -0.266166246380421, 1/2*x^2 - 1/95*x - 1/2, (1,3,2), [ 0, 0, 0, 0, 1 ], 963229057, 8045, 0.9661911734708414)  \nGot:\n    (303, -0.266166246380421, 1/2*x^2 - 1/95*x - 1/2, (1,2)(4,5), [ 0, 0, 0, 0, 1 ], 963229057, 8045, 0.9661911734708414)\n**********************************************************************\nFile \"/Users/student/Desktop/sage-5.4.beta1/devel/sage-main/sage/misc/randstate.pyx\", line 227:\n    sage: r2 = rtest(); r2\nExpected:\n    (105, 0.642309615982449, -x^2 - x - 6, (1,2,3), [ 1, 0, 0, 1, 1 ], 14082860, 1271, 0.001767155077382232)  \nGot:\n    (105, 0.642309615982449, -x^2 - x - 6, (4,5), [ 1, 0, 0, 1, 1 ], 14082860, 1271, 0.001767155077382232)\n**********************************************************************\nFile \"/Users/student/Desktop/sage-5.4.beta1/devel/sage-main/sage/misc/randstate.pyx\", line 236:\n    sage: with seed(1): rtest()\nExpected:\n    (978, 0.0557699430711638, -3*x^2 - 1/12, (1,3,2), [ 0, 1, 1, 0, 0 ], 1161603091, 60359, 0.8335077654199736)  \nGot:\n    (978, 0.0557699430711638, -3*x^2 - 1/12, (1,2,3), [ 0, 1, 1, 0, 0 ], 1161603091, 60359, 0.8335077654199736)\n**********************************************************************\nFile \"/Users/student/Desktop/sage-5.4.beta1/devel/sage-main/sage/misc/randstate.pyx\", line 239:\n    sage: r2m = rtest(); r2m\nExpected:\n    (105, 0.642309615982449, -x^2 - x - 6, (1,2,3), [ 1, 0, 0, 1, 1 ], 14082860, 19769, 0.001767155077382232)  \nGot:\n    (105, 0.642309615982449, -x^2 - x - 6, (4,5), [ 1, 0, 0, 1, 1 ], 14082860, 19769, 0.001767155077382232)\n**********************************************************************\nFile \"/Users/student/Desktop/sage-5.4.beta1/devel/sage-main/sage/misc/randstate.pyx\", line 255:\n    sage: with seed(1):\n          rtest();\n          rtest();\nExpected:\n    (978, 0.0557699430711638, -3*x^2 - 1/12, (1,3,2), [ 0, 1, 1, 0, 0 ], 1161603091, 60359, 0.8335077654199736)  \n    (138, -0.0404945051288503, 2*x - 24, (2,3), [ 1, 1, 1, 0, 1 ], 1966097838, 10234, 0.0033332230808060803)      \nGot:\n    (978, 0.0557699430711638, -3*x^2 - 1/12, (1,2,3), [ 0, 1, 1, 0, 0 ], 1161603091, 60359, 0.8335077654199736)\n    (138, -0.0404945051288503, 2*x - 24, (2,3), [ 1, 1, 1, 0, 1 ], 1966097838, 10234, 0.0033332230808060803)\n**********************************************************************\nFile \"/Users/student/Desktop/sage-5.4.beta1/devel/sage-main/sage/misc/randstate.pyx\", line 274:\n    sage: try:\n          ctx.__enter__()\n          rtest()\n    finally:\n          ctx.__exit__(None, None, None)\nExpected:\n    <sage.misc.randstate.randstate object at 0x...>\n    (978, 0.0557699430711638, -3*x^2 - 1/12, (1,3,2), [ 0, 1, 1, 0, 0 ], 1161603091, 60359, 0.8335077654199736)  \n    False\nGot:\n    <sage.misc.randstate.randstate object at 0x155950c0>\n    (978, 0.0557699430711638, -3*x^2 - 1/12, (1,2,3), [ 0, 1, 1, 0, 0 ], 1161603091, 60359, 0.8335077654199736)\n    False\n**********************************************************************\nFile \"/Users/student/Desktop/sage-5.4.beta1/devel/sage-main/sage/misc/randstate.pyx\", line 703:\n    sage: gap.Random(1, 10^50)\nExpected:\n    1496738263332555434474532297768680634540939580077\nGot:\n    97144566318213989637952954803537490912828430192472\n**********************************************************************\n```\n",
    "created_at": "2012-09-24T17:18:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157588",
    "user": "https://github.com/kcrisman"
}
```

I get the following errors on Mac OS X 10.4 PPC.  I think they are all about the seed for random tests.  Notice that they did pass in the past, and they are neither the old nor the new versions of the expected results from the patch here.  Could the little/big-endian have any impact on this?  I assume not, but otherwise it seems odd that they worked in the past and don't now.  Of course, they ARE "random"...

```
sage -t  "devel/sage-main/sage/algebras/group_algebra_new.py"
**********************************************************************
File "/Users/student/Desktop/sage-5.4.beta1/devel/sage-main/sage/algebras/group_algebra_new.py", line 592:
    sage: GroupAlgebra(DihedralGroup(6), QQ).random_element()
Expected:
    -1/95*(2,6)(3,5) - 1/2*(1,3)(4,6)
Got:
    -1/95*(1,3)(4,6) - 1/2*(1,5,3)(2,6,4)
**********************************************************************
File "/Users/student/Desktop/sage-5.4.beta1/devel/sage-main/sage/algebras/group_algebra_new.py", line 594:
    sage: GroupAlgebra(SU(2, 13), QQ).random_element(1)
Expected:
    1/2*[      1 9*a + 2]
    [9*a + 2      12]
Got:
    1/2*[       4  9*a + 2]
    [6*a + 10        1]
**********************************************************************
1 items had failures:
   2 of   5 in __main__.example_23
***Test Failed*** 2 failures.
For whitespace errors, see the file /Users/student/.sage//tmp/group_algebra_new_23167.py
         [83.0 s]
sage -t  "devel/sage-main/sage/groups/matrix_gps/__init__.py"
         [2.8 s]
sage -t  "devel/sage-main/sage/groups/matrix_gps/all.py"    
         [0.9 s]
sage -t  "devel/sage-main/sage/groups/matrix_gps/general_linear.py"
         [93.5 s]
sage -t  "devel/sage-main/sage/groups/matrix_gps/homset.py" 
         [30.6 s]
sage -t  "devel/sage-main/sage/groups/matrix_gps/linear.py" 
         [21.4 s]
sage -t  "devel/sage-main/sage/groups/matrix_gps/matrix_group.py"
         [129.7 s]
sage -t  "devel/sage-main/sage/groups/matrix_gps/matrix_group_element.py"
         [53.0 s]
sage -t  "devel/sage-main/sage/groups/matrix_gps/matrix_group_morphism.py"
         [50.4 s]
sage -t  "devel/sage-main/sage/groups/matrix_gps/orthogonal.py"
**********************************************************************
File "/Users/student/Desktop/sage-5.4.beta1/devel/sage-main/sage/groups/matrix_gps/orthogonal.py", line 244:
    sage: GO( 3, GF(7), 0).random_element()
Expected:
    [1 0 0]
    [6 1 6]
    [5 0 6]
Got:
    [1 5 3]
    [0 1 0]
    [0 6 6]
**********************************************************************
File "/Users/student/Desktop/sage-5.4.beta1/devel/sage-main/sage/groups/matrix_gps/orthogonal.py", line 142:
    sage: G.random_element()
Expected:
    [4 3 5 2]
    [6 6 4 0]
    [0 4 6 0]
    [4 4 5 1]
Got:
    [0 6 4 6]
    [2 5 0 2]
    [5 5 4 0]
    [1 0 3 4]
**********************************************************************
2 items had failures:
   1 of   6 in __main__.example_10
   1 of   6 in __main__.example_4
***Test Failed*** 2 failures.
For whitespace errors, see the file /Users/student/.sage//tmp/orthogonal_23218.py
         [39.1 s]
sage -t  "devel/sage-main/sage/groups/matrix_gps/special_linear.py"
         [42.5 s]
sage -t  "devel/sage-main/sage/groups/matrix_gps/symplectic.py"
**********************************************************************
File "/Users/student/Desktop/sage-5.4.beta1/devel/sage-main/sage/groups/matrix_gps/symplectic.py", line 16:
    sage: G.random_element()
Expected:
    [5 4 6 0]
    [1 1 6 2]
    [5 5 0 6]
    [5 4 5 1]
Got:
    [2 3 2 1]
    [6 4 6 5]
    [1 2 5 2]
    [6 5 1 0]
**********************************************************************
1 items had failures:
   1 of   8 in __main__.example_0
***Test Failed*** 1 failures.
For whitespace errors, see the file /Users/student/.sage//tmp/symplectic_23230.py
         [30.4 s]
sage -t  "devel/sage-main/sage/groups/matrix_gps/unitary.py"
**********************************************************************
File "/Users/student/Desktop/sage-5.4.beta1/devel/sage-main/sage/groups/matrix_gps/unitary.py", line 26:
    sage: G.random_element()
Expected:
    [4*a + 1 4*a + 4   a + 4]
    [3*a + 3       3       3]
    [  a + 2 4*a + 1 3*a + 3]
Got:
    [2*a + 3       4 3*a + 2]
    [3*a + 4       a 3*a + 1]
    [    4*a 2*a + 2   a + 2]
**********************************************************************
1 items had failures:
   1 of  10 in __main__.example_0
***Test Failed*** 1 failures.
For whitespace errors, see the file /Users/student/.sage//tmp/unitary_23236.py
         [31.7 s]
sage -t  "devel/sage-main/sage/misc/randstate.pyx"          
**********************************************************************
File "/Users/student/Desktop/sage-5.4.beta1/devel/sage-main/sage/misc/randstate.pyx", line 57:
    sage: rtest()
Expected:
    (303, -0.266166246380421, 1/2*x^2 - 1/95*x - 1/2, (1,3,2), [ 0, 0, 0, 0, 1 ], 963229057, 8045, 0.9661911734708414)  
Got:
    (303, -0.266166246380421, 1/2*x^2 - 1/95*x - 1/2, (1,2)(4,5), [ 0, 0, 0, 0, 1 ], 963229057, 8045, 0.9661911734708414)
**********************************************************************
File "/Users/student/Desktop/sage-5.4.beta1/devel/sage-main/sage/misc/randstate.pyx", line 61:
    sage: rtest()
Expected:
    (978, 0.0557699430711638, -3*x^2 - 1/12, (1,3,2), [ 0, 1, 1, 0, 0 ], 1161603091, 60359, 0.8335077654199736)  
Got:
    (978, 0.0557699430711638, -3*x^2 - 1/12, (1,2,3), [ 0, 1, 1, 0, 0 ], 1161603091, 60359, 0.8335077654199736)
**********************************************************************
File "/Users/student/Desktop/sage-5.4.beta1/devel/sage-main/sage/misc/randstate.pyx", line 65:
    sage: rtest()
Expected:
    (207, -0.0141049486533456, 4*x^2 + 1/2, (1,3,2), [ 0, 0, 1, 0, 1 ],  637693405, 27695, 0.19982565117278328)  
Got:
    (207, -0.0141049486533456, 4*x^2 + 1/2, (2,3), [ 0, 0, 1, 0, 1 ], 637693405, 27695, 0.19982565117278328)
**********************************************************************
File "/Users/student/Desktop/sage-5.4.beta1/devel/sage-main/sage/misc/randstate.pyx", line 69:
    sage: rtest()
Expected:
    (303, -0.266166246380421, 1/2*x^2 - 1/95*x - 1/2, (1,3,2), [ 0, 0, 0, 0, 1 ], 963229057, 8045, 0.9661911734708414)  
Got:
    (303, -0.266166246380421, 1/2*x^2 - 1/95*x - 1/2, (1,2)(4,5), [ 0, 0, 0, 0, 1 ], 963229057, 8045, 0.9661911734708414)
**********************************************************************
File "/Users/student/Desktop/sage-5.4.beta1/devel/sage-main/sage/misc/randstate.pyx", line 73:
    sage: rtest()
Expected:
    (978, 0.0557699430711638, -3*x^2 - 1/12, (1,3,2), [ 0, 1, 1, 0, 0 ], 1161603091, 60359, 0.8335077654199736)  
Got:
    (978, 0.0557699430711638, -3*x^2 - 1/12, (1,2,3), [ 0, 1, 1, 0, 0 ], 1161603091, 60359, 0.8335077654199736)
**********************************************************************
File "/Users/student/Desktop/sage-5.4.beta1/devel/sage-main/sage/misc/randstate.pyx", line 77:
    sage: rtest()
Expected:
    (207, -0.0141049486533456, 4*x^2 + 1/2, (1,3,2), [ 0, 0, 1, 0, 1 ],  637693405, 27695, 0.19982565117278328)  
Got:
    (207, -0.0141049486533456, 4*x^2 + 1/2, (2,3), [ 0, 0, 1, 0, 1 ], 637693405, 27695, 0.19982565117278328)
**********************************************************************
File "/Users/student/Desktop/sage-5.4.beta1/devel/sage-main/sage/misc/randstate.pyx", line 88:
    sage: rtest()
Expected:
    (720, -0.612180244315804, x^2 - x, (2,3), [ 1, 0, 0, 0, 0 ], 912534076, 14005, 0.9205331599518184)   
Got:
    (720, -0.612180244315804, x^2 - x, (1,3), [ 1, 0, 0, 0, 0 ], 912534076, 14005, 0.9205331599518184)
**********************************************************************
File "/Users/student/Desktop/sage-5.4.beta1/devel/sage-main/sage/misc/randstate.pyx", line 224:
    sage: r1 = rtest(); r1
Expected:
    (303, -0.266166246380421, 1/2*x^2 - 1/95*x - 1/2, (1,3,2), [ 0, 0, 0, 0, 1 ], 963229057, 8045, 0.9661911734708414)  
Got:
    (303, -0.266166246380421, 1/2*x^2 - 1/95*x - 1/2, (1,2)(4,5), [ 0, 0, 0, 0, 1 ], 963229057, 8045, 0.9661911734708414)
**********************************************************************
File "/Users/student/Desktop/sage-5.4.beta1/devel/sage-main/sage/misc/randstate.pyx", line 227:
    sage: r2 = rtest(); r2
Expected:
    (105, 0.642309615982449, -x^2 - x - 6, (1,2,3), [ 1, 0, 0, 1, 1 ], 14082860, 1271, 0.001767155077382232)  
Got:
    (105, 0.642309615982449, -x^2 - x - 6, (4,5), [ 1, 0, 0, 1, 1 ], 14082860, 1271, 0.001767155077382232)
**********************************************************************
File "/Users/student/Desktop/sage-5.4.beta1/devel/sage-main/sage/misc/randstate.pyx", line 236:
    sage: with seed(1): rtest()
Expected:
    (978, 0.0557699430711638, -3*x^2 - 1/12, (1,3,2), [ 0, 1, 1, 0, 0 ], 1161603091, 60359, 0.8335077654199736)  
Got:
    (978, 0.0557699430711638, -3*x^2 - 1/12, (1,2,3), [ 0, 1, 1, 0, 0 ], 1161603091, 60359, 0.8335077654199736)
**********************************************************************
File "/Users/student/Desktop/sage-5.4.beta1/devel/sage-main/sage/misc/randstate.pyx", line 239:
    sage: r2m = rtest(); r2m
Expected:
    (105, 0.642309615982449, -x^2 - x - 6, (1,2,3), [ 1, 0, 0, 1, 1 ], 14082860, 19769, 0.001767155077382232)  
Got:
    (105, 0.642309615982449, -x^2 - x - 6, (4,5), [ 1, 0, 0, 1, 1 ], 14082860, 19769, 0.001767155077382232)
**********************************************************************
File "/Users/student/Desktop/sage-5.4.beta1/devel/sage-main/sage/misc/randstate.pyx", line 255:
    sage: with seed(1):
          rtest();
          rtest();
Expected:
    (978, 0.0557699430711638, -3*x^2 - 1/12, (1,3,2), [ 0, 1, 1, 0, 0 ], 1161603091, 60359, 0.8335077654199736)  
    (138, -0.0404945051288503, 2*x - 24, (2,3), [ 1, 1, 1, 0, 1 ], 1966097838, 10234, 0.0033332230808060803)      
Got:
    (978, 0.0557699430711638, -3*x^2 - 1/12, (1,2,3), [ 0, 1, 1, 0, 0 ], 1161603091, 60359, 0.8335077654199736)
    (138, -0.0404945051288503, 2*x - 24, (2,3), [ 1, 1, 1, 0, 1 ], 1966097838, 10234, 0.0033332230808060803)
**********************************************************************
File "/Users/student/Desktop/sage-5.4.beta1/devel/sage-main/sage/misc/randstate.pyx", line 274:
    sage: try:
          ctx.__enter__()
          rtest()
    finally:
          ctx.__exit__(None, None, None)
Expected:
    <sage.misc.randstate.randstate object at 0x...>
    (978, 0.0557699430711638, -3*x^2 - 1/12, (1,3,2), [ 0, 1, 1, 0, 0 ], 1161603091, 60359, 0.8335077654199736)  
    False
Got:
    <sage.misc.randstate.randstate object at 0x155950c0>
    (978, 0.0557699430711638, -3*x^2 - 1/12, (1,2,3), [ 0, 1, 1, 0, 0 ], 1161603091, 60359, 0.8335077654199736)
    False
**********************************************************************
File "/Users/student/Desktop/sage-5.4.beta1/devel/sage-main/sage/misc/randstate.pyx", line 703:
    sage: gap.Random(1, 10^50)
Expected:
    1496738263332555434474532297768680634540939580077
Got:
    97144566318213989637952954803537490912828430192472
**********************************************************************
```




---

archive/issue_comments_157589.json:
```json
{
    "body": "In `sage.misc.randstate.pyx` there is a method `set_seed_gap()` that checks for big endian-ness and flips bytes around in that case. It could be that GAP's new random number code is actually big endian clean. Can you modify `set_seed_gap()` and see if that fixes things?",
    "created_at": "2012-09-24T18:18:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157589",
    "user": "https://github.com/vbraun"
}
```

In `sage.misc.randstate.pyx` there is a method `set_seed_gap()` that checks for big endian-ness and flips bytes around in that case. It could be that GAP's new random number code is actually big endian clean. Can you modify `set_seed_gap()` and see if that fixes things?



---

archive/issue_comments_157590.json:
```json
{
    "body": "> In `sage.misc.randstate.pyx` there is a method `set_seed_gap()` that checks for big endian-ness and flips bytes around in that case. It could be that GAP's new random number code is actually big endian clean. Can you modify `set_seed_gap()` and see if that fixes things?\n\nWell, what do you know!  I didn't think Sage had any custom code for big endian...  I'll try this now.  It certainly sounds likely.\n\n----\n\nIt does fix the problem in randstate.pyx, so I think you're right about the others.  Testing now.",
    "created_at": "2012-09-24T18:37:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157590",
    "user": "https://github.com/kcrisman"
}
```

> In `sage.misc.randstate.pyx` there is a method `set_seed_gap()` that checks for big endian-ness and flips bytes around in that case. It could be that GAP's new random number code is actually big endian clean. Can you modify `set_seed_gap()` and see if that fixes things?

Well, what do you know!  I didn't think Sage had any custom code for big endian...  I'll try this now.  It certainly sounds likely.

----

It does fix the problem in randstate.pyx, so I think you're right about the others.  Testing now.



---

archive/issue_comments_157591.json:
```json
{
    "body": "\n```\nsage -t  \"devel/sage-main/sage/algebras/group_algebra_new.py\"\n         [81.4 s]\nsage -t  \"devel/sage-main/sage/groups/matrix_gps/orthogonal.py\"\n         [31.4 s]\nsage -t  \"devel/sage-main/sage/groups/matrix_gps/symplectic.py\"\n         [30.7 s]\nsage -t  \"devel/sage-main/sage/groups/matrix_gps/unitary.py\"\n         [31.2 s]\nsage -t  \"devel/sage-main/sage/misc/randstate.pyx\"          \n         [109.4 s]\n```\n\n\nI just gutted that part of the code.\n\n```diff\n# HG changeset patch\n# User Karl-Dieter Crisman <kcrisman@gmail.com>\n# Date 1348512346 14400\n# Node ID aedbdc34982e44f81636a8006f7fc44086604f43\n# Parent  e1f48782037500988a1ea3f3b0764ead26b6232f\nRemove big-endian workaround\n\ndiff --git a/sage/misc/randstate.pyx b/sage/misc/randstate.pyx\n--- a/sage/misc/randstate.pyx\n+++ b/sage/misc/randstate.pyx\n@@ -718,23 +718,6 @@\n                  seed = ZZ.random_element(long(1)<<128)\n                  classic_seed = seed\n \n-                 if sys.byteorder == 'big':\n-                     # GAP's random number generator initialization\n-                     # (in integer.c, in FuncInitRandomMT) takes its\n-                     # seed as a string, then converts this string into\n-                     # an array of 32-bit integers just by casting the\n-                     # pointer.  Thus, the result depends on the\n-                     # endianness of the machine.  As a workaround, we\n-                     # swap the bytes in the string ourselves, so that\n-                     # GAP always gets the same array of integers.\n-\n-                     seed = str(seed)\n-                     new_seed = ''\n-                     while len(seed) >= 4:\n-                         new_seed += seed[3::-1]\n-                         seed = seed[4:]\n-                     seed = '\"' + new_seed + '\"'\n-\n                  mersenne_seed = seed\n \n              prev_mersenne_seed = gap.Reset(gap.GlobalMersenneTwister, mersenne_seed)\n```\n\nI don't know why these never format quite right...",
    "created_at": "2012-09-24T18:46:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157591",
    "user": "https://github.com/kcrisman"
}
```


```
sage -t  "devel/sage-main/sage/algebras/group_algebra_new.py"
         [81.4 s]
sage -t  "devel/sage-main/sage/groups/matrix_gps/orthogonal.py"
         [31.4 s]
sage -t  "devel/sage-main/sage/groups/matrix_gps/symplectic.py"
         [30.7 s]
sage -t  "devel/sage-main/sage/groups/matrix_gps/unitary.py"
         [31.2 s]
sage -t  "devel/sage-main/sage/misc/randstate.pyx"          
         [109.4 s]
```


I just gutted that part of the code.

```diff
# HG changeset patch
# User Karl-Dieter Crisman <kcrisman@gmail.com>
# Date 1348512346 14400
# Node ID aedbdc34982e44f81636a8006f7fc44086604f43
# Parent  e1f48782037500988a1ea3f3b0764ead26b6232f
Remove big-endian workaround

diff --git a/sage/misc/randstate.pyx b/sage/misc/randstate.pyx
--- a/sage/misc/randstate.pyx
+++ b/sage/misc/randstate.pyx
@@ -718,23 +718,6 @@
                  seed = ZZ.random_element(long(1)<<128)
                  classic_seed = seed
 
-                 if sys.byteorder == 'big':
-                     # GAP's random number generator initialization
-                     # (in integer.c, in FuncInitRandomMT) takes its
-                     # seed as a string, then converts this string into
-                     # an array of 32-bit integers just by casting the
-                     # pointer.  Thus, the result depends on the
-                     # endianness of the machine.  As a workaround, we
-                     # swap the bytes in the string ourselves, so that
-                     # GAP always gets the same array of integers.
-
-                     seed = str(seed)
-                     new_seed = ''
-                     while len(seed) >= 4:
-                         new_seed += seed[3::-1]
-                         seed = seed[4:]
-                     seed = '"' + new_seed + '"'
-
                  mersenne_seed = seed
 
              prev_mersenne_seed = gap.Reset(gap.GlobalMersenneTwister, mersenne_seed)
```

I don't know why these never format quite right...



---

archive/issue_comments_157592.json:
```json
{
    "body": "Replying to [comment:46 kcrisman]:\n> I get the following errors on Mac OS X 10.4 PPC.  I think they are all about the seed for random tests.  Notice that they did pass in the past, and they are neither the old nor the new versions of the expected results from the patch here.  Could the little/big-endian have any impact on this? \n\nOh dear, now I see why it felt like good deja vu  : see #9867. Nice moldy bitrotten ticket.  \nIt was never merged when the current ticket was prepared. \n\nI've put #9867 up for review. Please close it and merge it here somehow...",
    "created_at": "2012-09-25T06:44:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157592",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:46 kcrisman]:
> I get the following errors on Mac OS X 10.4 PPC.  I think they are all about the seed for random tests.  Notice that they did pass in the past, and they are neither the old nor the new versions of the expected results from the patch here.  Could the little/big-endian have any impact on this? 

Oh dear, now I see why it felt like good deja vu  : see #9867. Nice moldy bitrotten ticket.  
It was never merged when the current ticket was prepared. 

I've put #9867 up for review. Please close it and merge it here somehow...



---

archive/issue_comments_157593.json:
```json
{
    "body": "Attachment [endianness.patch](tarball://root/attachments/some-uuid/ticket13211/endianness.patch) by @dimpase created at 2012-09-26 05:43:25",
    "created_at": "2012-09-26T05:43:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157593",
    "user": "https://github.com/dimpase"
}
```

Attachment [endianness.patch](tarball://root/attachments/some-uuid/ticket13211/endianness.patch) by @dimpase created at 2012-09-26 05:43:25



---

archive/issue_comments_157594.json:
```json
{
    "body": "I have added the patch from #9867 here.",
    "created_at": "2012-09-26T05:45:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157594",
    "user": "https://github.com/dimpase"
}
```

I have added the patch from #9867 here.



---

archive/issue_comments_157595.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2012-09-26T09:58:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157595",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_157596.json:
```json
{
    "body": "I've rebased it on #13123 (that is, on the as-of-yet unrelease sage-5.4.beta2) and folded in the endianness patch.",
    "created_at": "2012-09-26T09:58:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157596",
    "user": "https://github.com/vbraun"
}
```

I've rebased it on #13123 (that is, on the as-of-yet unrelease sage-5.4.beta2) and folded in the endianness patch.



---

archive/issue_comments_157597.json:
```json
{
    "body": "I don't think it depends on #13123 *twice*.",
    "created_at": "2012-09-26T10:04:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157597",
    "user": "https://github.com/jdemeyer"
}
```

I don't think it depends on #13123 *twice*.



---

archive/issue_comments_157598.json:
```json
{
    "body": "It seems the endianness patch is included in the other patch...",
    "created_at": "2012-10-05T09:20:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157598",
    "user": "https://github.com/jdemeyer"
}
```

It seems the endianness patch is included in the other patch...



---

archive/issue_comments_157599.json:
```json
{
    "body": "When testing this in a from-scratch built Sage, I got\n\n```\nsage -t  -force_lib devel/sage/sage/tests/cmdline.py\n**********************************************************************\nFile \"/release/merger/sage-5.5.beta0/devel/sage-main/sage/tests/cmdline.py\", line 408:\n    sage: err\nExpected:\n    ''\nGot:\n    'gap: halving pool size.\\n'\n**********************************************************************\n```\n\nOn subsequent tests, I did not get this message.",
    "created_at": "2012-10-05T13:37:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157599",
    "user": "https://github.com/jdemeyer"
}
```

When testing this in a from-scratch built Sage, I got

```
sage -t  -force_lib devel/sage/sage/tests/cmdline.py
**********************************************************************
File "/release/merger/sage-5.5.beta0/devel/sage-main/sage/tests/cmdline.py", line 408:
    sage: err
Expected:
    ''
Got:
    'gap: halving pool size.\n'
**********************************************************************
```

On subsequent tests, I did not get this message.



---

archive/issue_comments_157600.json:
```json
{
    "body": "Looking at the GAP sources, this seems to be caused by a lack of memory...",
    "created_at": "2012-10-05T13:39:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157600",
    "user": "https://github.com/jdemeyer"
}
```

Looking at the GAP sources, this seems to be caused by a lack of memory...



---

archive/issue_comments_157601.json:
```json
{
    "body": "Also, I somehow ended up with orphan GAP processes running:\n\n```\njdemeyer@sage:/release/merger/sage-5.5.beta0$ ps -ef |grep gap\njdemeyer 10863     1 99 14:26 ?        01:21:46 /release/merger/sage-5.5.beta0/local/gap/latest/bin/x86_64-unknown-linux-gnu-gcc-default64/gap -m 24m -l /release/merger/sage-5.5.beta0/local/gap/latest -r -b -p -T -o 9999G /release/merger/sage-5.5.beta0/local/share/sage/ext/gap/sage.g\njdemeyer 17015 10589  0 15:49 pts/124  00:00:00 grep gap\njdemeyer 22854     1 99 14:52 ?        00:56:56 /release/merger/sage-5.5.beta0/local/gap/latest/bin/x86_64-unknown-linux-gnu-gcc-default64/gap -m 24m -l /release/merger/sage-5.5.beta0/local/gap/latest -r -b -p -T -o 9999G /release/merger/sage-5.5.beta0/local/share/sage/ext/gap/sage.g\n```\n",
    "created_at": "2012-10-05T13:51:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157601",
    "user": "https://github.com/jdemeyer"
}
```

Also, I somehow ended up with orphan GAP processes running:

```
jdemeyer@sage:/release/merger/sage-5.5.beta0$ ps -ef |grep gap
jdemeyer 10863     1 99 14:26 ?        01:21:46 /release/merger/sage-5.5.beta0/local/gap/latest/bin/x86_64-unknown-linux-gnu-gcc-default64/gap -m 24m -l /release/merger/sage-5.5.beta0/local/gap/latest -r -b -p -T -o 9999G /release/merger/sage-5.5.beta0/local/share/sage/ext/gap/sage.g
jdemeyer 17015 10589  0 15:49 pts/124  00:00:00 grep gap
jdemeyer 22854     1 99 14:52 ?        00:56:56 /release/merger/sage-5.5.beta0/local/gap/latest/bin/x86_64-unknown-linux-gnu-gcc-default64/gap -m 24m -l /release/merger/sage-5.5.beta0/local/gap/latest -r -b -p -T -o 9999G /release/merger/sage-5.5.beta0/local/share/sage/ext/gap/sage.g
```




---

archive/issue_comments_157602.json:
```json
{
    "body": "Its not lack of actual memory, it is a lack of swap space. GAP reserves addressing space and  corresponding swap space such that the addressing space could be actually used (potentially by swapping) if GAP were to use that much memory. If the initial workspace is too large, it tries with half the size iteratively until it succeeds. The \"halving pool size\" is harmless but cannot be disabled.",
    "created_at": "2012-10-05T13:56:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157602",
    "user": "https://github.com/vbraun"
}
```

Its not lack of actual memory, it is a lack of swap space. GAP reserves addressing space and  corresponding swap space such that the addressing space could be actually used (potentially by swapping) if GAP were to use that much memory. If the initial workspace is too large, it tries with half the size iteratively until it succeeds. The "halving pool size" is harmless but cannot be disabled.



---

archive/issue_comments_157603.json:
```json
{
    "body": "Replying to [comment:59 vbraun]:\n> The \"halving pool size\" is harmless but cannot be disabled.\nThe `printf()` could be patched out... if it's harmless.",
    "created_at": "2012-10-05T14:01:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157603",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:59 vbraun]:
> The "halving pool size" is harmless but cannot be disabled.
The `printf()` could be patched out... if it's harmless.



---

archive/issue_comments_157604.json:
```json
{
    "body": "I've written upstream about this issue, hopefully it'll be fixed in a future release.\n\nI'm not entirely happy with our allocation strategy, if you are running multiple sage processes (e.g. on a server) then you quickly reserve most of swap. I'll add a patch to tweak the pool size.",
    "created_at": "2012-10-05T14:16:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157604",
    "user": "https://github.com/vbraun"
}
```

I've written upstream about this issue, hopefully it'll be fixed in a future release.

I'm not entirely happy with our allocation strategy, if you are running multiple sage processes (e.g. on a server) then you quickly reserve most of swap. I'll add a patch to tweak the pool size.



---

archive/issue_comments_157605.json:
```json
{
    "body": "In any case, something needs to be done about the `cmdline.py` doctest failure due to that \"error\" message which isn't even an error.\n\nAlso: after running all doctests again, I ended up again with an orphaned `gap` process.",
    "created_at": "2012-10-05T19:06:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157605",
    "user": "https://github.com/jdemeyer"
}
```

In any case, something needs to be done about the `cmdline.py` doctest failure due to that "error" message which isn't even an error.

Also: after running all doctests again, I ended up again with an orphaned `gap` process.



---

archive/issue_comments_157606.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2012-10-05T19:06:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157606",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_157607.json:
```json
{
    "body": "I've fixed the \"halving pool size\" doctest error and changed the workspace allocation to default to 1/10*(available swap). This should give you enough workspace without reserving all swap when you run a server (or parallel doctests).\n\nI can't reproduce any gap orphans. I verified that the gap pid is correctly written to `spawned_processes` so even if Sage gets kill -9'ed the sage-cleaner will get rid of orphans. Maybe sage-cleaner has some issue on your setup, Jeroen?\n\nThe additional trac_13211_pool_size.patch needs review... Dima? ;-)",
    "created_at": "2012-10-08T20:49:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157607",
    "user": "https://github.com/vbraun"
}
```

I've fixed the "halving pool size" doctest error and changed the workspace allocation to default to 1/10*(available swap). This should give you enough workspace without reserving all swap when you run a server (or parallel doctests).

I can't reproduce any gap orphans. I verified that the gap pid is correctly written to `spawned_processes` so even if Sage gets kill -9'ed the sage-cleaner will get rid of orphans. Maybe sage-cleaner has some issue on your setup, Jeroen?

The additional trac_13211_pool_size.patch needs review... Dima? ;-)



---

archive/issue_comments_157608.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-10-08T20:49:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157608",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_157609.json:
```json
{
    "body": "Replying to [comment:64 vbraun]:\n> I can't reproduce any gap orphans. I verified that the gap pid is correctly written to `spawned_processes`\nI haven't looked at the code, but are you sure gap is started only from one place in Sage?  Maybe the command line helps:\n\n```\n/release/merger/sage-5.5.beta0/local/gap/latest/bin/x86_64-unknown-linux-gnu-gcc-default64/gap -m 24m -l /release/merger/sage-5.5.beta0/local/gap/latest -r -b -p -T -o 9999G /release/merger/sage-5.5.beta0/local/share/sage/ext/gap/sage.g\n```\n",
    "created_at": "2012-10-08T21:01:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157609",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:64 vbraun]:
> I can't reproduce any gap orphans. I verified that the gap pid is correctly written to `spawned_processes`
I haven't looked at the code, but are you sure gap is started only from one place in Sage?  Maybe the command line helps:

```
/release/merger/sage-5.5.beta0/local/gap/latest/bin/x86_64-unknown-linux-gnu-gcc-default64/gap -m 24m -l /release/merger/sage-5.5.beta0/local/gap/latest -r -b -p -T -o 9999G /release/merger/sage-5.5.beta0/local/share/sage/ext/gap/sage.g
```




---

archive/issue_comments_157610.json:
```json
{
    "body": "I spend quite some time today trying to find any change that might change where or how gap is started, but I didn't find any. I ran various doctests and tried to kill -9 the sage process, but never managed to produce any orphans that weren't cleaned up.",
    "created_at": "2012-10-08T21:17:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157610",
    "user": "https://github.com/vbraun"
}
```

I spend quite some time today trying to find any change that might change where or how gap is started, but I didn't find any. I ran various doctests and tried to kill -9 the sage process, but never managed to produce any orphans that weren't cleaned up.



---

archive/issue_comments_157611.json:
```json
{
    "body": "On MacOSX 10.6.8 I get\n\n```\nsage -t --long -force_lib \"devel/sage/sage/misc/memory_info.py\"\n**********************************************************************\nFile \"/usr/local/src/sage/sage-5.4.rc0/devel/sage/sage/misc/memory_info.py\", line 99:\n    sage: print \"ignore this\";  mem._parse_proc_meminfo()   # random output\nException raised:\n    Traceback (most recent call last):\n      File \"/usr/local/src/sage/sage-5.4.rc0/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/usr/local/src/sage/sage-5.4.rc0/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/usr/local/src/sage/sage-5.4.rc0/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_3[4]>\", line 1, in <module>\n        print \"ignore this\";  mem._parse_proc_meminfo()   # random output###line 99:\n    sage: print \"ignore this\";  mem._parse_proc_meminfo()   # random output\n    AttributeError: 'MemoryInfo_guess' object has no attribute '_parse_proc_meminfo'\n**********************************************************************\n1 items had failures:\n   1 of   6 in __main__.example_3\n***Test Failed*** 1 failures.\nFor whitespace errors, see the file /Users/dima/.sage//tmp/memory_info_41483.py\n\t [2.6 s]\n```\n",
    "created_at": "2012-10-09T11:01:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157611",
    "user": "https://github.com/dimpase"
}
```

On MacOSX 10.6.8 I get

```
sage -t --long -force_lib "devel/sage/sage/misc/memory_info.py"
**********************************************************************
File "/usr/local/src/sage/sage-5.4.rc0/devel/sage/sage/misc/memory_info.py", line 99:
    sage: print "ignore this";  mem._parse_proc_meminfo()   # random output
Exception raised:
    Traceback (most recent call last):
      File "/usr/local/src/sage/sage-5.4.rc0/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/usr/local/src/sage/sage-5.4.rc0/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/usr/local/src/sage/sage-5.4.rc0/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_3[4]>", line 1, in <module>
        print "ignore this";  mem._parse_proc_meminfo()   # random output###line 99:
    sage: print "ignore this";  mem._parse_proc_meminfo()   # random output
    AttributeError: 'MemoryInfo_guess' object has no attribute '_parse_proc_meminfo'
**********************************************************************
1 items had failures:
   1 of   6 in __main__.example_3
***Test Failed*** 1 failures.
For whitespace errors, see the file /Users/dima/.sage//tmp/memory_info_41483.py
	 [2.6 s]
```




---

archive/issue_comments_157612.json:
```json
{
    "body": "I see, raising an exception still makes `# random` doctests fail. Updated patch fixes this and adds special handling for OSX to get the ram size.",
    "created_at": "2012-10-09T12:30:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157612",
    "user": "https://github.com/vbraun"
}
```

I see, raising an exception still makes `# random` doctests fail. Updated patch fixes this and adds special handling for OSX to get the ram size.



---

archive/issue_comments_157613.json:
```json
{
    "body": "Replying to [comment:68 vbraun]:\n> I see, raising an exception still makes `# random` doctests fail. Updated patch fixes this and adds special handling for OSX to get the ram size.\n\nOK, this works on OSX now, good. Let me me check on Linux...",
    "created_at": "2012-10-09T13:05:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157613",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:68 vbraun]:
> I see, raising an exception still makes `# random` doctests fail. Updated patch fixes this and adds special handling for OSX to get the ram size.

OK, this works on OSX now, good. Let me me check on Linux...



---

archive/issue_comments_157614.json:
```json
{
    "body": "Replying to [comment:69 dimpase]:\n> Replying to [comment:68 vbraun]:\n> > I see, raising an exception still makes `# random` doctests fail. Updated patch fixes this and adds special handling for OSX to get the ram size.\n> \n> OK, this works on OSX now, good. Let me me check on Linux...\nwith #13579 and #13211 patches applied, I have the following weirdness on Debian:\n\n```\n$ ../../sage    \n----------------------------------------------------------------------\n----------------------------------------------------------------------\n**********************************************************************\n*                                                                    *\n* Warning: this is a prerelease version, and it may be unstable.     *\n*                                                                    *\n**********************************************************************\n        top: unknown argument 'l'\nusage:  top -hv | -bcisSH -d delay -n iterations [-u user | -U user] -p pid [,pid ...]\n| Sage Version 5.4.rc1, Release Date: 2012-10-05                     |\n| Type \"notebook()\" for the browser-based notebook interface.        |\n| Type \"help()\" for help.                                            |\nsage: \n```\n\nhere is my patch queue:\n\n```\n/usr/local/src/sage/sage-5.4.rc1/devel/sage$ hg qapplied\n13579_secure_tmp.patch\ntrac_13579_fix_test_executable.patch\ntrac_13211_fix_gap_doctests.patch\ntrac_13211_pool_size.patch\n```\n\n\nPS. This seems to be due to failure to tell OSX from Linux!",
    "created_at": "2012-10-09T15:04:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157614",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:69 dimpase]:
> Replying to [comment:68 vbraun]:
> > I see, raising an exception still makes `# random` doctests fail. Updated patch fixes this and adds special handling for OSX to get the ram size.
> 
> OK, this works on OSX now, good. Let me me check on Linux...
with #13579 and #13211 patches applied, I have the following weirdness on Debian:

```
$ ../../sage    
----------------------------------------------------------------------
----------------------------------------------------------------------
**********************************************************************
*                                                                    *
* Warning: this is a prerelease version, and it may be unstable.     *
*                                                                    *
**********************************************************************
        top: unknown argument 'l'
usage:  top -hv | -bcisSH -d delay -n iterations [-u user | -U user] -p pid [,pid ...]
| Sage Version 5.4.rc1, Release Date: 2012-10-05                     |
| Type "notebook()" for the browser-based notebook interface.        |
| Type "help()" for help.                                            |
sage: 
```

here is my patch queue:

```
/usr/local/src/sage/sage-5.4.rc1/devel/sage$ hg qapplied
13579_secure_tmp.patch
trac_13579_fix_test_executable.patch
trac_13211_fix_gap_doctests.patch
trac_13211_pool_size.patch
```


PS. This seems to be due to failure to tell OSX from Linux!



---

archive/issue_comments_157615.json:
```json
{
    "body": "Attachment [fixlinuxmeminfo.patch](tarball://root/attachments/some-uuid/ticket13211/fixlinuxmeminfo.patch) by @dimpase created at 2012-10-09 15:34:57\n\nfix control flow in misc/memory_info.py",
    "created_at": "2012-10-09T15:34:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157615",
    "user": "https://github.com/dimpase"
}
```

Attachment [fixlinuxmeminfo.patch](tarball://root/attachments/some-uuid/ticket13211/fixlinuxmeminfo.patch) by @dimpase created at 2012-10-09 15:34:57

fix control flow in misc/memory_info.py



---

archive/issue_comments_157616.json:
```json
{
    "body": "Well, why don't you actually check for Darwin/OSX? E.g.\n\n```\nimport platform\nif platform.system=='Darwin':\n   # do OSX-thing...\nelse:\n   # the rest...\n```\n",
    "created_at": "2012-10-09T16:00:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157616",
    "user": "https://github.com/dimpase"
}
```

Well, why don't you actually check for Darwin/OSX? E.g.

```
import platform
if platform.system=='Darwin':
   # do OSX-thing...
else:
   # the rest...
```




---

archive/issue_comments_157617.json:
```json
{
    "body": "I can't apply the patches. \n\n\n```\nsage: hg_sage.apply('http://trac.sagemath.org/sage_trac/raw-attachment/ticket/13211/trac_13211_fix_gap_doctests.patch')\nAttempting to load remote file: http://trac.sagemath.org/sage_trac/raw-attachment/ticket/13211/trac_13211_fix_gap_doctests.patch\nLoading: [.......]\ncd \"/home/mmarco/sage-5.3/devel/sage\" && sage --hg import   \"/home/mmarco/.sage/temp/neumann/583/tmp_0.patch\"\napplying /home/mmarco/.sage/temp/neumann/583/tmp_0.patch\npatching file sage/interfaces/gap.py\nHunk #20 FAILED at 1663\n1 out of 21 hunks FAILED -- saving rejects to file sage/interfaces/gap.py.rej\npatching file sage/tests/cmdline.py\nHunk #1 FAILED at 516\n1 out of 1 hunks FAILED -- saving rejects to file sage/tests/cmdline.py.rej\nabort: patch failed to apply\n```\n",
    "created_at": "2012-10-09T20:21:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157617",
    "user": "https://github.com/miguelmarco"
}
```

I can't apply the patches. 


```
sage: hg_sage.apply('http://trac.sagemath.org/sage_trac/raw-attachment/ticket/13211/trac_13211_fix_gap_doctests.patch')
Attempting to load remote file: http://trac.sagemath.org/sage_trac/raw-attachment/ticket/13211/trac_13211_fix_gap_doctests.patch
Loading: [.......]
cd "/home/mmarco/sage-5.3/devel/sage" && sage --hg import   "/home/mmarco/.sage/temp/neumann/583/tmp_0.patch"
applying /home/mmarco/.sage/temp/neumann/583/tmp_0.patch
patching file sage/interfaces/gap.py
Hunk #20 FAILED at 1663
1 out of 21 hunks FAILED -- saving rejects to file sage/interfaces/gap.py.rej
patching file sage/tests/cmdline.py
Hunk #1 FAILED at 516
1 out of 1 hunks FAILED -- saving rejects to file sage/tests/cmdline.py.rej
abort: patch failed to apply
```




---

archive/issue_comments_157618.json:
```json
{
    "body": "You need at least sage-5.4.beta2 to apply the patches, I think.",
    "created_at": "2012-10-09T20:41:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157618",
    "user": "https://github.com/vbraun"
}
```

You need at least sage-5.4.beta2 to apply the patches, I think.



---

archive/issue_comments_157619.json:
```json
{
    "body": "Ok should work now!",
    "created_at": "2012-10-09T21:36:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157619",
    "user": "https://github.com/vbraun"
}
```

Ok should work now!



---

archive/issue_comments_157620.json:
```json
{
    "body": "Replying to [comment:74 vbraun]:\n> Ok should work now!\n\nlooks good. Another round of tests, and hopefully it's done.",
    "created_at": "2012-10-10T01:18:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157620",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:74 vbraun]:
> Ok should work now!

looks good. Another round of tests, and hopefully it's done.



---

archive/issue_comments_157621.json:
```json
{
    "body": "There is an apparent incompatibility with the new GUAVA GAP package:\n\n```\nsage -t  --optional -force_lib devel/sage/sage/coding/linear_code.py\n**********************************************************************File \"/usr/local/src/sage/sage-5.4.rc1/devel/sage-main/sage/coding/linear_code.py\",\n line 1239:\n    sage: C.covering_radius()  # requires optional GAP package GuavaException raised:\n    Traceback (most recent call last):      File \"/usr/local/src/sage/sage-5.4.rc1/local/bin/ncadoctest.py\", line 1231, i\nn run_one_test        self.run_one_example(test, example, filename, compileflags)\n      File \"/usr/local/src/sage/sage-5.4.rc1/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compilefla\ngs)      File \"/usr/local/src/sage/sage-5.4.rc1/local/bin/ncadoctest.py\", line 1172, i\nn run_one_example        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_24[3]>\", line 1, in <module>\n        C.covering_radius()  # requires optional GAP package Guava###line 1239:\n    sage: C.covering_radius()  # requires optional GAP package Guava\n      File \"/usr/local/src/sage/sage-5.4.rc1/local/lib/python/site-packages/sage/co\nding/linear_code.py\", line 1245, in covering_radius        C = gapG.GeneratorMatCode(gap(F))\n      File \"/usr/local/src/sage/sage-5.4.rc1/local/lib/python/site-packages/sage/in\nterfaces/interface.py\", line 584, in __call__        return self._obj.parent().function_call(self._name, [self._obj] + list(args\n), kwds)\n      File \"/usr/local/src/sage/sage-5.4.rc1/local/lib/python/site-packages/sage/in\nterfaces/gap.py\", line 874, in function_call\n        ['%s=%s'%(key,value.name()) for key, value in kwds.items()])))      File \"/usr/local/src/sage/sage-5.4.rc1/local/lib/python/site-packages/sage/in\nterfaces/gap.py\", line 546, in eval\n        result = Expect.eval(self, input_line, **kwds)      File \"/usr/local/src/sage/sage-5.4.rc1/local/lib/python/site-packages/sage/in\nterfaces/expect.py\", line 1236, in eval        for L in code.split('\\n') if L != ''])\n      File \"/usr/local/src/sage/sage-5.4.rc1/local/lib/python/site-packages/sage/interfaces/gap.py\", line 747, in _eval_line\n        raise RuntimeError, message\n    RuntimeError: Gap produced error output\n    Error, Variable: 'GeneratorMatCode' must have a value\n\n       executing GeneratorMatCode($sage8,$sage1);\n**********************************************************************\n.... etc\n```\n",
    "created_at": "2012-10-10T05:21:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157621",
    "user": "https://github.com/dimpase"
}
```

There is an apparent incompatibility with the new GUAVA GAP package:

```
sage -t  --optional -force_lib devel/sage/sage/coding/linear_code.py
**********************************************************************File "/usr/local/src/sage/sage-5.4.rc1/devel/sage-main/sage/coding/linear_code.py",
 line 1239:
    sage: C.covering_radius()  # requires optional GAP package GuavaException raised:
    Traceback (most recent call last):      File "/usr/local/src/sage/sage-5.4.rc1/local/bin/ncadoctest.py", line 1231, i
n run_one_test        self.run_one_example(test, example, filename, compileflags)
      File "/usr/local/src/sage/sage-5.4.rc1/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compilefla
gs)      File "/usr/local/src/sage/sage-5.4.rc1/local/bin/ncadoctest.py", line 1172, i
n run_one_example        compileflags, 1) in test.globs
      File "<doctest __main__.example_24[3]>", line 1, in <module>
        C.covering_radius()  # requires optional GAP package Guava###line 1239:
    sage: C.covering_radius()  # requires optional GAP package Guava
      File "/usr/local/src/sage/sage-5.4.rc1/local/lib/python/site-packages/sage/co
ding/linear_code.py", line 1245, in covering_radius        C = gapG.GeneratorMatCode(gap(F))
      File "/usr/local/src/sage/sage-5.4.rc1/local/lib/python/site-packages/sage/in
terfaces/interface.py", line 584, in __call__        return self._obj.parent().function_call(self._name, [self._obj] + list(args
), kwds)
      File "/usr/local/src/sage/sage-5.4.rc1/local/lib/python/site-packages/sage/in
terfaces/gap.py", line 874, in function_call
        ['%s=%s'%(key,value.name()) for key, value in kwds.items()])))      File "/usr/local/src/sage/sage-5.4.rc1/local/lib/python/site-packages/sage/in
terfaces/gap.py", line 546, in eval
        result = Expect.eval(self, input_line, **kwds)      File "/usr/local/src/sage/sage-5.4.rc1/local/lib/python/site-packages/sage/in
terfaces/expect.py", line 1236, in eval        for L in code.split('\n') if L != ''])
      File "/usr/local/src/sage/sage-5.4.rc1/local/lib/python/site-packages/sage/interfaces/gap.py", line 747, in _eval_line
        raise RuntimeError, message
    RuntimeError: Gap produced error output
    Error, Variable: 'GeneratorMatCode' must have a value

       executing GeneratorMatCode($sage8,$sage1);
**********************************************************************
.... etc
```




---

archive/issue_comments_157622.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-10-10T10:02:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157622",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_157623.json:
```json
{
    "body": "Positive review. The issues with optional packages, such as the above, and [over here at sage-devel](https://groups.google.com/d/topic/sage-devel/LIdbHCZ1fVI/discussion), should be tackled elsewhere.",
    "created_at": "2012-10-10T10:02:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157623",
    "user": "https://github.com/dimpase"
}
```

Positive review. The issues with optional packages, such as the above, and [over here at sage-devel](https://groups.google.com/d/topic/sage-devel/LIdbHCZ1fVI/discussion), should be tackled elsewhere.



---

archive/issue_comments_157624.json:
```json
{
    "body": "rebased for sage-5.4.rc2",
    "created_at": "2012-10-31T19:26:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157624",
    "user": "https://github.com/vbraun"
}
```

rebased for sage-5.4.rc2



---

archive/issue_comments_157625.json:
```json
{
    "body": "> While we are at it, move the gap install to `$SAGE_LOCAL/gap/gap.x.y.z`.\n\nWould it make sense to use `$SAGE_LOCAL/share/gap/gap.x.y.z` instead?",
    "created_at": "2012-10-31T21:13:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157625",
    "user": "https://github.com/jhpalmieri"
}
```

> While we are at it, move the gap install to `$SAGE_LOCAL/gap/gap.x.y.z`.

Would it make sense to use `$SAGE_LOCAL/share/gap/gap.x.y.z` instead?



---

archive/issue_comments_157626.json:
```json
{
    "body": "Replying to [comment:81 jhpalmieri]:\n> Would it make sense to use `$SAGE_LOCAL/share/gap/gap.x.y.z` instead?\n\nNo, `/share/` isn't for binaries.",
    "created_at": "2012-10-31T21:26:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157626",
    "user": "https://github.com/vbraun"
}
```

Replying to [comment:81 jhpalmieri]:
> Would it make sense to use `$SAGE_LOCAL/share/gap/gap.x.y.z` instead?

No, `/share/` isn't for binaries.



---

archive/issue_comments_157627.json:
```json
{
    "body": "This fails on Skynet `eno`:\n\n```\nHost system:\nLinux eno 3.3.7-1.fc16.x86_64 #1 SMP Tue May 22 13:59:39 UTC 2012 x86_64 x86_64 x86_64 GNU/Linux\n****************************************************\nC compiler: gcc\nC compiler version:\nUsing built-in specs.\nCOLLECT_GCC=gcc\nCOLLECT_LTO_WRAPPER=/usr/local/gcc-4.7.0/x86_64-Linux-core2-fc/libexec/gcc/x86_64-unknown-linux-gnu/4.7.0/lto-wrapper\nTarget: x86_64-unknown-linux-gnu\nConfigured with: /usr/local/gcc-4.7.0/src/gcc-4.7.0/configure --enable-languages=c,c++,fortran --with-gnu-as --with-as=/usr/local/binutils-2.22/x86_64-Linux-core2-fc-gcc-4.6.2-rh/bin/as --with-gnu-ld --with-ld=/usr/local/binutils-2.22/x86_64-Linux-core2-fc-gcc-4.6.2-rh/bin/ld --with-gmp=/usr/local/mpir-2.5.1/x86_64-Linux-core2-fc-gcc-4.6.3-rh --with-mpfr=/usr/local/mpfr-3.1.0/x86_64-Linux-core2-fc-mpir-2.5.1-gcc-4.6.3-rh --with-mpc=/usr/local/mpc-0.9/x86_64-Linux-core2-fc-mpir-2.5.1-mpfr-3.1.0-gcc-4.6.3-rh --prefix=/usr/local/gcc-4.7.0/x86_64-Linux-core2-fc\nThread model: posix\ngcc version 4.7.0 (GCC) \n****************************************************\nspkg-install is using\nVERSION = 4.5.6\nGAP_DIR = gap-4.5.6\nINSTALL_DIR = /home/buildbot/build/sage/eno-1/eno_full/build/sage-5.5.beta1/local/gap/gap-4.5.6\nApplying patches...\npatching file gap.shi\npatching file tst/testinstall.g\nConfiguring GAP...\nchecking for gcc... gcc\nchecking whether the C compiler works... yes\nchecking for C compiler default output file name... a.out\nchecking for suffix of executables... \nchecking whether we are cross compiling... no\nchecking for suffix of object files... o\nchecking whether we are using the GNU C compiler... yes\nchecking whether gcc accepts -g... yes\nchecking for gcc option to accept ISO C89... none needed\nchecking how to run the C preprocessor... gcc -E\nchecking for grep that handles long lines and -e... /bin/grep\nchecking for egrep... /bin/grep -E\nchecking for ANSI C header files... yes\nchecking for sys/types.h... yes\nchecking for sys/stat.h... yes\nchecking for stdlib.h... yes\nchecking for string.h... yes\nchecking for memory.h... yes\nchecking for strings.h... yes\nchecking for inttypes.h... yes\nchecking for stdint.h... yes\nchecking for unistd.h... yes\nchecking size of void *... 8\nchecking ABI bit size... 64\nchecking build system type... x86_64-unknown-linux-gnu\nchecking host system type... x86_64-unknown-linux-gnu\nchecking target system type... x86_64-unknown-linux-gnu\nchecking for gcc... (cached) gcc\nchecking whether we are using the GNU C compiler... (cached) yes\nchecking whether gcc accepts -g... (cached) yes\nchecking for gcc option to accept ISO C89... (cached) none needed\nchecking whether make sets $(MAKE)... yes\nchecking GAP config name... default64\nconfigure: error: Could not locate GMP in the specified location\nError configuring GAP.\n```\n",
    "created_at": "2012-11-02T01:07:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157627",
    "user": "https://github.com/jdemeyer"
}
```

This fails on Skynet `eno`:

```
Host system:
Linux eno 3.3.7-1.fc16.x86_64 #1 SMP Tue May 22 13:59:39 UTC 2012 x86_64 x86_64 x86_64 GNU/Linux
****************************************************
C compiler: gcc
C compiler version:
Using built-in specs.
COLLECT_GCC=gcc
COLLECT_LTO_WRAPPER=/usr/local/gcc-4.7.0/x86_64-Linux-core2-fc/libexec/gcc/x86_64-unknown-linux-gnu/4.7.0/lto-wrapper
Target: x86_64-unknown-linux-gnu
Configured with: /usr/local/gcc-4.7.0/src/gcc-4.7.0/configure --enable-languages=c,c++,fortran --with-gnu-as --with-as=/usr/local/binutils-2.22/x86_64-Linux-core2-fc-gcc-4.6.2-rh/bin/as --with-gnu-ld --with-ld=/usr/local/binutils-2.22/x86_64-Linux-core2-fc-gcc-4.6.2-rh/bin/ld --with-gmp=/usr/local/mpir-2.5.1/x86_64-Linux-core2-fc-gcc-4.6.3-rh --with-mpfr=/usr/local/mpfr-3.1.0/x86_64-Linux-core2-fc-mpir-2.5.1-gcc-4.6.3-rh --with-mpc=/usr/local/mpc-0.9/x86_64-Linux-core2-fc-mpir-2.5.1-mpfr-3.1.0-gcc-4.6.3-rh --prefix=/usr/local/gcc-4.7.0/x86_64-Linux-core2-fc
Thread model: posix
gcc version 4.7.0 (GCC) 
****************************************************
spkg-install is using
VERSION = 4.5.6
GAP_DIR = gap-4.5.6
INSTALL_DIR = /home/buildbot/build/sage/eno-1/eno_full/build/sage-5.5.beta1/local/gap/gap-4.5.6
Applying patches...
patching file gap.shi
patching file tst/testinstall.g
Configuring GAP...
checking for gcc... gcc
checking whether the C compiler works... yes
checking for C compiler default output file name... a.out
checking for suffix of executables... 
checking whether we are cross compiling... no
checking for suffix of object files... o
checking whether we are using the GNU C compiler... yes
checking whether gcc accepts -g... yes
checking for gcc option to accept ISO C89... none needed
checking how to run the C preprocessor... gcc -E
checking for grep that handles long lines and -e... /bin/grep
checking for egrep... /bin/grep -E
checking for ANSI C header files... yes
checking for sys/types.h... yes
checking for sys/stat.h... yes
checking for stdlib.h... yes
checking for string.h... yes
checking for memory.h... yes
checking for strings.h... yes
checking for inttypes.h... yes
checking for stdint.h... yes
checking for unistd.h... yes
checking size of void *... 8
checking ABI bit size... 64
checking build system type... x86_64-unknown-linux-gnu
checking host system type... x86_64-unknown-linux-gnu
checking target system type... x86_64-unknown-linux-gnu
checking for gcc... (cached) gcc
checking whether we are using the GNU C compiler... (cached) yes
checking whether gcc accepts -g... (cached) yes
checking for gcc option to accept ISO C89... (cached) none needed
checking whether make sets $(MAKE)... yes
checking GAP config name... default64
configure: error: Could not locate GMP in the specified location
Error configuring GAP.
```




---

archive/issue_comments_157628.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2012-11-02T01:07:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157628",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_157629.json:
```json
{
    "body": "Replying to [comment:84 jdemeyer]:\n> This fails on Skynet `eno`:\n> {{{\n> Host system:\n> Linux eno 3.3.7-1.fc16.x86_64 #1 SMP Tue May 22 13:59:39 UTC 2012 x86_64 x86_64 x86_64 GNU/Linux\n> ****************************************************\n> C compiler: gcc\n> C compiler version:\n> Using built-in specs.\n> COLLECT_GCC=gcc\n> COLLECT_LTO_WRAPPER=/usr/local/gcc-4.7.0/x86_64-Linux-core2-fc/libexec/gcc/x86_64-unknown-linux-gnu/4.7.0/lto-wrapper\n> Target: x86_64-unknown-linux-gnu\n> Configured with: /usr/local/gcc-4.7.0/src/gcc-4.7.0/configure --enable-languages=c,c++,fortran --with-gnu-as --with-as=/usr/local/binutils-2.22/x86_64-Linux-core2-fc-gcc-4.6.2-rh/bin/as --with-gnu-ld --with-ld=/usr/local/binutils-2.22/x86_64-Linux-core2-fc-gcc-4.6.2-rh/bin/ld --with-gmp=/usr/local/mpir-2.5.1/x86_64-Linux-core2-fc-gcc-4.6.3-rh --with-mpfr=/usr/local/mpfr-3.1.0/x86_64-Linux-core2-fc-mpir-2.5.1-gcc-4.6.3-rh --with-mpc=/usr/local/mpc-0.9/x86_64-Linux-core2-fc-mpir-2.5.1-mpfr-3.1.0-gcc-4.6.3-rh --prefix=/usr/local/gcc-4.7.0/x86_64-Linux-core2-fc\n> Thread model: posix\n> gcc version 4.7.0 (GCC) \n> }}}\nmust everything be able to run with gcc 4.7.0, too?",
    "created_at": "2012-11-02T03:15:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157629",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:84 jdemeyer]:
> This fails on Skynet `eno`:
> {{{
> Host system:
> Linux eno 3.3.7-1.fc16.x86_64 #1 SMP Tue May 22 13:59:39 UTC 2012 x86_64 x86_64 x86_64 GNU/Linux
> ****************************************************
> C compiler: gcc
> C compiler version:
> Using built-in specs.
> COLLECT_GCC=gcc
> COLLECT_LTO_WRAPPER=/usr/local/gcc-4.7.0/x86_64-Linux-core2-fc/libexec/gcc/x86_64-unknown-linux-gnu/4.7.0/lto-wrapper
> Target: x86_64-unknown-linux-gnu
> Configured with: /usr/local/gcc-4.7.0/src/gcc-4.7.0/configure --enable-languages=c,c++,fortran --with-gnu-as --with-as=/usr/local/binutils-2.22/x86_64-Linux-core2-fc-gcc-4.6.2-rh/bin/as --with-gnu-ld --with-ld=/usr/local/binutils-2.22/x86_64-Linux-core2-fc-gcc-4.6.2-rh/bin/ld --with-gmp=/usr/local/mpir-2.5.1/x86_64-Linux-core2-fc-gcc-4.6.3-rh --with-mpfr=/usr/local/mpfr-3.1.0/x86_64-Linux-core2-fc-mpir-2.5.1-gcc-4.6.3-rh --with-mpc=/usr/local/mpc-0.9/x86_64-Linux-core2-fc-mpir-2.5.1-mpfr-3.1.0-gcc-4.6.3-rh --prefix=/usr/local/gcc-4.7.0/x86_64-Linux-core2-fc
> Thread model: posix
> gcc version 4.7.0 (GCC) 
> }}}
must everything be able to run with gcc 4.7.0, too?



---

archive/issue_comments_157630.json:
```json
{
    "body": "Replying to [comment:85 dimpase]:\n> must everything be able to run with gcc 4.7.0, too?\nAt least some gcc-4.7.x version should work.",
    "created_at": "2012-11-02T09:00:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157630",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:85 dimpase]:
> must everything be able to run with gcc 4.7.0, too?
At least some gcc-4.7.x version should work.



---

archive/issue_comments_157631.json:
```json
{
    "body": "The orphaned processes are still a problem for me.  After playing around with a Sage version including this patch, I am seeing 9 gap processes running at 100% CPU.",
    "created_at": "2012-11-02T09:02:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157631",
    "user": "https://github.com/jdemeyer"
}
```

The orphaned processes are still a problem for me.  After playing around with a Sage version including this patch, I am seeing 9 gap processes running at 100% CPU.



---

archive/issue_comments_157632.json:
```json
{
    "body": "Changing keywords from \"\" to \"orphaned processes, build on eno\".",
    "created_at": "2012-11-02T09:05:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157632",
    "user": "https://github.com/jdemeyer"
}
```

Changing keywords from "" to "orphaned processes, build on eno".



---

archive/issue_comments_157633.json:
```json
{
    "body": "On Itanium (Skynet `iras`):\n\n```\ngap(15123): unaligned access to 0x607ffffffecfa0ef, ip=0x400000000019cbd0\n\ngap(15123): unaligned access to 0x607ffffffecfa0e7, ip=0x400000000019cbd0\n\ngap(15123): unaligned access to 0x607ffffffecfa0df, ip=0x400000000019cbd0\n\ngap(15123): unaligned access to 0x607ffffffecfa0d7, ip=0x400000000019cbd0\n\ngap(15123): unaligned access to 0x607ffffffecfa0cf, ip=0x400000000019cbd0\n\nsage -t  --long -force_lib devel/sage/sage/interfaces/gap.py\n**********************************************************************\nFile \"/home/buildbot/build/sage/iras-1/iras_full/build/sage-5.5.beta1/devel/sage-main/sage/interfaces/gap.py\", line 886:\n    sage: c = gap.trait_names()\nException raised:\n    Traceback (most recent call last):\n      File \"/home/buildbot/build/sage/iras-1/iras_full/build/sage-5.5.beta1/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/home/buildbot/build/sage/iras-1/iras_full/build/sage-5.5.beta1/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/home/buildbot/build/sage/iras-1/iras_full/build/sage-5.5.beta1/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_21[2]>\", line 1, in <module>\n        c = gap.trait_names()###line 886:\n    sage: c = gap.trait_names()\n      File \"/home/buildbot/build/sage/iras-1/iras_full/build/sage-5.5.beta1/local/lib/python/site-packages/sage/interfaces/gap.py\", line 1379, in trait_names\n        self.__trait_names = eval(self.eval('NamesSystemGVars()')) + \\\n      File \"<string>\", line 2644\n        gap(15082): unaligned access to 0x607ffffffe79200f, ip=0x400000000019cbd0\n                  ^\n    SyntaxError: invalid syntax\n**********************************************************************\n```\n",
    "created_at": "2012-11-02T09:11:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157633",
    "user": "https://github.com/jdemeyer"
}
```

On Itanium (Skynet `iras`):

```
gap(15123): unaligned access to 0x607ffffffecfa0ef, ip=0x400000000019cbd0

gap(15123): unaligned access to 0x607ffffffecfa0e7, ip=0x400000000019cbd0

gap(15123): unaligned access to 0x607ffffffecfa0df, ip=0x400000000019cbd0

gap(15123): unaligned access to 0x607ffffffecfa0d7, ip=0x400000000019cbd0

gap(15123): unaligned access to 0x607ffffffecfa0cf, ip=0x400000000019cbd0

sage -t  --long -force_lib devel/sage/sage/interfaces/gap.py
**********************************************************************
File "/home/buildbot/build/sage/iras-1/iras_full/build/sage-5.5.beta1/devel/sage-main/sage/interfaces/gap.py", line 886:
    sage: c = gap.trait_names()
Exception raised:
    Traceback (most recent call last):
      File "/home/buildbot/build/sage/iras-1/iras_full/build/sage-5.5.beta1/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/home/buildbot/build/sage/iras-1/iras_full/build/sage-5.5.beta1/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/home/buildbot/build/sage/iras-1/iras_full/build/sage-5.5.beta1/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_21[2]>", line 1, in <module>
        c = gap.trait_names()###line 886:
    sage: c = gap.trait_names()
      File "/home/buildbot/build/sage/iras-1/iras_full/build/sage-5.5.beta1/local/lib/python/site-packages/sage/interfaces/gap.py", line 1379, in trait_names
        self.__trait_names = eval(self.eval('NamesSystemGVars()')) + \
      File "<string>", line 2644
        gap(15082): unaligned access to 0x607ffffffe79200f, ip=0x400000000019cbd0
                  ^
    SyntaxError: invalid syntax
**********************************************************************
```




---

archive/issue_comments_157634.json:
```json
{
    "body": "On OS X 10.6 (William's `bsd` machine), I get the same build error as `eno`:\n\n```\nHost system:\nDarwin bsd.math.washington.edu 10.8.0 Darwin Kernel Version 10.8.0: Tue Jun  7 16:32:41 PDT 2011; root:xnu-1504.15.3~1/RELEASE_X86_64 x86_64\n****************************************************\nC compiler: gcc\nC compiler version:\nUsing built-in specs.\nCOLLECT_GCC=gcc\nCOLLECT_LTO_WRAPPER=/Users/buildbot/build/sage/bsd-1/bsd_full/build/sage-5.5.beta1/local/libexec/gcc/x86_64-apple-darwin10.8.0/4.6.3/lto-wrapper\nTarget: x86_64-apple-darwin10.8.0\nConfigured with: ../src/configure --prefix=/Users/buildbot/build/sage/bsd-1/bsd_full/build/sage-5.5.beta1/local --with-local-prefix=/Users/buildbot/build/sage/bsd-1/bsd_full/build/sage-5.5.beta1/local --with-gmp=/Users/buildbot/build/sage/bsd-1/bsd_full/build/sage-5.5.beta1/local --with-mpfr=/Users/buildbot/build/sage/bsd-1/bsd_full/build/sage-5.5.beta1/local --with-mpc=/Users/buildbot/build/sage/bsd-1/bsd_full/build/sage-5.5.beta1/local --with-system-zlib --disable-multilib  \nThread model: posix\ngcc version 4.6.3 (GCC) \n****************************************************\nspkg-install is using\nVERSION = 4.5.6\nGAP_DIR = gap-4.5.6\nINSTALL_DIR = /Users/buildbot/build/sage/bsd-1/bsd_full/build/sage-5.5.beta1/local/gap/gap-4.5.6\nApplying patches...\npatching file gap.shi\npatching file tst/testinstall.g\nConfiguring GAP...\nchecking for gcc... gcc\nchecking whether the C compiler works... yes\nchecking for C compiler default output file name... a.out\nchecking for suffix of executables... \nchecking whether we are cross compiling... no\nchecking for suffix of object files... o\nchecking whether we are using the GNU C compiler... yes\nchecking whether gcc accepts -g... yes\nchecking for gcc option to accept ISO C89... none needed\nchecking how to run the C preprocessor... cpp\nchecking for grep that handles long lines and -e... /usr/bin/grep\nchecking for egrep... /usr/bin/grep -E\nchecking for ANSI C header files... yes\nchecking for sys/types.h... yes\nchecking for sys/stat.h... yes\nchecking for stdlib.h... yes\nchecking for string.h... yes\nchecking for memory.h... yes\nchecking for strings.h... yes\nchecking for inttypes.h... yes\nchecking for stdint.h... yes\nchecking for unistd.h... yes\nchecking size of void *... 8\nchecking ABI bit size... 64\nchecking build system type... x86_64-apple-darwin10.8.0\nchecking host system type... x86_64-apple-darwin10.8.0\nchecking target system type... x86_64-apple-darwin10.8.0\nchecking for gcc... (cached) gcc\nchecking whether we are using the GNU C compiler... (cached) yes\nchecking whether gcc accepts -g... (cached) yes\nchecking for gcc option to accept ISO C89... (cached) none needed\nchecking whether make sets $(MAKE)... yes\nchecking GAP config name... default64\nconfigure: error: Could not locate GMP in the specified location\nError configuring GAP.\n```\n",
    "created_at": "2012-11-02T09:13:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157634",
    "user": "https://github.com/jdemeyer"
}
```

On OS X 10.6 (William's `bsd` machine), I get the same build error as `eno`:

```
Host system:
Darwin bsd.math.washington.edu 10.8.0 Darwin Kernel Version 10.8.0: Tue Jun  7 16:32:41 PDT 2011; root:xnu-1504.15.3~1/RELEASE_X86_64 x86_64
****************************************************
C compiler: gcc
C compiler version:
Using built-in specs.
COLLECT_GCC=gcc
COLLECT_LTO_WRAPPER=/Users/buildbot/build/sage/bsd-1/bsd_full/build/sage-5.5.beta1/local/libexec/gcc/x86_64-apple-darwin10.8.0/4.6.3/lto-wrapper
Target: x86_64-apple-darwin10.8.0
Configured with: ../src/configure --prefix=/Users/buildbot/build/sage/bsd-1/bsd_full/build/sage-5.5.beta1/local --with-local-prefix=/Users/buildbot/build/sage/bsd-1/bsd_full/build/sage-5.5.beta1/local --with-gmp=/Users/buildbot/build/sage/bsd-1/bsd_full/build/sage-5.5.beta1/local --with-mpfr=/Users/buildbot/build/sage/bsd-1/bsd_full/build/sage-5.5.beta1/local --with-mpc=/Users/buildbot/build/sage/bsd-1/bsd_full/build/sage-5.5.beta1/local --with-system-zlib --disable-multilib  
Thread model: posix
gcc version 4.6.3 (GCC) 
****************************************************
spkg-install is using
VERSION = 4.5.6
GAP_DIR = gap-4.5.6
INSTALL_DIR = /Users/buildbot/build/sage/bsd-1/bsd_full/build/sage-5.5.beta1/local/gap/gap-4.5.6
Applying patches...
patching file gap.shi
patching file tst/testinstall.g
Configuring GAP...
checking for gcc... gcc
checking whether the C compiler works... yes
checking for C compiler default output file name... a.out
checking for suffix of executables... 
checking whether we are cross compiling... no
checking for suffix of object files... o
checking whether we are using the GNU C compiler... yes
checking whether gcc accepts -g... yes
checking for gcc option to accept ISO C89... none needed
checking how to run the C preprocessor... cpp
checking for grep that handles long lines and -e... /usr/bin/grep
checking for egrep... /usr/bin/grep -E
checking for ANSI C header files... yes
checking for sys/types.h... yes
checking for sys/stat.h... yes
checking for stdlib.h... yes
checking for string.h... yes
checking for memory.h... yes
checking for strings.h... yes
checking for inttypes.h... yes
checking for stdint.h... yes
checking for unistd.h... yes
checking size of void *... 8
checking ABI bit size... 64
checking build system type... x86_64-apple-darwin10.8.0
checking host system type... x86_64-apple-darwin10.8.0
checking target system type... x86_64-apple-darwin10.8.0
checking for gcc... (cached) gcc
checking whether we are using the GNU C compiler... (cached) yes
checking whether gcc accepts -g... (cached) yes
checking for gcc option to accept ISO C89... (cached) none needed
checking whether make sets $(MAKE)... yes
checking GAP config name... default64
configure: error: Could not locate GMP in the specified location
Error configuring GAP.
```




---

archive/issue_comments_157635.json:
```json
{
    "body": "Concerning the orphaned process: could it be that they appear during the **build** as opposed to when running Sage?  Typical command line:\n\n```\n/release/merger/sage-5.5.beta2/local/gap/latest/bin/x86_64-unknown-linux-gnu-gcc-default64/gap -m 24m -l /release/merger/sage-5.5.beta2/local/gap/latest -r -b -p -T -o 6271720243 /release/merger/sage-5.5.beta2/local/share/sage/ext/gap/sage.g\n```\n",
    "created_at": "2012-11-02T09:15:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157635",
    "user": "https://github.com/jdemeyer"
}
```

Concerning the orphaned process: could it be that they appear during the **build** as opposed to when running Sage?  Typical command line:

```
/release/merger/sage-5.5.beta2/local/gap/latest/bin/x86_64-unknown-linux-gnu-gcc-default64/gap -m 24m -l /release/merger/sage-5.5.beta2/local/gap/latest -r -b -p -T -o 6271720243 /release/merger/sage-5.5.beta2/local/share/sage/ext/gap/sage.g
```




---

archive/issue_comments_157636.json:
```json
{
    "body": "Replying to [comment:91 jdemeyer]:\n> Concerning the orphaned process: could it be that they appear during the **build** as opposed to when running Sage?  Typical command line:\n> {{{\n> /release/merger/sage-5.5.beta2/local/gap/latest/bin/x86_64-unknown-linux-gnu-gcc-default64/gap -m 24m -l /release/merger/sage-5.5.beta2/local/gap/latest -r -b -p -T -o 6271720243 /release/merger/sage-5.5.beta2/local/share/sage/ext/gap/sage.g\n> }}}\n\nwell, I have seen an orphaned gap process a couple of times, but I don't even recall whether it was with this patch, or not.",
    "created_at": "2012-11-02T10:41:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157636",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:91 jdemeyer]:
> Concerning the orphaned process: could it be that they appear during the **build** as opposed to when running Sage?  Typical command line:
> {{{
> /release/merger/sage-5.5.beta2/local/gap/latest/bin/x86_64-unknown-linux-gnu-gcc-default64/gap -m 24m -l /release/merger/sage-5.5.beta2/local/gap/latest -r -b -p -T -o 6271720243 /release/merger/sage-5.5.beta2/local/share/sage/ext/gap/sage.g
> }}}

well, I have seen an orphaned gap process a couple of times, but I don't even recall whether it was with this patch, or not.



---

archive/issue_comments_157637.json:
```json
{
    "body": "Replying to [comment:90 jdemeyer]:\n> On OS X 10.6 (William's `bsd` machine), I get the same build error as `eno`:\n\nOh, OK, this is a missing dependency, I think. GAP depends upon MPIR now, as it uses (pseudo)GMP. I'll attach a patch in a second.",
    "created_at": "2012-11-02T13:04:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157637",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:90 jdemeyer]:
> On OS X 10.6 (William's `bsd` machine), I get the same build error as `eno`:

Oh, OK, this is a missing dependency, I think. GAP depends upon MPIR now, as it uses (pseudo)GMP. I'll attach a patch in a second.



---

archive/issue_comments_157638.json:
```json
{
    "body": "Attachment [trac_13211_mpir_dep.patch](tarball://root/attachments/some-uuid/ticket13211/trac_13211_mpir_dep.patch) by @dimpase created at 2012-11-02 13:11:59\n\nadding MPIR dependence",
    "created_at": "2012-11-02T13:11:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157638",
    "user": "https://github.com/dimpase"
}
```

Attachment [trac_13211_mpir_dep.patch](tarball://root/attachments/some-uuid/ticket13211/trac_13211_mpir_dep.patch) by @dimpase created at 2012-11-02 13:11:59

adding MPIR dependence



---

archive/issue_comments_157639.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-11-02T13:15:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157639",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_157640.json:
```json
{
    "body": "The question is not why are there GAP orphans, but why is the sage-cleaner not killing them once the parent Sage process quits?\n\nI'll shortly add a patch to run gap with `prctl --unaligned=silent` on itanium, this will get rid of the offending alignment warnings.",
    "created_at": "2012-11-02T15:37:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157640",
    "user": "https://github.com/vbraun"
}
```

The question is not why are there GAP orphans, but why is the sage-cleaner not killing them once the parent Sage process quits?

I'll shortly add a patch to run gap with `prctl --unaligned=silent` on itanium, this will get rid of the offending alignment warnings.



---

archive/issue_comments_157641.json:
```json
{
    "body": "Changing keywords from \"orphaned processes, build on eno\" to \"orphaned processes\".",
    "created_at": "2012-11-02T17:07:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157641",
    "user": "https://github.com/dimpase"
}
```

Changing keywords from "orphaned processes, build on eno" to "orphaned processes".



---

archive/issue_comments_157642.json:
```json
{
    "body": "I'm currently building again to try to determine when the processes are created.",
    "created_at": "2012-11-02T17:09:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157642",
    "user": "https://github.com/jdemeyer"
}
```

I'm currently building again to try to determine when the processes are created.



---

archive/issue_comments_157643.json:
```json
{
    "body": "Attachment [trac_13211_itanium_fix.patch](tarball://root/attachments/some-uuid/ticket13211/trac_13211_itanium_fix.patch) by @vbraun created at 2012-11-02 17:28:14\n\nInitial patch",
    "created_at": "2012-11-02T17:28:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157643",
    "user": "https://github.com/vbraun"
}
```

Attachment [trac_13211_itanium_fix.patch](tarball://root/attachments/some-uuid/ticket13211/trac_13211_itanium_fix.patch) by @vbraun created at 2012-11-02 17:28:14

Initial patch



---

archive/issue_comments_157644.json:
```json
{
    "body": "Positive review to dima's dependency patch.\n\nI've also added the patch to suppress the itanium warnings. I haven't tested it on itanium yet (building sage-5.4.rc3 first). But I've verified that the `prctl` call gets rid of the warnings.",
    "created_at": "2012-11-02T17:30:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157644",
    "user": "https://github.com/vbraun"
}
```

Positive review to dima's dependency patch.

I've also added the patch to suppress the itanium warnings. I haven't tested it on itanium yet (building sage-5.4.rc3 first). But I've verified that the `prctl` call gets rid of the warnings.



---

archive/issue_comments_157645.json:
```json
{
    "body": "PS: The GAP command line includes `-o 6271720243`, this is clearly from `trac_13211_pool_size.patch` and not a process created during build.",
    "created_at": "2012-11-02T17:47:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157645",
    "user": "https://github.com/vbraun"
}
```

PS: The GAP command line includes `-o 6271720243`, this is clearly from `trac_13211_pool_size.patch` and not a process created during build.



---

archive/issue_comments_157646.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-11-03T08:58:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157646",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_157647.json:
```json
{
    "body": "I found out how to reproduce the orphans: running `local/bin/sage-starts` creates a gap orphan every time I run it.",
    "created_at": "2012-11-03T08:58:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157647",
    "user": "https://github.com/jdemeyer"
}
```

I found out how to reproduce the orphans: running `local/bin/sage-starts` creates a gap orphan every time I run it.



---

archive/issue_comments_157648.json:
```json
{
    "body": "Replying to [comment:100 jdemeyer]:\n> I found out how to reproduce the orphans: running `local/bin/sage-starts` creates a gap orphan every time I run it.\n\nI can reproduce this neither on Debian x86_64 nor on OSX 10.6.8. Specifically, I cd to SAGE_ROOT and start\n`./local/bin/sage-starts` there.\nI even tried to remove `~/.sage/`, no difference.\n\nIt looks like we need more details on the system you see this. (Preferably, access to it...).",
    "created_at": "2012-11-03T10:59:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157648",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:100 jdemeyer]:
> I found out how to reproduce the orphans: running `local/bin/sage-starts` creates a gap orphan every time I run it.

I can reproduce this neither on Debian x86_64 nor on OSX 10.6.8. Specifically, I cd to SAGE_ROOT and start
`./local/bin/sage-starts` there.
I even tried to remove `~/.sage/`, no difference.

It looks like we need more details on the system you see this. (Preferably, access to it...).



---

archive/issue_comments_157649.json:
```json
{
    "body": "Replying to [comment:101 dimpase]:\n> Replying to [comment:100 jdemeyer]:\n> > I found out how to reproduce the orphans: running `local/bin/sage-starts` creates a gap orphan every time I run it.\n> \n> I can reproduce this neither on Debian x86_64 nor on OSX 10.6.8. Specifically, I cd to SAGE_ROOT and start\n> `./local/bin/sage-starts` there.\n> I even tried to remove `~/.sage/`, no difference.\n> \n> It looks like we need more details on the system you see this. (Preferably, access to it...).\nOK, got it. I need to issue several `local/bin/sage-starts` within a short period of time on Debian x86_64. Then I get the orphans! Otherwise, not. A race condition, of sorts?",
    "created_at": "2012-11-03T11:02:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157649",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:101 dimpase]:
> Replying to [comment:100 jdemeyer]:
> > I found out how to reproduce the orphans: running `local/bin/sage-starts` creates a gap orphan every time I run it.
> 
> I can reproduce this neither on Debian x86_64 nor on OSX 10.6.8. Specifically, I cd to SAGE_ROOT and start
> `./local/bin/sage-starts` there.
> I even tried to remove `~/.sage/`, no difference.
> 
> It looks like we need more details on the system you see this. (Preferably, access to it...).
OK, got it. I need to issue several `local/bin/sage-starts` within a short period of time on Debian x86_64. Then I get the orphans! Otherwise, not. A race condition, of sorts?



---

archive/issue_comments_157650.json:
```json
{
    "body": "Replying to [comment:102 dimpase]:\n> Replying to [comment:101 dimpase]:\n> > Replying to [comment:100 jdemeyer]:\n> > > I found out how to reproduce the orphans: running `local/bin/sage-starts` creates a gap orphan every time I run it.\n> > \n> > I can reproduce this neither on Debian x86_64 nor on OSX 10.6.8. Specifically, I cd to SAGE_ROOT and start\n> > `./local/bin/sage-starts` there.\n> > I even tried to remove `~/.sage/`, no difference.\n> > \n> > It looks like we need more details on the system you see this. (Preferably, access to it...).\n> OK, got it. I need to issue several `local/bin/sage-starts` within a short period of time on Debian x86_64. Then I get the orphans! Otherwise, not. A race condition, of sorts?\n\nOops, no, in fact, these are not orphans, in the sense that they are not staying running forever. They all finish within 20-30 seconds. A typical process looks as follows (very similar to Jeroen's case):\n\n```\ndima     17195     1 93 19:24 ?        00:00:25 /usr/local/src/sage/sage-5.4.rc3/local/gap/latest/bin/x86_64-unknown-linux-gnu-gcc-default64/gap -m 24m -l /usr/local/src/sage/sage-5.4.rc3/local/gap/latest -r -b -p -T -o 872851456 /usr/local/src/sage/sage-5.4.rc3/local/share/sage/ext/gap/sage.g\n```\n\n\nJeroen, so you say that for you these processes don't finish by themselves?",
    "created_at": "2012-11-03T11:31:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157650",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:102 dimpase]:
> Replying to [comment:101 dimpase]:
> > Replying to [comment:100 jdemeyer]:
> > > I found out how to reproduce the orphans: running `local/bin/sage-starts` creates a gap orphan every time I run it.
> > 
> > I can reproduce this neither on Debian x86_64 nor on OSX 10.6.8. Specifically, I cd to SAGE_ROOT and start
> > `./local/bin/sage-starts` there.
> > I even tried to remove `~/.sage/`, no difference.
> > 
> > It looks like we need more details on the system you see this. (Preferably, access to it...).
> OK, got it. I need to issue several `local/bin/sage-starts` within a short period of time on Debian x86_64. Then I get the orphans! Otherwise, not. A race condition, of sorts?

Oops, no, in fact, these are not orphans, in the sense that they are not staying running forever. They all finish within 20-30 seconds. A typical process looks as follows (very similar to Jeroen's case):

```
dima     17195     1 93 19:24 ?        00:00:25 /usr/local/src/sage/sage-5.4.rc3/local/gap/latest/bin/x86_64-unknown-linux-gnu-gcc-default64/gap -m 24m -l /usr/local/src/sage/sage-5.4.rc3/local/gap/latest -r -b -p -T -o 872851456 /usr/local/src/sage/sage-5.4.rc3/local/share/sage/ext/gap/sage.g
```


Jeroen, so you say that for you these processes don't finish by themselves?



---

archive/issue_comments_157651.json:
```json
{
    "body": "Replying to [comment:103 dimpase]:\n> Jeroen, so you say that for you these processes don't finish by themselves?\nYes, they do not finish by themselves (at least not within a day).\n\n> It looks like we need more details on the system you see this. (Preferably, access to it...). \nsage.math.washington.edu: Ubuntu 8.04.4 LTS, x86_64.",
    "created_at": "2012-11-03T12:18:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157651",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:103 dimpase]:
> Jeroen, so you say that for you these processes don't finish by themselves?
Yes, they do not finish by themselves (at least not within a day).

> It looks like we need more details on the system you see this. (Preferably, access to it...). 
sage.math.washington.edu: Ubuntu 8.04.4 LTS, x86_64.



---

archive/issue_comments_157652.json:
```json
{
    "body": "Well, I spoke too soon, sometimes they do finish by themselves.",
    "created_at": "2012-11-03T12:20:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157652",
    "user": "https://github.com/jdemeyer"
}
```

Well, I spoke too soon, sometimes they do finish by themselves.



---

archive/issue_comments_157653.json:
```json
{
    "body": "Big there's still the obvious question: what is that `gap` process doing and why does it keep running for a while?",
    "created_at": "2012-11-03T12:22:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157653",
    "user": "https://github.com/jdemeyer"
}
```

Big there's still the obvious question: what is that `gap` process doing and why does it keep running for a while?



---

archive/issue_comments_157654.json:
```json
{
    "body": "Running `strace` on such a `gap` process shows:\n\n```\ngetrusage(RUSAGE_SELF, {ru_utime={97, 710000}, ru_stime={0, 200000}, ...}) = 0\nwrite(1, \"@!\", 2)                       = -1 EIO (Input/output error)\ngetrusage(RUSAGE_SELF, {ru_utime={97, 740000}, ru_stime={0, 200000}, ...}) = 0\nwrite(1, \"@!\", 2)                       = -1 EIO (Input/output error)\ngetrusage(RUSAGE_SELF, {ru_utime={97, 770000}, ru_stime={0, 200000}, ...}) = 0\nwrite(1, \"@!\", 2)                       = -1 EIO (Input/output error)\ngetrusage(RUSAGE_SELF, {ru_utime={97, 800000}, ru_stime={0, 200000}, ...}) = 0\nwrite(1, \"@!\", 2)                       = -1 EIO (Input/output error)\ngetrusage(RUSAGE_SELF, {ru_utime={97, 830000}, ru_stime={0, 200000}, ...}) = 0\n```\n\n[...]\n\n```\ngetrusage(RUSAGE_SELF, {ru_utime={116, 940000}, ru_stime={0, 200000}, ...}) = 0\nwrite(1, \"@!\", 2)                       = -1 EIO (Input/output error)\n--- SIGSEGV (Segmentation fault) @ 0 (0) ---\nProcess 12608 detached\n```\n\nIt looks like it's stuck in an infinite loop until it finally segfaults, which is almost certainly not what's supposed to happen.",
    "created_at": "2012-11-03T12:27:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157654",
    "user": "https://github.com/jdemeyer"
}
```

Running `strace` on such a `gap` process shows:

```
getrusage(RUSAGE_SELF, {ru_utime={97, 710000}, ru_stime={0, 200000}, ...}) = 0
write(1, "@!", 2)                       = -1 EIO (Input/output error)
getrusage(RUSAGE_SELF, {ru_utime={97, 740000}, ru_stime={0, 200000}, ...}) = 0
write(1, "@!", 2)                       = -1 EIO (Input/output error)
getrusage(RUSAGE_SELF, {ru_utime={97, 770000}, ru_stime={0, 200000}, ...}) = 0
write(1, "@!", 2)                       = -1 EIO (Input/output error)
getrusage(RUSAGE_SELF, {ru_utime={97, 800000}, ru_stime={0, 200000}, ...}) = 0
write(1, "@!", 2)                       = -1 EIO (Input/output error)
getrusage(RUSAGE_SELF, {ru_utime={97, 830000}, ru_stime={0, 200000}, ...}) = 0
```

[...]

```
getrusage(RUSAGE_SELF, {ru_utime={116, 940000}, ru_stime={0, 200000}, ...}) = 0
write(1, "@!", 2)                       = -1 EIO (Input/output error)
--- SIGSEGV (Segmentation fault) @ 0 (0) ---
Process 12608 detached
```

It looks like it's stuck in an infinite loop until it finally segfaults, which is almost certainly not what's supposed to happen.



---

archive/issue_comments_157655.json:
```json
{
    "body": "For those interested: a full `strace` can be found at [http://boxen.math.washington.edu/home/jdemeyer/gap.trace](http://boxen.math.washington.edu/home/jdemeyer/gap.trace)",
    "created_at": "2012-11-03T12:41:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157655",
    "user": "https://github.com/jdemeyer"
}
```

For those interested: a full `strace` can be found at [http://boxen.math.washington.edu/home/jdemeyer/gap.trace](http://boxen.math.washington.edu/home/jdemeyer/gap.trace)



---

archive/issue_comments_157656.json:
```json
{
    "body": "Replying to [comment:106 jdemeyer]:\n> Big there's still the obvious question: what is that `gap` process doing and why does it keep running for a while?\n\nthat it's the same GAP process as the one that gets started during the \"normal\" Sage startup.\nAnd it does the following things, as you can see by uncommenting `LogTo` line at the end of `sage.g`. \n\n```\ngap> LoadPackage(\"ctbllib\");\ntrue\n...\ngap> SaveWorkspace(\"/var/folders/qW/qWY+4Ku1GF0WXrOsV+IDvk+++TM/-Tmp-//dotsageKTXveD/gap/workspace-8046660130267724445\");\ntrue\ngap> \n```\n\n`LoadPackage()` things are OK, it's just loading GAP's packages.\nThe tough thing is `SaveWorkspace()`, which dumps GAP's workspace into a binary file; which can be loaded back --- well, not in this case of course, cause we are invoked with --nodotsage, so it goes to waste.\n\nSo I suppose that's what gets stuck, and crashes, for some reason (e.g. not enough disk space?).",
    "created_at": "2012-11-03T14:07:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157656",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:106 jdemeyer]:
> Big there's still the obvious question: what is that `gap` process doing and why does it keep running for a while?

that it's the same GAP process as the one that gets started during the "normal" Sage startup.
And it does the following things, as you can see by uncommenting `LogTo` line at the end of `sage.g`. 

```
gap> LoadPackage("ctbllib");
true
...
gap> SaveWorkspace("/var/folders/qW/qWY+4Ku1GF0WXrOsV+IDvk+++TM/-Tmp-//dotsageKTXveD/gap/workspace-8046660130267724445");
true
gap> 
```

`LoadPackage()` things are OK, it's just loading GAP's packages.
The tough thing is `SaveWorkspace()`, which dumps GAP's workspace into a binary file; which can be loaded back --- well, not in this case of course, cause we are invoked with --nodotsage, so it goes to waste.

So I suppose that's what gets stuck, and crashes, for some reason (e.g. not enough disk space?).



---

archive/issue_comments_157657.json:
```json
{
    "body": "Whats the content of your `~/.sage/tmp/<hostname>/<pid>/spawned_processes` file?",
    "created_at": "2012-11-03T14:10:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157657",
    "user": "https://github.com/vbraun"
}
```

Whats the content of your `~/.sage/tmp/<hostname>/<pid>/spawned_processes` file?



---

archive/issue_comments_157658.json:
```json
{
    "body": "PS: Writing the workspace dump succeeds as you can see from Jeroen's strace. \n\nWe don't specifically close down GAP afterwards, but just close the stdin/out pipes. This sends GAP into at tizzy, and it keeps trying to read from stdin after getting EIO (why would you do this?). Still, the real question remains: why is GAP not killed by the sage cleaner?",
    "created_at": "2012-11-03T14:17:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157658",
    "user": "https://github.com/vbraun"
}
```

PS: Writing the workspace dump succeeds as you can see from Jeroen's strace. 

We don't specifically close down GAP afterwards, but just close the stdin/out pipes. This sends GAP into at tizzy, and it keeps trying to read from stdin after getting EIO (why would you do this?). Still, the real question remains: why is GAP not killed by the sage cleaner?



---

archive/issue_comments_157659.json:
```json
{
    "body": "Now I see ENOSPC errors (I think not before):\n\n```\nopen(\"/tmp/dotsagewHCJJ1/gap/workspace-5368401171496622154\", O_WRONLY|O_CREAT|O_TRUNC, 0644) = 4\nwrite(4, \"GAP workspace\\0004.5.6\\00064 bit\\0\\10\\7\\6\\5\\4\"..., 100000) = -1 ENOSPC (No space left on device)\n```\n\n\nBut this doesn't make sense as there is plenty of space on `/tmp` and I can create large files manually there:\n\n```\njdemeyer@sage:sage-5.5.beta0-gap$ dd if=/dev/zero of=/tmp/dotsagewHCJJ1/gap/workspace-5368401171496622154 bs=1024 count=100000\n100000+0 records in\n100000+0 records out\n102400000 bytes (102 MB) copied, 0.158741 s, 645 MB/s\n```\n\n\nI am lost...",
    "created_at": "2012-11-03T14:27:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157659",
    "user": "https://github.com/jdemeyer"
}
```

Now I see ENOSPC errors (I think not before):

```
open("/tmp/dotsagewHCJJ1/gap/workspace-5368401171496622154", O_WRONLY|O_CREAT|O_TRUNC, 0644) = 4
write(4, "GAP workspace\0004.5.6\00064 bit\0\10\7\6\5\4"..., 100000) = -1 ENOSPC (No space left on device)
```


But this doesn't make sense as there is plenty of space on `/tmp` and I can create large files manually there:

```
jdemeyer@sage:sage-5.5.beta0-gap$ dd if=/dev/zero of=/tmp/dotsagewHCJJ1/gap/workspace-5368401171496622154 bs=1024 count=100000
100000+0 records in
100000+0 records out
102400000 bytes (102 MB) copied, 0.158741 s, 645 MB/s
```


I am lost...



---

archive/issue_comments_157660.json:
```json
{
    "body": "Could the ENOSPC be related to the fact that this a tmpfs and that GAP reserves all the memory for itself?",
    "created_at": "2012-11-03T14:30:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157660",
    "user": "https://github.com/jdemeyer"
}
```

Could the ENOSPC be related to the fact that this a tmpfs and that GAP reserves all the memory for itself?



---

archive/issue_comments_157661.json:
```json
{
    "body": "Does gap create lots of small files in `/tmp`? If so, are you running out of inodes? You can check using `df -i`.",
    "created_at": "2012-11-03T14:31:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157661",
    "user": "https://github.com/ppurka"
}
```

Does gap create lots of small files in `/tmp`? If so, are you running out of inodes? You can check using `df -i`.



---

archive/issue_comments_157662.json:
```json
{
    "body": "`/tmp` is as good as empty:\n\n```\njdemeyer@sage:~$ df -h /tmp\nFilesystem      Size  Used Avail Use% Mounted on\ntmpfs            16G   25M   16G   1% /tmp\njdemeyer@sage:~$ df -i /tmp\nFilesystem     Inodes IUsed  IFree IUse% Mounted on\ntmpfs          524288  1253 523035    1% /tmp\n```\n\n\n(looking at the trace, gap doesn't create a lot of files in `/tmp`)",
    "created_at": "2012-11-03T14:34:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157662",
    "user": "https://github.com/jdemeyer"
}
```

`/tmp` is as good as empty:

```
jdemeyer@sage:~$ df -h /tmp
Filesystem      Size  Used Avail Use% Mounted on
tmpfs            16G   25M   16G   1% /tmp
jdemeyer@sage:~$ df -i /tmp
Filesystem     Inodes IUsed  IFree IUse% Mounted on
tmpfs          524288  1253 523035    1% /tmp
```


(looking at the trace, gap doesn't create a lot of files in `/tmp`)



---

archive/issue_comments_157663.json:
```json
{
    "body": "Possibly kernel bug? From 2.6.38 changelog: \"tmpfs: fix spurious ENOSPC when racing with unswap\". GAP puts pressure on swap since it locks address space (and hence reduces the available swap).",
    "created_at": "2012-11-03T14:49:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157663",
    "user": "https://github.com/vbraun"
}
```

Possibly kernel bug? From 2.6.38 changelog: "tmpfs: fix spurious ENOSPC when racing with unswap". GAP puts pressure on swap since it locks address space (and hence reduces the available swap).



---

archive/issue_comments_157664.json:
```json
{
    "body": "Switching filesystems made to ENOSPC disappear.",
    "created_at": "2012-11-03T15:09:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157664",
    "user": "https://github.com/jdemeyer"
}
```

Switching filesystems made to ENOSPC disappear.



---

archive/issue_comments_157665.json:
```json
{
    "body": "But now I cannot reproduce the orphans anymore, they now crash much earlier:\n\n```\nwrite(4, \"\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\202\\30\\0\\0\\0\\0\\0\\0\\300\\3\\0\\0\\0\"..., 100000) = 100000\nwrite(4, \"\\0\\0\\0\\0\\275\\10\\0\\0\\0\\0\\0\\0\\363\\6\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\"..., 100000) = 100000\nwrite(4, \"\\0\\0\\0\\275\\10\\0\\0\\0\\0\\0\\0\\306\\v\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\"..., 100000) = 100000\nwrite(4, \"\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\275\"..., 86744) = 86744\nclose(4)                                = 0\nwrite(1, \"@n\", 2)                       = 2\nwrite(1, \"true@J\", 6)                   = 6\ngetrusage(RUSAGE_SELF, {ru_utime={2, 900000}, ru_stime={0, 140000}, ...}) = 0\ngetrusage(RUSAGE_SELF, {ru_utime={2, 900000}, ru_stime={0, 140000}, ...}) = 0\nwrite(1, \"@n\", 2)                       = 2\nwrite(1, \"gap> \", 5)                    = 5\nwrite(1, \"@i\", 2)                       = 2\ngetrusage(RUSAGE_SELF, {ru_utime={2, 900000}, ru_stime={0, 140000}, ...}) = 0\nread(0, \"\", 1)                          = 0\nwrite(1, \"\\r\", 1)                       = -1 EIO (Input/output error)\nwrite(1, \"@f\", 2)                       = -1 EIO (Input/output error)\nwrite(1, \"@f\", 2)                       = -1 EIO (Input/output error)\nwrite(1, \"@f\", 2)                       = -1 EIO (Input/output error)\nwrite(1, \"@f\", 2)                       = -1 EIO (Input/output error)\nwrite(1, \"@f\", 2)                       = -1 EIO (Input/output error)\nwrite(1, \"@f\", 2)                       = -1 EIO (Input/output error)\nwrite(1, \"@f\", 2)                       = -1 EIO (Input/output error)\nwrite(1, \"@f\", 2)                       = -1 EIO (Input/output error)\nwrite(1, \"@f\", 2)                       = -1 EIO (Input/output error)\nwrite(1, \"@f\", 2)                       = -1 EIO (Input/output error)\nwrite(1, \"@f\", 2)                       = -1 EIO (Input/output error)\nwrite(1, \"@f\", 2)                       = -1 EIO (Input/output error)\nwrite(1, \"@f\", 2)                       = -1 EIO (Input/output error)\n--- SIGSEGV (Segmentation fault) @ 0 (0) ---\n+++ killed by SIGSEGV +++\n```\n",
    "created_at": "2012-11-03T15:11:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157665",
    "user": "https://github.com/jdemeyer"
}
```

But now I cannot reproduce the orphans anymore, they now crash much earlier:

```
write(4, "\0\0\0\0\0\0\0\0\0\0\0\0\202\30\0\0\0\0\0\0\300\3\0\0\0"..., 100000) = 100000
write(4, "\0\0\0\0\275\10\0\0\0\0\0\0\363\6\0\0\0\0\0\0\0\0\0\0\0"..., 100000) = 100000
write(4, "\0\0\0\275\10\0\0\0\0\0\0\306\v\0\0\0\0\0\0\0\0\0\0\0\0"..., 100000) = 100000
write(4, "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\275"..., 86744) = 86744
close(4)                                = 0
write(1, "@n", 2)                       = 2
write(1, "true@J", 6)                   = 6
getrusage(RUSAGE_SELF, {ru_utime={2, 900000}, ru_stime={0, 140000}, ...}) = 0
getrusage(RUSAGE_SELF, {ru_utime={2, 900000}, ru_stime={0, 140000}, ...}) = 0
write(1, "@n", 2)                       = 2
write(1, "gap> ", 5)                    = 5
write(1, "@i", 2)                       = 2
getrusage(RUSAGE_SELF, {ru_utime={2, 900000}, ru_stime={0, 140000}, ...}) = 0
read(0, "", 1)                          = 0
write(1, "\r", 1)                       = -1 EIO (Input/output error)
write(1, "@f", 2)                       = -1 EIO (Input/output error)
write(1, "@f", 2)                       = -1 EIO (Input/output error)
write(1, "@f", 2)                       = -1 EIO (Input/output error)
write(1, "@f", 2)                       = -1 EIO (Input/output error)
write(1, "@f", 2)                       = -1 EIO (Input/output error)
write(1, "@f", 2)                       = -1 EIO (Input/output error)
write(1, "@f", 2)                       = -1 EIO (Input/output error)
write(1, "@f", 2)                       = -1 EIO (Input/output error)
write(1, "@f", 2)                       = -1 EIO (Input/output error)
write(1, "@f", 2)                       = -1 EIO (Input/output error)
write(1, "@f", 2)                       = -1 EIO (Input/output error)
write(1, "@f", 2)                       = -1 EIO (Input/output error)
write(1, "@f", 2)                       = -1 EIO (Input/output error)
--- SIGSEGV (Segmentation fault) @ 0 (0) ---
+++ killed by SIGSEGV +++
```




---

archive/issue_comments_157666.json:
```json
{
    "body": "And `\"$DOT_SAGE/tmp/sage.math.washington.edu\"` is empty after Sage is finished.",
    "created_at": "2012-11-03T15:13:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157666",
    "user": "https://github.com/jdemeyer"
}
```

And `"$DOT_SAGE/tmp/sage.math.washington.edu"` is empty after Sage is finished.



---

archive/issue_comments_157667.json:
```json
{
    "body": "But for `sage-cleaner`, what matters is \"$DOT_SAGE/**temp**/sage.math.washington.edu\"",
    "created_at": "2012-11-03T15:17:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157667",
    "user": "https://github.com/jdemeyer"
}
```

But for `sage-cleaner`, what matters is "$DOT_SAGE/**temp**/sage.math.washington.edu"



---

archive/issue_comments_157668.json:
```json
{
    "body": "When running Sage **interactively** (as opposed to `sage -c`), `gap` gets closed properly because it gets sent `\"quit;\\n\"`\n\n```\nwrite(4, \"\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\201\\20\\0\\0\\0\\0\"..., 91115) = 91115\nclose(4)                                = 0\nwrite(1, \"@n\", 2)                       = 2\nwrite(1, \"true@J\", 6)                   = 6\ngetrusage(RUSAGE_SELF, {ru_utime={2, 790000}, ru_stime={0, 170000}, ...}) = 0\ngetrusage(RUSAGE_SELF, {ru_utime={2, 790000}, ru_stime={0, 170000}, ...}) = 0\nwrite(1, \"@n\", 2)                       = 2\nwrite(1, \"gap> \", 5)                    = 5\nwrite(1, \"@i\", 2)                       = 2\ngetrusage(RUSAGE_SELF, {ru_utime={2, 790000}, ru_stime={0, 170000}, ...}) = 0\nread(0, \"q\", 1)                         = 1\nwrite(1, \"q\", 1)                        = 1\nread(0, \"u\", 1)                         = 1\nwrite(1, \"u\", 1)                        = 1\nread(0, \"i\", 1)                         = 1\nwrite(1, \"i\", 1)                        = 1\nread(0, \"t\", 1)                         = 1\nwrite(1, \"t\", 1)                        = 1\nread(0, \";\", 1)                         = 1\nwrite(1, \";\", 1)                        = 1\nread(0, \"\\n\", 1)                        = 1\nwrite(1, \"\\r\", 1)                       = 1\nwrite(1, \"\\n\", 1)                       = 1\nwrite(1, \"@r\", 2)                       = 2\nwrite(1, \"quit;@J\", 7)                  = 7\ngetrusage(RUSAGE_SELF, {ru_utime={2, 790000}, ru_stime={0, 170000}, ...}) = 0\nread(3, \"\", 20000)                      = 0\nclose(3)                                = 0\nexit_group(0)                           = ?\n```\n",
    "created_at": "2012-11-03T15:20:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157668",
    "user": "https://github.com/jdemeyer"
}
```

When running Sage **interactively** (as opposed to `sage -c`), `gap` gets closed properly because it gets sent `"quit;\n"`

```
write(4, "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\201\20\0\0\0\0"..., 91115) = 91115
close(4)                                = 0
write(1, "@n", 2)                       = 2
write(1, "true@J", 6)                   = 6
getrusage(RUSAGE_SELF, {ru_utime={2, 790000}, ru_stime={0, 170000}, ...}) = 0
getrusage(RUSAGE_SELF, {ru_utime={2, 790000}, ru_stime={0, 170000}, ...}) = 0
write(1, "@n", 2)                       = 2
write(1, "gap> ", 5)                    = 5
write(1, "@i", 2)                       = 2
getrusage(RUSAGE_SELF, {ru_utime={2, 790000}, ru_stime={0, 170000}, ...}) = 0
read(0, "q", 1)                         = 1
write(1, "q", 1)                        = 1
read(0, "u", 1)                         = 1
write(1, "u", 1)                        = 1
read(0, "i", 1)                         = 1
write(1, "i", 1)                        = 1
read(0, "t", 1)                         = 1
write(1, "t", 1)                        = 1
read(0, ";", 1)                         = 1
write(1, ";", 1)                        = 1
read(0, "\n", 1)                        = 1
write(1, "\r", 1)                       = 1
write(1, "\n", 1)                       = 1
write(1, "@r", 2)                       = 2
write(1, "quit;@J", 7)                  = 7
getrusage(RUSAGE_SELF, {ru_utime={2, 790000}, ru_stime={0, 170000}, ...}) = 0
read(3, "", 20000)                      = 0
close(3)                                = 0
exit_group(0)                           = ?
```




---

archive/issue_comments_157669.json:
```json
{
    "body": "Changing keywords from \"orphaned processes\" to \"segmentation fault in child process\".",
    "created_at": "2012-11-03T15:24:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157669",
    "user": "https://github.com/jdemeyer"
}
```

Changing keywords from "orphaned processes" to "segmentation fault in child process".



---

archive/issue_comments_157670.json:
```json
{
    "body": "Regardless of `sage-cleaner`, I think it's clear that the gap Segmentation Fault should be fixed.",
    "created_at": "2012-11-03T15:24:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157670",
    "user": "https://github.com/jdemeyer"
}
```

Regardless of `sage-cleaner`, I think it's clear that the gap Segmentation Fault should be fixed.



---

archive/issue_comments_157671.json:
```json
{
    "body": "Replying to [comment:120 jdemeyer]:\n> But for `sage-cleaner`, what matters is \"$DOT_SAGE/**temp**/sage.math.washington.edu\"\nOK, so the cleaner does not clean if one starts with --nodotsage...\n\nAt least this should go  another ticket, IMHO.",
    "created_at": "2012-11-03T15:27:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157671",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:120 jdemeyer]:
> But for `sage-cleaner`, what matters is "$DOT_SAGE/**temp**/sage.math.washington.edu"
OK, so the cleaner does not clean if one starts with --nodotsage...

At least this should go  another ticket, IMHO.



---

archive/issue_comments_157672.json:
```json
{
    "body": "Changing keywords from \"segmentation fault in child process\" to \"\".",
    "created_at": "2012-11-03T15:29:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157672",
    "user": "https://github.com/jdemeyer"
}
```

Changing keywords from "segmentation fault in child process" to "".



---

archive/issue_comments_157673.json:
```json
{
    "body": "Initial patch",
    "created_at": "2012-11-03T15:34:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157673",
    "user": "https://github.com/vbraun"
}
```

Initial patch



---

archive/issue_comments_157674.json:
```json
{
    "body": "Attachment [trac_13211_quit_after_workspace.patch](tarball://root/attachments/some-uuid/ticket13211/trac_13211_quit_after_workspace.patch) by @vbraun created at 2012-11-03 15:41:52\n\nI've added a patch to explicitly quit Gap after writing the workspace. \n\nThe sage-cleaner indeed looks in `.../temp/...`, but `SAGE_TMP` is in `.../tmp/...` so the cleaner is currently broken. Thats the fault of #13579",
    "created_at": "2012-11-03T15:41:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157674",
    "user": "https://github.com/vbraun"
}
```

Attachment [trac_13211_quit_after_workspace.patch](tarball://root/attachments/some-uuid/ticket13211/trac_13211_quit_after_workspace.patch) by @vbraun created at 2012-11-03 15:41:52

I've added a patch to explicitly quit Gap after writing the workspace. 

The sage-cleaner indeed looks in `.../temp/...`, but `SAGE_TMP` is in `.../tmp/...` so the cleaner is currently broken. Thats the fault of #13579



---

archive/issue_comments_157675.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-11-03T15:41:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157675",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_157676.json:
```json
{
    "body": "I've made #13681 to deal with some fallout of the `SAGE_TMP` change that #13579 introduced.",
    "created_at": "2012-11-03T16:12:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157676",
    "user": "https://github.com/vbraun"
}
```

I've made #13681 to deal with some fallout of the `SAGE_TMP` change that #13579 introduced.



---

archive/issue_comments_157677.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-11-04T04:06:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157677",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_157678.json:
```json
{
    "body": "After running some doctests again with this patch, I see a lot of orphan gap processes again.\nThe strace is as before:\n\n```\n[...]\ngetrusage(RUSAGE_SELF, {ru_utime={9186, 870000}, ru_stime={6, 120000}, ...}) = 0\nwrite(1, \"@!\", 2)                       = -1 EIO (Input/output error)\ngetrusage(RUSAGE_SELF, {ru_utime={9187, 210000}, ru_stime={6, 120000}, ...}) = 0\nwrite(1, \"@!\", 2)                       = -1 EIO (Input/output error)\ngetrusage(RUSAGE_SELF, {ru_utime={9187, 550000}, ru_stime={6, 120000}, ...}) = 0\nwrite(1, \"@!\", 2)                       = -1 EIO (Input/output error)\ngetrusage(RUSAGE_SELF, {ru_utime={9187, 910000}, ru_stime={6, 120000}, ...}) = 0\nwrite(1, \"@!\", 2)                       = -1 EIO (Input/output error)\ngetrusage(RUSAGE_SELF, {ru_utime={9188, 260000}, ru_stime={6, 120000}, ...}) = 0\nwrite(1, \"@!\", 2)                       = -1 EIO (Input/output error)\n[...]\n```\n",
    "created_at": "2012-11-08T20:29:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157678",
    "user": "https://github.com/jdemeyer"
}
```

After running some doctests again with this patch, I see a lot of orphan gap processes again.
The strace is as before:

```
[...]
getrusage(RUSAGE_SELF, {ru_utime={9186, 870000}, ru_stime={6, 120000}, ...}) = 0
write(1, "@!", 2)                       = -1 EIO (Input/output error)
getrusage(RUSAGE_SELF, {ru_utime={9187, 210000}, ru_stime={6, 120000}, ...}) = 0
write(1, "@!", 2)                       = -1 EIO (Input/output error)
getrusage(RUSAGE_SELF, {ru_utime={9187, 550000}, ru_stime={6, 120000}, ...}) = 0
write(1, "@!", 2)                       = -1 EIO (Input/output error)
getrusage(RUSAGE_SELF, {ru_utime={9187, 910000}, ru_stime={6, 120000}, ...}) = 0
write(1, "@!", 2)                       = -1 EIO (Input/output error)
getrusage(RUSAGE_SELF, {ru_utime={9188, 260000}, ru_stime={6, 120000}, ...}) = 0
write(1, "@!", 2)                       = -1 EIO (Input/output error)
[...]
```




---

archive/issue_comments_157679.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2012-11-08T20:29:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157679",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_157680.json:
```json
{
    "body": "Changing status from needs_work to needs_info.",
    "created_at": "2012-11-09T15:37:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157680",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_work to needs_info.



---

archive/issue_comments_157681.json:
```json
{
    "body": "Again, the question is not why are there GAP orphans but why is the sage-cleaner not killing them once the parent Sage process quits?",
    "created_at": "2012-11-09T15:37:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157681",
    "user": "https://github.com/vbraun"
}
```

Again, the question is not why are there GAP orphans but why is the sage-cleaner not killing them once the parent Sage process quits?



---

archive/issue_comments_157682.json:
```json
{
    "body": "Replying to [comment:129 vbraun]:\n> Again, the question is not why are there GAP orphans but why is the sage-cleaner not killing them once the parent Sage process quits?\nThat's **a** question, I don't think it's **the** question.  Sage should clean up for itself and `sage-cleaner` should only be a last resort.",
    "created_at": "2012-11-09T17:13:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157682",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:129 vbraun]:
> Again, the question is not why are there GAP orphans but why is the sage-cleaner not killing them once the parent Sage process quits?
That's **a** question, I don't think it's **the** question.  Sage should clean up for itself and `sage-cleaner` should only be a last resort.



---

archive/issue_comments_157683.json:
```json
{
    "body": "I agree, but since you are the only one who is able to get the orphans (possibly in conjunction with a kernel bug) I'd be perfectly happy to let sage-cleaner handle this corner case.",
    "created_at": "2012-11-09T17:58:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157683",
    "user": "https://github.com/vbraun"
}
```

I agree, but since you are the only one who is able to get the orphans (possibly in conjunction with a kernel bug) I'd be perfectly happy to let sage-cleaner handle this corner case.



---

archive/issue_comments_157684.json:
```json
{
    "body": "On an unrelated note, the interleaved getrusage / write strace probably means that GAP is running something in the internal profiler.",
    "created_at": "2012-11-09T17:59:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157684",
    "user": "https://github.com/vbraun"
}
```

On an unrelated note, the interleaved getrusage / write strace probably means that GAP is running something in the internal profiler.



---

archive/issue_comments_157685.json:
```json
{
    "body": "Can you confirm that the offending gap process still doesn't include the \"-L ...gapworkspace..\" command line switch? This probably means that the processes originate when creating the workspace. Is this on a file system that disallows simultaneous writes from multiple processes to the same file?",
    "created_at": "2012-11-09T18:05:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157685",
    "user": "https://github.com/vbraun"
}
```

Can you confirm that the offending gap process still doesn't include the "-L ...gapworkspace.." command line switch? This probably means that the processes originate when creating the workspace. Is this on a file system that disallows simultaneous writes from multiple processes to the same file?



---

archive/issue_comments_157686.json:
```json
{
    "body": "Also, can you post a strace for the hanging GAP process? With trac_13211_quit_after_workspace.patch the 'gap_reset_workspace()' command quits correctly, so I suspect your problem is at a different place now.",
    "created_at": "2012-11-09T18:34:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157686",
    "user": "https://github.com/vbraun"
}
```

Also, can you post a strace for the hanging GAP process? With trac_13211_quit_after_workspace.patch the 'gap_reset_workspace()' command quits correctly, so I suspect your problem is at a different place now.



---

archive/issue_comments_157687.json:
```json
{
    "body": "To better test this, I disabled the cleaner (by putting `sys.exit(0)` in `sage-cleaner`).\n\nExample strace of segfaulting process is attached.",
    "created_at": "2012-11-12T10:11:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157687",
    "user": "https://github.com/jdemeyer"
}
```

To better test this, I disabled the cleaner (by putting `sys.exit(0)` in `sage-cleaner`).

Example strace of segfaulting process is attached.



---

archive/issue_comments_157688.json:
```json
{
    "body": "I'm also seeing a lot of `ENOMEM` errors in the trace.  Could these be caused by the huge pool size?",
    "created_at": "2012-11-12T10:15:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157688",
    "user": "https://github.com/jdemeyer"
}
```

I'm also seeing a lot of `ENOMEM` errors in the trace.  Could these be caused by the huge pool size?



---

archive/issue_comments_157689.json:
```json
{
    "body": "There is a potential infinite loop with `_eval_line` in `gap.py`: when it crashes, it keeps trying again over and over:\n\n```\n    def _eval_line(self, line, allow_use_file=True, wait_for_prompt=True, restart_if_needed=True):\n        [...]\n        try:\n            [...]\n        except (RuntimeError,TypeError),message:\n            if 'EOF' in message[0] or E is None or not E.isalive():\n                print \"** %s crashed or quit executing '%s' **\"%(self, line)\n                print \"Restarting %s and trying again\"%self\n                self._start()\n                if line != '':\n                    return self._eval_line(line, allow_use_file=allow_use_file)\n                else:\n                    return ''\n            else:\n                raise RuntimeError, message\n```\n\n\nIs this intentional? Probably the number of retries should be limited.\n\n(this seems unrelated to this ticket but I thought I should mention it)",
    "created_at": "2012-11-12T10:44:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157689",
    "user": "https://github.com/jdemeyer"
}
```

There is a potential infinite loop with `_eval_line` in `gap.py`: when it crashes, it keeps trying again over and over:

```
    def _eval_line(self, line, allow_use_file=True, wait_for_prompt=True, restart_if_needed=True):
        [...]
        try:
            [...]
        except (RuntimeError,TypeError),message:
            if 'EOF' in message[0] or E is None or not E.isalive():
                print "** %s crashed or quit executing '%s' **"%(self, line)
                print "Restarting %s and trying again"%self
                self._start()
                if line != '':
                    return self._eval_line(line, allow_use_file=allow_use_file)
                else:
                    return ''
            else:
                raise RuntimeError, message
```


Is this intentional? Probably the number of retries should be limited.

(this seems unrelated to this ticket but I thought I should mention it)



---

archive/issue_comments_157690.json:
```json
{
    "body": "Did you apply `trac_13211_pool_size.patch`? Unless your machine has exabyte-sized swap it shouldn't even try to allocate such a large pool.",
    "created_at": "2012-11-12T16:26:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157690",
    "user": "https://github.com/vbraun"
}
```

Did you apply `trac_13211_pool_size.patch`? Unless your machine has exabyte-sized swap it shouldn't even try to allocate such a large pool.



---

archive/issue_comments_157691.json:
```json
{
    "body": "Oh I see, `gap -o <number>` doesn't work. It apparently requires a binary prefix.",
    "created_at": "2012-11-12T16:30:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157691",
    "user": "https://github.com/vbraun"
}
```

Oh I see, `gap -o <number>` doesn't work. It apparently requires a binary prefix.



---

archive/issue_comments_157692.json:
```json
{
    "body": "There is apparently an overflow in gap's argument parsing at `3*2^31`:\n\n```\n(sage-sh) vbraun@localhost:~$ /home/vbraun/opt/sage-5.4.rc4/local/gap/latest/bin/x86_64-unknown-linux-gnu-gcc-default64/gap -l /home/vbraun/opt/sage-5.4.rc4/local/gap/latest -o 6442450943\n \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   GAP, Version 4.5.6 of 16-Sep-2012 (free software, GPL)\n \u2502  GAP  \u2502   http://www.gap-system.org\n \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   Architecture: x86_64-unknown-linux-gnu-gcc-default64\n Libs used:  gmp, readline\n Loading the library and packages ...\n Packages:   GAPDoc 1.5.1\n Try '?help' for help. See also  '?copyright' and  '?authors'\ngap> \n(sage-sh) vbraun@localhost:~$ /home/vbraun/opt/sage-5.4.rc4/local/gap/latest/bin/x86_64-unknown-linux-gnu-gcc-default64/gap -l /home/vbraun/opt/sage-5.4.rc4/local/gap/latest -o 6442450944\ngap: halving pool size.\ngap: halving pool size.\ngap: halving pool size.\ngap: halving pool size.\ngap: halving pool size.\ngap: halving pool size.\ngap: halving pool size.\ngap: halving pool size.\ngap: halving pool size.\ngap: halving pool size.\ngap: halving pool size.\ngap: halving pool size.\ngap: halving pool size.\ngap: halving pool size.\ngap: halving pool size.\ngap: halving pool size.\ngap: halving pool size.\ngap: halving pool size.\ngap: halving pool size.\ngap: halving pool size.\ngap: halving pool size.\ngap: halving pool size.\ngap: halving pool size.\ngap: halving pool size.\ngap: halving pool size.\ngap: halving pool size.\ngap: halving pool size.\ngap: halving pool size.\ngap: halving pool size.\ngap: halving pool size.\n \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   GAP, Version 4.5.6 of 16-Sep-2012 (free software, GPL)\n \u2502  GAP  \u2502   http://www.gap-system.org\n \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   Architecture: x86_64-unknown-linux-gnu-gcc-default64\n Libs used:  gmp, readline\n Loading the library and packages ...\n Packages:   GAPDoc 1.5.1\n Try '?help' for help. See also  '?copyright' and  '?authors'\n```\n\nThat explains why you get the ENOMEMs. But gap tries smaller and smaller mmaps until it succeeds, so this is not a real problem. It will eat the available swap space and put much more pressure on the virtual memory system, though. I'll report this issue upstream.",
    "created_at": "2012-11-12T21:21:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157692",
    "user": "https://github.com/vbraun"
}
```

There is apparently an overflow in gap's argument parsing at `3*2^31`:

```
(sage-sh) vbraun@localhost:~$ /home/vbraun/opt/sage-5.4.rc4/local/gap/latest/bin/x86_64-unknown-linux-gnu-gcc-default64/gap -l /home/vbraun/opt/sage-5.4.rc4/local/gap/latest -o 6442450943
 ┌───────┐   GAP, Version 4.5.6 of 16-Sep-2012 (free software, GPL)
 │  GAP  │   http://www.gap-system.org
 └───────┘   Architecture: x86_64-unknown-linux-gnu-gcc-default64
 Libs used:  gmp, readline
 Loading the library and packages ...
 Packages:   GAPDoc 1.5.1
 Try '?help' for help. See also  '?copyright' and  '?authors'
gap> 
(sage-sh) vbraun@localhost:~$ /home/vbraun/opt/sage-5.4.rc4/local/gap/latest/bin/x86_64-unknown-linux-gnu-gcc-default64/gap -l /home/vbraun/opt/sage-5.4.rc4/local/gap/latest -o 6442450944
gap: halving pool size.
gap: halving pool size.
gap: halving pool size.
gap: halving pool size.
gap: halving pool size.
gap: halving pool size.
gap: halving pool size.
gap: halving pool size.
gap: halving pool size.
gap: halving pool size.
gap: halving pool size.
gap: halving pool size.
gap: halving pool size.
gap: halving pool size.
gap: halving pool size.
gap: halving pool size.
gap: halving pool size.
gap: halving pool size.
gap: halving pool size.
gap: halving pool size.
gap: halving pool size.
gap: halving pool size.
gap: halving pool size.
gap: halving pool size.
gap: halving pool size.
gap: halving pool size.
gap: halving pool size.
gap: halving pool size.
gap: halving pool size.
gap: halving pool size.
 ┌───────┐   GAP, Version 4.5.6 of 16-Sep-2012 (free software, GPL)
 │  GAP  │   http://www.gap-system.org
 └───────┘   Architecture: x86_64-unknown-linux-gnu-gcc-default64
 Libs used:  gmp, readline
 Loading the library and packages ...
 Packages:   GAPDoc 1.5.1
 Try '?help' for help. See also  '?copyright' and  '?authors'
```

That explains why you get the ENOMEMs. But gap tries smaller and smaller mmaps until it succeeds, so this is not a real problem. It will eat the available swap space and put much more pressure on the virtual memory system, though. I'll report this issue upstream.



---

archive/issue_comments_157693.json:
```json
{
    "body": "I've updated the patch to use `gap -o <number>m` for a specific number of megabytes instead of specifying the pool size in bytes. This should avoid the argument parsing overflow.",
    "created_at": "2012-11-12T21:47:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157693",
    "user": "https://github.com/vbraun"
}
```

I've updated the patch to use `gap -o <number>m` for a specific number of megabytes instead of specifying the pool size in bytes. This should avoid the argument parsing overflow.



---

archive/issue_comments_157694.json:
```json
{
    "body": "Replying to [comment:140 vbraun]:\n> There is apparently an overflow in gap's argument parsing at `3*2^31`:\n> That explains why you get the ENOMEMs. But gap tries smaller and smaller mmaps until it succeeds, so this is not a real problem. It will eat the available swap space and put much more pressure on the virtual memory system, though. I'll report this issue upstream.\n\nby the way, GAP finally has a real [tracker](http://tracker.gap-system.org/)!",
    "created_at": "2012-11-13T02:51:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157694",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:140 vbraun]:
> There is apparently an overflow in gap's argument parsing at `3*2^31`:
> That explains why you get the ENOMEMs. But gap tries smaller and smaller mmaps until it succeeds, so this is not a real problem. It will eat the available swap space and put much more pressure on the virtual memory system, though. I'll report this issue upstream.

by the way, GAP finally has a real [tracker](http://tracker.gap-system.org/)!



---

archive/issue_comments_157695.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2012-11-13T09:42:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157695",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_157696.json:
```json
{
    "body": "Replying to [comment:141 vbraun]:\n> I've updated the patch to use `gap -o <number>m` for a specific number of megabytes instead of specifying the pool size in bytes. This should avoid the argument parsing overflow.\n\nOK, I am testing this on the culprit machine (sage on sagemath UW cluster), and not able to see any staying up GAP processes. I'll try a bit more, and unless I succeed, I'll make it positive review...",
    "created_at": "2012-11-13T09:42:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157696",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:141 vbraun]:
> I've updated the patch to use `gap -o <number>m` for a specific number of megabytes instead of specifying the pool size in bytes. This should avoid the argument parsing overflow.

OK, I am testing this on the culprit machine (sage on sagemath UW cluster), and not able to see any staying up GAP processes. I'll try a bit more, and unless I succeed, I'll make it positive review...



---

archive/issue_comments_157697.json:
```json
{
    "body": "After building and fully doctesting Sage, I still end up with 20 gap processes:\n\n```\njdemeyer@sage:~$ ps -ef |grep gap\njdemeyer  6148     1 83 10:12 ?        03:35:26 /release/merger/sage-5.5.beta2/local/gap/latest/bin/x86_64-unknown-linux-gnu-gcc-default64/gap -m 24m -l /release/merger/sage-5.5.beta2/local/gap/latest -r -L /release/merger/sage-5.5.beta2/home/.sage/gap/workspace-1647326966196298359 -b -p -T -o 6274m /release/merger/sage-5.5.beta2/local/share/sage/ext/gap/sage.g\njdemeyer  6150     1 83 10:12 ?        03:36:51 /release/merger/sage-5.5.beta2/local/gap/latest/bin/x86_64-unknown-linux-gnu-gcc-default64/gap -m 24m -l /release/merger/sage-5.5.beta2/local/gap/latest -r -L /release/merger/sage-5.5.beta2/home/.sage/gap/workspace-1647326966196298359 -b -p -T -o 6274m /release/merger/sage-5.5.beta2/local/share/sage/ext/gap/sage.g\njdemeyer  6154     1 83 10:12 ?        03:35:23 /release/merger/sage-5.5.beta2/local/gap/latest/bin/x86_64-unknown-linux-gnu-gcc-default64/gap -m 24m -l /release/merger/sage-5.5.beta2/local/gap/latest -r -L /release/merger/sage-5.5.beta2/home/.sage/gap/workspace-1647326966196298359 -b -p -T -o 6274m /release/merger/sage-5.5.beta2/local/share/sage/ext/gap/sage.g\n[...]\n```\n",
    "created_at": "2012-11-13T13:32:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157697",
    "user": "https://github.com/jdemeyer"
}
```

After building and fully doctesting Sage, I still end up with 20 gap processes:

```
jdemeyer@sage:~$ ps -ef |grep gap
jdemeyer  6148     1 83 10:12 ?        03:35:26 /release/merger/sage-5.5.beta2/local/gap/latest/bin/x86_64-unknown-linux-gnu-gcc-default64/gap -m 24m -l /release/merger/sage-5.5.beta2/local/gap/latest -r -L /release/merger/sage-5.5.beta2/home/.sage/gap/workspace-1647326966196298359 -b -p -T -o 6274m /release/merger/sage-5.5.beta2/local/share/sage/ext/gap/sage.g
jdemeyer  6150     1 83 10:12 ?        03:36:51 /release/merger/sage-5.5.beta2/local/gap/latest/bin/x86_64-unknown-linux-gnu-gcc-default64/gap -m 24m -l /release/merger/sage-5.5.beta2/local/gap/latest -r -L /release/merger/sage-5.5.beta2/home/.sage/gap/workspace-1647326966196298359 -b -p -T -o 6274m /release/merger/sage-5.5.beta2/local/share/sage/ext/gap/sage.g
jdemeyer  6154     1 83 10:12 ?        03:35:23 /release/merger/sage-5.5.beta2/local/gap/latest/bin/x86_64-unknown-linux-gnu-gcc-default64/gap -m 24m -l /release/merger/sage-5.5.beta2/local/gap/latest -r -L /release/merger/sage-5.5.beta2/home/.sage/gap/workspace-1647326966196298359 -b -p -T -o 6274m /release/merger/sage-5.5.beta2/local/share/sage/ext/gap/sage.g
[...]
```




---

archive/issue_comments_157698.json:
```json
{
    "body": "At least, the ENOMEM errors are gone!",
    "created_at": "2012-11-13T13:42:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157698",
    "user": "https://github.com/jdemeyer"
}
```

At least, the ENOMEM errors are gone!



---

archive/issue_comments_157699.json:
```json
{
    "body": "[attachment:gap.10799] shows the strace of a hanging process. At some point, the trace stops, it seems no further system calls are done.\n\nI don't see the EIO errors and segmentation faults anymore, perhaps that was caused by ENOMEM?",
    "created_at": "2012-11-13T13:56:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157699",
    "user": "https://github.com/jdemeyer"
}
```

[attachment:gap.10799] shows the strace of a hanging process. At some point, the trace stops, it seems no further system calls are done.

I don't see the EIO errors and segmentation faults anymore, perhaps that was caused by ENOMEM?



---

archive/issue_comments_157700.json:
```json
{
    "body": "Replying to [comment:144 jdemeyer]:\n> After building and fully doctesting Sage, I still end up with 20 gap processes:\n\nI tried applying the patches (and the spkg) on this ticket to Sage 5.4.rc4, and running `make ptest`. I have not got any `gap` processes left after it has finished. Have you been doing something else, something nonstandard?",
    "created_at": "2012-11-13T14:12:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157700",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:144 jdemeyer]:
> After building and fully doctesting Sage, I still end up with 20 gap processes:

I tried applying the patches (and the spkg) on this ticket to Sage 5.4.rc4, and running `make ptest`. I have not got any `gap` processes left after it has finished. Have you been doing something else, something nonstandard?



---

archive/issue_comments_157701.json:
```json
{
    "body": "Replying to [comment:144 jdemeyer]:\n> After building and fully doctesting Sage, I still end up with 20 gap processes:\n> {{{\n> jdemeyer`@`sage:~$ ps -ef |grep gap\n> jdemeyer  6148     1 83 10:12 ?        03:35:26 /release/merger/sage-5.5.beta2/local/gap/latest/bin/x86_64-unknown-linux-gnu-gcc-default64/gap -m 24m -l /release/merger/sage-5.5.beta2/local/gap/latest -r -L /release/merger/sage-5.5.beta2/home/.sage/gap/workspace-1647326966196298359 -b -p -T -o 6274m /release/merger/sage-5.5.beta2/local/share/sage/ext/gap/sage.g\n> jdemeyer  6150     1 83 10:12 ?        03:36:51 /release/merger/sage-5.5.beta2/local/gap/latest/bin/x86_64-unknown-linux-gnu-gcc-default64/gap -m 24m -l /release/merger/sage-5.5.beta2/local/gap/latest -r -L /release/merger/sage-5.5.beta2/home/.sage/gap/workspace-1647326966196298359 -b -p -T -o 6274m /release/merger/sage-5.5.beta2/local/share/sage/ext/gap/sage.g\n> jdemeyer  6154     1 83 10:12 ?        03:35:23 /release/merger/sage-5.5.beta2/local/gap/latest/bin/x86_64-unknown-linux-gnu-gcc-default64/gap -m 24m -l /release/merger/sage-5.5.beta2/local/gap/latest -r -L /release/merger/sage-5.5.beta2/home/.sage/gap/workspace-1647326966196298359 -b -p -T -o 6274m /release/merger/sage-5.5.beta2/local/share/sage/ext/gap/sage.g\n> [...]\n> }}}\n\nWhere is .sage/ used in these calls to GAP? AFAIK there is no `/release/merger/sage-5.5.beta2/home/`, yet they list GAP workspace files `/release/merger/sage-5.5.beta2/home/.sage/gap/workspace-1647326966196298359`.\n\nWeird. Could it be the reason for them to hang?",
    "created_at": "2012-11-13T14:16:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157701",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:144 jdemeyer]:
> After building and fully doctesting Sage, I still end up with 20 gap processes:
> {{{
> jdemeyer`@`sage:~$ ps -ef |grep gap
> jdemeyer  6148     1 83 10:12 ?        03:35:26 /release/merger/sage-5.5.beta2/local/gap/latest/bin/x86_64-unknown-linux-gnu-gcc-default64/gap -m 24m -l /release/merger/sage-5.5.beta2/local/gap/latest -r -L /release/merger/sage-5.5.beta2/home/.sage/gap/workspace-1647326966196298359 -b -p -T -o 6274m /release/merger/sage-5.5.beta2/local/share/sage/ext/gap/sage.g
> jdemeyer  6150     1 83 10:12 ?        03:36:51 /release/merger/sage-5.5.beta2/local/gap/latest/bin/x86_64-unknown-linux-gnu-gcc-default64/gap -m 24m -l /release/merger/sage-5.5.beta2/local/gap/latest -r -L /release/merger/sage-5.5.beta2/home/.sage/gap/workspace-1647326966196298359 -b -p -T -o 6274m /release/merger/sage-5.5.beta2/local/share/sage/ext/gap/sage.g
> jdemeyer  6154     1 83 10:12 ?        03:35:23 /release/merger/sage-5.5.beta2/local/gap/latest/bin/x86_64-unknown-linux-gnu-gcc-default64/gap -m 24m -l /release/merger/sage-5.5.beta2/local/gap/latest -r -L /release/merger/sage-5.5.beta2/home/.sage/gap/workspace-1647326966196298359 -b -p -T -o 6274m /release/merger/sage-5.5.beta2/local/share/sage/ext/gap/sage.g
> [...]
> }}}

Where is .sage/ used in these calls to GAP? AFAIK there is no `/release/merger/sage-5.5.beta2/home/`, yet they list GAP workspace files `/release/merger/sage-5.5.beta2/home/.sage/gap/workspace-1647326966196298359`.

Weird. Could it be the reason for them to hang?



---

archive/issue_comments_157702.json:
```json
{
    "body": "`/release/merger/sage-5.5.beta2/home` is a temporary `$HOME` directory for the merger. It's similar to using the `--nodotsage` command line option to `sage`.",
    "created_at": "2012-11-13T15:08:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157702",
    "user": "https://github.com/jdemeyer"
}
```

`/release/merger/sage-5.5.beta2/home` is a temporary `$HOME` directory for the merger. It's similar to using the `--nodotsage` command line option to `sage`.



---

archive/issue_comments_157703.json:
```json
{
    "body": "The GAP developers acknowledged the option parsing overflow, will be fixed in the next stable release.",
    "created_at": "2012-11-13T17:24:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157703",
    "user": "https://github.com/vbraun"
}
```

The GAP developers acknowledged the option parsing overflow, will be fixed in the next stable release.



---

archive/issue_comments_157704.json:
```json
{
    "body": "Attachment [trac_13211_quit.patch](tarball://root/attachments/some-uuid/ticket13211/trac_13211_quit.patch) by @vbraun created at 2012-11-13 18:41:46\n\nInitial patch",
    "created_at": "2012-11-13T18:41:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157704",
    "user": "https://github.com/vbraun"
}
```

Attachment [trac_13211_quit.patch](tarball://root/attachments/some-uuid/ticket13211/trac_13211_quit.patch) by @vbraun created at 2012-11-13 18:41:46

Initial patch



---

archive/issue_comments_157705.json:
```json
{
    "body": "Is the number of orphans related to the number of parallel doctest processes? The added patch fixes an issue where we abandoned one process instead of killing it if the cached workspace fails to load and needs to be recreated.",
    "created_at": "2012-11-13T18:47:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157705",
    "user": "https://github.com/vbraun"
}
```

Is the number of orphans related to the number of parallel doctest processes? The added patch fixes an issue where we abandoned one process instead of killing it if the cached workspace fails to load and needs to be recreated.



---

archive/issue_comments_157706.json:
```json
{
    "body": "I spoke too soon about the EIO errors and segmentation faults being gone, I still get them.",
    "created_at": "2012-11-13T20:45:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157706",
    "user": "https://github.com/jdemeyer"
}
```

I spoke too soon about the EIO errors and segmentation faults being gone, I still get them.



---

archive/issue_comments_157707.json:
```json
{
    "body": "I still don't understand why you get EIO. This means something is seriously foobared, no? When sage quits the other end of the pipe should be closed, resulting in EPIPE.\n\nMy theory is the following: the Sage expect interface can use temporary files to redirect stdin/out and this is where the problem lies. If you run with `sage --nodotsage`, this temporary file is on `/tmp` (see `SAGE_TMP_INTERFACE`). The tmpfs on sage.math has some bug that is triggered when you put pressure on the virtual memory, when most of the swap is locked in anonymous mmaps.",
    "created_at": "2012-11-13T22:09:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157707",
    "user": "https://github.com/vbraun"
}
```

I still don't understand why you get EIO. This means something is seriously foobared, no? When sage quits the other end of the pipe should be closed, resulting in EPIPE.

My theory is the following: the Sage expect interface can use temporary files to redirect stdin/out and this is where the problem lies. If you run with `sage --nodotsage`, this temporary file is on `/tmp` (see `SAGE_TMP_INTERFACE`). The tmpfs on sage.math has some bug that is triggered when you put pressure on the virtual memory, when most of the swap is locked in anonymous mmaps.



---

archive/issue_comments_157708.json:
```json
{
    "body": "I ran some more doctests and GAP is not the only process that ends up in a write loop with EIO until it segfaults. E.g. Maxima does it, too. I guess your problem is that GAP does **not** segfault under certain circumstances.",
    "created_at": "2012-11-14T04:03:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157708",
    "user": "https://github.com/vbraun"
}
```

I ran some more doctests and GAP is not the only process that ends up in a write loop with EIO until it segfaults. E.g. Maxima does it, too. I guess your problem is that GAP does **not** segfault under certain circumstances.



---

archive/issue_comments_157709.json:
```json
{
    "body": "The glibc manual says: *EIO also occurs when a background process tries to read from the controlling terminal, and the normal action of stopping the process by sending it a SIGTTIN signal isn't working. This might happen if signal is being blocked or ignored, or because the process group is orphaned. See section Job Control, for more information about job control, and section Signal Handling, for information about signals.*",
    "created_at": "2012-11-14T04:05:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157709",
    "user": "https://github.com/vbraun"
}
```

The glibc manual says: *EIO also occurs when a background process tries to read from the controlling terminal, and the normal action of stopping the process by sending it a SIGTTIN signal isn't working. This might happen if signal is being blocked or ignored, or because the process group is orphaned. See section Job Control, for more information about job control, and section Signal Handling, for information about signals.*



---

archive/issue_comments_157710.json:
```json
{
    "body": "I don't want to annoy Jeroen yet again, but I really think we are done with this ticket. If on an old system (Ubuntu 8.04 LTS will reach its EOL in the coming April) under some very unusual circumstances it doesn't quite work as expected, it should not  hold the ticket up.",
    "created_at": "2012-11-14T05:30:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157710",
    "user": "https://github.com/dimpase"
}
```

I don't want to annoy Jeroen yet again, but I really think we are done with this ticket. If on an old system (Ubuntu 8.04 LTS will reach its EOL in the coming April) under some very unusual circumstances it doesn't quite work as expected, it should not  hold the ticket up.



---

archive/issue_comments_157711.json:
```json
{
    "body": "Replying to [comment:157 dimpase]:\n> I don't want to annoy Jeroen yet again, but I really think we are done with this ticket. If on an old system (Ubuntu 8.04 LTS will reach its EOL in the coming April) under some very unusual circumstances it doesn't quite work as expected, it should not  hold the ticket up. \n\nIf that old system happens to be the one on which Sage releases are made, it obviously holds up the ticket.",
    "created_at": "2012-11-14T08:13:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157711",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:157 dimpase]:
> I don't want to annoy Jeroen yet again, but I really think we are done with this ticket. If on an old system (Ubuntu 8.04 LTS will reach its EOL in the coming April) under some very unusual circumstances it doesn't quite work as expected, it should not  hold the ticket up. 

If that old system happens to be the one on which Sage releases are made, it obviously holds up the ticket.



---

archive/issue_comments_157712.json:
```json
{
    "body": "Attachment [gap.19589](tarball://root/attachments/some-uuid/ticket13211/gap.19589) by @jdemeyer created at 2012-11-14 13:50:01\n\nFirst 1500 lines of an infinite strace",
    "created_at": "2012-11-14T13:50:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157712",
    "user": "https://github.com/jdemeyer"
}
```

Attachment [gap.19589](tarball://root/attachments/some-uuid/ticket13211/gap.19589) by @jdemeyer created at 2012-11-14 13:50:01

First 1500 lines of an infinite strace



---

archive/issue_comments_157713.json:
```json
{
    "body": "I doubt that `/tmp` has anything to do with it. The filedescriptor giving EIO is a deleted pseudo-terminal, not a temporary file. This can be seen from `/proc/$PID/fd`:\n\n```\njdemeyer@sage:/tmp/gaptrace$ ls -l /proc/19589/fd\ntotal 0\nlrwx------ 1 jdemeyer jdemeyer 64 Nov 14 11:49 0 -> /dev/pts/71 (deleted)\nlrwx------ 1 jdemeyer jdemeyer 64 Nov 14 11:49 1 -> /dev/pts/71 (deleted)\nlrwx------ 1 jdemeyer jdemeyer 64 Nov 14 11:49 2 -> /dev/pts/71 (deleted)\n```\n\n\nI don't think it's a relevant discussion why we sometimes get Segmentation Faults and sometimes not.",
    "created_at": "2012-11-14T13:55:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157713",
    "user": "https://github.com/jdemeyer"
}
```

I doubt that `/tmp` has anything to do with it. The filedescriptor giving EIO is a deleted pseudo-terminal, not a temporary file. This can be seen from `/proc/$PID/fd`:

```
jdemeyer@sage:/tmp/gaptrace$ ls -l /proc/19589/fd
total 0
lrwx------ 1 jdemeyer jdemeyer 64 Nov 14 11:49 0 -> /dev/pts/71 (deleted)
lrwx------ 1 jdemeyer jdemeyer 64 Nov 14 11:49 1 -> /dev/pts/71 (deleted)
lrwx------ 1 jdemeyer jdemeyer 64 Nov 14 11:49 2 -> /dev/pts/71 (deleted)
```


I don't think it's a relevant discussion why we sometimes get Segmentation Faults and sometimes not.



---

archive/issue_comments_157714.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-11-14T13:55:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157714",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_157715.json:
```json
{
    "body": "Replying to [comment:154 vbraun]:\n> When sage quits the other end of the pipe should be closed, resulting in EPIPE.\nA pseudo-terminal is not a pipe.",
    "created_at": "2012-11-14T13:56:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157715",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:154 vbraun]:
> When sage quits the other end of the pipe should be closed, resulting in EPIPE.
A pseudo-terminal is not a pipe.



---

archive/issue_comments_157716.json:
```json
{
    "body": "Replying to [comment:159 jdemeyer]:\n> I doubt that `/tmp` has anything to do with it. \nSomewhere near the end of  `sage/ext/gap/sage.g`\nthere is a commented out line `LogTo(\"/tmp/gapsage.log\");`\nCould you uncomment it and try to reproduce such a hanging GAP process, with this log on?\n\nAs well, perhaps add some debugging prints into each of the GAP functions in the file.\nSomething like `AppendTo(\"/tmp/sageg\",\"OperationsAdmittingFirstArgument\\n\");`\nwhere `OperationsAdmittingFirstArgument` is the function name, and \"tmp/sageg\" the name of the log file...\n\nMy guess that the problem is in `$SAGE.NewPager()`, which tries to get `$SAGE.tempfile` and fails, either during this interaction, or upon attempting to open it.",
    "created_at": "2012-11-14T15:02:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157716",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:159 jdemeyer]:
> I doubt that `/tmp` has anything to do with it. 
Somewhere near the end of  `sage/ext/gap/sage.g`
there is a commented out line `LogTo("/tmp/gapsage.log");`
Could you uncomment it and try to reproduce such a hanging GAP process, with this log on?

As well, perhaps add some debugging prints into each of the GAP functions in the file.
Something like `AppendTo("/tmp/sageg","OperationsAdmittingFirstArgument\n");`
where `OperationsAdmittingFirstArgument` is the function name, and "tmp/sageg" the name of the log file...

My guess that the problem is in `$SAGE.NewPager()`, which tries to get `$SAGE.tempfile` and fails, either during this interaction, or upon attempting to open it.



---

archive/issue_comments_157717.json:
```json
{
    "body": "I am seriously debugging GAP now to check for the problem.",
    "created_at": "2012-11-14T15:06:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157717",
    "user": "https://github.com/jdemeyer"
}
```

I am seriously debugging GAP now to check for the problem.



---

archive/issue_comments_157718.json:
```json
{
    "body": "I'm pretty sure I found the bug. The culprit is the following from `src/sysfiles.c`:\n\n\n```\n/* utility to check return value of 'write'  */\nssize_t writeandcheck(int fd, const char *buf, size_t count) {\n  int ret;\n  ret = write(fd, buf, count);\n  if (ret < 0)\n  {\n    ErrorQuit(\"Cannot write to file descriptor %d, see 'LastSystemError();'\\n\",\n               fd, 0L);\n  }\nreturn ret;\n}\n```\n\n\nIf the pseudo-tty is closed, then `write()` fails with EIO, causing GAP to write an error message. We then get an infinite loop of failing to write the error message.",
    "created_at": "2012-11-14T16:03:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157718",
    "user": "https://github.com/jdemeyer"
}
```

I'm pretty sure I found the bug. The culprit is the following from `src/sysfiles.c`:


```
/* utility to check return value of 'write'  */
ssize_t writeandcheck(int fd, const char *buf, size_t count) {
  int ret;
  ret = write(fd, buf, count);
  if (ret < 0)
  {
    ErrorQuit("Cannot write to file descriptor %d, see 'LastSystemError();'\n",
               fd, 0L);
  }
return ret;
}
```


If the pseudo-tty is closed, then `write()` fails with EIO, causing GAP to write an error message. We then get an infinite loop of failing to write the error message.



---

archive/issue_comments_157719.json:
```json
{
    "body": "Replying to [comment:163 jdemeyer]:\n\nIt seems that `ErrorQuit` could just write to `stderr` in this case. Although in general it's not clear to me how to deal with it, for such a plug perhaps could break the ability of the interpreter to recover from errors.\nIs it actually possible to reliably check that the pty is closed?",
    "created_at": "2012-11-14T16:37:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157719",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:163 jdemeyer]:

It seems that `ErrorQuit` could just write to `stderr` in this case. Although in general it's not clear to me how to deal with it, for such a plug perhaps could break the ability of the interpreter to recover from errors.
Is it actually possible to reliably check that the pty is closed?



---

archive/issue_comments_157720.json:
```json
{
    "body": "Now that I know what the problem is, reproducing the Segmentation Fault is trivial. Within a Sage shell:\n\n```\n(sage-sh) jdemeyer@sage:sage-5.5.beta2$ gap &>/dev/full\nSegmentation fault\n```\n",
    "created_at": "2012-11-14T19:03:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157720",
    "user": "https://github.com/jdemeyer"
}
```

Now that I know what the problem is, reproducing the Segmentation Fault is trivial. Within a Sage shell:

```
(sage-sh) jdemeyer@sage:sage-5.5.beta2$ gap &>/dev/full
Segmentation fault
```




---

archive/issue_comments_157721.json:
```json
{
    "body": "You'd still get a EPIPE if the process wasn't orphaned. Also, the problem is that GAP is **not** segfaulting in some circumstances when it is orphaned. If it would segfault you wouldn't get an orphan.\n\nThe underlying problem is that the expect interfaces don't always clean up processes before quitting Sage, hence leading to orphaned processes to start with. Only after the process is orphaned you get EIO's.",
    "created_at": "2012-11-14T19:25:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157721",
    "user": "https://github.com/vbraun"
}
```

You'd still get a EPIPE if the process wasn't orphaned. Also, the problem is that GAP is **not** segfaulting in some circumstances when it is orphaned. If it would segfault you wouldn't get an orphan.

The underlying problem is that the expect interfaces don't always clean up processes before quitting Sage, hence leading to orphaned processes to start with. Only after the process is orphaned you get EIO's.



---

archive/issue_comments_157722.json:
```json
{
    "body": "Replying to [comment:166 vbraun]:\n> You'd still get a EPIPE if the process wasn't orphaned.\nI doubt that pseudo-terminals can cause an EPIPE (at least in Linux).  Even if they would, you should also get a SIGPIPE signal, killing the process.\n\n> Also, the problem is that GAP is **not** segfaulting in some circumstances when it is orphaned.\nI would not say that this is the problem. There is a bug in GAP which may or may not lead to a segfault. Relying that it will cause a segfault is silly.\n\n> The underlying problem is that the expect interfaces don't always clean up processes before quitting Sage, hence leading to orphaned processes to start with. Only after the process is orphaned you get EIO's.\nTrue. So either we fix GAP or we fix the Sage interface, and preferably both.",
    "created_at": "2012-11-14T19:40:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157722",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:166 vbraun]:
> You'd still get a EPIPE if the process wasn't orphaned.
I doubt that pseudo-terminals can cause an EPIPE (at least in Linux).  Even if they would, you should also get a SIGPIPE signal, killing the process.

> Also, the problem is that GAP is **not** segfaulting in some circumstances when it is orphaned.
I would not say that this is the problem. There is a bug in GAP which may or may not lead to a segfault. Relying that it will cause a segfault is silly.

> The underlying problem is that the expect interfaces don't always clean up processes before quitting Sage, hence leading to orphaned processes to start with. Only after the process is orphaned you get EIO's.
True. So either we fix GAP or we fix the Sage interface, and preferably both.



---

archive/issue_comments_157723.json:
```json
{
    "body": "maxima getting EIO & segfault too",
    "created_at": "2012-11-14T20:34:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157723",
    "user": "https://github.com/vbraun"
}
```

maxima getting EIO & segfault too



---

archive/issue_comments_157724.json:
```json
{
    "body": "Attachment [sage-test-maxima-EIO.strace](tarball://root/attachments/some-uuid/ticket13211/sage-test-maxima-EIO.strace) by @vbraun created at 2012-11-14 20:36:44\n\nJust for the record, other programs Segfault after running into EIO for a while as well. I dare say that most interactive binaries are not meant to be run as orphans. I don't see much point in making sure that the GAP command line interface can be run without controlling terminal.",
    "created_at": "2012-11-14T20:36:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157724",
    "user": "https://github.com/vbraun"
}
```

Attachment [sage-test-maxima-EIO.strace](tarball://root/attachments/some-uuid/ticket13211/sage-test-maxima-EIO.strace) by @vbraun created at 2012-11-14 20:36:44

Just for the record, other programs Segfault after running into EIO for a while as well. I dare say that most interactive binaries are not meant to be run as orphans. I don't see much point in making sure that the GAP command line interface can be run without controlling terminal.



---

archive/issue_comments_157725.json:
```json
{
    "body": "Replying to [comment:168 vbraun]:\n> Just for the record, other programs Segfault after running into EIO for a while as well.\nIndeed, it seems ECL has exactly the same bug. But that doesn't mean the GAP bug (or the Sage bug controlling GAP if you want) shouldn't be fixed.\n\nAnd the problem isn't limited to terminals: as I showed, it can also occur for example when writing to a filesystem which is full.",
    "created_at": "2012-11-14T20:51:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157725",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:168 vbraun]:
> Just for the record, other programs Segfault after running into EIO for a while as well.
Indeed, it seems ECL has exactly the same bug. But that doesn't mean the GAP bug (or the Sage bug controlling GAP if you want) shouldn't be fixed.

And the problem isn't limited to terminals: as I showed, it can also occur for example when writing to a filesystem which is full.



---

archive/issue_comments_157726.json:
```json
{
    "body": "Replying to [comment:165 jdemeyer]:\n> Now that I know what the problem is, reproducing the Segmentation Fault is trivial. Within a Sage shell:\n> {{{\n> (sage-sh) jdemeyer`@`sage:sage-5.5.beta2$ gap &>/dev/full\n> Segmentation fault\n> }}}\nThis is not the complete story. First off, you need to run with -T, which is meant to suppress the usual interactive behavour, and this is the option using which the orphans in question arise. In fact, it is because `stderr` is full, not because `stdout` is full.\n\n```\n(sage-sh) dima@sage$ gap -T >/dev/full\nError, Cannot write to file descriptor 1, see 'LastSystemError();'\n\nError, Cannot write to file descriptor 1, see 'LastSystemError();'\n\nError, Cannot write to file descriptor 1, see 'LastSystemError();'\n\nError, Cannot write to file descriptor 1, see 'LastSystemError();'\n\nError, Cannot write to file descriptor 1, see 'LastSystemError();'\n\nSyntax error: ; expected\n^\nError, Cannot write to file descriptor 1, see 'LastSystemError();'\n\n(sage-sh) dima@sage$\n```\n\nThus if the `stderr` is OK, it sort of works (the `Syntax error;` is quite weird though, and might be an indication of a \"more real\" bug).\nBy the way, `gap-4.4` just hangs in this situation.\n\nAs we talk about the situation with -T on, we can patch, say, `ErrorQuit` for this case to print to `stderr` and quit immediately. This will not fix this completely, but at least it will make sure that with -T option the behaviour is as it should be.\n\nAn alternative is to change Sage so that GAPs `stderr` does not get redirected. I don't know how well this will work, though.",
    "created_at": "2012-11-15T07:51:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157726",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:165 jdemeyer]:
> Now that I know what the problem is, reproducing the Segmentation Fault is trivial. Within a Sage shell:
> {{{
> (sage-sh) jdemeyer`@`sage:sage-5.5.beta2$ gap &>/dev/full
> Segmentation fault
> }}}
This is not the complete story. First off, you need to run with -T, which is meant to suppress the usual interactive behavour, and this is the option using which the orphans in question arise. In fact, it is because `stderr` is full, not because `stdout` is full.

```
(sage-sh) dima@sage$ gap -T >/dev/full
Error, Cannot write to file descriptor 1, see 'LastSystemError();'

Error, Cannot write to file descriptor 1, see 'LastSystemError();'

Error, Cannot write to file descriptor 1, see 'LastSystemError();'

Error, Cannot write to file descriptor 1, see 'LastSystemError();'

Error, Cannot write to file descriptor 1, see 'LastSystemError();'

Syntax error: ; expected
^
Error, Cannot write to file descriptor 1, see 'LastSystemError();'

(sage-sh) dima@sage$
```

Thus if the `stderr` is OK, it sort of works (the `Syntax error;` is quite weird though, and might be an indication of a "more real" bug).
By the way, `gap-4.4` just hangs in this situation.

As we talk about the situation with -T on, we can patch, say, `ErrorQuit` for this case to print to `stderr` and quit immediately. This will not fix this completely, but at least it will make sure that with -T option the behaviour is as it should be.

An alternative is to change Sage so that GAPs `stderr` does not get redirected. I don't know how well this will work, though.



---

archive/issue_comments_157727.json:
```json
{
    "body": "I've created an issue on GAP bugtracker in regard to the comment 165: \nhttp://tracker.gap-system.org/issues/125",
    "created_at": "2012-11-15T08:59:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157727",
    "user": "https://github.com/dimpase"
}
```

I've created an issue on GAP bugtracker in regard to the comment 165: 
http://tracker.gap-system.org/issues/125



---

archive/issue_comments_157728.json:
```json
{
    "body": "Replying to [comment:171 dimpase]:\n> I've created an issue on GAP bugtracker in regard to the comment 165: \n> http://tracker.gap-system.org/issues/125\n\nToo bad one cannot even look at the tracker issue without logging in. I registered for an account, but it needs to be approved by a moderator. Let me know if anything interesting comes up from upstream.",
    "created_at": "2012-11-15T09:11:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157728",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:171 dimpase]:
> I've created an issue on GAP bugtracker in regard to the comment 165: 
> http://tracker.gap-system.org/issues/125

Too bad one cannot even look at the tracker issue without logging in. I registered for an account, but it needs to be approved by a moderator. Let me know if anything interesting comes up from upstream.



---

archive/issue_comments_157729.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-11-15T09:45:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157729",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_157730.json:
```json
{
    "body": "New spkg with patch added: [http://boxen.math.washington.edu/home/jdemeyer/spkg/gap-4.5.6.p0.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/gap-4.5.6.p0.spkg)\n\nPatch attached.",
    "created_at": "2012-11-15T09:45:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157730",
    "user": "https://github.com/jdemeyer"
}
```

New spkg with patch added: [http://boxen.math.washington.edu/home/jdemeyer/spkg/gap-4.5.6.p0.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/gap-4.5.6.p0.spkg)

Patch attached.



---

archive/issue_comments_157731.json:
```json
{
    "body": "Attachment [writeandcheck.patch](tarball://root/attachments/some-uuid/ticket13211/writeandcheck.patch) by @jdemeyer created at 2012-11-15 09:45:59\n\nPatch added to GAP in gap-4.5.6.p0",
    "created_at": "2012-11-15T09:45:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157731",
    "user": "https://github.com/jdemeyer"
}
```

Attachment [writeandcheck.patch](tarball://root/attachments/some-uuid/ticket13211/writeandcheck.patch) by @jdemeyer created at 2012-11-15 09:45:59

Patch added to GAP in gap-4.5.6.p0



---

archive/issue_comments_157732.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-11-15T12:38:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157732",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_157733.json:
```json
{
    "body": "Replying to [comment:173 jdemeyer]:\n> New spkg with patch added: [http://boxen.math.washington.edu/home/jdemeyer/spkg/gap-4.5.6.p0.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/gap-4.5.6.p0.spkg)\n> \n> Patch attached.\nThe patch makes `gap &>/dev/full` hang. (Well, this is consistent with GAP 4.4 behaviour). At least this is good enough, I suppose, to fix the orphans issue. I mark this as positive review, with understanding that orphans, which I can't reproduce anyway, are no longer there. I hope GAP people will fix this good and proper.",
    "created_at": "2012-11-15T12:38:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157733",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:173 jdemeyer]:
> New spkg with patch added: [http://boxen.math.washington.edu/home/jdemeyer/spkg/gap-4.5.6.p0.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/gap-4.5.6.p0.spkg)
> 
> Patch attached.
The patch makes `gap &>/dev/full` hang. (Well, this is consistent with GAP 4.4 behaviour). At least this is good enough, I suppose, to fix the orphans issue. I mark this as positive review, with understanding that orphans, which I can't reproduce anyway, are no longer there. I hope GAP people will fix this good and proper.



---

archive/issue_comments_157734.json:
```json
{
    "body": "Replying to [comment:174 dimpase]:\n> The patch makes `gap &>/dev/full` hang.\nOf course it \"hangs\", since it's waiting for user input. It's still an interactive GAP session, you can hit CTRL-D to exit.",
    "created_at": "2012-11-15T13:05:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157734",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:174 dimpase]:
> The patch makes `gap &>/dev/full` hang.
Of course it "hangs", since it's waiting for user input. It's still an interactive GAP session, you can hit CTRL-D to exit.



---

archive/issue_comments_157735.json:
```json
{
    "body": "Replying to [comment:175 jdemeyer]:\n> Replying to [comment:174 dimpase]:\n> > The patch makes `gap &>/dev/full` hang.\n> Of course it \"hangs\", since it's waiting for user input. It's still an interactive GAP session, you can hit CTRL-D to exit.\n Oh, right. I tried CTRL-C, in vain :-)",
    "created_at": "2012-11-15T14:20:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157735",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:175 jdemeyer]:
> Replying to [comment:174 dimpase]:
> > The patch makes `gap &>/dev/full` hang.
> Of course it "hangs", since it's waiting for user input. It's still an interactive GAP session, you can hit CTRL-D to exit.
 Oh, right. I tried CTRL-C, in vain :-)



---

archive/issue_comments_157736.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2012-11-16T12:23:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157736",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_157737.json:
```json
{
    "body": "There is something wrong with the pool size patch. On the buildbot machine \"snapperkob\" (Ubuntu 12.04 x86_64), gap is started with \"-o 53m\" which is too few. It gives\n\n```\nRuntimeError: Gap produced error output\nError, exceeded the permitted memory (`-o' command line option)\n\n   executing SaveWorkspace(\"/tmp/dotsageyds6nf/gap/workspace-8407479053605879120\");\n```\n\n\nBut there is plenty of memory available:\n\n```\n$ cat /proc/meminfo\nMemTotal:        8012124 kB\nMemFree:         2736044 kB\nBuffers:          125968 kB\nCached:          4721000 kB\nSwapCached:            0 kB\nActive:          2978056 kB\nInactive:        1930440 kB\nActive(anon):      61564 kB\nInactive(anon):     3648 kB\nActive(file):    2916492 kB\nInactive(file):  1926792 kB\nUnevictable:           0 kB\nMlocked:               0 kB\nSwapTotal:        524284 kB\nSwapFree:         524284 kB\nDirty:                20 kB\nWriteback:             0 kB\nAnonPages:         61552 kB\nMapped:            14396 kB\nShmem:              3688 kB\nSlab:             261404 kB\nSReclaimable:     243728 kB\nSUnreclaim:        17676 kB\nKernelStack:        1280 kB\nPageTables:         3568 kB\nNFS_Unstable:          0 kB\nBounce:                0 kB\nWritebackTmp:          0 kB\nCommitLimit:     4530344 kB\nCommitted_AS:     160128 kB\nVmallocTotal:   34359738367 kB\nVmallocUsed:      561128 kB\nVmallocChunk:   34359173628 kB\nHardwareCorrupted:     0 kB\nAnonHugePages:         0 kB\nHugePages_Total:       0\nHugePages_Free:        0\nHugePages_Rsvd:        0\nHugePages_Surp:        0\nHugepagesize:       2048 kB\nDirectMap4k:       47100 kB\nDirectMap2M:     8173568 kB\n```\n",
    "created_at": "2012-11-16T12:23:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157737",
    "user": "https://github.com/jdemeyer"
}
```

There is something wrong with the pool size patch. On the buildbot machine "snapperkob" (Ubuntu 12.04 x86_64), gap is started with "-o 53m" which is too few. It gives

```
RuntimeError: Gap produced error output
Error, exceeded the permitted memory (`-o' command line option)

   executing SaveWorkspace("/tmp/dotsageyds6nf/gap/workspace-8407479053605879120");
```


But there is plenty of memory available:

```
$ cat /proc/meminfo
MemTotal:        8012124 kB
MemFree:         2736044 kB
Buffers:          125968 kB
Cached:          4721000 kB
SwapCached:            0 kB
Active:          2978056 kB
Inactive:        1930440 kB
Active(anon):      61564 kB
Inactive(anon):     3648 kB
Active(file):    2916492 kB
Inactive(file):  1926792 kB
Unevictable:           0 kB
Mlocked:               0 kB
SwapTotal:        524284 kB
SwapFree:         524284 kB
Dirty:                20 kB
Writeback:             0 kB
AnonPages:         61552 kB
Mapped:            14396 kB
Shmem:              3688 kB
Slab:             261404 kB
SReclaimable:     243728 kB
SUnreclaim:        17676 kB
KernelStack:        1280 kB
PageTables:         3568 kB
NFS_Unstable:          0 kB
Bounce:                0 kB
WritebackTmp:          0 kB
CommitLimit:     4530344 kB
Committed_AS:     160128 kB
VmallocTotal:   34359738367 kB
VmallocUsed:      561128 kB
VmallocChunk:   34359173628 kB
HardwareCorrupted:     0 kB
AnonHugePages:         0 kB
HugePages_Total:       0
HugePages_Free:        0
HugePages_Rsvd:        0
HugePages_Surp:        0
Hugepagesize:       2048 kB
DirectMap4k:       47100 kB
DirectMap2M:     8173568 kB
```




---

archive/issue_comments_157738.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2012-11-16T12:31:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157738",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_157739.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2012-11-16T12:55:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157739",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_157740.json:
```json
{
    "body": "Replying to [comment:177 jdemeyer]:\n> There is something wrong with the pool size patch. On the buildbot machine \"snapperkob\" (Ubuntu 12.04 x86_64), gap is started with \"-o 53m\" which is too few. \nI'll try to reproduce this on `sage.combinat`. This is the only Ubuntu 12.04 x86_64 I presently have access to.",
    "created_at": "2012-11-16T13:22:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157740",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:177 jdemeyer]:
> There is something wrong with the pool size patch. On the buildbot machine "snapperkob" (Ubuntu 12.04 x86_64), gap is started with "-o 53m" which is too few. 
I'll try to reproduce this on `sage.combinat`. This is the only Ubuntu 12.04 x86_64 I presently have access to.



---

archive/issue_comments_157741.json:
```json
{
    "body": "The machine has only 512MB of swap? The pool defaults to 1/10th of the total swap.",
    "created_at": "2012-11-16T14:22:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157741",
    "user": "https://github.com/vbraun"
}
```

The machine has only 512MB of swap? The pool defaults to 1/10th of the total swap.



---

archive/issue_comments_157742.json:
```json
{
    "body": "I've changed the pool size computation to default to at least 75MB.",
    "created_at": "2012-11-16T14:30:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157742",
    "user": "https://github.com/vbraun"
}
```

I've changed the pool size computation to default to at least 75MB.



---

archive/issue_comments_157743.json:
```json
{
    "body": "Replying to [comment:183 vbraun]:\n> I've changed the pool size computation to default to at least 75MB.\nyes, I was just reading your patch. It's my fault that I missed this potential problem before (I am aware of a \"modern\" school that teaches that swap is dead, as there is so much RAM nowadays...).\n\nLet me test it now.",
    "created_at": "2012-11-16T14:37:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157743",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:183 vbraun]:
> I've changed the pool size computation to default to at least 75MB.
yes, I was just reading your patch. It's my fault that I missed this potential problem before (I am aware of a "modern" school that teaches that swap is dead, as there is so much RAM nowadays...).

Let me test it now.



---

archive/issue_comments_157744.json:
```json
{
    "body": "Replying to [comment:183 vbraun]:\n> I've changed the pool size computation to default to at least 75MB.\nno, you have set it to `75*1024**3`, which is 75**GB**!\nYou should do `75*1024**2` instead.",
    "created_at": "2012-11-16T15:11:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157744",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:183 vbraun]:
> I've changed the pool size computation to default to at least 75MB.
no, you have set it to `75*1024**3`, which is 75**GB**!
You should do `75*1024**2` instead.



---

archive/issue_comments_157745.json:
```json
{
    "body": "Replying to [comment:185 dimpase]:\n> Replying to [comment:183 vbraun]:\n> > I've changed the pool size computation to default to at least 75MB.\n> no, you have set it to `75*1024**3`, which is 75**GB**!\n> You should do `75*1024**2` instead.\n\nI also think that \n\n```\n   suggested_size = max(int(mem.available_swap() / 10),  \n \t\t                         int(mem.available_ram()  / 50),   # in case you run without swap \n \t\t                         75 * 1024**2 )      # about 75MB is the minimum to run GAP \n```\n\nis way too much for machines with a lot of RAM. E.g. I tried this on sage.combinat and got 3.6GB as the `suggested_size`.\nI'd rather propose\n\n```\n   suggested_size = min(150 * 1024**2, \n                               max(int(mem.available_swap() / 10),  \n \t\t               int(mem.available_ram()  / 50),   # in case you run without swap \n \t\t               75 * 1024**2 ))      # about 75MB is the minimum to run GAP \n```\n \nfor 150MB is certainly good enough, but would not lead to problems if you have a hundred instances of Sage running on the same machine.",
    "created_at": "2012-11-16T15:44:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157745",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:185 dimpase]:
> Replying to [comment:183 vbraun]:
> > I've changed the pool size computation to default to at least 75MB.
> no, you have set it to `75*1024**3`, which is 75**GB**!
> You should do `75*1024**2` instead.

I also think that 

```
   suggested_size = max(int(mem.available_swap() / 10),  
 		                         int(mem.available_ram()  / 50),   # in case you run without swap 
 		                         75 * 1024**2 )      # about 75MB is the minimum to run GAP 
```

is way too much for machines with a lot of RAM. E.g. I tried this on sage.combinat and got 3.6GB as the `suggested_size`.
I'd rather propose

```
   suggested_size = min(150 * 1024**2, 
                               max(int(mem.available_swap() / 10),  
 		               int(mem.available_ram()  / 50),   # in case you run without swap 
 		               75 * 1024**2 ))      # about 75MB is the minimum to run GAP 
```
 
for 150MB is certainly good enough, but would not lead to problems if you have a hundred instances of Sage running on the same machine.



---

archive/issue_comments_157746.json:
```json
{
    "body": "On 32-bit systems:\n\n```\nsage -t  --long -force_lib devel/sage/sage/misc/memory_info.py\n**********************************************************************\nFile \"/var/lib/buildbot/build/sage/arando-1/arando_full/build/sage-5.5.beta2/devel/sage-main/sage/misc/memory_info.py\", line 350:\n    sage: mem.total_ram()\nExpected:\n    4294967296\nGot:\n    4294967296L\n**********************************************************************\n```\n",
    "created_at": "2012-11-16T19:09:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157746",
    "user": "https://github.com/jdemeyer"
}
```

On 32-bit systems:

```
sage -t  --long -force_lib devel/sage/sage/misc/memory_info.py
**********************************************************************
File "/var/lib/buildbot/build/sage/arando-1/arando_full/build/sage-5.5.beta2/devel/sage-main/sage/misc/memory_info.py", line 350:
    sage: mem.total_ram()
Expected:
    4294967296
Got:
    4294967296L
**********************************************************************
```




---

archive/issue_comments_157747.json:
```json
{
    "body": "Would it make sense, in `spkg-install`, to either remove the old GAP installation or (probably better) to move it to `local/gap/gap-4.4.12`?",
    "created_at": "2012-11-17T00:55:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157747",
    "user": "https://github.com/jhpalmieri"
}
```

Would it make sense, in `spkg-install`, to either remove the old GAP installation or (probably better) to move it to `local/gap/gap-4.4.12`?



---

archive/issue_comments_157748.json:
```json
{
    "body": "Thanks, fixed the MB... its been a long time that I've seen computations not finish because of `O(1024^2)` bytes of storage missing ;-)\n\nI've also added the appropriate `# 64-bit` vs `# 32-bit` to the offending doctest.\n\nThe pool size is **NOT** allocated ram, it is an anonymous mmap and will only be used if necessary. 150MB is definitely not enough for serious computations. If you want hundreds of Sage instances then thats fine, you just need enough swap. Or, if you prefer, you can set up your desktop without swap. Then the pool will be backed by actual RAM, but you hopefully were aware of that when you decided not to have a swap partition.\n\nFinally, I don't see any benefit in moving/deleting the previous GAP install. We'll just run into unintended consequences.",
    "created_at": "2012-11-17T05:38:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157748",
    "user": "https://github.com/vbraun"
}
```

Thanks, fixed the MB... its been a long time that I've seen computations not finish because of `O(1024^2)` bytes of storage missing ;-)

I've also added the appropriate `# 64-bit` vs `# 32-bit` to the offending doctest.

The pool size is **NOT** allocated ram, it is an anonymous mmap and will only be used if necessary. 150MB is definitely not enough for serious computations. If you want hundreds of Sage instances then thats fine, you just need enough swap. Or, if you prefer, you can set up your desktop without swap. Then the pool will be backed by actual RAM, but you hopefully were aware of that when you decided not to have a swap partition.

Finally, I don't see any benefit in moving/deleting the previous GAP install. We'll just run into unintended consequences.



---

archive/issue_comments_157749.json:
```json
{
    "body": "Replying to [comment:189 vbraun]:\n\n> The pool size is **NOT** allocated ram, it is an anonymous mmap and will only be used if necessary. 150MB is definitely not enough for serious computations. If you want hundreds of Sage instances then thats fine, you just need enough swap. \n\nWhy do we need to set '-o' at all? GAP can perfectly start with only '-m' (i.e. the initial amount of memory) set only.\n'-o' is meant to set the maximal amount of RAM to be available, at least according to GAPs [docs](http://www.gap-system.org/Manuals/doc/ref/chap3.html).",
    "created_at": "2012-11-17T06:37:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157749",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:189 vbraun]:

> The pool size is **NOT** allocated ram, it is an anonymous mmap and will only be used if necessary. 150MB is definitely not enough for serious computations. If you want hundreds of Sage instances then thats fine, you just need enough swap. 

Why do we need to set '-o' at all? GAP can perfectly start with only '-m' (i.e. the initial amount of memory) set only.
'-o' is meant to set the maximal amount of RAM to be available, at least according to GAPs [docs](http://www.gap-system.org/Manuals/doc/ref/chap3.html).



---

archive/issue_comments_157750.json:
```json
{
    "body": "If you don't specify '-o' then gap will just chose a pool size for you. The virtual memory pool address space can't be changed after GAP has started. The actual memory used can expand and contract. Of course the actual memory used is bounded by the pool size.",
    "created_at": "2012-11-17T13:37:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157750",
    "user": "https://github.com/vbraun"
}
```

If you don't specify '-o' then gap will just chose a pool size for you. The virtual memory pool address space can't be changed after GAP has started. The actual memory used can expand and contract. Of course the actual memory used is bounded by the pool size.



---

archive/issue_comments_157751.json:
```json
{
    "body": "Replying to [comment:191 vbraun]:\n> If you don't specify '-o' then gap will just chose a pool size for you. The virtual memory pool address space can't be changed after GAP has started. The actual memory used can expand and contract. Of course the actual memory used is bounded by the pool size.\n\nOK. Still, what about limiting the suggested_size to something (say, 500MB) - I agree that 150MB I suggested above is on a low side. \n\nAnyway, we should put somewhere in the documentation a remark that by default such-and-such max amount is allocated, but if you need more, then do `set_gap_memory_pool_size()` before doing any GAP stuff. \n\nBy the way, can one terminate, from Sage, all the running GAP subprocesses?",
    "created_at": "2012-11-17T13:59:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157751",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:191 vbraun]:
> If you don't specify '-o' then gap will just chose a pool size for you. The virtual memory pool address space can't be changed after GAP has started. The actual memory used can expand and contract. Of course the actual memory used is bounded by the pool size.

OK. Still, what about limiting the suggested_size to something (say, 500MB) - I agree that 150MB I suggested above is on a low side. 

Anyway, we should put somewhere in the documentation a remark that by default such-and-such max amount is allocated, but if you need more, then do `set_gap_memory_pool_size()` before doing any GAP stuff. 

By the way, can one terminate, from Sage, all the running GAP subprocesses?



---

archive/issue_comments_157752.json:
```json
{
    "body": "Replying to [comment:192 dimpase]:\n> OK. Still, what about limiting the suggested_size to something (say, 500MB) - I agree that 150MB I suggested above is on a low side. \n\nI'm against absolute limits, it should be a fraction of the available resources. Otherwise you'll end up on record with \"640kb is enough for everyone\".\n\n> Anyway, we should put somewhere in the documentation a remark that by default such-and-such max amount is allocated, but if you need more, then do `set_gap_memory_pool_size()` before doing any GAP stuff. \n\nIts in the `set_gap_memory_pool_size` docstring already.\n\n> By the way, can one terminate, from Sage, all the running GAP subprocesses?\n\nThe Sage expect interface does not keep a list of started subprocesses, so no. That would be a nice enhancement to the whole expect stuff, but please in another ticket.",
    "created_at": "2012-11-24T14:44:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157752",
    "user": "https://github.com/vbraun"
}
```

Replying to [comment:192 dimpase]:
> OK. Still, what about limiting the suggested_size to something (say, 500MB) - I agree that 150MB I suggested above is on a low side. 

I'm against absolute limits, it should be a fraction of the available resources. Otherwise you'll end up on record with "640kb is enough for everyone".

> Anyway, we should put somewhere in the documentation a remark that by default such-and-such max amount is allocated, but if you need more, then do `set_gap_memory_pool_size()` before doing any GAP stuff. 

Its in the `set_gap_memory_pool_size` docstring already.

> By the way, can one terminate, from Sage, all the running GAP subprocesses?

The Sage expect interface does not keep a list of started subprocesses, so no. That would be a nice enhancement to the whole expect stuff, but please in another ticket.



---

archive/issue_comments_157753.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-11-24T14:44:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157753",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_157754.json:
```json
{
    "body": "Replying to [comment:193 vbraun]:\n> Replying to [comment:192 dimpase]:\n> > OK. Still, what about limiting the suggested_size to something (say, 500MB) - I agree that 150MB I suggested above is on a low side. \n> \n> I'm against absolute limits, it should be a fraction of the available resources. Otherwise you'll end up on record with \"640kb is enough for everyone\".\n\nI propose a limit that can be explicitly overwritten, not something absolute. The reason is that on big machines a fraction of the resource can be too big to be meaningful, and will make sharing the machine very hard, as the first few processes will grab an enormous chunk of swap, and the remaining ones will suffer.\nI propose a limit that one would not even notice on a typical desktop (OK, if you think 500MB is too small, make it 750MB, or 1GB). \nAnd if you come to a super-duper machine to compute something huge then OK, please tell the system explicitly how much memory you might need.\n\nAs a matter of fact, I do not understand why GAP needs to **reserve** any swap at all. Just does not make sense to me. What is so special about GAP here?",
    "created_at": "2012-11-24T15:02:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157754",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:193 vbraun]:
> Replying to [comment:192 dimpase]:
> > OK. Still, what about limiting the suggested_size to something (say, 500MB) - I agree that 150MB I suggested above is on a low side. 
> 
> I'm against absolute limits, it should be a fraction of the available resources. Otherwise you'll end up on record with "640kb is enough for everyone".

I propose a limit that can be explicitly overwritten, not something absolute. The reason is that on big machines a fraction of the resource can be too big to be meaningful, and will make sharing the machine very hard, as the first few processes will grab an enormous chunk of swap, and the remaining ones will suffer.
I propose a limit that one would not even notice on a typical desktop (OK, if you think 500MB is too small, make it 750MB, or 1GB). 
And if you come to a super-duper machine to compute something huge then OK, please tell the system explicitly how much memory you might need.

As a matter of fact, I do not understand why GAP needs to **reserve** any swap at all. Just does not make sense to me. What is so special about GAP here?



---

archive/issue_comments_157755.json:
```json
{
    "body": "By \"absolute\" limit I mean a fixed size (as opposed to relative to available resources). 640kb (or any other fixed amount) is not going to be good enough in the future.\n\nThe current GAP in Sage does soak up all the available swap and I don't see anybody complaining about it. It does make my desktop slow down to a crawl whenever the patchbot hits GAP, though. Maybe this patch is not the ideal solution, but its a vast improvement over what we currently have. \n\nAs for the rest, read the mmap manpage. You either reserve swap or you get SIGSEGV when you run out of memory. And GAP is not written in a way what would handle that signal.",
    "created_at": "2012-11-24T16:12:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157755",
    "user": "https://github.com/vbraun"
}
```

By "absolute" limit I mean a fixed size (as opposed to relative to available resources). 640kb (or any other fixed amount) is not going to be good enough in the future.

The current GAP in Sage does soak up all the available swap and I don't see anybody complaining about it. It does make my desktop slow down to a crawl whenever the patchbot hits GAP, though. Maybe this patch is not the ideal solution, but its a vast improvement over what we currently have. 

As for the rest, read the mmap manpage. You either reserve swap or you get SIGSEGV when you run out of memory. And GAP is not written in a way what would handle that signal.



---

archive/issue_comments_157756.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-11-24T17:54:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157756",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_157757.json:
```json
{
    "body": "FWIW, this report https://groups.google.com/d/msg/sage-release/qxv0lvoSfN4/dSYcy-xOG1AJ mentions orphans with the previous version of GAP as well.",
    "created_at": "2012-11-25T22:03:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157757",
    "user": "https://github.com/vbraun"
}
```

FWIW, this report https://groups.google.com/d/msg/sage-release/qxv0lvoSfN4/dSYcy-xOG1AJ mentions orphans with the previous version of GAP as well.



---

archive/issue_comments_157758.json:
```json
{
    "body": "I had accidentally dropped the workaround for the `gap -o 3*2^31` option parser overflow, its back in the trac_13211_pool_size.patch now.\n\nAlso, seems like the reporter on sage-release didn't get GAP orphans with the old version after all.",
    "created_at": "2012-11-26T19:33:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157758",
    "user": "https://github.com/vbraun"
}
```

I had accidentally dropped the workaround for the `gap -o 3*2^31` option parser overflow, its back in the trac_13211_pool_size.patch now.

Also, seems like the reporter on sage-release didn't get GAP orphans with the old version after all.



---

archive/issue_comments_157759.json:
```json
{
    "body": "The memory size still isn't completely right, as I got this doctest error on snapperkob (Linux Ubuntu 12.04 x86_64, 8GB RAM + 0.5GB swap) and iras (Linux ia64, 4GB RAM + 2GB swap):\n\n```\nsage -t  --long -force_lib devel/sage/sage/groups/matrix_gps/matrix_group_morphism.py\n**********************************************************************\nFile \"/home/buildbot/build/sage/iras-1/iras_full/build/sage-5.6.beta0/devel/sage-main/sage/groups/matrix_gps/matrix_group_morphism.py\", line 229:\n    sage: f = O.hom([r*x*r_ for x in O.gens()])  # long time (19s on sage.math, 2011)\nException raised:\n    Traceback (most recent call last):\n      File \"/home/buildbot/build/sage/iras-1/iras_full/build/sage-5.6.beta0/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/home/buildbot/build/sage/iras-1/iras_full/build/sage-5.6.beta0/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/home/buildbot/build/sage/iras-1/iras_full/build/sage-5.6.beta0/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_7[17]>\", line 1, in <module>\n        f = O.hom([r*x*r_ for x in O.gens()])  # long time (19s on sage.math, 2011)###line 229:\n    sage: f = O.hom([r*x*r_ for x in O.gens()])  # long time (19s on sage.math, 2011)\n      File \"/home/buildbot/build/sage/iras-1/iras_full/build/sage-5.6.beta0/local/lib/python/site-packages/sage/groups/matrix_gps/matrix_group.py\", line 268, in hom\n        return self.Hom(U)(x)\n      File \"/home/buildbot/build/sage/iras-1/iras_full/build/sage-5.6.beta0/local/lib/python/site-packages/sage/groups/matrix_gps/homset.py\", line 114, in __call__\n        im_gens, check=check)\n      File \"/home/buildbot/build/sage/iras-1/iras_full/build/sage-5.6.beta0/local/lib/python/site-packages/sage/groups/matrix_gps/matrix_group_morphism.py\", line 75, in __init__\n        phi0 = gap(self)\n      File \"/home/buildbot/build/sage/iras-1/iras_full/build/sage-5.6.beta0/local/lib/python/site-packages/sage/interfaces/interface.py\", line 197, in __call__\n        return self._coerce_from_special_method(x)\n      File \"/home/buildbot/build/sage/iras-1/iras_full/build/sage-5.6.beta0/local/lib/python/site-packages/sage/interfaces/interface.py\", line 223, in _coerce_from_special_method\n        return (x.__getattribute__(s))(self)\n      File \"sage_object.pyx\", line 463, in sage.structure.sage_object.SageObject._gap_ (sage/structure/sage_object.c:4539)\n      File \"sage_object.pyx\", line 439, in sage.structure.sage_object.SageObject._interface_ (sage/structure/sage_object.c:4139)\n      File \"/home/buildbot/build/sage/iras-1/iras_full/build/sage-5.6.beta0/local/lib/python/site-packages/sage/interfaces/interface.py\", line 195, in __call__\n        return cls(self, x, name=name)\n      File \"/home/buildbot/build/sage/iras-1/iras_full/build/sage-5.6.beta0/local/lib/python/site-packages/sage/interfaces/expect.py\", line 1308, in __init__\n        raise TypeError, x\n    TypeError: Gap terminated unexpectedly while reading in a large line:\n    Gap produced error output\n    Error, exceeded the permitted memory (`-o' command line option)\n\n       executing Read(\"/home/buildbot/.sage/temp/iras/26682/interface/tmp26707\");\n**********************************************************************\n```\n\n\nSince this *never* happened with the old GAP, I consider this a regression which should be fixed.",
    "created_at": "2012-12-18T07:35:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157759",
    "user": "https://github.com/jdemeyer"
}
```

The memory size still isn't completely right, as I got this doctest error on snapperkob (Linux Ubuntu 12.04 x86_64, 8GB RAM + 0.5GB swap) and iras (Linux ia64, 4GB RAM + 2GB swap):

```
sage -t  --long -force_lib devel/sage/sage/groups/matrix_gps/matrix_group_morphism.py
**********************************************************************
File "/home/buildbot/build/sage/iras-1/iras_full/build/sage-5.6.beta0/devel/sage-main/sage/groups/matrix_gps/matrix_group_morphism.py", line 229:
    sage: f = O.hom([r*x*r_ for x in O.gens()])  # long time (19s on sage.math, 2011)
Exception raised:
    Traceback (most recent call last):
      File "/home/buildbot/build/sage/iras-1/iras_full/build/sage-5.6.beta0/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/home/buildbot/build/sage/iras-1/iras_full/build/sage-5.6.beta0/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/home/buildbot/build/sage/iras-1/iras_full/build/sage-5.6.beta0/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_7[17]>", line 1, in <module>
        f = O.hom([r*x*r_ for x in O.gens()])  # long time (19s on sage.math, 2011)###line 229:
    sage: f = O.hom([r*x*r_ for x in O.gens()])  # long time (19s on sage.math, 2011)
      File "/home/buildbot/build/sage/iras-1/iras_full/build/sage-5.6.beta0/local/lib/python/site-packages/sage/groups/matrix_gps/matrix_group.py", line 268, in hom
        return self.Hom(U)(x)
      File "/home/buildbot/build/sage/iras-1/iras_full/build/sage-5.6.beta0/local/lib/python/site-packages/sage/groups/matrix_gps/homset.py", line 114, in __call__
        im_gens, check=check)
      File "/home/buildbot/build/sage/iras-1/iras_full/build/sage-5.6.beta0/local/lib/python/site-packages/sage/groups/matrix_gps/matrix_group_morphism.py", line 75, in __init__
        phi0 = gap(self)
      File "/home/buildbot/build/sage/iras-1/iras_full/build/sage-5.6.beta0/local/lib/python/site-packages/sage/interfaces/interface.py", line 197, in __call__
        return self._coerce_from_special_method(x)
      File "/home/buildbot/build/sage/iras-1/iras_full/build/sage-5.6.beta0/local/lib/python/site-packages/sage/interfaces/interface.py", line 223, in _coerce_from_special_method
        return (x.__getattribute__(s))(self)
      File "sage_object.pyx", line 463, in sage.structure.sage_object.SageObject._gap_ (sage/structure/sage_object.c:4539)
      File "sage_object.pyx", line 439, in sage.structure.sage_object.SageObject._interface_ (sage/structure/sage_object.c:4139)
      File "/home/buildbot/build/sage/iras-1/iras_full/build/sage-5.6.beta0/local/lib/python/site-packages/sage/interfaces/interface.py", line 195, in __call__
        return cls(self, x, name=name)
      File "/home/buildbot/build/sage/iras-1/iras_full/build/sage-5.6.beta0/local/lib/python/site-packages/sage/interfaces/expect.py", line 1308, in __init__
        raise TypeError, x
    TypeError: Gap terminated unexpectedly while reading in a large line:
    Gap produced error output
    Error, exceeded the permitted memory (`-o' command line option)

       executing Read("/home/buildbot/.sage/temp/iras/26682/interface/tmp26707");
**********************************************************************
```


Since this *never* happened with the old GAP, I consider this a regression which should be fixed.



---

archive/issue_comments_157760.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2012-12-18T07:35:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157760",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_157761.json:
```json
{
    "body": "On hawk (OpenSolaris i386), I get this reproducible doctest error:\n\n```\nsage -t  --long -force_lib devel/sage/sage/interfaces/gap.py\ngap: halving pool size.\n**********************************************************************\nFile \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.6.beta0/devel/sage-main/sage/interfaces/gap.py\", line 376:\n    sage: gap('\"finished computation\"'); gap.interrupt(); gap('\"ok\"')\nException raised:\n    Traceback (most recent call last):\n      File \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.6.beta0/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.6.beta0/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.6.beta0/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_6[5]>\", line 1, in <module>\n        gap('\"finished computation\"'); gap.interrupt(); gap('\"ok\"')###line 376:\n    sage: gap('\"finished computation\"'); gap.interrupt(); gap('\"ok\"')\n      File \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.6.beta0/local/lib/python/site-packages/sage/interfaces/gap.py\", line 393, in interrupt\n        E.sendline()\n      File \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.6.beta0/local/lib/python/site-packages/pexpect.py\", line 677, in sendline\n        n = n + self.send (os.linesep)\n      File \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.6.beta0/local/lib/python/site-packages/pexpect.py\", line 669, in send\n        c = os.write(self.child_fd, str)\n    OSError: [Errno 22] Invalid argument\n**********************************************************************\nFile \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.6.beta0/devel/sage-main/sage/interfaces/gap.py\", line 1794:\n    sage: gap_version()\nExpected:\n    doctest:...: DeprecationWarning: use gap.version() instead\n    See http://trac.sagemath.org/13211 for details.\n    '4.5.6'\nGot:\n    doctest:1: DeprecationWarning: use gap.version() instead\n    See http://trac.sagemath.org/13211 for details.\n    ** Gap crashed or quit executing 'VERSION;' **\n    Restarting Gap and trying again\n    '4.5.6'\n**********************************************************************\n```\n\n\nIt seems we're trying to write to a closed filedescriptor.",
    "created_at": "2012-12-18T07:45:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157761",
    "user": "https://github.com/jdemeyer"
}
```

On hawk (OpenSolaris i386), I get this reproducible doctest error:

```
sage -t  --long -force_lib devel/sage/sage/interfaces/gap.py
gap: halving pool size.
**********************************************************************
File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.6.beta0/devel/sage-main/sage/interfaces/gap.py", line 376:
    sage: gap('"finished computation"'); gap.interrupt(); gap('"ok"')
Exception raised:
    Traceback (most recent call last):
      File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.6.beta0/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.6.beta0/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.6.beta0/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_6[5]>", line 1, in <module>
        gap('"finished computation"'); gap.interrupt(); gap('"ok"')###line 376:
    sage: gap('"finished computation"'); gap.interrupt(); gap('"ok"')
      File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.6.beta0/local/lib/python/site-packages/sage/interfaces/gap.py", line 393, in interrupt
        E.sendline()
      File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.6.beta0/local/lib/python/site-packages/pexpect.py", line 677, in sendline
        n = n + self.send (os.linesep)
      File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.6.beta0/local/lib/python/site-packages/pexpect.py", line 669, in send
        c = os.write(self.child_fd, str)
    OSError: [Errno 22] Invalid argument
**********************************************************************
File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.6.beta0/devel/sage-main/sage/interfaces/gap.py", line 1794:
    sage: gap_version()
Expected:
    doctest:...: DeprecationWarning: use gap.version() instead
    See http://trac.sagemath.org/13211 for details.
    '4.5.6'
Got:
    doctest:1: DeprecationWarning: use gap.version() instead
    See http://trac.sagemath.org/13211 for details.
    ** Gap crashed or quit executing 'VERSION;' **
    Restarting Gap and trying again
    '4.5.6'
**********************************************************************
```


It seems we're trying to write to a closed filedescriptor.



---

archive/issue_comments_157762.json:
```json
{
    "body": "Replying to [comment:200 jdemeyer]:\n> The memory size still isn't completely right, as I got this doctest error on snapperkob (Linux Ubuntu 12.04 x86_64, 8GB RAM + 0.5GB swap) and iras (Linux ia64, 4GB RAM + 2GB swap):\n\nThese are cases where the hardcoded minimum for the GAP memory pool is used (since they have insufficient swap space). I'll try to find a minimal value that is sufficient to run the long doctests, not just to start up GAP.",
    "created_at": "2012-12-18T10:15:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157762",
    "user": "https://github.com/vbraun"
}
```

Replying to [comment:200 jdemeyer]:
> The memory size still isn't completely right, as I got this doctest error on snapperkob (Linux Ubuntu 12.04 x86_64, 8GB RAM + 0.5GB swap) and iras (Linux ia64, 4GB RAM + 2GB swap):

These are cases where the hardcoded minimum for the GAP memory pool is used (since they have insufficient swap space). I'll try to find a minimal value that is sufficient to run the long doctests, not just to start up GAP.



---

archive/issue_comments_157763.json:
```json
{
    "body": "Updated patch",
    "created_at": "2012-12-18T10:34:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157763",
    "user": "https://github.com/vbraun"
}
```

Updated patch



---

archive/issue_comments_157764.json:
```json
{
    "body": "Attachment [trac_13211_pool_size.patch](tarball://root/attachments/some-uuid/ticket13211/trac_13211_pool_size.patch) by @vbraun created at 2012-12-18 10:38:09\n\nTurns out we need 76MB for the long doctests, but we hardcoded 75MB. I've increased the minimum to 100MB to give us some headroom for future doctests. I'll see if I can reproduce the OpenSolaris bug on OpenIndiana (if anybody with access to hawk can debug it go for it, but I don't have an account). But that shouldn't stop us from shipping the update.",
    "created_at": "2012-12-18T10:38:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157764",
    "user": "https://github.com/vbraun"
}
```

Attachment [trac_13211_pool_size.patch](tarball://root/attachments/some-uuid/ticket13211/trac_13211_pool_size.patch) by @vbraun created at 2012-12-18 10:38:09

Turns out we need 76MB for the long doctests, but we hardcoded 75MB. I've increased the minimum to 100MB to give us some headroom for future doctests. I'll see if I can reproduce the OpenSolaris bug on OpenIndiana (if anybody with access to hawk can debug it go for it, but I don't have an account). But that shouldn't stop us from shipping the update.



---

archive/issue_comments_157765.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2012-12-18T10:38:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157765",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_157766.json:
```json
{
    "body": "Replying to [comment:203 vbraun]:\n> I'll see if I can reproduce the OpenSolaris bug on OpenIndiana (if anybody with access to hawk can debug it go for it, but I don't have an account). But that shouldn't stop us from shipping the update. \n\nA failure on a supported platform does stop the update...",
    "created_at": "2012-12-19T11:40:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157766",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:203 vbraun]:
> I'll see if I can reproduce the OpenSolaris bug on OpenIndiana (if anybody with access to hawk can debug it go for it, but I don't have an account). But that shouldn't stop us from shipping the update. 

A failure on a supported platform does stop the update...



---

archive/issue_comments_157767.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2012-12-19T11:40:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157767",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_157768.json:
```json
{
    "body": "Replying to [comment:204 jdemeyer]:\n> Replying to [comment:203 vbraun]:\n> > I'll see if I can reproduce the OpenSolaris bug on OpenIndiana (if anybody with access to hawk can debug it go for it, but I don't have an account). But that shouldn't stop us from shipping the update. \n> \n> A failure on a supported platform does stop the update...\n\nI am having trouble building 5.5.rc1 on hawk. It errors out for no obvious reason.",
    "created_at": "2012-12-19T11:52:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157768",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:204 jdemeyer]:
> Replying to [comment:203 vbraun]:
> > I'll see if I can reproduce the OpenSolaris bug on OpenIndiana (if anybody with access to hawk can debug it go for it, but I don't have an account). But that shouldn't stop us from shipping the update. 
> 
> A failure on a supported platform does stop the update...

I am having trouble building 5.5.rc1 on hawk. It errors out for no obvious reason.



---

archive/issue_comments_157769.json:
```json
{
    "body": "Replying to [comment:204 jdemeyer]:\n> A failure on a supported platform does stop the update...\n\nThe most glaring bug is of course that OpenSolaris is a fully supported platform. https://groups.google.com/d/topic/sage-devel/nRVBUQtL_d4/discussion",
    "created_at": "2012-12-19T12:46:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157769",
    "user": "https://github.com/vbraun"
}
```

Replying to [comment:204 jdemeyer]:
> A failure on a supported platform does stop the update...

The most glaring bug is of course that OpenSolaris is a fully supported platform. https://groups.google.com/d/topic/sage-devel/nRVBUQtL_d4/discussion



---

archive/issue_comments_157770.json:
```json
{
    "body": "Another unrelated issue is that setting `SAGE_DEBUG=yes` doesn't correctly set `-O0`, as it's overwritten later in the command line by an `-O2`:\n\n```\n$ SAGE_DEBUG=yes ./sage -f gap-4.5.6.p0.spkg\n[...]\ngcc -I. -I../.. -DCONFIG_H  -I/release/merger/sage-5.6.beta0/local/include -D__GMP_MP_RELEASE=50002 -O0 -g3 -DDEBUG_MASTERPOINTERS -DDEBUG_GLOBAL_BAGS -DDEBUG_FUNCTIONS_BAGS -Wall -g -O2   -o intfuncs.o -c ../../src/intfuncs.c\n[...]\n```\n",
    "created_at": "2012-12-20T09:15:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157770",
    "user": "https://github.com/jdemeyer"
}
```

Another unrelated issue is that setting `SAGE_DEBUG=yes` doesn't correctly set `-O0`, as it's overwritten later in the command line by an `-O2`:

```
$ SAGE_DEBUG=yes ./sage -f gap-4.5.6.p0.spkg
[...]
gcc -I. -I../.. -DCONFIG_H  -I/release/merger/sage-5.6.beta0/local/include -D__GMP_MP_RELEASE=50002 -O0 -g3 -DDEBUG_MASTERPOINTERS -DDEBUG_GLOBAL_BAGS -DDEBUG_FUNCTIONS_BAGS -Wall -g -O2   -o intfuncs.o -c ../../src/intfuncs.c
[...]
```




---

archive/issue_comments_157771.json:
```json
{
    "body": "FYI: GAP-4.5.7 has been released which fixes (amongst other things)\n> Numbers in memory options on the command line exceeding 2<sup>32</sup> could not be parsed correctly, even on 64-bit systems. [Reported by Volker Braun]",
    "created_at": "2012-12-20T09:26:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157771",
    "user": "https://github.com/jdemeyer"
}
```

FYI: GAP-4.5.7 has been released which fixes (amongst other things)
> Numbers in memory options on the command line exceeding 2<sup>32</sup> could not be parsed correctly, even on 64-bit systems. [Reported by Volker Braun]



---

archive/issue_comments_157772.json:
```json
{
    "body": "Attachment [cflags.patch](tarball://root/attachments/some-uuid/ticket13211/cflags.patch) by @jdemeyer created at 2012-12-20 09:49:46\n\nFix CFLAGS setting in GAP configure file",
    "created_at": "2012-12-20T09:49:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157772",
    "user": "https://github.com/jdemeyer"
}
```

Attachment [cflags.patch](tarball://root/attachments/some-uuid/ticket13211/cflags.patch) by @jdemeyer created at 2012-12-20 09:49:46

Fix CFLAGS setting in GAP configure file



---

archive/issue_comments_157773.json:
```json
{
    "body": "I reported the patch [attachment:cflags.patch] upstream, it should be added to the spkg.",
    "created_at": "2012-12-20T10:00:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157773",
    "user": "https://github.com/jdemeyer"
}
```

I reported the patch [attachment:cflags.patch] upstream, it should be added to the spkg.



---

archive/issue_comments_157774.json:
```json
{
    "body": "The \"`Special Update/Build Instructions`\" are quite unclear to me. I'm trying to update the package to GAP-4.5.7 but it's difficult to understand what all this means:\n\n```\nThis is a stripped-down version of GAP.  The databases, which are arch\nindependent, are in a separate package and doc and tests are removed.\n\n** IMPORTANT **:\n   When you update this package, be sure to put the guava package\n   in the package directory!!\n\nDelete some of the documentation:\n  cd doc\n  rm *.bbl *.aux *.dvi *.idx *.ilg *.l* *.m* *.pdf *.toc  *.blg *.ind\n  rm */*.bbl */*.aux */*.dvi */*.idx */*.ilg */*.l* */*.m* */*.pdf */*.ind */*.toc */*.blg\n\nDATABASES (separated out to database_gap.spkg) except GAPDoc which is required:\n  rm -rf small prim trans\n  cd pkg\n  rm -rf !(GAPDoc*)\n\nStuff that isn't GAP sources:\n  rm -rf bin/*\n  cd extern\n  rm -rf !Makefile.in\n```\n",
    "created_at": "2012-12-20T11:37:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157774",
    "user": "https://github.com/jdemeyer"
}
```

The "`Special Update/Build Instructions`" are quite unclear to me. I'm trying to update the package to GAP-4.5.7 but it's difficult to understand what all this means:

```
This is a stripped-down version of GAP.  The databases, which are arch
independent, are in a separate package and doc and tests are removed.

** IMPORTANT **:
   When you update this package, be sure to put the guava package
   in the package directory!!

Delete some of the documentation:
  cd doc
  rm *.bbl *.aux *.dvi *.idx *.ilg *.l* *.m* *.pdf *.toc  *.blg *.ind
  rm */*.bbl */*.aux */*.dvi */*.idx */*.ilg */*.l* */*.m* */*.pdf */*.ind */*.toc */*.blg

DATABASES (separated out to database_gap.spkg) except GAPDoc which is required:
  rm -rf small prim trans
  cd pkg
  rm -rf !(GAPDoc*)

Stuff that isn't GAP sources:
  rm -rf bin/*
  cd extern
  rm -rf !Makefile.in
```




---

archive/issue_comments_157775.json:
```json
{
    "body": "Replying to [comment:210 jdemeyer]:\n> The \"`Special Update/Build Instructions`\" are quite unclear to me. I'm trying to update the package to GAP-4.5.7 but it's difficult to understand what all this means:\n> {{{\n> This is a stripped-down version of GAP.  The databases, which are arch\n> independent, are in a separate package and doc and tests are removed.\n> \n> ** IMPORTANT **:\n>    When you update this package, be sure to put the guava package\n>    in the package directory!!\n\nsomehow, guava, the favorite GAP package of DJ, used to enjoy a special deal. But not anymore, for a while already. This needs to be updated. \n\nGAP packages (a selection) go to gap_packages optional package.\n\nI hope the rest is clear. \n\n> \n> Delete some of the documentation:\n>   cd doc\n>   rm *.bbl *.aux *.dvi *.idx *.ilg *.l* *.m* *.pdf *.toc  *.blg *.ind\n>   rm */*.bbl */*.aux */*.dvi */*.idx */*.ilg */*.l* */*.m* */*.pdf */*.ind */*.toc */*.blg\n> \n> DATABASES (separated out to database_gap.spkg) except GAPDoc which is required:\n>   rm -rf small prim trans\n>   cd pkg\n>   rm -rf !(GAPDoc*)\n> \n> Stuff that isn't GAP sources:\n>   rm -rf bin/*\n>   cd extern\n>   rm -rf !Makefile.in\n> }}}",
    "created_at": "2012-12-20T12:08:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157775",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:210 jdemeyer]:
> The "`Special Update/Build Instructions`" are quite unclear to me. I'm trying to update the package to GAP-4.5.7 but it's difficult to understand what all this means:
> {{{
> This is a stripped-down version of GAP.  The databases, which are arch
> independent, are in a separate package and doc and tests are removed.
> 
> ** IMPORTANT **:
>    When you update this package, be sure to put the guava package
>    in the package directory!!

somehow, guava, the favorite GAP package of DJ, used to enjoy a special deal. But not anymore, for a while already. This needs to be updated. 

GAP packages (a selection) go to gap_packages optional package.

I hope the rest is clear. 

> 
> Delete some of the documentation:
>   cd doc
>   rm *.bbl *.aux *.dvi *.idx *.ilg *.l* *.m* *.pdf *.toc  *.blg *.ind
>   rm */*.bbl */*.aux */*.dvi */*.idx */*.ilg */*.l* */*.m* */*.pdf */*.ind */*.toc */*.blg
> 
> DATABASES (separated out to database_gap.spkg) except GAPDoc which is required:
>   rm -rf small prim trans
>   cd pkg
>   rm -rf !(GAPDoc*)
> 
> Stuff that isn't GAP sources:
>   rm -rf bin/*
>   cd extern
>   rm -rf !Makefile.in
> }}}



---

archive/issue_comments_157776.json:
```json
{
    "body": "Replying to [comment:211 dimpase]:\n> I hope the rest is clear.\nIt's not.\n\nWhen updating the sources is non-trivial, it's best to create a shell script (called `spkg-src`) which downloads and prepares `src/`.",
    "created_at": "2012-12-20T12:19:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157776",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:211 dimpase]:
> I hope the rest is clear.
It's not.

When updating the sources is non-trivial, it's best to create a shell script (called `spkg-src`) which downloads and prepares `src/`.



---

archive/issue_comments_157777.json:
```json
{
    "body": "Fix interrupts in Solaris",
    "created_at": "2012-12-20T12:52:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157777",
    "user": "https://github.com/jdemeyer"
}
```

Fix interrupts in Solaris



---

archive/issue_comments_157778.json:
```json
{
    "body": "Attachment [siginterrupt.patch](tarball://root/attachments/some-uuid/ticket13211/siginterrupt.patch) by @jdemeyer created at 2012-12-20 12:54:49\n\nI have a new spkg ready which includes two patches: [attachment:cflags.patch] and [attachment:siginterrupt.patch]. The latter one fixes the OpenSolaris issue and has also been reported upstream.\n\nSomebody else should really clarify `SPKG.txt` on how to update `src` or write a shell script to do so.",
    "created_at": "2012-12-20T12:54:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157778",
    "user": "https://github.com/jdemeyer"
}
```

Attachment [siginterrupt.patch](tarball://root/attachments/some-uuid/ticket13211/siginterrupt.patch) by @jdemeyer created at 2012-12-20 12:54:49

I have a new spkg ready which includes two patches: [attachment:cflags.patch] and [attachment:siginterrupt.patch]. The latter one fixes the OpenSolaris issue and has also been reported upstream.

Somebody else should really clarify `SPKG.txt` on how to update `src` or write a shell script to do so.



---

archive/issue_comments_157779.json:
```json
{
    "body": "Call me an optimist, but I'm still hoping that upstream will clean up their build system and dist tarball. The layout of their dist tarball and the required packages are also in a flux, so I don't see the value of a shell script. Having said that, the instructions are written in a manner that you just have to cd into the gap* source directory and execute them. E.g. there are directories `gap4r5/small`, `gap4r5/prim`, and `gap4r5/trans`. Then by \"`rm -rf small prim trans`\" I mean to check that the directory layout hasn't changed and then delete these directories.",
    "created_at": "2012-12-20T13:16:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157779",
    "user": "https://github.com/vbraun"
}
```

Call me an optimist, but I'm still hoping that upstream will clean up their build system and dist tarball. The layout of their dist tarball and the required packages are also in a flux, so I don't see the value of a shell script. Having said that, the instructions are written in a manner that you just have to cd into the gap* source directory and execute them. E.g. there are directories `gap4r5/small`, `gap4r5/prim`, and `gap4r5/trans`. Then by "`rm -rf small prim trans`" I mean to check that the directory layout hasn't changed and then delete these directories.



---

archive/issue_comments_157780.json:
```json
{
    "body": "Replying to [comment:214 vbraun]:\n> Having said that, the instructions are written in a manner that you just have to cd into the gap* source directory and execute them.\nNot quite. I don't know what `rm -rf !(GAPDoc*)` is supposed to do:\n\n\n```\njdemeyer@sage:~/spkg/gap-4.5.7.p0/src/pkg$ rm -rf !(GAPDoc*)\nbash: !: event not found\n```\n\n\nBesides, if you're writing out the commands in `SPKG.txt`, you might as well create an actual shell script which is easier to use than copy/pasting the code and putting the right \"cd\" statements in between.",
    "created_at": "2012-12-20T13:35:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157780",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:214 vbraun]:
> Having said that, the instructions are written in a manner that you just have to cd into the gap* source directory and execute them.
Not quite. I don't know what `rm -rf !(GAPDoc*)` is supposed to do:


```
jdemeyer@sage:~/spkg/gap-4.5.7.p0/src/pkg$ rm -rf !(GAPDoc*)
bash: !: event not found
```


Besides, if you're writing out the commands in `SPKG.txt`, you might as well create an actual shell script which is easier to use than copy/pasting the code and putting the right "cd" statements in between.



---

archive/issue_comments_157781.json:
```json
{
    "body": "You don't like extended shell globs? Then there is no concise way to match with exceptions, I think. \n\n```\nshopt +extglob\n```\n\nBoth the mercurial and subversion bash completion scripts enable this by default.",
    "created_at": "2012-12-20T14:16:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157781",
    "user": "https://github.com/vbraun"
}
```

You don't like extended shell globs? Then there is no concise way to match with exceptions, I think. 

```
shopt +extglob
```

Both the mercurial and subversion bash completion scripts enable this by default.



---

archive/issue_comments_157782.json:
```json
{
    "body": "Replying to [comment:216 vbraun]:\n> You don't like extended shell globs?\nNever heard of this...",
    "created_at": "2012-12-20T15:44:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157782",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:216 vbraun]:
> You don't like extended shell globs?
Never heard of this...



---

archive/issue_comments_157783.json:
```json
{
    "body": "I guess you mean\n\n```\nshopt -s extglob\n```\n",
    "created_at": "2012-12-20T15:54:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157783",
    "user": "https://github.com/jdemeyer"
}
```

I guess you mean

```
shopt -s extglob
```




---

archive/issue_comments_157784.json:
```json
{
    "body": "Yes, sorry.",
    "created_at": "2012-12-20T15:58:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157784",
    "user": "https://github.com/vbraun"
}
```

Yes, sorry.



---

archive/issue_comments_157785.json:
```json
{
    "body": "Attachment [gap-4.5.7.p0.diff](tarball://root/attachments/some-uuid/ticket13211/gap-4.5.7.p0.diff) by @jdemeyer created at 2012-12-20 17:00:43\n\nDiff for the GAP spkg 4.5.6 -> 4.5.7.p0. For reference / review only.",
    "created_at": "2012-12-20T17:00:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157785",
    "user": "https://github.com/jdemeyer"
}
```

Attachment [gap-4.5.7.p0.diff](tarball://root/attachments/some-uuid/ticket13211/gap-4.5.7.p0.diff) by @jdemeyer created at 2012-12-20 17:00:43

Diff for the GAP spkg 4.5.6 -> 4.5.7.p0. For reference / review only.



---

archive/issue_comments_157786.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-12-20T17:01:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157786",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_157787.json:
```json
{
    "body": "I updated `SPKG.txt` and upgraded to GAP-4.5.7.  needs review...",
    "created_at": "2012-12-20T17:01:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157787",
    "user": "https://github.com/jdemeyer"
}
```

I updated `SPKG.txt` and upgraded to GAP-4.5.7.  needs review...



---

archive/issue_comments_157788.json:
```json
{
    "body": "Did you check that nothing in the `gap_package` and `database_gap` packages changed? Should I version bump them to 4.5.7 to be clear?",
    "created_at": "2012-12-20T17:39:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157788",
    "user": "https://github.com/vbraun"
}
```

Did you check that nothing in the `gap_package` and `database_gap` packages changed? Should I version bump them to 4.5.7 to be clear?



---

archive/issue_comments_157789.json:
```json
{
    "body": "Replying to [comment:224 vbraun]:\n> Did you check that nothing in the `gap_package` and `database_gap` packages changed? Should I version bump them to 4.5.7 to be clear?\nAt least some packages might have been changed (this is not in sync with the GAP releases, AFAIK).\n\nAlso, after updating with Jeroen's spkg, I still get gap.version 4.5.6, not 4.5.7.",
    "created_at": "2012-12-20T17:46:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157789",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:224 vbraun]:
> Did you check that nothing in the `gap_package` and `database_gap` packages changed? Should I version bump them to 4.5.7 to be clear?
At least some packages might have been changed (this is not in sync with the GAP releases, AFAIK).

Also, after updating with Jeroen's spkg, I still get gap.version 4.5.6, not 4.5.7.



---

archive/issue_comments_157790.json:
```json
{
    "body": "Replying to [comment:225 dimpase]:\n> Also, after updating with Jeroen's spkg, I still get gap.version 4.5.6, not 4.5.7.\n\nMe, too. I verified that the upstream tarball shows the correct version (4.5.7) upon startup, so something is wrong with the spkg sources.",
    "created_at": "2012-12-20T18:06:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157790",
    "user": "https://github.com/vbraun"
}
```

Replying to [comment:225 dimpase]:
> Also, after updating with Jeroen's spkg, I still get gap.version 4.5.6, not 4.5.7.

Me, too. I verified that the upstream tarball shows the correct version (4.5.7) upon startup, so something is wrong with the spkg sources.



---

archive/issue_comments_157791.json:
```json
{
    "body": "Replying to [comment:225 dimpase]:\n> Also, after updating with Jeroen's spkg, I still get gap.version 4.5.6, not 4.5.7.\n\nIt works for me:\n\n```\njdemeyer@sage:/release/merger/sage-5.6.beta1$ ./sage --gap\n *********   GAP, Version 4.5.7 of 14-Dec-2012 (free software, GPL)\n *  GAP  *   http://www.gap-system.org\n *********   Architecture: x86_64-unknown-linux-gnu-gcc-default64\n Libs used:  gmp, readline\n Loading the library and packages ...\n Packages:   GAPDoc 1.5.1\n Try '?help' for help. See also  '?copyright' and  '?authors'\ngap>\n```\n\n\n```\njdemeyer@sage:/release/merger/sage-5.6.beta1$ ./sage\n----------------------------------------------------------------------\n----------------------------------------------------------------------\n**********************************************************************\n*                                                                    *\n* Warning: this is a prerelease version, and it may be unstable.     *\n*                                                                    *\n**********************************************************************\nsage: gap.version()\n'4.5.7'\n```\n",
    "created_at": "2012-12-20T19:54:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157791",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:225 dimpase]:
> Also, after updating with Jeroen's spkg, I still get gap.version 4.5.6, not 4.5.7.

It works for me:

```
jdemeyer@sage:/release/merger/sage-5.6.beta1$ ./sage --gap
 *********   GAP, Version 4.5.7 of 14-Dec-2012 (free software, GPL)
 *  GAP  *   http://www.gap-system.org
 *********   Architecture: x86_64-unknown-linux-gnu-gcc-default64
 Libs used:  gmp, readline
 Loading the library and packages ...
 Packages:   GAPDoc 1.5.1
 Try '?help' for help. See also  '?copyright' and  '?authors'
gap>
```


```
jdemeyer@sage:/release/merger/sage-5.6.beta1$ ./sage
----------------------------------------------------------------------
----------------------------------------------------------------------
**********************************************************************
*                                                                    *
* Warning: this is a prerelease version, and it may be unstable.     *
*                                                                    *
**********************************************************************
sage: gap.version()
'4.5.7'
```




---

archive/issue_comments_157792.json:
```json
{
    "body": "The doctest needs to be changed though to reflect version 4.5.7",
    "created_at": "2012-12-20T19:55:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157792",
    "user": "https://github.com/jdemeyer"
}
```

The doctest needs to be changed though to reflect version 4.5.7



---

archive/issue_comments_157793.json:
```json
{
    "body": "Replying to [comment:224 vbraun]:\n> Did you check that nothing in the `gap_package` and `database_gap` packages changed?\nNo, I didn't check anything, nor did I realise that this was needed. Please go ahead and update them.",
    "created_at": "2012-12-20T20:06:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157793",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:224 vbraun]:
> Did you check that nothing in the `gap_package` and `database_gap` packages changed?
No, I didn't check anything, nor did I realise that this was needed. Please go ahead and update them.



---

archive/issue_comments_157794.json:
```json
{
    "body": "The `gap/latest` symlink is not correctly created, which is why the old version is still used if you installed gap-4.5.6 previously. I'll fix that, too.",
    "created_at": "2012-12-20T20:07:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157794",
    "user": "https://github.com/vbraun"
}
```

The `gap/latest` symlink is not correctly created, which is why the old version is still used if you installed gap-4.5.6 previously. I'll fix that, too.



---

archive/issue_comments_157795.json:
```json
{
    "body": "Replying to [comment:230 vbraun]:\n> The `gap/latest` symlink is not correctly created, which is why the old version is still used if you installed gap-4.5.6 previously. I'll fix that, too.\nok",
    "created_at": "2012-12-20T20:18:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157795",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:230 vbraun]:
> The `gap/latest` symlink is not correctly created, which is why the old version is still used if you installed gap-4.5.6 previously. I'll fix that, too.
ok



---

archive/issue_comments_157796.json:
```json
{
    "body": "Attachment [gap-4.5.7.p1.diff](tarball://root/attachments/some-uuid/ticket13211/gap-4.5.7.p1.diff) by @vbraun created at 2012-12-20 20:25:39\n\nspkg diff for review only",
    "created_at": "2012-12-20T20:25:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157796",
    "user": "https://github.com/vbraun"
}
```

Attachment [gap-4.5.7.p1.diff](tarball://root/attachments/some-uuid/ticket13211/gap-4.5.7.p1.diff) by @vbraun created at 2012-12-20 20:25:39

spkg diff for review only



---

archive/issue_comments_157797.json:
```json
{
    "body": "Nothing changed in the `gap_packages` and `database_gap` this time, but I bumped the version to match. In any case they need to be updated from the old gap-4.4 ones.",
    "created_at": "2012-12-20T20:27:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157797",
    "user": "https://github.com/vbraun"
}
```

Nothing changed in the `gap_packages` and `database_gap` this time, but I bumped the version to match. In any case they need to be updated from the old gap-4.4 ones.



---

archive/issue_comments_157798.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-12-20T20:32:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157798",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_157799.json:
```json
{
    "body": "Positive review to Jeroen's changes.",
    "created_at": "2012-12-20T20:32:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157799",
    "user": "https://github.com/vbraun"
}
```

Positive review to Jeroen's changes.



---

archive/issue_comments_157800.json:
```json
{
    "body": "Updated for GAP-4.5.7 (contains pool_size patch)",
    "created_at": "2012-12-21T07:36:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157800",
    "user": "https://github.com/jdemeyer"
}
```

Updated for GAP-4.5.7 (contains pool_size patch)



---

archive/issue_comments_157801.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2012-12-22T07:07:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157801",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_157802.json:
```json
{
    "body": "Attachment [trac_13211_fix_gap_doctests.patch](tarball://root/attachments/some-uuid/ticket13211/trac_13211_fix_gap_doctests.patch) by @jdemeyer created at 2012-12-22 07:07:10\n\nThe memory size still isn't right, as I got this doctest error on snapperkob (Linux Ubuntu 12.04 x86_64, 8GB RAM + 0.5GB swap):\n\n```\nsage -t  --long -force_lib devel/sage/sage/combinat/root_system/weyl_group.py\n**********************************************************************\nFile \"/home/buildbot/build/sage/snapperkob/snapperkob_full/build/sage-5.6.beta1/devel/sage-main/sage/combinat/root_system/weyl_group.py\", line 543:\n    sage: all( WeylGroup(t).long_element() == WeylGroup(t).long_element_hardcoded() for t in types )  # long time (17s on sage.math, 2011)\nException raised:\n    Traceback (most recent call last):\n      File \"/home/buildbot/build/sage/snapperkob/snapperkob_full/build/sage-5.6.beta1/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/home/buildbot/build/sage/snapperkob/snapperkob_full/build/sage-5.6.beta1/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/home/buildbot/build/sage/snapperkob/snapperkob_full/build/sage-5.6.beta1/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_16[4]>\", line 1, in <module>\n        all( WeylGroup(t).long_element() == WeylGroup(t).long_element_hardcoded() for t in types )  # long time (17s on sage.math, 2011)###line 543:\n    sage: all( WeylGroup(t).long_element() == WeylGroup(t).long_element_hardcoded() for t in types )  # long time (17s on sage.math, 2011)\n      File \"<doctest __main__.example_16[4]>\", line 1, in <genexpr>\n        all( WeylGroup(t).long_element() == WeylGroup(t).long_element_hardcoded() for t in types )  # long time (17s on sage.math, 2011)###line 543:\n    sage: all( WeylGroup(t).long_element() == WeylGroup(t).long_element_hardcoded() for t in types )  # long time (17s on sage.math, 2011)\n      File \"/home/buildbot/build/sage/snapperkob/snapperkob_full/build/sage-5.6.beta1/local/lib/python/site-packages/sage/combinat/root_system/weyl_group.py\", line 579, in long_element_hardcoded\n        return self.__call__(m)\n      File \"/home/buildbot/build/sage/snapperkob/snapperkob_full/build/sage-5.6.beta1/local/lib/python/site-packages/sage/combinat/root_system/weyl_group.py\", line 362, in __call__\n        if not gap(g) in gap(self):\n      File \"/home/buildbot/build/sage/snapperkob/snapperkob_full/build/sage-5.6.beta1/local/lib/python/site-packages/sage/interfaces/interface.py\", line 675, in __contains__\n        return P._contains(x.name(), self.name())\n      File \"/home/buildbot/build/sage/snapperkob/snapperkob_full/build/sage-5.6.beta1/local/lib/python/site-packages/sage/interfaces/gap.py\", line 815, in _contains\n        return self.eval('%s in %s'%(v1,v2)) == \"true\"\n      File \"/home/buildbot/build/sage/snapperkob/snapperkob_full/build/sage-5.6.beta1/local/lib/python/site-packages/sage/interfaces/gap.py\", line 574, in eval\n        result = Expect.eval(self, input_line, **kwds)\n      File \"/home/buildbot/build/sage/snapperkob/snapperkob_full/build/sage-5.6.beta1/local/lib/python/site-packages/sage/interfaces/expect.py\", line 1220, in eval\n        for L in code.split('\\n') if L != ''])\n      File \"/home/buildbot/build/sage/snapperkob/snapperkob_full/build/sage-5.6.beta1/local/lib/python/site-packages/sage/interfaces/gap.py\", line 775, in _eval_line\n        raise RuntimeError, message\n    RuntimeError: Gap produced error output\n    Error, exceeded the permitted memory (`-o' command line option)\n\n       executing $sage3 in $sage11;\n**********************************************************************\n```\n",
    "created_at": "2012-12-22T07:07:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157802",
    "user": "https://github.com/jdemeyer"
}
```

Attachment [trac_13211_fix_gap_doctests.patch](tarball://root/attachments/some-uuid/ticket13211/trac_13211_fix_gap_doctests.patch) by @jdemeyer created at 2012-12-22 07:07:10

The memory size still isn't right, as I got this doctest error on snapperkob (Linux Ubuntu 12.04 x86_64, 8GB RAM + 0.5GB swap):

```
sage -t  --long -force_lib devel/sage/sage/combinat/root_system/weyl_group.py
**********************************************************************
File "/home/buildbot/build/sage/snapperkob/snapperkob_full/build/sage-5.6.beta1/devel/sage-main/sage/combinat/root_system/weyl_group.py", line 543:
    sage: all( WeylGroup(t).long_element() == WeylGroup(t).long_element_hardcoded() for t in types )  # long time (17s on sage.math, 2011)
Exception raised:
    Traceback (most recent call last):
      File "/home/buildbot/build/sage/snapperkob/snapperkob_full/build/sage-5.6.beta1/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/home/buildbot/build/sage/snapperkob/snapperkob_full/build/sage-5.6.beta1/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/home/buildbot/build/sage/snapperkob/snapperkob_full/build/sage-5.6.beta1/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_16[4]>", line 1, in <module>
        all( WeylGroup(t).long_element() == WeylGroup(t).long_element_hardcoded() for t in types )  # long time (17s on sage.math, 2011)###line 543:
    sage: all( WeylGroup(t).long_element() == WeylGroup(t).long_element_hardcoded() for t in types )  # long time (17s on sage.math, 2011)
      File "<doctest __main__.example_16[4]>", line 1, in <genexpr>
        all( WeylGroup(t).long_element() == WeylGroup(t).long_element_hardcoded() for t in types )  # long time (17s on sage.math, 2011)###line 543:
    sage: all( WeylGroup(t).long_element() == WeylGroup(t).long_element_hardcoded() for t in types )  # long time (17s on sage.math, 2011)
      File "/home/buildbot/build/sage/snapperkob/snapperkob_full/build/sage-5.6.beta1/local/lib/python/site-packages/sage/combinat/root_system/weyl_group.py", line 579, in long_element_hardcoded
        return self.__call__(m)
      File "/home/buildbot/build/sage/snapperkob/snapperkob_full/build/sage-5.6.beta1/local/lib/python/site-packages/sage/combinat/root_system/weyl_group.py", line 362, in __call__
        if not gap(g) in gap(self):
      File "/home/buildbot/build/sage/snapperkob/snapperkob_full/build/sage-5.6.beta1/local/lib/python/site-packages/sage/interfaces/interface.py", line 675, in __contains__
        return P._contains(x.name(), self.name())
      File "/home/buildbot/build/sage/snapperkob/snapperkob_full/build/sage-5.6.beta1/local/lib/python/site-packages/sage/interfaces/gap.py", line 815, in _contains
        return self.eval('%s in %s'%(v1,v2)) == "true"
      File "/home/buildbot/build/sage/snapperkob/snapperkob_full/build/sage-5.6.beta1/local/lib/python/site-packages/sage/interfaces/gap.py", line 574, in eval
        result = Expect.eval(self, input_line, **kwds)
      File "/home/buildbot/build/sage/snapperkob/snapperkob_full/build/sage-5.6.beta1/local/lib/python/site-packages/sage/interfaces/expect.py", line 1220, in eval
        for L in code.split('\n') if L != ''])
      File "/home/buildbot/build/sage/snapperkob/snapperkob_full/build/sage-5.6.beta1/local/lib/python/site-packages/sage/interfaces/gap.py", line 775, in _eval_line
        raise RuntimeError, message
    RuntimeError: Gap produced error output
    Error, exceeded the permitted memory (`-o' command line option)

       executing $sage3 in $sage11;
**********************************************************************
```




---

archive/issue_comments_157803.json:
```json
{
    "body": "Replying to [comment:236 jdemeyer]:\n> The memory size still isn't right, as I got this doctest error on snapperkob (Linux Ubuntu 12.04 x86_64, 8GB RAM + 0.5GB swap):\n\nsame on my OSX 10.6.8 laptop. Actually, just the following suffices:\n\n```\n$ sage \n----------------------------------------------------------------------\n----------------------------------------------------------------------\n**********************************************************************\n*                                                                    *\n* Warning: this is a prerelease version, and it may be unstable.     *\n*                                                                    *\n**********************************************************************\nsage: WeylGroup(['E',6]).long_element() == WeylGroup(['E',6]).long_element_hardcoded()\nERROR: An unexpected error occurred while tokenizing input\n[...]\nRuntimeError: Gap produced error output\nError, exceeded the permitted memory (`-o' command line option)\n```\n\nRepeating this line again in the same session produces no error, something I don't understand.",
    "created_at": "2012-12-22T07:58:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157803",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:236 jdemeyer]:
> The memory size still isn't right, as I got this doctest error on snapperkob (Linux Ubuntu 12.04 x86_64, 8GB RAM + 0.5GB swap):

same on my OSX 10.6.8 laptop. Actually, just the following suffices:

```
$ sage 
----------------------------------------------------------------------
----------------------------------------------------------------------
**********************************************************************
*                                                                    *
* Warning: this is a prerelease version, and it may be unstable.     *
*                                                                    *
**********************************************************************
sage: WeylGroup(['E',6]).long_element() == WeylGroup(['E',6]).long_element_hardcoded()
ERROR: An unexpected error occurred while tokenizing input
[...]
RuntimeError: Gap produced error output
Error, exceeded the permitted memory (`-o' command line option)
```

Repeating this line again in the same session produces no error, something I don't understand.



---

archive/issue_comments_157804.json:
```json
{
    "body": "Updated patch",
    "created_at": "2012-12-22T14:07:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157804",
    "user": "https://github.com/vbraun"
}
```

Updated patch



---

archive/issue_comments_157805.json:
```json
{
    "body": "Attachment [trac_13211_fix_gap_doctests.2.patch](tarball://root/attachments/some-uuid/ticket13211/trac_13211_fix_gap_doctests.2.patch) by @vbraun created at 2012-12-22 14:13:13\n\nI see, the by far largest computation with GAP is actually in combinat and not in the group theory stuff %-) We actually need about 220 MB, so I increased the minimum to 250 MB. I checked that make ptestlong runs without any further errors.\n\nDima, running the command twice probably uses values that were cached in Sage.",
    "created_at": "2012-12-22T14:13:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157805",
    "user": "https://github.com/vbraun"
}
```

Attachment [trac_13211_fix_gap_doctests.2.patch](tarball://root/attachments/some-uuid/ticket13211/trac_13211_fix_gap_doctests.2.patch) by @vbraun created at 2012-12-22 14:13:13

I see, the by far largest computation with GAP is actually in combinat and not in the group theory stuff %-) We actually need about 220 MB, so I increased the minimum to 250 MB. I checked that make ptestlong runs without any further errors.

Dima, running the command twice probably uses values that were cached in Sage.



---

archive/issue_comments_157806.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2012-12-22T14:13:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157806",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_157807.json:
```json
{
    "body": "Volker, your patch is missing `memory_info.py` for some reason.",
    "created_at": "2012-12-22T22:17:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157807",
    "user": "https://github.com/jdemeyer"
}
```

Volker, your patch is missing `memory_info.py` for some reason.



---

archive/issue_comments_157808.json:
```json
{
    "body": "Also, something else I just noted: in #12221, I determined it was better to complete unset `TERM` instead of setting it to \"dumb\". I don't remember why, but I do remember that was the most reliable. \n\nBut I don't care very much since it seems to pass doctests...",
    "created_at": "2012-12-22T22:19:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157808",
    "user": "https://github.com/jdemeyer"
}
```

Also, something else I just noted: in #12221, I determined it was better to complete unset `TERM` instead of setting it to "dumb". I don't remember why, but I do remember that was the most reliable. 

But I don't care very much since it seems to pass doctests...



---

archive/issue_comments_157809.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2012-12-22T22:19:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157809",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_157810.json:
```json
{
    "body": "Attachment [trac_13211_fix_gap_doctests.3.patch](tarball://root/attachments/some-uuid/ticket13211/trac_13211_fix_gap_doctests.3.patch) by @vbraun created at 2012-12-22 22:34:53\n\nUpdated patch",
    "created_at": "2012-12-22T22:34:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157810",
    "user": "https://github.com/vbraun"
}
```

Attachment [trac_13211_fix_gap_doctests.3.patch](tarball://root/attachments/some-uuid/ticket13211/trac_13211_fix_gap_doctests.3.patch) by @vbraun created at 2012-12-22 22:34:53

Updated patch



---

archive/issue_comments_157811.json:
```json
{
    "body": "Attachment [trac_13211_fix_gap_doctests_vb.patch](tarball://root/attachments/some-uuid/ticket13211/trac_13211_fix_gap_doctests_vb.patch) by @vbraun created at 2012-12-22 22:41:48\n\nUpdated patch",
    "created_at": "2012-12-22T22:41:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157811",
    "user": "https://github.com/vbraun"
}
```

Attachment [trac_13211_fix_gap_doctests_vb.patch](tarball://root/attachments/some-uuid/ticket13211/trac_13211_fix_gap_doctests_vb.patch) by @vbraun created at 2012-12-22 22:41:48

Updated patch



---

archive/issue_comments_157812.json:
```json
{
    "body": "Strange that the file got lost, I didn't edit anything in that dir. I put `memory_info.py` back in and switched from \"dumb\" to no TERM.",
    "created_at": "2012-12-22T22:43:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157812",
    "user": "https://github.com/vbraun"
}
```

Strange that the file got lost, I didn't edit anything in that dir. I put `memory_info.py` back in and switched from "dumb" to no TERM.



---

archive/issue_comments_157813.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2012-12-22T22:43:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157813",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_157814.json:
```json
{
    "body": "And there was much rejoicing...",
    "created_at": "2012-12-26T13:20:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157814",
    "user": "https://github.com/jdemeyer"
}
```

And there was much rejoicing...



---

archive/issue_comments_157815.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-12-26T13:20:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157815",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_comments_157816.json:
```json
{
    "body": "Thanks! \\o/",
    "created_at": "2012-12-26T13:39:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157816",
    "user": "https://github.com/ppurka"
}
```

Thanks! \o/



---

archive/issue_comments_157817.json:
```json
{
    "body": "Replying to [comment:243 jdemeyer]:\n> And there was much rejoicing...\n\nCongratulation! Although it means that I have to produce a new version of my group cohomology spkg - it seems that the new Gap version has a different syntax or function names or whatever else to cope with... :(",
    "created_at": "2012-12-26T14:44:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157817",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:243 jdemeyer]:
> And there was much rejoicing...

Congratulation! Although it means that I have to produce a new version of my group cohomology spkg - it seems that the new Gap version has a different syntax or function names or whatever else to cope with... :(



---

archive/issue_comments_157818.json:
```json
{
    "body": "both optional SPKSes are on their way around the world :-)",
    "created_at": "2012-12-26T17:15:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157818",
    "user": "https://github.com/haraldschilly"
}
```

both optional SPKSes are on their way around the world :-)



---

archive/issue_comments_157819.json:
```json
{
    "body": "The database_gap spkg on the mirrors seems to be corrupted, as does the one on Volker's page in the ticket description:\n\n```\npalmieri@sage:sage$ ./sage -i http://www.stp.dias.ie/~vbraun/Sage/spkg/database_gap-4.5.7.spkg\nAttempting to download package database_gap-4.5.7\n>>> Downloading database_gap-4.5.7.spkg.\n[............................................................]\ndatabase_gap-4.5.7\n====================================================\nExtracting package /scratch/palmieri/sage-5.5.rc0/spkg/optional/database_gap-4.5.7.spkg\n-rw-r--r-- 1 palmieri palmieri 59654144 2012-12-29 17:33 /scratch/palmieri/sage-5.5.rc0/spkg/optional/database_gap-4.5.7.spkg\ntar: Skipping to next header\ntar: Error exit delayed from previous errors\nError: failed to extract /scratch/palmieri/sage-5.5.rc0/spkg/optional/database_gap-4.5.7.spkg\n```\n",
    "created_at": "2012-12-30T01:34:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157819",
    "user": "https://github.com/jhpalmieri"
}
```

The database_gap spkg on the mirrors seems to be corrupted, as does the one on Volker's page in the ticket description:

```
palmieri@sage:sage$ ./sage -i http://www.stp.dias.ie/~vbraun/Sage/spkg/database_gap-4.5.7.spkg
Attempting to download package database_gap-4.5.7
>>> Downloading database_gap-4.5.7.spkg.
[............................................................]
database_gap-4.5.7
====================================================
Extracting package /scratch/palmieri/sage-5.5.rc0/spkg/optional/database_gap-4.5.7.spkg
-rw-r--r-- 1 palmieri palmieri 59654144 2012-12-29 17:33 /scratch/palmieri/sage-5.5.rc0/spkg/optional/database_gap-4.5.7.spkg
tar: Skipping to next header
tar: Error exit delayed from previous errors
Error: failed to extract /scratch/palmieri/sage-5.5.rc0/spkg/optional/database_gap-4.5.7.spkg
```




---

archive/issue_comments_157820.json:
```json
{
    "body": "Fixed, the file was truncated. This is the correct checksum:\n\n```\n[vbraun@volker-desktop spkg]$ md5sum database_gap-4.5.7.spkg \n46b0a14437b1fe996cbbb482d00e5325  database_gap-4.5.7.spkg\n```\n",
    "created_at": "2012-12-30T21:34:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157820",
    "user": "https://github.com/vbraun"
}
```

Fixed, the file was truncated. This is the correct checksum:

```
[vbraun@volker-desktop spkg]$ md5sum database_gap-4.5.7.spkg 
46b0a14437b1fe996cbbb482d00e5325  database_gap-4.5.7.spkg
```




---

archive/issue_comments_157821.json:
```json
{
    "body": "ok,i've replaced the faulty file on the master and the md5 sum matches now. mirrors are updating when you read this!",
    "created_at": "2012-12-30T21:40:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157821",
    "user": "https://github.com/haraldschilly"
}
```

ok,i've replaced the faulty file on the master and the md5 sum matches now. mirrors are updating when you read this!



---

archive/issue_comments_157822.json:
```json
{
    "body": "Just FYI, JP opened a followup at #13954 since this broke on Cygwin.  No action necessary here, of course, and it looks like he has a fix in any case.",
    "created_at": "2013-01-15T14:01:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157822",
    "user": "https://github.com/kcrisman"
}
```

Just FYI, JP opened a followup at #13954 since this broke on Cygwin.  No action necessary here, of course, and it looks like he has a fix in any case.



---

archive/issue_comments_157823.json:
```json
{
    "body": "I get some weird stuff in interfaces/gap.py on OS X 10.4 with 5.6.beta2.  Things like \n\n```\nsage: n = get_gap_memory_pool_size()\n<snip>\n    free_ram = int(free_ram([:-1]) * units[free_ram[-1]]\nValueError: invalid literal for int() with base 10: '33.1'\n```\n\nand lots and lots of other similar things.  The new file misc/memory_info.py has similar problems.  This was all introduced in this ticket, so I assume it is related... but maybe there was a followup I am unaware of?  Thanks for any feedback.",
    "created_at": "2013-01-15T16:37:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157823",
    "user": "https://github.com/kcrisman"
}
```

I get some weird stuff in interfaces/gap.py on OS X 10.4 with 5.6.beta2.  Things like 

```
sage: n = get_gap_memory_pool_size()
<snip>
    free_ram = int(free_ram([:-1]) * units[free_ram[-1]]
ValueError: invalid literal for int() with base 10: '33.1'
```

and lots and lots of other similar things.  The new file misc/memory_info.py has similar problems.  This was all introduced in this ticket, so I assume it is related... but maybe there was a followup I am unaware of?  Thanks for any feedback.



---

archive/issue_comments_157824.json:
```json
{
    "body": "There is a follow-up at #13880, but if that doesn't fix your problem, **please post to sage-devel** such that this can be fixed before releasing the final Sage 5.6.",
    "created_at": "2013-01-15T16:51:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157824",
    "user": "https://github.com/jdemeyer"
}
```

There is a follow-up at #13880, but if that doesn't fix your problem, **please post to sage-devel** such that this can be fixed before releasing the final Sage 5.6.



---

archive/issue_comments_157825.json:
```json
{
    "body": "> There is a follow-up at #13880, but if that doesn't fix your problem, **please post to sage-devel** such that this can be fixed before releasing the final Sage 5.6.\nI saw that, but it didn't seem to be quite the same issue... but I'll try it!",
    "created_at": "2013-01-15T17:31:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157825",
    "user": "https://github.com/kcrisman"
}
```

> There is a follow-up at #13880, but if that doesn't fix your problem, **please post to sage-devel** such that this can be fixed before releasing the final Sage 5.6.
I saw that, but it didn't seem to be quite the same issue... but I'll try it!



---

archive/issue_comments_157826.json:
```json
{
    "body": "> > There is a follow-up at #13880, but if that doesn't fix your problem, **please post to sage-devel** such that this can be fixed before releasing the final Sage 5.6.\n> I saw that, but it didn't seem to be quite the same issue... but I'll try it!\nSorry, it didn't seem to do it.  I've posted to sage-devel.",
    "created_at": "2013-01-15T17:45:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157826",
    "user": "https://github.com/kcrisman"
}
```

> > There is a follow-up at #13880, but if that doesn't fix your problem, **please post to sage-devel** such that this can be fixed before releasing the final Sage 5.6.
> I saw that, but it didn't seem to be quite the same issue... but I'll try it!
Sorry, it didn't seem to do it.  I've posted to sage-devel.



---

archive/issue_comments_157827.json:
```json
{
    "body": "(never mind)",
    "created_at": "2013-01-16T06:36:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157827",
    "user": "https://github.com/jdemeyer"
}
```

(never mind)



---

archive/issue_comments_157828.json:
```json
{
    "body": "This caused a serious slow-down in congruence subgroups: [https://groups.google.com/forum/?fromgroups#!topic/sage-devel/e3EDIRLuJXA](https://groups.google.com/forum/?fromgroups#!topic/sage-devel/e3EDIRLuJXA)",
    "created_at": "2013-01-25T10:46:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157828",
    "user": "https://github.com/jdemeyer"
}
```

This caused a serious slow-down in congruence subgroups: [https://groups.google.com/forum/?fromgroups#!topic/sage-devel/e3EDIRLuJXA](https://groups.google.com/forum/?fromgroups#!topic/sage-devel/e3EDIRLuJXA)



---

archive/issue_comments_157829.json:
```json
{
    "body": "Reported upstream at http://tracker.gap-system.org/issues/221",
    "created_at": "2013-01-25T12:19:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13039#issuecomment-157829",
    "user": "https://github.com/vbraun"
}
```

Reported upstream at http://tracker.gap-system.org/issues/221
