# Issue 29041: Callable symbolic expressions should be allowed to have unicode identifiers

Issue created by migration from https://trac.sagemath.org/ticket/29278

Original creator: rburing

Original creation time: 2020-03-03 21:23:49

CC:  tscrim

Keywords: callable symbolic expression, unicode, preparse, preparser, preparse_calculus

As [reported on Ask SageMath](https://ask.sagemath.org/question/50095/error-when-using-non-ascii-characters-as-symbolic-function-name/):


```
sage: μ(x) = x^2
  File "<ipython-input-20-93337e923470>", line 1
    μ(x) = x**Integer(2)
                        ^
SyntaxError: can't assign to function call
```


This is a bug in the preparser. Running


```
from sage.repl.preparse import preparse_calculus
preparse_calculus??
```


shows that in order to find the identifier it uses a regex with the range `[a-zA-Z_]`, which is old-fashioned since 9.0.

Note that there is no LaTeX issue here because callable symbolic expressions don't know their own names; the name is only used for the Python identifier.


---

Comment by nbruin created at 2020-03-03 21:51:53

Changing type from defect to enhancement.


---

Comment by nbruin created at 2020-03-03 21:51:53

It's not a really a bug. Perhaps it's not properly documented.

Identifier names that make it into SR should be very conservative, because they probably get shipped to all kinds of other interfaces -- by name! As pointed out in the ticket, the name used in the definition of a callable symbolic expression ends up only being used as a python identifier, so perhaps it's fine to relax the relevant regular expression.


---

Comment by @mwageringel created at 2020-03-03 22:07:40

Are you working on this? I have been looking into this a little bit and could create a branch.

IMO, this is very much a bug. The preparser should have nothing to do with other interfaces. If a particular interface does not support unicode, it needs to be caught in that interface, not in the preparser.

Note also that the following works just fine:

```
sage: aμ(x) = x^2
```

The problem only exists if the first character is not ASCII.


---

Comment by @mwageringel created at 2020-03-04 21:37:43

Changing status from new to needs_review.


---

Comment by @mwageringel created at 2020-03-04 21:37:43

I have updated all similar regular expressions in the preparser.

This also passes the tests with Python 2.
----
New commits:


---

Comment by rburing created at 2020-03-04 21:52:16

Thanks for working on this! Some of the original regular expressions purposely do not include digits, because Python identifiers should not start with digits. This still needs to be taken into account (and perhaps tested).


---

Comment by @mwageringel created at 2020-03-05 18:10:20

Replying to [comment:4 rburing]:
> Some of the original regular expressions purposely do not include digits, because Python identifiers should not start with digits. This still needs to be taken into account (and perhaps tested).

In place of `[a-zA-Z_]`, I used `[^\W\d]` to account for that, which excludes numbers and non-alphanumeric characters, so effectively only letters and underscores remain (for reference: the [re docs](https://docs.python.org/3.7/library/re.html#regular-expression-syntax)).


---

Comment by git created at 2020-03-06 18:43:16

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-03-07 19:19:28

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2020-03-29 19:42:37

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by @mwageringel created at 2020-03-29 19:44:13

Rebased on top of #29391.

By the way, IPython has accepted a patch for a very similar problem: https://github.com/ipython/ipython/pull/12208/files


---

Comment by mkoeppe created at 2020-04-14 19:41:51

Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.


---

Comment by tscrim created at 2020-07-07 02:57:44

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2020-07-07 02:57:44

LGTM.


---

Comment by vbraun created at 2020-07-10 19:34:26

Resolution: fixed
