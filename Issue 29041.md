# Issue 29041: Callable symbolic expressions should be allowed to have unicode identifiers

archive/issues_029041.json:
```json
{
    "body": "CC:  @tscrim\n\nKeywords: callable symbolic expression, unicode, preparse, preparser, preparse_calculus\n\nAs [reported on Ask SageMath](https://ask.sagemath.org/question/50095/error-when-using-non-ascii-characters-as-symbolic-function-name/):\n\n\n```\nsage: \u03bc(x) = x^2\n  File \"<ipython-input-20-93337e923470>\", line 1\n    \u03bc(x) = x**Integer(2)\n                        ^\nSyntaxError: can't assign to function call\n```\n\n\nThis is a bug in the preparser. Running\n\n\n```\nfrom sage.repl.preparse import preparse_calculus\npreparse_calculus??\n```\n\n\nshows that in order to find the identifier it uses a regex with the range `[a-zA-Z_]`, which is old-fashioned since 9.0.\n\nNote that there is no LaTeX issue here because callable symbolic expressions don't know their own names; the name is only used for the Python identifier.\n\nIssue created by migration from https://trac.sagemath.org/ticket/29278\n\n",
    "created_at": "2020-03-03T21:23:49Z",
    "labels": [
        "symbolics",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "Callable symbolic expressions should be allowed to have unicode identifiers",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29041",
    "user": "@rburing"
}
```
CC:  @tscrim

Keywords: callable symbolic expression, unicode, preparse, preparser, preparse_calculus

As [reported on Ask SageMath](https://ask.sagemath.org/question/50095/error-when-using-non-ascii-characters-as-symbolic-function-name/):


```
sage: μ(x) = x^2
  File "<ipython-input-20-93337e923470>", line 1
    μ(x) = x**Integer(2)
                        ^
SyntaxError: can't assign to function call
```


This is a bug in the preparser. Running


```
from sage.repl.preparse import preparse_calculus
preparse_calculus??
```


shows that in order to find the identifier it uses a regex with the range `[a-zA-Z_]`, which is old-fashioned since 9.0.

Note that there is no LaTeX issue here because callable symbolic expressions don't know their own names; the name is only used for the Python identifier.

Issue created by migration from https://trac.sagemath.org/ticket/29278





---

archive/issue_comments_411038.json:
```json
{
    "body": "Changing type from defect to enhancement.",
    "created_at": "2020-03-03T21:51:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29041#issuecomment-411038",
    "user": "@nbruin"
}
```

Changing type from defect to enhancement.



---

archive/issue_comments_411039.json:
```json
{
    "body": "It's not a really a bug. Perhaps it's not properly documented.\n\nIdentifier names that make it into SR should be very conservative, because they probably get shipped to all kinds of other interfaces -- by name! As pointed out in the ticket, the name used in the definition of a callable symbolic expression ends up only being used as a python identifier, so perhaps it's fine to relax the relevant regular expression.",
    "created_at": "2020-03-03T21:51:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29041#issuecomment-411039",
    "user": "@nbruin"
}
```

It's not a really a bug. Perhaps it's not properly documented.

Identifier names that make it into SR should be very conservative, because they probably get shipped to all kinds of other interfaces -- by name! As pointed out in the ticket, the name used in the definition of a callable symbolic expression ends up only being used as a python identifier, so perhaps it's fine to relax the relevant regular expression.



---

archive/issue_comments_411040.json:
```json
{
    "body": "Are you working on this? I have been looking into this a little bit and could create a branch.\n\nIMO, this is very much a bug. The preparser should have nothing to do with other interfaces. If a particular interface does not support unicode, it needs to be caught in that interface, not in the preparser.\n\nNote also that the following works just fine:\n\n```\nsage: a\u03bc(x) = x^2\n```\n\nThe problem only exists if the first character is not ASCII.",
    "created_at": "2020-03-03T22:07:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29041#issuecomment-411040",
    "user": "@mwageringel"
}
```

Are you working on this? I have been looking into this a little bit and could create a branch.

IMO, this is very much a bug. The preparser should have nothing to do with other interfaces. If a particular interface does not support unicode, it needs to be caught in that interface, not in the preparser.

Note also that the following works just fine:

```
sage: aμ(x) = x^2
```

The problem only exists if the first character is not ASCII.



---

archive/issue_comments_411041.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-03-04T21:37:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29041#issuecomment-411041",
    "user": "@mwageringel"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_411042.json:
```json
{
    "body": "I have updated all similar regular expressions in the preparser.\n\nThis also passes the tests with Python 2.\n----\nNew commits:",
    "created_at": "2020-03-04T21:37:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29041#issuecomment-411042",
    "user": "@mwageringel"
}
```

I have updated all similar regular expressions in the preparser.

This also passes the tests with Python 2.
----
New commits:



---

archive/issue_comments_411043.json:
```json
{
    "body": "Thanks for working on this! Some of the original regular expressions purposely do not include digits, because Python identifiers should not start with digits. This still needs to be taken into account (and perhaps tested).",
    "created_at": "2020-03-04T21:52:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29041#issuecomment-411043",
    "user": "@rburing"
}
```

Thanks for working on this! Some of the original regular expressions purposely do not include digits, because Python identifiers should not start with digits. This still needs to be taken into account (and perhaps tested).



---

archive/issue_comments_411044.json:
```json
{
    "body": "Replying to [comment:4 rburing]:\n> Some of the original regular expressions purposely do not include digits, because Python identifiers should not start with digits. This still needs to be taken into account (and perhaps tested).\n\nIn place of `[a-zA-Z_]`, I used `[^\\W\\d]` to account for that, which excludes numbers and non-alphanumeric characters, so effectively only letters and underscores remain (for reference: the [re docs](https://docs.python.org/3.7/library/re.html#regular-expression-syntax)).",
    "created_at": "2020-03-05T18:10:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29041#issuecomment-411044",
    "user": "@mwageringel"
}
```

Replying to [comment:4 rburing]:
> Some of the original regular expressions purposely do not include digits, because Python identifiers should not start with digits. This still needs to be taken into account (and perhaps tested).

In place of `[a-zA-Z_]`, I used `[^\W\d]` to account for that, which excludes numbers and non-alphanumeric characters, so effectively only letters and underscores remain (for reference: the [re docs](https://docs.python.org/3.7/library/re.html#regular-expression-syntax)).



---

archive/issue_comments_411045.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-03-06T18:43:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29041#issuecomment-411045",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_411046.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-03-07T19:19:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29041#issuecomment-411046",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_411047.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-03-29T19:42:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29041#issuecomment-411047",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_411048.json:
```json
{
    "body": "Rebased on top of #29391.\n\nBy the way, IPython has accepted a patch for a very similar problem: https://github.com/ipython/ipython/pull/12208/files",
    "created_at": "2020-03-29T19:44:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29041#issuecomment-411048",
    "user": "@mwageringel"
}
```

Rebased on top of #29391.

By the way, IPython has accepted a patch for a very similar problem: https://github.com/ipython/ipython/pull/12208/files



---

archive/issue_comments_411049.json:
```json
{
    "body": "Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.",
    "created_at": "2020-04-14T19:41:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29041#issuecomment-411049",
    "user": "@mkoeppe"
}
```

Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.



---

archive/issue_comments_411050.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-07-07T02:57:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29041#issuecomment-411050",
    "user": "@tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_411051.json:
```json
{
    "body": "LGTM.",
    "created_at": "2020-07-07T02:57:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29041#issuecomment-411051",
    "user": "@tscrim"
}
```

LGTM.



---

archive/issue_comments_411052.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-07-10T19:34:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29041#issuecomment-411052",
    "user": "@vbraun"
}
```

Resolution: fixed
