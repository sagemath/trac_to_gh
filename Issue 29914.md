# Issue 29914: Modularization of sagelib: Break out a separate package sage-meataxe

Issue created by migration from https://trac.sagemath.org/ticket/30151

Original creator: mkoeppe

Original creation time: 2020-07-15 21:46:10

CC:  simonking fbissey jhpalmieri dimpase

... in analogy of #29864 (sage-tdlib).


This is part of #29705: Meta-ticket: Modularize sagelib into separate distributions (distutils packages)


---

Comment by git created at 2020-10-16 18:57:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by SimonKing created at 2020-10-16 19:18:04

Can you elaborate on what is supposed to be done to use meataxe --- both as a C library, as collection of executables, and as optional Cython extension module?


---

Comment by mkoeppe created at 2020-10-16 19:58:52

spkg `meataxe` stays as is. It installs the C library and executables. No dependency on anything from Sage.

spkg `sagelib` will no longer conditionally build the Cython extension module.

Instead, the new spkg `sage_meataxe` will build the Cython extension module. It declares both `sagelib` and `meataxe` as a dependency.

`sage_meataxe`, in the implementation of this ticket, does not have a source tarball (note there is no `checksums.ini`). Instead, it is a "script" package, whose sources lie in `build/pkgs/sage_meataxe/src`.  It has the structure of a Python package (distribution), with `setup.py` doing the build and installation. The actual Cython sources remain in the `src/sage` tree (using symlinks).  (It is possible to build a pip-installable source distribution tarball as well, using the `spkg-src` script. Eventually, we will upload it to PyPI.)


---

Comment by SimonKing created at 2020-10-16 20:53:14

Replying to [comment:4 mkoeppe]:
> spkg `sagelib` will no longer conditionally build the Cython extension module.
> 
> Instead, the new spkg `sage_meataxe` will build the Cython extension module. It declares both `sagelib` and `meataxe` as a dependency.

So, in order to use it, one has to do `make sage_meataxe`, right? It would automatically install its dependency `meataxe`, would build the corresponding Cython extension module, AND would also build the documentation of the Cython extension module? And `sage -testall` would run the doctests from the corresponding Cython extension module if and only if sage_meataxe is installed, so that there is no need to mark all its tests as "optional"?

If the documentation and test suite would be taken care of, it would indeed be very helpful.


---

Comment by mkoeppe created at 2020-10-16 20:59:25

Replying to [comment:5 SimonKing]:
> Replying to [comment:4 mkoeppe]:
> > spkg `sagelib` will no longer conditionally build the Cython extension module.
> > 
> > Instead, the new spkg `sage_meataxe` will build the Cython extension module. It declares both `sagelib` and `meataxe` as a dependency.
> 
> So, in order to use it, one has to do `make sage_meataxe`, right? It would automatically install its dependency `meataxe`, would build the corresponding Cython extension module, AND would also build the documentation of the Cython extension module? 

Yes.

> And `sage -testall` would run the doctests from the corresponding Cython extension module if and only if sage_meataxe is installed, so that there is no need to mark all its tests as "optional"?

Yes, I would hope so. I have just created #30778 for this idea.


---

Comment by git created at 2020-10-17 02:00:50

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:


---

Comment by git created at 2020-10-17 02:20:16

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-10-17 02:27:23

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2020-10-17 02:32:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-10-17 02:33:26

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-10-17 03:14:57

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-10-17 04:31:55

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-10-17 04:33:16

The installation seems to work, but Sage cannot start because of a circular import related from `sage.matrix.args`. This needs a bit more work.


---

Comment by SimonKing created at 2020-10-17 11:34:44

#28711 previously depended on this ticket. However, because of giving a talk on p_group_cohomology at the next Sage Days, I am interested in getting p_group_cohomology up and running ASAP.

Therefore, I suggest to make this ticket depend on #28711, rather than the other way around. As soon as the circular import problem is solved, one can modify `SAGE_ROOT/build/pkgs/p_group_cohomology/dependencies` (same for any other package depending on meataxe, if there is any); I believe this change logically belongs here, because it is THIS ticket that makes the change in the `dependencies` files possible and necessary.


---

Comment by mkoeppe created at 2020-10-17 15:43:16

No objection here. This ticket certainly won't make it into Sage 9.2. (Not sure if #28711 can make it - it looks like Volker does not intend to merge non-"blocker" tickets.)


---

Comment by git created at 2020-10-17 17:15:03

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-10-17 18:00:08

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-10-17 18:01:14

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2020-10-17 18:01:14

Ready for review


---

Comment by git created at 2020-10-17 18:14:44

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-10-17 18:57:41

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-10-17 21:54:55

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-10-20 00:18:18

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-10-20 00:19:36

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-10-20 03:27:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-10-20 03:54:07

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-11-30 05:12:47

Changing keywords from "" to "sd111".


---

Comment by mkoeppe created at 2020-12-06 21:23:27

Changing status from needs_review to needs_work.


---

Comment by git created at 2020-12-09 05:39:22

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-02-13 20:51:01

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.


---

Comment by mkoeppe created at 2021-07-19 00:44:56

Setting a new milestone for this ticket based on a cursory review.


---

Comment by mkoeppe created at 2022-11-16 07:36:22

Changing status from needs_work to needs_review.


---

Comment by mkoeppe created at 2022-11-16 07:36:22

This is now done in #34346.


---

Comment by dimpase created at 2022-11-16 12:59:37

Changing status from needs_review to positive_review.
