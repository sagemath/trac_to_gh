# Issue 29914: Modularization of sagelib: Break out a separate package sage-meataxe

archive/issues_029914.json:
```json
{
    "body": "CC:  simonking fbissey jhpalmieri dimpase\n\n... in analogy of #29864 (sage-tdlib).\n\n\nThis is part of #29705: Meta-ticket: Modularize sagelib into separate distributions (distutils packages)\n\nIssue created by migration from https://trac.sagemath.org/ticket/30151\n\n",
    "created_at": "2020-07-15T21:46:10Z",
    "labels": [
        "packages: optional",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "Modularization of sagelib: Break out a separate package sage-meataxe",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29914",
    "user": "mkoeppe"
}
```
CC:  simonking fbissey jhpalmieri dimpase

... in analogy of #29864 (sage-tdlib).


This is part of #29705: Meta-ticket: Modularize sagelib into separate distributions (distutils packages)

Issue created by migration from https://trac.sagemath.org/ticket/30151





---

archive/issue_comments_424887.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-10-16T18:57:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29914#issuecomment-424887",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_424888.json:
```json
{
    "body": "Can you elaborate on what is supposed to be done to use meataxe --- both as a C library, as collection of executables, and as optional Cython extension module?",
    "created_at": "2020-10-16T19:18:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29914#issuecomment-424888",
    "user": "SimonKing"
}
```

Can you elaborate on what is supposed to be done to use meataxe --- both as a C library, as collection of executables, and as optional Cython extension module?



---

archive/issue_comments_424889.json:
```json
{
    "body": "spkg `meataxe` stays as is. It installs the C library and executables. No dependency on anything from Sage.\n\nspkg `sagelib` will no longer conditionally build the Cython extension module.\n\nInstead, the new spkg `sage_meataxe` will build the Cython extension module. It declares both `sagelib` and `meataxe` as a dependency.\n\n`sage_meataxe`, in the implementation of this ticket, does not have a source tarball (note there is no `checksums.ini`). Instead, it is a \"script\" package, whose sources lie in `build/pkgs/sage_meataxe/src`.  It has the structure of a Python package (distribution), with `setup.py` doing the build and installation. The actual Cython sources remain in the `src/sage` tree (using symlinks).  (It is possible to build a pip-installable source distribution tarball as well, using the `spkg-src` script. Eventually, we will upload it to PyPI.)",
    "created_at": "2020-10-16T19:58:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29914#issuecomment-424889",
    "user": "mkoeppe"
}
```

spkg `meataxe` stays as is. It installs the C library and executables. No dependency on anything from Sage.

spkg `sagelib` will no longer conditionally build the Cython extension module.

Instead, the new spkg `sage_meataxe` will build the Cython extension module. It declares both `sagelib` and `meataxe` as a dependency.

`sage_meataxe`, in the implementation of this ticket, does not have a source tarball (note there is no `checksums.ini`). Instead, it is a "script" package, whose sources lie in `build/pkgs/sage_meataxe/src`.  It has the structure of a Python package (distribution), with `setup.py` doing the build and installation. The actual Cython sources remain in the `src/sage` tree (using symlinks).  (It is possible to build a pip-installable source distribution tarball as well, using the `spkg-src` script. Eventually, we will upload it to PyPI.)



---

archive/issue_comments_424890.json:
```json
{
    "body": "Replying to [comment:4 mkoeppe]:\n> spkg `sagelib` will no longer conditionally build the Cython extension module.\n> \n> Instead, the new spkg `sage_meataxe` will build the Cython extension module. It declares both `sagelib` and `meataxe` as a dependency.\n\nSo, in order to use it, one has to do `make sage_meataxe`, right? It would automatically install its dependency `meataxe`, would build the corresponding Cython extension module, AND would also build the documentation of the Cython extension module? And `sage -testall` would run the doctests from the corresponding Cython extension module if and only if sage_meataxe is installed, so that there is no need to mark all its tests as \"optional\"?\n\nIf the documentation and test suite would be taken care of, it would indeed be very helpful.",
    "created_at": "2020-10-16T20:53:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29914#issuecomment-424890",
    "user": "SimonKing"
}
```

Replying to [comment:4 mkoeppe]:
> spkg `sagelib` will no longer conditionally build the Cython extension module.
> 
> Instead, the new spkg `sage_meataxe` will build the Cython extension module. It declares both `sagelib` and `meataxe` as a dependency.

So, in order to use it, one has to do `make sage_meataxe`, right? It would automatically install its dependency `meataxe`, would build the corresponding Cython extension module, AND would also build the documentation of the Cython extension module? And `sage -testall` would run the doctests from the corresponding Cython extension module if and only if sage_meataxe is installed, so that there is no need to mark all its tests as "optional"?

If the documentation and test suite would be taken care of, it would indeed be very helpful.



---

archive/issue_comments_424891.json:
```json
{
    "body": "Replying to [comment:5 SimonKing]:\n> Replying to [comment:4 mkoeppe]:\n> > spkg `sagelib` will no longer conditionally build the Cython extension module.\n> > \n> > Instead, the new spkg `sage_meataxe` will build the Cython extension module. It declares both `sagelib` and `meataxe` as a dependency.\n> \n> So, in order to use it, one has to do `make sage_meataxe`, right? It would automatically install its dependency `meataxe`, would build the corresponding Cython extension module, AND would also build the documentation of the Cython extension module? \n\nYes.\n\n> And `sage -testall` would run the doctests from the corresponding Cython extension module if and only if sage_meataxe is installed, so that there is no need to mark all its tests as \"optional\"?\n\nYes, I would hope so. I have just created #30778 for this idea.",
    "created_at": "2020-10-16T20:59:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29914#issuecomment-424891",
    "user": "mkoeppe"
}
```

Replying to [comment:5 SimonKing]:
> Replying to [comment:4 mkoeppe]:
> > spkg `sagelib` will no longer conditionally build the Cython extension module.
> > 
> > Instead, the new spkg `sage_meataxe` will build the Cython extension module. It declares both `sagelib` and `meataxe` as a dependency.
> 
> So, in order to use it, one has to do `make sage_meataxe`, right? It would automatically install its dependency `meataxe`, would build the corresponding Cython extension module, AND would also build the documentation of the Cython extension module? 

Yes.

> And `sage -testall` would run the doctests from the corresponding Cython extension module if and only if sage_meataxe is installed, so that there is no need to mark all its tests as "optional"?

Yes, I would hope so. I have just created #30778 for this idea.



---

archive/issue_comments_424892.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2020-10-17T02:00:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29914#issuecomment-424892",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_424893.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-10-17T02:20:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29914#issuecomment-424893",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_424894.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-10-17T02:27:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29914#issuecomment-424894",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_424895.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-10-17T02:32:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29914#issuecomment-424895",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_424896.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-10-17T02:33:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29914#issuecomment-424896",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_424897.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-10-17T03:14:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29914#issuecomment-424897",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_424898.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-10-17T04:31:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29914#issuecomment-424898",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_424899.json:
```json
{
    "body": "The installation seems to work, but Sage cannot start because of a circular import related from `sage.matrix.args`. This needs a bit more work.",
    "created_at": "2020-10-17T04:33:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29914#issuecomment-424899",
    "user": "mkoeppe"
}
```

The installation seems to work, but Sage cannot start because of a circular import related from `sage.matrix.args`. This needs a bit more work.



---

archive/issue_comments_424900.json:
```json
{
    "body": "#28711 previously depended on this ticket. However, because of giving a talk on p_group_cohomology at the next Sage Days, I am interested in getting p_group_cohomology up and running ASAP.\n\nTherefore, I suggest to make this ticket depend on #28711, rather than the other way around. As soon as the circular import problem is solved, one can modify `SAGE_ROOT/build/pkgs/p_group_cohomology/dependencies` (same for any other package depending on meataxe, if there is any); I believe this change logically belongs here, because it is THIS ticket that makes the change in the `dependencies` files possible and necessary.",
    "created_at": "2020-10-17T11:34:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29914#issuecomment-424900",
    "user": "SimonKing"
}
```

#28711 previously depended on this ticket. However, because of giving a talk on p_group_cohomology at the next Sage Days, I am interested in getting p_group_cohomology up and running ASAP.

Therefore, I suggest to make this ticket depend on #28711, rather than the other way around. As soon as the circular import problem is solved, one can modify `SAGE_ROOT/build/pkgs/p_group_cohomology/dependencies` (same for any other package depending on meataxe, if there is any); I believe this change logically belongs here, because it is THIS ticket that makes the change in the `dependencies` files possible and necessary.



---

archive/issue_comments_424901.json:
```json
{
    "body": "No objection here. This ticket certainly won't make it into Sage 9.2. (Not sure if #28711 can make it - it looks like Volker does not intend to merge non-\"blocker\" tickets.)",
    "created_at": "2020-10-17T15:43:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29914#issuecomment-424901",
    "user": "mkoeppe"
}
```

No objection here. This ticket certainly won't make it into Sage 9.2. (Not sure if #28711 can make it - it looks like Volker does not intend to merge non-"blocker" tickets.)



---

archive/issue_comments_424902.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-10-17T17:15:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29914#issuecomment-424902",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_424903.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-10-17T18:00:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29914#issuecomment-424903",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_424904.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-10-17T18:01:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29914#issuecomment-424904",
    "user": "mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_424905.json:
```json
{
    "body": "Ready for review",
    "created_at": "2020-10-17T18:01:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29914#issuecomment-424905",
    "user": "mkoeppe"
}
```

Ready for review



---

archive/issue_comments_424906.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-10-17T18:14:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29914#issuecomment-424906",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_424907.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-10-17T18:57:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29914#issuecomment-424907",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_424908.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-10-17T21:54:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29914#issuecomment-424908",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_424909.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-10-20T00:18:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29914#issuecomment-424909",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_424910.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-10-20T00:19:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29914#issuecomment-424910",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_424911.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-10-20T03:27:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29914#issuecomment-424911",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_424912.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-10-20T03:54:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29914#issuecomment-424912",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_424913.json:
```json
{
    "body": "Changing keywords from \"\" to \"sd111\".",
    "created_at": "2020-11-30T05:12:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29914#issuecomment-424913",
    "user": "mkoeppe"
}
```

Changing keywords from "" to "sd111".



---

archive/issue_comments_424914.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-12-06T21:23:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29914#issuecomment-424914",
    "user": "mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_424915.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-12-09T05:39:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29914#issuecomment-424915",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_424916.json:
```json
{
    "body": "Setting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-02-13T20:51:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29914#issuecomment-424916",
    "user": "mkoeppe"
}
```

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_comments_424917.json:
```json
{
    "body": "Setting a new milestone for this ticket based on a cursory review.",
    "created_at": "2021-07-19T00:44:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29914#issuecomment-424917",
    "user": "mkoeppe"
}
```

Setting a new milestone for this ticket based on a cursory review.



---

archive/issue_comments_424918.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-11-16T07:36:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29914#issuecomment-424918",
    "user": "mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_424919.json:
```json
{
    "body": "This is now done in #34346.",
    "created_at": "2022-11-16T07:36:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29914#issuecomment-424919",
    "user": "mkoeppe"
}
```

This is now done in #34346.



---

archive/issue_comments_424920.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-11-16T12:59:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29914#issuecomment-424920",
    "user": "dimpase"
}
```

Changing status from needs_review to positive_review.
