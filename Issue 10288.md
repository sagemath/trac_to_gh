# Issue 10288: Convenient history fetch facilities

Issue created by migration from Trac.

Original creator: klee

Original creation time: 2010-11-18 09:20:34

Assignee: was

Using Sage, you are missing a feature of the Magma command line interface. In Magma, if you enter a line found in history using up arrow key and then press down arrow key, then the next line in history is fetched. This feature allows you to fetch as many successive lines in history as you like. However, Sage does not have a similar feature. The [IPython](http://ipython.scipy.org/) command prompt uses the readline library (via pyreadline), which evidently does not support this feature. Magma has its own custom “readline-like” library, which does support this feature. (Since so many people have requested this feature, if anybody can figure out how to implement it, then such an implementation would certainly be welcome!)

This ticket addresses the above implementation.


---

Comment by klee created at 2010-11-18 09:22:51

From Chet Ramey: 
 ---------- 
 This is very similar to the operate-and-get-next feature bash adds to the readline interface.  I am not inclined to add this to readline in its current form because it manipulates state managed by the calling application (rl_startup_hook) and requires that state to be kept between calls to readline().  It's a feature that should be provided by the calling application -- it's implementation is not complicated.


---

Comment by klee created at 2010-11-18 09:24:12

A developer of R attempted to pull the part of the Bash source code 
 responsible for the "operate-and-get-next" feature into R interface. 
 See the following link: 


[http://r.789695.n4.nabble.com/readline-operate-and-get-next-td2317208...](http://r.789695.n4.nabble.com/readline-operate-and-get-next-td2317208...)(http://www.google.com/url?sa=D&q=http://r.789695.n4.nabble.com/readline-operate-and-get-next-td2317208.html&usg=AFQjCNHfXg4C5jEJFf6_Ti64UhWxS-UJZw) 



---

Comment by klee created at 2010-11-23 13:40:16

A preliminary version of the patch was uploaded. See the doc in the patch for how to bind the new readline commands with keys.

I am wondering how to doctest this module.

Things to do: add more comments and doctests.

I copied some programming logic from the Bash shell source files, in particular, from"bashline.c", and the GNU Readline source files, in particular from the file "misc.c". Check the copyright things, although I think there is no problem.


---

Comment by klee created at 2010-11-23 13:51:43

Note the last two commands in the patch implements the up and down arrow keys in Magma.


---

Comment by klee created at 2010-11-27 17:45:37

Changing status from new to needs_review.


---

Comment by klee created at 2011-04-28 09:37:26

Changing status from needs_review to needs_work.


---

Comment by klee created at 2011-04-29 00:35:55

This patch needs work as it does not work on Ubuntu machines. There is no problem with my Mac. On Ubuntu, the patch is compiled well, but produces "no symbol: history_length" error when it is imported on Sage startsup. Cython experts, please help me fix this problem.


---

Comment by klee created at 2012-02-12 19:17:34

Changing status from needs_work to needs_review.


---

Attachment

rebased on 4.8


---

Comment by klee created at 2012-02-12 19:19:36

Changing status from needs_review to needs_work.


---

Comment by klee created at 2012-02-13 00:02:54

I created the ticket #12503 duplicating this ticket, as the patchbot does not work for the patch uploaded here.

Further discussion on this ticket should be continued on #12503.


---

Comment by klee created at 2012-02-16 09:57:19

Changing status from needs_work to positive_review.


---

Comment by jdemeyer created at 2012-02-27 11:32:59

Resolution: duplicate
