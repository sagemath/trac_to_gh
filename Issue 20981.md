# Issue 20981: Making DisjointUnionEnumeratedSets check for FiniteEnumeratedSets when category is not set

Issue created by migration from https://trac.sagemath.org/ticket/21218

Original creator: andrew.mathas

Original creation time: 2016-08-11 05:20:10

CC:  sage-combinat




---

Comment by andrew.mathas created at 2016-08-11 05:29:43

Changing type from PLEASE CHANGE to enhancement.


---

Comment by andrew.mathas created at 2016-08-11 05:29:43

Changing status from new to needs_review.


---

Comment by andrew.mathas created at 2016-08-11 05:29:43

New commits:


---

Comment by andrew.mathas created at 2016-08-11 05:29:43

Changing component from PLEASE CHANGE to categories.


---

Comment by mderickx created at 2017-08-30 20:41:41

Changing status from needs_review to needs_work.


---

Comment by mderickx created at 2017-08-30 20:41:41

The family being a finite enumerated set is not enough to guarantee that the disjoint union is finite.  For example without this branch we have


```
sage: F = Family(range(10), lambda i: ZZ)
sage: D = DisjointUnionEnumeratedSets(F)
sage: F in FiniteEnumeratedSets()
True
sage: D in InfiniteEnumeratedSets()
True
sage: D.cardinality()
+Infinity
}}} 
but your patch will change this!!!

Actually the current code is also already buggy since just checking wether family.last() is infinite or not is not enough!

{{{
sage: F = Family(range(10), lambda i: ZZ if i==0 else Set([]))
sage: D in FiniteEnumeratedSets()
False
sage: F = Family(range(10), lambda i: ZZ if i==0 else Set([]))
sage: D = DisjointUnionEnumeratedSets(F)
sage: D in FiniteEnumeratedSets()
True
sage: D.cardinality()
+Infinity
}}}

So a correct implementation should check wether all elements in the union are finite and make a FiniteEnumeratedSet in this case and otherwise make an InfiniteEnumeratedSet


---

Comment by andrew.mathas created at 2017-08-31 01:19:31

As you say the current implementation is buggy, but this ticket has been sitting here for over a year without any one looking at it, so my motivation for working on this is low -- and in any case I can't at the moment because sage won't compile on my computer due to a skylake issue.
