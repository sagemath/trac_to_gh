# Issue 20981: Making DisjointUnionEnumeratedSets check for FiniteEnumeratedSets when category is not set

archive/issues_020981.json:
```json
{
    "body": "CC:  sage-combinat\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/21218\n\n",
    "created_at": "2016-08-11T05:20:10Z",
    "labels": [],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.4",
    "title": "Making DisjointUnionEnumeratedSets check for FiniteEnumeratedSets when category is not set",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/20981",
    "user": "https://github.com/AndrewAtLarge"
}
```
CC:  sage-combinat



Issue created by migration from https://trac.sagemath.org/ticket/21218





---

archive/issue_events_056579.json:
```json
{
    "actor": "https://github.com/AndrewAtLarge",
    "created_at": "2016-08-11T05:29:43Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/20981",
    "milestone": "sage-7.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20981#event-56579"
}
```



---

archive/issue_comments_290040.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to enhancement.",
    "created_at": "2016-08-11T05:29:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20981#issuecomment-290040",
    "user": "https://github.com/AndrewAtLarge"
}
```

Changing type from PLEASE CHANGE to enhancement.



---

archive/issue_comments_290041.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-08-11T05:29:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20981#issuecomment-290041",
    "user": "https://github.com/AndrewAtLarge"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_290042.json:
```json
{
    "body": "New commits:",
    "created_at": "2016-08-11T05:29:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20981#issuecomment-290042",
    "user": "https://github.com/AndrewAtLarge"
}
```

New commits:



---

archive/issue_comments_290043.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to categories.",
    "created_at": "2016-08-11T05:29:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20981#issuecomment-290043",
    "user": "https://github.com/AndrewAtLarge"
}
```

Changing component from PLEASE CHANGE to categories.



---

archive/issue_comments_290044.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-08-30T20:41:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20981#issuecomment-290044",
    "user": "https://github.com/koffie"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_290045.json:
```json
{
    "body": "The family being a finite enumerated set is not enough to guarantee that the disjoint union is finite.  For example without this branch we have\n\n```\nsage: F = Family(range(10), lambda i: ZZ)\nsage: D = DisjointUnionEnumeratedSets(F)\nsage: F in FiniteEnumeratedSets()\nTrue\nsage: D in InfiniteEnumeratedSets()\nTrue\nsage: D.cardinality()\n+Infinity\n``` \nbut your patch will change this!!!\n\nActually the current code is also already buggy since just checking wether family.last() is infinite or not is not enough!\n\n```\nsage: F = Family(range(10), lambda i: ZZ if i==0 else Set([]))\nsage: D in FiniteEnumeratedSets()\nFalse\nsage: F = Family(range(10), lambda i: ZZ if i==0 else Set([]))\nsage: D = DisjointUnionEnumeratedSets(F)\nsage: D in FiniteEnumeratedSets()\nTrue\nsage: D.cardinality()\n+Infinity\n```\n\nSo a correct implementation should check wether all elements in the union are finite and make a FiniteEnumeratedSet in this case and otherwise make an InfiniteEnumeratedSet",
    "created_at": "2017-08-30T20:41:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20981#issuecomment-290045",
    "user": "https://github.com/koffie"
}
```

The family being a finite enumerated set is not enough to guarantee that the disjoint union is finite.  For example without this branch we have

```
sage: F = Family(range(10), lambda i: ZZ)
sage: D = DisjointUnionEnumeratedSets(F)
sage: F in FiniteEnumeratedSets()
True
sage: D in InfiniteEnumeratedSets()
True
sage: D.cardinality()
+Infinity
``` 
but your patch will change this!!!

Actually the current code is also already buggy since just checking wether family.last() is infinite or not is not enough!

```
sage: F = Family(range(10), lambda i: ZZ if i==0 else Set([]))
sage: D in FiniteEnumeratedSets()
False
sage: F = Family(range(10), lambda i: ZZ if i==0 else Set([]))
sage: D = DisjointUnionEnumeratedSets(F)
sage: D in FiniteEnumeratedSets()
True
sage: D.cardinality()
+Infinity
```

So a correct implementation should check wether all elements in the union are finite and make a FiniteEnumeratedSet in this case and otherwise make an InfiniteEnumeratedSet



---

archive/issue_comments_290046.json:
```json
{
    "body": "As you say the current implementation is buggy, but this ticket has been sitting here for over a year without any one looking at it, so my motivation for working on this is low -- and in any case I can't at the moment because sage won't compile on my computer due to a skylake issue.",
    "created_at": "2017-08-31T01:19:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20981#issuecomment-290046",
    "user": "https://github.com/AndrewAtLarge"
}
```

As you say the current implementation is buggy, but this ticket has been sitting here for over a year without any one looking at it, so my motivation for working on this is low -- and in any case I can't at the moment because sage won't compile on my computer due to a skylake issue.
