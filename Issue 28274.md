# Issue 28274: use --disable-maintainer-mode for configuring autoconf'ed packages if possible

archive/issues_028274.json:
```json
{
    "body": "CC:  @embray @kiwifb @mkoeppe\n\nThe problem that autotools kick in while building autoconf'ed packages on HPC clusters and in similar unusual environments persists (there are old tickets dealing with it too, e.g. #12501), see e.g. this sage-devel [thread](https://groups.google.com/d/msg/sage-devel/lISFUY_eiA4/Cp2W8jA6BAAJ).\n\nAccording to [automake docs (AM_MAINTAINER_MODE)](https://www.gnu.org/software/automake/manual/html_node/maintainer_002dmode.html), configuring with `--disable-maintainer-mode` is the way to go if this macro is used.\nIt is e.g. the case for `gf2x`, its configure.ac has\n`configure.ac:AM_MAINTAINER_MODE([enable])` in. \n\nIssue created by migration from https://trac.sagemath.org/ticket/28511\n\n",
    "created_at": "2019-09-17T10:48:52Z",
    "labels": [
        "component: build"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.0",
    "title": "use --disable-maintainer-mode for configuring autoconf'ed packages if possible",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28274",
    "user": "https://github.com/dimpase"
}
```
CC:  @embray @kiwifb @mkoeppe

The problem that autotools kick in while building autoconf'ed packages on HPC clusters and in similar unusual environments persists (there are old tickets dealing with it too, e.g. #12501), see e.g. this sage-devel [thread](https://groups.google.com/d/msg/sage-devel/lISFUY_eiA4/Cp2W8jA6BAAJ).

According to [automake docs (AM_MAINTAINER_MODE)](https://www.gnu.org/software/automake/manual/html_node/maintainer_002dmode.html), configuring with `--disable-maintainer-mode` is the way to go if this macro is used.
It is e.g. the case for `gf2x`, its configure.ac has
`configure.ac:AM_MAINTAINER_MODE([enable])` in. 

Issue created by migration from https://trac.sagemath.org/ticket/28511





---

archive/issue_comments_398898.json:
```json
{
    "body": "Is it possible to boiler plate the disabling in the configure helper?",
    "created_at": "2019-09-17T10:50:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28274",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28274#issuecomment-398898",
    "user": "https://github.com/kiwifb"
}
```

Is it possible to boiler plate the disabling in the configure helper?



---

archive/issue_comments_398899.json:
```json
{
    "body": "probably one can test first if `--disable-maintainer-mode` does not error out, and then use it if it does not.",
    "created_at": "2019-09-17T11:24:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28274",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28274#issuecomment-398899",
    "user": "https://github.com/dimpase"
}
```

probably one can test first if `--disable-maintainer-mode` does not error out, and then use it if it does not.



---

archive/issue_comments_398900.json:
```json
{
    "body": "actually, `--disable-maintainer-mode` may be added unconditionally to an autoconf-produced `./configure`, as it would merely produce a warning if it's not understood.\n\nBut we also have hand-written `./configure`'s\nthat don't respect this rule, e.g. `flint`'s one errors out on any unrecognised option.\n\nSo one can do the following; check that\n\n```\n./configure --disable-foobarfoofoo --enable-option-checking=fatal 2>&1  | grep ^Usage\n```\n\nis empty, and in this case add `--disable-maintainer-mode` to the parameters of ./configure. Otherwise do not add it.\n\n---------\n\nWe can as well just try with `--disable-maintainer-mode` first, and if it fails (and it would fail quickly with non-conformant ./configure), try without it.\n\n-----------\nI'd go with the latter, what do you think?",
    "created_at": "2019-09-17T11:59:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28274",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28274#issuecomment-398900",
    "user": "https://github.com/dimpase"
}
```

actually, `--disable-maintainer-mode` may be added unconditionally to an autoconf-produced `./configure`, as it would merely produce a warning if it's not understood.

But we also have hand-written `./configure`'s
that don't respect this rule, e.g. `flint`'s one errors out on any unrecognised option.

So one can do the following; check that

```
./configure --disable-foobarfoofoo --enable-option-checking=fatal 2>&1  | grep ^Usage
```

is empty, and in this case add `--disable-maintainer-mode` to the parameters of ./configure. Otherwise do not add it.

---------

We can as well just try with `--disable-maintainer-mode` first, and if it fails (and it would fail quickly with non-conformant ./configure), try without it.

-----------
I'd go with the latter, what do you think?



---

archive/issue_comments_398901.json:
```json
{
    "body": "I presume it won't hurt to add `--disable-dependency-tracking` too, if only for a bit of a speed-up.",
    "created_at": "2019-09-17T12:16:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28274",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28274#issuecomment-398901",
    "user": "https://github.com/dimpase"
}
```

I presume it won't hurt to add `--disable-dependency-tracking` too, if only for a bit of a speed-up.



---

archive/issue_comments_398902.json:
```json
{
    "body": "New commits:",
    "created_at": "2019-09-17T18:43:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28274",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28274#issuecomment-398902",
    "user": "https://github.com/dimpase"
}
```

New commits:



---

archive/issue_comments_398903.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-09-17T18:43:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28274",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28274#issuecomment-398903",
    "user": "https://github.com/dimpase"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_398904.json:
```json
{
    "body": "I'm not sure the extra `./configure` call is necessary, since I generally discourage using `sdh_configure` for `configure` scripts that are not autoconf-generated.  But if you think it helps I won't fight it.",
    "created_at": "2019-09-18T10:02:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28274",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28274#issuecomment-398904",
    "user": "https://github.com/embray"
}
```

I'm not sure the extra `./configure` call is necessary, since I generally discourage using `sdh_configure` for `configure` scripts that are not autoconf-generated.  But if you think it helps I won't fight it.



---

archive/issue_comments_398905.json:
```json
{
    "body": "Replying to [comment:4 dimpase]:\n> I presume it won't hurt to add `--disable-dependency-tracking` too, if only for a bit of a speed-up.\n\nI understand `--disable-maintainer-mode` but what does this one do?\n\n+1 from me in any case.",
    "created_at": "2019-09-18T10:04:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28274",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28274#issuecomment-398905",
    "user": "https://github.com/embray"
}
```

Replying to [comment:4 dimpase]:
> I presume it won't hurt to add `--disable-dependency-tracking` too, if only for a bit of a speed-up.

I understand `--disable-maintainer-mode` but what does this one do?

+1 from me in any case.



---

archive/issue_comments_398906.json:
```json
{
    "body": "Replying to [comment:7 embray]:\n> Replying to [comment:4 dimpase]:\n> > I presume it won't hurt to add `--disable-dependency-tracking` too, if only for a bit of a speed-up.\n> \n> I understand `--disable-maintainer-mode` but what does this one do?\n\n`--disable-dependency-tracking` speeds up \"1-time\" builds, by not doing extra chasing of what needs to be rebuilt.\nAs our `spkg-install` calls are exactly this, \"1-time\" builds, then why not?\nhttps://www.gnu.org/software/automake/manual/html_node/Dependency-Tracking.html",
    "created_at": "2019-09-18T10:25:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28274",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28274#issuecomment-398906",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:7 embray]:
> Replying to [comment:4 dimpase]:
> > I presume it won't hurt to add `--disable-dependency-tracking` too, if only for a bit of a speed-up.
> 
> I understand `--disable-maintainer-mode` but what does this one do?

`--disable-dependency-tracking` speeds up "1-time" builds, by not doing extra chasing of what needs to be rebuilt.
As our `spkg-install` calls are exactly this, "1-time" builds, then why not?
https://www.gnu.org/software/automake/manual/html_node/Dependency-Tracking.html



---

archive/issue_comments_398907.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-09-18T10:42:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28274",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28274#issuecomment-398907",
    "user": "https://github.com/embray"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_398908.json:
```json
{
    "body": "I see--so this is another automake thing to track source file dependencies that aren't explicitly declared (e.g. external headers) IIUC.\n\nYes, clearly we disable that where possible :)",
    "created_at": "2019-09-18T10:42:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28274",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28274#issuecomment-398908",
    "user": "https://github.com/embray"
}
```

I see--so this is another automake thing to track source file dependencies that aren't explicitly declared (e.g. external headers) IIUC.

Yes, clearly we disable that where possible :)



---

archive/issue_comments_398909.json:
```json
{
    "body": "I did not test this, but I trust you did.  The change makes sense to me though.",
    "created_at": "2019-09-18T10:43:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28274",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28274#issuecomment-398909",
    "user": "https://github.com/embray"
}
```

I did not test this, but I trust you did.  The change makes sense to me though.



---

archive/issue_comments_398910.json:
```json
{
    "body": "author name missing",
    "created_at": "2019-09-18T11:51:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28274",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28274#issuecomment-398910",
    "user": "https://github.com/fchapoton"
}
```

author name missing



---

archive/issue_comments_398911.json:
```json
{
    "body": "moving milestone to 9.0 (after release of 8.9)",
    "created_at": "2019-09-30T08:12:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28274",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28274#issuecomment-398911",
    "user": "https://github.com/fchapoton"
}
```

moving milestone to 9.0 (after release of 8.9)



---

archive/issue_comments_398912.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-10-05T07:57:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28274",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28274#issuecomment-398912",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_026188.json:
```json
{
    "actor": "@vbraun",
    "created_at": "2019-10-05T07:57:46Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/28274",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28274#event-26188"
}
```
