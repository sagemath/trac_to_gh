# Issue 28274: use --disable-maintainer-mode for configuring autoconf'ed packages if possible

Issue created by migration from https://trac.sagemath.org/ticket/28511

Original creator: dimpase

Original creation time: 2019-09-17 10:48:52

CC:  embray fbissey mkoeppe

The problem that autotools kick in while building autoconf'ed packages on HPC clusters and in similar unusual environments persists (there are old tickets dealing with it too, e.g. #12501), see e.g. this sage-devel [thread](https://groups.google.com/d/msg/sage-devel/lISFUY_eiA4/Cp2W8jA6BAAJ).

According to [automake docs (AM_MAINTAINER_MODE)](https://www.gnu.org/software/automake/manual/html_node/maintainer_002dmode.html), configuring with `--disable-maintainer-mode` is the way to go if this macro is used.
It is e.g. the case for `gf2x`, its configure.ac has
`configure.ac:AM_MAINTAINER_MODE([enable])` in. 


---

Comment by fbissey created at 2019-09-17 10:50:43

Is it possible to boiler plate the disabling in the configure helper?


---

Comment by dimpase created at 2019-09-17 11:24:54

probably one can test first if `--disable-maintainer-mode` does not error out, and then use it if it does not.


---

Comment by dimpase created at 2019-09-17 11:59:08

actually, `--disable-maintainer-mode` may be added unconditionally to an autoconf-produced `./configure`, as it would merely produce a warning if it's not understood.

But we also have hand-written `./configure`'s
that don't respect this rule, e.g. `flint`'s one errors out on any unrecognised option.

So one can do the following; check that

```
./configure --disable-foobarfoofoo --enable-option-checking=fatal 2>&1  | grep ^Usage
```

is empty, and in this case add `--disable-maintainer-mode` to the parameters of ./configure. Otherwise do not add it.

---------

We can as well just try with `--disable-maintainer-mode` first, and if it fails (and it would fail quickly with non-conformant ./configure), try without it.

-----------
I'd go with the latter, what do you think?


---

Comment by dimpase created at 2019-09-17 12:16:40

I presume it won't hurt to add `--disable-dependency-tracking` too, if only for a bit of a speed-up.


---

Comment by dimpase created at 2019-09-17 18:43:55

New commits:


---

Comment by dimpase created at 2019-09-17 18:43:55

Changing status from new to needs_review.


---

Comment by embray created at 2019-09-18 10:02:20

I'm not sure the extra `./configure` call is necessary, since I generally discourage using `sdh_configure` for `configure` scripts that are not autoconf-generated.  But if you think it helps I won't fight it.


---

Comment by embray created at 2019-09-18 10:04:27

Replying to [comment:4 dimpase]:
> I presume it won't hurt to add `--disable-dependency-tracking` too, if only for a bit of a speed-up.

I understand `--disable-maintainer-mode` but what does this one do?

+1 from me in any case.


---

Comment by dimpase created at 2019-09-18 10:25:10

Replying to [comment:7 embray]:
> Replying to [comment:4 dimpase]:
> > I presume it won't hurt to add `--disable-dependency-tracking` too, if only for a bit of a speed-up.
> 
> I understand `--disable-maintainer-mode` but what does this one do?

`--disable-dependency-tracking` speeds up "1-time" builds, by not doing extra chasing of what needs to be rebuilt.
As our `spkg-install` calls are exactly this, "1-time" builds, then why not?
https://www.gnu.org/software/automake/manual/html_node/Dependency-Tracking.html


---

Comment by embray created at 2019-09-18 10:42:54

Changing status from needs_review to positive_review.


---

Comment by embray created at 2019-09-18 10:42:54

I see--so this is another automake thing to track source file dependencies that aren't explicitly declared (e.g. external headers) IIUC.

Yes, clearly we disable that where possible :)


---

Comment by embray created at 2019-09-18 10:43:31

I did not test this, but I trust you did.  The change makes sense to me though.


---

Comment by chapoton created at 2019-09-18 11:51:35

author name missing


---

Comment by chapoton created at 2019-09-30 08:12:27

moving milestone to 9.0 (after release of 8.9)


---

Comment by vbraun created at 2019-10-05 07:57:46

Resolution: fixed
