# Issue 22709: py3: work on unicode in lazy_import

Issue created by migration from https://trac.sagemath.org/ticket/22946

Original creator: chapoton

Original creation time: 2017-05-04 11:43:45

CC:  jdemeyer tscrim

because slicing of unicode strings is not allowed


---

Comment by chapoton created at 2017-05-04 11:44:11

Changing status from new to needs_review.


---

Comment by chapoton created at 2017-05-04 11:44:11

New commits:


---

Comment by chapoton created at 2017-05-04 11:44:23

Changing keywords from "" to "python3, unicode".


---

Comment by git created at 2017-05-04 11:57:06

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by chapoton created at 2017-05-04 17:53:48

bot is essentially green


---

Comment by tscrim created at 2017-05-04 19:43:09

Could you explain how importing `unicode_literal` allows you to use `unicode` in Python3? I would think you should use `unicode_literal`.


---

Comment by tscrim created at 2017-05-04 19:43:36

Also, is the spacing in the slices PEP8?


---

Comment by chapoton created at 2017-05-04 19:47:50

hmm, well. I have doubts, I must say.

Question 1: This is a pyx file. I nevertheless wonder whether cython understands "unicode" and "str" correctly in py2/py3 contexts

Question 2: I am sure for the +, not so sure about the :

I am only starting to try and touch the unicode question.. IMHO, this will be a large scale mess, maybe only marginally easier than the "cmp" mountain.


---

Comment by tscrim created at 2017-05-05 01:51:07

Question 1 is something Jeroen might be able to answer, I cannot. For Question 2, I would almost say not putting the spaces around the `+` as it looks somewhat strange. I more strongly disagree with the space after the `:` in a slice.

Hopefully the unicode problem won't be so pervasive as we don't use unicode in too many places.


---

Comment by git created at 2017-05-10 11:51:59

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2017-05-10 11:53:17

Jeroen, any comment ?


---

Comment by chapoton created at 2017-05-15 17:14:43

ping ?


---

Comment by tscrim created at 2017-05-15 21:02:02

Or could the import of `unicode_literals` be a change to `unicode` like `print_function` is to `print`?


---

Comment by tscrim created at 2017-05-16 03:36:16

Okay, so I've looked a little more into `unicode_literals`, and it is a global flag that makes all strings into unicode (i.e., is like doing `u'foo'`). I'm slightly worried about potential side effects (well, not on my system since I don't have unicode file paths), so is it strictly necessary to include it?

Then again, this is Cython code, so Python rules need not apply.


---

Comment by chapoton created at 2017-05-21 16:27:27

so, is there still some objection to the current state of the branch ? patchbot is green..


---

Comment by tscrim created at 2017-05-21 20:39:50

I am okay with the branch fundamentally, but I am still a little nervous. So this is a positive review, but I don't want to merge it in such a late beta (maybe the next will be an rc). Instead I would want this merged in 8.1.beta0.


---

Comment by jdemeyer created at 2017-05-22 07:58:44

To answer the questions above:

1. `from __future__ import unicode_literals` is like changing all strings in the sources from `"foo"` to `u"foo"`.

2. Cython does understand `str`, `bytes`, `unicode`, `basestring` in all Python versions.

Note that this conflicts with #22755.


---

Comment by git created at 2017-06-23 06:07:03

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2017-06-23 07:18:46

after merging with 8.0.b12, the branch is essentially empty. So I propose to set this to duplicate.


---

Comment by jdemeyer created at 2017-06-23 07:30:24

Resolution: duplicate
