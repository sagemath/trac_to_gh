# Issue 17131: Make pip a standard package

Issue created by migration from https://trac.sagemath.org/ticket/17368

Original creator: aapitzsch

Original creation time: 2014-11-19 14:43:02




---

Comment by git created at 2014-11-22 14:09:19

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tmonteil created at 2014-11-22 14:13:34

Changing status from new to needs_review.


---

Comment by git created at 2014-11-22 14:32:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by novoselt created at 2014-12-01 23:43:42

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2014-12-02 09:18:29


```
pip-1.5.6
====================================================
Setting up build directory for pip-1.5.6
Finished set up
****************************************************
Host system:
Linux tamiyo 3.7.10-gentoo #4 SMP PREEMPT Thu Oct 31 21:23:56 CET 2013 x86_64 Intel(R) Core(TM) i7-2640M CPU @ 2.80GHz GenuineIntel GNU/Linux
****************************************************
C compiler: gcc
C compiler version:
Using built-in specs.
COLLECT_GCC=/usr/x86_64-pc-linux-gnu/gcc-bin/4.6.4/gcc
COLLECT_LTO_WRAPPER=/usr/libexec/gcc/x86_64-pc-linux-gnu/4.6.4/lto-wrapper
Target: x86_64-pc-linux-gnu
Configured with: /var/tmp/portage/sys-devel/gcc-4.6.4/work/gcc-4.6.4/configure --host=x86_64-pc-linux-gnu --build=x86_64-pc-linux-gnu --prefix=/usr --bindir=/usr/x86_64-pc-linux-gnu/gcc-bin/4.6.4 --includedir=/usr/lib/gcc/x86_64-pc-linux-gnu/4.6.4/include --datadir=/usr/share/gcc-data/x86_64-pc-linux-gnu/4.6.4 --mandir=/usr/share/gcc-data/x86_64-pc-linux-gnu/4.6.4/man --infodir=/usr/share/gcc-data/x86_64-pc-linux-gnu/4.6.4/info --with-gxx-include-dir=/usr/lib/gcc/x86_64-pc-linux-gnu/4.6.4/include/g++-v4 --with-python-dir=/share/gcc-data/x86_64-pc-linux-gnu/4.6.4/python --enable-languages=c,c++,fortran --enable-obsolete --enable-secureplt --disable-werror --with-system-zlib --enable-nls --without-included-gettext --enable-checking=release --with-bugurl=https://bugs.gentoo.org/ --with-pkgversion='Gentoo 4.6.4 p1.2, pie-0.5.2' --enable-libstdcxx-time --enable-shared --enable-threads=posix --enable-__cxa_atexit --enable-clocale=gnu --enable-multilib --disable-altivec --disable-fixed-point --enable-targets=all --disable-libgcj --enable-libgomp --disable-libmudflap --disable-libssp --enable-lto --without-cloog --without-ppl
Thread model: posix
gcc version 4.6.4 (Gentoo 4.6.4 p1.2, pie-0.5.2) 
****************************************************
Traceback (most recent call last):
  File "setup.py", line 6, in <module>
    from setuptools import setup, find_packages
ImportError: No module named setuptools
```



---

Comment by jdemeyer created at 2014-12-02 09:18:29

Changing status from positive_review to needs_work.


---

Comment by nbruin created at 2014-12-03 09:05:43

Note that for pip to work, python must be built with OpenSSL support. Otherwise one gets

```
ImportError: cannot import name HTTPSHandler
```

So if we make pip a standard package, we would have to make OpenSSL a requirement for sage again (and/or use the openssl package for sage)


---

Comment by tmonteil created at 2014-12-03 09:10:24

Replying to [comment:6 jdemeyer]:
> pip-1.5.6
> [...]
> ImportError: No module named setuptools

Thanks for noticing, it worked for me and `setuptools` was not indicated as a dependency in `SPKG.txt`. I will fix this soon (but i am working on another branch from another version right now).


---

Comment by tmonteil created at 2014-12-03 09:15:30

Replying to [comment:7 nbruin]:
> Note that for pip to work, python must be built with OpenSSL support. Otherwise one gets
> {{{
> ImportError: cannot import name HTTPSHandler
> }}}
> So if we make pip a standard package, we would have to make OpenSSL a requirement for sage again (and/or use the openssl package for sage)

This is a more serious issue, since IIRC, `openssl` can not be a standard package because of licensing stuff (which i do not understand well). Do you know if `HTTPSHandler` works with other SSL implementations (e.g. gnuTLS) ?


---

Comment by nbruin created at 2014-12-03 16:34:53

Replying to [comment:9 tmonteil]:
> This is a more serious issue, since IIRC, `openssl` can not be a standard package because of licensing stuff (which i do not understand well). Do you know if `HTTPSHandler` works with other SSL implementations (e.g. gnuTLS) ?

It depends on whether python's standard "Lib/ssl.py" module can be made to work with another implementation. As far as I can tell, `Modules/_ssl.c` is the real implementation underneath and that file looks like it's wired into `openssl` (it imports its headers unconditionally without alternatives listed). There may exist drop-in replacements? It's the kind of module you do not want to take any chances with because of security.

Solution I see:
 - pip is not _essential_ for basic sage functionality, so while it's standard, its functioning can be conditional on recommended dependencies (rather than making them hard dependencies).
 - these dependencies can be met by a system-wide openssl install or by `sage -i openssl; make`

The big problem would probably be how we ship binaries, where "remaking" isn't an option. Can we just build WITH system openssl support and not include the shared library? Hopefully that would only lead to a fail at `import ssl`.


---

Comment by git created at 2014-12-08 13:11:58

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tmonteil created at 2014-12-09 17:36:10

Replying to [comment:10 nbruin]:
> The big problem would probably be how we ship binaries, where "remaking" isn't an option. Can we just build WITH system openssl support and not include the shared library? Hopefully that would only lead to a fail at `import ssl`.

If i understand correctly, official Sage binaries are built with the system's libssl-dev, so there should not be a problem for those (the user only have to install the libssl package from her distro to have it working).

It seems also that a similar dependency problem happens for ipython notebook:
https://groups.google.com/forum/#!topic/sage-release/1teX_pCj8w0
http://article.gmane.org/gmane.comp.mathematics.sage.release/2310


---

Comment by tmonteil created at 2014-12-09 17:36:10

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2014-12-09 18:02:41

Replying to [comment:10 nbruin]:
>  - pip is not _essential_ for basic sage functionality, so while it's standard, its functioning can be conditional on recommended dependencies (rather than making them hard dependencies).
This is true for the moment, but we have to ensure that this remains true, that we never use `pip` to install a standard package.


---

Comment by novoselt created at 2014-12-11 21:57:20

But part of the argument for having pip as standard is precisely to use it to install some of the packages, isn't it? Maybe openssl has to be made into a standard dependency. Both sagenb and ipython notebooks have issues without it already.


---

Comment by nbruin created at 2014-12-12 01:39:21

Replying to [comment:14 novoselt]:
> But part of the argument for having pip as standard is precisely to use it to install some of the packages, isn't it?

I'm not so sure it is. I certainly don't think it's desirable that building sage from a pre-downloaded tarball would need internet access to download further components. For one thing it would make it possible to get "failure to build sage due to inavailability of www.pypi.org", (or whatever error would result in if that were to happen).


---

Comment by novoselt created at 2014-12-12 01:58:40

It has functionality to install pre-downloaded packages. Perhaps there will be no need for security library for this use.


---

Comment by jdemeyer created at 2014-12-12 09:48:50

Replying to [comment:16 novoselt]:
> It has functionality to install pre-downloaded packages.
On the other hand, for pre-downloaded Python packages, usually a simple `python setup.py install` works, so there is no real gain from using `pip`. For standard packages, we already have a build system which works.

I thought the main motivation for `pip` was to be able to easily install _optional_ packages.


---

Comment by nbruin created at 2014-12-12 11:27:06

Replying to [comment:12 tmonteil]:
> If i understand correctly, official Sage binaries are built with the system's libssl-dev, so there should not be a problem for those (the user only have to install the libssl package from her distro to have it working).

Yet it is surprisingly easy to miss that dependency. My system (fedora) ended up having a system python where openssl works, but sage-python builds without its support. I would not have minded if the build would have warned me at the start that openssl support isn't present and/or offered to download the openssl.spkg.


---

Comment by jdemeyer created at 2014-12-13 08:10:05

Replying to [comment:18 nbruin]:
> I would not have minded if the build would have warned me at the start that openssl support isn't present and/or offered to download the openssl.spkg.
I would mind since I don't care about OpenSSL.

Anyway, back to the ticket: I'm testing the build now and if that works, it can be set back to positive_review.


---

Comment by jdemeyer created at 2014-12-13 08:12:58

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2014-12-16 13:57:19

Resolution: fixed
