# Issue 17131: Make pip a standard package

archive/issues_017131.json:
```json
{
    "body": "\n\nIssue created by migration from https://trac.sagemath.org/ticket/17368\n\n",
    "created_at": "2014-11-19T14:43:02Z",
    "labels": [
        "component: packages: standard"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.5",
    "title": "Make pip a standard package",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17131",
    "user": "https://github.com/a-andre"
}
```


Issue created by migration from https://trac.sagemath.org/ticket/17368





---

archive/issue_comments_227471.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-11-22T14:09:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17131",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17131#issuecomment-227471",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_227472.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-11-22T14:13:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17131",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17131#issuecomment-227472",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_227473.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-11-22T14:32:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17131",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17131#issuecomment-227473",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_227474.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-12-01T23:43:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17131",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17131#issuecomment-227474",
    "user": "https://github.com/novoselt"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_227475.json:
```json
{
    "body": "\n```\npip-1.5.6\n====================================================\nSetting up build directory for pip-1.5.6\nFinished set up\n****************************************************\nHost system:\nLinux tamiyo 3.7.10-gentoo #4 SMP PREEMPT Thu Oct 31 21:23:56 CET 2013 x86_64 Intel(R) Core(TM) i7-2640M CPU @ 2.80GHz GenuineIntel GNU/Linux\n****************************************************\nC compiler: gcc\nC compiler version:\nUsing built-in specs.\nCOLLECT_GCC=/usr/x86_64-pc-linux-gnu/gcc-bin/4.6.4/gcc\nCOLLECT_LTO_WRAPPER=/usr/libexec/gcc/x86_64-pc-linux-gnu/4.6.4/lto-wrapper\nTarget: x86_64-pc-linux-gnu\nConfigured with: /var/tmp/portage/sys-devel/gcc-4.6.4/work/gcc-4.6.4/configure --host=x86_64-pc-linux-gnu --build=x86_64-pc-linux-gnu --prefix=/usr --bindir=/usr/x86_64-pc-linux-gnu/gcc-bin/4.6.4 --includedir=/usr/lib/gcc/x86_64-pc-linux-gnu/4.6.4/include --datadir=/usr/share/gcc-data/x86_64-pc-linux-gnu/4.6.4 --mandir=/usr/share/gcc-data/x86_64-pc-linux-gnu/4.6.4/man --infodir=/usr/share/gcc-data/x86_64-pc-linux-gnu/4.6.4/info --with-gxx-include-dir=/usr/lib/gcc/x86_64-pc-linux-gnu/4.6.4/include/g++-v4 --with-python-dir=/share/gcc-data/x86_64-pc-linux-gnu/4.6.4/python --enable-languages=c,c++,fortran --enable-obsolete --enable-secureplt --disable-werror --with-system-zlib --enable-nls --without-included-gettext --enable-checking=release --with-bugurl=https://bugs.gentoo.org/ --with-pkgversion='Gentoo 4.6.4 p1.2, pie-0.5.2' --enable-libstdcxx-time --enable-shared --enable-threads=posix --enable-__cxa_atexit --enable-clocale=gnu --enable-multilib --disable-altivec --disable-fixed-point --enable-targets=all --disable-libgcj --enable-libgomp --disable-libmudflap --disable-libssp --enable-lto --without-cloog --without-ppl\nThread model: posix\ngcc version 4.6.4 (Gentoo 4.6.4 p1.2, pie-0.5.2) \n****************************************************\nTraceback (most recent call last):\n  File \"setup.py\", line 6, in <module>\n    from setuptools import setup, find_packages\nImportError: No module named setuptools\n```\n",
    "created_at": "2014-12-02T09:18:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17131",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17131#issuecomment-227475",
    "user": "https://github.com/jdemeyer"
}
```


```
pip-1.5.6
====================================================
Setting up build directory for pip-1.5.6
Finished set up
****************************************************
Host system:
Linux tamiyo 3.7.10-gentoo #4 SMP PREEMPT Thu Oct 31 21:23:56 CET 2013 x86_64 Intel(R) Core(TM) i7-2640M CPU @ 2.80GHz GenuineIntel GNU/Linux
****************************************************
C compiler: gcc
C compiler version:
Using built-in specs.
COLLECT_GCC=/usr/x86_64-pc-linux-gnu/gcc-bin/4.6.4/gcc
COLLECT_LTO_WRAPPER=/usr/libexec/gcc/x86_64-pc-linux-gnu/4.6.4/lto-wrapper
Target: x86_64-pc-linux-gnu
Configured with: /var/tmp/portage/sys-devel/gcc-4.6.4/work/gcc-4.6.4/configure --host=x86_64-pc-linux-gnu --build=x86_64-pc-linux-gnu --prefix=/usr --bindir=/usr/x86_64-pc-linux-gnu/gcc-bin/4.6.4 --includedir=/usr/lib/gcc/x86_64-pc-linux-gnu/4.6.4/include --datadir=/usr/share/gcc-data/x86_64-pc-linux-gnu/4.6.4 --mandir=/usr/share/gcc-data/x86_64-pc-linux-gnu/4.6.4/man --infodir=/usr/share/gcc-data/x86_64-pc-linux-gnu/4.6.4/info --with-gxx-include-dir=/usr/lib/gcc/x86_64-pc-linux-gnu/4.6.4/include/g++-v4 --with-python-dir=/share/gcc-data/x86_64-pc-linux-gnu/4.6.4/python --enable-languages=c,c++,fortran --enable-obsolete --enable-secureplt --disable-werror --with-system-zlib --enable-nls --without-included-gettext --enable-checking=release --with-bugurl=https://bugs.gentoo.org/ --with-pkgversion='Gentoo 4.6.4 p1.2, pie-0.5.2' --enable-libstdcxx-time --enable-shared --enable-threads=posix --enable-__cxa_atexit --enable-clocale=gnu --enable-multilib --disable-altivec --disable-fixed-point --enable-targets=all --disable-libgcj --enable-libgomp --disable-libmudflap --disable-libssp --enable-lto --without-cloog --without-ppl
Thread model: posix
gcc version 4.6.4 (Gentoo 4.6.4 p1.2, pie-0.5.2) 
****************************************************
Traceback (most recent call last):
  File "setup.py", line 6, in <module>
    from setuptools import setup, find_packages
ImportError: No module named setuptools
```




---

archive/issue_comments_227476.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2014-12-02T09:18:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17131",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17131#issuecomment-227476",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_227477.json:
```json
{
    "body": "Note that for pip to work, python must be built with OpenSSL support. Otherwise one gets\n\n```\nImportError: cannot import name HTTPSHandler\n```\n\nSo if we make pip a standard package, we would have to make OpenSSL a requirement for sage again (and/or use the openssl package for sage)",
    "created_at": "2014-12-03T09:05:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17131",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17131#issuecomment-227477",
    "user": "https://github.com/nbruin"
}
```

Note that for pip to work, python must be built with OpenSSL support. Otherwise one gets

```
ImportError: cannot import name HTTPSHandler
```

So if we make pip a standard package, we would have to make OpenSSL a requirement for sage again (and/or use the openssl package for sage)



---

archive/issue_comments_227478.json:
```json
{
    "body": "Replying to [comment:6 jdemeyer]:\n> pip-1.5.6\n> [...]\n> ImportError: No module named setuptools\n\nThanks for noticing, it worked for me and `setuptools` was not indicated as a dependency in `SPKG.txt`. I will fix this soon (but i am working on another branch from another version right now).",
    "created_at": "2014-12-03T09:10:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17131",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17131#issuecomment-227478",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Replying to [comment:6 jdemeyer]:
> pip-1.5.6
> [...]
> ImportError: No module named setuptools

Thanks for noticing, it worked for me and `setuptools` was not indicated as a dependency in `SPKG.txt`. I will fix this soon (but i am working on another branch from another version right now).



---

archive/issue_comments_227479.json:
```json
{
    "body": "Replying to [comment:7 nbruin]:\n> Note that for pip to work, python must be built with OpenSSL support. Otherwise one gets\n> {{{\n> ImportError: cannot import name HTTPSHandler\n> }}}\n> So if we make pip a standard package, we would have to make OpenSSL a requirement for sage again (and/or use the openssl package for sage)\n\nThis is a more serious issue, since IIRC, `openssl` can not be a standard package because of licensing stuff (which i do not understand well). Do you know if `HTTPSHandler` works with other SSL implementations (e.g. gnuTLS) ?",
    "created_at": "2014-12-03T09:15:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17131",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17131#issuecomment-227479",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Replying to [comment:7 nbruin]:
> Note that for pip to work, python must be built with OpenSSL support. Otherwise one gets
> {{{
> ImportError: cannot import name HTTPSHandler
> }}}
> So if we make pip a standard package, we would have to make OpenSSL a requirement for sage again (and/or use the openssl package for sage)

This is a more serious issue, since IIRC, `openssl` can not be a standard package because of licensing stuff (which i do not understand well). Do you know if `HTTPSHandler` works with other SSL implementations (e.g. gnuTLS) ?



---

archive/issue_comments_227480.json:
```json
{
    "body": "Replying to [comment:9 tmonteil]:\n> This is a more serious issue, since IIRC, `openssl` can not be a standard package because of licensing stuff (which i do not understand well). Do you know if `HTTPSHandler` works with other SSL implementations (e.g. gnuTLS) ?\n\nIt depends on whether python's standard \"Lib/ssl.py\" module can be made to work with another implementation. As far as I can tell, `Modules/_ssl.c` is the real implementation underneath and that file looks like it's wired into `openssl` (it imports its headers unconditionally without alternatives listed). There may exist drop-in replacements? It's the kind of module you do not want to take any chances with because of security.\n\nSolution I see:\n- pip is not *essential* for basic sage functionality, so while it's standard, its functioning can be conditional on recommended dependencies (rather than making them hard dependencies).\n- these dependencies can be met by a system-wide openssl install or by `sage -i openssl; make`\n\nThe big problem would probably be how we ship binaries, where \"remaking\" isn't an option. Can we just build WITH system openssl support and not include the shared library? Hopefully that would only lead to a fail at `import ssl`.",
    "created_at": "2014-12-03T16:34:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17131",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17131#issuecomment-227480",
    "user": "https://github.com/nbruin"
}
```

Replying to [comment:9 tmonteil]:
> This is a more serious issue, since IIRC, `openssl` can not be a standard package because of licensing stuff (which i do not understand well). Do you know if `HTTPSHandler` works with other SSL implementations (e.g. gnuTLS) ?

It depends on whether python's standard "Lib/ssl.py" module can be made to work with another implementation. As far as I can tell, `Modules/_ssl.c` is the real implementation underneath and that file looks like it's wired into `openssl` (it imports its headers unconditionally without alternatives listed). There may exist drop-in replacements? It's the kind of module you do not want to take any chances with because of security.

Solution I see:
- pip is not *essential* for basic sage functionality, so while it's standard, its functioning can be conditional on recommended dependencies (rather than making them hard dependencies).
- these dependencies can be met by a system-wide openssl install or by `sage -i openssl; make`

The big problem would probably be how we ship binaries, where "remaking" isn't an option. Can we just build WITH system openssl support and not include the shared library? Hopefully that would only lead to a fail at `import ssl`.



---

archive/issue_comments_227481.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-12-08T13:11:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17131",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17131#issuecomment-227481",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_227482.json:
```json
{
    "body": "Replying to [comment:10 nbruin]:\n> The big problem would probably be how we ship binaries, where \"remaking\" isn't an option. Can we just build WITH system openssl support and not include the shared library? Hopefully that would only lead to a fail at `import ssl`.\n\nIf i understand correctly, official Sage binaries are built with the system's libssl-dev, so there should not be a problem for those (the user only have to install the libssl package from her distro to have it working).\n\nIt seems also that a similar dependency problem happens for ipython notebook:\nhttps://groups.google.com/forum/#!topic/sage-release/1teX_pCj8w0\nhttp://article.gmane.org/gmane.comp.mathematics.sage.release/2310",
    "created_at": "2014-12-09T17:36:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17131",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17131#issuecomment-227482",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Replying to [comment:10 nbruin]:
> The big problem would probably be how we ship binaries, where "remaking" isn't an option. Can we just build WITH system openssl support and not include the shared library? Hopefully that would only lead to a fail at `import ssl`.

If i understand correctly, official Sage binaries are built with the system's libssl-dev, so there should not be a problem for those (the user only have to install the libssl package from her distro to have it working).

It seems also that a similar dependency problem happens for ipython notebook:
https://groups.google.com/forum/#!topic/sage-release/1teX_pCj8w0
http://article.gmane.org/gmane.comp.mathematics.sage.release/2310



---

archive/issue_comments_227483.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-12-09T17:36:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17131",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17131#issuecomment-227483",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_227484.json:
```json
{
    "body": "Replying to [comment:10 nbruin]:\n>  - pip is not *essential* for basic sage functionality, so while it's standard, its functioning can be conditional on recommended dependencies (rather than making them hard dependencies).\nThis is true for the moment, but we have to ensure that this remains true, that we never use `pip` to install a standard package.",
    "created_at": "2014-12-09T18:02:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17131",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17131#issuecomment-227484",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:10 nbruin]:
>  - pip is not *essential* for basic sage functionality, so while it's standard, its functioning can be conditional on recommended dependencies (rather than making them hard dependencies).
This is true for the moment, but we have to ensure that this remains true, that we never use `pip` to install a standard package.



---

archive/issue_comments_227485.json:
```json
{
    "body": "But part of the argument for having pip as standard is precisely to use it to install some of the packages, isn't it? Maybe openssl has to be made into a standard dependency. Both sagenb and ipython notebooks have issues without it already.",
    "created_at": "2014-12-11T21:57:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17131",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17131#issuecomment-227485",
    "user": "https://github.com/novoselt"
}
```

But part of the argument for having pip as standard is precisely to use it to install some of the packages, isn't it? Maybe openssl has to be made into a standard dependency. Both sagenb and ipython notebooks have issues without it already.



---

archive/issue_comments_227486.json:
```json
{
    "body": "Replying to [comment:14 novoselt]:\n> But part of the argument for having pip as standard is precisely to use it to install some of the packages, isn't it?\n\nI'm not so sure it is. I certainly don't think it's desirable that building sage from a pre-downloaded tarball would need internet access to download further components. For one thing it would make it possible to get \"failure to build sage due to inavailability of www.pypi.org\", (or whatever error would result in if that were to happen).",
    "created_at": "2014-12-12T01:39:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17131",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17131#issuecomment-227486",
    "user": "https://github.com/nbruin"
}
```

Replying to [comment:14 novoselt]:
> But part of the argument for having pip as standard is precisely to use it to install some of the packages, isn't it?

I'm not so sure it is. I certainly don't think it's desirable that building sage from a pre-downloaded tarball would need internet access to download further components. For one thing it would make it possible to get "failure to build sage due to inavailability of www.pypi.org", (or whatever error would result in if that were to happen).



---

archive/issue_comments_227487.json:
```json
{
    "body": "It has functionality to install pre-downloaded packages. Perhaps there will be no need for security library for this use.",
    "created_at": "2014-12-12T01:58:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17131",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17131#issuecomment-227487",
    "user": "https://github.com/novoselt"
}
```

It has functionality to install pre-downloaded packages. Perhaps there will be no need for security library for this use.



---

archive/issue_comments_227488.json:
```json
{
    "body": "Replying to [comment:16 novoselt]:\n> It has functionality to install pre-downloaded packages.\nOn the other hand, for pre-downloaded Python packages, usually a simple `python setup.py install` works, so there is no real gain from using `pip`. For standard packages, we already have a build system which works.\n\nI thought the main motivation for `pip` was to be able to easily install *optional* packages.",
    "created_at": "2014-12-12T09:48:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17131",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17131#issuecomment-227488",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:16 novoselt]:
> It has functionality to install pre-downloaded packages.
On the other hand, for pre-downloaded Python packages, usually a simple `python setup.py install` works, so there is no real gain from using `pip`. For standard packages, we already have a build system which works.

I thought the main motivation for `pip` was to be able to easily install *optional* packages.



---

archive/issue_comments_227489.json:
```json
{
    "body": "Replying to [comment:12 tmonteil]:\n> If i understand correctly, official Sage binaries are built with the system's libssl-dev, so there should not be a problem for those (the user only have to install the libssl package from her distro to have it working).\n\nYet it is surprisingly easy to miss that dependency. My system (fedora) ended up having a system python where openssl works, but sage-python builds without its support. I would not have minded if the build would have warned me at the start that openssl support isn't present and/or offered to download the openssl.spkg.",
    "created_at": "2014-12-12T11:27:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17131",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17131#issuecomment-227489",
    "user": "https://github.com/nbruin"
}
```

Replying to [comment:12 tmonteil]:
> If i understand correctly, official Sage binaries are built with the system's libssl-dev, so there should not be a problem for those (the user only have to install the libssl package from her distro to have it working).

Yet it is surprisingly easy to miss that dependency. My system (fedora) ended up having a system python where openssl works, but sage-python builds without its support. I would not have minded if the build would have warned me at the start that openssl support isn't present and/or offered to download the openssl.spkg.



---

archive/issue_comments_227490.json:
```json
{
    "body": "Replying to [comment:18 nbruin]:\n> I would not have minded if the build would have warned me at the start that openssl support isn't present and/or offered to download the openssl.spkg.\nI would mind since I don't care about OpenSSL.\n\nAnyway, back to the ticket: I'm testing the build now and if that works, it can be set back to positive_review.",
    "created_at": "2014-12-13T08:10:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17131",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17131#issuecomment-227490",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:18 nbruin]:
> I would not have minded if the build would have warned me at the start that openssl support isn't present and/or offered to download the openssl.spkg.
I would mind since I don't care about OpenSSL.

Anyway, back to the ticket: I'm testing the build now and if that works, it can be set back to positive_review.



---

archive/issue_comments_227491.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-12-13T08:12:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17131",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17131#issuecomment-227491",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_016555.json:
```json
{
    "actor": "@vbraun",
    "created_at": "2014-12-16T13:57:19Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/17131",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17131#event-16555"
}
```



---

archive/issue_comments_227492.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-12-16T13:57:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17131",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17131#issuecomment-227492",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
