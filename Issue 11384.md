# Issue 11384: Linear transformations, built from free module morphisms

Issue created by migration from https://trac.sagemath.org/ticket/11556

Original creator: rbeezer

Original creation time: 2011-06-30 04:33:27

Assignee: jason, was

CC:  jason

This patch introduces a new class, and related support, for linear transformations, designed to distinguish them from free module morphisms.  There will also be an easy-to-use constructor for beginners.


---

Attachment

Safe-keeping patch


---

Comment by rbeezer created at 2011-06-30 04:42:48

Patch is mostly up for safe-keeping.

(a) Passes most tests in `sage/modules`, failures are just output formatting.

(b) Functional, see module-level docs for `vector_space_homspace.py`.

(c) `vector_space_morphisms.py` remains to be overhauled - significant module-level documentation, a friendly constructor, and general touch-up.

(d) Need to add two new files to the overall reference documentation.


---

Attachment

Working patch, needs doctests, here for safe-keeping


---

Comment by rbeezer created at 2011-07-26 23:42:06

Changing status from new to needs_review.


---

Attachment


---

Comment by rbeezer created at 2011-07-26 23:45:19

Ready for review.

Feeding the patchbot:

Depends #11552, #11553

Apply trac_11556-linear-transformations-v3.patch


---

Attachment

v4 patch adds making full-spelling aliases for minpoly and charpoly of free module morphisms, in line with the nomenclature for matrices.


---

Comment by mraum created at 2011-08-16 17:51:47

Hi Robert,

There are very few changes that I propose for this patch. Sorry, for not making them myself, but I somehow happened to lack time again.

1. Add newline at the end of free_module_morphism.py.
2. In vector_space_morphism.py l.475f it is not clear what side refers to. Delete the sentence?
3. l. 639 of the same file contains a typo.
4. l. 689ff do the imports globally. If for conflicts you cannot move the import statements to the file's head, move at least as many as you can.
5. l. 756ff is indeed no sufficient to check for linearity. Is there a specific reason why you don't use is_polynomial()? Then check the degree and you are fine.
6. l. 775 do you want to keep that line or rather merge with l. 732?
7. l. 856 move this import if possible

With these very minor changes made, this ticket deserves a positive review.


---

Comment by rbeezer created at 2011-08-18 00:02:26

Replying to [comment:5 mraum]:

> 2. In vector_space_morphism.py l.475f it is not clear what side refers to.
> Delete the sentence?

Actual output from `_repr_()` once made it clearer, but I trimmed the amount of output later.  I will expand the sentence.

> 5. l. 756ff is indeed no sufficient to check for linearity. Is there a
> specific reason why you don't use is_polynomial()? Then check the degree
> and you are fine.

I did not think I could fully protect against all possible symbolic expressions sneaking through.  But I had not thought about  is_polynomial()  which sounds like a good idea.

> 6. l. 775 do you want to keep that line or rather merge with l. 732?

Mistaken leftover from various attempts to get unique parents.  ;-)

> 7. l. 856 move this import if possible

Generally:  I did some reading a few months ago about imports, and got the impression that there was very little cost to placing within a method a statement like


```
import foo.bar
```


and then subsequently calling as


```
answer = foo.bar.stuff()
```


This is not exactly what is happening at l. 856, but on other tickets, you have suggested moving imports.  What is the best strategy?  I thought in module headers it would count against startuptime?  Guess I'm just confused on what is best.

Thanks for all the help on all these tickets.  It is really good to see them all getting wrapped up.

Rob


---

Comment by mraum created at 2011-08-18 16:21:38

Concerning the imports and the performance, the following link might help: 
http://stackoverflow.com/questions/477096/python-import-coding-style

It exposes my suggestion as premature, and if you like to keep the imports as they are, do so.


---

Comment by rbeezer created at 2011-08-18 17:34:51

Hi Martin,

Caught me just in time on the imports.  Thanks for the link, that was helpful and confirmed my understanding from before.  I can do a bit of cleanup on the imports, and will move one that is used twice to the top of the file.  Otherwise, I will largely leave all those imports in the constructor since I think it makes the rest of the module easier to read with all those segregated.

I'm not sure `is_polynomial()` is going to work.  Consider:


```
sage: var('x y')
(x, y)
sage: g(x, y) = x*y
sage: g.is_polynomial(x)
True
sage: g.is_polynomial(y)
True
sage: g.degree(x)
1
sage: g.degree(y)
1
```


I think I can do worse, with negative and/or fractional exponents.  I'm open to ideas, but I guess I'm back to feeling there is no good way to confirm an arbitrary (callable) symbolic expression as being multivariate linear (including no constant term).  Will post a patch of changes in a few minutes, or later today.

Rob


---

Attachment


---

Comment by rbeezer created at 2011-08-18 17:41:40

"edits" patch addresses all of the reviewer suggestions, except linearity testing.  I'm open to trying new things to improve error-checking for linear function input.


---

Comment by mraum created at 2011-08-19 07:32:13

There is one thing left. Sorry, for this, but I probably wasn't very precise. In 2. you added a bit more explanation, but I was referring to the fact that the keyword side only influences matrices.  Many lines above there is one example that demonstrates how it works. The sentence that I referred to is placed before a series of examples dealing with lambda expressions and symbolic functions.
Do I get this wrong?

Concerning the linear polynomials you are probably right. I thought about something like extracting linear coefficients and then trying to recombine them. But that would have a great impact on performance. Also, lambda expressions cannot be tested for linearity either.


---

Attachment


---

Comment by rbeezer created at 2011-08-19 16:56:59

Replying to [comment:10 mraum]:
> Do I get this wrong?

No, my mistake.  Sorry about that.  I thought the examples following used the `side` keyword, but obviously I did not look very carefully.

"edits-v2" patch just deletes the sentence, but has some discussion elsewhere about the side.  So I think this is ready for review now.


---

Comment by mraum created at 2011-08-20 13:48:58

Changing status from needs_review to positive_review.


---

Attachment

Great! I only changed one type (one -> on), thus the new patch.


---

Comment by leif created at 2011-09-08 14:57:16

Replying to [comment:12 mraum]:
> Great! I only changed one type (one -> on), thus the new patch.

And the underscore in the filename to a hyphen... ;-)


---

Comment by leif created at 2011-09-12 12:37:19

Or maybe the patches are out of sync with their dependencies.


---

Comment by leif created at 2011-09-12 12:37:19

Changing status from positive_review to needs_work.


---

Comment by rbeezer created at 2011-09-13 00:16:49

Replying to [comment:15 leif]:
> Or maybe the patches are out of sync with their dependencies.

Thanks, Leif.  I'm taking a short break from Sage work, but will attend to the easy ones (like this rebase) very soon.  I've got a couple outstanding items on tickets you've touched, but feel free to ping me on anything critical.  (I need to start by building the latest alpha!)

Thanks for your work as release manager.


---

Attachment

A variety of doctests were fixed on #10793 and I fixed them too here, since code here was more strict than before and picked up the same error.  So hunk failures were "correct" since they were not needed with #10793 merged.  v5 version of main patch mostly just re-exports the v4 version without the failures.  I had to fix one hunk by hand where my changes were a mix of #10793 changes and truly-new changes.  Passes tests on affected files and sage/modules.

I will mark this "needs review" though I am not sure that is strictly needed.  Feel free to approve my rebase as not needing review.  (Rebase is against 4.7.2.alpha2.)  I'll rebase #11553 which is just a single fuzz warning.


---

Comment by rbeezer created at 2011-09-14 04:23:41

Changing status from needs_work to needs_review.


---

Comment by chapoton created at 2011-10-05 18:24:43

Trying to help the build bot

Apply trac_11556-linear-transformations-v5.patch trac-11556-linear-transformations-edits-v3.patch


---

Comment by jason created at 2011-11-23 16:06:55

What should be reviewed?  Just the rebase?


---

Comment by rbeezer created at 2011-11-23 16:56:11

Replying to [comment:19 jason]:
> What should be reviewed?  Just the rebase?

I think that is right.  v5 patch is a rebase on Martin's positive review at comment 12.  There was some duplication of effort prior to the rebase, I was fixing some incorrect doctests, while another patch was doing the same thing.  So IIRC those are the only real changes in the rebase (ie it was not a trivial matter, but if this applies and passes tests now then it should be ready to go).

Thanks,
Rob


---

Comment by jason created at 2011-12-04 07:04:55

all long doctests pass (with the very minor v5-rebase patch), so back to positive review!


---

Comment by jason created at 2011-12-04 07:04:55

Changing status from needs_review to positive_review.


---

Attachment


---

Comment by rbeezer created at 2011-12-05 05:29:41

Thanks, Jason - I really need this one for classes this spring.


---

Comment by jason created at 2011-12-06 08:24:22

rbeezer: me too.


---

Comment by jdemeyer created at 2011-12-06 21:15:54

"there will be a reject that is taken care of in the next patch" is not a proper way to post patches.  Rebasing a patch means editing the original patch and not adding a patch on top of a failed(!) patch.  Or, you could simply post the failing patch without the rejected hunk.


---

Comment by jdemeyer created at 2011-12-06 21:15:54

Changing status from positive_review to needs_work.


---

Comment by jason created at 2011-12-07 00:40:05

Sorry; I was debating whether to combine them or to post the very small fix separately so it could be reviewed separately.  I'll combine them and post a patch.


---

Attachment

Consolidated, standalone


---

Comment by rbeezer created at 2011-12-08 22:43:17

Changing status from needs_work to needs_review.


---

Comment by rbeezer created at 2011-12-08 22:43:17

Replying to [comment:25 jason]:
> I'll combine them and post a patch.

Beat you to it.  Combined the three patches into one.  I hope reviewers (Grout, Raum) don't mind that now it only has my name on it, but I wanted to finish this one off.

Passes all long tests on 4.8.alpha3, so the reject should have been handled correctly, since it involved changes to a doctest.

I've marked this "needs review", though the work done was totally trivial.


---

Comment by jason created at 2011-12-10 05:31:40

I won't have time in this last week of classes/finals to look at this.  I'd say, if it passes long tests and the work was totally trivial, mark it positive review.


---

Comment by rbeezer created at 2011-12-10 06:16:04

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2011-12-10 10:40:53

Resolution: fixed
