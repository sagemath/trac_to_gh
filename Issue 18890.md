# Issue 18890: Some clean up in docbuilding

Issue created by migration from Trac.

Original creator: jdemeyer

Original creation time: 2015-09-03 15:40:54

CC:  hivert ncohen

No change in functionality, just some clean up.

In particular:
- move the code for running Sphinx to `src/doc/builder`
- do not create and delete empty directories, instead silence the Sphinx warnings about non-existing directories
- instead of `compile()`, use `import`
- add a new variable `SAGE_DOC_OUTPUT` for `src/doc/output` (with the idea that this might be moved to `local/share/doc` in the future)


---

Comment by jdemeyer created at 2015-09-03 15:58:53

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2015-09-03 15:58:53

New commits:


---

Comment by git created at 2015-09-03 19:48:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-09-08 20:38:49

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2015-11-07 11:47:36

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-01-10 21:51:55

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2016-01-24 10:36:35

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2016-01-25 10:29:44

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-01-25 14:07:38

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2016-01-25 17:10:12

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2016-01-25 21:06:04

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2016-01-26 07:29:55

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by mmezzarobba created at 2016-01-26 11:30:02

I don't understand what `SAGE_DOC_OUTPUT` is supposed to do: I tried (without reading the code)

```
SAGE_DOC_OUTPUT=. sage -docbuild tutorial pdf
```

but the pdf file still ends up at its usual location.


---

Comment by jdemeyer created at 2016-01-26 11:37:14

Replying to [comment:17 mmezzarobba]:
> I don't understand what `SAGE_DOC_OUTPUT` is supposed to do
Such variables really need an absolute path, not relative.


---

Comment by mmezzarobba created at 2016-01-26 14:03:38

LGTM. Two minor comments though:
* I wonder why you renamed the logger to `doc.builder` (the obvious reason to change the name would be to follow the more-or-less standard convention of “namespacing” it using the corresponding Python module name, but that's not what you do).
* The developer guide contains a mention of `SAGE_ROOT/src/doc/builder/__init__.py` that probably should be updated or removed.


---

Comment by git created at 2016-01-26 14:26:54

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mmezzarobba created at 2016-01-26 14:31:30

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2016-01-28 17:13:58

http://build.sagedev.org/release/builders/%20%20fast%20Volker%20Desktop%20%28Fedora%2022%20x86_64%29%20incremental/builds/366/steps/shell_4/logs/stdio


---

Comment by vbraun created at 2016-01-28 17:13:58

Changing status from positive_review to needs_work.


---

Comment by jdemeyer created at 2016-01-28 18:22:35

That failure looks unrelated to the documentation, so I would be surprised if that buildbot error was due to this ticket. Which other tickets did you test?


---

Comment by jhpalmieri created at 2016-01-28 18:36:32

Unrelated to the doctest failure: should the `clean` target in `src/doc/Makefile` also do something like `rm -f common/*.pyc`? It would be good to clean up `common/builder.pyc` and other left-over files.


---

Comment by jdemeyer created at 2016-01-28 19:04:14

Replying to [comment:23 vbraun]:
> http://build.sagedev.org/release/builders/%20%20fast%20Volker%20Desktop%20%28Fedora%2022%20x86_64%29%20incremental/builds/366/steps/shell_4/logs/stdio

Confirmed (but still surprising!)


---

Comment by jdemeyer created at 2016-01-28 19:15:05

The problem seems to be that doctesting the old `src/doc/output` files fails because they are no longer consider "Sage library" files. Easily fixed by removing `src/doc/output`.


---

Comment by git created at 2016-01-28 19:36:36

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2016-01-28 22:47:49

Oops, I was confusing this ticket with #19963. Never mind this last commit.


---

Comment by git created at 2016-01-28 22:50:08

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2016-01-29 06:57:36

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2016-01-29 06:59:02

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2016-01-29 07:06:51

I will merge #19950 because these tickets conflict.


---

Comment by git created at 2016-01-29 07:09:07

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mmezzarobba created at 2016-02-02 10:40:05

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2016-02-02 23:06:38

Resolution: fixed


---

Comment by jmantysalo created at 2016-03-30 07:32:11

Is this the reason for #20255?
