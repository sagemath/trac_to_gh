# Issue 18890: Some clean up in docbuilding

archive/issues_018890.json:
```json
{
    "body": "CC:  @hivert @nathanncohen\n\nNo change in functionality, just some clean up.\n\nIn particular:\n- move the code for running Sphinx to `src/doc/builder`\n- do not create and delete empty directories, instead silence the Sphinx warnings about non-existing directories\n- instead of `compile()`, use `import`\n- add a new variable `SAGE_DOC_OUTPUT` for `src/doc/output` (with the idea that this might be moved to `local/share/doc` in the future)\n\nIssue created by migration from https://trac.sagemath.org/ticket/19127\n\n",
    "created_at": "2015-09-03T15:40:54Z",
    "labels": [
        "component: build"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.1",
    "title": "Some clean up in docbuilding",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18890",
    "user": "https://github.com/jdemeyer"
}
```
CC:  @hivert @nathanncohen

No change in functionality, just some clean up.

In particular:
- move the code for running Sphinx to `src/doc/builder`
- do not create and delete empty directories, instead silence the Sphinx warnings about non-existing directories
- instead of `compile()`, use `import`
- add a new variable `SAGE_DOC_OUTPUT` for `src/doc/output` (with the idea that this might be moved to `local/share/doc` in the future)

Issue created by migration from https://trac.sagemath.org/ticket/19127





---

archive/issue_comments_258403.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-09-03T15:58:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18890#issuecomment-258403",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_258404.json:
```json
{
    "body": "New commits:",
    "created_at": "2015-09-03T15:58:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18890#issuecomment-258404",
    "user": "https://github.com/jdemeyer"
}
```

New commits:



---

archive/issue_comments_258405.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-09-03T19:48:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18890#issuecomment-258405",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_258406.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-09-08T20:38:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18890#issuecomment-258406",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_258407.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-11-07T11:47:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18890#issuecomment-258407",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_258408.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-01-10T21:51:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18890#issuecomment-258408",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_258409.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-01-24T10:36:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18890#issuecomment-258409",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_258410.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-01-25T10:29:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18890#issuecomment-258410",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_258411.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-01-25T14:07:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18890#issuecomment-258411",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_258412.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-01-25T17:10:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18890#issuecomment-258412",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_258413.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-01-25T21:06:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18890#issuecomment-258413",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_258414.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-01-26T07:29:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18890#issuecomment-258414",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_258415.json:
```json
{
    "body": "I don't understand what `SAGE_DOC_OUTPUT` is supposed to do: I tried (without reading the code)\n\n```\nSAGE_DOC_OUTPUT=. sage -docbuild tutorial pdf\n```\nbut the pdf file still ends up at its usual location.",
    "created_at": "2016-01-26T11:30:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18890#issuecomment-258415",
    "user": "https://github.com/mezzarobba"
}
```

I don't understand what `SAGE_DOC_OUTPUT` is supposed to do: I tried (without reading the code)

```
SAGE_DOC_OUTPUT=. sage -docbuild tutorial pdf
```
but the pdf file still ends up at its usual location.



---

archive/issue_comments_258416.json:
```json
{
    "body": "Replying to [comment:17 mmezzarobba]:\n> I don't understand what `SAGE_DOC_OUTPUT` is supposed to do\n\nSuch variables really need an absolute path, not relative.",
    "created_at": "2016-01-26T11:37:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18890#issuecomment-258416",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:17 mmezzarobba]:
> I don't understand what `SAGE_DOC_OUTPUT` is supposed to do

Such variables really need an absolute path, not relative.



---

archive/issue_comments_258417.json:
```json
{
    "body": "LGTM. Two minor comments though:\n* I wonder why you renamed the logger to `doc.builder` (the obvious reason to change the name would be to follow the more-or-less standard convention of \u201cnamespacing\u201d it using the corresponding Python module name, but that's not what you do).\n* The developer guide contains a mention of `SAGE_ROOT/src/doc/builder/__init__.py` that probably should be updated or removed.",
    "created_at": "2016-01-26T14:03:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18890#issuecomment-258417",
    "user": "https://github.com/mezzarobba"
}
```

LGTM. Two minor comments though:
* I wonder why you renamed the logger to `doc.builder` (the obvious reason to change the name would be to follow the more-or-less standard convention of “namespacing” it using the corresponding Python module name, but that's not what you do).
* The developer guide contains a mention of `SAGE_ROOT/src/doc/builder/__init__.py` that probably should be updated or removed.



---

archive/issue_comments_258418.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-01-26T14:26:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18890#issuecomment-258418",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_events_053147.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2016-01-26T14:31:30Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/18890",
    "milestone": "sage-7.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18890#event-53147"
}
```



---

archive/issue_comments_258419.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-01-26T14:31:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18890#issuecomment-258419",
    "user": "https://github.com/mezzarobba"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_258420.json:
```json
{
    "body": "http://build.sagedev.org/release/builders/%20%20fast%20Volker%20Desktop%20%28Fedora%2022%20x86_64%29%20incremental/builds/366/steps/shell_4/logs/stdio",
    "created_at": "2016-01-28T17:13:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18890#issuecomment-258420",
    "user": "https://github.com/vbraun"
}
```

http://build.sagedev.org/release/builders/%20%20fast%20Volker%20Desktop%20%28Fedora%2022%20x86_64%29%20incremental/builds/366/steps/shell_4/logs/stdio



---

archive/issue_comments_258421.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2016-01-28T17:13:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18890#issuecomment-258421",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_258422.json:
```json
{
    "body": "That failure looks unrelated to the documentation, so I would be surprised if that buildbot error was due to this ticket. Which other tickets did you test?",
    "created_at": "2016-01-28T18:22:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18890#issuecomment-258422",
    "user": "https://github.com/jdemeyer"
}
```

That failure looks unrelated to the documentation, so I would be surprised if that buildbot error was due to this ticket. Which other tickets did you test?



---

archive/issue_comments_258423.json:
```json
{
    "body": "Unrelated to the doctest failure: should the `clean` target in `src/doc/Makefile` also do something like `rm -f common/*.pyc`? It would be good to clean up `common/builder.pyc` and other left-over files.",
    "created_at": "2016-01-28T18:36:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18890#issuecomment-258423",
    "user": "https://github.com/jhpalmieri"
}
```

Unrelated to the doctest failure: should the `clean` target in `src/doc/Makefile` also do something like `rm -f common/*.pyc`? It would be good to clean up `common/builder.pyc` and other left-over files.



---

archive/issue_comments_258424.json:
```json
{
    "body": "Replying to [comment:23 vbraun]:\n> http://build.sagedev.org/release/builders/%20%20fast%20Volker%20Desktop%20%28Fedora%2022%20x86_64%29%20incremental/builds/366/steps/shell_4/logs/stdio\n\n\nConfirmed (but still surprising!)",
    "created_at": "2016-01-28T19:04:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18890#issuecomment-258424",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:23 vbraun]:
> http://build.sagedev.org/release/builders/%20%20fast%20Volker%20Desktop%20%28Fedora%2022%20x86_64%29%20incremental/builds/366/steps/shell_4/logs/stdio


Confirmed (but still surprising!)



---

archive/issue_comments_258425.json:
```json
{
    "body": "The problem seems to be that doctesting the old `src/doc/output` files fails because they are no longer consider \"Sage library\" files. Easily fixed by removing `src/doc/output`.",
    "created_at": "2016-01-28T19:15:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18890#issuecomment-258425",
    "user": "https://github.com/jdemeyer"
}
```

The problem seems to be that doctesting the old `src/doc/output` files fails because they are no longer consider "Sage library" files. Easily fixed by removing `src/doc/output`.



---

archive/issue_comments_258426.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-01-28T19:36:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18890#issuecomment-258426",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_258427.json:
```json
{
    "body": "Oops, I was confusing this ticket with #19963. Never mind this last commit.",
    "created_at": "2016-01-28T22:47:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18890#issuecomment-258427",
    "user": "https://github.com/jdemeyer"
}
```

Oops, I was confusing this ticket with #19963. Never mind this last commit.



---

archive/issue_comments_258428.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-01-28T22:50:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18890#issuecomment-258428",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_258429.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-01-29T06:57:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18890#issuecomment-258429",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_258430.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-01-29T06:59:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18890#issuecomment-258430",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_258431.json:
```json
{
    "body": "I will merge #19950 because these tickets conflict.",
    "created_at": "2016-01-29T07:06:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18890#issuecomment-258431",
    "user": "https://github.com/jdemeyer"
}
```

I will merge #19950 because these tickets conflict.



---

archive/issue_comments_258432.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-01-29T07:09:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18890#issuecomment-258432",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_258433.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-02-02T10:40:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18890#issuecomment-258433",
    "user": "https://github.com/mezzarobba"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_053148.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-02-02T23:06:38Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/18890",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18890#event-53148"
}
```



---

archive/issue_comments_258434.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-02-02T23:06:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18890#issuecomment-258434",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_258435.json:
```json
{
    "body": "Is this the reason for #20255?",
    "created_at": "2016-03-30T07:32:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18890#issuecomment-258435",
    "user": "https://github.com/jm58660"
}
```

Is this the reason for #20255?
