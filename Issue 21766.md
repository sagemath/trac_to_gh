# Issue 21766: The number of faces of the complete graph on a single vertex should be 1

Issue created by migration from Trac.

Original creator: pelegm

Original creation time: 2016-11-30 21:06:54

CC:  tscrim

Keywords: tree,faces

The graph of order 1 and size 0 is a tree. Euler's formula should apply:

  num_verts - num_edges + num_faces = 2

and in particular, the number of faces of that graphs should be 1.  Currently, `.faces()` returns an empty list and `.num_faces()` returns 0.


---

Comment by dcoudert created at 2021-09-19 14:07:27

I agree that the number of faces of a graph with a single vertex should be 1 according to Euler's formula. However, I don't know which face to return. 


Another issue is the number of faces of graphs with several connected components. Indeed, the Euler's formula is `V-E+F-C=1`, where `C` is the number of connected components (see e.g.,  https://en.wikipedia.org/wiki/Euler_characteristic#Plane_graphs).
But we have

```
sage: G = graphs.CycleGraph(3) * 2
sage: G.num_faces()
4
sage: V = G.order()
sage: E = G.size()
sage: C = len(G.connected_components())
sage: F = E - V + C + 1
sage: F
3
```



---

Comment by dcoudert created at 2021-09-19 14:07:27

Changing status from new to needs_info.


---

Comment by tscrim created at 2021-09-19 20:27:51

For the single vertex graph, we should just return the "face" of `[]` representing everything.

For disconnected graphs, I suspect the `faces()` algorithm has a hidden assumption of connectedness. It makes it somewhat hard to define what a face is as the sphere remove the interior of the planar graphs is not homeomorphic to a disk anymore. We essentially have to insert some fake edges connecting the connected components in order to get the simplicial (well, CW is sufficient) decomposition for the faces. However, it is not clear to me there is an easy algorithm to chose which vertices of two unconnected planar graphs to add an edge to.


---

Comment by dcoudert created at 2021-09-20 14:40:37

Can we simply split the graph into connected components, compute the faces / number of faces of each component and then merge the results ?


---

Comment by tscrim created at 2021-09-21 08:12:52

That is a good idea. The exterior face of any planar graph would then represent _some_ face in S<sup>2</sup> \ Int(G), where Int(G) is the interior of the (disconnected) graph. It just would not be precise in some sense as we would not have an exact subdivision of the complement into disks.


---

Comment by dcoudert created at 2021-09-26 15:25:00

I have modified method `num_faces` to compute the correct number of faces of trees, forests and non-connected graphs. 

However, I have currently no suitable solution to get the faces. The difficulty is to identify the external face. May be we should let this issue for another ticket. Indeed, I think we have similar problem with `planar_dual`.
----
New commits:


---

Comment by dcoudert created at 2021-09-26 15:25:00

Changing status from needs_info to needs_review.


---

Comment by tscrim created at 2021-09-27 06:06:16

I guess you are defining a face to be something homeomorphic to a connected open subset of *R*<sup>2</sup>?

If you want some algorithm to identity the external face of a connected component, you can go over each edge and compute a perpendicular bisector. If one of those directions intersects an even number of edges, then it must be for the external face. This is a common technique in computer graphics to tell when a point is inside of something or not (we consider the point an infinitesimal distance from the edge in the chosen normal direction). This won't be super quick, but it will work.

This is good enough for now, although I might want the definition of a face specified in the documentation both in `num_faces` and `faces`. It is up to you if you also want to identify the external face. If not, I think we should raise a `NotImpementedError` when the graph is not connected.


---

Comment by dcoudert created at 2021-09-27 17:23:47

Disclaimer: I'm not "defining a face to be...", I'm trying to fix an issue ;)

In method `faces`, an embedding is defined as a clockwise ordering of the neighbors of each vertex.
So, when the graph is planar and that the embedding corresponds to a planar embedding of the graph, a face is a subset of *R*<sup>2</sup> surrounded by edges. However, I think we should distinguish several behaviors of these methods:
- if no embedding is given (or stored in the graph) and that the graph is planar, the method starts computing a planar embedding and then determines it's faces. Actually, for `num_faces`, we don't need the embedding, it is sufficient to know if the graph is planar (and it's number of connected components).
- if no embedding is given (or stored in the graph) and that the graph is **not** planar, then an error is raised
- if an embedding is given as input (or stored in the graph), none of the methods checks if it is a valid embedding of a planar graph. So we can for instance compute the "faces" of a non-planar graph like

```
sage: G = graphs.PetersenGraph()
sage: G.is_planar()
False
sage: embedding = {v: G.neighbors(v) for v in G}
sage: G.faces(embedding)
[[(0, 1),
  (1, 2),
  (2, 3),
  (3, 4),
  (4, 9),
  (9, 6),
  (6, 1),
  (1, 0),
  (0, 4),
  (4, 3),
  (3, 8),
  (8, 5),
  (5, 0)],
 [(0, 5), (5, 7), (7, 9), (9, 4), (4, 0)],
 [(1, 6),
  (6, 8),
  (8, 3),
  (3, 2),
  (2, 7),
  (7, 5),
  (5, 8),
  (8, 6),
  (6, 9),
  (9, 7),
  (7, 2),
  (2, 1)]]
```

  and you can see that the reported faces may have repeated vertices...

I'm not sure what's the best solution here. In particular, we cannot use method `is_planar` to check if a graph is planar based on a combinatorial embedding as method `is_planar` calls method `genus` which itself calls method `faces`.


---

Comment by tscrim created at 2021-09-28 03:41:40

There needs to be some definition that is compatible with the topological information you want. `:)` If a face is a subset of *R*<sup>2</sup> surrounded by edges, then that is equivalent to comment:6.

For `num_faces()`, would it be faster to check if it is planar and then use Euler's formula solving for `F`? It definitely feels more memory efficient as it won't have to list all of the faces.

In many ways, I think it is okay to define the faces of a non-planar graph because it still lies on some higher genus surface and the definition of a face still makes sense there. The local drawing in *R*<sup>2</sup> just specifies the local orientation of the edges around each vertex. I might even go so far as to say it should work for nonplanar graphs even without a specified embedding (and `num_faces` could work for any higher genus graph again using Euler's formula). This would get us out of the issue when we are given a planar graph with a nonplanar embedding.


---

Comment by git created at 2021-09-28 17:12:26

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-09-28 17:29:20

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2021-09-28 17:29:55

We now avoid the enumeration of faces when no embedding is provided in method `num_faces`. It is for sure faster this ways.

It remains to agree on some definition of faces when an embedding is provided, and to explain what the method do exactly. It added a proposal.


---

Comment by tscrim created at 2021-09-29 04:12:53

This will work for now since it keeps things with the current behavior.

I agree that we need a specific definition and to universally apply that definition.

The main thing I would advocate for would be to remove the planarity condition. A face still makes sense for non-planar graphs once you have defined an orientation around each edge. See, e.g., ribbon graphs with no twists. This would be consistent with the algebraic topology 1-skeleton viewpoint of a graph lying on a genus `g` surface and would be consistent with our equivalent definitions. It also should not require any significant changes to the code.


---

Comment by tscrim created at 2021-09-29 04:12:53

Changing status from needs_review to positive_review.


---

Comment by dcoudert created at 2021-09-29 07:17:26

The planarity condition is only used when no embedding is provided. If we want to remove the planarity condition (and possiblly add a parameter to enable it), we must have a method to compute an embedding. So far, I have no clear proposal for that.

Thank you for the review.


---

Comment by tscrim created at 2021-09-29 09:08:25

I don't think we necessarily need it to be embedded, just some projection of the graph that defines a local ordering of the edges around the vertices. Would we need something more than that?


---

Comment by dcoudert created at 2021-09-29 16:01:34

In the example of #comment:7, some "faces" visit more than once some vertices. The embedding is a local ordering of the neighbors (so of edges around vertices).

One could prefer to get `[(0, 1), (1, 2), (2, 3), (3, 4), (4, 9), (9, 6), (6, 1), (1, 0)]` and `[(0, 4), (4, 3), (3, 8), (8, 5), (5, 0)]` rather than
`[(0, 1), (1, 2), (2, 3), (3, 4), (4, 9), (9, 6), (6, 1), (1, 0), (0, 4), (4, 3), (3, 8), (8, 5), (5, 0)]`...


---

Comment by tscrim created at 2021-09-30 09:16:06

Replying to [comment:15 dcoudert]:
> In the example of #comment:7, some "faces" visit more than once some vertices.

I don't quite see why this is a problem. For a tree, say a star with 3 edges, you would naturally have this anyways.


---

Comment by dcoudert created at 2021-09-30 09:25:42

Right. So if the graph is not planar, any ordering could be used, for instance the one from `G.to_dictionary()`.


---

Comment by tscrim created at 2021-09-30 09:31:21

Then are we in agreement? We just need some generic way, such as `G.to_dictionary()`, and if an embedding is provided, we use that?

Maybe I have misunderstood you with the repeated vertices. I was thinking you were saying that was a (potential) problem. I was thinking of doing something naÃ¯ve like starting at an edge and following edges on one "side". This would give a face once we see the same edge again. Then we would stop once every edge is used exactly twice.


---

Comment by dcoudert created at 2021-09-30 11:26:10

Yes, but we need to add an extra argument ensuring that the method keeps the current behavior for non-planar graphs (raise error when no embedding is provided).


---

Comment by tscrim created at 2021-09-30 13:15:06

Sounds good to me.


---

Comment by dcoudert created at 2021-09-30 15:53:20

I might be best to do that in another ticket, with a more appropriate ticket name etc.


---

Comment by tscrim created at 2021-09-30 22:27:45

Replying to [comment:21 dcoudert]:
> I might be best to do that in another ticket, with a more appropriate ticket name etc.

+1 (although we can always change the ticket names `;P`)


---

Comment by vbraun created at 2021-10-09 11:10:10

Resolution: fixed
