# Issue 10119: Error building the PARI/GP spkg on 32-bit Fedora 11

archive/issues_010119.json:
```json
{
    "body": "Assignee: tbd\n\nCC:  jdemeyer hivert koen\n\nMike Witt has reported a problem building the PARI/GP package (pari-2.4.3.svn-12577.p7) in 4.6.alpha3 on a 32-bit Fedora 11 system with 4 GB of RAM.  From the install.log:\n\n\n```\ngcc  -c -O3 -Wall -fno-strict-aliasing -fomit-frame-pointer  -O3 -g\n-I. -I../src/headers -fPIC -o base2.o ../src/basemath/base2.c\ngcc  -c -O3 -Wall -fno-strict-aliasing -fomit-frame-pointer  -O3 -g\n-I. -I../src/headers -fPIC -o base3.o ../src/basemath/base3.c\n\ncc1: out of memory allocating 248 bytes after a total of 2883715072 bytes\nmake[3]: *** [base3.o] Error 1\nmake[3]: Leaving directory\n`/usr/local/sage-4.6.alpha3/spkg/build/pari-2.4.3.svn-12577.p7/src/Olinux-i686'\nmake[2]: *** [gp] Error 2\nmake[2]: Leaving directory\n`/usr/local/sage-4.6.alpha3/spkg/build/pari-2.4.3.svn-12577.p7/src'\nError building GP \n```\n\n\nSee [sage-release](http://groups.google.com/group/sage-release/browse_thread/thread/a72cd417c5312470) for some details.  Jeroen Demeyer has suggested that this is another GCC bug uncovered by PARI.\n\nSimilar: #9897.\n\nIssue created by migration from https://trac.sagemath.org/ticket/10120\n\n",
    "created_at": "2010-10-11T22:41:47Z",
    "labels": [
        "packages: standard",
        "major",
        "bug"
    ],
    "title": "Error building the PARI/GP spkg on 32-bit Fedora 11",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10119",
    "user": "mpatel"
}
```
Assignee: tbd

CC:  jdemeyer hivert koen

Mike Witt has reported a problem building the PARI/GP package (pari-2.4.3.svn-12577.p7) in 4.6.alpha3 on a 32-bit Fedora 11 system with 4 GB of RAM.  From the install.log:


```
gcc  -c -O3 -Wall -fno-strict-aliasing -fomit-frame-pointer  -O3 -g
-I. -I../src/headers -fPIC -o base2.o ../src/basemath/base2.c
gcc  -c -O3 -Wall -fno-strict-aliasing -fomit-frame-pointer  -O3 -g
-I. -I../src/headers -fPIC -o base3.o ../src/basemath/base3.c

cc1: out of memory allocating 248 bytes after a total of 2883715072 bytes
make[3]: *** [base3.o] Error 1
make[3]: Leaving directory
`/usr/local/sage-4.6.alpha3/spkg/build/pari-2.4.3.svn-12577.p7/src/Olinux-i686'
make[2]: *** [gp] Error 2
make[2]: Leaving directory
`/usr/local/sage-4.6.alpha3/spkg/build/pari-2.4.3.svn-12577.p7/src'
Error building GP 
```


See [sage-release](http://groups.google.com/group/sage-release/browse_thread/thread/a72cd417c5312470) for some details.  Jeroen Demeyer has suggested that this is another GCC bug uncovered by PARI.

Similar: #9897.

Issue created by migration from https://trac.sagemath.org/ticket/10120





---

archive/issue_comments_102228.json:
```json
{
    "body": "Just for fun, let me point out that the following gcc bug was also found by compling PARI: http://gcc.gnu.org/bugzilla/show_bug.cgi?id=37544",
    "created_at": "2010-10-12T02:35:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10119#issuecomment-102228",
    "user": "jdemeyer"
}
```

Just for fun, let me point out that the following gcc bug was also found by compling PARI: http://gcc.gnu.org/bugzilla/show_bug.cgi?id=37544



---

archive/issue_comments_102229.json:
```json
{
    "body": "I have the same problem with GNU compiler version 4.4.1 on SUSE 11, 64 bit.\nThis is independent of sage as I can not compile the dev version of pari, either.",
    "created_at": "2010-10-12T17:18:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10119#issuecomment-102229",
    "user": "wuthrich"
}
```

I have the same problem with GNU compiler version 4.4.1 on SUSE 11, 64 bit.
This is independent of sage as I can not compile the dev version of pari, either.



---

archive/issue_comments_102230.json:
```json
{
    "body": "Is it worth addressing such within Sage? (I personally don't think so.)\n\nManually changing `CFLAGS` to `-O2 ...` (just for the PARI package) might help.\n\n(As of course upgrading Fedora or just GCC would as well... ;-) )",
    "created_at": "2010-10-16T13:10:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10119#issuecomment-102230",
    "user": "leif"
}
```

Is it worth addressing such within Sage? (I personally don't think so.)

Manually changing `CFLAGS` to `-O2 ...` (just for the PARI package) might help.

(As of course upgrading Fedora or just GCC would as well... ;-) )



---

archive/issue_comments_102231.json:
```json
{
    "body": "Replying to [comment:5 leif]:\n> Is it worth addressing such within Sage? (I personally don't think so.)\n\nI don't think it's worth to special-case every broken version of gcc in Sage, espcially if the problem is fixed in newer versions of gcc.",
    "created_at": "2010-10-16T13:24:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10119#issuecomment-102231",
    "user": "jdemeyer"
}
```

Replying to [comment:5 leif]:
> Is it worth addressing such within Sage? (I personally don't think so.)

I don't think it's worth to special-case every broken version of gcc in Sage, espcially if the problem is fixed in newer versions of gcc.



---

archive/issue_comments_102232.json:
```json
{
    "body": "Replying to [comment:5 leif]:\n> Manually changing `CFLAGS` to `-O2 ...` (just for the PARI package) might help.\n\nMike Witt reported on sage-release (for Sage 4.6.rc0) that `-O2` (`-fno-strict-aliasing -fomit-frame-pointer`) **didn't help** to get around this bug; setting `SAGE_DEBUG=yes` instead (which sets `CFLAGS` to `... -O0`, i.e. *completely* disables optimization) worked for him.",
    "created_at": "2010-10-22T21:49:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10119#issuecomment-102232",
    "user": "leif"
}
```

Replying to [comment:5 leif]:
> Manually changing `CFLAGS` to `-O2 ...` (just for the PARI package) might help.

Mike Witt reported on sage-release (for Sage 4.6.rc0) that `-O2` (`-fno-strict-aliasing -fomit-frame-pointer`) **didn't help** to get around this bug; setting `SAGE_DEBUG=yes` instead (which sets `CFLAGS` to `... -O0`, i.e. *completely* disables optimization) worked for him.



---

archive/issue_comments_102233.json:
```json
{
    "body": "Replying to [comment:7 leif]:\n> Replying to [comment:5 leif]:\n> > Manually changing `CFLAGS` to `-O2 ...` (just for the PARI package) might help.\n> \n> Mike Witt reported on sage-release (for Sage 4.6.rc0) that `-O2` (`-fno-strict-aliasing -fomit-frame-pointer`) **didn't help** to get around this bug; setting `SAGE_DEBUG=yes` instead (which sets `CFLAGS` to `... -O0`, i.e. *completely* disables optimization) worked for him.\n\n`-O1 ...` also **worked** for him.",
    "created_at": "2010-10-22T23:46:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10119#issuecomment-102233",
    "user": "leif"
}
```

Replying to [comment:7 leif]:
> Replying to [comment:5 leif]:
> > Manually changing `CFLAGS` to `-O2 ...` (just for the PARI package) might help.
> 
> Mike Witt reported on sage-release (for Sage 4.6.rc0) that `-O2` (`-fno-strict-aliasing -fomit-frame-pointer`) **didn't help** to get around this bug; setting `SAGE_DEBUG=yes` instead (which sets `CFLAGS` to `... -O0`, i.e. *completely* disables optimization) worked for him.

`-O1 ...` also **worked** for him.



---

archive/issue_comments_102234.json:
```json
{
    "body": "Changing keywords from \"\" to \"gcc pari\".",
    "created_at": "2010-10-23T07:21:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10119#issuecomment-102234",
    "user": "jdemeyer"
}
```

Changing keywords from "" to "gcc pari".



---

archive/issue_comments_102235.json:
```json
{
    "body": "This emphasizes even more that it really is a gcc bug.",
    "created_at": "2010-10-23T07:21:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10119#issuecomment-102235",
    "user": "jdemeyer"
}
```

This emphasizes even more that it really is a gcc bug.



---

archive/issue_comments_102236.json:
```json
{
    "body": "Changing status from new to needs_info.",
    "created_at": "2010-10-23T17:08:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10119#issuecomment-102236",
    "user": "leif"
}
```

Changing status from new to needs_info.



---

archive/issue_comments_102237.json:
```json
{
    "body": "Should we document this in the [Installation Guide](http://www.sagemath.org/doc/installation/source.html#install-from-source-code)? README.txt? Release notes of Sage 4.6?\n\n(It's fairly out of date anyway, but updating at least some parts is IMHO overdue, since doing so hopefully prevents users again reporting known issues and should reduce potential annoyance.)",
    "created_at": "2010-10-23T17:08:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10119#issuecomment-102237",
    "user": "leif"
}
```

Should we document this in the [Installation Guide](http://www.sagemath.org/doc/installation/source.html#install-from-source-code)? README.txt? Release notes of Sage 4.6?

(It's fairly out of date anyway, but updating at least some parts is IMHO overdue, since doing so hopefully prevents users again reporting known issues and should reduce potential annoyance.)



---

archive/issue_comments_102238.json:
```json
{
    "body": "A better work-around than `export SAGE_DEBUG=yes` might be to let the (preferably parallel build) fail on PARI in the first place, then install PARI with modified `CFLAGS`, and after that continue the build by re-running `make` with \"better\" (or unset) `CFLAGS`:\n\n\n```sh\n$ export SAGE_PARALLEL_SPKG_BUILD=yes\n\n$ export MAKE=\"make -j4\"  # for example; using more threads/jobs than the number\n                          # of cores the CPU has is usually ok, at least if the\n                          # machine has enough memory (RAM) available\n\n$ make build  # should build all packages that do not depend on PARI, but will\n              # fail for PARI\n\n$ export CFLAGS=\"-O1 -fno-strict-aliasing -fomit-frame-pointer\"\n\n$ ./sage -i spkg/standard/pari-2.4.3*  # build/install only the PARI spkg;\n                                       # _should_ work, unless the scripts\n                                       # aren't yet installed\n\n$ unset CFLAGS  # clear them, such that the packages' defaults will be used\n\n$ make  # continue building the remaining packages and the documentation\n```\n\n\nIf the `sage -i ...` doesn't work (because the necessary scripts aren't yet installed), one could try once again running `make build` (with unset or \"normal\" `CFLAGS`), then retrying the `sage -i ...`, again with the **modified** `CFLAGS` as given above, after a successful build of PARI continuing with `unset CFLAGS` followed by `make`.\n\nAnother approach (untested) which makes sure the necessary scripts are installed after the build of PARI has failed in the first place is to use the `-k` (\"keep going\") option of `make`, i.e. replacing\n\n```sh\n$ make build\n```\n\nabove by\n\n```sh\n$ make -k build\n```\n\n\n(Of course one could do the same with (additional) custom `CFLAGS` for the usual build, substituting the `unset CFLAGS` by `export CFLAGS=\"...\"`, and **pre**pending those flags to the ones used above for building PARI.)\n\nIf one doesn't want to mess around with setting and unsetting `CFLAGS` many times, here's the solution with one **very long line** to avoid this, this time **without** building in parallel:\n\n```sh\n$ make -k build  # should build all packages that do not depend on PARI, but will\n                 # fail for PARI (with GCC 4.4.1)\n\n# build/install only the PARI spkg, with \"temporarily\" modified CFLAGS:\n$ env CFLAGS=\"-O1 -fno-strict-aliasing -fomit-frame-pointer\" ./sage -i spkg/standard/pari-2.4.3*\n\n$ make  # continue building the remaining packages and the documentation\n```\n",
    "created_at": "2010-11-02T02:56:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10119#issuecomment-102238",
    "user": "leif"
}
```

A better work-around than `export SAGE_DEBUG=yes` might be to let the (preferably parallel build) fail on PARI in the first place, then install PARI with modified `CFLAGS`, and after that continue the build by re-running `make` with "better" (or unset) `CFLAGS`:


```sh
$ export SAGE_PARALLEL_SPKG_BUILD=yes

$ export MAKE="make -j4"  # for example; using more threads/jobs than the number
                          # of cores the CPU has is usually ok, at least if the
                          # machine has enough memory (RAM) available

$ make build  # should build all packages that do not depend on PARI, but will
              # fail for PARI

$ export CFLAGS="-O1 -fno-strict-aliasing -fomit-frame-pointer"

$ ./sage -i spkg/standard/pari-2.4.3*  # build/install only the PARI spkg;
                                       # _should_ work, unless the scripts
                                       # aren't yet installed

$ unset CFLAGS  # clear them, such that the packages' defaults will be used

$ make  # continue building the remaining packages and the documentation
```


If the `sage -i ...` doesn't work (because the necessary scripts aren't yet installed), one could try once again running `make build` (with unset or "normal" `CFLAGS`), then retrying the `sage -i ...`, again with the **modified** `CFLAGS` as given above, after a successful build of PARI continuing with `unset CFLAGS` followed by `make`.

Another approach (untested) which makes sure the necessary scripts are installed after the build of PARI has failed in the first place is to use the `-k` ("keep going") option of `make`, i.e. replacing

```sh
$ make build
```

above by

```sh
$ make -k build
```


(Of course one could do the same with (additional) custom `CFLAGS` for the usual build, substituting the `unset CFLAGS` by `export CFLAGS="..."`, and **pre**pending those flags to the ones used above for building PARI.)

If one doesn't want to mess around with setting and unsetting `CFLAGS` many times, here's the solution with one **very long line** to avoid this, this time **without** building in parallel:

```sh
$ make -k build  # should build all packages that do not depend on PARI, but will
                 # fail for PARI (with GCC 4.4.1)

# build/install only the PARI spkg, with "temporarily" modified CFLAGS:
$ env CFLAGS="-O1 -fno-strict-aliasing -fomit-frame-pointer" ./sage -i spkg/standard/pari-2.4.3*

$ make  # continue building the remaining packages and the documentation
```




---

archive/issue_comments_102239.json:
```json
{
    "body": "Finotti has [inquired at AskSage](http://ask.sagemath.org/question/190/compilation-problem-46-on-fedora-11) about a problem compiling 4.6 on 64-bit Fedora 11:\n\n```\nstark.o ../src/modules/stark.c\ngcc  -c -O3 -Wall -fno-strict-aliasing -fomit-frame-pointer  -O3 -g   -I. -I../src/headers -fPIC -o subfield.o ../src/modules/subfield.c\ngcc  -c -O3 -Wall -fno-strict-aliasing -fomit-frame-pointer  -O3 -g   -I. -I../src/headers -fPIC -o thue.o ../src/modules/thue.c\ngcc: Internal error: Killed (program cc1)\nPlease submit a full bug report.\nSee <http://bugzilla.redhat.com/bugzilla> for instructions.\nmake[3]: *** [base3.o] Error 1\nmake[3]: Leaving directory `/work/local/sage-4.6/spkg/build/pari-2.4.3.svn-12577.p9/src/Olinux-x86_64'\nmake[2]: *** [gp] Error 2\nmake[2]: Leaving directory `/work/local/sage-4.6/spkg/build/pari-2.4.3.svn-12577.p9/src'\nError building GP\n```\n",
    "created_at": "2010-11-05T20:56:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10119#issuecomment-102239",
    "user": "mpatel"
}
```

Finotti has [inquired at AskSage](http://ask.sagemath.org/question/190/compilation-problem-46-on-fedora-11) about a problem compiling 4.6 on 64-bit Fedora 11:

```
stark.o ../src/modules/stark.c
gcc  -c -O3 -Wall -fno-strict-aliasing -fomit-frame-pointer  -O3 -g   -I. -I../src/headers -fPIC -o subfield.o ../src/modules/subfield.c
gcc  -c -O3 -Wall -fno-strict-aliasing -fomit-frame-pointer  -O3 -g   -I. -I../src/headers -fPIC -o thue.o ../src/modules/thue.c
gcc: Internal error: Killed (program cc1)
Please submit a full bug report.
See <http://bugzilla.redhat.com/bugzilla> for instructions.
make[3]: *** [base3.o] Error 1
make[3]: Leaving directory `/work/local/sage-4.6/spkg/build/pari-2.4.3.svn-12577.p9/src/Olinux-x86_64'
make[2]: *** [gp] Error 2
make[2]: Leaving directory `/work/local/sage-4.6/spkg/build/pari-2.4.3.svn-12577.p9/src'
Error building GP
```




---

archive/issue_comments_102240.json:
```json
{
    "body": "Another gcc bug...",
    "created_at": "2010-11-05T21:29:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10119#issuecomment-102240",
    "user": "jdemeyer"
}
```

Another gcc bug...



---

archive/issue_comments_102241.json:
```json
{
    "body": "Replying to [comment:13 jdemeyer]:\n> Another gcc bug...\n\nI'd say the same (or very similar). I don't understand why the Fedora guys don't provide an upgraded GCC package.\n\nMitesh, I assume you've pointed him here. (I have never looked at `ask.sagemath.org`.)",
    "created_at": "2010-11-06T00:32:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10119#issuecomment-102241",
    "user": "leif"
}
```

Replying to [comment:13 jdemeyer]:
> Another gcc bug...

I'd say the same (or very similar). I don't understand why the Fedora guys don't provide an upgraded GCC package.

Mitesh, I assume you've pointed him here. (I have never looked at `ask.sagemath.org`.)



---

archive/issue_comments_102242.json:
```json
{
    "body": "Replying to [comment:14 leif]:\n> Replying to [comment:13 jdemeyer]:\n> > Another gcc bug...\n> \n> I'd say the same (or very similar). I don't understand why the Fedora guys don't provide an upgraded GCC package.\n> \n> Mitesh, I assume you've pointed him here. (I have never looked at `ask.sagemath.org`.)\n\nMike Witt mentioned the `SAGE_DEBUG` work-around and this ticket in his answer.",
    "created_at": "2010-11-06T00:57:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10119#issuecomment-102242",
    "user": "mpatel"
}
```

Replying to [comment:14 leif]:
> Replying to [comment:13 jdemeyer]:
> > Another gcc bug...
> 
> I'd say the same (or very similar). I don't understand why the Fedora guys don't provide an upgraded GCC package.
> 
> Mitesh, I assume you've pointed him here. (I have never looked at `ask.sagemath.org`.)

Mike Witt mentioned the `SAGE_DEBUG` work-around and this ticket in his answer.



---

archive/issue_comments_102243.json:
```json
{
    "body": "Changing keywords from \"gcc pari\" to \"gcc pari opensuse11.2 gcc4.4.1 fedora11\".",
    "created_at": "2010-12-03T20:38:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10119#issuecomment-102243",
    "user": "Koen"
}
```

Changing keywords from "gcc pari" to "gcc pari opensuse11.2 gcc4.4.1 fedora11".



---

archive/issue_comments_102244.json:
```json
{
    "body": "For reference: OpenSuse 11.2 (gcc (SUSE Linux) 4.4.1 [gcc-4_4-branch revision 150839]) has the same problem when building PARI: on a machine with 64GB of RAM, it eventually fails after all memory is exhausted (takes hours). It happens when compiling the base3.c file:\n\n\n```\ngcc  -c -O3 -Wall -fno-strict-aliasing -fomit-frame-pointer  -O3 -g   -I. -I../src/headers -fPIC -o base1.o ../src/basemath/base1.c\ngcc  -c -O3 -Wall -fno-strict-aliasing -fomit-frame-pointer  -O3 -g   -I. -I../src/headers -fPIC -o base2.o ../src/basemath/base2.c\ngcc  -c -O3 -Wall -fno-strict-aliasing -fomit-frame-pointer  -O3 -g   -I. -I../src/headers -fPIC -o base3.o ../src/basemath/base3.c\n```\n\nUnfortunately, distros generally refuse to update their compiler, because all OS packages are compiled with it and they do not want to run the risk of breaking other packages.",
    "created_at": "2010-12-03T20:38:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10119#issuecomment-102244",
    "user": "Koen"
}
```

For reference: OpenSuse 11.2 (gcc (SUSE Linux) 4.4.1 [gcc-4_4-branch revision 150839]) has the same problem when building PARI: on a machine with 64GB of RAM, it eventually fails after all memory is exhausted (takes hours). It happens when compiling the base3.c file:


```
gcc  -c -O3 -Wall -fno-strict-aliasing -fomit-frame-pointer  -O3 -g   -I. -I../src/headers -fPIC -o base1.o ../src/basemath/base1.c
gcc  -c -O3 -Wall -fno-strict-aliasing -fomit-frame-pointer  -O3 -g   -I. -I../src/headers -fPIC -o base2.o ../src/basemath/base2.c
gcc  -c -O3 -Wall -fno-strict-aliasing -fomit-frame-pointer  -O3 -g   -I. -I../src/headers -fPIC -o base3.o ../src/basemath/base3.c
```

Unfortunately, distros generally refuse to update their compiler, because all OS packages are compiled with it and they do not want to run the risk of breaking other packages.



---

archive/issue_comments_102245.json:
```json
{
    "body": "Replying to [comment:16 Koen]:\n> For reference: OpenSuse 11.2 (gcc (SUSE Linux) 4.4.1 [gcc-4_4-branch revision 150839]) has the same problem when building PARI: on a machine with 64GB of RAM, it eventually fails after all memory is exhausted (takes hours).\n\nHmmm, install more RAM?\n\nWhat CPU type is that? I know others have built successfully on openSUSE 11.2.\n\n\n\n> Unfortunately, distros generally refuse to update their compiler, because all OS packages are compiled with it and they do not want to run the risk of breaking other packages.\n\nThis used to be different in the good old times (and some even offered source packages IIRC). Also, Fedora / RedHat IMHO tend to include / build with \"too fresh\" compilers.\n\nPerhaps we should really check the `gcc` version in PARI's `spkg-install`, and eventually switch to `-O1`, but IMHO this should be fixed upstream such that only the critical parts get built with that.\n\nCan you report this upstream?",
    "created_at": "2010-12-03T21:05:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10119#issuecomment-102245",
    "user": "leif"
}
```

Replying to [comment:16 Koen]:
> For reference: OpenSuse 11.2 (gcc (SUSE Linux) 4.4.1 [gcc-4_4-branch revision 150839]) has the same problem when building PARI: on a machine with 64GB of RAM, it eventually fails after all memory is exhausted (takes hours).

Hmmm, install more RAM?

What CPU type is that? I know others have built successfully on openSUSE 11.2.



> Unfortunately, distros generally refuse to update their compiler, because all OS packages are compiled with it and they do not want to run the risk of breaking other packages.

This used to be different in the good old times (and some even offered source packages IIRC). Also, Fedora / RedHat IMHO tend to include / build with "too fresh" compilers.

Perhaps we should really check the `gcc` version in PARI's `spkg-install`, and eventually switch to `-O1`, but IMHO this should be fixed upstream such that only the critical parts get built with that.

Can you report this upstream?



---

archive/issue_comments_102246.json:
```json
{
    "body": "The CPU type is Nehalem (Core i7/Xeon 5500 series), specifically an X5570.\n\nReporting it upstream probably won't do much good, because the later release openSUSE 11.3 uses a different GCC already (4.5), and upgrading the default compiler 12 months after 11.2 release will be judged too risky...",
    "created_at": "2010-12-05T10:40:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10119#issuecomment-102246",
    "user": "Koen"
}
```

The CPU type is Nehalem (Core i7/Xeon 5500 series), specifically an X5570.

Reporting it upstream probably won't do much good, because the later release openSUSE 11.3 uses a different GCC already (4.5), and upgrading the default compiler 12 months after 11.2 release will be judged too risky...



---

archive/issue_comments_102247.json:
```json
{
    "body": "Replying to [comment:18 Koen]:\n> The CPU type is Nehalem (Core i7/Xeon 5500 series), specifically an X5570.\n\nWe consider \"trial building\" with limits, reducing the optimization level on failures (See http://trac.sagemath.org/sage_trac/ticket/10430#comment:3 ff.)\n\nThoughts?\n\n\n\n\n> Reporting it upstream probably won't do much good, because the later release openSUSE 11.3 uses a different GCC already (4.5), and upgrading the default compiler 12 months after 11.2 release will be judged too risky...\n\nI meant rather PARI, such that the developers get more aware of these odd failures (on a potentially large number of systems).",
    "created_at": "2010-12-05T15:11:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10119#issuecomment-102247",
    "user": "leif"
}
```

Replying to [comment:18 Koen]:
> The CPU type is Nehalem (Core i7/Xeon 5500 series), specifically an X5570.

We consider "trial building" with limits, reducing the optimization level on failures (See http://trac.sagemath.org/sage_trac/ticket/10430#comment:3 ff.)

Thoughts?




> Reporting it upstream probably won't do much good, because the later release openSUSE 11.3 uses a different GCC already (4.5), and upgrading the default compiler 12 months after 11.2 release will be judged too risky...

I meant rather PARI, such that the developers get more aware of these odd failures (on a potentially large number of systems).



---

archive/issue_comments_102248.json:
```json
{
    "body": "At #10430, there is a spkg to test: [http://sage.math.washington.edu/home/jdemeyer/spkg/pari-2.4.3.alpha.p1.spkg](http://sage.math.washington.edu/home/jdemeyer/spkg/pari-2.4.3.alpha.p1.spkg).  It would be **very useful** to know whether this solves the problem reported here.",
    "created_at": "2010-12-10T10:03:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10119#issuecomment-102248",
    "user": "jdemeyer"
}
```

At #10430, there is a spkg to test: [http://sage.math.washington.edu/home/jdemeyer/spkg/pari-2.4.3.alpha.p1.spkg](http://sage.math.washington.edu/home/jdemeyer/spkg/pari-2.4.3.alpha.p1.spkg).  It would be **very useful** to know whether this solves the problem reported here.



---

archive/issue_comments_102249.json:
```json
{
    "body": "I have tested it quickly (by killing the compiler process by hand when it got stuck for a few minutes on the base3.c file), and indeed the updated version falls back to -O2, then to -O1. With -O1, GCC 4.4.1 is able to successfully build the package. So the skpg solves this problem for me :)\n\nTo see how long it takes to 'fail' twice, I will now let it run for a few hours without manual intervention.",
    "created_at": "2010-12-10T10:29:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10119#issuecomment-102249",
    "user": "Koen"
}
```

I have tested it quickly (by killing the compiler process by hand when it got stuck for a few minutes on the base3.c file), and indeed the updated version falls back to -O2, then to -O1. With -O1, GCC 4.4.1 is able to successfully build the package. So the skpg solves this problem for me :)

To see how long it takes to 'fail' twice, I will now let it run for a few hours without manual intervention.



---

archive/issue_comments_102250.json:
```json
{
    "body": "Killed it after 11GB of memory use and 17 minutes of CPU time on a single file; the fallback to -O1 works, but I'm guessing the updated spkg does not impose any limits on the compilation.",
    "created_at": "2010-12-10T10:50:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10119#issuecomment-102250",
    "user": "Koen"
}
```

Killed it after 11GB of memory use and 17 minutes of CPU time on a single file; the fallback to -O1 works, but I'm guessing the updated spkg does not impose any limits on the compilation.



---

archive/issue_comments_102251.json:
```json
{
    "body": "Replying to [comment:22 Koen]:\n> Killed it after 11GB of memory use and 17 minutes of CPU time on a single file; the fallback to -O1 works, but I'm guessing the updated spkg does not impose any limits on the compilation.\n\nWell, it should :-)\n\nTry the following in a bash session:\n\n```\n$ ulimit -v\n$ ( ulimit -v 1; gcc --version )\n```\n",
    "created_at": "2010-12-10T11:08:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10119#issuecomment-102251",
    "user": "jdemeyer"
}
```

Replying to [comment:22 Koen]:
> Killed it after 11GB of memory use and 17 minutes of CPU time on a single file; the fallback to -O1 works, but I'm guessing the updated spkg does not impose any limits on the compilation.

Well, it should :-)

Try the following in a bash session:

```
$ ulimit -v
$ ( ulimit -v 1; gcc --version )
```




---

archive/issue_comments_102252.json:
```json
{
    "body": "Ah, sorry for the confusion; it is a machine with a lot of memory (>64GB), and the memory limit by default is configured to 60GB. I thought the compilation process itself also specified some kind of limit.\n\n\n```\nksande@kameleon:~> ulimit -v\n61182400\nksande@kameleon:~> ulimit -v 1; gcc --version\nKilled\n```\n",
    "created_at": "2010-12-10T11:44:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10119#issuecomment-102252",
    "user": "Koen"
}
```

Ah, sorry for the confusion; it is a machine with a lot of memory (>64GB), and the memory limit by default is configured to 60GB. I thought the compilation process itself also specified some kind of limit.


```
ksande@kameleon:~> ulimit -v
61182400
ksande@kameleon:~> ulimit -v 1; gcc --version
Killed
```




---

archive/issue_comments_102253.json:
```json
{
    "body": "Replying to [comment:24 Koen]:\n> Ah, sorry for the confusion; it is a machine with a lot of memory (>64GB), and the memory limit by default is configured to 60GB. I thought the compilation process itself also specified some kind of limit.\n\nI have made a new spkg (same location: [http://sage.math.washington.edu/home/jdemeyer/spkg/pari-2.4.3.alpha.p1.spkg](http://sage.math.washington.edu/home/jdemeyer/spkg/pari-2.4.3.alpha.p1.spkg)).  Can you try with that?",
    "created_at": "2010-12-10T12:44:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10119#issuecomment-102253",
    "user": "jdemeyer"
}
```

Replying to [comment:24 Koen]:
> Ah, sorry for the confusion; it is a machine with a lot of memory (>64GB), and the memory limit by default is configured to 60GB. I thought the compilation process itself also specified some kind of limit.

I have made a new spkg (same location: [http://sage.math.washington.edu/home/jdemeyer/spkg/pari-2.4.3.alpha.p1.spkg](http://sage.math.washington.edu/home/jdemeyer/spkg/pari-2.4.3.alpha.p1.spkg)).  Can you try with that?



---

archive/issue_comments_102254.json:
```json
{
    "body": "Great, this new version fails much sooner on -O3/-O2 (hardly any delay), and after that it finishes correctly on -O1.\n\n\n```\ngcc  -c -O3 -Wall -fno-strict-aliasing -fomit-frame-pointer  -O3 -g   -I. -I../src/headers -fPIC -o base3.o ../src/basemath/base3.c\n\ncc1: out of memory allocating 488 bytes after a total of 341737472 bytes\nmake[1]: *** [base3.o] Error 1\nmake[1]: Leaving directory `/home/ksande/temp/sage-4.6/spkg/build/pari-2.4.3.alpha.p1/src/Olinux-x86_64'\nmake: *** [gp] Error 2\n===========================================\nBuilding PARI/GP with optimization flag -O2\n===========================================\n```\n",
    "created_at": "2010-12-10T14:02:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10119#issuecomment-102254",
    "user": "Koen"
}
```

Great, this new version fails much sooner on -O3/-O2 (hardly any delay), and after that it finishes correctly on -O1.


```
gcc  -c -O3 -Wall -fno-strict-aliasing -fomit-frame-pointer  -O3 -g   -I. -I../src/headers -fPIC -o base3.o ../src/basemath/base3.c

cc1: out of memory allocating 488 bytes after a total of 341737472 bytes
make[1]: *** [base3.o] Error 1
make[1]: Leaving directory `/home/ksande/temp/sage-4.6/spkg/build/pari-2.4.3.alpha.p1/src/Olinux-x86_64'
make: *** [gp] Error 2
===========================================
Building PARI/GP with optimization flag -O2
===========================================
```




---

archive/issue_comments_102255.json:
```json
{
    "body": "Resolution: duplicate",
    "created_at": "2010-12-10T14:13:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10119#issuecomment-102255",
    "user": "jdemeyer"
}
```

Resolution: duplicate



---

archive/issue_comments_102256.json:
```json
{
    "body": "Koen: could you add your real name as \"reviewer\" on this ticket and also add it to [http://trac.sagemath.org/sage_trac/#AccountNamesmappedtoRealNames](http://trac.sagemath.org/sage_trac/#AccountNamesmappedtoRealNames)?",
    "created_at": "2010-12-10T14:15:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10119#issuecomment-102256",
    "user": "jdemeyer"
}
```

Koen: could you add your real name as "reviewer" on this ticket and also add it to [http://trac.sagemath.org/sage_trac/#AccountNamesmappedtoRealNames](http://trac.sagemath.org/sage_trac/#AccountNamesmappedtoRealNames)?
