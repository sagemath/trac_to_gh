# Issue 24441: Add class for greedy linear extensions

archive/issues_024441.json:
```json
{
    "body": "CC:  tscrim\n\nThis patch adds a class for greedy linear extensions.\n\nIssue created by migration from https://trac.sagemath.org/ticket/24678\n\n",
    "created_at": "2018-02-07T09:29:40Z",
    "labels": [
        "combinatorics",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.2",
    "title": "Add class for greedy linear extensions",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24441",
    "user": "jmantysalo"
}
```
CC:  tscrim

This patch adds a class for greedy linear extensions.

Issue created by migration from https://trac.sagemath.org/ticket/24678





---

archive/issue_comments_342805.json:
```json
{
    "body": "First ever Python class by me. At least some of this works.\n----\nNew commits:",
    "created_at": "2018-02-07T09:31:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24441#issuecomment-342805",
    "user": "jmantysalo"
}
```

First ever Python class by me. At least some of this works.
----
New commits:



---

archive/issue_comments_342806.json:
```json
{
    "body": "At least `tau` returns wrong type.",
    "created_at": "2018-02-07T10:20:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24441#issuecomment-342806",
    "user": "jmantysalo"
}
```

At least `tau` returns wrong type.



---

archive/issue_comments_342807.json:
```json
{
    "body": "In some ways, this is not an ideal way to learn how to write a class. Although after this, writing any other class will be a cakewalk (i.e., extremely easy). I will take a more detailed look in the morning when I get to my office (I am on Australian time) to see what a good approach might be. If you could tell me all of the methods which currently return the wrong type, that would be useful.",
    "created_at": "2018-02-07T13:04:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24441#issuecomment-342807",
    "user": "tscrim"
}
```

In some ways, this is not an ideal way to learn how to write a class. Although after this, writing any other class will be a cakewalk (i.e., extremely easy). I will take a more detailed look in the morning when I get to my office (I am on Australian time) to see what a good approach might be. If you could tell me all of the methods which currently return the wrong type, that would be useful.



---

archive/issue_comments_342808.json:
```json
{
    "body": "Thanks, and there is no horry at all.\n\nFunctions are `evacuation`, `tau` and `promotion`, but propably I can do two if I see how to make one.",
    "created_at": "2018-02-07T13:23:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24441#issuecomment-342808",
    "user": "jmantysalo"
}
```

Thanks, and there is no horry at all.

Functions are `evacuation`, `tau` and `promotion`, but propably I can do two if I see how to make one.



---

archive/issue_comments_342809.json:
```json
{
    "body": "It looks like it is sufficient to just overwrite `tau` with something like\n\n```python\n    def tau(self, i):\n        P = self.poset()\n        a = self[i-1]\n        b = self[i  ]\n        if P.lt(a,b) or P.lt(b,a):\n            return self\n        q = list(self)\n        q[i-1] = b\n        q[i  ] = a\n        return P.linear_extensions()(q, check=False) # We know this is a linear extension\n```\n\nNote that this will never return a greedy linear extension class, but since `evacuation` and `promotion` use `tau`, those will return standard linear extensions by default.",
    "created_at": "2018-02-07T22:48:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24441#issuecomment-342809",
    "user": "tscrim"
}
```

It looks like it is sufficient to just overwrite `tau` with something like

```python
    def tau(self, i):
        P = self.poset()
        a = self[i-1]
        b = self[i  ]
        if P.lt(a,b) or P.lt(b,a):
            return self
        q = list(self)
        q[i-1] = b
        q[i  ] = a
        return P.linear_extensions()(q, check=False) # We know this is a linear extension
```

Note that this will never return a greedy linear extension class, but since `evacuation` and `promotion` use `tau`, those will return standard linear extensions by default.



---

archive/issue_comments_342810.json:
```json
{
    "body": "Replying to [comment:6 tscrim]:\n> It looks like it is sufficient to just overwrite `tau` with something like\n\nAlso `return self` must be corrected. But is this supposed to be in the class `GreedyLinearExtension`? If so, I think for a user it is better to have `_tau()` that is called from `tau()`, so that there is no visible function with the same name.\n\nSo, in any case we need classes `LinearExtensionOfPoset` (without `s`) and `LinearExtensionsOfPoset`.",
    "created_at": "2018-02-08T07:25:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24441#issuecomment-342810",
    "user": "jmantysalo"
}
```

Replying to [comment:6 tscrim]:
> It looks like it is sufficient to just overwrite `tau` with something like

Also `return self` must be corrected. But is this supposed to be in the class `GreedyLinearExtension`? If so, I think for a user it is better to have `_tau()` that is called from `tau()`, so that there is no visible function with the same name.

So, in any case we need classes `LinearExtensionOfPoset` (without `s`) and `LinearExtensionsOfPoset`.



---

archive/issue_comments_342811.json:
```json
{
    "body": "Replying to [comment:7 jmantysalo]:\n> Replying to [comment:6 tscrim]:\n> > It looks like it is sufficient to just overwrite `tau` with something like\n> \n> Also `return self` must be corrected. But is this supposed to be in the class `GreedyLinearExtension`? If so, I think for a user it is better to have `_tau()` that is called from `tau()`, so that there is no visible function with the same name.\n\nIt is okay to do `return self` as the greedy class will be a subclass of the generic. Polymorphism (or duck-typing if you prefer) takes care of the rest. You don't need a `_tau()` method.\n\n> So, in any case we need classes `LinearExtensionOfPoset` (without `s`) and `LinearExtensionsOfPoset`.\n\nRight, we still need those classes. I wasn't suggesting otherwise.",
    "created_at": "2018-02-08T07:32:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24441#issuecomment-342811",
    "user": "tscrim"
}
```

Replying to [comment:7 jmantysalo]:
> Replying to [comment:6 tscrim]:
> > It looks like it is sufficient to just overwrite `tau` with something like
> 
> Also `return self` must be corrected. But is this supposed to be in the class `GreedyLinearExtension`? If so, I think for a user it is better to have `_tau()` that is called from `tau()`, so that there is no visible function with the same name.

It is okay to do `return self` as the greedy class will be a subclass of the generic. Polymorphism (or duck-typing if you prefer) takes care of the rest. You don't need a `_tau()` method.

> So, in any case we need classes `LinearExtensionOfPoset` (without `s`) and `LinearExtensionsOfPoset`.

Right, we still need those classes. I wasn't suggesting otherwise.



---

archive/issue_comments_342812.json:
```json
{
    "body": "Replying to [comment:8 tscrim]:\n\n> It is okay to do `return self` as the greedy class will be a subclass of the generic. Polymorphism (or duck-typing if you prefer) takes care of the rest. You don't need a `_tau()` method.\n\nOK, trying to understand... But `type(12/4)` says that it is rational, i.e. return value is based on input type, not by input value. But so it OK to have `tau(3)` to return a (generic) linear extension and `tau(4)` to return a greedy linear extension?",
    "created_at": "2018-02-08T07:35:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24441#issuecomment-342812",
    "user": "jmantysalo"
}
```

Replying to [comment:8 tscrim]:

> It is okay to do `return self` as the greedy class will be a subclass of the generic. Polymorphism (or duck-typing if you prefer) takes care of the rest. You don't need a `_tau()` method.

OK, trying to understand... But `type(12/4)` says that it is rational, i.e. return value is based on input type, not by input value. But so it OK to have `tau(3)` to return a (generic) linear extension and `tau(4)` to return a greedy linear extension?



---

archive/issue_comments_342813.json:
```json
{
    "body": "Replying to [comment:9 jmantysalo]:\n> Replying to [comment:8 tscrim]:\n> \n> > It is okay to do `return self` as the greedy class will be a subclass of the generic. Polymorphism (or duck-typing if you prefer) takes care of the rest. You don't need a `_tau()` method.\n> \n> OK, trying to understand... But `type(12/4)` says that it is rational, i.e. return value is based on input type, not by input value. But so it OK to have `tau(3)` to return a (generic) linear extension and `tau(4)` to return a greedy linear extension?\n\nIn principle we could have `12/4` be an `Integer`, but that would mean checking the denominator, which has a performance penalty (yes, it is minor, but it matters because of how essential arithmetic operations are). Because of duck-typing, we generally do not care about the distinction between `Rational` and `Integer`. Perhaps a more fair example would be\n\n```\nsage: R.<x> = LaurentPolynomialRing(ZZ)\nsage: type(1/x)\n<type 'sage.rings.polynomial.laurent_polynomial.LaurentPolynomial_univariate'>\nsage: type(1/(x+1))\n<type 'sage.rings.fraction_field_element.FractionFieldElement'>\n```\n\nHowever, this is not quite our case because we are returning a *subclass*, which is a stronger notion because it will satisfy, e.g., an `isinstance(p, LinearExtensionOfPoset)` check and it has to have the same API as `LinearExtensionOfPoset`.",
    "created_at": "2018-02-08T07:41:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24441#issuecomment-342813",
    "user": "tscrim"
}
```

Replying to [comment:9 jmantysalo]:
> Replying to [comment:8 tscrim]:
> 
> > It is okay to do `return self` as the greedy class will be a subclass of the generic. Polymorphism (or duck-typing if you prefer) takes care of the rest. You don't need a `_tau()` method.
> 
> OK, trying to understand... But `type(12/4)` says that it is rational, i.e. return value is based on input type, not by input value. But so it OK to have `tau(3)` to return a (generic) linear extension and `tau(4)` to return a greedy linear extension?

In principle we could have `12/4` be an `Integer`, but that would mean checking the denominator, which has a performance penalty (yes, it is minor, but it matters because of how essential arithmetic operations are). Because of duck-typing, we generally do not care about the distinction between `Rational` and `Integer`. Perhaps a more fair example would be

```
sage: R.<x> = LaurentPolynomialRing(ZZ)
sage: type(1/x)
<type 'sage.rings.polynomial.laurent_polynomial.LaurentPolynomial_univariate'>
sage: type(1/(x+1))
<type 'sage.rings.fraction_field_element.FractionFieldElement'>
```

However, this is not quite our case because we are returning a *subclass*, which is a stronger notion because it will satisfy, e.g., an `isinstance(p, LinearExtensionOfPoset)` check and it has to have the same API as `LinearExtensionOfPoset`.



---

archive/issue_comments_342814.json:
```json
{
    "body": "OK, I will proceed with this information.",
    "created_at": "2018-02-08T07:47:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24441#issuecomment-342814",
    "user": "jmantysalo"
}
```

OK, I will proceed with this information.



---

archive/issue_comments_342815.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-02-08T10:02:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24441#issuecomment-342815",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_342816.json:
```json
{
    "body": "Note, what I was saying was not to *change* `LinearExtensionOfPoset.tau()`, but to override it with a completely *new* method in the subclass `GreedyLinearExtensionOfPoset`.",
    "created_at": "2018-02-08T12:16:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24441#issuecomment-342816",
    "user": "tscrim"
}
```

Note, what I was saying was not to *change* `LinearExtensionOfPoset.tau()`, but to override it with a completely *new* method in the subclass `GreedyLinearExtensionOfPoset`.



---

archive/issue_comments_342817.json:
```json
{
    "body": "Replying to [comment:13 tscrim]:\n> Note, what I was saying was not to *change* `LinearExtensionOfPoset.tau()`, but to override it with a completely *new* method in the subclass `GreedyLinearExtensionOfPoset`.\n\nBut that means that the user sees documentation for both `LinearExtensionOfPoset.tau()` and `GreedyLinearExtensionOfPoset.tau()` even when they have no difference.",
    "created_at": "2018-02-08T12:45:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24441#issuecomment-342817",
    "user": "jmantysalo"
}
```

Replying to [comment:13 tscrim]:
> Note, what I was saying was not to *change* `LinearExtensionOfPoset.tau()`, but to override it with a completely *new* method in the subclass `GreedyLinearExtensionOfPoset`.

But that means that the user sees documentation for both `LinearExtensionOfPoset.tau()` and `GreedyLinearExtensionOfPoset.tau()` even when they have no difference.



---

archive/issue_comments_342818.json:
```json
{
    "body": "Replying to [comment:14 jmantysalo]:\n> Replying to [comment:13 tscrim]:\n> > Note, what I was saying was not to *change* `LinearExtensionOfPoset.tau()`, but to override it with a completely *new* method in the subclass `GreedyLinearExtensionOfPoset`.\n> \n> But that means that the user sees documentation for both `LinearExtensionOfPoset.tau()` and `GreedyLinearExtensionOfPoset.tau()` even when they have no difference.\n\nWell, in the built doc for each individual class, in principle, yes. However, they will have different doctests, specifically, the latter one should demonstrate that it is only a generic linear extension in a non-trivial case. By doing `L.tau?`, they will only see one.",
    "created_at": "2018-02-08T12:52:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24441",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24441#issuecomment-342818",
    "user": "tscrim"
}
```

Replying to [comment:14 jmantysalo]:
> Replying to [comment:13 tscrim]:
> > Note, what I was saying was not to *change* `LinearExtensionOfPoset.tau()`, but to override it with a completely *new* method in the subclass `GreedyLinearExtensionOfPoset`.
> 
> But that means that the user sees documentation for both `LinearExtensionOfPoset.tau()` and `GreedyLinearExtensionOfPoset.tau()` even when they have no difference.

Well, in the built doc for each individual class, in principle, yes. However, they will have different doctests, specifically, the latter one should demonstrate that it is only a generic linear extension in a non-trivial case. By doing `L.tau?`, they will only see one.
