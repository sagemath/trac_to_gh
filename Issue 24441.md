# Issue 24441: Add class for greedy linear extensions

Issue created by migration from https://trac.sagemath.org/ticket/24678

Original creator: jmantysalo

Original creation time: 2018-02-07 09:29:40

CC:  tscrim

This patch adds a class for greedy linear extensions.


---

Comment by jmantysalo created at 2018-02-07 09:31:54

First ever Python class by me. At least some of this works.
----
New commits:


---

Comment by jmantysalo created at 2018-02-07 10:20:23

At least `tau` returns wrong type.


---

Comment by tscrim created at 2018-02-07 13:04:51

In some ways, this is not an ideal way to learn how to write a class. Although after this, writing any other class will be a cakewalk (i.e., extremely easy). I will take a more detailed look in the morning when I get to my office (I am on Australian time) to see what a good approach might be. If you could tell me all of the methods which currently return the wrong type, that would be useful.


---

Comment by jmantysalo created at 2018-02-07 13:23:16

Thanks, and there is no horry at all.

Functions are `evacuation`, `tau` and `promotion`, but propably I can do two if I see how to make one.


---

Comment by tscrim created at 2018-02-07 22:48:04

It looks like it is sufficient to just overwrite `tau` with something like

```python
    def tau(self, i):
        P = self.poset()
        a = self[i-1]
        b = self[i  ]
        if P.lt(a,b) or P.lt(b,a):
            return self
        q = list(self)
        q[i-1] = b
        q[i  ] = a
        return P.linear_extensions()(q, check=False) # We know this is a linear extension
```

Note that this will never return a greedy linear extension class, but since `evacuation` and `promotion` use `tau`, those will return standard linear extensions by default.


---

Comment by jmantysalo created at 2018-02-08 07:25:20

Replying to [comment:6 tscrim]:
> It looks like it is sufficient to just overwrite `tau` with something like

Also `return self` must be corrected. But is this supposed to be in the class `GreedyLinearExtension`? If so, I think for a user it is better to have `_tau()` that is called from `tau()`, so that there is no visible function with the same name.

So, in any case we need classes `LinearExtensionOfPoset` (without `s`) and `LinearExtensionsOfPoset`.


---

Comment by tscrim created at 2018-02-08 07:32:01

Replying to [comment:7 jmantysalo]:
> Replying to [comment:6 tscrim]:
> > It looks like it is sufficient to just overwrite `tau` with something like
> 
> Also `return self` must be corrected. But is this supposed to be in the class `GreedyLinearExtension`? If so, I think for a user it is better to have `_tau()` that is called from `tau()`, so that there is no visible function with the same name.

It is okay to do `return self` as the greedy class will be a subclass of the generic. Polymorphism (or duck-typing if you prefer) takes care of the rest. You don't need a `_tau()` method.

> So, in any case we need classes `LinearExtensionOfPoset` (without `s`) and `LinearExtensionsOfPoset`.

Right, we still need those classes. I wasn't suggesting otherwise.


---

Comment by jmantysalo created at 2018-02-08 07:35:26

Replying to [comment:8 tscrim]:

> It is okay to do `return self` as the greedy class will be a subclass of the generic. Polymorphism (or duck-typing if you prefer) takes care of the rest. You don't need a `_tau()` method.

OK, trying to understand... But `type(12/4)` says that it is rational, i.e. return value is based on input type, not by input value. But so it OK to have `tau(3)` to return a (generic) linear extension and `tau(4)` to return a greedy linear extension?


---

Comment by tscrim created at 2018-02-08 07:41:32

Replying to [comment:9 jmantysalo]:
> Replying to [comment:8 tscrim]:
> 
> > It is okay to do `return self` as the greedy class will be a subclass of the generic. Polymorphism (or duck-typing if you prefer) takes care of the rest. You don't need a `_tau()` method.
> 
> OK, trying to understand... But `type(12/4)` says that it is rational, i.e. return value is based on input type, not by input value. But so it OK to have `tau(3)` to return a (generic) linear extension and `tau(4)` to return a greedy linear extension?

In principle we could have `12/4` be an `Integer`, but that would mean checking the denominator, which has a performance penalty (yes, it is minor, but it matters because of how essential arithmetic operations are). Because of duck-typing, we generally do not care about the distinction between `Rational` and `Integer`. Perhaps a more fair example would be

```
sage: R.<x> = LaurentPolynomialRing(ZZ)
sage: type(1/x)
<type 'sage.rings.polynomial.laurent_polynomial.LaurentPolynomial_univariate'>
sage: type(1/(x+1))
<type 'sage.rings.fraction_field_element.FractionFieldElement'>
```

However, this is not quite our case because we are returning a *subclass*, which is a stronger notion because it will satisfy, e.g., an `isinstance(p, LinearExtensionOfPoset)` check and it has to have the same API as `LinearExtensionOfPoset`.


---

Comment by jmantysalo created at 2018-02-08 07:47:27

OK, I will proceed with this information.


---

Comment by git created at 2018-02-08 10:02:36

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2018-02-08 12:16:38

Note, what I was saying was not to _change_ `LinearExtensionOfPoset.tau()`, but to override it with a completely _new_ method in the subclass `GreedyLinearExtensionOfPoset`.


---

Comment by jmantysalo created at 2018-02-08 12:45:39

Replying to [comment:13 tscrim]:
> Note, what I was saying was not to _change_ `LinearExtensionOfPoset.tau()`, but to override it with a completely _new_ method in the subclass `GreedyLinearExtensionOfPoset`.

But that means that the user sees documentation for both `LinearExtensionOfPoset.tau()` and `GreedyLinearExtensionOfPoset.tau()` even when they have no difference.


---

Comment by tscrim created at 2018-02-08 12:52:29

Replying to [comment:14 jmantysalo]:
> Replying to [comment:13 tscrim]:
> > Note, what I was saying was not to _change_ `LinearExtensionOfPoset.tau()`, but to override it with a completely _new_ method in the subclass `GreedyLinearExtensionOfPoset`.
> 
> But that means that the user sees documentation for both `LinearExtensionOfPoset.tau()` and `GreedyLinearExtensionOfPoset.tau()` even when they have no difference.

Well, in the built doc for each individual class, in principle, yes. However, they will have different doctests, specifically, the latter one should demonstrate that it is only a generic linear extension in a non-trivial case. By doing `L.tau?`, they will only see one.
