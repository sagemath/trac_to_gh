# Issue 24554: py3: fix tests in sage.structure.unique_representation

Issue created by migration from https://trac.sagemath.org/ticket/24791

Original creator: embray

Original creation time: 2018-02-20 13:23:49

On one hand, we might still want to test `__cmp__` with this code on Python 2.  On the other hand, I think we'll be replacing most/all `__cmp__` methods anyways, so maybe it doesn't matter.  The comparison implementation itself is also not critical to how `UniqueRepresentation` works.

I'm fine with either way.


---

Comment by git created at 2018-02-20 13:24:07

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-02-20 13:25:02

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by embray created at 2018-02-20 13:25:14

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2018-02-20 13:55:56

This code looks strange:

```
        ....:         if op in (op_EQ, op_NE):
        ....:             if type(self) != type(other):
        ....:                 return op == op_NE
```

I wouldn't write that in an example. Would it work to do

```
        ....:         if type(self) is not type(other):
        ....:             return NotImplemented
```



---

Comment by jdemeyer created at 2018-02-20 13:55:56

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2018-02-20 19:16:54

The docs are no longer consistent with the example. I actually think it's best to just remove the `__cmp__` completely (instead of replacing it with `__richcmp__`) and then also remove the talk about custom comparison methods from the docs.


---

Comment by jdemeyer created at 2018-02-20 19:18:47

Just FYI: this conflicts with #19628


---

Comment by embray created at 2018-02-21 11:32:03

Replying to [comment:5 jdemeyer]:
> The docs are no longer consistent with the example. I actually think it's best to just remove the `__cmp__` completely (instead of replacing it with `__richcmp__`) and then also remove the talk about custom comparison methods from the docs.

That did seem out of place to me as well.  Beyond `__eq__` the talk of other comparison operators doesn't seem relevant, but I wasn't sure.

To be clear, you're just talking about the second example, and ensuing discussion of comparison methods, right?  In the first example the `__eq__`, at least, is still necessary.

I ask just because, while I understand what this class does on its own, I wasn't sure if there was some subtlety of how it's used in Sage that necessitated this documentation.


---

Comment by jdemeyer created at 2018-02-21 12:34:44

Yes, I was talking about the example with the `"custom cmp"`


---

Comment by embray created at 2018-02-21 13:01:37

Replying to [comment:6 jdemeyer]:
> Just FYI: this conflicts with #19628

That ticket looks like it's been sitting around for quite a while. Is it something I could be of help with?


---

Comment by jdemeyer created at 2018-02-21 13:04:45

Replying to [comment:9 embray]:
> Is it something I could be of help with?

It just needs review...


---

Comment by git created at 2018-02-21 13:33:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-02-21 13:35:02

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by embray created at 2018-02-21 13:37:30

Changing status from needs_work to needs_review.


---

Comment by embray created at 2018-02-21 13:37:30

Merged in #19628 and removed the custom comparison examples.  In the end the only change needed for Python 3 is to replace the one `__cmp__` in the example for `CachedRepresentation` with `__eq__`, which makes more sense anyways.


---

Comment by chapoton created at 2018-03-11 07:47:37

We should keep the test for `!=`


---

Comment by embray created at 2018-03-12 14:52:05

That's a good point.


---

Comment by embray created at 2018-03-12 14:52:05

Changing status from needs_review to needs_work.


---

Comment by git created at 2018-03-12 14:54:25

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2018-03-14 18:59:47

Changing keywords from "" to "python3, richcmp".


---

Comment by chapoton created at 2018-03-14 19:00:19

is this back to needs_review ?


---

Comment by chapoton created at 2018-03-15 13:19:48

Changing status from needs_work to needs_review.


---

Comment by chapoton created at 2018-03-15 13:19:48

I will assume so.


---

Comment by jdemeyer created at 2018-03-16 09:28:32

This sentence still makes no sense to me (see [comment:5]):

```
For other
comparisons, the relevant custom comparison is called if defined for either
the left-hand side or the right-hand side::
```



---

Comment by jdemeyer created at 2018-03-16 09:28:32

Changing status from needs_review to needs_work.


---

Comment by embray created at 2018-03-16 12:53:27

Changing status from needs_work to needs_review.


---

Comment by embray created at 2018-03-16 12:53:27

Could you clarify?  I think the sentence itself makes sense; or is at least true. If anything doesn't make sense it might just be the placement. I.e. the examples that immediately follow that sentence isn't really relevant (the sentence is more a modification to the previous sentence, to which the examples due apply).  

Maybe if it were moved later?  I wouldn't outright remove it--the point is just to say that other custom comparisons may still be implemented on classes that subclass from this.


---

Comment by jdemeyer created at 2018-03-16 13:10:06

What are "other comparisons" in that sentence?


---

Comment by embray created at 2018-03-16 13:23:57

`<` `>` `<=` `>=`?


---

Comment by jdemeyer created at 2018-03-16 13:26:47

OK, but then what is "the relevant custom comparison"?


---

Comment by jdemeyer created at 2018-03-16 13:27:08

I would just remove that sentence completely.


---

Comment by embray created at 2018-03-16 13:34:20

Okay... I don't really see a problem with it other than what I explained above, but I can certainly live without it as well.


---

Comment by jdemeyer created at 2018-03-16 13:36:39

If that sentence is meant to say that you can subclass `CachedRepresentation` and add your own rich comparison methods, it's saying that very badly. It's also superfluous since that's how subclassing in Python works in general.


---

Comment by git created at 2018-03-16 13:43:47

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by embray created at 2018-03-16 13:46:19

Replying to [comment:27 jdemeyer]:
> It's also superfluous since that's how subclassing in Python works in general.

I agree that it's superfluous, but so is a lot of the other text in there. I figured it was worth pointing out for those who aren't completely comfortable how subclassing works w.r.t. comparisons (heck, I'm not even completely comfortable with it, if recent experience dictates).

So it's saying "these objects have this specific type of behavior when it comes to identity comparisons, but may still have any other behavior w.r.t. ordering behavior".  But I don't think it's too important to say that either.


---

Comment by jdemeyer created at 2018-03-16 14:01:09

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2018-03-22 19:22:53

Resolution: fixed
