# Issue 29070: gfortran: build-gcc: Don't hardcode bash as /bin/bash

Issue created by migration from https://trac.sagemath.org/ticket/29307

Original creator: mkoeppe

Original creation time: 2020-03-10 03:17:09

CC:  @timokau

Causes errors on nix (#29130)


---

Comment by mkoeppe created at 2020-03-10 03:20:07

Changing status from new to needs_review.


---

Comment by jhpalmieri created at 2020-03-10 03:43:31

How about these changes?

```diff
diff --git a/build/pkgs/gcc/build-gcc b/build/pkgs/gcc/build-gcc
index 3773a22552..1b3c72b129 100755
--- a/build/pkgs/gcc/build-gcc
+++ b/build/pkgs/gcc/build-gcc
@@ -1,4 +1,4 @@
-#! /usr/bin/env bash
+#!/usr/bin/env bash
 #
 # Wrapper script for building GCC used for both the gcc and gfortran SPKGs
 # Usage:
diff --git a/build/pkgs/gcc/spkg-build b/build/pkgs/gcc/spkg-build
index 2c07c4ea98..441c9774b4 100644
--- a/build/pkgs/gcc/spkg-build
+++ b/build/pkgs/gcc/spkg-build
@@ -9,7 +9,7 @@ if { uname -sr | grep 'Darwin [0-9]\.' ;} &>/dev/null; then
     mkdir -p bin/
     LD=`which "${LD:-ld}"`
 
-    echo '#!/bin/bash' >>"bin/ld"
+    echo '#!/usr/bin/env bash' >>"bin/ld"
     echo '# ld wrapper generated by the GCC spkg' >>"bin/ld"
     echo >>"bin/ld"
     # Hardcode the path to the "real" ld.
```

----
New commits:


---

Comment by @timokau created at 2020-03-10 12:52:05

Looks good to me. It has been a while since I tried to compile sage-the-distribution on nix, but I'm glad to see you're looking into this.


---

Comment by git created at 2020-03-10 22:13:15

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-03-10 22:14:48

Replying to [comment:4 jhpalmieri]:
> How about these changes?
> {{{
> diff --git a/build/pkgs/gcc/build-gcc b/build/pkgs/gcc/build-gcc
> }}}

OK, done.

> {{{
> diff --git a/build/pkgs/gcc/spkg-build b/build/pkgs/gcc/spkg-build
> index 2c07c4ea98..441c9774b4 100644
> --- a/build/pkgs/gcc/spkg-build
> +++ b/build/pkgs/gcc/spkg-build
> `@``@` -9,7 +9,7 `@``@` if { uname -sr | grep 'Darwin [0-9]\.' ;} &>/dev/null; then
>      mkdir -p bin/
>      LD=`which "${LD:-ld}"`
>  
> -    echo '#!/bin/bash' >>"bin/ld"
> +    echo '#!/usr/bin/env bash' >>"bin/ld"
>      echo '# ld wrapper generated by the GCC spkg' >>"bin/ld"
>      echo >>"bin/ld"
>      # Hardcode the path to the "real" ld.
> }}}

This is code for ancient macOS versions that I would be unable to test. Best to leave it alone.


---

Comment by jhpalmieri created at 2020-03-10 22:39:55

Changing status from needs_review to positive_review.


---

Comment by jhpalmieri created at 2020-03-10 22:39:55

Okay


---

Comment by mkoeppe created at 2020-03-10 23:22:22

Thanks!


---

Comment by vbraun created at 2020-03-11 23:46:01

Resolution: fixed
