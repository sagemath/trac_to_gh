# Issue 16508: Random OperationalError: disk I/O error

Issue created by migration from https://trac.sagemath.org/ticket/16745

Original creator: vbraun

Original creation time: 2014-07-30 21:26:41

CC:  roed

Keywords: random_fail

I see this occasionally on different buildbots, so it is not a hardware problem. Looks like a race with the IPython sqlite history database.

```
sage: sig_on_count() ## line 923 ##
0
sage: ascii_art(tuple(DyckWords(3))) ## line 933 ##
(                                   /\   )
(            /\    /\      /\/\    /  \  )
( /\/\/\, /\/  \, /  \/\, /    \, /    \ )
sage: sig_on_count() ## line 937 ##
0

**********************************************************************
Traceback (most recent call last):
  File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 2117, in __call__
    atexit._run_exitfuncs()
  File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python/atexit.py", line 24, in _run_exitfuncs
    func(*targs, **kargs)
  File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/IPython/core/interactiveshell.py", line 3189, in atexit_operations
    self.history_manager.end_session()
  File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/IPython/core/history.py", line 525, in end_session
    len(self.input_hist_parsed)-1, self.session_number))
OperationalError: disk I/O error
```



---

Comment by jdemeyer created at 2014-08-29 15:59:06

Not sure why you think this is related to the doctest framework... It looks like a bug in IPython.


---

Comment by jdemeyer created at 2014-08-29 15:59:06

Changing keywords from "random_fail" to "random_fail ipython".


---

Comment by jdemeyer created at 2014-08-29 15:59:06

Changing component from doctest framework to packages: standard.


---

Comment by vbraun created at 2014-08-29 16:21:05

The doctest framework should (and does) disable the saving of commands to the history. Maybe we do something wrong / not enough to turn it off though. Could be an IPython issue as well, I agree.


---

Comment by vbraun created at 2014-09-02 14:12:25

Possible cause: https://github.com/ipython/ipython/pull/5874


---

Comment by vbraun created at 2014-09-02 14:33:09

New commits:


---

Comment by vbraun created at 2014-09-03 10:30:16

At least the patch doesn't make it worse ;-) only time will tell whether it fixes this. I'll reopen if it does not...


---

Comment by vbraun created at 2014-09-03 10:30:16

Changing status from new to needs_review.


---

Comment by was created at 2014-09-07 17:27:35

I'm rubber stamping this.


---

Comment by was created at 2014-09-07 17:27:35

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2014-09-08 08:48:41

Resolution: fixed
