# Issue 33296: Update nbconvert to 6.4.x, add optional package pyppeteer

Issue created by migration from https://trac.sagemath.org/ticket/33533

Original creator: mkoeppe

Original creation time: 2022-03-20 02:03:06

CC:  klee

[Pyppeteer](https://github.com/pyppeteer/pyppeteer) is needed for [webpdf exports](https://nbconvert.readthedocs.io/en/latest/usage.html#webpdf) of the Jupyter notebook.

The update to 6.4.x (https://nbconvert.readthedocs.io/en/latest/changelog.html) brings some improvements to webpdf exports.

6.4.x (and main as of 2022-03) still supports python 3.7, as needed for Sage 9.6

https://github.com/jupyter/nbconvert/blob/main/setup.py#L214

pyppeteer has a number of new dependencies, so for now we should only add it as a pip package.
https://github.com/pyppeteer/pyppeteer/blob/dev/pyproject.toml#L46


---

Comment by git created at 2022-03-27 20:04:47

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by mkoeppe created at 2022-03-27 20:14:43

Changing status from new to needs_review.


---

Comment by git created at 2022-03-27 20:18:22

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by klee created at 2022-03-28 08:17:44

>>> We convert the existing pip package to a standard normal package.

Then we need a discussion on sage-devel?


---

Comment by mkoeppe created at 2022-03-28 16:10:10

No, we have routinely added new dependencies of standard packages as standard packages on upgrades in the past


---

Comment by klee created at 2022-03-29 00:21:36

LGTM.


---

Comment by klee created at 2022-03-29 00:21:36

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2022-03-29 01:26:44

Thanks!


---

Comment by vbraun created at 2022-03-31 20:39:48

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2022-03-31 20:39:48


```
sage -t --long --warn-long 48.1 --random-seed=123 src/sage/misc/package.py
**********************************************************************
File "src/sage/misc/package.py", line 564, in sage.misc.package.optional_packages
Failed example:
    'beautifulsoup4' in installed+not_installed  # optional - sage_spkg
Expected:
    True
Got:
    False
**********************************************************************
1 item had failures:
   1 of   4 in sage.misc.package.optional_packages
    [56 tests, 1 failure, 3.67 s]
----------------------------------------------------------------------
sage -t --long --warn-long 48.1 --random-seed=123 src/sage/misc/package.py  # 1 doctest failed
----------------------------------------------------------------------
```



---

Comment by git created at 2022-03-31 22:46:46

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-03-31 22:49:09

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by mkoeppe created at 2022-03-31 22:49:20

Changing status from needs_work to needs_review.


---

Comment by mkoeppe created at 2022-03-31 22:49:20

New commits:


---

Comment by klee created at 2022-04-01 00:46:59

The prefix `bs4` also needs to be changed to `bp`?


---

Comment by git created at 2022-04-01 00:49:55

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by klee created at 2022-04-01 01:22:13

Changing status from needs_review to positive_review.


---

Comment by klee created at 2022-04-01 01:22:13

The issue is now resolved. Back to positive review.


---

Comment by mkoeppe created at 2022-04-01 01:27:38

Thanks!


---

Comment by vbraun created at 2022-04-03 11:13:47

Resolution: fixed
