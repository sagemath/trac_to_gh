# Issue 23703: implement proper black-box discrete logarithm for AdditiveAbelianGroupWrapper

archive/issues_023703.json:
```json
{
    "body": "Keywords: abstract abelian group generalized discrete logarithm\n\nThis takes care of the\n\n    TODO: Implement proper black-box discrete logarithm (using baby-step giant-step).\n\nin the `AdditiveAbelianGroupWrapper` class.\n\nThe proposed implementation first reduces to the case of p-groups using the Chinese remainder theorem. To solve the problem in p-groups, a basic version of an algorithm by Sutherland ([https://arxiv.org/abs/0809.3413](https://arxiv.org/abs/0809.3413)) is used.\n\nCompared to the previous (brute force) implementation, the new code yields huge speedups: For instance, the example\n\n\n```python\nF.<t> = GF(431**2)\nE = EllipticCurve(j=316*t+116)\nA = E.abelian_group()\nprint(A._discrete_log(E.random_point()))\n```\n\n\ntakes over two minutes on my machine using sage 8.0, but with the new code it finishes in less than 100 milliseconds on average.\n\nIssue created by migration from https://trac.sagemath.org/ticket/23940\n\n",
    "created_at": "2017-09-29T12:43:50Z",
    "labels": [
        "group theory",
        "major",
        "enhancement"
    ],
    "title": "implement proper black-box discrete logarithm for AdditiveAbelianGroupWrapper",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23703",
    "user": "lorenz"
}
```
Keywords: abstract abelian group generalized discrete logarithm

This takes care of the

    TODO: Implement proper black-box discrete logarithm (using baby-step giant-step).

in the `AdditiveAbelianGroupWrapper` class.

The proposed implementation first reduces to the case of p-groups using the Chinese remainder theorem. To solve the problem in p-groups, a basic version of an algorithm by Sutherland ([https://arxiv.org/abs/0809.3413](https://arxiv.org/abs/0809.3413)) is used.

Compared to the previous (brute force) implementation, the new code yields huge speedups: For instance, the example


```python
F.<t> = GF(431**2)
E = EllipticCurve(j=316*t+116)
A = E.abelian_group()
print(A._discrete_log(E.random_point()))
```


takes over two minutes on my machine using sage 8.0, but with the new code it finishes in less than 100 milliseconds on average.

Issue created by migration from https://trac.sagemath.org/ticket/23940





---

archive/issue_comments_332008.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-09-29T12:50:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23703#issuecomment-332008",
    "user": "lorenz"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_332009.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-09-29T13:37:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23703#issuecomment-332009",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_332010.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-12-04T10:27:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23703#issuecomment-332010",
    "user": "vdelecroix"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_332011.json:
```json
{
    "body": "Changing keywords from \"abstract abelian group generalized discrete logarithm\" to \"abelian group, discrete logarithm\".",
    "created_at": "2017-12-04T10:27:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23703#issuecomment-332011",
    "user": "vdelecroix"
}
```

Changing keywords from "abstract abelian group generalized discrete logarithm" to "abelian group, discrete logarithm".



---

archive/issue_comments_332012.json:
```json
{
    "body": "It looks like a great improvement to the Sage library!\n\nSadly your commits do not apply on the latest beta. You have to rebase your changes on the top of 8.1.rc4.\n\nConcerning the code\n\n1. In\n\n```\n+    def _discrete_log_pgroup(self, p, aa, b):\n+        from sage.arith.misc import valuation\n+        from sage.functions.other import ceil, sqrt\n+        from itertools import product as iproduct\n+        r\"\"\"\n```\n\n  The 3 import statements have to go **after** the docstring.\n\n2. You need a linebreak after `EXAMPLES::`\n\n3. You should provide benchmarks that show that you are not making worse the simple cases.",
    "created_at": "2017-12-04T10:27:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23703#issuecomment-332012",
    "user": "vdelecroix"
}
```

It looks like a great improvement to the Sage library!

Sadly your commits do not apply on the latest beta. You have to rebase your changes on the top of 8.1.rc4.

Concerning the code

1. In

```
+    def _discrete_log_pgroup(self, p, aa, b):
+        from sage.arith.misc import valuation
+        from sage.functions.other import ceil, sqrt
+        from itertools import product as iproduct
+        r"""
```

  The 3 import statements have to go **after** the docstring.

2. You need a linebreak after `EXAMPLES::`

3. You should provide benchmarks that show that you are not making worse the simple cases.



---

archive/issue_comments_332013.json:
```json
{
    "body": "Sorry, 1. is fixed in your commit `923edc1`",
    "created_at": "2017-12-04T10:32:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23703#issuecomment-332013",
    "user": "vdelecroix"
}
```

Sorry, 1. is fixed in your commit `923edc1`



---

archive/issue_comments_332014.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-30T12:58:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23703#issuecomment-332014",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_332015.json:
```json
{
    "body": "Thanks for the feedback and sorry for taking almost three years to continue this.\n\nI've rebased the patch onto the current `develop` branch.\n\nRegarding benchmarks, here's an example on my laptop for a \"simple case\" (a cyclic group of prime order):\n\n* Current `develop`:\n  {{{\n  sage: G = AdditiveAbelianGroup([31337])\n  sage: A = AdditiveAbelianGroupWrapper(G.0.parent(), G.gens(), [g.order() for g in G.gens()])\n  sage: %timeit A._discrete_log(randrange(31337)*G.0)\n  1 loop, best of 5: 3.24 s per loop\n  }}}\n\n* Commit `d43a1088db07f42554fe090e2a485c2e1695c779`:\n  {{{\n  sage: G = AdditiveAbelianGroup([31337])\n  sage: A = AdditiveAbelianGroupWrapper(G.0.parent(), G.gens(), [g.order() for g in G.gens()])\n  sage: %timeit A._discrete_log(randrange(31337)*G.0)\n  10 loops, best of 5: 26.2 ms per loop\n  }}}\n\nThe speedup is extremely significant. This is because the old implementation used na\u00efve brute force (linear complexity) whereas the new algorithm reduces to baby-step giant-step (square-root complexity) in the cyclic prime-order case. This case is in fact the hardest for the new algorithm and the speedup should be even bigger on more \"decomposable\" group structures.",
    "created_at": "2020-06-30T13:01:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23703#issuecomment-332015",
    "user": "lorenz"
}
```

Thanks for the feedback and sorry for taking almost three years to continue this.

I've rebased the patch onto the current `develop` branch.

Regarding benchmarks, here's an example on my laptop for a "simple case" (a cyclic group of prime order):

* Current `develop`:
  {{{
  sage: G = AdditiveAbelianGroup([31337])
  sage: A = AdditiveAbelianGroupWrapper(G.0.parent(), G.gens(), [g.order() for g in G.gens()])
  sage: %timeit A._discrete_log(randrange(31337)*G.0)
  1 loop, best of 5: 3.24 s per loop
  }}}

* Commit `d43a1088db07f42554fe090e2a485c2e1695c779`:
  {{{
  sage: G = AdditiveAbelianGroup([31337])
  sage: A = AdditiveAbelianGroupWrapper(G.0.parent(), G.gens(), [g.order() for g in G.gens()])
  sage: %timeit A._discrete_log(randrange(31337)*G.0)
  10 loops, best of 5: 26.2 ms per loop
  }}}

The speedup is extremely significant. This is because the old implementation used na√Øve brute force (linear complexity) whereas the new algorithm reduces to baby-step giant-step (square-root complexity) in the cyclic prime-order case. This case is in fact the hardest for the new algorithm and the speedup should be even bigger on more "decomposable" group structures.



---

archive/issue_comments_332016.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-06-30T13:06:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23703#issuecomment-332016",
    "user": "lorenz"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_332017.json:
```json
{
    "body": "Setting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-03-15T22:07:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23703#issuecomment-332017",
    "user": "mkoeppe"
}
```

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_comments_332018.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-04-28T07:48:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23703#issuecomment-332018",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_332019.json:
```json
{
    "body": "I made some small fixes to make the plugin happy.  Positive review if tests pass.",
    "created_at": "2021-04-28T07:49:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23703#issuecomment-332019",
    "user": "roed"
}
```

I made some small fixes to make the plugin happy.  Positive review if tests pass.



---

archive/issue_comments_332020.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-04-28T21:26:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23703#issuecomment-332020",
    "user": "roed"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_332021.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-05-27T20:30:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23703#issuecomment-332021",
    "user": "vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_332022.json:
```json
{
    "body": "follow up #33121",
    "created_at": "2022-01-05T15:57:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23703#issuecomment-332022",
    "user": "vdelecroix"
}
```

follow up #33121
