# Issue 31008: Implement parallel f-vector for polytopes

archive/issues_031008.json:
```json
{
    "body": "CC:  @jplab @laisrast stumpc5 @tscrim\n\nKeywords: parallel f-vector\n\nThis ticket parallelizes the f-vector for polytopes.\n\nEach thread has its private structure with which it does partial jobs. Depending on the parallelization depth, there is one job per face of fixed codimension (usually 1,2 or 3). After everything has finished, the partial f-vectors will be added.\n\nActually, every face is visited and thus the code could be modified in the future, to explore other properties of faces then just the dimension. The parallelization seems to work well with at least 40 threads.\n\nAlso the algorithm does work in other situations (simplicial complex, lattice of flats of a matroid) and this parallel structure could be used for this as well.\n\nOn the downside, `sig_on()/sig_off()` doesn't work with with multiple threads and has to be replaced by a simple `sig_check()`. Also raising errors in parallel code results in terrible slow down. Hence the errors are replaced by returning the exception value. In case of a bug there won't be any traceback anymore, but at least also no segmenation fault.\n\nBefore:\n\n```\nsage: P = P.base_extend(QQ)                                                                                                                                   \nsage: P = P.base_extend(QQ)                                                                                                                                   \nsage: Q = P.join(P.polar(in_affine_span=True))                                                                                                                \nsage: C = CombinatorialPolyhedron(Q)                                                                                                                          \nsage: %time C.f_vector()                                                                                                                                      \nCPU times: user 111 ms, sys: 186 \u00b5s, total: 111 ms\nWall time: 111 ms\n(1, 150, 3990, 25590, 69450, 95402, 69450, 25590, 3990, 150, 1)\n\nsage: P = polytopes.Birkhoff_polytope(5)                                                                                                                      \nsage: C = CombinatorialPolyhedron(P)                                                                                                                          \nsage: %time C.f_vector()                                                                                                                                      \nCPU times: user 584 ms, sys: 25 \u00b5s, total: 584 ms\nWall time: 583 ms\n(1, 120, 5040, 50250, 233400, 631700, 1113700, 1367040, 1220550, 817150, 419225, 167200, 52120, 12600, 2300, 300, 25, 1)\n\n# Using the <simple> version of the algorithm.\nsage: P = polytopes.associahedron(['A', 11], backend='normaliz')                                                                                              \nsage: C = CombinatorialPolyhedron(P)                                                                                                                          \nsage: %time C.f_vector()                                                                                                                                      \nCPU times: user 37.9 s, sys: 17.2 ms, total: 37.9 s\nWall time: 37.9 s\n(1, 208012, 1144066, 2735810, 3730650, 3197700, 1790712, 659736, 157080, 23100, 1925, 77, 1)\n```\n\nAfter (machine has 4 cores):\n\n```\nsage: P = polytopes.permutahedron(5)                                                                                                                          \nsage: P = P.base_extend(QQ)                                                                                                                                   \nsage: Q = P.join(P.polar(in_affine_span=True))                                                                                                                \nsage: C = CombinatorialPolyhedron(Q)                                                                                                                          \nsage: %time C.f_vector(num_threads=1)                                                                                                                         \nCPU times: user 107 ms, sys: 0 ns, total: 107 ms\nWall time: 107 ms\n(1, 150, 3990, 25590, 69450, 95402, 69450, 25590, 3990, 150, 1)\n\nsage: C = CombinatorialPolyhedron(Q)                                                                                                                          \nsage: %time C.f_vector(num_threads=2)                                                                                                                         \nCPU times: user 108 ms, sys: 0 ns, total: 108 ms\nWall time: 55.6 ms\n(1, 150, 3990, 25590, 69450, 95402, 69450, 25590, 3990, 150, 1)\n\nsage: C = CombinatorialPolyhedron(Q)                                                                                                                          \nsage: %time C.f_vector(num_threads=4)                                                                                                                         \nCPU times: user 147 ms, sys: 52 \u00b5s, total: 147 ms\nWall time: 38.6 ms\n(1, 150, 3990, 25590, 69450, 95402, 69450, 25590, 3990, 150, 1)\n\nsage: C = CombinatorialPolyhedron(Q)                                                                                                                          \nsage: %time C.f_vector(num_threads=8)                                                                                                                         \nCPU times: user 236 ms, sys: 0 ns, total: 236 ms\nWall time: 31.2 ms\n(1, 150, 3990, 25590, 69450, 95402, 69450, 25590, 3990, 150, 1)\n\nsage: P = polytopes.Birkhoff_polytope(5)                                                                                                                      \nsage: C = CombinatorialPolyhedron(P)                                                                                                                          \nsage: %time C.f_vector(num_threads=1)                                                                                                                         \nCPU times: user 354 ms, sys: 0 ns, total: 354 ms\nWall time: 354 ms\n(1, 120, 5040, 50250, 233400, 631700, 1113700, 1367040, 1220550, 817150, 419225, 167200, 52120, 12600, 2300, 300, 25, 1)\n\nsage: C = CombinatorialPolyhedron(P)                                                                                                                          \nsage: %time C.f_vector(num_threads=2)                                                                                                                         \nCPU times: user 363 ms, sys: 0 ns, total: 363 ms\nWall time: 181 ms\n(1, 120, 5040, 50250, 233400, 631700, 1113700, 1367040, 1220550, 817150, 419225, 167200, 52120, 12600, 2300, 300, 25, 1)\n\nsage: C = CombinatorialPolyhedron(P)                                                                                                                          \nsage: %time C.f_vector(num_threads=4)                                                                                                                         \nCPU times: user 459 ms, sys: 0 ns, total: 459 ms\nWall time: 117 ms\n(1, 120, 5040, 50250, 233400, 631700, 1113700, 1367040, 1220550, 817150, 419225, 167200, 52120, 12600, 2300, 300, 25, 1)\n\nsage: C = CombinatorialPolyhedron(P)                                                                                                                          \nsage: %time C.f_vector(num_threads=8)                                                                                                                         \nCPU times: user 776 ms, sys: 154 \u00b5s, total: 776 ms\nWall time: 103 ms\n(1, 120, 5040, 50250, 233400, 631700, 1113700, 1367040, 1220550, 817150, 419225, 167200, 52120, 12600, 2300, 300, 25, 1)\n\n\n# Using the <simple> version of the algorithm.\nsage: P = polytopes.associahedron(['A', 11], backend='normaliz')                                                                                              \nsage: C = CombinatorialPolyhedron(P)                                                                                                                          \nsage: %time C.f_vector(num_threads=1)                                                                                                                         \nCPU times: user 33.5 s, sys: 0 ns, total: 33.5 s\nWall time: 33.5 s\n(1, 208012, 1144066, 2735810, 3730650, 3197700, 1790712, 659736, 157080, 23100, 1925, 77, 1)\n\nsage: C = CombinatorialPolyhedron(P)                                                                                                                          \nsage: %time C.f_vector(num_threads=2)                                                                                                                         \nCPU times: user 34.4 s, sys: 3.49 ms, total: 34.4 s\nWall time: 17.2 s\n(1, 208012, 1144066, 2735810, 3730650, 3197700, 1790712, 659736, 157080, 23100, 1925, 77, 1)\n\nsage: C = CombinatorialPolyhedron(P)                                                                                                                          \nsage: %time C.f_vector(num_threads=4)                                                                                                                         \nCPU times: user 35.9 s, sys: 15.5 ms, total: 35.9 s\nWall time: 9 s\n(1, 208012, 1144066, 2735810, 3730650, 3197700, 1790712, 659736, 157080, 23100, 1925, 77, 1)\n\nsage: C = CombinatorialPolyhedron(P)                                                                                                                          \nsage: %time C.f_vector(num_threads=8)                                                                                                                         \nCPU times: user 1min 6s, sys: 31.3 ms, total: 1min 6s\nWall time: 8.44 s\n(1, 208012, 1144066, 2735810, 3730650, 3197700, 1790712, 659736, 157080, 23100, 1925, 77, 1)\n```\n\nIssue created by migration from https://trac.sagemath.org/ticket/31245\n\n",
    "created_at": "2021-01-15T10:37:56Z",
    "labels": [
        "component: geometry"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.4",
    "title": "Implement parallel f-vector for polytopes",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31008",
    "user": "https://github.com/kliem"
}
```
CC:  @jplab @laisrast stumpc5 @tscrim

Keywords: parallel f-vector

This ticket parallelizes the f-vector for polytopes.

Each thread has its private structure with which it does partial jobs. Depending on the parallelization depth, there is one job per face of fixed codimension (usually 1,2 or 3). After everything has finished, the partial f-vectors will be added.

Actually, every face is visited and thus the code could be modified in the future, to explore other properties of faces then just the dimension. The parallelization seems to work well with at least 40 threads.

Also the algorithm does work in other situations (simplicial complex, lattice of flats of a matroid) and this parallel structure could be used for this as well.

On the downside, `sig_on()/sig_off()` doesn't work with with multiple threads and has to be replaced by a simple `sig_check()`. Also raising errors in parallel code results in terrible slow down. Hence the errors are replaced by returning the exception value. In case of a bug there won't be any traceback anymore, but at least also no segmenation fault.

Before:

```
sage: P = P.base_extend(QQ)                                                                                                                                   
sage: P = P.base_extend(QQ)                                                                                                                                   
sage: Q = P.join(P.polar(in_affine_span=True))                                                                                                                
sage: C = CombinatorialPolyhedron(Q)                                                                                                                          
sage: %time C.f_vector()                                                                                                                                      
CPU times: user 111 ms, sys: 186 µs, total: 111 ms
Wall time: 111 ms
(1, 150, 3990, 25590, 69450, 95402, 69450, 25590, 3990, 150, 1)

sage: P = polytopes.Birkhoff_polytope(5)                                                                                                                      
sage: C = CombinatorialPolyhedron(P)                                                                                                                          
sage: %time C.f_vector()                                                                                                                                      
CPU times: user 584 ms, sys: 25 µs, total: 584 ms
Wall time: 583 ms
(1, 120, 5040, 50250, 233400, 631700, 1113700, 1367040, 1220550, 817150, 419225, 167200, 52120, 12600, 2300, 300, 25, 1)

# Using the <simple> version of the algorithm.
sage: P = polytopes.associahedron(['A', 11], backend='normaliz')                                                                                              
sage: C = CombinatorialPolyhedron(P)                                                                                                                          
sage: %time C.f_vector()                                                                                                                                      
CPU times: user 37.9 s, sys: 17.2 ms, total: 37.9 s
Wall time: 37.9 s
(1, 208012, 1144066, 2735810, 3730650, 3197700, 1790712, 659736, 157080, 23100, 1925, 77, 1)
```

After (machine has 4 cores):

```
sage: P = polytopes.permutahedron(5)                                                                                                                          
sage: P = P.base_extend(QQ)                                                                                                                                   
sage: Q = P.join(P.polar(in_affine_span=True))                                                                                                                
sage: C = CombinatorialPolyhedron(Q)                                                                                                                          
sage: %time C.f_vector(num_threads=1)                                                                                                                         
CPU times: user 107 ms, sys: 0 ns, total: 107 ms
Wall time: 107 ms
(1, 150, 3990, 25590, 69450, 95402, 69450, 25590, 3990, 150, 1)

sage: C = CombinatorialPolyhedron(Q)                                                                                                                          
sage: %time C.f_vector(num_threads=2)                                                                                                                         
CPU times: user 108 ms, sys: 0 ns, total: 108 ms
Wall time: 55.6 ms
(1, 150, 3990, 25590, 69450, 95402, 69450, 25590, 3990, 150, 1)

sage: C = CombinatorialPolyhedron(Q)                                                                                                                          
sage: %time C.f_vector(num_threads=4)                                                                                                                         
CPU times: user 147 ms, sys: 52 µs, total: 147 ms
Wall time: 38.6 ms
(1, 150, 3990, 25590, 69450, 95402, 69450, 25590, 3990, 150, 1)

sage: C = CombinatorialPolyhedron(Q)                                                                                                                          
sage: %time C.f_vector(num_threads=8)                                                                                                                         
CPU times: user 236 ms, sys: 0 ns, total: 236 ms
Wall time: 31.2 ms
(1, 150, 3990, 25590, 69450, 95402, 69450, 25590, 3990, 150, 1)

sage: P = polytopes.Birkhoff_polytope(5)                                                                                                                      
sage: C = CombinatorialPolyhedron(P)                                                                                                                          
sage: %time C.f_vector(num_threads=1)                                                                                                                         
CPU times: user 354 ms, sys: 0 ns, total: 354 ms
Wall time: 354 ms
(1, 120, 5040, 50250, 233400, 631700, 1113700, 1367040, 1220550, 817150, 419225, 167200, 52120, 12600, 2300, 300, 25, 1)

sage: C = CombinatorialPolyhedron(P)                                                                                                                          
sage: %time C.f_vector(num_threads=2)                                                                                                                         
CPU times: user 363 ms, sys: 0 ns, total: 363 ms
Wall time: 181 ms
(1, 120, 5040, 50250, 233400, 631700, 1113700, 1367040, 1220550, 817150, 419225, 167200, 52120, 12600, 2300, 300, 25, 1)

sage: C = CombinatorialPolyhedron(P)                                                                                                                          
sage: %time C.f_vector(num_threads=4)                                                                                                                         
CPU times: user 459 ms, sys: 0 ns, total: 459 ms
Wall time: 117 ms
(1, 120, 5040, 50250, 233400, 631700, 1113700, 1367040, 1220550, 817150, 419225, 167200, 52120, 12600, 2300, 300, 25, 1)

sage: C = CombinatorialPolyhedron(P)                                                                                                                          
sage: %time C.f_vector(num_threads=8)                                                                                                                         
CPU times: user 776 ms, sys: 154 µs, total: 776 ms
Wall time: 103 ms
(1, 120, 5040, 50250, 233400, 631700, 1113700, 1367040, 1220550, 817150, 419225, 167200, 52120, 12600, 2300, 300, 25, 1)


# Using the <simple> version of the algorithm.
sage: P = polytopes.associahedron(['A', 11], backend='normaliz')                                                                                              
sage: C = CombinatorialPolyhedron(P)                                                                                                                          
sage: %time C.f_vector(num_threads=1)                                                                                                                         
CPU times: user 33.5 s, sys: 0 ns, total: 33.5 s
Wall time: 33.5 s
(1, 208012, 1144066, 2735810, 3730650, 3197700, 1790712, 659736, 157080, 23100, 1925, 77, 1)

sage: C = CombinatorialPolyhedron(P)                                                                                                                          
sage: %time C.f_vector(num_threads=2)                                                                                                                         
CPU times: user 34.4 s, sys: 3.49 ms, total: 34.4 s
Wall time: 17.2 s
(1, 208012, 1144066, 2735810, 3730650, 3197700, 1790712, 659736, 157080, 23100, 1925, 77, 1)

sage: C = CombinatorialPolyhedron(P)                                                                                                                          
sage: %time C.f_vector(num_threads=4)                                                                                                                         
CPU times: user 35.9 s, sys: 15.5 ms, total: 35.9 s
Wall time: 9 s
(1, 208012, 1144066, 2735810, 3730650, 3197700, 1790712, 659736, 157080, 23100, 1925, 77, 1)

sage: C = CombinatorialPolyhedron(P)                                                                                                                          
sage: %time C.f_vector(num_threads=8)                                                                                                                         
CPU times: user 1min 6s, sys: 31.3 ms, total: 1min 6s
Wall time: 8.44 s
(1, 208012, 1144066, 2735810, 3730650, 3197700, 1790712, 659736, 157080, 23100, 1925, 77, 1)
```

Issue created by migration from https://trac.sagemath.org/ticket/31245





---

archive/issue_comments_442346.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-01-15T10:38:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31008#issuecomment-442346",
    "user": "https://github.com/kliem"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_442347.json:
```json
{
    "body": "The `sig_check()` outside the loop is unnecessary:\n\n```diff\n     cdef size_t j\n+    sig_check()\n     for j in range(n_faces):\n+        sig_check()\n         if (is_not_maximal_fused(new_faces, j, algorithm) or  # Step 2\n                 is_contained_in_one_fused(new_faces.faces[j], visited_all, algorithm)):  # Step 3\n             is_not_new_face[j] = True\n```\nLikewise here:\n\n```diff\n         face_list_t visited_all) nogil except -1:\n \n     cdef size_t output\n-    sig_on()\n+    sig_check()\n     if faces.polyhedron_is_simple:\n         output = get_next_level_fused(faces, new_faces, visited_all, <simple> 0)\n     else:\n         output = get_next_level_fused(faces, new_faces, visited_all, <standard> 0)\n-    sig_off()\n     return output\n \n cdef inline size_t bit_rep_to_coatom_rep(face_t face, face_list_t coatoms, size_t *output):\n```\nHere you either need the `sig_on/sig_off` or some more targeted checking. I don't see the point in performing a single check here.\n\nOtherwise LGTM.",
    "created_at": "2021-01-17T02:40:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31008#issuecomment-442347",
    "user": "https://github.com/tscrim"
}
```

The `sig_check()` outside the loop is unnecessary:

```diff
     cdef size_t j
+    sig_check()
     for j in range(n_faces):
+        sig_check()
         if (is_not_maximal_fused(new_faces, j, algorithm) or  # Step 2
                 is_contained_in_one_fused(new_faces.faces[j], visited_all, algorithm)):  # Step 3
             is_not_new_face[j] = True
```
Likewise here:

```diff
         face_list_t visited_all) nogil except -1:
 
     cdef size_t output
-    sig_on()
+    sig_check()
     if faces.polyhedron_is_simple:
         output = get_next_level_fused(faces, new_faces, visited_all, <simple> 0)
     else:
         output = get_next_level_fused(faces, new_faces, visited_all, <standard> 0)
-    sig_off()
     return output
 
 cdef inline size_t bit_rep_to_coatom_rep(face_t face, face_list_t coatoms, size_t *output):
```
Here you either need the `sig_on/sig_off` or some more targeted checking. I don't see the point in performing a single check here.

Otherwise LGTM.



---

archive/issue_comments_442348.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-01-17T09:37:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31008#issuecomment-442348",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_442349.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-01-17T09:43:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31008#issuecomment-442349",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_442350.json:
```json
{
    "body": "Replying to [comment:3 tscrim]:\n> The `sig_check()` outside the loop is unnecessary:\n> \n> ```diff\n>      cdef size_t j\n> +    sig_check()\n>      for j in range(n_faces):\n> +        sig_check()\n>          if (is_not_maximal_fused(new_faces, j, algorithm) or  # Step 2\n>                  is_contained_in_one_fused(new_faces.faces[j], visited_all, algorithm)):  # Step 3\n>              is_not_new_face[j] = True\n> ```\n> Likewise here:\n> \n> ```diff\n>          face_list_t visited_all) nogil except -1:\n>  \n>      cdef size_t output\n> -    sig_on()\n> +    sig_check()\n>      if faces.polyhedron_is_simple:\n>          output = get_next_level_fused(faces, new_faces, visited_all, <simple> 0)\n>      else:\n>          output = get_next_level_fused(faces, new_faces, visited_all, <standard> 0)\n> -    sig_off()\n>      return output\n>  \n>  cdef inline size_t bit_rep_to_coatom_rep(face_t face, face_list_t coatoms, size_t *output):\n> ```\n> Here you either need the `sig_on/sig_off` or some more targeted checking. I don't see the point in performing a single check here.\n> \n> Otherwise LGTM.\n\n\nI removed the redundant sig_checks.\n\nAs mentioned, sig_on, sig_off doesn't work well with parallelization. It crashes hard because sig_on, sig_off doesn't appear in correct order anymore.\n\nWrapping `prange` in sig_on/sig_off has a large performance penalty (8.45 s -> 9 s).\n\nCurrently there is one `sig_check` before checking that a face is inclusion maximal. One can add more sig checks, which wouldn't affect performance much for large examples, but for the small examples there is a penalty of about 50 percent.\n\nI think the current solution should be fine: The largest thing I ever computed with this algorithm, which took about a month on 40 cores, had 11,665,781 vertices and 162 facets. In this case between the sig_checks `A &~ B == 0` is performed for about 2 billion bits. Currently, without intrinsics, I get:\n\n```\nsage: B = Bitset((randint(0,2**20) for _ in range(2**19)))                                                                                                    \nsage: %timeit B.issubset(B)                                                                                                                                   \n6.18 \u00b5s \u00b1 9.8 ns per loop (mean \u00b1 std. dev. of 7 runs, 100000 loops each)\nsage: %timeit B.intersection_update(B)                                                                                                                        \n6.02 \u00b5s \u00b1 2.72 ns per loop (mean \u00b1 std. dev. of 7 runs, 100000 loops each)\n```\n\nOn this rate performing this for 2 billion bits should take about 12 ms. And even if the example has many more coatoms, in the worst case (completely unrealistic, because the dimension is not 1 and more memory is needed for other dimensions and probably for other threads), there are bitwise operations performed twice for the entire RAM. Say, we have 1 TB RAM, this would then take 96 seconds. Okay, that is long, but in any realistic sceanrio it would only take about a second, even with 1 TB RAM.\n\nTo sum up, I think the current amount of `sig_checks` suffices for the next years until more than 1 TB RAM is common (and even then, it doubt that there is an application for such a large example, as it would take forever to compute).",
    "created_at": "2021-01-17T10:16:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31008#issuecomment-442350",
    "user": "https://github.com/kliem"
}
```

Replying to [comment:3 tscrim]:
> The `sig_check()` outside the loop is unnecessary:
> 
> ```diff
>      cdef size_t j
> +    sig_check()
>      for j in range(n_faces):
> +        sig_check()
>          if (is_not_maximal_fused(new_faces, j, algorithm) or  # Step 2
>                  is_contained_in_one_fused(new_faces.faces[j], visited_all, algorithm)):  # Step 3
>              is_not_new_face[j] = True
> ```
> Likewise here:
> 
> ```diff
>          face_list_t visited_all) nogil except -1:
>  
>      cdef size_t output
> -    sig_on()
> +    sig_check()
>      if faces.polyhedron_is_simple:
>          output = get_next_level_fused(faces, new_faces, visited_all, <simple> 0)
>      else:
>          output = get_next_level_fused(faces, new_faces, visited_all, <standard> 0)
> -    sig_off()
>      return output
>  
>  cdef inline size_t bit_rep_to_coatom_rep(face_t face, face_list_t coatoms, size_t *output):
> ```
> Here you either need the `sig_on/sig_off` or some more targeted checking. I don't see the point in performing a single check here.
> 
> Otherwise LGTM.


I removed the redundant sig_checks.

As mentioned, sig_on, sig_off doesn't work well with parallelization. It crashes hard because sig_on, sig_off doesn't appear in correct order anymore.

Wrapping `prange` in sig_on/sig_off has a large performance penalty (8.45 s -> 9 s).

Currently there is one `sig_check` before checking that a face is inclusion maximal. One can add more sig checks, which wouldn't affect performance much for large examples, but for the small examples there is a penalty of about 50 percent.

I think the current solution should be fine: The largest thing I ever computed with this algorithm, which took about a month on 40 cores, had 11,665,781 vertices and 162 facets. In this case between the sig_checks `A &~ B == 0` is performed for about 2 billion bits. Currently, without intrinsics, I get:

```
sage: B = Bitset((randint(0,2**20) for _ in range(2**19)))                                                                                                    
sage: %timeit B.issubset(B)                                                                                                                                   
6.18 µs ± 9.8 ns per loop (mean ± std. dev. of 7 runs, 100000 loops each)
sage: %timeit B.intersection_update(B)                                                                                                                        
6.02 µs ± 2.72 ns per loop (mean ± std. dev. of 7 runs, 100000 loops each)
```

On this rate performing this for 2 billion bits should take about 12 ms. And even if the example has many more coatoms, in the worst case (completely unrealistic, because the dimension is not 1 and more memory is needed for other dimensions and probably for other threads), there are bitwise operations performed twice for the entire RAM. Say, we have 1 TB RAM, this would then take 96 seconds. Okay, that is long, but in any realistic sceanrio it would only take about a second, even with 1 TB RAM.

To sum up, I think the current amount of `sig_checks` suffices for the next years until more than 1 TB RAM is common (and even then, it doubt that there is an application for such a large example, as it would take forever to compute).



---

archive/issue_comments_442351.json:
```json
{
    "body": "Rebased.\n\nI didn't have this ticket here ready when writing #30445.\n\nEventually, one could also store edges/ridges or any sort of face in parallel.\nThis would also help with applications for simplicial complexes and lattice of flats of manifolds.\n\nBut that should be left for another time.\n\n---\nNew commits:",
    "created_at": "2021-01-17T17:21:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31008#issuecomment-442351",
    "user": "https://github.com/kliem"
}
```

Rebased.

I didn't have this ticket here ready when writing #30445.

Eventually, one could also store edges/ridges or any sort of face in parallel.
This would also help with applications for simplicial complexes and lattice of flats of manifolds.

But that should be left for another time.

---
New commits:



---

archive/issue_comments_442352.json:
```json
{
    "body": "Thank you. This is quite a nice improvement.",
    "created_at": "2021-01-18T00:11:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31008#issuecomment-442352",
    "user": "https://github.com/tscrim"
}
```

Thank you. This is quite a nice improvement.



---

archive/issue_comments_442353.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-01-18T00:11:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31008#issuecomment-442353",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_442354.json:
```json
{
    "body": "Thank you.",
    "created_at": "2021-01-18T06:40:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31008#issuecomment-442354",
    "user": "https://github.com/kliem"
}
```

Thank you.



---

archive/issue_comments_442355.json:
```json
{
    "body": "On the kucalc buildbot:\n\n```\n[sagelib-9.3.beta6] [1/1] gcc -Wno-unused-result -Wsign-compare -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -O2 -g -march=native -fPIC -I/var/lib/buildbot/slave/sage_git/build/local/lib/python3.9/site-packages/cysignals -I./sage/data_structures -I./sage/cpython -Isage/cpython -Isage/data_structures -I/var/lib/buildbot/slave/sage_git/build/build/pkgs/sagelib/src -I/var/lib/buildbot/slave/sage_git/build/local/include/python3.9 -I/var/lib/buildbot/slave/sage_git/build/local/lib/python3.9/site-packages/numpy/core/include -Ibuild/cythonized -I/var/lib/buildbot/slave/sage_git/build/local/include/python3.9 -c build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c -o build/temp.linux-x86_64-3.9/build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.o -fno-strict-aliasing -DCYTHON_CLINE_IN_TRACEBACK=1 -fopenmp -std=c99\n[sagelib-9.3.beta6] In file included from build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c:660:0:\n[sagelib-9.3.beta6] /var/lib/buildbot/slave/sage_git/build/local/lib/python3.9/site-packages/cysignals/struct_signals.h:45:1: sorry, unimplemented: \u2018_Atomic\u2019 with OpenMP\n[sagelib-9.3.beta6]  typedef volatile _Atomic int cy_atomic_int;\n[sagelib-9.3.beta6]  ^\n[sagelib-9.3.beta6] build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c: In function \u2018__pyx_f_4sage_8geometry_10polyhedron_24combinatorial_polyhedron_13face_iterator_prepare_face_iterator_for_partial_job\u2019:\n[sagelib-9.3.beta6] build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c:9035:54: warning: comparison between signed and unsigned integer expressions [-Wsign-compare]\n[sagelib-9.3.beta6]    __pyx_t_2 = ((__pyx_v_structure->current_dimension == (__pyx_v_structure->dimension - __pyx_v_parallelization_depth)) != 0);\n[sagelib-9.3.beta6]                                                       ^\n[sagelib-9.3.beta6] build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c:9322:84: warning: comparison between signed and unsigned integer expressions [-Wsign-compare]\n[sagelib-9.3.beta6]      __pyx_t_1 = (((__pyx_v_parallel_struct->current_job_id[__pyx_v_current_depth]) == -1L) != 0);\n[sagelib-9.3.beta6]                                                                                     ^\n[sagelib-9.3.beta6] build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c:9673:54: warning: comparison between signed and unsigned integer expressions [-Wsign-compare]\n[sagelib-9.3.beta6]    __pyx_t_1 = ((__pyx_v_structure->current_dimension != ((__pyx_v_structure->dimension - __pyx_v_parallelization_depth) - 1)) != 0);\n[sagelib-9.3.beta6]                                                       ^\n[sagelib-9.3.beta6] build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c: In function \u2018__Pyx_InitGlobals\u2019:\n[sagelib-9.3.beta6] build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c:23283:1: warning: \u2018PyEval_InitThreads\u2019 is deprecated [-Wdeprecated-declarations]\n[sagelib-9.3.beta6]  PyEval_InitThreads();\n[sagelib-9.3.beta6]  ^\n[sagelib-9.3.beta6] In file included from /var/lib/buildbot/slave/sage_git/build/local/include/python3.9/Python.h:145:0,\n[sagelib-9.3.beta6]                  from build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c:52:\n[sagelib-9.3.beta6] /var/lib/buildbot/slave/sage_git/build/local/include/python3.9/ceval.h:130:37: note: declared here\n[sagelib-9.3.beta6]  Py_DEPRECATED(3.9) PyAPI_FUNC(void) PyEval_InitThreads(void);\n[sagelib-9.3.beta6]                                      ^\n[sagelib-9.3.beta6] error: command '/usr/bin/gcc' failed with exit code 1\n```",
    "created_at": "2021-01-31T13:27:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31008#issuecomment-442355",
    "user": "https://github.com/vbraun"
}
```

On the kucalc buildbot:

```
[sagelib-9.3.beta6] [1/1] gcc -Wno-unused-result -Wsign-compare -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -O2 -g -march=native -fPIC -I/var/lib/buildbot/slave/sage_git/build/local/lib/python3.9/site-packages/cysignals -I./sage/data_structures -I./sage/cpython -Isage/cpython -Isage/data_structures -I/var/lib/buildbot/slave/sage_git/build/build/pkgs/sagelib/src -I/var/lib/buildbot/slave/sage_git/build/local/include/python3.9 -I/var/lib/buildbot/slave/sage_git/build/local/lib/python3.9/site-packages/numpy/core/include -Ibuild/cythonized -I/var/lib/buildbot/slave/sage_git/build/local/include/python3.9 -c build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c -o build/temp.linux-x86_64-3.9/build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.o -fno-strict-aliasing -DCYTHON_CLINE_IN_TRACEBACK=1 -fopenmp -std=c99
[sagelib-9.3.beta6] In file included from build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c:660:0:
[sagelib-9.3.beta6] /var/lib/buildbot/slave/sage_git/build/local/lib/python3.9/site-packages/cysignals/struct_signals.h:45:1: sorry, unimplemented: ‘_Atomic’ with OpenMP
[sagelib-9.3.beta6]  typedef volatile _Atomic int cy_atomic_int;
[sagelib-9.3.beta6]  ^
[sagelib-9.3.beta6] build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c: In function ‘__pyx_f_4sage_8geometry_10polyhedron_24combinatorial_polyhedron_13face_iterator_prepare_face_iterator_for_partial_job’:
[sagelib-9.3.beta6] build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c:9035:54: warning: comparison between signed and unsigned integer expressions [-Wsign-compare]
[sagelib-9.3.beta6]    __pyx_t_2 = ((__pyx_v_structure->current_dimension == (__pyx_v_structure->dimension - __pyx_v_parallelization_depth)) != 0);
[sagelib-9.3.beta6]                                                       ^
[sagelib-9.3.beta6] build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c:9322:84: warning: comparison between signed and unsigned integer expressions [-Wsign-compare]
[sagelib-9.3.beta6]      __pyx_t_1 = (((__pyx_v_parallel_struct->current_job_id[__pyx_v_current_depth]) == -1L) != 0);
[sagelib-9.3.beta6]                                                                                     ^
[sagelib-9.3.beta6] build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c:9673:54: warning: comparison between signed and unsigned integer expressions [-Wsign-compare]
[sagelib-9.3.beta6]    __pyx_t_1 = ((__pyx_v_structure->current_dimension != ((__pyx_v_structure->dimension - __pyx_v_parallelization_depth) - 1)) != 0);
[sagelib-9.3.beta6]                                                       ^
[sagelib-9.3.beta6] build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c: In function ‘__Pyx_InitGlobals’:
[sagelib-9.3.beta6] build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c:23283:1: warning: ‘PyEval_InitThreads’ is deprecated [-Wdeprecated-declarations]
[sagelib-9.3.beta6]  PyEval_InitThreads();
[sagelib-9.3.beta6]  ^
[sagelib-9.3.beta6] In file included from /var/lib/buildbot/slave/sage_git/build/local/include/python3.9/Python.h:145:0,
[sagelib-9.3.beta6]                  from build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c:52:
[sagelib-9.3.beta6] /var/lib/buildbot/slave/sage_git/build/local/include/python3.9/ceval.h:130:37: note: declared here
[sagelib-9.3.beta6]  Py_DEPRECATED(3.9) PyAPI_FUNC(void) PyEval_InitThreads(void);
[sagelib-9.3.beta6]                                      ^
[sagelib-9.3.beta6] error: command '/usr/bin/gcc' failed with exit code 1
```



---

archive/issue_comments_442356.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2021-01-31T13:27:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31008#issuecomment-442356",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_442357.json:
```json
{
    "body": "This appears to be an issue with python 3.5 to 3.7 according to https://bugs.python.org/issue25150\n\nFrom this I get that this can be \"fixed\" by doing this specific module as a C++ extension (or by requiring system python >= 3.8, but that isn't an option for the moment).\n\nI'll check if I can reproduce this with system python 3.7 (need to rebuild first).",
    "created_at": "2021-01-31T14:12:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31008#issuecomment-442357",
    "user": "https://github.com/kliem"
}
```

This appears to be an issue with python 3.5 to 3.7 according to https://bugs.python.org/issue25150

From this I get that this can be "fixed" by doing this specific module as a C++ extension (or by requiring system python >= 3.8, but that isn't an option for the moment).

I'll check if I can reproduce this with system python 3.7 (need to rebuild first).



---

archive/issue_comments_442358.json:
```json
{
    "body": "Actually, that is a problem with cysignals that should be fixed there.",
    "created_at": "2021-01-31T14:26:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31008#issuecomment-442358",
    "user": "https://github.com/kliem"
}
```

Actually, that is a problem with cysignals that should be fixed there.



---

archive/issue_comments_442359.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-01-31T15:28:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31008#issuecomment-442359",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_442360.json:
```json
{
    "body": "According to \n\nhttps://github.com/sagemath/cysignals/blob/master/src/cysignals/struct_signals.h\n\nand\n\nhttps://github.com/sagemath/cysignals/blob/master/src/cysignals/cysignals_config.h.in\n\njust undefininig `CYSIGNALS_C_ATOMIC` should fix this.",
    "created_at": "2021-01-31T15:30:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31008#issuecomment-442360",
    "user": "https://github.com/kliem"
}
```

According to 

https://github.com/sagemath/cysignals/blob/master/src/cysignals/struct_signals.h

and

https://github.com/sagemath/cysignals/blob/master/src/cysignals/cysignals_config.h.in

just undefininig `CYSIGNALS_C_ATOMIC` should fix this.



---

archive/issue_comments_442361.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-01-31T15:31:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31008#issuecomment-442361",
    "user": "https://github.com/kliem"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_442362.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-02-01T00:55:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31008#issuecomment-442362",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_442363.json:
```json
{
    "body": "Back off to the builbots.",
    "created_at": "2021-02-01T00:55:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31008#issuecomment-442363",
    "user": "https://github.com/tscrim"
}
```

Back off to the builbots.



---

archive/issue_comments_442364.json:
```json
{
    "body": "Build fails on various buildbots:\n\n```\n[sagelib-9.3.beta7] [1/1] gcc -Wno-unused-result -Wsign-compare -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -O2 -g -march=native -O2 -g -march=native -fPIC -UCYSIGNALS_C_ATOMIC -I/home/buildbot/slave/sage_git/build/local/lib/python3.9/site-packages/cysignals -I./sage/data_structures -I./sage/cpython -Isage/cpython -I/home/buildbot/slave/sage_git/build/build/pkgs/sagelib/src -I/home/buildbot/slave/sage_git/build/local/include/python3.9 -I/home/buildbot/slave/sage_git/build/local/lib/python3.9/site-packages/numpy/core/include -Ibuild/cythonized -I/home/buildbot/slave/sage_git/build/local/include/python3.9 -c build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c -o build/temp.linux-x86_64-3.9/build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.o -fno-strict-aliasing -DCYTHON_CLINE_IN_TRACEBACK=1 -fopenmp -std=c99\n[sagelib-9.3.beta7] In file included from build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c:662:0:\n[sagelib-9.3.beta7] /home/buildbot/slave/sage_git/build/local/lib/python3.9/site-packages/cysignals/struct_signals.h:45:1: sorry, unimplemented: \u2018_Atomic\u2019 with OpenMP\n[sagelib-9.3.beta7]  typedef volatile _Atomic int cy_atomic_int;\n[sagelib-9.3.beta7]  ^~~~~~~\n[sagelib-9.3.beta7] build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c: In function \u2018__pyx_f_4sage_8geometry_10polyhedron_24combinatorial_polyhedron_13face_iterator_prepare_face_iterator_for_partial_job\u2019:\n[sagelib-9.3.beta7] build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c:9037:54: warning: comparison between signed and unsigned integer expressions [-Wsign-compare]\n[sagelib-9.3.beta7]    __pyx_t_2 = ((__pyx_v_structure->current_dimension == (__pyx_v_structure->dimension - __pyx_v_parallelization_depth)) != 0);\n[sagelib-9.3.beta7]                                                       ^~\n[sagelib-9.3.beta7] build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c:9324:84: warning: comparison between signed and unsigned integer expressions [-Wsign-compare]\n[sagelib-9.3.beta7]      __pyx_t_1 = (((__pyx_v_parallel_struct->current_job_id[__pyx_v_current_depth]) == -1L) != 0);\n[sagelib-9.3.beta7]                                                                                     ^~\n[sagelib-9.3.beta7] build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c:9675:54: warning: comparison between signed and unsigned integer expressions [-Wsign-compare]\n[sagelib-9.3.beta7]    __pyx_t_1 = ((__pyx_v_structure->current_dimension != ((__pyx_v_structure->dimension - __pyx_v_parallelization_depth) - 1)) != 0);\n[sagelib-9.3.beta7]                                                       ^~\n[sagelib-9.3.beta7] build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c: In function \u2018__Pyx_InitGlobals\u2019:\n[sagelib-9.3.beta7] build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c:23285:1: warning: \u2018PyEval_InitThreads\u2019 is deprecated [-Wdeprecated-declarations]\n[sagelib-9.3.beta7]  PyEval_InitThreads();\n[sagelib-9.3.beta7]  ^~~~~~~~~~~~~~~~~~\n[sagelib-9.3.beta7] In file included from /home/buildbot/slave/sage_git/build/local/include/python3.9/Python.h:145:0,\n[sagelib-9.3.beta7]                  from build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c:54:\n[sagelib-9.3.beta7] /home/buildbot/slave/sage_git/build/local/include/python3.9/ceval.h:130:37: note: declared here\n[sagelib-9.3.beta7]  Py_DEPRECATED(3.9) PyAPI_FUNC(void) PyEval_InitThreads(void);\n[sagelib-9.3.beta7]                                      ^~~~~~~~~~~~~~~~~~\n[sagelib-9.3.beta7] error: command '/usr/bin/gcc' failed with exit code 1\n[sagelib-9.3.beta7] \n[sagelib-9.3.beta7] real\t0m3.325s\n[sagelib-9.3.beta7] user\t0m2.798s\n[sagelib-9.3.beta7] sys\t0m0.563s\nMakefile:2233: recipe for target 'sagelib-no-deps' failed\n```",
    "created_at": "2021-03-05T21:19:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31008#issuecomment-442364",
    "user": "https://github.com/vbraun"
}
```

Build fails on various buildbots:

```
[sagelib-9.3.beta7] [1/1] gcc -Wno-unused-result -Wsign-compare -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -O2 -g -march=native -O2 -g -march=native -fPIC -UCYSIGNALS_C_ATOMIC -I/home/buildbot/slave/sage_git/build/local/lib/python3.9/site-packages/cysignals -I./sage/data_structures -I./sage/cpython -Isage/cpython -I/home/buildbot/slave/sage_git/build/build/pkgs/sagelib/src -I/home/buildbot/slave/sage_git/build/local/include/python3.9 -I/home/buildbot/slave/sage_git/build/local/lib/python3.9/site-packages/numpy/core/include -Ibuild/cythonized -I/home/buildbot/slave/sage_git/build/local/include/python3.9 -c build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c -o build/temp.linux-x86_64-3.9/build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.o -fno-strict-aliasing -DCYTHON_CLINE_IN_TRACEBACK=1 -fopenmp -std=c99
[sagelib-9.3.beta7] In file included from build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c:662:0:
[sagelib-9.3.beta7] /home/buildbot/slave/sage_git/build/local/lib/python3.9/site-packages/cysignals/struct_signals.h:45:1: sorry, unimplemented: ‘_Atomic’ with OpenMP
[sagelib-9.3.beta7]  typedef volatile _Atomic int cy_atomic_int;
[sagelib-9.3.beta7]  ^~~~~~~
[sagelib-9.3.beta7] build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c: In function ‘__pyx_f_4sage_8geometry_10polyhedron_24combinatorial_polyhedron_13face_iterator_prepare_face_iterator_for_partial_job’:
[sagelib-9.3.beta7] build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c:9037:54: warning: comparison between signed and unsigned integer expressions [-Wsign-compare]
[sagelib-9.3.beta7]    __pyx_t_2 = ((__pyx_v_structure->current_dimension == (__pyx_v_structure->dimension - __pyx_v_parallelization_depth)) != 0);
[sagelib-9.3.beta7]                                                       ^~
[sagelib-9.3.beta7] build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c:9324:84: warning: comparison between signed and unsigned integer expressions [-Wsign-compare]
[sagelib-9.3.beta7]      __pyx_t_1 = (((__pyx_v_parallel_struct->current_job_id[__pyx_v_current_depth]) == -1L) != 0);
[sagelib-9.3.beta7]                                                                                     ^~
[sagelib-9.3.beta7] build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c:9675:54: warning: comparison between signed and unsigned integer expressions [-Wsign-compare]
[sagelib-9.3.beta7]    __pyx_t_1 = ((__pyx_v_structure->current_dimension != ((__pyx_v_structure->dimension - __pyx_v_parallelization_depth) - 1)) != 0);
[sagelib-9.3.beta7]                                                       ^~
[sagelib-9.3.beta7] build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c: In function ‘__Pyx_InitGlobals’:
[sagelib-9.3.beta7] build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c:23285:1: warning: ‘PyEval_InitThreads’ is deprecated [-Wdeprecated-declarations]
[sagelib-9.3.beta7]  PyEval_InitThreads();
[sagelib-9.3.beta7]  ^~~~~~~~~~~~~~~~~~
[sagelib-9.3.beta7] In file included from /home/buildbot/slave/sage_git/build/local/include/python3.9/Python.h:145:0,
[sagelib-9.3.beta7]                  from build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c:54:
[sagelib-9.3.beta7] /home/buildbot/slave/sage_git/build/local/include/python3.9/ceval.h:130:37: note: declared here
[sagelib-9.3.beta7]  Py_DEPRECATED(3.9) PyAPI_FUNC(void) PyEval_InitThreads(void);
[sagelib-9.3.beta7]                                      ^~~~~~~~~~~~~~~~~~
[sagelib-9.3.beta7] error: command '/usr/bin/gcc' failed with exit code 1
[sagelib-9.3.beta7] 
[sagelib-9.3.beta7] real	0m3.325s
[sagelib-9.3.beta7] user	0m2.798s
[sagelib-9.3.beta7] sys	0m0.563s
Makefile:2233: recipe for target 'sagelib-no-deps' failed
```



---

archive/issue_comments_442365.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2021-03-05T22:48:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31008#issuecomment-442365",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_442366.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2021-03-05T22:48:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31008#issuecomment-442366",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_442367.json:
```json
{
    "body": "I don't think this is going to happen with 9.3 anymore, if this is waiting on a cysignals patch/update.",
    "created_at": "2021-03-06T19:56:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31008#issuecomment-442367",
    "user": "https://github.com/kliem"
}
```

I don't think this is going to happen with 9.3 anymore, if this is waiting on a cysignals patch/update.



---

archive/issue_events_081675.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2021-03-06T19:56:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31008",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31008#event-81675"
}
```



---

archive/issue_comments_442368.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-03-09T08:17:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31008#issuecomment-442368",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_442369.json:
```json
{
    "body": "This bug isn't too hard to reproduce actually:\n\nhttps://github.com/kliem/sage/runs/2064520070?check_suite_focus=true\n\nSeems to be connected to older GCC.\n\nReplying to [comment:19 vbraun]:\n> Build fails on various buildbots:\n> \n> ```\n> [sagelib-9.3.beta7] [1/1] gcc -Wno-unused-result -Wsign-compare -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -O2 -g -march=native -O2 -g -march=native -fPIC -UCYSIGNALS_C_ATOMIC -I/home/buildbot/slave/sage_git/build/local/lib/python3.9/site-packages/cysignals -I./sage/data_structures -I./sage/cpython -Isage/cpython -I/home/buildbot/slave/sage_git/build/build/pkgs/sagelib/src -I/home/buildbot/slave/sage_git/build/local/include/python3.9 -I/home/buildbot/slave/sage_git/build/local/lib/python3.9/site-packages/numpy/core/include -Ibuild/cythonized -I/home/buildbot/slave/sage_git/build/local/include/python3.9 -c build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c -o build/temp.linux-x86_64-3.9/build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.o -fno-strict-aliasing -DCYTHON_CLINE_IN_TRACEBACK=1 -fopenmp -std=c99\n> [sagelib-9.3.beta7] In file included from build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c:662:0:\n> [sagelib-9.3.beta7] /home/buildbot/slave/sage_git/build/local/lib/python3.9/site-packages/cysignals/struct_signals.h:45:1: sorry, unimplemented: \u2018_Atomic\u2019 with OpenMP\n> [sagelib-9.3.beta7]  typedef volatile _Atomic int cy_atomic_int;\n> [sagelib-9.3.beta7]  ^~~~~~~\n> [sagelib-9.3.beta7] build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c: In function \u2018__pyx_f_4sage_8geometry_10polyhedron_24combinatorial_polyhedron_13face_iterator_prepare_face_iterator_for_partial_job\u2019:\n> [sagelib-9.3.beta7] build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c:9037:54: warning: comparison between signed and unsigned integer expressions [-Wsign-compare]\n> [sagelib-9.3.beta7]    __pyx_t_2 = ((__pyx_v_structure->current_dimension == (__pyx_v_structure->dimension - __pyx_v_parallelization_depth)) != 0);\n> [sagelib-9.3.beta7]                                                       ^~\n> [sagelib-9.3.beta7] build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c:9324:84: warning: comparison between signed and unsigned integer expressions [-Wsign-compare]\n> [sagelib-9.3.beta7]      __pyx_t_1 = (((__pyx_v_parallel_struct->current_job_id[__pyx_v_current_depth]) == -1L) != 0);\n> [sagelib-9.3.beta7]                                                                                     ^~\n> [sagelib-9.3.beta7] build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c:9675:54: warning: comparison between signed and unsigned integer expressions [-Wsign-compare]\n> [sagelib-9.3.beta7]    __pyx_t_1 = ((__pyx_v_structure->current_dimension != ((__pyx_v_structure->dimension - __pyx_v_parallelization_depth) - 1)) != 0);\n> [sagelib-9.3.beta7]                                                       ^~\n> [sagelib-9.3.beta7] build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c: In function \u2018__Pyx_InitGlobals\u2019:\n> [sagelib-9.3.beta7] build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c:23285:1: warning: \u2018PyEval_InitThreads\u2019 is deprecated [-Wdeprecated-declarations]\n> [sagelib-9.3.beta7]  PyEval_InitThreads();\n> [sagelib-9.3.beta7]  ^~~~~~~~~~~~~~~~~~\n> [sagelib-9.3.beta7] In file included from /home/buildbot/slave/sage_git/build/local/include/python3.9/Python.h:145:0,\n> [sagelib-9.3.beta7]                  from build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c:54:\n> [sagelib-9.3.beta7] /home/buildbot/slave/sage_git/build/local/include/python3.9/ceval.h:130:37: note: declared here\n> [sagelib-9.3.beta7]  Py_DEPRECATED(3.9) PyAPI_FUNC(void) PyEval_InitThreads(void);\n> [sagelib-9.3.beta7]                                      ^~~~~~~~~~~~~~~~~~\n> [sagelib-9.3.beta7] error: command '/usr/bin/gcc' failed with exit code 1\n> [sagelib-9.3.beta7] \n> [sagelib-9.3.beta7] real\t0m3.325s\n> [sagelib-9.3.beta7] user\t0m2.798s\n> [sagelib-9.3.beta7] sys\t0m0.563s\n> Makefile:2233: recipe for target 'sagelib-no-deps' failed\n> ```",
    "created_at": "2021-03-09T14:39:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31008#issuecomment-442369",
    "user": "https://github.com/kliem"
}
```

This bug isn't too hard to reproduce actually:

https://github.com/kliem/sage/runs/2064520070?check_suite_focus=true

Seems to be connected to older GCC.

Replying to [comment:19 vbraun]:
> Build fails on various buildbots:
> 
> ```
> [sagelib-9.3.beta7] [1/1] gcc -Wno-unused-result -Wsign-compare -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -O2 -g -march=native -O2 -g -march=native -fPIC -UCYSIGNALS_C_ATOMIC -I/home/buildbot/slave/sage_git/build/local/lib/python3.9/site-packages/cysignals -I./sage/data_structures -I./sage/cpython -Isage/cpython -I/home/buildbot/slave/sage_git/build/build/pkgs/sagelib/src -I/home/buildbot/slave/sage_git/build/local/include/python3.9 -I/home/buildbot/slave/sage_git/build/local/lib/python3.9/site-packages/numpy/core/include -Ibuild/cythonized -I/home/buildbot/slave/sage_git/build/local/include/python3.9 -c build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c -o build/temp.linux-x86_64-3.9/build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.o -fno-strict-aliasing -DCYTHON_CLINE_IN_TRACEBACK=1 -fopenmp -std=c99
> [sagelib-9.3.beta7] In file included from build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c:662:0:
> [sagelib-9.3.beta7] /home/buildbot/slave/sage_git/build/local/lib/python3.9/site-packages/cysignals/struct_signals.h:45:1: sorry, unimplemented: ‘_Atomic’ with OpenMP
> [sagelib-9.3.beta7]  typedef volatile _Atomic int cy_atomic_int;
> [sagelib-9.3.beta7]  ^~~~~~~
> [sagelib-9.3.beta7] build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c: In function ‘__pyx_f_4sage_8geometry_10polyhedron_24combinatorial_polyhedron_13face_iterator_prepare_face_iterator_for_partial_job’:
> [sagelib-9.3.beta7] build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c:9037:54: warning: comparison between signed and unsigned integer expressions [-Wsign-compare]
> [sagelib-9.3.beta7]    __pyx_t_2 = ((__pyx_v_structure->current_dimension == (__pyx_v_structure->dimension - __pyx_v_parallelization_depth)) != 0);
> [sagelib-9.3.beta7]                                                       ^~
> [sagelib-9.3.beta7] build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c:9324:84: warning: comparison between signed and unsigned integer expressions [-Wsign-compare]
> [sagelib-9.3.beta7]      __pyx_t_1 = (((__pyx_v_parallel_struct->current_job_id[__pyx_v_current_depth]) == -1L) != 0);
> [sagelib-9.3.beta7]                                                                                     ^~
> [sagelib-9.3.beta7] build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c:9675:54: warning: comparison between signed and unsigned integer expressions [-Wsign-compare]
> [sagelib-9.3.beta7]    __pyx_t_1 = ((__pyx_v_structure->current_dimension != ((__pyx_v_structure->dimension - __pyx_v_parallelization_depth) - 1)) != 0);
> [sagelib-9.3.beta7]                                                       ^~
> [sagelib-9.3.beta7] build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c: In function ‘__Pyx_InitGlobals’:
> [sagelib-9.3.beta7] build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c:23285:1: warning: ‘PyEval_InitThreads’ is deprecated [-Wdeprecated-declarations]
> [sagelib-9.3.beta7]  PyEval_InitThreads();
> [sagelib-9.3.beta7]  ^~~~~~~~~~~~~~~~~~
> [sagelib-9.3.beta7] In file included from /home/buildbot/slave/sage_git/build/local/include/python3.9/Python.h:145:0,
> [sagelib-9.3.beta7]                  from build/cythonized/sage/geometry/polyhedron/combinatorial_polyhedron/face_iterator.c:54:
> [sagelib-9.3.beta7] /home/buildbot/slave/sage_git/build/local/include/python3.9/ceval.h:130:37: note: declared here
> [sagelib-9.3.beta7]  Py_DEPRECATED(3.9) PyAPI_FUNC(void) PyEval_InitThreads(void);
> [sagelib-9.3.beta7]                                      ^~~~~~~~~~~~~~~~~~
> [sagelib-9.3.beta7] error: command '/usr/bin/gcc' failed with exit code 1
> [sagelib-9.3.beta7] 
> [sagelib-9.3.beta7] real	0m3.325s
> [sagelib-9.3.beta7] user	0m2.798s
> [sagelib-9.3.beta7] sys	0m0.563s
> Makefile:2233: recipe for target 'sagelib-no-deps' failed
> ```



---

archive/issue_comments_442370.json:
```json
{
    "body": "This might need more work, as the flag `-fopenmp` isn't understood everywhere: https://github.com/kliem/sage/pull/40/checks?check_run_id=2076988665\n\nSo we should probably check out at configure time, whether our compiler supports this, similar to #27122.",
    "created_at": "2021-03-12T13:59:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31008#issuecomment-442370",
    "user": "https://github.com/kliem"
}
```

This might need more work, as the flag `-fopenmp` isn't understood everywhere: https://github.com/kliem/sage/pull/40/checks?check_run_id=2076988665

So we should probably check out at configure time, whether our compiler supports this, similar to #27122.



---

archive/issue_comments_442371.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-03-12T13:59:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31008#issuecomment-442371",
    "user": "https://github.com/kliem"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_442372.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-03-15T11:58:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31008#issuecomment-442372",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_442373.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-03-15T11:59:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31008#issuecomment-442373",
    "user": "https://github.com/kliem"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_442374.json:
```json
{
    "body": "Tests are running here:\n\nhttps://github.com/kliem/sage/pull/40/checks",
    "created_at": "2021-03-15T12:11:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31008#issuecomment-442374",
    "user": "https://github.com/kliem"
}
```

Tests are running here:

https://github.com/kliem/sage/pull/40/checks



---

archive/issue_comments_442375.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-03-16T08:04:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31008#issuecomment-442375",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_442376.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-04-11T23:32:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31008#issuecomment-442376",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_442377.json:
```json
{
    "body": "Thanks again.",
    "created_at": "2021-04-12T06:30:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31008#issuecomment-442377",
    "user": "https://github.com/kliem"
}
```

Thanks again.



---

archive/issue_comments_442378.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2021-05-13T11:01:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31008#issuecomment-442378",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_442379.json:
```json
{
    "body": "Merge conflict",
    "created_at": "2021-05-13T11:01:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31008#issuecomment-442379",
    "user": "https://github.com/vbraun"
}
```

Merge conflict



---

archive/issue_comments_442380.json:
```json
{
    "body": "New commits:",
    "created_at": "2021-05-20T08:17:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31008#issuecomment-442380",
    "user": "https://github.com/kliem"
}
```

New commits:



---

archive/issue_comments_442381.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2021-05-20T08:53:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31008#issuecomment-442381",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_442382.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-05-20T08:55:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31008#issuecomment-442382",
    "user": "https://github.com/kliem"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_442383.json:
```json
{
    "body": "I'm not sure this was actually a merge conflict.\n\nBut even on my laptop with OPENMP support I got missing symbols. Don't exactly understand this.\n\nHowever, we can't use `openmp.omp_get_num_threads` for obvious reasons, because it doesn't have to be defined. Instead we should use `cython.parallel.threadid`, which takes care of this. It is supposed to work, just like prange.",
    "created_at": "2021-05-20T08:55:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31008#issuecomment-442383",
    "user": "https://github.com/kliem"
}
```

I'm not sure this was actually a merge conflict.

But even on my laptop with OPENMP support I got missing symbols. Don't exactly understand this.

However, we can't use `openmp.omp_get_num_threads` for obvious reasons, because it doesn't have to be defined. Instead we should use `cython.parallel.threadid`, which takes care of this. It is supposed to work, just like prange.



---

archive/issue_comments_442384.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-05-21T00:14:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31008#issuecomment-442384",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_442385.json:
```json
{
    "body": "Works for me. Let's try this again...",
    "created_at": "2021-05-21T00:14:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31008#issuecomment-442385",
    "user": "https://github.com/tscrim"
}
```

Works for me. Let's try this again...



---

archive/issue_comments_442386.json:
```json
{
    "body": "Merge conflict",
    "created_at": "2021-05-26T21:51:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31008#issuecomment-442386",
    "user": "https://github.com/vbraun"
}
```

Merge conflict



---

archive/issue_comments_442387.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2021-05-26T21:51:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31008#issuecomment-442387",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_442388.json:
```json
{
    "body": "New commits:",
    "created_at": "2021-05-26T22:32:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31008#issuecomment-442388",
    "user": "https://github.com/mkoeppe"
}
```

New commits:



---

archive/issue_comments_442389.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2021-05-26T22:32:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31008#issuecomment-442389",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_442390.json:
```json
{
    "body": "Segfaults reliably on OSX\n\n```\nsage -t --long --random-seed=0 src/sage/geometry/polyhedron/combinatorial_polyhedron/base.pyx  # Killed due to segmentation fault\nsage -t --long --random-seed=0 src/sage/geometry/polyhedron/base.py  # Killed due to segmentation fault\n```\nDebugger:\n\n```\n$ sage -sh\n(sage-sh) sudo lldb ./local/bin/python3\n(lldb) target create \"./local/bin/python3\"\nCurrent executable set to '/Users/buildbot-sage/slave/sage_git/build/local/bin/python3' (x86_64).\n(lldb) rfrom\nerror: 'rfrom' is not a valid command.\n(lldb) r\nProcess 81901 launched: '/Users/buildbot-sage/slave/sage_git/build/local/bin/python3' (x86_64)\nPython 3.9.5 (default, Jun  8 2021, 19:13:24) \n[Clang 12.0.5 (clang-1205.0.22.9)] on darwin\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n>>> from sage.all import *\n>>> line = Polyhedron(lines=[[0,1]])\n>>> line.vertex_graph() ## line 7185 ##\nbase.cpython-39-darwin.so was compiled with optimization - stepping may behave oddly; variables may not be available.\nProcess 81901 stopped\n* thread #1, queue = 'com.apple.main-thread', stop reason = EXC_BAD_ACCESS (code=1, address=0x0)\n    frame #0: 0x00000001142ae934 base.cpython-39-darwin.so`__pyx_gb_4sage_8geometry_10polyhedron_24combinatorial_polyhedron_4base_23CombinatorialPolyhedron_24_compute_edges_or_ridges_5generator29(__pyx_generator=0x0000000114562160, __pyx_tstate=0x0000000100508140, __pyx_sent_value=0x00000001003a8580) at base.c:28817:74 [opt]\n   28814\t  __pyx_t_2 = __pyx_t_1;\n   28815\t  for (__pyx_t_3 = 0; __pyx_t_3 < __pyx_t_2; __pyx_t_3+=1) {\n   28816\t    __pyx_cur_scope->__pyx_v_i = __pyx_t_3;\n-> 28817\t    __pyx_t_4 = ((PyObject *)__pyx_f_4sage_5rings_7integer_smallInteger((__pyx_cur_scope->__pyx_outer_scope->__pyx_v_f_vector[__pyx_cur_scope->__pyx_v_i]))); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3071, __pyx_L1_error)\n   28818\t    __Pyx_GOTREF(__pyx_t_4);\n   28819\t    __pyx_r = __pyx_t_4;\n   28820\t    __pyx_t_4 = 0;\nTarget 0: (python3) stopped.\n(lldb) \nerror: No auto repeat.\n(lldb) bt\n* thread #1, queue = 'com.apple.main-thread', stop reason = EXC_BAD_ACCESS (code=1, address=0x0)\n  * frame #0: 0x00000001142ae934 base.cpython-39-darwin.so`__pyx_gb_4sage_8geometry_10polyhedron_24combinatorial_polyhedron_4base_23CombinatorialPolyhedron_24_compute_edges_or_ridges_5generator29(__pyx_generator=0x0000000114562160, __pyx_tstate=0x0000000100508140, __pyx_sent_value=0x00000001003a8580) at base.c:28817:74 [opt]\n    frame #1: 0x00000001033bc4fa cachefunc.cpython-39-darwin.so`__Pyx_Coroutine_SendEx(self=0x0000000114562160, value=0x00000001003a8580, closing=<unavailable>) at cachefunc.c:28545:14 [opt]\n    frame #2: 0x00000001001573c0 libpython3.9.dylib`PySequence_Tuple + 144\n    frame #3: 0x00000001142abde3 base.cpython-39-darwin.so`__pyx_f_4sage_8geometry_10polyhedron_24combinatorial_polyhedron_4base_23CombinatorialPolyhedron__compute_edges_or_ridges(__pyx_v_self=<unavailable>, __pyx_v_dual=<unavailable>, __pyx_v_do_edges=<unavailable>) at base.c:29447:19 [opt]\n    frame #4: 0x00000001142b7aa7 base.cpython-39-darwin.so`__pyx_pw_4sage_8geometry_10polyhedron_24combinatorial_polyhedron_4base_23CombinatorialPolyhedron_23edges [inlined] __pyx_f_4sage_8geometry_10polyhedron_24combinatorial_polyhedron_4base_23CombinatorialPolyhedron__compute_edges(__pyx_v_self=<unavailable>, __pyx_v_dual=<unavailable>) at base.c:43309:15 [opt]\n    frame #5: 0x00000001142b7a9b base.cpython-39-darwin.so`__pyx_pw_4sage_8geometry_10polyhedron_24combinatorial_polyhedron_4base_23CombinatorialPolyhedron_23edges [inlined] __pyx_pf_4sage_8geometry_10polyhedron_24combinatorial_polyhedron_4base_23CombinatorialPolyhedron_22edges(__pyx_v_self=0x0000000114235ca0, __pyx_v_names=0x0000000000000000) at base.c:14187 [opt]\n    frame #6: 0x00000001142b742a base.cpython-39-darwin.so`__pyx_pw_4sage_8geometry_10polyhedron_24combinatorial_polyhedron_4base_23CombinatorialPolyhedron_23edges(__pyx_v_self=0x0000000114235ca0, __pyx_args=<unavailable>, __pyx_kwds=<unavailable>) at base.c:13668 [opt]\n    frame #7: 0x00000001001ab7c5 libpython3.9.dylib`cfunction_call + 69\n    frame #8: 0x00000001142ca4d7 base.cpython-39-darwin.so`__pyx_gb_4sage_8geometry_10polyhedron_24combinatorial_polyhedron_4base_23CombinatorialPolyhedron_12vertex_graph_2generator13 [inlined] __Pyx_PyObject_Call(func=0x0000000114569860, arg=<unavailable>, kw=0x0000000100722e80) at base.c:52465:14 [opt]\n    frame #9: 0x00000001142ca49a base.cpython-39-darwin.so`__pyx_gb_4sage_8geometry_10polyhedron_24combinatorial_polyhedron_4base_23CombinatorialPolyhedron_12vertex_graph_2generator13(__pyx_generator=0x0000000112ae5b80, __pyx_tstate=<unavailable>, __pyx_sent_value=<unavailable>) at base.c:14600 [opt]\n    frame #10: 0x00000001033bc4fa cachefunc.cpython-39-darwin.so`__Pyx_Coroutine_SendEx(self=0x0000000112ae5b80, value=0x00000001003a8580, closing=<unavailable>) at cachefunc.c:28545:14 [opt]\n    frame #11: 0x00000001001573c0 libpython3.9.dylib`PySequence_Tuple + 144\n    frame #12: 0x00000001142b86c8 base.cpython-39-darwin.so`__pyx_pw_4sage_8geometry_10polyhedron_24combinatorial_polyhedron_4base_23CombinatorialPolyhedron_25vertex_graph [inlined] __pyx_pf_4sage_8geometry_10polyhedron_24combinatorial_polyhedron_4base_23CombinatorialPolyhedron_24vertex_graph(__pyx_v_self=<unavailable>, __pyx_v_names=0x0000000000000000) at base.c:14808:15 [opt]\n    frame #13: 0x00000001142b85bb base.cpython-39-darwin.so`__pyx_pw_4sage_8geometry_10polyhedron_24combinatorial_polyhedron_4base_23CombinatorialPolyhedron_25vertex_graph(__pyx_v_self=<unavailable>, __pyx_args=<unavailable>, __pyx_kwds=<unavailable>) at base.c:14515 [opt]\n    frame #14: 0x00000001001759c3 libpython3.9.dylib`method_vectorcall_VARARGS_KEYWORDS + 275\n    frame #15: 0x000000010024bc1b libpython3.9.dylib`call_function + 411\n    frame #16: 0x0000000100248c0b libpython3.9.dylib`_PyEval_EvalFrameDefault + 27147\n    frame #17: 0x000000010016d5b5 libpython3.9.dylib`function_code_fastcall + 229\n    frame #18: 0x000000010016f89c libpython3.9.dylib`method_vectorcall + 204\n    frame #19: 0x000000010024bc1b libpython3.9.dylib`call_function + 411\n    frame #20: 0x0000000100248c2e libpython3.9.dylib`_PyEval_EvalFrameDefault + 27182\n    frame #21: 0x000000010024c9d4 libpython3.9.dylib`_PyEval_EvalCode + 2580\n    frame #22: 0x0000000100242107 libpython3.9.dylib`PyEval_EvalCode + 87\n    frame #23: 0x000000010028c45f libpython3.9.dylib`PyRun_InteractiveOneObjectEx + 847\n    frame #24: 0x000000010028ba59 libpython3.9.dylib`PyRun_InteractiveLoopFlags + 169\n    frame #25: 0x000000010028b97c libpython3.9.dylib`PyRun_AnyFileExFlags + 60\n    frame #26: 0x00000001002a84ea libpython3.9.dylib`Py_RunMain + 2362\n    frame #27: 0x00000001002a87ec libpython3.9.dylib`pymain_main + 348\n    frame #28: 0x00000001002a883b libpython3.9.dylib`Py_BytesMain + 43\n    frame #29: 0x00007fff20394621 libdyld.dylib`start + 1\n    frame #30: 0x00007fff20394621 libdyld.dylib`start + 1\n```",
    "created_at": "2021-06-19T08:50:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31008#issuecomment-442390",
    "user": "https://github.com/vbraun"
}
```

Segfaults reliably on OSX

```
sage -t --long --random-seed=0 src/sage/geometry/polyhedron/combinatorial_polyhedron/base.pyx  # Killed due to segmentation fault
sage -t --long --random-seed=0 src/sage/geometry/polyhedron/base.py  # Killed due to segmentation fault
```
Debugger:

```
$ sage -sh
(sage-sh) sudo lldb ./local/bin/python3
(lldb) target create "./local/bin/python3"
Current executable set to '/Users/buildbot-sage/slave/sage_git/build/local/bin/python3' (x86_64).
(lldb) rfrom
error: 'rfrom' is not a valid command.
(lldb) r
Process 81901 launched: '/Users/buildbot-sage/slave/sage_git/build/local/bin/python3' (x86_64)
Python 3.9.5 (default, Jun  8 2021, 19:13:24) 
[Clang 12.0.5 (clang-1205.0.22.9)] on darwin
Type "help", "copyright", "credits" or "license" for more information.
>>> from sage.all import *
>>> line = Polyhedron(lines=[[0,1]])
>>> line.vertex_graph() ## line 7185 ##
base.cpython-39-darwin.so was compiled with optimization - stepping may behave oddly; variables may not be available.
Process 81901 stopped
* thread #1, queue = 'com.apple.main-thread', stop reason = EXC_BAD_ACCESS (code=1, address=0x0)
    frame #0: 0x00000001142ae934 base.cpython-39-darwin.so`__pyx_gb_4sage_8geometry_10polyhedron_24combinatorial_polyhedron_4base_23CombinatorialPolyhedron_24_compute_edges_or_ridges_5generator29(__pyx_generator=0x0000000114562160, __pyx_tstate=0x0000000100508140, __pyx_sent_value=0x00000001003a8580) at base.c:28817:74 [opt]
   28814	  __pyx_t_2 = __pyx_t_1;
   28815	  for (__pyx_t_3 = 0; __pyx_t_3 < __pyx_t_2; __pyx_t_3+=1) {
   28816	    __pyx_cur_scope->__pyx_v_i = __pyx_t_3;
-> 28817	    __pyx_t_4 = ((PyObject *)__pyx_f_4sage_5rings_7integer_smallInteger((__pyx_cur_scope->__pyx_outer_scope->__pyx_v_f_vector[__pyx_cur_scope->__pyx_v_i]))); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3071, __pyx_L1_error)
   28818	    __Pyx_GOTREF(__pyx_t_4);
   28819	    __pyx_r = __pyx_t_4;
   28820	    __pyx_t_4 = 0;
Target 0: (python3) stopped.
(lldb) 
error: No auto repeat.
(lldb) bt
* thread #1, queue = 'com.apple.main-thread', stop reason = EXC_BAD_ACCESS (code=1, address=0x0)
  * frame #0: 0x00000001142ae934 base.cpython-39-darwin.so`__pyx_gb_4sage_8geometry_10polyhedron_24combinatorial_polyhedron_4base_23CombinatorialPolyhedron_24_compute_edges_or_ridges_5generator29(__pyx_generator=0x0000000114562160, __pyx_tstate=0x0000000100508140, __pyx_sent_value=0x00000001003a8580) at base.c:28817:74 [opt]
    frame #1: 0x00000001033bc4fa cachefunc.cpython-39-darwin.so`__Pyx_Coroutine_SendEx(self=0x0000000114562160, value=0x00000001003a8580, closing=<unavailable>) at cachefunc.c:28545:14 [opt]
    frame #2: 0x00000001001573c0 libpython3.9.dylib`PySequence_Tuple + 144
    frame #3: 0x00000001142abde3 base.cpython-39-darwin.so`__pyx_f_4sage_8geometry_10polyhedron_24combinatorial_polyhedron_4base_23CombinatorialPolyhedron__compute_edges_or_ridges(__pyx_v_self=<unavailable>, __pyx_v_dual=<unavailable>, __pyx_v_do_edges=<unavailable>) at base.c:29447:19 [opt]
    frame #4: 0x00000001142b7aa7 base.cpython-39-darwin.so`__pyx_pw_4sage_8geometry_10polyhedron_24combinatorial_polyhedron_4base_23CombinatorialPolyhedron_23edges [inlined] __pyx_f_4sage_8geometry_10polyhedron_24combinatorial_polyhedron_4base_23CombinatorialPolyhedron__compute_edges(__pyx_v_self=<unavailable>, __pyx_v_dual=<unavailable>) at base.c:43309:15 [opt]
    frame #5: 0x00000001142b7a9b base.cpython-39-darwin.so`__pyx_pw_4sage_8geometry_10polyhedron_24combinatorial_polyhedron_4base_23CombinatorialPolyhedron_23edges [inlined] __pyx_pf_4sage_8geometry_10polyhedron_24combinatorial_polyhedron_4base_23CombinatorialPolyhedron_22edges(__pyx_v_self=0x0000000114235ca0, __pyx_v_names=0x0000000000000000) at base.c:14187 [opt]
    frame #6: 0x00000001142b742a base.cpython-39-darwin.so`__pyx_pw_4sage_8geometry_10polyhedron_24combinatorial_polyhedron_4base_23CombinatorialPolyhedron_23edges(__pyx_v_self=0x0000000114235ca0, __pyx_args=<unavailable>, __pyx_kwds=<unavailable>) at base.c:13668 [opt]
    frame #7: 0x00000001001ab7c5 libpython3.9.dylib`cfunction_call + 69
    frame #8: 0x00000001142ca4d7 base.cpython-39-darwin.so`__pyx_gb_4sage_8geometry_10polyhedron_24combinatorial_polyhedron_4base_23CombinatorialPolyhedron_12vertex_graph_2generator13 [inlined] __Pyx_PyObject_Call(func=0x0000000114569860, arg=<unavailable>, kw=0x0000000100722e80) at base.c:52465:14 [opt]
    frame #9: 0x00000001142ca49a base.cpython-39-darwin.so`__pyx_gb_4sage_8geometry_10polyhedron_24combinatorial_polyhedron_4base_23CombinatorialPolyhedron_12vertex_graph_2generator13(__pyx_generator=0x0000000112ae5b80, __pyx_tstate=<unavailable>, __pyx_sent_value=<unavailable>) at base.c:14600 [opt]
    frame #10: 0x00000001033bc4fa cachefunc.cpython-39-darwin.so`__Pyx_Coroutine_SendEx(self=0x0000000112ae5b80, value=0x00000001003a8580, closing=<unavailable>) at cachefunc.c:28545:14 [opt]
    frame #11: 0x00000001001573c0 libpython3.9.dylib`PySequence_Tuple + 144
    frame #12: 0x00000001142b86c8 base.cpython-39-darwin.so`__pyx_pw_4sage_8geometry_10polyhedron_24combinatorial_polyhedron_4base_23CombinatorialPolyhedron_25vertex_graph [inlined] __pyx_pf_4sage_8geometry_10polyhedron_24combinatorial_polyhedron_4base_23CombinatorialPolyhedron_24vertex_graph(__pyx_v_self=<unavailable>, __pyx_v_names=0x0000000000000000) at base.c:14808:15 [opt]
    frame #13: 0x00000001142b85bb base.cpython-39-darwin.so`__pyx_pw_4sage_8geometry_10polyhedron_24combinatorial_polyhedron_4base_23CombinatorialPolyhedron_25vertex_graph(__pyx_v_self=<unavailable>, __pyx_args=<unavailable>, __pyx_kwds=<unavailable>) at base.c:14515 [opt]
    frame #14: 0x00000001001759c3 libpython3.9.dylib`method_vectorcall_VARARGS_KEYWORDS + 275
    frame #15: 0x000000010024bc1b libpython3.9.dylib`call_function + 411
    frame #16: 0x0000000100248c0b libpython3.9.dylib`_PyEval_EvalFrameDefault + 27147
    frame #17: 0x000000010016d5b5 libpython3.9.dylib`function_code_fastcall + 229
    frame #18: 0x000000010016f89c libpython3.9.dylib`method_vectorcall + 204
    frame #19: 0x000000010024bc1b libpython3.9.dylib`call_function + 411
    frame #20: 0x0000000100248c2e libpython3.9.dylib`_PyEval_EvalFrameDefault + 27182
    frame #21: 0x000000010024c9d4 libpython3.9.dylib`_PyEval_EvalCode + 2580
    frame #22: 0x0000000100242107 libpython3.9.dylib`PyEval_EvalCode + 87
    frame #23: 0x000000010028c45f libpython3.9.dylib`PyRun_InteractiveOneObjectEx + 847
    frame #24: 0x000000010028ba59 libpython3.9.dylib`PyRun_InteractiveLoopFlags + 169
    frame #25: 0x000000010028b97c libpython3.9.dylib`PyRun_AnyFileExFlags + 60
    frame #26: 0x00000001002a84ea libpython3.9.dylib`Py_RunMain + 2362
    frame #27: 0x00000001002a87ec libpython3.9.dylib`pymain_main + 348
    frame #28: 0x00000001002a883b libpython3.9.dylib`Py_BytesMain + 43
    frame #29: 0x00007fff20394621 libdyld.dylib`start + 1
    frame #30: 0x00007fff20394621 libdyld.dylib`start + 1
```



---

archive/issue_comments_442391.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2021-06-19T08:50:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31008#issuecomment-442391",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_442392.json:
```json
{
    "body": "Thanks Volker for the precise log.\n\nUnfortunately, I neither understand the problem nor can reproduce it. I could just disable OpenMP with clang by default and hope this solves the problem.",
    "created_at": "2021-06-19T09:19:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31008#issuecomment-442392",
    "user": "https://github.com/kliem"
}
```

Thanks Volker for the precise log.

Unfortunately, I neither understand the problem nor can reproduce it. I could just disable OpenMP with clang by default and hope this solves the problem.



---

archive/issue_comments_442393.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-06-19T11:06:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31008#issuecomment-442393",
    "user": "https://github.com/kliem"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_442394.json:
```json
{
    "body": "I think I tracked it down. I assumed that\n\n```\ncdef bint do_f_vector\n```\nis initialized to zero, which apparently isn't always the case.\n\nThen Volkers report also makes sense.\n\n---\nNew commits:",
    "created_at": "2021-06-19T11:06:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31008#issuecomment-442394",
    "user": "https://github.com/kliem"
}
```

I think I tracked it down. I assumed that

```
cdef bint do_f_vector
```
is initialized to zero, which apparently isn't always the case.

Then Volkers report also makes sense.

---
New commits:



---

archive/issue_comments_442395.json:
```json
{
    "body": "I really don't understand why this pops out just now and not earlier.",
    "created_at": "2021-06-19T11:07:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31008#issuecomment-442395",
    "user": "https://github.com/kliem"
}
```

I really don't understand why this pops out just now and not earlier.



---

archive/issue_comments_442396.json:
```json
{
    "body": "Uninitialized variables are whatever the RAM content is when they enter scope. However, any RAM region that you get from the OS is zeroed out (so you can't read content from older processes). So uninitialized variables tend to be zero initially, but the longer the program runs the more likely it becomes that the variable occupies a previously-used memory location.\n\nMore precisely, only global and static C variables are guaranteed to be initialized to zero, local variables are not.\n\nValgrind can detect these things for you (i.e. when you read uninitialized memory)",
    "created_at": "2021-06-19T13:53:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31008#issuecomment-442396",
    "user": "https://github.com/vbraun"
}
```

Uninitialized variables are whatever the RAM content is when they enter scope. However, any RAM region that you get from the OS is zeroed out (so you can't read content from older processes). So uninitialized variables tend to be zero initially, but the longer the program runs the more likely it becomes that the variable occupies a previously-used memory location.

More precisely, only global and static C variables are guaranteed to be initialized to zero, local variables are not.

Valgrind can detect these things for you (i.e. when you read uninitialized memory)



---

archive/issue_comments_442397.json:
```json
{
    "body": "Replying to [comment:46 vbraun]:\n> Uninitialized variables are whatever the RAM content is when they enter scope. However, any RAM region that you get from the OS is zeroed out (so you can't read content from older processes). So uninitialized variables tend to be zero initially, but the longer the program runs the more likely it becomes that the variable occupies a previously-used memory location.\n> \n> More precisely, only global and static C variables are guaranteed to be initialized to zero, local variables are not.\n> \n> Valgrind can detect these things for you (i.e. when you read uninitialized memory)\n> \n>    \n\n\nThank you for the explanation.\n\nOnce I found out where the problem lies, I wasn't that confused anymore. I originally thought it had something to do with the current ticket, but it doesn't, it just appears now, probably because it now gets stabely compiled in a slightly different way.\n\nIn this case it is actually a mistake I made (which I in theory knew about, when I made it). I never meant to assume anything on an unitialized `bint`: There where two cases and depending on the case I would set it to `True` and `False` and then I added special handling for corner cases and forgot to initialize the `bint`.\n\nI didn't know that RAM is zeroed out before the process, but once you mention it, of course this is how it ought to be.",
    "created_at": "2021-06-19T18:36:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31008#issuecomment-442397",
    "user": "https://github.com/kliem"
}
```

Replying to [comment:46 vbraun]:
> Uninitialized variables are whatever the RAM content is when they enter scope. However, any RAM region that you get from the OS is zeroed out (so you can't read content from older processes). So uninitialized variables tend to be zero initially, but the longer the program runs the more likely it becomes that the variable occupies a previously-used memory location.
> 
> More precisely, only global and static C variables are guaranteed to be initialized to zero, local variables are not.
> 
> Valgrind can detect these things for you (i.e. when you read uninitialized memory)
> 
>    


Thank you for the explanation.

Once I found out where the problem lies, I wasn't that confused anymore. I originally thought it had something to do with the current ticket, but it doesn't, it just appears now, probably because it now gets stabely compiled in a slightly different way.

In this case it is actually a mistake I made (which I in theory knew about, when I made it). I never meant to assume anything on an unitialized `bint`: There where two cases and depending on the case I would set it to `True` and `False` and then I added special handling for corner cases and forgot to initialize the `bint`.

I didn't know that RAM is zeroed out before the process, but once you mention it, of course this is how it ought to be.



---

archive/issue_comments_442398.json:
```json
{
    "body": "Hopefully this will be the last iteration of this. Sorry for having to redo this a bunch of times Volker; I just haven't been able to locally recreate any of the issues.",
    "created_at": "2021-06-20T22:53:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31008#issuecomment-442398",
    "user": "https://github.com/tscrim"
}
```

Hopefully this will be the last iteration of this. Sorry for having to redo this a bunch of times Volker; I just haven't been able to locally recreate any of the issues.



---

archive/issue_comments_442399.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-06-20T22:53:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31008#issuecomment-442399",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_442400.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-06-29T17:40:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31008#issuecomment-442400",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_081676.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-06-29T17:40:56Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/31008",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31008#event-81676"
}
```
