# Issue 17258: Fix refine_embedding when some but not all embeddings are real

Issue created by migration from Trac.

Original creator: jdemeyer

Original creation time: 2014-12-13 13:22:26

The number field below has one real embedding and two complex embeddings. These complex embeddings should be ignored in `refine_embedding`, but that's not the case, causing


```
sage: K.<a> = NumberField(x^3 + x - 1, embedding=0.68)
sage: from sage.rings.number_field.number_field import refine_embedding
sage: refine_embedding(K.specified_complex_embedding(), 200)
Traceback (most recent call last):
...
TypeError: Unable to convert number to real interval.
```



---

Comment by gagern created at 2014-12-15 09:28:25

New commits:


---

Comment by gagern created at 2014-12-15 09:28:25

Changing status from new to needs_review.


---

Comment by git created at 2014-12-15 09:38:12

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by gagern created at 2014-12-15 09:40:48

Regarding my second commit:


```
sage: f = QQ[x](69721504*x^8 + 251777664*x^6 + 329532012*x^4 + 184429548*x^2 + 37344321)
sage: %timeit CDF[x](f).roots()
1000 loops, best of 3: 525 µs per loop
sage: %timeit f.roots(CDF)
1000 loops, best of 3: 465 µs per loop
sage: %timeit QQbar[x](f).roots()
10 loops, best of 3: 24.4 ms per loop
sage: %timeit f.roots(QQbar)
10 loops, best of 3: 20.8 ms per loop
```


So using `f.roots(K)` should be better than `K['x'](f)` in pretty much all cases.


---

Comment by jdemeyer created at 2014-12-15 22:13:40

Please make this two lines:

```
r = f.roots(K, False); r.sort()
```



---

Comment by jdemeyer created at 2014-12-15 22:13:40

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2014-12-15 22:16:01

and use `f.roots(K, multiplicities=False)`, which is much more explicit.


---

Comment by jdemeyer created at 2014-12-15 22:34:13

For the example you added, could you do it also for `prec=Infinity`?


---

Comment by git created at 2014-12-15 22:55:22

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by gagern created at 2014-12-15 22:55:59

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2014-12-16 21:07:43

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2014-12-18 00:57:14

Resolution: fixed
