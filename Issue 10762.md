# Issue 10762: Make matplotlib support SAGE_SPKG_INSTALL_DOCS

archive/issues_010762.json:
```json
{
    "body": "Assignee: tbd\n\nCC:  ryan\n\nThis ticket implements #10823 for matplotlib. New spkg at \u00a0http://sage.math.washington.edu/home/jason/matplotlib-1.0.1.p0.spkg (depends on #10588)\n\nIssue created by migration from https://trac.sagemath.org/ticket/10828\n\n",
    "created_at": "2011-02-23T01:54:34Z",
    "labels": [
        "component: packages: standard"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "Make matplotlib support SAGE_SPKG_INSTALL_DOCS",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10762",
    "user": "https://github.com/jasongrout"
}
```
Assignee: tbd

CC:  ryan

This ticket implements #10823 for matplotlib. New spkg at Â http://sage.math.washington.edu/home/jason/matplotlib-1.0.1.p0.spkg (depends on #10588)

Issue created by migration from https://trac.sagemath.org/ticket/10828





---

archive/issue_comments_113632.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-02-23T01:55:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10762#issuecomment-113632",
    "user": "https://github.com/jasongrout"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_113633.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-03-01T15:24:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10762#issuecomment-113633",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_113634.json:
```json
{
    "body": "A few points. \n\n* The SPKG.txt file does not have the number of this ticket in it - only #10823 \n* On #10823 the patch which updates the Developers Guide shows the documentation being **copied** not moved, which is better, as it leaves the build directory untouched.  \n* It would make reviewing much easier, and be a better historical record, if there was a Mercurial patch of the changes attached to the ticket. \n\nIt looks like similar issues arise with the other updated .spkg files that you produced which are related to #10823",
    "created_at": "2011-03-01T15:24:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10762#issuecomment-113634",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

A few points. 

* The SPKG.txt file does not have the number of this ticket in it - only #10823 
* On #10823 the patch which updates the Developers Guide shows the documentation being **copied** not moved, which is better, as it leaves the build directory untouched.  
* It would make reviewing much easier, and be a better historical record, if there was a Mercurial patch of the changes attached to the ticket. 

It looks like similar issues arise with the other updated .spkg files that you produced which are related to #10823



---

archive/issue_comments_113635.json:
```json
{
    "body": "Attachment [10828.patch](tarball://root/attachments/some-uuid/ticket10828/10828.patch) by @jasongrout created at 2011-03-01 19:41:32\n\nFYI Only---already applied to spkg.",
    "created_at": "2011-03-01T19:41:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10762#issuecomment-113635",
    "user": "https://github.com/jasongrout"
}
```

Attachment [10828.patch](tarball://root/attachments/some-uuid/ticket10828/10828.patch) by @jasongrout created at 2011-03-01 19:41:32

FYI Only---already applied to spkg.



---

archive/issue_comments_113636.json:
```json
{
    "body": "FYI Only---already applied to spkg.",
    "created_at": "2011-03-01T19:41:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10762#issuecomment-113636",
    "user": "https://github.com/jasongrout"
}
```

FYI Only---already applied to spkg.



---

archive/issue_comments_113637.json:
```json
{
    "body": "Attachment [10828-1.patch](tarball://root/attachments/some-uuid/ticket10828/10828-1.patch) by @jasongrout created at 2011-03-01 19:42:56",
    "created_at": "2011-03-01T19:42:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10762#issuecomment-113637",
    "user": "https://github.com/jasongrout"
}
```

Attachment [10828-1.patch](tarball://root/attachments/some-uuid/ticket10828/10828-1.patch) by @jasongrout created at 2011-03-01 19:42:56



---

archive/issue_comments_113638.json:
```json
{
    "body": "I also found that the last matplotlib spkg from #10588 had a dirty src/ directory, instead a pristine copy of the sources.  That was probably all my fault, as I was the reviewer, and the contributor was a new contributor.  I'm CCing Ryan to make sure he knows about it, just as an FYI.\n\nThe new matplotlib spkg above replaces the src/ directory with a pristine copy of the 1.0.1 matplotlib sources, which removes the build directory, some of the files that are generated in compilation, and trims the final spkg from 19M to 11M.",
    "created_at": "2011-03-01T19:57:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10762#issuecomment-113638",
    "user": "https://github.com/jasongrout"
}
```

I also found that the last matplotlib spkg from #10588 had a dirty src/ directory, instead a pristine copy of the sources.  That was probably all my fault, as I was the reviewer, and the contributor was a new contributor.  I'm CCing Ryan to make sure he knows about it, just as an FYI.

The new matplotlib spkg above replaces the src/ directory with a pristine copy of the 1.0.1 matplotlib sources, which removes the build directory, some of the files that are generated in compilation, and trims the final spkg from 19M to 11M.



---

archive/issue_comments_113639.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-03-01T20:08:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10762#issuecomment-113639",
    "user": "https://github.com/jasongrout"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_113640.json:
```json
{
    "body": "New spkg is up, ready for review.",
    "created_at": "2011-03-01T20:08:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10762#issuecomment-113640",
    "user": "https://github.com/jasongrout"
}
```

New spkg is up, ready for review.



---

archive/issue_comments_113641.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-03-02T01:35:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10762#issuecomment-113641",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_113642.json:
```json
{
    "body": "This generates the HTML and puts it where expected. However, the simple \n\n\n```\ncp -r doc/* $SAGE_ROOT/local/share/doc/PACKAGE_NAME/\n```\n\n\nis copying a **lot** of unnecessary files. There are 29 files with the extension .py, 511 files with the extension .pyc, and possibly some other unnecessary files that are being copied to `$SAGE_ROOT/local/share/doc/PACKAGE_NAME/` There are 945 pdf files there too - I'm not quite sure how they got there. The total size of the files copied to `$SAGE_ROOT/local/share/doc/PACKAGE_NAME/` is 115 MB\n\nI think we need to find the unnecessary files and remove them. Something like:\n\n\n```\nfind \"$SAGE_ROOT/local/share/doc/matplotlib\" -name '*.pyc' -exec rm -f {} \\;\nfind \"$SAGE_ROOT/local/share/doc/matplotlib\" -name '*.py'  -exec rm -f {} \\;\n```\n\n\nwould be a start, but there's probably more that can be done. \n\nShould we generate all the PDFs if `pdftex` is present? (In which case there will be several hundred more), or delete all the PDFs??\n\nI can't see any point in having the .py and .pyc files, but I'm not so sure about the .pdf files. \n\nI'm not going to copy the same comments to all the other packages - lets get one right first, before going on to the others. \n\nI think #10823 should be updated to advise developers to remove unnecessary files if they are present, otherwise we are just going to be copying a lot of unneeded junk, and filling up disks unnecessarily. \n\nDave",
    "created_at": "2011-03-02T01:35:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10762#issuecomment-113642",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

This generates the HTML and puts it where expected. However, the simple 


```
cp -r doc/* $SAGE_ROOT/local/share/doc/PACKAGE_NAME/
```


is copying a **lot** of unnecessary files. There are 29 files with the extension .py, 511 files with the extension .pyc, and possibly some other unnecessary files that are being copied to `$SAGE_ROOT/local/share/doc/PACKAGE_NAME/` There are 945 pdf files there too - I'm not quite sure how they got there. The total size of the files copied to `$SAGE_ROOT/local/share/doc/PACKAGE_NAME/` is 115 MB

I think we need to find the unnecessary files and remove them. Something like:


```
find "$SAGE_ROOT/local/share/doc/matplotlib" -name '*.pyc' -exec rm -f {} \;
find "$SAGE_ROOT/local/share/doc/matplotlib" -name '*.py'  -exec rm -f {} \;
```


would be a start, but there's probably more that can be done. 

Should we generate all the PDFs if `pdftex` is present? (In which case there will be several hundred more), or delete all the PDFs??

I can't see any point in having the .py and .pyc files, but I'm not so sure about the .pdf files. 

I'm not going to copy the same comments to all the other packages - lets get one right first, before going on to the others. 

I think #10823 should be updated to advise developers to remove unnecessary files if they are present, otherwise we are just going to be copying a lot of unneeded junk, and filling up disks unnecessarily. 

Dave



---

archive/issue_comments_113643.json:
```json
{
    "body": "In matplotlib, it's not \"cp -r doc/* $SAGE_ROOT/local/share/doc/PACKAGE_NAME/\", but rather, it's copying the results of the build directory.\n\nThe documentation for matplotlib includes a *lot* of example figures (generated in both png and pdf formats) as well as the .py files that generated those examples, so I think those files are legitimate.  I'm not sure about the .pyc files---I'll check those.",
    "created_at": "2011-03-02T02:04:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10762#issuecomment-113643",
    "user": "https://github.com/jasongrout"
}
```

In matplotlib, it's not "cp -r doc/* $SAGE_ROOT/local/share/doc/PACKAGE_NAME/", but rather, it's copying the results of the build directory.

The documentation for matplotlib includes a *lot* of example figures (generated in both png and pdf formats) as well as the .py files that generated those examples, so I think those files are legitimate.  I'm not sure about the .pyc files---I'll check those.



---

archive/issue_comments_113644.json:
```json
{
    "body": "This spkg (as well as the other spkgs from #10823) are copying the directories containing the actual built documentation (e.g., build/html), not the entire documentation source tree.  As such, only the actual documentation files should be there.  In matplotlib's case, lots of pdf and png files are generated as example images (this is a plotting package, after all) and the generating .py files are also included in the docs.\n\nI see some pyc files that probably should not be in the build directory of the docs.  \nI feel like these should be reported upstream and dealt with on another ticket.  I'd really rather use the default upstream doc build system, and report problems upstream.\n\nPlease remember that SAGE_SPKG_INSTALL_DOCS is an optional feature, and the people that invoke it are making a decision that the documentation is worth the disk space.",
    "created_at": "2011-03-02T02:40:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10762#issuecomment-113644",
    "user": "https://github.com/jasongrout"
}
```

This spkg (as well as the other spkgs from #10823) are copying the directories containing the actual built documentation (e.g., build/html), not the entire documentation source tree.  As such, only the actual documentation files should be there.  In matplotlib's case, lots of pdf and png files are generated as example images (this is a plotting package, after all) and the generating .py files are also included in the docs.

I see some pyc files that probably should not be in the build directory of the docs.  
I feel like these should be reported upstream and dealt with on another ticket.  I'd really rather use the default upstream doc build system, and report problems upstream.

Please remember that SAGE_SPKG_INSTALL_DOCS is an optional feature, and the people that invoke it are making a decision that the documentation is worth the disk space.



---

archive/issue_comments_113645.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-03-02T02:40:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10762#issuecomment-113645",
    "user": "https://github.com/jasongrout"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_113646.json:
```json
{
    "body": "I've posted a message to the matplotlib list about the .pyc files, as well as a possible redundancy in image files.",
    "created_at": "2011-03-02T04:27:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10762#issuecomment-113646",
    "user": "https://github.com/jasongrout"
}
```

I've posted a message to the matplotlib list about the .pyc files, as well as a possible redundancy in image files.



---

archive/issue_comments_113647.json:
```json
{
    "body": "OK, in light of what you have said, I'll put this to positive review.",
    "created_at": "2011-03-02T04:45:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10762#issuecomment-113647",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

OK, in light of what you have said, I'll put this to positive review.



---

archive/issue_comments_113648.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-03-02T04:45:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10762#issuecomment-113648",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_113649.json:
```json
{
    "body": "An upstream developer has proposed some changes to matplotlib that will cut down on the redundant files.  See the mailing list thread here: http://thread.gmane.org/gmane.comp.python.matplotlib.general/26576",
    "created_at": "2011-03-04T16:59:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10762#issuecomment-113649",
    "user": "https://github.com/jasongrout"
}
```

An upstream developer has proposed some changes to matplotlib that will cut down on the redundant files.  See the mailing list thread here: http://thread.gmane.org/gmane.comp.python.matplotlib.general/26576



---

archive/issue_comments_113650.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2011-03-08T21:48:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10762#issuecomment-113650",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_events_010884.json:
```json
{
    "actor": "@jdemeyer",
    "created_at": "2011-03-08T21:48:19Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/10762",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10762#event-10884"
}
```



---

archive/issue_comments_113651.json:
```json
{
    "body": "matplotlib doesn't build from scratch using SAGE_SPKG_INSTALL_DOCS, see also #10826.",
    "created_at": "2011-04-14T11:59:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10762#issuecomment-113651",
    "user": "https://github.com/jdemeyer"
}
```

matplotlib doesn't build from scratch using SAGE_SPKG_INSTALL_DOCS, see also #10826.



---

archive/issue_comments_113652.json:
```json
{
    "body": "Changing status from closed to new.",
    "created_at": "2011-04-14T11:59:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10762#issuecomment-113652",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from closed to new.



---

archive/issue_events_010885.json:
```json
{
    "actor": "@jdemeyer",
    "created_at": "2011-04-14T11:59:14Z",
    "event": "reopened",
    "issue": "https://github.com/sagemath/sagetest/issues/10762",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10762#event-10885"
}
```



---

archive/issue_comments_113653.json:
```json
{
    "body": "Resolution changed from fixed to ",
    "created_at": "2011-04-14T11:59:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10762#issuecomment-113653",
    "user": "https://github.com/jdemeyer"
}
```

Resolution changed from fixed to 



---

archive/issue_comments_113654.json:
```json
{
    "body": "Changing status from new to needs_work.",
    "created_at": "2011-04-14T11:59:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10762#issuecomment-113654",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_work.



---

archive/issue_comments_113655.json:
```json
{
    "body": "See #11197 for building docs after Sage is built.",
    "created_at": "2011-04-14T13:52:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10762#issuecomment-113655",
    "user": "https://github.com/jasongrout"
}
```

See #11197 for building docs after Sage is built.



---

archive/issue_comments_113656.json:
```json
{
    "body": "Changing keywords from \"\" to \"sd32\".",
    "created_at": "2011-08-24T23:39:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10762#issuecomment-113656",
    "user": "https://github.com/williamstein"
}
```

Changing keywords from "" to "sd32".



---

archive/issue_comments_113657.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-12-02T01:11:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10762#issuecomment-113657",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_113658.json:
```json
{
    "body": "outdated, should close",
    "created_at": "2021-12-02T01:11:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10762#issuecomment-113658",
    "user": "https://github.com/mkoeppe"
}
```

outdated, should close



---

archive/issue_comments_113659.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-12-03T09:32:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10762#issuecomment-113659",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_010886.json:
```json
{
    "actor": "@mkoeppe",
    "created_at": "2021-12-03T18:41:01Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/10762",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10762#event-10886"
}
```



---

archive/issue_comments_113660.json:
```json
{
    "body": "Resolution: invalid",
    "created_at": "2021-12-03T18:41:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10762#issuecomment-113660",
    "user": "https://github.com/mkoeppe"
}
```

Resolution: invalid
