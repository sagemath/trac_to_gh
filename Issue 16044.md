# Issue 16044: redesign projective plane

Issue created by migration from Trac.

Original creator: vdelecroix

Original creation time: 2014-05-03 09:45:39

CC:  ncohen

Keywords: design, projective plane

Projective planes are currently implemented as block designs but are *very* slow to construct (see timings in #16272). Moreover the specifications and the behaviour are contradictory.

In this ticket
- we create several function that aim to build a specific projective planes (Desarguesian, Hall, Hugues)
- we replace the function `ProjectivePlaneDesign` with `projective_plane` that return *a* projective plane if there is an available construction, or raise a `EmptySetError` if no construction is possible or raise a `NotImplementedError` if no construction is currently available.

We also implement two translation functions `projective_plane_to_OA` and `OA_to_projective_plane` that make the translation between orthogonal arrays (with parameters `k=n+1` and `t=2`) and projective planes.

This is an intermediate step for #16272


---

Comment by vdelecroix created at 2014-05-03 13:14:48

Here it is...
----
New commits:


---

Comment by vdelecroix created at 2014-05-03 13:14:48

Changing status from new to needs_review.


---

Comment by ncohen created at 2014-05-03 13:42:59

Heeeeeeeeereis the review !

- Designs end with "Design", i.e. DesarguesianProjectivePlaneDesign. I don't say that it is a good idea, but that we should change it for all of them or not at all. Plus Dima will complain.

- Why not use deprecated_function_alias for designs.ProjectivePlaneDesign ?

- You can do this instead
  {{{
  relabel = {x:i for i,x in enumerate(K)}
  Klist = relabel # Klist represent the set of elements of K
  }}}

- `projective_plane_to_OA`: there is a function in bibd.py called `_relabel_BIBD` that takes a BIBD on n points as input (here it would be a projective plane) and relabels its elements in such a way that [[0,..,k-2,n],[k-1,...,2*k-2,n],...,[n-k-1,n-1]] are sets of the BIBD. So well. It actually does what you are doing : it relabels the BIBD such that when you remove all blocks containing n-1 you get a well-labelled TD.

- `OA_to_projective_plane` I implemented something VERY SIMILAR in #16279 but not equivalent :-)

- `OA_to_projective_plane` : Why do you need to relabel anything ?
  {{{
+    # add the n^2 lines that correspond to transversals
+    for l in OA:
+        blcks.append([i+(n+1)*j for i,j in enumerate(l)])
  }}}
  The OA is already well labelled. The BIBD is exactly the blocks from the OA plus the k groups union the new element, isn't it ? This should just be a deepcopy.

- Isn't the triangle a Projective Plane of order 1 ?

Nathann


---

Comment by ncohen created at 2014-05-03 13:42:59

Changing status from needs_review to needs_info.


---

Comment by vdelecroix created at 2014-05-03 13:51:57

Replying to [comment:3 ncohen]:
> Heeeeeeeeereis the review !

Thanks!
 
> - Designs end with "Design", i.e. DesarguesianProjectivePlaneDesign. I don't say that it is a good idea, but that we should change it for all of them or not at all. Plus Dima will complain.

Ok.

> - Why not use deprecated_function_alias for designs.ProjectivePlaneDesign ?

Because of the argument "type"... funny isn't it?

> - You can do this instead
>   {{{
>   relabel = {x:i for i,x in enumerate(K)}
>   Klist = relabel # Klist represent the set of elements of K
>   }}}

All right.

> - `projective_plane_to_OA`: there is a function in bibd.py called `_relabel_BIBD` that takes a BIBD on n points as input (here it would be a projective plane) and relabels its elements in such a way that [[0,..,k-2,n],[k-1,...,2*k-2,n],...,[n-k-1,n-1]] are sets of the BIBD. So well. It actually does what you are doing : it relabels the BIBD such that when you remove all blocks containing n-1 you get a well-labelled TD.
> - `OA_to_projective_plane` I implemented something VERY SIMILAR in #16279 but not equivalent :-)
> 
> - `OA_to_projective_plane` : Why do you need to relabel anything ?
>   {{{
> +    # add the n^2 lines that correspond to transversals
> +    for l in OA:
> +        blcks.append([i+(n+1)*j for i,j in enumerate(l)])
>   }}}
>   The OA is already well labelled. The BIBD is exactly the blocks from the OA plus the k groups union the new element, isn't it ? This should just be a deepcopy.
> 

I do not know what is a bibd and I did not have a look at it (except changing the call to ProjectivePlaneDesign). If you feel like removing more code I am happy with that but I will not do it (if you do, wait until the other remarks are implemented).

> - Isn't the triangle a Projective Plane of order 1 ?

Nope: in a projective plane there should be a quadrilateral.
 
Vincent


---

Comment by ncohen created at 2014-05-03 13:55:42

Yo !

> Because of the argument "type"... funny isn't it?

Come on.... I am not even sure this thing ever appeared in a public release, and it does nothing.... I think it is safe to use a `deprecated_function_alias`. Actually it is even safe to remove it without warning...

> I do not know what is a bibd and I did not have a look at it (except changing the call to ProjectivePlaneDesign). If you feel like removing more code I am happy with that but I will not do it (if you do, wait until the other remarks are implemented).

Well. If you have a ProjectivePlane (a Projective Plane is a BIBD) named `PP` and do `PP = _relabel_BIBD(PP)` then if you remove from the new `PP` all blocks that contain the "maximum point" (i.e. n-1) then you have a properly labeled TD.

> Nope: in a projective plane there should be a quadrilateral.

Right. I had some (theoretical) problems with degenerate projective planes recently `:-P`

Nathann


---

Comment by vdelecroix created at 2014-05-03 13:57:05

Replying to [comment:5 ncohen]:
> Yo !
> 
> > Because of the argument "type"... funny isn't it?
> 
> Come on.... I am not even sure this thing ever appeared in a public release, and it does nothing.... I think it is safe to use a `deprecated_function_alias`. Actually it is even safe to remove it without warning...

All right. I remove it.

> > I do not know what is a bibd and I did not have a look at it (except changing the call to ProjectivePlaneDesign). If you feel like removing more code I am happy with that but I will not do it (if you do, wait until the other remarks are implemented).
> 
> Well. If you have a ProjectivePlane (a Projective Plane is a BIBD) named `PP` and do `PP = _relabel_BIBD(PP)` then if you remove from the new `PP` all blocks that contain the "maximum point" (i.e. n-1) then you have a properly labeled TD.

Ok. I see. Perfect.

Vincent


---

Comment by ncohen created at 2014-05-03 13:59:40

by the way: a BIBD is an edge-decomposition of a Complete graph on n elements with complete graphs of k elements. It is a collection of sets of size k such that any pair of elements in [n] belong to exactly one of these sets of size k. Somehow it is a projective plane with uniform lines, but two lines do not necessarily intersect.

Nathann


---

Comment by git created at 2014-05-03 14:10:16

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2014-05-03 14:11:28

I was not able to use the function '_relabel_bibd'. If you want to play with it...


---

Comment by vdelecroix created at 2014-05-03 14:11:49

Changing status from needs_info to needs_review.


---

Comment by ncohen created at 2014-05-03 14:36:34

> I was not able to use the function '_relabel_bibd'. If you want to play with it...

Do you think that the "pt" argument is useful ? If it is not, I can rewrite this in 4-5 lines.

I do not think that it is useful, given that from the pair "PP,pt" there is not an "unique" resulting OA. So well, the function just creates a OA from a PP, and we cannot say much more.

Nathann


---

Comment by ncohen created at 2014-05-03 14:52:06

Changing status from needs_review to needs_info.


---

Comment by ncohen created at 2014-05-03 14:52:06

I added a commit that does that in public/16281

Nathann


---

Comment by vdelecroix created at 2014-05-03 15:13:31

The thing is that the pair (pp,pt) gives a unique stuff up to isomorphism if and only if the automorphism group of the pp acts enough transitively... it is the case for Desarguesian planes but I do not no yet for the others.


---

Comment by ncohen created at 2014-05-03 15:15:47

> The thing is that the pair (pp,pt) gives a unique stuff up to isomorphism if and only if the automorphism group of the pp acts enough transitively... it is the case for Desarguesian planes but I do not no yet for the others.

Do you think we could leave this for later, until somebody actually ... cares to compute this with Sage ?...

Nathann


---

Comment by ncohen created at 2014-05-03 15:44:22

new version in 10 minutes that leaves the feature.

Nathann


---

Comment by ncohen created at 2014-05-03 15:53:27

Here it is, in public/16281.

Nathann


---

Comment by vdelecroix created at 2014-05-03 16:51:02

Hi Nathann,

Looks cool like that. Thanks.

Is that ready to go?

Vincent


---

Comment by vdelecroix created at 2014-05-03 16:51:02

Changing status from needs_info to needs_review.


---

Comment by ncohen created at 2014-05-03 17:18:03

In your construction of the projective plane I do not understand what you mean by the coordinates, especially while reading the code.

A way to make it clearer would be to define the following functions. If you have another idea I really don't mind, I just want to understand the code `^^;`


```
pair_to_int = lambda x,y : relabel[x] + n*relabel[y]
infinity = lambda x : x + n2
```


This way we can read the code without trying to translate the coordinates `^^;`

Nathann


---

Comment by vdelecroix created at 2014-05-03 17:30:42

Hi,

The projective plane over a field is the set of equivalence classes of non-zero vectors `(x,y,z)` up to multiplication by a non-zero scalar. You can decompose the projective plane into:
- an affine plane: `(x,y,1)`
- an affine line "at infinity": `(x,1,0)`
- a point "at infinity": `(1,0,0)`
I would prefer the names

```
affine_plane   = lambda x,y : relabel[x] + n*relabel[y]
line_infinity  = lambda x : x + n2
point_infinity = n2 + n 
```

I am making it.

Vincent


---

Comment by ncohen created at 2014-05-03 17:31:58

Well, what I find confusing is that you give all these things 3 coordinates, and I do not see the point `O_o`

For me there are three kinds of points, one with two coordinates one with 1, and the last one.

Nathann


---

Comment by vdelecroix created at 2014-05-03 17:40:55

Three because of the definition I know... quotient out `K^3 \ {0}` by the positive scalar acting by multiplication. Then, you can manage to decompose into plane+line+point.

How about a HUGE comment as follows

```
# we decompose the points (x:y:z) of the projective space into an affine
# plane, an affine line and a point. At the same time, we relabel the points
# with the integers from 0 to n^2 + n. It is done as follows:
# the affine plane is the set of points (x:y:1) and gets relabeled
# from 0 to n^2-1
affine_plane   = lambda x,y: relabel[x] + n * relabel[y]
    
# the affine line is the set of points (x:1:0)
# and gets relabeld from n^2 to n^2 + n - 1
line_infinity  = lambda x: n2 + relabel[x]
    
# the point is (1:0:0)
# and gets relabeld n^2 + n
point_infinity = n2 + n

```



---

Comment by ncohen created at 2014-05-03 17:42:25

.......

Really, what force is making you define three coordinates for those points ? In which 3d space do they live ? `O_O`

Nathann


---

Comment by ncohen created at 2014-05-03 17:47:13

OOhhhhhhhhhh I see how you see it now... `T_T`

Well, I personally find  the explanation clearer without any mention of the 3d coordinates... But well, it's up to you.. Tastes, I guess `T_T`

Nathann


---

Comment by vdelecroix created at 2014-05-03 17:51:12

It is the [standard definition](http://en.wikipedia.org/wiki/Projective_space) of the projective plane: it is the set of vectorial lines in `K^3`. You need the coordinates to see which point is at infinity...


---

Comment by ncohen created at 2014-05-03 17:54:18

Defined as equivalence classes okay, but it stays abstract and you still have no coordinates. But then you say "I can either normalize the third coordinate if it is nonzero, otherwise I normalize the second coordinate,and if I can't I normalize the first".

Well... I am used to defined this thing with "three kinds of points" :-P

Anyway, if you can put this inside of the branch then no problem `:-)`

Nathann


---

Comment by vdelecroix created at 2014-05-03 18:01:59

here you go


---

Comment by git created at 2014-05-03 18:02:24

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2014-05-03 18:04:26

Oups: there is a warning in docbuild

```
.../block_design.py:docstring of sage.combinat.designs.block_design.projective_plane_to_OA:1: WARNING: Inline literal start-string without end-string.
```



---

Comment by ncohen created at 2014-05-03 18:06:07

Oh right. The ``` after pplane. Well, you can set this to `positive_review` after this is fixed. Thanks for this patch !

Nathann


---

Comment by git created at 2014-05-03 18:06:55

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2014-05-03 18:07:55

Changing status from needs_review to positive_review.


---

Comment by vdelecroix created at 2014-05-03 18:07:55

Great. Let's go back to #16272 and manage the merge...


---

Comment by ncohen created at 2014-05-03 18:09:05

Come ooooooooon. That will be easy.

Hey Vincent, I'm not sure I told you but it is great to work together on something. Stuff happens, gets merged and written. Much better than the usual "write a patch, then wait forever" `:-P`

Nathann


---

Comment by vbraun created at 2014-05-06 22:02:57

Resolution: fixed
