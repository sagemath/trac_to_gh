# Issue 12314: Add patchbot to Sage itself.

archive/issues_012314.json:
```json
{
    "body": "Assignee: mvngu\n\nCC:  @kini @dkrenn\n\nAnyone can run `sage --patchbot` to contribute.\n\nIssue created by migration from https://trac.sagemath.org/ticket/12486\n\n",
    "created_at": "2012-02-10T09:18:39Z",
    "labels": [
        "doctest",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.3",
    "title": "Add patchbot to Sage itself.",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12314",
    "user": "@robertwb"
}
```
Assignee: mvngu

CC:  @kini @dkrenn

Anyone can run `sage --patchbot` to contribute.

Issue created by migration from https://trac.sagemath.org/ticket/12486





---

archive/issue_comments_144875.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-02-10T09:26:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144875",
    "user": "@robertwb"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_144876.json:
```json
{
    "body": "Attachment [patchbot.patch](tarball://root/attachments/some-uuid/ticket12486/patchbot.patch) by @dandrake created at 2012-02-13 03:06:30\n\nnote that this doesn't apply to 5.0.beta3, since the `sage-sage` script has been deprecated. It looks like the relevant bit needs to be applied to `SAGE_ROOT/spkg/bin/sage` for 5.0.",
    "created_at": "2012-02-13T03:06:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144876",
    "user": "@dandrake"
}
```

Attachment [patchbot.patch](tarball://root/attachments/some-uuid/ticket12486/patchbot.patch) by @dandrake created at 2012-02-13 03:06:30

note that this doesn't apply to 5.0.beta3, since the `sage-sage` script has been deprecated. It looks like the relevant bit needs to be applied to `SAGE_ROOT/spkg/bin/sage` for 5.0.



---

archive/issue_comments_144877.json:
```json
{
    "body": "I split the original patch, since in 5.0, the `sage` script is tracked by the root repo.",
    "created_at": "2012-02-13T03:32:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144877",
    "user": "@dandrake"
}
```

I split the original patch, since in 5.0, the `sage` script is tracked by the root repo.



---

archive/issue_comments_144878.json:
```json
{
    "body": "We should document the patchbot. Something better than \"read the code\" and \"ask Robert on sage-devel\". This is now #12505.",
    "created_at": "2012-02-13T13:58:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144878",
    "user": "@dandrake"
}
```

We should document the patchbot. Something better than "read the code" and "ask Robert on sage-devel". This is now #12505.



---

archive/issue_comments_144879.json:
```json
{
    "body": "Attachment [patchbot-root-5.0.patch](tarball://root/attachments/some-uuid/ticket12486/patchbot-root-5.0.patch) by @dandrake created at 2012-02-15 02:14:32\n\nfor 5.0 series, apply to SAGE_ROOT repo",
    "created_at": "2012-02-15T02:14:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144879",
    "user": "@dandrake"
}
```

Attachment [patchbot-root-5.0.patch](tarball://root/attachments/some-uuid/ticket12486/patchbot-root-5.0.patch) by @dandrake created at 2012-02-15 02:14:32

for 5.0 series, apply to SAGE_ROOT repo



---

archive/issue_comments_144880.json:
```json
{
    "body": "New patches (1) remove trailing whitespace, (2) include ticket number in commit message, and (3) have proper node and parent IDs, so patchbot knows where to apply them. These changes were prompted by looking at the patchbot's logs for this ticket. :)",
    "created_at": "2012-02-15T02:16:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144880",
    "user": "@dandrake"
}
```

New patches (1) remove trailing whitespace, (2) include ticket number in commit message, and (3) have proper node and parent IDs, so patchbot knows where to apply them. These changes were prompted by looking at the patchbot's logs for this ticket. :)



---

archive/issue_comments_144881.json:
```json
{
    "body": "I tried this out (you'll see there are some results from `debian/squeeze/sid/x86_64/2.6.32-37-server/fermat` on the master patchbot server) and I got some strange behaviour. If you run the bot and give it a ticket number, with the ` --ticket ` command-line option, then it tests that ticket, but on finishing the test it gets stuck in an infinite loop of idling roundabout line 178 of patchbot.py (in particular, it never sends the test results back to the server). This is kind of annoying.",
    "created_at": "2012-03-10T14:05:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144881",
    "user": "@loefflerd"
}
```

I tried this out (you'll see there are some results from `debian/squeeze/sid/x86_64/2.6.32-37-server/fermat` on the master patchbot server) and I got some strange behaviour. If you run the bot and give it a ticket number, with the ` --ticket ` command-line option, then it tests that ticket, but on finishing the test it gets stuck in an infinite loop of idling roundabout line 178 of patchbot.py (in particular, it never sends the test results back to the server). This is kind of annoying.



---

archive/issue_comments_144882.json:
```json
{
    "body": "Sorry, the issue I reported the last time is a non-issue (you just have to wait a bit longer for the Tee background process to notice that it's finished). \n\nBut there is an amusing bug which I spotted when running a patchbot under 5.0.beta10. The function that compares version numbers just splits on \".\" and sorts alphabetically, and hence it thinks beta1 < beta10 < beta2! This caused a bunch of spurious \"Apply Failed\" warnings when it tried to apply patches from tickets that had already been merged (listed as dependencies of open tickets). See for example the first of the two runs for ticket #10527.\n\nThe fix is to add the lines\n\n\n```python\na = a.replace(\"beta\", \"beta.\")\nb = b.replace(\"beta\", \"beta.\")\n```\n\n\nto util.compare_versions.",
    "created_at": "2012-03-25T13:40:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144882",
    "user": "@loefflerd"
}
```

Sorry, the issue I reported the last time is a non-issue (you just have to wait a bit longer for the Tee background process to notice that it's finished). 

But there is an amusing bug which I spotted when running a patchbot under 5.0.beta10. The function that compares version numbers just splits on "." and sorts alphabetically, and hence it thinks beta1 < beta10 < beta2! This caused a bunch of spurious "Apply Failed" warnings when it tried to apply patches from tickets that had already been merged (listed as dependencies of open tickets). See for example the first of the two runs for ticket #10527.

The fix is to add the lines


```python
a = a.replace("beta", "beta.")
b = b.replace("beta", "beta.")
```


to util.compare_versions.



---

archive/issue_comments_144883.json:
```json
{
    "body": "for 5 .0 series, apply to scripts repo",
    "created_at": "2012-04-02T01:58:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144883",
    "user": "@dandrake"
}
```

for 5 .0 series, apply to scripts repo



---

archive/issue_comments_144884.json:
```json
{
    "body": "Attachment [patchbot-scripts-5.0.patch](tarball://root/attachments/some-uuid/ticket12486/patchbot-scripts-5.0.patch) by @dandrake created at 2012-04-02 01:59:49\n\nReplying to [comment:9 davidloeffler]:\n> The fix is to add the lines\n> \n> {{{\n> #!python\n> a = a.replace(\"beta\", \"beta.\")\n> b = b.replace(\"beta\", \"beta.\")\n> }}}\n> \n> to util.compare_versions.\n\nThe updated patch does that. (It also is a bit more strict about catching a `ValueError` when doing `int(s)`, which probably isn't a big deal, but it seems like a good idea.)",
    "created_at": "2012-04-02T01:59:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144884",
    "user": "@dandrake"
}
```

Attachment [patchbot-scripts-5.0.patch](tarball://root/attachments/some-uuid/ticket12486/patchbot-scripts-5.0.patch) by @dandrake created at 2012-04-02 01:59:49

Replying to [comment:9 davidloeffler]:
> The fix is to add the lines
> 
> {{{
> #!python
> a = a.replace("beta", "beta.")
> b = b.replace("beta", "beta.")
> }}}
> 
> to util.compare_versions.

The updated patch does that. (It also is a bit more strict about catching a `ValueError` when doing `int(s)`, which probably isn't a big deal, but it seems like a good idea.)



---

archive/issue_comments_144885.json:
```json
{
    "body": "Thanks. I noticed that too.",
    "created_at": "2012-05-03T07:08:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144885",
    "user": "@robertwb"
}
```

Thanks. I noticed that too.



---

archive/issue_comments_144886.json:
```json
{
    "body": "Since a while now, there is no requirement for the ticket number to be in the commit message, it's added automatically when merging in the standard format\n\n```\nTrac #12486: message from the patch file\n```\n",
    "created_at": "2012-05-30T15:21:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144886",
    "user": "@jdemeyer"
}
```

Since a while now, there is no requirement for the ticket number to be in the commit message, it's added automatically when merging in the standard format

```
Trac #12486: message from the patch file
```




---

archive/issue_comments_144887.json:
```json
{
    "body": "I noticed just now that on the buildbot arando, where I am running a patchbot on Sage 5.1.beta1, there were orphaned patchbot testing processes (i.e. instances of the python interpreter) left lying around, running things in `~/.sage/tmp/arando-*/`, of which many seemed to be named `maxima_abstract_*.py`, though there were several other filenames as well. These testing processes were not sleeping or waiting but running full steam, taking up most of arando's CPU time, so I killed them. I've noticed this happen once or twice before, as well.",
    "created_at": "2012-06-03T01:06:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144887",
    "user": "@kini"
}
```

I noticed just now that on the buildbot arando, where I am running a patchbot on Sage 5.1.beta1, there were orphaned patchbot testing processes (i.e. instances of the python interpreter) left lying around, running things in `~/.sage/tmp/arando-*/`, of which many seemed to be named `maxima_abstract_*.py`, though there were several other filenames as well. These testing processes were not sleeping or waiting but running full steam, taking up most of arando's CPU time, so I killed them. I've noticed this happen once or twice before, as well.



---

archive/issue_comments_144888.json:
```json
{
    "body": "kini: I'd love to know which ticket causes the maxima_abstract failures.",
    "created_at": "2012-06-03T08:44:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144888",
    "user": "@jdemeyer"
}
```

kini: I'd love to know which ticket causes the maxima_abstract failures.



---

archive/issue_comments_144889.json:
```json
{
    "body": "By the way: the \"Python keeps running after a doctest timeout\" bug is #11338.",
    "created_at": "2012-06-03T08:50:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144889",
    "user": "@jdemeyer"
}
```

By the way: the "Python keeps running after a doctest timeout" bug is #11338.



---

archive/issue_comments_144890.json:
```json
{
    "body": "\n```\n[2] patchbot@arando ~/.sage/tmp $ find | grep maxima_abstract | xargs grep \"^#.*devel/sage-\"\n./arando-13446/maxima_abstract_22717.py:# '/opt/patchbot-5.1.beta0/devel/sage-12214/sage/interfaces/maxima_abstract.py'.\n./arando-698/maxima_abstract_10001.py:# '/opt/patchbot-5.1.beta0/devel/sage-12120/sage/interfaces/maxima_abstract.py'.\n./arando-21967/maxima_abstract_10092.py:# '/opt/patchbot-5.1.beta0/devel/sage-12989/sage/interfaces/maxima_abstract.py'.\n./arando-25899/maxima_abstract_2742.py:# '/opt/patchbot-5.1.beta0/devel/sage-12298/sage/interfaces/maxima_abstract.py'.\n./arando-25577/maxima_abstract_13608.py:# '/opt/patchbot-5.1.beta0/devel/sage-6812/sage/interfaces/maxima_abstract.py'.\n./arando-7379/maxima_abstract_27734.py:# '/opt/patchbot-5.1.beta0/devel/sage-6812/sage/interfaces/maxima_abstract.py'.\n./arando-16948/maxima_abstract_3744.py:# '/opt/patchbot-5.1.beta1/devel/sage-12043/sage/interfaces/maxima_abstract.py'.\n./arando-5871/maxima_abstract_15144.py:# '/opt/patchbot-5.1.beta0/devel/sage-11726/sage/interfaces/maxima_abstract.py'.\n./arando-10252/maxima_abstract_30489.py:# '/opt/patchbot-5.1.beta0/devel/sage-12518/sage/interfaces/maxima_abstract.py'.\n./arando-25814/maxima_abstract_13608.py:# '/opt/patchbot-5.1.beta0/devel/sage-6812/sage/interfaces/maxima_abstract.py'.\n./arando-21669/maxima_abstract_30915.py:# '/opt/patchbot-5.0/devel/sage-2215/sage/interfaces/maxima_abstract.py'.\n./arando-3379/maxima_abstract_22614.py:# '/opt/patchbot-5.1.beta1/devel/sage-12251/sage/interfaces/maxima_abstract.py'.\n./arando-23007/maxima_abstract_11131.py:# '/opt/patchbot-5.1.beta0/devel/sage-12989/sage/interfaces/maxima_abstract.py'.\n./arando-7740/maxima_abstract_11922.py:# '/opt/patchbot-5.1.beta1/devel/sage-11930/sage/interfaces/maxima_abstract.py'.\n./arando-13364/maxima_abstract_22646.py:# '/opt/patchbot-5.1.beta0/devel/sage-11143/sage/interfaces/maxima_abstract.py'.\n./arando-12724/maxima_abstract_834.py:# '/opt/patchbot-5.1.beta0/devel/sage-12892/sage/interfaces/maxima_abstract.py'.\n./arando-20437/maxima_abstract_29714.py:# '/opt/patchbot-5.1.beta0/devel/sage-11895/sage/interfaces/maxima_abstract.py'.\n./arando-5929/maxima_abstract_15208.py:# '/opt/patchbot-5.1.beta0/devel/sage-12352/sage/interfaces/maxima_abstract.py'.\n./arando-4951/maxima_abstract_14224.py:# '/opt/patchbot-5.1.beta0/devel/sage-2215/sage/interfaces/maxima_abstract.py'.\n```\n\n\nI don't know how many of these are files that these stalled processes were running and how many are just other temp files that happened not to have been cleaned up - next time this happens I'll grep `ps` instead. (The ticket numbers are in the path names of the form `*devel/sage-*`, not of the form `./arando-*`.)",
    "created_at": "2012-06-03T19:02:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144890",
    "user": "@kini"
}
```


```
[2] patchbot@arando ~/.sage/tmp $ find | grep maxima_abstract | xargs grep "^#.*devel/sage-"
./arando-13446/maxima_abstract_22717.py:# '/opt/patchbot-5.1.beta0/devel/sage-12214/sage/interfaces/maxima_abstract.py'.
./arando-698/maxima_abstract_10001.py:# '/opt/patchbot-5.1.beta0/devel/sage-12120/sage/interfaces/maxima_abstract.py'.
./arando-21967/maxima_abstract_10092.py:# '/opt/patchbot-5.1.beta0/devel/sage-12989/sage/interfaces/maxima_abstract.py'.
./arando-25899/maxima_abstract_2742.py:# '/opt/patchbot-5.1.beta0/devel/sage-12298/sage/interfaces/maxima_abstract.py'.
./arando-25577/maxima_abstract_13608.py:# '/opt/patchbot-5.1.beta0/devel/sage-6812/sage/interfaces/maxima_abstract.py'.
./arando-7379/maxima_abstract_27734.py:# '/opt/patchbot-5.1.beta0/devel/sage-6812/sage/interfaces/maxima_abstract.py'.
./arando-16948/maxima_abstract_3744.py:# '/opt/patchbot-5.1.beta1/devel/sage-12043/sage/interfaces/maxima_abstract.py'.
./arando-5871/maxima_abstract_15144.py:# '/opt/patchbot-5.1.beta0/devel/sage-11726/sage/interfaces/maxima_abstract.py'.
./arando-10252/maxima_abstract_30489.py:# '/opt/patchbot-5.1.beta0/devel/sage-12518/sage/interfaces/maxima_abstract.py'.
./arando-25814/maxima_abstract_13608.py:# '/opt/patchbot-5.1.beta0/devel/sage-6812/sage/interfaces/maxima_abstract.py'.
./arando-21669/maxima_abstract_30915.py:# '/opt/patchbot-5.0/devel/sage-2215/sage/interfaces/maxima_abstract.py'.
./arando-3379/maxima_abstract_22614.py:# '/opt/patchbot-5.1.beta1/devel/sage-12251/sage/interfaces/maxima_abstract.py'.
./arando-23007/maxima_abstract_11131.py:# '/opt/patchbot-5.1.beta0/devel/sage-12989/sage/interfaces/maxima_abstract.py'.
./arando-7740/maxima_abstract_11922.py:# '/opt/patchbot-5.1.beta1/devel/sage-11930/sage/interfaces/maxima_abstract.py'.
./arando-13364/maxima_abstract_22646.py:# '/opt/patchbot-5.1.beta0/devel/sage-11143/sage/interfaces/maxima_abstract.py'.
./arando-12724/maxima_abstract_834.py:# '/opt/patchbot-5.1.beta0/devel/sage-12892/sage/interfaces/maxima_abstract.py'.
./arando-20437/maxima_abstract_29714.py:# '/opt/patchbot-5.1.beta0/devel/sage-11895/sage/interfaces/maxima_abstract.py'.
./arando-5929/maxima_abstract_15208.py:# '/opt/patchbot-5.1.beta0/devel/sage-12352/sage/interfaces/maxima_abstract.py'.
./arando-4951/maxima_abstract_14224.py:# '/opt/patchbot-5.1.beta0/devel/sage-2215/sage/interfaces/maxima_abstract.py'.
```


I don't know how many of these are files that these stalled processes were running and how many are just other temp files that happened not to have been cleaned up - next time this happens I'll grep `ps` instead. (The ticket numbers are in the path names of the form `*devel/sage-*`, not of the form `./arando-*`.)



---

archive/issue_comments_144891.json:
```json
{
    "body": "There is no logic behind this, too many independent tickets have this issue.",
    "created_at": "2012-06-03T19:08:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144891",
    "user": "@jdemeyer"
}
```

There is no logic behind this, too many independent tickets have this issue.



---

archive/issue_comments_144892.json:
```json
{
    "body": "Is there a way how \"state\" could be preserved across patchbot runs?  Could it happen that the patchbot tests ticket X and somehow ticket X has a bug causing failures in *following* tickets the patchbot tests?  Because it looks like this is happening here.\n\nI did 600 test runs of `maxima_abstract.py` on vanilla sage-5.1.beta2 and found no error.  Nobody has reported this bug on the mailing list and I haven't seen it on the buildbot with sage-5.1.beta2 or earlier.  So I conclude that the bug is introduced by a not-yet-merged ticket.\n\nSince it is extremely unlikely that all the tickets in kini's list above cause the same bug, the most logical explanation is that somehow one ticket corrupted further patchbot runs.",
    "created_at": "2012-06-05T12:20:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144892",
    "user": "@jdemeyer"
}
```

Is there a way how "state" could be preserved across patchbot runs?  Could it happen that the patchbot tests ticket X and somehow ticket X has a bug causing failures in *following* tickets the patchbot tests?  Because it looks like this is happening here.

I did 600 test runs of `maxima_abstract.py` on vanilla sage-5.1.beta2 and found no error.  Nobody has reported this bug on the mailing list and I haven't seen it on the buildbot with sage-5.1.beta2 or earlier.  So I conclude that the bug is introduced by a not-yet-merged ticket.

Since it is extremely unlikely that all the tickets in kini's list above cause the same bug, the most logical explanation is that somehow one ticket corrupted further patchbot runs.



---

archive/issue_comments_144893.json:
```json
{
    "body": "For the record, here is the verbose output of the failure:\n\n```\nsage -t --long --verbose \"devel/sage/sage/interfaces/maxima_abstract.py\"\n[...]\nTrying:\n    ~f###line 2304:_sage_    >>> ~f\nExpecting:\n    1/sin(x)\n**********************************************************************\nFile \"/padic/scratch/jdemeyer/merger/sage-5.1.beta3/devel/sage/sage/interfaces/maxima_abstract.py\", line ?, in __main__.example_81\nFailed example:\n    ~f###line 2304:_sage_    >>> ~f\nException raised:\n    Traceback (most recent call last):\n      File \"/padic/scratch/jdemeyer/merger/sage-5.1.beta3/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/padic/scratch/jdemeyer/merger/sage-5.1.beta3/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/padic/scratch/jdemeyer/merger/sage-5.1.beta3/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_81[3]>\", line 1, in <module>\n        ~f###line 2304:_sage_    >>> ~f\n      File \"element.pyx\", line 1833, in sage.structure.element.RingElement.__invert__ (sage/structure/element.c:13904)\n      File \"element.pyx\", line 1799, in sage.structure.element.RingElement.__div__ (sage/structure/element.c:13362)\n      File \"coerce.pyx\", line 744, in sage.structure.coerce.CoercionModel_cache_maps.bin_op (sage/structure/coerce.c:6704)\n      File \"coerce.pyx\", line 858, in sage.structure.coerce.CoercionModel_cache_maps.canonical_coercion (sage/structure/coerce.c:7892)\n      File \"map.pyx\", line 1282, in sage.categories.map.FormalCompositeMap._call_ (sage/categories/map.c:6190)\n      File \"morphism.pyx\", line 159, in sage.categories.morphism.CallMorphism._call_ (sage/categories/morphism.c:3080)\n      File \"/padic/scratch/jdemeyer/merger/sage-5.1.beta3/local/lib/python/site-packages/sage/interfaces/interface.py\", line 200, in __cal\nl__\n        return self._coerce_from_special_method(x)\n      File \"/padic/scratch/jdemeyer/merger/sage-5.1.beta3/local/lib/python/site-packages/sage/interfaces/interface.py\", line 226, in _coer\nce_from_special_method\n        return (x.__getattribute__(s))(self)\n      File \"sage_object.pyx\", line 527, in sage.structure.sage_object.SageObject._maxima_ (sage/structure/sage_object.c:5444)\n        This function may call the magma interpreter when it runs.\n      File \"sage_object.pyx\", line 439, in sage.structure.sage_object.SageObject._interface_ (sage/structure/sage_object.c:3684)\n        X = I(s)\n      File \"/padic/scratch/jdemeyer/merger/sage-5.1.beta3/local/lib/python/site-packages/sage/interfaces/interface.py\", line 198, in __call__\n        return cls(self, x, name=name)\n      File \"/padic/scratch/jdemeyer/merger/sage-5.1.beta3/local/lib/python/site-packages/sage/interfaces/maxima.py\", line 1155, in __init__\n        ExpectElement.__init__(self, parent, value, is_name=False, name=None)\n      File \"/padic/scratch/jdemeyer/merger/sage-5.1.beta3/local/lib/python/site-packages/sage/interfaces/expect.py\", line 1331, in __init__\n        self._name = parent._create(value, name=name)\n      File \"/padic/scratch/jdemeyer/merger/sage-5.1.beta3/local/lib/python/site-packages/sage/interfaces/interface.py\", line 388, in _create\n        self.set(name, value)\n      File \"/padic/scratch/jdemeyer/merger/sage-5.1.beta3/local/lib/python/site-packages/sage/interfaces/maxima.py\", line 1000, in set\n        self._eval_line(cmd)\n      File \"/padic/scratch/jdemeyer/merger/sage-5.1.beta3/local/lib/python/site-packages/sage/interfaces/maxima.py\", line 756, in _eval_line\n        assert line_echo.strip() == line.strip()\n    AssertionError\n[...]\n4 items had no tests:\n    __main__\n    __main__.change_warning_output\n    __main__.check_with_tolerance\n    __main__.warning_function\n85 items passed all tests:\n   3 tests in __main__.example_0\n   6 tests in __main__.example_1\n[...]\n   4 tests in __main__.example_43\n   4 tests in __main__.example_44\n   4 tests in __main__.example_45\n   4 tests in __main__.example_46\n   4 tesException RuntimeError: RuntimeError('maximum recursion depth exceeded while calling a Python object',) in  ignored\nException RuntimeError: RuntimeError('maximum recursion depth exceeded while calling a Python object',) in  ignored\nException RuntimeError: RuntimeError('maximum recursion depth exceeded while calling a Python object',) in  ignored\nException RuntimeError: RuntimeError('maximum recursion depth exceeded while calling a Python object',) in  ignored\nException RuntimeError: RuntimeError('maximum recursion depth exceeded while calling a Python object',) in  ignored\nException RuntimeError: RuntimeError('maximum recursion depth exceeded while calling a Python object',) in  ignored\n[...goes on forever until killed...]\n```\n",
    "created_at": "2012-06-05T12:23:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144893",
    "user": "@jdemeyer"
}
```

For the record, here is the verbose output of the failure:

```
sage -t --long --verbose "devel/sage/sage/interfaces/maxima_abstract.py"
[...]
Trying:
    ~f###line 2304:_sage_    >>> ~f
Expecting:
    1/sin(x)
**********************************************************************
File "/padic/scratch/jdemeyer/merger/sage-5.1.beta3/devel/sage/sage/interfaces/maxima_abstract.py", line ?, in __main__.example_81
Failed example:
    ~f###line 2304:_sage_    >>> ~f
Exception raised:
    Traceback (most recent call last):
      File "/padic/scratch/jdemeyer/merger/sage-5.1.beta3/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/padic/scratch/jdemeyer/merger/sage-5.1.beta3/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/padic/scratch/jdemeyer/merger/sage-5.1.beta3/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_81[3]>", line 1, in <module>
        ~f###line 2304:_sage_    >>> ~f
      File "element.pyx", line 1833, in sage.structure.element.RingElement.__invert__ (sage/structure/element.c:13904)
      File "element.pyx", line 1799, in sage.structure.element.RingElement.__div__ (sage/structure/element.c:13362)
      File "coerce.pyx", line 744, in sage.structure.coerce.CoercionModel_cache_maps.bin_op (sage/structure/coerce.c:6704)
      File "coerce.pyx", line 858, in sage.structure.coerce.CoercionModel_cache_maps.canonical_coercion (sage/structure/coerce.c:7892)
      File "map.pyx", line 1282, in sage.categories.map.FormalCompositeMap._call_ (sage/categories/map.c:6190)
      File "morphism.pyx", line 159, in sage.categories.morphism.CallMorphism._call_ (sage/categories/morphism.c:3080)
      File "/padic/scratch/jdemeyer/merger/sage-5.1.beta3/local/lib/python/site-packages/sage/interfaces/interface.py", line 200, in __cal
l__
        return self._coerce_from_special_method(x)
      File "/padic/scratch/jdemeyer/merger/sage-5.1.beta3/local/lib/python/site-packages/sage/interfaces/interface.py", line 226, in _coer
ce_from_special_method
        return (x.__getattribute__(s))(self)
      File "sage_object.pyx", line 527, in sage.structure.sage_object.SageObject._maxima_ (sage/structure/sage_object.c:5444)
        This function may call the magma interpreter when it runs.
      File "sage_object.pyx", line 439, in sage.structure.sage_object.SageObject._interface_ (sage/structure/sage_object.c:3684)
        X = I(s)
      File "/padic/scratch/jdemeyer/merger/sage-5.1.beta3/local/lib/python/site-packages/sage/interfaces/interface.py", line 198, in __call__
        return cls(self, x, name=name)
      File "/padic/scratch/jdemeyer/merger/sage-5.1.beta3/local/lib/python/site-packages/sage/interfaces/maxima.py", line 1155, in __init__
        ExpectElement.__init__(self, parent, value, is_name=False, name=None)
      File "/padic/scratch/jdemeyer/merger/sage-5.1.beta3/local/lib/python/site-packages/sage/interfaces/expect.py", line 1331, in __init__
        self._name = parent._create(value, name=name)
      File "/padic/scratch/jdemeyer/merger/sage-5.1.beta3/local/lib/python/site-packages/sage/interfaces/interface.py", line 388, in _create
        self.set(name, value)
      File "/padic/scratch/jdemeyer/merger/sage-5.1.beta3/local/lib/python/site-packages/sage/interfaces/maxima.py", line 1000, in set
        self._eval_line(cmd)
      File "/padic/scratch/jdemeyer/merger/sage-5.1.beta3/local/lib/python/site-packages/sage/interfaces/maxima.py", line 756, in _eval_line
        assert line_echo.strip() == line.strip()
    AssertionError
[...]
4 items had no tests:
    __main__
    __main__.change_warning_output
    __main__.check_with_tolerance
    __main__.warning_function
85 items passed all tests:
   3 tests in __main__.example_0
   6 tests in __main__.example_1
[...]
   4 tests in __main__.example_43
   4 tests in __main__.example_44
   4 tests in __main__.example_45
   4 tests in __main__.example_46
   4 tesException RuntimeError: RuntimeError('maximum recursion depth exceeded while calling a Python object',) in  ignored
Exception RuntimeError: RuntimeError('maximum recursion depth exceeded while calling a Python object',) in  ignored
Exception RuntimeError: RuntimeError('maximum recursion depth exceeded while calling a Python object',) in  ignored
Exception RuntimeError: RuntimeError('maximum recursion depth exceeded while calling a Python object',) in  ignored
Exception RuntimeError: RuntimeError('maximum recursion depth exceeded while calling a Python object',) in  ignored
Exception RuntimeError: RuntimeError('maximum recursion depth exceeded while calling a Python object',) in  ignored
[...goes on forever until killed...]
```




---

archive/issue_comments_144894.json:
```json
{
    "body": "This bug is now prominently in my top 3 of \"weirdest Sage bugs I encountered as release manager\", together with #12221 and #10609.",
    "created_at": "2012-06-05T12:27:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144894",
    "user": "@jdemeyer"
}
```

This bug is now prominently in my top 3 of "weirdest Sage bugs I encountered as release manager", together with #12221 and #10609.



---

archive/issue_comments_144895.json:
```json
{
    "body": "My desktop does about 10 tickets/hour, each of which adds a `$SAGE_ROOT/devel/sage-<ticket>` directory of about 330MB. Is there a reason why the patchbot does not delete these? It kind of adds up, we are talking about >50 GB per day. Or should I get another harddisk to run the patchbot on?\n\nAbout the `maxima_abstract.py` error, I never observed it here. It might be a 32-bit issue (I'm running Fedora 17 x86_64). Although perhaps far-fetched, there is another bug where the sage-maxima interface goes into an infinite recursion (#13097).\n\nEven with these issues I'd be in favor of merging this ticket. Its useful functionality and it works for most. We can polish it in a follow-up ticket.",
    "created_at": "2012-06-10T11:58:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144895",
    "user": "@vbraun"
}
```

My desktop does about 10 tickets/hour, each of which adds a `$SAGE_ROOT/devel/sage-<ticket>` directory of about 330MB. Is there a reason why the patchbot does not delete these? It kind of adds up, we are talking about >50 GB per day. Or should I get another harddisk to run the patchbot on?

About the `maxima_abstract.py` error, I never observed it here. It might be a 32-bit issue (I'm running Fedora 17 x86_64). Although perhaps far-fetched, there is another bug where the sage-maxima interface goes into an infinite recursion (#13097).

Even with these issues I'd be in favor of merging this ticket. Its useful functionality and it works for most. We can polish it in a follow-up ticket.



---

archive/issue_comments_144896.json:
```json
{
    "body": "The patchbot deletes tickets directories when they are closed. It might be worth having an option to delete them after every run, but then a full re-clone and re-build would be required to test any additional patches (expensive). \n\nAs for space, all the build and .c files are hard linked from sage-main (unless they're changed), so the aggregate use of the directories is about 100MB each ticket (not each run). Even if we got up to, say, 500 open tickets you are looking at a stead state of 50GB total, not per day. \n\nIt will only apply patches to the sage-main tree, which it re-clones for every ticket, but the doctests and code itself could do anything, so one can't rule out any global state (though if there it's both strange and a bug).\n\nI'm all in favor of getting this in and iterating on it there. I made some minor changes and will try to refresh these patches shortly.",
    "created_at": "2012-06-11T19:03:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144896",
    "user": "@robertwb"
}
```

The patchbot deletes tickets directories when they are closed. It might be worth having an option to delete them after every run, but then a full re-clone and re-build would be required to test any additional patches (expensive). 

As for space, all the build and .c files are hard linked from sage-main (unless they're changed), so the aggregate use of the directories is about 100MB each ticket (not each run). Even if we got up to, say, 500 open tickets you are looking at a stead state of 50GB total, not per day. 

It will only apply patches to the sage-main tree, which it re-clones for every ticket, but the doctests and code itself could do anything, so one can't rule out any global state (though if there it's both strange and a bug).

I'm all in favor of getting this in and iterating on it there. I made some minor changes and will try to refresh these patches shortly.



---

archive/issue_comments_144897.json:
```json
{
    "body": "My patchbot processed 236 tickets so far and I'm at 80 gigabytes:\n\n```\n[patchbot@volker-desktop sage-5.1.beta3]$ du -sh .\n79G\t.\n[patchbot@volker-desktop sage-5.1.beta3]$ mount | grep /home\n/dev/sdc1 on /home type ext4 (rw,relatime,seclabel,data=ordered)\n```\n\nThats already accounting for hardlinks, `du` is smart enough to only count the linked file once. Turning this off (and overcounting) yields\n\n```\n[patchbot@volker-desktop sage-5.1.beta3]$ du -shl .\n336G\t.\n```\n\nSo it should probably stop just below 100G, still acceptable I think.",
    "created_at": "2012-06-11T19:14:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144897",
    "user": "@vbraun"
}
```

My patchbot processed 236 tickets so far and I'm at 80 gigabytes:

```
[patchbot@volker-desktop sage-5.1.beta3]$ du -sh .
79G	.
[patchbot@volker-desktop sage-5.1.beta3]$ mount | grep /home
/dev/sdc1 on /home type ext4 (rw,relatime,seclabel,data=ordered)
```

Thats already accounting for hardlinks, `du` is smart enough to only count the linked file once. Turning this off (and overcounting) yields

```
[patchbot@volker-desktop sage-5.1.beta3]$ du -shl .
336G	.
```

So it should probably stop just below 100G, still acceptable I think.



---

archive/issue_comments_144898.json:
```json
{
    "body": "Hmm... that is quite a bit more than I'd expect. Certainly keeping only the most recently used N tickets would be an improvement, but between moving to git and cycache and ccache it will become irrelevant (one would simply specify the desired cache size) and 100G isn't overkill these days.",
    "created_at": "2012-06-11T19:54:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144898",
    "user": "@robertwb"
}
```

Hmm... that is quite a bit more than I'd expect. Certainly keeping only the most recently used N tickets would be an improvement, but between moving to git and cycache and ccache it will become irrelevant (one would simply specify the desired cache size) and 100G isn't overkill these days.



---

archive/issue_comments_144899.json:
```json
{
    "body": "My experience with running patchbot has been that many tickets (notably those that add new modules to the reference manual) do seem to pollute the global state, particularly for documentation building purposes, where the docbuild log for running patchbot on ticket X will start complaining that it can't find a file that is added in some other ticket Y that it previously tested. (I think this is because the `sage-clone` script hard-links the Sphinx environment pickle.)\n\nMoreover, even without \"cross-branch contamination\", adding source files and then removing them tends to leave junk in the Sage build tree. Thus the patchbot isn't really doing its job properly, of simulating the effect of applying the latest set of patches to a clean copy of Sage. So I found it preferable to fiddle with the patchbot `test_a_ticket` code such that it always made a new branch, then deleted it afterwards.",
    "created_at": "2012-06-12T07:25:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144899",
    "user": "@loefflerd"
}
```

My experience with running patchbot has been that many tickets (notably those that add new modules to the reference manual) do seem to pollute the global state, particularly for documentation building purposes, where the docbuild log for running patchbot on ticket X will start complaining that it can't find a file that is added in some other ticket Y that it previously tested. (I think this is because the `sage-clone` script hard-links the Sphinx environment pickle.)

Moreover, even without "cross-branch contamination", adding source files and then removing them tends to leave junk in the Sage build tree. Thus the patchbot isn't really doing its job properly, of simulating the effect of applying the latest set of patches to a clean copy of Sage. So I found it preferable to fiddle with the patchbot `test_a_ticket` code such that it always made a new branch, then deleted it afterwards.



---

archive/issue_comments_144900.json:
```json
{
    "body": "Well, this is a defect in sage -clone (which should hopefully go away with git). I'm not quite sure how \n\n\n```\nsage -clone ticket\n[test ticket]\nsage -b main\nsage -clone newticket\n```\n\n\nwould have different behavior from \n\n\n```\nsage -clone ticket\n[test ticket]\nsage -b main\nrm -rf /path/to/deve/sage-ticket\nsage -clone newticket\n```\n\n\nthough I have seen issues with the build directory getting messed up when files are added and then removed.",
    "created_at": "2012-06-12T09:16:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144900",
    "user": "@robertwb"
}
```

Well, this is a defect in sage -clone (which should hopefully go away with git). I'm not quite sure how 


```
sage -clone ticket
[test ticket]
sage -b main
sage -clone newticket
```


would have different behavior from 


```
sage -clone ticket
[test ticket]
sage -b main
rm -rf /path/to/deve/sage-ticket
sage -clone newticket
```


though I have seen issues with the build directory getting messed up when files are added and then removed.



---

archive/issue_comments_144901.json:
```json
{
    "body": "With the updated patch I get:\n\n```\n[patchbot@volker-desktop sage-5.1.beta3]$ ./sage -patchbot\n/home/patchbot/Sage/sage-5.1.beta3/spkg/bin/sage: line 877: /home/patchbot/Sage/sage-5.1.beta3/local/bin/patchbot/patchbot.py: Permission denied\n```\n\nManually changing the permission works.",
    "created_at": "2012-06-13T12:38:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144901",
    "user": "@vbraun"
}
```

With the updated patch I get:

```
[patchbot@volker-desktop sage-5.1.beta3]$ ./sage -patchbot
/home/patchbot/Sage/sage-5.1.beta3/spkg/bin/sage: line 877: /home/patchbot/Sage/sage-5.1.beta3/local/bin/patchbot/patchbot.py: Permission denied
```

Manually changing the permission works.



---

archive/issue_comments_144902.json:
```json
{
    "body": "Attachment [12486-patchbot-scripts-5.0-updated.patch](tarball://root/attachments/some-uuid/ticket12486/12486-patchbot-scripts-5.0-updated.patch) by @kini created at 2012-06-21 19:25:05\n\napply to $SAGE_LOCAL/bin",
    "created_at": "2012-06-21T19:25:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144902",
    "user": "@kini"
}
```

Attachment [12486-patchbot-scripts-5.0-updated.patch](tarball://root/attachments/some-uuid/ticket12486/12486-patchbot-scripts-5.0-updated.patch) by @kini created at 2012-06-21 19:25:05

apply to $SAGE_LOCAL/bin



---

archive/issue_comments_144903.json:
```json
{
    "body": "Replying to [comment:29 vbraun]:\n> With the updated patch I get:\n> {{{\n> [patchbot`@`volker-desktop sage-5.1.beta3]$ ./sage -patchbot\n> /home/patchbot/Sage/sage-5.1.beta3/spkg/bin/sage: line 877: /home/patchbot/Sage/sage-5.1.beta3/local/bin/patchbot/patchbot.py: Permission denied\n> }}}\n> Manually changing the permission works.\n\nI updated the patch.",
    "created_at": "2012-06-21T19:25:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144903",
    "user": "@kini"
}
```

Replying to [comment:29 vbraun]:
> With the updated patch I get:
> {{{
> [patchbot`@`volker-desktop sage-5.1.beta3]$ ./sage -patchbot
> /home/patchbot/Sage/sage-5.1.beta3/spkg/bin/sage: line 877: /home/patchbot/Sage/sage-5.1.beta3/local/bin/patchbot/patchbot.py: Permission denied
> }}}
> Manually changing the permission works.

I updated the patch.



---

archive/issue_comments_144904.json:
```json
{
    "body": "Hah - patchbot gives its own code a green circle despite there being no patches for the Sage library :)",
    "created_at": "2012-06-21T20:33:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144904",
    "user": "@kini"
}
```

Hah - patchbot gives its own code a green circle despite there being no patches for the Sage library :)



---

archive/issue_comments_144905.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-06-25T14:59:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144905",
    "user": "@vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_144906.json:
```json
{
    "body": "Looks good to me! \n\nThe perfect is the enemy of the good.",
    "created_at": "2012-06-25T14:59:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144906",
    "user": "@vbraun"
}
```

Looks good to me! 

The perfect is the enemy of the good.



---

archive/issue_comments_144907.json:
```json
{
    "body": "On arando I am consistently getting a doctest failure in devel/sage-0/sage/rings/finite_rings/integer_mod.pyx when the patchbot first starts up and tests a vanilla Sage. When I doctest that particular file manually, there are no failures. Even when I run `make ptestlong`, there is no failure. But if I run `sage --patchbot`, it fails on that file. This has been happening since 5.1.beta5, as far as I can tell.",
    "created_at": "2012-06-26T02:55:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144907",
    "user": "@kini"
}
```

On arando I am consistently getting a doctest failure in devel/sage-0/sage/rings/finite_rings/integer_mod.pyx when the patchbot first starts up and tests a vanilla Sage. When I doctest that particular file manually, there are no failures. Even when I run `make ptestlong`, there is no failure. But if I run `sage --patchbot`, it fails on that file. This has been happening since 5.1.beta5, as far as I can tell.



---

archive/issue_comments_144908.json:
```json
{
    "body": "I tried it again while redirecting stdout to a text file which I later searched. The actual failure is apparently this:\n\n\n```\nsage -t  -force_lib devel/sage-0/sage/rings/finite_rings/integer_mod.pyx\n**********************************************************************\nFile \"/opt/patchbot-5.1.beta6/devel/sage-0/sage/rings/finite_rings/integer_mod.pyx\", line 2855:\n    sage: mod(5,13^5) == mod(5,13)                                                       \nExpected:\n    True\nGot:\n    False\n**********************************************************************\n1 items had failures:\n   1 of   8 in __main__.example_88\n***Test Failed*** 1 failures.\n```\n",
    "created_at": "2012-06-26T06:09:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144908",
    "user": "@kini"
}
```

I tried it again while redirecting stdout to a text file which I later searched. The actual failure is apparently this:


```
sage -t  -force_lib devel/sage-0/sage/rings/finite_rings/integer_mod.pyx
**********************************************************************
File "/opt/patchbot-5.1.beta6/devel/sage-0/sage/rings/finite_rings/integer_mod.pyx", line 2855:
    sage: mod(5,13^5) == mod(5,13)                                                       
Expected:
    True
Got:
    False
**********************************************************************
1 items had failures:
   1 of   8 in __main__.example_88
***Test Failed*** 1 failures.
```




---

archive/issue_comments_144909.json:
```json
{
    "body": "Keshav: Try `make ptest` or `sage -tp <n> $SAGE_ROOT/devel/sage` to test multiple files and see if you can reproduce it. The patchbot doesn't do anything different.",
    "created_at": "2012-06-27T17:06:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144909",
    "user": "@vbraun"
}
```

Keshav: Try `make ptest` or `sage -tp <n> $SAGE_ROOT/devel/sage` to test multiple files and see if you can reproduce it. The patchbot doesn't do anything different.



---

archive/issue_comments_144910.json:
```json
{
    "body": "I've tried this three or four times with the patchbot and three or four times with `make ptestlong`, and of these trials all the patchbot runs end with this failure, and all the `make ptestlong`s pass all doctests. I'm trying again now with a plain `make ptest` (without the long doctests).",
    "created_at": "2012-06-27T17:42:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144910",
    "user": "@kini"
}
```

I've tried this three or four times with the patchbot and three or four times with `make ptestlong`, and of these trials all the patchbot runs end with this failure, and all the `make ptestlong`s pass all doctests. I'm trying again now with a plain `make ptest` (without the long doctests).



---

archive/issue_comments_144911.json:
```json
{
    "body": "Yup, no errors with `make ptest`. Now trying `sage --patchbot` again for about the fifth time :)",
    "created_at": "2012-06-29T03:48:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144911",
    "user": "@kini"
}
```

Yup, no errors with `make ptest`. Now trying `sage --patchbot` again for about the fifth time :)



---

archive/issue_comments_144912.json:
```json
{
    "body": "May I remind you about my feature request for \"patchbot log grepping\": given a doctest error, I would like to find out whether the patchbot has seen that failure and which ticket caused it.",
    "created_at": "2012-06-29T06:47:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144912",
    "user": "@jdemeyer"
}
```

May I remind you about my feature request for "patchbot log grepping": given a doctest error, I would like to find out whether the patchbot has seen that failure and which ticket caused it.



---

archive/issue_comments_144913.json:
```json
{
    "body": "`sage --patchbot` fails again on the same file. I think it's pretty clear that this is only happening when the patchbot runs the tests, though I can't imagine why. Is it worth setting the ticket to needs_work? Can anyone else reproduce this? (Try a 32-bit machine, I suppose...)",
    "created_at": "2012-06-29T06:52:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144913",
    "user": "@kini"
}
```

`sage --patchbot` fails again on the same file. I think it's pretty clear that this is only happening when the patchbot runs the tests, though I can't imagine why. Is it worth setting the ticket to needs_work? Can anyone else reproduce this? (Try a 32-bit machine, I suppose...)



---

archive/issue_comments_144914.json:
```json
{
    "body": "The patchbot just runs `sage -t`, its probably something in the doctesting framework that needs fixing. There is also the new doctesting framework at http://trac.sagemath.org/12415, maybe that'll fix it? In any case that discussion belongs to a different ticket. \n\nSame for feature requests, Jeroen ;-)",
    "created_at": "2012-06-29T12:12:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144914",
    "user": "@vbraun"
}
```

The patchbot just runs `sage -t`, its probably something in the doctesting framework that needs fixing. There is also the new doctesting framework at http://trac.sagemath.org/12415, maybe that'll fix it? In any case that discussion belongs to a different ticket. 

Same for feature requests, Jeroen ;-)



---

archive/issue_comments_144915.json:
```json
{
    "body": "It seems that `sage-make_devel_packages` (I guess) needs to be updated, the `patchbot` files in `local/bin` are not picked up by `sage-sdist`.",
    "created_at": "2012-06-29T16:01:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144915",
    "user": "@jdemeyer"
}
```

It seems that `sage-make_devel_packages` (I guess) needs to be updated, the `patchbot` files in `local/bin` are not picked up by `sage-sdist`.



---

archive/issue_comments_144916.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2012-06-29T16:01:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144916",
    "user": "@jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_144917.json:
```json
{
    "body": "Replying to [comment:39 jdemeyer]:\n> May I remind you about my feature request for \"patchbot log grepping\": given a doctest error, I would like to find out whether the patchbot has seen that failure and which ticket caused it.\n\nYes, that would be nice. At the moment my energies are focused on (finally) trying to just get this in.",
    "created_at": "2012-07-01T05:12:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144917",
    "user": "@robertwb"
}
```

Replying to [comment:39 jdemeyer]:
> May I remind you about my feature request for "patchbot log grepping": given a doctest error, I would like to find out whether the patchbot has seen that failure and which ticket caused it.

Yes, that would be nice. At the moment my energies are focused on (finally) trying to just get this in.



---

archive/issue_comments_144918.json:
```json
{
    "body": "Replying to [comment:40 kini]:\n> `sage --patchbot` fails again on the same file. I think it's pretty clear that this is only happening when the patchbot runs the tests, though I can't imagine why. Is it worth setting the ticket to needs_work? Can anyone else reproduce this? (Try a 32-bit machine, I suppose...)\n\nI have no idea, but unless this is reproducible by others I don't think this should block it getting in.",
    "created_at": "2012-07-01T05:14:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144918",
    "user": "@robertwb"
}
```

Replying to [comment:40 kini]:
> `sage --patchbot` fails again on the same file. I think it's pretty clear that this is only happening when the patchbot runs the tests, though I can't imagine why. Is it worth setting the ticket to needs_work? Can anyone else reproduce this? (Try a 32-bit machine, I suppose...)

I have no idea, but unless this is reproducible by others I don't think this should block it getting in.



---

archive/issue_comments_144919.json:
```json
{
    "body": "I agree. Volker actually told me on IRC that he couldn't reproduce it on a 32-bit VM, so it must be something peculiar to arando.",
    "created_at": "2012-07-01T05:16:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144919",
    "user": "@kini"
}
```

I agree. Volker actually told me on IRC that he couldn't reproduce it on a 32-bit VM, so it must be something peculiar to arando.



---

archive/issue_comments_144920.json:
```json
{
    "body": "Indeed, it's very strange, as it's just running the same sage -t in a subshell.",
    "created_at": "2012-07-01T05:29:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144920",
    "user": "@robertwb"
}
```

Indeed, it's very strange, as it's just running the same sage -t in a subshell.



---

archive/issue_comments_144921.json:
```json
{
    "body": "Apply to $SAGE_LOCAL/bin.",
    "created_at": "2012-07-01T05:31:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144921",
    "user": "@robertwb"
}
```

Apply to $SAGE_LOCAL/bin.



---

archive/issue_comments_144922.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-07-01T05:32:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144922",
    "user": "@robertwb"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_144923.json:
```json
{
    "body": "Attachment [12486-fix-sdist.patch](tarball://root/attachments/some-uuid/ticket12486/12486-fix-sdist.patch) by @robertwb created at 2012-07-01 05:32:48\n\nWow, such ugliness here. I can't wait until we're set up with a unified repository...",
    "created_at": "2012-07-01T05:32:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144923",
    "user": "@robertwb"
}
```

Attachment [12486-fix-sdist.patch](tarball://root/attachments/some-uuid/ticket12486/12486-fix-sdist.patch) by @robertwb created at 2012-07-01 05:32:48

Wow, such ugliness here. I can't wait until we're set up with a unified repository...



---

archive/issue_comments_144924.json:
```json
{
    "body": "For the record, this is the 32-bit test VM passing the test: http://patchbot.sagemath.org/ticket/?machine=Fedora/16/i686/3.4.2-1.fc16.i686.PAE/sagevm&status=open In any case, this should not block the patchbot ticket going forward.\n\nI noticed that `$DOT_SAGE/cache` contains a file `$SAGE_ROOT-$PID-lazy_import_cache.pickle` that seems to be not cleaned up by the sage cleaner. So over time the patchbot will fill it with 32k files, one per possible pid. Not terrible, but could be nicer. Should probably be fixed in the sage-cleaner, though.\n\nRunning the patchbot for a long time seems to leak file descriptors for a pseudoterminal, after a few days I have\n\n```\n[root@volker-desktop 2040]# ps -p 2040 u\nUSER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND\npatchbot  2040  0.0  0.3 301676 99940 pts/2    S+   Jun30   0:57 python /mnt/storage2TB/patchbot/Sage/sage-5.1.rc0/local/bin/patchbot/patchbot.py\n[root@volker-desktop 2040]# ls -alv /proc/2040/fd/*\nlrwx------. 1 patchbot patchbot 64 Jul  1 12:54 /proc/2040/fd/0 -> /dev/pts/2\nl-wx------. 1 patchbot patchbot 64 Jul  1 12:54 /proc/2040/fd/1 -> pipe:[3598117]\nl-wx------. 1 patchbot patchbot 64 Jul  1 12:54 /proc/2040/fd/2 -> pipe:[3598117]\nlrwx------. 1 patchbot patchbot 64 Jul  1 12:54 /proc/2040/fd/3 -> /dev/pts/2\nlrwx------. 1 patchbot patchbot 64 Jul  1 12:54 /proc/2040/fd/4 -> /dev/pts/2\nlrwx------. 1 patchbot patchbot 64 Jul  1 12:54 /proc/2040/fd/5 -> /dev/pts/2\nlrwx------. 1 patchbot patchbot 64 Jul  1 12:54 /proc/2040/fd/6 -> /dev/pts/2\nlrwx------. 1 patchbot patchbot 64 Jul  1 12:54 /proc/2040/fd/7 -> /dev/pts/2\nlrwx------. 1 patchbot patchbot 64 Jul  1 12:54 /proc/2040/fd/8 -> /dev/pts/2\n[...]\nlrwx------. 1 patchbot patchbot 64 Jul  1 12:54 /proc/2040/fd/319 -> /dev/pts/2\nlrwx------. 1 patchbot patchbot 64 Jul  1 12:54 /proc/2040/fd/320 -> /dev/pts/2\nlrwx------. 1 patchbot patchbot 64 Jul  1 13:14 /proc/2040/fd/321 -> /dev/pts/2\nlrwx------. 1 patchbot patchbot 64 Jul  1 12:54 /proc/2040/fd/322 -> /dev/pts/2\nlrwx------. 1 patchbot patchbot 64 Jul  1 12:54 /proc/2040/fd/323 -> /dev/pts/2\nlrwx------. 1 patchbot patchbot 64 Jul  1 12:54 /proc/2040/fd/324 -> /dev/pts/2\nlrwx------. 1 patchbot patchbot 64 Jul  1 13:16 /proc/2040/fd/325 -> /dev/pts/2\nlrwx------. 1 patchbot patchbot 64 Jul  1 13:16 /proc/2040/fd/326 -> /dev/pts/2\nl-wx------. 1 patchbot patchbot 64 Jul  1 13:16 /proc/2040/fd/328 -> pipe:[3598117]\n```\n",
    "created_at": "2012-07-01T12:26:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144924",
    "user": "@vbraun"
}
```

For the record, this is the 32-bit test VM passing the test: http://patchbot.sagemath.org/ticket/?machine=Fedora/16/i686/3.4.2-1.fc16.i686.PAE/sagevm&status=open In any case, this should not block the patchbot ticket going forward.

I noticed that `$DOT_SAGE/cache` contains a file `$SAGE_ROOT-$PID-lazy_import_cache.pickle` that seems to be not cleaned up by the sage cleaner. So over time the patchbot will fill it with 32k files, one per possible pid. Not terrible, but could be nicer. Should probably be fixed in the sage-cleaner, though.

Running the patchbot for a long time seems to leak file descriptors for a pseudoterminal, after a few days I have

```
[root@volker-desktop 2040]# ps -p 2040 u
USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
patchbot  2040  0.0  0.3 301676 99940 pts/2    S+   Jun30   0:57 python /mnt/storage2TB/patchbot/Sage/sage-5.1.rc0/local/bin/patchbot/patchbot.py
[root@volker-desktop 2040]# ls -alv /proc/2040/fd/*
lrwx------. 1 patchbot patchbot 64 Jul  1 12:54 /proc/2040/fd/0 -> /dev/pts/2
l-wx------. 1 patchbot patchbot 64 Jul  1 12:54 /proc/2040/fd/1 -> pipe:[3598117]
l-wx------. 1 patchbot patchbot 64 Jul  1 12:54 /proc/2040/fd/2 -> pipe:[3598117]
lrwx------. 1 patchbot patchbot 64 Jul  1 12:54 /proc/2040/fd/3 -> /dev/pts/2
lrwx------. 1 patchbot patchbot 64 Jul  1 12:54 /proc/2040/fd/4 -> /dev/pts/2
lrwx------. 1 patchbot patchbot 64 Jul  1 12:54 /proc/2040/fd/5 -> /dev/pts/2
lrwx------. 1 patchbot patchbot 64 Jul  1 12:54 /proc/2040/fd/6 -> /dev/pts/2
lrwx------. 1 patchbot patchbot 64 Jul  1 12:54 /proc/2040/fd/7 -> /dev/pts/2
lrwx------. 1 patchbot patchbot 64 Jul  1 12:54 /proc/2040/fd/8 -> /dev/pts/2
[...]
lrwx------. 1 patchbot patchbot 64 Jul  1 12:54 /proc/2040/fd/319 -> /dev/pts/2
lrwx------. 1 patchbot patchbot 64 Jul  1 12:54 /proc/2040/fd/320 -> /dev/pts/2
lrwx------. 1 patchbot patchbot 64 Jul  1 13:14 /proc/2040/fd/321 -> /dev/pts/2
lrwx------. 1 patchbot patchbot 64 Jul  1 12:54 /proc/2040/fd/322 -> /dev/pts/2
lrwx------. 1 patchbot patchbot 64 Jul  1 12:54 /proc/2040/fd/323 -> /dev/pts/2
lrwx------. 1 patchbot patchbot 64 Jul  1 12:54 /proc/2040/fd/324 -> /dev/pts/2
lrwx------. 1 patchbot patchbot 64 Jul  1 13:16 /proc/2040/fd/325 -> /dev/pts/2
lrwx------. 1 patchbot patchbot 64 Jul  1 13:16 /proc/2040/fd/326 -> /dev/pts/2
l-wx------. 1 patchbot patchbot 64 Jul  1 13:16 /proc/2040/fd/328 -> pipe:[3598117]
```




---

archive/issue_comments_144925.json:
```json
{
    "body": "PS: there are no spurious processes around as far as I can tell\n\n```\n[root@volker-desktop fd]# pstree -p 2040\npython(2040)\u2500\u252c\u2500bash(19705)\u2500\u2500\u2500bash(19707)\u2500\u2500\u2500python(19710)\u2500\u252c\u2500python(19711)\u2500\u2500\u2500bash(22440)\u2500\u2500\u2500python(22441)\u2500\u2500\u2500python(22442)\n             \u2502                                           \u251c\u2500python(19712)\u2500\u2500\u2500bash(22317)\u2500\u2500\u2500python(22318)\u2500\u2500\u2500python(22319)\u2500\u252c\u2500gp(22346)\n             \u2502                                           \u2502                                                             \u251c\u2500gp(22364)\n             \u2502                                           \u2502                                                             \u251c\u2500mwrank(22334)\n             \u2502                                           \u2502                                                             \u251c\u2500mwrank(22337)\n             \u2502                                           \u2502                                                             \u251c\u2500mwrank(22340)\n             \u2502                                           \u2502                                                             \u2514\u2500mwrank(22443)\n             \u2502                                           \u251c\u2500python(19713)\u2500\u2500\u2500bash(22450)\u2500\u2500\u2500python(22451)\u2500\u2500\u2500python(22452)\n             \u2502                                           \u251c\u2500{python}(19714)\n             \u2502                                           \u251c\u2500{python}(19715)\n             \u2502                                           \u2514\u2500{python}(19716)\n             \u251c\u2500python(19692)\n             \u2514\u2500tee(19283)\n[root@volker-desktop fd]# ps -p 19705 u\nUSER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND\npatchbot 19705  0.0  0.0 112096  1316 pts/2    S+   13:17   0:00 bash /mnt/storage2TB/patchbot/Sage/sage-5.1.rc0/sage -tp 3 -sagenb /mnt/storage2TB/patchbot/S\n[root@volker-desktop fd]# ps -p 19692 u\nUSER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND\npatchbot 19692  0.0  0.0      0     0 pts/2    Z+   13:17   0:00 [python] <defunct>\n[root@volker-desktop fd]# ps -p 19283 u\nUSER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND\npatchbot 19283  0.0  0.0 106848   624 pts/2    S+   13:16   0:00 tee /mnt/storage2TB/patchbot/Sage/sage-5.1.rc0/logs/10764-log.txt\n```\n",
    "created_at": "2012-07-01T12:29:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144925",
    "user": "@vbraun"
}
```

PS: there are no spurious processes around as far as I can tell

```
[root@volker-desktop fd]# pstree -p 2040
python(2040)bash(19705)bash(19707)python(19710)python(19711)bash(22440)python(22441)python(22442)
                                                        python(19712)bash(22317)python(22318)python(22319)gp(22346)
                                                                                                                     gp(22364)
                                                                                                                     mwrank(22334)
                                                                                                                     mwrank(22337)
                                                                                                                     mwrank(22340)
                                                                                                                     mwrank(22443)
                                                        python(19713)bash(22450)python(22451)python(22452)
                                                        {python}(19714)
                                                        {python}(19715)
                                                        {python}(19716)
             python(19692)
             tee(19283)
[root@volker-desktop fd]# ps -p 19705 u
USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
patchbot 19705  0.0  0.0 112096  1316 pts/2    S+   13:17   0:00 bash /mnt/storage2TB/patchbot/Sage/sage-5.1.rc0/sage -tp 3 -sagenb /mnt/storage2TB/patchbot/S
[root@volker-desktop fd]# ps -p 19692 u
USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
patchbot 19692  0.0  0.0      0     0 pts/2    Z+   13:17   0:00 [python] <defunct>
[root@volker-desktop fd]# ps -p 19283 u
USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
patchbot 19283  0.0  0.0 106848   624 pts/2    S+   13:16   0:00 tee /mnt/storage2TB/patchbot/Sage/sage-5.1.rc0/logs/10764-log.txt
```




---

archive/issue_comments_144926.json:
```json
{
    "body": "Also, for the life of me I can't figure out how to make the patchbot ignore the unused patches in #12544. Am I missing anything? Perhaps we need to support \"ignore file.patch\" in the comment text to explicitly tell the bot to ignore patches?",
    "created_at": "2012-07-01T14:14:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144926",
    "user": "@vbraun"
}
```

Also, for the life of me I can't figure out how to make the patchbot ignore the unused patches in #12544. Am I missing anything? Perhaps we need to support "ignore file.patch" in the comment text to explicitly tell the bot to ignore patches?



---

archive/issue_comments_144927.json:
```json
{
    "body": "Attachment [trac_12486_fix_fd_leak.patch](tarball://root/attachments/some-uuid/ticket12486/trac_12486_fix_fd_leak.patch) by @vbraun created at 2012-07-01 14:15:47\n\nInitial patch",
    "created_at": "2012-07-01T14:15:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144927",
    "user": "@vbraun"
}
```

Attachment [trac_12486_fix_fd_leak.patch](tarball://root/attachments/some-uuid/ticket12486/trac_12486_fix_fd_leak.patch) by @vbraun created at 2012-07-01 14:15:47

Initial patch



---

archive/issue_comments_144928.json:
```json
{
    "body": "The attached patch fixes the fd leak (2 per ticket) for me.",
    "created_at": "2012-07-01T14:16:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144928",
    "user": "@vbraun"
}
```

The attached patch fixes the fd leak (2 per ticket) for me.



---

archive/issue_comments_144929.json:
```json
{
    "body": "I'm fine with the ticket going into Sage. Positive review for everything except my patch.",
    "created_at": "2012-07-01T14:28:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144929",
    "user": "@vbraun"
}
```

I'm fine with the ticket going into Sage. Positive review for everything except my patch.



---

archive/issue_comments_144930.json:
```json
{
    "body": "For what it's worth, I'm no longer getting the failure on arando after I rebooted it and installed this ticket into 5.1.rc0 (I just got into Singapore today so I was able to physically access the machine again), so you can forget about that, I guess...",
    "created_at": "2012-07-03T00:57:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144930",
    "user": "@kini"
}
```

For what it's worth, I'm no longer getting the failure on arando after I rebooted it and installed this ticket into 5.1.rc0 (I just got into Singapore today so I was able to physically access the machine again), so you can forget about that, I guess...



---

archive/issue_comments_144931.json:
```json
{
    "body": "Ah, thanks for the file descriptor leak! Positive review on that patch. I'll look into the issue at #12544, but that seems to be an exceptional case.",
    "created_at": "2012-07-03T06:03:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144931",
    "user": "@robertwb"
}
```

Ah, thanks for the file descriptor leak! Positive review on that patch. I'll look into the issue at #12544, but that seems to be an exceptional case.



---

archive/issue_comments_144932.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-07-03T06:03:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144932",
    "user": "@robertwb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_144933.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2012-07-08T19:41:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144933",
    "user": "@jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_144934.json:
```json
{
    "body": "`sage-sdist` isn't fixed at all, the following files still disappear:\n\n```\n! patchbot/README.txt\n! patchbot/db.py\n! patchbot/http_post_file.py\n! patchbot/images/blue-blob.png\n! patchbot/images/green-blob.png\n! patchbot/images/purple-blob.png\n! patchbot/images/red-blob.png\n! patchbot/images/white-blob.png\n! patchbot/images/yellow-blob.png\n! patchbot/patchbot.py\n! patchbot/plugins.py\n! patchbot/run_server.py\n! patchbot/serve.py\n! patchbot/templates/base.html\n! patchbot/templates/ticket.html\n! patchbot/templates/ticket_list.html\n! patchbot/trac.py\n! patchbot/util.py\n```\n",
    "created_at": "2012-07-08T19:41:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144934",
    "user": "@jdemeyer"
}
```

`sage-sdist` isn't fixed at all, the following files still disappear:

```
! patchbot/README.txt
! patchbot/db.py
! patchbot/http_post_file.py
! patchbot/images/blue-blob.png
! patchbot/images/green-blob.png
! patchbot/images/purple-blob.png
! patchbot/images/red-blob.png
! patchbot/images/white-blob.png
! patchbot/images/yellow-blob.png
! patchbot/patchbot.py
! patchbot/plugins.py
! patchbot/run_server.py
! patchbot/serve.py
! patchbot/templates/base.html
! patchbot/templates/ticket.html
! patchbot/templates/ticket_list.html
! patchbot/trac.py
! patchbot/util.py
```




---

archive/issue_comments_144935.json:
```json
{
    "body": "Argh! OK, I'm going to rebase this on an entirely clean copy of Sage and git it fixed tonight.",
    "created_at": "2012-07-09T21:42:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144935",
    "user": "@robertwb"
}
```

Argh! OK, I'm going to rebase this on an entirely clean copy of Sage and git it fixed tonight.



---

archive/issue_comments_144936.json:
```json
{
    "body": "I'm not sure I see what the problem is; is the issue that the files aren't extracted in the spkg itself? That shouldn't matter at all, as they're in the history which is what's used to install the spkg.",
    "created_at": "2012-07-10T08:39:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144936",
    "user": "@robertwb"
}
```

I'm not sure I see what the problem is; is the issue that the files aren't extracted in the spkg itself? That shouldn't matter at all, as they're in the history which is what's used to install the spkg.



---

archive/issue_comments_144937.json:
```json
{
    "body": "The issue is that the files are not copied *into* the spkg by `sage-sdist`.",
    "created_at": "2012-07-10T08:44:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144937",
    "user": "@jdemeyer"
}
```

The issue is that the files are not copied *into* the spkg by `sage-sdist`.



---

archive/issue_comments_144938.json:
```json
{
    "body": "My question is more why do they need to be?",
    "created_at": "2012-07-10T09:11:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144938",
    "user": "@robertwb"
}
```

My question is more why do they need to be?



---

archive/issue_comments_144939.json:
```json
{
    "body": "Replying to [comment:59 robertwb]:\n> My question is more why do they need to be?\nBecause we have always done things that way, and I don't see any reason why we should make an exception for the patchbot files.\n\nSurely our installation/packaging procedure can be improved, but that's the topic of #13015, not of this ticket.",
    "created_at": "2012-07-10T09:18:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144939",
    "user": "@jdemeyer"
}
```

Replying to [comment:59 robertwb]:
> My question is more why do they need to be?
Because we have always done things that way, and I don't see any reason why we should make an exception for the patchbot files.

Surely our installation/packaging procedure can be improved, but that's the topic of #13015, not of this ticket.



---

archive/issue_comments_144940.json:
```json
{
    "body": "If you really want to change the installation of the scripts spkg, make a separate ticket and add that as dependency here.",
    "created_at": "2012-07-10T09:23:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144940",
    "user": "@jdemeyer"
}
```

If you really want to change the installation of the scripts spkg, make a separate ticket and add that as dependency here.



---

archive/issue_comments_144941.json:
```json
{
    "body": "Sure, I'll do that. (I just did that here as it seemed cleaner than explicitly adding a bunch of globs to copy, making sure I got everything we wanted and nothing we didn't.)",
    "created_at": "2012-07-10T09:46:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144941",
    "user": "@robertwb"
}
```

Sure, I'll do that. (I just did that here as it seemed cleaner than explicitly adding a bunch of globs to copy, making sure I got everything we wanted and nothing we didn't.)



---

archive/issue_comments_144942.json:
```json
{
    "body": "*** ping ***",
    "created_at": "2012-08-08T13:04:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144942",
    "user": "@jdemeyer"
}
```

*** ping ***



---

archive/issue_comments_144943.json:
```json
{
    "body": "Does the patchbot already feature the automatic deleting of old devel/sage-NNNNN directories?",
    "created_at": "2012-08-14T08:59:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144943",
    "user": "@jdemeyer"
}
```

Does the patchbot already feature the automatic deleting of old devel/sage-NNNNN directories?



---

archive/issue_comments_144944.json:
```json
{
    "body": "It doesn't do so by default at the moment, at least.",
    "created_at": "2012-08-14T09:03:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144944",
    "user": "@kini"
}
```

It doesn't do so by default at the moment, at least.



---

archive/issue_comments_144945.json:
```json
{
    "body": "Sorry I haven't gotten back to this. I'll try to get to it within the week. Thanks for the ping.\n\nRegarding deleting the sage-NNNNN directories, It should delete them as the tickets get closed.",
    "created_at": "2012-08-14T16:06:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144945",
    "user": "@robertwb"
}
```

Sorry I haven't gotten back to this. I'll try to get to it within the week. Thanks for the ping.

Regarding deleting the sage-NNNNN directories, It should delete them as the tickets get closed.



---

archive/issue_comments_144946.json:
```json
{
    "body": "Just an idea concerning the distribution of the patchbot: maybe you could make a separate spkg for the patchbot instead of distributing it with `sage_scripts`?",
    "created_at": "2012-08-15T07:29:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144946",
    "user": "@jdemeyer"
}
```

Just an idea concerning the distribution of the patchbot: maybe you could make a separate spkg for the patchbot instead of distributing it with `sage_scripts`?



---

archive/issue_comments_144947.json:
```json
{
    "body": "Replying to [comment:66 robertwb]:\n> Regarding deleting the sage-NNNNN directories, It should delete them as the tickets get closed. \nI would propose something like: if there is no activitity on a ticket (meaning no patches are changed) for a certain time (one week?), then also delete the directory.",
    "created_at": "2012-08-15T07:31:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144947",
    "user": "@jdemeyer"
}
```

Replying to [comment:66 robertwb]:
> Regarding deleting the sage-NNNNN directories, It should delete them as the tickets get closed. 
I would propose something like: if there is no activitity on a ticket (meaning no patches are changed) for a certain time (one week?), then also delete the directory.



---

archive/issue_comments_144948.json:
```json
{
    "body": "I've been running a patchbot for a while now and disk usage isn't really that much of a deal. Especially since there isn't any reason to keep old versions around as development goes on. What is much more annoying is that this ticket is still not merged so with each beta I have to install a handful of patches on a machine on the other side of the atlantic...",
    "created_at": "2012-08-15T13:39:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144948",
    "user": "@vbraun"
}
```

I've been running a patchbot for a while now and disk usage isn't really that much of a deal. Especially since there isn't any reason to keep old versions around as development goes on. What is much more annoying is that this ticket is still not merged so with each beta I have to install a handful of patches on a machine on the other side of the atlantic...



---

archive/issue_comments_144949.json:
```json
{
    "body": "I have this setup on arando:\n\n\n```\n[1] patchbot@arando /opt $ ls -hal\ntotal 4.4G\ndrwxrwxr-x  3 root     opt      4.0K Aug 15 21:42 .\ndrwxr-xr-x 22 root     root     4.0K Aug 13 18:32 ..\nlrwxrwxrwx  1 patchbot patchbot   18 Aug 13 20:12 patchbot -> patchbot-5.3.beta1\ndrwxr-xr-x 10 patchbot patchbot 4.0K Aug 13 23:49 patchbot-5.3.beta1\n-rw-rw-r--  1 patchbot patchbot 295M Jul  3 03:15 sage-5.0.1.tar\n-r--r--r--  1 kini     kini     294M May 15 17:54 sage-5.0.tar\n-rw-r--r--  1 kini     kini     294M May 18 02:09 sage-5.1.beta0.tar\n-rw-rw-r--  1 patchbot patchbot 294M May 29 05:40 sage-5.1.beta1.tar\n-rw-rw-r--  1 patchbot patchbot 290M Jun  4 00:58 sage-5.1.beta2.tar\n-rw-rw-r--  1 patchbot patchbot 290M Jun  7 17:37 sage-5.1.beta3.tar\n-rw-rw-r--  1 patchbot patchbot 291M Jun 19 19:31 sage-5.1.beta5.tar\n-rw-rw-r--  1 patchbot patchbot 291M Jun 25 19:30 sage-5.1.beta6.tar\n-rw-rw-r--  1 patchbot patchbot 291M Jul  3 03:16 sage-5.1.rc0.tar\n-rw-rw-r--  1 patchbot patchbot 291M Jul  6 07:32 sage-5.1.rc1.tar\n-rw-rw-r--  1 patchbot patchbot 313M Jul 10 02:18 sage-5.2.beta0.tar\n-rw-rw-r--  1 patchbot patchbot 314M Jul 25 01:59 sage-5.2.rc1.tar\n-rw-rw-r--  1 patchbot patchbot 314M Jul 26 02:00 sage-5.2.tar\n-rw-rw-r--  1 patchbot patchbot 314M Aug  1 23:55 sage-5.3.beta0.tar\n-rw-rw-r--  1 patchbot patchbot 314M Aug 13 06:15 sage-5.3.beta1.tar\n-rwxrwxr-x  1 patchbot patchbot 1.3K Aug 15 21:42 setup-patchbot.sh\n[1] patchbot@arando /opt $ cat setup-patchbot.sh \n#!/bin/bash\n\n# This script upgrades the currently running patchbot in this directory.\n# Supply a Sage version number as an argument, and the script will\n# download, set up, and run the patchbot.\n\nVER=$1\n[ -n $VER ] || exit 1\n\n# Get new patchbot and extract it\nrm -f sage-$VER.tar\nwget http://boxen.math.washington.edu/home/release/sage-$VER/sage-$VER.tar\nrm -rf $(readlink patchbot)\n\n# Delete old patchbot dir (keep tarball) and move symlink to new\n# patchbot dir\nrm patchbot\ntar xf sage-$VER.tar\nmv sage-$VER patchbot-$VER\nln -s patchbot-$VER patchbot\n\n# Build new patchbot's Sage from source\ncd patchbot\nmake\n\n# Install the patchbot into the newly built Sage version (TODO: update\n# this when the patches on ticket #12486 change, or when #12486 is\n# merged)\nhg qimport -P http://trac.sagemath.org/sage_trac/raw-attachment/ticket/12486/patchbot-root-5.0.patch\nhg -R local/bin qimport -P http://trac.sagemath.org/sage_trac/raw-attachment/ticket/12486/12486-patchbot-scripts-5.0-updated.patch\nhg -R local/bin qimport -P http://trac.sagemath.org/sage_trac/raw-attachment/ticket/12486/12486-fix-sdist.patch\nhg -R local/bin qimport -P http://trac.sagemath.org/sage_trac/raw-attachment/ticket/12486/trac_12486_fix_fd_leak.patch\n./sage -b\n\n# Start the patchbot\nexec ./sage --patchbot\n[1] patchbot@arando /opt $ \n```\n\n\nMakes it pretty easy...",
    "created_at": "2012-08-15T13:43:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144949",
    "user": "@kini"
}
```

I have this setup on arando:


```
[1] patchbot@arando /opt $ ls -hal
total 4.4G
drwxrwxr-x  3 root     opt      4.0K Aug 15 21:42 .
drwxr-xr-x 22 root     root     4.0K Aug 13 18:32 ..
lrwxrwxrwx  1 patchbot patchbot   18 Aug 13 20:12 patchbot -> patchbot-5.3.beta1
drwxr-xr-x 10 patchbot patchbot 4.0K Aug 13 23:49 patchbot-5.3.beta1
-rw-rw-r--  1 patchbot patchbot 295M Jul  3 03:15 sage-5.0.1.tar
-r--r--r--  1 kini     kini     294M May 15 17:54 sage-5.0.tar
-rw-r--r--  1 kini     kini     294M May 18 02:09 sage-5.1.beta0.tar
-rw-rw-r--  1 patchbot patchbot 294M May 29 05:40 sage-5.1.beta1.tar
-rw-rw-r--  1 patchbot patchbot 290M Jun  4 00:58 sage-5.1.beta2.tar
-rw-rw-r--  1 patchbot patchbot 290M Jun  7 17:37 sage-5.1.beta3.tar
-rw-rw-r--  1 patchbot patchbot 291M Jun 19 19:31 sage-5.1.beta5.tar
-rw-rw-r--  1 patchbot patchbot 291M Jun 25 19:30 sage-5.1.beta6.tar
-rw-rw-r--  1 patchbot patchbot 291M Jul  3 03:16 sage-5.1.rc0.tar
-rw-rw-r--  1 patchbot patchbot 291M Jul  6 07:32 sage-5.1.rc1.tar
-rw-rw-r--  1 patchbot patchbot 313M Jul 10 02:18 sage-5.2.beta0.tar
-rw-rw-r--  1 patchbot patchbot 314M Jul 25 01:59 sage-5.2.rc1.tar
-rw-rw-r--  1 patchbot patchbot 314M Jul 26 02:00 sage-5.2.tar
-rw-rw-r--  1 patchbot patchbot 314M Aug  1 23:55 sage-5.3.beta0.tar
-rw-rw-r--  1 patchbot patchbot 314M Aug 13 06:15 sage-5.3.beta1.tar
-rwxrwxr-x  1 patchbot patchbot 1.3K Aug 15 21:42 setup-patchbot.sh
[1] patchbot@arando /opt $ cat setup-patchbot.sh 
#!/bin/bash

# This script upgrades the currently running patchbot in this directory.
# Supply a Sage version number as an argument, and the script will
# download, set up, and run the patchbot.

VER=$1
[ -n $VER ] || exit 1

# Get new patchbot and extract it
rm -f sage-$VER.tar
wget http://boxen.math.washington.edu/home/release/sage-$VER/sage-$VER.tar
rm -rf $(readlink patchbot)

# Delete old patchbot dir (keep tarball) and move symlink to new
# patchbot dir
rm patchbot
tar xf sage-$VER.tar
mv sage-$VER patchbot-$VER
ln -s patchbot-$VER patchbot

# Build new patchbot's Sage from source
cd patchbot
make

# Install the patchbot into the newly built Sage version (TODO: update
# this when the patches on ticket #12486 change, or when #12486 is
# merged)
hg qimport -P http://trac.sagemath.org/sage_trac/raw-attachment/ticket/12486/patchbot-root-5.0.patch
hg -R local/bin qimport -P http://trac.sagemath.org/sage_trac/raw-attachment/ticket/12486/12486-patchbot-scripts-5.0-updated.patch
hg -R local/bin qimport -P http://trac.sagemath.org/sage_trac/raw-attachment/ticket/12486/12486-fix-sdist.patch
hg -R local/bin qimport -P http://trac.sagemath.org/sage_trac/raw-attachment/ticket/12486/trac_12486_fix_fd_leak.patch
./sage -b

# Start the patchbot
exec ./sage --patchbot
[1] patchbot@arando /opt $ 
```


Makes it pretty easy...



---

archive/issue_comments_144950.json:
```json
{
    "body": "I've created an spkg: http://sage.math.washington.edu/home/robertwb/patches/patchbot-1.0.spkg\n\nThe contents of this spkg should be identical to the (flattened) patches.",
    "created_at": "2012-08-23T09:31:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144950",
    "user": "@robertwb"
}
```

I've created an spkg: http://sage.math.washington.edu/home/robertwb/patches/patchbot-1.0.spkg

The contents of this spkg should be identical to the (flattened) patches.



---

archive/issue_comments_144951.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-08-23T09:31:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144951",
    "user": "@robertwb"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_144952.json:
```json
{
    "body": "Adding a spkg requires changes to `spkg/standard/deps` and `spkg/install`.\n\nLeaving `$SAGE_LOCAL` unquoted is not so good:\n\n```\n$SAGE_LOCAL/bin/patchbot/patchbot.py\n```\n\n\nBetter is\n\n```\n\"$SAGE_LOCAL/bin/patchbot/patchbot.py\"\n```\n",
    "created_at": "2012-08-23T15:02:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144952",
    "user": "@jdemeyer"
}
```

Adding a spkg requires changes to `spkg/standard/deps` and `spkg/install`.

Leaving `$SAGE_LOCAL` unquoted is not so good:

```
$SAGE_LOCAL/bin/patchbot/patchbot.py
```


Better is

```
"$SAGE_LOCAL/bin/patchbot/patchbot.py"
```




---

archive/issue_comments_144953.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-08-23T15:02:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144953",
    "user": "@jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_144954.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-08-23T15:58:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144954",
    "user": "@robertwb"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_144955.json:
```json
{
    "body": "Attachment [patchbot-root-5.0.quoted.patch](tarball://root/attachments/some-uuid/ticket12486/patchbot-root-5.0.quoted.patch) by @robertwb created at 2012-08-23 15:58:03",
    "created_at": "2012-08-23T15:58:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144955",
    "user": "@robertwb"
}
```

Attachment [patchbot-root-5.0.quoted.patch](tarball://root/attachments/some-uuid/ticket12486/patchbot-root-5.0.quoted.patch) by @robertwb created at 2012-08-23 15:58:03



---

archive/issue_comments_144956.json:
```json
{
    "body": "As Simon King pointed out on sage-devel a few days ago, the patchbot shouldn't report \"ApplyFailed\" when what failed was the downloading of the patches rather than the application of the patches.",
    "created_at": "2012-08-24T03:01:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144956",
    "user": "@kini"
}
```

As Simon King pointed out on sage-devel a few days ago, the patchbot shouldn't report "ApplyFailed" when what failed was the downloading of the patches rather than the application of the patches.



---

archive/issue_comments_144957.json:
```json
{
    "body": "Good idea to package the bot. I think we should start by making the patchbot an optional spkg.   We don't need to modify `spkg/standard/deps` or add id to the `sage -advanced` help then. Once it is an optional spkg we can vote on sage-devel to make it standard (+1 from me). \n\nFor consistency the mercurial repo inside the spkg should have the bot committed and not as a patch queue. Apart from that its ready to go.",
    "created_at": "2012-08-25T15:23:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144957",
    "user": "@vbraun"
}
```

Good idea to package the bot. I think we should start by making the patchbot an optional spkg.   We don't need to modify `spkg/standard/deps` or add id to the `sage -advanced` help then. Once it is an optional spkg we can vote on sage-devel to make it standard (+1 from me). 

For consistency the mercurial repo inside the spkg should have the bot committed and not as a patch queue. Apart from that its ready to go.



---

archive/issue_comments_144958.json:
```json
{
    "body": "The Mercurial repo inside the SPKG should not have the bot committed. The bot should be in the src/ directory and the src/ directory should be ignored in .hgignore. This is standard among SPKGs, and is also what is present in the current patch queue in the SPKG.",
    "created_at": "2012-08-25T15:31:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144958",
    "user": "@kini"
}
```

The Mercurial repo inside the SPKG should not have the bot committed. The bot should be in the src/ directory and the src/ directory should be ignored in .hgignore. This is standard among SPKGs, and is also what is present in the current patch queue in the SPKG.



---

archive/issue_comments_144959.json:
```json
{
    "body": "Thats what I meant. Sorry for not being clear. My point is that the `SPGK.txt`, ... files are in a mercurial queue right now.",
    "created_at": "2012-08-25T15:48:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144959",
    "user": "@vbraun"
}
```

Thats what I meant. Sorry for not being clear. My point is that the `SPGK.txt`, ... files are in a mercurial queue right now.



---

archive/issue_comments_144960.json:
```json
{
    "body": "`patchbot.py` is not executable, so `sage --patchbot` fails to execute.",
    "created_at": "2012-08-25T17:53:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144960",
    "user": "@vbraun"
}
```

`patchbot.py` is not executable, so `sage --patchbot` fails to execute.



---

archive/issue_comments_144961.json:
```json
{
    "body": "OK, I've pushed a new commit to make patchbot.py executable and make the hg commit a real commit. It's nit-picky stuff like this that in part made me want to avoid making an spkg. I'd much rather spend time improving or cleaning up the patchbot than worrying about packaging details as I've done over the last 7 (!) months since filing this ticket (whether as a patch or an spkg) but it's a real pain to not have this in. Basically, we need to move to a better system soon... OK, done ranting.\n\nI also made it to qimport failing doesn't cause the ticket to fail.",
    "created_at": "2012-08-26T05:19:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144961",
    "user": "@robertwb"
}
```

OK, I've pushed a new commit to make patchbot.py executable and make the hg commit a real commit. It's nit-picky stuff like this that in part made me want to avoid making an spkg. I'd much rather spend time improving or cleaning up the patchbot than worrying about packaging details as I've done over the last 7 (!) months since filing this ticket (whether as a patch or an spkg) but it's a real pain to not have this in. Basically, we need to move to a better system soon... OK, done ranting.

I also made it to qimport failing doesn't cause the ticket to fail.



---

archive/issue_comments_144962.json:
```json
{
    "body": "And, to be clear, no offense to any of you intended, in fact I'm really grateful you're looking at this. It's the system that's to onerous.",
    "created_at": "2012-08-26T05:21:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144962",
    "user": "@robertwb"
}
```

And, to be clear, no offense to any of you intended, in fact I'm really grateful you're looking at this. It's the system that's to onerous.



---

archive/issue_comments_144963.json:
```json
{
    "body": "Changing component from doctest to optional packages.",
    "created_at": "2012-08-28T07:07:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144963",
    "user": "@jdemeyer"
}
```

Changing component from doctest to optional packages.



---

archive/issue_comments_144964.json:
```json
{
    "body": "Looks good to me!",
    "created_at": "2012-08-29T13:44:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144964",
    "user": "@vbraun"
}
```

Looks good to me!



---

archive/issue_comments_144965.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-08-29T13:44:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144965",
    "user": "@vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_144966.json:
```json
{
    "body": "the optional spkg is on the server+mirrors now.",
    "created_at": "2012-08-30T09:49:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144966",
    "user": "@haraldschilly"
}
```

the optional spkg is on the server+mirrors now.



---

archive/issue_comments_144967.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-08-30T11:41:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12314#issuecomment-144967",
    "user": "@jdemeyer"
}
```

Resolution: fixed
