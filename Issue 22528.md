# Issue 22528: Fix cycle_index for permutation groups on non trivial domains

Issue created by migration from Trac.

Original creator: nthiery

Original creation time: 2017-04-06 02:47:09

CC:  nborie dimpase

The code for `cycle_index` predates permutation groups with arbitrary
domain, as well as their `cycle_type` methods. Instead it goes through
plain Permutation's, which only works if the domain is 1,...n::


```
sage: G = PermutationGroup([This is the Trac macro *'b','c','a'* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#'b','c','a'-macro), domain=['a','b','c'])
sage: G.cycle_index()
ValueError                                Traceback (most recent call last)
/opt/sage-git2/local/lib/python2.7/site-packages/sage/combinat/permutation.pyc in __init__(self, parent, l, check_input)
    519             for i in lst:
    520                 try:
--> 521                     i = int(i)
    522                 except TypeError:
    523                     raise ValueError("the elements must be integer variables")

ValueError: invalid literal for int() with base 10: 'a'
```


This ticket fixes that, and uses the occasion to clean a bit the code,
using in particular the `conjugacy_classes` method to avoid a direct
access to GAP.


---

Comment by nthiery created at 2017-04-06 03:08:05

Changing status from new to needs_review.


---

Comment by nthiery created at 2017-04-06 03:09:55

New commits:


---

Comment by chapoton created at 2017-04-06 09:45:27

wrong syntax here:

```
+            (see trac:`22765`)::
```

should be `:trac:`22765``


---

Comment by git created at 2017-04-06 11:03:49

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by nthiery created at 2017-04-06 11:06:48

Replying to [comment:5 chapoton]:
> wrong syntax here:
> {{{
> +            (see trac:`22765`)::
> }}}
> should be `:trac:`22765``

Fixed. Merci Frédéric!

May I assume that you proofread the rest and the syntax is correct?


---

Comment by chapoton created at 2017-04-06 11:30:20

no, sorry. I was in mode "break at first failure"


---

Comment by nthiery created at 2017-04-06 17:25:07

Fair enough :-) Thanks though!


---

Comment by nthiery created at 2017-04-06 18:41:15

Changing keywords from "" to "gap, permutation group, Pólya enumeration".


---

Comment by chapoton created at 2017-04-08 06:23:40

same here:

```
(:wikipedia`Cycle_index`)
```



---

Comment by chapoton created at 2017-04-08 06:23:40

Changing status from needs_review to needs_work.


---

Comment by git created at 2017-04-08 15:26:37

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by nthiery created at 2017-04-08 15:27:37

Thanks :-)


---

Comment by nthiery created at 2017-04-08 15:27:37

Changing status from needs_work to needs_review.


---

Comment by git created at 2017-04-08 16:09:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by nthiery created at 2017-04-08 16:10:08

Oops, while updating the write up of the book, I just noticed I had not use sum_of_terms. Fixed!


---

Comment by nthiery created at 2017-04-14 11:30:38

For the record, the patchbot is green up to:

```
sage -t --long src/sage/doctest/test.py  # Timed out after testing finished
sage -t --long src/sage/calculus/calculus.py  # 1 doctest failed
```

which I don't see how they could not be independent.


---

Comment by tscrim created at 2017-04-15 03:53:27

Yes, they are independent. Frederic (or Dima), are you going to be doing a full review, if not, I can do it.


---

Comment by chapoton created at 2017-04-16 07:10:51

This is slightly ambiguous, and better with more parentheses:

```
+            elif not hasattr(parent, "term") and hasattr(parent, "sum"):
```

I am satisfied with the changes. I will not look further.


---

Comment by git created at 2017-04-16 12:06:02

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by nthiery created at 2017-04-16 12:07:29

Oops, the test was indeed logically broken. Fixed. I used the occasion to switch to a cleaner type checking. Thanks!


---

Comment by chapoton created at 2017-04-17 09:06:10

ok, then let it be


---

Comment by chapoton created at 2017-04-17 09:06:10

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2017-04-23 12:57:40

Resolution: fixed
