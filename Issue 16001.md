# Issue 16001: Correct call convention for isogenies

Issue created by migration from Trac.

Original creator: sbesnier

Original creation time: 2014-04-25 16:57:25

CC:  defeo cremona

Keywords: call isogeny

The method `__call__` of the class `EllipticCurveIsogeny` takes a second argument `output_base_ring`. It seems weird to me, do you find this is conventional?

Moreover, this method should be `_call_` in order to make the functionalities of `Map`  available.


---

Comment by pbruin created at 2014-04-25 23:10:57

It is not uncommon for `__call__()` to take extra (positional or keyword) arguments; this is used for example to implement `E(x,y)` as an alternative notation for `E((x, y))` to construct a point on an elliptic curve.

I think that you can rename `__call__()` to `_call_()` if you also implement `_call_with_args()`, for example as follows (the non-standard calling convention seems to be a consequence of Cython restrictions):

```diff
diff --git a/src/sage/schemes/elliptic_curves/ell_curve_isogeny.py b/src/sage/schemes/elliptic_curves/ell_curve_isogeny.py
index 8b18590..7aa1583 100644
--- a/src/sage/schemes/elliptic_curves/ell_curve_isogeny.py
+++ b/src/sage/schemes/elliptic_curves/ell_curve_isogeny.py
`@``@` -1029,6 +1029,8 `@``@` class EllipticCurveIsogeny(Morphism):

         return outE2.point([R(outP[0]), R(outP[1]), R(1)], check=False)

+    def _call_with_args(self, x, args=(), kwds={}):
+        return self._call_(x, *args, **kwds)

     def __getitem__(self, i):
         self.__initialize_rational_maps()
```

However, I'm wondering if this `output_base_ring` argument is used for any purpose at all.  You could try simply removing it; then `_call_with_args()` is not necessary either.


---

Comment by defeo created at 2014-04-25 23:53:35

> However, I'm wondering if this `output_base_ring` argument is used for any purpose at all.  You could try simply removing it; then `_call_with_args()` is not necessary either.

Same opinion here. Looks like bad design to me: we already have coercion and `.change_ring` to achieve the same result. These are standard idioms in Sage, while `output_base_ring` is not. 

Except for one single doctest not shown in the ref manual, the third argument is not even documented.

Since you are at it, you could clean the code of `__call__`. It does a lot of manual checking of parents, which should be taken care of automatically by the coercion system if you switch to `_call_`.


---

Comment by sbesnier created at 2014-04-27 15:03:31

I've done the suggested modifications. The coercion staff is now handle by Map (the doctests concercing isogeny equality still fail, it'll be fix as soon as #11474 will be fix).

Currently, we can call `phi((1,0))`, but no `phi(1,0)` (in the same way we can call `E(1,0)`). Do you think it would be usefull to implement that? We should use something like:

```python

def _call_with_args(self, x, y=None,kwd={}):
    return self._call_(self.__E2(x,y))

```


But this simple code doesn't work at all! Indeed, when we call for example `phi(0,0)`, the first arg is first coerced to `phi.__E1(0)` and then passed to `_call_with_args`.

Should I overload `__call__`, in this way:

```python
def __call__(self,x,y=None):
    if y is None:
       return Map.__call__(self,x)
    else:
       return Map.__call__(self,(x,y))
```

?

But this looks a bit creepy to me.
----
New commits:


---

Comment by sbesnier created at 2014-04-27 15:09:12

Changing status from new to needs_review.


---

Comment by defeo created at 2014-04-27 15:24:32

> Currently, we can call `phi((1,0))`, but no `phi(1,0)` (in the same way we can call `E(1,0)`). Do you think it would be usefull to implement that? 

I don't like it. Even `phi((1,0))` is distasteful in my opinion.


---

Comment by pbruin created at 2014-04-28 11:27:01

Replying to [comment:6 defeo]:
> > Currently, we can call `phi((1,0))`, but no `phi(1,0)` (in the same way we can call `E(1,0)`). Do you think it would be usefull to implement that? 
> 
> I don't like it. Even `phi((1,0))` is distasteful in my opinion.
The notation `phi((1, 0))` presumably works automatically because `(1, 0)` is an object that can be coerced into `E`.  It may not be the most expressive notation, but I see no reason not to keep it.  I think extending this to allow `phi(1, 0)` is unnecessary.


---

Comment by git created at 2014-04-28 12:15:07

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by pbruin created at 2014-08-19 14:54:14

Merged #16245 and made a trivial reviewer patch; positive review conditional on #16245.


---

Comment by pbruin created at 2014-08-19 14:54:14

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2014-09-08 08:48:51

Resolution: fixed
