# Issue 18104: Sphinx tarball needs renaming

Issue created by migration from https://trac.sagemath.org/ticket/18341

Original creator: charpent

Original creation time: 2015-04-30 06:25:43

Sphinx is built from `Sphinx-1.2.2.tar.gz`. it turns out that `sage -sh sage-fix-pkg-checksums`, that computes the checksums, will treat only lower-case-named tarballs ... except on Macs, whose filesystems will find `Sphinx-1.2.2.tar.gz` when asked for `sphinx-1.2.2.tar.gz`. See #18229 for discussion.

This is documented in the Developer's guide ([http://www.sagemath.org/doc/developer/packaging.html](http://www.sagemath.org/doc/developer/packaging.html), paragraph "Directory structure"), that states :

> "The build scripts and associated files are in a subdirectory SAGE_ROOT/build/pkgs/package, where you replace package with a lower-case version of the upstream project name."

I suppose that the original Sphinx porter might have been a Mac user, and that nobody caught the problem.

HTH,


---

Comment by jdemeyer created at 2015-04-30 07:44:36

What's the problem really? I don't think it is a requirement that the tarball name matches the package name. It builds and the current checksums are correct, so...? The next person to update the package can still rename the tarball.


---

Comment by jdemeyer created at 2015-04-30 07:44:36

Changing status from new to needs_review.


---

Comment by charpent created at 2015-04-30 08:44:58

Replying to [comment:2 jdemeyer]:
> What's the problem really? I don't think it is a requirement that the tarball name matches the package name.

It is :
* [Developer's guide](http://www.sagemath.org/doc/developer/packaging.html) requirement, as quoted in the ticket description
* The current sage-fix-spkg-checksums won't update the checksums on anything but a Mac with their pseudo-case-sensitive filesystem. See #18229 for an exchange between FranÃ§ois Bissey and myself.


> It builds and the current checksums are correct,

How do you know ? You don't have a way to know that unless you're on a Mac or you're recomputing the checksums by hand (sage-fix-spkg-checksums won't do it on anything but a Mac).

> so...? The next person to update the package can still rename the tarball.

I agree that the lower-case tarball requirement seems odd. It has been a thorn in my bu...err...backside since I started to keep R up-to-date. But the problem exists, and won't go away until the parts of the build system that are tarball-case-sensitive are fixed.

I posted something to that effect on sage-devel. Could we move this discussion  there ?

In the interim, status ==> needs_work.


---

Comment by charpent created at 2015-04-30 08:44:58

Changing status from needs_review to needs_info.


---

Comment by jdemeyer created at 2015-04-30 09:10:30

Replying to [comment:3 charpent]:
> Replying to [comment:2 jdemeyer]:
> > What's the problem really? I don't think it is a requirement that the tarball name matches the package name.
> 
> It is :
> * [Developer's guide](http://www.sagemath.org/doc/developer/packaging.html) requirement, as quoted in the ticket description
Not really, that just says something about the name of the directory in `build/pkgs`.

> * The current sage-fix-spkg-checksums won't update the checksums on anything but a Mac
That's true, but is that a reason to rename the tarball now?

> > It builds and the current checksums are correct,
> 
> How do you know ?
Because `make` succeeds.


---

Comment by charpent created at 2015-04-30 09:34:13

Replying to [comment:4 jdemeyer]:
> Replying to [comment:3 charpent]:
> > Replying to [comment:2 jdemeyer]:
> > > What's the problem really? I don't think it is a requirement that the tarball name matches the package name.
> > 
> > It is :
> > * [Developer's guide](http://www.sagemath.org/doc/developer/packaging.html) requirement, as quoted in the ticket description
> Not really, that just says something about the name of the directory in `build/pkgs`.

< Insert "consistency" sermon here ... >

> 
> > * The current sage-fix-spkg-checksums won't update the checksums on anything but a Mac
> That's true, but is that a reason to rename the tarball now?

Yes : you might get run over by a truck, and the next maintainer of (P|p)illow, who might not be a Mac user, would be stuck with the mess...

> > > It builds and the current checksums are correct,
> > 
> > How do you know ?
> Because `make` succeeds.

... On your Mac ! Or with the current (P|p)illow version. Again, it's the maintenance that seems problematic.

HTH,


---

Comment by jdemeyer created at 2015-04-30 09:43:55

Replying to [comment:5 charpent]:
> > Not really, that just says something about the name of the directory in `build/pkgs`.
> 
> < Insert "consistency" sermon here ... >
If you want consistency, then make this a ticket about enforcing consistency, not about renaming one random tarball.


---

Comment by jdemeyer created at 2015-04-30 09:48:18

Replying to [comment:5 charpent]:
> > > * The current sage-fix-spkg-checksums won't update the checksums on anything but a Mac
> > That's true, but is that a reason to rename the tarball now?
> 
> Yes : you might get run over by a truck, and the next maintainer of (P|p)illow, who might not be a Mac user, would be stuck with the mess...
You think that it will make maintaining Pillow easier if we rename the Pillow tarball now? If you _really_ believe that, then I guess it's worth renaming the tarball now.

> ... On your Mac !
I don't have a Mac and still my Sage builds fine. The checksums are equally correct on my Linux machine than on somebody else's Mac.


---

Comment by aapitzsch created at 2015-05-25 12:51:28

`sage -sh sage-fix-pkg-checksums` works for me. Also `Sphinx-1.2.2.tar.gz` is treated.


---

Comment by aapitzsch created at 2015-05-25 12:51:28

Changing status from needs_info to needs_review.


---

Comment by jdemeyer created at 2015-06-06 10:23:57

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2015-06-19 08:40:24

Resolution: invalid
