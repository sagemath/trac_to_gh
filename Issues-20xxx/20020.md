# Issue 20020: asymptotic expansion generator: singularity analysis (log-type) without renormalization

archive/issues_019783.json:
```json
{
    "body": "As a follow-up to #19969, also implement singularity analysis for `(1-z)<sup>(-alpha)*(log(1/(1-z))</sup>beta`, i.e., where the renormalizing factor `1/z`, for integer beta.\n\nCC:  @behackl @dkrenn\n\nBranch/Commit: 4462b276a506a8a3439a4cad07fa1df09a4d6892\n\nReviewer: Daniel Krenn\n\nAuthor: Clemens Heuberger\n\nDependencies: #19969\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/20020\n\n",
    "closed_at": "2016-02-15T19:28:33Z",
    "created_at": "2016-02-07T13:50:50Z",
    "labels": [
        "component: asymptotic expansions"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.1",
    "title": "asymptotic expansion generator: singularity analysis (log-type) without renormalization",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/20020",
    "user": "https://github.com/cheuberg"
}
```
As a follow-up to #19969, also implement singularity analysis for `(1-z)<sup>(-alpha)*(log(1/(1-z))</sup>beta`, i.e., where the renormalizing factor `1/z`, for integer beta.

CC:  @behackl @dkrenn

Branch/Commit: 4462b276a506a8a3439a4cad07fa1df09a4d6892

Reviewer: Daniel Krenn

Author: Clemens Heuberger

Dependencies: #19969

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/20020





---

archive/issue_comments_361063.json:
```json
{
    "body": "Changing branch from \"\" to \"u/cheuberg/asy/singularity-generator-log-non-normalized\"",
    "created_at": "2016-02-07T15:12:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20020",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20020#issuecomment-361063",
    "user": "https://github.com/cheuberg"
}
```

Changing branch from "" to "u/cheuberg/asy/singularity-generator-log-non-normalized"



---

archive/issue_comments_361064.json:
```json
{
    "body": "<a id='comment:2'></a>Last 10 new commits:",
    "created_at": "2016-02-07T15:13:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20020",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20020#issuecomment-361064",
    "user": "https://github.com/cheuberg"
}
```

<a id='comment:2'></a>Last 10 new commits:



---

archive/issue_comments_361065.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-02-07T15:13:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20020",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20020#issuecomment-361065",
    "user": "https://github.com/cheuberg"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_361066.json:
```json
{
    "body": "Changing commit from \"\" to \"9a6bb5d5203e37c74e8c32cf7f7a034821697561\"",
    "created_at": "2016-02-07T15:13:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20020",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20020#issuecomment-361066",
    "user": "https://github.com/cheuberg"
}
```

Changing commit from "" to "9a6bb5d5203e37c74e8c32cf7f7a034821697561"



---

archive/issue_comments_361067.json:
```json
{
    "body": "Changing commit from \"9a6bb5d5203e37c74e8c32cf7f7a034821697561\" to \"2b67cf075c1d227d7942fc02737b17b51ab661f5\"",
    "created_at": "2016-02-07T16:38:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20020",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20020#issuecomment-361067",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "9a6bb5d5203e37c74e8c32cf7f7a034821697561" to "2b67cf075c1d227d7942fc02737b17b51ab661f5"



---

archive/issue_comments_361068.json:
```json
{
    "body": "<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-02-07T16:38:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20020",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20020#issuecomment-361068",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_361069.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#19969\"",
    "created_at": "2016-02-07T16:38:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20020",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20020#issuecomment-361069",
    "user": "https://github.com/cheuberg"
}
```

Changing dependencies from "" to "#19969"



---

archive/issue_comments_361070.json:
```json
{
    "body": "Changing branch from \"u/cheuberg/asy/singularity-generator-log-non-normalized\" to \"u/dkrenn/asy/singularity-generator-log-non-normalized\"",
    "created_at": "2016-02-12T13:59:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20020",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20020#issuecomment-361070",
    "user": "https://github.com/dkrenn"
}
```

Changing branch from "u/cheuberg/asy/singularity-generator-log-non-normalized" to "u/dkrenn/asy/singularity-generator-log-non-normalized"



---

archive/issue_comments_361071.json:
```json
{
    "body": "<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-02-13T09:41:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20020",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20020#issuecomment-361071",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_361072.json:
```json
{
    "body": "Changing commit from \"2b67cf075c1d227d7942fc02737b17b51ab661f5\" to \"931e5df85430b2f3d51750a0aac3dba730c2e13f\"",
    "created_at": "2016-02-13T09:41:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20020",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20020#issuecomment-361072",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "2b67cf075c1d227d7942fc02737b17b51ab661f5" to "931e5df85430b2f3d51750a0aac3dba730c2e13f"



---

archive/issue_comments_361073.json:
```json
{
    "body": "Changing commit from \"2b67cf075c1d227d7942fc02737b17b51ab661f5\" to \"931e5df85430b2f3d51750a0aac3dba730c2e13f\"",
    "created_at": "2016-02-13T09:41:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20020",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20020#issuecomment-361073",
    "user": "https://github.com/dkrenn"
}
```

Changing commit from "2b67cf075c1d227d7942fc02737b17b51ab661f5" to "931e5df85430b2f3d51750a0aac3dba730c2e13f"



---

archive/issue_comments_361074.json:
```json
{
    "body": "<a id='comment:8'></a>Merged dependencies.\n\n---\nLast 10 new commits:",
    "created_at": "2016-02-13T09:41:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20020",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20020#issuecomment-361074",
    "user": "https://github.com/dkrenn"
}
```

<a id='comment:8'></a>Merged dependencies.

---
Last 10 new commits:



---

archive/issue_comments_361075.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-02-13T11:28:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20020",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20020#issuecomment-361075",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_361076.json:
```json
{
    "body": "Changing commit from \"931e5df85430b2f3d51750a0aac3dba730c2e13f\" to \"4462b276a506a8a3439a4cad07fa1df09a4d6892\"",
    "created_at": "2016-02-13T11:28:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20020",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20020#issuecomment-361076",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "931e5df85430b2f3d51750a0aac3dba730c2e13f" to "4462b276a506a8a3439a4cad07fa1df09a4d6892"



---

archive/issue_comments_361077.json:
```json
{
    "body": "<a id='comment:10'></a>From the docstring:\n\n```\n            sage: asymptotic_expansions._SingularityAnalysis_non_normalized_(\n            ....:     'n', 1, alpha=2, beta=2, precision=4) / n\n            log(n)^2 + (2*euler_gamma - 2)*log(n)\n            - 2*euler_gamma + euler_gamma^2 - 1/6*pi^2 + 2\n            + n^(-1)*log(n)^2 + O(n^(-1)*log(n))\n\n        Be aware that the last result does *not* coincide with [FS2009]_,\n        they do have a different error term.\n```\nI've checked this result and it (in particular, the term `n<sup>(-1)*log(n)</sup>2`) seems to be correct.\n\nApart from that, everything looks good.",
    "created_at": "2016-02-13T11:31:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20020",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20020#issuecomment-361077",
    "user": "https://github.com/dkrenn"
}
```

<a id='comment:10'></a>From the docstring:

```
            sage: asymptotic_expansions._SingularityAnalysis_non_normalized_(
            ....:     'n', 1, alpha=2, beta=2, precision=4) / n
            log(n)^2 + (2*euler_gamma - 2)*log(n)
            - 2*euler_gamma + euler_gamma^2 - 1/6*pi^2 + 2
            + n^(-1)*log(n)^2 + O(n^(-1)*log(n))

        Be aware that the last result does *not* coincide with [FS2009]_,
        they do have a different error term.
```
I've checked this result and it (in particular, the term `n<sup>(-1)*log(n)</sup>2`) seems to be correct.

Apart from that, everything looks good.



---

archive/issue_comments_361078.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-02-13T11:31:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20020",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20020#issuecomment-361078",
    "user": "https://github.com/dkrenn"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_361079.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Daniel Krenn\"",
    "created_at": "2016-02-13T11:31:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20020",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20020#issuecomment-361079",
    "user": "https://github.com/dkrenn"
}
```

Changing reviewer from "" to "Daniel Krenn"



---

archive/issue_comments_361080.json:
```json
{
    "body": "<a id='comment:11'></a>Replying to [dkrenn](#comment%3A10):\n> From the docstring:\n> \n> ```\n>             sage: asymptotic_expansions._SingularityAnalysis_non_normalized_(\n>             ....:     'n', 1, alpha=2, beta=2, precision=4) / n\n>             log(n)^2 + (2*euler_gamma - 2)*log(n)\n>             - 2*euler_gamma + euler_gamma^2 - 1/6*pi^2 + 2\n>             + n^(-1)*log(n)^2 + O(n^(-1)*log(n))\n> \n>         Be aware that the last result does *not* coincide with [FS2009]_,\n>         they do have a different error term.\n> ```\n> I've checked this result and it (in particular, the term `n<sup>(-1)*log(n)</sup>2`) seems to be correct.\n\nI have run numerical tests (via `compare_with_values`) for \n\n```\nsage: asymptotic_expansions._SingularityAnalysis_non_normalized_(\n....:     'n', 1, alpha=2, beta=2, precision=6)\nn*log(n)^2 + (2*euler_gamma - 2)*n*log(n) + (-2*euler_gamma + euler_gamma^2 - 1/6*pi^2 + 2)*n + log(n)^2 + (2*euler_gamma + 1)*log(n) + euler_gamma + euler_gamma^2 - 1/6*pi^2 + O(n^(-1)*log(n)^2)\n```\nthe result is\n\n```\n[(5000, -0.1171037?),\n (10000, -0.1069521?),\n (15000, -0.101778?),\n (20000, -0.098395?),\n (25000, -0.095920?),\n (30000, -0.093987?),\n (35000, -0.09242?),\n (40000, -0.09109?),\n (45000, -0.08995?),\n (50000, -0.08896?)]\n```\nwhich very much supports the additional term here (if it were not here, the renormalization would have multiplied with `n`, which is clearly not occurring).\n\nI therefore submitted this as an erratum at the [book site](http://ac.cs.princeton.edu/errata/).\n\nFor completeness, here is my code for testing.\n\n```\n@cached_function\ndef H(k):\n    \"\"\"\n    Harmonic numbers. Generating function: -log(1-z)/(1-z)\n    \"\"\"\n    if k < 1:\n        return 0\n    else:\n        return 1/k + H(k-1)\n@cached_function\ndef a(k):\n    \"\"\"\n    Coefficients of (-log(1-z))^2: differentiate GF once,\n    obtain 2(-log(1-z))/(1-z), i.e., the harmonic numbers multiplied by 2.\n    Shift and divide by k in order to take differntiation into account.\n    \"\"\"\n    return 2*H(k-1)/k\n@cached_function\ndef sum_a(k):\n    \"\"\"\n    Summatory function of a(k), thus GF (-log(1-z))^2/(1-z).\n    \"\"\"\n    if k<1:\n        return 0\n    else:\n        return sum_a(k-1)+a(k)\n@cached_function\ndef sum_sum_a(k):\n    \"\"\"\n    Summatory function of sum_a(k), thus GF (-log(1-z))^2/(1-z)^2.\n    \"\"\"\n    if k<1:\n        return 0\n    else:\n        return sum_sum_a(k-1)+sum_a(k)\nR.<z> = PowerSeriesRing(QQ, default_prec=100)\nassert (log(1/(1-z)))^2 - sum(z^n*2*H(n-1)/n for n in range(1, 101)) == O(z^101)\nassert (log(1/(1-z))/(1-z))^2 - sum(z^n*sum_sum_a(n) for n in range(1, 101)) == O(z^101)\n%time result = [sum_sum_a(_) > 0 for _ in range(100, 50001, 100)]\nae = asymptotic_expansions._SingularityAnalysis_non_normalized_('n', 1, alpha=2, beta=2, precision=6); ae\nae.compare_with_values('n', sum_sum_a, srange(5000, 50001, 5000))\n```",
    "created_at": "2016-02-13T15:40:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20020",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20020#issuecomment-361080",
    "user": "https://github.com/cheuberg"
}
```

<a id='comment:11'></a>Replying to [dkrenn](#comment%3A10):
> From the docstring:
> 
> ```
>             sage: asymptotic_expansions._SingularityAnalysis_non_normalized_(
>             ....:     'n', 1, alpha=2, beta=2, precision=4) / n
>             log(n)^2 + (2*euler_gamma - 2)*log(n)
>             - 2*euler_gamma + euler_gamma^2 - 1/6*pi^2 + 2
>             + n^(-1)*log(n)^2 + O(n^(-1)*log(n))
> 
>         Be aware that the last result does *not* coincide with [FS2009]_,
>         they do have a different error term.
> ```
> I've checked this result and it (in particular, the term `n<sup>(-1)*log(n)</sup>2`) seems to be correct.

I have run numerical tests (via `compare_with_values`) for 

```
sage: asymptotic_expansions._SingularityAnalysis_non_normalized_(
....:     'n', 1, alpha=2, beta=2, precision=6)
n*log(n)^2 + (2*euler_gamma - 2)*n*log(n) + (-2*euler_gamma + euler_gamma^2 - 1/6*pi^2 + 2)*n + log(n)^2 + (2*euler_gamma + 1)*log(n) + euler_gamma + euler_gamma^2 - 1/6*pi^2 + O(n^(-1)*log(n)^2)
```
the result is

```
[(5000, -0.1171037?),
 (10000, -0.1069521?),
 (15000, -0.101778?),
 (20000, -0.098395?),
 (25000, -0.095920?),
 (30000, -0.093987?),
 (35000, -0.09242?),
 (40000, -0.09109?),
 (45000, -0.08995?),
 (50000, -0.08896?)]
```
which very much supports the additional term here (if it were not here, the renormalization would have multiplied with `n`, which is clearly not occurring).

I therefore submitted this as an erratum at the [book site](http://ac.cs.princeton.edu/errata/).

For completeness, here is my code for testing.

```
@cached_function
def H(k):
    """
    Harmonic numbers. Generating function: -log(1-z)/(1-z)
    """
    if k < 1:
        return 0
    else:
        return 1/k + H(k-1)
@cached_function
def a(k):
    """
    Coefficients of (-log(1-z))^2: differentiate GF once,
    obtain 2(-log(1-z))/(1-z), i.e., the harmonic numbers multiplied by 2.
    Shift and divide by k in order to take differntiation into account.
    """
    return 2*H(k-1)/k
@cached_function
def sum_a(k):
    """
    Summatory function of a(k), thus GF (-log(1-z))^2/(1-z).
    """
    if k<1:
        return 0
    else:
        return sum_a(k-1)+a(k)
@cached_function
def sum_sum_a(k):
    """
    Summatory function of sum_a(k), thus GF (-log(1-z))^2/(1-z)^2.
    """
    if k<1:
        return 0
    else:
        return sum_sum_a(k-1)+sum_a(k)
R.<z> = PowerSeriesRing(QQ, default_prec=100)
assert (log(1/(1-z)))^2 - sum(z^n*2*H(n-1)/n for n in range(1, 101)) == O(z^101)
assert (log(1/(1-z))/(1-z))^2 - sum(z^n*sum_sum_a(n) for n in range(1, 101)) == O(z^101)
%time result = [sum_sum_a(_) > 0 for _ in range(100, 50001, 100)]
ae = asymptotic_expansions._SingularityAnalysis_non_normalized_('n', 1, alpha=2, beta=2, precision=6); ae
ae.compare_with_values('n', sum_sum_a, srange(5000, 50001, 5000))
```



---

archive/issue_comments_361081.json:
```json
{
    "body": "Changing branch from \"u/dkrenn/asy/singularity-generator-log-non-normalized\" to \"4462b276a506a8a3439a4cad07fa1df09a4d6892\"",
    "created_at": "2016-02-15T19:28:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20020",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20020#issuecomment-361081",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/dkrenn/asy/singularity-generator-log-non-normalized" to "4462b276a506a8a3439a4cad07fa1df09a4d6892"



---

archive/issue_events_054557.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-02-15T19:28:33Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/20020",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20020#event-54557"
}
```



---

archive/issue_comments_361082.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-02-15T19:28:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20020",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20020#issuecomment-361082",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
