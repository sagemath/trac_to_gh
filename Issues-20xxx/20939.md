# Issue 20939: Fix crash and remove pexpect-Maxima usage in Y(m,n)

archive/issues_020702.json:
```json
{
    "body": "\n```\nsage: spherical_harmonic(3, 2, 1, 2*pi/3)\n...\nTypeError: ECL says: THROW: The catch MACSYMA-QUIT is undefined.\n```\nThe eval function of `SphericalHarmonic` uses pexpect-Maxima. Since this needs only a formula the call to Maxima could be replaced by a few lines of Python.\n\nhttp://dlmf.nist.gov/14.30.E1\n\nReplacing pexpect-Maxima is part of #17753.\n\n**Branch/Commit:** [bb4630fa7a2ac6b9b0a1d98486378877fe60f97c](https://github.com/sagemath/sagetrac-mirror/commit/bb4630fa7a2ac6b9b0a1d98486378877fe60f97c)\n\n**Upstream:** Fixed upstream, in a later stable release.\n\n**Reviewer:** Travis Scrimshaw\n\n**Author:** Ralf Stephan\n\n**Dependencies:** #21614, #21963\n\nIssue created by migration from https://trac.sagemath.org/ticket/20939\n\n",
    "closed_at": "2017-01-18T20:39:50Z",
    "created_at": "2016-07-05T07:20:36Z",
    "labels": [
        "component: symbolics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.5",
    "title": "Fix crash and remove pexpect-Maxima usage in Y(m,n)",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/20939",
    "user": "https://github.com/rwst"
}
```

```
sage: spherical_harmonic(3, 2, 1, 2*pi/3)
...
TypeError: ECL says: THROW: The catch MACSYMA-QUIT is undefined.
```
The eval function of `SphericalHarmonic` uses pexpect-Maxima. Since this needs only a formula the call to Maxima could be replaced by a few lines of Python.

http://dlmf.nist.gov/14.30.E1

Replacing pexpect-Maxima is part of #17753.

**Branch/Commit:** [bb4630fa7a2ac6b9b0a1d98486378877fe60f97c](https://github.com/sagemath/sagetrac-mirror/commit/bb4630fa7a2ac6b9b0a1d98486378877fe60f97c)

**Upstream:** Fixed upstream, in a later stable release.

**Reviewer:** Travis Scrimshaw

**Author:** Ralf Stephan

**Dependencies:** #21614, #21963

Issue created by migration from https://trac.sagemath.org/ticket/20939





---

archive/issue_comments_366490.json:
```json
{
    "body": "**Dependencies:** 16813",
    "created_at": "2016-08-04T06:12:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20939#issuecomment-366490",
    "user": "https://github.com/rwst"
}
```

**Dependencies:** 16813



---

archive/issue_comments_366491.json:
```json
{
    "body": "<a id='comment:1'></a>\nThis depends on the associated Legendre polynomials being implemented, e,g, #16813.",
    "created_at": "2016-08-04T06:12:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20939#issuecomment-366491",
    "user": "https://github.com/rwst"
}
```

<a id='comment:1'></a>
This depends on the associated Legendre polynomials being implemented, e,g, #16813.



---

archive/issue_comments_366492.json:
```json
{
    "body": "**Changing dependencies** from \"16813\" to \"#16813\".",
    "created_at": "2016-08-04T06:12:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20939#issuecomment-366492",
    "user": "https://github.com/rwst"
}
```

**Changing dependencies** from "16813" to "#16813".



---

archive/issue_comments_366493.json:
```json
{
    "body": "<a id='comment:3'></a>\nIt won't be dependent on `P(l,m,x)` if the P special value formula is directly used in `_eval_`. The Y floating point evaluation is done via mpmath anyway.",
    "created_at": "2016-08-04T06:31:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20939#issuecomment-366493",
    "user": "https://github.com/rwst"
}
```

<a id='comment:3'></a>
It won't be dependent on `P(l,m,x)` if the P special value formula is directly used in `_eval_`. The Y floating point evaluation is done via mpmath anyway.



---

archive/issue_comments_366494.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,12 +1,11 @@\n-The eval function of `SphericalHarmonic` uses pexpect-Maxima:\n \n ```\n-        if n in ZZ and m in ZZ and n > -1:\n-            if abs(m) > n:\n-                return ZZ(0)\n-            return maxima(\"spherical_harmonic({},{},{},{})\".format(\n-                ZZ(n), ZZ(m), maxima(theta), maxima(phi))).sage()\n+sage: spherical_harmonic(3, 2, 1, 2*pi/3)\n+...\n+TypeError: ECL says: THROW: The catch MACSYMA-QUIT is undefined.\n ```\n-This should be replaced by `maxima_lib` or something different without Maxima.\n+The eval function of `SphericalHarmonic` uses pexpect-Maxima. Since this needs only a formula the call to Maxima could be replaced by a few lines of Python.\n \n-Part of #17753.\n+http://dlmf.nist.gov/14.30.E1\n+\n+Replacing pexpect-Maxima is part of #17753.\n``````\n",
    "created_at": "2016-08-04T13:24:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20939#issuecomment-366494",
    "user": "https://github.com/rwst"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,12 +1,11 @@
-The eval function of `SphericalHarmonic` uses pexpect-Maxima:
 
 ```
-        if n in ZZ and m in ZZ and n > -1:
-            if abs(m) > n:
-                return ZZ(0)
-            return maxima("spherical_harmonic({},{},{},{})".format(
-                ZZ(n), ZZ(m), maxima(theta), maxima(phi))).sage()
+sage: spherical_harmonic(3, 2, 1, 2*pi/3)
+...
+TypeError: ECL says: THROW: The catch MACSYMA-QUIT is undefined.
 ```
-This should be replaced by `maxima_lib` or something different without Maxima.
+The eval function of `SphericalHarmonic` uses pexpect-Maxima. Since this needs only a formula the call to Maxima could be replaced by a few lines of Python.
 
-Part of #17753.
+http://dlmf.nist.gov/14.30.E1
+
+Replacing pexpect-Maxima is part of #17753.
``````




---

archive/issue_comments_366495.json:
```json
{
    "body": "**Changing dependencies** from \"#16813\" to \"\".",
    "created_at": "2016-08-04T13:24:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20939#issuecomment-366495",
    "user": "https://github.com/rwst"
}
```

**Changing dependencies** from "#16813" to "".



---

archive/issue_events_063366.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/20939",
    "rename": {
        "from": "Remove pexpect-Maxima usage in Y(m,n)",
        "to": "Fix crash and remove pexpect-Maxima usage in Y(m,n)"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20939#event-63366"
}
```



---

archive/issue_comments_366496.json:
```json
{
    "body": "**Branch:** [u/rws/remove_pexpect_maxima_usage_in_y_m_n_](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/remove_pexpect_maxima_usage_in_y_m_n_)",
    "created_at": "2016-08-04T14:42:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20939#issuecomment-366496",
    "user": "https://github.com/rwst"
}
```

**Branch:** [u/rws/remove_pexpect_maxima_usage_in_y_m_n_](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/remove_pexpect_maxima_usage_in_y_m_n_)



---

archive/issue_comments_366497.json:
```json
{
    "body": "**Commit:** [f233afa35058ab40a1f6f33e6d635e6eac515f97](https://github.com/sagemath/sagetrac-mirror/commit/f233afa35058ab40a1f6f33e6d635e6eac515f97)",
    "created_at": "2016-08-04T14:43:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20939#issuecomment-366497",
    "user": "https://github.com/rwst"
}
```

**Commit:** [f233afa35058ab40a1f6f33e6d635e6eac515f97](https://github.com/sagemath/sagetrac-mirror/commit/f233afa35058ab40a1f6f33e6d635e6eac515f97)



---

archive/issue_events_063367.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2016-08-04T14:43:32Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/20939",
    "milestone": "sage-7.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20939#event-63367"
}
```



---

archive/issue_comments_366498.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2016-08-04T14:43:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20939#issuecomment-366498",
    "user": "https://github.com/rwst"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_366499.json:
```json
{
    "body": "<a id='comment:6'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f233afa35058ab40a1f6f33e6d635e6eac515f97\">f233afa</a></td><td><code>20939: Fix crash and remove pexpect-Maxima usage in Y(m,n)</code></td></tr></table>\n",
    "created_at": "2016-08-04T14:43:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20939#issuecomment-366499",
    "user": "https://github.com/rwst"
}
```

<a id='comment:6'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f233afa35058ab40a1f6f33e6d635e6eac515f97">f233afa</a></td><td><code>20939: Fix crash and remove pexpect-Maxima usage in Y(m,n)</code></td></tr></table>




---

archive/issue_comments_366500.json:
```json
{
    "body": "**Author:** Ralf Stephan",
    "created_at": "2016-08-04T14:43:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20939#issuecomment-366500",
    "user": "https://github.com/rwst"
}
```

**Author:** Ralf Stephan



---

archive/issue_comments_366501.json:
```json
{
    "body": "<a id='comment:7'></a>\nLGTM modulo\n\n```diff\n         Check that :trac:`20939` is fixed::\n \n             sage: spherical_harmonic(3,2,1,2*pi/3)\n             1/240*sqrt(30)*(-15*I*sqrt(7)*sqrt(3) -\n-            ...15*sqrt(7))*cos(1)*sin(1)^2/sqrt(pi)\n+            ... + 15*sqrt(7))*cos(1)*sin(1)^2/sqrt(pi)\n         \"\"\"\n         if n in ZZ and m in ZZ and n > -1:\n             if abs(m) > n:\n                 return ZZ(0)\n-            if (m == 0 and theta.is_zero()):\n+            if m == 0 and theta.is_zero():\n                 return sqrt((2*n+1)/4/pi)\n```",
    "created_at": "2016-08-04T17:42:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20939#issuecomment-366501",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:7'></a>
LGTM modulo

```diff
         Check that :trac:`20939` is fixed::
 
             sage: spherical_harmonic(3,2,1,2*pi/3)
             1/240*sqrt(30)*(-15*I*sqrt(7)*sqrt(3) -
-            ...15*sqrt(7))*cos(1)*sin(1)^2/sqrt(pi)
+            ... + 15*sqrt(7))*cos(1)*sin(1)^2/sqrt(pi)
         """
         if n in ZZ and m in ZZ and n > -1:
             if abs(m) > n:
                 return ZZ(0)
-            if (m == 0 and theta.is_zero()):
+            if m == 0 and theta.is_zero():
                 return sqrt((2*n+1)/4/pi)
```



---

archive/issue_comments_366502.json:
```json
{
    "body": "**Reviewer:** Travis Scrimshaw",
    "created_at": "2016-08-04T17:42:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20939#issuecomment-366502",
    "user": "https://github.com/tscrim"
}
```

**Reviewer:** Travis Scrimshaw



---

archive/issue_comments_366503.json:
```json
{
    "body": "<a id='comment:8'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1a5cf6b9dbf75041e634a5c0d27b0a2a09932834\">1a5cf6b</a></td><td><code>20939: cosmetics</code></td></tr></table>\n",
    "created_at": "2016-08-05T06:18:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20939#issuecomment-366503",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1a5cf6b9dbf75041e634a5c0d27b0a2a09932834">1a5cf6b</a></td><td><code>20939: cosmetics</code></td></tr></table>




---

archive/issue_comments_366504.json:
```json
{
    "body": "**Changing commit** from \"[f233afa35058ab40a1f6f33e6d635e6eac515f97](https://github.com/sagemath/sagetrac-mirror/commit/f233afa35058ab40a1f6f33e6d635e6eac515f97)\" to \"[1a5cf6b9dbf75041e634a5c0d27b0a2a09932834](https://github.com/sagemath/sagetrac-mirror/commit/1a5cf6b9dbf75041e634a5c0d27b0a2a09932834)\".",
    "created_at": "2016-08-05T06:18:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20939#issuecomment-366504",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[f233afa35058ab40a1f6f33e6d635e6eac515f97](https://github.com/sagemath/sagetrac-mirror/commit/f233afa35058ab40a1f6f33e6d635e6eac515f97)" to "[1a5cf6b9dbf75041e634a5c0d27b0a2a09932834](https://github.com/sagemath/sagetrac-mirror/commit/1a5cf6b9dbf75041e634a5c0d27b0a2a09932834)".



---

archive/issue_comments_366505.json:
```json
{
    "body": "<a id='comment:9'></a>\nThat doesn't work as given. First the plus is a minus, and then the space after the ellipsis will make it fail too.\n\nI'll assume the last commit is still what you wanted and set positive. Just revert if not. Thanks for the review.",
    "created_at": "2016-08-05T06:22:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20939#issuecomment-366505",
    "user": "https://github.com/rwst"
}
```

<a id='comment:9'></a>
That doesn't work as given. First the plus is a minus, and then the space after the ellipsis will make it fail too.

I'll assume the last commit is still what you wanted and set positive. Just revert if not. Thanks for the review.



---

archive/issue_comments_366506.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2016-08-05T06:22:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20939#issuecomment-366506",
    "user": "https://github.com/rwst"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_366507.json:
```json
{
    "body": "**Changing commit** from \"[1a5cf6b9dbf75041e634a5c0d27b0a2a09932834](https://github.com/sagemath/sagetrac-mirror/commit/1a5cf6b9dbf75041e634a5c0d27b0a2a09932834)\" to \"[a080e1e8824bf56a760d54cbd7e6c9b79c351cef](https://github.com/sagemath/sagetrac-mirror/commit/a080e1e8824bf56a760d54cbd7e6c9b79c351cef)\".",
    "created_at": "2016-08-05T14:27:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20939#issuecomment-366507",
    "user": "https://github.com/tscrim"
}
```

**Changing commit** from "[1a5cf6b9dbf75041e634a5c0d27b0a2a09932834](https://github.com/sagemath/sagetrac-mirror/commit/1a5cf6b9dbf75041e634a5c0d27b0a2a09932834)" to "[a080e1e8824bf56a760d54cbd7e6c9b79c351cef](https://github.com/sagemath/sagetrac-mirror/commit/a080e1e8824bf56a760d54cbd7e6c9b79c351cef)".



---

archive/issue_comments_366508.json:
```json
{
    "body": "**Changing status** from positive_review to needs_review.",
    "created_at": "2016-08-05T14:27:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20939#issuecomment-366508",
    "user": "https://github.com/tscrim"
}
```

**Changing status** from positive_review to needs_review.



---

archive/issue_comments_366509.json:
```json
{
    "body": "<a id='comment:10'></a>\nSo the `...` is actually unneeded; I was thinking there was more than 2 terms. Please check my changes.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a080e1e8824bf56a760d54cbd7e6c9b79c351cef\">a080e1e</a></td><td><code>Removing uncessary ... in doctest.</code></td></tr></table>\n",
    "created_at": "2016-08-05T14:27:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20939#issuecomment-366509",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:10'></a>
So the `...` is actually unneeded; I was thinking there was more than 2 terms. Please check my changes.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a080e1e8824bf56a760d54cbd7e6c9b79c351cef">a080e1e</a></td><td><code>Removing uncessary ... in doctest.</code></td></tr></table>




---

archive/issue_comments_366510.json:
```json
{
    "body": "**Changing branch** from \"[u/rws/remove_pexpect_maxima_usage_in_y_m_n_](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/remove_pexpect_maxima_usage_in_y_m_n_)\" to \"[u/tscrim/remove_pexpect_maxima_in_ymn-20939](https://github.com/sagemath/sagetrac-mirror/tree/u/tscrim/remove_pexpect_maxima_in_ymn-20939)\".",
    "created_at": "2016-08-05T14:27:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20939#issuecomment-366510",
    "user": "https://github.com/tscrim"
}
```

**Changing branch** from "[u/rws/remove_pexpect_maxima_usage_in_y_m_n_](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/remove_pexpect_maxima_usage_in_y_m_n_)" to "[u/tscrim/remove_pexpect_maxima_in_ymn-20939](https://github.com/sagemath/sagetrac-mirror/tree/u/tscrim/remove_pexpect_maxima_in_ymn-20939)".



---

archive/issue_comments_366511.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2016-08-05T14:55:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20939#issuecomment-366511",
    "user": "https://github.com/rwst"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_366512.json:
```json
{
    "body": "**Changing status** from positive_review to needs_work.",
    "created_at": "2016-08-06T11:14:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20939#issuecomment-366512",
    "user": "https://github.com/vbraun"
}
```

**Changing status** from positive_review to needs_work.



---

archive/issue_comments_366513.json:
```json
{
    "body": "<a id='comment:12'></a>\nDocumentation doesn't build, see patchbot",
    "created_at": "2016-08-06T11:14:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20939#issuecomment-366513",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:12'></a>
Documentation doesn't build, see patchbot



---

archive/issue_comments_366514.json:
```json
{
    "body": "<a id='comment:13'></a>\nInteresting. I get this\n\n```\n[dochtml] [plot3d   ] /home/ralf/sage/src/doc/en/reference/plot3d/sage/plot/plot3d/plot3d.rst:1937: WARNING: Exception occurred in plotting plot3d-35\n[dochtml] [plot3d   ] from /home/ralf/sage/src/doc/en/reference/plot3d/sage/plot/plot3d/plot3d.rst:\n[dochtml] [plot3d   ] Traceback (most recent call last):\n[dochtml] [plot3d   ] File \"/home/ralf/sage/local/lib/python2.7/site-packages/matplotlib-1.5.1-py2.7-linux-x86_64.egg/matplotlib/sphinxext/plot_directive.py\", line 517, in run_code\n```\nI don't know how to get to the `plot3d-35` plot commands but:\n\n```\n[dochtml] [plot3d   ] result[0] = interp_rdf(args\n[dochtml] [plot3d   ] File \"sage/symbolic/function.pyx\", line 821, in sage.symbolic.function.GinacFunction.__call__ (build/cythonized/sage/symbolic/function.cpp:9409)\n[dochtml] [plot3d   ] res = super(GinacFunction, self).__call__(*args, **kwds)\n[dochtml] [plot3d   ] File \"sage/symbolic/function.pyx\", line 972, in sage.symbolic.function.BuiltinFunction.__call__ (build/cythonized/sage/symbolic/function.cpp:11034)\n[dochtml] [plot3d   ] res = super(BuiltinFunction, self).__call__(\n[dochtml] [plot3d   ] File \"sage/symbolic/function.pyx\", line 488, in sage.symbolic.function.Function.__call__ (build/cythonized/sage/symbolic/function.cpp:6886)\n[dochtml] [plot3d   ] res = g_function_eval2(self._serial, (<Expression>args[0])._gobj,\n[dochtml] [plot3d   ] RuntimeError: arctan2_eval(): arctan2(0,0) encountered\n```\nThe only calls to `atan2(x,y)` are in `revolution_plot3d()` and if I remove all its doctests it still crashes on build at this point, so I no longer know where to look. Either the 3d plot number 35 or the uncompiled `plot3d.rst` would be necessary.\n\nApart from the bug at hand I think Pynac's `atan2_eval` should return unsigned infinity instead of throwing an exception. There is a reason `atan2(0,0)` is called however.",
    "created_at": "2016-08-09T13:33:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20939#issuecomment-366514",
    "user": "https://github.com/rwst"
}
```

<a id='comment:13'></a>
Interesting. I get this

```
[dochtml] [plot3d   ] /home/ralf/sage/src/doc/en/reference/plot3d/sage/plot/plot3d/plot3d.rst:1937: WARNING: Exception occurred in plotting plot3d-35
[dochtml] [plot3d   ] from /home/ralf/sage/src/doc/en/reference/plot3d/sage/plot/plot3d/plot3d.rst:
[dochtml] [plot3d   ] Traceback (most recent call last):
[dochtml] [plot3d   ] File "/home/ralf/sage/local/lib/python2.7/site-packages/matplotlib-1.5.1-py2.7-linux-x86_64.egg/matplotlib/sphinxext/plot_directive.py", line 517, in run_code
```
I don't know how to get to the `plot3d-35` plot commands but:

```
[dochtml] [plot3d   ] result[0] = interp_rdf(args
[dochtml] [plot3d   ] File "sage/symbolic/function.pyx", line 821, in sage.symbolic.function.GinacFunction.__call__ (build/cythonized/sage/symbolic/function.cpp:9409)
[dochtml] [plot3d   ] res = super(GinacFunction, self).__call__(*args, **kwds)
[dochtml] [plot3d   ] File "sage/symbolic/function.pyx", line 972, in sage.symbolic.function.BuiltinFunction.__call__ (build/cythonized/sage/symbolic/function.cpp:11034)
[dochtml] [plot3d   ] res = super(BuiltinFunction, self).__call__(
[dochtml] [plot3d   ] File "sage/symbolic/function.pyx", line 488, in sage.symbolic.function.Function.__call__ (build/cythonized/sage/symbolic/function.cpp:6886)
[dochtml] [plot3d   ] res = g_function_eval2(self._serial, (<Expression>args[0])._gobj,
[dochtml] [plot3d   ] RuntimeError: arctan2_eval(): arctan2(0,0) encountered
```
The only calls to `atan2(x,y)` are in `revolution_plot3d()` and if I remove all its doctests it still crashes on build at this point, so I no longer know where to look. Either the 3d plot number 35 or the uncompiled `plot3d.rst` would be necessary.

Apart from the bug at hand I think Pynac's `atan2_eval` should return unsigned infinity instead of throwing an exception. There is a reason `atan2(0,0)` is called however.



---

archive/issue_comments_366515.json:
```json
{
    "body": "<a id='comment:14'></a>\nThis is the trigger:\n\n```\nsage: phi, theta = var('phi, theta')\nsage: Y = spherical_harmonic(2, 1, theta, phi)\nsage: rea = spherical_plot3d(abs(real(Y)), (phi,0,2*pi), (theta,0,pi), color='bl\n....: ue', opacity=0.6)\nsage: ima = spherical_plot3d(abs(imag(Y)), (phi,0,2*pi), (theta,0,pi), color='re\n....: d', opacity=0.6)\nsage:  (rea + ima).show(aspect_ratio=1)\n---------------------------------------------------------------------------\nRuntimeError: arctan2_eval(): arctan2(0,0) encountered\n```",
    "created_at": "2016-09-30T07:44:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20939#issuecomment-366515",
    "user": "https://github.com/rwst"
}
```

<a id='comment:14'></a>
This is the trigger:

```
sage: phi, theta = var('phi, theta')
sage: Y = spherical_harmonic(2, 1, theta, phi)
sage: rea = spherical_plot3d(abs(real(Y)), (phi,0,2*pi), (theta,0,pi), color='bl
....: ue', opacity=0.6)
sage: ima = spherical_plot3d(abs(imag(Y)), (phi,0,2*pi), (theta,0,pi), color='re
....: d', opacity=0.6)
sage:  (rea + ima).show(aspect_ratio=1)
---------------------------------------------------------------------------
RuntimeError: arctan2_eval(): arctan2(0,0) encountered
```



---

archive/issue_comments_366516.json:
```json
{
    "body": "<a id='comment:15'></a>\nThe new code makes `Y` expand immediately, and the `real/imag` calls then really blow it up.\n\n```\nsage: Y = 1/4*sqrt(6)*sqrt(5)*sqrt(sin(theta)^2)*cos(theta)*e^(I*phi)/sqrt(pi)\nsage: abs(real(Y))\nabs(1/4*sqrt(6)*sqrt(5)*sqrt(abs(sin(theta))^2)*cos(1/2*\\\narctan2(2*cos(real_part(theta))*cosh(imag_part(theta))*sin(real_part(theta))*sinh(imag_part(theta)),\ncosh(imag_part(theta))^2*sin(real_part(theta))^2-cos(real_part(theta))^2*sinh(imag_part(theta))^2))\n*cos(real_part(phi))*cos(real_part(theta))*cosh(imag_part(theta))*e^(-imag_part(phi))/sqrt(pi) - \n1/4*sqrt(6)*sqrt(5)*sqrt(abs(sin(theta))^2)*cos(real_part(theta))*cosh(imag_part(theta))*e^(-imag_part(phi))*sin(1/2*arctan2(2*cos(real_part(theta))*cosh(imag_part(theta))*sin(real_part(theta))*sinh(imag_part(theta)), cosh(imag_part(theta))^2*sin(real_part(theta))^2 - cos(real_part(theta))^2*sinh(imag_part(theta))^2))*sin(real_part(phi))/sqrt(pi) + 1/4*sqrt(6)*sqrt(5)*sqrt(abs(sin(theta))^2)*cos(real_part(phi))*e^(-imag_part(phi))*sin(1/2*arctan2(2*cos(real_part(theta))*cosh(imag_part(theta))*sin(real_part(theta))*sinh(imag_part(theta)), cosh(imag_part(theta))^2*sin(real_part(theta))^2 - cos(real_part(theta))^2*sinh(imag_part(theta))^2))*sin(real_part(theta))*sinh(imag_part(theta))/sqrt(pi) + 1/4*sqrt(6)*sqrt(5)*sqrt(abs(sin(theta))^2)*cos(1/2*arctan2(2*cos(real_part(theta))*cosh(imag_part(theta))*sin(real_part(theta))*sinh(imag_part(theta)), cosh(imag_part(theta))^2*sin(real_part(theta))^2 - cos(real_part(theta))^2*sinh(imag_part(theta))^2))*e^(-imag_part(phi))*sin(real_part(phi))*sin(real_part(theta))*sinh(imag_part(theta))/sqrt(pi))\n```",
    "created_at": "2016-09-30T14:32:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20939#issuecomment-366516",
    "user": "https://github.com/rwst"
}
```

<a id='comment:15'></a>
The new code makes `Y` expand immediately, and the `real/imag` calls then really blow it up.

```
sage: Y = 1/4*sqrt(6)*sqrt(5)*sqrt(sin(theta)^2)*cos(theta)*e^(I*phi)/sqrt(pi)
sage: abs(real(Y))
abs(1/4*sqrt(6)*sqrt(5)*sqrt(abs(sin(theta))^2)*cos(1/2*\
arctan2(2*cos(real_part(theta))*cosh(imag_part(theta))*sin(real_part(theta))*sinh(imag_part(theta)),
cosh(imag_part(theta))^2*sin(real_part(theta))^2-cos(real_part(theta))^2*sinh(imag_part(theta))^2))
*cos(real_part(phi))*cos(real_part(theta))*cosh(imag_part(theta))*e^(-imag_part(phi))/sqrt(pi) - 
1/4*sqrt(6)*sqrt(5)*sqrt(abs(sin(theta))^2)*cos(real_part(theta))*cosh(imag_part(theta))*e^(-imag_part(phi))*sin(1/2*arctan2(2*cos(real_part(theta))*cosh(imag_part(theta))*sin(real_part(theta))*sinh(imag_part(theta)), cosh(imag_part(theta))^2*sin(real_part(theta))^2 - cos(real_part(theta))^2*sinh(imag_part(theta))^2))*sin(real_part(phi))/sqrt(pi) + 1/4*sqrt(6)*sqrt(5)*sqrt(abs(sin(theta))^2)*cos(real_part(phi))*e^(-imag_part(phi))*sin(1/2*arctan2(2*cos(real_part(theta))*cosh(imag_part(theta))*sin(real_part(theta))*sinh(imag_part(theta)), cosh(imag_part(theta))^2*sin(real_part(theta))^2 - cos(real_part(theta))^2*sinh(imag_part(theta))^2))*sin(real_part(theta))*sinh(imag_part(theta))/sqrt(pi) + 1/4*sqrt(6)*sqrt(5)*sqrt(abs(sin(theta))^2)*cos(1/2*arctan2(2*cos(real_part(theta))*cosh(imag_part(theta))*sin(real_part(theta))*sinh(imag_part(theta)), cosh(imag_part(theta))^2*sin(real_part(theta))^2 - cos(real_part(theta))^2*sinh(imag_part(theta))^2))*e^(-imag_part(phi))*sin(real_part(phi))*sin(real_part(theta))*sinh(imag_part(theta))/sqrt(pi))
```



---

archive/issue_comments_366517.json:
```json
{
    "body": "<a id='comment:16'></a>\n\n```\nsage: x=abs(real(Y))\nsage: x.subs(theta==0)\n...\nRuntimeError: arctan2_eval(): arctan2(0,0) encountered\nsage: y=abs(imag(Y))\nsage: y.subs(theta==0)\n...\nRuntimeError: arctan2_eval(): arctan2(0,0) encountered\nsage: Y\n1/4*sqrt(6)*sqrt(5)*sqrt(sin(theta)^2)*cos(theta)*e^(I*phi)/sqrt(pi)\nsage: Y.subs(theta==0)\n0\n```\nSo it seems the `real/imag` expansions produce results in some cases that are not defined at zero, so are not correct.",
    "created_at": "2016-09-30T15:23:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20939#issuecomment-366517",
    "user": "https://github.com/rwst"
}
```

<a id='comment:16'></a>

```
sage: x=abs(real(Y))
sage: x.subs(theta==0)
...
RuntimeError: arctan2_eval(): arctan2(0,0) encountered
sage: y=abs(imag(Y))
sage: y.subs(theta==0)
...
RuntimeError: arctan2_eval(): arctan2(0,0) encountered
sage: Y
1/4*sqrt(6)*sqrt(5)*sqrt(sin(theta)^2)*cos(theta)*e^(I*phi)/sqrt(pi)
sage: Y.subs(theta==0)
0
```
So it seems the `real/imag` expansions produce results in some cases that are not defined at zero, so are not correct.



---

archive/issue_comments_366518.json:
```json
{
    "body": "**Dependencies:** #21614",
    "created_at": "2016-09-30T15:49:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20939#issuecomment-366518",
    "user": "https://github.com/rwst"
}
```

**Dependencies:** #21614



---

archive/issue_comments_366519.json:
```json
{
    "body": "**Changing status** from needs_work to positive_review.",
    "created_at": "2016-11-10T08:35:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20939#issuecomment-366519",
    "user": "https://github.com/rwst"
}
```

**Changing status** from needs_work to positive_review.



---

archive/issue_comments_366520.json:
```json
{
    "body": "<a id='comment:18'></a>\nSo to summarize the code here is good, we just depend on #21614.",
    "created_at": "2016-11-10T08:35:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20939#issuecomment-366520",
    "user": "https://github.com/rwst"
}
```

<a id='comment:18'></a>
So to summarize the code here is good, we just depend on #21614.



---

archive/issue_comments_366521.json:
```json
{
    "body": "**Changing status** from positive_review to needs_work.",
    "created_at": "2016-11-13T16:08:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20939#issuecomment-366521",
    "user": "https://github.com/vbraun"
}
```

**Changing status** from positive_review to needs_work.



---

archive/issue_comments_366522.json:
```json
{
    "body": "<a id='comment:19'></a>\n\n```\nFile \"src/sage/plot/plot3d/plot3d.py\", line 1195, in sage.plot.plot3d.plot3d.spherical_plot3d\nFailed example:\n    (rea + ima).show(aspect_ratio=1)  # long time (4s on sage.math, 2011)\nException raised:\n    Traceback (most recent call last):\n      File \"/home/chapoton/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 498, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/chapoton/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 861, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.plot.plot3d.plot3d.spherical_plot3d[13]>\", line 1, in <module>\n        (rea + ima).show(aspect_ratio=Integer(1))  # long time (4s on sage.math, 2011)\n      File \"sage/plot/plot3d/base.pyx\", line 1379, in sage.plot.plot3d.base.Graphics3d.show (build/cythonized/sage/plot/plot3d/base.c:17925)\n        dm.display_immediately(self, **kwds)\n      File \"/home/chapoton/sage/local/lib/python2.7/site-packages/sage/repl/rich_output/display_manager.py\", line 791, in display_immediately\n        plain_text, rich_output = self._rich_output_formatter(obj, rich_repr_kwds)\n      File \"/home/chapoton/sage/local/lib/python2.7/site-packages/sage/repl/rich_output/display_manager.py\", line 623, in _rich_output_formatter\n        rich_output = self._call_rich_repr(obj, rich_repr_kwds)\n      File \"/home/chapoton/sage/local/lib/python2.7/site-packages/sage/repl/rich_output/display_manager.py\", line 581, in _call_rich_repr\n        return obj._rich_repr_(self, **rich_repr_kwds)\n      File \"sage/plot/plot3d/base.pyx\", line 130, in sage.plot.plot3d.base.Graphics3d._rich_repr_ (build/cythonized/sage/plot/plot3d/base.c:4422)\n        opts = self._process_viewing_options(kwds)\n      File \"sage/plot/plot3d/base.pyx\", line 1257, in sage.plot.plot3d.base.Graphics3d._process_viewing_options (build/cythonized/sage/plot/plot3d/base.c:17397)\n        self._determine_frame_aspect_ratio(opts['aspect_ratio'])\n      File \"sage/plot/plot3d/base.pyx\", line 472, in sage.plot.plot3d.base.Graphics3d._determine_frame_aspect_ratio (build/cythonized/sage/plot/plot3d/base.c:9247)\n        a_min, a_max = self._safe_bounding_box()\n      File \"sage/plot/plot3d/base.pyx\", line 490, in sage.plot.plot3d.base.Graphics3d._safe_bounding_box (build/cythonized/sage/plot/plot3d/base.c:9420)\n        a_min, a_max = self.bounding_box()\n      File \"sage/plot/plot3d/base.pyx\", line 1831, in sage.plot.plot3d.base.Graphics3dGroup.bounding_box (build/cythonized/sage/plot/plot3d/base.c:24445)\n        v = [obj.bounding_box() for obj in self.all]\n      File \"sage/plot/plot3d/parametric_surface.pyx\", line 379, in sage.plot.plot3d.parametric_surface.ParametricSurface.bounding_box (build/cythonized/sage/plot/plot3d/parametric_surface.c:5079)\n        self.triangulate()\n      File \"sage/plot/plot3d/parametric_surface.pyx\", line 427, in sage.plot.plot3d.parametric_surface.ParametricSurface.triangulate (build/cythonized/sage/plot/plot3d/parametric_surface.c:5826)\n        raise\n      File \"sage/plot/plot3d/parametric_surface.pyx\", line 422, in sage.plot.plot3d.parametric_surface.ParametricSurface.triangulate (build/cythonized/sage/plot/plot3d/parametric_surface.c:5746)\n        self.eval_grid(urange, vrange)\n      File \"sage/plot/plot3d/parametric_surface.pyx\", line 601, in sage.plot.plot3d.parametric_surface.ParametricSurface.eval_grid (build/cythonized/sage/plot/plot3d/parametric_surface.c:7437)\n        (<Wrapper_rdf>fx).call_c(uv, &self.vs[i*n+j].x)\n      File \"sage/ext/interpreters/wrapper_rdf.pyx\", line 90, in sage.ext.interpreters.wrapper_rdf.Wrapper_rdf.call_c (build/cythonized/sage/ext/interpreters/wrapper_rdf.c:2163)\n        result[0] = interp_rdf(args\n      File \"sage/symbolic/expression.pyx\", line 1410, in sage.symbolic.expression.Expression.__float__ (build/cythonized/sage/symbolic/expression.cpp:11032)\n        ret = float(self._eval_self(float))\n      File \"sage/symbolic/expression.pyx\", line 1197, in sage.symbolic.expression.Expression._eval_self (build/cythonized/sage/symbolic/expression.cpp:9741)\n        res = self._gobj.evalf(0, {'parent':R})\n      File \"sage/libs/pynac/pynac.pyx\", line 2160, in sage.libs.pynac.pynac.py_eval_constant (build/cythonized/sage/libs/pynac/pynac.cpp:25827)\n        constant = constants_table[serial]\n    KeyError: 3\n```",
    "created_at": "2016-11-13T16:08:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20939#issuecomment-366522",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:19'></a>

```
File "src/sage/plot/plot3d/plot3d.py", line 1195, in sage.plot.plot3d.plot3d.spherical_plot3d
Failed example:
    (rea + ima).show(aspect_ratio=1)  # long time (4s on sage.math, 2011)
Exception raised:
    Traceback (most recent call last):
      File "/home/chapoton/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 498, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/chapoton/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 861, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.plot.plot3d.plot3d.spherical_plot3d[13]>", line 1, in <module>
        (rea + ima).show(aspect_ratio=Integer(1))  # long time (4s on sage.math, 2011)
      File "sage/plot/plot3d/base.pyx", line 1379, in sage.plot.plot3d.base.Graphics3d.show (build/cythonized/sage/plot/plot3d/base.c:17925)
        dm.display_immediately(self, **kwds)
      File "/home/chapoton/sage/local/lib/python2.7/site-packages/sage/repl/rich_output/display_manager.py", line 791, in display_immediately
        plain_text, rich_output = self._rich_output_formatter(obj, rich_repr_kwds)
      File "/home/chapoton/sage/local/lib/python2.7/site-packages/sage/repl/rich_output/display_manager.py", line 623, in _rich_output_formatter
        rich_output = self._call_rich_repr(obj, rich_repr_kwds)
      File "/home/chapoton/sage/local/lib/python2.7/site-packages/sage/repl/rich_output/display_manager.py", line 581, in _call_rich_repr
        return obj._rich_repr_(self, **rich_repr_kwds)
      File "sage/plot/plot3d/base.pyx", line 130, in sage.plot.plot3d.base.Graphics3d._rich_repr_ (build/cythonized/sage/plot/plot3d/base.c:4422)
        opts = self._process_viewing_options(kwds)
      File "sage/plot/plot3d/base.pyx", line 1257, in sage.plot.plot3d.base.Graphics3d._process_viewing_options (build/cythonized/sage/plot/plot3d/base.c:17397)
        self._determine_frame_aspect_ratio(opts['aspect_ratio'])
      File "sage/plot/plot3d/base.pyx", line 472, in sage.plot.plot3d.base.Graphics3d._determine_frame_aspect_ratio (build/cythonized/sage/plot/plot3d/base.c:9247)
        a_min, a_max = self._safe_bounding_box()
      File "sage/plot/plot3d/base.pyx", line 490, in sage.plot.plot3d.base.Graphics3d._safe_bounding_box (build/cythonized/sage/plot/plot3d/base.c:9420)
        a_min, a_max = self.bounding_box()
      File "sage/plot/plot3d/base.pyx", line 1831, in sage.plot.plot3d.base.Graphics3dGroup.bounding_box (build/cythonized/sage/plot/plot3d/base.c:24445)
        v = [obj.bounding_box() for obj in self.all]
      File "sage/plot/plot3d/parametric_surface.pyx", line 379, in sage.plot.plot3d.parametric_surface.ParametricSurface.bounding_box (build/cythonized/sage/plot/plot3d/parametric_surface.c:5079)
        self.triangulate()
      File "sage/plot/plot3d/parametric_surface.pyx", line 427, in sage.plot.plot3d.parametric_surface.ParametricSurface.triangulate (build/cythonized/sage/plot/plot3d/parametric_surface.c:5826)
        raise
      File "sage/plot/plot3d/parametric_surface.pyx", line 422, in sage.plot.plot3d.parametric_surface.ParametricSurface.triangulate (build/cythonized/sage/plot/plot3d/parametric_surface.c:5746)
        self.eval_grid(urange, vrange)
      File "sage/plot/plot3d/parametric_surface.pyx", line 601, in sage.plot.plot3d.parametric_surface.ParametricSurface.eval_grid (build/cythonized/sage/plot/plot3d/parametric_surface.c:7437)
        (<Wrapper_rdf>fx).call_c(uv, &self.vs[i*n+j].x)
      File "sage/ext/interpreters/wrapper_rdf.pyx", line 90, in sage.ext.interpreters.wrapper_rdf.Wrapper_rdf.call_c (build/cythonized/sage/ext/interpreters/wrapper_rdf.c:2163)
        result[0] = interp_rdf(args
      File "sage/symbolic/expression.pyx", line 1410, in sage.symbolic.expression.Expression.__float__ (build/cythonized/sage/symbolic/expression.cpp:11032)
        ret = float(self._eval_self(float))
      File "sage/symbolic/expression.pyx", line 1197, in sage.symbolic.expression.Expression._eval_self (build/cythonized/sage/symbolic/expression.cpp:9741)
        res = self._gobj.evalf(0, {'parent':R})
      File "sage/libs/pynac/pynac.pyx", line 2160, in sage.libs.pynac.pynac.py_eval_constant (build/cythonized/sage/libs/pynac/pynac.cpp:25827)
        constant = constants_table[serial]
    KeyError: 3
```



---

archive/issue_comments_366523.json:
```json
{
    "body": "<a id='comment:20'></a>\nI should say I saw it too. `plot3d-35` is still problematic with this here.",
    "created_at": "2016-11-13T20:11:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20939#issuecomment-366523",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:20'></a>
I should say I saw it too. `plot3d-35` is still problematic with this here.



---

archive/issue_comments_366524.json:
```json
{
    "body": "**Changing branch** from \"[u/tscrim/remove_pexpect_maxima_in_ymn-20939](https://github.com/sagemath/sagetrac-mirror/tree/u/tscrim/remove_pexpect_maxima_in_ymn-20939)\" to \"[u/rws/remove_pexpect_maxima_in_ymn-20939](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/remove_pexpect_maxima_in_ymn-20939)\".",
    "created_at": "2016-11-14T07:28:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20939#issuecomment-366524",
    "user": "https://github.com/rwst"
}
```

**Changing branch** from "[u/tscrim/remove_pexpect_maxima_in_ymn-20939](https://github.com/sagemath/sagetrac-mirror/tree/u/tscrim/remove_pexpect_maxima_in_ymn-20939)" to "[u/rws/remove_pexpect_maxima_in_ymn-20939](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/remove_pexpect_maxima_in_ymn-20939)".



---

archive/issue_comments_366525.json:
```json
{
    "body": "<a id='comment:22'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/55deed789b8d56d475f0bd4b95f25d221c8257d0\">55deed7</a></td><td><code>Merge branch 'develop' into t/20939/remove_pexpect_maxima_in_ymn-20939</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/31e6c649c586363c621f2daabf805283be10775a\">31e6c64</a></td><td><code>20939: fix NaN handling</code></td></tr></table>\n",
    "created_at": "2016-11-14T07:28:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20939#issuecomment-366525",
    "user": "https://github.com/rwst"
}
```

<a id='comment:22'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/55deed789b8d56d475f0bd4b95f25d221c8257d0">55deed7</a></td><td><code>Merge branch 'develop' into t/20939/remove_pexpect_maxima_in_ymn-20939</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/31e6c649c586363c621f2daabf805283be10775a">31e6c64</a></td><td><code>20939: fix NaN handling</code></td></tr></table>




---

archive/issue_comments_366526.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2016-11-14T07:28:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20939#issuecomment-366526",
    "user": "https://github.com/rwst"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_366527.json:
```json
{
    "body": "**Changing commit** from \"[a080e1e8824bf56a760d54cbd7e6c9b79c351cef](https://github.com/sagemath/sagetrac-mirror/commit/a080e1e8824bf56a760d54cbd7e6c9b79c351cef)\" to \"[31e6c649c586363c621f2daabf805283be10775a](https://github.com/sagemath/sagetrac-mirror/commit/31e6c649c586363c621f2daabf805283be10775a)\".",
    "created_at": "2016-11-14T07:28:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20939#issuecomment-366527",
    "user": "https://github.com/rwst"
}
```

**Changing commit** from "[a080e1e8824bf56a760d54cbd7e6c9b79c351cef](https://github.com/sagemath/sagetrac-mirror/commit/a080e1e8824bf56a760d54cbd7e6c9b79c351cef)" to "[31e6c649c586363c621f2daabf805283be10775a](https://github.com/sagemath/sagetrac-mirror/commit/31e6c649c586363c621f2daabf805283be10775a)".



---

archive/issue_comments_366528.json:
```json
{
    "body": "<a id='comment:23'></a>\nWould it be possible to have a test to make sure this stays fixed?",
    "created_at": "2016-11-14T14:52:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20939#issuecomment-366528",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:23'></a>
Would it be possible to have a test to make sure this stays fixed?



---

archive/issue_comments_366529.json:
```json
{
    "body": "<a id='comment:24'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/04f79cdf8ed0c887b7f7d1797ce5023f782d0a50\">04f79cd</a></td><td><code>20939: make sure atan2(0,0) returns always NaN</code></td></tr></table>\n",
    "created_at": "2016-11-14T16:41:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20939#issuecomment-366529",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:24'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/04f79cdf8ed0c887b7f7d1797ce5023f782d0a50">04f79cd</a></td><td><code>20939: make sure atan2(0,0) returns always NaN</code></td></tr></table>




---

archive/issue_comments_366530.json:
```json
{
    "body": "**Changing commit** from \"[31e6c649c586363c621f2daabf805283be10775a](https://github.com/sagemath/sagetrac-mirror/commit/31e6c649c586363c621f2daabf805283be10775a)\" to \"[04f79cdf8ed0c887b7f7d1797ce5023f782d0a50](https://github.com/sagemath/sagetrac-mirror/commit/04f79cdf8ed0c887b7f7d1797ce5023f782d0a50)\".",
    "created_at": "2016-11-14T16:41:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20939#issuecomment-366530",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[31e6c649c586363c621f2daabf805283be10775a](https://github.com/sagemath/sagetrac-mirror/commit/31e6c649c586363c621f2daabf805283be10775a)" to "[04f79cdf8ed0c887b7f7d1797ce5023f782d0a50](https://github.com/sagemath/sagetrac-mirror/commit/04f79cdf8ed0c887b7f7d1797ce5023f782d0a50)".



---

archive/issue_comments_366531.json:
```json
{
    "body": "<a id='comment:25'></a>\nThis commit contains a test for the specific `NaN` evaluation problem causing the second crash (the fix for the first crash is tested with #21614). The commit also fixes an inconsistency. As to a general test of the second problem I opened https://github.com/pynac/pynac/issues/211",
    "created_at": "2016-11-14T16:44:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20939#issuecomment-366531",
    "user": "https://github.com/rwst"
}
```

<a id='comment:25'></a>
This commit contains a test for the specific `NaN` evaluation problem causing the second crash (the fix for the first crash is tested with #21614). The commit also fixes an inconsistency. As to a general test of the second problem I opened https://github.com/pynac/pynac/issues/211



---

archive/issue_comments_366532.json:
```json
{
    "body": "<a id='comment:26'></a>\nThanks. Now back to the buildbots.",
    "created_at": "2016-11-14T17:12:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20939#issuecomment-366532",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:26'></a>
Thanks. Now back to the buildbots.



---

archive/issue_comments_366533.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2016-11-14T17:12:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20939#issuecomment-366533",
    "user": "https://github.com/tscrim"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_366534.json:
```json
{
    "body": "<a id='comment:27'></a>\nI don know what Volker will report if anything but now I have a segfault in `constant.py`\n\n```\nsage: sig_on_count() # check sig_on/off pairings (virtual doctest) ## line 688 ##\n0\nsage: loads(dumps(NaN)) ## line 704 ##\n------------------------------------------------------------------------\n/usr/lib64/python2.7/site-packages/cysignals/signals.so(+0x4556)[0x7f4f180eb556]\n/usr/lib64/python2.7/site-packages/cysignals/signals.so(+0x4a6c)[0x7f4f180eba6c]\n/usr/lib64/python2.7/site-packages/cysignals/signals.so(+0x6d6f)[0x7f4f180edd6f]\n/lib64/libpthread.so.0(+0x10d70)[0x7f4f1ce53d70]\n/usr/lib64/python2.7/site-packages/sage/libs/pynac/pynac.so(+0x2940d)[0x7f4d3ece640d]\n/usr/lib64/libpynac.so.8(_ZN5GiNaC8constant9unarchiveERKNS_12archive_nodeERNS_9containerINSt7__cxx114listEEE+0x196)[0x7f4d3e955dcc]\n/usr/lib64/libpynac.so.8(_ZNK5GiNaC12archive_node9unarchiveERNS_9containerINSt7__cxx114listEEE+0xf4)[0x7f4d3e936836]\n/usr/lib64/libpynac.so.8(_ZNK5GiNaC7archive12unarchive_exERKNS_9containerINSt7__cxx114listEEEj+0x130)[0x7f4d3e936a42]\n/usr/lib64/python2.7/site-packages/sage/symbolic/expression.so(+0xec87f)[0x7f4d3e63787f]\n/usr/lib64/python2.7/site-packages/sage/symbolic/expression.so(+0xecc2a)[0x7f4d3e637c2a]\n/usr/lib64/libpython2.7.so.1.0(PyCFunction_Call+0xf1)[0x7f4f1d0ddbd9]\n/usr/lib64/libpython2.7.so.1.0(PyObject_Call+0x5c)[0x7f4f1d0a8123]\n```",
    "created_at": "2016-11-16T01:46:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20939#issuecomment-366534",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:27'></a>
I don know what Volker will report if anything but now I have a segfault in `constant.py`

```
sage: sig_on_count() # check sig_on/off pairings (virtual doctest) ## line 688 ##
0
sage: loads(dumps(NaN)) ## line 704 ##
------------------------------------------------------------------------
/usr/lib64/python2.7/site-packages/cysignals/signals.so(+0x4556)[0x7f4f180eb556]
/usr/lib64/python2.7/site-packages/cysignals/signals.so(+0x4a6c)[0x7f4f180eba6c]
/usr/lib64/python2.7/site-packages/cysignals/signals.so(+0x6d6f)[0x7f4f180edd6f]
/lib64/libpthread.so.0(+0x10d70)[0x7f4f1ce53d70]
/usr/lib64/python2.7/site-packages/sage/libs/pynac/pynac.so(+0x2940d)[0x7f4d3ece640d]
/usr/lib64/libpynac.so.8(_ZN5GiNaC8constant9unarchiveERKNS_12archive_nodeERNS_9containerINSt7__cxx114listEEE+0x196)[0x7f4d3e955dcc]
/usr/lib64/libpynac.so.8(_ZNK5GiNaC12archive_node9unarchiveERNS_9containerINSt7__cxx114listEEE+0xf4)[0x7f4d3e936836]
/usr/lib64/libpynac.so.8(_ZNK5GiNaC7archive12unarchive_exERKNS_9containerINSt7__cxx114listEEEj+0x130)[0x7f4d3e936a42]
/usr/lib64/python2.7/site-packages/sage/symbolic/expression.so(+0xec87f)[0x7f4d3e63787f]
/usr/lib64/python2.7/site-packages/sage/symbolic/expression.so(+0xecc2a)[0x7f4d3e637c2a]
/usr/lib64/libpython2.7.so.1.0(PyCFunction_Call+0xf1)[0x7f4f1d0ddbd9]
/usr/lib64/libpython2.7.so.1.0(PyObject_Call+0x5c)[0x7f4f1d0a8123]
```



---

archive/issue_comments_366535.json:
```json
{
    "body": "<a id='comment:28'></a>\nConfirmed. I'm sorry. With Pynac changes I have a testing procedure in place here, but with Python I was relying on patchbot. This issue is also somewhat unusual as to the surprising problems presented.",
    "created_at": "2016-11-16T07:53:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20939#issuecomment-366535",
    "user": "https://github.com/rwst"
}
```

<a id='comment:28'></a>
Confirmed. I'm sorry. With Pynac changes I have a testing procedure in place here, but with Python I was relying on patchbot. This issue is also somewhat unusual as to the surprising problems presented.



---

archive/issue_comments_366536.json:
```json
{
    "body": "**Changing status** from positive_review to needs_work.",
    "created_at": "2016-11-16T07:53:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20939#issuecomment-366536",
    "user": "https://github.com/rwst"
}
```

**Changing status** from positive_review to needs_work.



---

archive/issue_comments_366537.json:
```json
{
    "body": "<a id='comment:29'></a>\nSame here...",
    "created_at": "2016-11-16T07:54:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20939#issuecomment-366537",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:29'></a>
Same here...



---

archive/issue_comments_366538.json:
```json
{
    "body": "<a id='comment:30'></a>\nPositive stuff for me, it made me realise that some bits of `cysignals` are not currently working properly on Gentoo - even so the tests pass :(",
    "created_at": "2016-11-16T07:57:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20939#issuecomment-366538",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:30'></a>
Positive stuff for me, it made me realise that some bits of `cysignals` are not currently working properly on Gentoo - even so the tests pass :(



---

archive/issue_comments_366539.json:
```json
{
    "body": "**Changing upstream** from \"N/A\" to \"Fixed upstream, in a later stable release.\".",
    "created_at": "2016-11-16T14:07:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20939#issuecomment-366539",
    "user": "https://github.com/rwst"
}
```

**Changing upstream** from "N/A" to "Fixed upstream, in a later stable release.".



---

archive/issue_comments_366540.json:
```json
{
    "body": "**Changing dependencies** from \"#21614\" to \"#21614, pynac-0.7.1\".",
    "created_at": "2016-11-16T14:07:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20939#issuecomment-366540",
    "user": "https://github.com/rwst"
}
```

**Changing dependencies** from "#21614" to "#21614, pynac-0.7.1".



---

archive/issue_comments_366541.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2016-11-24T16:34:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20939#issuecomment-366541",
    "user": "https://github.com/rwst"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_366542.json:
```json
{
    "body": "**Changing dependencies** from \"#21614, pynac-0.7.1\" to \"#21614, #21963\".",
    "created_at": "2016-11-24T16:34:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20939#issuecomment-366542",
    "user": "https://github.com/rwst"
}
```

**Changing dependencies** from "#21614, pynac-0.7.1" to "#21614, #21963".



---

archive/issue_comments_366543.json:
```json
{
    "body": "**Changing commit** from \"[04f79cdf8ed0c887b7f7d1797ce5023f782d0a50](https://github.com/sagemath/sagetrac-mirror/commit/04f79cdf8ed0c887b7f7d1797ce5023f782d0a50)\" to \"[bb4630fa7a2ac6b9b0a1d98486378877fe60f97c](https://github.com/sagemath/sagetrac-mirror/commit/bb4630fa7a2ac6b9b0a1d98486378877fe60f97c)\".",
    "created_at": "2016-12-20T16:00:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20939#issuecomment-366543",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[04f79cdf8ed0c887b7f7d1797ce5023f782d0a50](https://github.com/sagemath/sagetrac-mirror/commit/04f79cdf8ed0c887b7f7d1797ce5023f782d0a50)" to "[bb4630fa7a2ac6b9b0a1d98486378877fe60f97c](https://github.com/sagemath/sagetrac-mirror/commit/bb4630fa7a2ac6b9b0a1d98486378877fe60f97c)".



---

archive/issue_comments_366544.json:
```json
{
    "body": "<a id='comment:33'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bb4630fa7a2ac6b9b0a1d98486378877fe60f97c\">bb4630f</a></td><td><code>Merge branch 'develop' into t/20939/remove_pexpect_maxima_in_ymn-20939</code></td></tr></table>\n",
    "created_at": "2016-12-20T16:00:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20939#issuecomment-366544",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:33'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bb4630fa7a2ac6b9b0a1d98486378877fe60f97c">bb4630f</a></td><td><code>Merge branch 'develop' into t/20939/remove_pexpect_maxima_in_ymn-20939</code></td></tr></table>




---

archive/issue_comments_366545.json:
```json
{
    "body": "<a id='comment:34'></a>\nLet's try again.",
    "created_at": "2016-12-20T20:51:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20939#issuecomment-366545",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:34'></a>
Let's try again.



---

archive/issue_comments_366546.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2016-12-20T20:51:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20939#issuecomment-366546",
    "user": "https://github.com/tscrim"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_events_063368.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2016-12-20T20:51:36Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/20939",
    "milestone": "sage-7.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20939#event-63368"
}
```



---

archive/issue_events_063369.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2016-12-20T20:51:36Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/20939",
    "milestone": "sage-7.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20939#event-63369"
}
```



---

archive/issue_events_063370.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-01-18T20:39:50Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/20939",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20939#event-63370"
}
```



---

archive/issue_comments_366547.json:
```json
{
    "body": "**Changing branch** from \"[u/rws/remove_pexpect_maxima_in_ymn-20939](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/remove_pexpect_maxima_in_ymn-20939)\" to \"[bb4630fa7a2ac6b9b0a1d98486378877fe60f97c](https://github.com/sagemath/sagetrac-mirror/commit/bb4630fa7a2ac6b9b0a1d98486378877fe60f97c)\".",
    "created_at": "2017-01-18T20:39:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20939#issuecomment-366547",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/rws/remove_pexpect_maxima_in_ymn-20939](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/remove_pexpect_maxima_in_ymn-20939)" to "[bb4630fa7a2ac6b9b0a1d98486378877fe60f97c](https://github.com/sagemath/sagetrac-mirror/commit/bb4630fa7a2ac6b9b0a1d98486378877fe60f97c)".
