# Issue 20722: Comparison in polynomial quotient rings

archive/issues_020485.json:
```json
{
    "body": "see [this sage-devel discussion](https://groups.google.com/forum/?hl=en#!topic/sage-devel/lAHT1sENv9w):\n\n```\nsage: R = PolynomialRing(GF(4), ('x', 'y'))\nsage: x, y = R.gens()\nsage: I = R.ideal([x^2 + y^2, x + y^3])\nsage: S = R.quotient(I, 'ab')\nsage: a, b = S.gens()\nsage: c, d, e = a + b^2, a*b, b^2\nsage: c*(d + e) == c*d + c*e\nFalse\n```\nThe problem is `QuotientRingElement._cmp_`, where it is assumed that the reduction of an element with respect to an ideal I is a unique representative of its residue class modulo I. In general, it is not.\n\n**CC:**  @burcin simonking jakobkroeker @obtext\n\n**Branch:** [u/nbruin/comparison_in_polynomial_quotient_rings](https://github.com/sagemath/sagetrac-mirror/tree/u/nbruin/comparison_in_polynomial_quotient_rings)\n\n**Commit:** [45d7f4e294356ef1a5fc7a391314506c66aaf061](https://github.com/sagemath/sagetrac-mirror/commit/45d7f4e294356ef1a5fc7a391314506c66aaf061)\n\nIssue created by migration from https://trac.sagemath.org/ticket/20722\n\n",
    "created_at": "2016-05-30T18:44:13Z",
    "labels": [
        "component: algebra",
        "bug",
        "needs info"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-7.3",
    "title": "Comparison in polynomial quotient rings",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/20722",
    "user": "https://github.com/nbruin"
}
```
see [this sage-devel discussion](https://groups.google.com/forum/?hl=en#!topic/sage-devel/lAHT1sENv9w):

```
sage: R = PolynomialRing(GF(4), ('x', 'y'))
sage: x, y = R.gens()
sage: I = R.ideal([x^2 + y^2, x + y^3])
sage: S = R.quotient(I, 'ab')
sage: a, b = S.gens()
sage: c, d, e = a + b^2, a*b, b^2
sage: c*(d + e) == c*d + c*e
False
```
The problem is `QuotientRingElement._cmp_`, where it is assumed that the reduction of an element with respect to an ideal I is a unique representative of its residue class modulo I. In general, it is not.

**CC:**  @burcin simonking jakobkroeker @obtext

**Branch:** [u/nbruin/comparison_in_polynomial_quotient_rings](https://github.com/sagemath/sagetrac-mirror/tree/u/nbruin/comparison_in_polynomial_quotient_rings)

**Commit:** [45d7f4e294356ef1a5fc7a391314506c66aaf061](https://github.com/sagemath/sagetrac-mirror/commit/45d7f4e294356ef1a5fc7a391314506c66aaf061)

Issue created by migration from https://trac.sagemath.org/ticket/20722





---

archive/issue_comments_302604.json:
```json
{
    "body": "**Branch:** [u/nbruin/comparison_in_polynomial_quotient_rings](https://github.com/sagemath/sagetrac-mirror/tree/u/nbruin/comparison_in_polynomial_quotient_rings)",
    "created_at": "2016-05-30T19:11:19Z",
    "issue": "https://github.com/sagemath/sage/issues/20722",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20722#issuecomment-302604",
    "user": "https://github.com/nbruin"
}
```

**Branch:** [u/nbruin/comparison_in_polynomial_quotient_rings](https://github.com/sagemath/sagetrac-mirror/tree/u/nbruin/comparison_in_polynomial_quotient_rings)



---

archive/issue_comments_302605.json:
```json
{
    "body": "<a id='comment:2'></a>\nFirst try. Seems to work for the most part, except for one doctest\n\n```\n            sage: F.<x,y,z> = FreeAlgebra(QQ, implementation='letterplace')\n            sage: I = F*[x*y+y*z,x^2+x*y-y*x-y^2]*F\n            sage: Q = F.quo(I)\n            sage: Q.0^4    # indirect doctest\n            ArithmeticError: Can only subtract elements of the same degree\n```\nwhich I think is a bug in the implementation of Q: if you can only work in the homogeneous parts, it's a disjoint union of modules; not a ring, and it shouldn't have any business trying to use ring machinery.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/45d7f4e294356ef1a5fc7a391314506c66aaf061\">45d7f4e</a></td><td><code>trac 20722: Base QuotientRingElement._cmp_ on ideal membership</code></td></tr></table>\n",
    "created_at": "2016-05-30T19:15:29Z",
    "issue": "https://github.com/sagemath/sage/issues/20722",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20722#issuecomment-302605",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:2'></a>
First try. Seems to work for the most part, except for one doctest

```
            sage: F.<x,y,z> = FreeAlgebra(QQ, implementation='letterplace')
            sage: I = F*[x*y+y*z,x^2+x*y-y*x-y^2]*F
            sage: Q = F.quo(I)
            sage: Q.0^4    # indirect doctest
            ArithmeticError: Can only subtract elements of the same degree
```
which I think is a bug in the implementation of Q: if you can only work in the homogeneous parts, it's a disjoint union of modules; not a ring, and it shouldn't have any business trying to use ring machinery.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/45d7f4e294356ef1a5fc7a391314506c66aaf061">45d7f4e</a></td><td><code>trac 20722: Base QuotientRingElement._cmp_ on ideal membership</code></td></tr></table>




---

archive/issue_comments_302606.json:
```json
{
    "body": "**Commit:** [45d7f4e294356ef1a5fc7a391314506c66aaf061](https://github.com/sagemath/sagetrac-mirror/commit/45d7f4e294356ef1a5fc7a391314506c66aaf061)",
    "created_at": "2016-05-30T19:15:29Z",
    "issue": "https://github.com/sagemath/sage/issues/20722",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20722#issuecomment-302606",
    "user": "https://github.com/nbruin"
}
```

**Commit:** [45d7f4e294356ef1a5fc7a391314506c66aaf061](https://github.com/sagemath/sagetrac-mirror/commit/45d7f4e294356ef1a5fc7a391314506c66aaf061)



---

archive/issue_events_185714.json:
```json
{
    "actor": "https://github.com/nbruin",
    "created_at": "2016-05-30T19:19:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20722",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20722#event-185714"
}
```



---

archive/issue_comments_302607.json:
```json
{
    "body": "<a id='comment:3'></a>\nInput needed from some FreeAlgebra experts. Including Simon and Burcin.",
    "created_at": "2016-05-30T19:19:59Z",
    "issue": "https://github.com/sagemath/sage/issues/20722",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20722#issuecomment-302607",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:3'></a>
Input needed from some FreeAlgebra experts. Including Simon and Burcin.



---

archive/issue_events_185715.json:
```json
{
    "actor": "https://github.com/nbruin",
    "created_at": "2016-05-30T19:20:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20722",
    "label": "bug",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20722#event-185715"
}
```



---

archive/issue_events_185716.json:
```json
{
    "actor": "https://github.com/nbruin",
    "created_at": "2016-05-30T19:20:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20722",
    "label": "component: algebra",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20722#event-185716"
}
```



---

archive/issue_comments_302608.json:
```json
{
    "body": "<a id='comment:5'></a>\nReplying to [nbruin](#comment%3A3):\n> Input needed from some FreeAlgebra experts. Including Simon and Burcin.\n\n\nI thought that the letterplace implementation of free algebras does provide a normal form. Thus, there shouldn't be a problem involved here. Or am I missing something?",
    "created_at": "2016-05-31T08:20:15Z",
    "issue": "https://github.com/sagemath/sage/issues/20722",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20722#issuecomment-302608",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:5'></a>
Replying to [nbruin](#comment%3A3):
> Input needed from some FreeAlgebra experts. Including Simon and Burcin.


I thought that the letterplace implementation of free algebras does provide a normal form. Thus, there shouldn't be a problem involved here. Or am I missing something?



---

archive/issue_comments_302609.json:
```json
{
    "body": "<a id='comment:6'></a>\nReplying to [SimonKing](#comment%3A5):\n> I thought that the letterplace implementation of free algebras does provide a normal form. Thus, there shouldn't be a problem involved here. Or am I missing something?\n\n\nI don't think that `normalform` with respect to an ideal is defined in all text as something that is unique (**EDIT:** OK, I think it's part of the definition of Groebner basis that it is unique when taken with respect to a basis -- there is something to say for not letting equality testing in a quotient ring depend on finding a groebner basis for the ideal first though). Clearly, in the example in this ticket, this fails. Whether this is a bug in the relevant groebner basis/reduction code or whether this is an unfortunate feature of the definition of groebner basis used there, I don't know.\n\nThe test branch I wrote avoids depending on a normal form by testing if the difference of representatives lies in the ideal. On the FreeAlgebra test case, this leads to subtracting elements of unequal degree in the standard powering algorithm, which leads to an error.\n\nThe fact that you cannot subtract any two elements in FreeAlgebra is a bug in itself: it means its ring structure isn't fully implemented. It would be good to change this. If FreeAlgebras are always graded (and we only consider homogeneous ideals in them) then perhaps elements should be implemented as vectors of homogeneous elements, with component-wise addition and subtraction. Then the thing is actually a ring. Now it's just a disjoint union of modules tied together with multiplication morphisms. Or are FreeAlgebras certifiably only useful with the partial operations?\n\nIf we can regain unique NormalForm with respect to all ideals in all rings this code gets used for, we could hide the problem again by reverting the definition of equality testing. However, I think the \"is difference in ideal\" test is preferable anyway:\n- you only need one reduction instead of two (although perhaps the elements are already in reduced form and hopefully the reduction algorithm detects that quickly)\n- I expect positive answers to have a better chance of being quick, because showing an element does lie in an ideal often allows shortcuts (that I hope many reduction algorithms would find)",
    "created_at": "2016-05-31T15:41:17Z",
    "issue": "https://github.com/sagemath/sage/issues/20722",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20722#issuecomment-302609",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:6'></a>
Replying to [SimonKing](#comment%3A5):
> I thought that the letterplace implementation of free algebras does provide a normal form. Thus, there shouldn't be a problem involved here. Or am I missing something?


I don't think that `normalform` with respect to an ideal is defined in all text as something that is unique (**EDIT:** OK, I think it's part of the definition of Groebner basis that it is unique when taken with respect to a basis -- there is something to say for not letting equality testing in a quotient ring depend on finding a groebner basis for the ideal first though). Clearly, in the example in this ticket, this fails. Whether this is a bug in the relevant groebner basis/reduction code or whether this is an unfortunate feature of the definition of groebner basis used there, I don't know.

The test branch I wrote avoids depending on a normal form by testing if the difference of representatives lies in the ideal. On the FreeAlgebra test case, this leads to subtracting elements of unequal degree in the standard powering algorithm, which leads to an error.

The fact that you cannot subtract any two elements in FreeAlgebra is a bug in itself: it means its ring structure isn't fully implemented. It would be good to change this. If FreeAlgebras are always graded (and we only consider homogeneous ideals in them) then perhaps elements should be implemented as vectors of homogeneous elements, with component-wise addition and subtraction. Then the thing is actually a ring. Now it's just a disjoint union of modules tied together with multiplication morphisms. Or are FreeAlgebras certifiably only useful with the partial operations?

If we can regain unique NormalForm with respect to all ideals in all rings this code gets used for, we could hide the problem again by reverting the definition of equality testing. However, I think the "is difference in ideal" test is preferable anyway:
- you only need one reduction instead of two (although perhaps the elements are already in reduced form and hopefully the reduction algorithm detects that quickly)
- I expect positive answers to have a better chance of being quick, because showing an element does lie in an ideal often allows shortcuts (that I hope many reduction algorithms would find)



---

archive/issue_comments_302610.json:
```json
{
    "body": "<a id='comment:9'></a>\nMight this one be related : #24808 ?",
    "created_at": "2018-02-21T15:56:54Z",
    "issue": "https://github.com/sagemath/sage/issues/20722",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20722#issuecomment-302610",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:9'></a>
Might this one be related : #24808 ?
