# Issue 20895: Computing ordinary models of plane curves

archive/issues_020658.json:
```json
{
    "body": "Given a plane curve, it is possible to transform it into a plane curve with only ordinary singularities via application of a finite sequence of quadratic transformation maps.\n\nImplement a function at the curve class level to apply the standard quadratic transformation (the birational automorphism of `P2` sending `(x : y : z)` to `(yz : xz : xy)`) and a function to transform a given plane curve into one with only ordinary singularities.\n\nCC:  @bhutz @miguelmarco\n\nKeywords: gsoc2016\n\nBranch/Commit: 6ef31f5e81344759cc6a27941cd30ace24f6de9f\n\nReviewer: Ben Hutz\n\nAuthor: Grayson Jorgenson\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/20895\n\n",
    "closed_at": "2016-09-10T09:00:04Z",
    "created_at": "2016-06-28T07:37:02Z",
    "labels": [
        "component: algebraic geometry",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.4",
    "title": "Computing ordinary models of plane curves",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/20895",
    "user": "https://trac.sagemath.org/admin/accounts/users/gjorgenson"
}
```
Given a plane curve, it is possible to transform it into a plane curve with only ordinary singularities via application of a finite sequence of quadratic transformation maps.

Implement a function at the curve class level to apply the standard quadratic transformation (the birational automorphism of `P2` sending `(x : y : z)` to `(yz : xz : xy)`) and a function to transform a given plane curve into one with only ordinary singularities.

CC:  @bhutz @miguelmarco

Keywords: gsoc2016

Branch/Commit: 6ef31f5e81344759cc6a27941cd30ace24f6de9f

Reviewer: Ben Hutz

Author: Grayson Jorgenson

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/20895





---

archive/issue_comments_384418.json:
```json
{
    "body": "Changing branch from \"\" to \"u/gjorgenson/ticket/20895\"",
    "created_at": "2016-07-05T08:12:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20895#issuecomment-384418",
    "user": "https://trac.sagemath.org/admin/accounts/users/gjorgenson"
}
```

Changing branch from "" to "u/gjorgenson/ticket/20895"



---

archive/issue_comments_384419.json:
```json
{
    "body": "Changing commit from \"\" to \"54a991e606b87e665bef1ea53c229f5a5df265f8\"",
    "created_at": "2016-07-05T08:13:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20895#issuecomment-384419",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "" to "54a991e606b87e665bef1ea53c229f5a5df265f8"



---

archive/issue_comments_384420.json:
```json
{
    "body": "<a id='comment:2'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                                     |\n|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------|\n|[489c55f](https://github.com/sagemath/sagetrac-mirror/commit/489c55f9ccf4227e84332db0eaf904aa78d7ec3e)|`20895: some pieces of functionality`|\n|[f6cca25](https://github.com/sagemath/sagetrac-mirror/commit/f6cca250a5bc891e3923ba0c23b05cb321e814fe)|`20895: merge with ticket 20839.`|\n|[54a991e](https://github.com/sagemath/sagetrac-mirror/commit/54a991e606b87e665bef1ea53c229f5a5df265f8)|`20895: first pass at implementation`|",
    "created_at": "2016-07-05T08:13:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20895#issuecomment-384420",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                                     |
|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------|
|[489c55f](https://github.com/sagemath/sagetrac-mirror/commit/489c55f9ccf4227e84332db0eaf904aa78d7ec3e)|`20895: some pieces of functionality`|
|[f6cca25](https://github.com/sagemath/sagetrac-mirror/commit/f6cca250a5bc891e3923ba0c23b05cb321e814fe)|`20895: merge with ticket 20839.`|
|[54a991e](https://github.com/sagemath/sagetrac-mirror/commit/54a991e606b87e665bef1ea53c229f5a5df265f8)|`20895: first pass at implementation`|



---

archive/issue_comments_384421.json:
```json
{
    "body": "<a id='comment:3'></a>\nOkay, here's my first attempt at the implementation. I improved the affine tangents function to work with QQbar, and added some helper functions to apply the standard Cremona transformation, find the equation of the line between two projective plane points, and to move a curve into excellent position as defined in Fulton's alg. curves book. I haven't yet been able to find a good way to mitigate the dependency on QQbar, so right now I just restrict to QQbar curves entirely. Moving curves to excellent position seems to take > 2 seconds even for basic curves and quickly becomes impractical for more complicated curves. The new functionality does seem to be working correctly on the basic examples I've tested though.\n\nDo you think it's possible to reduce the dependency on QQbar computations?",
    "created_at": "2016-07-05T08:54:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20895#issuecomment-384421",
    "user": "https://trac.sagemath.org/admin/accounts/users/gjorgenson"
}
```

<a id='comment:3'></a>
Okay, here's my first attempt at the implementation. I improved the affine tangents function to work with QQbar, and added some helper functions to apply the standard Cremona transformation, find the equation of the line between two projective plane points, and to move a curve into excellent position as defined in Fulton's alg. curves book. I haven't yet been able to find a good way to mitigate the dependency on QQbar, so right now I just restrict to QQbar curves entirely. Moving curves to excellent position seems to take > 2 seconds even for basic curves and quickly becomes impractical for more complicated curves. The new functionality does seem to be working correctly on the basic examples I've tested though.

Do you think it's possible to reduce the dependency on QQbar computations?



---

archive/issue_comments_384422.json:
```json
{
    "body": "<a id='comment:4'></a>\nTake a look at the `.as_number_field_element()` method of algebraic numbers, and the `number_field_elements_from_algebraics`function. They allow you to get a number field to embed your numbers. So you can proceed this way: use QQbar just to compute the roots you need. Once done that, find a number field where everything you need may fit (that is, it should be an extension of your current field that contains the needed elements), and extend your base ring. From there, you can keep working in a concrete number field which should be much faster than QQbar.",
    "created_at": "2016-07-05T12:11:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20895#issuecomment-384422",
    "user": "https://github.com/miguelmarco"
}
```

<a id='comment:4'></a>
Take a look at the `.as_number_field_element()` method of algebraic numbers, and the `number_field_elements_from_algebraics`function. They allow you to get a number field to embed your numbers. So you can proceed this way: use QQbar just to compute the roots you need. Once done that, find a number field where everything you need may fit (that is, it should be an extension of your current field that contains the needed elements), and extend your base ring. From there, you can keep working in a concrete number field which should be much faster than QQbar.



---

archive/issue_comments_384423.json:
```json
{
    "body": "<a id='comment:5'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                       |\n|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------|\n|[1c91bf1](https://github.com/sagemath/sagetrac-mirror/commit/1c91bf1b7fa839e488e23306acf6dbf78720b77f)|`20895: some revisions`|",
    "created_at": "2016-07-07T07:22:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20895#issuecomment-384423",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                       |
|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------|
|[1c91bf1](https://github.com/sagemath/sagetrac-mirror/commit/1c91bf1b7fa839e488e23306acf6dbf78720b77f)|`20895: some revisions`|



---

archive/issue_comments_384424.json:
```json
{
    "body": "Changing commit from \"54a991e606b87e665bef1ea53c229f5a5df265f8\" to \"1c91bf1b7fa839e488e23306acf6dbf78720b77f\"",
    "created_at": "2016-07-07T07:22:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20895#issuecomment-384424",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "54a991e606b87e665bef1ea53c229f5a5df265f8" to "1c91bf1b7fa839e488e23306acf6dbf78720b77f"



---

archive/issue_comments_384425.json:
```json
{
    "body": "Changing commit from \"1c91bf1b7fa839e488e23306acf6dbf78720b77f\" to \"132dfb58a02856fb2650d17330866def4ddbb175\"",
    "created_at": "2016-07-08T00:29:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20895#issuecomment-384425",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "1c91bf1b7fa839e488e23306acf6dbf78720b77f" to "132dfb58a02856fb2650d17330866def4ddbb175"



---

archive/issue_comments_384426.json:
```json
{
    "body": "<a id='comment:6'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                                      |\n|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------|\n|[132dfb5](https://github.com/sagemath/sagetrac-mirror/commit/132dfb58a02856fb2650d17330866def4ddbb175)|`20895: more efficient implementation`|",
    "created_at": "2016-07-08T00:29:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20895#issuecomment-384426",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                                      |
|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------|
|[132dfb5](https://github.com/sagemath/sagetrac-mirror/commit/132dfb58a02856fb2650d17330866def4ddbb175)|`20895: more efficient implementation`|



---

archive/issue_comments_384427.json:
```json
{
    "body": "<a id='comment:7'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                                                      |\n|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------|\n|[dd40201](https://github.com/sagemath/sagetrac-mirror/commit/dd402019c59ce2889d22933d3167079f0faf5997)|`20895: ordinary_model revision, and some minor fixes`|",
    "created_at": "2016-07-08T06:28:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20895#issuecomment-384427",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                                                      |
|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------|
|[dd40201](https://github.com/sagemath/sagetrac-mirror/commit/dd402019c59ce2889d22933d3167079f0faf5997)|`20895: ordinary_model revision, and some minor fixes`|



---

archive/issue_comments_384428.json:
```json
{
    "body": "Changing commit from \"132dfb58a02856fb2650d17330866def4ddbb175\" to \"dd402019c59ce2889d22933d3167079f0faf5997\"",
    "created_at": "2016-07-08T06:28:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20895#issuecomment-384428",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "132dfb58a02856fb2650d17330866def4ddbb175" to "dd402019c59ce2889d22933d3167079f0faf5997"



---

archive/issue_comments_384429.json:
```json
{
    "body": "<a id='comment:8'></a>\nAlright, I experimented with embedding into numberfields, but after doing some timing analysis, I found that the biggest use of time was finding intersection points of a given curve with the lines used to create a change of coordinates map to move the curve into excellent position. I tried revising the excellent_position and ordinary_model functions in the first of the last three commits to reduce the costs of these computations, but they still used a lot of time even for simple examples.\n\nIn the last two commits I tried a different approach and gave the excellent_position function an option to accept a list/tuple of three points to use to create the transformation (without checks), and modified the ordinary model function so that it now creates lists of vertices incrementally without explicitly checking that they put the curve into excellent position and passes them to excellent_position. To verify that the nonordinary singularities do become resolved, I'm using that after every application of excellent_position + quadratic_transformation, if the given curve was actually put into excellent position, the resulting curve should either have a smaller apparent genus (arithmetic genus - sum m*(m-1)/2 as m runs over the curve's singular point multiplicities), or should have fewer nonordinary singularities. This gives an upper bound for the number of applications of excellent_position + quadratic_transformation needed to resolve the nonordinary singularities, and so if the nonordinary singularities are not resolved after this number of transformations, a new set of vertices is used.\n\nSo far this seems to work pretty quickly for curves of degree < 5, but is somewhat hit-or-miss for higher degree curves. The transformed curves can also have high degrees when multiple transformations are needed to resolve all of the nonordinary singularities, and sometimes don't seem very practically useful. I think the code is a bit too much of a mess right now for this to be ready for review, but does the method of implementation seem okay so far? Do you think there's a way I can make the transformations nicer?",
    "created_at": "2016-07-08T07:23:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20895#issuecomment-384429",
    "user": "https://trac.sagemath.org/admin/accounts/users/gjorgenson"
}
```

<a id='comment:8'></a>
Alright, I experimented with embedding into numberfields, but after doing some timing analysis, I found that the biggest use of time was finding intersection points of a given curve with the lines used to create a change of coordinates map to move the curve into excellent position. I tried revising the excellent_position and ordinary_model functions in the first of the last three commits to reduce the costs of these computations, but they still used a lot of time even for simple examples.

In the last two commits I tried a different approach and gave the excellent_position function an option to accept a list/tuple of three points to use to create the transformation (without checks), and modified the ordinary model function so that it now creates lists of vertices incrementally without explicitly checking that they put the curve into excellent position and passes them to excellent_position. To verify that the nonordinary singularities do become resolved, I'm using that after every application of excellent_position + quadratic_transformation, if the given curve was actually put into excellent position, the resulting curve should either have a smaller apparent genus (arithmetic genus - sum m*(m-1)/2 as m runs over the curve's singular point multiplicities), or should have fewer nonordinary singularities. This gives an upper bound for the number of applications of excellent_position + quadratic_transformation needed to resolve the nonordinary singularities, and so if the nonordinary singularities are not resolved after this number of transformations, a new set of vertices is used.

So far this seems to work pretty quickly for curves of degree < 5, but is somewhat hit-or-miss for higher degree curves. The transformed curves can also have high degrees when multiple transformations are needed to resolve all of the nonordinary singularities, and sometimes don't seem very practically useful. I think the code is a bit too much of a mess right now for this to be ready for review, but does the method of implementation seem okay so far? Do you think there's a way I can make the transformations nicer?



---

archive/issue_comments_384430.json:
```json
{
    "body": "Changing commit from \"dd402019c59ce2889d22933d3167079f0faf5997\" to \"837ddb8b01cb421e7568545f8f2181c29a47a389\"",
    "created_at": "2016-07-17T09:01:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20895#issuecomment-384430",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "dd402019c59ce2889d22933d3167079f0faf5997" to "837ddb8b01cb421e7568545f8f2181c29a47a389"



---

archive/issue_comments_384431.json:
```json
{
    "body": "<a id='comment:9'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                      |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------|\n|[ce8c06a](https://github.com/sagemath/sagetrac-mirror/commit/ce8c06a41b0cfccc24832f702af88dd48a5e7467)|`20895: revised excellent_position and ordinary_model`|\n|[3299418](https://github.com/sagemath/sagetrac-mirror/commit/32994180b82d50df58f547a3fe29eee5919389f4)|`20895: merge with #20848 for access to is_irreducible`|\n|[837ddb8](https://github.com/sagemath/sagetrac-mirror/commit/837ddb8b01cb421e7568545f8f2181c29a47a389)|`20895: minor fix in excellent_position and added is_irreducible check`|",
    "created_at": "2016-07-17T09:01:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20895#issuecomment-384431",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                      |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------|
|[ce8c06a](https://github.com/sagemath/sagetrac-mirror/commit/ce8c06a41b0cfccc24832f702af88dd48a5e7467)|`20895: revised excellent_position and ordinary_model`|
|[3299418](https://github.com/sagemath/sagetrac-mirror/commit/32994180b82d50df58f547a3fe29eee5919389f4)|`20895: merge with #20848 for access to is_irreducible`|
|[837ddb8](https://github.com/sagemath/sagetrac-mirror/commit/837ddb8b01cb421e7568545f8f2181c29a47a389)|`20895: minor fix in excellent_position and added is_irreducible check`|



---

archive/issue_comments_384432.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-07-17T20:45:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20895#issuecomment-384432",
    "user": "https://trac.sagemath.org/admin/accounts/users/gjorgenson"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_384433.json:
```json
{
    "body": "<a id='comment:10'></a>\nI implemented a new approach for excellent_position that no longer requires computing intersection points and works for number fields. I think the computations are faster now and I revised ordinary_model to leave the checks to excellent_position. ordinary_model works for number fields as well by returning a curve defined over an extension if any of the coordinates of the non-ordinary singularities are not contained in the original base field.\n\nI also cleaned up the code and removed unnecessary changes that were implemented in previous commits, such as the line function for projective space.",
    "created_at": "2016-07-17T20:45:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20895#issuecomment-384433",
    "user": "https://trac.sagemath.org/admin/accounts/users/gjorgenson"
}
```

<a id='comment:10'></a>
I implemented a new approach for excellent_position that no longer requires computing intersection points and works for number fields. I think the computations are faster now and I revised ordinary_model to leave the checks to excellent_position. ordinary_model works for number fields as well by returning a curve defined over an extension if any of the coordinates of the non-ordinary singularities are not contained in the original base field.

I also cleaned up the code and removed unnecessary changes that were implemented in previous commits, such as the line function for projective space.



---

archive/issue_comments_384434.json:
```json
{
    "body": "<a id='comment:11'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                      |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------|\n|[1811424](https://github.com/sagemath/sagetrac-mirror/commit/1811424fe1b63dea59fdcd51c052958fab3dd3a0)|`Merge branch 'master' into u/gjorgenson/ticket/20895`|\n|[b1a505d](https://github.com/sagemath/sagetrac-mirror/commit/b1a505df81bd7ddc362ea58b6cb32d49fb9baae1)|`Merge branch 'master' into u/gjorgenson/ticket/20895`|\n|[a405aaf](https://github.com/sagemath/sagetrac-mirror/commit/a405aaff209e2d0c84d0136704139fb5e801615c)|`20895: some minor improvements`|\n|[71bd9a0](https://github.com/sagemath/sagetrac-mirror/commit/71bd9a091149b640499c1d168845035b39fd0dcc)|`20895: bug and documentation fix`|",
    "created_at": "2016-08-20T09:17:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20895#issuecomment-384434",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                      |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------|
|[1811424](https://github.com/sagemath/sagetrac-mirror/commit/1811424fe1b63dea59fdcd51c052958fab3dd3a0)|`Merge branch 'master' into u/gjorgenson/ticket/20895`|
|[b1a505d](https://github.com/sagemath/sagetrac-mirror/commit/b1a505df81bd7ddc362ea58b6cb32d49fb9baae1)|`Merge branch 'master' into u/gjorgenson/ticket/20895`|
|[a405aaf](https://github.com/sagemath/sagetrac-mirror/commit/a405aaff209e2d0c84d0136704139fb5e801615c)|`20895: some minor improvements`|
|[71bd9a0](https://github.com/sagemath/sagetrac-mirror/commit/71bd9a091149b640499c1d168845035b39fd0dcc)|`20895: bug and documentation fix`|



---

archive/issue_comments_384435.json:
```json
{
    "body": "Changing commit from \"837ddb8b01cb421e7568545f8f2181c29a47a389\" to \"71bd9a091149b640499c1d168845035b39fd0dcc\"",
    "created_at": "2016-08-20T09:17:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20895#issuecomment-384435",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "837ddb8b01cb421e7568545f8f2181c29a47a389" to "71bd9a091149b640499c1d168845035b39fd0dcc"



---

archive/issue_comments_384436.json:
```json
{
    "body": "<a id='comment:12'></a>\nI made some improvements to the functionality here and I think this should be ready for review.\n\nChanges made in this ticket up to this point have been to add an ordinary_model function along with two helper functions, quadratic_transform and excellent_position, to the projective plane curve class. The is_ordinary_singularity and tangents functions for affine curves were also modified to reduce the need for QQbar computations.\n\nOverall the ordinary_model function appears to be working properly, but still becomes very slow for most curves of degree > 5. I think this slowdown is mainly due to the rate at which the degrees of the quadratic transforms of the curves can grow.",
    "created_at": "2016-08-20T09:44:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20895#issuecomment-384436",
    "user": "https://trac.sagemath.org/admin/accounts/users/gjorgenson"
}
```

<a id='comment:12'></a>
I made some improvements to the functionality here and I think this should be ready for review.

Changes made in this ticket up to this point have been to add an ordinary_model function along with two helper functions, quadratic_transform and excellent_position, to the projective plane curve class. The is_ordinary_singularity and tangents functions for affine curves were also modified to reduce the need for QQbar computations.

Overall the ordinary_model function appears to be working properly, but still becomes very slow for most curves of degree > 5. I think this slowdown is mainly due to the rate at which the degrees of the quadratic transforms of the curves can grow.



---

archive/issue_events_063670.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/gjorgenson",
    "created_at": "2016-08-20T09:44:19Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/20895",
    "milestone": "sage-7.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20895#event-63670"
}
```



---

archive/issue_comments_384437.json:
```json
{
    "body": "<a id='comment:13'></a>\nI did not find any functionality issues, but here are some comments\n\n- in affine_curve.py is there a reason you have \n\n```\nfrom sage.arith.misc import binomial\n```\nin the function and not with the rest of the imports\n\n- in affine tangents()\n\n```\nt = T.degree(vars[0])\nfor monom in T.monomials():\n    if monom.degree(vars[0]) < t:\n        t = monom.degree(vars[0]\n```\nseems to just be doing\n\n```\nmin([e1 for e1,e2 in T.exponents()])\n```\nis that right? If so, you can simplify both instances.\n\n- in is_ord : projective\n\n```\nC = self.affine_patch(i)\nQ = list(P)\nt = Q.pop(i)\nQ = [1/t*Q[j] for j in range(self.ambient_space().dimension_relative())]\n```\n\nYou can just say\n\n```\nC(Q.dehomogenize(i))\n```\nto get the affine point\n\n- in excellent position: projective\n\n```\nd = self.defining_polynomial().degree()\n```\nis there no C.degree() function for plane curves??\n\n```\nif all([g.degree(PP.gens()[0]) > 0 for g in T.monomials()]):\n```\nseems simpler as\n\n```\nif all([e[0] > 0 for e in T.exponents()]):\n```\n\nalso this function fails over QQbar since .divides() does not work. You should either fix that or specify in the documentation that you need a number field\n\n- in def ordinary_model(self):\n\n```\nReturn an ordinary plane curve model of this curve.\n```\nActually you are returning the morphism from the curve to an ordinary model. You should either match the description of excellent position or return the curve and add a return_mapping parameter. Either way, I think both functions should do the same thing.\n\nI'd also like an example to show that all singularities are now ordinary.\n\n```\n[C.is_ordinary_singularity(Q) for Q in C.singular_points()]\n```\n\nin extension()\n\nnot sure why you are doing this:\n\n```\n# make sure the defining polynomial variable names are the same for K, N\nN = NumberField(K.defining_polynomial().parent()(F.defining_polynomial()), str(K.gen()))\n```\nbecause\n\n```\nsage: K.<v>=QuadraticField(2)\nsage: N = NumberField(K.defining_polynomial().parent()(x^3+2), str(K.gen()))\nsage: N.gen()==K.gen()\nFalse\n```",
    "created_at": "2016-08-25T14:46:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20895#issuecomment-384437",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:13'></a>
I did not find any functionality issues, but here are some comments

- in affine_curve.py is there a reason you have 

```
from sage.arith.misc import binomial
```
in the function and not with the rest of the imports

- in affine tangents()

```
t = T.degree(vars[0])
for monom in T.monomials():
    if monom.degree(vars[0]) < t:
        t = monom.degree(vars[0]
```
seems to just be doing

```
min([e1 for e1,e2 in T.exponents()])
```
is that right? If so, you can simplify both instances.

- in is_ord : projective

```
C = self.affine_patch(i)
Q = list(P)
t = Q.pop(i)
Q = [1/t*Q[j] for j in range(self.ambient_space().dimension_relative())]
```

You can just say

```
C(Q.dehomogenize(i))
```
to get the affine point

- in excellent position: projective

```
d = self.defining_polynomial().degree()
```
is there no C.degree() function for plane curves??

```
if all([g.degree(PP.gens()[0]) > 0 for g in T.monomials()]):
```
seems simpler as

```
if all([e[0] > 0 for e in T.exponents()]):
```

also this function fails over QQbar since .divides() does not work. You should either fix that or specify in the documentation that you need a number field

- in def ordinary_model(self):

```
Return an ordinary plane curve model of this curve.
```
Actually you are returning the morphism from the curve to an ordinary model. You should either match the description of excellent position or return the curve and add a return_mapping parameter. Either way, I think both functions should do the same thing.

I'd also like an example to show that all singularities are now ordinary.

```
[C.is_ordinary_singularity(Q) for Q in C.singular_points()]
```

in extension()

not sure why you are doing this:

```
# make sure the defining polynomial variable names are the same for K, N
N = NumberField(K.defining_polynomial().parent()(F.defining_polynomial()), str(K.gen()))
```
because

```
sage: K.<v>=QuadraticField(2)
sage: N = NumberField(K.defining_polynomial().parent()(x^3+2), str(K.gen()))
sage: N.gen()==K.gen()
False
```



---

archive/issue_comments_384438.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-08-25T14:46:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20895#issuecomment-384438",
    "user": "https://github.com/bhutz"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_384439.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Ben Hutz\"",
    "created_at": "2016-08-25T14:46:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20895#issuecomment-384439",
    "user": "https://github.com/bhutz"
}
```

Changing reviewer from "" to "Ben Hutz"



---

archive/issue_comments_384440.json:
```json
{
    "body": "Changing commit from \"71bd9a091149b640499c1d168845035b39fd0dcc\" to \"6ef31f5e81344759cc6a27941cd30ace24f6de9f\"",
    "created_at": "2016-08-30T08:32:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20895#issuecomment-384440",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "71bd9a091149b640499c1d168845035b39fd0dcc" to "6ef31f5e81344759cc6a27941cd30ace24f6de9f"



---

archive/issue_comments_384441.json:
```json
{
    "body": "<a id='comment:14'></a>\nBranch pushed to git repo; I updated commit sha1. Last 10 new commits:\n|                                                                                                                                           |                             |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------|\n|[9828514](https://github.com/sagemath/sagetrac-mirror/commit/98285148ebdb1c2c3cc189ec82716a80784c35f8)|`20790: merge with 7.3 beta5`|\n|[ee363e4](https://github.com/sagemath/sagetrac-mirror/commit/ee363e4fc1c9be96b771f9fe1fd5f05ede4862ce)|`20790: merge with 7.3 beta6`|\n|[c69bcd1](https://github.com/sagemath/sagetrac-mirror/commit/c69bcd14736dcf157cd5b5c18d11ccfec1c62cd0)|`20790: removed constructor imports`|\n|[16d6207](https://github.com/sagemath/sagetrac-mirror/commit/16d6207d099a7368a20bb2c0527c120f5d51943c)|`20790: merge with sage 7.3.rc0`|\n|[8785032](https://github.com/sagemath/sagetrac-mirror/commit/878503201d65e0ace5146466d706417ec383fc83)|`20790: changes from review`|\n|[39108a1](https://github.com/sagemath/sagetrac-mirror/commit/39108a1cf5c2b84da83b01f7283390236852ae1d)|`20790: added some tests`|\n|[67320bb](https://github.com/sagemath/sagetrac-mirror/commit/67320bb67498749e9a85e7cb77f6bbd51a6fdad3)|`Merge branch 'master' into u/gjorgenson/ticket/20790`|\n|[679338b](https://github.com/sagemath/sagetrac-mirror/commit/679338b2f7fd3888f06fa4f5d1b69310339e1fd7)|`20790: merge with 21085 to fix conflicts`|\n|[ea2970f](https://github.com/sagemath/sagetrac-mirror/commit/ea2970fbdad99bf1242ef768a0d66b65165d82d2)|`20895: merge with ticket 20790 to fix conflicts`|\n|[6ef31f5](https://github.com/sagemath/sagetrac-mirror/commit/6ef31f5e81344759cc6a27941cd30ace24f6de9f)|`20895: fix example`|",
    "created_at": "2016-08-30T08:32:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20895#issuecomment-384441",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>
Branch pushed to git repo; I updated commit sha1. Last 10 new commits:
|                                                                                                                                           |                             |
|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------|
|[9828514](https://github.com/sagemath/sagetrac-mirror/commit/98285148ebdb1c2c3cc189ec82716a80784c35f8)|`20790: merge with 7.3 beta5`|
|[ee363e4](https://github.com/sagemath/sagetrac-mirror/commit/ee363e4fc1c9be96b771f9fe1fd5f05ede4862ce)|`20790: merge with 7.3 beta6`|
|[c69bcd1](https://github.com/sagemath/sagetrac-mirror/commit/c69bcd14736dcf157cd5b5c18d11ccfec1c62cd0)|`20790: removed constructor imports`|
|[16d6207](https://github.com/sagemath/sagetrac-mirror/commit/16d6207d099a7368a20bb2c0527c120f5d51943c)|`20790: merge with sage 7.3.rc0`|
|[8785032](https://github.com/sagemath/sagetrac-mirror/commit/878503201d65e0ace5146466d706417ec383fc83)|`20790: changes from review`|
|[39108a1](https://github.com/sagemath/sagetrac-mirror/commit/39108a1cf5c2b84da83b01f7283390236852ae1d)|`20790: added some tests`|
|[67320bb](https://github.com/sagemath/sagetrac-mirror/commit/67320bb67498749e9a85e7cb77f6bbd51a6fdad3)|`Merge branch 'master' into u/gjorgenson/ticket/20790`|
|[679338b](https://github.com/sagemath/sagetrac-mirror/commit/679338b2f7fd3888f06fa4f5d1b69310339e1fd7)|`20790: merge with 21085 to fix conflicts`|
|[ea2970f](https://github.com/sagemath/sagetrac-mirror/commit/ea2970fbdad99bf1242ef768a0d66b65165d82d2)|`20895: merge with ticket 20790 to fix conflicts`|
|[6ef31f5](https://github.com/sagemath/sagetrac-mirror/commit/6ef31f5e81344759cc6a27941cd30ace24f6de9f)|`20895: fix example`|



---

archive/issue_comments_384442.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-08-30T09:43:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20895#issuecomment-384442",
    "user": "https://trac.sagemath.org/admin/accounts/users/gjorgenson"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_384443.json:
```json
{
    "body": "<a id='comment:15'></a>\nThanks for reviewing this. I was a bit busy with preparing for the semester and wasn't able to finish working on the next update until now.\n\nI made the suggested changes and also merged this with ticket 20790 (has been closed) to fix a conflict with the imports. The projective subscheme multiplicity and intersection_multiplicity functions now use the point dehomogenize function as well for cleaner code. I also added a degree function override for projective plane curves which just returns the degree of the defining polynomial of the curve to avoid using the slower Hilbert polynomial computation. \n\nIn\n\n`N = NumberField(K.defining_polynomial().parent()(F.defining_polynomial()), str(K.gen()))`\n\nI don't think `str(K.gen())` is needed and can be replaced with an arbitrary variable name, but the reason I am using `K.defining_polynomial().parent()(F.defining_polynomial())` is to make the defining polynomials of `N` and `K` have the same variable name. If the names are different the composite_fields function raises an error:\n\n```\nR.<x> = QQ[]\nS.<y> = QQ[]\nN.<a> = NumberField(x^2 + 1)\nM.<b> = NumberField(y^2 - 7)\nN.composite_fields(M)\nTraceback (click to the left of this block for traceback)\n...\nsage.libs.pari.handle_error.PariError: inconsistent variables in\npolcompositum, x != y\n```",
    "created_at": "2016-08-30T09:43:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20895#issuecomment-384443",
    "user": "https://trac.sagemath.org/admin/accounts/users/gjorgenson"
}
```

<a id='comment:15'></a>
Thanks for reviewing this. I was a bit busy with preparing for the semester and wasn't able to finish working on the next update until now.

I made the suggested changes and also merged this with ticket 20790 (has been closed) to fix a conflict with the imports. The projective subscheme multiplicity and intersection_multiplicity functions now use the point dehomogenize function as well for cleaner code. I also added a degree function override for projective plane curves which just returns the degree of the defining polynomial of the curve to avoid using the slower Hilbert polynomial computation. 

In

`N = NumberField(K.defining_polynomial().parent()(F.defining_polynomial()), str(K.gen()))`

I don't think `str(K.gen())` is needed and can be replaced with an arbitrary variable name, but the reason I am using `K.defining_polynomial().parent()(F.defining_polynomial())` is to make the defining polynomials of `N` and `K` have the same variable name. If the names are different the composite_fields function raises an error:

```
R.<x> = QQ[]
S.<y> = QQ[]
N.<a> = NumberField(x^2 + 1)
M.<b> = NumberField(y^2 - 7)
N.composite_fields(M)
Traceback (click to the left of this block for traceback)
...
sage.libs.pari.handle_error.PariError: inconsistent variables in
polcompositum, x != y
```



---

archive/issue_comments_384444.json:
```json
{
    "body": "<a id='comment:16'></a>\nThe updates look fine to me and all tests still pass.",
    "created_at": "2016-09-07T19:50:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20895#issuecomment-384444",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:16'></a>
The updates look fine to me and all tests still pass.



---

archive/issue_comments_384445.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-09-07T19:50:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20895#issuecomment-384445",
    "user": "https://github.com/bhutz"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_384446.json:
```json
{
    "body": "<a id='comment:17'></a>\nOUPUT ?",
    "created_at": "2016-09-09T18:10:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20895#issuecomment-384446",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:17'></a>
OUPUT ?



---

archive/issue_comments_384447.json:
```json
{
    "body": "Changing branch from \"u/gjorgenson/ticket/20895\" to \"6ef31f5e81344759cc6a27941cd30ace24f6de9f\"",
    "created_at": "2016-09-10T09:00:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20895#issuecomment-384447",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/gjorgenson/ticket/20895" to "6ef31f5e81344759cc6a27941cd30ace24f6de9f"



---

archive/issue_comments_384448.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-09-10T09:00:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20895#issuecomment-384448",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_063671.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-09-10T09:00:04Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/20895",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20895#event-63671"
}
```
