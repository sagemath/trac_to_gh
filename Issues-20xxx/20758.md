# Issue 20758: Simplicial complexes: keep the __enlarged cache in add_face

archive/issues_020521.json:
```json
{
    "assignees": [],
    "body": "The `add_face` method currently deletes the `__enlarged` cache, but this is unnecessary.\n\nCC:  @tscrim\n\nKeywords: **days74**\n\nBranch/Commit: **[c7bdbcf](https://github.com/sagemath/sagetrac-mirror/commit/c7bdbcf797859670d9bcb0ce29c7692ea0832f2d)**\n\nReviewer: **Travis Scrimshaw**\n\nAuthor: **John Palmieri**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/20758_\n\n",
    "closed_at": "2016-06-08T12:29:51Z",
    "created_at": "2016-06-02T10:07:02Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20algebraic%20topology",
        "https://github.com/sagemath/sage/labels/p4%20%E2%80%93%20minor",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-7.3",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Simplicial complexes: keep the __enlarged cache in add_face",
    "type": "issue",
    "updated_at": "2016-06-08T12:29:51Z",
    "url": "https://github.com/sagemath/sage/issues/20758",
    "user": "https://github.com/jhpalmieri"
}
```
The `add_face` method currently deletes the `__enlarged` cache, but this is unnecessary.

CC:  @tscrim

Keywords: **days74**

Branch/Commit: **[c7bdbcf](https://github.com/sagemath/sagetrac-mirror/commit/c7bdbcf797859670d9bcb0ce29c7692ea0832f2d)**

Reviewer: **Travis Scrimshaw**

Author: **John Palmieri**

_Issue created by migration from https://trac.sagemath.org/ticket/20758_





---

archive/issue_events_274344.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2016-06-02T10:07:02Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/20758",
    "milestone_number": null,
    "milestone_title": "sage-7.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20758#event-274344"
}
```



---

archive/issue_events_274345.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2016-06-02T10:07:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20758",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20algebraic%20topology",
    "label_color": "0000ff",
    "label_name": "component: algebraic topology",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20758#event-274345"
}
```



---

archive/issue_events_274346.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2016-06-02T10:07:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20758",
    "label": "https://github.com/sagemath/sage/labels/p4%20%E2%80%93%20minor",
    "label_color": "ffe799",
    "label_name": "p4 \u2013 minor",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20758#event-274346"
}
```



---

archive/issue_events_274347.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2016-06-02T10:07:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20758",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20758#event-274347"
}
```



---

archive/issue_comments_303579.json:
```json
{
    "body": "Commit: **[1f18ca9](https://github.com/sagemath/sagetrac-mirror/commit/1f18ca90a8b1574cf2d8f1de6cbc2bdaa161c39a)**",
    "created_at": "2016-06-02T11:43:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20758#issuecomment-303579",
    "user": "https://github.com/jhpalmieri"
}
```

Commit: **[1f18ca9](https://github.com/sagemath/sagetrac-mirror/commit/1f18ca90a8b1574cf2d8f1de6cbc2bdaa161c39a)**



---

archive/issue_comments_303580.json:
```json
{
    "body": "Branch: **[u/jhpalmieri/simplicial-add-face](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/simplicial-add-face)**",
    "created_at": "2016-06-02T11:43:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20758#issuecomment-303580",
    "user": "https://github.com/jhpalmieri"
}
```

Branch: **[u/jhpalmieri/simplicial-add-face](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/simplicial-add-face)**



---

archive/issue_comments_303581.json:
```json
{
    "body": "<a id='comment:1'>Comment 1:</a>\nThe `_faces` cache was also not treated properly, in both `add_face` and `remove_face`. For `add_face`, for example, you can see this if instead of the change here, you just delete the line `self.__enlarged = {`}: a doctest will fail because of an incorrect homology calculation, because of the wrong cached value for `_faces`.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1f18ca90a8b1574cf2d8f1de6cbc2bdaa161c39a\">1f18ca9</a></td><td><code>Simplicial complexes: when adding a face, keep the __enlarged cache.</code></td></tr></table>\n",
    "created_at": "2016-06-02T11:43:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20758#issuecomment-303581",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:1'>Comment 1:</a>
The `_faces` cache was also not treated properly, in both `add_face` and `remove_face`. For `add_face`, for example, you can see this if instead of the change here, you just delete the line `self.__enlarged = {`}: a doctest will fail because of an incorrect homology calculation, because of the wrong cached value for `_faces`.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1f18ca90a8b1574cf2d8f1de6cbc2bdaa161c39a">1f18ca9</a></td><td><code>Simplicial complexes: when adding a face, keep the __enlarged cache.</code></td></tr></table>




---

archive/issue_events_274348.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2016-06-02T11:43:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20758",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20758#event-274348"
}
```



---

archive/issue_comments_303582.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-The `add_face` method currently deletes the ``__enlarged`` cache, but this is unnecessary.\n+The `add_face` method currently deletes the `__enlarged` cache, but this is unnecessary.\n``````\n",
    "created_at": "2016-06-02T11:43:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20758#issuecomment-303582",
    "user": "https://github.com/jhpalmieri"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-The `add_face` method currently deletes the ``__enlarged`` cache, but this is unnecessary.
+The `add_face` method currently deletes the `__enlarged` cache, but this is unnecessary.
``````




---

archive/issue_comments_303583.json:
```json
{
    "body": "Changed keywords from **** to **days74**",
    "created_at": "2016-06-02T12:11:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20758#issuecomment-303583",
    "user": "https://github.com/jhpalmieri"
}
```

Changed keywords from **** to **days74**



---

archive/issue_comments_303584.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nIf you're okay with my changes, then you can set a positive review.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/00fce35fba80180814ebf3557e27491ee15082d2\">00fce35</a></td><td><code>Reviewer changes to #20758.</code></td></tr></table>\n",
    "created_at": "2016-06-02T12:53:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20758#issuecomment-303584",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:3'>Comment 3:</a>
If you're okay with my changes, then you can set a positive review.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/00fce35fba80180814ebf3557e27491ee15082d2">00fce35</a></td><td><code>Reviewer changes to #20758.</code></td></tr></table>




---

archive/issue_comments_303585.json:
```json
{
    "body": "Reviewer: **Travis Scrimshaw**",
    "created_at": "2016-06-02T12:53:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20758#issuecomment-303585",
    "user": "https://github.com/tscrim"
}
```

Reviewer: **Travis Scrimshaw**



---

archive/issue_comments_303586.json:
```json
{
    "body": "Changed branch from **[u/jhpalmieri/simplicial-add-face](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/simplicial-add-face)** to **[u/tscrim/simplicial_add_face-20758](https://github.com/sagemath/sagetrac-mirror/tree/u/tscrim/simplicial_add_face-20758)**",
    "created_at": "2016-06-02T12:53:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20758#issuecomment-303586",
    "user": "https://github.com/tscrim"
}
```

Changed branch from **[u/jhpalmieri/simplicial-add-face](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/simplicial-add-face)** to **[u/tscrim/simplicial_add_face-20758](https://github.com/sagemath/sagetrac-mirror/tree/u/tscrim/simplicial_add_face-20758)**



---

archive/issue_comments_303587.json:
```json
{
    "body": "Author: **John Palmieri**",
    "created_at": "2016-06-02T12:53:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20758#issuecomment-303587",
    "user": "https://github.com/tscrim"
}
```

Author: **John Palmieri**



---

archive/issue_comments_303588.json:
```json
{
    "body": "Changed commit from **[1f18ca9](https://github.com/sagemath/sagetrac-mirror/commit/1f18ca90a8b1574cf2d8f1de6cbc2bdaa161c39a)** to **[00fce35](https://github.com/sagemath/sagetrac-mirror/commit/00fce35fba80180814ebf3557e27491ee15082d2)**",
    "created_at": "2016-06-02T12:53:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20758#issuecomment-303588",
    "user": "https://github.com/tscrim"
}
```

Changed commit from **[1f18ca9](https://github.com/sagemath/sagetrac-mirror/commit/1f18ca90a8b1574cf2d8f1de6cbc2bdaa161c39a)** to **[00fce35](https://github.com/sagemath/sagetrac-mirror/commit/00fce35fba80180814ebf3557e27491ee15082d2)**



---

archive/issue_events_274349.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2016-06-02T13:16:49Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20758",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20758#event-274349"
}
```



---

archive/issue_events_274350.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2016-06-02T13:16:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20758",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20758#event-274350"
}
```



---

archive/issue_comments_303589.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nLooks good.",
    "created_at": "2016-06-02T13:16:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20758#issuecomment-303589",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:4'>Comment 4:</a>
Looks good.



---

archive/issue_comments_303590.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\n\n```\nsage -t --long src/sage/homology/simplicial_complex.py\n**********************************************************************\nFile \"src/sage/homology/simplicial_complex.py\", line 2606, in sage.homology.simplicial_complex.SimplicialComplex.remove_face\nFailed example:\n    T.remove_face((1,2,3))\nException raised:\n    Traceback (most recent call last):\n      File \"/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 498, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 861, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.homology.simplicial_complex.SimplicialComplex.remove_face[12]>\", line 1, in <module>\n        T.remove_face((Integer(1),Integer(2),Integer(3)))\n      File \"/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/homology/simplicial_complex.py\", line 2659, in remove_face\n        if L is None or Simplex(face) not in L:\n      File \"/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/homology/simplicial_complex.py\", line 1204, in __contains__\n        return x in self.faces()[dim]\n    KeyError: 2\n**********************************************************************\nFile \"src/sage/homology/simplicial_complex.py\", line 2607, in sage.homology.simplicial_complex.SimplicialComplex.remove_face\nFailed example:\n    len(T._faces)\nExpected:\n    2\nGot:\n    1\n**********************************************************************\n1 item had failures:\n   2 of  17 in sage.homology.simplicial_complex.SimplicialComplex.remove_face\n    [581 tests, 2 failures, 10.66 s]\nsage -t --long src/sage/interfaces/interface.py\n```",
    "created_at": "2016-06-03T21:54:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20758#issuecomment-303590",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:5'>Comment 5:</a>

```
sage -t --long src/sage/homology/simplicial_complex.py
**********************************************************************
File "src/sage/homology/simplicial_complex.py", line 2606, in sage.homology.simplicial_complex.SimplicialComplex.remove_face
Failed example:
    T.remove_face((1,2,3))
Exception raised:
    Traceback (most recent call last):
      File "/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 498, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 861, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.homology.simplicial_complex.SimplicialComplex.remove_face[12]>", line 1, in <module>
        T.remove_face((Integer(1),Integer(2),Integer(3)))
      File "/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/homology/simplicial_complex.py", line 2659, in remove_face
        if L is None or Simplex(face) not in L:
      File "/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/homology/simplicial_complex.py", line 1204, in __contains__
        return x in self.faces()[dim]
    KeyError: 2
**********************************************************************
File "src/sage/homology/simplicial_complex.py", line 2607, in sage.homology.simplicial_complex.SimplicialComplex.remove_face
Failed example:
    len(T._faces)
Expected:
    2
Got:
    1
**********************************************************************
1 item had failures:
   2 of  17 in sage.homology.simplicial_complex.SimplicialComplex.remove_face
    [581 tests, 2 failures, 10.66 s]
sage -t --long src/sage/interfaces/interface.py
```



---

archive/issue_comments_303591.json:
```json
{
    "body": "<a id='comment:6'>Comment 6:</a>\nThis is fallout from #20718: in that ticket, we changed from using `self.n_faces(dim)` to using `self.faces()[dim]`, but the former allows values of `dim` greater than the dimension of the complex: it just returns the empty set in that case. So we can continue with the philosophy in #20718, that we want to avoid `n_faces`, or we can restore its use in some cases. The fix is easy either way, we just need to decide what to do. For example, in keeping with the philosophy there:\n\n```diff\ndiff --git a/src/sage/homology/simplicial_complex.py b/src/sage/homology/simplicial_complex.py\nindex fefc90e..1a6cca7 100644\n--- a/src/sage/homology/simplicial_complex.py\n+++ b/src/sage/homology/simplicial_complex.py\n@@ -1199,7 +1199,7 @@ class SimplicialComplex(Parent, GenericCellComplex):\n         if not isinstance(x, Simplex):\n             return False\n         dim = x.dimension()\n-        return x in self.faces()[dim]\n+        return dim in self.faces() and x in self.faces()[dim]\n \n     def __call__(self, simplex):\n         \"\"\"\n@@ -1527,9 +1527,11 @@ class SimplicialComplex(Parent, GenericCellComplex):\n             ...\n             ValueError: this simplex is not in this simplicial complex\n         \"\"\"\n-        if not simplex in self.faces()[simplex.dimension()]:\n+        d = simplex.dimension()\n+        if d in self.faces() and simplex in self.faces()[d]:\n+            return simplex.face(i)\n+        else:\n             raise ValueError('this simplex is not in this simplicial complex')\n-        return simplex.face(i)\n \n     def flip_graph(self):\n         \"\"\"\n@@ -3220,7 +3222,11 @@ class SimplicialComplex(Parent, GenericCellComplex):\n             sage: X.set_immutable()\n             sage: X.n_skeleton(2)\n             Simplicial complex with vertex set (0, 1, 2, 3) and facets {(0, 2, 3), (1, 2, 3), (0, 1)}\n+            sage: X.n_skeleton(4)\n+            Simplicial complex with vertex set (0, 1, 2, 3) and facets {(0, 2, 3), (1, 2, 3), (0, 1)}\n         \"\"\"\n+        if n >= self.dimension():\n+            return self\n         # make sure it's a list (it will be a tuple if immutable)\n         facets = [f for f in self._facets if f.dimension() < n]\n         facets.extend(self.faces()[n])\n```",
    "created_at": "2016-06-04T02:33:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20758#issuecomment-303591",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:6'>Comment 6:</a>
This is fallout from #20718: in that ticket, we changed from using `self.n_faces(dim)` to using `self.faces()[dim]`, but the former allows values of `dim` greater than the dimension of the complex: it just returns the empty set in that case. So we can continue with the philosophy in #20718, that we want to avoid `n_faces`, or we can restore its use in some cases. The fix is easy either way, we just need to decide what to do. For example, in keeping with the philosophy there:

```diff
diff --git a/src/sage/homology/simplicial_complex.py b/src/sage/homology/simplicial_complex.py
index fefc90e..1a6cca7 100644
--- a/src/sage/homology/simplicial_complex.py
+++ b/src/sage/homology/simplicial_complex.py
@@ -1199,7 +1199,7 @@ class SimplicialComplex(Parent, GenericCellComplex):
         if not isinstance(x, Simplex):
             return False
         dim = x.dimension()
-        return x in self.faces()[dim]
+        return dim in self.faces() and x in self.faces()[dim]
 
     def __call__(self, simplex):
         """
@@ -1527,9 +1527,11 @@ class SimplicialComplex(Parent, GenericCellComplex):
             ...
             ValueError: this simplex is not in this simplicial complex
         """
-        if not simplex in self.faces()[simplex.dimension()]:
+        d = simplex.dimension()
+        if d in self.faces() and simplex in self.faces()[d]:
+            return simplex.face(i)
+        else:
             raise ValueError('this simplex is not in this simplicial complex')
-        return simplex.face(i)
 
     def flip_graph(self):
         """
@@ -3220,7 +3222,11 @@ class SimplicialComplex(Parent, GenericCellComplex):
             sage: X.set_immutable()
             sage: X.n_skeleton(2)
             Simplicial complex with vertex set (0, 1, 2, 3) and facets {(0, 2, 3), (1, 2, 3), (0, 1)}
+            sage: X.n_skeleton(4)
+            Simplicial complex with vertex set (0, 1, 2, 3) and facets {(0, 2, 3), (1, 2, 3), (0, 1)}
         """
+        if n >= self.dimension():
+            return self
         # make sure it's a list (it will be a tuple if immutable)
         facets = [f for f in self._facets if f.dimension() < n]
         facets.extend(self.faces()[n])
```



---

archive/issue_events_274351.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2016-06-04T02:33:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20758",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20758#event-274351"
}
```



---

archive/issue_events_274352.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2016-06-04T02:33:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20758",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20758#event-274352"
}
```



---

archive/issue_comments_303592.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nI would say let us use `self.faces()[dim]` to continue to avoid using `n_faces` (the more we scrub it from the code, it is less likely that anyone will use it in the future [in the code]).",
    "created_at": "2016-06-04T06:42:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20758#issuecomment-303592",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:7'>Comment 7:</a>
I would say let us use `self.faces()[dim]` to continue to avoid using `n_faces` (the more we scrub it from the code, it is less likely that anyone will use it in the future [in the code]).



---

archive/issue_comments_303593.json:
```json
{
    "body": "Changed branch from **[u/tscrim/simplicial_add_face-20758](https://github.com/sagemath/sagetrac-mirror/tree/u/tscrim/simplicial_add_face-20758)** to **[u/jhpalmieri/simplicial_add_face-20758](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/simplicial_add_face-20758)**",
    "created_at": "2016-06-04T14:15:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20758#issuecomment-303593",
    "user": "https://github.com/jhpalmieri"
}
```

Changed branch from **[u/tscrim/simplicial_add_face-20758](https://github.com/sagemath/sagetrac-mirror/tree/u/tscrim/simplicial_add_face-20758)** to **[u/jhpalmieri/simplicial_add_face-20758](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/simplicial_add_face-20758)**



---

archive/issue_events_274353.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2016-06-04T14:16:45Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20758",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20758#event-274353"
}
```



---

archive/issue_events_274354.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2016-06-04T14:16:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20758",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20758#event-274354"
}
```



---

archive/issue_comments_303594.json:
```json
{
    "body": "<a id='comment:9'>Comment 9:</a>\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/15e54b1060205985bc5b546be5eeb637d6abace6\">15e54b1</a></td><td><code>trac 20718: use n_cells, not n_faces, and sort n_cells.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6bd5a97d9e9a6a752eccc8d566b50d7c85c9c50f\">6bd5a97</a></td><td><code>grammar fix, capitalization</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7b1a2996f159192d6a4c97e690f6156d7860e110\">7b1a299</a></td><td><code>Having vertices() return a tuple instead of a Simplex.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3ace10e8c297c9bf447a60f8779c59657317562a\">3ace10e</a></td><td><code>Fixing a doctest in combinat/cluster_complex.py.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/00c48e8de85d04e6001b739c6341cf5eb10341fe\">00c48e8</a></td><td><code>trac 20720: referee changes</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/954ef51766eb40b46f0ae008a52a91c024c9e655\">954ef51</a></td><td><code>Merge branch 't/20720/public/simplicial_complex/vertices_output_type-20720' into homology_sorted</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/617a76ac2519d8219ee2640c26b0e1207642c5cb\">617a76a</a></td><td><code>trac 20718: fix issues with sorting (or not) of vertices</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0b0a85de0116681645f8a7b5dc01edeecfaf39b0\">0b0a85d</a></td><td><code>Merge branch 't/20718/617a76ac2519d8219ee2640c26b0e1207642c5cb' into t/20758/simplicial_add_face-20758</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c7bdbcf797859670d9bcb0ce29c7692ea0832f2d\">c7bdbcf</a></td><td><code>simplicial complexes: a few more fixes with n_faces vs. faces</code></td></tr></table>\n",
    "created_at": "2016-06-04T14:16:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20758#issuecomment-303594",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:9'>Comment 9:</a>
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/15e54b1060205985bc5b546be5eeb637d6abace6">15e54b1</a></td><td><code>trac 20718: use n_cells, not n_faces, and sort n_cells.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6bd5a97d9e9a6a752eccc8d566b50d7c85c9c50f">6bd5a97</a></td><td><code>grammar fix, capitalization</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7b1a2996f159192d6a4c97e690f6156d7860e110">7b1a299</a></td><td><code>Having vertices() return a tuple instead of a Simplex.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3ace10e8c297c9bf447a60f8779c59657317562a">3ace10e</a></td><td><code>Fixing a doctest in combinat/cluster_complex.py.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/00c48e8de85d04e6001b739c6341cf5eb10341fe">00c48e8</a></td><td><code>trac 20720: referee changes</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/954ef51766eb40b46f0ae008a52a91c024c9e655">954ef51</a></td><td><code>Merge branch 't/20720/public/simplicial_complex/vertices_output_type-20720' into homology_sorted</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/617a76ac2519d8219ee2640c26b0e1207642c5cb">617a76a</a></td><td><code>trac 20718: fix issues with sorting (or not) of vertices</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0b0a85de0116681645f8a7b5dc01edeecfaf39b0">0b0a85d</a></td><td><code>Merge branch 't/20718/617a76ac2519d8219ee2640c26b0e1207642c5cb' into t/20758/simplicial_add_face-20758</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c7bdbcf797859670d9bcb0ce29c7692ea0832f2d">c7bdbcf</a></td><td><code>simplicial complexes: a few more fixes with n_faces vs. faces</code></td></tr></table>




---

archive/issue_comments_303595.json:
```json
{
    "body": "Changed commit from **[00fce35](https://github.com/sagemath/sagetrac-mirror/commit/00fce35fba80180814ebf3557e27491ee15082d2)** to **[c7bdbcf](https://github.com/sagemath/sagetrac-mirror/commit/c7bdbcf797859670d9bcb0ce29c7692ea0832f2d)**",
    "created_at": "2016-06-04T14:16:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20758#issuecomment-303595",
    "user": "https://github.com/jhpalmieri"
}
```

Changed commit from **[00fce35](https://github.com/sagemath/sagetrac-mirror/commit/00fce35fba80180814ebf3557e27491ee15082d2)** to **[c7bdbcf](https://github.com/sagemath/sagetrac-mirror/commit/c7bdbcf797859670d9bcb0ce29c7692ea0832f2d)**



---

archive/issue_events_274355.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-06-04T18:59:56Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20758",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20758#event-274355"
}
```



---

archive/issue_events_274356.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-06-04T18:59:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20758",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20758#event-274356"
}
```



---

archive/issue_comments_303596.json:
```json
{
    "body": "<a id='comment:10'>Comment 10:</a>\n\n```\nsage -t --long src/sage/homology/simplicial_complex.py\n**********************************************************************\nFile \"src/sage/homology/simplicial_complex.py\", line 2606, in sage.homology.simplicial_complex.SimplicialComplex.remove_face\nFailed example:\n    T.remove_face((1,2,3))\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 498, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 861, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.homology.simplicial_complex.SimplicialComplex.remove_face[12]>\", line 1, in <module>\n        T.remove_face((Integer(1),Integer(2),Integer(3)))\n      File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/homology/simplicial_complex.py\", line 2659, in remove_face\n        if L is None or Simplex(face) not in L:\n      File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/homology/simplicial_complex.py\", line 1204, in __contains__\n        return x in self.faces()[dim]\n    KeyError: 2\n**********************************************************************\nFile \"src/sage/homology/simplicial_complex.py\", line 2607, in sage.homology.simplicial_complex.SimplicialComplex.remove_face\nFailed example:\n    len(T._faces)\nExpected:\n    2\nGot:\n    1\n**********************************************************************\n1 item had failures:\n   2 of  17 in sage.homology.simplicial_complex.SimplicialComplex.remove_face\n    [581 tests, 2 failures, 6.66 s]\n```",
    "created_at": "2016-06-04T18:59:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20758#issuecomment-303596",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:10'>Comment 10:</a>

```
sage -t --long src/sage/homology/simplicial_complex.py
**********************************************************************
File "src/sage/homology/simplicial_complex.py", line 2606, in sage.homology.simplicial_complex.SimplicialComplex.remove_face
Failed example:
    T.remove_face((1,2,3))
Exception raised:
    Traceback (most recent call last):
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 498, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 861, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.homology.simplicial_complex.SimplicialComplex.remove_face[12]>", line 1, in <module>
        T.remove_face((Integer(1),Integer(2),Integer(3)))
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/homology/simplicial_complex.py", line 2659, in remove_face
        if L is None or Simplex(face) not in L:
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/homology/simplicial_complex.py", line 1204, in __contains__
        return x in self.faces()[dim]
    KeyError: 2
**********************************************************************
File "src/sage/homology/simplicial_complex.py", line 2607, in sage.homology.simplicial_complex.SimplicialComplex.remove_face
Failed example:
    len(T._faces)
Expected:
    2
Got:
    1
**********************************************************************
1 item had failures:
   2 of  17 in sage.homology.simplicial_complex.SimplicialComplex.remove_face
    [581 tests, 2 failures, 6.66 s]
```



---

archive/issue_events_274357.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2016-06-04T20:07:57Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20758",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20758#event-274357"
}
```



---

archive/issue_events_274358.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2016-06-04T20:07:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20758",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20758#event-274358"
}
```



---

archive/issue_comments_303597.json:
```json
{
    "body": "<a id='comment:11'>Comment 11:</a>\nI don't understand this error. With my branch, there is no line in the entire Sage source tree matching `return x in self.faces()[dim]`. The most recent changes one line (and I think the relevant line, from the `__contains__` method) to\n\n```\nreturn dim in self.faces() and x in self.faces()[dim]\n```\nso this error should not happen.\n\nAll tests pass for me. I started over, checking out the branch all over again, and all tests still pass.",
    "created_at": "2016-06-04T20:07:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20758#issuecomment-303597",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:11'>Comment 11:</a>
I don't understand this error. With my branch, there is no line in the entire Sage source tree matching `return x in self.faces()[dim]`. The most recent changes one line (and I think the relevant line, from the `__contains__` method) to

```
return dim in self.faces() and x in self.faces()[dim]
```
so this error should not happen.

All tests pass for me. I started over, checking out the branch all over again, and all tests still pass.



---

archive/issue_comments_303598.json:
```json
{
    "body": "<a id='comment:12'>Comment 12:</a>\nWell you wrote that in #20718 ;-)\n\njust wait for the next beta and merge it in, easy.",
    "created_at": "2016-06-04T20:30:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20758#issuecomment-303598",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:12'>Comment 12:</a>
Well you wrote that in #20718 ;-)

just wait for the next beta and merge it in, easy.



---

archive/issue_comments_303599.json:
```json
{
    "body": "<a id='comment:13'>Comment 13:</a>\nReplying to [@vbraun](#comment%3A12):\n> Well you wrote that in #20718 ;-)\n\nRight, and then changed it in the most recent commit on this ticket ([c7bdbcf](https://github.com/sagemath/sagetrac-mirror/commit/c7bdbcf797859670d9bcb0ce29c7692ea0832f2d)).",
    "created_at": "2016-06-04T20:43:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20758#issuecomment-303599",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:13'>Comment 13:</a>
Replying to [@vbraun](#comment%3A12):
> Well you wrote that in #20718 ;-)

Right, and then changed it in the most recent commit on this ticket ([c7bdbcf](https://github.com/sagemath/sagetrac-mirror/commit/c7bdbcf797859670d9bcb0ce29c7692ea0832f2d)).



---

archive/issue_comments_303600.json:
```json
{
    "body": "<a id='comment:14'>Comment 14:</a>\nWhich is why you shouldn't switch positively reviewed tickets back and forth...",
    "created_at": "2016-06-04T20:59:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20758#issuecomment-303600",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:14'>Comment 14:</a>
Which is why you shouldn't switch positively reviewed tickets back and forth...



---

archive/issue_comments_303601.json:
```json
{
    "body": "<a id='comment:15'>Comment 15:</a>\nI'm really confused now. You posted a doctest failure here, so I thought it was basically required to undo the positive review. Should I have left it as a positive review?",
    "created_at": "2016-06-04T21:40:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20758#issuecomment-303601",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:15'>Comment 15:</a>
I'm really confused now. You posted a doctest failure here, so I thought it was basically required to undo the positive review. Should I have left it as a positive review?



---

archive/issue_comments_303602.json:
```json
{
    "body": "<a id='comment:16'>Comment 16:</a>\nIf its fixed then set it back to positive review. \n\nIf you want to avoid the confusion then don't go back after positive review. If it doesn't work then I'll tell you. Now you merged in #20718 but there is no guarantee that that ticket will even be in the next beta. Its likely but it might still get unmerged.",
    "created_at": "2016-06-05T01:05:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20758#issuecomment-303602",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:16'>Comment 16:</a>
If its fixed then set it back to positive review. 

If you want to avoid the confusion then don't go back after positive review. If it doesn't work then I'll tell you. Now you merged in #20718 but there is no guarantee that that ticket will even be in the next beta. Its likely but it might still get unmerged.



---

archive/issue_comments_303603.json:
```json
{
    "body": "<a id='comment:17'>Comment 17:</a>\nJust to be clear: I tested the branch from back when it was \"positive review\".",
    "created_at": "2016-06-05T01:16:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20758#issuecomment-303603",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:17'>Comment 17:</a>
Just to be clear: I tested the branch from back when it was "positive review".



---

archive/issue_events_274359.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2016-06-05T13:02:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20758",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20758#event-274359"
}
```



---

archive/issue_events_274360.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2016-06-05T13:02:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20758",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20758#event-274360"
}
```



---

archive/issue_events_274361.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-06-08T12:29:51Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20758",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20758#event-274361"
}
```



---

archive/issue_events_274362.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "30e77150ad52cac05956542166b803d471b3ccd4",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2016-06-08T12:29:51Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/20758",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20758#event-274362"
}
```



---

archive/issue_comments_303604.json:
```json
{
    "body": "Changed branch from **[u/jhpalmieri/simplicial_add_face-20758](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/simplicial_add_face-20758)** to **[c7bdbcf](https://github.com/sagemath/sagetrac-mirror/commit/c7bdbcf797859670d9bcb0ce29c7692ea0832f2d)**",
    "created_at": "2016-06-08T12:29:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20758#issuecomment-303604",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/jhpalmieri/simplicial_add_face-20758](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/simplicial_add_face-20758)** to **[c7bdbcf](https://github.com/sagemath/sagetrac-mirror/commit/c7bdbcf797859670d9bcb0ce29c7692ea0832f2d)**
