# Issue 20681: Cythonize the special methods in the categories that handle coercion in arithmetic

archive/issues_020444.json:
```json
{
    "body": "Recall that the Sage categories provide implementations for Python's\nspecial methods for the basic arithmetic operations (e.g. `__mul__`,\n`__add__`), that dispatch to the coercion model or call Sage's special\nmethods (e.g. `_mul_`, `_add_`) for the internal\noperations. Furthermore, the default implementation for `_mul_` is to\ndelegate the work to the `product` method of the parent.\n\nBefore this ticket, those indirections induced an overhead of roughly\n100ns for `*`, 480ns for `__mul__` and 340ns for `_mul_`:\n\n```\n    sage: S = Semigroups().example()\n    sage: x = S.an_element()\n    sage: x*x\n    42\n    sage: sage: %timeit [x*x for i in range(1000)]\n    1000 loops, best of 3: 1.21 ms per loop\n    sage: sage: %timeit [x.__mul__(x) for i in range(1000)]\n    1000 loops, best of 3: 1.12 ms per loop\n    sage: sage: %timeit [x._mul_(x) for i in range(1000)]\n    1000 loops, best of 3: 643 \u00b5s per loop\n    sage: %timeit [S.product(x,x) for i in range(1000)]\n    1000 loops, best of 3: 300 \u00b5s per loop\n```\n\nAfter this ticket, which Cythonize those methods, the overhead is\nreduced to roughly 20ns for `*`, 100ns for `__mul__` and 160ms for\n`_mul_`, which is a speedup by a factor of 3 on the accumulated\noverhead, and an overall speedup by a factor of 2 for this particular\nparent:\n\n```\n    sage: %timeit [x*x for i in range(1000)]\n    1000 loops, best of 3: 596 \u00b5s per loop\n    sage: %timeit [x.__mul__(x) for i in range(1000)]\n    1000 loops, best of 3: 572 \u00b5s per loop\n    sage: %timeit [x._mul_(x) for i in range(1000)]\n    1000 loops, best of 3: 467 \u00b5s per loop\n    sage: %timeit [S.product(x,x) for i in range(1000)]\n    1000 loops, best of 3: 300 \u00b5s per loop\n```\n\n=Notes=\n\nThe average timings vary by about 5-10% from one run to the other.\n\nIn this parent, the product is trivial, and implemented as a plain\nPython `product` method in the parent. For a parent with a non trivial\nPython product, the overhead of the indirections is now of 20%, which\nis getting closer to acceptable::\n\n```\n    sage: S = Semigroups().Finite().example()\n    sage: x = S.an_element()\n    sage: %timeit [S.product(x,x) for i in range(1000)]\n    100 loops, best of 3: 4.39 ms per loop\n    sage: %timeit [x*x for i in range(1000)]\n    100 loops, best of 3: 5.28 ms per loop\n```\n\nFor comparison, here is the cost of the product of two (Sage)\nintegers::\n\n```\n    sage: x = 3\n    sage: %timeit [x*x for i in range(1000)]\n    1000 loops, best of 3: 162 \u00b5s per loop\n    sage: x = int(3)\n    sage: %timeit [x*x for i in range(1000)]\n    10000 loops, best of 3: 63.9 \u00b5s per loop\n```\n\nSo the 120ns overhead when using coercion methods `__mul__` provided\nby categories (rather than from a Cython super class) is of the same\norder of magnitude as the cost of a trivial multiplication.\n\n\n**Keywords:** performance\n\n**Branch:** [public/categories/cythonize_arithmetic_special_methods-20681](https://github.com/sagemath/sagetrac-mirror/tree/public/categories/cythonize_arithmetic_special_methods-20681)\n\n**Commit:** [4e88e4c311b0108f21d28a2c3587193e364ee0fd](https://github.com/sagemath/sagetrac-mirror/commit/4e88e4c311b0108f21d28a2c3587193e364ee0fd)\n\n**Reviewer:** Travis Scrimshaw\n\n**Author:** Nicolas M. Thi\u00e9ry\n\nIssue created by migration from https://trac.sagemath.org/ticket/20681\n\n",
    "closed_at": "2016-05-31T07:36:59Z",
    "created_at": "2016-05-25T21:59:29Z",
    "labels": [
        "component: categories",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.3",
    "title": "Cythonize the special methods in the categories that handle coercion in arithmetic",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/20681",
    "user": "https://github.com/nthiery"
}
```
Recall that the Sage categories provide implementations for Python's
special methods for the basic arithmetic operations (e.g. `__mul__`,
`__add__`), that dispatch to the coercion model or call Sage's special
methods (e.g. `_mul_`, `_add_`) for the internal
operations. Furthermore, the default implementation for `_mul_` is to
delegate the work to the `product` method of the parent.

Before this ticket, those indirections induced an overhead of roughly
100ns for `*`, 480ns for `__mul__` and 340ns for `_mul_`:

```
    sage: S = Semigroups().example()
    sage: x = S.an_element()
    sage: x*x
    42
    sage: sage: %timeit [x*x for i in range(1000)]
    1000 loops, best of 3: 1.21 ms per loop
    sage: sage: %timeit [x.__mul__(x) for i in range(1000)]
    1000 loops, best of 3: 1.12 ms per loop
    sage: sage: %timeit [x._mul_(x) for i in range(1000)]
    1000 loops, best of 3: 643 µs per loop
    sage: %timeit [S.product(x,x) for i in range(1000)]
    1000 loops, best of 3: 300 µs per loop
```

After this ticket, which Cythonize those methods, the overhead is
reduced to roughly 20ns for `*`, 100ns for `__mul__` and 160ms for
`_mul_`, which is a speedup by a factor of 3 on the accumulated
overhead, and an overall speedup by a factor of 2 for this particular
parent:

```
    sage: %timeit [x*x for i in range(1000)]
    1000 loops, best of 3: 596 µs per loop
    sage: %timeit [x.__mul__(x) for i in range(1000)]
    1000 loops, best of 3: 572 µs per loop
    sage: %timeit [x._mul_(x) for i in range(1000)]
    1000 loops, best of 3: 467 µs per loop
    sage: %timeit [S.product(x,x) for i in range(1000)]
    1000 loops, best of 3: 300 µs per loop
```

=Notes=

The average timings vary by about 5-10% from one run to the other.

In this parent, the product is trivial, and implemented as a plain
Python `product` method in the parent. For a parent with a non trivial
Python product, the overhead of the indirections is now of 20%, which
is getting closer to acceptable::

```
    sage: S = Semigroups().Finite().example()
    sage: x = S.an_element()
    sage: %timeit [S.product(x,x) for i in range(1000)]
    100 loops, best of 3: 4.39 ms per loop
    sage: %timeit [x*x for i in range(1000)]
    100 loops, best of 3: 5.28 ms per loop
```

For comparison, here is the cost of the product of two (Sage)
integers::

```
    sage: x = 3
    sage: %timeit [x*x for i in range(1000)]
    1000 loops, best of 3: 162 µs per loop
    sage: x = int(3)
    sage: %timeit [x*x for i in range(1000)]
    10000 loops, best of 3: 63.9 µs per loop
```

So the 120ns overhead when using coercion methods `__mul__` provided
by categories (rather than from a Cython super class) is of the same
order of magnitude as the cost of a trivial multiplication.


**Keywords:** performance

**Branch:** [public/categories/cythonize_arithmetic_special_methods-20681](https://github.com/sagemath/sagetrac-mirror/tree/public/categories/cythonize_arithmetic_special_methods-20681)

**Commit:** [4e88e4c311b0108f21d28a2c3587193e364ee0fd](https://github.com/sagemath/sagetrac-mirror/commit/4e88e4c311b0108f21d28a2c3587193e364ee0fd)

**Reviewer:** Travis Scrimshaw

**Author:** Nicolas M. Thiéry

Issue created by migration from https://trac.sagemath.org/ticket/20681





---

archive/issue_comments_360371.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2016-05-25T22:57:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20681#issuecomment-360371",
    "user": "https://github.com/nthiery"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_360372.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1,33 @@\n+Recall that the Sage categories provide implementations for Python's\n+special methods for the basic arithmetic operations (e.g. `__mul__`,\n+`__add__`), that dispatch to the coercion model or call Sage's special\n+methods (e.g. `_mul_`, `_add_`) for the internal operations.\n \n+Before this ticket, this indirection induces an overhead of roughly\n+500ns:\n+\n+```\n+sage: S = Semigroups().example()\n+sage: x = S.an_element()\n+\n+sage: sage: %timeit [x*x for i in range(1000)]\n+1000 loops, best of 3: 1.21 ms per loop\n+sage: sage: %timeit [x.__mul__(x) for i in range(1000)]\n+1000 loops, best of 3: 1.12 ms per loop\n+sage: sage: %timeit [x._mul_(x) for i in range(1000)]\n+1000 loops, best of 3: 643 \u00b5s per loop\n+```\n+(the average timing don't vary much if we try again)\n+\n+After this ticket, which Cythonize those methods, the overhead is\n+reduced to roughly 260ns, which is a speedup by a factor of 2:\n+\n+```\n+sage: %timeit [x*x for i in range(1000)]\n+1000 loops, best of 3: 929 \u00b5s per loop\n+sage: %timeit [x.__mul__(x) for i in range(1000)]\n+1000 loops, best of 3: 884 \u00b5s per loop\n+sage: %timeit [x._mul_(x) for i in range(1000)]\n+1000 loops, best of 3: 624 \u00b5s per loop\n+```\n+\n``````\n",
    "created_at": "2016-05-25T22:57:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20681#issuecomment-360372",
    "user": "https://github.com/nthiery"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1,33 @@
+Recall that the Sage categories provide implementations for Python's
+special methods for the basic arithmetic operations (e.g. `__mul__`,
+`__add__`), that dispatch to the coercion model or call Sage's special
+methods (e.g. `_mul_`, `_add_`) for the internal operations.
 
+Before this ticket, this indirection induces an overhead of roughly
+500ns:
+
+```
+sage: S = Semigroups().example()
+sage: x = S.an_element()
+
+sage: sage: %timeit [x*x for i in range(1000)]
+1000 loops, best of 3: 1.21 ms per loop
+sage: sage: %timeit [x.__mul__(x) for i in range(1000)]
+1000 loops, best of 3: 1.12 ms per loop
+sage: sage: %timeit [x._mul_(x) for i in range(1000)]
+1000 loops, best of 3: 643 µs per loop
+```
+(the average timing don't vary much if we try again)
+
+After this ticket, which Cythonize those methods, the overhead is
+reduced to roughly 260ns, which is a speedup by a factor of 2:
+
+```
+sage: %timeit [x*x for i in range(1000)]
+1000 loops, best of 3: 929 µs per loop
+sage: %timeit [x.__mul__(x) for i in range(1000)]
+1000 loops, best of 3: 884 µs per loop
+sage: %timeit [x._mul_(x) for i in range(1000)]
+1000 loops, best of 3: 624 µs per loop
+```
+
``````




---

archive/issue_events_062900.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/20681",
    "rename": {
        "from": "Cythonize arithmetic special methods in the categories",
        "to": "Cythonize the special methods in the categories that handle coercion in arithmetic"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20681#event-62900"
}
```



---

archive/issue_comments_360373.json:
```json
{
    "body": "**Branch:** [u/nthiery/cythonize_arithmetic_special_methods_in_the_categories](https://github.com/sagemath/sagetrac-mirror/tree/u/nthiery/cythonize_arithmetic_special_methods_in_the_categories)",
    "created_at": "2016-05-25T23:02:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20681#issuecomment-360373",
    "user": "https://github.com/nthiery"
}
```

**Branch:** [u/nthiery/cythonize_arithmetic_special_methods_in_the_categories](https://github.com/sagemath/sagetrac-mirror/tree/u/nthiery/cythonize_arithmetic_special_methods_in_the_categories)



---

archive/issue_comments_360374.json:
```json
{
    "body": "<a id='comment:3'></a>\nThere is a doctest failure in `src/sage/categories/primer.py` due to the new location of `__mul__` for magmas, and I am not sure how you would want to change the primer to reflect that. Also if you could remove the two added blanklines in `finite_dimensional_modules_with_basis.py`. Thank you.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8e387d0dd88b75ca1564be37a27859f2ad87cd53\">8e387d0</a></td><td><code>20681: Cythonize the special methods in the categories that handle coercion in arithmetic</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8ea790453bfae9af8027b716fb54e0b679f3ffd0\">8ea7904</a></td><td><code>20681: add new file to the documentation</code></td></tr></table>\n",
    "created_at": "2016-05-26T06:02:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20681#issuecomment-360374",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:3'></a>
There is a doctest failure in `src/sage/categories/primer.py` due to the new location of `__mul__` for magmas, and I am not sure how you would want to change the primer to reflect that. Also if you could remove the two added blanklines in `finite_dimensional_modules_with_basis.py`. Thank you.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8e387d0dd88b75ca1564be37a27859f2ad87cd53">8e387d0</a></td><td><code>20681: Cythonize the special methods in the categories that handle coercion in arithmetic</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8ea790453bfae9af8027b716fb54e0b679f3ffd0">8ea7904</a></td><td><code>20681: add new file to the documentation</code></td></tr></table>




---

archive/issue_comments_360375.json:
```json
{
    "body": "**Reviewer:** Travis Scrimshaw",
    "created_at": "2016-05-26T06:02:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20681#issuecomment-360375",
    "user": "https://github.com/tscrim"
}
```

**Reviewer:** Travis Scrimshaw



---

archive/issue_comments_360376.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2016-05-26T06:02:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20681#issuecomment-360376",
    "user": "https://github.com/tscrim"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_360377.json:
```json
{
    "body": "**Commit:** [8ea790453bfae9af8027b716fb54e0b679f3ffd0](https://github.com/sagemath/sagetrac-mirror/commit/8ea790453bfae9af8027b716fb54e0b679f3ffd0)",
    "created_at": "2016-05-26T06:02:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20681#issuecomment-360377",
    "user": "https://github.com/tscrim"
}
```

**Commit:** [8ea790453bfae9af8027b716fb54e0b679f3ffd0](https://github.com/sagemath/sagetrac-mirror/commit/8ea790453bfae9af8027b716fb54e0b679f3ffd0)



---

archive/issue_comments_360378.json:
```json
{
    "body": "**Changing commit** from \"[8ea790453bfae9af8027b716fb54e0b679f3ffd0](https://github.com/sagemath/sagetrac-mirror/commit/8ea790453bfae9af8027b716fb54e0b679f3ffd0)\" to \"[2f83f598d7d08ee2002b749e6ba2f81d48983a25](https://github.com/sagemath/sagetrac-mirror/commit/2f83f598d7d08ee2002b749e6ba2f81d48983a25)\".",
    "created_at": "2016-05-26T07:38:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20681#issuecomment-360378",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[8ea790453bfae9af8027b716fb54e0b679f3ffd0](https://github.com/sagemath/sagetrac-mirror/commit/8ea790453bfae9af8027b716fb54e0b679f3ffd0)" to "[2f83f598d7d08ee2002b749e6ba2f81d48983a25](https://github.com/sagemath/sagetrac-mirror/commit/2f83f598d7d08ee2002b749e6ba2f81d48983a25)".



---

archive/issue_comments_360379.json:
```json
{
    "body": "<a id='comment:4'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2f83f598d7d08ee2002b749e6ba2f81d48983a25\">2f83f59</a></td><td><code>#20681: revert accidental addition of blank lines</code></td></tr></table>\n",
    "created_at": "2016-05-26T07:38:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20681#issuecomment-360379",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2f83f598d7d08ee2002b749e6ba2f81d48983a25">2f83f59</a></td><td><code>#20681: revert accidental addition of blank lines</code></td></tr></table>




---

archive/issue_comments_360380.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,33 +1,75 @@\n Recall that the Sage categories provide implementations for Python's\n special methods for the basic arithmetic operations (e.g. `__mul__`,\n `__add__`), that dispatch to the coercion model or call Sage's special\n-methods (e.g. `_mul_`, `_add_`) for the internal operations.\n+methods (e.g. `_mul_`, `_add_`) for the internal\n+operations. Furthermore, the default implementation for `_mul_` is to\n+delegate the work to the `product` method of the parent.\n \n-Before this ticket, this indirection induces an overhead of roughly\n-500ns:\n+Before this ticket, those indirections induced an overhead of roughly\n+100ns for `*`, 480ns for `__mul__` and 340ns for `_mul_`:\n \n ```\n-sage: S = Semigroups().example()\n-sage: x = S.an_element()\n-\n-sage: sage: %timeit [x*x for i in range(1000)]\n-1000 loops, best of 3: 1.21 ms per loop\n-sage: sage: %timeit [x.__mul__(x) for i in range(1000)]\n-1000 loops, best of 3: 1.12 ms per loop\n-sage: sage: %timeit [x._mul_(x) for i in range(1000)]\n-1000 loops, best of 3: 643 \u00b5s per loop\n+    sage: S = Semigroups().example()\n+    sage: x = S.an_element()\n+    sage: x*x\n+    42\n+    sage: sage: %timeit [x*x for i in range(1000)]\n+    1000 loops, best of 3: 1.21 ms per loop\n+    sage: sage: %timeit [x.__mul__(x) for i in range(1000)]\n+    1000 loops, best of 3: 1.12 ms per loop\n+    sage: sage: %timeit [x._mul_(x) for i in range(1000)]\n+    1000 loops, best of 3: 643 \u00b5s per loop\n+    sage: %timeit [S.product(x,x) for i in range(1000)]\n+    1000 loops, best of 3: 300 \u00b5s per loop\n ```\n-(the average timing don't vary much if we try again)\n \n After this ticket, which Cythonize those methods, the overhead is\n-reduced to roughly 260ns, which is a speedup by a factor of 2:\n+reduced to roughly 20ns for `*`, 100ns for `__mul__` and 160ms for\n+`_mul_`, which is a speedup by a factor of 3 on the accumulated\n+overhead, and an overall speedup by a factor of 2 for this particular\n+parent:\n \n ```\n-sage: %timeit [x*x for i in range(1000)]\n-1000 loops, best of 3: 929 \u00b5s per loop\n-sage: %timeit [x.__mul__(x) for i in range(1000)]\n-1000 loops, best of 3: 884 \u00b5s per loop\n-sage: %timeit [x._mul_(x) for i in range(1000)]\n-1000 loops, best of 3: 624 \u00b5s per loop\n+    sage: %timeit [x*x for i in range(1000)]\n+    1000 loops, best of 3: 596 \u00b5s per loop\n+    sage: %timeit [x.__mul__(x) for i in range(1000)]\n+    1000 loops, best of 3: 572 \u00b5s per loop\n+    sage: %timeit [x._mul_(x) for i in range(1000)]\n+    1000 loops, best of 3: 467 \u00b5s per loop\n+    sage: %timeit [S.product(x,x) for i in range(1000)]\n+    1000 loops, best of 3: 300 \u00b5s per loop\n ```\n \n+Notes\n+##### The average timings vary by about 5-10% from one run to the other.\n+\n+In this parent, the product is trivial, and implemented as a plain\n+Python `product` method in the parent. For a parent with a non trivial\n+Python product, the overhead of the indirections is now of 20%, which\n+is getting closer to acceptable::\n+\n+```\n+    sage: S = Semigroups().Finite().example()\n+    sage: x = S.an_element()\n+    sage: %timeit [S.product(x,x) for i in range(1000)]\n+    100 loops, best of 3: 4.39 ms per loop\n+    sage: %timeit [x*x for i in range(1000)]\n+    100 loops, best of 3: 5.28 ms per loop\n+```\n+\n+For comparison, here is the cost of the product of two (Sage)\n+integers::\n+\n+```\n+    sage: x = 3\n+    sage: %timeit [x*x for i in range(1000)]\n+    1000 loops, best of 3: 162 \u00b5s per loop\n+    sage: x = int(3)\n+    sage: %timeit [x*x for i in range(1000)]\n+    10000 loops, best of 3: 63.9 \u00b5s per loop\n+```\n+\n+So the 120ns overhead when using coercion methods `__mul__` provided\n+by categories (rather than from a Cython super class) is of the same\n+order of magnitude as the cost of a trivial multiplication.\n+\n``````\n",
    "created_at": "2016-05-26T08:52:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20681#issuecomment-360380",
    "user": "https://github.com/nthiery"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,33 +1,75 @@
 Recall that the Sage categories provide implementations for Python's
 special methods for the basic arithmetic operations (e.g. `__mul__`,
 `__add__`), that dispatch to the coercion model or call Sage's special
-methods (e.g. `_mul_`, `_add_`) for the internal operations.
+methods (e.g. `_mul_`, `_add_`) for the internal
+operations. Furthermore, the default implementation for `_mul_` is to
+delegate the work to the `product` method of the parent.
 
-Before this ticket, this indirection induces an overhead of roughly
-500ns:
+Before this ticket, those indirections induced an overhead of roughly
+100ns for `*`, 480ns for `__mul__` and 340ns for `_mul_`:
 
 ```
-sage: S = Semigroups().example()
-sage: x = S.an_element()
-
-sage: sage: %timeit [x*x for i in range(1000)]
-1000 loops, best of 3: 1.21 ms per loop
-sage: sage: %timeit [x.__mul__(x) for i in range(1000)]
-1000 loops, best of 3: 1.12 ms per loop
-sage: sage: %timeit [x._mul_(x) for i in range(1000)]
-1000 loops, best of 3: 643 µs per loop
+    sage: S = Semigroups().example()
+    sage: x = S.an_element()
+    sage: x*x
+    42
+    sage: sage: %timeit [x*x for i in range(1000)]
+    1000 loops, best of 3: 1.21 ms per loop
+    sage: sage: %timeit [x.__mul__(x) for i in range(1000)]
+    1000 loops, best of 3: 1.12 ms per loop
+    sage: sage: %timeit [x._mul_(x) for i in range(1000)]
+    1000 loops, best of 3: 643 µs per loop
+    sage: %timeit [S.product(x,x) for i in range(1000)]
+    1000 loops, best of 3: 300 µs per loop
 ```
-(the average timing don't vary much if we try again)
 
 After this ticket, which Cythonize those methods, the overhead is
-reduced to roughly 260ns, which is a speedup by a factor of 2:
+reduced to roughly 20ns for `*`, 100ns for `__mul__` and 160ms for
+`_mul_`, which is a speedup by a factor of 3 on the accumulated
+overhead, and an overall speedup by a factor of 2 for this particular
+parent:
 
 ```
-sage: %timeit [x*x for i in range(1000)]
-1000 loops, best of 3: 929 µs per loop
-sage: %timeit [x.__mul__(x) for i in range(1000)]
-1000 loops, best of 3: 884 µs per loop
-sage: %timeit [x._mul_(x) for i in range(1000)]
-1000 loops, best of 3: 624 µs per loop
+    sage: %timeit [x*x for i in range(1000)]
+    1000 loops, best of 3: 596 µs per loop
+    sage: %timeit [x.__mul__(x) for i in range(1000)]
+    1000 loops, best of 3: 572 µs per loop
+    sage: %timeit [x._mul_(x) for i in range(1000)]
+    1000 loops, best of 3: 467 µs per loop
+    sage: %timeit [S.product(x,x) for i in range(1000)]
+    1000 loops, best of 3: 300 µs per loop
 ```
 
+Notes
+##### The average timings vary by about 5-10% from one run to the other.
+
+In this parent, the product is trivial, and implemented as a plain
+Python `product` method in the parent. For a parent with a non trivial
+Python product, the overhead of the indirections is now of 20%, which
+is getting closer to acceptable::
+
+```
+    sage: S = Semigroups().Finite().example()
+    sage: x = S.an_element()
+    sage: %timeit [S.product(x,x) for i in range(1000)]
+    100 loops, best of 3: 4.39 ms per loop
+    sage: %timeit [x*x for i in range(1000)]
+    100 loops, best of 3: 5.28 ms per loop
+```
+
+For comparison, here is the cost of the product of two (Sage)
+integers::
+
+```
+    sage: x = 3
+    sage: %timeit [x*x for i in range(1000)]
+    1000 loops, best of 3: 162 µs per loop
+    sage: x = int(3)
+    sage: %timeit [x*x for i in range(1000)]
+    10000 loops, best of 3: 63.9 µs per loop
+```
+
+So the 120ns overhead when using coercion methods `__mul__` provided
+by categories (rather than from a Cython super class) is of the same
+order of magnitude as the cost of a trivial multiplication.
+
``````




---

archive/issue_comments_360381.json:
```json
{
    "body": "**Changing commit** from \"[2f83f598d7d08ee2002b749e6ba2f81d48983a25](https://github.com/sagemath/sagetrac-mirror/commit/2f83f598d7d08ee2002b749e6ba2f81d48983a25)\" to \"[6ea05420b67b16f563fb2b1cedb098b0d6682b66](https://github.com/sagemath/sagetrac-mirror/commit/6ea05420b67b16f563fb2b1cedb098b0d6682b66)\".",
    "created_at": "2016-05-26T08:56:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20681#issuecomment-360381",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[2f83f598d7d08ee2002b749e6ba2f81d48983a25](https://github.com/sagemath/sagetrac-mirror/commit/2f83f598d7d08ee2002b749e6ba2f81d48983a25)" to "[6ea05420b67b16f563fb2b1cedb098b0d6682b66](https://github.com/sagemath/sagetrac-mirror/commit/6ea05420b67b16f563fb2b1cedb098b0d6682b66)".



---

archive/issue_comments_360382.json:
```json
{
    "body": "<a id='comment:6'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/86460abcc7250b602d6e60d62dcc119e7d28f0d9\">86460ab</a></td><td><code>20681: further optimized `__mul__`, and cythonize _mul_parent</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6ea05420b67b16f563fb2b1cedb098b0d6682b66\">6ea0542</a></td><td><code>20681: updated the category primer according to the Cythonization of `__mul__` and _mul_parent</code></td></tr></table>\n",
    "created_at": "2016-05-26T08:56:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20681#issuecomment-360382",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/86460abcc7250b602d6e60d62dcc119e7d28f0d9">86460ab</a></td><td><code>20681: further optimized `__mul__`, and cythonize _mul_parent</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6ea05420b67b16f563fb2b1cedb098b0d6682b66">6ea0542</a></td><td><code>20681: updated the category primer according to the Cythonization of `__mul__` and _mul_parent</code></td></tr></table>




---

archive/issue_comments_360383.json:
```json
{
    "body": "**Changing commit** from \"[6ea05420b67b16f563fb2b1cedb098b0d6682b66](https://github.com/sagemath/sagetrac-mirror/commit/6ea05420b67b16f563fb2b1cedb098b0d6682b66)\" to \"[0698cf523f274626f4f1eabcd0dc224c623e3f47](https://github.com/sagemath/sagetrac-mirror/commit/0698cf523f274626f4f1eabcd0dc224c623e3f47)\".",
    "created_at": "2016-05-26T08:59:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20681#issuecomment-360383",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[6ea05420b67b16f563fb2b1cedb098b0d6682b66](https://github.com/sagemath/sagetrac-mirror/commit/6ea05420b67b16f563fb2b1cedb098b0d6682b66)" to "[0698cf523f274626f4f1eabcd0dc224c623e3f47](https://github.com/sagemath/sagetrac-mirror/commit/0698cf523f274626f4f1eabcd0dc224c623e3f47)".



---

archive/issue_comments_360384.json:
```json
{
    "body": "<a id='comment:7'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0698cf523f274626f4f1eabcd0dc224c623e3f47\">0698cf5</a></td><td><code>20681: doctest fix</code></td></tr></table>\n",
    "created_at": "2016-05-26T08:59:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20681#issuecomment-360384",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0698cf523f274626f4f1eabcd0dc224c623e3f47">0698cf5</a></td><td><code>20681: doctest fix</code></td></tr></table>




---

archive/issue_comments_360385.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -40,8 +40,9 @@\n     1000 loops, best of 3: 300 \u00b5s per loop\n ```\n \n-Notes\n-##### The average timings vary by about 5-10% from one run to the other.\n+*Notes*\n+\n+The average timings vary by about 5-10% from one run to the other.\n \n In this parent, the product is trivial, and implemented as a plain\n Python `product` method in the parent. For a parent with a non trivial\n``````\n",
    "created_at": "2016-05-26T09:00:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20681#issuecomment-360385",
    "user": "https://github.com/nthiery"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -40,8 +40,9 @@
     1000 loops, best of 3: 300 µs per loop
 ```
 
-Notes
-##### The average timings vary by about 5-10% from one run to the other.
+*Notes*
+
+The average timings vary by about 5-10% from one run to the other.
 
 In this parent, the product is trivial, and implemented as a plain
 Python `product` method in the parent. For a parent with a non trivial
``````




---

archive/issue_comments_360386.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2016-05-26T09:00:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20681#issuecomment-360386",
    "user": "https://github.com/nthiery"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_360387.json:
```json
{
    "body": "**Changing branch** from \"[u/nthiery/cythonize_arithmetic_special_methods_in_the_categories](https://github.com/sagemath/sagetrac-mirror/tree/u/nthiery/cythonize_arithmetic_special_methods_in_the_categories)\" to \"[public/categories/cythonize_arithmetic_special_methods-20681](https://github.com/sagemath/sagetrac-mirror/tree/public/categories/cythonize_arithmetic_special_methods-20681)\".",
    "created_at": "2016-05-26T09:11:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20681#issuecomment-360387",
    "user": "https://github.com/tscrim"
}
```

**Changing branch** from "[u/nthiery/cythonize_arithmetic_special_methods_in_the_categories](https://github.com/sagemath/sagetrac-mirror/tree/u/nthiery/cythonize_arithmetic_special_methods_in_the_categories)" to "[public/categories/cythonize_arithmetic_special_methods-20681](https://github.com/sagemath/sagetrac-mirror/tree/public/categories/cythonize_arithmetic_special_methods-20681)".



---

archive/issue_comments_360388.json:
```json
{
    "body": "<a id='comment:10'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8024147bc82c55fadd2baf7f02cfad9ea838885f\">8024147</a></td><td><code>Some little doc fixes while-we-are-at-it (tm).</code></td></tr></table>\n",
    "created_at": "2016-05-26T09:11:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20681#issuecomment-360388",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:10'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8024147bc82c55fadd2baf7f02cfad9ea838885f">8024147</a></td><td><code>Some little doc fixes while-we-are-at-it (tm).</code></td></tr></table>




---

archive/issue_comments_360389.json:
```json
{
    "body": "**Changing commit** from \"[0698cf523f274626f4f1eabcd0dc224c623e3f47](https://github.com/sagemath/sagetrac-mirror/commit/0698cf523f274626f4f1eabcd0dc224c623e3f47)\" to \"[8024147bc82c55fadd2baf7f02cfad9ea838885f](https://github.com/sagemath/sagetrac-mirror/commit/8024147bc82c55fadd2baf7f02cfad9ea838885f)\".",
    "created_at": "2016-05-26T09:11:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20681#issuecomment-360389",
    "user": "https://github.com/tscrim"
}
```

**Changing commit** from "[0698cf523f274626f4f1eabcd0dc224c623e3f47](https://github.com/sagemath/sagetrac-mirror/commit/0698cf523f274626f4f1eabcd0dc224c623e3f47)" to "[8024147bc82c55fadd2baf7f02cfad9ea838885f](https://github.com/sagemath/sagetrac-mirror/commit/8024147bc82c55fadd2baf7f02cfad9ea838885f)".



---

archive/issue_comments_360390.json:
```json
{
    "body": "<a id='comment:11'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9f44f49d7b93d47e9c46b923725dea7ff7fff3d0\">9f44f49</a></td><td><code>20681: further improved the documentation of the coercion methods</code></td></tr></table>\n",
    "created_at": "2016-05-26T10:12:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20681#issuecomment-360390",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9f44f49d7b93d47e9c46b923725dea7ff7fff3d0">9f44f49</a></td><td><code>20681: further improved the documentation of the coercion methods</code></td></tr></table>




---

archive/issue_comments_360391.json:
```json
{
    "body": "**Changing commit** from \"[8024147bc82c55fadd2baf7f02cfad9ea838885f](https://github.com/sagemath/sagetrac-mirror/commit/8024147bc82c55fadd2baf7f02cfad9ea838885f)\" to \"[9f44f49d7b93d47e9c46b923725dea7ff7fff3d0](https://github.com/sagemath/sagetrac-mirror/commit/9f44f49d7b93d47e9c46b923725dea7ff7fff3d0)\".",
    "created_at": "2016-05-26T10:12:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20681#issuecomment-360391",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[8024147bc82c55fadd2baf7f02cfad9ea838885f](https://github.com/sagemath/sagetrac-mirror/commit/8024147bc82c55fadd2baf7f02cfad9ea838885f)" to "[9f44f49d7b93d47e9c46b923725dea7ff7fff3d0](https://github.com/sagemath/sagetrac-mirror/commit/9f44f49d7b93d47e9c46b923725dea7ff7fff3d0)".



---

archive/issue_comments_360392.json:
```json
{
    "body": "**Changing commit** from \"[9f44f49d7b93d47e9c46b923725dea7ff7fff3d0](https://github.com/sagemath/sagetrac-mirror/commit/9f44f49d7b93d47e9c46b923725dea7ff7fff3d0)\" to \"[de62437f434f282dd41256ff9529d4aca3d679fd](https://github.com/sagemath/sagetrac-mirror/commit/de62437f434f282dd41256ff9529d4aca3d679fd)\".",
    "created_at": "2016-05-26T10:15:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20681#issuecomment-360392",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[9f44f49d7b93d47e9c46b923725dea7ff7fff3d0](https://github.com/sagemath/sagetrac-mirror/commit/9f44f49d7b93d47e9c46b923725dea7ff7fff3d0)" to "[de62437f434f282dd41256ff9529d4aca3d679fd](https://github.com/sagemath/sagetrac-mirror/commit/de62437f434f282dd41256ff9529d4aca3d679fd)".



---

archive/issue_comments_360393.json:
```json
{
    "body": "<a id='comment:12'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/de62437f434f282dd41256ff9529d4aca3d679fd\">de62437</a></td><td><code>20681: ReST fixes</code></td></tr></table>\n",
    "created_at": "2016-05-26T10:15:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20681#issuecomment-360393",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/de62437f434f282dd41256ff9529d4aca3d679fd">de62437</a></td><td><code>20681: ReST fixes</code></td></tr></table>




---

archive/issue_comments_360394.json:
```json
{
    "body": "<a id='comment:13'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/de62437f434f282dd41256ff9529d4aca3d679fd\">de62437</a></td><td><code>20681: ReST fixes</code></td></tr></table>\n",
    "created_at": "2016-05-26T10:16:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20681#issuecomment-360394",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:13'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/de62437f434f282dd41256ff9529d4aca3d679fd">de62437</a></td><td><code>20681: ReST fixes</code></td></tr></table>




---

archive/issue_comments_360395.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -40,7 +40,7 @@\n     1000 loops, best of 3: 300 \u00b5s per loop\n ```\n \n-*Notes*\n+=Notes=\n \n The average timings vary by about 5-10% from one run to the other.\n \n``````\n",
    "created_at": "2016-05-26T10:16:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20681#issuecomment-360395",
    "user": "https://github.com/nthiery"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -40,7 +40,7 @@
     1000 loops, best of 3: 300 µs per loop
 ```
 
-*Notes*
+=Notes=
 
 The average timings vary by about 5-10% from one run to the other.
 
``````




---

archive/issue_comments_360396.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2016-05-26T10:16:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20681#issuecomment-360396",
    "user": "https://github.com/tscrim"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_360397.json:
```json
{
    "body": "**Changing status** from positive_review to needs_info.",
    "created_at": "2016-05-26T11:32:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20681#issuecomment-360397",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from positive_review to needs_info.



---

archive/issue_comments_360398.json:
```json
{
    "body": "<a id='comment:15'></a>\nI understand the point of this patch, but I think it's not the right thing to do. The methods you define now in `coercion_methods.pyx` are just copies of methods available in various subclasses of `Element` anyway (e.g. `ModuleElement`, `RingElement`).\n\nI think the right thing to do is just to get rid of the category framework for these arithmetic methods and just define them in `Element`. That will be even faster than the current patch.",
    "created_at": "2016-05-26T11:32:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20681#issuecomment-360398",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:15'></a>
I understand the point of this patch, but I think it's not the right thing to do. The methods you define now in `coercion_methods.pyx` are just copies of methods available in various subclasses of `Element` anyway (e.g. `ModuleElement`, `RingElement`).

I think the right thing to do is just to get rid of the category framework for these arithmetic methods and just define them in `Element`. That will be even faster than the current patch.



---

archive/issue_comments_360399.json:
```json
{
    "body": "<a id='comment:16'></a>\nIn other words: you write\n\n```\n# This could eventually be moved to SageObject\n```\nI think you should just do that instead (but for `Element` instead of `SageObject`).",
    "created_at": "2016-05-26T11:35:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20681#issuecomment-360399",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:16'></a>
In other words: you write

```
# This could eventually be moved to SageObject
```
I think you should just do that instead (but for `Element` instead of `SageObject`).



---

archive/issue_comments_360400.json:
```json
{
    "body": "<a id='comment:17'></a>\nNote that I don't really have anything against this ticket (if it improves things, why not). So, feel free to set the ticket back to positive_review if you disagree with me.",
    "created_at": "2016-05-26T11:41:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20681#issuecomment-360400",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:17'></a>
Note that I don't really have anything against this ticket (if it improves things, why not). So, feel free to set the ticket back to positive_review if you disagree with me.



---

archive/issue_comments_360401.json:
```json
{
    "body": "<a id='comment:18'></a>\nReplying to [jdemeyer](#comment%3A16):\n> In other words: you write\n> \n> ```\n> # This could eventually be moved to SageObject\n> ```\n> I think you should just do that instead (but for `Element` instead of `SageObject`).\n\n\n(for the record: I just moved that comment which was already there).\n\nYes, I pondered about that, since we had this parallel discussion\nabout moving all the coercion methods up to Element. If we do the\nmove, we should do it for all coercion methods at once. However, given\nthat this moving is a non trivial API change and still under\ndiscussion, I prefer to postpone it to a later ticket.",
    "created_at": "2016-05-26T12:57:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20681#issuecomment-360401",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:18'></a>
Replying to [jdemeyer](#comment%3A16):
> In other words: you write
> 
> ```
> # This could eventually be moved to SageObject
> ```
> I think you should just do that instead (but for `Element` instead of `SageObject`).


(for the record: I just moved that comment which was already there).

Yes, I pondered about that, since we had this parallel discussion
about moving all the coercion methods up to Element. If we do the
move, we should do it for all coercion methods at once. However, given
that this moving is a non trivial API change and still under
discussion, I prefer to postpone it to a later ticket.



---

archive/issue_comments_360402.json:
```json
{
    "body": "**Changing status** from needs_info to positive_review.",
    "created_at": "2016-05-26T12:58:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20681#issuecomment-360402",
    "user": "https://github.com/nthiery"
}
```

**Changing status** from needs_info to positive_review.



---

archive/issue_comments_360403.json:
```json
{
    "body": "<a id='comment:19'></a>\nThanks though for raising this!",
    "created_at": "2016-05-26T12:58:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20681#issuecomment-360403",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:19'></a>
Thanks though for raising this!



---

archive/issue_comments_360404.json:
```json
{
    "body": "<a id='comment:20'></a>\nsee patchbot report",
    "created_at": "2016-05-27T23:02:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20681#issuecomment-360404",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:20'></a>
see patchbot report



---

archive/issue_comments_360405.json:
```json
{
    "body": "**Changing status** from positive_review to needs_work.",
    "created_at": "2016-05-27T23:02:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20681#issuecomment-360405",
    "user": "https://github.com/vbraun"
}
```

**Changing status** from positive_review to needs_work.



---

archive/issue_comments_360406.json:
```json
{
    "body": "<a id='comment:21'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/99f986867ea06d7fe494d315a11de955b189594d\">99f9868</a></td><td><code>Fixing documentation.</code></td></tr></table>\n",
    "created_at": "2016-05-28T07:42:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20681#issuecomment-360406",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:21'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/99f986867ea06d7fe494d315a11de955b189594d">99f9868</a></td><td><code>Fixing documentation.</code></td></tr></table>




---

archive/issue_comments_360407.json:
```json
{
    "body": "**Changing commit** from \"[de62437f434f282dd41256ff9529d4aca3d679fd](https://github.com/sagemath/sagetrac-mirror/commit/de62437f434f282dd41256ff9529d4aca3d679fd)\" to \"[99f986867ea06d7fe494d315a11de955b189594d](https://github.com/sagemath/sagetrac-mirror/commit/99f986867ea06d7fe494d315a11de955b189594d)\".",
    "created_at": "2016-05-28T07:42:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20681#issuecomment-360407",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[de62437f434f282dd41256ff9529d4aca3d679fd](https://github.com/sagemath/sagetrac-mirror/commit/de62437f434f282dd41256ff9529d4aca3d679fd)" to "[99f986867ea06d7fe494d315a11de955b189594d](https://github.com/sagemath/sagetrac-mirror/commit/99f986867ea06d7fe494d315a11de955b189594d)".



---

archive/issue_comments_360408.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2016-05-28T07:43:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20681#issuecomment-360408",
    "user": "https://github.com/tscrim"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_360409.json:
```json
{
    "body": "<a id='comment:22'></a>\nNicolas, can you double check. Also are the referenced methods correct in the `__*mul__` doc?",
    "created_at": "2016-05-28T07:43:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20681#issuecomment-360409",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:22'></a>
Nicolas, can you double check. Also are the referenced methods correct in the `__*mul__` doc?



---

archive/issue_comments_360410.json:
```json
{
    "body": "**Changing commit** from \"[99f986867ea06d7fe494d315a11de955b189594d](https://github.com/sagemath/sagetrac-mirror/commit/99f986867ea06d7fe494d315a11de955b189594d)\" to \"[6ad71d48edfeb6743488810f416ae1d430ff5dff](https://github.com/sagemath/sagetrac-mirror/commit/6ad71d48edfeb6743488810f416ae1d430ff5dff)\".",
    "created_at": "2016-05-28T08:34:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20681#issuecomment-360410",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[99f986867ea06d7fe494d315a11de955b189594d](https://github.com/sagemath/sagetrac-mirror/commit/99f986867ea06d7fe494d315a11de955b189594d)" to "[6ad71d48edfeb6743488810f416ae1d430ff5dff](https://github.com/sagemath/sagetrac-mirror/commit/6ad71d48edfeb6743488810f416ae1d430ff5dff)".



---

archive/issue_comments_360411.json:
```json
{
    "body": "<a id='comment:23'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6ad71d48edfeb6743488810f416ae1d430ff5dff\">6ad71d4</a></td><td><code>20681: trivial space adjustment</code></td></tr></table>\n",
    "created_at": "2016-05-28T08:34:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20681#issuecomment-360411",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:23'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6ad71d48edfeb6743488810f416ae1d430ff5dff">6ad71d4</a></td><td><code>20681: trivial space adjustment</code></td></tr></table>




---

archive/issue_comments_360412.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2016-05-28T08:36:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20681#issuecomment-360412",
    "user": "https://github.com/nthiery"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_360413.json:
```json
{
    "body": "<a id='comment:24'></a>\nThanks for all the rest fixes! I had actually just about to start working on them :-)",
    "created_at": "2016-05-28T08:36:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20681#issuecomment-360413",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:24'></a>
Thanks for all the rest fixes! I had actually just about to start working on them :-)



---

archive/issue_comments_360414.json:
```json
{
    "body": "<a id='comment:25'></a>\nPDF docs still don't build",
    "created_at": "2016-05-28T14:19:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20681#issuecomment-360414",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:25'></a>
PDF docs still don't build



---

archive/issue_comments_360415.json:
```json
{
    "body": "**Changing status** from positive_review to needs_work.",
    "created_at": "2016-05-28T14:19:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20681#issuecomment-360415",
    "user": "https://github.com/vbraun"
}
```

**Changing status** from positive_review to needs_work.



---

archive/issue_comments_360416.json:
```json
{
    "body": "<a id='comment:26'></a>\nMy guess is that it doesn't like that `coercion_methods.pyx` does not have any public methods. We probably should `autodoc` those all in anyways...",
    "created_at": "2016-05-29T13:47:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20681#issuecomment-360416",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:26'></a>
My guess is that it doesn't like that `coercion_methods.pyx` does not have any public methods. We probably should `autodoc` those all in anyways...



---

archive/issue_comments_360417.json:
```json
{
    "body": "<a id='comment:27'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4e88e4c311b0108f21d28a2c3587193e364ee0fd\">4e88e4c</a></td><td><code>20681: ReST fix</code></td></tr></table>\n",
    "created_at": "2016-05-30T06:57:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20681#issuecomment-360417",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:27'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4e88e4c311b0108f21d28a2c3587193e364ee0fd">4e88e4c</a></td><td><code>20681: ReST fix</code></td></tr></table>




---

archive/issue_comments_360418.json:
```json
{
    "body": "**Changing commit** from \"[6ad71d48edfeb6743488810f416ae1d430ff5dff](https://github.com/sagemath/sagetrac-mirror/commit/6ad71d48edfeb6743488810f416ae1d430ff5dff)\" to \"[4e88e4c311b0108f21d28a2c3587193e364ee0fd](https://github.com/sagemath/sagetrac-mirror/commit/4e88e4c311b0108f21d28a2c3587193e364ee0fd)\".",
    "created_at": "2016-05-30T06:57:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20681#issuecomment-360418",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[6ad71d48edfeb6743488810f416ae1d430ff5dff](https://github.com/sagemath/sagetrac-mirror/commit/6ad71d48edfeb6743488810f416ae1d430ff5dff)" to "[4e88e4c311b0108f21d28a2c3587193e364ee0fd](https://github.com/sagemath/sagetrac-mirror/commit/4e88e4c311b0108f21d28a2c3587193e364ee0fd)".



---

archive/issue_comments_360419.json:
```json
{
    "body": "<a id='comment:28'></a>\nDo we want to include these functions into the html/pdf doc or keep them hidden?",
    "created_at": "2016-05-30T08:21:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20681#issuecomment-360419",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:28'></a>
Do we want to include these functions into the html/pdf doc or keep them hidden?



---

archive/issue_comments_360420.json:
```json
{
    "body": "<a id='comment:29'></a>\nWe definitely would want to have them appear in the doc of the original classes. But this will only happen when we finally configure Sphinx to include the special methods (which are not private methods!).\n\nFor the \"coercion_methods\" module, it does not really matter.\n\nThe pdf doc compiles on my machine after my latest rest fix.",
    "created_at": "2016-05-30T21:50:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20681#issuecomment-360420",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:29'></a>
We definitely would want to have them appear in the doc of the original classes. But this will only happen when we finally configure Sphinx to include the special methods (which are not private methods!).

For the "coercion_methods" module, it does not really matter.

The pdf doc compiles on my machine after my latest rest fix.



---

archive/issue_comments_360421.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2016-05-30T21:50:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20681#issuecomment-360421",
    "user": "https://github.com/nthiery"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_360422.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2016-05-30T21:52:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20681#issuecomment-360422",
    "user": "https://github.com/tscrim"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_360423.json:
```json
{
    "body": "<a id='comment:31'></a>\nOkay. Let's get this into Sage.",
    "created_at": "2016-05-30T21:52:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20681#issuecomment-360423",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:31'></a>
Okay. Let's get this into Sage.



---

archive/issue_comments_360424.json:
```json
{
    "body": "<a id='comment:32'></a>\nPart of this ticket was already merged in 7.3.beta2. Please take whatever else was on this ticket and move it to a new ticket.",
    "created_at": "2016-05-31T07:36:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20681#issuecomment-360424",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:32'></a>
Part of this ticket was already merged in 7.3.beta2. Please take whatever else was on this ticket and move it to a new ticket.



---

archive/issue_events_062901.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-05-31T07:36:59Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/20681",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20681#event-62901"
}
```



---

archive/issue_comments_360425.json:
```json
{
    "body": "<a id='comment:33'></a>\nSee #20733",
    "created_at": "2016-05-31T13:51:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20681#issuecomment-360425",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:33'></a>
See #20733



---

archive/issue_comments_360426.json:
```json
{
    "body": "<a id='comment:34'></a>\nFollow-up: most of this new file will be removed in #20767. Only `_mul_parent` will remain.",
    "created_at": "2016-08-01T15:16:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20681#issuecomment-360426",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:34'></a>
Follow-up: most of this new file will be removed in #20767. Only `_mul_parent` will remain.
