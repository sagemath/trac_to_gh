# Issue 20062: Make _floordiv_() return the Euclidean quotient for power series over fields

archive/issues_019825.json:
```json
{
    "assignees": [],
    "body": "There exists a method `PowerSeries_poly.__floordiv__()`, but it is not clear how it differs from ordinary division (see [#15601 comment:43](https://github.com/sagemath/sage/issues/15601#comment:43)), or how it should differ mathematically.\n\nWe replace this method by a new method `PowerSeries._floordiv_()`, which returns the Euclidean quotient over fields and is a deprecated alias for `_div_()` over other rings.\n\nCC:  @jdemeyer\n\nBranch/Commit: **[b7cd5cb](https://github.com/sagemath/sagetrac-mirror/commit/b7cd5cb0331479589f777c4da8fdd35c3bc1bb2b)**\n\nReviewer: **Bruno Grenet**\n\nAuthor: **Peter Bruin**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/20062_\n\n",
    "closed_at": "2016-05-24T07:06:28Z",
    "created_at": "2016-02-16T11:05:59Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20algebra",
        "https://github.com/sagemath/sage/labels/p4%20%E2%80%93%20minor"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-7.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Make _floordiv_() return the Euclidean quotient for power series over fields",
    "type": "issue",
    "updated_at": "2016-05-24T07:06:28Z",
    "url": "https://github.com/sagemath/sage/issues/20062",
    "user": "https://github.com/pjbruin"
}
```
There exists a method `PowerSeries_poly.__floordiv__()`, but it is not clear how it differs from ordinary division (see [#15601 comment:43](https://github.com/sagemath/sage/issues/15601#comment:43)), or how it should differ mathematically.

We replace this method by a new method `PowerSeries._floordiv_()`, which returns the Euclidean quotient over fields and is a deprecated alias for `_div_()` over other rings.

CC:  @jdemeyer

Branch/Commit: **[b7cd5cb](https://github.com/sagemath/sagetrac-mirror/commit/b7cd5cb0331479589f777c4da8fdd35c3bc1bb2b)**

Reviewer: **Bruno Grenet**

Author: **Peter Bruin**

_Issue created by migration from https://trac.sagemath.org/ticket/20062_





---

archive/issue_events_255930.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2016-02-16T11:05:59Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/20062",
    "milestone_number": null,
    "milestone_title": "sage-7.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20062#event-255930"
}
```



---

archive/issue_events_255931.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2016-02-16T11:05:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20062",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20algebra",
    "label_color": "0000ff",
    "label_name": "component: algebra",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20062#event-255931"
}
```



---

archive/issue_events_255932.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2016-02-16T11:05:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20062",
    "label": "https://github.com/sagemath/sage/labels/p4%20%E2%80%93%20minor",
    "label_color": "ffe799",
    "label_name": "p4 \u2013 minor",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20062#event-255932"
}
```



---

archive/issue_comments_290155.json:
```json
{
    "body": "Branch: **[u/pbruin/20062-PowerSeries_floordiv](https://github.com/sagemath/sagetrac-mirror/tree/u/pbruin/20062-PowerSeries_floordiv)**",
    "created_at": "2016-02-16T11:14:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20062#issuecomment-290155",
    "user": "https://github.com/pjbruin"
}
```

Branch: **[u/pbruin/20062-PowerSeries_floordiv](https://github.com/sagemath/sagetrac-mirror/tree/u/pbruin/20062-PowerSeries_floordiv)**



---

archive/issue_comments_290156.json:
```json
{
    "body": "Commit: **[e9719f7](https://github.com/sagemath/sagetrac-mirror/commit/e9719f7399ffab100407a360c16fe0596e7f2689)**",
    "created_at": "2016-02-16T11:14:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20062#issuecomment-290156",
    "user": "https://github.com/pjbruin"
}
```

Commit: **[e9719f7](https://github.com/sagemath/sagetrac-mirror/commit/e9719f7399ffab100407a360c16fe0596e7f2689)**



---

archive/issue_events_255933.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2016-02-16T11:14:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20062",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20062#event-255933"
}
```



---

archive/issue_comments_290157.json:
```json
{
    "body": "<a id='comment:2'>Comment 2:</a>\nI don't fully agree with your proposal: In (generic) implementations for elements of rings, one may need to have a `__floordiv__` (which returns the same as `__div__`). That's why (I guess) there is a `__floordiv__` in the class `FieldElement`. So I would not deprecate it, but rather simply make it an (non-deprecated) alias of `__div__`.",
    "created_at": "2016-03-16T11:43:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20062#issuecomment-290157",
    "user": "https://github.com/bgrenet"
}
```

<a id='comment:2'>Comment 2:</a>
I don't fully agree with your proposal: In (generic) implementations for elements of rings, one may need to have a `__floordiv__` (which returns the same as `__div__`). That's why (I guess) there is a `__floordiv__` in the class `FieldElement`. So I would not deprecate it, but rather simply make it an (non-deprecated) alias of `__div__`.



---

archive/issue_events_255934.json:
```json
{
    "actor": "https://github.com/bgrenet",
    "created_at": "2016-03-16T11:43:26Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20062",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20062#event-255934"
}
```



---

archive/issue_events_255935.json:
```json
{
    "actor": "https://github.com/bgrenet",
    "created_at": "2016-03-16T11:43:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20062",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20062#event-255935"
}
```



---

archive/issue_comments_290158.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nReplying to [@bgrenet](#comment%3A2):\n> I don't fully agree with your proposal: In (generic) implementations for elements of rings, one may need to have a `__floordiv__` (which returns the same as `__div__`).\n\nWhy would this be necessary?  If the user calls `__floordiv__`, he presumably does this for a reason, i.e. expects that it behaves differently from `__div__`...\n\n> That's why (I guess) there is a `__floordiv__` in the class `FieldElement`.\n\nWell, power series rings are not fields.  There is also an implementation of `_floordiv_` in `RingElement`, which explicitly raises an error saying `unsupported operand parent(s) for '//'`.  In fact, this error is even raised when applying `__floordiv__` to elements of `RR`:\n\n```\nsage: RR(1.2) // RR(2.3)\n...\nTypeError: unsupported operand parent(s) for '//': 'Real Field with 53 bits of precision' and 'Real Field with 53 bits of precision'\n```\n\n> So I would not deprecate it, but rather simply make it an (non-deprecated) alias of `__div__`.\n\nThen we should do this in general for ring elements; I don't really see the advantage of this...\n\nIn my opinion, it would make more sense to make sure that power series rings `R` over a field, or more generally all discrete valuation rings `(R, v)`, are put into the category of Euclidean domains.  Then floor division in `R` can be implemented using Euclidean division, so `f * g = f / g` if `v(g) <= v(f)` and `f * g = 0` if `v(g) > v(f)`.  However, this has the disadvantage that it is not the same as the current `__floordiv__`, which (as far as I can see) is the same as `__div__`.",
    "created_at": "2016-03-17T09:08:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20062#issuecomment-290158",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:3'>Comment 3:</a>
Replying to [@bgrenet](#comment%3A2):
> I don't fully agree with your proposal: In (generic) implementations for elements of rings, one may need to have a `__floordiv__` (which returns the same as `__div__`).

Why would this be necessary?  If the user calls `__floordiv__`, he presumably does this for a reason, i.e. expects that it behaves differently from `__div__`...

> That's why (I guess) there is a `__floordiv__` in the class `FieldElement`.

Well, power series rings are not fields.  There is also an implementation of `_floordiv_` in `RingElement`, which explicitly raises an error saying `unsupported operand parent(s) for '//'`.  In fact, this error is even raised when applying `__floordiv__` to elements of `RR`:

```
sage: RR(1.2) // RR(2.3)
...
TypeError: unsupported operand parent(s) for '//': 'Real Field with 53 bits of precision' and 'Real Field with 53 bits of precision'
```

> So I would not deprecate it, but rather simply make it an (non-deprecated) alias of `__div__`.

Then we should do this in general for ring elements; I don't really see the advantage of this...

In my opinion, it would make more sense to make sure that power series rings `R` over a field, or more generally all discrete valuation rings `(R, v)`, are put into the category of Euclidean domains.  Then floor division in `R` can be implemented using Euclidean division, so `f * g = f / g` if `v(g) <= v(f)` and `f * g = 0` if `v(g) > v(f)`.  However, this has the disadvantage that it is not the same as the current `__floordiv__`, which (as far as I can see) is the same as `__div__`.



---

archive/issue_comments_290159.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nReplying to [@pjbruin](#comment%3A3):\n> Why would this be necessary?  If the user calls `__floordiv__`, he presumably does this for a reason, i.e. expects that it behaves differently from `__div__`...\n\nOne case I very often encounter is the need of an \"exact division\", that is a division when you know in advance that the result is exact.\n \n> \n> > That's why (I guess) there is a `__floordiv__` in the class `FieldElement`.\n\n> \n> Well, power series rings are not fields.  There is also an implementation of `_floordiv_` in `RingElement`, which explicitly raises an error saying `unsupported operand parent(s) for '//'`.  In fact, this error is even raised when applying `__floordiv__` to elements of `RR`:\n> \n> ```\n> sage: RR(1.2) // RR(2.3)\n> ...\n> TypeError: unsupported operand parent(s) for '//': 'Real Field with 53 bits of precision' and 'Real Field with 53 bits of precision'\n> ```\n\nRight. But this behavior for `RR` is currently being discussed in #15260.\n \n> \n> > So I would not deprecate it, but rather simply make it an (non-deprecated) alias of `__div__`.\n\n> \n> Then we should do this in general for ring elements; I don't really see the advantage of this...\n\nThat's right, it is probably a bad idea to make `__floordiv__` an alias of `__div__` in this case. \n \n> \n> In my opinion, it would make more sense to make sure that power series rings `R` over a field, or more generally all discrete valuation rings `(R, v)`, are put into the category of Euclidean domains.  Then floor division in `R` can be implemented using Euclidean division, so `f * g = f / g` if `v(g) <= v(f)` and `f * g = 0` if `v(g) > v(f)`.  However, this has the disadvantage that it is not the same as the current `__floordiv__`, which (as far as I can see) is the same as `__div__`.\n\nYou're perfectly right. My two-cent on this would be as follows:\n\n* `__div__` should return an element of the fraction field, as it is the case for elements of `ZZ` or polynomials for instance; I find the current situation weird:\n\n```python\nsage: R.<x> = QQ[[]]\nsage: (1/(1+x)).parent()\nPower Series Ring in x over Rational Field\nsage: (1/x).parent()\nLaurent Series Ring in x over Rational Field\n```\n  while for instance for `ZZ`:\n\n```python\nsage: (1/1).parent() is (1/2).parent()\nTrue\n```\n\n\n* `__floordiv__` in power series rings over a field should return the quotient in the euclidean division, since these rings are euclidean.\n\n* `__floordiv__` in power series rings over `ZZ` (say) should behave the same way as it behaves for polynomials over `ZZ`, that is return the quotient in the euclidean division (as over `QQ`) but reducing each coefficient modulo the leading coefficient of the divisor. For instance, `2-3*x-x<sup>2+O(x</sup>3)//(2+x)` should equal `1-2*x+0*x<sup>2+O(x</sup>3)`.",
    "created_at": "2016-03-17T10:56:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20062#issuecomment-290159",
    "user": "https://github.com/bgrenet"
}
```

<a id='comment:4'>Comment 4:</a>
Replying to [@pjbruin](#comment%3A3):
> Why would this be necessary?  If the user calls `__floordiv__`, he presumably does this for a reason, i.e. expects that it behaves differently from `__div__`...

One case I very often encounter is the need of an "exact division", that is a division when you know in advance that the result is exact.
 
> 
> > That's why (I guess) there is a `__floordiv__` in the class `FieldElement`.

> 
> Well, power series rings are not fields.  There is also an implementation of `_floordiv_` in `RingElement`, which explicitly raises an error saying `unsupported operand parent(s) for '//'`.  In fact, this error is even raised when applying `__floordiv__` to elements of `RR`:
> 
> ```
> sage: RR(1.2) // RR(2.3)
> ...
> TypeError: unsupported operand parent(s) for '//': 'Real Field with 53 bits of precision' and 'Real Field with 53 bits of precision'
> ```

Right. But this behavior for `RR` is currently being discussed in #15260.
 
> 
> > So I would not deprecate it, but rather simply make it an (non-deprecated) alias of `__div__`.

> 
> Then we should do this in general for ring elements; I don't really see the advantage of this...

That's right, it is probably a bad idea to make `__floordiv__` an alias of `__div__` in this case. 
 
> 
> In my opinion, it would make more sense to make sure that power series rings `R` over a field, or more generally all discrete valuation rings `(R, v)`, are put into the category of Euclidean domains.  Then floor division in `R` can be implemented using Euclidean division, so `f * g = f / g` if `v(g) <= v(f)` and `f * g = 0` if `v(g) > v(f)`.  However, this has the disadvantage that it is not the same as the current `__floordiv__`, which (as far as I can see) is the same as `__div__`.

You're perfectly right. My two-cent on this would be as follows:

* `__div__` should return an element of the fraction field, as it is the case for elements of `ZZ` or polynomials for instance; I find the current situation weird:

```python
sage: R.<x> = QQ[[]]
sage: (1/(1+x)).parent()
Power Series Ring in x over Rational Field
sage: (1/x).parent()
Laurent Series Ring in x over Rational Field
```
  while for instance for `ZZ`:

```python
sage: (1/1).parent() is (1/2).parent()
True
```


* `__floordiv__` in power series rings over a field should return the quotient in the euclidean division, since these rings are euclidean.

* `__floordiv__` in power series rings over `ZZ` (say) should behave the same way as it behaves for polynomials over `ZZ`, that is return the quotient in the euclidean division (as over `QQ`) but reducing each coefficient modulo the leading coefficient of the divisor. For instance, `2-3*x-x<sup>2+O(x</sup>3)//(2+x)` should equal `1-2*x+0*x<sup>2+O(x</sup>3)`.



---

archive/issue_comments_290160.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nI tried to (1) add a method `_floordiv_` to `EuclideanDomains.ElementMethods`, and (2) make `DiscreteValuationRings` a subcategory of `EuclideanDomains`.  However, `f // g` then still complains that the parents do not support this operator.  If I understand correctly, this is because `RingElement._floordiv_` comes before `EuclideanDomains.ElementMethods._floordiv_` in the method resolution order.  We cannot remove the first one because it must be implemented in `RingElement`, being a `cpdef` method.\n\nJeroen, do you (as the author of e.g. #2034) perhaps know a way around this?\n\n**Edit:** (2) was done in #20283.",
    "created_at": "2016-03-18T08:50:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20062#issuecomment-290160",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:5'>Comment 5:</a>
I tried to (1) add a method `_floordiv_` to `EuclideanDomains.ElementMethods`, and (2) make `DiscreteValuationRings` a subcategory of `EuclideanDomains`.  However, `f // g` then still complains that the parents do not support this operator.  If I understand correctly, this is because `RingElement._floordiv_` comes before `EuclideanDomains.ElementMethods._floordiv_` in the method resolution order.  We cannot remove the first one because it must be implemented in `RingElement`, being a `cpdef` method.

Jeroen, do you (as the author of e.g. #2034) perhaps know a way around this?

**Edit:** (2) was done in #20283.



---

archive/issue_comments_290161.json:
```json
{
    "body": "<a id='comment:6'>Comment 6:</a>\nReplying to [@pjbruin](#comment%3A5):\n> I tried to (1) add a method `_floordiv_` to `EuclideanDomains.ElementMethods`\n\nI think that such category stuff should probably not be used for Cython methods, I'm not entirely surprised that it doesn't work.\n\nIn any case, I think there is not much point in implementing stuff if we haven't agreed on the semantics of `//`.",
    "created_at": "2016-03-18T11:23:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20062#issuecomment-290161",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:6'>Comment 6:</a>
Replying to [@pjbruin](#comment%3A5):
> I tried to (1) add a method `_floordiv_` to `EuclideanDomains.ElementMethods`

I think that such category stuff should probably not be used for Cython methods, I'm not entirely surprised that it doesn't work.

In any case, I think there is not much point in implementing stuff if we haven't agreed on the semantics of `//`.



---

archive/issue_comments_290162.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nAfter thinking about this a bit more, it still seems meaningful to me to have an operator `//` that is different from `/`, and that returns the \"Euclidean\" quotient in the case of power series over a field.  (I am not sure what to do for power series over **Z**, for example).\n\nHowever, both to warn users and because the \"correct\" `//` seems to be non-trivial to implement, it is probably good to start by deprecating the current behaviour where `//` behaves identically to `/`.  Hence I am setting this ticket back to \"needs review\" and propose to do the \"meaningful\" reimplementation of `//` at a later time.",
    "created_at": "2016-03-31T21:53:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20062#issuecomment-290162",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:7'>Comment 7:</a>
After thinking about this a bit more, it still seems meaningful to me to have an operator `//` that is different from `/`, and that returns the "Euclidean" quotient in the case of power series over a field.  (I am not sure what to do for power series over **Z**, for example).

However, both to warn users and because the "correct" `//` seems to be non-trivial to implement, it is probably good to start by deprecating the current behaviour where `//` behaves identically to `/`.  Hence I am setting this ticket back to "needs review" and propose to do the "meaningful" reimplementation of `//` at a later time.



---

archive/issue_events_255936.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2016-03-31T21:53:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20062",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20062#event-255936"
}
```



---

archive/issue_events_255937.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2016-03-31T21:53:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20062",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20062#event-255937"
}
```



---

archive/issue_comments_290163.json:
```json
{
    "body": "<a id='comment:8'>Comment 8:</a>\nReplying to [@pjbruin](#comment%3A7):\n> After thinking about this a bit more, it still seems meaningful to me to have an operator `//` that is different from `/`, and that returns the \"Euclidean\" quotient in the case of power series over a field.  (I am not sure what to do for power series over **Z**, for example).\n> \n> However, both to warn users and because the \"correct\" `//` seems to be non-trivial to implement, it is probably good to start by deprecating the current behaviour where `//` behaves identically to `/`.  Hence I am setting this ticket back to \"needs review\" and propose to do the \"meaningful\" reimplementation of `//` at a later time.\n\nNote that there exists a method `quo_rem` for `DiscreteValuationRing`s which works. Thus it should be possible to use it to get a method `__floordiv__`. I am not sure to understand the subtleties described in [comment:5](#comment%3A5) and [comment:6](#comment%3A6), but at least there is some working code. For instance:\n\n```python\nsage: R.<x> = QQ[[]]\nsage: R(1).quo_rem(1+t)\n(1 - t + t^2 - t^3 + t^4 - t^5 + t^6 - t^7 + t^8 - t^9 + t^10 - t^11 + t^12 - t^13 + t^14 - t^15 + t^16 - t^17 + t^18 - t^19 + O(t^20),\n 0)\n```",
    "created_at": "2016-04-01T08:05:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20062#issuecomment-290163",
    "user": "https://github.com/bgrenet"
}
```

<a id='comment:8'>Comment 8:</a>
Replying to [@pjbruin](#comment%3A7):
> After thinking about this a bit more, it still seems meaningful to me to have an operator `//` that is different from `/`, and that returns the "Euclidean" quotient in the case of power series over a field.  (I am not sure what to do for power series over **Z**, for example).
> 
> However, both to warn users and because the "correct" `//` seems to be non-trivial to implement, it is probably good to start by deprecating the current behaviour where `//` behaves identically to `/`.  Hence I am setting this ticket back to "needs review" and propose to do the "meaningful" reimplementation of `//` at a later time.

Note that there exists a method `quo_rem` for `DiscreteValuationRing`s which works. Thus it should be possible to use it to get a method `__floordiv__`. I am not sure to understand the subtleties described in [comment:5](#comment%3A5) and [comment:6](#comment%3A6), but at least there is some working code. For instance:

```python
sage: R.<x> = QQ[[]]
sage: R(1).quo_rem(1+t)
(1 - t + t^2 - t^3 + t^4 - t^5 + t^6 - t^7 + t^8 - t^9 + t^10 - t^11 + t^12 - t^13 + t^14 - t^15 + t^16 - t^17 + t^18 - t^19 + O(t^20),
 0)
```



---

archive/issue_comments_290164.json:
```json
{
    "body": "<a id='comment:9'>Comment 9:</a>\nReplying to [@bgrenet](#comment%3A8):\n> Note that there exists a method `quo_rem` for `DiscreteValuationRing`s which works.\n\nYes, I added that in #20283.\n> Thus it should be possible to use it to get a method `__floordiv__`. I am not sure to understand the subtleties described in [comment:5](#comment%3A5) and [comment:6](#comment%3A6), but at least there is some working code. For instance:\n> \n> ```python\n> sage: R.<x> = QQ[[]]\n> sage: R(1).quo_rem(1+t)\n> (1 - t + t^2 - t^3 + t^4 - t^5 + t^6 - t^7 + t^8 - t^9 + t^10 - t^11 + t^12 - t^13 + t^14 - t^15 + t^16 - t^17 + t^18 - t^19 + O(t^20),\n>  0)\n> ```\n\nYes, absolutely.  There are two problems: (1) due to the problem mentioned in [comment:5](#comment%3A5), it seems that we cannot easily implement a generic `__floordiv__` using `quo_rem` for all Euclidean domains simultaneously, and (2) in view of backward compatibility it would not be very good to change the behaviour of `__floordiv__` without any warning or deprecation of the old behaviour.",
    "created_at": "2016-04-01T09:19:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20062#issuecomment-290164",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:9'>Comment 9:</a>
Replying to [@bgrenet](#comment%3A8):
> Note that there exists a method `quo_rem` for `DiscreteValuationRing`s which works.

Yes, I added that in #20283.
> Thus it should be possible to use it to get a method `__floordiv__`. I am not sure to understand the subtleties described in [comment:5](#comment%3A5) and [comment:6](#comment%3A6), but at least there is some working code. For instance:
> 
> ```python
> sage: R.<x> = QQ[[]]
> sage: R(1).quo_rem(1+t)
> (1 - t + t^2 - t^3 + t^4 - t^5 + t^6 - t^7 + t^8 - t^9 + t^10 - t^11 + t^12 - t^13 + t^14 - t^15 + t^16 - t^17 + t^18 - t^19 + O(t^20),
>  0)
> ```

Yes, absolutely.  There are two problems: (1) due to the problem mentioned in [comment:5](#comment%3A5), it seems that we cannot easily implement a generic `__floordiv__` using `quo_rem` for all Euclidean domains simultaneously, and (2) in view of backward compatibility it would not be very good to change the behaviour of `__floordiv__` without any warning or deprecation of the old behaviour.



---

archive/issue_comments_290165.json:
```json
{
    "body": "<a id='comment:10'>Comment 10:</a>\nReplying to [@pjbruin](#comment%3A9):\n> Replying to [@bgrenet](#comment%3A8):\n> > Note that there exists a method `quo_rem` for `DiscreteValuationRing`s which works.\n\n> Yes, I added that in #20283.\n\nI did not notice that, so you probably knew this `:-)`.\n \n> > Thus it should be possible to use it to get a method `__floordiv__`. I am not sure to understand the subtleties described in [comment:5](#comment%3A5) and [comment:6](#comment%3A6), but at least there is some working code. For instance:\n> > \n> > ```python\n> > sage: R.<x> = QQ[[]]\n> > sage: R(1).quo_rem(1+t)\n> > (1 - t + t^2 - t^3 + t^4 - t^5 + t^6 - t^7 + t^8 - t^9 + t^10 - t^11 + t^12 - t^13 + t^14 - t^15 + t^16 - t^17 + t^18 - t^19 + O(t^20),\n> >  0)\n> > ```\n\n> Yes, absolutely.  There are two problems: (1) due to the problem mentioned in [comment:5](#comment%3A5), it seems that we cannot easily implement a generic `__floordiv__` using `quo_rem` for all Euclidean domains simultaneously, and (2) in view of backward compatibility it would not be very good to change the behaviour of `__floordiv__` without any warning or deprecation of the old behaviour.\n\nAgain, I simply trust you for the technical part about `__floordiv__`. For the deprecation policy, I (probably) agree that we should warn the user. Isn't it possible to put a deprecation warning while changing the behavior? I mean, one could do something like:\n\n* If `self.quo_rem(other)` works, return `self.quo_rem(other)[0]`;\n* Else return `self._div_(other)`;\n* In all cases, print a deprecation message such as (message to be improved for sure!): `The operator // now performs a euclidean division (when possible) rather than a division. Use / instead to perform a division.`\n\nBtw, I think that this change should also go with a change of behavior in the `truediv` algorithm, that should always return an element of the fraction field of the PowerSeries ring.",
    "created_at": "2016-04-01T09:50:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20062#issuecomment-290165",
    "user": "https://github.com/bgrenet"
}
```

<a id='comment:10'>Comment 10:</a>
Replying to [@pjbruin](#comment%3A9):
> Replying to [@bgrenet](#comment%3A8):
> > Note that there exists a method `quo_rem` for `DiscreteValuationRing`s which works.

> Yes, I added that in #20283.

I did not notice that, so you probably knew this `:-)`.
 
> > Thus it should be possible to use it to get a method `__floordiv__`. I am not sure to understand the subtleties described in [comment:5](#comment%3A5) and [comment:6](#comment%3A6), but at least there is some working code. For instance:
> > 
> > ```python
> > sage: R.<x> = QQ[[]]
> > sage: R(1).quo_rem(1+t)
> > (1 - t + t^2 - t^3 + t^4 - t^5 + t^6 - t^7 + t^8 - t^9 + t^10 - t^11 + t^12 - t^13 + t^14 - t^15 + t^16 - t^17 + t^18 - t^19 + O(t^20),
> >  0)
> > ```

> Yes, absolutely.  There are two problems: (1) due to the problem mentioned in [comment:5](#comment%3A5), it seems that we cannot easily implement a generic `__floordiv__` using `quo_rem` for all Euclidean domains simultaneously, and (2) in view of backward compatibility it would not be very good to change the behaviour of `__floordiv__` without any warning or deprecation of the old behaviour.

Again, I simply trust you for the technical part about `__floordiv__`. For the deprecation policy, I (probably) agree that we should warn the user. Isn't it possible to put a deprecation warning while changing the behavior? I mean, one could do something like:

* If `self.quo_rem(other)` works, return `self.quo_rem(other)[0]`;
* Else return `self._div_(other)`;
* In all cases, print a deprecation message such as (message to be improved for sure!): `The operator // now performs a euclidean division (when possible) rather than a division. Use / instead to perform a division.`

Btw, I think that this change should also go with a change of behavior in the `truediv` algorithm, that should always return an element of the fraction field of the PowerSeries ring.



---

archive/issue_comments_290166.json:
```json
{
    "body": "<a id='comment:11'>Comment 11:</a>\nA proposal along the line of my previous comment would be as follows:\n\n```python\n    cpdef RingElement _floordiv_(self, RingElement denom):\n        \"\"\"\n        ...\n        \"\"\"\n        from sage.misc.superseded import deprecation                               \n        try:                                                                       \n            deprecation(20062, \"the operator // now performs a euclidean division for power series over fields,      use / instead to perform a (true) division\")\n            return self.quo_rem(denom)[0]                                          \n        except AttributeError, NotImplementedError:                              \n            deprecation(20062, \"the operator // is deprecated for power series over non-fields, use / instead\")\n            return self._div_(denom)\n```\n\nTesting this code, I get a deprecation warning about deprecation warnings so it is probably not the right way to write this:\n\n```python \n/opt/sage/local/lib/python2.7/site-packages/IPython/core/formatters.py:92: DeprecationWarning: DisplayFormatter._ipython_display_formatter_default is deprecated: use @default decorator instead.\n```",
    "created_at": "2016-04-01T10:05:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20062#issuecomment-290166",
    "user": "https://github.com/bgrenet"
}
```

<a id='comment:11'>Comment 11:</a>
A proposal along the line of my previous comment would be as follows:

```python
    cpdef RingElement _floordiv_(self, RingElement denom):
        """
        ...
        """
        from sage.misc.superseded import deprecation                               
        try:                                                                       
            deprecation(20062, "the operator // now performs a euclidean division for power series over fields,      use / instead to perform a (true) division")
            return self.quo_rem(denom)[0]                                          
        except AttributeError, NotImplementedError:                              
            deprecation(20062, "the operator // is deprecated for power series over non-fields, use / instead")
            return self._div_(denom)
```

Testing this code, I get a deprecation warning about deprecation warnings so it is probably not the right way to write this:

```python 
/opt/sage/local/lib/python2.7/site-packages/IPython/core/formatters.py:92: DeprecationWarning: DisplayFormatter._ipython_display_formatter_default is deprecated: use @default decorator instead.
```



---

archive/issue_comments_290167.json:
```json
{
    "body": "Changed commit from **[e9719f7](https://github.com/sagemath/sagetrac-mirror/commit/e9719f7399ffab100407a360c16fe0596e7f2689)** to **[5e5748b](https://github.com/sagemath/sagetrac-mirror/commit/5e5748bdaf542f550aadd722d06925c668b473ab)**",
    "created_at": "2016-04-09T13:05:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20062#issuecomment-290167",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[e9719f7](https://github.com/sagemath/sagetrac-mirror/commit/e9719f7399ffab100407a360c16fe0596e7f2689)** to **[5e5748b](https://github.com/sagemath/sagetrac-mirror/commit/5e5748bdaf542f550aadd722d06925c668b473ab)**



---

archive/issue_comments_290168.json:
```json
{
    "body": "<a id='comment:12'>Comment 12:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5e5748bdaf542f550aadd722d06925c668b473ab\">5e5748b</a></td><td><code>Trac 20062: make `_floordiv_` do Euclidean division for power series over fields</code></td></tr></table>\n",
    "created_at": "2016-04-09T13:05:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20062#issuecomment-290168",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:12'>Comment 12:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5e5748bdaf542f550aadd722d06925c668b473ab">5e5748b</a></td><td><code>Trac 20062: make `_floordiv_` do Euclidean division for power series over fields</code></td></tr></table>




---

archive/issue_comments_290169.json:
```json
{
    "body": "<a id='comment:13'>Comment 13:</a>\nThe new comment implements a variant of your suggestion; I think the message in the case of fields should be a normal warning (since the behaviour changed), not a deprecation.",
    "created_at": "2016-04-09T13:11:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20062#issuecomment-290169",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:13'>Comment 13:</a>
The new comment implements a variant of your suggestion; I think the message in the case of fields should be a normal warning (since the behaviour changed), not a deprecation.



---

archive/issue_events_255938.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2016-04-09T13:11:12Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/20062",
    "title_is": "Make _floordiv_() return the Euclidean quotient for power series over fields",
    "title_was": "Make _floordiv_() for power series a deprecated alias for _div_()",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20062#event-255938"
}
```



---

archive/issue_comments_290170.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n There exists a method `PowerSeries_poly.__floordiv__()`, but it is not clear how it differs from ordinary division (see [#15601 comment:43](https://github.com/sagemath/sage/issues/15601#comment:43)), or how it should differ mathematically.\n \n-We replace this method by a new method `PowerSeries._floordiv_()`, which is a deprecated alias for `_div_()`.\n+We replace this method by a new method `PowerSeries._floordiv_()`, which returns the Euclidean quotient over fields and is a deprecated alias for `_div_()` over other rings.\n``````\n",
    "created_at": "2016-04-09T13:11:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20062#issuecomment-290170",
    "user": "https://github.com/pjbruin"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
 There exists a method `PowerSeries_poly.__floordiv__()`, but it is not clear how it differs from ordinary division (see [#15601 comment:43](https://github.com/sagemath/sage/issues/15601#comment:43)), or how it should differ mathematically.
 
-We replace this method by a new method `PowerSeries._floordiv_()`, which is a deprecated alias for `_div_()`.
+We replace this method by a new method `PowerSeries._floordiv_()`, which returns the Euclidean quotient over fields and is a deprecated alias for `_div_()` over other rings.
``````




---

archive/issue_comments_290171.json:
```json
{
    "body": "Changed commit from **[5e5748b](https://github.com/sagemath/sagetrac-mirror/commit/5e5748bdaf542f550aadd722d06925c668b473ab)** to **[b7cd5cb](https://github.com/sagemath/sagetrac-mirror/commit/b7cd5cb0331479589f777c4da8fdd35c3bc1bb2b)**",
    "created_at": "2016-04-11T22:08:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20062#issuecomment-290171",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[5e5748b](https://github.com/sagemath/sagetrac-mirror/commit/5e5748bdaf542f550aadd722d06925c668b473ab)** to **[b7cd5cb](https://github.com/sagemath/sagetrac-mirror/commit/b7cd5cb0331479589f777c4da8fdd35c3bc1bb2b)**



---

archive/issue_comments_290172.json:
```json
{
    "body": "<a id='comment:14'>Comment 14:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b7cd5cb0331479589f777c4da8fdd35c3bc1bb2b\">b7cd5cb</a></td><td><code>Trac 20062: improvements related to imports</code></td></tr></table>\n",
    "created_at": "2016-04-11T22:08:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20062#issuecomment-290172",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:14'>Comment 14:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b7cd5cb0331479589f777c4da8fdd35c3bc1bb2b">b7cd5cb</a></td><td><code>Trac 20062: improvements related to imports</code></td></tr></table>




---

archive/issue_comments_290173.json:
```json
{
    "body": "Reviewer: **Bruno Grenet**",
    "created_at": "2016-05-23T13:36:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20062#issuecomment-290173",
    "user": "https://github.com/bgrenet"
}
```

Reviewer: **Bruno Grenet**



---

archive/issue_comments_290174.json:
```json
{
    "body": "<a id='comment:15'>Comment 15:</a>\nThis looks good to me!",
    "created_at": "2016-05-23T13:36:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20062#issuecomment-290174",
    "user": "https://github.com/bgrenet"
}
```

<a id='comment:15'>Comment 15:</a>
This looks good to me!



---

archive/issue_events_255939.json:
```json
{
    "actor": "https://github.com/bgrenet",
    "created_at": "2016-05-23T13:36:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20062",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20062#event-255939"
}
```



---

archive/issue_events_255940.json:
```json
{
    "actor": "https://github.com/bgrenet",
    "created_at": "2016-05-23T13:36:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20062",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20062#event-255940"
}
```



---

archive/issue_comments_290175.json:
```json
{
    "body": "Changed branch from **[u/pbruin/20062-PowerSeries_floordiv](https://github.com/sagemath/sagetrac-mirror/tree/u/pbruin/20062-PowerSeries_floordiv)** to **[b7cd5cb](https://github.com/sagemath/sagetrac-mirror/commit/b7cd5cb0331479589f777c4da8fdd35c3bc1bb2b)**",
    "created_at": "2016-05-24T07:06:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20062#issuecomment-290175",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/pbruin/20062-PowerSeries_floordiv](https://github.com/sagemath/sagetrac-mirror/tree/u/pbruin/20062-PowerSeries_floordiv)** to **[b7cd5cb](https://github.com/sagemath/sagetrac-mirror/commit/b7cd5cb0331479589f777c4da8fdd35c3bc1bb2b)**



---

archive/issue_events_255941.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-05-24T07:06:28Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20062",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20062#event-255941"
}
```



---

archive/issue_events_255942.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "fc8db57804930b9b08a70d3a021b1f869a729d9f",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2016-05-24T07:06:28Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/20062",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20062#event-255942"
}
```
