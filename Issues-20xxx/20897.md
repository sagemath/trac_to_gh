# Issue 20897: Fixes to SAGE_BANNER=bare support throughout

archive/issues_020660.json:
```json
{
    "body": "#20322 fixed the standard `sage` CLI so that if `SAGE_BANNER=bare`, the simplified, non-unicode banner is displayed.\n\nHowever, there were several other places this directive was not obeyed.  First `sage --help` would still display the full banner regardless.  Second, the built-in `banner()` function (from what the banner file is generated) also does not obey `SAGE_BANNER=bare`.\n\nBecause there is code that calls `banner()` directly, it should still only display the simplified banner if the `SAGE_BANNER=bare` variable is set in the environment (this is particularly relevant in the Docker container on Windows...)\n\n(This bug caused a live demo to fail!  (Mysteriously the same demo did not fail when I tested it minutes earlier....not sure why it suddenly changed))\n\nReviewer: Fr\u00e9d\u00e9ric Chapoton\n\nAuthor: Erik Bray\n\nBranch: 9e5e9a57d87f8a9700bd06327b76ec23b4a978d5\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/20897\n\n",
    "closed_at": "2016-07-13T23:36:55Z",
    "created_at": "2016-06-28T14:01:37Z",
    "labels": [
        "component: user interface",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.3",
    "title": "Fixes to SAGE_BANNER=bare support throughout",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/20897",
    "user": "https://github.com/embray"
}
```
#20322 fixed the standard `sage` CLI so that if `SAGE_BANNER=bare`, the simplified, non-unicode banner is displayed.

However, there were several other places this directive was not obeyed.  First `sage --help` would still display the full banner regardless.  Second, the built-in `banner()` function (from what the banner file is generated) also does not obey `SAGE_BANNER=bare`.

Because there is code that calls `banner()` directly, it should still only display the simplified banner if the `SAGE_BANNER=bare` variable is set in the environment (this is particularly relevant in the Docker container on Windows...)

(This bug caused a live demo to fail!  (Mysteriously the same demo did not fail when I tested it minutes earlier....not sure why it suddenly changed))

Reviewer: Frédéric Chapoton

Author: Erik Bray

Branch: 9e5e9a57d87f8a9700bd06327b76ec23b4a978d5

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/20897





---

archive/issue_comments_303618.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-06-28T14:01:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20897",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20897#issuecomment-303618",
    "user": "https://github.com/embray"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_303619.json:
```json
{
    "body": "<a id='comment:2'></a>this looks strange:\n\n```diff\n--- a/src/bin/sage-update-version\n+++ b/src/bin/sage-update-version\n@@ -46,9 +46,10 @@ EOF\n # Rebuild the Sage library for the change in version.py to take effect\n \"$SAGE_ROOT/sage\" -b\n \n-# Update Sage version file\n-echo \"SageMath version $SAGE_VERSION, Release Date: $SAGE_RELEASE_DATE\" \\\n-    > \"$SAGE_ROOT/VERSION.txt\"\n+# Update the simplified Sage banner\n+\"$SAGE_ROOT/sage\" --python -c \\\n+    \"import sage.misc.banner; sage.misc.banner.banner(full=False)\" \\\n+    > \"$SAGE_SRC/bin/VERSION.txt\"\n```\nDo you really want to change the place where VERSION.txt is stored ?",
    "created_at": "2016-06-28T18:24:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20897",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20897#issuecomment-303619",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:2'></a>this looks strange:

```diff
--- a/src/bin/sage-update-version
+++ b/src/bin/sage-update-version
@@ -46,9 +46,10 @@ EOF
 # Rebuild the Sage library for the change in version.py to take effect
 "$SAGE_ROOT/sage" -b
 
-# Update Sage version file
-echo "SageMath version $SAGE_VERSION, Release Date: $SAGE_RELEASE_DATE" \
-    > "$SAGE_ROOT/VERSION.txt"
+# Update the simplified Sage banner
+"$SAGE_ROOT/sage" --python -c \
+    "import sage.misc.banner; sage.misc.banner.banner(full=False)" \
+    > "$SAGE_SRC/bin/VERSION.txt"
```
Do you really want to change the place where VERSION.txt is stored ?



---

archive/issue_comments_303620.json:
```json
{
    "body": "<a id='comment:3'></a>Oops, thanks for pointing that out.  No, that's a copy/paste error.",
    "created_at": "2016-06-29T08:19:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20897",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20897#issuecomment-303620",
    "user": "https://github.com/embray"
}
```

<a id='comment:3'></a>Oops, thanks for pointing that out.  No, that's a copy/paste error.



---

archive/issue_comments_303621.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-06-29T09:22:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20897",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20897#issuecomment-303621",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_303622.json:
```json
{
    "body": "<a id='comment:5'></a>I fixed the error and rebased.",
    "created_at": "2016-06-29T09:23:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20897",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20897#issuecomment-303622",
    "user": "https://github.com/embray"
}
```

<a id='comment:5'></a>I fixed the error and rebased.



---

archive/issue_comments_303623.json:
```json
{
    "body": "<a id='comment:6'></a>You cannot use SAGE_BANNER_TEXT at the beginning of \"sage\" script, as sage-env is not yet sourced. The banner here needs to come from a file.",
    "created_at": "2016-06-30T16:21:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20897",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20897#issuecomment-303623",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:6'></a>You cannot use SAGE_BANNER_TEXT at the beginning of "sage" script, as sage-env is not yet sourced. The banner here needs to come from a file.



---

archive/issue_comments_303624.json:
```json
{
    "body": "<a id='comment:7'></a>It's only used directly in two functions: `help_banner` and `sage_setup`.  ISTM `sage-env` is sourced before either of this functions are used anywhere.",
    "created_at": "2016-06-30T16:46:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20897",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20897#issuecomment-303624",
    "user": "https://github.com/embray"
}
```

<a id='comment:7'></a>It's only used directly in two functions: `help_banner` and `sage_setup`.  ISTM `sage-env` is sourced before either of this functions are used anywhere.



---

archive/issue_comments_303625.json:
```json
{
    "body": "<a id='comment:8'></a>ok, you are right.\n\nBut now I am worried by something else, in sage-update-version\n\nSAGE_RELEASE_DATE was used there and is no longer used anywhere. Are you creating some kind of circular thing, where nobody takes care of doing the real job ?",
    "created_at": "2016-06-30T17:02:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20897",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20897#issuecomment-303625",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:8'></a>ok, you are right.

But now I am worried by something else, in sage-update-version

SAGE_RELEASE_DATE was used there and is no longer used anywhere. Are you creating some kind of circular thing, where nobody takes care of doing the real job ?



---

archive/issue_comments_303626.json:
```json
{
    "body": "<a id='comment:9'></a>Let me take a look at that--I hadn't really paid attention to `SAGE_RELEASE_DATE`",
    "created_at": "2016-07-01T09:12:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20897",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20897#issuecomment-303626",
    "user": "https://github.com/embray"
}
```

<a id='comment:9'></a>Let me take a look at that--I hadn't really paid attention to `SAGE_RELEASE_DATE`



---

archive/issue_comments_303627.json:
```json
{
    "body": "<a id='comment:10'></a>Okay, I'm not sure what you mean by `SAGE_RELEASE_DATE` is no longer used anywhere.  It's used right in `sage-update-version` to write `$SAGE_SRC/bin/sage-version.sh` and `$SAGE_SRC/sage/version.py`.  That's where the `SAGE_VERSION` and `SAGE_RELEASE_DATE` values can be retrieved from at runtime.\n\nThe `VERSION.txt` file is mostly superfluous and I'm not sure why it's there exactly.",
    "created_at": "2016-07-01T09:20:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20897",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20897#issuecomment-303627",
    "user": "https://github.com/embray"
}
```

<a id='comment:10'></a>Okay, I'm not sure what you mean by `SAGE_RELEASE_DATE` is no longer used anywhere.  It's used right in `sage-update-version` to write `$SAGE_SRC/bin/sage-version.sh` and `$SAGE_SRC/sage/version.py`.  That's where the `SAGE_VERSION` and `SAGE_RELEASE_DATE` values can be retrieved from at runtime.

The `VERSION.txt` file is mostly superfluous and I'm not sure why it's there exactly.



---

archive/issue_comments_303628.json:
```json
{
    "body": "<a id='comment:11'></a>I would give a positive review if you would revert this change\n\n```diff\n-# Update Sage version file\n-echo \"SageMath version $SAGE_VERSION, Release Date: $SAGE_RELEASE_DATE\" \\\n+# Update the simplified Sage banner\n+\"$SAGE_ROOT/sage\" --python -c \\\n+    \"import sage.misc.banner; sage.misc.banner.banner(full=False)\" \\\n     > \"$SAGE_ROOT/VERSION.txt\"\n```",
    "created_at": "2016-07-11T12:54:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20897",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20897#issuecomment-303628",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:11'></a>I would give a positive review if you would revert this change

```diff
-# Update Sage version file
-echo "SageMath version $SAGE_VERSION, Release Date: $SAGE_RELEASE_DATE" \
+# Update the simplified Sage banner
+"$SAGE_ROOT/sage" --python -c \
+    "import sage.misc.banner; sage.misc.banner.banner(full=False)" \
     > "$SAGE_ROOT/VERSION.txt"
```



---

archive/issue_comments_303629.json:
```json
{
    "body": "<a id='comment:12'></a>Why?  What's wrong with that change?\n\nIf anything it de-duplicates code.  The existing code there already outputs the *exact same* message as `sage.misc.banner.banner(full=False)`.  Why have two different implementations of outputting the same text, which *ought* to be outputting the same text, when they this point isn't well documented and could accidentally diverge?  It's also perfectly reasonably symmetric that the two types of \"banners\" are generated from the same code, with a different options (`full=True` vs (`full=False`).",
    "created_at": "2016-07-11T13:00:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20897",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20897#issuecomment-303629",
    "user": "https://github.com/embray"
}
```

<a id='comment:12'></a>Why?  What's wrong with that change?

If anything it de-duplicates code.  The existing code there already outputs the *exact same* message as `sage.misc.banner.banner(full=False)`.  Why have two different implementations of outputting the same text, which *ought* to be outputting the same text, when they this point isn't well documented and could accidentally diverge?  It's also perfectly reasonably symmetric that the two types of "banners" are generated from the same code, with a different options (`full=True` vs (`full=False`).



---

archive/issue_comments_303630.json:
```json
{
    "body": "<a id='comment:13'></a>Replying to [comment:12 embray]:\n> Why?  What's wrong with that change?\n\n\nMaybe it's ok, but it will just take me more time to check that, for something not so important..",
    "created_at": "2016-07-11T13:05:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20897",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20897#issuecomment-303630",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:13'></a>Replying to [comment:12 embray]:
> Why?  What's wrong with that change?


Maybe it's ok, but it will just take me more time to check that, for something not so important..



---

archive/issue_comments_303631.json:
```json
{
    "body": "<a id='comment:14'></a>It seems that the argument `full` of `banner_text` is ignored.\n\nbanner_text always print the full banner, unless an environnement variable is changed..",
    "created_at": "2016-07-11T13:11:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20897",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20897#issuecomment-303631",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:14'></a>It seems that the argument `full` of `banner_text` is ignored.

banner_text always print the full banner, unless an environnement variable is changed..



---

archive/issue_comments_303632.json:
```json
{
    "body": "<a id='comment:15'></a>Ah, you're right. I completely dropped some logic from that--it shouldn't pay any attention to `SAGE_BANNER` except by default (i.e. if `full=True/False` is not explicitly given).",
    "created_at": "2016-07-11T13:21:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20897",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20897#issuecomment-303632",
    "user": "https://github.com/embray"
}
```

<a id='comment:15'></a>Ah, you're right. I completely dropped some logic from that--it shouldn't pay any attention to `SAGE_BANNER` except by default (i.e. if `full=True/False` is not explicitly given).



---

archive/issue_comments_303633.json:
```json
{
    "body": "<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-07-11T13:25:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20897",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20897#issuecomment-303633",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_303634.json:
```json
{
    "body": "<a id='comment:17'></a>Replying to [comment:13 chapoton]:\n> Replying to [comment:12 embray]:\n> > Why?  What's wrong with that change?\n\n> \n> Maybe it's ok, but it will just take me more time to check that, for something not so important..\n\n\nThere is already code [here](https://github.com/sagemath/sagetrac-mirror/blob/master/src/sage/misc/banner.py?id=1ade53383dec21e76b7b00ffc031c30b7a5ddfee#n18) which prints the exact same thing as the `echo \"SageMath version $SAGE_VERSION, Release Date: $SAGE_RELEASE_DATE\"`.  I see no point in having two things that produce the same output.\n\nThe only reason I replace it with `banner(full=False)` instead of `version()` is for symmetry.  \n\n`banner()` was updated to wrap `version()` (by way of `full=False`) to incorporate consistent handling of the `SAGE_BANNER` environment variable, as `banner()` is already called in a few other parts of the code (including by sagenb) without respecting `SAGE_BANNER`.",
    "created_at": "2016-07-11T13:31:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20897",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20897#issuecomment-303634",
    "user": "https://github.com/embray"
}
```

<a id='comment:17'></a>Replying to [comment:13 chapoton]:
> Replying to [comment:12 embray]:
> > Why?  What's wrong with that change?

> 
> Maybe it's ok, but it will just take me more time to check that, for something not so important..


There is already code [here](https://github.com/sagemath/sagetrac-mirror/blob/master/src/sage/misc/banner.py?id=1ade53383dec21e76b7b00ffc031c30b7a5ddfee#n18) which prints the exact same thing as the `echo "SageMath version $SAGE_VERSION, Release Date: $SAGE_RELEASE_DATE"`.  I see no point in having two things that produce the same output.

The only reason I replace it with `banner(full=False)` instead of `version()` is for symmetry.  

`banner()` was updated to wrap `version()` (by way of `full=False`) to incorporate consistent handling of the `SAGE_BANNER` environment variable, as `banner()` is already called in a few other parts of the code (including by sagenb) without respecting `SAGE_BANNER`.



---

archive/issue_comments_303635.json:
```json
{
    "body": "<a id='comment:18'></a>ok, ok. I am still not very convinced, but this is enough.\n\nCould you please add one doctest for `full=False` in `banner_text` ?\n\nThen I will give a positive review.",
    "created_at": "2016-07-11T13:51:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20897",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20897#issuecomment-303635",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:18'></a>ok, ok. I am still not very convinced, but this is enough.

Could you please add one doctest for `full=False` in `banner_text` ?

Then I will give a positive review.



---

archive/issue_comments_303636.json:
```json
{
    "body": "<a id='comment:19'></a>A doctest would be good to better define the expectation here.",
    "created_at": "2016-07-11T14:09:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20897",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20897#issuecomment-303636",
    "user": "https://github.com/embray"
}
```

<a id='comment:19'></a>A doctest would be good to better define the expectation here.



---

archive/issue_comments_303637.json:
```json
{
    "body": "<a id='comment:20'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-07-11T14:11:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20897",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20897#issuecomment-303637",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:20'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_303638.json:
```json
{
    "body": "<a id='comment:21'></a>ok, then. This should work as far as I can tell. I hope there will be no unexpected side effect.",
    "created_at": "2016-07-11T14:19:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20897",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20897#issuecomment-303638",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:21'></a>ok, then. This should work as far as I can tell. I hope there will be no unexpected side effect.



---

archive/issue_comments_303639.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-07-11T14:19:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20897",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20897#issuecomment-303639",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_303640.json:
```json
{
    "body": "<a id='comment:22'></a>I need to doublecheck, it seems that some doctests in misc are failing.",
    "created_at": "2016-07-11T14:48:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20897",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20897#issuecomment-303640",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:22'></a>I need to doublecheck, it seems that some doctests in misc are failing.



---

archive/issue_comments_303641.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2016-07-11T14:48:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20897",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20897#issuecomment-303641",
    "user": "https://github.com/fchapoton"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_303642.json:
```json
{
    "body": "<a id='comment:23'></a>and with the branch, running\n\n```\nsage\n```\nthe banner is displayed without line breaks..",
    "created_at": "2016-07-11T14:50:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20897",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20897#issuecomment-303642",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:23'></a>and with the branch, running

```
sage
```
the banner is displayed without line breaks..



---

archive/issue_comments_303643.json:
```json
{
    "body": "<a id='comment:24'></a>I got\n\n```\nsage -t src/sage/misc/lazy_attribute.pyx  # 1 doctest failed\nsage -t src/sage/misc/abstract_method.py  # 1 doctest failed\nsage -t src/sage/misc/temporary_file.py  # 1 doctest failed\n```",
    "created_at": "2016-07-11T15:05:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20897",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20897#issuecomment-303643",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:24'></a>I got

```
sage -t src/sage/misc/lazy_attribute.pyx  # 1 doctest failed
sage -t src/sage/misc/abstract_method.py  # 1 doctest failed
sage -t src/sage/misc/temporary_file.py  # 1 doctest failed
```



---

archive/issue_comments_303644.json:
```json
{
    "body": "<a id='comment:25'></a>Oops!  I'll fix the line breaks thing.  That's just because there's missing quotes in the `echo`.",
    "created_at": "2016-07-12T07:56:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20897",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20897#issuecomment-303644",
    "user": "https://github.com/embray"
}
```

<a id='comment:25'></a>Oops!  I'll fix the line breaks thing.  That's just because there's missing quotes in the `echo`.



---

archive/issue_comments_303645.json:
```json
{
    "body": "<a id='comment:26'></a>For the tests you have failing did you install the new code before running the tests?  Otherwise they'll definitely fail since they depend on what python sources are actually being tested.",
    "created_at": "2016-07-12T07:57:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20897",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20897#issuecomment-303645",
    "user": "https://github.com/embray"
}
```

<a id='comment:26'></a>For the tests you have failing did you install the new code before running the tests?  Otherwise they'll definitely fail since they depend on what python sources are actually being tested.



---

archive/issue_comments_303646.json:
```json
{
    "body": "<a id='comment:27'></a>I always use \"sage -bt\". The 3 lines above are copy-pasted from the output of the command. I think these 3 tests really fail.",
    "created_at": "2016-07-12T10:20:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20897",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20897#issuecomment-303646",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:27'></a>I always use "sage -bt". The 3 lines above are copy-pasted from the output of the command. I think these 3 tests really fail.



---

archive/issue_comments_303647.json:
```json
{
    "body": "<a id='comment:28'></a>You'd have to show me how the tests are failing for you.  The one about `temporary_file.py` seems particularly unrelated.  The other two do contain related tests but I updated those tests to reflect these changes, as you can see in the diff.",
    "created_at": "2016-07-12T12:27:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20897",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20897#issuecomment-303647",
    "user": "https://github.com/embray"
}
```

<a id='comment:28'></a>You'd have to show me how the tests are failing for you.  The one about `temporary_file.py` seems particularly unrelated.  The other two do contain related tests but I updated those tests to reflect these changes, as you can see in the diff.



---

archive/issue_comments_303648.json:
```json
{
    "body": "<a id='comment:29'></a>Here they are (plus of course the missing line breaks)\n\n```\nsage -t src/sage/misc/abstract_method.py\n**********************************************************************\nFile \"src/sage/misc/abstract_method.py\", line 194, in sage.misc.abstract_method.AbstractMethod._sage_src_lines_\nFailed example:\n    lines\nExpected:\n    83\nGot:\n    99\n**********************************************************************\n**********************************************************************\nFile \"src/sage/misc/temporary_file.py\", line 47, in sage.misc.temporary_file.delete_tmpfiles\nFailed example:\n    os.path.isdir(parent_SAGE_TMP)\nExpected:\n    True\nGot:\n    False\n**********************************************************************\n**********************************************************************\nFile \"src/sage/misc/lazy_attribute.pyx\", line 90, in sage.misc.lazy_attribute._lazy_attribute._sage_src_lines_\nFailed example:\n    lines\nExpected:\n    83\nGot:\n    99\n**********************************************************************\n```",
    "created_at": "2016-07-12T18:11:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20897",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20897#issuecomment-303648",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:29'></a>Here they are (plus of course the missing line breaks)

```
sage -t src/sage/misc/abstract_method.py
**********************************************************************
File "src/sage/misc/abstract_method.py", line 194, in sage.misc.abstract_method.AbstractMethod._sage_src_lines_
Failed example:
    lines
Expected:
    83
Got:
    99
**********************************************************************
**********************************************************************
File "src/sage/misc/temporary_file.py", line 47, in sage.misc.temporary_file.delete_tmpfiles
Failed example:
    os.path.isdir(parent_SAGE_TMP)
Expected:
    True
Got:
    False
**********************************************************************
**********************************************************************
File "src/sage/misc/lazy_attribute.pyx", line 90, in sage.misc.lazy_attribute._lazy_attribute._sage_src_lines_
Failed example:
    lines
Expected:
    83
Got:
    99
**********************************************************************
```



---

archive/issue_comments_303649.json:
```json
{
    "body": "<a id='comment:30'></a>Oh I see.  The *number* of source lines changed too, and there's a test for that.\n\nThe one you're getting from `temporary_file.py` really doesn't look related..",
    "created_at": "2016-07-13T10:27:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20897",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20897#issuecomment-303649",
    "user": "https://github.com/embray"
}
```

<a id='comment:30'></a>Oh I see.  The *number* of source lines changed too, and there's a test for that.

The one you're getting from `temporary_file.py` really doesn't look related..



---

archive/issue_comments_303650.json:
```json
{
    "body": "<a id='comment:31'></a>Okay, I investigated the `temporary_file.py` test and it is related.  It seems the banner is being printed when running `./sage -c` which I'm guessing is not meant to be the case.",
    "created_at": "2016-07-13T11:59:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20897",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20897#issuecomment-303650",
    "user": "https://github.com/embray"
}
```

<a id='comment:31'></a>Okay, I investigated the `temporary_file.py` test and it is related.  It seems the banner is being printed when running `./sage -c` which I'm guessing is not meant to be the case.



---

archive/issue_comments_303651.json:
```json
{
    "body": "<a id='comment:32'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-07-13T12:05:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20897",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20897#issuecomment-303651",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:32'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_303652.json:
```json
{
    "body": "<a id='comment:33'></a>Okay, this should fix all the failing tests.  Thanks again chapoton for your careful review.",
    "created_at": "2016-07-13T12:07:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20897",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20897#issuecomment-303652",
    "user": "https://github.com/embray"
}
```

<a id='comment:33'></a>Okay, this should fix all the failing tests.  Thanks again chapoton for your careful review.



---

archive/issue_comments_303653.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-07-13T12:07:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20897",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20897#issuecomment-303653",
    "user": "https://github.com/embray"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_303654.json:
```json
{
    "body": "<a id='comment:34'></a>Should be good now.",
    "created_at": "2016-07-13T12:35:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20897",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20897#issuecomment-303654",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:34'></a>Should be good now.



---

archive/issue_comments_303655.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-07-13T12:35:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20897",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20897#issuecomment-303655",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_055997.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-07-13T23:36:55Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/20897",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20897#event-55997"
}
```



---

archive/issue_comments_303656.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-07-13T23:36:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20897",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20897#issuecomment-303656",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_303657.json:
```json
{
    "body": "<a id='comment:36'></a>Follow-up: #21029",
    "created_at": "2016-07-15T09:43:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20897",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20897#issuecomment-303657",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:36'></a>Follow-up: #21029
