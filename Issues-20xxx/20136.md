# Issue 20136: Upgrade meataxe and fix some build issues

archive/issues_019899.json:
```json
{
    "assignees": [],
    "body": "<div id=\"comment:0\"></div>\n\n1. The actual command lines when compiling are hidden, all I see is `compile foo.c`. Seeing the actual command line passed to `gcc` is very useful for debugging.\n\n2. user-defined `CFLAGS` are not passed.\n\n3. meataxe assumes that `char` is `signed char` but that is not guaranteed by the C standard. This causes breakage on powerpc64le. A work-around with GCC is `-fsigned-char` but it's better to fix the C sources.\n\n4. the test-suite has race conditions: testing with `MAKE=\"make -j48\"` fails while `MAKE=\"make -j1\"` works.\n\nUpstream: **None of the above - read trac for reasoning.**\n\nCC:  @simon-king-jena\n\nComponent: **packages: optional**\n\nAuthor: **Simon King**\n\nBranch/Commit: **[u/SimonKing/various_meataxe_build_issues](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/various_meataxe_build_issues) @ [`96fc74f`](https://github.com/sagemath/sagetrac-mirror/commit/96fc74f2b7d5aa908d28376673e014828375e4c7)**\n\nReviewer: **Jeroen Demeyer**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/20136_\n\n",
    "created_at": "2016-02-29T11:39:41Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20optional",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/bug",
        "https://github.com/sagemath/sage/labels/needs%20work"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Upgrade meataxe and fix some build issues",
    "type": "issue",
    "updated_at": "2022-12-29T01:35:57Z",
    "url": "https://github.com/sagemath/sage/issues/20136",
    "user": "https://github.com/jdemeyer"
}
```
<div id="comment:0"></div>

1. The actual command lines when compiling are hidden, all I see is `compile foo.c`. Seeing the actual command line passed to `gcc` is very useful for debugging.

2. user-defined `CFLAGS` are not passed.

3. meataxe assumes that `char` is `signed char` but that is not guaranteed by the C standard. This causes breakage on powerpc64le. A work-around with GCC is `-fsigned-char` but it's better to fix the C sources.

4. the test-suite has race conditions: testing with `MAKE="make -j48"` fails while `MAKE="make -j1"` works.

Upstream: **None of the above - read trac for reasoning.**

CC:  @simon-king-jena

Component: **packages: optional**

Author: **Simon King**

Branch/Commit: **[u/SimonKing/various_meataxe_build_issues](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/various_meataxe_build_issues) @ [`96fc74f`](https://github.com/sagemath/sagetrac-mirror/commit/96fc74f2b7d5aa908d28376673e014828375e4c7)**

Reviewer: **Jeroen Demeyer**

_Issue created by migration from https://trac.sagemath.org/ticket/20136_





---

archive/issue_events_281828.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-02-29T11:39:41Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/20136",
    "milestone_number": null,
    "milestone_title": "sage-7.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20136#event-281828"
}
```



---

archive/issue_events_281829.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-02-29T11:39:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20136",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20optional",
    "label_color": "0000b0",
    "label_name": "c: packages: optional",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20136#event-281829"
}
```



---

archive/issue_events_281830.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-02-29T11:39:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20136",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20136#event-281830"
}
```



---

archive/issue_events_281831.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-02-29T11:39:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20136",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20136#event-281831"
}
```



---

archive/issue_comments_289032.json:
```json
{
    "body": "Hi Jeroen,\n\nThank you for locating a couple of issues and opening the ticket! I am about to contact upstream\n\nReplying to [@jdemeyer](https://github.com/sagemath/sage/issues/20136#comment:0):\n> 3. meataxe assumes that `char` is `signed char` but that is not guaranteed by the C standard. This causes breakage on powerpc64le. A work-around with GCC is `-fsigned-char` but it's better to fix the sources.\n\nOK, but that would also require to either fix the sources (namely the Makefile), either by using `-fsigned-char` or by passing `CFLAGS`.\n \n> 4. the test-suite has race conditions: testing with `MAKE=\"make -j48\"` fails while `MAKE=\"make -j1\"` works.\n\nI have seen before that the test suite is flaky. Meataxe's test suite is about Meataxe executables that read and write data from files. Could file i/o be the reason for race conditions? Hm. Let's see what upstream has to say.",
    "created_at": "2016-02-29T13:10:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20136#issuecomment-289032",
    "user": "https://github.com/simon-king-jena"
}
```

Hi Jeroen,

Thank you for locating a couple of issues and opening the ticket! I am about to contact upstream

Replying to [@jdemeyer](https://github.com/sagemath/sage/issues/20136#comment:0):
> 3. meataxe assumes that `char` is `signed char` but that is not guaranteed by the C standard. This causes breakage on powerpc64le. A work-around with GCC is `-fsigned-char` but it's better to fix the sources.

OK, but that would also require to either fix the sources (namely the Makefile), either by using `-fsigned-char` or by passing `CFLAGS`.
 
> 4. the test-suite has race conditions: testing with `MAKE="make -j48"` fails while `MAKE="make -j1"` works.

I have seen before that the test suite is flaky. Meataxe's test suite is about Meataxe executables that read and write data from files. Could file i/o be the reason for race conditions? Hm. Let's see what upstream has to say.



---

archive/issue_comments_289033.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nReplying to [@simon-king-jena](#comment%3A1):\n> > 3. meataxe assumes that `char` is `signed char` but that is not guaranteed by the C standard. This causes breakage on powerpc64le. A work-around with GCC is `-fsigned-char` but it's better to fix the sources.\n> \n> \n> OK, but that would also require to either fix the sources (namely the Makefile)\n\nI meant changing the C sources. This could mean changing `char` to `signed char` or fix the places where it is assumed that `char` is signed.\n\nAlso keep in mind that perhaps code *linking* to meataxe might break because of this (maybe not, I don't know). I don't think you can require such code to use `-fsigned-char`.\n\n> > 4. the test-suite has race conditions: testing with `MAKE=\"make -j48\"` fails while `MAKE=\"make -j1\"` works.\n> \n> \n> I have seen before that the test suite is flaky.\n\nAn easy workaround is to use `$MAKE -j1` then.",
    "created_at": "2016-02-29T13:17:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20136#issuecomment-289033",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:2" align="right">comment:2</div>

Replying to [@simon-king-jena](#comment%3A1):
> > 3. meataxe assumes that `char` is `signed char` but that is not guaranteed by the C standard. This causes breakage on powerpc64le. A work-around with GCC is `-fsigned-char` but it's better to fix the sources.
> 
> 
> OK, but that would also require to either fix the sources (namely the Makefile)

I meant changing the C sources. This could mean changing `char` to `signed char` or fix the places where it is assumed that `char` is signed.

Also keep in mind that perhaps code *linking* to meataxe might break because of this (maybe not, I don't know). I don't think you can require such code to use `-fsigned-char`.

> > 4. the test-suite has race conditions: testing with `MAKE="make -j48"` fails while `MAKE="make -j1"` works.
> 
> 
> I have seen before that the test suite is flaky.

An easy workaround is to use `$MAKE -j1` then.



---

archive/issue_comments_289034.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nReplying to [@jdemeyer](#comment%3A2):\n> I meant changing the C sources. This could mean changing `char` to `signed char` or fix the places where it is assumed that `char` is signed.\n> \n> Also keep in mind that perhaps code *linking* to meataxe might break because of this (maybe not, I don't know). I don't think you can require such code to use `-fsigned-char`.\n\nGood point.\n \n> > > 4. the test-suite has race conditions: testing with `MAKE=\"make -j48\"` fails while `MAKE=\"make -j1\"` works.\n> > \n> > \n> > I have seen before that the test suite is flaky.\n> \n> An easy workaround is to use `$MAKE -j1` then.\n\nIs there really no *proper* solution for such a race condition, assuming that it really is caused by delays in file i/o?",
    "created_at": "2016-02-29T13:25:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20136#issuecomment-289034",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:3" align="right">comment:3</div>

Replying to [@jdemeyer](#comment%3A2):
> I meant changing the C sources. This could mean changing `char` to `signed char` or fix the places where it is assumed that `char` is signed.
> 
> Also keep in mind that perhaps code *linking* to meataxe might break because of this (maybe not, I don't know). I don't think you can require such code to use `-fsigned-char`.

Good point.
 
> > > 4. the test-suite has race conditions: testing with `MAKE="make -j48"` fails while `MAKE="make -j1"` works.
> > 
> > 
> > I have seen before that the test suite is flaky.
> 
> An easy workaround is to use `$MAKE -j1` then.

Is there really no *proper* solution for such a race condition, assuming that it really is caused by delays in file i/o?



---

archive/issue_comments_289035.json:
```json
{
    "body": "Upstream: **Reported upstream. No feedback yet.**",
    "created_at": "2016-02-29T13:25:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20136#issuecomment-289035",
    "user": "https://github.com/simon-king-jena"
}
```

Upstream: **Reported upstream. No feedback yet.**



---

archive/issue_comments_289036.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nReplying to [@simon-king-jena](#comment%3A3):\n> Is there really no *proper* solution for such a race condition, assuming that it really is caused by delays in file i/o?\n\nOf course there is, I was just giving the easiest possible solution. Everything depends on the exact nature of the race condition.\n\nJust guessing... maybe different tests write to the same file. Then the fix is easy: use a different file for each test.",
    "created_at": "2016-02-29T13:29:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20136#issuecomment-289036",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:4" align="right">comment:4</div>

Replying to [@simon-king-jena](#comment%3A3):
> Is there really no *proper* solution for such a race condition, assuming that it really is caused by delays in file i/o?

Of course there is, I was just giving the easiest possible solution. Everything depends on the exact nature of the race condition.

Just guessing... maybe different tests write to the same file. Then the fix is easy: use a different file for each test.



---

archive/issue_comments_289037.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,6 +2,6 @@\n \n 2. user-defined `CFLAGS` are not passed.\n \n-3. meataxe assumes that `char` is `signed char` but that is not guaranteed by the C standard. This causes breakage on powerpc64le. A work-around with GCC is `-fsigned-char` but it's better to fix the sources.\n+3. meataxe assumes that `char` is `signed char` but that is not guaranteed by the C standard. This causes breakage on powerpc64le. A work-around with GCC is `-fsigned-char` but it's better to fix the C sources.\n \n 4. the test-suite has race conditions: testing with `MAKE=\"make -j48\"` fails while `MAKE=\"make -j1\"` works.\n``````\n",
    "created_at": "2016-02-29T13:30:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20136#issuecomment-289037",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,6 +2,6 @@
 
 2. user-defined `CFLAGS` are not passed.
 
-3. meataxe assumes that `char` is `signed char` but that is not guaranteed by the C standard. This causes breakage on powerpc64le. A work-around with GCC is `-fsigned-char` but it's better to fix the sources.
+3. meataxe assumes that `char` is `signed char` but that is not guaranteed by the C standard. This causes breakage on powerpc64le. A work-around with GCC is `-fsigned-char` but it's better to fix the C sources.
 
 4. the test-suite has race conditions: testing with `MAKE="make -j48"` fails while `MAKE="make -j1"` works.
``````




---

archive/issue_comments_289038.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nThis really looks like `meataxe` is using the same filename (`x2`) for different tests, especially because the calculated checksum is the same each time:\n\n```\nFile x2: checksum error\n         expected:   41484.1750919850\n         calculated: 41484.2717504566\nMakefile:134: recipe for target 'tmp/t-0115.done' failed\nmake[2]: *** [tmp/t-0115.done] Error 1\nFile x2: checksum error\n         expected:   1251.4048248722\n         calculated: 41484.2717504566\nMakefile:134: recipe for target 'tmp/t-0116.done' failed\nmake[2]: *** [tmp/t-0116.done] Error 1\nFile x2: checksum error\n         expected:   384.1740937932\n         calculated: 41484.2717504566\nMakefile:134: recipe for target 'tmp/t-0111.done' failed\nmake[2]: *** [tmp/t-0111.done] Error 1\n```",
    "created_at": "2016-02-29T13:38:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20136#issuecomment-289038",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:6" align="right">comment:6</div>

This really looks like `meataxe` is using the same filename (`x2`) for different tests, especially because the calculated checksum is the same each time:

```
File x2: checksum error
         expected:   41484.1750919850
         calculated: 41484.2717504566
Makefile:134: recipe for target 'tmp/t-0115.done' failed
make[2]: *** [tmp/t-0115.done] Error 1
File x2: checksum error
         expected:   1251.4048248722
         calculated: 41484.2717504566
Makefile:134: recipe for target 'tmp/t-0116.done' failed
make[2]: *** [tmp/t-0116.done] Error 1
File x2: checksum error
         expected:   384.1740937932
         calculated: 41484.2717504566
Makefile:134: recipe for target 'tmp/t-0111.done' failed
make[2]: *** [tmp/t-0111.done] Error 1
```



---

archive/issue_comments_289039.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nReplying to [@jdemeyer](#comment%3A4):\n> Replying to [@simon-king-jena](#comment%3A3):\n> Just guessing... maybe different tests write to the same file. Then the fix is easy: use a different file for each test.\n\nCould several processes READING from the same file be a problem, too? Or is reading safe?",
    "created_at": "2016-02-29T13:39:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20136#issuecomment-289039",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:7" align="right">comment:7</div>

Replying to [@jdemeyer](#comment%3A4):
> Replying to [@simon-king-jena](#comment%3A3):
> Just guessing... maybe different tests write to the same file. Then the fix is easy: use a different file for each test.

Could several processes READING from the same file be a problem, too? Or is reading safe?



---

archive/issue_comments_289040.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nReplying to [@jdemeyer](#comment%3A6):\n> This really looks like `meataxe` is using the same filename (`x2`) for different tests, especially because the calculated checksum is the same each time:\n\nOK, that would of course be a bad design.",
    "created_at": "2016-02-29T13:40:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20136#issuecomment-289040",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:8" align="right">comment:8</div>

Replying to [@jdemeyer](#comment%3A6):
> This really looks like `meataxe` is using the same filename (`x2`) for different tests, especially because the calculated checksum is the same each time:

OK, that would of course be a bad design.



---

archive/issue_comments_289041.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nReplying to [@simon-king-jena](#comment%3A7):\n> Could several processes READING from the same file be a problem, too?\n\nNo, that should be safe. This is in fact extremely common: if you execute several instances of `gcc` in parallel, each of them will probably read the same `.h` files.",
    "created_at": "2016-02-29T13:40:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20136#issuecomment-289041",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:9" align="right">comment:9</div>

Replying to [@simon-king-jena](#comment%3A7):
> Could several processes READING from the same file be a problem, too?

No, that should be safe. This is in fact extremely common: if you execute several instances of `gcc` in parallel, each of them will probably read the same `.h` files.



---

archive/issue_comments_289042.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nMeanwhile Michael Ringe has replied:\n\n- He deems my patches useful extensions and/or corrections.\n- He has difficulties to use my code in the current development version, since the code base has changed.\n- The current source code is [at github](https://github.com/momtx/meataxe/tree/2.4.x). He plans to include my patches there and create a new 2.4.x-version, but it is unclear when he will find the time to do so.\n- In the current development version, some but not all test problems are solved.\n\nConcerning the issues raised by Jeroen:\n\n- The problem with (unsigned) char should be solved in the development version; however, he didn't try building on AIX recently.\n- Full output of the compiler commands can be obtained by `make V=1`. So, we should change spkg-install accordingly.\n- The tests are not parallelisable (so, we should resort to `make -j1`), but should become in future.",
    "created_at": "2016-03-08T10:55:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20136#issuecomment-289042",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:10" align="right">comment:10</div>

Meanwhile Michael Ringe has replied:

- He deems my patches useful extensions and/or corrections.
- He has difficulties to use my code in the current development version, since the code base has changed.
- The current source code is [at github](https://github.com/momtx/meataxe/tree/2.4.x). He plans to include my patches there and create a new 2.4.x-version, but it is unclear when he will find the time to do so.
- In the current development version, some but not all test problems are solved.

Concerning the issues raised by Jeroen:

- The problem with (unsigned) char should be solved in the development version; however, he didn't try building on AIX recently.
- Full output of the compiler commands can be obtained by `make V=1`. So, we should change spkg-install accordingly.
- The tests are not parallelisable (so, we should resort to `make -j1`), but should become in future.



---

archive/issue_comments_289043.json:
```json
{
    "body": "Changed upstream from **Reported upstream. No feedback yet.** to **Reported upstream. Developers acknowledge bug.**",
    "created_at": "2016-03-08T10:55:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20136#issuecomment-289043",
    "user": "https://github.com/simon-king-jena"
}
```

Changed upstream from **Reported upstream. No feedback yet.** to **Reported upstream. Developers acknowledge bug.**



---

archive/issue_comments_289044.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nJeroen, I have developed my patches with a git repository on my laptop. Since the new meataxe upstream code is at github, shouldn't it be possible to do a merge more or less smoothly (using kdiff3 I mean)? How do I use github, i.e., how do I pull the recent upstream changes so that I can merge with my patches?\n\nOr: SHOULD I do the merge? Should an optional meataxe package be based on the latest official meataxe release (which is currently the case) or on a non-official development branch?",
    "created_at": "2016-03-08T10:58:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20136#issuecomment-289044",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:11" align="right">comment:11</div>

Jeroen, I have developed my patches with a git repository on my laptop. Since the new meataxe upstream code is at github, shouldn't it be possible to do a merge more or less smoothly (using kdiff3 I mean)? How do I use github, i.e., how do I pull the recent upstream changes so that I can merge with my patches?

Or: SHOULD I do the merge? Should an optional meataxe package be based on the latest official meataxe release (which is currently the case) or on a non-official development branch?



---

archive/issue_comments_289045.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nReplying to [@simon-king-jena](#comment%3A11):\n> Should an optional meataxe package be based on the latest official meataxe release (which is currently the case) or on a non-official development branch?\n\nA stable release is preferred, but if there are good reasons to use a development version, you can use that (like we do for the standard package PARI for example). From what I understand, this would qualify as a good reason.\n\nBut above all: document things clearly. A blackbox tarball with no documentation where it came from is not acceptable. It should be possible for a third party to obtain exactly the sources that you used (from github say).",
    "created_at": "2016-03-08T13:08:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20136#issuecomment-289045",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:12" align="right">comment:12</div>

Replying to [@simon-king-jena](#comment%3A11):
> Should an optional meataxe package be based on the latest official meataxe release (which is currently the case) or on a non-official development branch?

A stable release is preferred, but if there are good reasons to use a development version, you can use that (like we do for the standard package PARI for example). From what I understand, this would qualify as a good reason.

But above all: document things clearly. A blackbox tarball with no documentation where it came from is not acceptable. It should be possible for a third party to obtain exactly the sources that you used (from github say).



---

archive/issue_comments_289046.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nReplying to [@simon-king-jena](#comment%3A10):\n> - Full output of the compiler commands can be obtained by `make V=1`. So, we should change spkg-install accordingly.\n> - The tests are not parallelisable (so, we should resort to `make -j1`), but should become in future.\n\nGood. Remember to replace `make` by `$MAKE` in the above.",
    "created_at": "2016-03-08T13:09:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20136#issuecomment-289046",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:13" align="right">comment:13</div>

Replying to [@simon-king-jena](#comment%3A10):
> - Full output of the compiler commands can be obtained by `make V=1`. So, we should change spkg-install accordingly.
> - The tests are not parallelisable (so, we should resort to `make -j1`), but should become in future.

Good. Remember to replace `make` by `$MAKE` in the above.



---

archive/issue_comments_289047.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReplying to [@jdemeyer](#comment%3A12):\n> But above all: document things clearly.\n\nHow? Do I simply state in SPKG.txt the address of the github repository and the commit I am using?\n\nAnd the tarball created from the repository should not contain .git/ and .gitignore, right?",
    "created_at": "2016-03-15T12:41:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20136#issuecomment-289047",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:14" align="right">comment:14</div>

Replying to [@jdemeyer](#comment%3A12):
> But above all: document things clearly.

How? Do I simply state in SPKG.txt the address of the github repository and the commit I am using?

And the tarball created from the repository should not contain .git/ and .gitignore, right?



---

archive/issue_comments_289048.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nSigh. The upstream development version has changed considerably wrt the official release. Filenames have changed, which makes rebasing my patches uncomfortable.\n\nALL c-source files have changed. It seems that in most cases the change is in how comments are formatted and whether tabs are used. This makes rebasing my patches a mess, and for no good reason (I mean, it isn't so much about codes but about formatting!).\n\nThere are some source files that look like being dedicated to the \"large\" kernel (i.e., field sizes > 255), but in the Makefile is stated that the large kernel is not available --- which I find inconsistent.\n\nBut my main frustration comes from the fact that using the latest upstream development version would require an awful lot of additional work.",
    "created_at": "2016-03-15T16:22:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20136#issuecomment-289048",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:15" align="right">comment:15</div>

Sigh. The upstream development version has changed considerably wrt the official release. Filenames have changed, which makes rebasing my patches uncomfortable.

ALL c-source files have changed. It seems that in most cases the change is in how comments are formatted and whether tabs are used. This makes rebasing my patches a mess, and for no good reason (I mean, it isn't so much about codes but about formatting!).

There are some source files that look like being dedicated to the "large" kernel (i.e., field sizes > 255), but in the Makefile is stated that the large kernel is not available --- which I find inconsistent.

But my main frustration comes from the fact that using the latest upstream development version would require an awful lot of additional work.



---

archive/issue_comments_289049.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nReplying to [@simon-king-jena](#comment%3A15):\n> It seems that in most cases the change is in how comments are formatted and whether tabs are used. This makes rebasing my patches a mess, and for no good reason (I mean, it isn't so much about codes but about formatting!).\n\nIf it's only a matter of spacing, `git merge` has options for dealing with that:\n\n```\n           ignore-space-change, ignore-all-space, ignore-space-at-eol\n               Treats lines with the indicated type of whitespace change as unchanged for the sake of a three-way merge. Whitespace changes mixed with\n               other changes to a line are not ignored. See also git-diff(1)-b, -w, and --ignore-space-at-eol.\n\n               \u00b7   If their version only introduces whitespace changes to a line, our version is used;\n\n               \u00b7   If our version introduces whitespace changes but their version includes a substantial change, their version is used;\n\n               \u00b7   Otherwise, the merge proceeds in the usual way.\n```",
    "created_at": "2016-03-15T16:46:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20136#issuecomment-289049",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:16" align="right">comment:16</div>

Replying to [@simon-king-jena](#comment%3A15):
> It seems that in most cases the change is in how comments are formatted and whether tabs are used. This makes rebasing my patches a mess, and for no good reason (I mean, it isn't so much about codes but about formatting!).

If it's only a matter of spacing, `git merge` has options for dealing with that:

```
           ignore-space-change, ignore-all-space, ignore-space-at-eol
               Treats lines with the indicated type of whitespace change as unchanged for the sake of a three-way merge. Whitespace changes mixed with
               other changes to a line are not ignored. See also git-diff(1)-b, -w, and --ignore-space-at-eol.

               ·   If their version only introduces whitespace changes to a line, our version is used;

               ·   If our version introduces whitespace changes but their version includes a substantial change, their version is used;

               ·   Otherwise, the merge proceeds in the usual way.
```



---

archive/issue_comments_289050.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nReplying to [@simon-king-jena](#comment%3A14):\n> Replying to [@jdemeyer](#comment%3A12):\n> > But above all: document things clearly.\n> \n> \n> How? Do I simply state in SPKG.txt the address of the github repository and the commit I am using?\n\nIf you literally took a snapshot from that commit: yes\n\n> And the tarball created from the repository should not contain .git/ and .gitignore, right?\n\nNo, it should not contain that. Ideally, upstream has a defined procedure for making a source tarball (something like `make dist` or `make snapshot` or `python setup.py sdist`), that should be used.",
    "created_at": "2016-03-15T16:49:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20136#issuecomment-289050",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:17" align="right">comment:17</div>

Replying to [@simon-king-jena](#comment%3A14):
> Replying to [@jdemeyer](#comment%3A12):
> > But above all: document things clearly.
> 
> 
> How? Do I simply state in SPKG.txt the address of the github repository and the commit I am using?

If you literally took a snapshot from that commit: yes

> And the tarball created from the repository should not contain .git/ and .gitignore, right?

No, it should not contain that. Ideally, upstream has a defined procedure for making a source tarball (something like `make dist` or `make snapshot` or `python setup.py sdist`), that should be used.



---

archive/issue_comments_289051.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nReplying to [@jdemeyer](#comment%3A16):\n> Replying to [@simon-king-jena](#comment%3A15):\n> > It seems that in most cases the change is in how comments are formatted and whether tabs are used. This makes rebasing my patches a mess, and for no good reason (I mean, it isn't so much about codes but about formatting!).\n\nUnfortunately, it is more complicated. Here is an example obtained with `diff -b`:\n\n```diff\n1,8c1,7\n< /* ============================= C MeatAxe ==================================\n<    File:        $Id: matcmp.c,v 1.1.1.1 2007/09/02 11:06:17 mringe Exp $\n<    Comment:     Compare matrices.\n<    --------------------------------------------------------------------------\n<    (C) Copyright 1998 Michael Ringe, Lehrstuhl D fuer Mathematik,\n<    RWTH Aachen, Germany  <mringe@math.rwth-aachen.de>\n<    This program is free software; see the file COPYING for details.\n<    ========================================================================== */\n---\n> ////////////////////////////////////////////////////////////////////////////////////////////////////\n> // C MeatAxe - Compare matrices\n> //\n> // (C) Copyright 1998-2015 Michael Ringe, Lehrstuhl D fuer Mathematik, RWTH Aachen\n> //\n> // This program is free software; see the file COPYING for details.\n> ////////////////////////////////////////////////////////////////////////////////////////////////////\n10,11c9\n< \n< #include \"meataxe.h\"\n---\n> #include <meataxe.h>\n14c12,13\n< MTX_DEFINE_FILE_INFO\n---\n> ////////////////////////////////////////////////////////////////////////////////////////////////////\n> // Local data\n15a15\n> MTX_DEFINE_FILE_INFO\n16a17,18\n> /// @addtogroup mat\n> /// @{\n18,42c20,38\n< /**\n<  ** @addtogroup mat\n<  ** @{\n<  **/\n< \n< /**\n<  ** Compare two matrices\n<  ** If the matrices are equal, the return value is 0. Otherwise the return value is positive,\n<  ** if @em a is \"greater\" than @em b and negative, if @em a is \"less\" than @em b. The ordering\n<  ** matrices is defined as follows:\n<  **\n<  ** - If the matrices are over different fields, the matrix over the smaller field is smaller.\n<  ** - Otherwise, if the matrices have different number of columns, the matrix with the smaller\n<  **   number of columns is smaller.\n<  ** - Otherwise, if the matrices have different number of rows, the matrix with the smaller\n<  **   number of rows is smaller.\n<  ** - Otherwise, the relation is determined by the return value of FfCmpRow() on the first row\n<  **   that is not equal in both matrices.\n<  **\n<  ** In case an error occurs, the return value is -1. But note that a return value of -1 does\n<  ** not necessarily mean that an error has occured.\n<  ** @param a First matrix.\n<  ** @param b Second matrix.\n<  ** @return 0 if the matrices are equal, nonzero otherwise (see description).\n<  **/\n---\n> ////////////////////////////////////////////////////////////////////////////////////////////////////\n> /// Compare two matrices\n> /// If the matrices are equal, the return value is 0. Otherwise the return value is positive,\n> /// if @em a is \"greater\" than @em b and negative, if @em a is \"less\" than @em b. The ordering\n> /// matrices is defined as follows:\n> ///\n> /// - If the matrices are over different fields, the matrix over the smaller field is smaller.\n> /// - Otherwise, if the matrices have different number of columns, the matrix with the smaller\n> ///   number of columns is smaller.\n> /// - Otherwise, if the matrices have different number of rows, the matrix with the smaller\n> ///   number of rows is smaller.\n> /// - Otherwise, the relation is determined by the return value of FfCmpRow() on the first row\n> ///   that is not equal in both matrices.\n> ///\n> /// In case an error occurs, the return value is -1. But note that a return value of -1 does\n> /// not necessarily mean that an error has occured.\n> /// @param a First matrix.\n> /// @param b Second matrix.\n> /// @return 0 if the matrices are equal, nonzero otherwise (see description).\n50,51c46\n<     if (!MatIsValid(a) || !MatIsValid(b))\n<     {\n---\n>    if (!MatIsValid(a) || !MatIsValid(b)) {\n58c53\n<     if ((i = a->Field - b->Field) != 0)\n---\n>    if ((i = a->Field - b->Field) != 0) {\n60c55,56\n<     if ((i = a->Noc - b->Noc) != 0)\n---\n>    }\n>    if ((i = a->Noc - b->Noc) != 0) {\n62c58,59\n<     if ((i = a->Nor - b->Nor) != 0)\n---\n>    }\n>    if ((i = a->Nor - b->Nor) != 0) {\n63a61\n>    }\n70,71c68\n<     for (i = 0; i < a->Nor; ++i)\n<     {\n---\n>    for (i = 0; i < a->Nor; ++i) {\n75c72\n< \tif (diff != 0)\n---\n>       if (diff != 0) {\n77a75\n>    }\n84,86c82,83\n< /**\n<  ** @}\n<  **/\n---\n> \n> /// @}\n```\nThe file has 83 lines, but even though the code didn't change the tiniest bit, the diff file has 117 lines ---  which basically makes it so that all hunks for a patch will fail.",
    "created_at": "2016-03-15T18:48:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20136#issuecomment-289051",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:18" align="right">comment:18</div>

Replying to [@jdemeyer](#comment%3A16):
> Replying to [@simon-king-jena](#comment%3A15):
> > It seems that in most cases the change is in how comments are formatted and whether tabs are used. This makes rebasing my patches a mess, and for no good reason (I mean, it isn't so much about codes but about formatting!).

Unfortunately, it is more complicated. Here is an example obtained with `diff -b`:

```diff
1,8c1,7
< /* ============================= C MeatAxe ==================================
<    File:        $Id: matcmp.c,v 1.1.1.1 2007/09/02 11:06:17 mringe Exp $
<    Comment:     Compare matrices.
<    --------------------------------------------------------------------------
<    (C) Copyright 1998 Michael Ringe, Lehrstuhl D fuer Mathematik,
<    RWTH Aachen, Germany  <mringe@math.rwth-aachen.de>
<    This program is free software; see the file COPYING for details.
<    ========================================================================== */
---
> ////////////////////////////////////////////////////////////////////////////////////////////////////
> // C MeatAxe - Compare matrices
> //
> // (C) Copyright 1998-2015 Michael Ringe, Lehrstuhl D fuer Mathematik, RWTH Aachen
> //
> // This program is free software; see the file COPYING for details.
> ////////////////////////////////////////////////////////////////////////////////////////////////////
10,11c9
< 
< #include "meataxe.h"
---
> #include <meataxe.h>
14c12,13
< MTX_DEFINE_FILE_INFO
---
> ////////////////////////////////////////////////////////////////////////////////////////////////////
> // Local data
15a15
> MTX_DEFINE_FILE_INFO
16a17,18
> /// @addtogroup mat
> /// @{
18,42c20,38
< /**
<  ** @addtogroup mat
<  ** @{
<  **/
< 
< /**
<  ** Compare two matrices
<  ** If the matrices are equal, the return value is 0. Otherwise the return value is positive,
<  ** if @em a is "greater" than @em b and negative, if @em a is "less" than @em b. The ordering
<  ** matrices is defined as follows:
<  **
<  ** - If the matrices are over different fields, the matrix over the smaller field is smaller.
<  ** - Otherwise, if the matrices have different number of columns, the matrix with the smaller
<  **   number of columns is smaller.
<  ** - Otherwise, if the matrices have different number of rows, the matrix with the smaller
<  **   number of rows is smaller.
<  ** - Otherwise, the relation is determined by the return value of FfCmpRow() on the first row
<  **   that is not equal in both matrices.
<  **
<  ** In case an error occurs, the return value is -1. But note that a return value of -1 does
<  ** not necessarily mean that an error has occured.
<  ** @param a First matrix.
<  ** @param b Second matrix.
<  ** @return 0 if the matrices are equal, nonzero otherwise (see description).
<  **/
---
> ////////////////////////////////////////////////////////////////////////////////////////////////////
> /// Compare two matrices
> /// If the matrices are equal, the return value is 0. Otherwise the return value is positive,
> /// if @em a is "greater" than @em b and negative, if @em a is "less" than @em b. The ordering
> /// matrices is defined as follows:
> ///
> /// - If the matrices are over different fields, the matrix over the smaller field is smaller.
> /// - Otherwise, if the matrices have different number of columns, the matrix with the smaller
> ///   number of columns is smaller.
> /// - Otherwise, if the matrices have different number of rows, the matrix with the smaller
> ///   number of rows is smaller.
> /// - Otherwise, the relation is determined by the return value of FfCmpRow() on the first row
> ///   that is not equal in both matrices.
> ///
> /// In case an error occurs, the return value is -1. But note that a return value of -1 does
> /// not necessarily mean that an error has occured.
> /// @param a First matrix.
> /// @param b Second matrix.
> /// @return 0 if the matrices are equal, nonzero otherwise (see description).
50,51c46
<     if (!MatIsValid(a) || !MatIsValid(b))
<     {
---
>    if (!MatIsValid(a) || !MatIsValid(b)) {
58c53
<     if ((i = a->Field - b->Field) != 0)
---
>    if ((i = a->Field - b->Field) != 0) {
60c55,56
<     if ((i = a->Noc - b->Noc) != 0)
---
>    }
>    if ((i = a->Noc - b->Noc) != 0) {
62c58,59
<     if ((i = a->Nor - b->Nor) != 0)
---
>    }
>    if ((i = a->Nor - b->Nor) != 0) {
63a61
>    }
70,71c68
<     for (i = 0; i < a->Nor; ++i)
<     {
---
>    for (i = 0; i < a->Nor; ++i) {
75c72
< 	if (diff != 0)
---
>       if (diff != 0) {
77a75
>    }
84,86c82,83
< /**
<  ** @}
<  **/
---
> 
> /// @}
```
The file has 83 lines, but even though the code didn't change the tiniest bit, the diff file has 117 lines ---  which basically makes it so that all hunks for a patch will fail.



---

archive/issue_comments_289052.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nI understand your problem, I also see no easy solution...",
    "created_at": "2016-03-15T19:32:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20136#issuecomment-289052",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:19" align="right">comment:19</div>

I understand your problem, I also see no easy solution...



---

archive/issue_comments_289053.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nI am not so much of a git expert. The upstream repository's first commit is close to the sources my patches are based upon. Would it perhaps be feasible to apply my patches to them, and then try to rebase the full upstream branch? Can that be easier than the attempt to apply my patches directly to the latest upstream commit?",
    "created_at": "2016-03-15T19:36:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20136#issuecomment-289053",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:20" align="right">comment:20</div>

I am not so much of a git expert. The upstream repository's first commit is close to the sources my patches are based upon. Would it perhaps be feasible to apply my patches to them, and then try to rebase the full upstream branch? Can that be easier than the attempt to apply my patches directly to the latest upstream commit?



---

archive/issue_comments_289054.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nReplying to [@simon-king-jena](#comment%3A20):\n> I am not so much of a git expert. The upstream repository's first commit is close to the sources my patches are based upon. Would it perhaps be feasible to apply my patches to them, and then try to rebase the full upstream branch?\n\nI would not literally \"rebase\" but instead `git merge` the latest upstream branch and then fix the conflicts.\n\n> Can that be easier than the attempt to apply my patches directly to the latest upstream commit?\n\nPerhaps yes. You can try and see what it gives.",
    "created_at": "2016-03-15T20:20:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20136#issuecomment-289054",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:21" align="right">comment:21</div>

Replying to [@simon-king-jena](#comment%3A20):
> I am not so much of a git expert. The upstream repository's first commit is close to the sources my patches are based upon. Would it perhaps be feasible to apply my patches to them, and then try to rebase the full upstream branch?

I would not literally "rebase" but instead `git merge` the latest upstream branch and then fix the conflicts.

> Can that be easier than the attempt to apply my patches directly to the latest upstream commit?

Perhaps yes. You can try and see what it gives.



---

archive/issue_comments_289055.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nIf you merge into patches into an older version in the git history, then do `git merge`, then it is more likely to succeed automatically. You should also try to employ the `patience` or `minimal` merge strategies as well, e.g.,:\n\n```\ngit merge -X ignore-space-change -X patience master\n```\n`patience` is known to at least produce better differences wrt things like braces.",
    "created_at": "2016-03-15T23:43:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20136#issuecomment-289055",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:22" align="right">comment:22</div>

If you merge into patches into an older version in the git history, then do `git merge`, then it is more likely to succeed automatically. You should also try to employ the `patience` or `minimal` merge strategies as well, e.g.,:

```
git merge -X ignore-space-change -X patience master
```
`patience` is known to at least produce better differences wrt things like braces.



---

archive/issue_comments_289056.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nI succeeded to create a new package version based on the current snapshot. At least it installs and does some computations --- I didn't do extensive tests yet.\n\nApparently I misunderstood one point: My understanding was that the current snapshot would write/read the multiplication tables to/from a directory that is either prescribed by an environment variable at built time or a global C parameter at run time. But I stand corrected: Michael Ringe told me that MeatAxe would still *create* the tables in the current directory, but would first try to *read* the tables from a prescribed directory.\n\nMoreover, the \"prescribed directory\" defaults to `MTX_ROOT/lib`, where `MTX_ROOT` is the path into which MeatAxe is installed. In the case of a Sage package, we would have `MTX_ROOT=SAGE_LOCAL`, so that the binaries are installed in `SAGE_LOCAL/bin` and `libmtx.a` in `SAGE_LOCAL/lib` and meataxe.h in `SAGE_LOCAL/include`. But this can be overridden at run time, if I understood correctly.\n\nI see the following options:\n- Create all multiplication tables (it's only a few, for all finite fields up to order 255) during installation of the optional package (i.e., in a temporary directory) and then copy the tables into `SAGE_LOCAL/lib`, where presumably MeatAxe would find them by default.\n- Rather than clobbering `SAGE_LOCAL/lib` with some dozens of files, choose a better location in the `SAGE_LOCAL`-folder, and copy the tables to that location. Override meataxe's default directory at run time.\n- Do not create the multiplication tables at installation time, but at run time. During installation of the package, write permission is granted for `SAGE_LOCAL`, but not at run time. Hence, tables separately for each user ought to be created in `DOT_SAGE`. This is what the current version of the meataxe spkg is doing.\n\nWhat option do you prefer? The last option requires to rebase another patch, but that's easy.\n\nAnd another issue: MeatAxe has a `make tar` target to create a source tarball. Unfortunately, `make tar` does not copy the test suite into the tarball. Hence, I should probably create an spkg-src script.\n\nWould spkg-src really do the exact steps that I did to get a new tarball? That would be as follows:\n1. `git clone` the upstream repository.\n2. `git checkout` a particular commit, which in later versions may be changed\n3. `make tar`\n4. Move the resulting tar file into a temporary directory, unpack it there, copy the test suite into it, and repack it.",
    "created_at": "2016-03-29T16:26:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20136#issuecomment-289056",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:23" align="right">comment:23</div>

I succeeded to create a new package version based on the current snapshot. At least it installs and does some computations --- I didn't do extensive tests yet.

Apparently I misunderstood one point: My understanding was that the current snapshot would write/read the multiplication tables to/from a directory that is either prescribed by an environment variable at built time or a global C parameter at run time. But I stand corrected: Michael Ringe told me that MeatAxe would still *create* the tables in the current directory, but would first try to *read* the tables from a prescribed directory.

Moreover, the "prescribed directory" defaults to `MTX_ROOT/lib`, where `MTX_ROOT` is the path into which MeatAxe is installed. In the case of a Sage package, we would have `MTX_ROOT=SAGE_LOCAL`, so that the binaries are installed in `SAGE_LOCAL/bin` and `libmtx.a` in `SAGE_LOCAL/lib` and meataxe.h in `SAGE_LOCAL/include`. But this can be overridden at run time, if I understood correctly.

I see the following options:
- Create all multiplication tables (it's only a few, for all finite fields up to order 255) during installation of the optional package (i.e., in a temporary directory) and then copy the tables into `SAGE_LOCAL/lib`, where presumably MeatAxe would find them by default.
- Rather than clobbering `SAGE_LOCAL/lib` with some dozens of files, choose a better location in the `SAGE_LOCAL`-folder, and copy the tables to that location. Override meataxe's default directory at run time.
- Do not create the multiplication tables at installation time, but at run time. During installation of the package, write permission is granted for `SAGE_LOCAL`, but not at run time. Hence, tables separately for each user ought to be created in `DOT_SAGE`. This is what the current version of the meataxe spkg is doing.

What option do you prefer? The last option requires to rebase another patch, but that's easy.

And another issue: MeatAxe has a `make tar` target to create a source tarball. Unfortunately, `make tar` does not copy the test suite into the tarball. Hence, I should probably create an spkg-src script.

Would spkg-src really do the exact steps that I did to get a new tarball? That would be as follows:
1. `git clone` the upstream repository.
2. `git checkout` a particular commit, which in later versions may be changed
3. `make tar`
4. Move the resulting tar file into a temporary directory, unpack it there, copy the test suite into it, and repack it.



---

archive/issue_comments_289057.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nFor the tables, I would prefer `DOT_SAGE`. Even if there are 255 tables, maybe that number will increase if larger fields are supported.",
    "created_at": "2016-03-30T08:40:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20136#issuecomment-289057",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:24" align="right">comment:24</div>

For the tables, I would prefer `DOT_SAGE`. Even if there are 255 tables, maybe that number will increase if larger fields are supported.



---

archive/issue_comments_289058.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nReplying to [@simon-king-jena](#comment%3A23):\n> Unfortunately, `make tar` does not copy the test suite into the tarball.\n\nDoes upstream consider that a bug or a feature? I would try to convince upstream to either fix `make tar` or to add a new target (say, `make dist`) to create the full distribution including the testsuite.",
    "created_at": "2016-03-30T08:41:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20136#issuecomment-289058",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:25" align="right">comment:25</div>

Replying to [@simon-king-jena](#comment%3A23):
> Unfortunately, `make tar` does not copy the test suite into the tarball.

Does upstream consider that a bug or a feature? I would try to convince upstream to either fix `make tar` or to add a new target (say, `make dist`) to create the full distribution including the testsuite.



---

archive/issue_comments_289059.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nReplying to [@jdemeyer](#comment%3A24):\n> For the tables, I would prefer `DOT_SAGE`. Even if there are 255 tables, maybe that number will increase if larger fields are supported.\n\nThat's unlikely, as support for larger fields (available by setting ZZZ=1 at compile time) in previous versions was dropped.",
    "created_at": "2016-03-30T16:27:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20136#issuecomment-289059",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:26" align="right">comment:26</div>

Replying to [@jdemeyer](#comment%3A24):
> For the tables, I would prefer `DOT_SAGE`. Even if there are 255 tables, maybe that number will increase if larger fields are supported.

That's unlikely, as support for larger fields (available by setting ZZZ=1 at compile time) in previous versions was dropped.



---

archive/issue_comments_289060.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nReplying to [@jdemeyer](#comment%3A25):\n> Replying to [@simon-king-jena](#comment%3A23):\n> > Unfortunately, `make tar` does not copy the test suite into the tarball.\n> \n> \n> Does upstream consider that a bug or a feature?\n\nRinge somehow said that the tests are work in progress...\n\n> I would try to convince upstream to either fix `make tar` or to add a new target (say, `make dist`) to create the full distribution including the testsuite.\n\nHow could I do the latter? I could of course add a patch in build/pkg/meataxe/patches. But that patch would be applied to the already *existing* sources that include tests.",
    "created_at": "2016-03-30T16:30:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20136#issuecomment-289060",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:27" align="right">comment:27</div>

Replying to [@jdemeyer](#comment%3A25):
> Replying to [@simon-king-jena](#comment%3A23):
> > Unfortunately, `make tar` does not copy the test suite into the tarball.
> 
> 
> Does upstream consider that a bug or a feature?

Ringe somehow said that the tests are work in progress...

> I would try to convince upstream to either fix `make tar` or to add a new target (say, `make dist`) to create the full distribution including the testsuite.

How could I do the latter? I could of course add a patch in build/pkg/meataxe/patches. But that patch would be applied to the already *existing* sources that include tests.



---

archive/issue_comments_289061.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nReplying to [@simon-king-jena](#comment%3A27):\n> > I would try to convince upstream to either fix `make tar` or to add a new target (say, `make dist`) to create the full distribution including the testsuite.\n> \n> \n> How could I do the latter? I could of course add a patch in build/pkg/meataxe/patches. But that patch would be applied to the already *existing* sources that include tests.\n\nMaybe by letting `spkg-src` act as follows:\n- `git clone` the upstream repository\n- `git checkout` the specific commit that we are working with\n- `patch ...` applying a patch to the makefile\n- `make dist`.\n\nDoes that sound right, even though it would mean that the source tar ball of the spkg is *not* identical with upstream?",
    "created_at": "2016-03-30T16:32:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20136#issuecomment-289061",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:28" align="right">comment:28</div>

Replying to [@simon-king-jena](#comment%3A27):
> > I would try to convince upstream to either fix `make tar` or to add a new target (say, `make dist`) to create the full distribution including the testsuite.
> 
> 
> How could I do the latter? I could of course add a patch in build/pkg/meataxe/patches. But that patch would be applied to the already *existing* sources that include tests.

Maybe by letting `spkg-src` act as follows:
- `git clone` the upstream repository
- `git checkout` the specific commit that we are working with
- `patch ...` applying a patch to the makefile
- `make dist`.

Does that sound right, even though it would mean that the source tar ball of the spkg is *not* identical with upstream?



---

archive/issue_comments_289062.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nReplying to [@simon-king-jena](#comment%3A28):\n> Does that sound right, even though it would mean that the source tar ball of the spkg is *not* identical with upstream?\n\nSounds right, but of course it would be better if upstream would add this patch (that's what I meant in [comment:25] too).",
    "created_at": "2016-03-30T17:15:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20136#issuecomment-289062",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:29" align="right">comment:29</div>

Replying to [@simon-king-jena](#comment%3A28):
> Does that sound right, even though it would mean that the source tar ball of the spkg is *not* identical with upstream?

Sounds right, but of course it would be better if upstream would add this patch (that's what I meant in [comment:25] too).



---

archive/issue_comments_289063.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nI think I will use the following patch to create a tarball containing the tests, with a version number that isn't just `2.5.0-SNAPSHOT` but is based on the hash of the commit being used:\n\n```diff\ndiff --git a/Makefile b/Makefile\nindex 935964b..9f14045 100644\n--- a/Makefile\n+++ b/Makefile\n@@ -43,7 +43,7 @@ SILENT0=@\n SILENT1=\n SILENT=${SILENT${V}}\n \n-MTXVERSION = 2.5.0-SNAPSHOT\n+MTXVERSION = 2.5.0-$(shell git log -1 --format=\"%h\")\n \n CFLAGS=$(CFLAGS1) -I\"${MTXROOT}/include\" -Itmp \\\n  -DZZZ=${ZZZ} -DMTXLIB=\"${MTXLIB}\" -DMTXBIN=\"${MTXBIN}\"\n@@ -221,7 +221,7 @@ tmp/test-%.done: tests/common.sh tests/%/run $(PROGRAMS:%=${MTXBIN}/%)\n \t@touch \"$@\"\n \n \n-.PHONY: tar clean install test\n+.PHONY: tar dist clean install test\n .PRECIOUS: tmp/%.o\n \n \n@@ -264,6 +264,8 @@ EXPORTED_FILES =\\\n   Makefile README.md COPYING\\\n   src/meataxe.doc src/changelog.doc\\\n \n+TESTS = tests\n+\n tar: all doc\n \trm -f meataxe-${MTXVERSION} meataxe-${MTXVERSION}.tar meataxe-${MTXVERSION}.tar.gz \\\n \t&& ln -s . meataxe-${MTXVERSION} \\\n@@ -271,3 +273,11 @@ tar: all doc\n \t&& rm meataxe-${MTXVERSION} \\\n \t&& gzip meataxe-${MTXVERSION}.tar \\\n \t&& echo \"Created meataxe-${MTXVERSION}.tar.gz\"\n+\n+dist: all doc\n+\trm -f meataxe-${MTXVERSION} meataxe-${MTXVERSION}.tar meataxe-${MTXVERSION}.tar.gz \\\n+\t&& ln -s . meataxe-${MTXVERSION} \\\n+\t&& tar cf meataxe-${MTXVERSION}.tar $(EXPORTED_FILES:%=meataxe-${MTXVERSION}/%) meataxe-${MTXVERSION}/${TESTS} \\\n+\t&& rm meataxe-${MTXVERSION} \\\n+\t&& gzip meataxe-${MTXVERSION}.tar \\\n+\t&& echo \"Created meataxe-${MTXVERSION}.tar.gz including tests\"\n-- \n2.5.0\n```",
    "created_at": "2016-04-01T08:47:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20136#issuecomment-289063",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:30" align="right">comment:30</div>

I think I will use the following patch to create a tarball containing the tests, with a version number that isn't just `2.5.0-SNAPSHOT` but is based on the hash of the commit being used:

```diff
diff --git a/Makefile b/Makefile
index 935964b..9f14045 100644
--- a/Makefile
+++ b/Makefile
@@ -43,7 +43,7 @@ SILENT0=@
 SILENT1=
 SILENT=${SILENT${V}}
 
-MTXVERSION = 2.5.0-SNAPSHOT
+MTXVERSION = 2.5.0-$(shell git log -1 --format="%h")
 
 CFLAGS=$(CFLAGS1) -I"${MTXROOT}/include" -Itmp \
  -DZZZ=${ZZZ} -DMTXLIB="${MTXLIB}" -DMTXBIN="${MTXBIN}"
@@ -221,7 +221,7 @@ tmp/test-%.done: tests/common.sh tests/%/run $(PROGRAMS:%=${MTXBIN}/%)
 	@touch "$@"
 
 
-.PHONY: tar clean install test
+.PHONY: tar dist clean install test
 .PRECIOUS: tmp/%.o
 
 
@@ -264,6 +264,8 @@ EXPORTED_FILES =\
   Makefile README.md COPYING\
   src/meataxe.doc src/changelog.doc\
 
+TESTS = tests
+
 tar: all doc
 	rm -f meataxe-${MTXVERSION} meataxe-${MTXVERSION}.tar meataxe-${MTXVERSION}.tar.gz \
 	&& ln -s . meataxe-${MTXVERSION} \
@@ -271,3 +273,11 @@ tar: all doc
 	&& rm meataxe-${MTXVERSION} \
 	&& gzip meataxe-${MTXVERSION}.tar \
 	&& echo "Created meataxe-${MTXVERSION}.tar.gz"
+
+dist: all doc
+	rm -f meataxe-${MTXVERSION} meataxe-${MTXVERSION}.tar meataxe-${MTXVERSION}.tar.gz \
+	&& ln -s . meataxe-${MTXVERSION} \
+	&& tar cf meataxe-${MTXVERSION}.tar $(EXPORTED_FILES:%=meataxe-${MTXVERSION}/%) meataxe-${MTXVERSION}/${TESTS} \
+	&& rm meataxe-${MTXVERSION} \
+	&& gzip meataxe-${MTXVERSION}.tar \
+	&& echo "Created meataxe-${MTXVERSION}.tar.gz including tests"
-- 
2.5.0
```



---

archive/issue_comments_289064.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nGosh, I just realise that it won't work. It assumes that there is a git repository. Hence, that makefile did work for me, since I tested it in a clone of the upstream repository. But it won't work in the spkg, since it doesn't comprise the repository. Back to the drawing board.",
    "created_at": "2016-04-01T08:50:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20136#issuecomment-289064",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:31" align="right">comment:31</div>

Gosh, I just realise that it won't work. It assumes that there is a git repository. Hence, that makefile did work for me, since I tested it in a clone of the upstream repository. But it won't work in the spkg, since it doesn't comprise the repository. Back to the drawing board.



---

archive/issue_comments_289065.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nThe following should be a better idea for `spkg-src`:\n- `git clone` upstream.\n- `git checkout` the appropriate commit --- which is what one needs to change for upgrading the sources.\n- Apply the following general patch, that I will suggest to upstream:\n\n  ```diff\n  diff --git a/Makefile b/Makefile\n  index 935964b..49c2b86 100644\n  --- a/Makefile\n  +++ b/Makefile\n  @@ -221,7 +221,7 @@ tmp/test-%.done: tests/common.sh tests/%/run $(PROGRAMS:%=${MTXBIN}/%)\n   \t@touch \"$@\"\n   \n   \n  -.PHONY: tar clean install test\n  +.PHONY: tar dist clean install test\n   .PRECIOUS: tmp/%.o\n   \n   \n  @@ -264,6 +264,8 @@ EXPORTED_FILES =\\\n     Makefile README.md COPYING\\\n     src/meataxe.doc src/changelog.doc\\\n   \n  +TESTS = tests\n  +\n   tar: all doc\n   \trm -f meataxe-${MTXVERSION} meataxe-${MTXVERSION}.tar meataxe-${MTXVERSION}.tar.gz \\\n   \t&& ln -s . meataxe-${MTXVERSION} \\\n  @@ -271,3 +273,11 @@ tar: all doc\n   \t&& rm meataxe-${MTXVERSION} \\\n   \t&& gzip meataxe-${MTXVERSION}.tar \\\n   \t&& echo \"Created meataxe-${MTXVERSION}.tar.gz\"\n  +\n  +dist: all doc\n  +\trm -f meataxe-${MTXVERSION} meataxe-${MTXVERSION}.tar meataxe-${MTXVERSION}.tar.gz \\\n  +\t&& ln -s . meataxe-${MTXVERSION} \\\n  +\t&& tar cf meataxe-${MTXVERSION}.tar $(EXPORTED_FILES:%=meataxe-${MTXVERSION}/%) meataxe-${MTXVERSION}/${TESTS} \\\n  +\t&& rm meataxe-${MTXVERSION} \\\n  +\t&& gzip meataxe-${MTXVERSION}.tar \\\n  +\t&& echo \"Created meataxe-${MTXVERSION}.tar.gz including tests\"\n  -- \n  ```\n- Use `sed` to replace the word `-SNAPSHOT` in the Makefile by the current commit hash. That will work, because the spkg-src script *is* in a git repository at that point.\n- When building the spkg, there will be no git repository. But now, the commit number is hardcoded in the Makefile. The hardcoded number, however, will change automatically when changing the choice of commit in spkg-src.\n\nQuestion:\n\nIs it acceptable to add a general spkg-src, that takes the chosen commit of the upstream repository as an argument? In that way, one could obtain meataxe-2.5.0.123456.tar.gz for commit 123456 simply by calling `spkg-src 123456`.",
    "created_at": "2016-04-01T16:38:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20136#issuecomment-289065",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:32" align="right">comment:32</div>

The following should be a better idea for `spkg-src`:
- `git clone` upstream.
- `git checkout` the appropriate commit --- which is what one needs to change for upgrading the sources.
- Apply the following general patch, that I will suggest to upstream:

  ```diff
  diff --git a/Makefile b/Makefile
  index 935964b..49c2b86 100644
  --- a/Makefile
  +++ b/Makefile
  @@ -221,7 +221,7 @@ tmp/test-%.done: tests/common.sh tests/%/run $(PROGRAMS:%=${MTXBIN}/%)
   	@touch "$@"
   
   
  -.PHONY: tar clean install test
  +.PHONY: tar dist clean install test
   .PRECIOUS: tmp/%.o
   
   
  @@ -264,6 +264,8 @@ EXPORTED_FILES =\
     Makefile README.md COPYING\
     src/meataxe.doc src/changelog.doc\
   
  +TESTS = tests
  +
   tar: all doc
   	rm -f meataxe-${MTXVERSION} meataxe-${MTXVERSION}.tar meataxe-${MTXVERSION}.tar.gz \
   	&& ln -s . meataxe-${MTXVERSION} \
  @@ -271,3 +273,11 @@ tar: all doc
   	&& rm meataxe-${MTXVERSION} \
   	&& gzip meataxe-${MTXVERSION}.tar \
   	&& echo "Created meataxe-${MTXVERSION}.tar.gz"
  +
  +dist: all doc
  +	rm -f meataxe-${MTXVERSION} meataxe-${MTXVERSION}.tar meataxe-${MTXVERSION}.tar.gz \
  +	&& ln -s . meataxe-${MTXVERSION} \
  +	&& tar cf meataxe-${MTXVERSION}.tar $(EXPORTED_FILES:%=meataxe-${MTXVERSION}/%) meataxe-${MTXVERSION}/${TESTS} \
  +	&& rm meataxe-${MTXVERSION} \
  +	&& gzip meataxe-${MTXVERSION}.tar \
  +	&& echo "Created meataxe-${MTXVERSION}.tar.gz including tests"
  -- 
  ```
- Use `sed` to replace the word `-SNAPSHOT` in the Makefile by the current commit hash. That will work, because the spkg-src script *is* in a git repository at that point.
- When building the spkg, there will be no git repository. But now, the commit number is hardcoded in the Makefile. The hardcoded number, however, will change automatically when changing the choice of commit in spkg-src.

Question:

Is it acceptable to add a general spkg-src, that takes the chosen commit of the upstream repository as an argument? In that way, one could obtain meataxe-2.5.0.123456.tar.gz for commit 123456 simply by calling `spkg-src 123456`.



---

archive/issue_comments_289066.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nReplying to [@simon-king-jena](#comment%3A32):\n> Is it acceptable to add a general spkg-src, that takes the chosen commit of the upstream repository as an argument? In that way, one could obtain meataxe-2.5.0.123456.tar.gz for commit 123456 simply by calling `spkg-src 123456`.\n\nI would advise against that, since `spkg-src` is not only a script but also serves as some kind of documentation of how the tarball was obtained. With that in mind, it's best if `spkg-src` is completely self-contained.",
    "created_at": "2016-04-01T17:38:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20136#issuecomment-289066",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:33" align="right">comment:33</div>

Replying to [@simon-king-jena](#comment%3A32):
> Is it acceptable to add a general spkg-src, that takes the chosen commit of the upstream repository as an argument? In that way, one could obtain meataxe-2.5.0.123456.tar.gz for commit 123456 simply by calling `spkg-src 123456`.

I would advise against that, since `spkg-src` is not only a script but also serves as some kind of documentation of how the tarball was obtained. With that in mind, it's best if `spkg-src` is completely self-contained.



---

archive/issue_comments_289067.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nReplying to [@jdemeyer](#comment%3A33):\n> I would advise against that, since `spkg-src` is not only a script but also serves as some kind of documentation of how the tarball was obtained. With that in mind, it's best if `spkg-src` is completely self-contained.\n\nThen I suggest `spkg-src` be the following:\n\n```\n#!/usr/bin/env bash\n\nCOMMIT=7c0bcf9\n\ngit clone https://github.com/momtx/meataxe.git\ncd meataxe\ngit checkout -b package $COMMIT\ngit apply ../spkg-src\ngit commit -a -m \"Add make target *dist*\"\nsed -i 's/-SNAPSHOT/.'$COMMIT'/' Makefile\nmake dist\ncd ..\nmv meataxe/meataxe-2.5.0.$COMMIT.tar.gz .\nrm -rf meataxe\nexit 0\n\n########################################\n\ndiff --git a/Makefile b/Makefile\nindex 935964b..49c2b86 100644\n--- a/Makefile\n+++ b/Makefile\n@@ -221,7 +221,7 @@ tmp/test-%.done: tests/common.sh tests/%/run $(PROGRAMS:%=${MTXBIN}/%)\n \t@touch \"$@\"\n \n \n-.PHONY: tar clean install test\n+.PHONY: tar dist clean install test\n .PRECIOUS: tmp/%.o\n \n \n@@ -264,6 +264,8 @@ EXPORTED_FILES =\\\n   Makefile README.md COPYING\\\n   src/meataxe.doc src/changelog.doc\\\n \n+TESTS = tests\n+\n tar: all doc\n \trm -f meataxe-${MTXVERSION} meataxe-${MTXVERSION}.tar meataxe-${MTXVERSION}.tar.gz \\\n \t&& ln -s . meataxe-${MTXVERSION} \\\n@@ -271,3 +273,11 @@ tar: all doc\n \t&& rm meataxe-${MTXVERSION} \\\n \t&& gzip meataxe-${MTXVERSION}.tar \\\n \t&& echo \"Created meataxe-${MTXVERSION}.tar.gz\"\n+\n+dist: all doc\n+\trm -f meataxe-${MTXVERSION} meataxe-${MTXVERSION}.tar meataxe-${MTXVERSION}.tar.gz \\\n+\t&& ln -s . meataxe-${MTXVERSION} \\\n+\t&& tar cf meataxe-${MTXVERSION}.tar $(EXPORTED_FILES:%=meataxe-${MTXVERSION}/%) meataxe-${MTXVERSION}/${TESTS} \\\n+\t&& rm meataxe-${MTXVERSION} \\\n+\t&& gzip meataxe-${MTXVERSION}.tar \\\n+\t&& echo \"Created meataxe-${MTXVERSION}.tar.gz including tests\"\n-- \n2.5.0\n```\nIt provides the concrete commit of the snapshot, adds a `make dist` target that includes the test suite into the tarball, makes it so that the version number provides the concrete commit, creates the tar ball, and removes the temporary meataxe repository.\n\nThe only assumption is that the script is executed in the same directory in which it is stored, since it serves as a diff file to be applied to the Makefile.",
    "created_at": "2016-04-02T12:48:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20136#issuecomment-289067",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:34" align="right">comment:34</div>

Replying to [@jdemeyer](#comment%3A33):
> I would advise against that, since `spkg-src` is not only a script but also serves as some kind of documentation of how the tarball was obtained. With that in mind, it's best if `spkg-src` is completely self-contained.

Then I suggest `spkg-src` be the following:

```
#!/usr/bin/env bash

COMMIT=7c0bcf9

git clone https://github.com/momtx/meataxe.git
cd meataxe
git checkout -b package $COMMIT
git apply ../spkg-src
git commit -a -m "Add make target *dist*"
sed -i 's/-SNAPSHOT/.'$COMMIT'/' Makefile
make dist
cd ..
mv meataxe/meataxe-2.5.0.$COMMIT.tar.gz .
rm -rf meataxe
exit 0

########################################

diff --git a/Makefile b/Makefile
index 935964b..49c2b86 100644
--- a/Makefile
+++ b/Makefile
@@ -221,7 +221,7 @@ tmp/test-%.done: tests/common.sh tests/%/run $(PROGRAMS:%=${MTXBIN}/%)
 	@touch "$@"
 
 
-.PHONY: tar clean install test
+.PHONY: tar dist clean install test
 .PRECIOUS: tmp/%.o
 
 
@@ -264,6 +264,8 @@ EXPORTED_FILES =\
   Makefile README.md COPYING\
   src/meataxe.doc src/changelog.doc\
 
+TESTS = tests
+
 tar: all doc
 	rm -f meataxe-${MTXVERSION} meataxe-${MTXVERSION}.tar meataxe-${MTXVERSION}.tar.gz \
 	&& ln -s . meataxe-${MTXVERSION} \
@@ -271,3 +273,11 @@ tar: all doc
 	&& rm meataxe-${MTXVERSION} \
 	&& gzip meataxe-${MTXVERSION}.tar \
 	&& echo "Created meataxe-${MTXVERSION}.tar.gz"
+
+dist: all doc
+	rm -f meataxe-${MTXVERSION} meataxe-${MTXVERSION}.tar meataxe-${MTXVERSION}.tar.gz \
+	&& ln -s . meataxe-${MTXVERSION} \
+	&& tar cf meataxe-${MTXVERSION}.tar $(EXPORTED_FILES:%=meataxe-${MTXVERSION}/%) meataxe-${MTXVERSION}/${TESTS} \
+	&& rm meataxe-${MTXVERSION} \
+	&& gzip meataxe-${MTXVERSION}.tar \
+	&& echo "Created meataxe-${MTXVERSION}.tar.gz including tests"
-- 
2.5.0
```
It provides the concrete commit of the snapshot, adds a `make dist` target that includes the test suite into the tarball, makes it so that the version number provides the concrete commit, creates the tar ball, and removes the temporary meataxe repository.

The only assumption is that the script is executed in the same directory in which it is stored, since it serves as a diff file to be applied to the Makefile.



---

archive/issue_comments_289068.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nSee `build/pkgs/ecl/spkg-src` for a good example on how to deal with patches at packaging time. It also contains some boilerplate to protect against mistakes.",
    "created_at": "2016-04-02T12:50:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20136#issuecomment-289068",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:35" align="right">comment:35</div>

See `build/pkgs/ecl/spkg-src` for a good example on how to deal with patches at packaging time. It also contains some boilerplate to protect against mistakes.



---

archive/issue_comments_289069.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nReplying to [@jdemeyer](#comment%3A35):\n> See `build/pkgs/ecl/spkg-src` for a good example on how to deal with patches at packaging time. It also contains some boilerplate to protect against mistakes.\n\nSo, basically you suggest that *all* my patches should be applied when creating the source ball, whereas I thought that the source ball should be as close to upstream as possible --- hence, only a small patch should be applied when creating the source ball, and everything else should be patched when the package will be installed.\n\nDo I understand correctly that it is fine to apply all patches, including Strassen-Winograd multiplication, *before* installing the package?",
    "created_at": "2016-04-02T13:10:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20136#issuecomment-289069",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:36" align="right">comment:36</div>

Replying to [@jdemeyer](#comment%3A35):
> See `build/pkgs/ecl/spkg-src` for a good example on how to deal with patches at packaging time. It also contains some boilerplate to protect against mistakes.

So, basically you suggest that *all* my patches should be applied when creating the source ball, whereas I thought that the source ball should be as close to upstream as possible --- hence, only a small patch should be applied when creating the source ball, and everything else should be patched when the package will be installed.

Do I understand correctly that it is fine to apply all patches, including Strassen-Winograd multiplication, *before* installing the package?



---

archive/issue_comments_289070.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nReplying to [@simon-king-jena](#comment%3A36):\n> Replying to [@jdemeyer](#comment%3A35):\n> > See `build/pkgs/ecl/spkg-src` for a good example on how to deal with patches at packaging time. It also contains some boilerplate to protect against mistakes.\n> \n> \n> So, basically you suggest that *all* my patches should be applied when creating the source ball\n\nNo! I am suggesting to split up your patches in two directories: one to be applied at install-time as usual and one to apply at packaging-time. Please have a closer look at the `build/pkgs/ecl/patches/` directory.",
    "created_at": "2016-04-02T13:14:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20136#issuecomment-289070",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:37" align="right">comment:37</div>

Replying to [@simon-king-jena](#comment%3A36):
> Replying to [@jdemeyer](#comment%3A35):
> > See `build/pkgs/ecl/spkg-src` for a good example on how to deal with patches at packaging time. It also contains some boilerplate to protect against mistakes.
> 
> 
> So, basically you suggest that *all* my patches should be applied when creating the source ball

No! I am suggesting to split up your patches in two directories: one to be applied at install-time as usual and one to apply at packaging-time. Please have a closer look at the `build/pkgs/ecl/patches/` directory.



---

archive/issue_comments_289071.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nReplying to [@jdemeyer](#comment%3A37):\n> No! I am suggesting to split up your patches in two directories: one to be applied at install-time as usual and one to apply at packaging-time. Please have a closer look at the `build/pkgs/ecl/patches/` directory.\n\nExactly. All patches in `build/pkgs/ecl/patches/` (`gmp.patch`, `implib.patch`, `write_error.patch`) are applied by `spkg-src`, which contains the lines\n\n```\n# the patches are applied here, as it has to be done before\n# running autoconf.\ncd src\necho \"applying patches in ecl-$ECLVERSION/src\"\n# For some of the patches, Cygwin also has upstream fixes that are\n# closely related, keep track.  See Trac 11119, for example.\nfor patch in ../../patches/*.patch; do\n    patch --verbose -p2 <\"$patch\"\n    if [ $? -ne 0 ]; then\n        echo >&2 \"Error applying '$patch'\"\n        exit 1\n    fi\ndone\n```\nThat's why I was asking.\n\nUnless there was a change since sage-7.1.",
    "created_at": "2016-04-02T13:42:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20136#issuecomment-289071",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:38" align="right">comment:38</div>

Replying to [@jdemeyer](#comment%3A37):
> No! I am suggesting to split up your patches in two directories: one to be applied at install-time as usual and one to apply at packaging-time. Please have a closer look at the `build/pkgs/ecl/patches/` directory.

Exactly. All patches in `build/pkgs/ecl/patches/` (`gmp.patch`, `implib.patch`, `write_error.patch`) are applied by `spkg-src`, which contains the lines

```
# the patches are applied here, as it has to be done before
# running autoconf.
cd src
echo "applying patches in ecl-$ECLVERSION/src"
# For some of the patches, Cygwin also has upstream fixes that are
# closely related, keep track.  See Trac 11119, for example.
for patch in ../../patches/*.patch; do
    patch --verbose -p2 <"$patch"
    if [ $? -ne 0 ]; then
        echo >&2 "Error applying '$patch'"
        exit 1
    fi
done
```
That's why I was asking.

Unless there was a change since sage-7.1.



---

archive/issue_comments_289072.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nIn the most recent version it says\n\n```\nfor patch in ../patches/src/*.patch; do\n```\n`patches/src` contains `gmp.patch` and `implib.patch`.",
    "created_at": "2016-04-02T16:31:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20136#issuecomment-289072",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:39" align="right">comment:39</div>

In the most recent version it says

```
for patch in ../patches/src/*.patch; do
```
`patches/src` contains `gmp.patch` and `implib.patch`.



---

archive/issue_comments_289073.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nReplying to [@jhpalmieri](#comment%3A39):\n> In the most recent version it says\n> \n> ```\n> for patch in ../patches/src/*.patch; do\n> ```\n> `patches/src` contains `gmp.patch` and `implib.patch`.\n\nIn my previous suggestion, I did not provide a separate patch but did everything in `spkg-src`, since I thought `spkg-src` was supposed to be self-contained. But if ../patches/ is allowed to serve a double purpose and if `spkg-src` may be \"incomplete\": Be it!",
    "created_at": "2016-04-02T20:24:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20136#issuecomment-289073",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:40" align="right">comment:40</div>

Replying to [@jhpalmieri](#comment%3A39):
> In the most recent version it says
> 
> ```
> for patch in ../patches/src/*.patch; do
> ```
> `patches/src` contains `gmp.patch` and `implib.patch`.

In my previous suggestion, I did not provide a separate patch but did everything in `spkg-src`, since I thought `spkg-src` was supposed to be self-contained. But if ../patches/ is allowed to serve a double purpose and if `spkg-src` may be "incomplete": Be it!



---

archive/issue_comments_289074.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nI have an unexpected problem:\n\nWhen I am in a normal shell, the line `git clone https://github.com/momtx/meataxe.git` works fine.\n\nWhen I am in a Sage shell, the same line `git clone https://github.com/momtx/meataxe.git` results in\n\n```\nKlone nach 'meataxe' ...\nfatal: Unable to find remote helper for 'https'\n```\n\nWhat the heck...?",
    "created_at": "2016-04-05T14:25:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20136#issuecomment-289074",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:41" align="right">comment:41</div>

I have an unexpected problem:

When I am in a normal shell, the line `git clone https://github.com/momtx/meataxe.git` works fine.

When I am in a Sage shell, the same line `git clone https://github.com/momtx/meataxe.git` results in

```
Klone nach 'meataxe' ...
fatal: Unable to find remote helper for 'https'
```

What the heck...?



---

archive/issue_comments_289075.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nApparently Sage has built its own version of git. Why? I don't think I told it to.\n\nAnd why Sage hasn't built git with http support? That's a bit awkward for Sage development.",
    "created_at": "2016-04-05T14:39:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20136#issuecomment-289075",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:42" align="right">comment:42</div>

Apparently Sage has built its own version of git. Why? I don't think I told it to.

And why Sage hasn't built git with http support? That's a bit awkward for Sage development.



---

archive/issue_comments_289076.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nI was told on sage-devel that it is fine to provide a `spkg-src` script for usage *outside* of a Sage shell. Apparently only `spkg-install` and `spkg-check` are required to be executed in a Sage shell.\n\nA related question: Is it ok when `spkg-install` also executes MeatAxe's test suite if `SAGE_CHECK` is set? Or is `spkg-check` mandatory for tests?",
    "created_at": "2016-04-07T09:42:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20136#issuecomment-289076",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:43" align="right">comment:43</div>

I was told on sage-devel that it is fine to provide a `spkg-src` script for usage *outside* of a Sage shell. Apparently only `spkg-install` and `spkg-check` are required to be executed in a Sage shell.

A related question: Is it ok when `spkg-install` also executes MeatAxe's test suite if `SAGE_CHECK` is set? Or is `spkg-check` mandatory for tests?



---

archive/issue_comments_289077.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\nReplying to [@jdemeyer](#comment%3A24):\n> For the tables, I would prefer `DOT_SAGE`. Even if there are 255 tables, maybe that number will increase if larger fields are supported.\n\nCurrent status of my local branch is:\n- I am using the latest upstream snapshot, which says \"Fixes for AIX and 64-bit platforms, GCC 4.9 compiler warnings\". So, hopefully the \"unsigned versus signed char\" issue is fixed.\n- To change to a different commit in the upstream repository, it should be sufficient to change what is written in `package-version.txt`, and `spkg-src` will create the upstream tar ball (provided that it is executed in the directory in which `package-version.txt` is found).\n- The error propagation introduced by my patches does not cover all potential cases. But it seems to me that it is sufficient for the intended applications.\n- MeatAxe's test suite passes *after* applying my patches with Strassen multiplication and error propagation.\n- The tests in sage.matrix pass after changing one line number that appears in an error message.\n- The issue with multiplication tables polluting the current directory has yet to be fixed. According to your comment, I should rebase my old patch (which is easy), so that we can tell MeatAxe to put its tables into `DOT_SAGE`.",
    "created_at": "2016-04-07T09:53:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20136#issuecomment-289077",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:44" align="right">comment:44</div>

Replying to [@jdemeyer](#comment%3A24):
> For the tables, I would prefer `DOT_SAGE`. Even if there are 255 tables, maybe that number will increase if larger fields are supported.

Current status of my local branch is:
- I am using the latest upstream snapshot, which says "Fixes for AIX and 64-bit platforms, GCC 4.9 compiler warnings". So, hopefully the "unsigned versus signed char" issue is fixed.
- To change to a different commit in the upstream repository, it should be sufficient to change what is written in `package-version.txt`, and `spkg-src` will create the upstream tar ball (provided that it is executed in the directory in which `package-version.txt` is found).
- The error propagation introduced by my patches does not cover all potential cases. But it seems to me that it is sufficient for the intended applications.
- MeatAxe's test suite passes *after* applying my patches with Strassen multiplication and error propagation.
- The tests in sage.matrix pass after changing one line number that appears in an error message.
- The issue with multiplication tables polluting the current directory has yet to be fixed. According to your comment, I should rebase my old patch (which is easy), so that we can tell MeatAxe to put its tables into `DOT_SAGE`.



---

archive/issue_comments_289078.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\nReplying to [@simon-king-jena](#comment%3A43):\n> I was told on sage-devel that it is fine to provide a `spkg-src` script for usage *outside* of a Sage shell.\n\n> Apparently only `spkg-install` and `spkg-check` are required to be executed in a Sage shell.\n\nRight, it's not required to run `spkg-src` in a Sage shell, it's just a sensible thing to do. For example, you would want to do `cd \"$SAGE_ROOT/build/pkgs/meataxe\" but that wouldn't work outside a Sage shell.\n\n> A related question: Is it ok when `spkg-install` also executes MeatAxe's test suite if `SAGE_CHECK` is set?\n\nI think you already asked this: it's not a problem.",
    "created_at": "2016-04-07T12:30:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20136#issuecomment-289078",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:45" align="right">comment:45</div>

Replying to [@simon-king-jena](#comment%3A43):
> I was told on sage-devel that it is fine to provide a `spkg-src` script for usage *outside* of a Sage shell.

> Apparently only `spkg-install` and `spkg-check` are required to be executed in a Sage shell.

Right, it's not required to run `spkg-src` in a Sage shell, it's just a sensible thing to do. For example, you would want to do `cd "$SAGE_ROOT/build/pkgs/meataxe" but that wouldn't work outside a Sage shell.

> A related question: Is it ok when `spkg-install` also executes MeatAxe's test suite if `SAGE_CHECK` is set?

I think you already asked this: it's not a problem.



---

archive/issue_comments_289079.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">comment:46</div>\n\nReplying to [@jdemeyer](#comment%3A45):\n> Replying to [@simon-king-jena](#comment%3A43):\n> > Apparently only `spkg-install` and `spkg-check` are required to be executed in a Sage shell.\n> \n> \n> Right, it's not required to run `spkg-src` in a Sage shell, it's just a sensible thing to do. For example, you would want to do `cd \"$SAGE_ROOT/build/pkgs/meataxe\" but that wouldn't work outside a Sage shell.\n\nRight. That's why originally I wanted it to run in a Sage shell. But alas, Sage thought it was a good idea to build its own git and thought it was an even better idea to not support http.\n\n> > A related question: Is it ok when `spkg-install` also executes MeatAxe's test suite if `SAGE_CHECK` is set?\n> \n> \n> I think you already asked this: it's not a problem.\n\nRight, sorry for asking twice.",
    "created_at": "2016-04-07T14:00:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20136#issuecomment-289079",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:46" align="right">comment:46</div>

Replying to [@jdemeyer](#comment%3A45):
> Replying to [@simon-king-jena](#comment%3A43):
> > Apparently only `spkg-install` and `spkg-check` are required to be executed in a Sage shell.
> 
> 
> Right, it's not required to run `spkg-src` in a Sage shell, it's just a sensible thing to do. For example, you would want to do `cd "$SAGE_ROOT/build/pkgs/meataxe" but that wouldn't work outside a Sage shell.

Right. That's why originally I wanted it to run in a Sage shell. But alas, Sage thought it was a good idea to build its own git and thought it was an even better idea to not support http.

> > A related question: Is it ok when `spkg-install` also executes MeatAxe's test suite if `SAGE_CHECK` is set?
> 
> 
> I think you already asked this: it's not a problem.

Right, sorry for asking twice.



---

archive/issue_comments_289080.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">comment:47</div>\n\nSigh. The patch that makes MeatAxe read and write its tables in a prescribed directory makes its test suite fail. Which has not been the case for the previous MeatAxe version. Namely, it can't find certain files created during the tests.",
    "created_at": "2016-04-07T15:06:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20136#issuecomment-289080",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:47" align="right">comment:47</div>

Sigh. The patch that makes MeatAxe read and write its tables in a prescribed directory makes its test suite fail. Which has not been the case for the previous MeatAxe version. Namely, it can't find certain files created during the tests.



---

archive/issue_comments_289081.json:
```json
{
    "body": "Branch: **[u/SimonKing/various_meataxe_build_issues](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/various_meataxe_build_issues)**",
    "created_at": "2016-04-07T16:02:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20136#issuecomment-289081",
    "user": "https://github.com/simon-king-jena"
}
```

Branch: **[u/SimonKing/various_meataxe_build_issues](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/various_meataxe_build_issues)**



---

archive/issue_comments_289082.json:
```json
{
    "body": "<div id=\"comment:49\" align=\"right\">comment:49</div>\n\nIt should be fine now. As far as I see,\n- I have addressed what we have discussed on the ticket,\n- MeatAxe's test suite passes when installing it with the \"-c\" option,\n- the test suite does not leave garbage behind in SAGE_LOCAL/lib nor in the current directory (it does temporarily create garbage in SAGE_LOCAL/lib, but `spkg-install` removes it),\n- the MeatAxe wrapper in Sage sets a C variable `MtxLibDir` to `$DOT_SAGE/meataxe/`, and one of the patches makes MeatAxe use it for its multiplication tables. Thus, again there should be no garbage created,\n- the tests in sage.matrix pass and indeed no garbage can be found afterwards --- the multiplication tables neatly appear in `DOT_SAGE/meataxe`.\n\n\nNeeds review, I'd say!\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b6e16978528851ffb380449d72f3a529f543a4c9\"><code>b6e1697</code></a></td><td><code>Fix various MeatAxe build issues</code></td></tr></table>\n",
    "created_at": "2016-04-07T16:09:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20136#issuecomment-289082",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:49" align="right">comment:49</div>

It should be fine now. As far as I see,
- I have addressed what we have discussed on the ticket,
- MeatAxe's test suite passes when installing it with the "-c" option,
- the test suite does not leave garbage behind in SAGE_LOCAL/lib nor in the current directory (it does temporarily create garbage in SAGE_LOCAL/lib, but `spkg-install` removes it),
- the MeatAxe wrapper in Sage sets a C variable `MtxLibDir` to `$DOT_SAGE/meataxe/`, and one of the patches makes MeatAxe use it for its multiplication tables. Thus, again there should be no garbage created,
- the tests in sage.matrix pass and indeed no garbage can be found afterwards --- the multiplication tables neatly appear in `DOT_SAGE/meataxe`.


Needs review, I'd say!

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b6e16978528851ffb380449d72f3a529f543a4c9"><code>b6e1697</code></a></td><td><code>Fix various MeatAxe build issues</code></td></tr></table>




---

archive/issue_events_281832.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2016-04-07T16:09:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20136",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20136#event-281832"
}
```



---

archive/issue_comments_289083.json:
```json
{
    "body": "Commit: **[`b6e1697`](https://github.com/sagemath/sagetrac-mirror/commit/b6e16978528851ffb380449d72f3a529f543a4c9)**",
    "created_at": "2016-04-07T16:09:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20136#issuecomment-289083",
    "user": "https://github.com/simon-king-jena"
}
```

Commit: **[`b6e1697`](https://github.com/sagemath/sagetrac-mirror/commit/b6e16978528851ffb380449d72f3a529f543a4c9)**



---

archive/issue_comments_289084.json:
```json
{
    "body": "Changed upstream from **Reported upstream. Developers acknowledge bug.** to **None of the above - read trac for reasoning.**",
    "created_at": "2016-04-07T16:10:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20136#issuecomment-289084",
    "user": "https://github.com/simon-king-jena"
}
```

Changed upstream from **Reported upstream. Developers acknowledge bug.** to **None of the above - read trac for reasoning.**



---

archive/issue_comments_289085.json:
```json
{
    "body": "<div id=\"comment:51\" align=\"right\">comment:51</div>\n\nJust looking at `spkg-src` for now...\n\n1. I think it's better if it can be executed from `$SAGE_ROOT`, so I would add `cd build/pkgs/meataxe` in the beginning.\n\n2. You should move the tarball to `$SAGE_DISTFILES` (I know this isn't a Sage shell, but you could do something like `./sage --sh -c 'mv .... \"$SAGE_DISTFILES\"'`\n\n3. Remove the `# commented out code`.\n\n4. I don't see the point of `git commit -a -m \"Add make target *dist*\"` since the tarball shouldn't contain the git repo.",
    "created_at": "2016-04-07T16:47:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20136#issuecomment-289085",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:51" align="right">comment:51</div>

Just looking at `spkg-src` for now...

1. I think it's better if it can be executed from `$SAGE_ROOT`, so I would add `cd build/pkgs/meataxe` in the beginning.

2. You should move the tarball to `$SAGE_DISTFILES` (I know this isn't a Sage shell, but you could do something like `./sage --sh -c 'mv .... "$SAGE_DISTFILES"'`

3. Remove the `# commented out code`.

4. I don't see the point of `git commit -a -m "Add make target *dist*"` since the tarball shouldn't contain the git repo.



---

archive/issue_events_281833.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-04-07T16:47:46Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/20136",
    "milestone_number": null,
    "milestone_title": "sage-7.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20136#event-281833"
}
```



---

archive/issue_events_281834.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-04-07T16:47:46Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/20136",
    "milestone_number": null,
    "milestone_title": "sage-7.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20136#event-281834"
}
```



---

archive/issue_comments_289086.json:
```json
{
    "body": "Author: **Simon King**",
    "created_at": "2016-04-07T16:47:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20136#issuecomment-289086",
    "user": "https://github.com/jdemeyer"
}
```

Author: **Simon King**



---

archive/issue_events_281835.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-04-07T16:47:46Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/20136",
    "title_is": "Upgrade meataxe and fix some build issues",
    "title_was": "Various meataxe build issues",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20136#event-281835"
}
```



---

archive/issue_comments_289087.json:
```json
{
    "body": "Reviewer: **Jeroen Demeyer**",
    "created_at": "2016-04-07T16:47:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20136#issuecomment-289087",
    "user": "https://github.com/jdemeyer"
}
```

Reviewer: **Jeroen Demeyer**



---

archive/issue_comments_289088.json:
```json
{
    "body": "<div id=\"comment:52\" align=\"right\">comment:52</div>\n\nDid you submit your patches upstream? If yes, how, and was there any reaction?",
    "created_at": "2016-04-07T16:48:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20136#issuecomment-289088",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:52" align="right">comment:52</div>

Did you submit your patches upstream? If yes, how, and was there any reaction?



---

archive/issue_comments_289089.json:
```json
{
    "body": "<div id=\"comment:53\" align=\"right\">comment:53</div>\n\nReplying to [@jdemeyer](#comment%3A52):\n> Did you submit your patches upstream? If yes, how, and was there any reaction?\n\nMy \"old\" patches have been submitted upstream, by mail to Prof. Ringe.\n\nA part of my old patches has been applied upstream: The \"tweaks\" for echelon form computation. Main tool is a function that does \"addmul\" for a *part* of a matrix row (in the original upstream implementation, \"addmul\" has always added complete rows, which is a waste of time during echelon computation, as one knows that the row starts with zeroes).\n\nHowever, upstream has changed my function: I gave an initial position of the row segment to be added, *and* its length. Upstream just gives the initial position of the row segment and assumed that *everything* after the initial position will be added. That's fine for echelon computation, but I need to be able to operate on row segments of a given length, simply since Strassen multiplication acts on matrix windows.\n\nHence, I kept upstream's modification of my \"partial addmul\" function for echelon computation, and I put my original \"partial addmul\" function into src/window.c (which is where I implemented Winograd-Strassen multiplication).\n\nApparently upstream sees no reason to prescribe a directory for multiplication at run time. They think it is enough to try to read it from \"$MTX_ROOT/lib/\", not even from a *subdirectory* of \"$MTX_ROOT/lib\" (where MTX_ROOT typically is /local/ or $SAGE_ROOT), and create the tables in the current directory if it cannot be found in \"$MTX_ROOT/lib\".\nHere I strongly disagree. /local/lib/ is a place for libraries, not for computational data. And the current directory should be kept clean.\n\nAlso I don't know if upstream really cares about error propagation, since it seems that the default way of dealing with errors is to print an error message and exit (I would qualify that as \"crash\").\n\nIn any case, I will send my rebased patches to Ringe soon.",
    "created_at": "2016-04-07T20:05:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20136#issuecomment-289089",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:53" align="right">comment:53</div>

Replying to [@jdemeyer](#comment%3A52):
> Did you submit your patches upstream? If yes, how, and was there any reaction?

My "old" patches have been submitted upstream, by mail to Prof. Ringe.

A part of my old patches has been applied upstream: The "tweaks" for echelon form computation. Main tool is a function that does "addmul" for a *part* of a matrix row (in the original upstream implementation, "addmul" has always added complete rows, which is a waste of time during echelon computation, as one knows that the row starts with zeroes).

However, upstream has changed my function: I gave an initial position of the row segment to be added, *and* its length. Upstream just gives the initial position of the row segment and assumed that *everything* after the initial position will be added. That's fine for echelon computation, but I need to be able to operate on row segments of a given length, simply since Strassen multiplication acts on matrix windows.

Hence, I kept upstream's modification of my "partial addmul" function for echelon computation, and I put my original "partial addmul" function into src/window.c (which is where I implemented Winograd-Strassen multiplication).

Apparently upstream sees no reason to prescribe a directory for multiplication at run time. They think it is enough to try to read it from "$MTX_ROOT/lib/", not even from a *subdirectory* of "$MTX_ROOT/lib" (where MTX_ROOT typically is /local/ or $SAGE_ROOT), and create the tables in the current directory if it cannot be found in "$MTX_ROOT/lib".
Here I strongly disagree. /local/lib/ is a place for libraries, not for computational data. And the current directory should be kept clean.

Also I don't know if upstream really cares about error propagation, since it seems that the default way of dealing with errors is to print an error message and exit (I would qualify that as "crash").

In any case, I will send my rebased patches to Ringe soon.



---

archive/issue_comments_289090.json:
```json
{
    "body": "<div id=\"comment:54\" align=\"right\">comment:54</div>\n\nReplying to [@jdemeyer](#comment%3A51):\n> Just looking at `spkg-src` for now...\n> \n> 1. I think it's better if it can be executed from `$SAGE_ROOT`, so I would add `cd build/pkgs/meataxe` in the beginning.\n\nAs long as it is not to be executed in a sage shell...\n\n> 2. You should move the tarball to `$SAGE_DISTFILES` (I know this isn't a Sage shell, but you could do something like `./sage --sh -c 'mv .... \"$SAGE_DISTFILES\"'`\n\nInteresting usage of \"sage -sh\"! So, \"$SAGE_DISTFILES\" is \"$SAGE_ROOT/upstream/\"?\n\nI tried `./sage --sh -c COMMIT=$COMMIT 'mv build/pkgs/meataxe/meataxe/meataxe-2.5.0.$COMMIT.tar.gz \"$SAGE_DISTFILES\"'`, but\n1. it didn't work\n2. it didn't exit with an error although it didn't work.\n\nSo, what am I doing wrong?\n\n> 3. Remove the `# commented out code`.\n\nSorry, I guess it was \"WIP\"...\n\n> 4. I don't see the point of `git commit -a -m \"Add make target *dist*\"` since the tarball shouldn't contain the git repo.\n\nRight.",
    "created_at": "2016-04-07T20:31:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20136#issuecomment-289090",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:54" align="right">comment:54</div>

Replying to [@jdemeyer](#comment%3A51):
> Just looking at `spkg-src` for now...
> 
> 1. I think it's better if it can be executed from `$SAGE_ROOT`, so I would add `cd build/pkgs/meataxe` in the beginning.

As long as it is not to be executed in a sage shell...

> 2. You should move the tarball to `$SAGE_DISTFILES` (I know this isn't a Sage shell, but you could do something like `./sage --sh -c 'mv .... "$SAGE_DISTFILES"'`

Interesting usage of "sage -sh"! So, "$SAGE_DISTFILES" is "$SAGE_ROOT/upstream/"?

I tried `./sage --sh -c COMMIT=$COMMIT 'mv build/pkgs/meataxe/meataxe/meataxe-2.5.0.$COMMIT.tar.gz "$SAGE_DISTFILES"'`, but
1. it didn't work
2. it didn't exit with an error although it didn't work.

So, what am I doing wrong?

> 3. Remove the `# commented out code`.

Sorry, I guess it was "WIP"...

> 4. I don't see the point of `git commit -a -m "Add make target *dist*"` since the tarball shouldn't contain the git repo.

Right.



---

archive/issue_comments_289091.json:
```json
{
    "body": "<div id=\"comment:55\" align=\"right\">comment:55</div>\n\nReplying to [@simon-king-jena](#comment%3A54):\n> So, what am I doing wrong?\n\nI don't think you can do `sh -c VAR=something \"command\"`, that's just invalid. What should work is\n\n```\nexport VAR=something\nsh -c \"command\"\n```\nThat's also more readable.",
    "created_at": "2016-04-07T20:36:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20136#issuecomment-289091",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:55" align="right">comment:55</div>

Replying to [@simon-king-jena](#comment%3A54):
> So, what am I doing wrong?

I don't think you can do `sh -c VAR=something "command"`, that's just invalid. What should work is

```
export VAR=something
sh -c "command"
```
That's also more readable.



---

archive/issue_comments_289092.json:
```json
{
    "body": "<div id=\"comment:56\" align=\"right\">comment:56</div>\n\nIt seems that `./sage --sh -c 'mv build/pkgs/meataxe/meataxe/meataxe-2.5.0.$COMMIT.tar.gz \"$SAGE_DISTFILES\"' COMMIT=$COMMIT` works. But if it is better readable, I'll export COMMIT.",
    "created_at": "2016-04-07T20:37:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20136#issuecomment-289092",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:56" align="right">comment:56</div>

It seems that `./sage --sh -c 'mv build/pkgs/meataxe/meataxe/meataxe-2.5.0.$COMMIT.tar.gz "$SAGE_DISTFILES"' COMMIT=$COMMIT` works. But if it is better readable, I'll export COMMIT.



---

archive/issue_comments_289093.json:
```json
{
    "body": "<div id=\"comment:57\" align=\"right\">comment:57</div>\n\nJust add `export` on this line\n\n```\nCOMMIT=$(cat package-version.txt | cut -d'.' -f4)\n```",
    "created_at": "2016-04-07T20:40:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20136#issuecomment-289093",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:57" align="right">comment:57</div>

Just add `export` on this line

```
COMMIT=$(cat package-version.txt | cut -d'.' -f4)
```



---

archive/issue_comments_289094.json:
```json
{
    "body": "<div id=\"comment:58\" align=\"right\">comment:58</div>\n\nI am a bit puzzled by Sage's behaviour. I forgot to do `./sage -fix-pkg-checksums` after creating the new tarball. Rather than aborting and complaining about a wrong checksum, Sage *deleted* the tarball that I just put into SAGE_ROOT/upstream!",
    "created_at": "2016-04-07T20:45:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20136#issuecomment-289094",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:58" align="right">comment:58</div>

I am a bit puzzled by Sage's behaviour. I forgot to do `./sage -fix-pkg-checksums` after creating the new tarball. Rather than aborting and complaining about a wrong checksum, Sage *deleted* the tarball that I just put into SAGE_ROOT/upstream!



---

archive/issue_comments_289095.json:
```json
{
    "body": "<div id=\"comment:59\" align=\"right\">comment:59</div>\n\nReplying to [@simon-king-jena](#comment%3A58):\n> Rather than aborting and complaining about a wrong checksum\n\nI think this is mainly meant to make automatic testing easier... but I agree it's not really user-friendly.",
    "created_at": "2016-04-07T20:47:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20136#issuecomment-289095",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:59" align="right">comment:59</div>

Replying to [@simon-king-jena](#comment%3A58):
> Rather than aborting and complaining about a wrong checksum

I think this is mainly meant to make automatic testing easier... but I agree it's not really user-friendly.



---

archive/issue_comments_289096.json:
```json
{
    "body": "<div id=\"comment:60\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/96fc74f2b7d5aa908d28376673e014828375e4c7\"><code>96fc74f</code></a></td><td><code>Sanitise meataxe's spkg-src script</code></td></tr></table>\n",
    "created_at": "2016-04-07T20:48:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20136#issuecomment-289096",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:60"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/96fc74f2b7d5aa908d28376673e014828375e4c7"><code>96fc74f</code></a></td><td><code>Sanitise meataxe's spkg-src script</code></td></tr></table>




---

archive/issue_comments_289097.json:
```json
{
    "body": "Changed commit from **[`b6e1697`](https://github.com/sagemath/sagetrac-mirror/commit/b6e16978528851ffb380449d72f3a529f543a4c9)** to **[`96fc74f`](https://github.com/sagemath/sagetrac-mirror/commit/96fc74f2b7d5aa908d28376673e014828375e4c7)**",
    "created_at": "2016-04-07T20:48:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20136#issuecomment-289097",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`b6e1697`](https://github.com/sagemath/sagetrac-mirror/commit/b6e16978528851ffb380449d72f3a529f543a4c9)** to **[`96fc74f`](https://github.com/sagemath/sagetrac-mirror/commit/96fc74f2b7d5aa908d28376673e014828375e4c7)**



---

archive/issue_comments_289098.json:
```json
{
    "body": "<div id=\"comment:61\" align=\"right\">comment:61</div>\n\nBetter?",
    "created_at": "2016-04-07T20:49:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20136#issuecomment-289098",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:61" align="right">comment:61</div>

Better?



---

archive/issue_comments_289099.json:
```json
{
    "body": "<div id=\"comment:62\" align=\"right\">comment:62</div>\n\nI've been trying to help install Sage with meataxe in a multiuser environment at UMN, and we ran into problems with meataxe looking for files in each user's `DOT_SAGE` folder. So I feel we should change the behavior to install/lookup the necessary files in some subdirectory of `SAGE_LOCAL`.",
    "created_at": "2016-04-15T15:54:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20136#issuecomment-289099",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:62" align="right">comment:62</div>

I've been trying to help install Sage with meataxe in a multiuser environment at UMN, and we ran into problems with meataxe looking for files in each user's `DOT_SAGE` folder. So I feel we should change the behavior to install/lookup the necessary files in some subdirectory of `SAGE_LOCAL`.



---

archive/issue_comments_289100.json:
```json
{
    "body": "<div id=\"comment:63\" align=\"right\">comment:63</div>\n\nIt depends on whether meataxe will be writing to those files after installation, because at that point it won't necessarily have write access to `SAGE_LOCAL`. I don't know the answer to this, though. Can it look in both places?",
    "created_at": "2016-04-15T16:09:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20136#issuecomment-289100",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:63" align="right">comment:63</div>

It depends on whether meataxe will be writing to those files after installation, because at that point it won't necessarily have write access to `SAGE_LOCAL`. I don't know the answer to this, though. Can it look in both places?



---

archive/issue_comments_289101.json:
```json
{
    "body": "<div id=\"comment:64\" align=\"right\">comment:64</div>\n\nIn order to use meataxe, you need to rebuild Sage because of the optional extension. So I would think you would need a certain amount of write access. Although if that is an issue, I think one way we can fix it all is during installation, there could be a flag which we set that determines where the data files are written to and read from. Otherwise I am not sure how to make this really usable in a multiuser environment.",
    "created_at": "2016-04-16T03:35:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20136#issuecomment-289101",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:64" align="right">comment:64</div>

In order to use meataxe, you need to rebuild Sage because of the optional extension. So I would think you would need a certain amount of write access. Although if that is an issue, I think one way we can fix it all is during installation, there could be a flag which we set that determines where the data files are written to and read from. Otherwise I am not sure how to make this really usable in a multiuser environment.



---

archive/issue_comments_289102.json:
```json
{
    "body": "<div id=\"comment:65\" align=\"right\">comment:65</div>\n\nReplying to [@tscrim](#comment%3A64):\n> In order to use meataxe, you need to rebuild Sage because of the optional extension. So I would think you would need a certain amount of write access.\n\nDuring *installation* of the package, of course it is granted that the person who is installing it has write access to SAGE_LOCAL. However, during *usage* of Sage, it is granted that the user has *read* access to SAGE_LOCAL and *write* access to DOT_SAGE, but not necessarily write access to SAGE_LOCAL.\n\n> Although if that is an issue, I think one way we can fix it all is during installation, there could be a flag which we set that determines where the data files are written to and read from. Otherwise I am not sure how to make this really usable in a multiuser environment.\n\nOf course it is usable in a multiuser environment, because it is not a problem if each user has her own copy of the multiplication tables.\n\n\nI think I have explained above the three possible approaches that one could take:\n\n- Current approach I take: Patch MeatAxe, so that it becomes possible to set a flag at run time telling MeatAxe to read tables from and write tables to a specified directory. Since it is during run time, it **must** be a directory where the user has write access, hence, DOT_SAGE but not SAGE_LOCAL.\n\n- Alternative approach: By a relatively recent upstream change, MeatAxe would finally read from, but still not *write* into, the directory `MTX_ROOT/lib`, where `MTX_ROOT` is the directory into which MeatAxe is installed; if a table cannot be found there, upstream would write into the current directory, which may be forbidden for the Sage user, resulting in an error (or without my patches, it wouldn't give an error but just crash). Of course we would have `MTX_ROOT=$SAGE_LOCAL`. Consequences:\n    1. It would become mandatory to write *all* multiplication tables during installation of the package, since otherwise write permission cannot be granted and since we don't want the current directory to be polluted.\n    2. We would never be able to use the \"big\" MeatAxe kernel for large field sizes, simply since it wouldn't be feasible to compute and write ten thousands of multiplication tables during installation. However, the big kernel isn't officially supported by upstream nowadays.\n    3. As I said, upstream would use `MTX_ROOT/lib`, i.e. `SAGE_LOCAL/lib`, for its tables --- but that's awful. To the very least, it should use a single sub-directory such as `MTX_ROOT/lib/meataxe_tables` for that purpose. Hence, we would need yet another patch to upstream.\n- Mixed approach: Patch MeatAxe as in the current approach, use a single location to which all users have read but not necessarily write permission, and create the tables during package installation.",
    "created_at": "2016-04-16T05:35:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20136#issuecomment-289102",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:65" align="right">comment:65</div>

Replying to [@tscrim](#comment%3A64):
> In order to use meataxe, you need to rebuild Sage because of the optional extension. So I would think you would need a certain amount of write access.

During *installation* of the package, of course it is granted that the person who is installing it has write access to SAGE_LOCAL. However, during *usage* of Sage, it is granted that the user has *read* access to SAGE_LOCAL and *write* access to DOT_SAGE, but not necessarily write access to SAGE_LOCAL.

> Although if that is an issue, I think one way we can fix it all is during installation, there could be a flag which we set that determines where the data files are written to and read from. Otherwise I am not sure how to make this really usable in a multiuser environment.

Of course it is usable in a multiuser environment, because it is not a problem if each user has her own copy of the multiplication tables.


I think I have explained above the three possible approaches that one could take:

- Current approach I take: Patch MeatAxe, so that it becomes possible to set a flag at run time telling MeatAxe to read tables from and write tables to a specified directory. Since it is during run time, it **must** be a directory where the user has write access, hence, DOT_SAGE but not SAGE_LOCAL.

- Alternative approach: By a relatively recent upstream change, MeatAxe would finally read from, but still not *write* into, the directory `MTX_ROOT/lib`, where `MTX_ROOT` is the directory into which MeatAxe is installed; if a table cannot be found there, upstream would write into the current directory, which may be forbidden for the Sage user, resulting in an error (or without my patches, it wouldn't give an error but just crash). Of course we would have `MTX_ROOT=$SAGE_LOCAL`. Consequences:
    1. It would become mandatory to write *all* multiplication tables during installation of the package, since otherwise write permission cannot be granted and since we don't want the current directory to be polluted.
    2. We would never be able to use the "big" MeatAxe kernel for large field sizes, simply since it wouldn't be feasible to compute and write ten thousands of multiplication tables during installation. However, the big kernel isn't officially supported by upstream nowadays.
    3. As I said, upstream would use `MTX_ROOT/lib`, i.e. `SAGE_LOCAL/lib`, for its tables --- but that's awful. To the very least, it should use a single sub-directory such as `MTX_ROOT/lib/meataxe_tables` for that purpose. Hence, we would need yet another patch to upstream.
- Mixed approach: Patch MeatAxe as in the current approach, use a single location to which all users have read but not necessarily write permission, and create the tables during package installation.



---

archive/issue_comments_289103.json:
```json
{
    "body": "<div id=\"comment:66\" align=\"right\">comment:66</div>\n\nI reported the following issue on sage-devel https://groups.google.com/forum/?fromgroups#!topic/sage-devel/aMuSDOjCbR0\nI am not sure whether this upgrade will fix it.",
    "created_at": "2016-09-21T12:47:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20136#issuecomment-289103",
    "user": "https://github.com/sagetrac-tmonteil"
}
```

<div id="comment:66" align="right">comment:66</div>

I reported the following issue on sage-devel https://groups.google.com/forum/?fromgroups#!topic/sage-devel/aMuSDOjCbR0
I am not sure whether this upgrade will fix it.



---

archive/issue_comments_289104.json:
```json
{
    "body": "<div id=\"comment:67\" align=\"right\">comment:67</div>\n\nApparently the branch doesn't apply.",
    "created_at": "2017-01-09T12:48:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20136#issuecomment-289104",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:67" align="right">comment:67</div>

Apparently the branch doesn't apply.



---

archive/issue_events_281836.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2017-01-09T12:48:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20136",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20136#event-281836"
}
```



---

archive/issue_events_281837.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2017-01-09T12:48:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20136",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20136#event-281837"
}
```



---

archive/issue_events_281838.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-12-29T01:35:57Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/20136",
    "milestone_number": null,
    "milestone_title": "sage-7.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20136#event-281838"
}
```
