# Issue 20162: properties of converted finite field elements are wrong

archive/issues_019925.json:
```json
{
    "body": "This should not happen:\n\n```\nsage: k.<a> = GF(9)\nsage: SR(a).is_real()\nTrue\nsage: SR(a).is_positive()\nTrue\n```\n\nCC:  @rwst\n\nReviewer: Clemens Heuberger\n\nAuthor: Benjamin Hackl\n\nDependencies: #20312\n\nResolution: invalid\n\nIssue created by migration from https://trac.sagemath.org/ticket/20162\n\n",
    "closed_at": "2017-01-21T18:03:11Z",
    "created_at": "2016-03-04T21:55:42Z",
    "labels": [
        "component: symbolics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "properties of converted finite field elements are wrong",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/20162",
    "user": "https://github.com/behackl"
}
```
This should not happen:

```
sage: k.<a> = GF(9)
sage: SR(a).is_real()
True
sage: SR(a).is_positive()
True
```

CC:  @rwst

Reviewer: Clemens Heuberger

Author: Benjamin Hackl

Dependencies: #20312

Resolution: invalid

Issue created by migration from https://trac.sagemath.org/ticket/20162





---

archive/issue_comments_359809.json:
```json
{
    "body": "<a id='comment:1'></a>\nNew commits:\n|                                                                                                                                          |                                     |\n|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------|\n|[443fbf8](https://github.com/sagemath/sagetrac-mirror/commit/443fbf8f88e730687543208efdab24b2546c125a)|`finite field elements are not reals`|\n|[a822d5d](https://github.com/sagemath/sagetrac-mirror/commit/a822d5dd9c18b99bcca00138d103e05665247523)|`add doctests for is_real/is_positive`|",
    "created_at": "2016-03-04T21:59:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20162#issuecomment-359809",
    "user": "https://github.com/behackl"
}
```

<a id='comment:1'></a>
New commits:
|                                                                                                                                          |                                     |
|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------|
|[443fbf8](https://github.com/sagemath/sagetrac-mirror/commit/443fbf8f88e730687543208efdab24b2546c125a)|`finite field elements are not reals`|
|[a822d5d](https://github.com/sagemath/sagetrac-mirror/commit/a822d5dd9c18b99bcca00138d103e05665247523)|`add doctests for is_real/is_positive`|



---

archive/issue_comments_359810.json:
```json
{
    "body": "Changing branch from \"\" to \"u/behackl/symbolic/finite-field-reals\"",
    "created_at": "2016-03-04T21:59:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20162#issuecomment-359810",
    "user": "https://github.com/behackl"
}
```

Changing branch from "" to "u/behackl/symbolic/finite-field-reals"



---

archive/issue_comments_359811.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-03-04T21:59:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20162#issuecomment-359811",
    "user": "https://github.com/behackl"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_359812.json:
```json
{
    "body": "Changing commit from \"\" to \"a822d5dd9c18b99bcca00138d103e05665247523\"",
    "created_at": "2016-03-04T21:59:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20162#issuecomment-359812",
    "user": "https://github.com/behackl"
}
```

Changing commit from "" to "a822d5dd9c18b99bcca00138d103e05665247523"



---

archive/issue_comments_359813.json:
```json
{
    "body": "<a id='comment:2'></a>\nPatchbot shows doctest fails.",
    "created_at": "2016-03-05T14:04:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20162#issuecomment-359813",
    "user": "https://github.com/rwst"
}
```

<a id='comment:2'></a>
Patchbot shows doctest fails.



---

archive/issue_comments_359814.json:
```json
{
    "body": "<a id='comment:3'></a>\nAh, yes. Maybe I need another way of finding out whether a parent is a finite field; `is_finite` seems to throw `NotImplementedError`s here. That would fix the failures in `schemes/elliptic_curves/heigth.py`.\n\nHowever, I'm not sure about the segmentation fault in `expression.pyx`, calling\n\n```\nsage: (Mod(2,7)*x^2 + Mod(2,7))^7\n```\nfrom `sage -gdb` prints the line\n\n```\nProgram received signal SIGSEGV, Segmentation fault.\nGiNaC::add::integer_content (this=0x3019c20) at normal.cpp:325\n```\nIt seems that something requires the expression to be a real in order for the power to work. This is bad.\n\nMaybe I'll investigate later; have to go now.",
    "created_at": "2016-03-05T16:44:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20162#issuecomment-359814",
    "user": "https://github.com/behackl"
}
```

<a id='comment:3'></a>
Ah, yes. Maybe I need another way of finding out whether a parent is a finite field; `is_finite` seems to throw `NotImplementedError`s here. That would fix the failures in `schemes/elliptic_curves/heigth.py`.

However, I'm not sure about the segmentation fault in `expression.pyx`, calling

```
sage: (Mod(2,7)*x^2 + Mod(2,7))^7
```
from `sage -gdb` prints the line

```
Program received signal SIGSEGV, Segmentation fault.
GiNaC::add::integer_content (this=0x3019c20) at normal.cpp:325
```
It seems that something requires the expression to be a real in order for the power to work. This is bad.

Maybe I'll investigate later; have to go now.



---

archive/issue_comments_359815.json:
```json
{
    "body": "<a id='comment:4'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                                             |\n|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------|\n|[591899b](https://github.com/sagemath/sagetrac-mirror/commit/591899ba8eda202cf8af3a2c22ef7aab85059ccf)|`return false in case of NotImplementedError`|",
    "created_at": "2016-03-06T09:48:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20162#issuecomment-359815",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                                             |
|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------|
|[591899b](https://github.com/sagemath/sagetrac-mirror/commit/591899ba8eda202cf8af3a2c22ef7aab85059ccf)|`return false in case of NotImplementedError`|



---

archive/issue_comments_359816.json:
```json
{
    "body": "Changing commit from \"a822d5dd9c18b99bcca00138d103e05665247523\" to \"591899ba8eda202cf8af3a2c22ef7aab85059ccf\"",
    "created_at": "2016-03-06T09:48:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20162#issuecomment-359816",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "a822d5dd9c18b99bcca00138d103e05665247523" to "591899ba8eda202cf8af3a2c22ef7aab85059ccf"



---

archive/issue_comments_359817.json:
```json
{
    "body": "<a id='comment:5'></a>\nThe last commit fixes the doctest failures in `schemes/elliptic_curves/height.py`, but not the segmentation fault. Unfortunately, the reason for that lies in pynac---a fix can be found here: https://github.com/pynac/pynac/pull/160.",
    "created_at": "2016-03-06T09:57:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20162#issuecomment-359817",
    "user": "https://github.com/behackl"
}
```

<a id='comment:5'></a>
The last commit fixes the doctest failures in `schemes/elliptic_curves/height.py`, but not the segmentation fault. Unfortunately, the reason for that lies in pynac---a fix can be found here: https://github.com/pynac/pynac/pull/160.



---

archive/issue_comments_359818.json:
```json
{
    "body": "<a id='comment:6'></a>\nJust to share some related fun with quotients of the integer ring\n\n```\nsage: cos(Zmod(7)(3))\n-0.989992496600445\nsage: cos(Zmod(10)(3))\n1\nsage: cos(Zmod(15)(3))\n1\n```",
    "created_at": "2016-03-09T18:43:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20162#issuecomment-359818",
    "user": "https://github.com/videlec"
}
```

<a id='comment:6'></a>
Just to share some related fun with quotients of the integer ring

```
sage: cos(Zmod(7)(3))
-0.989992496600445
sage: cos(Zmod(10)(3))
1
sage: cos(Zmod(15)(3))
1
```



---

archive/issue_comments_359819.json:
```json
{
    "body": "<a id='comment:7'></a>\nWith pynac-0.6.4 (#20134):\n\n```\nsage: cos(Zmod(7)(3))\n-0.989992496600445\nsage: cos(Zmod(10)(3))\n-0.989992496600445\nsage: cos(Zmod(15)(3))\n-0.989992496600445\n```\nIn an ideal world, this would probably raise a `ValueError` or so. This way it is at least consistent.",
    "created_at": "2016-03-09T19:40:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20162#issuecomment-359819",
    "user": "https://github.com/behackl"
}
```

<a id='comment:7'></a>
With pynac-0.6.4 (#20134):

```
sage: cos(Zmod(7)(3))
-0.989992496600445
sage: cos(Zmod(10)(3))
-0.989992496600445
sage: cos(Zmod(15)(3))
-0.989992496600445
```
In an ideal world, this would probably raise a `ValueError` or so. This way it is at least consistent.



---

archive/issue_comments_359820.json:
```json
{
    "body": "Changing dependencies from \"\" to \"pynac-0.6.5\"",
    "created_at": "2016-04-17T13:54:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20162#issuecomment-359820",
    "user": "https://github.com/rwst"
}
```

Changing dependencies from "" to "pynac-0.6.5"



---

archive/issue_comments_359821.json:
```json
{
    "body": "<a id='comment:9'></a>\nI doubt it is such a good idea to special-case finite fields here. Why does `py_imag` default to returning `True` in the first place?! And as for returning results based on the parent of the wrapped object, I'd be tempted to base the logic on whether the parent has coercions to things like `{Real,Complex}Field(mpfr_prec_min())` instead of having explicit lists of \u201creal\u201d and \u201cnon-real\u201d parents.",
    "created_at": "2016-04-18T11:42:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20162#issuecomment-359821",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:9'></a>
I doubt it is such a good idea to special-case finite fields here. Why does `py_imag` default to returning `True` in the first place?! And as for returning results based on the parent of the wrapped object, I'd be tempted to base the logic on whether the parent has coercions to things like `{Real,Complex}Field(mpfr_prec_min())` instead of having explicit lists of “real” and “non-real” parents.



---

archive/issue_comments_359822.json:
```json
{
    "body": "<a id='comment:10'></a>\nReplying to [mmezzarobba](#comment%3A9):\n> I doubt it is such a good idea to special-case finite fields here. Why does `py_imag` default to returning `True` in the first place?! \n\n\nThis is because if in doubt `py_is_real` asks `py_imag` whether the imaginary part is 0---which is the case for these elements, because if in doubt, `py_imag` assumes that the imaginary part is 0. ;-)\n\n> And as for returning results based on the parent of the wrapped object, I'd be tempted to base the logic on whether the parent has coercions to things like `{Real,Complex}Field(mpfr_prec_min())` instead of having explicit lists of \u201creal\u201d and \u201cnon-real\u201d parents.\n\n\nThis might be an approach worth pursuing.",
    "created_at": "2016-04-18T12:02:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20162#issuecomment-359822",
    "user": "https://github.com/behackl"
}
```

<a id='comment:10'></a>
Replying to [mmezzarobba](#comment%3A9):
> I doubt it is such a good idea to special-case finite fields here. Why does `py_imag` default to returning `True` in the first place?! 


This is because if in doubt `py_is_real` asks `py_imag` whether the imaginary part is 0---which is the case for these elements, because if in doubt, `py_imag` assumes that the imaginary part is 0. ;-)

> And as for returning results based on the parent of the wrapped object, I'd be tempted to base the logic on whether the parent has coercions to things like `{Real,Complex}Field(mpfr_prec_min())` instead of having explicit lists of “real” and “non-real” parents.


This might be an approach worth pursuing.



---

archive/issue_comments_359823.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-04-18T12:02:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20162#issuecomment-359823",
    "user": "https://github.com/behackl"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_359824.json:
```json
{
    "body": "Changing dependencies from \"pynac-0.6.5\" to \"#20312\"",
    "created_at": "2016-05-11T06:08:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20162#issuecomment-359824",
    "user": "https://github.com/rwst"
}
```

Changing dependencies from "pynac-0.6.5" to "#20312"



---

archive/issue_comments_359825.json:
```json
{
    "body": "<a id='comment:12'></a>\nNow (with #20312) both flags are false. Can this case be considered to be fixed? Then just a doctest would be needed here.",
    "created_at": "2016-05-11T06:08:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20162#issuecomment-359825",
    "user": "https://github.com/rwst"
}
```

<a id='comment:12'></a>
Now (with #20312) both flags are false. Can this case be considered to be fixed? Then just a doctest would be needed here.



---

archive/issue_comments_359826.json:
```json
{
    "body": "<a id='comment:13'></a>\nWith #22162 this would return `Unknown`, and a doctest already exist (changed in #22162) so I think this is a duplicate now.",
    "created_at": "2017-01-10T14:31:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20162#issuecomment-359826",
    "user": "https://github.com/rwst"
}
```

<a id='comment:13'></a>
With #22162 this would return `Unknown`, and a doctest already exist (changed in #22162) so I think this is a duplicate now.



---

archive/issue_comments_359827.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-01-10T14:31:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20162#issuecomment-359827",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_events_070143.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-01-10T14:31:48Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/20162",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20162#event-70143"
}
```



---

archive/issue_comments_359828.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-01-12T06:48:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20162#issuecomment-359828",
    "user": "https://github.com/cheuberg"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_359829.json:
```json
{
    "body": "<a id='comment:14'></a>\nIn any case, this produces a merge conflict.",
    "created_at": "2017-01-12T06:48:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20162#issuecomment-359829",
    "user": "https://github.com/cheuberg"
}
```

<a id='comment:14'></a>
In any case, this produces a merge conflict.



---

archive/issue_comments_359830.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-01-12T07:32:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20162#issuecomment-359830",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_359831.json:
```json
{
    "body": "<a id='comment:15'></a>\nReplying to [cheuberg](#comment%3A14):\n> In any case, this produces a merge conflict.\n\n\nNeeds work on a duplicate request!?",
    "created_at": "2017-01-12T07:32:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20162#issuecomment-359831",
    "user": "https://github.com/rwst"
}
```

<a id='comment:15'></a>
Replying to [cheuberg](#comment%3A14):
> In any case, this produces a merge conflict.


Needs work on a duplicate request!?



---

archive/issue_comments_359832.json:
```json
{
    "body": "<a id='comment:16'></a>\nsorry, did not see the sage-duplicate/invalid/wontfix milestone.",
    "created_at": "2017-01-12T07:43:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20162#issuecomment-359832",
    "user": "https://github.com/cheuberg"
}
```

<a id='comment:16'></a>
sorry, did not see the sage-duplicate/invalid/wontfix milestone.



---

archive/issue_comments_359833.json:
```json
{
    "body": "<a id='comment:17'></a>\nI see that the problem is fixed; can you tell me where the doctest is? I did not see it at first glance.",
    "created_at": "2017-01-12T07:47:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20162#issuecomment-359833",
    "user": "https://github.com/cheuberg"
}
```

<a id='comment:17'></a>
I see that the problem is fixed; can you tell me where the doctest is? I did not see it at first glance.



---

archive/issue_comments_359834.json:
```json
{
    "body": "<a id='comment:18'></a>\nIt was added with https://github.com/sagemath/sage/commit/11e2b784\n(bottom)",
    "created_at": "2017-01-12T08:28:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20162#issuecomment-359834",
    "user": "https://github.com/rwst"
}
```

<a id='comment:18'></a>
It was added with https://github.com/sagemath/sage/commit/11e2b784
(bottom)



---

archive/issue_comments_359835.json:
```json
{
    "body": "<a id='comment:19'></a>\nProblem is fixed and doctest has been included in #20475.",
    "created_at": "2017-01-12T09:25:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20162#issuecomment-359835",
    "user": "https://github.com/cheuberg"
}
```

<a id='comment:19'></a>
Problem is fixed and doctest has been included in #20475.



---

archive/issue_comments_359836.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Clemens Heuberger\"",
    "created_at": "2017-01-12T09:25:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20162#issuecomment-359836",
    "user": "https://github.com/cheuberg"
}
```

Changing reviewer from "" to "Clemens Heuberger"



---

archive/issue_comments_359837.json:
```json
{
    "body": "Changing commit from \"591899ba8eda202cf8af3a2c22ef7aab85059ccf\" to \"\"",
    "created_at": "2017-01-12T09:25:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20162#issuecomment-359837",
    "user": "https://github.com/cheuberg"
}
```

Changing commit from "591899ba8eda202cf8af3a2c22ef7aab85059ccf" to ""



---

archive/issue_comments_359838.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-01-12T09:25:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20162#issuecomment-359838",
    "user": "https://github.com/cheuberg"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_359839.json:
```json
{
    "body": "Changing branch from \"u/behackl/symbolic/finite-field-reals\" to \"\"",
    "created_at": "2017-01-12T09:25:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20162#issuecomment-359839",
    "user": "https://github.com/cheuberg"
}
```

Changing branch from "u/behackl/symbolic/finite-field-reals" to ""



---

archive/issue_events_070144.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-01-21T18:03:11Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/20162",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20162#event-70144"
}
```



---

archive/issue_comments_359840.json:
```json
{
    "body": "Resolution: invalid",
    "created_at": "2017-01-21T18:03:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20162",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20162#issuecomment-359840",
    "user": "https://github.com/vbraun"
}
```

Resolution: invalid
