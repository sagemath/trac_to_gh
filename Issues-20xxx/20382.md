# Issue 20382: Replace is_package_installed with Features

archive/issues_020145.json:
```json
{
    "body": "\n\nAssignee: @jdemeyer\n\nCC:  @mkoeppe @jdemeyer @nexttime @embray @defeo @isuruf @slel\n\nKeywords: days85\n\nReviewer: Nicolas M. Thi\u00e9ry, Fran\u00e7ois Bissey, Julian R\u00fcth\n\nAuthor: Julian R\u00fcth, Jeroen Demeyer\n\nBranch: ad6dcc6fc50723b616ae32f23ea592c8a27da5ca\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/20382\n\n",
    "closed_at": "2018-05-08T17:27:34Z",
    "created_at": "2016-04-07T17:03:13Z",
    "labels": [
        "component: build"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.3",
    "title": "Replace is_package_installed with Features",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/20382",
    "user": "https://github.com/saraedum"
}
```


Assignee: @jdemeyer

CC:  @mkoeppe @jdemeyer @nexttime @embray @defeo @isuruf @slel

Keywords: days85

Reviewer: Nicolas M. Thiéry, François Bissey, Julian Rüth

Author: Julian Rüth, Jeroen Demeyer

Branch: ad6dcc6fc50723b616ae32f23ea592c8a27da5ca

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/20382





---

archive/issue_comments_277230.json:
```json
{
    "body": "<a id='comment:2'></a>Indeed same kind of work. Much more sophisticated on your part I must say. Do I understand well that you need an executable class for any external binaries that you want to call?\n\nIt could also solve the issue that I was thinking about executables and other files requirement. You should be able to find and use something already installed in a standard location. `theta` being already present in `/usr/local/bin` instead of `$SAGE_LOCAL/bin` (which resolves to `/usr/bin` in sage-on-gentoo) or anywhere in the `PATH`. Similarly you can install `gap` packages in `~/.gap/pkg` and there is no reasons why you shouldn't be able to use those.\n\n---\nNew commits:",
    "created_at": "2016-04-07T23:06:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277230",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:2'></a>Indeed same kind of work. Much more sophisticated on your part I must say. Do I understand well that you need an executable class for any external binaries that you want to call?

It could also solve the issue that I was thinking about executables and other files requirement. You should be able to find and use something already installed in a standard location. `theta` being already present in `/usr/local/bin` instead of `$SAGE_LOCAL/bin` (which resolves to `/usr/bin` in sage-on-gentoo) or anywhere in the `PATH`. Similarly you can install `gap` packages in `~/.gap/pkg` and there is no reasons why you shouldn't be able to use those.

---
New commits:



---

archive/issue_comments_277231.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-04-07T23:26:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277231",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_277232.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-04-07T23:31:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277232",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_277233.json:
```json
{
    "body": "<a id='comment:6'></a>Handling of `database_gap` will be delicate. The spkg includes bits removed stuff from `gap` that are expected by default (no need to load if present) and one \"real\" gap package that one would need to load (`tomlib`). \n\nThat may require special consideration.",
    "created_at": "2016-04-07T23:37:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277233",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:6'></a>Handling of `database_gap` will be delicate. The spkg includes bits removed stuff from `gap` that are expected by default (no need to load if present) and one "real" gap package that one would need to load (`tomlib`). 

That may require special consideration.



---

archive/issue_comments_277234.json:
```json
{
    "body": "<a id='comment:7'></a>Thanks for the pointer about database_gap. I should have a complete proposal up on the other ticket in the next 24 hours.",
    "created_at": "2016-04-07T23:57:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277234",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:7'></a>Thanks for the pointer about database_gap. I should have a complete proposal up on the other ticket in the next 24 hours.



---

archive/issue_comments_277235.json:
```json
{
    "body": "<a id='comment:8'></a>I think this ticket should replace the other one unless you have a plan. I am making a list of stuff that needs to come from the other ticket and stuff that should use your feature detection. I guess we could split it along those lines.",
    "created_at": "2016-04-08T00:03:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277235",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:8'></a>I think this ticket should replace the other one unless you have a plan. I am making a list of stuff that needs to come from the other ticket and stuff that should use your feature detection. I guess we could split it along those lines.



---

archive/issue_comments_277236.json:
```json
{
    "body": "<a id='comment:9'></a>Going through the files that I have changed in #20377 which this ticket should supersede:\n* `sage/databases/cremona.py` we need to check the real presence of a file in a specific location in this case. Adding something to feature may be overkill for that particular case.\n* `sage/game_theory/normal_form_game.py` + `sage/geometry/polyhedron/base.py` look for the `lrs` executable\n* `sage/graphs/generators/classical_geometries.py` already covered in this ticket\n* `sage/graphs/generic_graph.py` I think my stuff should stay. It is mostly straight `try...expect` whether or not a python module is available.\n* `sage/graphs/graph_generators.py` 3 different executables to detect\n* `sage/graphs/lovasz_theta.py` covered here\n* `sage/groups/generic.py` possibly detect if gap package tomlib is present\n* `sage/groups/perm_gps/permgroup.py` again dodgy database_gap detection in one part. The part using the gap `hap` package would need a nice rework not just migration. I'd like to pick the mind of the person who wrote this.\n* `sage/misc/all.py` my stuff should stay. It is removal of `import` no one uses.\n* `sage/rings/polynomial/multi_polynomial_sequence.py` finding one executable",
    "created_at": "2016-04-08T00:13:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277236",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:9'></a>Going through the files that I have changed in #20377 which this ticket should supersede:
* `sage/databases/cremona.py` we need to check the real presence of a file in a specific location in this case. Adding something to feature may be overkill for that particular case.
* `sage/game_theory/normal_form_game.py` + `sage/geometry/polyhedron/base.py` look for the `lrs` executable
* `sage/graphs/generators/classical_geometries.py` already covered in this ticket
* `sage/graphs/generic_graph.py` I think my stuff should stay. It is mostly straight `try...expect` whether or not a python module is available.
* `sage/graphs/graph_generators.py` 3 different executables to detect
* `sage/graphs/lovasz_theta.py` covered here
* `sage/groups/generic.py` possibly detect if gap package tomlib is present
* `sage/groups/perm_gps/permgroup.py` again dodgy database_gap detection in one part. The part using the gap `hap` package would need a nice rework not just migration. I'd like to pick the mind of the person who wrote this.
* `sage/misc/all.py` my stuff should stay. It is removal of `import` no one uses.
* `sage/rings/polynomial/multi_polynomial_sequence.py` finding one executable



---

archive/issue_comments_277237.json:
```json
{
    "body": "<a id='comment:11'></a>Is there overlap with #20182? Should #20182 be rewritten to use this?\n\n---\nNew commits:",
    "created_at": "2016-04-08T15:09:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277237",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:11'></a>Is there overlap with #20182? Should #20182 be rewritten to use this?

---
New commits:



---

archive/issue_comments_277238.json:
```json
{
    "body": "<a id='comment:12'></a>Hi Julian,\n\nJust some rambling, thinking about use cases for this ticket or some follow up:\n\nWhile discussing with the Debian people, it was stressed out that we\nwill eventually want to be able to support simultaneously a stable\nversion of software X (as provided by distributions), and a devel\nversion of it (e.g. for our researchers that need the very latest\nfeatures). Therefore we probably will want to have code that could\nlook like:\n\n```\n        def latest_feature():\n            \"\"\"\n            ...\n\n            EXAMPLES::\n\n                sage: X = ...\n                sage: X.latest_feature()    # optional gap >= 3.5\n            \"\"\"\n            GAP(min_version=3.5).require()      # or some better syntax\n            ...\n            return gap.latest_feature()\n```\n\nTo support this use case we would need:\n\n- support for version checking in the Feature code (probably in a follow up ticket).\n\n  Probably not much can be written generically, except possibly for Executables,\n  trying to pass the --version and scanning the output for something that looks\n  like a version number\n\n- some updates to the doctesting framework to support version\n  annotations (definitely in another ticket)\n\n- mapping feature names appearing in the #optional annotations to actual Feature's\n  (it's going in this direction in #20182).\n\n\nNot directly related to this ticket, but building on the discussion we had while walking in Cernay, we may want to be able to write the annotation as::\n\n```\n        def latest_feature():\n            \"\"\"\n            ...\n\n            .. REQUIRES:: gap >= 3.5\n\n            EXAMPLES::\n\n                sage: X = ...\n                sage: X.latest_feature()\n            \"\"\"\n```\n\nCheers,\n                           Nicolas",
    "created_at": "2016-04-10T05:03:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277238",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:12'></a>Hi Julian,

Just some rambling, thinking about use cases for this ticket or some follow up:

While discussing with the Debian people, it was stressed out that we
will eventually want to be able to support simultaneously a stable
version of software X (as provided by distributions), and a devel
version of it (e.g. for our researchers that need the very latest
features). Therefore we probably will want to have code that could
look like:

```
        def latest_feature():
            """
            ...

            EXAMPLES::

                sage: X = ...
                sage: X.latest_feature()    # optional gap >= 3.5
            """
            GAP(min_version=3.5).require()      # or some better syntax
            ...
            return gap.latest_feature()
```

To support this use case we would need:

- support for version checking in the Feature code (probably in a follow up ticket).

  Probably not much can be written generically, except possibly for Executables,
  trying to pass the --version and scanning the output for something that looks
  like a version number

- some updates to the doctesting framework to support version
  annotations (definitely in another ticket)

- mapping feature names appearing in the #optional annotations to actual Feature's
  (it's going in this direction in #20182).


Not directly related to this ticket, but building on the discussion we had while walking in Cernay, we may want to be able to write the annotation as::

```
        def latest_feature():
            """
            ...

            .. REQUIRES:: gap >= 3.5

            EXAMPLES::

                sage: X = ...
                sage: X.latest_feature()
            """
```

Cheers,
                           Nicolas



---

archive/issue_comments_277239.json:
```json
{
    "body": "<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-04-11T02:29:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277239",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_277240.json:
```json
{
    "body": "<a id='comment:14'></a>nthiery: About version checks. I think it would be easy to add this in the current setup. However, I would recommend to follow the philosophy of autoconf here. I.e., we should not check for a version because you need to keep track which version range supportes the feature you are looking for (and often things are heavily patched so the version might be misleading.) Instead, we should check for the actual feature/interface required. It is a bit more work of course but usually better and much easier to maintain.",
    "created_at": "2016-04-11T02:36:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277240",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:14'></a>nthiery: About version checks. I think it would be easy to add this in the current setup. However, I would recommend to follow the philosophy of autoconf here. I.e., we should not check for a version because you need to keep track which version range supportes the feature you are looking for (and often things are heavily patched so the version might be misleading.) Instead, we should check for the actual feature/interface required. It is a bit more work of course but usually better and much easier to maintain.



---

archive/issue_comments_277241.json:
```json
{
    "body": "<a id='comment:15'></a>Yep there is value in the autoconf approach. On the other hand, since this is mostly about doctests at this point, a version information is more useful for the user: \"oh, I need to upgrade to 3.5\" is simpler than \"oh, I need to upgrade to a recent enough version that supports method xxx on object yyy\". We could do both: make a feature check, and provide a version number for user reporting; but that's more work. Another advantage of version checking is that you just need to fetch the version once, and don't need to relaunch, e.g a GAP command, each time you want to check another feature.",
    "created_at": "2016-04-11T07:16:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277241",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:15'></a>Yep there is value in the autoconf approach. On the other hand, since this is mostly about doctests at this point, a version information is more useful for the user: "oh, I need to upgrade to 3.5" is simpler than "oh, I need to upgrade to a recent enough version that supports method xxx on object yyy". We could do both: make a feature check, and provide a version number for user reporting; but that's more work. Another advantage of version checking is that you just need to fetch the version once, and don't need to relaunch, e.g a GAP command, each time you want to check another feature.



---

archive/issue_comments_277242.json:
```json
{
    "body": "<a id='comment:16'></a>I like more the centralized approach in this ticket rather than the one in #20377 in which each feature needs a special care. Though many things looks very complicated and the related #20182 is much more readable (though using inheritance from this ticket would save some efforts). Moreover #20182 implements some *database of available features* which is not discussed here. The latter has the advantage of minimizing the requests time after the first call. With the architecture proposed here, each check involves a `Feature` class creation and some associated test...\n\nSome more specific remarks:\n\n- Do we really care about the class `FeatureTestResult`? If the result is `True` then we mostly don't care about explanation and if it is `False` we likely want an error (with an explicit error message). Similarly, I would get rid of `FeatureNotPresentError`. Instead, I would add an `error` and a `message` arguments in the `require` method (with of course some reasonable default which would mimic the current behavior using the standard `RuntimeError`).\n\n- Are you sure `CSDP` is better inside the file `lovasz_theta.py`? Do we want to spread the `Features` all around the modules or should they be centralized?\n\n- Finally class names might be confusing. `GapPackage` is not a handle on a gap package nor something describing what is inside a given package (what I would guess from the name). Similarly, with having `CSDP` has a class when `CSDP` is the name of the program. It would be fine if all of them belong to a fixed module.",
    "created_at": "2016-04-12T13:06:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277242",
    "user": "https://github.com/videlec"
}
```

<a id='comment:16'></a>I like more the centralized approach in this ticket rather than the one in #20377 in which each feature needs a special care. Though many things looks very complicated and the related #20182 is much more readable (though using inheritance from this ticket would save some efforts). Moreover #20182 implements some *database of available features* which is not discussed here. The latter has the advantage of minimizing the requests time after the first call. With the architecture proposed here, each check involves a `Feature` class creation and some associated test...

Some more specific remarks:

- Do we really care about the class `FeatureTestResult`? If the result is `True` then we mostly don't care about explanation and if it is `False` we likely want an error (with an explicit error message). Similarly, I would get rid of `FeatureNotPresentError`. Instead, I would add an `error` and a `message` arguments in the `require` method (with of course some reasonable default which would mimic the current behavior using the standard `RuntimeError`).

- Are you sure `CSDP` is better inside the file `lovasz_theta.py`? Do we want to spread the `Features` all around the modules or should they be centralized?

- Finally class names might be confusing. `GapPackage` is not a handle on a gap package nor something describing what is inside a given package (what I would guess from the name). Similarly, with having `CSDP` has a class when `CSDP` is the name of the program. It would be fine if all of them belong to a fixed module.



---

archive/issue_comments_277243.json:
```json
{
    "body": "<a id='comment:17'></a>And last but not the least: what about having the \"packages\" part directly attached to executable?\n\n```\nsage.interfaces.gap.gap.require_package('grape')\n```\ninstead of\n\n```\nsage.misc.features.GapPackage('grape').require()\n```",
    "created_at": "2016-04-12T13:11:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277243",
    "user": "https://github.com/videlec"
}
```

<a id='comment:17'></a>And last but not the least: what about having the "packages" part directly attached to executable?

```
sage.interfaces.gap.gap.require_package('grape')
```
instead of

```
sage.misc.features.GapPackage('grape').require()
```



---

archive/issue_comments_277244.json:
```json
{
    "body": "<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-04-12T13:41:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277244",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_277245.json:
```json
{
    "body": "<a id='comment:19'></a>Replying to [comment:17 vdelecroix]:\n> And last but not the least: what about having the \"packages\" part directly attached to executable?\nSure. A followup ticket could define `gap.require_package` as a call out\nto `GapPackage().require`.",
    "created_at": "2016-04-12T13:51:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277245",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:19'></a>Replying to [comment:17 vdelecroix]:
> And last but not the least: what about having the "packages" part directly attached to executable?
Sure. A followup ticket could define `gap.require_package` as a call out
to `GapPackage().require`.



---

archive/issue_comments_277246.json:
```json
{
    "body": "<a id='comment:20'></a>Replying to [comment:16 vdelecroix]:\n>  Moreover #20182 implements some *database of available features* which\n>  is not discussed here. The latter has the advantage of minimizing the\n>  requests time after the first call. With the architecture proposed here,\n>  each check involves a `Feature` class creation and some associated test...\n\nThe docstring tells you that you might want to cache the result if you think it\nis a performance problem. Most of the time you are going to call out to a\nbinary anyway so I do not see the point of caching it as a default. \"Premature\noptimization is the root of all evil\u2026\"\nWe could centralize the checks. I do not really have an opinion on that.\n\n>  - Do we really care about the class `FeatureTestResult`? If the result is\n>  `True` then we mostly don't care about explanation and if it is `False` we\n>  likely want an error (with an explicit error message).\n\nThat's what `is_present` vs `require` is about. There are places where the default algorithm is chosen depending on the\npresence of some feature.\n\n>  Similarly, I would\n>  get rid of `FeatureNotPresentError`. Instead, I would add an `error` and a\n>  `message` arguments in the `require` method (with of course some\n>  reasonable default which would mimic the current behavior using the\n>  standard `RuntimeError`).\n\nSo you have to catch whatever RuntimeError instead of being able to catch\nsomething specific? I do not see the advantage of that. Also, if I understand\nyour proposal, each caller has to cook up their own error message. I think it\nis nice to have a central place where these error messages and resolutions\nlive.\nFinally, with your approach you do not get the granularity between `abc is not\non the path` vs `abc is there but does not work`. That's something that some\npeople requested.\n\n>  - Are you sure `CSDP` is better inside the file `lovasz_theta.py`? Do we\n>  want to spread the `Features` all around the modules or should they be\n>  centralized?\n\nSee above.\n\n>  - Finally class names might be confusing. `GapPackage` is not a handle on\n>  a gap package nor something describing what is inside a given package\n>  (what I would guess from the name).\n\nGapPackage lives in sage.misc.feature. So it should be clear that this is not\nthe actual package. We can suffix everything with Feature if that is preferred.\nI prefer short class names if possible.\n\n>  Similarly, with having `CSDP` has a\n>  class when `CSDP` is the name of the program. It would be fine if all of\n>  them belong to a fixed module.\n\nSee above. (Sorry if I misunderstood you. It seems you are raising the\ncentralization vs localization issue several times in your comment.)",
    "created_at": "2016-04-12T13:51:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277246",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:20'></a>Replying to [comment:16 vdelecroix]:
>  Moreover #20182 implements some *database of available features* which
>  is not discussed here. The latter has the advantage of minimizing the
>  requests time after the first call. With the architecture proposed here,
>  each check involves a `Feature` class creation and some associated test...

The docstring tells you that you might want to cache the result if you think it
is a performance problem. Most of the time you are going to call out to a
binary anyway so I do not see the point of caching it as a default. "Premature
optimization is the root of all evil…"
We could centralize the checks. I do not really have an opinion on that.

>  - Do we really care about the class `FeatureTestResult`? If the result is
>  `True` then we mostly don't care about explanation and if it is `False` we
>  likely want an error (with an explicit error message).

That's what `is_present` vs `require` is about. There are places where the default algorithm is chosen depending on the
presence of some feature.

>  Similarly, I would
>  get rid of `FeatureNotPresentError`. Instead, I would add an `error` and a
>  `message` arguments in the `require` method (with of course some
>  reasonable default which would mimic the current behavior using the
>  standard `RuntimeError`).

So you have to catch whatever RuntimeError instead of being able to catch
something specific? I do not see the advantage of that. Also, if I understand
your proposal, each caller has to cook up their own error message. I think it
is nice to have a central place where these error messages and resolutions
live.
Finally, with your approach you do not get the granularity between `abc is not
on the path` vs `abc is there but does not work`. That's something that some
people requested.

>  - Are you sure `CSDP` is better inside the file `lovasz_theta.py`? Do we
>  want to spread the `Features` all around the modules or should they be
>  centralized?

See above.

>  - Finally class names might be confusing. `GapPackage` is not a handle on
>  a gap package nor something describing what is inside a given package
>  (what I would guess from the name).

GapPackage lives in sage.misc.feature. So it should be clear that this is not
the actual package. We can suffix everything with Feature if that is preferred.
I prefer short class names if possible.

>  Similarly, with having `CSDP` has a
>  class when `CSDP` is the name of the program. It would be fine if all of
>  them belong to a fixed module.

See above. (Sorry if I misunderstood you. It seems you are raising the
centralization vs localization issue several times in your comment.)



---

archive/issue_comments_277247.json:
```json
{
    "body": "<a id='comment:21'></a>Replying to [comment:15 nthiery]:\n> Yep there is value in the autoconf approach. On the other hand, since this is mostly about doctests at this point, a version information is more useful for the user: \"oh, I need to upgrade to 3.5\" is simpler than \"oh, I need to upgrade to a recent enough version that supports method xxx on object yyy\". We could do both: make a feature check, and provide a version number for user reporting; but that's more work. Another advantage of version checking is that you just need to fetch the version once, and don't need to relaunch, e.g a GAP command, each time you want to check another feature.\n> \nSure. Both options are valid. They are not in the scope of this ticket I\nthink. In either case, such \"features\" can easily be added to Feature.",
    "created_at": "2016-04-12T13:52:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277247",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:21'></a>Replying to [comment:15 nthiery]:
> Yep there is value in the autoconf approach. On the other hand, since this is mostly about doctests at this point, a version information is more useful for the user: "oh, I need to upgrade to 3.5" is simpler than "oh, I need to upgrade to a recent enough version that supports method xxx on object yyy". We could do both: make a feature check, and provide a version number for user reporting; but that's more work. Another advantage of version checking is that you just need to fetch the version once, and don't need to relaunch, e.g a GAP command, each time you want to check another feature.
> 
Sure. Both options are valid. They are not in the scope of this ticket I
think. In either case, such "features" can easily be added to Feature.



---

archive/issue_comments_277248.json:
```json
{
    "body": "<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-04-13T21:25:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277248",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_277249.json:
```json
{
    "body": "<a id='comment:24'></a>If I do `ls` in `sage/misc` directory and I see the file `feature.py` listed, I would never be able to guess its content. Can the filename be more verbose maybe `package_feature.py`?",
    "created_at": "2016-04-15T21:32:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277249",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:24'></a>If I do `ls` in `sage/misc` directory and I see the file `feature.py` listed, I would never be able to guess its content. Can the filename be more verbose maybe `package_feature.py`?



---

archive/issue_comments_277250.json:
```json
{
    "body": "<a id='comment:25'></a>Replying to [comment:24 slabbe]:\n> If I do `ls` in `sage/misc` directory and I see the file `feature.py` listed, I would never be able to guess its content. Can the filename be more verbose maybe `package_feature.py`?\n\n\nWould not make sense. It is not only about packages but also system softwares and libraries on the system. However, it could contains the words `dependencies` or `requirement`. I am not sure what would be the clearest.",
    "created_at": "2016-04-16T12:40:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277250",
    "user": "https://github.com/videlec"
}
```

<a id='comment:25'></a>Replying to [comment:24 slabbe]:
> If I do `ls` in `sage/misc` directory and I see the file `feature.py` listed, I would never be able to guess its content. Can the filename be more verbose maybe `package_feature.py`?


Would not make sense. It is not only about packages but also system softwares and libraries on the system. However, it could contains the words `dependencies` or `requirement`. I am not sure what would be the clearest.



---

archive/issue_comments_277251.json:
```json
{
    "body": "<a id='comment:26'></a>Maybe something like ``feature_test``? This seems to be consistent with autoconf's vocabulary.",
    "created_at": "2016-04-18T00:25:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277251",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:26'></a>Maybe something like ``feature_test``? This seems to be consistent with autoconf's vocabulary.



---

archive/issue_comments_277252.json:
```json
{
    "body": "<a id='comment:27'></a>I like `feature_test`. I will rename it to that.",
    "created_at": "2016-04-21T09:05:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277252",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:27'></a>I like `feature_test`. I will rename it to that.



---

archive/issue_comments_277253.json:
```json
{
    "body": "<a id='comment:28'></a>Hello,\n\nThis code is mostly Sage agnostic right? Would it be possible to move this code out of Sage source code? It would better be in `sage/src/sage_setup/` or whatever appropriate (even possibly an external python module). We might want to use it outside of Sage or before Sage is built to track possible dependencies.",
    "created_at": "2016-04-27T01:05:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277253",
    "user": "https://github.com/videlec"
}
```

<a id='comment:28'></a>Hello,

This code is mostly Sage agnostic right? Would it be possible to move this code out of Sage source code? It would better be in `sage/src/sage_setup/` or whatever appropriate (even possibly an external python module). We might want to use it outside of Sage or before Sage is built to track possible dependencies.



---

archive/issue_comments_277254.json:
```json
{
    "body": "<a id='comment:29'></a>As far as I am concerned `sage_setup` is only used at install time and shouldn't be used at runtime. But spinning it as a separate python package sounds like an interesting idea. Other packages could probably benefits from those mechanism.",
    "created_at": "2016-04-27T01:30:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277254",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:29'></a>As far as I am concerned `sage_setup` is only used at install time and shouldn't be used at runtime. But spinning it as a separate python package sounds like an interesting idea. Other packages could probably benefits from those mechanism.



---

archive/issue_comments_277255.json:
```json
{
    "body": "<a id='comment:30'></a>I already thought about moving parts of this out of the source tree. I have not really reached a conclusion yet. It certainly needs to be used during build time. Currently, we have `sage_setup/optional_extension.py` which calls `sage.misc.package.is_package_installed`. So, at least in a first version, I would certainly mimic this behaviour and check for a feature (in this case, whether Cython can build against a library) at build time.\n\nReplying to [comment:28 vdelecroix]:\n> This code is mostly Sage agnostic right?\n\nThe idea is Sage agnostic. The features it checks for are of course relatively Sage specific.\n\n> Would it be possible to move this code out of Sage source code? It would better be in `sage/src/sage_setup/` or whatever appropriate (even possibly an external python module). We might want to use it outside of Sage or before Sage is built to track possible dependencies.\n\nI am not sure about moving it to `sage_setup`. We need this at runtime. Can we (and should we?) access things in `sage_setup` at runtime?\nIt is an interesting idea to make it a separate package. There seems to be no python package around which does anything similar. I would be happy to pursue such a path but would like to postpone this to a followup ticket.",
    "created_at": "2016-04-27T13:31:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277255",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:30'></a>I already thought about moving parts of this out of the source tree. I have not really reached a conclusion yet. It certainly needs to be used during build time. Currently, we have `sage_setup/optional_extension.py` which calls `sage.misc.package.is_package_installed`. So, at least in a first version, I would certainly mimic this behaviour and check for a feature (in this case, whether Cython can build against a library) at build time.

Replying to [comment:28 vdelecroix]:
> This code is mostly Sage agnostic right?

The idea is Sage agnostic. The features it checks for are of course relatively Sage specific.

> Would it be possible to move this code out of Sage source code? It would better be in `sage/src/sage_setup/` or whatever appropriate (even possibly an external python module). We might want to use it outside of Sage or before Sage is built to track possible dependencies.

I am not sure about moving it to `sage_setup`. We need this at runtime. Can we (and should we?) access things in `sage_setup` at runtime?
It is an interesting idea to make it a separate package. There seems to be no python package around which does anything similar. I would be happy to pursue such a path but would like to postpone this to a followup ticket.



---

archive/issue_comments_277256.json:
```json
{
    "body": "<a id='comment:31'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-07-08T23:11:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277256",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:31'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_277257.json:
```json
{
    "body": "<a id='comment:32'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-07-09T00:19:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277257",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:32'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_277258.json:
```json
{
    "body": "<a id='comment:33'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-07-15T01:10:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277258",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:33'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_277259.json:
```json
{
    "body": "<a id='comment:34'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-07-20T02:42:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277259",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:34'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_277260.json:
```json
{
    "body": "<a id='comment:35'></a>This seems to be essentially complete now. Some docstrings are still missing and I also need to do some testing but I replaced all occurrences of `is_package_installed` if the code is just checking whether an optional package is installed.\nAny feedback is already very welcome until I find the time to polish all the docstrings.",
    "created_at": "2016-07-20T02:45:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277260",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:35'></a>This seems to be essentially complete now. Some docstrings are still missing and I also need to do some testing but I replaced all occurrences of `is_package_installed` if the code is just checking whether an optional package is installed.
Any feedback is already very welcome until I find the time to polish all the docstrings.



---

archive/issue_comments_277261.json:
```json
{
    "body": "<a id='comment:36'></a>That's really cool. I will give it a good look. I may even try it in sage-on-gentoo.",
    "created_at": "2016-07-20T02:52:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277261",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:36'></a>That's really cool. I will give it a good look. I may even try it in sage-on-gentoo.



---

archive/issue_comments_277262.json:
```json
{
    "body": "<a id='comment:37'></a>I was actually a little confused that `is_package_installed` gets used in so few places. (Or maybe `search_src` is lying about it.)",
    "created_at": "2016-07-20T04:37:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277262",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:37'></a>I was actually a little confused that `is_package_installed` gets used in so few places. (Or maybe `search_src` is lying about it.)



---

archive/issue_comments_277263.json:
```json
{
    "body": "<a id='comment:38'></a>Looks good to me. There is one last thing that I think should be done, but I wouldn't hold the ticket for it, is remove\n\n```\nfrom .package import (install_package,\n        installed_packages, is_package_installed,\n        standard_packages, optional_packages, experimental_packages,\n        upgrade, package_versions)\n```\nfrom `sage/misc/all.py` we don't really want those to be directly exposed in my opinion - and they are/were always called explicitly in sage itself.",
    "created_at": "2016-07-20T10:54:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277263",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:38'></a>Looks good to me. There is one last thing that I think should be done, but I wouldn't hold the ticket for it, is remove

```
from .package import (install_package,
        installed_packages, is_package_installed,
        standard_packages, optional_packages, experimental_packages,
        upgrade, package_versions)
```
from `sage/misc/all.py` we don't really want those to be directly exposed in my opinion - and they are/were always called explicitly in sage itself.



---

archive/issue_comments_277264.json:
```json
{
    "body": "<a id='comment:39'></a>My wish above may be best served by different ticket. Can you put this one in \"need review\".",
    "created_at": "2016-07-21T11:08:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277264",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:39'></a>My wish above may be best served by different ticket. Can you put this one in "need review".



---

archive/issue_comments_277265.json:
```json
{
    "body": "<a id='comment:40'></a>Checking availability of a Python module as you did has consequences\n\n```\nsage: def is_present(module):\n....:    import importlib\n....:    try:\n....:        importlib.import_module(module)\n....:        return True\n....:    except ImportError:\n....:        return False\nsage: print len(sys.modules), 'numpy' in sys.modules\n2625 False\nsage: is_present('numpy')\nTrue\nsage: print len(sys.modules), 'numpy' in sys.modules\n2710 True\n```\nThis would better be documented.",
    "created_at": "2016-07-22T20:34:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277265",
    "user": "https://github.com/videlec"
}
```

<a id='comment:40'></a>Checking availability of a Python module as you did has consequences

```
sage: def is_present(module):
....:    import importlib
....:    try:
....:        importlib.import_module(module)
....:        return True
....:    except ImportError:
....:        return False
sage: print len(sys.modules), 'numpy' in sys.modules
2625 False
sage: is_present('numpy')
True
sage: print len(sys.modules), 'numpy' in sys.modules
2710 True
```
This would better be documented.



---

archive/issue_comments_277266.json:
```json
{
    "body": "<a id='comment:41'></a>I would be very happy to use this ticket to solve #21135 where I need to set the octave parameters for its Sage interface depending on its version... hence I am asking whether it would be possible to have a `version` method on `Features` (or at least on `Executable`)? For executable it is reasonable to just have an attribute `_version_cmd_option` (that would generally be `-v` or `--version` or `--dumpversion`) with a default implementation that runs the command with the option `_version_cmd_option`. What do you think?",
    "created_at": "2016-08-01T14:54:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277266",
    "user": "https://github.com/videlec"
}
```

<a id='comment:41'></a>I would be very happy to use this ticket to solve #21135 where I need to set the octave parameters for its Sage interface depending on its version... hence I am asking whether it would be possible to have a `version` method on `Features` (or at least on `Executable`)? For executable it is reasonable to just have an attribute `_version_cmd_option` (that would generally be `-v` or `--version` or `--dumpversion`) with a default implementation that runs the command with the option `_version_cmd_option`. What do you think?



---

archive/issue_comments_277267.json:
```json
{
    "body": "<a id='comment:42'></a>Note also that for interfaces we allow remote programs with possibly subtle commands (see #20388 and the file `sage/interfaces/expect.py`). For example, I can access magma and get it work within sage by doing\n\n```\n$ SAGE_MAGMA_COMMAND=\"module load magma/2.11.13; magma\"\n$ SAGE_MAGMA_SERVER=\"plafrim\"\n$ export SAGE_MAGMA_COMMAND SAGE_MAGMA_SERVER\n$ sage -q\nsage: magma('1+1')\n2\n```\nDoes a magma feature should take care of this?",
    "created_at": "2016-08-01T15:03:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277267",
    "user": "https://github.com/videlec"
}
```

<a id='comment:42'></a>Note also that for interfaces we allow remote programs with possibly subtle commands (see #20388 and the file `sage/interfaces/expect.py`). For example, I can access magma and get it work within sage by doing

```
$ SAGE_MAGMA_COMMAND="module load magma/2.11.13; magma"
$ SAGE_MAGMA_SERVER="plafrim"
$ export SAGE_MAGMA_COMMAND SAGE_MAGMA_SERVER
$ sage -q
sage: magma('1+1')
2
```
Does a magma feature should take care of this?



---

archive/issue_comments_277268.json:
```json
{
    "body": "<a id='comment:43'></a>Replying to [comment:41 vdelecroix]:\n> I would be very happy to use this ticket to solve #21135 where I need to set the octave parameters for its Sage interface depending on its version...\n\nIt would be great to see somebody use this interface already :)\nI have completing this Ticket high on my priority list. I hope I find the time to do this soon.\n\n> hence I am asking whether it would be possible to have a `version` method on `Features` (or at least on `Executable`)? For executable it is reasonable to just have an attribute `_version_cmd_option` (that would generally be `-v` or `--version` or `--dumpversion`) with a default implementation that runs the command with the option `_version_cmd_option`. What do you think?\n\n\nSometimes version checking is a good thing to do but I generally follow the autoconf tradition here that sees version numbers as something very unreliable. I think you should check whether the executable provides the interface that you need.\n\nSo, I would be reluctant to provide a general interface for version checks. I should certainly add a comment about this somewhere. Anyway, you can extend any Feature. To check for a version you might want to roughly do something like what I did for `StaticFile.absolute_path`.",
    "created_at": "2016-08-01T22:32:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277268",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:43'></a>Replying to [comment:41 vdelecroix]:
> I would be very happy to use this ticket to solve #21135 where I need to set the octave parameters for its Sage interface depending on its version...

It would be great to see somebody use this interface already :)
I have completing this Ticket high on my priority list. I hope I find the time to do this soon.

> hence I am asking whether it would be possible to have a `version` method on `Features` (or at least on `Executable`)? For executable it is reasonable to just have an attribute `_version_cmd_option` (that would generally be `-v` or `--version` or `--dumpversion`) with a default implementation that runs the command with the option `_version_cmd_option`. What do you think?


Sometimes version checking is a good thing to do but I generally follow the autoconf tradition here that sees version numbers as something very unreliable. I think you should check whether the executable provides the interface that you need.

So, I would be reluctant to provide a general interface for version checks. I should certainly add a comment about this somewhere. Anyway, you can extend any Feature. To check for a version you might want to roughly do something like what I did for `StaticFile.absolute_path`.



---

archive/issue_comments_277269.json:
```json
{
    "body": "<a id='comment:44'></a>Replying to [comment:42 vdelecroix]:\n> Note also that for interfaces we allow remote programs with possibly subtle commands (see #20388 and the file `sage/interfaces/expect.py`). For example, I can access magma and get it work within sage by doing\n> \n> ```\n> $ SAGE_MAGMA_COMMAND=\"module load magma/2.11.13; magma\"\n> $ SAGE_MAGMA_SERVER=\"plafrim\"\n> $ export SAGE_MAGMA_COMMAND SAGE_MAGMA_SERVER\n> $ sage -q\n> sage: magma('1+1')\n> 2\n> ```\n> Does a magma feature should take care of this?\n\n\nSorry, but I am not sure whether I understand your question. Do you mean whether a `Magma` Feature should look at `SAGE_MAGMA_COMMAND` and `SAGE_MAGMA_SERVER`? Yes, absolutely.",
    "created_at": "2016-08-01T22:33:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277269",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:44'></a>Replying to [comment:42 vdelecroix]:
> Note also that for interfaces we allow remote programs with possibly subtle commands (see #20388 and the file `sage/interfaces/expect.py`). For example, I can access magma and get it work within sage by doing
> 
> ```
> $ SAGE_MAGMA_COMMAND="module load magma/2.11.13; magma"
> $ SAGE_MAGMA_SERVER="plafrim"
> $ export SAGE_MAGMA_COMMAND SAGE_MAGMA_SERVER
> $ sage -q
> sage: magma('1+1')
> 2
> ```
> Does a magma feature should take care of this?


Sorry, but I am not sure whether I understand your question. Do you mean whether a `Magma` Feature should look at `SAGE_MAGMA_COMMAND` and `SAGE_MAGMA_SERVER`? Yes, absolutely.



---

archive/issue_comments_277270.json:
```json
{
    "body": "<a id='comment:45'></a>Replying to [comment:44 saraedum]:\n> Replying to [comment:42 vdelecroix]:\n> > Note also that for interfaces we allow remote programs with possibly subtle commands (see #20388 and the file `sage/interfaces/expect.py`). For example, I can access magma and get it work within sage by doing\n> > \n> > ```\n> > $ SAGE_MAGMA_COMMAND=\"module load magma/2.11.13; magma\"\n> > $ SAGE_MAGMA_SERVER=\"plafrim\"\n> > $ export SAGE_MAGMA_COMMAND SAGE_MAGMA_SERVER\n> > $ sage -q\n> > sage: magma('1+1')\n> > 2\n> > ```\n> > Does a magma feature should take care of this?\n\n> \n> Sorry, but I am not sure whether I understand your question. Do you mean whether a `Magma` Feature should look at `SAGE_MAGMA_COMMAND` and `SAGE_MAGMA_SERVER`? Yes, absolutely.\n\n\nYes. That was mostly the question ;-) There are some interferences between the branch provided here and how software are detected (and configured) in `sage/interfaces/`. This should be done in one place and I guess features is the right one.",
    "created_at": "2016-08-01T22:36:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277270",
    "user": "https://github.com/videlec"
}
```

<a id='comment:45'></a>Replying to [comment:44 saraedum]:
> Replying to [comment:42 vdelecroix]:
> > Note also that for interfaces we allow remote programs with possibly subtle commands (see #20388 and the file `sage/interfaces/expect.py`). For example, I can access magma and get it work within sage by doing
> > 
> > ```
> > $ SAGE_MAGMA_COMMAND="module load magma/2.11.13; magma"
> > $ SAGE_MAGMA_SERVER="plafrim"
> > $ export SAGE_MAGMA_COMMAND SAGE_MAGMA_SERVER
> > $ sage -q
> > sage: magma('1+1')
> > 2
> > ```
> > Does a magma feature should take care of this?

> 
> Sorry, but I am not sure whether I understand your question. Do you mean whether a `Magma` Feature should look at `SAGE_MAGMA_COMMAND` and `SAGE_MAGMA_SERVER`? Yes, absolutely.


Yes. That was mostly the question ;-) There are some interferences between the branch provided here and how software are detected (and configured) in `sage/interfaces/`. This should be done in one place and I guess features is the right one.



---

archive/issue_comments_277271.json:
```json
{
    "body": "<a id='comment:46'></a>Replying to [comment:43 saraedum]:\n> Replying to [comment:41 vdelecroix]:\n> > [...]\n\n> \n> Sometimes version checking is a good thing to do but I generally follow the autoconf tradition here that sees version numbers as something very unreliable. I think you should check whether the executable provides the interface that you need.\n\n\nArgh. I do not see how I can check that `octave` does not launch the GUI... I can check whether `octave --no-gui` is available. If octave does not exist I got a `OSError` and if it does not accept `--no-gui` I get a `1` return code. Is that what I should do? Does that should be part of an `Octave` feature?",
    "created_at": "2016-08-01T22:39:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277271",
    "user": "https://github.com/videlec"
}
```

<a id='comment:46'></a>Replying to [comment:43 saraedum]:
> Replying to [comment:41 vdelecroix]:
> > [...]

> 
> Sometimes version checking is a good thing to do but I generally follow the autoconf tradition here that sees version numbers as something very unreliable. I think you should check whether the executable provides the interface that you need.


Argh. I do not see how I can check that `octave` does not launch the GUI... I can check whether `octave --no-gui` is available. If octave does not exist I got a `OSError` and if it does not accept `--no-gui` I get a `1` return code. Is that what I should do? Does that should be part of an `Octave` feature?



---

archive/issue_comments_277272.json:
```json
{
    "body": "<a id='comment:47'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-04T05:25:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277272",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:47'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_277273.json:
```json
{
    "body": "<a id='comment:48'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-17T04:41:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277273",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:48'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_277274.json:
```json
{
    "body": "<a id='comment:49'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-17T04:52:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277274",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:49'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_277275.json:
```json
{
    "body": "<a id='comment:50'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-18T03:39:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277275",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:50'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_277276.json:
```json
{
    "body": "<a id='comment:51'></a>Replying to [comment:2 fbissey]:\n> [...] Do I understand well that you need an executable class for any external binaries that you want to call?\n\nIts up to you. You can create a new class and make it easier for others to use or you could just write `Executable(...).require()` to check for an executable in one place.",
    "created_at": "2016-08-18T03:44:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277276",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:51'></a>Replying to [comment:2 fbissey]:
> [...] Do I understand well that you need an executable class for any external binaries that you want to call?

Its up to you. You can create a new class and make it easier for others to use or you could just write `Executable(...).require()` to check for an executable in one place.



---

archive/issue_comments_277277.json:
```json
{
    "body": "<a id='comment:52'></a>Replying to [comment:6 fbissey]:\n> Handling of `database_gap` will be delicate. The spkg includes bits removed stuff from `gap` that are expected by default (no need to load if present) and one \"real\" gap package that one would need to load (`tomlib`). \n\nI tried to check for the package that was actually needed whenever the old code queried the `gap_packages` SPKG. I am not sure I fully understand your comment here. Could you point me to an example in the code where this is a problem?",
    "created_at": "2016-08-18T03:46:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277277",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:52'></a>Replying to [comment:6 fbissey]:
> Handling of `database_gap` will be delicate. The spkg includes bits removed stuff from `gap` that are expected by default (no need to load if present) and one "real" gap package that one would need to load (`tomlib`). 

I tried to check for the package that was actually needed whenever the old code queried the `gap_packages` SPKG. I am not sure I fully understand your comment here. Could you point me to an example in the code where this is a problem?



---

archive/issue_comments_277278.json:
```json
{
    "body": "<a id='comment:53'></a>Replying to [comment:9 fbissey]:\n> Going through the files that I have changed in #20377 which this ticket should supersede:\n> * `sage/databases/cremona.py` we need to check the real presence of a file in a specific location in this case. Adding something to feature may be overkill for that particular case.\n\n`sage/databases/cremona.py` loads the cremona DB from a very specific place, namely `SAGE_SHARE`. This is certainly not ideal. But making that code more flexible should imho go into a followup ticket. Should I create one?\n>  * `sage/game_theory/normal_form_game.py` + `sage/geometry/polyhedron/base.py` look for the `lrs` executable\n \nAddressed with the `Lrs` feature.\n>  * `sage/graphs/generators/classical_geometries.py` already covered in this ticket\n>  * `sage/graphs/generic_graph.py` I think my stuff should stay. It is mostly straight `try...expect` whether or not a python module is available.\n \nI am checking this now with a `PythonModule` feature.\n>  * `sage/graphs/graph_generators.py` 3 different executables to detect\n \nI am checking for these executables (and run them on trivial inputs.)\n>  * `sage/graphs/lovasz_theta.py` covered here\n>  * `sage/groups/generic.py` possibly detect if gap package tomlib is present\n \nI am checking for the presence of the small groups library. Is that the same somehow?\n>  * `sage/groups/perm_gps/permgroup.py` again dodgy database_gap detection in one part. The part using the gap `hap` package would need a nice rework not just migration. I'd like to pick the mind of the person who wrote this.\n \nI am checking for the hap package here. Is there anything else that should happen?\n>  * `sage/misc/all.py` my stuff should stay. It is removal of `import` no one uses.\n \nSure. But I am not addressing this here.\n>  * `sage/rings/polynomial/multi_polynomial_sequence.py` finding one executable\n \nActually you need to check for the presence of the fes library. Not only that but also whether the sage interface to that library has been built (which only happens if sage can find the library, i.e., SPKG at build time.)",
    "created_at": "2016-08-18T03:54:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277278",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:53'></a>Replying to [comment:9 fbissey]:
> Going through the files that I have changed in #20377 which this ticket should supersede:
> * `sage/databases/cremona.py` we need to check the real presence of a file in a specific location in this case. Adding something to feature may be overkill for that particular case.

`sage/databases/cremona.py` loads the cremona DB from a very specific place, namely `SAGE_SHARE`. This is certainly not ideal. But making that code more flexible should imho go into a followup ticket. Should I create one?
>  * `sage/game_theory/normal_form_game.py` + `sage/geometry/polyhedron/base.py` look for the `lrs` executable
 
Addressed with the `Lrs` feature.
>  * `sage/graphs/generators/classical_geometries.py` already covered in this ticket
>  * `sage/graphs/generic_graph.py` I think my stuff should stay. It is mostly straight `try...expect` whether or not a python module is available.
 
I am checking this now with a `PythonModule` feature.
>  * `sage/graphs/graph_generators.py` 3 different executables to detect
 
I am checking for these executables (and run them on trivial inputs.)
>  * `sage/graphs/lovasz_theta.py` covered here
>  * `sage/groups/generic.py` possibly detect if gap package tomlib is present
 
I am checking for the presence of the small groups library. Is that the same somehow?
>  * `sage/groups/perm_gps/permgroup.py` again dodgy database_gap detection in one part. The part using the gap `hap` package would need a nice rework not just migration. I'd like to pick the mind of the person who wrote this.
 
I am checking for the hap package here. Is there anything else that should happen?
>  * `sage/misc/all.py` my stuff should stay. It is removal of `import` no one uses.
 
Sure. But I am not addressing this here.
>  * `sage/rings/polynomial/multi_polynomial_sequence.py` finding one executable
 
Actually you need to check for the presence of the fes library. Not only that but also whether the sage interface to that library has been built (which only happens if sage can find the library, i.e., SPKG at build time.)



---

archive/issue_comments_277279.json:
```json
{
    "body": "<a id='comment:54'></a>Replying to [comment:15 nthiery]:\n> Yep there is value in the autoconf approach. On the other hand, since this is mostly about doctests at this point, a version information is more useful for the user: \"oh, I need to upgrade to 3.5\" is simpler than \"oh, I need to upgrade to a recent enough version that supports method xxx on object yyy\". We could do both: make a feature check, and provide a version number for user reporting; but that's more work.\n\nThat's the approach I would like to follow. Currently there is no code like this in here because I am just replacing `is_package_installed` which also did not do any version checks. But, yes, people should check for a certain feature of a package and then the `reason` of a test failure should say \"Your X does not support Y.\" and the `resolution` should say \"You need at least version Z of X. Try sage -i X to fix this.\" or something along these lines.",
    "created_at": "2016-08-18T04:00:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277279",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:54'></a>Replying to [comment:15 nthiery]:
> Yep there is value in the autoconf approach. On the other hand, since this is mostly about doctests at this point, a version information is more useful for the user: "oh, I need to upgrade to 3.5" is simpler than "oh, I need to upgrade to a recent enough version that supports method xxx on object yyy". We could do both: make a feature check, and provide a version number for user reporting; but that's more work.

That's the approach I would like to follow. Currently there is no code like this in here because I am just replacing `is_package_installed` which also did not do any version checks. But, yes, people should check for a certain feature of a package and then the `reason` of a test failure should say "Your X does not support Y." and the `resolution` should say "You need at least version Z of X. Try sage -i X to fix this." or something along these lines.



---

archive/issue_comments_277280.json:
```json
{
    "body": "<a id='comment:57'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-18T04:13:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277280",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:57'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_277281.json:
```json
{
    "body": "<a id='comment:58'></a>Replying to [comment:40 vdelecroix]:\n> Checking availability of a Python module as you did has consequences\n> \n> ```\n> sage: def is_present(module):\n> ....:    import importlib\n> ....:    try:\n> ....:        importlib.import_module(module)\n> ....:        return True\n> ....:    except ImportError:\n> ....:        return False\n> sage: print len(sys.modules), 'numpy' in sys.modules\n> 2625 False\n> sage: is_present('numpy')\n> True\n> sage: print len(sys.modules), 'numpy' in sys.modules\n> 2710 True\n> ```\n> This would better be documented.\n\nYou are right. I documented that.",
    "created_at": "2016-08-18T04:14:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277281",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:58'></a>Replying to [comment:40 vdelecroix]:
> Checking availability of a Python module as you did has consequences
> 
> ```
> sage: def is_present(module):
> ....:    import importlib
> ....:    try:
> ....:        importlib.import_module(module)
> ....:        return True
> ....:    except ImportError:
> ....:        return False
> sage: print len(sys.modules), 'numpy' in sys.modules
> 2625 False
> sage: is_present('numpy')
> True
> sage: print len(sys.modules), 'numpy' in sys.modules
> 2710 True
> ```
> This would better be documented.

You are right. I documented that.



---

archive/issue_comments_277282.json:
```json
{
    "body": "<a id='comment:59'></a>Replying to [comment:46 vdelecroix]:\n> Replying to [comment:43 saraedum]:\n> > Replying to [comment:41 vdelecroix]:\n> > > [...]\n\n> > \n> > Sometimes version checking is a good thing to do but I generally follow the autoconf tradition here that sees version numbers as something very unreliable. I think you should check whether the executable provides the interface that you need.\n\n> \n> Argh. I do not see how I can check that `octave` does not launch the GUI... I can check whether `octave --no-gui` is available. If octave does not exist I got a `OSError` and if it does not accept `--no-gui` I get a `1` return code. Is that what I should do? Does that should be part of an `Octave` feature?\n  \nI have a feeling that I already answered this one. But apparently I have not.\nI would write an `Octave` feature that checks whether there is an `octave` binary and then checks whether it accepts `--no-gui`. Sort of like `StaticFile` has an `absolute_path()` that tells you something about how this feature works, `Octave` could expose information about which parameters are needed to actually invoke it so it reads from stdin.",
    "created_at": "2016-08-18T04:21:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277282",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:59'></a>Replying to [comment:46 vdelecroix]:
> Replying to [comment:43 saraedum]:
> > Replying to [comment:41 vdelecroix]:
> > > [...]

> > 
> > Sometimes version checking is a good thing to do but I generally follow the autoconf tradition here that sees version numbers as something very unreliable. I think you should check whether the executable provides the interface that you need.

> 
> Argh. I do not see how I can check that `octave` does not launch the GUI... I can check whether `octave --no-gui` is available. If octave does not exist I got a `OSError` and if it does not accept `--no-gui` I get a `1` return code. Is that what I should do? Does that should be part of an `Octave` feature?
  
I have a feeling that I already answered this one. But apparently I have not.
I would write an `Octave` feature that checks whether there is an `octave` binary and then checks whether it accepts `--no-gui`. Sort of like `StaticFile` has an `absolute_path()` that tells you something about how this feature works, `Octave` could expose information about which parameters are needed to actually invoke it so it reads from stdin.



---

archive/issue_comments_277283.json:
```json
{
    "body": "<a id='comment:60'></a>I hope I addressed all comments on this ticket. I did not have a chance to run all doctests yet (my sage 7.4 is still building) but essentially this is ready for review now.",
    "created_at": "2016-08-18T04:23:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277283",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:60'></a>I hope I addressed all comments on this ticket. I did not have a chance to run all doctests yet (my sage 7.4 is still building) but essentially this is ready for review now.



---

archive/issue_comments_277284.json:
```json
{
    "body": "<a id='comment:62'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-18T04:40:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277284",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:62'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_277285.json:
```json
{
    "body": "<a id='comment:63'></a>New commits:\n|                                                                                                                                          |                                             |\n|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------|\n|[0529637](https://git.sagemath.org/sage.git/commit?id=052963745bf9de80896ca216c41716f777e87fc8)|`Reordered classes in sage.misc.feature_test`|\n|[6f2d596](https://git.sagemath.org/sage.git/commit?id=6f2d596f9445a8bf5e9b8d8b2f73155c4dd42872)|`Fixed doctests which failed because of the feature -> feature_test renaming`|\n|[edd4f6e](https://git.sagemath.org/sage.git/commit?id=edd4f6ed42b58f9b8b88e6349b0439ea7fbc3447)|`add missing sig_off to doctest`|\n---\nNew commits:",
    "created_at": "2016-08-18T04:40:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277285",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:63'></a>New commits:
|                                                                                                                                          |                                             |
|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------|
|[0529637](https://git.sagemath.org/sage.git/commit?id=052963745bf9de80896ca216c41716f777e87fc8)|`Reordered classes in sage.misc.feature_test`|
|[6f2d596](https://git.sagemath.org/sage.git/commit?id=6f2d596f9445a8bf5e9b8d8b2f73155c4dd42872)|`Fixed doctests which failed because of the feature -> feature_test renaming`|
|[edd4f6e](https://git.sagemath.org/sage.git/commit?id=edd4f6ed42b58f9b8b88e6349b0439ea7fbc3447)|`add missing sig_off to doctest`|
---
New commits:



---

archive/issue_comments_277286.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-08-18T04:40:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277286",
    "user": "https://github.com/saraedum"
}
```

Changing status from new to needs_review.



---

archive/issue_events_055208.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2016-08-22T06:23:16Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "milestone": "sage-7.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20382#event-55208"
}
```



---

archive/issue_comments_277287.json:
```json
{
    "body": "<a id='comment:65'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-25T18:55:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277287",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:65'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_277288.json:
```json
{
    "body": "<a id='comment:66'></a>Since `is_package_installed` is very sage (the distribution) specific, it causes trouble for package managers which would like to refer to check whether a package is available on the local system instead of whether it has been installed with `sage -i` (or similar.)\nThis replaces all occurrences of `is_package_installed` (which are not part of sage the distribution) with a \"feature\" check which is performed much in the spirit of autoconf: check for the presence of the features needed, not for version numbers.\nThese checks are certainly not perfect yet and will need to evolve over time.",
    "created_at": "2016-08-25T19:02:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277288",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:66'></a>Since `is_package_installed` is very sage (the distribution) specific, it causes trouble for package managers which would like to refer to check whether a package is available on the local system instead of whether it has been installed with `sage -i` (or similar.)
This replaces all occurrences of `is_package_installed` (which are not part of sage the distribution) with a "feature" check which is performed much in the spirit of autoconf: check for the presence of the features needed, not for version numbers.
These checks are certainly not perfect yet and will need to evolve over time.



---

archive/issue_comments_277289.json:
```json
{
    "body": "<a id='comment:67'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-25T19:50:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277289",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:67'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_277290.json:
```json
{
    "body": "<a id='comment:68'></a>Needs to be merged with Sage 7.4.beta2.",
    "created_at": "2016-08-26T11:43:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277290",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:68'></a>Needs to be merged with Sage 7.4.beta2.



---

archive/issue_comments_277291.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-08-26T11:43:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277291",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_277292.json:
```json
{
    "body": "<a id='comment:69'></a>For `OptionalModule`, you should separate the library check from the Python module check. They really are independent things. It just happens that there is essentially a one-to-one correspondence in Sage, but that doesn't have to be the case.\n\nAnd once you do this, you can use the library check in `src/sage_setup/optional_extension.py` to decide which optional extensions to build.",
    "created_at": "2016-08-26T11:53:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277292",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:69'></a>For `OptionalModule`, you should separate the library check from the Python module check. They really are independent things. It just happens that there is essentially a one-to-one correspondence in Sage, but that doesn't have to be the case.

And once you do this, you can use the library check in `src/sage_setup/optional_extension.py` to decide which optional extensions to build.



---

archive/issue_comments_277293.json:
```json
{
    "body": "<a id='comment:70'></a>The changes to `src/sage/misc/cython.py` might make sense but do not belong to this ticket.",
    "created_at": "2016-08-26T12:13:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277293",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:70'></a>The changes to `src/sage/misc/cython.py` might make sense but do not belong to this ticket.



---

archive/issue_comments_277294.json:
```json
{
    "body": "<a id='comment:71'></a>I must say to me in sage-on-gentoo the fact that the current `OptionalModule` only require presence to build the extension is problematic but I don't expect a solution to that particular aspect in the near future.\nIn effect the fact that you only check for presence/availability as a signal for building is introducing automagic dependencies.\n\nI currently have a variable mechanism to signal that the dependency should be present and I want to build. A `setup.cfg` could be a viable solution. I realise that it would be a burden in the current sage model in the short term.",
    "created_at": "2016-08-26T12:14:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277294",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:71'></a>I must say to me in sage-on-gentoo the fact that the current `OptionalModule` only require presence to build the extension is problematic but I don't expect a solution to that particular aspect in the near future.
In effect the fact that you only check for presence/availability as a signal for building is introducing automagic dependencies.

I currently have a variable mechanism to signal that the dependency should be present and I want to build. A `setup.cfg` could be a viable solution. I realise that it would be a burden in the current sage model in the short term.



---

archive/issue_comments_277295.json:
```json
{
    "body": "<a id='comment:72'></a>Replying to [comment:71 fbissey]:\n> I must say to me in sage-on-gentoo the fact that the current `OptionalModule` only require presence to build the extension is problematic but I don't expect a solution to that particular aspect in the near future.\n\n\nIdeally, Sage should have something like Gentoo's `USE` flags for optional dependencies...",
    "created_at": "2016-08-26T12:16:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277295",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:72'></a>Replying to [comment:71 fbissey]:
> I must say to me in sage-on-gentoo the fact that the current `OptionalModule` only require presence to build the extension is problematic but I don't expect a solution to that particular aspect in the near future.


Ideally, Sage should have something like Gentoo's `USE` flags for optional dependencies...



---

archive/issue_comments_277296.json:
```json
{
    "body": "<a id='comment:74'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-09-01T20:11:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277296",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:74'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_277297.json:
```json
{
    "body": "<a id='comment:75'></a>Replying to [comment:69 jdemeyer]:\n> For `OptionalModule`, you should separate the library check from the Python module check. They really are independent things. It just happens that there is essentially a one-to-one correspondence  in Sage, but that doesn't have to be the case.\nOk. I am splitting this up.\n\n> And once you do this, you can use the library check in `src/sage_setup/optional_extension.py` to decide which optional extensions to build.\n\nThat would be a followup ticket I believe.",
    "created_at": "2016-09-01T20:19:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277297",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:75'></a>Replying to [comment:69 jdemeyer]:
> For `OptionalModule`, you should separate the library check from the Python module check. They really are independent things. It just happens that there is essentially a one-to-one correspondence  in Sage, but that doesn't have to be the case.
Ok. I am splitting this up.

> And once you do this, you can use the library check in `src/sage_setup/optional_extension.py` to decide which optional extensions to build.

That would be a followup ticket I believe.



---

archive/issue_comments_277298.json:
```json
{
    "body": "<a id='comment:76'></a>Replying to [comment:70 jdemeyer]:\n> The changes to `src/sage/misc/cython.py` might make sense but do not belong to this ticket.\n\nI'd prefer to sneak this change in here. The shared library test code in here actually tests that this does the right thing and I'd prefer not to write some constructed doctest for something like this.",
    "created_at": "2016-09-01T21:21:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277298",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:76'></a>Replying to [comment:70 jdemeyer]:
> The changes to `src/sage/misc/cython.py` might make sense but do not belong to this ticket.

I'd prefer to sneak this change in here. The shared library test code in here actually tests that this does the right thing and I'd prefer not to write some constructed doctest for something like this.



---

archive/issue_comments_277299.json:
```json
{
    "body": "<a id='comment:77'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-09-01T21:22:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277299",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:77'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_277300.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-09-01T21:28:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277300",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_277301.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-09-01T21:36:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277301",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_277302.json:
```json
{
    "body": "<a id='comment:79'></a>Sorry, but it will need rebasing against #21289 which is already merged for the next beta.",
    "created_at": "2016-09-01T21:36:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277302",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:79'></a>Sorry, but it will need rebasing against #21289 which is already merged for the next beta.



---

archive/issue_comments_277303.json:
```json
{
    "body": "<a id='comment:80'></a>Replying to [comment:75 saraedum]:\n> Replying to [comment:69 jdemeyer]:\n> > For `OptionalModule`, you should separate the library check from the Python module check. They really are independent things. It just happens that there is essentially a one-to-one correspondence  in Sage, but that doesn't have to be the case.\n\n> Ok. I am splitting this up.\n\nWell, I meant *really* splitting those it up: get rid of `OptionalModule` altogether and replace it by `Module`. And remove the dependencies: if the dependencies are not satisfied, the module will not import. There is no need for an additional check.\n\n> > And once you do this, you can use the library check in `src/sage_setup/optional_extension.py` to decide which optional extensions to build.\n\n> That would be a followup ticket I believe.\n\nFair enough.",
    "created_at": "2016-09-02T12:24:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277303",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:80'></a>Replying to [comment:75 saraedum]:
> Replying to [comment:69 jdemeyer]:
> > For `OptionalModule`, you should separate the library check from the Python module check. They really are independent things. It just happens that there is essentially a one-to-one correspondence  in Sage, but that doesn't have to be the case.

> Ok. I am splitting this up.

Well, I meant *really* splitting those it up: get rid of `OptionalModule` altogether and replace it by `Module`. And remove the dependencies: if the dependencies are not satisfied, the module will not import. There is no need for an additional check.

> > And once you do this, you can use the library check in `src/sage_setup/optional_extension.py` to decide which optional extensions to build.

> That would be a followup ticket I believe.

Fair enough.



---

archive/issue_comments_277304.json:
```json
{
    "body": "<a id='comment:81'></a>Replying to [comment:80 jdemeyer]:\n> Replying to [comment:75 saraedum]:\n> > Replying to [comment:69 jdemeyer]:\n> > > For `OptionalModule`, you should separate the library check from the Python module check. They really are independent things. It just happens that there is essentially a one-to-one correspondence  in Sage, but that doesn't have to be the case.\n\n> > Ok. I am splitting this up.\n> \n> Well, I meant *really* splitting those it up: get rid of `OptionalModule` altogether and replace it by `Module`. And remove the dependencies: if the dependencies are not satisfied, the module will not import. There is no need for an additional check.\n\nSure, the check is not necessary. But I would like to tell people what is the problem here. In that particular case, the module also would not import but that's more obscure than telling people that the required library is missing. More generally, an `OptionalModule` checks whether the module imports and is functional. Running some tests to make sure that the underlying library is working properly is a reasonable thing to do imho.",
    "created_at": "2016-09-08T01:28:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277304",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:81'></a>Replying to [comment:80 jdemeyer]:
> Replying to [comment:75 saraedum]:
> > Replying to [comment:69 jdemeyer]:
> > > For `OptionalModule`, you should separate the library check from the Python module check. They really are independent things. It just happens that there is essentially a one-to-one correspondence  in Sage, but that doesn't have to be the case.

> > Ok. I am splitting this up.
> 
> Well, I meant *really* splitting those it up: get rid of `OptionalModule` altogether and replace it by `Module`. And remove the dependencies: if the dependencies are not satisfied, the module will not import. There is no need for an additional check.

Sure, the check is not necessary. But I would like to tell people what is the problem here. In that particular case, the module also would not import but that's more obscure than telling people that the required library is missing. More generally, an `OptionalModule` checks whether the module imports and is functional. Running some tests to make sure that the underlying library is working properly is a reasonable thing to do imho.



---

archive/issue_comments_277305.json:
```json
{
    "body": "<a id='comment:82'></a>Replying to [comment:81 saraedum]:\n> But I would like to tell people what is the problem here.\n\n\nThe problem is that they need to install the optional Sage package. That's what you should tell.\n\n> In that particular case, the module also would not import but that's more obscure than telling people that the required library is missing.\n\n\nBut the `OptionalModule` machine checks whether the optional Sage package is installed. Having the library available from the OS would not help.\n\n> Running some tests to make sure that the underlying library is working properly is a reasonable thing to do imho.\n\n\nI don't like to put the same information in different places. That way, you will eventually end up with inconsistencies. The information that the module needs the library should be in exactly one place, namely the build system which decides when the module is compiled.",
    "created_at": "2016-09-08T06:10:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277305",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:82'></a>Replying to [comment:81 saraedum]:
> But I would like to tell people what is the problem here.


The problem is that they need to install the optional Sage package. That's what you should tell.

> In that particular case, the module also would not import but that's more obscure than telling people that the required library is missing.


But the `OptionalModule` machine checks whether the optional Sage package is installed. Having the library available from the OS would not help.

> Running some tests to make sure that the underlying library is working properly is a reasonable thing to do imho.


I don't like to put the same information in different places. That way, you will eventually end up with inconsistencies. The information that the module needs the library should be in exactly one place, namely the build system which decides when the module is compiled.



---

archive/issue_comments_277306.json:
```json
{
    "body": "<a id='comment:83'></a>Replying to [comment:82 jdemeyer]:\n> Replying to [comment:81 saraedum]:\n> > But I would like to tell people what is the problem here.\n\n> \n> The problem is that they need to install the optional Sage package. That's what you should tell.\n> \n> > In that particular case, the module also would not import but that's more obscure than telling people that the required library is missing.\n\n> \n> But the `OptionalModule` machine checks whether the optional Sage package is installed. Having the library available from the OS would not help.\n> \n\n\nIndeed. The current build system assumes that if the package is installed it is because I explicitly want it in sage. It is a long standing convention which from where I sit on the outside is called automagic detection. The reality is that it belongs to configuration space (with availability checking - autoconf style). Sure it is possibly more risky to use an outside package but if it satisfy the availability checking, why not?\n\nAfter all, at least some of us want to push sage down that way. \n\nAlso note that for executables `Features` only cares about availability in the path, from sage or not (as it should as far as I am concerned). So not caring whether it is from sage or not is in spirit. \n\nI'll admit to have a bias since I want most of `sage/misc/package.py` to be gone with a top priority on `is_package_installed` in particular.",
    "created_at": "2016-09-08T07:28:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277306",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:83'></a>Replying to [comment:82 jdemeyer]:
> Replying to [comment:81 saraedum]:
> > But I would like to tell people what is the problem here.

> 
> The problem is that they need to install the optional Sage package. That's what you should tell.
> 
> > In that particular case, the module also would not import but that's more obscure than telling people that the required library is missing.

> 
> But the `OptionalModule` machine checks whether the optional Sage package is installed. Having the library available from the OS would not help.
> 


Indeed. The current build system assumes that if the package is installed it is because I explicitly want it in sage. It is a long standing convention which from where I sit on the outside is called automagic detection. The reality is that it belongs to configuration space (with availability checking - autoconf style). Sure it is possibly more risky to use an outside package but if it satisfy the availability checking, why not?

After all, at least some of us want to push sage down that way. 

Also note that for executables `Features` only cares about availability in the path, from sage or not (as it should as far as I am concerned). So not caring whether it is from sage or not is in spirit. 

I'll admit to have a bias since I want most of `sage/misc/package.py` to be gone with a top priority on `is_package_installed` in particular.



---

archive/issue_comments_277307.json:
```json
{
    "body": "<a id='comment:84'></a>Replying to [comment:83 fbissey]:\n> The reality is that it belongs to configuration space (with availability checking - autoconf style). Sure it is possibly more risky to use an outside package but if it satisfy the availability checking, why not?\n\n\nI'm not disagreeing with that. However, it is besides the point. This ticket should implement the current reality, not some future plan.",
    "created_at": "2016-09-08T07:33:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277307",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:84'></a>Replying to [comment:83 fbissey]:
> The reality is that it belongs to configuration space (with availability checking - autoconf style). Sure it is possibly more risky to use an outside package but if it satisfy the availability checking, why not?


I'm not disagreeing with that. However, it is besides the point. This ticket should implement the current reality, not some future plan.



---

archive/issue_comments_277308.json:
```json
{
    "body": "<a id='comment:85'></a>I don't think `feature` can replace the current reality of what happens in `OptionalExtension`. It should be strictly future work. I am OK for it to be left as is until we decide it is time to move.",
    "created_at": "2016-09-08T07:42:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277308",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:85'></a>I don't think `feature` can replace the current reality of what happens in `OptionalExtension`. It should be strictly future work. I am OK for it to be left as is until we decide it is time to move.



---

archive/issue_comments_277309.json:
```json
{
    "body": "<a id='comment:86'></a>I guess if building and possibly documentation are the only place left using stuff from `package.py` it could be moved to `sage_setup` where things not needed at run-time belongs in my opinion.",
    "created_at": "2016-09-08T08:11:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277309",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:86'></a>I guess if building and possibly documentation are the only place left using stuff from `package.py` it could be moved to `sage_setup` where things not needed at run-time belongs in my opinion.



---

archive/issue_comments_277310.json:
```json
{
    "body": "<a id='comment:87'></a>documentation -> doctesting",
    "created_at": "2016-09-08T08:11:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277310",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:87'></a>documentation -> doctesting



---

archive/issue_comments_277311.json:
```json
{
    "body": "<a id='comment:88'></a>I think I have not made my point clear in [comment:82]\n\nWhat I wanted to say: you should remove the check for libraries from the `OptionalModule` features. It is *currently* (whether you like it or not) the job of `OptionalExtension` in `sage_setup` to decide whether or not to build the Python module. I don't see the point of the redundant check in `OptionalModule`. It needlessly complicates things and it is actually wrong (`OptionalModule` requires a Sage package, not a system package).",
    "created_at": "2016-09-16T08:31:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277311",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:88'></a>I think I have not made my point clear in [comment:82]

What I wanted to say: you should remove the check for libraries from the `OptionalModule` features. It is *currently* (whether you like it or not) the job of `OptionalExtension` in `sage_setup` to decide whether or not to build the Python module. I don't see the point of the redundant check in `OptionalModule`. It needlessly complicates things and it is actually wrong (`OptionalModule` requires a Sage package, not a system package).



---

archive/issue_comments_277312.json:
```json
{
    "body": "<a id='comment:89'></a>Rebasing on current develop. Someone else should check that I did everything right. One worry when building in parallel building of documentation kept on failing on `:module:` in `package.py`. When I built serial it just worked.\n\n---\nNew commits:",
    "created_at": "2016-10-02T09:01:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277312",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:89'></a>Rebasing on current develop. Someone else should check that I did everything right. One worry when building in parallel building of documentation kept on failing on `:module:` in `package.py`. When I built serial it just worked.

---
New commits:



---

archive/issue_comments_277313.json:
```json
{
    "body": "<a id='comment:90'></a>Replying to [comment:88 jdemeyer]:\n> I think I have not made my point clear in [comment:82]\n> \n> What I wanted to say: you should remove the check for libraries from the `OptionalModule` features. It is *currently* (whether you like it or not) the job of `OptionalExtension` in `sage_setup` to decide whether or not to build the Python module. I don't see the point of the redundant check in `OptionalModule`. It needlessly complicates things and it is actually wrong (`OptionalModule` requires a Sage package, not a system package).\n\nI don't understand. I meant to write this so it works for a sage that has not been installed through sage-the-distribution. So, for the module to work, I have to check that it has been compiled and that the library it uses actually works. For sage-the-distribution the second part is redundant for other distributions it may not be.",
    "created_at": "2016-11-28T10:00:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277313",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:90'></a>Replying to [comment:88 jdemeyer]:
> I think I have not made my point clear in [comment:82]
> 
> What I wanted to say: you should remove the check for libraries from the `OptionalModule` features. It is *currently* (whether you like it or not) the job of `OptionalExtension` in `sage_setup` to decide whether or not to build the Python module. I don't see the point of the redundant check in `OptionalModule`. It needlessly complicates things and it is actually wrong (`OptionalModule` requires a Sage package, not a system package).

I don't understand. I meant to write this so it works for a sage that has not been installed through sage-the-distribution. So, for the module to work, I have to check that it has been compiled and that the library it uses actually works. For sage-the-distribution the second part is redundant for other distributions it may not be.



---

archive/issue_comments_277314.json:
```json
{
    "body": "<a id='comment:92'></a>Replying to [comment:90 saraedum]:\n> So, for the module to work, I have to check that it has been compiled and that the library it uses actually works.\n\n\nNo, you don't need to check anything. The module is linked against the library. If the library didn't work, the module probably wouldn't even compile and it certainly wouldn't be importable. If you can import the module, then surely the library works.",
    "created_at": "2017-01-05T16:47:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277314",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:92'></a>Replying to [comment:90 saraedum]:
> So, for the module to work, I have to check that it has been compiled and that the library it uses actually works.


No, you don't need to check anything. The module is linked against the library. If the library didn't work, the module probably wouldn't even compile and it certainly wouldn't be importable. If you can import the module, then surely the library works.



---

archive/issue_comments_277315.json:
```json
{
    "body": "<a id='comment:94'></a>Something I don't quite get about this:  It seems to be purely for runtime feature checks, which is fine and a good thing to have.  But is there also any intention or thought put into making this usable for build-time feature checks when building Sage?  Is there any way this could be used to check the system for features during `./configure` (i.e. as a replacement for a m4 scripts to do the same)?",
    "created_at": "2017-01-12T09:44:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277315",
    "user": "https://github.com/embray"
}
```

<a id='comment:94'></a>Something I don't quite get about this:  It seems to be purely for runtime feature checks, which is fine and a good thing to have.  But is there also any intention or thought put into making this usable for build-time feature checks when building Sage?  Is there any way this could be used to check the system for features during `./configure` (i.e. as a replacement for a m4 scripts to do the same)?



---

archive/issue_comments_277316.json:
```json
{
    "body": "<a id='comment:95'></a>When we originally discussed this during Sage days the idea was to eventually use it for both, build and compile time. For that it would have to be moved out of the sage library probably. So yes, we thought about this as a possible second step.",
    "created_at": "2017-01-12T17:02:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277316",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:95'></a>When we originally discussed this during Sage days the idea was to eventually use it for both, build and compile time. For that it would have to be moved out of the sage library probably. So yes, we thought about this as a possible second step.



---

archive/issue_comments_277317.json:
```json
{
    "body": "<a id='comment:96'></a>Thanks for clarifying that.  Yes, for that reason alone it would make sense to have as a stand-alone package of sorts.\n\nIs there anything I can do to help move this forward?  I think getting this to a state where it can also detect already installed dependencies will help massively speed up development time in some cases.",
    "created_at": "2017-01-13T11:07:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277317",
    "user": "https://github.com/embray"
}
```

<a id='comment:96'></a>Thanks for clarifying that.  Yes, for that reason alone it would make sense to have as a stand-alone package of sorts.

Is there anything I can do to help move this forward?  I think getting this to a state where it can also detect already installed dependencies will help massively speed up development time in some cases.



---

archive/issue_comments_277318.json:
```json
{
    "body": "<a id='comment:97'></a>I am quite happy to have it for run-time only in the first instance. One issue for building is that we are not quite ready to use non sage installed optional package at this stage (i.e. finding optional package not installed by sage).\n\nFixing runtime would remove a burden from sage-on-distro, especially the bits depending on `is_package_installed` that we don't want to use in a distro. Build time can be fixed if the distro decides to support a particular option. But ideally we would want something more fine grained. Ideally it would tie up with a proper configuration phase.",
    "created_at": "2017-01-14T09:37:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277318",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:97'></a>I am quite happy to have it for run-time only in the first instance. One issue for building is that we are not quite ready to use non sage installed optional package at this stage (i.e. finding optional package not installed by sage).

Fixing runtime would remove a burden from sage-on-distro, especially the bits depending on `is_package_installed` that we don't want to use in a distro. Build time can be fixed if the distro decides to support a particular option. But ideally we would want something more fine grained. Ideally it would tie up with a proper configuration phase.



---

archive/issue_comments_277319.json:
```json
{
    "body": "<a id='comment:98'></a>Replying to [comment:97 fbissey]:\n> I am quite happy to have it for run-time only in the first instance. One issue for building is that we are not quite ready to use non sage installed optional package at this stage (i.e. finding optional package not installed by sage).\n\n\nI'm not sure what you mean exactly by this.  Why should optional packages be a problem as long as this can be useful for non-optional packages?\n\n> Fixing runtime would remove a burden from sage-on-distro, especially the bits depending on `is_package_installed` that we don't want to use in a distro. Build time can be fixed if the distro decides to support a particular option. But ideally we would want something more fine grained. Ideally it would tie up with a proper configuration phase.\n\n\nYes, that work is going on in #21566 and other associated tickets.\n\nTo be clear, I think we're in agreement that *this ticket* should not handle any tasks directly related to enabling build-time detection of dependencies.  I agree that's a separate issue.  My point is that we should keep that use-case in mind for this ticket insofar as the checks its provides don't depend on having a fully working Sage install already, and that it exists outside the main Sage package.\n\nIn other words, this ticket could remain focused on fixing the `is_package_installed` issue, but just keep in mind the other use case that this code could help resolve.",
    "created_at": "2017-01-16T13:14:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277319",
    "user": "https://github.com/embray"
}
```

<a id='comment:98'></a>Replying to [comment:97 fbissey]:
> I am quite happy to have it for run-time only in the first instance. One issue for building is that we are not quite ready to use non sage installed optional package at this stage (i.e. finding optional package not installed by sage).


I'm not sure what you mean exactly by this.  Why should optional packages be a problem as long as this can be useful for non-optional packages?

> Fixing runtime would remove a burden from sage-on-distro, especially the bits depending on `is_package_installed` that we don't want to use in a distro. Build time can be fixed if the distro decides to support a particular option. But ideally we would want something more fine grained. Ideally it would tie up with a proper configuration phase.


Yes, that work is going on in #21566 and other associated tickets.

To be clear, I think we're in agreement that *this ticket* should not handle any tasks directly related to enabling build-time detection of dependencies.  I agree that's a separate issue.  My point is that we should keep that use-case in mind for this ticket insofar as the checks its provides don't depend on having a fully working Sage install already, and that it exists outside the main Sage package.

In other words, this ticket could remain focused on fixing the `is_package_installed` issue, but just keep in mind the other use case that this code could help resolve.



---

archive/issue_comments_277320.json:
```json
{
    "body": "<a id='comment:0'></a>After some discussion with jdemeyer, I'll remove the current checks OptionalModule. I'll leave the possibility for such checks in though.",
    "created_at": "2017-03-13T22:35:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277320",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:0'></a>After some discussion with jdemeyer, I'll remove the current checks OptionalModule. I'll leave the possibility for such checks in though.



---

archive/issue_comments_277321.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-03-13T22:41:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277321",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_277322.json:
```json
{
    "body": "<a id='comment:3'></a>New commits:",
    "created_at": "2017-03-13T23:00:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277322",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:3'></a>New commits:



---

archive/issue_comments_277323.json:
```json
{
    "body": "Changing keywords from \"\" to \"days85\".",
    "created_at": "2017-03-14T16:12:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277323",
    "user": "https://github.com/saraedum"
}
```

Changing keywords from "" to "days85".



---

archive/issue_comments_277324.json:
```json
{
    "body": "<a id='comment:6'></a>Shouldn't *all* feature checks be cached?",
    "created_at": "2017-03-14T16:34:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277324",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:6'></a>Shouldn't *all* feature checks be cached?



---

archive/issue_comments_277325.json:
```json
{
    "body": "<a id='comment:7'></a>Copy-paste typo:\n\n```python\nclass Bliss(OptionalModule):\n    r\"\"\"\n    A :class:`Feature` which describes whether the ;module:`sage.graphs.bliss`\n    module has been enabled for this build of Sage and is functional.\n\n    .. NOTE::\n\n------> This module does not depend on :class:`LibFESLibrary`. If the module\n        imports we just assume that the library is working.\n```",
    "created_at": "2017-03-14T16:35:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277325",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:7'></a>Copy-paste typo:

```python
class Bliss(OptionalModule):
    r"""
    A :class:`Feature` which describes whether the ;module:`sage.graphs.bliss`
    module has been enabled for this build of Sage and is functional.

    .. NOTE::

------> This module does not depend on :class:`LibFESLibrary`. If the module
        imports we just assume that the library is working.
```



---

archive/issue_comments_277326.json:
```json
{
    "body": "<a id='comment:8'></a>I don't like `_test_code`: you define the attribute `_test_code`, pass it through `__init__` and then assign it as the `test_code` attribute. Why so convoluted, you might as well assign `test_code` directly.",
    "created_at": "2017-03-14T16:44:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277326",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'></a>I don't like `_test_code`: you define the attribute `_test_code`, pass it through `__init__` and then assign it as the `test_code` attribute. Why so convoluted, you might as well assign `test_code` directly.



---

archive/issue_comments_277327.json:
```json
{
    "body": "<a id='comment:9'></a>Speaking of test code, wouldn't it be cleaner to move the test code snippets to separate files? Right now, I find it a bit distracting to have the Cython test code in between the Python code implementing the testing logic.",
    "created_at": "2017-03-14T16:46:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277327",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:9'></a>Speaking of test code, wouldn't it be cleaner to move the test code snippets to separate files? Right now, I find it a bit distracting to have the Cython test code in between the Python code implementing the testing logic.



---

archive/issue_comments_277328.json:
```json
{
    "body": "<a id='comment:0'></a>Typo: `;module:`sage.libs.fes``",
    "created_at": "2017-03-14T16:47:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277328",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:0'></a>Typo: `;module:`sage.libs.fes``



---

archive/issue_comments_277329.json:
```json
{
    "body": "<a id='comment:111'></a>Replying to [comment:100 saraedum]:\n> After some discussion with jdemeyer, I'll remove the current checks OptionalModule.\n\n\nGiven that `OptionalModule` and `Module` essentially do the same thing, can you just get rid of the `OptionalModule` class completely?",
    "created_at": "2017-03-14T16:49:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277329",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:111'></a>Replying to [comment:100 saraedum]:
> After some discussion with jdemeyer, I'll remove the current checks OptionalModule.


Given that `OptionalModule` and `Module` essentially do the same thing, can you just get rid of the `OptionalModule` class completely?



---

archive/issue_comments_277330.json:
```json
{
    "body": "<a id='comment:2'></a>I don't really like the names `LibFES` and `Bliss`. I would prefer something which clearly reminds that this is just about the module: I would call them `FESModule` and `BlissModule`.",
    "created_at": "2017-03-14T16:50:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277330",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:2'></a>I don't really like the names `LibFES` and `Bliss`. I would prefer something which clearly reminds that this is just about the module: I would call them `FESModule` and `BlissModule`.



---

archive/issue_comments_277331.json:
```json
{
    "body": "<a id='comment:3'></a>Another suggestion: split this one big file `src/sage/misc/feature_test.py` up. It would be good to separate the abstract base classes (like `Executable`, `SharedLibrary`,...) from the actual concrete tests.\n\nPersonally, I would even have one file for each package, for example `src/sage/misc/feature_test/bliss.py` for `BlissLibrary` and `BlissModule`. In this case, you can define the Cython test code as module global, which would solve [comment:109] too.",
    "created_at": "2017-03-14T16:55:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277331",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:3'></a>Another suggestion: split this one big file `src/sage/misc/feature_test.py` up. It would be good to separate the abstract base classes (like `Executable`, `SharedLibrary`,...) from the actual concrete tests.

Personally, I would even have one file for each package, for example `src/sage/misc/feature_test/bliss.py` for `BlissLibrary` and `BlissModule`. In this case, you can define the Cython test code as module global, which would solve [comment:109] too.



---

archive/issue_comments_277332.json:
```json
{
    "body": "<a id='comment:4'></a>Except for the typos, we do not fully agree on whether the above should be changed or not. jdemeyer agreed to split up the module, introduce caching, and do the renamings himself.",
    "created_at": "2017-03-14T19:22:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277332",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:4'></a>Except for the typos, we do not fully agree on whether the above should be changed or not. jdemeyer agreed to split up the module, introduce caching, and do the renamings himself.



---

archive/issue_comments_277333.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-03-14T19:22:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277333",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_277334.json:
```json
{
    "body": "Set assignee to @jdemeyer.",
    "created_at": "2017-03-14T19:22:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277334",
    "user": "https://github.com/saraedum"
}
```

Set assignee to @jdemeyer.



---

archive/issue_comments_277335.json:
```json
{
    "body": "<a id='comment:7'></a>This is a minor nit, but is there a reason this isn't using `super().__init__` for calling the base-class `__init__`s?",
    "created_at": "2017-04-03T07:06:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277335",
    "user": "https://github.com/embray"
}
```

<a id='comment:7'></a>This is a minor nit, but is there a reason this isn't using `super().__init__` for calling the base-class `__init__`s?



---

archive/issue_comments_277336.json:
```json
{
    "body": "<a id='comment:9'></a>What should we do about this issue? I had put a lot of work into this and I would like to get this merged.\n\nJeroen: Would you agree to merge this as is now (after fixing patchbot errors)? Or can I expect a patch anytime soon?",
    "created_at": "2018-01-31T15:13:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277336",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:9'></a>What should we do about this issue? I had put a lot of work into this and I would like to get this merged.

Jeroen: Would you agree to merge this as is now (after fixing patchbot errors)? Or can I expect a patch anytime soon?



---

archive/issue_comments_277337.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-01-31T15:13:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277337",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_277338.json:
```json
{
    "body": "<a id='comment:0'></a>I've in the meantime started moving in a different direction for build-time feature dependency checks, so to me at least my earlier questions about using this for that purpose are moot.  But I'm still +1 on having it for runtime feature checks.\n\nIt looks like the patch does not apply so I think you'll have to set this back to needs_work.  I'd be happy to help rebasing your patch if need be.",
    "created_at": "2018-01-31T15:48:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277338",
    "user": "https://github.com/embray"
}
```

<a id='comment:0'></a>I've in the meantime started moving in a different direction for build-time feature dependency checks, so to me at least my earlier questions about using this for that purpose are moot.  But I'm still +1 on having it for runtime feature checks.

It looks like the patch does not apply so I think you'll have to set this back to needs_work.  I'd be happy to help rebasing your patch if need be.



---

archive/issue_comments_277339.json:
```json
{
    "body": "<a id='comment:2'></a>I'll clean this up.\n\n---\nNew commits:",
    "created_at": "2018-02-12T14:37:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277339",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:2'></a>I'll clean this up.

---
New commits:



---

archive/issue_comments_277340.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-02-12T14:37:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277340",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_277341.json:
```json
{
    "body": "<a id='comment:3'></a>In some cases, bigger changes were made than just using this new `Features` framework. I'll split those off as separate tickets.",
    "created_at": "2018-02-12T14:40:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277341",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:3'></a>In some cases, bigger changes were made than just using this new `Features` framework. I'll split those off as separate tickets.



---

archive/issue_comments_277342.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-02-12T14:43:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277342",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_277343.json:
```json
{
    "body": "<a id='comment:5'></a>It seems that `SharedLibrary` is not checking for libraries at all: it just tries to compile some Cython code. So it would be better to rename it as `CythonFeature` or whatever better name I can come up with...",
    "created_at": "2018-02-12T15:05:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277343",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:5'></a>It seems that `SharedLibrary` is not checking for libraries at all: it just tries to compile some Cython code. So it would be better to rename it as `CythonFeature` or whatever better name I can come up with...



---

archive/issue_comments_277344.json:
```json
{
    "body": "<a id='comment:126'></a>Replying to [comment:111 jdemeyer]:\n> Given that `OptionalModule` and `Module` essentially do the same thing, can you just get rid of the `OptionalModule` class completely?\n\n\nI will remove `OptionalModule` and also rename `Module` -> `PythonModule`.",
    "created_at": "2018-02-12T15:11:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277344",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:126'></a>Replying to [comment:111 jdemeyer]:
> Given that `OptionalModule` and `Module` essentially do the same thing, can you just get rid of the `OptionalModule` class completely?


I will remove `OptionalModule` and also rename `Module` -> `PythonModule`.



---

archive/issue_comments_277345.json:
```json
{
    "body": "<a id='comment:7'></a>I just found a problem which is not easy to fix: there is no way as far as I can tell to silence compiler error in distutils. This means that feature checks will show messages like\n\n```\n/usr/lib/gcc/x86_64-pc-linux-gnu/4.9.4/../../../../x86_64-pc-linux-gnu/bin/ld: cannot find -lxxxxxxxx\ncollect2: error: ld returned 1 exit status\n```",
    "created_at": "2018-02-12T15:31:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277345",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:7'></a>I just found a problem which is not easy to fix: there is no way as far as I can tell to silence compiler error in distutils. This means that feature checks will show messages like

```
/usr/lib/gcc/x86_64-pc-linux-gnu/4.9.4/../../../../x86_64-pc-linux-gnu/bin/ld: cannot find -lxxxxxxxx
collect2: error: ld returned 1 exit status
```



---

archive/issue_comments_277346.json:
```json
{
    "body": "<a id='comment:8'></a>I could take a look at that. I feel like that's a problem I've solved once before, also when using distutils for feature checks (even if it means temporarily redirecting stdio or something).",
    "created_at": "2018-02-12T16:02:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277346",
    "user": "https://github.com/embray"
}
```

<a id='comment:8'></a>I could take a look at that. I feel like that's a problem I've solved once before, also when using distutils for feature checks (even if it means temporarily redirecting stdio or something).



---

archive/issue_comments_277347.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-02-12T16:11:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277347",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_277348.json:
```json
{
    "body": "<a id='comment:0'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-02-12T16:17:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277348",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:0'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_277349.json:
```json
{
    "body": "<a id='comment:1'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-02-12T16:21:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277349",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:1'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_277350.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-02-12T16:22:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277350",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_277351.json:
```json
{
    "body": "<a id='comment:2'></a>I'm setting this to needs_review mainly for patchbot testing. It's probably going to break somewhere, but it should mostly work.",
    "created_at": "2018-02-12T16:22:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277351",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:2'></a>I'm setting this to needs_review mainly for patchbot testing. It's probably going to break somewhere, but it should mostly work.



---

archive/issue_comments_277352.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-02-12T20:30:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277352",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_277353.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-02-12T20:48:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277353",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_277354.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-02-12T20:48:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277354",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_277355.json:
```json
{
    "body": "<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-02-12T21:33:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277355",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_277356.json:
```json
{
    "body": "<a id='comment:8'></a>I now consider this finished, apart from #24720.",
    "created_at": "2018-02-12T21:35:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277356",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'></a>I now consider this finished, apart from #24720.



---

archive/issue_comments_277357.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-02-12T21:36:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277357",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_277358.json:
```json
{
    "body": "<a id='comment:0'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-02-12T21:40:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277358",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:0'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_277359.json:
```json
{
    "body": "<a id='comment:1'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-02-12T21:52:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277359",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:1'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_277360.json:
```json
{
    "body": "<a id='comment:2'></a>It looks really good. There are a few files remaining to migrate to \"features\" not covered here but that's good for a first iteration and will prove that the concept work. One more file should be migrated in this ticket I think, `databases/cremona.py`  because it is the only file that would use `features/databases.py` as it currently stands.\n\nFor info the following files have stuff to convert\n* coding/linear_code.py\n* coding/guava.py\n* coding/databases.py\n* graphs/generators/smallgraphs.py\n* groups/abelian_gps/abelian_group.py\nAll of these are about some gap packages.",
    "created_at": "2018-02-12T22:09:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277360",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:2'></a>It looks really good. There are a few files remaining to migrate to "features" not covered here but that's good for a first iteration and will prove that the concept work. One more file should be migrated in this ticket I think, `databases/cremona.py`  because it is the only file that would use `features/databases.py` as it currently stands.

For info the following files have stuff to convert
* coding/linear_code.py
* coding/guava.py
* coding/databases.py
* graphs/generators/smallgraphs.py
* groups/abelian_gps/abelian_group.py
All of these are about some gap packages.



---

archive/issue_comments_277361.json:
```json
{
    "body": "<a id='comment:143'></a>Replying to [comment:142 fbissey]:\n> One more file should be migrated in this ticket I think, `databases/cremona.py`  because it is the only file that would use `features/databases.py` as it currently stands.\n\n\nI split that off as #24718.",
    "created_at": "2018-02-13T06:25:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277361",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:143'></a>Replying to [comment:142 fbissey]:
> One more file should be migrated in this ticket I think, `databases/cremona.py`  because it is the only file that would use `features/databases.py` as it currently stands.


I split that off as #24718.



---

archive/issue_comments_277362.json:
```json
{
    "body": "<a id='comment:4'></a>If you care about this ticket, please review #24722, #24724, #24720 which all deal with improving `sage.misc.cython` to allow for silent operation.",
    "created_at": "2018-02-13T15:41:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277362",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:4'></a>If you care about this ticket, please review #24722, #24724, #24720 which all deal with improving `sage.misc.cython` to allow for silent operation.



---

archive/issue_comments_277363.json:
```json
{
    "body": "<a id='comment:5'></a>OK I think it is time to move this ticket further.",
    "created_at": "2018-02-25T22:23:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277363",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:5'></a>OK I think it is time to move this ticket further.



---

archive/issue_comments_277364.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2018-02-25T22:23:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277364",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_events_055209.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2018-02-25T22:23:40Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "milestone": "sage-7.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20382#event-55209"
}
```



---

archive/issue_events_055210.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2018-02-25T22:23:40Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "milestone": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20382#event-55210"
}
```



---

archive/issue_comments_277365.json:
```json
{
    "body": "<a id='comment:6'></a>I never set this to needs_review.",
    "created_at": "2018-02-26T08:55:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277365",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:6'></a>I never set this to needs_review.



---

archive/issue_comments_277366.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2018-02-26T08:55:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277366",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_277367.json:
```json
{
    "body": "<a id='comment:7'></a>There is one issue remaining: this shouldn't use `cython_import()` but a direct `cython()` call. For simplicity, I plan to do that once all dependencies are merged.",
    "created_at": "2018-02-26T08:56:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277367",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:7'></a>There is one issue remaining: this shouldn't use `cython_import()` but a direct `cython()` call. For simplicity, I plan to do that once all dependencies are merged.



---

archive/issue_comments_277368.json:
```json
{
    "body": "<a id='comment:8'></a>Ok, at #20382#comment:138 you said you considered this done. So I assumed too much out of that. Works well as far as I am concerned.",
    "created_at": "2018-02-26T09:21:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277368",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:8'></a>Ok, at #20382#comment:138 you said you considered this done. So I assumed too much out of that. Works well as far as I am concerned.



---

archive/issue_comments_277369.json:
```json
{
    "body": "<a id='comment:9'></a>I guess I meant more broadly \"apart from issues with Cython\".",
    "created_at": "2018-02-26T21:01:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277369",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:9'></a>I guess I meant more broadly "apart from issues with Cython".



---

archive/issue_comments_277370.json:
```json
{
    "body": "<a id='comment:0'></a>It looks like the dependencies that you listed will be in the next beta - which could turn out to be a rc at this stage. Are there any more tickets that need to go in prior to this one in your opinion?",
    "created_at": "2018-02-26T21:05:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277370",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:0'></a>It looks like the dependencies that you listed will be in the next beta - which could turn out to be a rc at this stage. Are there any more tickets that need to go in prior to this one in your opinion?



---

archive/issue_comments_277371.json:
```json
{
    "body": "<a id='comment:1'></a>#24764 would be nice because it touches the same code.",
    "created_at": "2018-02-26T21:27:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277371",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:1'></a>#24764 would be nice because it touches the same code.



---

archive/issue_comments_277372.json:
```json
{
    "body": "<a id='comment:2'></a>#24764 is in.",
    "created_at": "2018-03-13T09:18:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277372",
    "user": "https://github.com/slel"
}
```

<a id='comment:2'></a>#24764 is in.



---

archive/issue_comments_277373.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-03-13T14:49:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277373",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_277374.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-03-13T14:50:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277374",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_277375.json:
```json
{
    "body": "<a id='comment:5'></a>Setting milestone to sage-pending because I think that this ticket should **not** be merged in Sage 8.2. The reason is that this ticket has a lot of potential to break stuff because it involves optional packages and those are tested poorly. This would be an ideal ticket to merge in 8.3.beta0.",
    "created_at": "2018-03-13T14:50:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277375",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:5'></a>Setting milestone to sage-pending because I think that this ticket should **not** be merged in Sage 8.2. The reason is that this ticket has a lot of potential to break stuff because it involves optional packages and those are tested poorly. This would be an ideal ticket to merge in 8.3.beta0.



---

archive/issue_events_055211.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-03-13T14:50:46Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "milestone": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20382#event-55211"
}
```



---

archive/issue_events_055212.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-03-13T14:50:46Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "milestone": "sage-pending",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20382#event-55212"
}
```



---

archive/issue_comments_277376.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-03-23T21:42:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277376",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_055213.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-04-26T09:54:07Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "milestone": "sage-pending",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20382#event-55213"
}
```



---

archive/issue_events_055214.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-04-26T09:54:07Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "milestone": "sage-8.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20382#event-55214"
}
```



---

archive/issue_events_055215.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-05-08T17:27:34Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20382#event-55215"
}
```



---

archive/issue_comments_277377.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-05-08T17:27:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277377",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_277378.json:
```json
{
    "body": "<a id='comment:159'></a>Replying to [comment:155 jdemeyer]:\n> Setting milestone to sage-pending because I think that this ticket should **not** be merged in Sage 8.2. The reason is that this ticket has a lot of potential to break stuff because it involves optional packages and those are tested poorly. This would be an ideal ticket to merge in 8.3.beta0.\n\n\nIndeed... help for fixing the consequences in: #25332\n\nAnd one question: the LattE feature from #25400 needs to check for two executables. Should I introduce an abstract class feature \"Executables\" (whose constructor argument would be a list of `Executable` classes)?",
    "created_at": "2018-05-19T08:18:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20382",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20382#issuecomment-277378",
    "user": "https://github.com/videlec"
}
```

<a id='comment:159'></a>Replying to [comment:155 jdemeyer]:
> Setting milestone to sage-pending because I think that this ticket should **not** be merged in Sage 8.2. The reason is that this ticket has a lot of potential to break stuff because it involves optional packages and those are tested poorly. This would be an ideal ticket to merge in 8.3.beta0.


Indeed... help for fixing the consequences in: #25332

And one question: the LattE feature from #25400 needs to check for two executables. Should I introduce an abstract class feature "Executables" (whose constructor argument would be a list of `Executable` classes)?
