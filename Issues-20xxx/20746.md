# Issue 20746: Pushout for real embedded number fields

archive/issues_020509.json:
```json
{
    "body": "Implement the following pushout\n\n```\nsage: K.<a> = NumberField(x^2 - 3, embedding=AA(3)**(1/2))\nsage: L.<b> = NumberField(x^2 - 2, embedding=AA(2)**(1/2))\nsage: a+b\n3.146264369941973?\nsage: parent(_)\nAlgebraic Real Field\nsage: a < b\nFalse\n```\n\n**CC:**  @jdemeyer @tscrim\n\n**Keywords:** days74, days84\n\n**Branch/Commit:** [4a52745b734543ca8e65f2ac3050c9a73f223edd](https://github.com/sagemath/sagetrac-mirror/commit/4a52745b734543ca8e65f2ac3050c9a73f223edd)\n\n**Reviewer:** Jean-Philippe Labb\u00e9\n\n**Author:** Vincent Delecroix\n\nIssue created by migration from https://trac.sagemath.org/ticket/20746\n\n",
    "closed_at": "2017-03-08T18:45:56Z",
    "created_at": "2016-06-01T10:28:19Z",
    "labels": [
        "component: number fields",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.3",
    "title": "Pushout for real embedded number fields",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/20746",
    "user": "https://github.com/videlec"
}
```
Implement the following pushout

```
sage: K.<a> = NumberField(x^2 - 3, embedding=AA(3)**(1/2))
sage: L.<b> = NumberField(x^2 - 2, embedding=AA(2)**(1/2))
sage: a+b
3.146264369941973?
sage: parent(_)
Algebraic Real Field
sage: a < b
False
```

**CC:**  @jdemeyer @tscrim

**Keywords:** days74, days84

**Branch/Commit:** [4a52745b734543ca8e65f2ac3050c9a73f223edd](https://github.com/sagemath/sagetrac-mirror/commit/4a52745b734543ca8e65f2ac3050c9a73f223edd)

**Reviewer:** Jean-Philippe Labbé

**Author:** Vincent Delecroix

Issue created by migration from https://trac.sagemath.org/ticket/20746





---

archive/issue_comments_304923.json:
```json
{
    "body": "**Branch:** [u/vdelecroix/20746](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/20746)",
    "created_at": "2016-06-01T10:29:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20746#issuecomment-304923",
    "user": "https://github.com/videlec"
}
```

**Branch:** [u/vdelecroix/20746](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/20746)



---

archive/issue_comments_304924.json:
```json
{
    "body": "**Commit:** [4a52745b734543ca8e65f2ac3050c9a73f223edd](https://github.com/sagemath/sagetrac-mirror/commit/4a52745b734543ca8e65f2ac3050c9a73f223edd)",
    "created_at": "2016-06-01T10:29:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20746#issuecomment-304924",
    "user": "https://github.com/videlec"
}
```

**Commit:** [4a52745b734543ca8e65f2ac3050c9a73f223edd](https://github.com/sagemath/sagetrac-mirror/commit/4a52745b734543ca8e65f2ac3050c9a73f223edd)



---

archive/issue_events_189504.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2016-06-01T10:29:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/20746",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20746#event-189504"
}
```



---

archive/issue_comments_304925.json:
```json
{
    "body": "<a id='comment:1'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4a52745b734543ca8e65f2ac3050c9a73f223edd\">4a52745</a></td><td><code>Trac 20746: pushout for real embedded number fields</code></td></tr></table>\n",
    "created_at": "2016-06-01T10:29:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20746#issuecomment-304925",
    "user": "https://github.com/videlec"
}
```

<a id='comment:1'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4a52745b734543ca8e65f2ac3050c9a73f223edd">4a52745</a></td><td><code>Trac 20746: pushout for real embedded number fields</code></td></tr></table>




---

archive/issue_comments_304926.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -7,4 +7,6 @@\n 3.146264369941973?\n sage: parent(_)\n Algebraic Real Field\n+sage: a < b\n+False\n ```\n``````\n",
    "created_at": "2016-06-01T10:34:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20746#issuecomment-304926",
    "user": "https://github.com/videlec"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -7,4 +7,6 @@
 3.146264369941973?
 sage: parent(_)
 Algebraic Real Field
+sage: a < b
+False
 ```
``````




---

archive/issue_events_189505.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2016-06-01T11:23:15Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/20746",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20746#event-189505"
}
```



---

archive/issue_events_189506.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2016-06-01T11:23:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/20746",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20746#event-189506"
}
```



---

archive/issue_comments_304927.json:
```json
{
    "body": "<a id='comment:4'></a>\nIsn't it a bit drastic to declare `AA` to be the pushout rather than to create a suitable number field?  I think a better solution would be to use the existing `composite_fields()` method, which respects embeddings:\n\n```diff\n--- a/src/sage/rings/number_field/number_field_base.pyx\n+++ b/src/sage/rings/number_field/number_field_base.pyx\n@@ -350,3 +350,7 @@ cdef class NumberField(Field):\n         else:\n             raise ValueError(\"No embedding set. You need to specify a a real embedding.\")\n \n+    def _pushout_(self, other):\n+        if (isinstance(other, NumberField) and self._embedded_real and\n+            (<NumberField>other)._embedded_real):\n+            return self.composite_fields(other)[0]\n```\nThis makes the examples in the current branch work just as well (you can see the numerical values after coercing into `AA`).",
    "created_at": "2016-06-01T11:23:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20746#issuecomment-304927",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:4'></a>
Isn't it a bit drastic to declare `AA` to be the pushout rather than to create a suitable number field?  I think a better solution would be to use the existing `composite_fields()` method, which respects embeddings:

```diff
--- a/src/sage/rings/number_field/number_field_base.pyx
+++ b/src/sage/rings/number_field/number_field_base.pyx
@@ -350,3 +350,7 @@ cdef class NumberField(Field):
         else:
             raise ValueError("No embedding set. You need to specify a a real embedding.")
 
+    def _pushout_(self, other):
+        if (isinstance(other, NumberField) and self._embedded_real and
+            (<NumberField>other)._embedded_real):
+            return self.composite_fields(other)[0]
```
This makes the examples in the current branch work just as well (you can see the numerical values after coercing into `AA`).



---

archive/issue_comments_304928.json:
```json
{
    "body": "<a id='comment:5'></a>\nFair enough. Though it is more expensive.",
    "created_at": "2016-06-01T12:00:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20746#issuecomment-304928",
    "user": "https://github.com/videlec"
}
```

<a id='comment:5'></a>
Fair enough. Though it is more expensive.



---

archive/issue_comments_304929.json:
```json
{
    "body": "<a id='comment:6'></a>\nAnd this is order dependent\n\n```\nsage: K.<a> = NumberField(x^2 - 3, embedding=AA(3)**(1/2))\nsage: L.<b> = NumberField(x^2 - 2, embedding=AA(2)**(1/2))\nsage: a+b\nab^3 - 10*ab\n```\nversus\n\n```\nsage: K.<a> = NumberField(x^2 - 3, embedding=AA(3)**(1/2))\nsage: L.<b> = NumberField(x^2 - 2, embedding=AA(2)**(1/2))\nsage: b+a\n-ba^3 + 10*ba\n```",
    "created_at": "2016-06-01T12:08:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20746#issuecomment-304929",
    "user": "https://github.com/videlec"
}
```

<a id='comment:6'></a>
And this is order dependent

```
sage: K.<a> = NumberField(x^2 - 3, embedding=AA(3)**(1/2))
sage: L.<b> = NumberField(x^2 - 2, embedding=AA(2)**(1/2))
sage: a+b
ab^3 - 10*ab
```
versus

```
sage: K.<a> = NumberField(x^2 - 3, embedding=AA(3)**(1/2))
sage: L.<b> = NumberField(x^2 - 2, embedding=AA(2)**(1/2))
sage: b+a
-ba^3 + 10*ba
```



---

archive/issue_events_189507.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2016-06-02T04:20:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/20746",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20746#event-189507"
}
```



---

archive/issue_events_189508.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2016-06-02T04:20:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/20746",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20746#event-189508"
}
```



---

archive/issue_comments_304930.json:
```json
{
    "body": "<a id='comment:8'></a>\nThis coercion has its advantages:\n\n- makes it possible to do arithmetic operations with elements with two different `NumberFields` as parents. Right now returns a TypeError:\n\n```\n    sage: J = NumberField(x^2 - 2,'s')\n    sage: s = J.gens()[0]\n    sage: K = NumberField(x^3 - 2,'t')\n    sage: t = K.gens()[0]\n    sage: s * t\n    Traceback (most recent call last):\n    ...\n    TypeError: unsupported operand parent(s) for *: ...\n```\n- It is lazy, it does have to compute the join.\n\nDepending on the usage, one may want to get the join of the fields using `composite_field`, this introduces another variable and is order dependant. I guess that if one wants to do computations on the long run with that field, one would already use the right field from start.\n\nIMHO, this ticket already fixes an operation that one would naturally want to have at hand. So, I would make this a positive review.",
    "created_at": "2017-03-05T23:33:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20746#issuecomment-304930",
    "user": "https://github.com/jplab"
}
```

<a id='comment:8'></a>
This coercion has its advantages:

- makes it possible to do arithmetic operations with elements with two different `NumberFields` as parents. Right now returns a TypeError:

```
    sage: J = NumberField(x^2 - 2,'s')
    sage: s = J.gens()[0]
    sage: K = NumberField(x^3 - 2,'t')
    sage: t = K.gens()[0]
    sage: s * t
    Traceback (most recent call last):
    ...
    TypeError: unsupported operand parent(s) for *: ...
```
- It is lazy, it does have to compute the join.

Depending on the usage, one may want to get the join of the fields using `composite_field`, this introduces another variable and is order dependant. I guess that if one wants to do computations on the long run with that field, one would already use the right field from start.

IMHO, this ticket already fixes an operation that one would naturally want to have at hand. So, I would make this a positive review.



---

archive/issue_events_189509.json:
```json
{
    "actor": "https://github.com/jplab",
    "created_at": "2017-03-05T23:34:10Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/20746",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20746#event-189509"
}
```



---

archive/issue_events_189510.json:
```json
{
    "actor": "https://github.com/jplab",
    "created_at": "2017-03-05T23:34:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/20746",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20746#event-189510"
}
```



---

archive/issue_comments_304931.json:
```json
{
    "body": "**Reviewer:** Jean-Philippe Labb\u00e9",
    "created_at": "2017-03-05T23:34:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20746#issuecomment-304931",
    "user": "https://github.com/jplab"
}
```

**Reviewer:** Jean-Philippe Labbé



---

archive/issue_comments_304932.json:
```json
{
    "body": "**Changing keywords** from \"days74\" to \"days74, days84\".",
    "created_at": "2017-03-05T23:35:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20746#issuecomment-304932",
    "user": "https://github.com/jplab"
}
```

**Changing keywords** from "days74" to "days74, days84".



---

archive/issue_events_189511.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-03-08T18:45:56Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/20746",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20746#event-189511"
}
```



---

archive/issue_events_189512.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-03-08T18:45:56Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/20746",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20746#event-189512"
}
```



---

archive/issue_comments_304933.json:
```json
{
    "body": "**Changing branch** from \"[u/vdelecroix/20746](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/20746)\" to \"[4a52745b734543ca8e65f2ac3050c9a73f223edd](https://github.com/sagemath/sagetrac-mirror/commit/4a52745b734543ca8e65f2ac3050c9a73f223edd)\".",
    "created_at": "2017-03-08T18:45:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20746#issuecomment-304933",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/vdelecroix/20746](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/20746)" to "[4a52745b734543ca8e65f2ac3050c9a73f223edd](https://github.com/sagemath/sagetrac-mirror/commit/4a52745b734543ca8e65f2ac3050c9a73f223edd)".
