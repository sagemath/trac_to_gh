# Issue 20639: Sphinx sometimes doesn't resolve :meth:`.method` references correctly

archive/issues_020402.json:
```json
{
    "body": "In Sphinx it's possible to reference a method (or I guess attribute) of a class, or also a member of a module, using a shorthand notation with a leading dot. E.g. `:meth:`.order`` which should resolve documentation of the `order()` method of the current class being documented.\n\nHowever, I found that this often fails, it seems, especially if that method is documented in a parent class, but not directly in some subclass.  E.g. the following error can occur when building the docs:\n\n```\nOSError: [graphs   ] /home/embray/src/sagemath/sage/local/lib/python2.7/site-packages/sage/graphs/digraph.py:docstring of sage.graphs.digraph.DiGraph.reverse_edge:116: WARNING: more than one target found for cross-reference u'edge_label': sage.graphs.generic_graph.GenericGraph.edge_label, sage.combinat.knutson_tao_puzzles.PuzzlePiece.edge_label\n```\n\nIt's possible this doesn't occur when building the docs in parallel, but when building in a single process it's inevitable in a few places.\n\nThe problem in this case is that when generating a reference for `DiGraph.edge_label` (which is referenced in the docstring for `DiGraph` as `:meth:`.edge_label``) it comes up with multiple matches: \n\n```\n[(u'sage.combinat.knutson_tao_puzzles.PuzzlePiece.edge_label', (u'sage/combinat/knutson_tao_puzzles', u'method')), (u'sage.graphs.generic_graph.GenericGraph.edge_label', (u'sage/graphs/generic_graph', u'method'))]\n```\n\nIn this case it should of course use `GenericGraph.edge_label`, but it doesn't recognize that `GenericGraph` is a subclass of `DiGraph` and should be preferred. Instead this ends up generating an incorrect reference.  A workaround would be to use a more explicit reference.  \n\nI'm also not sure why it results in an `OSError` and craashes the build instead of just producing a warning--is the doc build configured to promote all warnings to exceptions?\n\nUpstream: Not yet reported upstream; Will do shortly.\n\nStatus: new\n\nIssue created by migration from https://trac.sagemath.org/ticket/20639\n\n",
    "created_at": "2016-05-20T09:13:27Z",
    "labels": [
        "component: documentation",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.3",
    "title": "Sphinx sometimes doesn't resolve :meth:`.method` references correctly",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/20639",
    "user": "https://github.com/embray"
}
```
In Sphinx it's possible to reference a method (or I guess attribute) of a class, or also a member of a module, using a shorthand notation with a leading dot. E.g. `:meth:`.order`` which should resolve documentation of the `order()` method of the current class being documented.

However, I found that this often fails, it seems, especially if that method is documented in a parent class, but not directly in some subclass.  E.g. the following error can occur when building the docs:

```
OSError: [graphs   ] /home/embray/src/sagemath/sage/local/lib/python2.7/site-packages/sage/graphs/digraph.py:docstring of sage.graphs.digraph.DiGraph.reverse_edge:116: WARNING: more than one target found for cross-reference u'edge_label': sage.graphs.generic_graph.GenericGraph.edge_label, sage.combinat.knutson_tao_puzzles.PuzzlePiece.edge_label
```

It's possible this doesn't occur when building the docs in parallel, but when building in a single process it's inevitable in a few places.

The problem in this case is that when generating a reference for `DiGraph.edge_label` (which is referenced in the docstring for `DiGraph` as `:meth:`.edge_label``) it comes up with multiple matches: 

```
[(u'sage.combinat.knutson_tao_puzzles.PuzzlePiece.edge_label', (u'sage/combinat/knutson_tao_puzzles', u'method')), (u'sage.graphs.generic_graph.GenericGraph.edge_label', (u'sage/graphs/generic_graph', u'method'))]
```

In this case it should of course use `GenericGraph.edge_label`, but it doesn't recognize that `GenericGraph` is a subclass of `DiGraph` and should be preferred. Instead this ends up generating an incorrect reference.  A workaround would be to use a more explicit reference.  

I'm also not sure why it results in an `OSError` and craashes the build instead of just producing a warning--is the doc build configured to promote all warnings to exceptions?

Upstream: Not yet reported upstream; Will do shortly.

Status: new

Issue created by migration from https://trac.sagemath.org/ticket/20639





---

archive/issue_comments_378448.json:
```json
{
    "body": "Replying to [ticket:20639 embray]:\n> I'm also not sure why it results in an `OSError` and craashes the build instead of just producing a warning--is the doc build configured to promote all warnings to exceptions?\n\n\nYes.",
    "created_at": "2016-05-20T09:53:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20639",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20639#issuecomment-378448",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [ticket:20639 embray]:
> I'm also not sure why it results in an `OSError` and craashes the build instead of just producing a warning--is the doc build configured to promote all warnings to exceptions?


Yes.



---

archive/issue_comments_378449.json:
```json
{
    "body": "<a id='comment:2'></a>\nOkay, thanks for clarifying that.  The fact that it's an `OSError` is weird but otherwise I have no problem with that.",
    "created_at": "2016-05-20T10:11:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20639",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20639#issuecomment-378449",
    "user": "https://github.com/embray"
}
```

<a id='comment:2'></a>
Okay, thanks for clarifying that.  The fact that it's an `OSError` is weird but otherwise I have no problem with that.



---

archive/issue_comments_378450.json:
```json
{
    "body": "<a id='comment:3'></a>\nTo document the **current** class you should use `:meth:`order``\n\nLeading dot is for searching all files; disambiguate as needed `:meth:`.GenericGraph.edge_label``",
    "created_at": "2016-05-21T23:01:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20639",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20639#issuecomment-378450",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:3'></a>
To document the **current** class you should use `:meth:`order``

Leading dot is for searching all files; disambiguate as needed `:meth:`.GenericGraph.edge_label``



---

archive/issue_comments_378451.json:
```json
{
    "body": "<a id='comment:4'></a>\nI see--I would have thought it the other way around though?\n\nI haven't checked--are Sage classes documented with inherited members?",
    "created_at": "2016-05-23T13:03:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20639",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20639#issuecomment-378451",
    "user": "https://github.com/embray"
}
```

<a id='comment:4'></a>
I see--I would have thought it the other way around though?

I haven't checked--are Sage classes documented with inherited members?



---

archive/issue_comments_378452.json:
```json
{
    "body": "<a id='comment:5'></a>\nThe Sphinx docs read:\n\n> Normally, names in these roles are searched first without any further qualification, then with the current module name prepended, then with the current module and class name (if any) prepended. If you prefix the name with a dot, this order is reversed. For example, in the documentation of Python\u2019s codecs module, `:py:func:`open`` always refers to the built-in function, while `:py:func:`.open`` refers to `codecs.open()`.\n\n\nLater it reads:\n\n> Also, if the name is prefixed with a dot, and no exact match is found, the target is taken as a suffix and all object names with that suffix are searched. For example, `:py:meth:`.TarFile.close`` references the `tarfile.TarFile.close()` function, even if the current module is not tarfile. Since this can get ambiguous, if there is more than one possible match, you will get a warning from Sphinx.\n\n\nSo that does more or less reflect the current behavior accurately.  However, for attributes and methods of classes, the matching should take into consideration the class's subclasses, and currently it does not.  So it complains about ambiguity when really there's nothing ambiguous.",
    "created_at": "2016-05-25T15:28:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20639",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20639#issuecomment-378452",
    "user": "https://github.com/embray"
}
```

<a id='comment:5'></a>
The Sphinx docs read:

> Normally, names in these roles are searched first without any further qualification, then with the current module name prepended, then with the current module and class name (if any) prepended. If you prefix the name with a dot, this order is reversed. For example, in the documentation of Pythonâ€™s codecs module, `:py:func:`open`` always refers to the built-in function, while `:py:func:`.open`` refers to `codecs.open()`.


Later it reads:

> Also, if the name is prefixed with a dot, and no exact match is found, the target is taken as a suffix and all object names with that suffix are searched. For example, `:py:meth:`.TarFile.close`` references the `tarfile.TarFile.close()` function, even if the current module is not tarfile. Since this can get ambiguous, if there is more than one possible match, you will get a warning from Sphinx.


So that does more or less reflect the current behavior accurately.  However, for attributes and methods of classes, the matching should take into consideration the class's subclasses, and currently it does not.  So it complains about ambiguity when really there's nothing ambiguous.



---

archive/issue_comments_378453.json:
```json
{
    "body": "<a id='comment:6'></a>\nI think maybe this is not really a problem anymore since #21044, of this was a symptom, was fixed.  I still think the logic in Sphinx might not be perfect here, but as long as reference data is not being unnecessarily shared between docs, as fixed in #21044, this is less likely to come up.",
    "created_at": "2017-04-24T15:09:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20639",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20639#issuecomment-378453",
    "user": "https://github.com/embray"
}
```

<a id='comment:6'></a>
I think maybe this is not really a problem anymore since #21044, of this was a symptom, was fixed.  I still think the logic in Sphinx might not be perfect here, but as long as reference data is not being unnecessarily shared between docs, as fixed in #21044, this is less likely to come up.
