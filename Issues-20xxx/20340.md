# Issue 20340: GRS decode_to_code and decode_to_message fail on messages in the code

archive/issues_020103.json:
```json
{
    "assignees": [],
    "body": "Currently, the following occurs\n\n```python\nsage: F = GF(59)\nsage: length = 40\nsage: dimension = 12\nsage: eval_pts = F.list()[:length]\nsage: col_mults = F.list()[1:length+1]\nsage: C = codes.GeneralizedReedSolomonCode(eval_pts, dimension, col_mults)\nsage: msg = random_vector(F, dimension)\nsage: c = C.encode(msg)\nsage: c in C\nTrue\nsage: c.decode_to_code(c)\n7 # random; first entry of msg (expected c)\nsage: c.decode_to_message(c)\nTraceback (most recent call last)\n...\nTypeError: 'sage.rings.finite_rings.integer_mod.IntegerMod_int' object is not iterable\n```\n\nWe expect:\n\n```python\n...\nsage: c.decode_to_code(c) == c\nTrue\nsage: c.decode_to_message(c) == msg\nTrue\n```\n\n\nCC:  @sagetrac-dlucas\n\nBranch/Commit: **[d4bbfdd](https://github.com/sagemath/sagetrac-mirror/commit/d4bbfddd4682577d0f1e79a1303d7cf07cad8657)**\n\nReviewer: **David Lucas**\n\nAuthor: **Julien Lavauzelle**\n\nComponent: **coding theory**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/20340_\n\n",
    "closed_at": "2016-04-08T00:25:46Z",
    "created_at": "2016-03-31T21:58:43Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20coding%20theory",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-7.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "GRS decode_to_code and decode_to_message fail on messages in the code",
    "type": "issue",
    "updated_at": "2016-04-08T00:25:46Z",
    "url": "https://github.com/sagemath/sage/issues/20340",
    "user": "https://github.com/sagetrac-cprior"
}
```
Currently, the following occurs

```python
sage: F = GF(59)
sage: length = 40
sage: dimension = 12
sage: eval_pts = F.list()[:length]
sage: col_mults = F.list()[1:length+1]
sage: C = codes.GeneralizedReedSolomonCode(eval_pts, dimension, col_mults)
sage: msg = random_vector(F, dimension)
sage: c = C.encode(msg)
sage: c in C
True
sage: c.decode_to_code(c)
7 # random; first entry of msg (expected c)
sage: c.decode_to_message(c)
Traceback (most recent call last)
...
TypeError: 'sage.rings.finite_rings.integer_mod.IntegerMod_int' object is not iterable
```

We expect:

```python
...
sage: c.decode_to_code(c) == c
True
sage: c.decode_to_message(c) == msg
True
```


CC:  @sagetrac-dlucas

Branch/Commit: **[d4bbfdd](https://github.com/sagemath/sagetrac-mirror/commit/d4bbfddd4682577d0f1e79a1303d7cf07cad8657)**

Reviewer: **David Lucas**

Author: **Julien Lavauzelle**

Component: **coding theory**

_Issue created by migration from https://trac.sagemath.org/ticket/20340_





---

archive/issue_events_287080.json:
```json
{
    "actor": "https://github.com/sagetrac-cprior",
    "created_at": "2016-03-31T21:58:43Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/20340",
    "milestone_number": null,
    "milestone_title": "sage-7.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20340#event-287080"
}
```



---

archive/issue_events_287081.json:
```json
{
    "actor": "https://github.com/sagetrac-cprior",
    "created_at": "2016-03-31T21:58:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20340",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20coding%20theory",
    "label_color": "0000ff",
    "label_name": "c: coding theory",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20340#event-287081"
}
```



---

archive/issue_events_287082.json:
```json
{
    "actor": "https://github.com/sagetrac-cprior",
    "created_at": "2016-03-31T21:58:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20340",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20340#event-287082"
}
```



---

archive/issue_events_287083.json:
```json
{
    "actor": "https://github.com/sagetrac-cprior",
    "created_at": "2016-03-31T21:58:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20340",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20340#event-287083"
}
```



---

archive/issue_comments_293296.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nHi,\n\nI think you mixed codeword and code in your script. Both `decode_to_code` and `decode_to_message` are methods of the code's class. So the good syntax is:\n\n```python\nsage: C.decode_to_code(c) == c\nsage: C.decode_to_message(c) == msg\n```\n\nJulien",
    "created_at": "2016-04-04T07:10:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20340#issuecomment-293296",
    "user": "https://github.com/jlavauzelle"
}
```

<div id="comment:1" align="right">comment:1</div>

Hi,

I think you mixed codeword and code in your script. Both `decode_to_code` and `decode_to_message` are methods of the code's class. So the good syntax is:

```python
sage: C.decode_to_code(c) == c
sage: C.decode_to_message(c) == msg
```

Julien



---

archive/issue_comments_293297.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nHi again,\n\nMy mistake, I didn't run the most recent version of Sage. Your typo fooled me, but you're completely right, there's indeed an issue with these methods.\n\nJulien",
    "created_at": "2016-04-05T06:51:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20340#issuecomment-293297",
    "user": "https://github.com/jlavauzelle"
}
```

<div id="comment:2" align="right">comment:2</div>

Hi again,

My mistake, I didn't run the most recent version of Sage. Your typo fooled me, but you're completely right, there's indeed an issue with these methods.

Julien



---

archive/issue_comments_293298.json:
```json
{
    "body": "Branch: **[u/jlavauzelle/fix_decode_methods](https://github.com/sagemath/sagetrac-mirror/tree/u/jlavauzelle/fix_decode_methods)**",
    "created_at": "2016-04-06T10:58:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20340#issuecomment-293298",
    "user": "https://github.com/jlavauzelle"
}
```

Branch: **[u/jlavauzelle/fix_decode_methods](https://github.com/sagemath/sagetrac-mirror/tree/u/jlavauzelle/fix_decode_methods)**



---

archive/issue_comments_293299.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nHello,\n\nJust a few remarks:\n\n- when you push a fix on a ticket, don't forget to change its state to `needs_review`\n- you can also put your (full) name on the `Authors` field\n- and when it's a bug fix, you can add a new doctest which shows the bug has been fixed, e.g.\n\n\n```\nEXAMPLES:\n\nThe bug detailed in trac #20340 has been fixed::\n\n    sage: C = codes.GeneralizedReedSolomonCode(GF(59).list()[:40], 12)\n    sage: c = C.random_element()\n    sage: D = C.decoder(\"BerlekampWelch\")\n    sage: D.decode_to_code(c) == c\n    True\n```\n\nOtherwise, it seems all good to me!\n\nBest,\n\nDavid\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4bca107e876219e61793fbfa5e8d7e2cbca1f044\">4bca107</a></td><td><code>Fixed error on _decode_to_code_and_message() methods</code></td></tr></table>\n",
    "created_at": "2016-04-06T11:43:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20340#issuecomment-293299",
    "user": "https://github.com/sagetrac-dlucas"
}
```

<div id="comment:4" align="right">comment:4</div>

Hello,

Just a few remarks:

- when you push a fix on a ticket, don't forget to change its state to `needs_review`
- you can also put your (full) name on the `Authors` field
- and when it's a bug fix, you can add a new doctest which shows the bug has been fixed, e.g.


```
EXAMPLES:

The bug detailed in trac #20340 has been fixed::

    sage: C = codes.GeneralizedReedSolomonCode(GF(59).list()[:40], 12)
    sage: c = C.random_element()
    sage: D = C.decoder("BerlekampWelch")
    sage: D.decode_to_code(c) == c
    True
```

Otherwise, it seems all good to me!

Best,

David

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4bca107e876219e61793fbfa5e8d7e2cbca1f044">4bca107</a></td><td><code>Fixed error on _decode_to_code_and_message() methods</code></td></tr></table>




---

archive/issue_comments_293300.json:
```json
{
    "body": "Commit: **[4bca107](https://github.com/sagemath/sagetrac-mirror/commit/4bca107e876219e61793fbfa5e8d7e2cbca1f044)**",
    "created_at": "2016-04-06T11:43:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20340#issuecomment-293300",
    "user": "https://github.com/sagetrac-dlucas"
}
```

Commit: **[4bca107](https://github.com/sagemath/sagetrac-mirror/commit/4bca107e876219e61793fbfa5e8d7e2cbca1f044)**



---

archive/issue_comments_293301.json:
```json
{
    "body": "Author: **Julien Lavauzelle**",
    "created_at": "2016-04-06T20:58:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20340#issuecomment-293301",
    "user": "https://github.com/jlavauzelle"
}
```

Author: **Julien Lavauzelle**



---

archive/issue_comments_293302.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nThanks David,\n\nFollowing your advice, I added the doctest and some short summaries of the decoders in the top documentation of the grs.py file.\n\nBest,\n\nJulien",
    "created_at": "2016-04-06T20:58:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20340#issuecomment-293302",
    "user": "https://github.com/jlavauzelle"
}
```

<div id="comment:5" align="right">comment:5</div>

Thanks David,

Following your advice, I added the doctest and some short summaries of the decoders in the top documentation of the grs.py file.

Best,

Julien



---

archive/issue_events_287084.json:
```json
{
    "actor": "https://github.com/jlavauzelle",
    "created_at": "2016-04-06T20:58:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20340",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20340#event-287084"
}
```



---

archive/issue_comments_293303.json:
```json
{
    "body": "<div id=\"comment:6\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e4bdd3d561883ffe012fbf23284819f242d72024\">e4bdd3d</a></td><td><code>Add a doctest and fix documentation.</code></td></tr></table>\n",
    "created_at": "2016-04-06T21:05:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20340#issuecomment-293303",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:6"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e4bdd3d561883ffe012fbf23284819f242d72024">e4bdd3d</a></td><td><code>Add a doctest and fix documentation.</code></td></tr></table>




---

archive/issue_comments_293304.json:
```json
{
    "body": "Changed commit from **[4bca107](https://github.com/sagemath/sagetrac-mirror/commit/4bca107e876219e61793fbfa5e8d7e2cbca1f044)** to **[e4bdd3d](https://github.com/sagemath/sagetrac-mirror/commit/e4bdd3d561883ffe012fbf23284819f242d72024)**",
    "created_at": "2016-04-06T21:05:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20340#issuecomment-293304",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[4bca107](https://github.com/sagemath/sagetrac-mirror/commit/4bca107e876219e61793fbfa5e8d7e2cbca1f044)** to **[e4bdd3d](https://github.com/sagemath/sagetrac-mirror/commit/e4bdd3d561883ffe012fbf23284819f242d72024)**



---

archive/issue_comments_293305.json:
```json
{
    "body": "Changed branch from **[u/jlavauzelle/fix_decode_methods](https://github.com/sagemath/sagetrac-mirror/tree/u/jlavauzelle/fix_decode_methods)** to **[u/dlucas/fix_decode_methods](https://github.com/sagemath/sagetrac-mirror/tree/u/dlucas/fix_decode_methods)**",
    "created_at": "2016-04-07T08:02:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20340#issuecomment-293305",
    "user": "https://github.com/sagetrac-dlucas"
}
```

Changed branch from **[u/jlavauzelle/fix_decode_methods](https://github.com/sagemath/sagetrac-mirror/tree/u/jlavauzelle/fix_decode_methods)** to **[u/dlucas/fix_decode_methods](https://github.com/sagemath/sagetrac-mirror/tree/u/dlucas/fix_decode_methods)**



---

archive/issue_comments_293306.json:
```json
{
    "body": "Changed commit from **[e4bdd3d](https://github.com/sagemath/sagetrac-mirror/commit/e4bdd3d561883ffe012fbf23284819f242d72024)** to **[d4bbfdd](https://github.com/sagemath/sagetrac-mirror/commit/d4bbfddd4682577d0f1e79a1303d7cf07cad8657)**",
    "created_at": "2016-04-07T08:03:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20340#issuecomment-293306",
    "user": "https://github.com/sagetrac-dlucas"
}
```

Changed commit from **[e4bdd3d](https://github.com/sagemath/sagetrac-mirror/commit/e4bdd3d561883ffe012fbf23284819f242d72024)** to **[d4bbfdd](https://github.com/sagemath/sagetrac-mirror/commit/d4bbfddd4682577d0f1e79a1303d7cf07cad8657)**



---

archive/issue_comments_293307.json:
```json
{
    "body": "Reviewer: **David Lucas**",
    "created_at": "2016-04-07T08:03:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20340#issuecomment-293307",
    "user": "https://github.com/sagetrac-dlucas"
}
```

Reviewer: **David Lucas**



---

archive/issue_comments_293308.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nHello,\n\nI copied your doctest in every method which was previously impacted by the bug.\nIf you agree with my changes, set it to `positive_review`, on my side, I'm fine with your fix.\n\nDavid\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d4bbfddd4682577d0f1e79a1303d7cf07cad8657\">d4bbfdd</a></td><td><code>Replicated doctest for the fixed bug in every (once) flawed method</code></td></tr></table>\n",
    "created_at": "2016-04-07T08:03:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20340#issuecomment-293308",
    "user": "https://github.com/sagetrac-dlucas"
}
```

<div id="comment:8" align="right">comment:8</div>

Hello,

I copied your doctest in every method which was previously impacted by the bug.
If you agree with my changes, set it to `positive_review`, on my side, I'm fine with your fix.

David

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d4bbfddd4682577d0f1e79a1303d7cf07cad8657">d4bbfdd</a></td><td><code>Replicated doctest for the fixed bug in every (once) flawed method</code></td></tr></table>




---

archive/issue_events_287085.json:
```json
{
    "actor": "https://github.com/jlavauzelle",
    "created_at": "2016-04-07T13:05:26Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20340",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20340#event-287085"
}
```



---

archive/issue_events_287086.json:
```json
{
    "actor": "https://github.com/jlavauzelle",
    "created_at": "2016-04-07T13:05:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20340",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20340#event-287086"
}
```



---

archive/issue_comments_293309.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nNice, thanks a lot,\n\nJulien",
    "created_at": "2016-04-07T13:05:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20340#issuecomment-293309",
    "user": "https://github.com/jlavauzelle"
}
```

<div id="comment:9" align="right">comment:9</div>

Nice, thanks a lot,

Julien



---

archive/issue_comments_293310.json:
```json
{
    "body": "Changed branch from **[u/dlucas/fix_decode_methods](https://github.com/sagemath/sagetrac-mirror/tree/u/dlucas/fix_decode_methods)** to **[d4bbfdd](https://github.com/sagemath/sagetrac-mirror/commit/d4bbfddd4682577d0f1e79a1303d7cf07cad8657)**",
    "created_at": "2016-04-08T00:25:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20340",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20340#issuecomment-293310",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/dlucas/fix_decode_methods](https://github.com/sagemath/sagetrac-mirror/tree/u/dlucas/fix_decode_methods)** to **[d4bbfdd](https://github.com/sagemath/sagetrac-mirror/commit/d4bbfddd4682577d0f1e79a1303d7cf07cad8657)**



---

archive/issue_events_287087.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-04-08T00:25:46Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20340",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20340#event-287087"
}
```



---

archive/issue_events_287088.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "4a330478e72eaa39c7739cc6dc8f4ea8ac5e940a",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2016-04-08T00:25:46Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/20340",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20340#event-287088"
}
```
