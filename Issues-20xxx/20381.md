# Issue 20381: Patch to brial to get it building again on Cygwin

archive/issues_020144.json:
```json
{
    "body": "brial doesn't build on Cygwin due to some inconsistency of how `__STRICT_ANSI__` is handled by C++ on Cygwin.  Changing `-std=c++98` to `-std=gnu++98` works around this behavior--I don't think there's any reason brial *must* be build with strict ANSI C++.\n\nNevertheless this is an issue more with Cygwin than anything else.\nI don't know if this has been reported upstream to Cygwin but it seems to be a very old issue.  Likewise it would be good if a workaround were upstreamed to brial.\n\n**Keywords:** cygwin windows brial\n\n**Branch:** [84b0513a4055a606716b74863dcc78d49e8235a7](https://github.com/sagemath/sagetrac-mirror/commit/84b0513a4055a606716b74863dcc78d49e8235a7)\n\n**Reviewer:** Sebastien Gouezel, Erik Bray\n\n**Author:** Erik Bray, Sebastien Gouezel\n\nIssue created by migration from https://trac.sagemath.org/ticket/20381\n\n",
    "closed_at": "2016-04-28T15:36:24Z",
    "created_at": "2016-04-07T16:35:37Z",
    "labels": [
        "component: build",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-7.2",
    "title": "Patch to brial to get it building again on Cygwin",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/20381",
    "user": "https://github.com/embray"
}
```
brial doesn't build on Cygwin due to some inconsistency of how `__STRICT_ANSI__` is handled by C++ on Cygwin.  Changing `-std=c++98` to `-std=gnu++98` works around this behavior--I don't think there's any reason brial *must* be build with strict ANSI C++.

Nevertheless this is an issue more with Cygwin than anything else.
I don't know if this has been reported upstream to Cygwin but it seems to be a very old issue.  Likewise it would be good if a workaround were upstreamed to brial.

**Keywords:** cygwin windows brial

**Branch:** [84b0513a4055a606716b74863dcc78d49e8235a7](https://github.com/sagemath/sagetrac-mirror/commit/84b0513a4055a606716b74863dcc78d49e8235a7)

**Reviewer:** Sebastien Gouezel, Erik Bray

**Author:** Erik Bray, Sebastien Gouezel

Issue created by migration from https://trac.sagemath.org/ticket/20381





---

archive/issue_events_182910.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2016-04-07T16:35:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20381#event-182910"
}
```



---

archive/issue_comments_296457.json:
```json
{
    "body": "<a id='comment:2'></a>\nThat said, [this post](https://cygwin.com/ml/cygwin/2010-01/msg00791.html) seems to make a good argument that Cygwin's behavior is *more* correct than the standard gcc in this regard.  It's inconvenient but seemingly not wrong.  So maybe just forget about it and just bring the issue to brial.",
    "created_at": "2016-04-07T16:49:30Z",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20381#issuecomment-296457",
    "user": "https://github.com/embray"
}
```

<a id='comment:2'></a>
That said, [this post](https://cygwin.com/ml/cygwin/2010-01/msg00791.html) seems to make a good argument that Cygwin's behavior is *more* correct than the standard gcc in this regard.  It's inconvenient but seemingly not wrong.  So maybe just forget about it and just bring the issue to brial.



---

archive/issue_comments_296458.json:
```json
{
    "body": "<a id='comment:3'></a>\nIn any case, I would prefer to apply this patch always, not only on Cygwin.",
    "created_at": "2016-04-07T17:25:37Z",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20381#issuecomment-296458",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:3'></a>
In any case, I would prefer to apply this patch always, not only on Cygwin.



---

archive/issue_comments_296459.json:
```json
{
    "body": "<a id='comment:4'></a>\nOh? I have nothing against that I'm just curious why it would be preferable always?",
    "created_at": "2016-04-07T17:27:24Z",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20381#issuecomment-296459",
    "user": "https://github.com/embray"
}
```

<a id='comment:4'></a>
Oh? I have nothing against that I'm just curious why it would be preferable always?



---

archive/issue_comments_296460.json:
```json
{
    "body": "<a id='comment:5'></a>\nPlease add your name in the Author field.",
    "created_at": "2016-04-07T18:49:57Z",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20381#issuecomment-296460",
    "user": "https://github.com/videlec"
}
```

<a id='comment:5'></a>
Please add your name in the Author field.



---

archive/issue_comments_296461.json:
```json
{
    "body": "**Author:** embray",
    "created_at": "2016-04-07T18:58:52Z",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20381#issuecomment-296461",
    "user": "https://github.com/embray"
}
```

**Author:** embray



---

archive/issue_comments_296462.json:
```json
{
    "body": "**Changing author** from \"embray\" to \"Erik Bray\".",
    "created_at": "2016-04-07T19:01:02Z",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20381#issuecomment-296462",
    "user": "https://github.com/videlec"
}
```

**Changing author** from "embray" to "Erik Bray".



---

archive/issue_comments_296463.json:
```json
{
    "body": "**Changing commit** from \"[5bbcadaa8b0d9a14357cfa4aed31a4bf95f23b30](https://github.com/sagemath/sagetrac-mirror/commit/5bbcadaa8b0d9a14357cfa4aed31a4bf95f23b30)\" to \"[db84ff01e1ba5c78f84d547ffcaf8fb3b74a71fe](https://github.com/sagemath/sagetrac-mirror/commit/db84ff01e1ba5c78f84d547ffcaf8fb3b74a71fe)\".",
    "created_at": "2016-04-07T19:01:49Z",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20381#issuecomment-296463",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[5bbcadaa8b0d9a14357cfa4aed31a4bf95f23b30](https://github.com/sagemath/sagetrac-mirror/commit/5bbcadaa8b0d9a14357cfa4aed31a4bf95f23b30)" to "[db84ff01e1ba5c78f84d547ffcaf8fb3b74a71fe](https://github.com/sagemath/sagetrac-mirror/commit/db84ff01e1ba5c78f84d547ffcaf8fb3b74a71fe)".



---

archive/issue_comments_296464.json:
```json
{
    "body": "<a id='comment:8'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/db84ff01e1ba5c78f84d547ffcaf8fb3b74a71fe\">db84ff0</a></td><td><code>As requested, apply the patch on all platforms, not just cygwin</code></td></tr></table>\n",
    "created_at": "2016-04-07T19:01:49Z",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20381#issuecomment-296464",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/db84ff01e1ba5c78f84d547ffcaf8fb3b74a71fe">db84ff0</a></td><td><code>As requested, apply the patch on all platforms, not just cygwin</code></td></tr></table>




---

archive/issue_events_182911.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/gouezel",
    "created_at": "2016-04-08T15:45:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20381#event-182911"
}
```



---

archive/issue_events_182912.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/gouezel",
    "created_at": "2016-04-08T15:45:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20381#event-182912"
}
```



---

archive/issue_comments_296465.json:
```json
{
    "body": "<a id='comment:9'></a>\nThe patch is not enough for me: even with the patch, compilation lines still have `-std=c++98` and not `-std=gnu++98`. After `autoreconf`, however, eveything becomes fine, so I guess the patch is only missing the `autoreconf` output. (More details in #17622, [comment:5](#comment%3A5))",
    "created_at": "2016-04-08T15:45:31Z",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20381#issuecomment-296465",
    "user": "https://trac.sagemath.org/admin/accounts/users/gouezel"
}
```

<a id='comment:9'></a>
The patch is not enough for me: even with the patch, compilation lines still have `-std=c++98` and not `-std=gnu++98`. After `autoreconf`, however, eveything becomes fine, so I guess the patch is only missing the `autoreconf` output. (More details in #17622, [comment:5](#comment%3A5))



---

archive/issue_comments_296466.json:
```json
{
    "body": "<a id='comment:10'></a>\nI have added the necessary autoconfed bits. With the new branch, this works for me.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/84b0513a4055a606716b74863dcc78d49e8235a7\">84b0513</a></td><td><code> #20381: Using std=c++98 breaks on Cygwin</code></td></tr></table>\n",
    "created_at": "2016-04-08T18:45:05Z",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20381#issuecomment-296466",
    "user": "https://trac.sagemath.org/admin/accounts/users/gouezel"
}
```

<a id='comment:10'></a>
I have added the necessary autoconfed bits. With the new branch, this works for me.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/84b0513a4055a606716b74863dcc78d49e8235a7">84b0513</a></td><td><code> #20381: Using std=c++98 breaks on Cygwin</code></td></tr></table>




---

archive/issue_events_182913.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/gouezel",
    "created_at": "2016-04-08T18:45:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20381#event-182913"
}
```



---

archive/issue_events_182914.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/gouezel",
    "created_at": "2016-04-08T18:45:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20381#event-182914"
}
```



---

archive/issue_comments_296467.json:
```json
{
    "body": "**Changing branch** from \"[u/embray/brial-cygwin-patch](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/brial-cygwin-patch)\" to \"[u/gouezel/brial-cygwin-patch](https://github.com/sagemath/sagetrac-mirror/tree/u/gouezel/brial-cygwin-patch)\".",
    "created_at": "2016-04-08T18:45:05Z",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20381#issuecomment-296467",
    "user": "https://trac.sagemath.org/admin/accounts/users/gouezel"
}
```

**Changing branch** from "[u/embray/brial-cygwin-patch](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/brial-cygwin-patch)" to "[u/gouezel/brial-cygwin-patch](https://github.com/sagemath/sagetrac-mirror/tree/u/gouezel/brial-cygwin-patch)".



---

archive/issue_comments_296468.json:
```json
{
    "body": "**Changing commit** from \"[db84ff01e1ba5c78f84d547ffcaf8fb3b74a71fe](https://github.com/sagemath/sagetrac-mirror/commit/db84ff01e1ba5c78f84d547ffcaf8fb3b74a71fe)\" to \"[84b0513a4055a606716b74863dcc78d49e8235a7](https://github.com/sagemath/sagetrac-mirror/commit/84b0513a4055a606716b74863dcc78d49e8235a7)\".",
    "created_at": "2016-04-08T18:45:05Z",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20381#issuecomment-296468",
    "user": "https://trac.sagemath.org/admin/accounts/users/gouezel"
}
```

**Changing commit** from "[db84ff01e1ba5c78f84d547ffcaf8fb3b74a71fe](https://github.com/sagemath/sagetrac-mirror/commit/db84ff01e1ba5c78f84d547ffcaf8fb3b74a71fe)" to "[84b0513a4055a606716b74863dcc78d49e8235a7](https://github.com/sagemath/sagetrac-mirror/commit/84b0513a4055a606716b74863dcc78d49e8235a7)".



---

archive/issue_comments_296469.json:
```json
{
    "body": "<a id='comment:11'></a>\nOkay, I was a little confused by this before too.  Why is there a separate set of patches under `patches/build/`?  When are the \"build\" patches applied?  I didn't need this myself.",
    "created_at": "2016-04-11T12:13:51Z",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20381#issuecomment-296469",
    "user": "https://github.com/embray"
}
```

<a id='comment:11'></a>
Okay, I was a little confused by this before too.  Why is there a separate set of patches under `patches/build/`?  When are the "build" patches applied?  I didn't need this myself.



---

archive/issue_comments_296470.json:
```json
{
    "body": "<a id='comment:12'></a>\nCopy/pasted from jpflori's comment at #17622:\n\nThe patches in build_system directory are those you need to apply to the brial build system before autotools automatically generate the full build system.\nOnce these patches are applied, one can invoke autotools to update the build system and deduce the full patches in the patches directory which don't need autotools invokation anymore and can be applied at build time.\n\n\nTo summarize it's good to ship two set of patches because:\n\n* we can't rely on invoking autotools at build time because it is not a prerequisite and would not be manageable anyway, it's kind of impossible to make sure that the build system will be correctly regenarated with one of the random versions of autotools programs in the wild, therefore the build system has to be regenerated on a dev machine and full patches have to be distributed,\n  \n* the patches only touching the input to autotools are still of interest as these are the ones to be updated manually if we want to introduce further changes in the build system, and the ones to submit upstream for inclusion (and when upstream makes new releases it will regenerate the full build system)",
    "created_at": "2016-04-13T19:56:58Z",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20381#issuecomment-296470",
    "user": "https://trac.sagemath.org/admin/accounts/users/gouezel"
}
```

<a id='comment:12'></a>
Copy/pasted from jpflori's comment at #17622:

The patches in build_system directory are those you need to apply to the brial build system before autotools automatically generate the full build system.
Once these patches are applied, one can invoke autotools to update the build system and deduce the full patches in the patches directory which don't need autotools invokation anymore and can be applied at build time.


To summarize it's good to ship two set of patches because:

* we can't rely on invoking autotools at build time because it is not a prerequisite and would not be manageable anyway, it's kind of impossible to make sure that the build system will be correctly regenarated with one of the random versions of autotools programs in the wild, therefore the build system has to be regenerated on a dev machine and full patches have to be distributed,
  
* the patches only touching the input to autotools are still of interest as these are the ones to be updated manually if we want to introduce further changes in the build system, and the ones to submit upstream for inclusion (and when upstream makes new releases it will regenerate the full build system)



---

archive/issue_comments_296471.json:
```json
{
    "body": "<a id='comment:13'></a>\nDid you try dropping the `-std=gnu++98` argument completely? Is it a problem if C++03 or C++11 is used?",
    "created_at": "2016-04-13T20:01:00Z",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20381#issuecomment-296471",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:13'></a>
Did you try dropping the `-std=gnu++98` argument completely? Is it a problem if C++03 or C++11 is used?



---

archive/issue_comments_296472.json:
```json
{
    "body": "<a id='comment:14'></a>\nI should add that I am surprised that your patch was enough for you, since it wasn't for me and our settings should be comparable. Are you sure that you did not do `autoreconf` at some point manually, that was accidentally not included in the patch? To test that your patch was enough for you, could you start from a clean `develop`, then merge `u/embray/brial-cygwin-patch` and see if it builds without any additional tweaking?",
    "created_at": "2016-04-13T20:02:16Z",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20381#issuecomment-296472",
    "user": "https://trac.sagemath.org/admin/accounts/users/gouezel"
}
```

<a id='comment:14'></a>
I should add that I am surprised that your patch was enough for you, since it wasn't for me and our settings should be comparable. Are you sure that you did not do `autoreconf` at some point manually, that was accidentally not included in the patch? To test that your patch was enough for you, could you start from a clean `develop`, then merge `u/embray/brial-cygwin-patch` and see if it builds without any additional tweaking?



---

archive/issue_comments_296473.json:
```json
{
    "body": "<a id='comment:15'></a>\nNote that upstream for brial is really Sage. It's a Sage fork of the abandoned project PolyBoRi. So it might be best to just make a new release of brial and use that.",
    "created_at": "2016-04-13T20:03:23Z",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20381#issuecomment-296473",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:15'></a>
Note that upstream for brial is really Sage. It's a Sage fork of the abandoned project PolyBoRi. So it might be best to just make a new release of brial and use that.



---

archive/issue_comments_296474.json:
```json
{
    "body": "<a id='comment:16'></a>\nThis all seems to be under the assumption that one would have already built \"brial\" once before and already have the autotools-generated files lying around. But I don't know why you would assume that to be the case in general.",
    "created_at": "2016-04-14T09:32:34Z",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20381#issuecomment-296474",
    "user": "https://github.com/embray"
}
```

<a id='comment:16'></a>
This all seems to be under the assumption that one would have already built "brial" once before and already have the autotools-generated files lying around. But I don't know why you would assume that to be the case in general.



---

archive/issue_comments_296475.json:
```json
{
    "body": "<a id='comment:17'></a>\nSorry, I don't get what you mean.\n\nAgain, `autotools` is **not** a requirement of Sagemath, and building a package does **not** run autotools: as is customary, it only does `./configure` and `make`. So the `autotools` steps should be done by the package maintainer, inside the `spkg`. If a patch changes a file used by `autotools`, then it should also include the subsequent modifications made by the `autotools` invocation.",
    "created_at": "2016-04-14T09:49:00Z",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20381#issuecomment-296475",
    "user": "https://trac.sagemath.org/admin/accounts/users/gouezel"
}
```

<a id='comment:17'></a>
Sorry, I don't get what you mean.

Again, `autotools` is **not** a requirement of Sagemath, and building a package does **not** run autotools: as is customary, it only does `./configure` and `make`. So the `autotools` steps should be done by the package maintainer, inside the `spkg`. If a patch changes a file used by `autotools`, then it should also include the subsequent modifications made by the `autotools` invocation.



---

archive/issue_comments_296476.json:
```json
{
    "body": "<a id='comment:18'></a>\n> Again, autotools is not a requirement of Sagemath\n\n\nOkay, that's what wasn't clear to me.  I think it's not always clear what sage does to modify source packages, versus what it does to modify extracted source packages at build time (or indeed, if sage publishes its own source packages, why even apply build-time patches at all?)",
    "created_at": "2016-04-14T10:14:45Z",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20381#issuecomment-296476",
    "user": "https://github.com/embray"
}
```

<a id='comment:18'></a>
> Again, autotools is not a requirement of Sagemath


Okay, that's what wasn't clear to me.  I think it's not always clear what sage does to modify source packages, versus what it does to modify extracted source packages at build time (or indeed, if sage publishes its own source packages, why even apply build-time patches at all?)



---

archive/issue_comments_296477.json:
```json
{
    "body": "<a id='comment:19'></a>\nThe idea is that source packages should be official source releases provided by upstream, without any modification. All modifications should come from patches. In this way, it is easy to keep sage's modifications when upstream releases a new version.",
    "created_at": "2016-04-14T10:23:44Z",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20381#issuecomment-296477",
    "user": "https://trac.sagemath.org/admin/accounts/users/gouezel"
}
```

<a id='comment:19'></a>
The idea is that source packages should be official source releases provided by upstream, without any modification. All modifications should come from patches. In this way, it is easy to keep sage's modifications when upstream releases a new version.



---

archive/issue_comments_296478.json:
```json
{
    "body": "<a id='comment:20'></a>\n> The idea is that source packages should be official source releases provided by upstream, without any modification\n\n\nI think we're talking past each other, or some terms aren't clearly defined. Because to me this directly contradicts what you wrote just previously (and also my own experience which is that sage builds its own modified source tarballs in some cases).  Is this all documented somewhere?",
    "created_at": "2016-04-14T10:28:05Z",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20381#issuecomment-296478",
    "user": "https://github.com/embray"
}
```

<a id='comment:20'></a>
> The idea is that source packages should be official source releases provided by upstream, without any modification


I think we're talking past each other, or some terms aren't clearly defined. Because to me this directly contradicts what you wrote just previously (and also my own experience which is that sage builds its own modified source tarballs in some cases).  Is this all documented somewhere?



---

archive/issue_comments_296479.json:
```json
{
    "body": "<a id='comment:21'></a>\nIn general, to compile a program from source, you don't need autotools, just run `./configure` and `make`. This means its release manager will run autotools before releasing an official source tarball. \n\nThen this (official, already autotoolified) source tarball will be the sage source package, downloaded in the `upstream`directory. If some patches to this source package are needed for sage, they will be added just before build: the usual package installation process uncompresses the official source, incorporates the patches, then runs `./configure`, `make` and `make install`, with additional flags if necessary.",
    "created_at": "2016-04-14T11:30:44Z",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20381#issuecomment-296479",
    "user": "https://trac.sagemath.org/admin/accounts/users/gouezel"
}
```

<a id='comment:21'></a>
In general, to compile a program from source, you don't need autotools, just run `./configure` and `make`. This means its release manager will run autotools before releasing an official source tarball. 

Then this (official, already autotoolified) source tarball will be the sage source package, downloaded in the `upstream`directory. If some patches to this source package are needed for sage, they will be added just before build: the usual package installation process uncompresses the official source, incorporates the patches, then runs `./configure`, `make` and `make install`, with additional flags if necessary.



---

archive/issue_comments_296480.json:
```json
{
    "body": "<a id='comment:22'></a>\n> In general, to compile a program from source, you don't need autotools, just run ./configure and make\n\n\nIt depends. My confusion perhaps stems from the fact that some (probably most?) projects include `./configure` in their source tarballs, but some don't.\n\n> If some patches to this source package are needed for sage, they will be added just before build\n\n\nThere are some exceptions, which is another source of my confusion.  For example [ecl](https://github.com/sagemath/sagetrac-mirror/blob/develop/build/pkgs/ecl?h=develop) has patches that are applied to the source tarball before uploading to sage's package mirrors.  I guessed that maybe the same was being done for brial but I was wrong in this case.  What's further confusing is that although the separate `brial/patches/build/` patches *exist* in the repository, nothing ever seems to apply them (I was expecting to find maybe an `spkg-src` script that applies them).  I sort of get the point though--it's just demonstrating what would be patched before running `autoreconf` or the like.  *shrug*",
    "created_at": "2016-04-14T12:12:01Z",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20381#issuecomment-296480",
    "user": "https://github.com/embray"
}
```

<a id='comment:22'></a>
> In general, to compile a program from source, you don't need autotools, just run ./configure and make


It depends. My confusion perhaps stems from the fact that some (probably most?) projects include `./configure` in their source tarballs, but some don't.

> If some patches to this source package are needed for sage, they will be added just before build


There are some exceptions, which is another source of my confusion.  For example [ecl](https://github.com/sagemath/sagetrac-mirror/blob/develop/build/pkgs/ecl?h=develop) has patches that are applied to the source tarball before uploading to sage's package mirrors.  I guessed that maybe the same was being done for brial but I was wrong in this case.  What's further confusing is that although the separate `brial/patches/build/` patches *exist* in the repository, nothing ever seems to apply them (I was expecting to find maybe an `spkg-src` script that applies them).  I sort of get the point though--it's just demonstrating what would be patched before running `autoreconf` or the like.  *shrug*



---

archive/issue_comments_296481.json:
```json
{
    "body": "<a id='comment:23'></a>\nReplying to [embray](#comment%3A22):\n> > In general, to compile a program from source, you don't need autotools, just run ./configure and make\n\n> \n> It depends. My confusion perhaps stems from the fact that some (probably most?) projects include `./configure` in their source tarballs, but some don't.\n\n\nIf they don't include `./configure`, I consider that an upstream bug.",
    "created_at": "2016-04-14T12:27:54Z",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20381#issuecomment-296481",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:23'></a>
Replying to [embray](#comment%3A22):
> > In general, to compile a program from source, you don't need autotools, just run ./configure and make

> 
> It depends. My confusion perhaps stems from the fact that some (probably most?) projects include `./configure` in their source tarballs, but some don't.


If they don't include `./configure`, I consider that an upstream bug.



---

archive/issue_comments_296482.json:
```json
{
    "body": "<a id='comment:24'></a>\nMaybe, maybe not.  Some projects just make their source tarballs by bundling what's in the VCS--sometimes this is done directly though [GitHub](GitHub) or other VCS interfaces.  I don't think it's wrong.  Slightly inconvenient but not wrong.",
    "created_at": "2016-04-15T12:13:45Z",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20381#issuecomment-296482",
    "user": "https://github.com/embray"
}
```

<a id='comment:24'></a>
Maybe, maybe not.  Some projects just make their source tarballs by bundling what's in the VCS--sometimes this is done directly though [GitHub](GitHub) or other VCS interfaces.  I don't think it's wrong.  Slightly inconvenient but not wrong.



---

archive/issue_comments_296483.json:
```json
{
    "body": "<a id='comment:25'></a>\nAbove discussion aside this is good to go.  I  haven't tried outright dropping the `-std=gnu++98`. I doubt it's needed but leaving this as is is easier than testing and rewriting the patch since this definitely fixes the issue and we don't really care what C standard it prefers as long as it compiles.",
    "created_at": "2016-04-27T14:11:10Z",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20381#issuecomment-296483",
    "user": "https://github.com/embray"
}
```

<a id='comment:25'></a>
Above discussion aside this is good to go.  I  haven't tried outright dropping the `-std=gnu++98`. I doubt it's needed but leaving this as is is easier than testing and rewriting the patch since this definitely fixes the issue and we don't really care what C standard it prefers as long as it compiles.



---

archive/issue_events_182915.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2016-04-27T14:11:15Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20381#event-182915"
}
```



---

archive/issue_events_182916.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2016-04-27T14:11:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20381#event-182916"
}
```



---

archive/issue_comments_296484.json:
```json
{
    "body": "**Reviewer:** Sebastien Gouezel, Erik Bray",
    "created_at": "2016-04-27T14:16:38Z",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20381#issuecomment-296484",
    "user": "https://trac.sagemath.org/admin/accounts/users/gouezel"
}
```

**Reviewer:** Sebastien Gouezel, Erik Bray



---

archive/issue_comments_296485.json:
```json
{
    "body": "<a id='comment:27'></a>\nI have tested without `-std=gnu++98`, it also works but I agree it is not worth rewriting the patch. I have submitted a pull request upstream fixing this issue and #19643, so hopefully we will be able to drop this patch with the next release of brial.",
    "created_at": "2016-04-27T14:16:38Z",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20381#issuecomment-296485",
    "user": "https://trac.sagemath.org/admin/accounts/users/gouezel"
}
```

<a id='comment:27'></a>
I have tested without `-std=gnu++98`, it also works but I agree it is not worth rewriting the patch. I have submitted a pull request upstream fixing this issue and #19643, so hopefully we will be able to drop this patch with the next release of brial.



---

archive/issue_comments_296486.json:
```json
{
    "body": "**Changing author** from \"Erik Bray\" to \"Erik Bray, Sebastien Gouezel\".",
    "created_at": "2016-04-27T14:16:38Z",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20381#issuecomment-296486",
    "user": "https://trac.sagemath.org/admin/accounts/users/gouezel"
}
```

**Changing author** from "Erik Bray" to "Erik Bray, Sebastien Gouezel".



---

archive/issue_comments_296487.json:
```json
{
    "body": "**Changing branch** from \"[u/gouezel/brial-cygwin-patch](https://github.com/sagemath/sagetrac-mirror/tree/u/gouezel/brial-cygwin-patch)\" to \"[84b0513a4055a606716b74863dcc78d49e8235a7](https://github.com/sagemath/sagetrac-mirror/commit/84b0513a4055a606716b74863dcc78d49e8235a7)\".",
    "created_at": "2016-04-28T15:36:24Z",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20381#issuecomment-296487",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/gouezel/brial-cygwin-patch](https://github.com/sagemath/sagetrac-mirror/tree/u/gouezel/brial-cygwin-patch)" to "[84b0513a4055a606716b74863dcc78d49e8235a7](https://github.com/sagemath/sagetrac-mirror/commit/84b0513a4055a606716b74863dcc78d49e8235a7)".



---

archive/issue_events_182917.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-04-28T15:36:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20381#event-182917"
}
```



---

archive/issue_events_182918.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "62be89a8886f0800a20e07189e68cd67df161816",
    "created_at": "2016-04-28T15:36:24Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20381#event-182918"
}
```



---

archive/issue_comments_296488.json:
```json
{
    "body": "<a id='comment:29'></a>\nWhich this patch, one created a dependence on automake. \nSee https://groups.google.com/d/msg/sage-support/6Xg1RXXw-S0/nKaaeLdrDAAJ\n\nThis should not have happened!",
    "created_at": "2016-05-18T11:49:32Z",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20381#issuecomment-296488",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:29'></a>
Which this patch, one created a dependence on automake. 
See https://groups.google.com/d/msg/sage-support/6Xg1RXXw-S0/nKaaeLdrDAAJ

This should not have happened!



---

archive/issue_comments_296489.json:
```json
{
    "body": "**Changing commit** from \"[84b0513a4055a606716b74863dcc78d49e8235a7](https://github.com/sagemath/sagetrac-mirror/commit/84b0513a4055a606716b74863dcc78d49e8235a7)\" to \"\".",
    "created_at": "2016-05-18T11:49:32Z",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20381#issuecomment-296489",
    "user": "https://github.com/dimpase"
}
```

**Changing commit** from "[84b0513a4055a606716b74863dcc78d49e8235a7](https://github.com/sagemath/sagetrac-mirror/commit/84b0513a4055a606716b74863dcc78d49e8235a7)" to "".



---

archive/issue_comments_296490.json:
```json
{
    "body": "<a id='comment:30'></a>\nNo, I don't believe so.  \n\nWhat I mean to say is, I don't think it has to do with this ticket.  If you scrutinize the patch it's just making some trivial modifications to some lines that already exist.\n\nIt's possible that if a new package for brial was built it wasn't done properly, but I don't know who does that.",
    "created_at": "2016-05-19T10:20:46Z",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20381#issuecomment-296490",
    "user": "https://github.com/embray"
}
```

<a id='comment:30'></a>
No, I don't believe so.  

What I mean to say is, I don't think it has to do with this ticket.  If you scrutinize the patch it's just making some trivial modifications to some lines that already exist.

It's possible that if a new package for brial was built it wasn't done properly, but I don't know who does that.



---

archive/issue_comments_296491.json:
```json
{
    "body": "<a id='comment:31'></a>\nReplying to [embray](#comment%3A30):\n> No, I don't believe so.  \n> \n> What I mean to say is, I don't think it has to do with this ticket.  If you scrutinize the patch it's just making some trivial modifications to some lines that already exist.\n> \n> It's possible that if a new package for brial was built it wasn't done properly, but I don't know who does that.\n\n\nHmm, OK, sorry. Perhaps it's a building issue, like a skew clock or something, that triggers automake run....",
    "created_at": "2016-05-19T10:31:42Z",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20381#issuecomment-296491",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:31'></a>
Replying to [embray](#comment%3A30):
> No, I don't believe so.  
> 
> What I mean to say is, I don't think it has to do with this ticket.  If you scrutinize the patch it's just making some trivial modifications to some lines that already exist.
> 
> It's possible that if a new package for brial was built it wasn't done properly, but I don't know who does that.


Hmm, OK, sorry. Perhaps it's a building issue, like a skew clock or something, that triggers automake run....



---

archive/issue_comments_296492.json:
```json
{
    "body": "<a id='comment:32'></a>\nReplying to [gouezel](#comment%3A27):\n> I have submitted a pull request upstream fixing this issue and #19643, so hopefully\n> we will be able to drop this patch with the next release of brial.\n\n\nFor reference upstream the pull request is at\n    https://github.com/BRiAl/BRiAl/pull/7",
    "created_at": "2016-05-19T10:55:05Z",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20381#issuecomment-296492",
    "user": "https://github.com/slel"
}
```

<a id='comment:32'></a>
Replying to [gouezel](#comment%3A27):
> I have submitted a pull request upstream fixing this issue and #19643, so hopefully
> we will be able to drop this patch with the next release of brial.


For reference upstream the pull request is at
    https://github.com/BRiAl/BRiAl/pull/7



---

archive/issue_comments_296493.json:
```json
{
    "body": "<a id='comment:33'></a>\nReplying to [embray](#comment%3A30):\n> If you scrutinize the patch it's just making some trivial modifications to some lines that already exist.\n\n\nThe mere fact of applying a patch (whether or not it makes trivial modifications) is an important change. It affects timestamps of the patched files which can certainly influence whether automake is needed.",
    "created_at": "2016-05-19T11:30:46Z",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20381#issuecomment-296493",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:33'></a>
Replying to [embray](#comment%3A30):
> If you scrutinize the patch it's just making some trivial modifications to some lines that already exist.


The mere fact of applying a patch (whether or not it makes trivial modifications) is an important change. It affects timestamps of the patched files which can certainly influence whether automake is needed.



---

archive/issue_comments_296494.json:
```json
{
    "body": "<a id='comment:34'></a>\nFor the record: I'm not able to reproduce the automake issue with Sage 7.2 (Linux 3.17.7 on ext4 file system)",
    "created_at": "2016-05-19T11:39:08Z",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20381#issuecomment-296494",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:34'></a>
For the record: I'm not able to reproduce the automake issue with Sage 7.2 (Linux 3.17.7 on ext4 file system)



---

archive/issue_comments_296495.json:
```json
{
    "body": "<a id='comment:35'></a>\nI could reproduce the issue on cygwin. Should be solved with #20634.",
    "created_at": "2016-05-19T19:41:37Z",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20381#issuecomment-296495",
    "user": "https://trac.sagemath.org/admin/accounts/users/gouezel"
}
```

<a id='comment:35'></a>
I could reproduce the issue on cygwin. Should be solved with #20634.



---

archive/issue_comments_296496.json:
```json
{
    "body": "<a id='comment:36'></a>\nI see now, so maybe by patching common.mk for example it retriggered automake.",
    "created_at": "2016-05-20T10:13:06Z",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20381#issuecomment-296496",
    "user": "https://github.com/embray"
}
```

<a id='comment:36'></a>
I see now, so maybe by patching common.mk for example it retriggered automake.



---

archive/issue_comments_296497.json:
```json
{
    "body": "<a id='comment:37'></a>\nI think that the patch should have included the complete change (including `.ac`, etc., files), and not only changes to autogenerated files.",
    "created_at": "2016-05-20T10:50:11Z",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20381#issuecomment-296497",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:37'></a>
I think that the patch should have included the complete change (including `.ac`, etc., files), and not only changes to autogenerated files.



---

archive/issue_comments_296498.json:
```json
{
    "body": "<a id='comment:38'></a>\nReplying to [dimpase](#comment%3A37):\n> I think that the patch should have included the complete change (including `.ac`, etc., files), and not only changes to autogenerated files.\n\n\nThis is exactly what the patch does. The version in `/patches/build/` indicates the manual modification to configuration files (only `common.mk` needs to be changed), and the version in `/patches/` (the one that gets applied) includes both this manual modification and the subsequent changes to autogenerated files following from an autotools application.",
    "created_at": "2016-05-20T18:50:04Z",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20381#issuecomment-296498",
    "user": "https://trac.sagemath.org/admin/accounts/users/gouezel"
}
```

<a id='comment:38'></a>
Replying to [dimpase](#comment%3A37):
> I think that the patch should have included the complete change (including `.ac`, etc., files), and not only changes to autogenerated files.


This is exactly what the patch does. The version in `/patches/build/` indicates the manual modification to configuration files (only `common.mk` needs to be changed), and the version in `/patches/` (the one that gets applied) includes both this manual modification and the subsequent changes to autogenerated files following from an autotools application.
