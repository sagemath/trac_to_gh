# Issue 20381: Patch to brial to get it building again on Cygwin

archive/issues_020144.json:
```json
{
    "assignees": [],
    "body": "brial doesn't build on Cygwin due to some inconsistency of how `__STRICT_ANSI__` is handled by C++ on Cygwin.  Changing `-std=c++98` to `-std=gnu++98` works around this behavior--I don't think there's any reason brial *must* be build with strict ANSI C++.\n\nNevertheless this is an issue more with Cygwin than anything else.\nI don't know if this has been reported upstream to Cygwin but it seems to be a very old issue.  Likewise it would be good if a workaround were upstreamed to brial.\n\nKeywords: **cygwin windows brial**\n\nBranch: **[84b0513](https://github.com/sagemath/sagetrac-mirror/commit/84b0513a4055a606716b74863dcc78d49e8235a7)**\n\nReviewer: **Sebastien Gouezel, Erik Bray**\n\nAuthor: **Erik Bray, Sebastien Gouezel**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/20381_\n\n",
    "closed_at": "2016-04-28T15:36:24Z",
    "created_at": "2016-04-07T16:35:37Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20build",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-7.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Patch to brial to get it building again on Cygwin",
    "type": "issue",
    "updated_at": "2016-05-20T18:50:04Z",
    "url": "https://github.com/sagemath/sage/issues/20381",
    "user": "https://github.com/embray"
}
```
brial doesn't build on Cygwin due to some inconsistency of how `__STRICT_ANSI__` is handled by C++ on Cygwin.  Changing `-std=c++98` to `-std=gnu++98` works around this behavior--I don't think there's any reason brial *must* be build with strict ANSI C++.

Nevertheless this is an issue more with Cygwin than anything else.
I don't know if this has been reported upstream to Cygwin but it seems to be a very old issue.  Likewise it would be good if a workaround were upstreamed to brial.

Keywords: **cygwin windows brial**

Branch: **[84b0513](https://github.com/sagemath/sagetrac-mirror/commit/84b0513a4055a606716b74863dcc78d49e8235a7)**

Reviewer: **Sebastien Gouezel, Erik Bray**

Author: **Erik Bray, Sebastien Gouezel**

_Issue created by migration from https://trac.sagemath.org/ticket/20381_





---

archive/issue_events_269646.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2016-04-07T16:35:37Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "milestone_number": null,
    "milestone_title": "sage-7.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20381#event-269646"
}
```



---

archive/issue_events_269647.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2016-04-07T16:35:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20build",
    "label_color": "000080",
    "label_name": "component: build",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20381#event-269647"
}
```



---

archive/issue_events_269648.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2016-04-07T16:35:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20381#event-269648"
}
```



---

archive/issue_events_269649.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2016-04-07T16:35:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20381#event-269649"
}
```



---

archive/issue_events_269650.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2016-04-07T16:35:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20381#event-269650"
}
```



---

archive/issue_comments_296529.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">Comment 2</div>\n\nThat said, [this post](https://cygwin.com/ml/cygwin/2010-01/msg00791.html) seems to make a good argument that Cygwin's behavior is *more* correct than the standard gcc in this regard.  It's inconvenient but seemingly not wrong.  So maybe just forget about it and just bring the issue to brial.",
    "created_at": "2016-04-07T16:49:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20381#issuecomment-296529",
    "user": "https://github.com/embray"
}
```

<div id="comment:2" align="right">Comment 2</div>

That said, [this post](https://cygwin.com/ml/cygwin/2010-01/msg00791.html) seems to make a good argument that Cygwin's behavior is *more* correct than the standard gcc in this regard.  It's inconvenient but seemingly not wrong.  So maybe just forget about it and just bring the issue to brial.



---

archive/issue_comments_296530.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">Comment 3</div>\n\nIn any case, I would prefer to apply this patch always, not only on Cygwin.",
    "created_at": "2016-04-07T17:25:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20381#issuecomment-296530",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:3" align="right">Comment 3</div>

In any case, I would prefer to apply this patch always, not only on Cygwin.



---

archive/issue_comments_296531.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">Comment 4</div>\n\nOh? I have nothing against that I'm just curious why it would be preferable always?",
    "created_at": "2016-04-07T17:27:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20381#issuecomment-296531",
    "user": "https://github.com/embray"
}
```

<div id="comment:4" align="right">Comment 4</div>

Oh? I have nothing against that I'm just curious why it would be preferable always?



---

archive/issue_comments_296532.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">Comment 5</div>\n\nPlease add your name in the Author field.",
    "created_at": "2016-04-07T18:49:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20381#issuecomment-296532",
    "user": "https://github.com/videlec"
}
```

<div id="comment:5" align="right">Comment 5</div>

Please add your name in the Author field.



---

archive/issue_comments_296533.json:
```json
{
    "body": "Author: **embray**",
    "created_at": "2016-04-07T18:58:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20381#issuecomment-296533",
    "user": "https://github.com/embray"
}
```

Author: **embray**



---

archive/issue_comments_296534.json:
```json
{
    "body": "Changed author from **embray** to **Erik Bray**",
    "created_at": "2016-04-07T19:01:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20381#issuecomment-296534",
    "user": "https://github.com/videlec"
}
```

Changed author from **embray** to **Erik Bray**



---

archive/issue_comments_296535.json:
```json
{
    "body": "Changed commit from **[5bbcada](https://github.com/sagemath/sagetrac-mirror/commit/5bbcadaa8b0d9a14357cfa4aed31a4bf95f23b30)** to **[db84ff0](https://github.com/sagemath/sagetrac-mirror/commit/db84ff01e1ba5c78f84d547ffcaf8fb3b74a71fe)**",
    "created_at": "2016-04-07T19:01:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20381#issuecomment-296535",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[5bbcada](https://github.com/sagemath/sagetrac-mirror/commit/5bbcadaa8b0d9a14357cfa4aed31a4bf95f23b30)** to **[db84ff0](https://github.com/sagemath/sagetrac-mirror/commit/db84ff01e1ba5c78f84d547ffcaf8fb3b74a71fe)**



---

archive/issue_comments_296536.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">Comment 8</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/db84ff01e1ba5c78f84d547ffcaf8fb3b74a71fe\">db84ff0</a></td><td><code>As requested, apply the patch on all platforms, not just cygwin</code></td></tr></table>\n",
    "created_at": "2016-04-07T19:01:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20381#issuecomment-296536",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:8" align="right">Comment 8</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/db84ff01e1ba5c78f84d547ffcaf8fb3b74a71fe">db84ff0</a></td><td><code>As requested, apply the patch on all platforms, not just cygwin</code></td></tr></table>




---

archive/issue_events_269651.json:
```json
{
    "actor": "https://github.com/sagetrac-gouezel",
    "created_at": "2016-04-08T15:45:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20381#event-269651"
}
```



---

archive/issue_events_269652.json:
```json
{
    "actor": "https://github.com/sagetrac-gouezel",
    "created_at": "2016-04-08T15:45:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20381#event-269652"
}
```



---

archive/issue_comments_296537.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">Comment 9</div>\n\nThe patch is not enough for me: even with the patch, compilation lines still have `-std=c++98` and not `-std=gnu++98`. After `autoreconf`, however, eveything becomes fine, so I guess the patch is only missing the `autoreconf` output. (More details in #17622, [comment:5](#comment%3A5))",
    "created_at": "2016-04-08T15:45:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20381#issuecomment-296537",
    "user": "https://github.com/sagetrac-gouezel"
}
```

<div id="comment:9" align="right">Comment 9</div>

The patch is not enough for me: even with the patch, compilation lines still have `-std=c++98` and not `-std=gnu++98`. After `autoreconf`, however, eveything becomes fine, so I guess the patch is only missing the `autoreconf` output. (More details in #17622, [comment:5](#comment%3A5))



---

archive/issue_comments_296538.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">Comment 10</div>\n\nI have added the necessary autoconfed bits. With the new branch, this works for me.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/84b0513a4055a606716b74863dcc78d49e8235a7\">84b0513</a></td><td><code> #20381: Using std=c++98 breaks on Cygwin</code></td></tr></table>\n",
    "created_at": "2016-04-08T18:45:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20381#issuecomment-296538",
    "user": "https://github.com/sagetrac-gouezel"
}
```

<div id="comment:10" align="right">Comment 10</div>

I have added the necessary autoconfed bits. With the new branch, this works for me.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/84b0513a4055a606716b74863dcc78d49e8235a7">84b0513</a></td><td><code> #20381: Using std=c++98 breaks on Cygwin</code></td></tr></table>




---

archive/issue_events_269653.json:
```json
{
    "actor": "https://github.com/sagetrac-gouezel",
    "created_at": "2016-04-08T18:45:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20381#event-269653"
}
```



---

archive/issue_events_269654.json:
```json
{
    "actor": "https://github.com/sagetrac-gouezel",
    "created_at": "2016-04-08T18:45:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20381#event-269654"
}
```



---

archive/issue_comments_296539.json:
```json
{
    "body": "Changed branch from **[u/embray/brial-cygwin-patch](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/brial-cygwin-patch)** to **[u/gouezel/brial-cygwin-patch](https://github.com/sagemath/sagetrac-mirror/tree/u/gouezel/brial-cygwin-patch)**",
    "created_at": "2016-04-08T18:45:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20381#issuecomment-296539",
    "user": "https://github.com/sagetrac-gouezel"
}
```

Changed branch from **[u/embray/brial-cygwin-patch](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/brial-cygwin-patch)** to **[u/gouezel/brial-cygwin-patch](https://github.com/sagemath/sagetrac-mirror/tree/u/gouezel/brial-cygwin-patch)**



---

archive/issue_comments_296540.json:
```json
{
    "body": "Changed commit from **[db84ff0](https://github.com/sagemath/sagetrac-mirror/commit/db84ff01e1ba5c78f84d547ffcaf8fb3b74a71fe)** to **[84b0513](https://github.com/sagemath/sagetrac-mirror/commit/84b0513a4055a606716b74863dcc78d49e8235a7)**",
    "created_at": "2016-04-08T18:45:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20381#issuecomment-296540",
    "user": "https://github.com/sagetrac-gouezel"
}
```

Changed commit from **[db84ff0](https://github.com/sagemath/sagetrac-mirror/commit/db84ff01e1ba5c78f84d547ffcaf8fb3b74a71fe)** to **[84b0513](https://github.com/sagemath/sagetrac-mirror/commit/84b0513a4055a606716b74863dcc78d49e8235a7)**



---

archive/issue_comments_296541.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">Comment 11</div>\n\nOkay, I was a little confused by this before too.  Why is there a separate set of patches under `patches/build/`?  When are the \"build\" patches applied?  I didn't need this myself.",
    "created_at": "2016-04-11T12:13:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20381#issuecomment-296541",
    "user": "https://github.com/embray"
}
```

<div id="comment:11" align="right">Comment 11</div>

Okay, I was a little confused by this before too.  Why is there a separate set of patches under `patches/build/`?  When are the "build" patches applied?  I didn't need this myself.



---

archive/issue_comments_296542.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">Comment 12</div>\n\nCopy/pasted from jpflori's comment at #17622:\n\nThe patches in build_system directory are those you need to apply to the brial build system before autotools automatically generate the full build system.\nOnce these patches are applied, one can invoke autotools to update the build system and deduce the full patches in the patches directory which don't need autotools invokation anymore and can be applied at build time.\n\n\nTo summarize it's good to ship two set of patches because:\n\n* we can't rely on invoking autotools at build time because it is not a prerequisite and would not be manageable anyway, it's kind of impossible to make sure that the build system will be correctly regenarated with one of the random versions of autotools programs in the wild, therefore the build system has to be regenerated on a dev machine and full patches have to be distributed,\n  \n* the patches only touching the input to autotools are still of interest as these are the ones to be updated manually if we want to introduce further changes in the build system, and the ones to submit upstream for inclusion (and when upstream makes new releases it will regenerate the full build system)",
    "created_at": "2016-04-13T19:56:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20381#issuecomment-296542",
    "user": "https://github.com/sagetrac-gouezel"
}
```

<div id="comment:12" align="right">Comment 12</div>

Copy/pasted from jpflori's comment at #17622:

The patches in build_system directory are those you need to apply to the brial build system before autotools automatically generate the full build system.
Once these patches are applied, one can invoke autotools to update the build system and deduce the full patches in the patches directory which don't need autotools invokation anymore and can be applied at build time.


To summarize it's good to ship two set of patches because:

* we can't rely on invoking autotools at build time because it is not a prerequisite and would not be manageable anyway, it's kind of impossible to make sure that the build system will be correctly regenarated with one of the random versions of autotools programs in the wild, therefore the build system has to be regenerated on a dev machine and full patches have to be distributed,
  
* the patches only touching the input to autotools are still of interest as these are the ones to be updated manually if we want to introduce further changes in the build system, and the ones to submit upstream for inclusion (and when upstream makes new releases it will regenerate the full build system)



---

archive/issue_comments_296543.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">Comment 13</div>\n\nDid you try dropping the `-std=gnu++98` argument completely? Is it a problem if C++03 or C++11 is used?",
    "created_at": "2016-04-13T20:01:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20381#issuecomment-296543",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:13" align="right">Comment 13</div>

Did you try dropping the `-std=gnu++98` argument completely? Is it a problem if C++03 or C++11 is used?



---

archive/issue_comments_296544.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">Comment 14</div>\n\nI should add that I am surprised that your patch was enough for you, since it wasn't for me and our settings should be comparable. Are you sure that you did not do `autoreconf` at some point manually, that was accidentally not included in the patch? To test that your patch was enough for you, could you start from a clean `develop`, then merge `u/embray/brial-cygwin-patch` and see if it builds without any additional tweaking?",
    "created_at": "2016-04-13T20:02:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20381#issuecomment-296544",
    "user": "https://github.com/sagetrac-gouezel"
}
```

<div id="comment:14" align="right">Comment 14</div>

I should add that I am surprised that your patch was enough for you, since it wasn't for me and our settings should be comparable. Are you sure that you did not do `autoreconf` at some point manually, that was accidentally not included in the patch? To test that your patch was enough for you, could you start from a clean `develop`, then merge `u/embray/brial-cygwin-patch` and see if it builds without any additional tweaking?



---

archive/issue_comments_296545.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">Comment 15</div>\n\nNote that upstream for brial is really Sage. It's a Sage fork of the abandoned project PolyBoRi. So it might be best to just make a new release of brial and use that.",
    "created_at": "2016-04-13T20:03:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20381#issuecomment-296545",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:15" align="right">Comment 15</div>

Note that upstream for brial is really Sage. It's a Sage fork of the abandoned project PolyBoRi. So it might be best to just make a new release of brial and use that.



---

archive/issue_comments_296546.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">Comment 16</div>\n\nThis all seems to be under the assumption that one would have already built \"brial\" once before and already have the autotools-generated files lying around. But I don't know why you would assume that to be the case in general.",
    "created_at": "2016-04-14T09:32:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20381#issuecomment-296546",
    "user": "https://github.com/embray"
}
```

<div id="comment:16" align="right">Comment 16</div>

This all seems to be under the assumption that one would have already built "brial" once before and already have the autotools-generated files lying around. But I don't know why you would assume that to be the case in general.



---

archive/issue_comments_296547.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">Comment 17</div>\n\nSorry, I don't get what you mean.\n\nAgain, `autotools` is **not** a requirement of Sagemath, and building a package does **not** run autotools: as is customary, it only does `./configure` and `make`. So the `autotools` steps should be done by the package maintainer, inside the `spkg`. If a patch changes a file used by `autotools`, then it should also include the subsequent modifications made by the `autotools` invocation.",
    "created_at": "2016-04-14T09:49:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20381#issuecomment-296547",
    "user": "https://github.com/sagetrac-gouezel"
}
```

<div id="comment:17" align="right">Comment 17</div>

Sorry, I don't get what you mean.

Again, `autotools` is **not** a requirement of Sagemath, and building a package does **not** run autotools: as is customary, it only does `./configure` and `make`. So the `autotools` steps should be done by the package maintainer, inside the `spkg`. If a patch changes a file used by `autotools`, then it should also include the subsequent modifications made by the `autotools` invocation.



---

archive/issue_comments_296548.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">Comment 18</div>\n\n> Again, autotools is not a requirement of Sagemath\n\nOkay, that's what wasn't clear to me.  I think it's not always clear what sage does to modify source packages, versus what it does to modify extracted source packages at build time (or indeed, if sage publishes its own source packages, why even apply build-time patches at all?)",
    "created_at": "2016-04-14T10:14:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20381#issuecomment-296548",
    "user": "https://github.com/embray"
}
```

<div id="comment:18" align="right">Comment 18</div>

> Again, autotools is not a requirement of Sagemath

Okay, that's what wasn't clear to me.  I think it's not always clear what sage does to modify source packages, versus what it does to modify extracted source packages at build time (or indeed, if sage publishes its own source packages, why even apply build-time patches at all?)



---

archive/issue_comments_296549.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">Comment 19</div>\n\nThe idea is that source packages should be official source releases provided by upstream, without any modification. All modifications should come from patches. In this way, it is easy to keep sage's modifications when upstream releases a new version.",
    "created_at": "2016-04-14T10:23:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20381#issuecomment-296549",
    "user": "https://github.com/sagetrac-gouezel"
}
```

<div id="comment:19" align="right">Comment 19</div>

The idea is that source packages should be official source releases provided by upstream, without any modification. All modifications should come from patches. In this way, it is easy to keep sage's modifications when upstream releases a new version.



---

archive/issue_comments_296550.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">Comment 20</div>\n\n> The idea is that source packages should be official source releases provided by upstream, without any modification\n\nI think we're talking past each other, or some terms aren't clearly defined. Because to me this directly contradicts what you wrote just previously (and also my own experience which is that sage builds its own modified source tarballs in some cases).  Is this all documented somewhere?",
    "created_at": "2016-04-14T10:28:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20381#issuecomment-296550",
    "user": "https://github.com/embray"
}
```

<div id="comment:20" align="right">Comment 20</div>

> The idea is that source packages should be official source releases provided by upstream, without any modification

I think we're talking past each other, or some terms aren't clearly defined. Because to me this directly contradicts what you wrote just previously (and also my own experience which is that sage builds its own modified source tarballs in some cases).  Is this all documented somewhere?



---

archive/issue_comments_296551.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">Comment 21</div>\n\nIn general, to compile a program from source, you don't need autotools, just run `./configure` and `make`. This means its release manager will run autotools before releasing an official source tarball. \n\nThen this (official, already autotoolified) source tarball will be the sage source package, downloaded in the `upstream`directory. If some patches to this source package are needed for sage, they will be added just before build: the usual package installation process uncompresses the official source, incorporates the patches, then runs `./configure`, `make` and `make install`, with additional flags if necessary.",
    "created_at": "2016-04-14T11:30:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20381#issuecomment-296551",
    "user": "https://github.com/sagetrac-gouezel"
}
```

<div id="comment:21" align="right">Comment 21</div>

In general, to compile a program from source, you don't need autotools, just run `./configure` and `make`. This means its release manager will run autotools before releasing an official source tarball. 

Then this (official, already autotoolified) source tarball will be the sage source package, downloaded in the `upstream`directory. If some patches to this source package are needed for sage, they will be added just before build: the usual package installation process uncompresses the official source, incorporates the patches, then runs `./configure`, `make` and `make install`, with additional flags if necessary.



---

archive/issue_comments_296552.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">Comment 22</div>\n\n> In general, to compile a program from source, you don't need autotools, just run ./configure and make\n\nIt depends. My confusion perhaps stems from the fact that some (probably most?) projects include `./configure` in their source tarballs, but some don't.\n\n> If some patches to this source package are needed for sage, they will be added just before build\n\nThere are some exceptions, which is another source of my confusion.  For example [ecl](https://github.com/sagemath/sagetrac-mirror/blob/develop/build/pkgs/ecl?h=develop) has patches that are applied to the source tarball before uploading to sage's package mirrors.  I guessed that maybe the same was being done for brial but I was wrong in this case.  What's further confusing is that although the separate `brial/patches/build/` patches *exist* in the repository, nothing ever seems to apply them (I was expecting to find maybe an `spkg-src` script that applies them).  I sort of get the point though--it's just demonstrating what would be patched before running `autoreconf` or the like.  *shrug*",
    "created_at": "2016-04-14T12:12:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20381#issuecomment-296552",
    "user": "https://github.com/embray"
}
```

<div id="comment:22" align="right">Comment 22</div>

> In general, to compile a program from source, you don't need autotools, just run ./configure and make

It depends. My confusion perhaps stems from the fact that some (probably most?) projects include `./configure` in their source tarballs, but some don't.

> If some patches to this source package are needed for sage, they will be added just before build

There are some exceptions, which is another source of my confusion.  For example [ecl](https://github.com/sagemath/sagetrac-mirror/blob/develop/build/pkgs/ecl?h=develop) has patches that are applied to the source tarball before uploading to sage's package mirrors.  I guessed that maybe the same was being done for brial but I was wrong in this case.  What's further confusing is that although the separate `brial/patches/build/` patches *exist* in the repository, nothing ever seems to apply them (I was expecting to find maybe an `spkg-src` script that applies them).  I sort of get the point though--it's just demonstrating what would be patched before running `autoreconf` or the like.  *shrug*



---

archive/issue_comments_296553.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">Comment 23</div>\n\nReplying to [@embray](#comment%3A22):\n> > In general, to compile a program from source, you don't need autotools, just run ./configure and make\n\n> \n> It depends. My confusion perhaps stems from the fact that some (probably most?) projects include `./configure` in their source tarballs, but some don't.\n\nIf they don't include `./configure`, I consider that an upstream bug.",
    "created_at": "2016-04-14T12:27:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20381#issuecomment-296553",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:23" align="right">Comment 23</div>

Replying to [@embray](#comment%3A22):
> > In general, to compile a program from source, you don't need autotools, just run ./configure and make

> 
> It depends. My confusion perhaps stems from the fact that some (probably most?) projects include `./configure` in their source tarballs, but some don't.

If they don't include `./configure`, I consider that an upstream bug.



---

archive/issue_comments_296554.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">Comment 24</div>\n\nMaybe, maybe not.  Some projects just make their source tarballs by bundling what's in the VCS--sometimes this is done directly though [GitHub](../wiki/GitHub) or other VCS interfaces.  I don't think it's wrong.  Slightly inconvenient but not wrong.",
    "created_at": "2016-04-15T12:13:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20381#issuecomment-296554",
    "user": "https://github.com/embray"
}
```

<div id="comment:24" align="right">Comment 24</div>

Maybe, maybe not.  Some projects just make their source tarballs by bundling what's in the VCS--sometimes this is done directly though [GitHub](../wiki/GitHub) or other VCS interfaces.  I don't think it's wrong.  Slightly inconvenient but not wrong.



---

archive/issue_comments_296555.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">Comment 25</div>\n\nAbove discussion aside this is good to go.  I  haven't tried outright dropping the `-std=gnu++98`. I doubt it's needed but leaving this as is is easier than testing and rewriting the patch since this definitely fixes the issue and we don't really care what C standard it prefers as long as it compiles.",
    "created_at": "2016-04-27T14:11:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20381#issuecomment-296555",
    "user": "https://github.com/embray"
}
```

<div id="comment:25" align="right">Comment 25</div>

Above discussion aside this is good to go.  I  haven't tried outright dropping the `-std=gnu++98`. I doubt it's needed but leaving this as is is easier than testing and rewriting the patch since this definitely fixes the issue and we don't really care what C standard it prefers as long as it compiles.



---

archive/issue_events_269655.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2016-04-27T14:11:15Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20381#event-269655"
}
```



---

archive/issue_events_269656.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2016-04-27T14:11:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20381#event-269656"
}
```



---

archive/issue_comments_296556.json:
```json
{
    "body": "Reviewer: **Sebastien Gouezel, Erik Bray**",
    "created_at": "2016-04-27T14:16:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20381#issuecomment-296556",
    "user": "https://github.com/sagetrac-gouezel"
}
```

Reviewer: **Sebastien Gouezel, Erik Bray**



---

archive/issue_comments_296557.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">Comment 27</div>\n\nI have tested without `-std=gnu++98`, it also works but I agree it is not worth rewriting the patch. I have submitted a pull request upstream fixing this issue and #19643, so hopefully we will be able to drop this patch with the next release of brial.",
    "created_at": "2016-04-27T14:16:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20381#issuecomment-296557",
    "user": "https://github.com/sagetrac-gouezel"
}
```

<div id="comment:27" align="right">Comment 27</div>

I have tested without `-std=gnu++98`, it also works but I agree it is not worth rewriting the patch. I have submitted a pull request upstream fixing this issue and #19643, so hopefully we will be able to drop this patch with the next release of brial.



---

archive/issue_comments_296558.json:
```json
{
    "body": "Changed author from **Erik Bray** to **Erik Bray, Sebastien Gouezel**",
    "created_at": "2016-04-27T14:16:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20381#issuecomment-296558",
    "user": "https://github.com/sagetrac-gouezel"
}
```

Changed author from **Erik Bray** to **Erik Bray, Sebastien Gouezel**



---

archive/issue_comments_296559.json:
```json
{
    "body": "Changed branch from **[u/gouezel/brial-cygwin-patch](https://github.com/sagemath/sagetrac-mirror/tree/u/gouezel/brial-cygwin-patch)** to **[84b0513](https://github.com/sagemath/sagetrac-mirror/commit/84b0513a4055a606716b74863dcc78d49e8235a7)**",
    "created_at": "2016-04-28T15:36:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20381#issuecomment-296559",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/gouezel/brial-cygwin-patch](https://github.com/sagemath/sagetrac-mirror/tree/u/gouezel/brial-cygwin-patch)** to **[84b0513](https://github.com/sagemath/sagetrac-mirror/commit/84b0513a4055a606716b74863dcc78d49e8235a7)**



---

archive/issue_events_269657.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-04-28T15:36:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20381#event-269657"
}
```



---

archive/issue_events_269658.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "62be89a8886f0800a20e07189e68cd67df161816",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2016-04-28T15:36:24Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20381#event-269658"
}
```



---

archive/issue_comments_296560.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">Comment 29</div>\n\nWhich this patch, one created a dependence on automake. \nSee https://groups.google.com/d/msg/sage-support/6Xg1RXXw-S0/nKaaeLdrDAAJ\n\nThis should not have happened!",
    "created_at": "2016-05-18T11:49:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20381#issuecomment-296560",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:29" align="right">Comment 29</div>

Which this patch, one created a dependence on automake. 
See https://groups.google.com/d/msg/sage-support/6Xg1RXXw-S0/nKaaeLdrDAAJ

This should not have happened!



---

archive/issue_comments_296561.json:
```json
{
    "body": "Changed commit from **[84b0513](https://github.com/sagemath/sagetrac-mirror/commit/84b0513a4055a606716b74863dcc78d49e8235a7)** to none",
    "created_at": "2016-05-18T11:49:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20381#issuecomment-296561",
    "user": "https://github.com/dimpase"
}
```

Changed commit from **[84b0513](https://github.com/sagemath/sagetrac-mirror/commit/84b0513a4055a606716b74863dcc78d49e8235a7)** to none



---

archive/issue_comments_296562.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">Comment 30</div>\n\nNo, I don't believe so.  \n\nWhat I mean to say is, I don't think it has to do with this ticket.  If you scrutinize the patch it's just making some trivial modifications to some lines that already exist.\n\nIt's possible that if a new package for brial was built it wasn't done properly, but I don't know who does that.",
    "created_at": "2016-05-19T10:20:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20381#issuecomment-296562",
    "user": "https://github.com/embray"
}
```

<div id="comment:30" align="right">Comment 30</div>

No, I don't believe so.  

What I mean to say is, I don't think it has to do with this ticket.  If you scrutinize the patch it's just making some trivial modifications to some lines that already exist.

It's possible that if a new package for brial was built it wasn't done properly, but I don't know who does that.



---

archive/issue_comments_296563.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">Comment 31</div>\n\nReplying to [@embray](#comment%3A30):\n> No, I don't believe so.  \n> \n> What I mean to say is, I don't think it has to do with this ticket.  If you scrutinize the patch it's just making some trivial modifications to some lines that already exist.\n> \n> It's possible that if a new package for brial was built it wasn't done properly, but I don't know who does that.\n\nHmm, OK, sorry. Perhaps it's a building issue, like a skew clock or something, that triggers automake run....",
    "created_at": "2016-05-19T10:31:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20381#issuecomment-296563",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:31" align="right">Comment 31</div>

Replying to [@embray](#comment%3A30):
> No, I don't believe so.  
> 
> What I mean to say is, I don't think it has to do with this ticket.  If you scrutinize the patch it's just making some trivial modifications to some lines that already exist.
> 
> It's possible that if a new package for brial was built it wasn't done properly, but I don't know who does that.

Hmm, OK, sorry. Perhaps it's a building issue, like a skew clock or something, that triggers automake run....



---

archive/issue_comments_296564.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">Comment 32</div>\n\nReplying to [@sagetrac-gouezel](#comment%3A27):\n> I have submitted a pull request upstream fixing this issue and #19643, so hopefully\n> we will be able to drop this patch with the next release of brial.\n\nFor reference upstream the pull request is at\n    https://github.com/BRiAl/BRiAl/pull/7",
    "created_at": "2016-05-19T10:55:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20381#issuecomment-296564",
    "user": "https://github.com/slel"
}
```

<div id="comment:32" align="right">Comment 32</div>

Replying to [@sagetrac-gouezel](#comment%3A27):
> I have submitted a pull request upstream fixing this issue and #19643, so hopefully
> we will be able to drop this patch with the next release of brial.

For reference upstream the pull request is at
    https://github.com/BRiAl/BRiAl/pull/7



---

archive/issue_comments_296565.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">Comment 33</div>\n\nReplying to [@embray](#comment%3A30):\n> If you scrutinize the patch it's just making some trivial modifications to some lines that already exist.\n\nThe mere fact of applying a patch (whether or not it makes trivial modifications) is an important change. It affects timestamps of the patched files which can certainly influence whether automake is needed.",
    "created_at": "2016-05-19T11:30:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20381#issuecomment-296565",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:33" align="right">Comment 33</div>

Replying to [@embray](#comment%3A30):
> If you scrutinize the patch it's just making some trivial modifications to some lines that already exist.

The mere fact of applying a patch (whether or not it makes trivial modifications) is an important change. It affects timestamps of the patched files which can certainly influence whether automake is needed.



---

archive/issue_comments_296566.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">Comment 34</div>\n\nFor the record: I'm not able to reproduce the automake issue with Sage 7.2 (Linux 3.17.7 on ext4 file system)",
    "created_at": "2016-05-19T11:39:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20381#issuecomment-296566",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:34" align="right">Comment 34</div>

For the record: I'm not able to reproduce the automake issue with Sage 7.2 (Linux 3.17.7 on ext4 file system)



---

archive/issue_comments_296567.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">Comment 35</div>\n\nI could reproduce the issue on cygwin. Should be solved with #20634.",
    "created_at": "2016-05-19T19:41:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20381#issuecomment-296567",
    "user": "https://github.com/sagetrac-gouezel"
}
```

<div id="comment:35" align="right">Comment 35</div>

I could reproduce the issue on cygwin. Should be solved with #20634.



---

archive/issue_comments_296568.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">Comment 36</div>\n\nI see now, so maybe by patching common.mk for example it retriggered automake.",
    "created_at": "2016-05-20T10:13:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20381#issuecomment-296568",
    "user": "https://github.com/embray"
}
```

<div id="comment:36" align="right">Comment 36</div>

I see now, so maybe by patching common.mk for example it retriggered automake.



---

archive/issue_comments_296569.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">Comment 37</div>\n\nI think that the patch should have included the complete change (including `.ac`, etc., files), and not only changes to autogenerated files.",
    "created_at": "2016-05-20T10:50:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20381#issuecomment-296569",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:37" align="right">Comment 37</div>

I think that the patch should have included the complete change (including `.ac`, etc., files), and not only changes to autogenerated files.



---

archive/issue_comments_296570.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">Comment 38</div>\n\nReplying to [@dimpase](#comment%3A37):\n> I think that the patch should have included the complete change (including `.ac`, etc., files), and not only changes to autogenerated files.\n\nThis is exactly what the patch does. The version in `/patches/build/` indicates the manual modification to configuration files (only `common.mk` needs to be changed), and the version in `/patches/` (the one that gets applied) includes both this manual modification and the subsequent changes to autogenerated files following from an autotools application.",
    "created_at": "2016-05-20T18:50:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20381#issuecomment-296570",
    "user": "https://github.com/sagetrac-gouezel"
}
```

<div id="comment:38" align="right">Comment 38</div>

Replying to [@dimpase](#comment%3A37):
> I think that the patch should have included the complete change (including `.ac`, etc., files), and not only changes to autogenerated files.

This is exactly what the patch does. The version in `/patches/build/` indicates the manual modification to configuration files (only `common.mk` needs to be changed), and the version in `/patches/` (the one that gets applied) includes both this manual modification and the subsequent changes to autogenerated files following from an autotools application.
