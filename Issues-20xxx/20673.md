# Issue 20673: revert #4967

archive/issues_020436.json:
```json
{
    "body": "#4967 -- to completely disallow users to install Gap packages or configure anything in order to make the Sage build more isolated -- was short sighted and should be reverted.\n\nJust revert it.  Sage can't and shouldn't protect its build against all possible user-level configuration on their system -- VM's or containers are better for doing that.\n\nAlso #4967 makes it completely impossible for a user to install their own package and use a system-wide install of sage.\n\nBranch: u/kalmar/revert__4967\n\nStatus: new\n\nCommit: 1dad6793d0e2c8e94aa38bd9e37532ba5eca9bba\n\nIssue created by migration from https://trac.sagemath.org/ticket/20673\n\n",
    "created_at": "2016-05-24T18:13:43Z",
    "labels": [
        "component: interfaces",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.3",
    "title": "revert #4967",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/20673",
    "user": "https://github.com/williamstein"
}
```
#4967 -- to completely disallow users to install Gap packages or configure anything in order to make the Sage build more isolated -- was short sighted and should be reverted.

Just revert it.  Sage can't and shouldn't protect its build against all possible user-level configuration on their system -- VM's or containers are better for doing that.

Also #4967 makes it completely impossible for a user to install their own package and use a system-wide install of sage.

Branch: u/kalmar/revert__4967

Status: new

Commit: 1dad6793d0e2c8e94aa38bd9e37532ba5eca9bba

Issue created by migration from https://trac.sagemath.org/ticket/20673





---

archive/issue_comments_281287.json:
```json
{
    "body": "<a id='comment:2'></a>Not sure if installing out of GAP tree works for GAP packages building \"GAP kernel extensions\", some sort of dynamic libraries runtime linked by GAP.\nOne such package is called io, see http://gap-system.org/Packages/io.html\n\n---\nNew commits:",
    "created_at": "2016-09-02T09:38:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20673",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20673#issuecomment-281287",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:2'></a>Not sure if installing out of GAP tree works for GAP packages building "GAP kernel extensions", some sort of dynamic libraries runtime linked by GAP.
One such package is called io, see http://gap-system.org/Packages/io.html

---
New commits:



---

archive/issue_comments_281288.json:
```json
{
    "body": "<a id='comment:3'></a>I actually use the IO package compiled this way. Everything seems to work fine, though my usage is not really extensive (pickling, writing, reading, un-pickling).\n\nOf course there might be problems when sage-used version of GAP changes -- but this becomes users responsibility to keep their locally installed packages up-to-date.",
    "created_at": "2016-09-02T10:11:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20673",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20673#issuecomment-281288",
    "user": "https://trac.sagemath.org/admin/accounts/users/kalmar"
}
```

<a id='comment:3'></a>I actually use the IO package compiled this way. Everything seems to work fine, though my usage is not really extensive (pickling, writing, reading, un-pickling).

Of course there might be problems when sage-used version of GAP changes -- but this becomes users responsibility to keep their locally installed packages up-to-date.



---

archive/issue_comments_281289.json:
```json
{
    "body": "<a id='comment:4'></a>and what happens if you do\n\n```\n   sage: libgap.LoadPackage(\"io\")\n```\n(I expect an ugly error).\n\nAnd, by the way, does this (i.e. `libgap.LoadPackage()`) work with userspace GAP packages that do not need GAP kernel extensions?",
    "created_at": "2016-09-02T10:21:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20673",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20673#issuecomment-281289",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:4'></a>and what happens if you do

```
   sage: libgap.LoadPackage("io")
```
(I expect an ugly error).

And, by the way, does this (i.e. `libgap.LoadPackage()`) work with userspace GAP packages that do not need GAP kernel extensions?



---

archive/issue_comments_281290.json:
```json
{
    "body": "<a id='comment:5'></a>I get \n\n```\ntrue\n```\n\n(I do it in SCM)\n\nWhich other package should I test?",
    "created_at": "2016-09-02T10:50:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20673",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20673#issuecomment-281290",
    "user": "https://trac.sagemath.org/admin/accounts/users/kalmar"
}
```

<a id='comment:5'></a>I get 

```
true
```

(I do it in SCM)

Which other package should I test?



---

archive/issue_comments_281291.json:
```json
{
    "body": "<a id='comment:6'></a>Replying to [comment:5 kalmar]:\n> I get \n> \n> ```\n> true\n> ```\n> \n> (I do it in SCM)\n> \n\nThis is with io, right? So it loads, right? Could you test that it *works* in libgap, too? In fact I am about to start creating Sage package with io, json, and perhaps few other packages, too.",
    "created_at": "2016-09-02T11:03:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20673",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20673#issuecomment-281291",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:6'></a>Replying to [comment:5 kalmar]:
> I get 
> 
> ```
> true
> ```
> 
> (I do it in SCM)
> 

This is with io, right? So it loads, right? Could you test that it *works* in libgap, too? In fact I am about to start creating Sage package with io, json, and perhaps few other packages, too.



---

archive/issue_comments_281292.json:
```json
{
    "body": "<a id='comment:7'></a>Ok, I don't know if it works with libgap (haven't even tried to make it work)\n\nHowever (just checked in the branch):\n\nDownloading io-4.4.6.tar.bz2\\\\\n./configure (with the appropriate --with-gaproot=)\\\\\ncopying folder to ./.gap/pkg as io\\\\\nand then\n\n```\nsage> gap.load_package(\"io\")\nsage> gap.IO_Pickle(gap.AlternatingGroup(5))\nPRMGILIS2PERMB(1,2,3,4,5)PERM7(3,4,5)INTG23CFAIL\n```\ndoes what it's supposed to",
    "created_at": "2016-09-02T12:06:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20673",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20673#issuecomment-281292",
    "user": "https://trac.sagemath.org/admin/accounts/users/kalmar"
}
```

<a id='comment:7'></a>Ok, I don't know if it works with libgap (haven't even tried to make it work)

However (just checked in the branch):

Downloading io-4.4.6.tar.bz2\\
./configure (with the appropriate --with-gaproot=)\\
copying folder to ./.gap/pkg as io\\
and then

```
sage> gap.load_package("io")
sage> gap.IO_Pickle(gap.AlternatingGroup(5))
PRMGILIS2PERMB(1,2,3,4,5)PERM7(3,4,5)INTG23CFAIL
```
does what it's supposed to



---

archive/issue_comments_281293.json:
```json
{
    "body": "<a id='comment:8'></a>how about trying\n\n```\nsage> libgap.LoadPackage(\"io\")\nsage> libgap.IO_Pickle(libgap.AlternatingGroup(5))\n```",
    "created_at": "2016-09-02T12:50:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20673",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20673#issuecomment-281293",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:8'></a>how about trying

```
sage> libgap.LoadPackage("io")
sage> libgap.IO_Pickle(libgap.AlternatingGroup(5))
```



---

archive/issue_comments_281294.json:
```json
{
    "body": "<a id='comment:9'></a>\n```\nAttributeError: No such attribute: IO_Pickle.\n```",
    "created_at": "2016-09-02T12:56:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20673",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20673#issuecomment-281294",
    "user": "https://trac.sagemath.org/admin/accounts/users/kalmar"
}
```

<a id='comment:9'></a>
```
AttributeError: No such attribute: IO_Pickle.
```



---

archive/issue_comments_281295.json:
```json
{
    "body": "<a id='comment:10'></a>Replying to [comment:9 kalmar]:\n> \n> \n> ```\n> AttributeError: No such attribute: IO_Pickle.\n> ```\n\nOK, and how about\n\n```\nsage: libgap.eval('IO_Pickle(AlternatingGroup(5));')\n```\n(not sure whether ';' is needed here, or not.)",
    "created_at": "2016-09-02T13:57:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20673",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20673#issuecomment-281295",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:10'></a>Replying to [comment:9 kalmar]:
> 
> 
> ```
> AttributeError: No such attribute: IO_Pickle.
> ```

OK, and how about

```
sage: libgap.eval('IO_Pickle(AlternatingGroup(5));')
```
(not sure whether ';' is needed here, or not.)



---

archive/issue_comments_281296.json:
```json
{
    "body": "<a id='comment:11'></a>I tried this previously as well:\n\n```\nlibGAP: Error, Variable: 'IO_Pickle' must have a value\n```\n\n(in fact I don't quite know how to use loaded package functionality through libgap)",
    "created_at": "2016-09-02T14:12:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20673",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20673#issuecomment-281296",
    "user": "https://trac.sagemath.org/admin/accounts/users/kalmar"
}
```

<a id='comment:11'></a>I tried this previously as well:

```
libGAP: Error, Variable: 'IO_Pickle' must have a value
```

(in fact I don't quite know how to use loaded package functionality through libgap)



---

archive/issue_comments_281297.json:
```json
{
    "body": "<a id='comment:12'></a>for instance, this works:\n\n```\nsage: libgap.LoadPackage(\"grape\")\ntrue\nsage: libgap.eval('JohnsonGraph(5,2)')\nrec( adjacencies := [ [ 2, 3, 4, 5, 6, 7 ] ], group := Group([ (1,5,8,10,4)(2,6,9,3,7), (2,5)(3,6)(4,7) ]), isGraph := true, isSimple := true, names := [ [ 1, 2 ], [ 1, 3 ], [ 1, 4 ], [ 1, 5 ], [ 2, 3 ], [ 2, 4 ], [ 2, 5 ], [ 3, 4 ], [ 3, 5 ], [ 4, 5 ] ], order := 10, representatives := [ 1 ], schreierVector := [ -1, 2, 2, 1, 1, 1, 2, 1, 1, 1 ] )\nsage: \n```",
    "created_at": "2016-09-02T14:24:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20673",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20673#issuecomment-281297",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:12'></a>for instance, this works:

```
sage: libgap.LoadPackage("grape")
true
sage: libgap.eval('JohnsonGraph(5,2)')
rec( adjacencies := [ [ 2, 3, 4, 5, 6, 7 ] ], group := Group([ (1,5,8,10,4)(2,6,9,3,7), (2,5)(3,6)(4,7) ]), isGraph := true, isSimple := true, names := [ [ 1, 2 ], [ 1, 3 ], [ 1, 4 ], [ 1, 5 ], [ 2, 3 ], [ 2, 4 ], [ 2, 5 ], [ 3, 4 ], [ 3, 5 ], [ 4, 5 ] ], order := 10, representatives := [ 1 ], schreierVector := [ -1, 2, 2, 1, 1, 1, 2, 1, 1, 1 ] )
sage: 
```



---

archive/issue_comments_281298.json:
```json
{
    "body": "<a id='comment:13'></a>oops, libGAP does not support dynamic loading ATM, and infact autoloaded IO package breaks it. See this [github comment](https://github.com/OpenDreamKit/OpenDreamKit/issues/93#issuecomment-244400907) on how to fix it, sort of.",
    "created_at": "2016-09-02T15:40:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20673",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20673#issuecomment-281298",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:13'></a>oops, libGAP does not support dynamic loading ATM, and infact autoloaded IO package breaks it. See this [github comment](https://github.com/OpenDreamKit/OpenDreamKit/issues/93#issuecomment-244400907) on how to fix it, sort of.



---

archive/issue_comments_281299.json:
```json
{
    "body": "<a id='comment:14'></a>Anyhow, if you added a warning saying that GAP packages using loadable modules (such as IO and json, but possibly other too) will break libGAP and should not be used with GAP at the moment, I could give this a positive review.",
    "created_at": "2016-09-03T07:57:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20673",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20673#issuecomment-281299",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:14'></a>Anyhow, if you added a warning saying that GAP packages using loadable modules (such as IO and json, but possibly other too) will break libGAP and should not be used with GAP at the moment, I could give this a positive review.



---

archive/issue_comments_281300.json:
```json
{
    "body": "<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-10-09T09:51:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20673",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20673#issuecomment-281300",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_281301.json:
```json
{
    "body": "<a id='comment:16'></a>Sorry it took me so long;",
    "created_at": "2016-10-09T09:52:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20673",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20673#issuecomment-281301",
    "user": "https://trac.sagemath.org/admin/accounts/users/kalmar"
}
```

<a id='comment:16'></a>Sorry it took me so long;



---

archive/issue_comments_281302.json:
```json
{
    "body": "<a id='comment:17'></a>Shouldn't this\n\n`will break libGAP and should not be used with GAP at the moment!`\n\nsay\n\n`will break libGAP and should not be used with Sage at the moment!`",
    "created_at": "2016-10-09T14:13:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20673",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20673#issuecomment-281302",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:17'></a>Shouldn't this

`will break libGAP and should not be used with GAP at the moment!`

say

`will break libGAP and should not be used with Sage at the moment!`



---

archive/issue_comments_281303.json:
```json
{
    "body": "<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-10-09T14:29:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20673",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20673#issuecomment-281303",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_281304.json:
```json
{
    "body": "<a id='comment:20'></a>According to Volker, a way to allow dynamic modules (i.e. GAP kernel extensions) in libGAP is through #19915.",
    "created_at": "2017-03-17T10:08:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20673",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20673#issuecomment-281304",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:20'></a>According to Volker, a way to allow dynamic modules (i.e. GAP kernel extensions) in libGAP is through #19915.



---

archive/issue_comments_281305.json:
```json
{
    "body": "<a id='comment:21'></a>See alo #22626 (upgrade to GAP 4.9 and it's own libgap): at this stage, it seems likely that the provided libgap will be unprefixed, as in #19915.",
    "created_at": "2017-03-17T10:40:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20673",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20673#issuecomment-281305",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:21'></a>See alo #22626 (upgrade to GAP 4.9 and it's own libgap): at this stage, it seems likely that the provided libgap will be unprefixed, as in #19915.
