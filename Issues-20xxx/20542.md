# Issue 20542: Allow choosing between ATLAS and OpenBLAS

archive/issues_020305.json:
```json
{
    "body": "Add a `./configure` option `--with-blas` to choose between ATLAS and OpenBLAS.\n\nInstalling both is not supported.\n\nCC:  @embray @kiwifb\n\nReviewer: Fran\u00e7ois Bissey\n\nAuthor: Jeroen Demeyer\n\nBranch: df750a356e54cd53c311247aa452249e93ff32b3\n\nDependencies: #20392\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/20542\n\n",
    "closed_at": "2016-05-05T09:27:04Z",
    "created_at": "2016-05-03T11:37:54Z",
    "labels": [
        "component: build"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.2",
    "title": "Allow choosing between ATLAS and OpenBLAS",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/20542",
    "user": "https://github.com/jdemeyer"
}
```
Add a `./configure` option `--with-blas` to choose between ATLAS and OpenBLAS.

Installing both is not supported.

CC:  @embray @kiwifb

Reviewer: Fran√ßois Bissey

Author: Jeroen Demeyer

Branch: df750a356e54cd53c311247aa452249e93ff32b3

Dependencies: #20392

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/20542





---

archive/issue_comments_279595.json:
```json
{
    "body": "<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-05-03T12:58:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20542",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20542#issuecomment-279595",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_279596.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-05-03T15:43:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20542",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20542#issuecomment-279596",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_279597.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-05-03T15:43:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20542",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20542#issuecomment-279597",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_279598.json:
```json
{
    "body": "<a id='comment:6'></a>The mechanics looks alright but I want to have a few hours to digest it. Since we are not changing the current spkg, things are not as informative as they could be. How do you know from `configure --help` that\n 1) --with-blas=atlas (or nothing) allows you to use a system ATLAS via an environment variable.\n 2) that the same option will give use the accelerate framework on OS X by default (there is a way to force ATLAS build but that's a real expert case).\n\nThe first one may qualify as an expert use case where we don't want to make the suggestion in configuration's help message. I think the second one should deserve a mention, one way or another.",
    "created_at": "2016-05-03T21:15:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20542",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20542#issuecomment-279598",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:6'></a>The mechanics looks alright but I want to have a few hours to digest it. Since we are not changing the current spkg, things are not as informative as they could be. How do you know from `configure --help` that
 1) --with-blas=atlas (or nothing) allows you to use a system ATLAS via an environment variable.
 2) that the same option will give use the accelerate framework on OS X by default (there is a way to force ATLAS build but that's a real expert case).

The first one may qualify as an expert use case where we don't want to make the suggestion in configuration's help message. I think the second one should deserve a mention, one way or another.



---

archive/issue_comments_279599.json:
```json
{
    "body": "<a id='comment:7'></a>Replying to [comment:6 fbissey]:\n> How do you know from `configure --help` that\n>  1) --with-blas=atlas (or nothing) allows you to use a system ATLAS via an environment variable.\n>  2) that the same option will give use the accelerate framework on OS X by default (there is a way to force ATLAS build but that's a real expert case).\n\n\nWell, the ATLAS options are documented in http://doc.sagemath.org/html/en/installation/source.html#environment-variables\n\nI agree that it's not very clear, but I was hoping that this ticket could be reviewed anyway with further work for a follow-up ticket.\n\nIdeally we should move some of the configuration logic of the ATLAS spkg either to a generic BLAS meta-package or the top-level `configure` script. I haven't completely thought out the details of this, but I don't see much point in documenting something which I plan to change soon anyway.",
    "created_at": "2016-05-04T08:59:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20542",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20542#issuecomment-279599",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:7'></a>Replying to [comment:6 fbissey]:
> How do you know from `configure --help` that
>  1) --with-blas=atlas (or nothing) allows you to use a system ATLAS via an environment variable.
>  2) that the same option will give use the accelerate framework on OS X by default (there is a way to force ATLAS build but that's a real expert case).


Well, the ATLAS options are documented in http://doc.sagemath.org/html/en/installation/source.html#environment-variables

I agree that it's not very clear, but I was hoping that this ticket could be reviewed anyway with further work for a follow-up ticket.

Ideally we should move some of the configuration logic of the ATLAS spkg either to a generic BLAS meta-package or the top-level `configure` script. I haven't completely thought out the details of this, but I don't see much point in documenting something which I plan to change soon anyway.



---

archive/issue_comments_279600.json:
```json
{
    "body": "<a id='comment:8'></a>Also: as long as the default remains ATLAS, old configurations using `SAGE_ATLAS...` environment variables will continue to work.",
    "created_at": "2016-05-04T09:07:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20542",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20542#issuecomment-279600",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'></a>Also: as long as the default remains ATLAS, old configurations using `SAGE_ATLAS...` environment variables will continue to work.



---

archive/issue_comments_279601.json:
```json
{
    "body": "<a id='comment:9'></a>OK, deal. Sending to the bots.",
    "created_at": "2016-05-04T09:10:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20542",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20542#issuecomment-279601",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:9'></a>OK, deal. Sending to the bots.



---

archive/issue_comments_279602.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-05-04T09:10:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20542",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20542#issuecomment-279602",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_279603.json:
```json
{
    "body": "<a id='comment:10'></a>Replying to [comment:9 fbissey]:\n> OK, deal. Sending to the bots.\n\n\nWell, the bots won't test OpenBLAS, so I don't expect problems.",
    "created_at": "2016-05-04T09:21:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20542",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20542#issuecomment-279603",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:10'></a>Replying to [comment:9 fbissey]:
> OK, deal. Sending to the bots.


Well, the bots won't test OpenBLAS, so I don't expect problems.



---

archive/issue_comments_279604.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-05-05T09:27:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20542",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20542#issuecomment-279604",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_055446.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-05-05T09:27:04Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/20542",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20542#event-55446"
}
```



---

archive/issue_comments_279605.json:
```json
{
    "body": "<a id='comment:12'></a>> Ideally we should move some of the configuration logic of the ATLAS spkg either to a generic BLAS meta-package or the top-level configure script.\n\n\nThis is partly why I suggested the former, earlier.  But I agree further work could be in a follow-up.  This is a good move in the right direction.",
    "created_at": "2016-05-06T11:47:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20542",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20542#issuecomment-279605",
    "user": "https://github.com/embray"
}
```

<a id='comment:12'></a>> Ideally we should move some of the configuration logic of the ATLAS spkg either to a generic BLAS meta-package or the top-level configure script.


This is partly why I suggested the former, earlier.  But I agree further work could be in a follow-up.  This is a good move in the right direction.



---

archive/issue_comments_279606.json:
```json
{
    "body": "<a id='comment:13'></a>With all respect, this ticket should have been changing that docs, too. Do you expect that people would read configure source just to figure out how to switch between Atlas and OpenBlas? E.g., how does one build with Atlas?!\n\nBesides, `with-blas` is misleading. Surely, in both bases [BLAS](https://en.wikipedia.org/wiki/Basic_Linear_Algebra_Subprograms) is used, just different ones...",
    "created_at": "2016-11-04T10:40:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20542",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20542#issuecomment-279606",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:13'></a>With all respect, this ticket should have been changing that docs, too. Do you expect that people would read configure source just to figure out how to switch between Atlas and OpenBlas? E.g., how does one build with Atlas?!

Besides, `with-blas` is misleading. Surely, in both bases [BLAS](https://en.wikipedia.org/wiki/Basic_Linear_Algebra_Subprograms) is used, just different ones...



---

archive/issue_comments_279607.json:
```json
{
    "body": "<a id='comment:14'></a>Replying to [comment:13 dimpase]:\n> With all respect, this ticket should have been changing that docs, too. Do you expect that people would read configure source just to figure out how to switch between Atlas and OpenBlas? E.g., how does one build with Atlas?!\n\n\nNo, but I would expect them to read `./configure --help`.  If the help docs are broken then yeah I agree.",
    "created_at": "2016-11-07T13:46:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20542",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20542#issuecomment-279607",
    "user": "https://github.com/embray"
}
```

<a id='comment:14'></a>Replying to [comment:13 dimpase]:
> With all respect, this ticket should have been changing that docs, too. Do you expect that people would read configure source just to figure out how to switch between Atlas and OpenBlas? E.g., how does one build with Atlas?!


No, but I would expect them to read `./configure --help`.  If the help docs are broken then yeah I agree.



---

archive/issue_comments_279608.json:
```json
{
    "body": "<a id='comment:15'></a>Replying to [comment:14 embray]:\n> Replying to [comment:13 dimpase]:\n> > With all respect, this ticket should have been changing that docs, too. Do you expect that people would read configure source just to figure out how to switch between Atlas and OpenBlas? E.g., how does one build with Atlas?!\n\n> \n> No, but I would expect them to read `./configure --help`.  If the help docs are broken then yeah I agree.\n\n\n`./configure` ?\n\n`./configure` is not mentioned in the official manual.\ncf http://doc.sagemath.org/html/en/installation/source.html#step-by-step-installation-procedure\n\nor your locally built manual for the latest 7.5.beta",
    "created_at": "2016-11-07T17:59:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20542",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20542#issuecomment-279608",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:15'></a>Replying to [comment:14 embray]:
> Replying to [comment:13 dimpase]:
> > With all respect, this ticket should have been changing that docs, too. Do you expect that people would read configure source just to figure out how to switch between Atlas and OpenBlas? E.g., how does one build with Atlas?!

> 
> No, but I would expect them to read `./configure --help`.  If the help docs are broken then yeah I agree.


`./configure` ?

`./configure` is not mentioned in the official manual.
cf http://doc.sagemath.org/html/en/installation/source.html#step-by-step-installation-procedure

or your locally built manual for the latest 7.5.beta



---

archive/issue_comments_279609.json:
```json
{
    "body": "<a id='comment:16'></a>Well obviously it should be.",
    "created_at": "2016-11-08T11:15:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20542",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20542#issuecomment-279609",
    "user": "https://github.com/embray"
}
```

<a id='comment:16'></a>Well obviously it should be.
