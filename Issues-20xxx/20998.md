# Issue 20998: Removing deprecated cmp and __cmp__ in some pyx files

archive/issues_020761.json:
```json
{
    "assignees": [],
    "body": "When trying to compile sage with py3, the first failing point\nis currently caused by the use of \"cmp\" in some pyx files.\n\nThis tickets aims to make a few more pyx files compile correctly\nby removing cmp in them. This can be considered as en experiment,\nas this will have to be done on a larger scale later.\n\n\n**CC:**  @tscrim @jm58660 @jdemeyer @embray\n\n**Branch/Commit:** [e019d8c9ba333d3e7c7a77edbee1167ecfb1ca3b](https://github.com/sagemath/sagetrac-mirror/commit/e019d8c9ba333d3e7c7a77edbee1167ecfb1ca3b)\n\n**Reviewer:** Jeroen Demeyer\n\n**Author:** Fr\u00e9d\u00e9ric Chapoton\n\nIssue created by migration from https://trac.sagemath.org/ticket/20998\n\n",
    "closed_at": "2016-08-07T20:01:18Z",
    "created_at": "2016-07-11T12:08:13Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20python3",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-7.3",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Removing deprecated cmp and __cmp__ in some pyx files",
    "type": "issue",
    "updated_at": "2016-08-07T20:01:18Z",
    "url": "https://github.com/sagemath/sage/issues/20998",
    "user": "https://github.com/fchapoton"
}
```
When trying to compile sage with py3, the first failing point
is currently caused by the use of "cmp" in some pyx files.

This tickets aims to make a few more pyx files compile correctly
by removing cmp in them. This can be considered as en experiment,
as this will have to be done on a larger scale later.


**CC:**  @tscrim @jm58660 @jdemeyer @embray

**Branch/Commit:** [e019d8c9ba333d3e7c7a77edbee1167ecfb1ca3b](https://github.com/sagemath/sagetrac-mirror/commit/e019d8c9ba333d3e7c7a77edbee1167ecfb1ca3b)

**Reviewer:** Jeroen Demeyer

**Author:** Frédéric Chapoton

Issue created by migration from https://trac.sagemath.org/ticket/20998





---

archive/issue_events_255468.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-07-11T12:08:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/20998",
    "milestone_number": null,
    "milestone_title": "sage-7.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20998#event-255468"
}
```



---

archive/issue_events_255469.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-07-11T12:08:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20998",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20python3",
    "label_color": "08517b",
    "label_name": "component: python3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20998#event-255469"
}
```



---

archive/issue_events_255470.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-07-11T12:08:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20998",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "008080",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20998#event-255470"
}
```



---

archive/issue_comments_307517.json:
```json
{
    "body": "<a id='comment:1'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f4d65c76e96648ce0b1e0bd17122a3eec6bce18f\">f4d65c7</a></td><td><code>some cmp converted to richcmp in pyx files</code></td></tr></table>\n",
    "created_at": "2016-07-11T12:09:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20998#issuecomment-307517",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:1'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f4d65c76e96648ce0b1e0bd17122a3eec6bce18f">f4d65c7</a></td><td><code>some cmp converted to richcmp in pyx files</code></td></tr></table>




---

archive/issue_events_255471.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-07-11T12:09:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20998",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20998#event-255471"
}
```



---

archive/issue_comments_307518.json:
```json
{
    "body": "**Branch:** [public/20998](https://github.com/sagemath/sagetrac-mirror/tree/public/20998)",
    "created_at": "2016-07-11T12:09:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20998#issuecomment-307518",
    "user": "https://github.com/fchapoton"
}
```

**Branch:** [public/20998](https://github.com/sagemath/sagetrac-mirror/tree/public/20998)



---

archive/issue_comments_307519.json:
```json
{
    "body": "**Commit:** [f4d65c76e96648ce0b1e0bd17122a3eec6bce18f](https://github.com/sagemath/sagetrac-mirror/commit/f4d65c76e96648ce0b1e0bd17122a3eec6bce18f)",
    "created_at": "2016-07-11T12:09:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20998#issuecomment-307519",
    "user": "https://github.com/fchapoton"
}
```

**Commit:** [f4d65c76e96648ce0b1e0bd17122a3eec6bce18f](https://github.com/sagemath/sagetrac-mirror/commit/f4d65c76e96648ce0b1e0bd17122a3eec6bce18f)



---

archive/issue_events_255472.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2016-07-11T20:39:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20998",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20998#event-255472"
}
```



---

archive/issue_events_255473.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2016-07-11T20:39:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20998",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20998#event-255473"
}
```



---

archive/issue_comments_307520.json:
```json
{
    "body": "<a id='comment:3'></a>\n`_cmp_` (one underscore) and `__richcmp__` (two underscores) do not have the same semantic. In your code it seems that you assume that `self` and `other` have the same type and parent... which might not be the case.",
    "created_at": "2016-07-11T20:39:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20998#issuecomment-307520",
    "user": "https://github.com/videlec"
}
```

<a id='comment:3'></a>
`_cmp_` (one underscore) and `__richcmp__` (two underscores) do not have the same semantic. In your code it seems that you assume that `self` and `other` have the same type and parent... which might not be the case.



---

archive/issue_comments_307521.json:
```json
{
    "body": "<a id='comment:4'></a>\nAnd instead of all this repeated noise you can use `rich_to_bool` from `sage/structure/sage_object.pxd`.",
    "created_at": "2016-07-11T20:43:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20998#issuecomment-307521",
    "user": "https://github.com/videlec"
}
```

<a id='comment:4'></a>
And instead of all this repeated noise you can use `rich_to_bool` from `sage/structure/sage_object.pxd`.



---

archive/issue_comments_307522.json:
```json
{
    "body": "<a id='comment:5'></a>\nThis is wrong:\n\n```\ndef __richcmp__(FreeAlgebraElement_letterplace self, other, int op):\n```\n\nYou should not assume that `self` is of type `FreeAlgebraElement_letterplace`, see also [comment:3].",
    "created_at": "2016-07-11T23:43:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20998#issuecomment-307522",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:5'></a>
This is wrong:

```
def __richcmp__(FreeAlgebraElement_letterplace self, other, int op):
```

You should not assume that `self` is of type `FreeAlgebraElement_letterplace`, see also [comment:3].



---

archive/issue_comments_307523.json:
```json
{
    "body": "<a id='comment:6'></a>\nAnd this is not at all a blocking point with Python 3. There is nothing wrong with implementing `_cmp_`, the Sage coercion model should handle it just fine, even for rich comparisons.",
    "created_at": "2016-07-11T23:44:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20998#issuecomment-307523",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:6'></a>
And this is not at all a blocking point with Python 3. There is nothing wrong with implementing `_cmp_`, the Sage coercion model should handle it just fine, even for rich comparisons.



---

archive/issue_comments_307524.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-The first is the current blocking point in py3 compilation.\n+\n``````\n",
    "created_at": "2016-07-11T23:44:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20998#issuecomment-307524",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1 @@
-The first is the current blocking point in py3 compilation.
+
``````




---

archive/issue_events_255474.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-07-11T23:44:29Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/20998",
    "rename": {
        "from": "convert a few cmp to richcmp in some pyx files",
        "to": "convert _cmp_ to __richcmp__ in some pyx files"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20998#event-255474"
}
```



---

archive/issue_comments_307525.json:
```json
{
    "body": "<a id='comment:7'></a>\nSorry, but the line with the command `cmp` in the file `src/sage/algebras/letterplace/free_algebra_element_letterplace.pyx`\nis really the place where the py3 compilation currently stops.\n\nMaybe the description should be restored ?",
    "created_at": "2016-07-12T06:20:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20998#issuecomment-307525",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:7'></a>
Sorry, but the line with the command `cmp` in the file `src/sage/algebras/letterplace/free_algebra_element_letterplace.pyx`
is really the place where the py3 compilation currently stops.

Maybe the description should be restored ?



---

archive/issue_comments_307526.json:
```json
{
    "body": "<a id='comment:8'></a>\nReplying to [@videlec](#comment%3A4):\n> And instead of all this repeated noise you can use `rich_to_bool` from `sage/structure/sage_object.pxd`.\n\nI do not understand how I could use that and at the same time get rid of using `cmp`.",
    "created_at": "2016-07-12T07:38:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20998#issuecomment-307526",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:8'></a>
Replying to [@videlec](#comment%3A4):
> And instead of all this repeated noise you can use `rich_to_bool` from `sage/structure/sage_object.pxd`.

I do not understand how I could use that and at the same time get rid of using `cmp`.



---

archive/issue_comments_307527.json:
```json
{
    "body": "<a id='comment:9'></a>\nFirst of all, the following are 4 different independent things:\n\n1. Getting rid of `cmp=` arguments to `sort()` for example.\n\n2. Getting rid of the `cmp()` function.\n\n3. Getting rid of `__cmp__` methods.\n\n4. Getting rid of `_cmp_` methods.\n\nThe last is not needed because `__richcmp__` will call `_cmp_` if needed.\n\nFor the first 3, I really prefer to consider them as different issues and fix them in the order listed above.",
    "created_at": "2016-07-12T08:35:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20998#issuecomment-307527",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:9'></a>
First of all, the following are 4 different independent things:

1. Getting rid of `cmp=` arguments to `sort()` for example.

2. Getting rid of the `cmp()` function.

3. Getting rid of `__cmp__` methods.

4. Getting rid of `_cmp_` methods.

The last is not needed because `__richcmp__` will call `_cmp_` if needed.

For the first 3, I really prefer to consider them as different issues and fix them in the order listed above.



---

archive/issue_comments_307528.json:
```json
{
    "body": "<a id='comment:10'></a>\nReplying to [@fchapoton](#comment%3A7):\n> Maybe the description should be restored ?\n\nFeel free to add a clearer description than the original one.",
    "created_at": "2016-07-13T19:20:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20998#issuecomment-307528",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:10'></a>
Replying to [@fchapoton](#comment%3A7):
> Maybe the description should be restored ?

Feel free to add a clearer description than the original one.



---

archive/issue_comments_307529.json:
```json
{
    "body": "<a id='comment:11'></a>\nsorry, but I am a bit perplexed here. My initial aim was to try to make more pyx files compile correctly. My idea was that one should get rid of using cmp(a, b).\n\nBut I feel I do not understand enough the cmp mechanisms to do so properly.\n\nDo you have useful concrete suggestions ? For example\n\n```\ngit grep -P -c \"cmp\\(type\" *.pyx\n```\nreturn something like 25 instances. What to do with them ?",
    "created_at": "2016-07-13T19:25:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20998#issuecomment-307529",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:11'></a>
sorry, but I am a bit perplexed here. My initial aim was to try to make more pyx files compile correctly. My idea was that one should get rid of using cmp(a, b).

But I feel I do not understand enough the cmp mechanisms to do so properly.

Do you have useful concrete suggestions ? For example

```
git grep -P -c "cmp\(type" *.pyx
```
return something like 25 instances. What to do with them ?



---

archive/issue_comments_307530.json:
```json
{
    "body": "<a id='comment:12'></a>\nReplying to [@fchapoton](#comment%3A11):\n> Do you have useful concrete suggestions ? For example\n> \n> ```\n> git grep -P -c \"cmp\\(type\" *.pyx\n> ```\n> return something like 25 instances. What to do with them ?\n\nIt depends where you find those `cmp(typeA, typeB)`. If it's within a `def __cmp__` method, then that should be cleaned up anyway. If it's somewhere else, I guess the code should be refactored to not compare types (why would you do that anyway?).",
    "created_at": "2016-07-13T19:30:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20998#issuecomment-307530",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:12'></a>
Replying to [@fchapoton](#comment%3A11):
> Do you have useful concrete suggestions ? For example
> 
> ```
> git grep -P -c "cmp\(type" *.pyx
> ```
> return something like 25 instances. What to do with them ?

It depends where you find those `cmp(typeA, typeB)`. If it's within a `def __cmp__` method, then that should be cleaned up anyway. If it's somewhere else, I guess the code should be refactored to not compare types (why would you do that anyway?).



---

archive/issue_comments_307531.json:
```json
{
    "body": "<a id='comment:13'></a>\nReplying to [@fchapoton](#comment%3A11):\n> My idea was that one should get rid of using cmp(a, b).\n\nA very good aim! But that's not what your patch is doing. Which makes me confused about the actual purpose of this ticket.",
    "created_at": "2016-07-13T19:32:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20998#issuecomment-307531",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:13'></a>
Replying to [@fchapoton](#comment%3A11):
> My idea was that one should get rid of using cmp(a, b).

A very good aim! But that's not what your patch is doing. Which makes me confused about the actual purpose of this ticket.



---

archive/issue_comments_307532.json:
```json
{
    "body": "<a id='comment:14'></a>\nBy the way, we could consider keeping `cmp()`. Even if it doesn't exist in Python 3, we could still implement it in Sage.",
    "created_at": "2016-07-13T19:34:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20998#issuecomment-307532",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:14'></a>
By the way, we could consider keeping `cmp()`. Even if it doesn't exist in Python 3, we could still implement it in Sage.



---

archive/issue_comments_307533.json:
```json
{
    "body": "<a id='comment:15'></a>\nI guess we need to discuss on sage-devel strategies to deal with comparisons. I guess this is the most difficult part of the Python 3 conversion.",
    "created_at": "2016-07-13T19:35:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20998#issuecomment-307533",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:15'></a>
I guess we need to discuss on sage-devel strategies to deal with comparisons. I guess this is the most difficult part of the Python 3 conversion.



---

archive/issue_comments_307534.json:
```json
{
    "body": "<a id='comment:16'></a>\nIndeed, this seems to be tricky. Maybe unicode versus bytes will also be painful.",
    "created_at": "2016-07-13T19:37:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20998#issuecomment-307534",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:16'></a>
Indeed, this seems to be tricky. Maybe unicode versus bytes will also be painful.



---

archive/issue_comments_307535.json:
```json
{
    "body": "<a id='comment:17'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/20ebd435b8739f595ecbb9089f54c24bef3b0145\">20ebd43</a></td><td><code>Merge branch 'public/20998' in 7.3.b9</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2f3c11ea91a8c078b3bd4d70d82460b7d4c952c8\">2f3c11e</a></td><td><code>trac 20998 not assuming same type for other</code></td></tr></table>\n",
    "created_at": "2016-07-28T11:21:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20998#issuecomment-307535",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:17'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/20ebd435b8739f595ecbb9089f54c24bef3b0145">20ebd43</a></td><td><code>Merge branch 'public/20998' in 7.3.b9</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2f3c11ea91a8c078b3bd4d70d82460b7d4c952c8">2f3c11e</a></td><td><code>trac 20998 not assuming same type for other</code></td></tr></table>




---

archive/issue_comments_307536.json:
```json
{
    "body": "**Changing commit** from \"[f4d65c76e96648ce0b1e0bd17122a3eec6bce18f](https://github.com/sagemath/sagetrac-mirror/commit/f4d65c76e96648ce0b1e0bd17122a3eec6bce18f)\" to \"[2f3c11ea91a8c078b3bd4d70d82460b7d4c952c8](https://github.com/sagemath/sagetrac-mirror/commit/2f3c11ea91a8c078b3bd4d70d82460b7d4c952c8)\".",
    "created_at": "2016-07-28T11:21:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20998#issuecomment-307536",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[f4d65c76e96648ce0b1e0bd17122a3eec6bce18f](https://github.com/sagemath/sagetrac-mirror/commit/f4d65c76e96648ce0b1e0bd17122a3eec6bce18f)" to "[2f3c11ea91a8c078b3bd4d70d82460b7d4c952c8](https://github.com/sagemath/sagetrac-mirror/commit/2f3c11ea91a8c078b3bd4d70d82460b7d4c952c8)".



---

archive/issue_comments_307537.json:
```json
{
    "body": "**Changing commit** from \"[2f3c11ea91a8c078b3bd4d70d82460b7d4c952c8](https://github.com/sagemath/sagetrac-mirror/commit/2f3c11ea91a8c078b3bd4d70d82460b7d4c952c8)\" to \"[2f8a4d1dffcd0bc30e742b71adc10221d54d2f30](https://github.com/sagemath/sagetrac-mirror/commit/2f8a4d1dffcd0bc30e742b71adc10221d54d2f30)\".",
    "created_at": "2016-07-28T13:40:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20998#issuecomment-307537",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[2f3c11ea91a8c078b3bd4d70d82460b7d4c952c8](https://github.com/sagemath/sagetrac-mirror/commit/2f3c11ea91a8c078b3bd4d70d82460b7d4c952c8)" to "[2f8a4d1dffcd0bc30e742b71adc10221d54d2f30](https://github.com/sagemath/sagetrac-mirror/commit/2f8a4d1dffcd0bc30e742b71adc10221d54d2f30)".



---

archive/issue_comments_307538.json:
```json
{
    "body": "<a id='comment:18'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2f8a4d1dffcd0bc30e742b71adc10221d54d2f30\">2f8a4d1</a></td><td><code>trac 20998 trying to simplify the logic by factorizing code</code></td></tr></table>\n",
    "created_at": "2016-07-28T13:40:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20998#issuecomment-307538",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:18'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2f8a4d1dffcd0bc30e742b71adc10221d54d2f30">2f8a4d1</a></td><td><code>trac 20998 trying to simplify the logic by factorizing code</code></td></tr></table>




---

archive/issue_comments_307539.json:
```json
{
    "body": "<a id='comment:19'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f66236b3c60ee0afd79b1a38671b4daa65673946\">f66236b</a></td><td><code>trac 20998 details</code></td></tr></table>\n",
    "created_at": "2016-07-28T13:53:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20998#issuecomment-307539",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:19'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f66236b3c60ee0afd79b1a38671b4daa65673946">f66236b</a></td><td><code>trac 20998 details</code></td></tr></table>




---

archive/issue_comments_307540.json:
```json
{
    "body": "**Changing commit** from \"[2f8a4d1dffcd0bc30e742b71adc10221d54d2f30](https://github.com/sagemath/sagetrac-mirror/commit/2f8a4d1dffcd0bc30e742b71adc10221d54d2f30)\" to \"[f66236b3c60ee0afd79b1a38671b4daa65673946](https://github.com/sagemath/sagetrac-mirror/commit/f66236b3c60ee0afd79b1a38671b4daa65673946)\".",
    "created_at": "2016-07-28T13:53:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20998#issuecomment-307540",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[2f8a4d1dffcd0bc30e742b71adc10221d54d2f30](https://github.com/sagemath/sagetrac-mirror/commit/2f8a4d1dffcd0bc30e742b71adc10221d54d2f30)" to "[f66236b3c60ee0afd79b1a38671b4daa65673946](https://github.com/sagemath/sagetrac-mirror/commit/f66236b3c60ee0afd79b1a38671b4daa65673946)".



---

archive/issue_comments_307541.json:
```json
{
    "body": "**Changing commit** from \"[f66236b3c60ee0afd79b1a38671b4daa65673946](https://github.com/sagemath/sagetrac-mirror/commit/f66236b3c60ee0afd79b1a38671b4daa65673946)\" to \"[750f6989bdd90aefe29db49fef6a0043c4363865](https://github.com/sagemath/sagetrac-mirror/commit/750f6989bdd90aefe29db49fef6a0043c4363865)\".",
    "created_at": "2016-07-28T18:41:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20998#issuecomment-307541",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[f66236b3c60ee0afd79b1a38671b4daa65673946](https://github.com/sagemath/sagetrac-mirror/commit/f66236b3c60ee0afd79b1a38671b4daa65673946)" to "[750f6989bdd90aefe29db49fef6a0043c4363865](https://github.com/sagemath/sagetrac-mirror/commit/750f6989bdd90aefe29db49fef6a0043c4363865)".



---

archive/issue_comments_307542.json:
```json
{
    "body": "<a id='comment:20'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/750f6989bdd90aefe29db49fef6a0043c4363865\">750f698</a></td><td><code>trac 20998 fixing the code</code></td></tr></table>\n",
    "created_at": "2016-07-28T18:41:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20998#issuecomment-307542",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:20'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/750f6989bdd90aefe29db49fef6a0043c4363865">750f698</a></td><td><code>trac 20998 fixing the code</code></td></tr></table>




---

archive/issue_comments_307543.json:
```json
{
    "body": "<a id='comment:21'></a>\nI am still waiting for a description of which problem this ticket is addressing.",
    "created_at": "2016-07-28T19:19:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20998#issuecomment-307543",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:21'></a>
I am still waiting for a description of which problem this ticket is addressing.



---

archive/issue_comments_307544.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1,7 @@\n+When trying to compile sage with py3, the first failing point\n+is currently caused by the use of \"cmp\" in some pyx files.\n \n+This tickets aims to make a few more pyx files compile correctly\n+by removing cmp in them. This can be considered as en experiment,\n+as this will have to be done on a larger scale later.\n+\n``````\n",
    "created_at": "2016-07-28T19:25:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20998#issuecomment-307544",
    "user": "https://github.com/fchapoton"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1,7 @@
+When trying to compile sage with py3, the first failing point
+is currently caused by the use of "cmp" in some pyx files.
 
+This tickets aims to make a few more pyx files compile correctly
+by removing cmp in them. This can be considered as en experiment,
+as this will have to be done on a larger scale later.
+
``````




---

archive/issue_events_255475.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-07-28T19:25:05Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/20998",
    "rename": {
        "from": "convert _cmp_ to __richcmp__ in some pyx files",
        "to": "removing deprecated builtin cmp in some pyx files"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20998#event-255475"
}
```



---

archive/issue_comments_307545.json:
```json
{
    "body": "<a id='comment:22'></a>\nHere is a tentative description. Note that I am now waiting for patchbot's results before setting to needs_review.",
    "created_at": "2016-07-28T19:25:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20998#issuecomment-307545",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:22'></a>
Here is a tentative description. Note that I am now waiting for patchbot's results before setting to needs_review.



---

archive/issue_events_255476.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-07-28T20:31:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20998",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20998#event-255476"
}
```



---

archive/issue_events_255477.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-07-28T20:31:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20998",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "008080",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20998#event-255477"
}
```



---

archive/issue_comments_307546.json:
```json
{
    "body": "<a id='comment:23'></a>\nplease tell me what you think..",
    "created_at": "2016-07-28T20:31:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20998#issuecomment-307546",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:23'></a>
please tell me what you think..



---

archive/issue_events_255478.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-07-29T07:39:12Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/20998",
    "rename": {
        "from": "removing deprecated builtin cmp in some pyx files",
        "to": "Removing deprecated cmp and __cmp__ in some pyx files"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20998#event-255478"
}
```



---

archive/issue_events_255479.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-07-29T07:39:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20998",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "008080",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20998#event-255479"
}
```



---

archive/issue_events_255480.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-07-29T07:39:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20998",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20998#event-255480"
}
```



---

archive/issue_comments_307547.json:
```json
{
    "body": "**Reviewer:** Jeroen Demeyer",
    "created_at": "2016-07-29T07:39:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20998#issuecomment-307547",
    "user": "https://github.com/jdemeyer"
}
```

**Reviewer:** Jeroen Demeyer



---

archive/issue_comments_307548.json:
```json
{
    "body": "<a id='comment:24'></a>\n1. **free_algebra_element_letterplace.pyx**, **semigroups_cython.pyx** and **map.pyx**:\n\n`__richcmp__` bypasses the coercion model which is usually not what you want for `Element` classes. The rule of thumb is that any comparison/arithmetic of Sage `Element`s should use the coercion model unless there is a reason not to. Maybe for `FormalCompositeMap`, there is not much point in using the coercion model. But `FreeAlgebraElement_letterplace` and `LeftZeroSemigroupElement` really are elements where coercion looks useful.\n\nThe `_cmp_` and `_richcmp_` methods come from the coercion model, so you are guaranteed equal parents, which likely implies that both arguments are instances of `FreeAlgebraElement_letterplace`, `LeftZeroSemigroupElement` or `FormalCompositeMap`. In that case, you can just drop the type comparison.\n\n2. The function **richcmp_shortcut**:\n\nThis should be removed and replaced by the standard Python function `PyObject_RichCompare`. For an example on how to use it, see `src/sage/structure/coerce.pyx`.",
    "created_at": "2016-07-29T07:39:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20998#issuecomment-307548",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:24'></a>
1. **free_algebra_element_letterplace.pyx**, **semigroups_cython.pyx** and **map.pyx**:

`__richcmp__` bypasses the coercion model which is usually not what you want for `Element` classes. The rule of thumb is that any comparison/arithmetic of Sage `Element`s should use the coercion model unless there is a reason not to. Maybe for `FormalCompositeMap`, there is not much point in using the coercion model. But `FreeAlgebraElement_letterplace` and `LeftZeroSemigroupElement` really are elements where coercion looks useful.

The `_cmp_` and `_richcmp_` methods come from the coercion model, so you are guaranteed equal parents, which likely implies that both arguments are instances of `FreeAlgebraElement_letterplace`, `LeftZeroSemigroupElement` or `FormalCompositeMap`. In that case, you can just drop the type comparison.

2. The function **richcmp_shortcut**:

This should be removed and replaced by the standard Python function `PyObject_RichCompare`. For an example on how to use it, see `src/sage/structure/coerce.pyx`.



---

archive/issue_comments_307549.json:
```json
{
    "body": "**Changing commit** from \"[750f6989bdd90aefe29db49fef6a0043c4363865](https://github.com/sagemath/sagetrac-mirror/commit/750f6989bdd90aefe29db49fef6a0043c4363865)\" to \"[0e819d2704eb9ff6a5287ae200fe65470cf9d011](https://github.com/sagemath/sagetrac-mirror/commit/0e819d2704eb9ff6a5287ae200fe65470cf9d011)\".",
    "created_at": "2016-07-29T09:21:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20998#issuecomment-307549",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[750f6989bdd90aefe29db49fef6a0043c4363865](https://github.com/sagemath/sagetrac-mirror/commit/750f6989bdd90aefe29db49fef6a0043c4363865)" to "[0e819d2704eb9ff6a5287ae200fe65470cf9d011](https://github.com/sagemath/sagetrac-mirror/commit/0e819d2704eb9ff6a5287ae200fe65470cf9d011)".



---

archive/issue_comments_307550.json:
```json
{
    "body": "<a id='comment:25'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/139239691baa75964778b83ab9280ea1cba54f88\">1392396</a></td><td><code>Merge branch 'public/20998' in 7.3.rc0</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0e819d2704eb9ff6a5287ae200fe65470cf9d011\">0e819d2</a></td><td><code>using an existing function for rich comparison</code></td></tr></table>\n",
    "created_at": "2016-07-29T09:21:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20998#issuecomment-307550",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:25'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/139239691baa75964778b83ab9280ea1cba54f88">1392396</a></td><td><code>Merge branch 'public/20998' in 7.3.rc0</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0e819d2704eb9ff6a5287ae200fe65470cf9d011">0e819d2</a></td><td><code>using an existing function for rich comparison</code></td></tr></table>




---

archive/issue_comments_307551.json:
```json
{
    "body": "<a id='comment:26'></a>\nThanks.\n\nI have tried to make changes for your point 2.\n\nI am not quite sure to understand your point 1. Do you suggest that in these 3 files I should replace double-underscored `__richcmp__` methods by single-underscored `_richcmp_` methods, and at the same time remove the check for type equality ?",
    "created_at": "2016-07-29T09:25:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20998#issuecomment-307551",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:26'></a>
Thanks.

I have tried to make changes for your point 2.

I am not quite sure to understand your point 1. Do you suggest that in these 3 files I should replace double-underscored `__richcmp__` methods by single-underscored `_richcmp_` methods, and at the same time remove the check for type equality ?



---

archive/issue_comments_307552.json:
```json
{
    "body": "<a id='comment:27'></a>\nReplying to [@fchapoton](#comment%3A26):\n> Thanks.\n> \n> I have tried to make changes for your point 2.\n\nLooks good.\n\n> Do you suggest that in these 3 files I should replace double-underscored `__richcmp__` methods by single-underscored `_richcmp_` methods, and at the same time remove the check for type equality ?\n\nHard to tell in general because one really needs to understand what the various classes do and which kind of objects you would like to compare. For `FreeAlgebraElement_letterplace` and `LeftZeroSemigroupElement`, the answer to your question is probably \"YES\", for `FormalCompositeMap` it might be \"NO\".",
    "created_at": "2016-07-29T10:33:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20998#issuecomment-307552",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:27'></a>
Replying to [@fchapoton](#comment%3A26):
> Thanks.
> 
> I have tried to make changes for your point 2.

Looks good.

> Do you suggest that in these 3 files I should replace double-underscored `__richcmp__` methods by single-underscored `_richcmp_` methods, and at the same time remove the check for type equality ?

Hard to tell in general because one really needs to understand what the various classes do and which kind of objects you would like to compare. For `FreeAlgebraElement_letterplace` and `LeftZeroSemigroupElement`, the answer to your question is probably "YES", for `FormalCompositeMap` it might be "NO".



---

archive/issue_comments_307553.json:
```json
{
    "body": "**Changing commit** from \"[0e819d2704eb9ff6a5287ae200fe65470cf9d011](https://github.com/sagemath/sagetrac-mirror/commit/0e819d2704eb9ff6a5287ae200fe65470cf9d011)\" to \"[dd8c133e043a24e1e03dc497f242aea087735ba9](https://github.com/sagemath/sagetrac-mirror/commit/dd8c133e043a24e1e03dc497f242aea087735ba9)\".",
    "created_at": "2016-07-31T16:28:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20998#issuecomment-307553",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[0e819d2704eb9ff6a5287ae200fe65470cf9d011](https://github.com/sagemath/sagetrac-mirror/commit/0e819d2704eb9ff6a5287ae200fe65470cf9d011)" to "[dd8c133e043a24e1e03dc497f242aea087735ba9](https://github.com/sagemath/sagetrac-mirror/commit/dd8c133e043a24e1e03dc497f242aea087735ba9)".



---

archive/issue_comments_307554.json:
```json
{
    "body": "<a id='comment:28'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dd8c133e043a24e1e03dc497f242aea087735ba9\">dd8c133</a></td><td><code>trac #20998 using richcmp in the coercion framework</code></td></tr></table>\n",
    "created_at": "2016-07-31T16:28:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20998#issuecomment-307554",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:28'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dd8c133e043a24e1e03dc497f242aea087735ba9">dd8c133</a></td><td><code>trac #20998 using richcmp in the coercion framework</code></td></tr></table>




---

archive/issue_comments_307555.json:
```json
{
    "body": "<a id='comment:29'></a>\nIt seems that using `_richcmp_` in `FreeAlgebraElement_letterplace` and `LeftZeroSemigroupElement` breaks many doctests.",
    "created_at": "2016-08-02T08:14:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20998#issuecomment-307555",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:29'></a>
It seems that using `_richcmp_` in `FreeAlgebraElement_letterplace` and `LeftZeroSemigroupElement` breaks many doctests.



---

archive/issue_comments_307556.json:
```json
{
    "body": "<a id='comment:30'></a>\nMaybe this is the problem:\n\n```\n[sagelib-7.3.rc0] warning: sage/categories/examples/semigroups_cython.pyx:89:4: Overriding cdef method with def method.\n[sagelib-7.3.rc0] warning: sage/algebras/letterplace/free_algebra_element_letterplace.pyx:455:4: Overriding cdef method with def method.\n```",
    "created_at": "2016-08-02T11:24:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20998#issuecomment-307556",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:30'></a>
Maybe this is the problem:

```
[sagelib-7.3.rc0] warning: sage/categories/examples/semigroups_cython.pyx:89:4: Overriding cdef method with def method.
[sagelib-7.3.rc0] warning: sage/algebras/letterplace/free_algebra_element_letterplace.pyx:455:4: Overriding cdef method with def method.
```



---

archive/issue_comments_307557.json:
```json
{
    "body": "<a id='comment:31'></a>\nand what would be the cure ?",
    "created_at": "2016-08-02T11:56:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20998#issuecomment-307557",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:31'></a>
and what would be the cure ?



---

archive/issue_comments_307558.json:
```json
{
    "body": "**Changing commit** from \"[dd8c133e043a24e1e03dc497f242aea087735ba9](https://github.com/sagemath/sagetrac-mirror/commit/dd8c133e043a24e1e03dc497f242aea087735ba9)\" to \"[84793748dfca6d396d7dfe08ba71a440b05ad66f](https://github.com/sagemath/sagetrac-mirror/commit/84793748dfca6d396d7dfe08ba71a440b05ad66f)\".",
    "created_at": "2016-08-02T16:20:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20998#issuecomment-307558",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[dd8c133e043a24e1e03dc497f242aea087735ba9](https://github.com/sagemath/sagetrac-mirror/commit/dd8c133e043a24e1e03dc497f242aea087735ba9)" to "[84793748dfca6d396d7dfe08ba71a440b05ad66f](https://github.com/sagemath/sagetrac-mirror/commit/84793748dfca6d396d7dfe08ba71a440b05ad66f)".



---

archive/issue_comments_307559.json:
```json
{
    "body": "<a id='comment:32'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/84793748dfca6d396d7dfe08ba71a440b05ad66f\">8479374</a></td><td><code>trac 20998 using cpdef for _richcmp_</code></td></tr></table>\n",
    "created_at": "2016-08-02T16:20:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20998#issuecomment-307559",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:32'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/84793748dfca6d396d7dfe08ba71a440b05ad66f">8479374</a></td><td><code>trac 20998 using cpdef for _richcmp_</code></td></tr></table>




---

archive/issue_events_255481.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-08-02T18:40:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20998",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20998#event-255481"
}
```



---

archive/issue_events_255482.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-08-02T18:40:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20998",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20998#event-255482"
}
```



---

archive/issue_comments_307560.json:
```json
{
    "body": "<a id='comment:33'></a>\nbot is green",
    "created_at": "2016-08-02T18:40:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20998#issuecomment-307560",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:33'></a>
bot is green



---

archive/issue_events_255483.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-08-03T06:14:45Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20998",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20998#event-255483"
}
```



---

archive/issue_events_255484.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-08-03T06:14:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20998",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20998#event-255484"
}
```



---

archive/issue_comments_307561.json:
```json
{
    "body": "<a id='comment:34'></a>\nWhy did you remove\n\n```\n        if type(self) != type(other):\n            return NotImplemented\n```\nThat's very important to avoid segmentation faults. You should keep that and change `!=` to `is not`.",
    "created_at": "2016-08-03T06:14:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20998#issuecomment-307561",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:34'></a>
Why did you remove

```
        if type(self) != type(other):
            return NotImplemented
```
That's very important to avoid segmentation faults. You should keep that and change `!=` to `is not`.



---

archive/issue_comments_307562.json:
```json
{
    "body": "<a id='comment:35'></a>\nReplying to [@jdemeyer](#comment%3A34):\n> Why did you remove\n> \n> ```\n>         if type(self) != type(other):\n>             return NotImplemented\n> ```\n> That's very important to avoid segmentation faults. You should keep that and change `!=` to `is not`.\n\nwhich file are you talking about, please ? only the map one ?",
    "created_at": "2016-08-03T06:17:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20998#issuecomment-307562",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:35'></a>
Replying to [@jdemeyer](#comment%3A34):
> Why did you remove
> 
> ```
>         if type(self) != type(other):
>             return NotImplemented
> ```
> That's very important to avoid segmentation faults. You should keep that and change `!=` to `is not`.

which file are you talking about, please ? only the map one ?



---

archive/issue_comments_307563.json:
```json
{
    "body": "**Changing commit** from \"[84793748dfca6d396d7dfe08ba71a440b05ad66f](https://github.com/sagemath/sagetrac-mirror/commit/84793748dfca6d396d7dfe08ba71a440b05ad66f)\" to \"[f95b1b7dbfa43680391383338c60faaa6709f258](https://github.com/sagemath/sagetrac-mirror/commit/f95b1b7dbfa43680391383338c60faaa6709f258)\".",
    "created_at": "2016-08-03T08:12:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20998#issuecomment-307563",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[84793748dfca6d396d7dfe08ba71a440b05ad66f](https://github.com/sagemath/sagetrac-mirror/commit/84793748dfca6d396d7dfe08ba71a440b05ad66f)" to "[f95b1b7dbfa43680391383338c60faaa6709f258](https://github.com/sagemath/sagetrac-mirror/commit/f95b1b7dbfa43680391383338c60faaa6709f258)".



---

archive/issue_comments_307564.json:
```json
{
    "body": "<a id='comment:36'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f95b1b7dbfa43680391383338c60faaa6709f258\">f95b1b7</a></td><td><code>trac 20998 re-adding type checking</code></td></tr></table>\n",
    "created_at": "2016-08-03T08:12:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20998#issuecomment-307564",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:36'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f95b1b7dbfa43680391383338c60faaa6709f258">f95b1b7</a></td><td><code>trac 20998 re-adding type checking</code></td></tr></table>




---

archive/issue_events_255485.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-08-03T08:13:03Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20998",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20998#event-255485"
}
```



---

archive/issue_events_255486.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-08-03T08:13:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20998",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20998#event-255486"
}
```



---

archive/issue_comments_307565.json:
```json
{
    "body": "<a id='comment:37'></a>\nis this what you suggested ?",
    "created_at": "2016-08-03T08:13:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20998#issuecomment-307565",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:37'></a>
is this what you suggested ?



---

archive/issue_comments_307566.json:
```json
{
    "body": "<a id='comment:38'></a>\nI think you should add a doctest where you compare a map to something silly, like `None` and the integer `2`.",
    "created_at": "2016-08-03T10:39:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20998#issuecomment-307566",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:38'></a>
I think you should add a doctest where you compare a map to something silly, like `None` and the integer `2`.



---

archive/issue_comments_307567.json:
```json
{
    "body": "<a id='comment:39'></a>\nTo elaborate, in `map.pyx`, you are *not* using the coercion model. So we should add a test that something sensible happens when comparing a map with something else. If you use `_richcmp_` (single underscores), that's not an issue since the coercion model handles that.",
    "created_at": "2016-08-03T10:44:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20998#issuecomment-307567",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:39'></a>
To elaborate, in `map.pyx`, you are *not* using the coercion model. So we should add a test that something sensible happens when comparing a map with something else. If you use `_richcmp_` (single underscores), that's not an issue since the coercion model handles that.



---

archive/issue_comments_307568.json:
```json
{
    "body": "**Changing commit** from \"[f95b1b7dbfa43680391383338c60faaa6709f258](https://github.com/sagemath/sagetrac-mirror/commit/f95b1b7dbfa43680391383338c60faaa6709f258)\" to \"[e019d8c9ba333d3e7c7a77edbee1167ecfb1ca3b](https://github.com/sagemath/sagetrac-mirror/commit/e019d8c9ba333d3e7c7a77edbee1167ecfb1ca3b)\".",
    "created_at": "2016-08-03T12:42:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20998#issuecomment-307568",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[f95b1b7dbfa43680391383338c60faaa6709f258](https://github.com/sagemath/sagetrac-mirror/commit/f95b1b7dbfa43680391383338c60faaa6709f258)" to "[e019d8c9ba333d3e7c7a77edbee1167ecfb1ca3b](https://github.com/sagemath/sagetrac-mirror/commit/e019d8c9ba333d3e7c7a77edbee1167ecfb1ca3b)".



---

archive/issue_comments_307569.json:
```json
{
    "body": "<a id='comment:40'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e019d8c9ba333d3e7c7a77edbee1167ecfb1ca3b\">e019d8c</a></td><td><code>trac #20998 adding doctests for comparison of map and something</code></td></tr></table>\n",
    "created_at": "2016-08-03T12:42:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20998#issuecomment-307569",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:40'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e019d8c9ba333d3e7c7a77edbee1167ecfb1ca3b">e019d8c</a></td><td><code>trac #20998 adding doctests for comparison of map and something</code></td></tr></table>




---

archive/issue_comments_307570.json:
```json
{
    "body": "<a id='comment:41'></a>\nI am not sure we really understand each other. Anyway. I have launched my patchbot on the latest branch. Let us wait for the results.",
    "created_at": "2016-08-03T12:48:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20998#issuecomment-307570",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:41'></a>
I am not sure we really understand each other. Anyway. I have launched my patchbot on the latest branch. Let us wait for the results.



---

archive/issue_comments_307571.json:
```json
{
    "body": "<a id='comment:42'></a>\nI am misunderstanding you since I didn't notice that you changed `def __richcmp__` to `cpdef _richcmp_` in this commit:\n\n|                                                                                                                                                 |                                      |\n|-------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------|\n|[8479374](https://github.com/sagemath/sagetrac-mirror/commit/84793748dfca6d396d7dfe08ba71a440b05ad66f)|`trac 20998 using cpdef for _richcmp_`|\n\nI thought that you only changed `def _richcmp_` to `cpdef _richcmp_` which would have been the right thing to do.",
    "created_at": "2016-08-03T12:58:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20998#issuecomment-307571",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:42'></a>
I am misunderstanding you since I didn't notice that you changed `def __richcmp__` to `cpdef _richcmp_` in this commit:

|                                                                                                                                                 |                                      |
|-------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------|
|[8479374](https://github.com/sagemath/sagetrac-mirror/commit/84793748dfca6d396d7dfe08ba71a440b05ad66f)|`trac 20998 using cpdef for _richcmp_`|

I thought that you only changed `def _richcmp_` to `cpdef _richcmp_` which would have been the right thing to do.



---

archive/issue_comments_307572.json:
```json
{
    "body": "<a id='comment:43'></a>\nok, bot is green. Is the current state of affairs ok for you ?",
    "created_at": "2016-08-03T18:36:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20998#issuecomment-307572",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:43'></a>
ok, bot is green. Is the current state of affairs ok for you ?



---

archive/issue_events_255487.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-08-04T07:31:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20998",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20998#event-255487"
}
```



---

archive/issue_events_255488.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-08-04T07:31:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20998",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20998#event-255488"
}
```



---

archive/issue_comments_307573.json:
```json
{
    "body": "<a id='comment:45'></a>\nI am planning some changes to the implementation of comparisons (#21163). In order to avoid conflicts, it would be good to not make further changes to `__cmp__` in other tickets.",
    "created_at": "2016-08-04T08:00:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20998#issuecomment-307573",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:45'></a>
I am planning some changes to the implementation of comparisons (#21163). In order to avoid conflicts, it would be good to not make further changes to `__cmp__` in other tickets.



---

archive/issue_comments_307574.json:
```json
{
    "body": "<a id='comment:46'></a>\nReplying to [@jdemeyer](#comment%3A45):\n> I am planning some changes to the implementation of comparisons (#21163). In order to avoid conflicts, it would be good to not make further changes to `__cmp__` in other tickets.\n\nok, message received",
    "created_at": "2016-08-04T08:01:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20998#issuecomment-307574",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:46'></a>
Replying to [@jdemeyer](#comment%3A45):
> I am planning some changes to the implementation of comparisons (#21163). In order to avoid conflicts, it would be good to not make further changes to `__cmp__` in other tickets.

ok, message received



---

archive/issue_comments_307575.json:
```json
{
    "body": "<a id='comment:47'></a>\nI just realized that, for #21163 to work, I need to get rid of most `__cmp__` methods. So that is going to be some work...",
    "created_at": "2016-08-04T10:54:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20998#issuecomment-307575",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:47'></a>
I just realized that, for #21163 to work, I need to get rid of most `__cmp__` methods. So that is going to be some work...



---

archive/issue_comments_307576.json:
```json
{
    "body": "<a id='comment:48'></a>\nReplying to [@jdemeyer](#comment%3A47):\n> I just realized that, for #21163 to work, I need to get rid of most `__cmp__` methods. So that is going to be some work...\n\nActually, never mind. I found a quick fix for #21163.",
    "created_at": "2016-08-04T11:35:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20998#issuecomment-307576",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:48'></a>
Replying to [@jdemeyer](#comment%3A47):
> I just realized that, for #21163 to work, I need to get rid of most `__cmp__` methods. So that is going to be some work...

Actually, never mind. I found a quick fix for #21163.



---

archive/issue_comments_307577.json:
```json
{
    "body": "<a id='comment:49'></a>\n#21163 turned out to be quite easy, so you can freely work on `__cmp__` tickets now. There are more than 300 instances of `def __cmp__`, so this is going to be some work...",
    "created_at": "2016-08-05T12:07:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20998#issuecomment-307577",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:49'></a>
#21163 turned out to be quite easy, so you can freely work on `__cmp__` tickets now. There are more than 300 instances of `def __cmp__`, so this is going to be some work...



---

archive/issue_comments_307578.json:
```json
{
    "body": "**Changing branch** from \"[public/20998](https://github.com/sagemath/sagetrac-mirror/tree/public/20998)\" to \"[e019d8c9ba333d3e7c7a77edbee1167ecfb1ca3b](https://github.com/sagemath/sagetrac-mirror/commit/e019d8c9ba333d3e7c7a77edbee1167ecfb1ca3b)\".",
    "created_at": "2016-08-07T20:01:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20998#issuecomment-307578",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[public/20998](https://github.com/sagemath/sagetrac-mirror/tree/public/20998)" to "[e019d8c9ba333d3e7c7a77edbee1167ecfb1ca3b](https://github.com/sagemath/sagetrac-mirror/commit/e019d8c9ba333d3e7c7a77edbee1167ecfb1ca3b)".



---

archive/issue_events_255489.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-08-07T20:01:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20998",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20998#event-255489"
}
```



---

archive/issue_events_255490.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "399320b562d570e681ae7a5b5b63093d89e6877d",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2016-08-07T20:01:18Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/20998",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20998#event-255490"
}
```
