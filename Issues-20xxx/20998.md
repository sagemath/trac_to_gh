# Issue 20998: Removing deprecated cmp and __cmp__ in some pyx files

archive/issues_020761.json:
```json
{
    "body": "When trying to compile sage with py3, the first failing point\nis currently caused by the use of \"cmp\" in some pyx files.\n\nThis tickets aims to make a few more pyx files compile correctly\nby removing cmp in them. This can be considered as en experiment,\nas this will have to be done on a larger scale later.\n\n\nCC:  @tscrim @jm58660 @jdemeyer @embray\n\nBranch/Commit: e019d8c9ba333d3e7c7a77edbee1167ecfb1ca3b\n\nReviewer: Jeroen Demeyer\n\nAuthor: Fr\u00e9d\u00e9ric Chapoton\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/20998\n\n",
    "closed_at": "2016-08-07T20:01:18Z",
    "created_at": "2016-07-11T12:08:13Z",
    "labels": [
        "component: python3"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.3",
    "title": "Removing deprecated cmp and __cmp__ in some pyx files",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/20998",
    "user": "https://github.com/fchapoton"
}
```
When trying to compile sage with py3, the first failing point
is currently caused by the use of "cmp" in some pyx files.

This tickets aims to make a few more pyx files compile correctly
by removing cmp in them. This can be considered as en experiment,
as this will have to be done on a larger scale later.


CC:  @tscrim @jm58660 @jdemeyer @embray

Branch/Commit: e019d8c9ba333d3e7c7a77edbee1167ecfb1ca3b

Reviewer: Jeroen Demeyer

Author: Frédéric Chapoton

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/20998





---

archive/issue_comments_305091.json:
```json
{
    "body": "<a id='comment:1'></a>New commits:",
    "created_at": "2016-07-11T12:09:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20998#issuecomment-305091",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:1'></a>New commits:



---

archive/issue_comments_305092.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-07-11T12:09:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20998#issuecomment-305092",
    "user": "https://github.com/fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_305093.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-07-11T20:39:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20998#issuecomment-305093",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_305094.json:
```json
{
    "body": "<a id='comment:3'></a>`_cmp_` (one underscore) and `__richcmp__` (two underscores) do not have the same semantic. In your code it seems that you assume that `self` and `other` have the same type and parent... which might not be the case.",
    "created_at": "2016-07-11T20:39:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20998#issuecomment-305094",
    "user": "https://github.com/videlec"
}
```

<a id='comment:3'></a>`_cmp_` (one underscore) and `__richcmp__` (two underscores) do not have the same semantic. In your code it seems that you assume that `self` and `other` have the same type and parent... which might not be the case.



---

archive/issue_comments_305095.json:
```json
{
    "body": "<a id='comment:4'></a>And instead of all this repeated noise you can use `rich_to_bool` from `sage/structure/sage_object.pxd`.",
    "created_at": "2016-07-11T20:43:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20998#issuecomment-305095",
    "user": "https://github.com/videlec"
}
```

<a id='comment:4'></a>And instead of all this repeated noise you can use `rich_to_bool` from `sage/structure/sage_object.pxd`.



---

archive/issue_comments_305096.json:
```json
{
    "body": "<a id='comment:5'></a>This is wrong:\n\n```\ndef __richcmp__(FreeAlgebraElement_letterplace self, other, int op):\n```\n\nYou should not assume that `self` is of type `FreeAlgebraElement_letterplace`, see also [comment:3].",
    "created_at": "2016-07-11T23:43:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20998#issuecomment-305096",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:5'></a>This is wrong:

```
def __richcmp__(FreeAlgebraElement_letterplace self, other, int op):
```

You should not assume that `self` is of type `FreeAlgebraElement_letterplace`, see also [comment:3].



---

archive/issue_comments_305097.json:
```json
{
    "body": "<a id='comment:6'></a>And this is not at all a blocking point with Python 3. There is nothing wrong with implementing `_cmp_`, the Sage coercion model should handle it just fine, even for rich comparisons.",
    "created_at": "2016-07-11T23:44:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20998#issuecomment-305097",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:6'></a>And this is not at all a blocking point with Python 3. There is nothing wrong with implementing `_cmp_`, the Sage coercion model should handle it just fine, even for rich comparisons.



---

archive/issue_comments_305098.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-The first is the current blocking point in py3 compilation.\n+\n \n Author: Fr\u00e9d\u00e9ric Chapoton\n \n``````\n",
    "created_at": "2016-07-11T23:44:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20998#issuecomment-305098",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-The first is the current blocking point in py3 compilation.
+
 
 Author: Frédéric Chapoton
 
``````




---

archive/issue_comments_305099.json:
```json
{
    "body": "<a id='comment:7'></a>Sorry, but the line with the command `cmp` in the file `src/sage/algebras/letterplace/free_algebra_element_letterplace.pyx`\nis really the place where the py3 compilation currently stops.\n\nMaybe the description should be restored ?",
    "created_at": "2016-07-12T06:20:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20998#issuecomment-305099",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:7'></a>Sorry, but the line with the command `cmp` in the file `src/sage/algebras/letterplace/free_algebra_element_letterplace.pyx`
is really the place where the py3 compilation currently stops.

Maybe the description should be restored ?



---

archive/issue_comments_305100.json:
```json
{
    "body": "<a id='comment:8'></a>Replying to [comment:4 vdelecroix]:\n> And instead of all this repeated noise you can use `rich_to_bool` from `sage/structure/sage_object.pxd`.\n\n\nI do not understand how I could use that and at the same time get rid of using `cmp`.",
    "created_at": "2016-07-12T07:38:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20998#issuecomment-305100",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:8'></a>Replying to [comment:4 vdelecroix]:
> And instead of all this repeated noise you can use `rich_to_bool` from `sage/structure/sage_object.pxd`.


I do not understand how I could use that and at the same time get rid of using `cmp`.



---

archive/issue_comments_305101.json:
```json
{
    "body": "<a id='comment:9'></a>First of all, the following are 4 different independent things:\n\n1. Getting rid of `cmp=` arguments to `sort()` for example.\n\n2. Getting rid of the `cmp()` function.\n\n3. Getting rid of `__cmp__` methods.\n\n4. Getting rid of `_cmp_` methods.\n\nThe last is not needed because `__richcmp__` will call `_cmp_` if needed.\n\nFor the first 3, I really prefer to consider them as different issues and fix them in the order listed above.",
    "created_at": "2016-07-12T08:35:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20998#issuecomment-305101",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:9'></a>First of all, the following are 4 different independent things:

1. Getting rid of `cmp=` arguments to `sort()` for example.

2. Getting rid of the `cmp()` function.

3. Getting rid of `__cmp__` methods.

4. Getting rid of `_cmp_` methods.

The last is not needed because `__richcmp__` will call `_cmp_` if needed.

For the first 3, I really prefer to consider them as different issues and fix them in the order listed above.



---

archive/issue_comments_305102.json:
```json
{
    "body": "<a id='comment:10'></a>Replying to [comment:7 chapoton]:\n> Maybe the description should be restored ?\n\n\nFeel free to add a clearer description than the original one.",
    "created_at": "2016-07-13T19:20:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20998#issuecomment-305102",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:10'></a>Replying to [comment:7 chapoton]:
> Maybe the description should be restored ?


Feel free to add a clearer description than the original one.



---

archive/issue_comments_305103.json:
```json
{
    "body": "<a id='comment:11'></a>sorry, but I am a bit perplexed here. My initial aim was to try to make more pyx files compile correctly. My idea was that one should get rid of using cmp(a, b).\n\nBut I feel I do not understand enough the cmp mechanisms to do so properly.\n\nDo you have useful concrete suggestions ? For example\n\n```\ngit grep -P -c \"cmp\\(type\" *.pyx\n```\nreturn something like 25 instances. What to do with them ?",
    "created_at": "2016-07-13T19:25:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20998#issuecomment-305103",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:11'></a>sorry, but I am a bit perplexed here. My initial aim was to try to make more pyx files compile correctly. My idea was that one should get rid of using cmp(a, b).

But I feel I do not understand enough the cmp mechanisms to do so properly.

Do you have useful concrete suggestions ? For example

```
git grep -P -c "cmp\(type" *.pyx
```
return something like 25 instances. What to do with them ?



---

archive/issue_comments_305104.json:
```json
{
    "body": "<a id='comment:12'></a>Replying to [comment:11 chapoton]:\n> Do you have useful concrete suggestions ? For example\n> \n> ```\n> git grep -P -c \"cmp\\(type\" *.pyx\n> ```\n> return something like 25 instances. What to do with them ?\n\nIt depends where you find those `cmp(typeA, typeB)`. If it's within a `def __cmp__` method, then that should be cleaned up anyway. If it's somewhere else, I guess the code should be refactored to not compare types (why would you do that anyway?).",
    "created_at": "2016-07-13T19:30:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20998#issuecomment-305104",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:12'></a>Replying to [comment:11 chapoton]:
> Do you have useful concrete suggestions ? For example
> 
> ```
> git grep -P -c "cmp\(type" *.pyx
> ```
> return something like 25 instances. What to do with them ?

It depends where you find those `cmp(typeA, typeB)`. If it's within a `def __cmp__` method, then that should be cleaned up anyway. If it's somewhere else, I guess the code should be refactored to not compare types (why would you do that anyway?).



---

archive/issue_comments_305105.json:
```json
{
    "body": "<a id='comment:13'></a>Replying to [comment:11 chapoton]:\n> My idea was that one should get rid of using cmp(a, b).\n\n\nA very good aim! But that's not what your patch is doing. Which makes me confused about the actual purpose of this ticket.",
    "created_at": "2016-07-13T19:32:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20998#issuecomment-305105",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:13'></a>Replying to [comment:11 chapoton]:
> My idea was that one should get rid of using cmp(a, b).


A very good aim! But that's not what your patch is doing. Which makes me confused about the actual purpose of this ticket.



---

archive/issue_comments_305106.json:
```json
{
    "body": "<a id='comment:14'></a>By the way, we could consider keeping `cmp()`. Even if it doesn't exist in Python 3, we could still implement it in Sage.",
    "created_at": "2016-07-13T19:34:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20998#issuecomment-305106",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:14'></a>By the way, we could consider keeping `cmp()`. Even if it doesn't exist in Python 3, we could still implement it in Sage.



---

archive/issue_comments_305107.json:
```json
{
    "body": "<a id='comment:15'></a>I guess we need to discuss on sage-devel strategies to deal with comparisons. I guess this is the most difficult part of the Python 3 conversion.",
    "created_at": "2016-07-13T19:35:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20998#issuecomment-305107",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:15'></a>I guess we need to discuss on sage-devel strategies to deal with comparisons. I guess this is the most difficult part of the Python 3 conversion.



---

archive/issue_comments_305108.json:
```json
{
    "body": "<a id='comment:16'></a>Indeed, this seems to be tricky. Maybe unicode versus bytes will also be painful.",
    "created_at": "2016-07-13T19:37:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20998#issuecomment-305108",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:16'></a>Indeed, this seems to be tricky. Maybe unicode versus bytes will also be painful.



---

archive/issue_comments_305109.json:
```json
{
    "body": "<a id='comment:17'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-07-28T11:21:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20998#issuecomment-305109",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:17'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_305110.json:
```json
{
    "body": "<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-07-28T13:40:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20998#issuecomment-305110",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_305111.json:
```json
{
    "body": "<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-07-28T13:53:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20998#issuecomment-305111",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_305112.json:
```json
{
    "body": "<a id='comment:20'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-07-28T18:41:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20998#issuecomment-305112",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:20'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_305113.json:
```json
{
    "body": "<a id='comment:21'></a>I am still waiting for a description of which problem this ticket is addressing.",
    "created_at": "2016-07-28T19:19:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20998#issuecomment-305113",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:21'></a>I am still waiting for a description of which problem this ticket is addressing.



---

archive/issue_comments_305114.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,9 @@\n+When trying to compile sage with py3, the first failing point\n+is currently caused by the use of \"cmp\" in some pyx files.\n+\n+This tickets aims to make a few more pyx files compile correctly\n+by removing cmp in them. This can be considered as en experiment,\n+as this will have to be done on a larger scale later.\n \n \n Author: Fr\u00e9d\u00e9ric Chapoton\n``````\n",
    "created_at": "2016-07-28T19:25:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20998#issuecomment-305114",
    "user": "https://github.com/fchapoton"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,9 @@
+When trying to compile sage with py3, the first failing point
+is currently caused by the use of "cmp" in some pyx files.
+
+This tickets aims to make a few more pyx files compile correctly
+by removing cmp in them. This can be considered as en experiment,
+as this will have to be done on a larger scale later.
 
 
 Author: Frédéric Chapoton
``````




---

archive/issue_comments_305115.json:
```json
{
    "body": "<a id='comment:22'></a>Here is a tentative description. Note that I am now waiting for patchbot's results before setting to needs_review.",
    "created_at": "2016-07-28T19:25:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20998#issuecomment-305115",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:22'></a>Here is a tentative description. Note that I am now waiting for patchbot's results before setting to needs_review.



---

archive/issue_comments_305116.json:
```json
{
    "body": "Changing status from needs_work to needs_info.",
    "created_at": "2016-07-28T20:31:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20998#issuecomment-305116",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_work to needs_info.



---

archive/issue_comments_305117.json:
```json
{
    "body": "<a id='comment:23'></a>please tell me what you think..",
    "created_at": "2016-07-28T20:31:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20998#issuecomment-305117",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:23'></a>please tell me what you think..



---

archive/issue_comments_305118.json:
```json
{
    "body": "Changing status from needs_info to needs_work.",
    "created_at": "2016-07-29T07:39:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20998#issuecomment-305118",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_info to needs_work.



---

archive/issue_comments_305119.json:
```json
{
    "body": "<a id='comment:24'></a>1. **free_algebra_element_letterplace.pyx**, **semigroups_cython.pyx** and **map.pyx**:\n\n`__richcmp__` bypasses the coercion model which is usually not what you want for `Element` classes. The rule of thumb is that any comparison/arithmetic of Sage `Element`s should use the coercion model unless there is a reason not to. Maybe for `FormalCompositeMap`, there is not much point in using the coercion model. But `FreeAlgebraElement_letterplace` and `LeftZeroSemigroupElement` really are elements where coercion looks useful.\n\nThe `_cmp_` and `_richcmp_` methods come from the coercion model, so you are guaranteed equal parents, which likely implies that both arguments are instances of `FreeAlgebraElement_letterplace`, `LeftZeroSemigroupElement` or `FormalCompositeMap`. In that case, you can just drop the type comparison.\n\n2. The function **richcmp_shortcut**:\n\nThis should be removed and replaced by the standard Python function `PyObject_RichCompare`. For an example on how to use it, see `src/sage/structure/coerce.pyx`.",
    "created_at": "2016-07-29T07:39:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20998#issuecomment-305119",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:24'></a>1. **free_algebra_element_letterplace.pyx**, **semigroups_cython.pyx** and **map.pyx**:

`__richcmp__` bypasses the coercion model which is usually not what you want for `Element` classes. The rule of thumb is that any comparison/arithmetic of Sage `Element`s should use the coercion model unless there is a reason not to. Maybe for `FormalCompositeMap`, there is not much point in using the coercion model. But `FreeAlgebraElement_letterplace` and `LeftZeroSemigroupElement` really are elements where coercion looks useful.

The `_cmp_` and `_richcmp_` methods come from the coercion model, so you are guaranteed equal parents, which likely implies that both arguments are instances of `FreeAlgebraElement_letterplace`, `LeftZeroSemigroupElement` or `FormalCompositeMap`. In that case, you can just drop the type comparison.

2. The function **richcmp_shortcut**:

This should be removed and replaced by the standard Python function `PyObject_RichCompare`. For an example on how to use it, see `src/sage/structure/coerce.pyx`.



---

archive/issue_comments_305120.json:
```json
{
    "body": "<a id='comment:25'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-07-29T09:21:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20998#issuecomment-305120",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:25'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_305121.json:
```json
{
    "body": "<a id='comment:26'></a>Thanks.\n\nI have tried to make changes for your point 2.\n\nI am not quite sure to understand your point 1. Do you suggest that in these 3 files I should replace double-underscored `__richcmp__` methods by single-underscored `_richcmp_` methods, and at the same time remove the check for type equality ?",
    "created_at": "2016-07-29T09:25:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20998#issuecomment-305121",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:26'></a>Thanks.

I have tried to make changes for your point 2.

I am not quite sure to understand your point 1. Do you suggest that in these 3 files I should replace double-underscored `__richcmp__` methods by single-underscored `_richcmp_` methods, and at the same time remove the check for type equality ?



---

archive/issue_comments_305122.json:
```json
{
    "body": "<a id='comment:27'></a>Replying to [comment:26 chapoton]:\n> Thanks.\n> \n> I have tried to make changes for your point 2.\n\n\nLooks good.\n\n> Do you suggest that in these 3 files I should replace double-underscored `__richcmp__` methods by single-underscored `_richcmp_` methods, and at the same time remove the check for type equality ?\n\n\nHard to tell in general because one really needs to understand what the various classes do and which kind of objects you would like to compare. For `FreeAlgebraElement_letterplace` and `LeftZeroSemigroupElement`, the answer to your question is probably \"YES\", for `FormalCompositeMap` it might be \"NO\".",
    "created_at": "2016-07-29T10:33:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20998#issuecomment-305122",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:27'></a>Replying to [comment:26 chapoton]:
> Thanks.
> 
> I have tried to make changes for your point 2.


Looks good.

> Do you suggest that in these 3 files I should replace double-underscored `__richcmp__` methods by single-underscored `_richcmp_` methods, and at the same time remove the check for type equality ?


Hard to tell in general because one really needs to understand what the various classes do and which kind of objects you would like to compare. For `FreeAlgebraElement_letterplace` and `LeftZeroSemigroupElement`, the answer to your question is probably "YES", for `FormalCompositeMap` it might be "NO".



---

archive/issue_comments_305123.json:
```json
{
    "body": "<a id='comment:28'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-07-31T16:28:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20998#issuecomment-305123",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:28'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_305124.json:
```json
{
    "body": "<a id='comment:29'></a>It seems that using `_richcmp_` in `FreeAlgebraElement_letterplace` and `LeftZeroSemigroupElement` breaks many doctests.",
    "created_at": "2016-08-02T08:14:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20998#issuecomment-305124",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:29'></a>It seems that using `_richcmp_` in `FreeAlgebraElement_letterplace` and `LeftZeroSemigroupElement` breaks many doctests.



---

archive/issue_comments_305125.json:
```json
{
    "body": "<a id='comment:30'></a>Maybe this is the problem:\n\n```\n[sagelib-7.3.rc0] warning: sage/categories/examples/semigroups_cython.pyx:89:4: Overriding cdef method with def method.\n[sagelib-7.3.rc0] warning: sage/algebras/letterplace/free_algebra_element_letterplace.pyx:455:4: Overriding cdef method with def method.\n```",
    "created_at": "2016-08-02T11:24:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20998#issuecomment-305125",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:30'></a>Maybe this is the problem:

```
[sagelib-7.3.rc0] warning: sage/categories/examples/semigroups_cython.pyx:89:4: Overriding cdef method with def method.
[sagelib-7.3.rc0] warning: sage/algebras/letterplace/free_algebra_element_letterplace.pyx:455:4: Overriding cdef method with def method.
```



---

archive/issue_comments_305126.json:
```json
{
    "body": "<a id='comment:31'></a>and what would be the cure ?",
    "created_at": "2016-08-02T11:56:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20998#issuecomment-305126",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:31'></a>and what would be the cure ?



---

archive/issue_comments_305127.json:
```json
{
    "body": "<a id='comment:32'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-02T16:20:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20998#issuecomment-305127",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:32'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_305128.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-08-02T18:40:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20998#issuecomment-305128",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_305129.json:
```json
{
    "body": "<a id='comment:33'></a>bot is green",
    "created_at": "2016-08-02T18:40:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20998#issuecomment-305129",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:33'></a>bot is green



---

archive/issue_comments_305130.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-08-03T06:14:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20998#issuecomment-305130",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_305131.json:
```json
{
    "body": "<a id='comment:34'></a>Why did you remove\n\n```\n        if type(self) != type(other):\n            return NotImplemented\n```\nThat's very important to avoid segmentation faults. You should keep that and change `!=` to `is not`.",
    "created_at": "2016-08-03T06:14:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20998#issuecomment-305131",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:34'></a>Why did you remove

```
        if type(self) != type(other):
            return NotImplemented
```
That's very important to avoid segmentation faults. You should keep that and change `!=` to `is not`.



---

archive/issue_comments_305132.json:
```json
{
    "body": "<a id='comment:35'></a>Replying to [comment:34 jdemeyer]:\n> Why did you remove\n> \n> ```\n>         if type(self) != type(other):\n>             return NotImplemented\n> ```\n> That's very important to avoid segmentation faults. You should keep that and change `!=` to `is not`.\n\n\nwhich file are you talking about, please ? only the map one ?",
    "created_at": "2016-08-03T06:17:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20998#issuecomment-305132",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:35'></a>Replying to [comment:34 jdemeyer]:
> Why did you remove
> 
> ```
>         if type(self) != type(other):
>             return NotImplemented
> ```
> That's very important to avoid segmentation faults. You should keep that and change `!=` to `is not`.


which file are you talking about, please ? only the map one ?



---

archive/issue_comments_305133.json:
```json
{
    "body": "<a id='comment:36'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-03T08:12:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20998#issuecomment-305133",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:36'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_305134.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-08-03T08:13:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20998#issuecomment-305134",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_305135.json:
```json
{
    "body": "<a id='comment:37'></a>is this what you suggested ?",
    "created_at": "2016-08-03T08:13:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20998#issuecomment-305135",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:37'></a>is this what you suggested ?



---

archive/issue_comments_305136.json:
```json
{
    "body": "<a id='comment:38'></a>I think you should add a doctest where you compare a map to something silly, like `None` and the integer `2`.",
    "created_at": "2016-08-03T10:39:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20998#issuecomment-305136",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:38'></a>I think you should add a doctest where you compare a map to something silly, like `None` and the integer `2`.



---

archive/issue_comments_305137.json:
```json
{
    "body": "<a id='comment:39'></a>To elaborate, in `map.pyx`, you are *not* using the coercion model. So we should add a test that something sensible happens when comparing a map with something else. If you use `_richcmp_` (single underscores), that's not an issue since the coercion model handles that.",
    "created_at": "2016-08-03T10:44:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20998#issuecomment-305137",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:39'></a>To elaborate, in `map.pyx`, you are *not* using the coercion model. So we should add a test that something sensible happens when comparing a map with something else. If you use `_richcmp_` (single underscores), that's not an issue since the coercion model handles that.



---

archive/issue_comments_305138.json:
```json
{
    "body": "<a id='comment:40'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-03T12:42:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20998#issuecomment-305138",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:40'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_305139.json:
```json
{
    "body": "<a id='comment:41'></a>I am not sure we really understand each other. Anyway. I have launched my patchbot on the latest branch. Let us wait for the results.",
    "created_at": "2016-08-03T12:48:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20998#issuecomment-305139",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:41'></a>I am not sure we really understand each other. Anyway. I have launched my patchbot on the latest branch. Let us wait for the results.



---

archive/issue_comments_305140.json:
```json
{
    "body": "<a id='comment:42'></a>I am misunderstanding you since I didn't notice that you changed `def __richcmp__` to `cpdef _richcmp_` in this commit:\n\n|                                                                                                                                           |                                      |\n|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------|\n|[8479374](https://git.sagemath.org/sage.git/commit/?id=84793748dfca6d396d7dfe08ba71a440b05ad66f)|`trac 20998 using cpdef for _richcmp_`|\nI thought that you only changed `def _richcmp_` to `cpdef _richcmp_` which would have been the right thing to do.",
    "created_at": "2016-08-03T12:58:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20998#issuecomment-305140",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:42'></a>I am misunderstanding you since I didn't notice that you changed `def __richcmp__` to `cpdef _richcmp_` in this commit:

|                                                                                                                                           |                                      |
|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------|
|[8479374](https://git.sagemath.org/sage.git/commit/?id=84793748dfca6d396d7dfe08ba71a440b05ad66f)|`trac 20998 using cpdef for _richcmp_`|
I thought that you only changed `def _richcmp_` to `cpdef _richcmp_` which would have been the right thing to do.



---

archive/issue_comments_305141.json:
```json
{
    "body": "<a id='comment:43'></a>ok, bot is green. Is the current state of affairs ok for you ?",
    "created_at": "2016-08-03T18:36:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20998#issuecomment-305141",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:43'></a>ok, bot is green. Is the current state of affairs ok for you ?



---

archive/issue_comments_305142.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-08-04T07:31:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20998#issuecomment-305142",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_305143.json:
```json
{
    "body": "<a id='comment:45'></a>I am planning some changes to the implementation of comparisons (#21163). In order to avoid conflicts, it would be good to not make further changes to `__cmp__` in other tickets.",
    "created_at": "2016-08-04T08:00:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20998#issuecomment-305143",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:45'></a>I am planning some changes to the implementation of comparisons (#21163). In order to avoid conflicts, it would be good to not make further changes to `__cmp__` in other tickets.



---

archive/issue_comments_305144.json:
```json
{
    "body": "<a id='comment:46'></a>Replying to [comment:45 jdemeyer]:\n> I am planning some changes to the implementation of comparisons (#21163). In order to avoid conflicts, it would be good to not make further changes to `__cmp__` in other tickets.\n\n\nok, message received",
    "created_at": "2016-08-04T08:01:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20998#issuecomment-305144",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:46'></a>Replying to [comment:45 jdemeyer]:
> I am planning some changes to the implementation of comparisons (#21163). In order to avoid conflicts, it would be good to not make further changes to `__cmp__` in other tickets.


ok, message received



---

archive/issue_comments_305145.json:
```json
{
    "body": "<a id='comment:47'></a>I just realized that, for #21163 to work, I need to get rid of most `__cmp__` methods. So that is going to be some work...",
    "created_at": "2016-08-04T10:54:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20998#issuecomment-305145",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:47'></a>I just realized that, for #21163 to work, I need to get rid of most `__cmp__` methods. So that is going to be some work...



---

archive/issue_comments_305146.json:
```json
{
    "body": "<a id='comment:48'></a>Replying to [comment:47 jdemeyer]:\n> I just realized that, for #21163 to work, I need to get rid of most `__cmp__` methods. So that is going to be some work...\n\n\nActually, never mind. I found a quick fix for #21163.",
    "created_at": "2016-08-04T11:35:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20998#issuecomment-305146",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:48'></a>Replying to [comment:47 jdemeyer]:
> I just realized that, for #21163 to work, I need to get rid of most `__cmp__` methods. So that is going to be some work...


Actually, never mind. I found a quick fix for #21163.



---

archive/issue_comments_305147.json:
```json
{
    "body": "<a id='comment:49'></a>#21163 turned out to be quite easy, so you can freely work on `__cmp__` tickets now. There are more than 300 instances of `def __cmp__`, so this is going to be some work...",
    "created_at": "2016-08-05T12:07:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20998#issuecomment-305147",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:49'></a>#21163 turned out to be quite easy, so you can freely work on `__cmp__` tickets now. There are more than 300 instances of `def __cmp__`, so this is going to be some work...



---

archive/issue_comments_305148.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-08-07T20:01:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20998#issuecomment-305148",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_056153.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-08-07T20:01:18Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/20998",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20998#event-56153"
}
```
