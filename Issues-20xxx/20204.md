# Issue 20204: Fix problems with constructing or converting to SymPy expressions

archive/issues_019967.json:
```json
{
    "assignees": [],
    "body": "In the Sympy-1.0 upgrade the `AppliedUndef._sage_` method is patched away to enable the important upgrade. This function was planned to resolve part of #14723 but uncovers problems with symbolics. The following doctest in french_book fails if `AppliedUndef._sage_` is defined:\n\n```\nsage: from sympy import Function, Symbol\nsage: u = Function('u'); n = Symbol('n', integer=True)\nsage: f = u(n+2)-(3/2)*u(n+1)+(1/2)*u(n)\nNotImplementedError\n```\n\ntscrim found the minimal cases:\n> \n> ```\n> sage: f = function('f')\n> sage: x = var('x')\n> sage: sympy.sympify(f(x), evaluate=False)\n> f(x)\n> sage: sympy.sympify(3*f(x), evaluate=False)\n> AttributeError: 'Call' object has no attribute 'id'\n> ```\n> However, we do seem to have our own troubles of constructing SymPy objects from symbolic expressions. All of these result in errors:\n> \n> ```\n> sage: f._sympy_()\n> sage: f(x)._sympy_()\n> sage: (f(x)+3)._sympy_()\n> ```\n\nThis means that Sympy-1.0 probably only uncovered already existing problems in expression conversion. This ticket should remove the patch in `build/pkgs/sympy` and resolve all mentioned problems.\n\nSee #20185 for all previous discussion on this.\n\nDepends on #23496\nDepends on #22566\n\nCC:  @mforets @man74cio\n\nBranch/Commit: **[`fd0db78`](https://github.com/sagemath/sagetrac-mirror/commit/fd0db783a1d0dfe70a5ca5272d762345376f0965)**\n\nReviewer: **Marcelo Forets**\n\nAuthor: **Marcelo Forets, Ralf Stephan**\n\nComponent: **symbolics**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/20204_\n\n",
    "closed_at": "2017-11-04T23:24:42Z",
    "created_at": "2016-03-14T07:50:14Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20symbolics",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Fix problems with constructing or converting to SymPy expressions",
    "type": "issue",
    "updated_at": "2017-11-04T23:24:42Z",
    "url": "https://github.com/sagemath/sage/issues/20204",
    "user": "https://github.com/rwst"
}
```
In the Sympy-1.0 upgrade the `AppliedUndef._sage_` method is patched away to enable the important upgrade. This function was planned to resolve part of #14723 but uncovers problems with symbolics. The following doctest in french_book fails if `AppliedUndef._sage_` is defined:

```
sage: from sympy import Function, Symbol
sage: u = Function('u'); n = Symbol('n', integer=True)
sage: f = u(n+2)-(3/2)*u(n+1)+(1/2)*u(n)
NotImplementedError
```

tscrim found the minimal cases:
> 
> ```
> sage: f = function('f')
> sage: x = var('x')
> sage: sympy.sympify(f(x), evaluate=False)
> f(x)
> sage: sympy.sympify(3*f(x), evaluate=False)
> AttributeError: 'Call' object has no attribute 'id'
> ```
> However, we do seem to have our own troubles of constructing SymPy objects from symbolic expressions. All of these result in errors:
> 
> ```
> sage: f._sympy_()
> sage: f(x)._sympy_()
> sage: (f(x)+3)._sympy_()
> ```

This means that Sympy-1.0 probably only uncovered already existing problems in expression conversion. This ticket should remove the patch in `build/pkgs/sympy` and resolve all mentioned problems.

See #20185 for all previous discussion on this.

Depends on #23496
Depends on #22566

CC:  @mforets @man74cio

Branch/Commit: **[`fd0db78`](https://github.com/sagemath/sagetrac-mirror/commit/fd0db783a1d0dfe70a5ca5272d762345376f0965)**

Reviewer: **Marcelo Forets**

Author: **Marcelo Forets, Ralf Stephan**

Component: **symbolics**

_Issue created by migration from https://trac.sagemath.org/ticket/20204_





---

archive/issue_events_285237.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2016-03-14T07:50:14Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "milestone_number": null,
    "milestone_title": "sage-7.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20204#event-285237"
}
```



---

archive/issue_events_285238.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2016-03-14T07:50:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20symbolics",
    "label_color": "0000ff",
    "label_name": "c: symbolics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20204#event-285238"
}
```



---

archive/issue_events_285239.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2016-03-14T07:50:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20204#event-285239"
}
```



---

archive/issue_events_285240.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2016-03-14T07:50:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20204#event-285240"
}
```



---

archive/issue_comments_290526.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-In the Sympy-1.0 upgrade the `UndefinedFunction._sage_` method is patched away to enable the important upgrade. This function was planned to resolve part of #14723 but uncovers missing functionality in the coercion system, and probably with symbolics. The following doctest in french_book fails if `UndefinedFunction._sage_` is defined:\n+In the Sympy-1.0 upgrade the `UndefinedFunction._sage_` method is patched away to enable the important upgrade. This function was planned to resolve part of #14723 but uncovers problems with symbolics. The following doctest in french_book fails if `UndefinedFunction._sage_` is defined:\n \n ```\n   sage: from sympy import Function, Symbol\n``````\n",
    "created_at": "2016-03-14T08:12:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-290526",
    "user": "https://github.com/rwst"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-In the Sympy-1.0 upgrade the `UndefinedFunction._sage_` method is patched away to enable the important upgrade. This function was planned to resolve part of #14723 but uncovers missing functionality in the coercion system, and probably with symbolics. The following doctest in french_book fails if `UndefinedFunction._sage_` is defined:
+In the Sympy-1.0 upgrade the `UndefinedFunction._sage_` method is patched away to enable the important upgrade. This function was planned to resolve part of #14723 but uncovers problems with symbolics. The following doctest in french_book fails if `UndefinedFunction._sage_` is defined:
 
 ```
   sage: from sympy import Function, Symbol
``````




---

archive/issue_comments_290527.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-In the Sympy-1.0 upgrade the `UndefinedFunction._sage_` method is patched away to enable the important upgrade. This function was planned to resolve part of #14723 but uncovers problems with symbolics. The following doctest in french_book fails if `UndefinedFunction._sage_` is defined:\n+In the Sympy-1.0 upgrade the `AppliedUndef._sage_` method is patched away to enable the important upgrade. This function was planned to resolve part of #14723 but uncovers problems with symbolics. The following doctest in french_book fails if `AppliedUndef._sage_` is defined:\n \n ```\n   sage: from sympy import Function, Symbol\n``````\n",
    "created_at": "2016-08-06T09:03:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-290527",
    "user": "https://github.com/rwst"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-In the Sympy-1.0 upgrade the `UndefinedFunction._sage_` method is patched away to enable the important upgrade. This function was planned to resolve part of #14723 but uncovers problems with symbolics. The following doctest in french_book fails if `UndefinedFunction._sage_` is defined:
+In the Sympy-1.0 upgrade the `AppliedUndef._sage_` method is patched away to enable the important upgrade. This function was planned to resolve part of #14723 but uncovers problems with symbolics. The following doctest in french_book fails if `AppliedUndef._sage_` is defined:
 
 ```
   sage: from sympy import Function, Symbol
``````




---

archive/issue_comments_290528.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nHi, any progress on this? We are currently NOT carrying Sage's sympy patch in Debian, so our Sage is running *without* this patch (and a few french book doctests break but we just ignore this).\n\nIn fact applying the patch, breaks some of sympy's own tests relating to Sage integration: https://github.com/sympy/sympy/pull/11858#issuecomment-308207891\n\nBTW you do not need to rebuild Sympy to apply or unapply this patch, just edit /usr/lib/python2.7/dist-packages/sympy/core/function.py or wherever the file is installed to. Then restart sage (if you're testing Sage) or python (if you're testing sympy).",
    "created_at": "2017-06-13T19:23:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-290528",
    "user": "https://github.com/infinity0"
}
```

<div id="comment:4" align="right">comment:4</div>

Hi, any progress on this? We are currently NOT carrying Sage's sympy patch in Debian, so our Sage is running *without* this patch (and a few french book doctests break but we just ignore this).

In fact applying the patch, breaks some of sympy's own tests relating to Sage integration: https://github.com/sympy/sympy/pull/11858#issuecomment-308207891

BTW you do not need to rebuild Sympy to apply or unapply this patch, just edit /usr/lib/python2.7/dist-packages/sympy/core/function.py or wherever the file is installed to. Then restart sage (if you're testing Sage) or python (if you're testing sympy).



---

archive/issue_comments_290529.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nhi, i've experimented adding a fragment of #14723:\n\n```\n@@ -764,6 +764,9 @@ class SympyConverter(Converter):\n         if f_sympy:\n             return f_sympy(*sympy.sympify(g, evaluate=False))\n         else:\n\n+            from sage.symbolic.function_factory import SymbolicFunction\n+            if isinstance(ex.operator(), SymbolicFunction):\n+                return sympy.Function(str(f))(*g, evaluate=False)\n             raise NotImplementedError(\"SymPy function '%s' doesn't exist\" % f)\n``` \n\nand adding the `_sympy_` method to the NewSymbolicFunction class:\n\n```\n@@ -67,6 +67,10 @@ def function_factory(name, nargs=0, latex_name=None, conversions=None,\n             \"\"\"\n             return \"'%s\"%self.name()\n\n+        def _sympy_(self):\n+            from sympy import Function\n+            return Function(self.name())\n```\n\nwith these changes, the conversions in this ticket's description work. does this go in the good direction or not? \n\nhowever, the round trip back to sage is broken:\n\n```\nsage: f = function('f')\nsage: type(f)\n<class 'sage.symbolic.function_factory.NewSymbolicFunction'>\nsage: fs = f._sympy_()\nsage: type(fs)\n<class 'sympy.core.function.UndefinedFunction'>\nsage: fs._sage_()\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-5-9fb5fbad3003> in <module>()\n----> 1 fs._sage_()\n\nTypeError: unbound method _sage_() must be called with f instance as first argument (got nothing instead)\n```\n\nand with a different error for a function with arguments:\n\n```\nsage: f = function('f')(x)\nsage: type(f)\n<type 'sage.symbolic.expression.Expression'>\nsage: fs = f._sympy_()\nsage: type(fs)\nf\nsage: fs._sage_()\n\n---------------------------------------------------------------------------\nAttributeError                            Traceback (most recent call last)\n<ipython-input-5-9fb5fbad3003> in <module>()\n----> 1 fs._sage_()\n\n/Users/forets/sage-src/sage/local/lib/python2.7/site-packages/sympy/core/function.pyc in _sage_(self)\n    705         import sage.all as sage\n    706         fname = self.func.__name__\n--> 707         func = getattr(sage, fname)\n    708         args = [arg._sage_() for arg in self.args]\n    709         return func(*args)\n\nAttributeError: 'module' object has no attribute 'f'\n```",
    "created_at": "2017-06-23T09:51:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-290529",
    "user": "https://github.com/mforets"
}
```

<div id="comment:5" align="right">comment:5</div>

hi, i've experimented adding a fragment of #14723:

```
@@ -764,6 +764,9 @@ class SympyConverter(Converter):
         if f_sympy:
             return f_sympy(*sympy.sympify(g, evaluate=False))
         else:

+            from sage.symbolic.function_factory import SymbolicFunction
+            if isinstance(ex.operator(), SymbolicFunction):
+                return sympy.Function(str(f))(*g, evaluate=False)
             raise NotImplementedError("SymPy function '%s' doesn't exist" % f)
``` 

and adding the `_sympy_` method to the NewSymbolicFunction class:

```
@@ -67,6 +67,10 @@ def function_factory(name, nargs=0, latex_name=None, conversions=None,
             """
             return "'%s"%self.name()

+        def _sympy_(self):
+            from sympy import Function
+            return Function(self.name())
```

with these changes, the conversions in this ticket's description work. does this go in the good direction or not? 

however, the round trip back to sage is broken:

```
sage: f = function('f')
sage: type(f)
<class 'sage.symbolic.function_factory.NewSymbolicFunction'>
sage: fs = f._sympy_()
sage: type(fs)
<class 'sympy.core.function.UndefinedFunction'>
sage: fs._sage_()
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-5-9fb5fbad3003> in <module>()
----> 1 fs._sage_()

TypeError: unbound method _sage_() must be called with f instance as first argument (got nothing instead)
```

and with a different error for a function with arguments:

```
sage: f = function('f')(x)
sage: type(f)
<type 'sage.symbolic.expression.Expression'>
sage: fs = f._sympy_()
sage: type(fs)
f
sage: fs._sage_()

---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
<ipython-input-5-9fb5fbad3003> in <module>()
----> 1 fs._sage_()

/Users/forets/sage-src/sage/local/lib/python2.7/site-packages/sympy/core/function.pyc in _sage_(self)
    705         import sage.all as sage
    706         fname = self.func.__name__
--> 707         func = getattr(sage, fname)
    708         args = [arg._sage_() for arg in self.args]
    709         return func(*args)

AttributeError: 'module' object has no attribute 'f'
```



---

archive/issue_comments_290530.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nReplying to [@mforets](#comment:5):\n> with these changes, the conversions in this ticket's description work. does this go in the good direction or not? \n\nLooks good.",
    "created_at": "2017-06-23T12:54:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-290530",
    "user": "https://github.com/rwst"
}
```

<div id="comment:6" align="right">comment:6</div>

Replying to [@mforets](#comment:5):
> with these changes, the conversions in this ticket's description work. does this go in the good direction or not? 

Looks good.



---

archive/issue_comments_290531.json:
```json
{
    "body": "Commit: **[`442d13b`](https://github.com/sagemath/sagetrac-mirror/commit/442d13b21bd3056d744ce92a19fb9b428f1df641)**",
    "created_at": "2017-06-24T09:08:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-290531",
    "user": "https://github.com/mforets"
}
```

Commit: **[`442d13b`](https://github.com/sagemath/sagetrac-mirror/commit/442d13b21bd3056d744ce92a19fb9b428f1df641)**



---

archive/issue_comments_290532.json:
```json
{
    "body": "<div id=\"comment:7\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/442d13b21bd3056d744ce92a19fb9b428f1df641\"><code>442d13b</code></a></td><td><code>check for SymbolicFunction in SympyConverter</code></td></tr></table>\n",
    "created_at": "2017-06-24T09:08:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-290532",
    "user": "https://github.com/mforets"
}
```

<div id="comment:7"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/442d13b21bd3056d744ce92a19fb9b428f1df641"><code>442d13b</code></a></td><td><code>check for SymbolicFunction in SympyConverter</code></td></tr></table>




---

archive/issue_comments_290533.json:
```json
{
    "body": "Branch: **[u/mforets/20204](https://github.com/sagemath/sagetrac-mirror/tree/u/mforets/20204)**",
    "created_at": "2017-06-24T09:08:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-290533",
    "user": "https://github.com/mforets"
}
```

Branch: **[u/mforets/20204](https://github.com/sagemath/sagetrac-mirror/tree/u/mforets/20204)**



---

archive/issue_comments_290534.json:
```json
{
    "body": "<div id=\"comment:8\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9f40ac9e569317cd3f9c264d05f6c18f07bebe65\"><code>9f40ac9</code></a></td><td><code>add sympy method to NewSymbolicFunction</code></td></tr></table>\n",
    "created_at": "2017-06-24T09:09:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-290534",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:8"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9f40ac9e569317cd3f9c264d05f6c18f07bebe65"><code>9f40ac9</code></a></td><td><code>add sympy method to NewSymbolicFunction</code></td></tr></table>




---

archive/issue_comments_290535.json:
```json
{
    "body": "Changed commit from **[`442d13b`](https://github.com/sagemath/sagetrac-mirror/commit/442d13b21bd3056d744ce92a19fb9b428f1df641)** to **[`9f40ac9`](https://github.com/sagemath/sagetrac-mirror/commit/9f40ac9e569317cd3f9c264d05f6c18f07bebe65)**",
    "created_at": "2017-06-24T09:09:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-290535",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`442d13b`](https://github.com/sagemath/sagetrac-mirror/commit/442d13b21bd3056d744ce92a19fb9b428f1df641)** to **[`9f40ac9`](https://github.com/sagemath/sagetrac-mirror/commit/9f40ac9e569317cd3f9c264d05f6c18f07bebe65)**



---

archive/issue_comments_290536.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nfor the remaining part, this is supposed to be solved here? (*This ticket should remove the patch..* => to delete the file `build/pkgs/sympy/patches/01_undeffun_sage.patch` ??). i've played around, but i don't quite understand how it's supposed to work.. thanks.",
    "created_at": "2017-06-25T14:06:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-290536",
    "user": "https://github.com/mforets"
}
```

<div id="comment:9" align="right">comment:9</div>

for the remaining part, this is supposed to be solved here? (*This ticket should remove the patch..* => to delete the file `build/pkgs/sympy/patches/01_undeffun_sage.patch` ??). i've played around, but i don't quite understand how it's supposed to work.. thanks.



---

archive/issue_comments_290537.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nReplying to [@mforets](#comment:9):\n> for the remaining part, this is supposed to be solved here? (*This ticket should remove the patch..* => to delete the file `build/pkgs/sympy/patches/01_undeffun_sage.patch` ??). i've played around, but i don't quite understand how it's supposed to work.. thanks.\n\nYou mean how to delete a file from a git branch? use `git rm`.",
    "created_at": "2017-07-01T07:04:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-290537",
    "user": "https://github.com/rwst"
}
```

<div id="comment:10" align="right">comment:10</div>

Replying to [@mforets](#comment:9):
> for the remaining part, this is supposed to be solved here? (*This ticket should remove the patch..* => to delete the file `build/pkgs/sympy/patches/01_undeffun_sage.patch` ??). i've played around, but i don't quite understand how it's supposed to work.. thanks.

You mean how to delete a file from a git branch? use `git rm`.



---

archive/issue_comments_290538.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nReplying to [@rwst](#comment:10):\n> Replying to [@mforets](#comment:9):\n> > for the remaining part, this is supposed to be solved here? (*This ticket should remove the patch..* => to delete the file `build/pkgs/sympy/patches/01_undeffun_sage.patch` ??). i've played around, but i don't quite understand how it's supposed to work.. thanks.\n\n> \n> You mean how to delete a file from a git branch? use `git rm`.\n\nno; i didn't know what are these `*.patch` files, how they are generated, how they are incorporated into sage.. Anyway, I'll `git rm 01_undeffun_sage.patch` later today!",
    "created_at": "2017-07-01T08:20:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-290538",
    "user": "https://github.com/mforets"
}
```

<div id="comment:11" align="right">comment:11</div>

Replying to [@rwst](#comment:10):
> Replying to [@mforets](#comment:9):
> > for the remaining part, this is supposed to be solved here? (*This ticket should remove the patch..* => to delete the file `build/pkgs/sympy/patches/01_undeffun_sage.patch` ??). i've played around, but i don't quite understand how it's supposed to work.. thanks.

> 
> You mean how to delete a file from a git branch? use `git rm`.

no; i didn't know what are these `*.patch` files, how they are generated, how they are incorporated into sage.. Anyway, I'll `git rm 01_undeffun_sage.patch` later today!



---

archive/issue_comments_290539.json:
```json
{
    "body": "<div id=\"comment:12\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a07b72be4003315a37d9cf9c73c14b074c7d52c5\"><code>a07b72b</code></a></td><td><code>remove undeffun patch</code></td></tr></table>\n",
    "created_at": "2017-07-01T08:52:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-290539",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:12"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a07b72be4003315a37d9cf9c73c14b074c7d52c5"><code>a07b72b</code></a></td><td><code>remove undeffun patch</code></td></tr></table>




---

archive/issue_comments_290540.json:
```json
{
    "body": "Changed commit from **[`9f40ac9`](https://github.com/sagemath/sagetrac-mirror/commit/9f40ac9e569317cd3f9c264d05f6c18f07bebe65)** to **[`a07b72b`](https://github.com/sagemath/sagetrac-mirror/commit/a07b72be4003315a37d9cf9c73c14b074c7d52c5)**",
    "created_at": "2017-07-01T08:52:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-290540",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`9f40ac9`](https://github.com/sagemath/sagetrac-mirror/commit/9f40ac9e569317cd3f9c264d05f6c18f07bebe65)** to **[`a07b72b`](https://github.com/sagemath/sagetrac-mirror/commit/a07b72be4003315a37d9cf9c73c14b074c7d52c5)**



---

archive/issue_comments_290541.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nReplying to [@mforets](#comment:11):\n> no; i didn't know what are these `*.patch` files, how they are generated, how they are incorporated into sage..\n\nYou get them with any git branch by piping the output of `git diff` into a file. OTOH you don't even need `git diff`. For example the SymPy PR patch mentioned in #22802 can be had by downloading `https://patch-diff.githubusercontent.com/raw/sympy/sympy/pull/12826.diff`, i.e. the PR link with `.diff` appended. That should work with any github commit.",
    "created_at": "2017-07-01T09:00:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-290541",
    "user": "https://github.com/rwst"
}
```

<div id="comment:13" align="right">comment:13</div>

Replying to [@mforets](#comment:11):
> no; i didn't know what are these `*.patch` files, how they are generated, how they are incorporated into sage..

You get them with any git branch by piping the output of `git diff` into a file. OTOH you don't even need `git diff`. For example the SymPy PR patch mentioned in #22802 can be had by downloading `https://patch-diff.githubusercontent.com/raw/sympy/sympy/pull/12826.diff`, i.e. the PR link with `.diff` appended. That should work with any github commit.



---

archive/issue_comments_290542.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nOK and those patches get automatically applied into `/local/lib/...` upon rebuilding.\n\nI've tested the patch in question. It solves one out of the two cases from [comment:5](#comment:5) :\n\n```\nsage: function('f')(x)._sympy_()._sage_()  # ok\nf(x)\nsage: function('f')._sympy_()._sage_()  # problem\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-2-7d5000a51aaa> in <module>()\n----> 1 function('f')._sympy_()._sage_()\n\nTypeError: unbound method _sage_() must be called with f instance as first argument (got nothing instead)\n```\n\nIf we also want to transform from `UndefinedFunction` back to `NewSymbolicFunction`, then, that case should be addressed upstream in [sympy to sage conversion : Abstract function](https://github.com/sympy/sympy/pull/12826) too?",
    "created_at": "2017-07-01T10:58:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-290542",
    "user": "https://github.com/mforets"
}
```

<div id="comment:14" align="right">comment:14</div>

OK and those patches get automatically applied into `/local/lib/...` upon rebuilding.

I've tested the patch in question. It solves one out of the two cases from [comment:5](#comment:5) :

```
sage: function('f')(x)._sympy_()._sage_()  # ok
f(x)
sage: function('f')._sympy_()._sage_()  # problem
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-2-7d5000a51aaa> in <module>()
----> 1 function('f')._sympy_()._sage_()

TypeError: unbound method _sage_() must be called with f instance as first argument (got nothing instead)
```

If we also want to transform from `UndefinedFunction` back to `NewSymbolicFunction`, then, that case should be addressed upstream in [sympy to sage conversion : Abstract function](https://github.com/sympy/sympy/pull/12826) too?



---

archive/issue_comments_290543.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nReplying to [@mforets](#comment:14):\n> If we also want to transform from `UndefinedFunction` back to `NewSymbolicFunction`, then, that case should be addressed upstream in [sympy to sage conversion : Abstract function](https://github.com/sympy/sympy/pull/12826) too?\n\nYes, conversion of SymPy objects is usually done by their member function `_sage_()`. That means SymPy source change.",
    "created_at": "2017-07-01T12:48:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-290543",
    "user": "https://github.com/rwst"
}
```

<div id="comment:15" align="right">comment:15</div>

Replying to [@mforets](#comment:14):
> If we also want to transform from `UndefinedFunction` back to `NewSymbolicFunction`, then, that case should be addressed upstream in [sympy to sage conversion : Abstract function](https://github.com/sympy/sympy/pull/12826) too?

Yes, conversion of SymPy objects is usually done by their member function `_sage_()`. That means SymPy source change.



---

archive/issue_comments_290544.json:
```json
{
    "body": "<div id=\"comment:16\"></div>\n\nBranch pushed to git repo; I updated commit sha1. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9d16a70b2daf9e123f2bf180547f38a4a10c2306\"><code>9d16a70</code></a></td><td><code>Lost package-version.txt modifications : restored</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d5d6b6733ea408b4a73860578e8b482d6dfea2c7\"><code>d5d6b67</code></a></td><td><code>Corrected error on patcj version</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/462bd681d32ee87a3813caa79e43842a4477d2e7\"><code>462bd68</code></a></td><td><code>test is not corrected at this point</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/daa2f2cc0a70480553db6a01fd9b28552e63920e\"><code>daa2f2c</code></a></td><td><code>Error on sympy branch corrected with a new patch</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/487242514e520b0c73e24628ac2269df7cd2c0c0\"><code>4872425</code></a></td><td><code>forgetten to delete gg in doctest</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/721eed7a72e7d86189fa6200bed75ef1c11af4a3\"><code>721eed7</code></a></td><td><code>removed whitespace</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e46345b0c23138d017ce6f50f44d144179c9c668\"><code>e46345b</code></a></td><td><code>changed sympy patch version</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/46ebd728aac486a5dd675f5d228d90001c421635\"><code>46ebd72</code></a></td><td><code>Merge branch 'public/23496_patch_sympy_abstact_function' of git://trac.sagemath.org/sage into public/23496_patch_sympy_abstact_function</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e74980b22380c76fb64fd9b3ef4eb4da60bcf11a\"><code>e74980b</code></a></td><td><code>Merge branch 'develop' into t/23496/public/23496_patch_sympy_abstact_function</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c9db59735ba48630a2cecb38308ad33d6b707a04\"><code>c9db597</code></a></td><td><code>Merge branch 't/23496/public/23496_patch_sympy_abstact_function' into t/mforets/20204</code></td></tr></table>\n",
    "created_at": "2017-08-30T08:21:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-290544",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:16"></div>

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9d16a70b2daf9e123f2bf180547f38a4a10c2306"><code>9d16a70</code></a></td><td><code>Lost package-version.txt modifications : restored</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d5d6b6733ea408b4a73860578e8b482d6dfea2c7"><code>d5d6b67</code></a></td><td><code>Corrected error on patcj version</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/462bd681d32ee87a3813caa79e43842a4477d2e7"><code>462bd68</code></a></td><td><code>test is not corrected at this point</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/daa2f2cc0a70480553db6a01fd9b28552e63920e"><code>daa2f2c</code></a></td><td><code>Error on sympy branch corrected with a new patch</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/487242514e520b0c73e24628ac2269df7cd2c0c0"><code>4872425</code></a></td><td><code>forgetten to delete gg in doctest</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/721eed7a72e7d86189fa6200bed75ef1c11af4a3"><code>721eed7</code></a></td><td><code>removed whitespace</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e46345b0c23138d017ce6f50f44d144179c9c668"><code>e46345b</code></a></td><td><code>changed sympy patch version</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/46ebd728aac486a5dd675f5d228d90001c421635"><code>46ebd72</code></a></td><td><code>Merge branch 'public/23496_patch_sympy_abstact_function' of git://trac.sagemath.org/sage into public/23496_patch_sympy_abstact_function</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e74980b22380c76fb64fd9b3ef4eb4da60bcf11a"><code>e74980b</code></a></td><td><code>Merge branch 'develop' into t/23496/public/23496_patch_sympy_abstact_function</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c9db59735ba48630a2cecb38308ad33d6b707a04"><code>c9db597</code></a></td><td><code>Merge branch 't/23496/public/23496_patch_sympy_abstact_function' into t/mforets/20204</code></td></tr></table>




---

archive/issue_comments_290545.json:
```json
{
    "body": "Changed commit from **[`a07b72b`](https://github.com/sagemath/sagetrac-mirror/commit/a07b72be4003315a37d9cf9c73c14b074c7d52c5)** to **[`c9db597`](https://github.com/sagemath/sagetrac-mirror/commit/c9db59735ba48630a2cecb38308ad33d6b707a04)**",
    "created_at": "2017-08-30T08:21:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-290545",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`a07b72b`](https://github.com/sagemath/sagetrac-mirror/commit/a07b72be4003315a37d9cf9c73c14b074c7d52c5)** to **[`c9db597`](https://github.com/sagemath/sagetrac-mirror/commit/c9db59735ba48630a2cecb38308ad33d6b707a04)**



---

archive/issue_events_285241.json:
```json
{
    "actor": "https://github.com/mforets",
    "created_at": "2017-08-30T08:22:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20204#event-285241"
}
```



---

archive/issue_comments_290546.json:
```json
{
    "body": "Author: **Marcelo Forets, Ralph Stephan**",
    "created_at": "2017-08-30T08:22:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-290546",
    "user": "https://github.com/mforets"
}
```

Author: **Marcelo Forets, Ralph Stephan**



---

archive/issue_comments_290547.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nLast 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9d16a70b2daf9e123f2bf180547f38a4a10c2306\"><code>9d16a70</code></a></td><td><code>Lost package-version.txt modifications : restored</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d5d6b6733ea408b4a73860578e8b482d6dfea2c7\"><code>d5d6b67</code></a></td><td><code>Corrected error on patcj version</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/462bd681d32ee87a3813caa79e43842a4477d2e7\"><code>462bd68</code></a></td><td><code>test is not corrected at this point</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/daa2f2cc0a70480553db6a01fd9b28552e63920e\"><code>daa2f2c</code></a></td><td><code>Error on sympy branch corrected with a new patch</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/487242514e520b0c73e24628ac2269df7cd2c0c0\"><code>4872425</code></a></td><td><code>forgetten to delete gg in doctest</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/721eed7a72e7d86189fa6200bed75ef1c11af4a3\"><code>721eed7</code></a></td><td><code>removed whitespace</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e46345b0c23138d017ce6f50f44d144179c9c668\"><code>e46345b</code></a></td><td><code>changed sympy patch version</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/46ebd728aac486a5dd675f5d228d90001c421635\"><code>46ebd72</code></a></td><td><code>Merge branch 'public/23496_patch_sympy_abstact_function' of git://trac.sagemath.org/sage into public/23496_patch_sympy_abstact_function</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e74980b22380c76fb64fd9b3ef4eb4da60bcf11a\"><code>e74980b</code></a></td><td><code>Merge branch 'develop' into t/23496/public/23496_patch_sympy_abstact_function</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c9db59735ba48630a2cecb38308ad33d6b707a04\"><code>c9db597</code></a></td><td><code>Merge branch 't/23496/public/23496_patch_sympy_abstact_function' into t/mforets/20204</code></td></tr></table>\n",
    "created_at": "2017-08-30T08:22:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-290547",
    "user": "https://github.com/mforets"
}
```

<div id="comment:17" align="right">comment:17</div>

Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9d16a70b2daf9e123f2bf180547f38a4a10c2306"><code>9d16a70</code></a></td><td><code>Lost package-version.txt modifications : restored</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d5d6b6733ea408b4a73860578e8b482d6dfea2c7"><code>d5d6b67</code></a></td><td><code>Corrected error on patcj version</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/462bd681d32ee87a3813caa79e43842a4477d2e7"><code>462bd68</code></a></td><td><code>test is not corrected at this point</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/daa2f2cc0a70480553db6a01fd9b28552e63920e"><code>daa2f2c</code></a></td><td><code>Error on sympy branch corrected with a new patch</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/487242514e520b0c73e24628ac2269df7cd2c0c0"><code>4872425</code></a></td><td><code>forgetten to delete gg in doctest</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/721eed7a72e7d86189fa6200bed75ef1c11af4a3"><code>721eed7</code></a></td><td><code>removed whitespace</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e46345b0c23138d017ce6f50f44d144179c9c668"><code>e46345b</code></a></td><td><code>changed sympy patch version</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/46ebd728aac486a5dd675f5d228d90001c421635"><code>46ebd72</code></a></td><td><code>Merge branch 'public/23496_patch_sympy_abstact_function' of git://trac.sagemath.org/sage into public/23496_patch_sympy_abstact_function</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e74980b22380c76fb64fd9b3ef4eb4da60bcf11a"><code>e74980b</code></a></td><td><code>Merge branch 'develop' into t/23496/public/23496_patch_sympy_abstact_function</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c9db59735ba48630a2cecb38308ad33d6b707a04"><code>c9db597</code></a></td><td><code>Merge branch 't/23496/public/23496_patch_sympy_abstact_function' into t/mforets/20204</code></td></tr></table>




---

archive/issue_events_285242.json:
```json
{
    "actor": "https://github.com/mforets",
    "created_at": "2017-08-30T08:22:50Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "milestone_number": null,
    "milestone_title": "sage-7.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20204#event-285242"
}
```



---

archive/issue_events_285243.json:
```json
{
    "actor": "https://github.com/mforets",
    "created_at": "2017-08-30T08:22:50Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "milestone_number": null,
    "milestone_title": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20204#event-285243"
}
```



---

archive/issue_comments_290548.json:
```json
{
    "body": "Dependencies: **23496**",
    "created_at": "2017-08-30T08:22:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-290548",
    "user": "https://github.com/mforets"
}
```

Dependencies: **23496**



---

archive/issue_comments_290549.json:
```json
{
    "body": "Changed dependencies from **23496** to **#23496**",
    "created_at": "2017-08-30T08:23:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-290549",
    "user": "https://github.com/mforets"
}
```

Changed dependencies from **23496** to **#23496**



---

archive/issue_events_285244.json:
```json
{
    "actor": "https://github.com/mforets",
    "created_at": "2017-09-03T12:35:04Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20204#event-285244"
}
```



---

archive/issue_events_285245.json:
```json
{
    "actor": "https://github.com/mforets",
    "created_at": "2017-09-03T12:35:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20204#event-285245"
}
```



---

archive/issue_comments_290550.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nessentially there is this problem:\n\n```\nsage: from sympy import Function, Symbol\nsage:  u = Function('u') ; n = Symbol('n', integer=True);\nsage: type(2+u(2))  # wrong\n<type 'sage.symbolic.expression.Expression'>\nsage: type(u(2)+2)\n<class 'sympy.core.add.Add'>\n```\n\nit gets fixed with the code in this comment: [#23496 comment:65](https://github.com/sagemath/sage/issues/23496#comment:65)\n\ndo you agree?",
    "created_at": "2017-09-03T12:35:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-290550",
    "user": "https://github.com/mforets"
}
```

<div id="comment:19" align="right">comment:19</div>

essentially there is this problem:

```
sage: from sympy import Function, Symbol
sage:  u = Function('u') ; n = Symbol('n', integer=True);
sage: type(2+u(2))  # wrong
<type 'sage.symbolic.expression.Expression'>
sage: type(u(2)+2)
<class 'sympy.core.add.Add'>
```

it gets fixed with the code in this comment: [#23496 comment:65](https://github.com/sagemath/sage/issues/23496#comment:65)

do you agree?



---

archive/issue_comments_290551.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nAfter #24006 there is need for a rewrite which makes it all much simpler. I'll try that now.",
    "created_at": "2017-10-17T06:48:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-290551",
    "user": "https://github.com/rwst"
}
```

<div id="comment:20" align="right">comment:20</div>

After #24006 there is need for a rewrite which makes it all much simpler. I'll try that now.



---

archive/issue_comments_290552.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nawesome. i started to read your code today, so i don't get too outdated :)",
    "created_at": "2017-10-17T06:54:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-290552",
    "user": "https://github.com/mforets"
}
```

<div id="comment:21" align="right">comment:21</div>

awesome. i started to read your code today, so i don't get too outdated :)



---

archive/issue_comments_290553.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nI think the problem with `Function('f')` is that it returns a class not an object, and I'm not sure if we can put a `_sage_` method onto that.",
    "created_at": "2017-10-17T07:53:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-290553",
    "user": "https://github.com/rwst"
}
```

<div id="comment:22" align="right">comment:22</div>

I think the problem with `Function('f')` is that it returns a class not an object, and I'm not sure if we can put a `_sage_` method onto that.



---

archive/issue_comments_290554.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nTo document what happens in SymPy:\n\nWhen `F=Function('abc')` is called the constructor of `Function` uses the metaclass `UndefFunction` to create a new class with parent `AppliedUndef` named `abc`. Calling `F._sage_()` will NOT call the `_sage_()` member of `AppliedUndef` but tries to call `abc._sage_()` which does not exist at installation time. This, however, is not a problem because we can dynamically add a `_sage_()` method to `abc` on creation of `abc` inside `UndefFunction.__new__`. So converting abstract functions works.\n\nThe problem is that now `F(x)._sage_()` will call the same `abc._sage_()` while previously it was referred to the superclass, i.e. `AppliedUndef._sage_()`. But `_sage_` as class method does not know about the specific instance and its argument `x`.",
    "created_at": "2017-10-17T15:15:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-290554",
    "user": "https://github.com/rwst"
}
```

<div id="comment:23" align="right">comment:23</div>

To document what happens in SymPy:

When `F=Function('abc')` is called the constructor of `Function` uses the metaclass `UndefFunction` to create a new class with parent `AppliedUndef` named `abc`. Calling `F._sage_()` will NOT call the `_sage_()` member of `AppliedUndef` but tries to call `abc._sage_()` which does not exist at installation time. This, however, is not a problem because we can dynamically add a `_sage_()` method to `abc` on creation of `abc` inside `UndefFunction.__new__`. So converting abstract functions works.

The problem is that now `F(x)._sage_()` will call the same `abc._sage_()` while previously it was referred to the superclass, i.e. `AppliedUndef._sage_()`. But `_sage_` as class method does not know about the specific instance and its argument `x`.



---

archive/issue_comments_290555.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nFor the solution we will have to patch SymPy, not possible otherwise.",
    "created_at": "2017-10-17T15:59:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-290555",
    "user": "https://github.com/rwst"
}
```

<div id="comment:24" align="right">comment:24</div>

For the solution we will have to patch SymPy, not possible otherwise.



---

archive/issue_comments_290556.json:
```json
{
    "body": "Changed branch from **[u/mforets/20204](https://github.com/sagemath/sagetrac-mirror/tree/u/mforets/20204)** to **[u/rws/20204](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/20204)**",
    "created_at": "2017-10-17T16:03:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-290556",
    "user": "https://github.com/rwst"
}
```

Changed branch from **[u/mforets/20204](https://github.com/sagemath/sagetrac-mirror/tree/u/mforets/20204)** to **[u/rws/20204](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/20204)**



---

archive/issue_comments_290557.json:
```json
{
    "body": "<div id=\"comment:26\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b261ec3e671179d04d1922d15d9116e4f6e1d47f\"><code>b261ec3</code></a></td><td><code>23923: fix doctest</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5010acf00b2811420ba1a725deb2351f77eb0c01\"><code>5010acf</code></a></td><td><code>Merge branch 'u/rws/23923' of git://trac.sagemath.org/sage into t/20204/20204</code></td></tr></table>\n",
    "created_at": "2017-10-17T16:11:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-290557",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:26"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b261ec3e671179d04d1922d15d9116e4f6e1d47f"><code>b261ec3</code></a></td><td><code>23923: fix doctest</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5010acf00b2811420ba1a725deb2351f77eb0c01"><code>5010acf</code></a></td><td><code>Merge branch 'u/rws/23923' of git://trac.sagemath.org/sage into t/20204/20204</code></td></tr></table>




---

archive/issue_comments_290558.json:
```json
{
    "body": "Changed commit from **[`c9db597`](https://github.com/sagemath/sagetrac-mirror/commit/c9db59735ba48630a2cecb38308ad33d6b707a04)** to **[`5010acf`](https://github.com/sagemath/sagetrac-mirror/commit/5010acf00b2811420ba1a725deb2351f77eb0c01)**",
    "created_at": "2017-10-17T16:11:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-290558",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`c9db597`](https://github.com/sagemath/sagetrac-mirror/commit/c9db59735ba48630a2cecb38308ad33d6b707a04)** to **[`5010acf`](https://github.com/sagemath/sagetrac-mirror/commit/5010acf00b2811420ba1a725deb2351f77eb0c01)**



---

archive/issue_comments_290559.json:
```json
{
    "body": "Changed dependencies from **#23496** to **#23496, #22566**",
    "created_at": "2017-10-17T16:18:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-290559",
    "user": "https://github.com/rwst"
}
```

Changed dependencies from **#23496** to **#23496, #22566**



---

archive/issue_comments_290560.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nThe original examples all work now. I'll add them as doctests tomorrow.",
    "created_at": "2017-10-17T16:18:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-290560",
    "user": "https://github.com/rwst"
}
```

<div id="comment:27" align="right">comment:27</div>

The original examples all work now. I'll add them as doctests tomorrow.



---

archive/issue_comments_290561.json:
```json
{
    "body": "Changed author from **Marcelo Forets, Ralph Stephan** to **Marcelo Forets, Ralf Stephan**",
    "created_at": "2017-10-17T16:18:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-290561",
    "user": "https://github.com/rwst"
}
```

Changed author from **Marcelo Forets, Ralph Stephan** to **Marcelo Forets, Ralf Stephan**



---

archive/issue_comments_290562.json:
```json
{
    "body": "<div id=\"comment:28\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/14b1c523c468bfb304191edfe6e85a5c94e916f5\"><code>14b1c52</code></a></td><td><code>20204: more doctests</code></td></tr></table>\n",
    "created_at": "2017-10-18T06:53:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-290562",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:28"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/14b1c523c468bfb304191edfe6e85a5c94e916f5"><code>14b1c52</code></a></td><td><code>20204: more doctests</code></td></tr></table>




---

archive/issue_comments_290563.json:
```json
{
    "body": "Changed commit from **[`5010acf`](https://github.com/sagemath/sagetrac-mirror/commit/5010acf00b2811420ba1a725deb2351f77eb0c01)** to **[`14b1c52`](https://github.com/sagemath/sagetrac-mirror/commit/14b1c523c468bfb304191edfe6e85a5c94e916f5)**",
    "created_at": "2017-10-18T06:53:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-290563",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`5010acf`](https://github.com/sagemath/sagetrac-mirror/commit/5010acf00b2811420ba1a725deb2351f77eb0c01)** to **[`14b1c52`](https://github.com/sagemath/sagetrac-mirror/commit/14b1c523c468bfb304191edfe6e85a5c94e916f5)**



---

archive/issue_comments_290564.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nNext, we'll work on the SymPy update, based on this ticket.",
    "created_at": "2017-10-18T06:56:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-290564",
    "user": "https://github.com/rwst"
}
```

<div id="comment:29" align="right">comment:29</div>

Next, we'll work on the SymPy update, based on this ticket.



---

archive/issue_events_285246.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-10-18T06:56:37Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "title_is": "Fix problems with constructing or converting to SymPy expressions",
    "title_was": "problems with constructing or converting to SymPy expressions",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20204#event-285246"
}
```



---

archive/issue_events_285247.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-10-18T06:56:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20204#event-285247"
}
```



---

archive/issue_events_285248.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-10-18T06:56:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20204#event-285248"
}
```



---

archive/issue_comments_290565.json:
```json
{
    "body": "Reviewer: **Marcelo Forets**",
    "created_at": "2017-10-18T07:42:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-290565",
    "user": "https://github.com/mforets"
}
```

Reviewer: **Marcelo Forets**



---

archive/issue_comments_290566.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nlooks good to me. doctests in `src/sage/interfaces/sympy.py` pass and all (yes, all!) the issues in this ticket's description are solved. htmldoc is ok. let's wait that the patchbot changes the status..\n\nthe only oddity that i get (but maybe we shouldn't care?) is:\n\n```\nsage: from sympy import Function, Symbol\nsage: u = Function('u'); n = Symbol('n', integer=True)\nsage: type(u(2)+2)\n<class 'sympy.core.add.Add'>\nsage: type(2+u(2))\n<type 'sage.symbolic.expression.Expression'>\n```",
    "created_at": "2017-10-18T08:01:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-290566",
    "user": "https://github.com/mforets"
}
```

<div id="comment:31" align="right">comment:31</div>

looks good to me. doctests in `src/sage/interfaces/sympy.py` pass and all (yes, all!) the issues in this ticket's description are solved. htmldoc is ok. let's wait that the patchbot changes the status..

the only oddity that i get (but maybe we shouldn't care?) is:

```
sage: from sympy import Function, Symbol
sage: u = Function('u'); n = Symbol('n', integer=True)
sage: type(u(2)+2)
<class 'sympy.core.add.Add'>
sage: type(2+u(2))
<type 'sage.symbolic.expression.Expression'>
```



---

archive/issue_comments_290567.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nI think there is nothing wrong. In the second case it's probably coercion that makes the choice, and it doesn't know that SymPy implements addition for their objects to use.\n\nAs to the patchbots they are unreliable at the moment. That segfault in matrix is curious but I can't reproduce it.",
    "created_at": "2017-10-18T15:35:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-290567",
    "user": "https://github.com/rwst"
}
```

<div id="comment:32" align="right">comment:32</div>

I think there is nothing wrong. In the second case it's probably coercion that makes the choice, and it doesn't know that SymPy implements addition for their objects to use.

As to the patchbots they are unreliable at the moment. That segfault in matrix is curious but I can't reproduce it.



---

archive/issue_comments_290568.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\n> I think there is nothing wrong. In the second case it's probably coercion that makes the choice, and it doesn't know that SymPy implements addition for their objects to use. \n\nOk.\n\nsince i cannot reproduce failures in my machine, let me set to positive review.. and thanks for fixing everything!!",
    "created_at": "2017-10-18T17:07:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-290568",
    "user": "https://github.com/mforets"
}
```

<div id="comment:33" align="right">comment:33</div>

> I think there is nothing wrong. In the second case it's probably coercion that makes the choice, and it doesn't know that SymPy implements addition for their objects to use. 

Ok.

since i cannot reproduce failures in my machine, let me set to positive review.. and thanks for fixing everything!!



---

archive/issue_events_285249.json:
```json
{
    "actor": "https://github.com/mforets",
    "created_at": "2017-10-18T17:07:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20204#event-285249"
}
```



---

archive/issue_events_285250.json:
```json
{
    "actor": "https://github.com/mforets",
    "created_at": "2017-10-18T17:07:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20204#event-285250"
}
```



---

archive/issue_comments_290569.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nThanks for the review.",
    "created_at": "2017-10-19T05:50:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-290569",
    "user": "https://github.com/rwst"
}
```

<div id="comment:34" align="right">comment:34</div>

Thanks for the review.



---

archive/issue_comments_290570.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\n(Fixing formatting in ticket description.)",
    "created_at": "2017-10-29T00:29:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-290570",
    "user": "https://github.com/slel"
}
```

<div id="comment:35" align="right">comment:35</div>

(Fixing formatting in ticket description.)



---

archive/issue_comments_290571.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,10 +1,10 @@\n In the Sympy-1.0 upgrade the `AppliedUndef._sage_` method is patched away to enable the important upgrade. This function was planned to resolve part of #14723 but uncovers problems with symbolics. The following doctest in french_book fails if `AppliedUndef._sage_` is defined:\n \n ```\n-  sage: from sympy import Function, Symbol\n-  sage: u = Function('u'); n = Symbol('n', integer=True)\n-  sage: f = u(n+2)-(3/2)*u(n+1)+(1/2)*u(n)\n-NotimplementedError\n+sage: from sympy import Function, Symbol\n+sage: u = Function('u'); n = Symbol('n', integer=True)\n+sage: f = u(n+2)-(3/2)*u(n+1)+(1/2)*u(n)\n+NotImplementedError\n ```\n \n tscrim found the minimal cases:\n``````\n",
    "created_at": "2017-10-29T00:29:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-290571",
    "user": "https://github.com/slel"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,10 +1,10 @@
 In the Sympy-1.0 upgrade the `AppliedUndef._sage_` method is patched away to enable the important upgrade. This function was planned to resolve part of #14723 but uncovers problems with symbolics. The following doctest in french_book fails if `AppliedUndef._sage_` is defined:
 
 ```
-  sage: from sympy import Function, Symbol
-  sage: u = Function('u'); n = Symbol('n', integer=True)
-  sage: f = u(n+2)-(3/2)*u(n+1)+(1/2)*u(n)
-NotimplementedError
+sage: from sympy import Function, Symbol
+sage: u = Function('u'); n = Symbol('n', integer=True)
+sage: f = u(n+2)-(3/2)*u(n+1)+(1/2)*u(n)
+NotImplementedError
 ```
 
 tscrim found the minimal cases:
``````




---

archive/issue_comments_290572.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nMerge conflict",
    "created_at": "2017-11-01T23:06:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-290572",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:36" align="right">comment:36</div>

Merge conflict



---

archive/issue_events_285251.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-11-01T23:06:43Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20204#event-285251"
}
```



---

archive/issue_events_285252.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-11-01T23:06:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20204#event-285252"
}
```



---

archive/issue_comments_290573.json:
```json
{
    "body": "Changed commit from **[`14b1c52`](https://github.com/sagemath/sagetrac-mirror/commit/14b1c523c468bfb304191edfe6e85a5c94e916f5)** to **[`fd0db78`](https://github.com/sagemath/sagetrac-mirror/commit/fd0db783a1d0dfe70a5ca5272d762345376f0965)**",
    "created_at": "2017-11-02T06:50:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-290573",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`14b1c52`](https://github.com/sagemath/sagetrac-mirror/commit/14b1c523c468bfb304191edfe6e85a5c94e916f5)** to **[`fd0db78`](https://github.com/sagemath/sagetrac-mirror/commit/fd0db783a1d0dfe70a5ca5272d762345376f0965)**



---

archive/issue_comments_290574.json:
```json
{
    "body": "<div id=\"comment:37\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9169924ca14501168066f1a2ed9d03bcc887db34\"><code>9169924</code></a></td><td><code>Merge branch 'develop' into t/24006/24006</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d43419f73f455259896cbd9aeff86bbaa5d764c7\"><code>d43419f</code></a></td><td><code>24006: bump sympy patchlevel</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fd0db783a1d0dfe70a5ca5272d762345376f0965\"><code>fd0db78</code></a></td><td><code>Merge commit 'd43419f73f455259896cbd9aeff86bbaa5d764c7' of git://trac.sagemath.org/sage into t/20204/20204</code></td></tr></table>\n",
    "created_at": "2017-11-02T06:50:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-290574",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:37"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9169924ca14501168066f1a2ed9d03bcc887db34"><code>9169924</code></a></td><td><code>Merge branch 'develop' into t/24006/24006</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d43419f73f455259896cbd9aeff86bbaa5d764c7"><code>d43419f</code></a></td><td><code>24006: bump sympy patchlevel</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fd0db783a1d0dfe70a5ca5272d762345376f0965"><code>fd0db78</code></a></td><td><code>Merge commit 'd43419f73f455259896cbd9aeff86bbaa5d764c7' of git://trac.sagemath.org/sage into t/20204/20204</code></td></tr></table>




---

archive/issue_comments_290575.json:
```json
{
    "body": "<div id=\"comment:38\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9169924ca14501168066f1a2ed9d03bcc887db34\"><code>9169924</code></a></td><td><code>Merge branch 'develop' into t/24006/24006</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d43419f73f455259896cbd9aeff86bbaa5d764c7\"><code>d43419f</code></a></td><td><code>24006: bump sympy patchlevel</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fd0db783a1d0dfe70a5ca5272d762345376f0965\"><code>fd0db78</code></a></td><td><code>Merge commit 'd43419f73f455259896cbd9aeff86bbaa5d764c7' of git://trac.sagemath.org/sage into t/20204/20204</code></td></tr></table>\n",
    "created_at": "2017-11-02T06:51:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-290575",
    "user": "https://github.com/rwst"
}
```

<div id="comment:38"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9169924ca14501168066f1a2ed9d03bcc887db34"><code>9169924</code></a></td><td><code>Merge branch 'develop' into t/24006/24006</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d43419f73f455259896cbd9aeff86bbaa5d764c7"><code>d43419f</code></a></td><td><code>24006: bump sympy patchlevel</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fd0db783a1d0dfe70a5ca5272d762345376f0965"><code>fd0db78</code></a></td><td><code>Merge commit 'd43419f73f455259896cbd9aeff86bbaa5d764c7' of git://trac.sagemath.org/sage into t/20204/20204</code></td></tr></table>




---

archive/issue_events_285253.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-11-02T06:51:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20204#event-285253"
}
```



---

archive/issue_events_285254.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-11-02T06:51:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20204#event-285254"
}
```



---

archive/issue_events_285255.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-11-04T23:24:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20204#event-285255"
}
```



---

archive/issue_events_285256.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "dc9be1b4243c6b70da301a5d74b3b2d6245e47e5",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2017-11-04T23:24:42Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20204#event-285256"
}
```



---

archive/issue_comments_290576.json:
```json
{
    "body": "Changed branch from **[u/rws/20204](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/20204)** to **[`fd0db78`](https://github.com/sagemath/sagetrac-mirror/commit/fd0db783a1d0dfe70a5ca5272d762345376f0965)**",
    "created_at": "2017-11-04T23:24:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-290576",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/rws/20204](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/20204)** to **[`fd0db78`](https://github.com/sagemath/sagetrac-mirror/commit/fd0db783a1d0dfe70a5ca5272d762345376f0965)**
