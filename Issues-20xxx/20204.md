# Issue 20204: Fix problems with constructing or converting to SymPy expressions

archive/issues_019967.json:
```json
{
    "assignees": [],
    "body": "In the Sympy-1.0 upgrade the `AppliedUndef._sage_` method is patched away to enable the important upgrade. This function was planned to resolve part of #14723 but uncovers problems with symbolics. The following doctest in french_book fails if `AppliedUndef._sage_` is defined:\n\n```\nsage: from sympy import Function, Symbol\nsage: u = Function('u'); n = Symbol('n', integer=True)\nsage: f = u(n+2)-(3/2)*u(n+1)+(1/2)*u(n)\nNotImplementedError\n```\n\ntscrim found the minimal cases:\n> \n> ```\n> sage: f = function('f')\n> sage: x = var('x')\n> sage: sympy.sympify(f(x), evaluate=False)\n> f(x)\n> sage: sympy.sympify(3*f(x), evaluate=False)\n> AttributeError: 'Call' object has no attribute 'id'\n> ```\n> However, we do seem to have our own troubles of constructing SymPy objects from symbolic expressions. All of these result in errors:\n> \n> ```\n> sage: f._sympy_()\n> sage: f(x)._sympy_()\n> sage: (f(x)+3)._sympy_()\n> ```\n\nThis means that Sympy-1.0 probably only uncovered already existing problems in expression conversion. This ticket should remove the patch in `build/pkgs/sympy` and resolve all mentioned problems.\n\nSee #20185 for all previous discussion on this.\n\nDepends on #23496\n\nDepends on #22566\n\n**CC:**  @mforets @man74cio\n\n**Branch/Commit:** [fd0db783a1d0dfe70a5ca5272d762345376f0965](https://github.com/sagemath/sagetrac-mirror/commit/fd0db783a1d0dfe70a5ca5272d762345376f0965)\n\n**Reviewer:** Marcelo Forets\n\n**Author:** Marcelo Forets, Ralf Stephan\n\nIssue created by migration from https://trac.sagemath.org/ticket/20204\n\n",
    "closed_at": "2017-11-04T23:24:42Z",
    "created_at": "2016-03-14T07:50:14Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20symbolics",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Fix problems with constructing or converting to SymPy expressions",
    "type": "issue",
    "updated_at": "2017-11-04T23:24:42Z",
    "url": "https://github.com/sagemath/sage/issues/20204",
    "user": "https://github.com/rwst"
}
```
In the Sympy-1.0 upgrade the `AppliedUndef._sage_` method is patched away to enable the important upgrade. This function was planned to resolve part of #14723 but uncovers problems with symbolics. The following doctest in french_book fails if `AppliedUndef._sage_` is defined:

```
sage: from sympy import Function, Symbol
sage: u = Function('u'); n = Symbol('n', integer=True)
sage: f = u(n+2)-(3/2)*u(n+1)+(1/2)*u(n)
NotImplementedError
```

tscrim found the minimal cases:
> 
> ```
> sage: f = function('f')
> sage: x = var('x')
> sage: sympy.sympify(f(x), evaluate=False)
> f(x)
> sage: sympy.sympify(3*f(x), evaluate=False)
> AttributeError: 'Call' object has no attribute 'id'
> ```
> However, we do seem to have our own troubles of constructing SymPy objects from symbolic expressions. All of these result in errors:
> 
> ```
> sage: f._sympy_()
> sage: f(x)._sympy_()
> sage: (f(x)+3)._sympy_()
> ```

This means that Sympy-1.0 probably only uncovered already existing problems in expression conversion. This ticket should remove the patch in `build/pkgs/sympy` and resolve all mentioned problems.

See #20185 for all previous discussion on this.

Depends on #23496

Depends on #22566

**CC:**  @mforets @man74cio

**Branch/Commit:** [fd0db783a1d0dfe70a5ca5272d762345376f0965](https://github.com/sagemath/sagetrac-mirror/commit/fd0db783a1d0dfe70a5ca5272d762345376f0965)

**Reviewer:** Marcelo Forets

**Author:** Marcelo Forets, Ralf Stephan

Issue created by migration from https://trac.sagemath.org/ticket/20204





---

archive/issue_events_246361.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2016-03-14T07:50:14Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "milestone_number": null,
    "milestone_title": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20204#event-246361"
}
```



---

archive/issue_events_246362.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2016-03-14T07:50:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20symbolics",
    "label_color": "08517b",
    "label_name": "component: symbolics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20204#event-246362"
}
```



---

archive/issue_events_246363.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2016-03-14T07:50:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "008080",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20204#event-246363"
}
```



---

archive/issue_comments_292997.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-In the Sympy-1.0 upgrade the `UndefinedFunction._sage_` method is patched away to enable the important upgrade. This function was planned to resolve part of #14723 but uncovers missing functionality in the coercion system, and probably with symbolics. The following doctest in french_book fails if `UndefinedFunction._sage_` is defined:\n+In the Sympy-1.0 upgrade the `UndefinedFunction._sage_` method is patched away to enable the important upgrade. This function was planned to resolve part of #14723 but uncovers problems with symbolics. The following doctest in french_book fails if `UndefinedFunction._sage_` is defined:\n \n ```\n   sage: from sympy import Function, Symbol\n``````\n",
    "created_at": "2016-03-14T08:12:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-292997",
    "user": "https://github.com/rwst"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-In the Sympy-1.0 upgrade the `UndefinedFunction._sage_` method is patched away to enable the important upgrade. This function was planned to resolve part of #14723 but uncovers missing functionality in the coercion system, and probably with symbolics. The following doctest in french_book fails if `UndefinedFunction._sage_` is defined:
+In the Sympy-1.0 upgrade the `UndefinedFunction._sage_` method is patched away to enable the important upgrade. This function was planned to resolve part of #14723 but uncovers problems with symbolics. The following doctest in french_book fails if `UndefinedFunction._sage_` is defined:
 
 ```
   sage: from sympy import Function, Symbol
``````




---

archive/issue_comments_292998.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-In the Sympy-1.0 upgrade the `UndefinedFunction._sage_` method is patched away to enable the important upgrade. This function was planned to resolve part of #14723 but uncovers problems with symbolics. The following doctest in french_book fails if `UndefinedFunction._sage_` is defined:\n+In the Sympy-1.0 upgrade the `AppliedUndef._sage_` method is patched away to enable the important upgrade. This function was planned to resolve part of #14723 but uncovers problems with symbolics. The following doctest in french_book fails if `AppliedUndef._sage_` is defined:\n \n ```\n   sage: from sympy import Function, Symbol\n``````\n",
    "created_at": "2016-08-06T09:03:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-292998",
    "user": "https://github.com/rwst"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-In the Sympy-1.0 upgrade the `UndefinedFunction._sage_` method is patched away to enable the important upgrade. This function was planned to resolve part of #14723 but uncovers problems with symbolics. The following doctest in french_book fails if `UndefinedFunction._sage_` is defined:
+In the Sympy-1.0 upgrade the `AppliedUndef._sage_` method is patched away to enable the important upgrade. This function was planned to resolve part of #14723 but uncovers problems with symbolics. The following doctest in french_book fails if `AppliedUndef._sage_` is defined:
 
 ```
   sage: from sympy import Function, Symbol
``````




---

archive/issue_comments_292999.json:
```json
{
    "body": "<a id='comment:4'>**Comment 4:**</a>\nHi, any progress on this? We are currently NOT carrying Sage's sympy patch in Debian, so our Sage is running *without* this patch (and a few french book doctests break but we just ignore this).\n\nIn fact applying the patch, breaks some of sympy's own tests relating to Sage integration: https://github.com/sympy/sympy/pull/11858#issuecomment-308207891\n\nBTW you do not need to rebuild Sympy to apply or unapply this patch, just edit /usr/lib/python2.7/dist-packages/sympy/core/function.py or wherever the file is installed to. Then restart sage (if you're testing Sage) or python (if you're testing sympy).",
    "created_at": "2017-06-13T19:23:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-292999",
    "user": "https://github.com/infinity0"
}
```

<a id='comment:4'>**Comment 4:**</a>
Hi, any progress on this? We are currently NOT carrying Sage's sympy patch in Debian, so our Sage is running *without* this patch (and a few french book doctests break but we just ignore this).

In fact applying the patch, breaks some of sympy's own tests relating to Sage integration: https://github.com/sympy/sympy/pull/11858#issuecomment-308207891

BTW you do not need to rebuild Sympy to apply or unapply this patch, just edit /usr/lib/python2.7/dist-packages/sympy/core/function.py or wherever the file is installed to. Then restart sage (if you're testing Sage) or python (if you're testing sympy).



---

archive/issue_comments_293000.json:
```json
{
    "body": "<a id='comment:5'>**Comment 5:**</a>\nhi, i've experimented adding a fragment of #14723:\n\n```\n@@ -764,6 +764,9 @@ class SympyConverter(Converter):\n         if f_sympy:\n             return f_sympy(*sympy.sympify(g, evaluate=False))\n         else:\n\n+            from sage.symbolic.function_factory import SymbolicFunction\n+            if isinstance(ex.operator(), SymbolicFunction):\n+                return sympy.Function(str(f))(*g, evaluate=False)\n             raise NotImplementedError(\"SymPy function '%s' doesn't exist\" % f)\n``` \n\nand adding the `_sympy_` method to the NewSymbolicFunction class:\n\n```\n@@ -67,6 +67,10 @@ def function_factory(name, nargs=0, latex_name=None, conversions=None,\n             \"\"\"\n             return \"'%s\"%self.name()\n\n+        def _sympy_(self):\n+            from sympy import Function\n+            return Function(self.name())\n```\n\nwith these changes, the conversions in this ticket's description work. does this go in the good direction or not? \n\nhowever, the round trip back to sage is broken:\n\n```\nsage: f = function('f')\nsage: type(f)\n<class 'sage.symbolic.function_factory.NewSymbolicFunction'>\nsage: fs = f._sympy_()\nsage: type(fs)\n<class 'sympy.core.function.UndefinedFunction'>\nsage: fs._sage_()\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-5-9fb5fbad3003> in <module>()\n----> 1 fs._sage_()\n\nTypeError: unbound method _sage_() must be called with f instance as first argument (got nothing instead)\n```\n\nand with a different error for a function with arguments:\n\n```\nsage: f = function('f')(x)\nsage: type(f)\n<type 'sage.symbolic.expression.Expression'>\nsage: fs = f._sympy_()\nsage: type(fs)\nf\nsage: fs._sage_()\n\n---------------------------------------------------------------------------\nAttributeError                            Traceback (most recent call last)\n<ipython-input-5-9fb5fbad3003> in <module>()\n----> 1 fs._sage_()\n\n/Users/forets/sage-src/sage/local/lib/python2.7/site-packages/sympy/core/function.pyc in _sage_(self)\n    705         import sage.all as sage\n    706         fname = self.func.__name__\n--> 707         func = getattr(sage, fname)\n    708         args = [arg._sage_() for arg in self.args]\n    709         return func(*args)\n\nAttributeError: 'module' object has no attribute 'f'\n```",
    "created_at": "2017-06-23T09:51:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-293000",
    "user": "https://github.com/mforets"
}
```

<a id='comment:5'>**Comment 5:**</a>
hi, i've experimented adding a fragment of #14723:

```
@@ -764,6 +764,9 @@ class SympyConverter(Converter):
         if f_sympy:
             return f_sympy(*sympy.sympify(g, evaluate=False))
         else:

+            from sage.symbolic.function_factory import SymbolicFunction
+            if isinstance(ex.operator(), SymbolicFunction):
+                return sympy.Function(str(f))(*g, evaluate=False)
             raise NotImplementedError("SymPy function '%s' doesn't exist" % f)
``` 

and adding the `_sympy_` method to the NewSymbolicFunction class:

```
@@ -67,6 +67,10 @@ def function_factory(name, nargs=0, latex_name=None, conversions=None,
             """
             return "'%s"%self.name()

+        def _sympy_(self):
+            from sympy import Function
+            return Function(self.name())
```

with these changes, the conversions in this ticket's description work. does this go in the good direction or not? 

however, the round trip back to sage is broken:

```
sage: f = function('f')
sage: type(f)
<class 'sage.symbolic.function_factory.NewSymbolicFunction'>
sage: fs = f._sympy_()
sage: type(fs)
<class 'sympy.core.function.UndefinedFunction'>
sage: fs._sage_()
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-5-9fb5fbad3003> in <module>()
----> 1 fs._sage_()

TypeError: unbound method _sage_() must be called with f instance as first argument (got nothing instead)
```

and with a different error for a function with arguments:

```
sage: f = function('f')(x)
sage: type(f)
<type 'sage.symbolic.expression.Expression'>
sage: fs = f._sympy_()
sage: type(fs)
f
sage: fs._sage_()

---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
<ipython-input-5-9fb5fbad3003> in <module>()
----> 1 fs._sage_()

/Users/forets/sage-src/sage/local/lib/python2.7/site-packages/sympy/core/function.pyc in _sage_(self)
    705         import sage.all as sage
    706         fname = self.func.__name__
--> 707         func = getattr(sage, fname)
    708         args = [arg._sage_() for arg in self.args]
    709         return func(*args)

AttributeError: 'module' object has no attribute 'f'
```



---

archive/issue_comments_293001.json:
```json
{
    "body": "<a id='comment:6'>**Comment 6:**</a>\nReplying to [@mforets](#comment%3A5):\n> with these changes, the conversions in this ticket's description work. does this go in the good direction or not? \n\nLooks good.",
    "created_at": "2017-06-23T12:54:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-293001",
    "user": "https://github.com/rwst"
}
```

<a id='comment:6'>**Comment 6:**</a>
Replying to [@mforets](#comment%3A5):
> with these changes, the conversions in this ticket's description work. does this go in the good direction or not? 

Looks good.



---

archive/issue_comments_293002.json:
```json
{
    "body": "**Commit:** [442d13b21bd3056d744ce92a19fb9b428f1df641](https://github.com/sagemath/sagetrac-mirror/commit/442d13b21bd3056d744ce92a19fb9b428f1df641)",
    "created_at": "2017-06-24T09:08:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-293002",
    "user": "https://github.com/mforets"
}
```

**Commit:** [442d13b21bd3056d744ce92a19fb9b428f1df641](https://github.com/sagemath/sagetrac-mirror/commit/442d13b21bd3056d744ce92a19fb9b428f1df641)



---

archive/issue_comments_293003.json:
```json
{
    "body": "<a id='comment:7'>**Comment 7:**</a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/442d13b21bd3056d744ce92a19fb9b428f1df641\">442d13b</a></td><td><code>check for SymbolicFunction in SympyConverter</code></td></tr></table>\n",
    "created_at": "2017-06-24T09:08:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-293003",
    "user": "https://github.com/mforets"
}
```

<a id='comment:7'>**Comment 7:**</a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/442d13b21bd3056d744ce92a19fb9b428f1df641">442d13b</a></td><td><code>check for SymbolicFunction in SympyConverter</code></td></tr></table>




---

archive/issue_comments_293004.json:
```json
{
    "body": "**Branch:** [u/mforets/20204](https://github.com/sagemath/sagetrac-mirror/tree/u/mforets/20204)",
    "created_at": "2017-06-24T09:08:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-293004",
    "user": "https://github.com/mforets"
}
```

**Branch:** [u/mforets/20204](https://github.com/sagemath/sagetrac-mirror/tree/u/mforets/20204)



---

archive/issue_comments_293005.json:
```json
{
    "body": "<a id='comment:8'>**Comment 8:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9f40ac9e569317cd3f9c264d05f6c18f07bebe65\">9f40ac9</a></td><td><code>add sympy method to NewSymbolicFunction</code></td></tr></table>\n",
    "created_at": "2017-06-24T09:09:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-293005",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:8'>**Comment 8:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9f40ac9e569317cd3f9c264d05f6c18f07bebe65">9f40ac9</a></td><td><code>add sympy method to NewSymbolicFunction</code></td></tr></table>




---

archive/issue_comments_293006.json:
```json
{
    "body": "**Changing commit** from \"[442d13b21bd3056d744ce92a19fb9b428f1df641](https://github.com/sagemath/sagetrac-mirror/commit/442d13b21bd3056d744ce92a19fb9b428f1df641)\" to \"[9f40ac9e569317cd3f9c264d05f6c18f07bebe65](https://github.com/sagemath/sagetrac-mirror/commit/9f40ac9e569317cd3f9c264d05f6c18f07bebe65)\".",
    "created_at": "2017-06-24T09:09:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-293006",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[442d13b21bd3056d744ce92a19fb9b428f1df641](https://github.com/sagemath/sagetrac-mirror/commit/442d13b21bd3056d744ce92a19fb9b428f1df641)" to "[9f40ac9e569317cd3f9c264d05f6c18f07bebe65](https://github.com/sagemath/sagetrac-mirror/commit/9f40ac9e569317cd3f9c264d05f6c18f07bebe65)".



---

archive/issue_comments_293007.json:
```json
{
    "body": "<a id='comment:9'>**Comment 9:**</a>\nfor the remaining part, this is supposed to be solved here? (*This ticket should remove the patch..* => to delete the file `build/pkgs/sympy/patches/01_undeffun_sage.patch` ??). i've played around, but i don't quite understand how it's supposed to work.. thanks.",
    "created_at": "2017-06-25T14:06:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-293007",
    "user": "https://github.com/mforets"
}
```

<a id='comment:9'>**Comment 9:**</a>
for the remaining part, this is supposed to be solved here? (*This ticket should remove the patch..* => to delete the file `build/pkgs/sympy/patches/01_undeffun_sage.patch` ??). i've played around, but i don't quite understand how it's supposed to work.. thanks.



---

archive/issue_comments_293008.json:
```json
{
    "body": "<a id='comment:10'>**Comment 10:**</a>\nReplying to [@mforets](#comment%3A9):\n> for the remaining part, this is supposed to be solved here? (*This ticket should remove the patch..* => to delete the file `build/pkgs/sympy/patches/01_undeffun_sage.patch` ??). i've played around, but i don't quite understand how it's supposed to work.. thanks.\n\nYou mean how to delete a file from a git branch? use `git rm`.",
    "created_at": "2017-07-01T07:04:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-293008",
    "user": "https://github.com/rwst"
}
```

<a id='comment:10'>**Comment 10:**</a>
Replying to [@mforets](#comment%3A9):
> for the remaining part, this is supposed to be solved here? (*This ticket should remove the patch..* => to delete the file `build/pkgs/sympy/patches/01_undeffun_sage.patch` ??). i've played around, but i don't quite understand how it's supposed to work.. thanks.

You mean how to delete a file from a git branch? use `git rm`.



---

archive/issue_comments_293009.json:
```json
{
    "body": "<a id='comment:11'>**Comment 11:**</a>\nReplying to [@rwst](#comment%3A10):\n> Replying to [@mforets](#comment%3A9):\n> > for the remaining part, this is supposed to be solved here? (*This ticket should remove the patch..* => to delete the file `build/pkgs/sympy/patches/01_undeffun_sage.patch` ??). i've played around, but i don't quite understand how it's supposed to work.. thanks.\n\n> \n> You mean how to delete a file from a git branch? use `git rm`.\n\nno; i didn't know what are these `*.patch` files, how they are generated, how they are incorporated into sage.. Anyway, I'll `git rm 01_undeffun_sage.patch` later today!",
    "created_at": "2017-07-01T08:20:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-293009",
    "user": "https://github.com/mforets"
}
```

<a id='comment:11'>**Comment 11:**</a>
Replying to [@rwst](#comment%3A10):
> Replying to [@mforets](#comment%3A9):
> > for the remaining part, this is supposed to be solved here? (*This ticket should remove the patch..* => to delete the file `build/pkgs/sympy/patches/01_undeffun_sage.patch` ??). i've played around, but i don't quite understand how it's supposed to work.. thanks.

> 
> You mean how to delete a file from a git branch? use `git rm`.

no; i didn't know what are these `*.patch` files, how they are generated, how they are incorporated into sage.. Anyway, I'll `git rm 01_undeffun_sage.patch` later today!



---

archive/issue_comments_293010.json:
```json
{
    "body": "<a id='comment:12'>**Comment 12:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a07b72be4003315a37d9cf9c73c14b074c7d52c5\">a07b72b</a></td><td><code>remove undeffun patch</code></td></tr></table>\n",
    "created_at": "2017-07-01T08:52:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-293010",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:12'>**Comment 12:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a07b72be4003315a37d9cf9c73c14b074c7d52c5">a07b72b</a></td><td><code>remove undeffun patch</code></td></tr></table>




---

archive/issue_comments_293011.json:
```json
{
    "body": "**Changing commit** from \"[9f40ac9e569317cd3f9c264d05f6c18f07bebe65](https://github.com/sagemath/sagetrac-mirror/commit/9f40ac9e569317cd3f9c264d05f6c18f07bebe65)\" to \"[a07b72be4003315a37d9cf9c73c14b074c7d52c5](https://github.com/sagemath/sagetrac-mirror/commit/a07b72be4003315a37d9cf9c73c14b074c7d52c5)\".",
    "created_at": "2017-07-01T08:52:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-293011",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[9f40ac9e569317cd3f9c264d05f6c18f07bebe65](https://github.com/sagemath/sagetrac-mirror/commit/9f40ac9e569317cd3f9c264d05f6c18f07bebe65)" to "[a07b72be4003315a37d9cf9c73c14b074c7d52c5](https://github.com/sagemath/sagetrac-mirror/commit/a07b72be4003315a37d9cf9c73c14b074c7d52c5)".



---

archive/issue_comments_293012.json:
```json
{
    "body": "<a id='comment:13'>**Comment 13:**</a>\nReplying to [@mforets](#comment%3A11):\n> no; i didn't know what are these `*.patch` files, how they are generated, how they are incorporated into sage..\n\nYou get them with any git branch by piping the output of `git diff` into a file. OTOH you don't even need `git diff`. For example the SymPy PR patch mentioned in #22802 can be had by downloading `https://patch-diff.githubusercontent.com/raw/sympy/sympy/pull/12826.diff`, i.e. the PR link with `.diff` appended. That should work with any github commit.",
    "created_at": "2017-07-01T09:00:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-293012",
    "user": "https://github.com/rwst"
}
```

<a id='comment:13'>**Comment 13:**</a>
Replying to [@mforets](#comment%3A11):
> no; i didn't know what are these `*.patch` files, how they are generated, how they are incorporated into sage..

You get them with any git branch by piping the output of `git diff` into a file. OTOH you don't even need `git diff`. For example the SymPy PR patch mentioned in #22802 can be had by downloading `https://patch-diff.githubusercontent.com/raw/sympy/sympy/pull/12826.diff`, i.e. the PR link with `.diff` appended. That should work with any github commit.



---

archive/issue_comments_293013.json:
```json
{
    "body": "<a id='comment:14'>**Comment 14:**</a>\nOK and those patches get automatically applied into `/local/lib/...` upon rebuilding.\n\nI've tested the patch in question. It solves one out of the two cases from [comment:5](#comment%3A5) :\n\n```\nsage: function('f')(x)._sympy_()._sage_()  # ok\nf(x)\nsage: function('f')._sympy_()._sage_()  # problem\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-2-7d5000a51aaa> in <module>()\n----> 1 function('f')._sympy_()._sage_()\n\nTypeError: unbound method _sage_() must be called with f instance as first argument (got nothing instead)\n```\n\nIf we also want to transform from `UndefinedFunction` back to `NewSymbolicFunction`, then, that case should be addressed upstream in [sympy to sage conversion : Abstract function](https://github.com/sympy/sympy/pull/12826) too?",
    "created_at": "2017-07-01T10:58:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-293013",
    "user": "https://github.com/mforets"
}
```

<a id='comment:14'>**Comment 14:**</a>
OK and those patches get automatically applied into `/local/lib/...` upon rebuilding.

I've tested the patch in question. It solves one out of the two cases from [comment:5](#comment%3A5) :

```
sage: function('f')(x)._sympy_()._sage_()  # ok
f(x)
sage: function('f')._sympy_()._sage_()  # problem
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-2-7d5000a51aaa> in <module>()
----> 1 function('f')._sympy_()._sage_()

TypeError: unbound method _sage_() must be called with f instance as first argument (got nothing instead)
```

If we also want to transform from `UndefinedFunction` back to `NewSymbolicFunction`, then, that case should be addressed upstream in [sympy to sage conversion : Abstract function](https://github.com/sympy/sympy/pull/12826) too?



---

archive/issue_comments_293014.json:
```json
{
    "body": "<a id='comment:15'>**Comment 15:**</a>\nReplying to [@mforets](#comment%3A14):\n> If we also want to transform from `UndefinedFunction` back to `NewSymbolicFunction`, then, that case should be addressed upstream in [sympy to sage conversion : Abstract function](https://github.com/sympy/sympy/pull/12826) too?\n\nYes, conversion of SymPy objects is usually done by their member function `_sage_()`. That means SymPy source change.",
    "created_at": "2017-07-01T12:48:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-293014",
    "user": "https://github.com/rwst"
}
```

<a id='comment:15'>**Comment 15:**</a>
Replying to [@mforets](#comment%3A14):
> If we also want to transform from `UndefinedFunction` back to `NewSymbolicFunction`, then, that case should be addressed upstream in [sympy to sage conversion : Abstract function](https://github.com/sympy/sympy/pull/12826) too?

Yes, conversion of SymPy objects is usually done by their member function `_sage_()`. That means SymPy source change.



---

archive/issue_comments_293015.json:
```json
{
    "body": "<a id='comment:16'>**Comment 16:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **Last 10 new commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9d16a70b2daf9e123f2bf180547f38a4a10c2306\">9d16a70</a></td><td><code>Lost package-version.txt modifications : restored</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d5d6b6733ea408b4a73860578e8b482d6dfea2c7\">d5d6b67</a></td><td><code>Corrected error on patcj version</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/462bd681d32ee87a3813caa79e43842a4477d2e7\">462bd68</a></td><td><code>test is not corrected at this point</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/daa2f2cc0a70480553db6a01fd9b28552e63920e\">daa2f2c</a></td><td><code>Error on sympy branch corrected with a new patch</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/487242514e520b0c73e24628ac2269df7cd2c0c0\">4872425</a></td><td><code>forgetten to delete gg in doctest</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/721eed7a72e7d86189fa6200bed75ef1c11af4a3\">721eed7</a></td><td><code>removed whitespace</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e46345b0c23138d017ce6f50f44d144179c9c668\">e46345b</a></td><td><code>changed sympy patch version</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/46ebd728aac486a5dd675f5d228d90001c421635\">46ebd72</a></td><td><code>Merge branch 'public/23496_patch_sympy_abstact_function' of git://trac.sagemath.org/sage into public/23496_patch_sympy_abstact_function</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e74980b22380c76fb64fd9b3ef4eb4da60bcf11a\">e74980b</a></td><td><code>Merge branch 'develop' into t/23496/public/23496_patch_sympy_abstact_function</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c9db59735ba48630a2cecb38308ad33d6b707a04\">c9db597</a></td><td><code>Merge branch 't/23496/public/23496_patch_sympy_abstact_function' into t/mforets/20204</code></td></tr></table>\n",
    "created_at": "2017-08-30T08:21:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-293015",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:16'>**Comment 16:**</a>
**Branch pushed to git repo; I updated commit sha1.** **Last 10 new commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9d16a70b2daf9e123f2bf180547f38a4a10c2306">9d16a70</a></td><td><code>Lost package-version.txt modifications : restored</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d5d6b6733ea408b4a73860578e8b482d6dfea2c7">d5d6b67</a></td><td><code>Corrected error on patcj version</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/462bd681d32ee87a3813caa79e43842a4477d2e7">462bd68</a></td><td><code>test is not corrected at this point</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/daa2f2cc0a70480553db6a01fd9b28552e63920e">daa2f2c</a></td><td><code>Error on sympy branch corrected with a new patch</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/487242514e520b0c73e24628ac2269df7cd2c0c0">4872425</a></td><td><code>forgetten to delete gg in doctest</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/721eed7a72e7d86189fa6200bed75ef1c11af4a3">721eed7</a></td><td><code>removed whitespace</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e46345b0c23138d017ce6f50f44d144179c9c668">e46345b</a></td><td><code>changed sympy patch version</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/46ebd728aac486a5dd675f5d228d90001c421635">46ebd72</a></td><td><code>Merge branch 'public/23496_patch_sympy_abstact_function' of git://trac.sagemath.org/sage into public/23496_patch_sympy_abstact_function</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e74980b22380c76fb64fd9b3ef4eb4da60bcf11a">e74980b</a></td><td><code>Merge branch 'develop' into t/23496/public/23496_patch_sympy_abstact_function</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c9db59735ba48630a2cecb38308ad33d6b707a04">c9db597</a></td><td><code>Merge branch 't/23496/public/23496_patch_sympy_abstact_function' into t/mforets/20204</code></td></tr></table>




---

archive/issue_comments_293016.json:
```json
{
    "body": "**Changing commit** from \"[a07b72be4003315a37d9cf9c73c14b074c7d52c5](https://github.com/sagemath/sagetrac-mirror/commit/a07b72be4003315a37d9cf9c73c14b074c7d52c5)\" to \"[c9db59735ba48630a2cecb38308ad33d6b707a04](https://github.com/sagemath/sagetrac-mirror/commit/c9db59735ba48630a2cecb38308ad33d6b707a04)\".",
    "created_at": "2017-08-30T08:21:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-293016",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[a07b72be4003315a37d9cf9c73c14b074c7d52c5](https://github.com/sagemath/sagetrac-mirror/commit/a07b72be4003315a37d9cf9c73c14b074c7d52c5)" to "[c9db59735ba48630a2cecb38308ad33d6b707a04](https://github.com/sagemath/sagetrac-mirror/commit/c9db59735ba48630a2cecb38308ad33d6b707a04)".



---

archive/issue_events_246364.json:
```json
{
    "actor": "https://github.com/mforets",
    "created_at": "2017-08-30T08:22:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20204#event-246364"
}
```



---

archive/issue_comments_293017.json:
```json
{
    "body": "**Author:** Marcelo Forets, Ralph Stephan",
    "created_at": "2017-08-30T08:22:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-293017",
    "user": "https://github.com/mforets"
}
```

**Author:** Marcelo Forets, Ralph Stephan



---

archive/issue_comments_293018.json:
```json
{
    "body": "<a id='comment:17'>**Comment 17:**</a>\n**Last 10 new commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9d16a70b2daf9e123f2bf180547f38a4a10c2306\">9d16a70</a></td><td><code>Lost package-version.txt modifications : restored</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d5d6b6733ea408b4a73860578e8b482d6dfea2c7\">d5d6b67</a></td><td><code>Corrected error on patcj version</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/462bd681d32ee87a3813caa79e43842a4477d2e7\">462bd68</a></td><td><code>test is not corrected at this point</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/daa2f2cc0a70480553db6a01fd9b28552e63920e\">daa2f2c</a></td><td><code>Error on sympy branch corrected with a new patch</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/487242514e520b0c73e24628ac2269df7cd2c0c0\">4872425</a></td><td><code>forgetten to delete gg in doctest</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/721eed7a72e7d86189fa6200bed75ef1c11af4a3\">721eed7</a></td><td><code>removed whitespace</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e46345b0c23138d017ce6f50f44d144179c9c668\">e46345b</a></td><td><code>changed sympy patch version</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/46ebd728aac486a5dd675f5d228d90001c421635\">46ebd72</a></td><td><code>Merge branch 'public/23496_patch_sympy_abstact_function' of git://trac.sagemath.org/sage into public/23496_patch_sympy_abstact_function</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e74980b22380c76fb64fd9b3ef4eb4da60bcf11a\">e74980b</a></td><td><code>Merge branch 'develop' into t/23496/public/23496_patch_sympy_abstact_function</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c9db59735ba48630a2cecb38308ad33d6b707a04\">c9db597</a></td><td><code>Merge branch 't/23496/public/23496_patch_sympy_abstact_function' into t/mforets/20204</code></td></tr></table>\n",
    "created_at": "2017-08-30T08:22:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-293018",
    "user": "https://github.com/mforets"
}
```

<a id='comment:17'>**Comment 17:**</a>
**Last 10 new commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9d16a70b2daf9e123f2bf180547f38a4a10c2306">9d16a70</a></td><td><code>Lost package-version.txt modifications : restored</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d5d6b6733ea408b4a73860578e8b482d6dfea2c7">d5d6b67</a></td><td><code>Corrected error on patcj version</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/462bd681d32ee87a3813caa79e43842a4477d2e7">462bd68</a></td><td><code>test is not corrected at this point</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/daa2f2cc0a70480553db6a01fd9b28552e63920e">daa2f2c</a></td><td><code>Error on sympy branch corrected with a new patch</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/487242514e520b0c73e24628ac2269df7cd2c0c0">4872425</a></td><td><code>forgetten to delete gg in doctest</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/721eed7a72e7d86189fa6200bed75ef1c11af4a3">721eed7</a></td><td><code>removed whitespace</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e46345b0c23138d017ce6f50f44d144179c9c668">e46345b</a></td><td><code>changed sympy patch version</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/46ebd728aac486a5dd675f5d228d90001c421635">46ebd72</a></td><td><code>Merge branch 'public/23496_patch_sympy_abstact_function' of git://trac.sagemath.org/sage into public/23496_patch_sympy_abstact_function</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e74980b22380c76fb64fd9b3ef4eb4da60bcf11a">e74980b</a></td><td><code>Merge branch 'develop' into t/23496/public/23496_patch_sympy_abstact_function</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c9db59735ba48630a2cecb38308ad33d6b707a04">c9db597</a></td><td><code>Merge branch 't/23496/public/23496_patch_sympy_abstact_function' into t/mforets/20204</code></td></tr></table>




---

archive/issue_events_246365.json:
```json
{
    "actor": "https://github.com/mforets",
    "created_at": "2017-08-30T08:22:50Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "milestone_number": null,
    "milestone_title": "sage-7.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20204#event-246365"
}
```



---

archive/issue_events_246366.json:
```json
{
    "actor": "https://github.com/mforets",
    "created_at": "2017-08-30T08:22:50Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "milestone_number": null,
    "milestone_title": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20204#event-246366"
}
```



---

archive/issue_comments_293019.json:
```json
{
    "body": "**Dependencies:** 23496",
    "created_at": "2017-08-30T08:22:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-293019",
    "user": "https://github.com/mforets"
}
```

**Dependencies:** 23496



---

archive/issue_comments_293020.json:
```json
{
    "body": "**Changing dependencies** from \"23496\" to \"#23496\".",
    "created_at": "2017-08-30T08:23:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-293020",
    "user": "https://github.com/mforets"
}
```

**Changing dependencies** from "23496" to "#23496".



---

archive/issue_events_246367.json:
```json
{
    "actor": "https://github.com/mforets",
    "created_at": "2017-09-03T12:35:04Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20204#event-246367"
}
```



---

archive/issue_events_246368.json:
```json
{
    "actor": "https://github.com/mforets",
    "created_at": "2017-09-03T12:35:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20204#event-246368"
}
```



---

archive/issue_comments_293021.json:
```json
{
    "body": "<a id='comment:19'>**Comment 19:**</a>\nessentially there is this problem:\n\n```\nsage: from sympy import Function, Symbol\nsage:  u = Function('u') ; n = Symbol('n', integer=True);\nsage: type(2+u(2))  # wrong\n<type 'sage.symbolic.expression.Expression'>\nsage: type(u(2)+2)\n<class 'sympy.core.add.Add'>\n```\n\nit gets fixed with the code in this comment: [#23496 comment:65](https://github.com/sagemath/sage/issues/23496#comment:65)\n\ndo you agree?",
    "created_at": "2017-09-03T12:35:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-293021",
    "user": "https://github.com/mforets"
}
```

<a id='comment:19'>**Comment 19:**</a>
essentially there is this problem:

```
sage: from sympy import Function, Symbol
sage:  u = Function('u') ; n = Symbol('n', integer=True);
sage: type(2+u(2))  # wrong
<type 'sage.symbolic.expression.Expression'>
sage: type(u(2)+2)
<class 'sympy.core.add.Add'>
```

it gets fixed with the code in this comment: [#23496 comment:65](https://github.com/sagemath/sage/issues/23496#comment:65)

do you agree?



---

archive/issue_comments_293022.json:
```json
{
    "body": "<a id='comment:20'>**Comment 20:**</a>\nAfter #24006 there is need for a rewrite which makes it all much simpler. I'll try that now.",
    "created_at": "2017-10-17T06:48:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-293022",
    "user": "https://github.com/rwst"
}
```

<a id='comment:20'>**Comment 20:**</a>
After #24006 there is need for a rewrite which makes it all much simpler. I'll try that now.



---

archive/issue_comments_293023.json:
```json
{
    "body": "<a id='comment:21'>**Comment 21:**</a>\nawesome. i started to read your code today, so i don't get too outdated :)",
    "created_at": "2017-10-17T06:54:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-293023",
    "user": "https://github.com/mforets"
}
```

<a id='comment:21'>**Comment 21:**</a>
awesome. i started to read your code today, so i don't get too outdated :)



---

archive/issue_comments_293024.json:
```json
{
    "body": "<a id='comment:22'>**Comment 22:**</a>\nI think the problem with `Function('f')` is that it returns a class not an object, and I'm not sure if we can put a `_sage_` method onto that.",
    "created_at": "2017-10-17T07:53:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-293024",
    "user": "https://github.com/rwst"
}
```

<a id='comment:22'>**Comment 22:**</a>
I think the problem with `Function('f')` is that it returns a class not an object, and I'm not sure if we can put a `_sage_` method onto that.



---

archive/issue_comments_293025.json:
```json
{
    "body": "<a id='comment:23'>**Comment 23:**</a>\nTo document what happens in SymPy:\n\nWhen `F=Function('abc')` is called the constructor of `Function` uses the metaclass `UndefFunction` to create a new class with parent `AppliedUndef` named `abc`. Calling `F._sage_()` will NOT call the `_sage_()` member of `AppliedUndef` but tries to call `abc._sage_()` which does not exist at installation time. This, however, is not a problem because we can dynamically add a `_sage_()` method to `abc` on creation of `abc` inside `UndefFunction.__new__`. So converting abstract functions works.\n\nThe problem is that now `F(x)._sage_()` will call the same `abc._sage_()` while previously it was referred to the superclass, i.e. `AppliedUndef._sage_()`. But `_sage_` as class method does not know about the specific instance and its argument `x`.",
    "created_at": "2017-10-17T15:15:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-293025",
    "user": "https://github.com/rwst"
}
```

<a id='comment:23'>**Comment 23:**</a>
To document what happens in SymPy:

When `F=Function('abc')` is called the constructor of `Function` uses the metaclass `UndefFunction` to create a new class with parent `AppliedUndef` named `abc`. Calling `F._sage_()` will NOT call the `_sage_()` member of `AppliedUndef` but tries to call `abc._sage_()` which does not exist at installation time. This, however, is not a problem because we can dynamically add a `_sage_()` method to `abc` on creation of `abc` inside `UndefFunction.__new__`. So converting abstract functions works.

The problem is that now `F(x)._sage_()` will call the same `abc._sage_()` while previously it was referred to the superclass, i.e. `AppliedUndef._sage_()`. But `_sage_` as class method does not know about the specific instance and its argument `x`.



---

archive/issue_comments_293026.json:
```json
{
    "body": "<a id='comment:24'>**Comment 24:**</a>\nFor the solution we will have to patch SymPy, not possible otherwise.",
    "created_at": "2017-10-17T15:59:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-293026",
    "user": "https://github.com/rwst"
}
```

<a id='comment:24'>**Comment 24:**</a>
For the solution we will have to patch SymPy, not possible otherwise.



---

archive/issue_comments_293027.json:
```json
{
    "body": "**Changing branch** from \"[u/mforets/20204](https://github.com/sagemath/sagetrac-mirror/tree/u/mforets/20204)\" to \"[u/rws/20204](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/20204)\".",
    "created_at": "2017-10-17T16:03:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-293027",
    "user": "https://github.com/rwst"
}
```

**Changing branch** from "[u/mforets/20204](https://github.com/sagemath/sagetrac-mirror/tree/u/mforets/20204)" to "[u/rws/20204](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/20204)".



---

archive/issue_comments_293028.json:
```json
{
    "body": "<a id='comment:26'>**Comment 26:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b261ec3e671179d04d1922d15d9116e4f6e1d47f\">b261ec3</a></td><td><code>23923: fix doctest</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5010acf00b2811420ba1a725deb2351f77eb0c01\">5010acf</a></td><td><code>Merge branch 'u/rws/23923' of git://trac.sagemath.org/sage into t/20204/20204</code></td></tr></table>\n",
    "created_at": "2017-10-17T16:11:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-293028",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:26'>**Comment 26:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b261ec3e671179d04d1922d15d9116e4f6e1d47f">b261ec3</a></td><td><code>23923: fix doctest</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5010acf00b2811420ba1a725deb2351f77eb0c01">5010acf</a></td><td><code>Merge branch 'u/rws/23923' of git://trac.sagemath.org/sage into t/20204/20204</code></td></tr></table>




---

archive/issue_comments_293029.json:
```json
{
    "body": "**Changing commit** from \"[c9db59735ba48630a2cecb38308ad33d6b707a04](https://github.com/sagemath/sagetrac-mirror/commit/c9db59735ba48630a2cecb38308ad33d6b707a04)\" to \"[5010acf00b2811420ba1a725deb2351f77eb0c01](https://github.com/sagemath/sagetrac-mirror/commit/5010acf00b2811420ba1a725deb2351f77eb0c01)\".",
    "created_at": "2017-10-17T16:11:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-293029",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[c9db59735ba48630a2cecb38308ad33d6b707a04](https://github.com/sagemath/sagetrac-mirror/commit/c9db59735ba48630a2cecb38308ad33d6b707a04)" to "[5010acf00b2811420ba1a725deb2351f77eb0c01](https://github.com/sagemath/sagetrac-mirror/commit/5010acf00b2811420ba1a725deb2351f77eb0c01)".



---

archive/issue_comments_293030.json:
```json
{
    "body": "**Changing dependencies** from \"#23496\" to \"#23496, #22566\".",
    "created_at": "2017-10-17T16:18:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-293030",
    "user": "https://github.com/rwst"
}
```

**Changing dependencies** from "#23496" to "#23496, #22566".



---

archive/issue_comments_293031.json:
```json
{
    "body": "<a id='comment:27'>**Comment 27:**</a>\nThe original examples all work now. I'll add them as doctests tomorrow.",
    "created_at": "2017-10-17T16:18:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-293031",
    "user": "https://github.com/rwst"
}
```

<a id='comment:27'>**Comment 27:**</a>
The original examples all work now. I'll add them as doctests tomorrow.



---

archive/issue_comments_293032.json:
```json
{
    "body": "**Changing author** from \"Marcelo Forets, Ralph Stephan\" to \"Marcelo Forets, Ralf Stephan\".",
    "created_at": "2017-10-17T16:18:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-293032",
    "user": "https://github.com/rwst"
}
```

**Changing author** from "Marcelo Forets, Ralph Stephan" to "Marcelo Forets, Ralf Stephan".



---

archive/issue_comments_293033.json:
```json
{
    "body": "<a id='comment:28'>**Comment 28:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/14b1c523c468bfb304191edfe6e85a5c94e916f5\">14b1c52</a></td><td><code>20204: more doctests</code></td></tr></table>\n",
    "created_at": "2017-10-18T06:53:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-293033",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:28'>**Comment 28:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/14b1c523c468bfb304191edfe6e85a5c94e916f5">14b1c52</a></td><td><code>20204: more doctests</code></td></tr></table>




---

archive/issue_comments_293034.json:
```json
{
    "body": "**Changing commit** from \"[5010acf00b2811420ba1a725deb2351f77eb0c01](https://github.com/sagemath/sagetrac-mirror/commit/5010acf00b2811420ba1a725deb2351f77eb0c01)\" to \"[14b1c523c468bfb304191edfe6e85a5c94e916f5](https://github.com/sagemath/sagetrac-mirror/commit/14b1c523c468bfb304191edfe6e85a5c94e916f5)\".",
    "created_at": "2017-10-18T06:53:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-293034",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[5010acf00b2811420ba1a725deb2351f77eb0c01](https://github.com/sagemath/sagetrac-mirror/commit/5010acf00b2811420ba1a725deb2351f77eb0c01)" to "[14b1c523c468bfb304191edfe6e85a5c94e916f5](https://github.com/sagemath/sagetrac-mirror/commit/14b1c523c468bfb304191edfe6e85a5c94e916f5)".



---

archive/issue_comments_293035.json:
```json
{
    "body": "<a id='comment:29'>**Comment 29:**</a>\nNext, we'll work on the SymPy update, based on this ticket.",
    "created_at": "2017-10-18T06:56:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-293035",
    "user": "https://github.com/rwst"
}
```

<a id='comment:29'>**Comment 29:**</a>
Next, we'll work on the SymPy update, based on this ticket.



---

archive/issue_events_246369.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-10-18T06:56:37Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "rename": {
        "from": "problems with constructing or converting to SymPy expressions",
        "to": "Fix problems with constructing or converting to SymPy expressions"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20204#event-246369"
}
```



---

archive/issue_events_246370.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-10-18T06:56:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20204#event-246370"
}
```



---

archive/issue_events_246371.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-10-18T06:56:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20204#event-246371"
}
```



---

archive/issue_comments_293036.json:
```json
{
    "body": "**Reviewer:** Marcelo Forets",
    "created_at": "2017-10-18T07:42:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-293036",
    "user": "https://github.com/mforets"
}
```

**Reviewer:** Marcelo Forets



---

archive/issue_comments_293037.json:
```json
{
    "body": "<a id='comment:31'>**Comment 31:**</a>\nlooks good to me. doctests in `src/sage/interfaces/sympy.py` pass and all (yes, all!) the issues in this ticket's description are solved. htmldoc is ok. let's wait that the patchbot changes the status..\n\nthe only oddity that i get (but maybe we shouldn't care?) is:\n\n```\nsage: from sympy import Function, Symbol\nsage: u = Function('u'); n = Symbol('n', integer=True)\nsage: type(u(2)+2)\n<class 'sympy.core.add.Add'>\nsage: type(2+u(2))\n<type 'sage.symbolic.expression.Expression'>\n```",
    "created_at": "2017-10-18T08:01:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-293037",
    "user": "https://github.com/mforets"
}
```

<a id='comment:31'>**Comment 31:**</a>
looks good to me. doctests in `src/sage/interfaces/sympy.py` pass and all (yes, all!) the issues in this ticket's description are solved. htmldoc is ok. let's wait that the patchbot changes the status..

the only oddity that i get (but maybe we shouldn't care?) is:

```
sage: from sympy import Function, Symbol
sage: u = Function('u'); n = Symbol('n', integer=True)
sage: type(u(2)+2)
<class 'sympy.core.add.Add'>
sage: type(2+u(2))
<type 'sage.symbolic.expression.Expression'>
```



---

archive/issue_comments_293038.json:
```json
{
    "body": "<a id='comment:32'>**Comment 32:**</a>\nI think there is nothing wrong. In the second case it's probably coercion that makes the choice, and it doesn't know that SymPy implements addition for their objects to use.\n\nAs to the patchbots they are unreliable at the moment. That segfault in matrix is curious but I can't reproduce it.",
    "created_at": "2017-10-18T15:35:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-293038",
    "user": "https://github.com/rwst"
}
```

<a id='comment:32'>**Comment 32:**</a>
I think there is nothing wrong. In the second case it's probably coercion that makes the choice, and it doesn't know that SymPy implements addition for their objects to use.

As to the patchbots they are unreliable at the moment. That segfault in matrix is curious but I can't reproduce it.



---

archive/issue_comments_293039.json:
```json
{
    "body": "<a id='comment:33'>**Comment 33:**</a>\n> I think there is nothing wrong. In the second case it's probably coercion that makes the choice, and it doesn't know that SymPy implements addition for their objects to use. \n\nOk.\n\nsince i cannot reproduce failures in my machine, let me set to positive review.. and thanks for fixing everything!!",
    "created_at": "2017-10-18T17:07:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-293039",
    "user": "https://github.com/mforets"
}
```

<a id='comment:33'>**Comment 33:**</a>
> I think there is nothing wrong. In the second case it's probably coercion that makes the choice, and it doesn't know that SymPy implements addition for their objects to use. 

Ok.

since i cannot reproduce failures in my machine, let me set to positive review.. and thanks for fixing everything!!



---

archive/issue_events_246372.json:
```json
{
    "actor": "https://github.com/mforets",
    "created_at": "2017-10-18T17:07:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20204#event-246372"
}
```



---

archive/issue_events_246373.json:
```json
{
    "actor": "https://github.com/mforets",
    "created_at": "2017-10-18T17:07:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20204#event-246373"
}
```



---

archive/issue_comments_293040.json:
```json
{
    "body": "<a id='comment:34'>**Comment 34:**</a>\nThanks for the review.",
    "created_at": "2017-10-19T05:50:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-293040",
    "user": "https://github.com/rwst"
}
```

<a id='comment:34'>**Comment 34:**</a>
Thanks for the review.



---

archive/issue_comments_293041.json:
```json
{
    "body": "<a id='comment:35'>**Comment 35:**</a>\n(Fixing formatting in ticket description.)",
    "created_at": "2017-10-29T00:29:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-293041",
    "user": "https://github.com/slel"
}
```

<a id='comment:35'>**Comment 35:**</a>
(Fixing formatting in ticket description.)



---

archive/issue_comments_293042.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,10 +1,10 @@\n In the Sympy-1.0 upgrade the `AppliedUndef._sage_` method is patched away to enable the important upgrade. This function was planned to resolve part of #14723 but uncovers problems with symbolics. The following doctest in french_book fails if `AppliedUndef._sage_` is defined:\n \n ```\n-  sage: from sympy import Function, Symbol\n-  sage: u = Function('u'); n = Symbol('n', integer=True)\n-  sage: f = u(n+2)-(3/2)*u(n+1)+(1/2)*u(n)\n-NotimplementedError\n+sage: from sympy import Function, Symbol\n+sage: u = Function('u'); n = Symbol('n', integer=True)\n+sage: f = u(n+2)-(3/2)*u(n+1)+(1/2)*u(n)\n+NotImplementedError\n ```\n \n tscrim found the minimal cases:\n``````\n",
    "created_at": "2017-10-29T00:29:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-293042",
    "user": "https://github.com/slel"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,10 +1,10 @@
 In the Sympy-1.0 upgrade the `AppliedUndef._sage_` method is patched away to enable the important upgrade. This function was planned to resolve part of #14723 but uncovers problems with symbolics. The following doctest in french_book fails if `AppliedUndef._sage_` is defined:
 
 ```
-  sage: from sympy import Function, Symbol
-  sage: u = Function('u'); n = Symbol('n', integer=True)
-  sage: f = u(n+2)-(3/2)*u(n+1)+(1/2)*u(n)
-NotimplementedError
+sage: from sympy import Function, Symbol
+sage: u = Function('u'); n = Symbol('n', integer=True)
+sage: f = u(n+2)-(3/2)*u(n+1)+(1/2)*u(n)
+NotImplementedError
 ```
 
 tscrim found the minimal cases:
``````




---

archive/issue_comments_293043.json:
```json
{
    "body": "<a id='comment:36'>**Comment 36:**</a>\nMerge conflict",
    "created_at": "2017-11-01T23:06:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-293043",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:36'>**Comment 36:**</a>
Merge conflict



---

archive/issue_events_246374.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-11-01T23:06:43Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20204#event-246374"
}
```



---

archive/issue_events_246375.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-11-01T23:06:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20204#event-246375"
}
```



---

archive/issue_comments_293044.json:
```json
{
    "body": "**Changing commit** from \"[14b1c523c468bfb304191edfe6e85a5c94e916f5](https://github.com/sagemath/sagetrac-mirror/commit/14b1c523c468bfb304191edfe6e85a5c94e916f5)\" to \"[fd0db783a1d0dfe70a5ca5272d762345376f0965](https://github.com/sagemath/sagetrac-mirror/commit/fd0db783a1d0dfe70a5ca5272d762345376f0965)\".",
    "created_at": "2017-11-02T06:50:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-293044",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[14b1c523c468bfb304191edfe6e85a5c94e916f5](https://github.com/sagemath/sagetrac-mirror/commit/14b1c523c468bfb304191edfe6e85a5c94e916f5)" to "[fd0db783a1d0dfe70a5ca5272d762345376f0965](https://github.com/sagemath/sagetrac-mirror/commit/fd0db783a1d0dfe70a5ca5272d762345376f0965)".



---

archive/issue_comments_293045.json:
```json
{
    "body": "<a id='comment:37'>**Comment 37:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9169924ca14501168066f1a2ed9d03bcc887db34\">9169924</a></td><td><code>Merge branch 'develop' into t/24006/24006</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d43419f73f455259896cbd9aeff86bbaa5d764c7\">d43419f</a></td><td><code>24006: bump sympy patchlevel</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fd0db783a1d0dfe70a5ca5272d762345376f0965\">fd0db78</a></td><td><code>Merge commit 'd43419f73f455259896cbd9aeff86bbaa5d764c7' of git://trac.sagemath.org/sage into t/20204/20204</code></td></tr></table>\n",
    "created_at": "2017-11-02T06:50:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-293045",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:37'>**Comment 37:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9169924ca14501168066f1a2ed9d03bcc887db34">9169924</a></td><td><code>Merge branch 'develop' into t/24006/24006</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d43419f73f455259896cbd9aeff86bbaa5d764c7">d43419f</a></td><td><code>24006: bump sympy patchlevel</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fd0db783a1d0dfe70a5ca5272d762345376f0965">fd0db78</a></td><td><code>Merge commit 'd43419f73f455259896cbd9aeff86bbaa5d764c7' of git://trac.sagemath.org/sage into t/20204/20204</code></td></tr></table>




---

archive/issue_comments_293046.json:
```json
{
    "body": "<a id='comment:38'>**Comment 38:**</a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9169924ca14501168066f1a2ed9d03bcc887db34\">9169924</a></td><td><code>Merge branch 'develop' into t/24006/24006</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d43419f73f455259896cbd9aeff86bbaa5d764c7\">d43419f</a></td><td><code>24006: bump sympy patchlevel</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fd0db783a1d0dfe70a5ca5272d762345376f0965\">fd0db78</a></td><td><code>Merge commit 'd43419f73f455259896cbd9aeff86bbaa5d764c7' of git://trac.sagemath.org/sage into t/20204/20204</code></td></tr></table>\n",
    "created_at": "2017-11-02T06:51:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-293046",
    "user": "https://github.com/rwst"
}
```

<a id='comment:38'>**Comment 38:**</a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9169924ca14501168066f1a2ed9d03bcc887db34">9169924</a></td><td><code>Merge branch 'develop' into t/24006/24006</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d43419f73f455259896cbd9aeff86bbaa5d764c7">d43419f</a></td><td><code>24006: bump sympy patchlevel</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fd0db783a1d0dfe70a5ca5272d762345376f0965">fd0db78</a></td><td><code>Merge commit 'd43419f73f455259896cbd9aeff86bbaa5d764c7' of git://trac.sagemath.org/sage into t/20204/20204</code></td></tr></table>




---

archive/issue_events_246376.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-11-02T06:51:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20204#event-246376"
}
```



---

archive/issue_events_246377.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-11-02T06:51:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20204#event-246377"
}
```



---

archive/issue_events_246378.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-11-04T23:24:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20204#event-246378"
}
```



---

archive/issue_events_246379.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "dc9be1b4243c6b70da301a5d74b3b2d6245e47e5",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2017-11-04T23:24:42Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20204#event-246379"
}
```



---

archive/issue_comments_293047.json:
```json
{
    "body": "**Changing branch** from \"[u/rws/20204](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/20204)\" to \"[fd0db783a1d0dfe70a5ca5272d762345376f0965](https://github.com/sagemath/sagetrac-mirror/commit/fd0db783a1d0dfe70a5ca5272d762345376f0965)\".",
    "created_at": "2017-11-04T23:24:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20204#issuecomment-293047",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/rws/20204](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/20204)" to "[fd0db783a1d0dfe70a5ca5272d762345376f0965](https://github.com/sagemath/sagetrac-mirror/commit/fd0db783a1d0dfe70a5ca5272d762345376f0965)".
