# Issue 20414: Add copy/__copy__ methods to CVXOPT, PPL, InteractiveLP backends, and __deepcopy__ to MixedIntegerLinearProgram and backends

archive/issues_020177.json:
```json
{
    "body": "The COIN, CPLEX, GLPK, and Gurobi backends supply a `copy` method. \nBut it's not documented as a backend interface method in `GenericBackend`, and the CVXOPT, PPL, InteractiveLP backends do not implement it. \nIt is used by `MixedIntegerLinearProgram.__copy__`.\n\nThe backend method should actually probably be called `__copy__` as well -- see https://docs.python.org/2/library/copy.html\n\nThe branch on the ticket does this.\n\nWe also add `__deepcopy__` methods to `MixedIntegerLinearProgram` and the backends. \nThis fixes #15159, though the semantics of `copy` and `deepcopy` of a `MixedIntegerLinearProgram` remains questionable due to its interaction with `MIPVariable`; see #15159 and #19523.\n\nSee also #20323 (in which copying a backend could be the basis for more diverse tests).\n\nCC:  @videlec @vbraun @dimpase\n\nKeywords: lp\n\nBranch/Commit: 3117b01e595febc8fc6de90eeb3cf19a7e97c7bd\n\nReviewer: Dima Pasechnik\n\nAuthor: Matthias Koeppe\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/20414\n\n",
    "closed_at": "2016-04-20T22:26:38Z",
    "created_at": "2016-04-11T01:37:33Z",
    "labels": [
        "component: numerical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.2",
    "title": "Add copy/__copy__ methods to CVXOPT, PPL, InteractiveLP backends, and __deepcopy__ to MixedIntegerLinearProgram and backends",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/20414",
    "user": "https://github.com/mkoeppe"
}
```
The COIN, CPLEX, GLPK, and Gurobi backends supply a `copy` method. 
But it's not documented as a backend interface method in `GenericBackend`, and the CVXOPT, PPL, InteractiveLP backends do not implement it. 
It is used by `MixedIntegerLinearProgram.__copy__`.

The backend method should actually probably be called `__copy__` as well -- see https://docs.python.org/2/library/copy.html

The branch on the ticket does this.

We also add `__deepcopy__` methods to `MixedIntegerLinearProgram` and the backends. 
This fixes #15159, though the semantics of `copy` and `deepcopy` of a `MixedIntegerLinearProgram` remains questionable due to its interaction with `MIPVariable`; see #15159 and #19523.

See also #20323 (in which copying a backend could be the basis for more diverse tests).

CC:  @videlec @vbraun @dimpase

Keywords: lp

Branch/Commit: 3117b01e595febc8fc6de90eeb3cf19a7e97c7bd

Reviewer: Dima Pasechnik

Author: Matthias Koeppe

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/20414





---

archive/issue_comments_296059.json:
```json
{
    "body": "<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2016-04-15T02:28:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20414#issuecomment-296059",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_296060.json:
```json
{
    "body": "<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-04-15T02:43:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20414#issuecomment-296060",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_296061.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-04-15T07:24:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20414#issuecomment-296061",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_296062.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-04-15T07:31:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20414#issuecomment-296062",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_296063.json:
```json
{
    "body": "<a id='comment:5'></a>The branch is on top of #20323 (Common `TestSuite` for MIP backends).\nThe `_test_copy_some_mips` method exposed a bug in `CoinBackend`, which I have fixed on the way.",
    "created_at": "2016-04-15T07:31:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20414#issuecomment-296063",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:5'></a>The branch is on top of #20323 (Common `TestSuite` for MIP backends).
The `_test_copy_some_mips` method exposed a bug in `CoinBackend`, which I have fixed on the way.



---

archive/issue_comments_296064.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-04-17T00:34:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20414#issuecomment-296064",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_296065.json:
```json
{
    "body": "<a id='comment:7'></a>Now also contains a fix for #15159 (see description). \nNeeds review.",
    "created_at": "2016-04-17T00:38:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20414#issuecomment-296065",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:7'></a>Now also contains a fix for #15159 (see description). 
Needs review.



---

archive/issue_comments_296066.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -4,7 +4,12 @@\n \n The backend method should actually probably be called `__copy__` as well -- see https://docs.python.org/2/library/copy.html\n \n-See also #15159 (which may indicate that we may need a `__deepcopy__` method as well) and #20323 (in which copying a backend could be the basis for more diverse tests)\n+The branch on the ticket does this.\n+\n+We also add `__deepcopy__` methods to `MixedIntegerLinearProgram` and the backends. \n+This fixes #15159, though the semantics of `copy` and `deepcopy` of a `MixedIntegerLinearProgram` remains questionable due to its interaction with `MIPVariable`; see #15159 and #19523.\n+\n+See also #20323 (in which copying a backend could be the basis for more diverse tests).\n \n Comment: 1\n \n```\n",
    "created_at": "2016-04-17T00:38:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20414#issuecomment-296066",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -4,7 +4,12 @@
 
 The backend method should actually probably be called `__copy__` as well -- see https://docs.python.org/2/library/copy.html
 
-See also #15159 (which may indicate that we may need a `__deepcopy__` method as well) and #20323 (in which copying a backend could be the basis for more diverse tests)
+The branch on the ticket does this.
+
+We also add `__deepcopy__` methods to `MixedIntegerLinearProgram` and the backends. 
+This fixes #15159, though the semantics of `copy` and `deepcopy` of a `MixedIntegerLinearProgram` remains questionable due to its interaction with `MIPVariable`; see #15159 and #19523.
+
+See also #20323 (in which copying a backend could be the basis for more diverse tests).
 
 Comment: 1
 
```




---

archive/issue_comments_296067.json:
```json
{
    "body": "<a id='comment:10'></a>How reliable is `__deepcopy__` here? Is it just working now?",
    "created_at": "2016-04-18T11:37:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20414#issuecomment-296067",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:10'></a>How reliable is `__deepcopy__` here? Is it just working now?



---

archive/issue_comments_296068.json:
```json
{
    "body": "<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-04-18T18:49:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20414#issuecomment-296068",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_296069.json:
```json
{
    "body": "<a id='comment:12'></a>Replying to [comment:10 dimpase]:\n> How reliable is `__deepcopy__` here? Is it just working now?\n\n\nIt's working. I've added another test to illustrate deepcopy semantics.",
    "created_at": "2016-04-18T18:50:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20414#issuecomment-296069",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:12'></a>Replying to [comment:10 dimpase]:
> How reliable is `__deepcopy__` here? Is it just working now?


It's working. I've added another test to illustrate deepcopy semantics.



---

archive/issue_comments_296070.json:
```json
{
    "body": "<a id='comment:13'></a>Replying to [comment:12 mkoeppe]:\n> Replying to [comment:10 dimpase]:\n> > How reliable is `__deepcopy__` here? Is it just working now?\n\n> \n> It's working. I've added another test to illustrate deepcopy semantics.\n\n\nwas there something about variables that are (not) copied?",
    "created_at": "2016-04-18T19:08:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20414#issuecomment-296070",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:13'></a>Replying to [comment:12 mkoeppe]:
> Replying to [comment:10 dimpase]:
> > How reliable is `__deepcopy__` here? Is it just working now?

> 
> It's working. I've added another test to illustrate deepcopy semantics.


was there something about variables that are (not) copied?



---

archive/issue_comments_296071.json:
```json
{
    "body": "<a id='comment:14'></a>Replying to [comment:13 dimpase]:\n> was there something about variables that are (not) copied?\n\n\nBefore this patch, deepcopy didn't even copy the backend of a MIP. \nNow it does, simply by doing the same as copy.\n\nBoth copy and deepcopy have weird semantics in relation to the MIPVariables in a problems -- because a MIP does not have an API to gain access to its variables; and trying to use the old MIPVariables with the copy is questionable and definitely broken if one creates new components of this variable, see #15159, #19523. Fixing this would require a redesign; a possible stopgap would be to stop all MIPVariables from creating new components when they have been subjected to copy().",
    "created_at": "2016-04-18T19:25:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20414#issuecomment-296071",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:14'></a>Replying to [comment:13 dimpase]:
> was there something about variables that are (not) copied?


Before this patch, deepcopy didn't even copy the backend of a MIP. 
Now it does, simply by doing the same as copy.

Both copy and deepcopy have weird semantics in relation to the MIPVariables in a problems -- because a MIP does not have an API to gain access to its variables; and trying to use the old MIPVariables with the copy is questionable and definitely broken if one creates new components of this variable, see #15159, #19523. Fixing this would require a redesign; a possible stopgap would be to stop all MIPVariables from creating new components when they have been subjected to copy().



---

archive/issue_comments_296072.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-04-18T21:27:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20414#issuecomment-296072",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_296073.json:
```json
{
    "body": "<a id='comment:15'></a>ok, fine.",
    "created_at": "2016-04-18T21:27:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20414#issuecomment-296073",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:15'></a>ok, fine.



---

archive/issue_comments_296074.json:
```json
{
    "body": "<a id='comment:16'></a>Replying to [comment:15 dimpase]:\n> ok, fine.\n\n\nThanks for reviewing.\n\nI've created a new ticket, #20461, for solving the issue with the variables of a copied MIP. Please take a look when you have a chance.",
    "created_at": "2016-04-19T04:12:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20414#issuecomment-296074",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:16'></a>Replying to [comment:15 dimpase]:
> ok, fine.


Thanks for reviewing.

I've created a new ticket, #20461, for solving the issue with the variables of a copied MIP. Please take a look when you have a chance.



---

archive/issue_comments_296075.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-04-20T22:26:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20414",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20414#issuecomment-296075",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_055264.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-04-20T22:26:38Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/20414",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20414#event-55264"
}
```
