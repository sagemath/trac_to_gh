# Issue 20802: Restore Python 2.6+ compatibility

archive/issues_020565.json:
```json
{
    "body": "As of Sage 7.3.beta6, building Sage requires a system Python >= 2.7 because `sage-uncompress-spkg` uses `argparse`.\n\nWhile we already ship a copy of `argparse.py`, `sage-uncompress-spkg` currently doesn't try to import it from where it's located in the Sage tree.\n\n\n**CC:**  @dimpase @embray @jdemeyer\n\n**Keywords:** argparse sage-uncompress-spkg\n\n**Branch/Commit:** [775a3d3e160388b6d5b21b0a38e0ec2b3d247ef0](https://github.com/sagemath/sagetrac-mirror/commit/775a3d3e160388b6d5b21b0a38e0ec2b3d247ef0)\n\n**Reviewer:** Erik Bray, Leif Leonhardy, Dima Pasechnik\n\n**Author:** Volker Braun\n\n**Dependencies:** #19984, #20871\n\n**Resolution:** fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/20802\n\n",
    "closed_at": "2016-07-27T20:24:40Z",
    "created_at": "2016-06-10T18:18:39Z",
    "labels": [
        "component: build",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.3",
    "title": "Restore Python 2.6+ compatibility",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/20802",
    "user": "https://github.com/vbraun"
}
```
As of Sage 7.3.beta6, building Sage requires a system Python >= 2.7 because `sage-uncompress-spkg` uses `argparse`.

While we already ship a copy of `argparse.py`, `sage-uncompress-spkg` currently doesn't try to import it from where it's located in the Sage tree.


**CC:**  @dimpase @embray @jdemeyer

**Keywords:** argparse sage-uncompress-spkg

**Branch/Commit:** [775a3d3e160388b6d5b21b0a38e0ec2b3d247ef0](https://github.com/sagemath/sagetrac-mirror/commit/775a3d3e160388b6d5b21b0a38e0ec2b3d247ef0)

**Reviewer:** Erik Bray, Leif Leonhardy, Dima Pasechnik

**Author:** Volker Braun

**Dependencies:** #19984, #20871

**Resolution:** fixed

Issue created by migration from https://trac.sagemath.org/ticket/20802





---

archive/issue_comments_382433.json:
```json
{
    "body": "**Branch:** [u/vbraun/sage_requires_python_2_7_](https://github.com/sagemath/sagetrac-mirror/tree/u/vbraun/sage_requires_python_2_7_)",
    "created_at": "2016-06-10T18:24:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20802#issuecomment-382433",
    "user": "https://github.com/vbraun"
}
```

**Branch:** [u/vbraun/sage_requires_python_2_7_](https://github.com/sagemath/sagetrac-mirror/tree/u/vbraun/sage_requires_python_2_7_)



---

archive/issue_comments_382434.json:
```json
{
    "body": "<a id='comment:2'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c323a93bd31fa80fba6f7c9c9aa9626499840731\">c323a93</a></td><td><code>Sage requires Python 2.7+</code></td></tr></table>\n",
    "created_at": "2016-06-10T18:25:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20802#issuecomment-382434",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:2'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c323a93bd31fa80fba6f7c9c9aa9626499840731">c323a93</a></td><td><code>Sage requires Python 2.7+</code></td></tr></table>




---

archive/issue_comments_382435.json:
```json
{
    "body": "**Commit:** [c323a93bd31fa80fba6f7c9c9aa9626499840731](https://github.com/sagemath/sagetrac-mirror/commit/c323a93bd31fa80fba6f7c9c9aa9626499840731)",
    "created_at": "2016-06-10T18:25:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20802#issuecomment-382435",
    "user": "https://github.com/vbraun"
}
```

**Commit:** [c323a93bd31fa80fba6f7c9c9aa9626499840731](https://github.com/sagemath/sagetrac-mirror/commit/c323a93bd31fa80fba6f7c9c9aa9626499840731)



---

archive/issue_comments_382436.json:
```json
{
    "body": "**Author:** Volker Braun",
    "created_at": "2016-06-10T18:25:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20802#issuecomment-382436",
    "user": "https://github.com/vbraun"
}
```

**Author:** Volker Braun



---

archive/issue_events_063478.json:
```json
{
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/20802",
    "label": "component: documentation",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20802#event-63478"
}
```



---

archive/issue_comments_382437.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2016-06-10T18:25:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20802#issuecomment-382437",
    "user": "https://github.com/vbraun"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_382438.json:
```json
{
    "body": "<a id='comment:3'></a>\nJust a few months ago, people were complaining about a change (fixed in #20252) which prevented Sage from building with Python 2.6. So I think this is a dangerous change to implement: we will lose some of our user base. See [discussion in sage-devel](https://groups.google.com/d/msg/sage-devel/1hbXSJFWDZw/NNP9L2V9DQAJ). What is the motivation?",
    "created_at": "2016-06-10T18:44:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20802#issuecomment-382438",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:3'></a>
Just a few months ago, people were complaining about a change (fixed in #20252) which prevented Sage from building with Python 2.6. So I think this is a dangerous change to implement: we will lose some of our user base. See [discussion in sage-devel](https://groups.google.com/d/msg/sage-devel/1hbXSJFWDZw/NNP9L2V9DQAJ). What is the motivation?



---

archive/issue_comments_382439.json:
```json
{
    "body": "<a id='comment:4'></a>\nThe fix has been broken in #20721\n\nI've advocated bundling argparse (which is imho a no-brainer) but the 0.1% size increase was deemed unacceptable in #19984.",
    "created_at": "2016-06-10T18:49:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20802#issuecomment-382439",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:4'></a>
The fix has been broken in #20721

I've advocated bundling argparse (which is imho a no-brainer) but the 0.1% size increase was deemed unacceptable in #19984.



---

archive/issue_comments_382440.json:
```json
{
    "body": "<a id='comment:5'></a>\nIs use of argparse the only thing that currently breaks compatibility for Python 2.6?  If so I think bundling it is a no-brainer--I've done it in a dozen other projects (though most projects are finally droppping support for Python 2.6).\n\nThat said we either support Python 2.6 or we don't.  If Sage isn't tested against Python 2.6 it doesn't support it as far as anyone should be concerned.  Same goes for any other Python version.  If it's not tested it's not supported.",
    "created_at": "2016-06-13T08:11:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20802#issuecomment-382440",
    "user": "https://github.com/embray"
}
```

<a id='comment:5'></a>
Is use of argparse the only thing that currently breaks compatibility for Python 2.6?  If so I think bundling it is a no-brainer--I've done it in a dozen other projects (though most projects are finally droppping support for Python 2.6).

That said we either support Python 2.6 or we don't.  If Sage isn't tested against Python 2.6 it doesn't support it as far as anyone should be concerned.  Same goes for any other Python version.  If it's not tested it's not supported.



---

archive/issue_comments_382441.json:
```json
{
    "body": "<a id='comment:6'></a>\nReplying to [embray](#comment%3A5):\n> Is use of argparse the only thing that currently breaks compatibility for Python 2.6?  If so I think bundling it is a no-brainer--I've done it in a dozen other projects (though most projects are finally droppping support for Python 2.6).\n> \n> That said we either support Python 2.6 or we don't.  If Sage isn't tested against Python 2.6 it doesn't support it as far as anyone should be concerned.  Same goes for any other Python version.  If it's not tested it's not supported.\n\n\nthere is demand for Python 2.6 support. It should be easy to set up a VM with one of these LTS Linux systems which are using 2.6 as the default. The question is who will do this, and on what system. There is spare capacity on the UW cluster, I think, to do this.",
    "created_at": "2016-06-13T08:20:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20802#issuecomment-382441",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:6'></a>
Replying to [embray](#comment%3A5):
> Is use of argparse the only thing that currently breaks compatibility for Python 2.6?  If so I think bundling it is a no-brainer--I've done it in a dozen other projects (though most projects are finally droppping support for Python 2.6).
> 
> That said we either support Python 2.6 or we don't.  If Sage isn't tested against Python 2.6 it doesn't support it as far as anyone should be concerned.  Same goes for any other Python version.  If it's not tested it's not supported.


there is demand for Python 2.6 support. It should be easy to set up a VM with one of these LTS Linux systems which are using 2.6 as the default. The question is who will do this, and on what system. There is spare capacity on the UW cluster, I think, to do this.



---

archive/issue_comments_382442.json:
```json
{
    "body": "<a id='comment:7'></a>\nSo, what should be done to reenable 2.6?",
    "created_at": "2016-06-13T08:22:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20802#issuecomment-382442",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:7'></a>
So, what should be done to reenable 2.6?



---

archive/issue_comments_382443.json:
```json
{
    "body": "<a id='comment:8'></a>\nI guess also I was confused about using Python as a build dependency versus as a runtime dependency.  As a runtime dependency only Python 2.7 is supported I guess.  But for the build tools 2.6+ makes sense (but should be tested if we're to claim to support it).",
    "created_at": "2016-06-13T08:23:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20802#issuecomment-382443",
    "user": "https://github.com/embray"
}
```

<a id='comment:8'></a>
I guess also I was confused about using Python as a build dependency versus as a runtime dependency.  As a runtime dependency only Python 2.7 is supported I guess.  But for the build tools 2.6+ makes sense (but should be tested if we're to claim to support it).



---

archive/issue_comments_382444.json:
```json
{
    "body": "**Changing commit** from \"[c323a93bd31fa80fba6f7c9c9aa9626499840731](https://github.com/sagemath/sagetrac-mirror/commit/c323a93bd31fa80fba6f7c9c9aa9626499840731)\" to \"\".",
    "created_at": "2016-06-13T16:14:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20802#issuecomment-382444",
    "user": "https://github.com/vbraun"
}
```

**Changing commit** from "[c323a93bd31fa80fba6f7c9c9aa9626499840731](https://github.com/sagemath/sagetrac-mirror/commit/c323a93bd31fa80fba6f7c9c9aa9626499840731)" to "".



---

archive/issue_comments_382445.json:
```json
{
    "body": "**Dependencies:** #19984",
    "created_at": "2016-06-13T16:14:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20802#issuecomment-382445",
    "user": "https://github.com/vbraun"
}
```

**Dependencies:** #19984



---

archive/issue_comments_382446.json:
```json
{
    "body": "**Changing branch** from \"[u/vbraun/sage_requires_python_2_7_](https://github.com/sagemath/sagetrac-mirror/tree/u/vbraun/sage_requires_python_2_7_)\" to \"\".",
    "created_at": "2016-06-13T16:14:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20802#issuecomment-382446",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/vbraun/sage_requires_python_2_7_](https://github.com/sagemath/sagetrac-mirror/tree/u/vbraun/sage_requires_python_2_7_)" to "".



---

archive/issue_comments_382447.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2016-06-13T16:14:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20802#issuecomment-382447",
    "user": "https://github.com/vbraun"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_events_063479.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/20802",
    "rename": {
        "from": "Sage requires Python 2.7+",
        "to": "Restore Python 2.6+ compatibility"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20802#event-63479"
}
```



---

archive/issue_comments_382448.json:
```json
{
    "body": "<a id='comment:10'></a>\nThere is testing via tox for multiple Python versions. Though you need to write tests, obviously. Its not currently tested on the buildbot, thats a todo for the buildbot configuration.",
    "created_at": "2016-06-13T16:16:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20802#issuecomment-382448",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:10'></a>
There is testing via tox for multiple Python versions. Though you need to write tests, obviously. Its not currently tested on the buildbot, thats a todo for the buildbot configuration.



---

archive/issue_comments_382449.json:
```json
{
    "body": "<a id='comment:11'></a>\nI'm still a little confused here.  What specifically is being tested via tox is there are no tests (and what are we talking about tests *for*)?  \n\nFor example, what command(s) are being run by tox?  Who's running tox, if not the build bot?",
    "created_at": "2016-06-14T08:32:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20802#issuecomment-382449",
    "user": "https://github.com/embray"
}
```

<a id='comment:11'></a>
I'm still a little confused here.  What specifically is being tested via tox is there are no tests (and what are we talking about tests *for*)?  

For example, what command(s) are being run by tox?  Who's running tox, if not the build bot?



---

archive/issue_comments_382450.json:
```json
{
    "body": "<a id='comment:12'></a>\nI don't understand what you mean; Tests are in `build/tests` and you can run them right now via `cd build && tox`. Developers are supposed to run the tests before making commits, not just the buildbot ;-)",
    "created_at": "2016-06-14T16:12:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20802#issuecomment-382450",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:12'></a>
I don't understand what you mean; Tests are in `build/tests` and you can run them right now via `cd build && tox`. Developers are supposed to run the tests before making commits, not just the buildbot ;-)



---

archive/issue_comments_382451.json:
```json
{
    "body": "<a id='comment:13'></a>\nAh, I think that's relatively new.  Wasn't there a few days ago.",
    "created_at": "2016-06-15T08:25:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20802#issuecomment-382451",
    "user": "https://github.com/embray"
}
```

<a id='comment:13'></a>
Ah, I think that's relatively new.  Wasn't there a few days ago.



---

archive/issue_comments_382452.json:
```json
{
    "body": "<a id='comment:14'></a>\nPing.\n\nDo we need more than, say\n\n```diff\ndiff --git a/build/bin/sage-uncompress-spkg b/build/bin/sage-uncompress-spkg\nindex 9b72878..e7339ad 100755\n--- a/build/bin/sage-uncompress-spkg\n+++ b/build/bin/sage-uncompress-spkg\n@@ -28,10 +28,22 @@ printing the SPKG.txt file from an old-style spkg.)\n \n from __future__ import print_function\n \n-import argparse\n-import copy\n import os\n import sys\n+try:\n+    import argparse\n+except ImportError:\n+    # Python 2.6 doesn't have it\n+    SAGE_ROOT = os.environ.get(\"SAGE_ROOT\")\n+    if not SAGE_ROOT:\n+        sys.stderr.write(\n+            \"Error: SAGE_ROOT not set, needed to import Sage's argparse module.\\n\")\n+        sys.exit(1)\n+    sys.path.append(os.path.join(SAGE_ROOT, \"build\", \"sage_bootstrap\", \"compat\"))\n+    # we could also first check the presence of Sage's argparse.py here\n+    import argparse\n+    # bail out if that also fails (or suggest something else?)\n+import copy\n import tarfile\n import zipfile\n \n```\n?",
    "created_at": "2016-07-01T16:14:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20802#issuecomment-382452",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:14'></a>
Ping.

Do we need more than, say

```diff
diff --git a/build/bin/sage-uncompress-spkg b/build/bin/sage-uncompress-spkg
index 9b72878..e7339ad 100755
--- a/build/bin/sage-uncompress-spkg
+++ b/build/bin/sage-uncompress-spkg
@@ -28,10 +28,22 @@ printing the SPKG.txt file from an old-style spkg.)
 
 from __future__ import print_function
 
-import argparse
-import copy
 import os
 import sys
+try:
+    import argparse
+except ImportError:
+    # Python 2.6 doesn't have it
+    SAGE_ROOT = os.environ.get("SAGE_ROOT")
+    if not SAGE_ROOT:
+        sys.stderr.write(
+            "Error: SAGE_ROOT not set, needed to import Sage's argparse module.\n")
+        sys.exit(1)
+    sys.path.append(os.path.join(SAGE_ROOT, "build", "sage_bootstrap", "compat"))
+    # we could also first check the presence of Sage's argparse.py here
+    import argparse
+    # bail out if that also fails (or suggest something else?)
+import copy
 import tarfile
 import zipfile
 
```
?



---

archive/issue_events_063480.json:
```json
{
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/20802",
    "label": "component: documentation",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20802#event-63480"
}
```



---

archive/issue_comments_382453.json:
```json
{
    "body": "<a id='comment:16'></a>\nIf it's too much trouble, I can also just change this script to use `optparse` instead of `argparse`.  I don't think there's really any `argparse`-specific features that it's strongly relying on.",
    "created_at": "2016-07-04T10:11:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20802#issuecomment-382453",
    "user": "https://github.com/embray"
}
```

<a id='comment:16'></a>
If it's too much trouble, I can also just change this script to use `optparse` instead of `argparse`.  I don't think there's really any `argparse`-specific features that it's strongly relying on.



---

archive/issue_comments_382454.json:
```json
{
    "body": "<a id='comment:17'></a>\nReplying to [embray](#comment%3A16):\n> If it's too much trouble, I can also just change this script to use `optparse` instead of `argparse`.  I don't think there's really any `argparse`-specific features that it's strongly relying on.\n\n\nI rather meant to ask whether it's only the above little change we need, but I've meanwhile built Sage 7.3.beta6 from scratch with that on a system with just Python 2.6, which worked without any issues.  (`argparse.py` already gets shipped in `build/sage_bootstrap/compat/` anyway.)\n\nSo now the question is whether I should put a branch *here* or open a separate ticket specifically for `sage-uncompress-spkg` as the ticket's title sounds pretty generic (as if it was meant to be a meta-ticket).",
    "created_at": "2016-07-04T12:06:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20802#issuecomment-382454",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:17'></a>
Replying to [embray](#comment%3A16):
> If it's too much trouble, I can also just change this script to use `optparse` instead of `argparse`.  I don't think there's really any `argparse`-specific features that it's strongly relying on.


I rather meant to ask whether it's only the above little change we need, but I've meanwhile built Sage 7.3.beta6 from scratch with that on a system with just Python 2.6, which worked without any issues.  (`argparse.py` already gets shipped in `build/sage_bootstrap/compat/` anyway.)

So now the question is whether I should put a branch *here* or open a separate ticket specifically for `sage-uncompress-spkg` as the ticket's title sounds pretty generic (as if it was meant to be a meta-ticket).



---

archive/issue_comments_382455.json:
```json
{
    "body": "**Changing status** from needs_work to needs_info.",
    "created_at": "2016-07-04T12:06:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20802#issuecomment-382455",
    "user": "https://github.com/nexttime"
}
```

**Changing status** from needs_work to needs_info.



---

archive/issue_comments_382456.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1,4 @@\n+As of Sage 7.3.beta6, building Sage requires a system Python >= 2.7 because `sage-uncompress-spkg` uses `argparse`.\n \n+While we already ship a copy of `argparse.py`, `sage-uncompress-spkg` currently doesn't try to import it from where it's located in the Sage tree.\n+\n``````\n",
    "created_at": "2016-07-04T12:06:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20802#issuecomment-382456",
    "user": "https://github.com/nexttime"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1,4 @@
+As of Sage 7.3.beta6, building Sage requires a system Python >= 2.7 because `sage-uncompress-spkg` uses `argparse`.
 
+While we already ship a copy of `argparse.py`, `sage-uncompress-spkg` currently doesn't try to import it from where it's located in the Sage tree.
+
``````




---

archive/issue_comments_382457.json:
```json
{
    "body": "**Changing author** from \"Volker Braun\" to \"\".",
    "created_at": "2016-07-04T12:06:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20802#issuecomment-382457",
    "user": "https://github.com/nexttime"
}
```

**Changing author** from "Volker Braun" to "".



---

archive/issue_comments_382458.json:
```json
{
    "body": "**Changing keywords** from \"\" to \"argparse sage-uncompress-spkg\".",
    "created_at": "2016-07-04T12:06:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20802#issuecomment-382458",
    "user": "https://github.com/nexttime"
}
```

**Changing keywords** from "" to "argparse sage-uncompress-spkg".



---

archive/issue_comments_382459.json:
```json
{
    "body": "<a id='comment:18'></a>\nAs long as `sage-uncompress-spkg` is not **needed** to install things into `build/sage_bootstrap/compat/`, this looks good.",
    "created_at": "2016-07-04T12:11:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20802#issuecomment-382459",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:18'></a>
As long as `sage-uncompress-spkg` is not **needed** to install things into `build/sage_bootstrap/compat/`, this looks good.



---

archive/issue_comments_382460.json:
```json
{
    "body": "<a id='comment:19'></a>\nJust import from `sage_bootstrap.compat.argparse`",
    "created_at": "2016-07-04T12:42:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20802#issuecomment-382460",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:19'></a>
Just import from `sage_bootstrap.compat.argparse`



---

archive/issue_comments_382461.json:
```json
{
    "body": "<a id='comment:20'></a>\nReplying to [vbraun](#comment%3A19):\n> Just import from `sage_bootstrap.compat.argparse`\n\n\nYou mean unconditionally?",
    "created_at": "2016-07-04T13:01:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20802#issuecomment-382461",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:20'></a>
Replying to [vbraun](#comment%3A19):
> Just import from `sage_bootstrap.compat.argparse`


You mean unconditionally?



---

archive/issue_comments_382462.json:
```json
{
    "body": "<a id='comment:21'></a>\nReplying to [leif](#comment%3A20):\n> Replying to [vbraun](#comment%3A19):\n> > Just import from `sage_bootstrap.compat.argparse`\n\n> \n> You mean unconditionally?\n> \n\nWell, why? The difference is that, AFAII, `bootstrap.compat.argparse` exists, while `build/sage_bootstrap/compat/` might not (yet).",
    "created_at": "2016-07-04T13:07:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20802#issuecomment-382462",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:21'></a>
Replying to [leif](#comment%3A20):
> Replying to [vbraun](#comment%3A19):
> > Just import from `sage_bootstrap.compat.argparse`

> 
> You mean unconditionally?
> 

Well, why? The difference is that, AFAII, `bootstrap.compat.argparse` exists, while `build/sage_bootstrap/compat/` might not (yet).



---

archive/issue_comments_382463.json:
```json
{
    "body": "<a id='comment:22'></a>\n`build/sage_bootstrap/compat` is checked into the Sage repo so it will exist as long as you have the source code.",
    "created_at": "2016-07-04T13:13:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20802#issuecomment-382463",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:22'></a>
`build/sage_bootstrap/compat` is checked into the Sage repo so it will exist as long as you have the source code.



---

archive/issue_comments_382464.json:
```json
{
    "body": "<a id='comment:23'></a>\nI think it would still be better to try to import the existing package first, and fall back on the compat version shipped with sage otherwise.",
    "created_at": "2016-07-04T14:01:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20802#issuecomment-382464",
    "user": "https://github.com/embray"
}
```

<a id='comment:23'></a>
I think it would still be better to try to import the existing package first, and fall back on the compat version shipped with sage otherwise.



---

archive/issue_comments_382465.json:
```json
{
    "body": "<a id='comment:24'></a>\n#20871 (merged in 7.3.beta7) added a new import to `sage-uncompress-spkg`...",
    "created_at": "2016-07-09T14:53:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20802#issuecomment-382465",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:24'></a>
#20871 (merged in 7.3.beta7) added a new import to `sage-uncompress-spkg`...



---

archive/issue_comments_382466.json:
```json
{
    "body": "**Changing dependencies** from \"#19984\" to \"#19984, #20871\".",
    "created_at": "2016-07-09T14:53:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20802#issuecomment-382466",
    "user": "https://github.com/nexttime"
}
```

**Changing dependencies** from "#19984" to "#19984, #20871".



---

archive/issue_comments_382467.json:
```json
{
    "body": "<a id='comment:25'></a>\nReplying to [leif](#comment%3A24):\n> #20871 (merged in 7.3.beta7) added a new import to `sage-uncompress-spkg`...\n\n\nOnly the `stat` module, for two constants, both of which are the same in Python 2.6.",
    "created_at": "2016-07-11T11:22:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20802#issuecomment-382467",
    "user": "https://github.com/embray"
}
```

<a id='comment:25'></a>
Replying to [leif](#comment%3A24):
> #20871 (merged in 7.3.beta7) added a new import to `sage-uncompress-spkg`...


Only the `stat` module, for two constants, both of which are the same in Python 2.6.



---

archive/issue_comments_382468.json:
```json
{
    "body": "<a id='comment:26'></a>\nReplying to [embray](#comment%3A25):\n> Replying to [leif](#comment%3A24):\n> > #20871 (merged in 7.3.beta7) added a new import to `sage-uncompress-spkg`...\n\n> \n> Only the `stat` module, for two constants, both of which are the same in Python 2.6.  \n\n\nYep, but that broke the patch because a change happened within its context.  (While there's no branch here yet anyway, it'll have to depend on #20871 now).",
    "created_at": "2016-07-11T12:04:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20802#issuecomment-382468",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:26'></a>
Replying to [embray](#comment%3A25):
> Replying to [leif](#comment%3A24):
> > #20871 (merged in 7.3.beta7) added a new import to `sage-uncompress-spkg`...

> 
> Only the `stat` module, for two constants, both of which are the same in Python 2.6.  


Yep, but that broke the patch because a change happened within its context.  (While there's no branch here yet anyway, it'll have to depend on #20871 now).



---

archive/issue_comments_382469.json:
```json
{
    "body": "<a id='comment:27'></a>\nReplying to [embray](#comment%3A23):\n> I think it would still be better to try to import the existing package first, and fall back on the compat version shipped with sage otherwise.\n\n\nGenerally, I don't like the philosophy of \"try A and if that didn't work, use B instead\". It means two different scenarios which can break. If B is always available and it works, why bother with trying A first?",
    "created_at": "2016-07-11T23:49:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20802#issuecomment-382469",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:27'></a>
Replying to [embray](#comment%3A23):
> I think it would still be better to try to import the existing package first, and fall back on the compat version shipped with sage otherwise.


Generally, I don't like the philosophy of "try A and if that didn't work, use B instead". It means two different scenarios which can break. If B is always available and it works, why bother with trying A first?



---

archive/issue_comments_382470.json:
```json
{
    "body": "<a id='comment:28'></a>\nThats the standard pattern for vendoring python libraries, I don't think its particularly fruitful to discuss it here.",
    "created_at": "2016-07-12T07:29:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20802#issuecomment-382470",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:28'></a>
Thats the standard pattern for vendoring python libraries, I don't think its particularly fruitful to discuss it here.



---

archive/issue_comments_382471.json:
```json
{
    "body": "<a id='comment:29'></a>\nReplying to [vbraun](#comment%3A28):\n> Thats the standard pattern for vendoring python libraries, I don't think its particularly fruitful to discuss it here.\n\n\n+1",
    "created_at": "2016-07-12T08:01:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20802#issuecomment-382471",
    "user": "https://github.com/embray"
}
```

<a id='comment:29'></a>
Replying to [vbraun](#comment%3A28):
> Thats the standard pattern for vendoring python libraries, I don't think its particularly fruitful to discuss it here.


+1



---

archive/issue_comments_382472.json:
```json
{
    "body": "**Branch:** [u/vbraun/restore_python_2_6__compatibility](https://github.com/sagemath/sagetrac-mirror/tree/u/vbraun/restore_python_2_6__compatibility)",
    "created_at": "2016-07-23T23:03:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20802#issuecomment-382472",
    "user": "https://github.com/vbraun"
}
```

**Branch:** [u/vbraun/restore_python_2_6__compatibility](https://github.com/sagemath/sagetrac-mirror/tree/u/vbraun/restore_python_2_6__compatibility)



---

archive/issue_comments_382473.json:
```json
{
    "body": "**Author:** Volker Braun",
    "created_at": "2016-07-23T23:03:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20802#issuecomment-382473",
    "user": "https://github.com/vbraun"
}
```

**Author:** Volker Braun



---

archive/issue_comments_382474.json:
```json
{
    "body": "<a id='comment:31'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/775a3d3e160388b6d5b21b0a38e0ec2b3d247ef0\">775a3d3</a></td><td><code>Refactor sage-uncompress-spkg, add tests</code></td></tr></table>\n",
    "created_at": "2016-07-23T23:03:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20802#issuecomment-382474",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:31'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/775a3d3e160388b6d5b21b0a38e0ec2b3d247ef0">775a3d3</a></td><td><code>Refactor sage-uncompress-spkg, add tests</code></td></tr></table>




---

archive/issue_comments_382475.json:
```json
{
    "body": "**Commit:** [775a3d3e160388b6d5b21b0a38e0ec2b3d247ef0](https://github.com/sagemath/sagetrac-mirror/commit/775a3d3e160388b6d5b21b0a38e0ec2b3d247ef0)",
    "created_at": "2016-07-23T23:03:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20802#issuecomment-382475",
    "user": "https://github.com/vbraun"
}
```

**Commit:** [775a3d3e160388b6d5b21b0a38e0ec2b3d247ef0](https://github.com/sagemath/sagetrac-mirror/commit/775a3d3e160388b6d5b21b0a38e0ec2b3d247ef0)



---

archive/issue_comments_382476.json:
```json
{
    "body": "**Changing status** from needs_info to needs_review.",
    "created_at": "2016-07-23T23:03:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20802#issuecomment-382476",
    "user": "https://github.com/vbraun"
}
```

**Changing status** from needs_info to needs_review.



---

archive/issue_comments_382477.json:
```json
{
    "body": "<a id='comment:32'></a>\nFWIW, I intentionally did *not* import the whole `sage_bootstrap` package just because `sage-uncompress-spkg` in case of Python 2.6 needs the `argparse` module (and only that) from `.../compat/` in my patch.\n\n---\n\nCould you add a `.contains_garbage()` property in order to not pass the whole list of all files in a tarball to `.extractall()` if it returns `False` (which is the normal case -- it should IMHO error out unless given some option to override that otherwise, or *at least* give a warning).\n\nAs is, it essentially does\n\n```sh\ntar xf $TARBALL $( tar tf $TARBALL | cat )\n```\nor, worse (and more explicit),\n\n```sh\ngunzip -c $TARBALL | tar xf - $( gunzip -c $TARBALL | tar tf - | cat )\n```\nin the normal (non-error) case, where `gunzip` will be `bunzip2` if `$TARBALL` ends with `.bz2` instead of `.gz`; since you're also building a dictionary, `cat` here doesn't even properly reflect the no-op processing of all filenames in the archive (it would have to be some more complex identity function).\n\n\\\\\n\nYou could in addition rename `.names()` to `.valid_names()` say, and add another function `.invalid_names()` (or `.names()` returning *all* names) or whatever (such that it is possible to obtain the ones filtered out, or at least see whether any files got filtered out, but if we give an error or warning message, that should contain *which* files are considered garbage).",
    "created_at": "2016-07-24T15:02:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20802#issuecomment-382477",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:32'></a>
FWIW, I intentionally did *not* import the whole `sage_bootstrap` package just because `sage-uncompress-spkg` in case of Python 2.6 needs the `argparse` module (and only that) from `.../compat/` in my patch.

---

Could you add a `.contains_garbage()` property in order to not pass the whole list of all files in a tarball to `.extractall()` if it returns `False` (which is the normal case -- it should IMHO error out unless given some option to override that otherwise, or *at least* give a warning).

As is, it essentially does

```sh
tar xf $TARBALL $( tar tf $TARBALL | cat )
```
or, worse (and more explicit),

```sh
gunzip -c $TARBALL | tar xf - $( gunzip -c $TARBALL | tar tf - | cat )
```
in the normal (non-error) case, where `gunzip` will be `bunzip2` if `$TARBALL` ends with `.bz2` instead of `.gz`; since you're also building a dictionary, `cat` here doesn't even properly reflect the no-op processing of all filenames in the archive (it would have to be some more complex identity function).

\\

You could in addition rename `.names()` to `.valid_names()` say, and add another function `.invalid_names()` (or `.names()` returning *all* names) or whatever (such that it is possible to obtain the ones filtered out, or at least see whether any files got filtered out, but if we give an error or warning message, that should contain *which* files are considered garbage).



---

archive/issue_comments_382478.json:
```json
{
    "body": "<a id='comment:33'></a>\nIHMO adding subdirectories of packages to sys.path is to be avoided as it can cause confusion.\n\nI don't mind beautifying the file handling logic, but that doesn't belong to this ticket.",
    "created_at": "2016-07-24T15:22:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20802#issuecomment-382478",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:33'></a>
IHMO adding subdirectories of packages to sys.path is to be avoided as it can cause confusion.

I don't mind beautifying the file handling logic, but that doesn't belong to this ticket.



---

archive/issue_comments_382479.json:
```json
{
    "body": "<a id='comment:34'></a>\nP.S.:  To those unfamiliar with the tar (**t**ape **ar**chive) file format:\n\nIn contrast to e.g. a zip archive, the tar header does *not* contain a \"table of contents\"; to get a list of all files contained in a tarball (or to see whether it contains some file(s)), the *whole archive* has to get read.  (This originates from the sequential access of tapes, and has other advantages.)",
    "created_at": "2016-07-24T15:24:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20802#issuecomment-382479",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:34'></a>
P.S.:  To those unfamiliar with the tar (**t**ape **ar**chive) file format:

In contrast to e.g. a zip archive, the tar header does *not* contain a "table of contents"; to get a list of all files contained in a tarball (or to see whether it contains some file(s)), the *whole archive* has to get read.  (This originates from the sequential access of tapes, and has other advantages.)



---

archive/issue_comments_382480.json:
```json
{
    "body": "<a id='comment:35'></a>\nReplying to [vbraun](#comment%3A33):\n> IHMO adding subdirectories of packages to sys.path is to be avoided as it can cause confusion.\n\n\nSure, but I didn't put `argparse` there, which is unrelated to and independent of all the other stuff there.\n\n\\\\\n\n> I don't mind beautifying the file handling logic, but that doesn't belong to this ticket.\n\n\nBut completely rewriting it (or changing its structure, and adding tests etc.) does?\n\nThat's really completely unrelated to Python 2.6 support; if you're referring to the title, all we need *here* is to pick up the `argparse` module.  And it's currently a blocker ticket.\n\nI'd suggest to put your restructuring etc. on a follow-up, where we can improve other things as well (to not say remove further regressions introduced previously).\n\nIf the latter still makes it into Sage 7.3, fine, otherwise it doesn't hurt because the main issue has already been fixed here -- quickly and safe.",
    "created_at": "2016-07-24T15:39:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20802#issuecomment-382480",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:35'></a>
Replying to [vbraun](#comment%3A33):
> IHMO adding subdirectories of packages to sys.path is to be avoided as it can cause confusion.


Sure, but I didn't put `argparse` there, which is unrelated to and independent of all the other stuff there.

\\

> I don't mind beautifying the file handling logic, but that doesn't belong to this ticket.


But completely rewriting it (or changing its structure, and adding tests etc.) does?

That's really completely unrelated to Python 2.6 support; if you're referring to the title, all we need *here* is to pick up the `argparse` module.  And it's currently a blocker ticket.

I'd suggest to put your restructuring etc. on a follow-up, where we can improve other things as well (to not say remove further regressions introduced previously).

If the latter still makes it into Sage 7.3, fine, otherwise it doesn't hurt because the main issue has already been fixed here -- quickly and safe.



---

archive/issue_comments_382481.json:
```json
{
    "body": "<a id='comment:36'></a>\nReplying to [leif](#comment%3A35):\n> But completely rewriting it (or changing its structure, and adding tests etc.) does?\n\n\nYes, especially adding tests that you can run with tox on a variety of Python versions is IMHO crucially important.",
    "created_at": "2016-07-24T15:41:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20802#issuecomment-382481",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:36'></a>
Replying to [leif](#comment%3A35):
> But completely rewriting it (or changing its structure, and adding tests etc.) does?


Yes, especially adding tests that you can run with tox on a variety of Python versions is IMHO crucially important.



---

archive/issue_comments_382482.json:
```json
{
    "body": "<a id='comment:37'></a>\nThen also add tests with \"garbage\" in the archive.\n\nAnd a warning message is still missing, which is even more important.",
    "created_at": "2016-07-24T15:44:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20802#issuecomment-382482",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:37'></a>
Then also add tests with "garbage" in the archive.

And a warning message is still missing, which is even more important.



---

archive/issue_comments_382483.json:
```json
{
    "body": "<a id='comment:38'></a>\nP.S.:  If we want to continue Python 2.6 support, at least one buildbot should have (and use) it anyway.",
    "created_at": "2016-07-24T15:51:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20802#issuecomment-382483",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:38'></a>
P.S.:  If we want to continue Python 2.6 support, at least one buildbot should have (and use) it anyway.



---

archive/issue_comments_382484.json:
```json
{
    "body": "<a id='comment:39'></a>\nThose are good suggestions but not really on scope for this ticket.",
    "created_at": "2016-07-24T17:57:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20802#issuecomment-382484",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:39'></a>
Those are good suggestions but not really on scope for this ticket.



---

archive/issue_comments_382485.json:
```json
{
    "body": "<a id='comment:40'></a>\nReplying to [vbraun](#comment%3A39):\n> Those are good suggestions but not really on scope for this ticket.\n\n\n[https://en.wikipedia.org/wiki/Procrastination](https://en.wikipedia.org/wiki/Procrastination)",
    "created_at": "2016-07-24T20:12:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20802#issuecomment-382485",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:40'></a>
Replying to [vbraun](#comment%3A39):
> Those are good suggestions but not really on scope for this ticket.


[https://en.wikipedia.org/wiki/Procrastination](https://en.wikipedia.org/wiki/Procrastination)



---

archive/issue_comments_382486.json:
```json
{
    "body": "<a id='comment:41'></a>\n`filter_os_files.py` seems a bit overly-specialized.  I might just call that `utils.py`.  But up to you.  LGTM otherwise.",
    "created_at": "2016-07-26T12:19:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20802#issuecomment-382486",
    "user": "https://github.com/embray"
}
```

<a id='comment:41'></a>
`filter_os_files.py` seems a bit overly-specialized.  I might just call that `utils.py`.  But up to you.  LGTM otherwise.



---

archive/issue_comments_382487.json:
```json
{
    "body": "<a id='comment:42'></a>\nthere is [comment:ticket:20870:4] about getting directory permissions right in `sage-uncompress-spkg`.\n\nIs it indeed the case it is fixed here, or was always fixed anyway?\n\n---\n\nEDIT: Cross-ticket comment reference is `[comment:ticket:TTTTT:CCC]`.",
    "created_at": "2016-07-26T13:26:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20802#issuecomment-382487",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:42'></a>
there is [comment:ticket:20870:4] about getting directory permissions right in `sage-uncompress-spkg`.

Is it indeed the case it is fixed here, or was always fixed anyway?

---

EDIT: Cross-ticket comment reference is `[comment:ticket:TTTTT:CCC]`.



---

archive/issue_comments_382488.json:
```json
{
    "body": "<a id='comment:43'></a>\nI didn't change anything, but `SageTarFile.chmod` (which I didn't change) suggests that permissions are sanitized.",
    "created_at": "2016-07-26T14:00:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20802#issuecomment-382488",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:43'></a>
I didn't change anything, but `SageTarFile.chmod` (which I didn't change) suggests that permissions are sanitized.



---

archive/issue_comments_382489.json:
```json
{
    "body": "<a id='comment:44'></a>\nwhat are these errors:\n\n```\nsage -t build/test/capture.py  # ImportError in doctesting framework\n...\n```\nAre these files meant to be tested in some other way?",
    "created_at": "2016-07-26T14:13:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20802#issuecomment-382489",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:44'></a>
what are these errors:

```
sage -t build/test/capture.py  # ImportError in doctesting framework
...
```
Are these files meant to be tested in some other way?



---

archive/issue_comments_382490.json:
```json
{
    "body": "<a id='comment:45'></a>\nReplying to [dimpase](#comment%3A44):\n> what are these errors:\n> \n> ```\n> sage -t build/test/capture.py  # ImportError in doctesting framework\n> ...\n> ```\n> Are these files meant to be tested in some other way?\n\n\nAt least they're not directly tested by `ptestlong` (which passed for me):\n\n```sh\n$ ./sage -t --long build/test/\n...\n----------------------------------------------------------------------\nsage -t --long build/test/test_package.py  # ImportError in doctesting framework\nsage -t --long build/test/test_is_url.py  # ImportError in doctesting framework\nsage -t --long build/test/test_download.py  # ValueError in doctesting framework\nsage -t --long build/test/runnable.py  # ImportError in doctesting framework\nsage -t --long build/test/test_download_cmdline.py  # ImportError in doctesting framework\nsage -t --long build/test/test_config.py  # ImportError in doctesting framework\nsage -t --long build/test/capture.py  # ImportError in doctesting framework\nsage -t --long build/test/test_mirror_list.py  # ValueError in doctesting framework\nsage -t --long build/test/test_cksum.py  # ImportError in doctesting framework\nsage -t --long build/test/test_tarball.py  # ImportError in doctesting framework\nsage -t --long build/test/test_uncompress.py  # ImportError in doctesting framework\nsage -t --long build/test/test_logger.py  # ValueError in doctesting framework\nsage -t --long build/test/test_package_cmdline.py  # ImportError in doctesting framework\n----------------------------------------------------------------------\n```",
    "created_at": "2016-07-26T15:42:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20802#issuecomment-382490",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:45'></a>
Replying to [dimpase](#comment%3A44):
> what are these errors:
> 
> ```
> sage -t build/test/capture.py  # ImportError in doctesting framework
> ...
> ```
> Are these files meant to be tested in some other way?


At least they're not directly tested by `ptestlong` (which passed for me):

```sh
$ ./sage -t --long build/test/
...
----------------------------------------------------------------------
sage -t --long build/test/test_package.py  # ImportError in doctesting framework
sage -t --long build/test/test_is_url.py  # ImportError in doctesting framework
sage -t --long build/test/test_download.py  # ValueError in doctesting framework
sage -t --long build/test/runnable.py  # ImportError in doctesting framework
sage -t --long build/test/test_download_cmdline.py  # ImportError in doctesting framework
sage -t --long build/test/test_config.py  # ImportError in doctesting framework
sage -t --long build/test/capture.py  # ImportError in doctesting framework
sage -t --long build/test/test_mirror_list.py  # ValueError in doctesting framework
sage -t --long build/test/test_cksum.py  # ImportError in doctesting framework
sage -t --long build/test/test_tarball.py  # ImportError in doctesting framework
sage -t --long build/test/test_uncompress.py  # ImportError in doctesting framework
sage -t --long build/test/test_logger.py  # ValueError in doctesting framework
sage -t --long build/test/test_package_cmdline.py  # ImportError in doctesting framework
----------------------------------------------------------------------
```



---

archive/issue_comments_382491.json:
```json
{
    "body": "<a id='comment:46'></a>\nNo, they aren't meant to be run with the Sage doctest runner. They are meant to execute under tox, which is also ideally suited to run against multiple python versions (see tox.ini):\n\n```\ncd build\ntox\n```",
    "created_at": "2016-07-26T16:40:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20802#issuecomment-382491",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:46'></a>
No, they aren't meant to be run with the Sage doctest runner. They are meant to execute under tox, which is also ideally suited to run against multiple python versions (see tox.ini):

```
cd build
tox
```



---

archive/issue_comments_382492.json:
```json
{
    "body": "**Reviewer:** Erik Bray, Leif Leonhardy, Dima Pasechnik",
    "created_at": "2016-07-26T22:03:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20802#issuecomment-382492",
    "user": "https://github.com/dimpase"
}
```

**Reviewer:** Erik Bray, Leif Leonhardy, Dima Pasechnik



---

archive/issue_comments_382493.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2016-07-26T22:03:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20802#issuecomment-382493",
    "user": "https://github.com/dimpase"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_382494.json:
```json
{
    "body": "<a id='comment:47'></a>\nLGTM",
    "created_at": "2016-07-26T22:03:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20802#issuecomment-382494",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:47'></a>
LGTM



---

archive/issue_comments_382495.json:
```json
{
    "body": "<a id='comment:48'></a>\nPS. Perhaps for another ticket:\n\n```\npy34 runtests: commands[0] | python3.4 -m unittest discover\n...../home/dima/software/sage/build/sage_bootstrap/download/transfer.py:123: DeprecationWarning: FancyURLopener style of invoking requests is deprecated. Use newer urlopen functions/methods\n  opener = urllib.FancyURLopener()\n```",
    "created_at": "2016-07-26T22:04:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20802#issuecomment-382495",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:48'></a>
PS. Perhaps for another ticket:

```
py34 runtests: commands[0] | python3.4 -m unittest discover
...../home/dima/software/sage/build/sage_bootstrap/download/transfer.py:123: DeprecationWarning: FancyURLopener style of invoking requests is deprecated. Use newer urlopen functions/methods
  opener = urllib.FancyURLopener()
```



---

archive/issue_comments_382496.json:
```json
{
    "body": "<a id='comment:49'></a>\nOMG, fancy is deprecated?!",
    "created_at": "2016-07-26T22:21:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20802#issuecomment-382496",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:49'></a>
OMG, fancy is deprecated?!



---

archive/issue_events_063481.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-07-27T20:24:40Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/20802",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20802#event-63481"
}
```



---

archive/issue_comments_382497.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2016-07-27T20:24:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20802#issuecomment-382497",
    "user": "https://github.com/vbraun"
}
```

**Resolution:** fixed



---

archive/issue_comments_382498.json:
```json
{
    "body": "**Changing branch** from \"[u/vbraun/restore_python_2_6__compatibility](https://github.com/sagemath/sagetrac-mirror/tree/u/vbraun/restore_python_2_6__compatibility)\" to \"[775a3d3e160388b6d5b21b0a38e0ec2b3d247ef0](https://github.com/sagemath/sagetrac-mirror/commit/775a3d3e160388b6d5b21b0a38e0ec2b3d247ef0)\".",
    "created_at": "2016-07-27T20:24:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20802",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20802#issuecomment-382498",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/vbraun/restore_python_2_6__compatibility](https://github.com/sagemath/sagetrac-mirror/tree/u/vbraun/restore_python_2_6__compatibility)" to "[775a3d3e160388b6d5b21b0a38e0ec2b3d247ef0](https://github.com/sagemath/sagetrac-mirror/commit/775a3d3e160388b6d5b21b0a38e0ec2b3d247ef0)".
