# Issue 20243: Count real roots of polynomials using Sturm sequences

archive/issues_020006.json:
```json
{
    "body": "Assignee: @kedlaya\n\nKeywords: polynomials, root-counting, days71\n\nWe should expose PARI's functionality for counting roots of polynomials in a closed interval:\n\n```\nsage: P.<x> = PolynomialRing(ZZ)\nsage: pari((x-1)*(x-2)*(x-3)).polsturm(1,2)\n2\n```\nNote that the boundary behavior has changed from PARI 2.7 (which did not include the left endpoint of the interval as a root) to 2.8 (which does do so).\n\nIssue created by migration from https://trac.sagemath.org/ticket/20243\n\n",
    "closed_at": "2016-05-28T12:13:32Z",
    "created_at": "2016-03-21T15:40:23Z",
    "labels": [
        "component: algebra",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.2",
    "title": "Count real roots of polynomials using Sturm sequences",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/20243",
    "user": "https://github.com/kedlaya"
}
```
Assignee: @kedlaya

Keywords: polynomials, root-counting, days71

We should expose PARI's functionality for counting roots of polynomials in a closed interval:

```
sage: P.<x> = PolynomialRing(ZZ)
sage: pari((x-1)*(x-2)*(x-3)).polsturm(1,2)
2
```
Note that the boundary behavior has changed from PARI 2.7 (which did not include the left endpoint of the interval as a root) to 2.8 (which does do so).

Issue created by migration from https://trac.sagemath.org/ticket/20243





---

archive/issue_comments_275247.json:
```json
{
    "body": "Set assignee to @kedlaya.",
    "created_at": "2016-03-22T04:40:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20243#issuecomment-275247",
    "user": "https://github.com/kedlaya"
}
```

Set assignee to @kedlaya.



---

archive/issue_comments_275248.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-03-22T04:51:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20243#issuecomment-275248",
    "user": "https://github.com/kedlaya"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_275249.json:
```json
{
    "body": "Changing keywords from \"polynomials, root-counting\" to \"polynomials, root-counting, days71\".",
    "created_at": "2016-03-22T17:53:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20243#issuecomment-275249",
    "user": "https://github.com/kedlaya"
}
```

Changing keywords from "polynomials, root-counting" to "polynomials, root-counting, days71".



---

archive/issue_comments_275250.json:
```json
{
    "body": "Running Patchbot overnight, will play with the code tomorrow. \n\nJust looking at the source, you're probably going to want to include a check in the code to make sure your polynomial has an appropriate base field, and a test making sure this check behaves properly. Easiest way would to be to check that self.base_field() is RR/QQ/ZZ. There's a potential issue if somebody's polynomial has real coefficients, but is constructed in a complex ring. That is something I may personally do, as testing the Cyclic Sieving Phenomenon involves evaluating polynomials with nonnegative integer coefficients at complex roots of unity. But I suppose the user can just change the base ring appropriately if they want to test for real roots in that case.\n\nAlso, there should be the option of having a be -\\infty and b being +\\infty (the Maxima code for counting number of real roots in an interval allows these options, not sure about pari). My main interest in this code would checking to see if all of a polynomial's roots are real, so I would personally want a simple alias 'is_real_rooted()' that returns 'all_roots_in_interval(-Inf,Inf)'.",
    "created_at": "2016-03-23T06:52:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20243#issuecomment-275250",
    "user": "https://github.com/kevindilks"
}
```

Running Patchbot overnight, will play with the code tomorrow. 

Just looking at the source, you're probably going to want to include a check in the code to make sure your polynomial has an appropriate base field, and a test making sure this check behaves properly. Easiest way would to be to check that self.base_field() is RR/QQ/ZZ. There's a potential issue if somebody's polynomial has real coefficients, but is constructed in a complex ring. That is something I may personally do, as testing the Cyclic Sieving Phenomenon involves evaluating polynomials with nonnegative integer coefficients at complex roots of unity. But I suppose the user can just change the base ring appropriately if they want to test for real roots in that case.

Also, there should be the option of having a be -\infty and b being +\infty (the Maxima code for counting number of real roots in an interval allows these options, not sure about pari). My main interest in this code would checking to see if all of a polynomial's roots are real, so I would personally want a simple alias 'is_real_rooted()' that returns 'all_roots_in_interval(-Inf,Inf)'.



---

archive/issue_comments_275251.json:
```json
{
    "body": "> Just looking at the source, you're probably going to want to include a check in the code to make sure your polynomial has an appropriate base field\n\n\nAgreed. However, it might be easier to do this check *after* converting to PARI.",
    "created_at": "2016-03-23T10:09:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20243#issuecomment-275251",
    "user": "https://github.com/jdemeyer"
}
```

> Just looking at the source, you're probably going to want to include a check in the code to make sure your polynomial has an appropriate base field


Agreed. However, it might be easier to do this check *after* converting to PARI.



---

archive/issue_comments_275252.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-03-23T10:09:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20243#issuecomment-275252",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_275253.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-03-23T10:40:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20243#issuecomment-275253",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_275254.json:
```json
{
    "body": "PARI's polsturm allows infinite arguments by omission: a first argument of None translates to -Infinity, a second argument of None translates to +Infinity. I just pushed a commit allowing these.\n\nI agree with adding an alias for all real roots, but I'm not sure what to call it. My first thought would be is_self-adjoint().\n\nI'm not sure what is the best way to check for a valid base ring. One option would be to force the coefficients into RR, but I really want this to be an exact computation on exact input. I suppose I could check for coefficients in QQ or ZZ, and in those cases pass exact coefficients, and in all other cases force the coefficients into RR. But then one should be careful not to clobber the precision of the input in case it is higher than usual.",
    "created_at": "2016-03-23T10:44:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20243#issuecomment-275254",
    "user": "https://github.com/kedlaya"
}
```

PARI's polsturm allows infinite arguments by omission: a first argument of None translates to -Infinity, a second argument of None translates to +Infinity. I just pushed a commit allowing these.

I agree with adding an alias for all real roots, but I'm not sure what to call it. My first thought would be is_self-adjoint().

I'm not sure what is the best way to check for a valid base ring. One option would be to force the coefficients into RR, but I really want this to be an exact computation on exact input. I suppose I could check for coefficients in QQ or ZZ, and in those cases pass exact coefficients, and in all other cases force the coefficients into RR. But then one should be careful not to clobber the precision of the input in case it is higher than usual.



---

archive/issue_comments_275255.json:
```json
{
    "body": "Replying to [comment:8 kedlaya]:\n> PARI's polsturm allows infinite arguments by omission: a first argument of None translates to -Infinity, a second argument of None translates to +Infinity. I just pushed a commit allowing these.\n\n\nThat's undocumented in PARI, so I think it's a bad idea to rely on that.",
    "created_at": "2016-03-23T11:04:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20243#issuecomment-275255",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:8 kedlaya]:
> PARI's polsturm allows infinite arguments by omission: a first argument of None translates to -Infinity, a second argument of None translates to +Infinity. I just pushed a commit allowing these.


That's undocumented in PARI, so I think it's a bad idea to rely on that.



---

archive/issue_comments_275256.json:
```json
{
    "body": "Replying to [comment:9 jdemeyer]:\n> Replying to [comment:8 kedlaya]:\n> > PARI's polsturm allows infinite arguments by omission: a first argument of None translates to -Infinity, a second argument of None translates to +Infinity. I just pushed a commit allowing these.\n\n> \n> That's undocumented in PARI, so I think it's a bad idea to rely on that.\n\n\nIt's in the 2.7 documentation:\n\n```\npolsturm(pol, {a}, {b}): Number of real roots of the real squarefree polynomial pol in the interval ]a,b], using Sturm's algorithm. a (resp. b) is taken to be -infinity (resp. +infinity) if omitted.\n```\nOr have you seen the 2.8 user guide yet (which I haven't found)? There does need to be a change of text to change the interval from ]a,b] (open on the left, closed on the right) to [a,b] (closed both sides).",
    "created_at": "2016-03-23T11:40:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20243#issuecomment-275256",
    "user": "https://github.com/kedlaya"
}
```

Replying to [comment:9 jdemeyer]:
> Replying to [comment:8 kedlaya]:
> > PARI's polsturm allows infinite arguments by omission: a first argument of None translates to -Infinity, a second argument of None translates to +Infinity. I just pushed a commit allowing these.

> 
> That's undocumented in PARI, so I think it's a bad idea to rely on that.


It's in the 2.7 documentation:

```
polsturm(pol, {a}, {b}): Number of real roots of the real squarefree polynomial pol in the interval ]a,b], using Sturm's algorithm. a (resp. b) is taken to be -infinity (resp. +infinity) if omitted.
```
Or have you seen the 2.8 user guide yet (which I haven't found)? There does need to be a change of text to change the interval from ]a,b] (open on the left, closed on the right) to [a,b] (closed both sides).



---

archive/issue_comments_275257.json:
```json
{
    "body": "Replying to [comment:10 kedlaya]:\n> Or have you seen the 2.8 user guide yet (which I haven't found)?\n\n\nPARI-2.7 is ancient. In PARI-2.8, the syntax has changed, you are supposed to use `polsturm(pol, [a,b])` instead.\n\nThe PARI-2.8 user guide might not be online, but you can access the documentation from Sage: run `./sage --gp` and then type `??polsturm`.\n\nI created #20257 to deprecate `pari(...).polsturm(a, b)` in Sage.",
    "created_at": "2016-03-23T12:58:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20243#issuecomment-275257",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:10 kedlaya]:
> Or have you seen the 2.8 user guide yet (which I haven't found)?


PARI-2.7 is ancient. In PARI-2.8, the syntax has changed, you are supposed to use `polsturm(pol, [a,b])` instead.

The PARI-2.8 user guide might not be online, but you can access the documentation from Sage: run `./sage --gp` and then type `??polsturm`.

I created #20257 to deprecate `pari(...).polsturm(a, b)` in Sage.



---

archive/issue_comments_275258.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-03-23T13:45:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20243#issuecomment-275258",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_275259.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-03-23T14:30:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20243#issuecomment-275259",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_275260.json:
```json
{
    "body": "OK, I changed the call syntax to polsturm. I also changed the call syntax for count_roots_in_interval and all_roots_in_interval: they now take a variable number of arguments, which should be either two numbers or one interval. Moreover, I allow passing either None or -Infinity as a left endpoint, and None or +Infinity as a right endpoint (converting them to the Pari infinities).\n\nI still haven't implemented an alias for all real roots (since I'm not settled on the name) or checking the argument type.",
    "created_at": "2016-03-23T14:32:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20243#issuecomment-275260",
    "user": "https://github.com/kedlaya"
}
```

OK, I changed the call syntax to polsturm. I also changed the call syntax for count_roots_in_interval and all_roots_in_interval: they now take a variable number of arguments, which should be either two numbers or one interval. Moreover, I allow passing either None or -Infinity as a left endpoint, and None or +Infinity as a right endpoint (converting them to the Pari infinities).

I still haven't implemented an alias for all real roots (since I'm not settled on the name) or checking the argument type.



---

archive/issue_comments_275261.json:
```json
{
    "body": "Conversion to infinity should not happen here, but more generally in the Sage <-> PARI interface. Feel free to add a commit to #20256 to do that.",
    "created_at": "2016-03-23T14:35:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20243#issuecomment-275261",
    "user": "https://github.com/jdemeyer"
}
```

Conversion to infinity should not happen here, but more generally in the Sage <-> PARI interface. Feel free to add a commit to #20256 to do that.



---

archive/issue_comments_275262.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-03-24T10:30:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20243#issuecomment-275262",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_275263.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-03-24T10:39:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20243#issuecomment-275263",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_275264.json:
```json
{
    "body": "This commit should play nicely with #20256, but I'm still a novice with git-trac and haven't figured out how to test this yet.\n\nI added has_all_real_roots() to test for all roots in the real line. I'm open to changing that name if someone has a better idea.\n\nI still haven't implemented any sort of sanity checking on the input base ring.",
    "created_at": "2016-03-24T10:41:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20243#issuecomment-275264",
    "user": "https://github.com/kedlaya"
}
```

This commit should play nicely with #20256, but I'm still a novice with git-trac and haven't figured out how to test this yet.

I added has_all_real_roots() to test for all roots in the real line. I'm open to changing that name if someone has a better idea.

I still haven't implemented any sort of sanity checking on the input base ring.



---

archive/issue_comments_275265.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-03-24T14:29:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20243#issuecomment-275265",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_275266.json:
```json
{
    "body": "Merged #20256 to do the Infinity conversion.\n\nI don't know what to do about type-checking. If you have a polynomial over C but whose coefficients actually belong to R, then PARI seems to handle this correctly (I added a doctest to this effect). However, we have trouble with inexact polynomials which are (apparently) not squarefree:\n\n```\nsage: P.<x> = PolynomialRing(RR)\nsage: pol = (x-1)^2*(x-2)^2*(x-3)\nsage: pol.is_squarefree() # Should be False\nTrue\nsage: pari(pol).issquarefree # Should be 0\n1\nsage: pol.count_roots_in_interval()\n...\nPariError: domain error in polsturm: issquarefree(pol) = 0\n```\nI created ticket #20282 for this issue, in case we decide not to deal with it here (which would be my preference).",
    "created_at": "2016-03-24T15:27:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20243#issuecomment-275266",
    "user": "https://github.com/kedlaya"
}
```

Merged #20256 to do the Infinity conversion.

I don't know what to do about type-checking. If you have a polynomial over C but whose coefficients actually belong to R, then PARI seems to handle this correctly (I added a doctest to this effect). However, we have trouble with inexact polynomials which are (apparently) not squarefree:

```
sage: P.<x> = PolynomialRing(RR)
sage: pol = (x-1)^2*(x-2)^2*(x-3)
sage: pol.is_squarefree() # Should be False
True
sage: pari(pol).issquarefree # Should be 0
1
sage: pol.count_roots_in_interval()
...
PariError: domain error in polsturm: issquarefree(pol) = 0
```
I created ticket #20282 for this issue, in case we decide not to deal with it here (which would be my preference).



---

archive/issue_comments_275267.json:
```json
{
    "body": "You don't actually need this: `a1 = pari(a)` and `b1 = pari(b)`: PARI methods will automatically convert anyway.",
    "created_at": "2016-03-24T16:00:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20243#issuecomment-275267",
    "user": "https://github.com/jdemeyer"
}
```

You don't actually need this: `a1 = pari(a)` and `b1 = pari(b)`: PARI methods will automatically convert anyway.



---

archive/issue_comments_275268.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-03-24T16:11:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20243#issuecomment-275268",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_275269.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-03-24T16:15:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20243#issuecomment-275269",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_275270.json:
```json
{
    "body": "Replying to [comment:21 jdemeyer]:\n> You don't actually need this: `a1 = pari(a)` and `b1 = pari(b)`: PARI methods will automatically convert anyway.\n\n\nChanged to `a1 = a` and `b1 = b`.",
    "created_at": "2016-03-24T16:16:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20243#issuecomment-275270",
    "user": "https://github.com/kedlaya"
}
```

Replying to [comment:21 jdemeyer]:
> You don't actually need this: `a1 = pari(a)` and `b1 = pari(b)`: PARI methods will automatically convert anyway.


Changed to `a1 = a` and `b1 = b`.



---

archive/issue_comments_275271.json:
```json
{
    "body": "You don't need `a1` or `b1` either, just use `a` and `b`. And `foo == None` should be replaced by `foo is None`.",
    "created_at": "2016-03-24T16:37:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20243#issuecomment-275271",
    "user": "https://github.com/jdemeyer"
}
```

You don't need `a1` or `b1` either, just use `a` and `b`. And `foo == None` should be replaced by `foo is None`.



---

archive/issue_comments_275272.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-03-24T17:35:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20243#issuecomment-275272",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_275273.json:
```json
{
    "body": "Replying to [comment:25 jdemeyer]:\n> You don't need `a1` or `b1` either, just use `a` and `b`. And `foo == None` should be replaced by `foo is None`.\n\n\nChanges made.",
    "created_at": "2016-03-24T17:36:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20243#issuecomment-275273",
    "user": "https://github.com/kedlaya"
}
```

Replying to [comment:25 jdemeyer]:
> You don't need `a1` or `b1` either, just use `a` and `b`. And `foo == None` should be replaced by `foo is None`.


Changes made.



---

archive/issue_comments_275274.json:
```json
{
    "body": "The only thing that remains is to check that the coefficients are real. I see two approaches: either checking that the base_ring coerces to `RealField(2)` or checking the PARI types after conversion to PARI.",
    "created_at": "2016-03-24T18:10:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20243#issuecomment-275274",
    "user": "https://github.com/jdemeyer"
}
```

The only thing that remains is to check that the coefficients are real. I see two approaches: either checking that the base_ring coerces to `RealField(2)` or checking the PARI types after conversion to PARI.



---

archive/issue_comments_275275.json:
```json
{
    "body": "I'm not sure checking the base ring is the right approach; one use case that was already suggested above is a polynomial over CC which happens to have real coefficients. One option is to attempt the coercion by calling `self.change_ring(RR)` and discarding the result (allowing a `TypeError` through if it comes up). Working on the PARI side eliminates this particular case:\n\n```\nsage: u = CC(1)\nsage: u.parent()\nComplex Field with 53 bits of precision\nsage: pari(u)\n1.00000000000000\nsage: pari(u).type()\n't_REAL'\n```\nThoughts?",
    "created_at": "2016-03-24T19:56:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20243#issuecomment-275275",
    "user": "https://github.com/kedlaya"
}
```

I'm not sure checking the base ring is the right approach; one use case that was already suggested above is a polynomial over CC which happens to have real coefficients. One option is to attempt the coercion by calling `self.change_ring(RR)` and discarding the result (allowing a `TypeError` through if it comes up). Working on the PARI side eliminates this particular case:

```
sage: u = CC(1)
sage: u.parent()
Complex Field with 53 bits of precision
sage: pari(u)
1.00000000000000
sage: pari(u).type()
't_REAL'
```
Thoughts?



---

archive/issue_comments_275276.json:
```json
{
    "body": "Replying to [comment:29 kedlaya]:\n> I'm not sure checking the base ring is the right approach; one use case that was already suggested above is a polynomial over CC which happens to have real coefficients.\n\n\nThe Sage philosophy is usually that the base ring matters. So, if the polynomial defined over CC happens to have real coefficients, that's an accident. It doens't mean that functions expecting real input should work.",
    "created_at": "2016-03-24T21:25:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20243#issuecomment-275276",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:29 kedlaya]:
> I'm not sure checking the base ring is the right approach; one use case that was already suggested above is a polynomial over CC which happens to have real coefficients.


The Sage philosophy is usually that the base ring matters. So, if the polynomial defined over CC happens to have real coefficients, that's an accident. It doens't mean that functions expecting real input should work.



---

archive/issue_comments_275277.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-03-25T12:07:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20243#issuecomment-275277",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_275278.json:
```json
{
    "body": "Replying to [comment:30 jdemeyer]:\n> Replying to [comment:29 kedlaya]:\n> > I'm not sure checking the base ring is the right approach; one use case that was already suggested above is a polynomial over CC which happens to have real coefficients.\n\n> \n> The Sage philosophy is usually that the base ring matters. So, if the polynomial defined over CC happens to have real coefficients, that's an accident. It doens't mean that functions expecting real input should work.\n\n\nHere is a better solution: make the function work on complex inputs! Now I first attempt a conversion to RR, and if no exception is raised I pass the (unconverted) input directly to PARI; that way, exact inputs stay exact. If that fails, I convert to CC (allowing an exception through if it occurs), and take the GCD of the polynomial with its conjugate (and strip off the leading coefficient) to get a polynomial with real coefficients and all the same real roots as before.",
    "created_at": "2016-03-25T12:09:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20243#issuecomment-275278",
    "user": "https://github.com/kedlaya"
}
```

Replying to [comment:30 jdemeyer]:
> Replying to [comment:29 kedlaya]:
> > I'm not sure checking the base ring is the right approach; one use case that was already suggested above is a polynomial over CC which happens to have real coefficients.

> 
> The Sage philosophy is usually that the base ring matters. So, if the polynomial defined over CC happens to have real coefficients, that's an accident. It doens't mean that functions expecting real input should work.


Here is a better solution: make the function work on complex inputs! Now I first attempt a conversion to RR, and if no exception is raised I pass the (unconverted) input directly to PARI; that way, exact inputs stay exact. If that fails, I convert to CC (allowing an exception through if it occurs), and take the GCD of the polynomial with its conjugate (and strip off the leading coefficient) to get a polynomial with real coefficients and all the same real roots as before.



---

archive/issue_comments_275279.json:
```json
{
    "body": "Replying to [comment:32 kedlaya]:\n> Here is a better solution: make the function work on complex inputs! Now I first attempt a conversion to RR, and if no exception is raised I pass the (unconverted) input directly to PARI; that way, exact inputs stay exact. If that fails, I convert to CC (allowing an exception through if it occurs), and take the GCD of the polynomial with its conjugate (and strip off the leading coefficient) to get a polynomial with real coefficients and all the same real roots as before.\n\n\nCan you document the stuff you wrote here in the code?\n\nI don't see why you need to convert to `CC`. Just conjugate without conversion. That way, you support much more base fields, in particular `QQbar`.",
    "created_at": "2016-03-25T12:36:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20243#issuecomment-275279",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:32 kedlaya]:
> Here is a better solution: make the function work on complex inputs! Now I first attempt a conversion to RR, and if no exception is raised I pass the (unconverted) input directly to PARI; that way, exact inputs stay exact. If that fails, I convert to CC (allowing an exception through if it occurs), and take the GCD of the polynomial with its conjugate (and strip off the leading coefficient) to get a polynomial with real coefficients and all the same real roots as before.


Can you document the stuff you wrote here in the code?

I don't see why you need to convert to `CC`. Just conjugate without conversion. That way, you support much more base fields, in particular `QQbar`.



---

archive/issue_comments_275280.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-03-25T13:02:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20243#issuecomment-275280",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_275281.json:
```json
{
    "body": "Replying to [comment:33 jdemeyer]:\n> Replying to [comment:32 kedlaya]:\n> > Here is a better solution: make the function work on complex inputs! Now I first attempt a conversion to RR, and if no exception is raised I pass the (unconverted) input directly to PARI; that way, exact inputs stay exact. If that fails, I convert to CC (allowing an exception through if it occurs), and take the GCD of the polynomial with its conjugate (and strip off the leading coefficient) to get a polynomial with real coefficients and all the same real roots as before.\n\n> \n> Can you document the stuff you wrote here in the code?\n> \n> I don't see why you need to convert to `CC`. Just conjugate without conversion. That way, you support much more base fields, in particular `QQbar`.\n\n\nDone. I also took out the conversion to RR, since anyway Pari will return an error if it doesn't like the input.",
    "created_at": "2016-03-25T13:04:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20243#issuecomment-275281",
    "user": "https://github.com/kedlaya"
}
```

Replying to [comment:33 jdemeyer]:
> Replying to [comment:32 kedlaya]:
> > Here is a better solution: make the function work on complex inputs! Now I first attempt a conversion to RR, and if no exception is raised I pass the (unconverted) input directly to PARI; that way, exact inputs stay exact. If that fails, I convert to CC (allowing an exception through if it occurs), and take the GCD of the polynomial with its conjugate (and strip off the leading coefficient) to get a polynomial with real coefficients and all the same real roots as before.

> 
> Can you document the stuff you wrote here in the code?
> 
> I don't see why you need to convert to `CC`. Just conjugate without conversion. That way, you support much more base fields, in particular `QQbar`.


Done. I also took out the conversion to RR, since anyway Pari will return an error if it doesn't like the input.



---

archive/issue_comments_275282.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-04-05T02:46:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20243#issuecomment-275282",
    "user": "https://github.com/kedlaya"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_275283.json:
```json
{
    "body": "Patchbot doesn't like something about the way errors are raised. I think it would be a bit more straightforward to make the arguments be `(self,lower_bound=None,upper_bound=None)`, and just not allow for the option of specifying the bounds as a two-element list.\n\nIn terms of the names of functions, I think `count_roots_in_interval` would make more sense as `number_of_roots_in_interval` (that's the naming convention used for most combinatorial statistics). And `has_all_real_roots` should probably be named `is_real_rooted`. Things that return a boolean almost always start with `is_`, and calling polynomials with all real roots \"real rooted\" is prevalent, at least in the literature that I read.",
    "created_at": "2016-04-06T02:05:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20243#issuecomment-275283",
    "user": "https://github.com/kevindilks"
}
```

Patchbot doesn't like something about the way errors are raised. I think it would be a bit more straightforward to make the arguments be `(self,lower_bound=None,upper_bound=None)`, and just not allow for the option of specifying the bounds as a two-element list.

In terms of the names of functions, I think `count_roots_in_interval` would make more sense as `number_of_roots_in_interval` (that's the naming convention used for most combinatorial statistics). And `has_all_real_roots` should probably be named `is_real_rooted`. Things that return a boolean almost always start with `is_`, and calling polynomials with all real roots "real rooted" is prevalent, at least in the literature that I read.



---

archive/issue_comments_275284.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-04-06T02:05:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20243#issuecomment-275284",
    "user": "https://github.com/kevindilks"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_275285.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-04-06T02:46:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20243#issuecomment-275285",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_275286.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-04-06T02:53:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20243#issuecomment-275286",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_275287.json:
```json
{
    "body": "Replying to [comment:37 kdilks]:\n> Patchbot doesn't like something about the way errors are raised. I think it would be a bit more straightforward to make the arguments be `(self,lower_bound=None,upper_bound=None)`, and just not allow for the option of specifying the bounds as a two-element list.\n> \n\nSee if patchbot does better with this.\n\n> In terms of the names of functions, I think `count_roots_in_interval` would make more sense as `number_of_roots_in_interval` (that's the naming convention used for most combinatorial statistics). And `has_all_real_roots` should probably be named `is_real_rooted`. Things that return a boolean almost always start with `is_`, and calling polynomials with all real roots \"real rooted\" is prevalent, at least in the literature that I read.\n\n\nNot a term I had seen before. I suppose it's actually \"real-rooted\" (otherwise a \"real rooted polynomial\" would be a polynomial which is real and also \"rooted\"), but I think there is a convention to convert both spaces and hyphens into underscores in method names (as in `Matrix.is_skew_symmetric`). However, I don't have a suitable \"is\" reformulation of  `all_roots_in_interval`.\n\nBonus edit: I added `number_of_real_roots` as an alias for `number_of_roots_in_interval` with no arguments.",
    "created_at": "2016-04-06T03:00:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20243#issuecomment-275287",
    "user": "https://github.com/kedlaya"
}
```

Replying to [comment:37 kdilks]:
> Patchbot doesn't like something about the way errors are raised. I think it would be a bit more straightforward to make the arguments be `(self,lower_bound=None,upper_bound=None)`, and just not allow for the option of specifying the bounds as a two-element list.
> 

See if patchbot does better with this.

> In terms of the names of functions, I think `count_roots_in_interval` would make more sense as `number_of_roots_in_interval` (that's the naming convention used for most combinatorial statistics). And `has_all_real_roots` should probably be named `is_real_rooted`. Things that return a boolean almost always start with `is_`, and calling polynomials with all real roots "real rooted" is prevalent, at least in the literature that I read.


Not a term I had seen before. I suppose it's actually "real-rooted" (otherwise a "real rooted polynomial" would be a polynomial which is real and also "rooted"), but I think there is a convention to convert both spaces and hyphens into underscores in method names (as in `Matrix.is_skew_symmetric`). However, I don't have a suitable "is" reformulation of  `all_roots_in_interval`.

Bonus edit: I added `number_of_real_roots` as an alias for `number_of_roots_in_interval` with no arguments.



---

archive/issue_comments_275288.json:
```json
{
    "body": "I am happy with this ticket now, but I'll give `@`jdemeyer some time to weigh in before setting positive review.",
    "created_at": "2016-04-06T19:00:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20243#issuecomment-275288",
    "user": "https://github.com/kevindilks"
}
```

I am happy with this ticket now, but I'll give `@`jdemeyer some time to weigh in before setting positive review.



---

archive/issue_comments_275289.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-04-06T19:00:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20243#issuecomment-275289",
    "user": "https://github.com/kevindilks"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_275290.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-05-26T19:02:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20243#issuecomment-275290",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_275291.json:
```json
{
    "body": "missing whiteline after `TESTS::`\n\notherwise looks good to me",
    "created_at": "2016-05-26T19:02:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20243#issuecomment-275291",
    "user": "https://github.com/fchapoton"
}
```

missing whiteline after `TESTS::`

otherwise looks good to me



---

archive/issue_comments_275292.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-05-26T21:06:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20243#issuecomment-275292",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_275293.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-05-26T21:07:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20243#issuecomment-275293",
    "user": "https://github.com/kedlaya"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_275294.json:
```json
{
    "body": "Replying to [comment:42 chapoton]:\n> missing whiteline after `TESTS::`\n> \n> otherwise looks good to me\n\n\nFixed, thanks.",
    "created_at": "2016-05-26T21:07:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20243#issuecomment-275294",
    "user": "https://github.com/kedlaya"
}
```

Replying to [comment:42 chapoton]:
> missing whiteline after `TESTS::`
> 
> otherwise looks good to me


Fixed, thanks.



---

archive/issue_comments_275295.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-05-27T06:23:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20243#issuecomment-275295",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_275296.json:
```json
{
    "body": "ok, let it be.",
    "created_at": "2016-05-27T06:23:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20243#issuecomment-275296",
    "user": "https://github.com/fchapoton"
}
```

ok, let it be.



---

archive/issue_comments_275297.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-05-28T12:13:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20243",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20243#issuecomment-275297",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_054984.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-05-28T12:13:32Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/20243",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20243#event-54984"
}
```
