# Issue 20830: Symbolic factor_list() should do integer factorisation of integers/rationals

archive/issues_020830.json:
```json
{
    "body": "Let symbolic `factor_list()` do integer factorisation if given an integer or fraction.\n\n```\nsage: SR(50).factor_list()\n[(50, 1)]\nsage: SR(49/100).factor_list()\n[(49/100, 1)]\n```\n\nToo much surprise for new users.\n\nIssue created by migration from https://trac.sagemath.org/ticket/21067\n\n",
    "created_at": "2016-07-21T06:37:44Z",
    "labels": [
        "component: symbolics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.2",
    "title": "Symbolic factor_list() should do integer factorisation of integers/rationals",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/20830",
    "user": "https://github.com/rwst"
}
```
Let symbolic `factor_list()` do integer factorisation if given an integer or fraction.

```
sage: SR(50).factor_list()
[(50, 1)]
sage: SR(49/100).factor_list()
[(49/100, 1)]
```

Too much surprise for new users.

Issue created by migration from https://trac.sagemath.org/ticket/21067





---

archive/issue_comments_287461.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-07-21T08:27:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20830",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20830#issuecomment-287461",
    "user": "https://github.com/rwst"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_287462.json:
```json
{
    "body": "New commits:",
    "created_at": "2016-07-21T08:27:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20830",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20830#issuecomment-287462",
    "user": "https://github.com/rwst"
}
```

New commits:



---

archive/issue_comments_287463.json:
```json
{
    "body": "One minor thing: could you move the import into the `factor_list` method? I worry that this could lead to import hell.",
    "created_at": "2016-07-21T14:43:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20830",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20830#issuecomment-287463",
    "user": "https://github.com/tscrim"
}
```

One minor thing: could you move the import into the `factor_list` method? I worry that this could lead to import hell.



---

archive/issue_comments_287464.json:
```json
{
    "body": "Two comments:\n\n- I don't think SR needs to be imported at all. The very fact that we land in this `factor_list` implementation should mean that `self.parent()` should be SR. And if it isn't, that's probably the better parent to use anyway.\n\n- If we're going to do this anyway, I think it's better if we have\n\n```\nsage: (5/3*x/(x+1)).factor_list()\n[(x + 1, -1), (x, 1), (5, 1), (3,-1)]\n```\nbecause it's closer to the idea that the factorisation of a product U*V has a tendency to be the concatenation of the factorisations of U and V.\n\n\nIt should be clear that `factor_list` just returns *a* factorisation:\n\n```\nsage: ((sqrt(5)+1)^2*(x^2-5)).expand_rational().factor_list()\n[(x^2 - 5, 1), (sqrt(5) + 3, 1), (2, 1)]\n```\n\nbut keeping the convention that we factor rational numbers into their prime factors should be fine and could be nice for newbies.",
    "created_at": "2016-07-21T18:34:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20830",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20830#issuecomment-287464",
    "user": "https://github.com/nbruin"
}
```

Two comments:

- I don't think SR needs to be imported at all. The very fact that we land in this `factor_list` implementation should mean that `self.parent()` should be SR. And if it isn't, that's probably the better parent to use anyway.

- If we're going to do this anyway, I think it's better if we have

```
sage: (5/3*x/(x+1)).factor_list()
[(x + 1, -1), (x, 1), (5, 1), (3,-1)]
```
because it's closer to the idea that the factorisation of a product U*V has a tendency to be the concatenation of the factorisations of U and V.


It should be clear that `factor_list` just returns *a* factorisation:

```
sage: ((sqrt(5)+1)^2*(x^2-5)).expand_rational().factor_list()
[(x^2 - 5, 1), (sqrt(5) + 3, 1), (2, 1)]
```

but keeping the convention that we factor rational numbers into their prime factors should be fine and could be nice for newbies.



---

archive/issue_comments_287465.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-07-22T07:34:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20830",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20830#issuecomment-287465",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_287466.json:
```json
{
    "body": "Instead of having a special check and a special method for integer/rationals couldn't we use something simpler and more generic like\n\n```python\ndef _factorization_from_pyobject(self):\n    try:\n        a = self.pyobject()\n    except TypeError:\n        return\n\n    try:\n        f = a.factor()\n    except (AttributeError, NotImplementedError):\n        return\n\n    # from here I assume that a is a Sage object which might not be the case...\n    P = self.parent()\n    facs = [(P(p), P(e)) for p,e in f]\n    if f.unit().is_one():\n        return facs\n    else:\n        return [(P(f.unit()), P(1))] + facs\n```",
    "created_at": "2016-07-22T23:06:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20830",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20830#issuecomment-287466",
    "user": "https://github.com/videlec"
}
```

Instead of having a special check and a special method for integer/rationals couldn't we use something simpler and more generic like

```python
def _factorization_from_pyobject(self):
    try:
        a = self.pyobject()
    except TypeError:
        return

    try:
        f = a.factor()
    except (AttributeError, NotImplementedError):
        return

    # from here I assume that a is a Sage object which might not be the case...
    P = self.parent()
    facs = [(P(p), P(e)) for p,e in f]
    if f.unit().is_one():
        return facs
    else:
        return [(P(f.unit()), P(1))] + facs
```



---

archive/issue_comments_287467.json:
```json
{
    "body": "Vincent, if you think it's better, then please go ahead on a new branch. I'm not so deep in Python that I could object.",
    "created_at": "2016-07-23T07:49:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20830",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20830#issuecomment-287467",
    "user": "https://github.com/rwst"
}
```

Vincent, if you think it's better, then please go ahead on a new branch. I'm not so deep in Python that I could object.



---

archive/issue_comments_287468.json:
```json
{
    "body": "I think \"factor\" in general could be a little fickle to depend on:\n\n```\nsage: K.<a>=NumberField(x^2+5)\nsage: K(2).factor()\nArithmeticError: non-principal ideal in factorization\nsage:  SR(2).pyobject().factor()\n2\nsage: (2+I-I).pyobject().factor() \n(-I) * (I + 1)^2\n```",
    "created_at": "2016-07-23T15:57:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20830",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20830#issuecomment-287468",
    "user": "https://github.com/nbruin"
}
```

I think "factor" in general could be a little fickle to depend on:

```
sage: K.<a>=NumberField(x^2+5)
sage: K(2).factor()
ArithmeticError: non-principal ideal in factorization
sage:  SR(2).pyobject().factor()
2
sage: (2+I-I).pyobject().factor() 
(-I) * (I + 1)^2
```



---

archive/issue_comments_287469.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-08-18T13:00:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20830",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20830#issuecomment-287469",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_287470.json:
```json
{
    "body": "I think this ticket should also do:\n\n```\nsage: (2+6*x).factor_list()\n[(3*x + 1, 1), (2, 1)]\n```",
    "created_at": "2017-04-07T08:06:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20830",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20830#issuecomment-287470",
    "user": "https://github.com/rwst"
}
```

I think this ticket should also do:

```
sage: (2+6*x).factor_list()
[(3*x + 1, 1), (2, 1)]
```



---

archive/issue_comments_287471.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-04-16T06:43:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20830",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20830#issuecomment-287471",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_events_056278.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-04-16T06:43:15Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/20830",
    "milestone": "sage-8.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20830#event-56278"
}
```



---

archive/issue_comments_287472.json:
```json
{
    "body": "I used Vincent's code for a new version that tries also to separate the content in a univariate polynomial.\n\n---\nNew commits:",
    "created_at": "2017-04-16T06:43:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20830",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20830#issuecomment-287472",
    "user": "https://github.com/rwst"
}
```

I used Vincent's code for a new version that tries also to separate the content in a univariate polynomial.

---
New commits:



---

archive/issue_comments_287473.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-11-09T07:15:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20830",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20830#issuecomment-287473",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_287474.json:
```json
{
    "body": "Doctest errors, see patchbot.",
    "created_at": "2017-11-28T07:16:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20830",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20830#issuecomment-287474",
    "user": "https://github.com/rwst"
}
```

Doctest errors, see patchbot.



---

archive/issue_comments_287475.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-11-28T07:16:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20830",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20830#issuecomment-287475",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_287476.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-12-06T16:09:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20830",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20830#issuecomment-287476",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_287477.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-12-06T16:09:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20830",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20830#issuecomment-287477",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_events_056279.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-12-06T16:09:54Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/20830",
    "milestone": "sage-8.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20830#event-56279"
}
```



---

archive/issue_events_056280.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-12-06T16:09:54Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/20830",
    "milestone": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20830#event-56280"
}
```



---

archive/issue_comments_287478.json:
```json
{
    "body": "LGTM, I only have one comment:\n\n```diff\n+            raise ValueError\n```\nThis is only used internally, so it might be good to consider a customized exception:\n\n```python\nclass CannotFactor(RuntimeError):\n    pass\n```\nAnd yes, I think `RuntimeError` is more appropriate (but if you insist on `ValueError` then I am good with it as well, although wanting to hear your arguments for that ;) )",
    "created_at": "2019-03-28T09:01:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20830",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20830#issuecomment-287478",
    "user": "https://github.com/dkrenn"
}
```

LGTM, I only have one comment:

```diff
+            raise ValueError
```
This is only used internally, so it might be good to consider a customized exception:

```python
class CannotFactor(RuntimeError):
    pass
```
And yes, I think `RuntimeError` is more appropriate (but if you insist on `ValueError` then I am good with it as well, although wanting to hear your arguments for that ;) )
