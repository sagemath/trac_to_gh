# Issue 20080: Meta-ticket: Sage docbuild

archive/issues_019843.json:
```json
{
    "body": "Docbuild tickets:\n\n- #30010 Split sage_setup.docbuild out to a separate distribution (distutils package)\n- #31353 `sage --docbuild`: Add options to list all documents\n- #31936 docbuild: Japanese characters creeping into other parts of Sage documentation\n- #31366 docbuild: switch from `optparse` to `argparse`\n- #31948 Reimplement parallel docbuild using `make`\n- #29868 pip-installable packages `sage-doc-html`, `sage-doc-pdf`\n- #30369 Parallel docbuild, cythonization: Use GNU make's POSIX jobserver protocol\n- #30475 `sage -docbuild`: error building docs of single file with relative imports\n- #6389 expose building documentation for user modules not in the Sage library\n- #30418 Missing PDF icons in the Sage documentation website\n- #28376 Shrink Documentation\n- #31415 GH Actions workflow that deploys built documentation\n- #29868 pip-installable packages sagemath-doc-src, sagemath-doc-inventory, sagemath-doc-html, sagemath-doc-pdf\n- https://github.com/sagemath/documentation/issues/24 (Versioned Sage documentation)\n\nSphinx tickets:\n\n- #31696 Sphinx/docutils update for Sage 9.4\n- #27578 Use `sphinx.util.inspect.Signature` not `sphinx.ext.autodoc.inspector.formatargspec`\n- #27164 link sphinx docs of Sage components in reference manual\n- #29231 add intersphinx mapping for SciPy\n- #27495 Use `sphinx.ext.extlinks` to add Sphinx roles for links to external package docs\n- #30893 Replace sage autodoc extension by built-in one\n- #30894 Add typing info to documentation using `sphinx_autodoc_typehints`\n\nSee also: \n\n- #20893 Meta-ticket: Improve live documentation in the Jupyter notebook\n\n---\n\n**Overview of Sphinx custom code in Sage's documentation build system**\n\nThe goal of this ticket is to write an overview of the various bits and pieces of custom Sphinx code in Sage, with the long term goal to see which pieces could be:\n- thrown away, using features that are now in Sphinx\n- generalized and submitted upstream\n- cleaned up\n\nHere is a list of files with their relative roles:\n\n**src/sage/docs**\n\n- `__init__.py`: empty file\n\n- `conf.py`: standard Sphinx configuration file.\n\n**src/sage_docbuild** (was `src/sage_setup/docbuild`)\n\n- `__init__.py`: top-level docbuilder, contains classes for the various documents (e.g. reference manual).\n\n- `__main__.py`: stub entry point for `sage --docbuild`, calls `main()` from `__init__.py`\n\n- `build_options.py`: Parse the option for building.\n\n- `sphinxbuild.py`: Sage's version of the sphinx-build script\n\n   mainly deals with logging and error reporting.\n\n**src/sage_docbuild/ext** (was `src/sage_setup/docbuild/ext`)\n\n\n- `inventory_builder.py`:\n\n    A customized HTML builder which only generates intersphinx \"object.inv\"\n    inventory files and pickle files. The documentation files are not written.\n    This is supposed to be used with multidocs below.\n\n- `multidocs.py`:\n\n    The goal of this extension is to manage a multi documentation in Sphinx.\n    To be able to compile Sage's huge documentation in parallel, the\n    documentation is cut into a bunch of independent documentations called\n    \"subdocs\", which are compiled separately. There is a master document which\n    points to all the subdocs. The intersphinx extension ensures that the\n    cross-link between the subdocs are correctly resolved. However some work\n    is needed to build a global index. This is the goal of multidocs.\n\n    More precisely this extension ensures the correct merging of\n\n        1. the todo list if this extension is activated;\n        2. the python indexes;\n        3. the list of python modules;\n        4. the javascript index;\n        5. the citations.\n\n- `sage_autodoc.py`\n\n    This is a patched version of sphinx.ext.autodoc, which started to diverge\n    before 2011. As far as I (Florent) understand, the role here is to\n\n        1. allows to correctly fetch the Cython doc and argspec\n        2. get correctly the argspec of callable (from the _sage_argspec_\n           attribute) #9976\n        3. deals correctly with LazyImport #17455\n        4. In particular document CachedFunction as a function and not a class\n           instance #9976.\n        5. correctly handles classe aliases and nested classed #7448 #5986\n\n    This file probably need to be completely reworked since Sphinx seems to\n    have now various plugin and Mixin.\n\n**src/sage/misc**\n\n- `sphinxify.py`\n\n    script which calls Sphinx to format a single docstring for help from the\n    command line or the notebook. Has its own configuration.\n\n\nCC:  @egourgoulhon @jhpalmieri @dimpase @kwankyu @haraldschilly\n\nStatus: new\n\nIssue created by migration from https://trac.sagemath.org/ticket/20080\n\n",
    "created_at": "2016-02-18T14:52:48Z",
    "labels": [
        "component: documentation"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Meta-ticket: Sage docbuild",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/20080",
    "user": "https://github.com/nthiery"
}
```
Docbuild tickets:

- #30010 Split sage_setup.docbuild out to a separate distribution (distutils package)
- #31353 `sage --docbuild`: Add options to list all documents
- #31936 docbuild: Japanese characters creeping into other parts of Sage documentation
- #31366 docbuild: switch from `optparse` to `argparse`
- #31948 Reimplement parallel docbuild using `make`
- #29868 pip-installable packages `sage-doc-html`, `sage-doc-pdf`
- #30369 Parallel docbuild, cythonization: Use GNU make's POSIX jobserver protocol
- #30475 `sage -docbuild`: error building docs of single file with relative imports
- #6389 expose building documentation for user modules not in the Sage library
- #30418 Missing PDF icons in the Sage documentation website
- #28376 Shrink Documentation
- #31415 GH Actions workflow that deploys built documentation
- #29868 pip-installable packages sagemath-doc-src, sagemath-doc-inventory, sagemath-doc-html, sagemath-doc-pdf
- https://github.com/sagemath/documentation/issues/24 (Versioned Sage documentation)

Sphinx tickets:

- #31696 Sphinx/docutils update for Sage 9.4
- #27578 Use `sphinx.util.inspect.Signature` not `sphinx.ext.autodoc.inspector.formatargspec`
- #27164 link sphinx docs of Sage components in reference manual
- #29231 add intersphinx mapping for SciPy
- #27495 Use `sphinx.ext.extlinks` to add Sphinx roles for links to external package docs
- #30893 Replace sage autodoc extension by built-in one
- #30894 Add typing info to documentation using `sphinx_autodoc_typehints`

See also: 

- #20893 Meta-ticket: Improve live documentation in the Jupyter notebook

---

**Overview of Sphinx custom code in Sage's documentation build system**

The goal of this ticket is to write an overview of the various bits and pieces of custom Sphinx code in Sage, with the long term goal to see which pieces could be:
- thrown away, using features that are now in Sphinx
- generalized and submitted upstream
- cleaned up

Here is a list of files with their relative roles:

**src/sage/docs**

- `__init__.py`: empty file

- `conf.py`: standard Sphinx configuration file.

**src/sage_docbuild** (was `src/sage_setup/docbuild`)

- `__init__.py`: top-level docbuilder, contains classes for the various documents (e.g. reference manual).

- `__main__.py`: stub entry point for `sage --docbuild`, calls `main()` from `__init__.py`

- `build_options.py`: Parse the option for building.

- `sphinxbuild.py`: Sage's version of the sphinx-build script

   mainly deals with logging and error reporting.

**src/sage_docbuild/ext** (was `src/sage_setup/docbuild/ext`)


- `inventory_builder.py`:

    A customized HTML builder which only generates intersphinx "object.inv"
    inventory files and pickle files. The documentation files are not written.
    This is supposed to be used with multidocs below.

- `multidocs.py`:

    The goal of this extension is to manage a multi documentation in Sphinx.
    To be able to compile Sage's huge documentation in parallel, the
    documentation is cut into a bunch of independent documentations called
    "subdocs", which are compiled separately. There is a master document which
    points to all the subdocs. The intersphinx extension ensures that the
    cross-link between the subdocs are correctly resolved. However some work
    is needed to build a global index. This is the goal of multidocs.

    More precisely this extension ensures the correct merging of

        1. the todo list if this extension is activated;
        2. the python indexes;
        3. the list of python modules;
        4. the javascript index;
        5. the citations.

- `sage_autodoc.py`

    This is a patched version of sphinx.ext.autodoc, which started to diverge
    before 2011. As far as I (Florent) understand, the role here is to

        1. allows to correctly fetch the Cython doc and argspec
        2. get correctly the argspec of callable (from the _sage_argspec_
           attribute) #9976
        3. deals correctly with LazyImport #17455
        4. In particular document CachedFunction as a function and not a class
           instance #9976.
        5. correctly handles classe aliases and nested classed #7448 #5986

    This file probably need to be completely reworked since Sphinx seems to
    have now various plugin and Mixin.

**src/sage/misc**

- `sphinxify.py`

    script which calls Sphinx to format a single docstring for help from the
    command line or the notebook. Has its own configuration.


CC:  @egourgoulhon @jhpalmieri @dimpase @kwankyu @haraldschilly

Status: new

Issue created by migration from https://trac.sagemath.org/ticket/20080





---

archive/issue_comments_272368.json:
```json
{
    "body": "<a id='comment:6'></a>I would like to mention `sphinxify.py` which is currently part of `sagenb` but should be moved to inside `sage` proper ASAP. `sphinxify` is called from `sage/misc/sagedoc.py` both at doc building time and run time.",
    "created_at": "2016-02-18T20:09:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20080",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20080#issuecomment-272368",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:6'></a>I would like to mention `sphinxify.py` which is currently part of `sagenb` but should be moved to inside `sage` proper ASAP. `sphinxify` is called from `sage/misc/sagedoc.py` both at doc building time and run time.



---

archive/issue_comments_272369.json:
```json
{
    "body": "<a id='comment:10'></a>> I would like to mention `sphinxify.py` which is currently part of `sagenb` but should be moved to inside `sage` proper ASAP. `sphinxify` is called from `sage/misc/sagedoc.py` both at doc building time and run time. \n\n\nI'm open to PRs, as this seems pretty reasonable - docbuild shouldn't depend on sagenb, though we would still want the doc to work from within it.",
    "created_at": "2016-02-23T18:04:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20080",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20080#issuecomment-272369",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:10'></a>> I would like to mention `sphinxify.py` which is currently part of `sagenb` but should be moved to inside `sage` proper ASAP. `sphinxify` is called from `sage/misc/sagedoc.py` both at doc building time and run time. 


I'm open to PRs, as this seems pretty reasonable - docbuild shouldn't depend on sagenb, though we would still want the doc to work from within it.



---

archive/issue_comments_272370.json:
```json
{
    "body": "<a id='comment:12'></a>Could someone clarify what\n\n> This is a slightly hacked-up version of the Sphinx-multidoc plugin\n\n\nmeans?\n\nI can't find any reference to a Sphinx multidoc plugin outside of Sage.",
    "created_at": "2016-07-27T10:09:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20080",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20080#issuecomment-272370",
    "user": "https://github.com/embray"
}
```

<a id='comment:12'></a>Could someone clarify what

> This is a slightly hacked-up version of the Sphinx-multidoc plugin


means?

I can't find any reference to a Sphinx multidoc plugin outside of Sage.



---

archive/issue_comments_272371.json:
```json
{
    "body": "<a id='comment:13'></a>Fixed :-)",
    "created_at": "2016-07-27T10:13:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20080",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20080#issuecomment-272371",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:13'></a>Fixed :-)



---

archive/issue_comments_272372.json:
```json
{
    "body": "<a id='comment:15'></a>I'm having \"fun\" finally taking the time to fully understand the doc builds system... :)",
    "created_at": "2016-07-27T10:19:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20080",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20080#issuecomment-272372",
    "user": "https://github.com/embray"
}
```

<a id='comment:15'></a>I'm having "fun" finally taking the time to fully understand the doc builds system... :)



---

archive/issue_comments_272373.json:
```json
{
    "body": "<a id='comment:16'></a>it would be a good idea to revise this, or perhaps just start from scratch. It's not clear to me whether most/all of this can be achieved with vanilla Sphinx 3 or 4.",
    "created_at": "2020-06-29T09:46:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20080",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20080#issuecomment-272373",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:16'></a>it would be a good idea to revise this, or perhaps just start from scratch. It's not clear to me whether most/all of this can be achieved with vanilla Sphinx 3 or 4.



---

archive/issue_comments_272374.json:
```json
{
    "body": "<a id='comment:17'></a>Related: #30010\t- Split sage_setup.docbuild out to a separate distribution (distutils package)",
    "created_at": "2020-07-16T19:39:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20080",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20080#issuecomment-272374",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:17'></a>Related: #30010	- Split sage_setup.docbuild out to a separate distribution (distutils package)



---

archive/issue_comments_272375.json:
```json
{
    "body": "<a id='comment:18'></a>One of sphinx devs, \nTakeshi KOMIYA, is going to do a comparison with \"native\" sphinx for the reference manual - https://github.com/sphinx-doc/sphinx/issues/7891",
    "created_at": "2020-07-17T07:44:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20080",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20080#issuecomment-272375",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:18'></a>One of sphinx devs, 
Takeshi KOMIYA, is going to do a comparison with "native" sphinx for the reference manual - https://github.com/sphinx-doc/sphinx/issues/7891



---

archive/issue_comments_272376.json:
```json
{
    "body": "<a id='comment:19'></a>Cool!",
    "created_at": "2020-07-21T07:28:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20080",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20080#issuecomment-272376",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:19'></a>Cool!



---

archive/issue_events_054662.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-08T23:11:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/20080",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20080#event-54662"
}
```



---

archive/issue_comments_272377.json:
```json
{
    "body": "<a id='comment:23'></a>Setting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-02-13T20:51:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20080",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20080#issuecomment-272377",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:23'></a>Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_events_054663.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T20:51:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/20080",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20080#event-54663"
}
```



---

archive/issue_events_054664.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T20:51:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/20080",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20080#event-54664"
}
```



---

archive/issue_events_054665.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-10T17:30:20Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/20080",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20080#event-54665"
}
```



---

archive/issue_events_054666.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-10T17:30:20Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/20080",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20080#event-54666"
}
```



---

archive/issue_events_054667.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:41:23Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/20080",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20080#event-54667"
}
```



---

archive/issue_events_054668.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:41:23Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/20080",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20080#event-54668"
}
```



---

archive/issue_events_054669.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-05-03T15:17:06Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/20080",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20080#event-54669"
}
```



---

archive/issue_events_054670.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-05-03T15:17:06Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/20080",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20080#event-54670"
}
```



---

archive/issue_events_054671.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/20080",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20080#event-54671"
}
```



---

archive/issue_events_054672.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/20080",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20080#event-54672"
}
```
