# Issue 20561: Return cycle type of a permutation

archive/issues_020324.json:
```json
{
    "body": "Given an element of a permutation group, which automatically comes equipped with a fixed embedding into a symmetric group, return the cycle type of the permutation as a partition.\n\n```python\nsage: G=DihedralGroup(3)\nsage: [g.cycle_type() for g in G]\n[[1, 1, 1], [2, 1], [3], [2, 1], [3], [2, 1]]\nsage: PermutationGroupElement('(1,2,3)(4,5)(6,7,8)').cycle_type()\n[3, 3, 2]\nsage: G=SymmetricGroup(3); G('(1,2)').cycle_type()\n[2, 1]\nsage: G=SymmetricGroup(4); G('(1,2)').cycle_type()\n[2, 1, 1]\n```\n\n**Keywords:** permutation, cycle type\n\n**Branch/Commit:** [35145b98cacc56bdee36bc8836218d6c4dec5e06](https://github.com/sagemath/sagetrac-mirror/commit/35145b98cacc56bdee36bc8836218d6c4dec5e06)\n\n**Reviewer:** Vincent Delecroix, Travis Scrimshaw\n\n**Author:** Andrew Mathas\n\n**Resolution:** fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/20561\n\n",
    "closed_at": "2016-05-19T22:38:42Z",
    "created_at": "2016-05-05T00:26:00Z",
    "labels": [
        "component: group theory"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.3",
    "title": "Return cycle type of a permutation",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/20561",
    "user": "https://github.com/AndrewAtLarge"
}
```
Given an element of a permutation group, which automatically comes equipped with a fixed embedding into a symmetric group, return the cycle type of the permutation as a partition.

```python
sage: G=DihedralGroup(3)
sage: [g.cycle_type() for g in G]
[[1, 1, 1], [2, 1], [3], [2, 1], [3], [2, 1]]
sage: PermutationGroupElement('(1,2,3)(4,5)(6,7,8)').cycle_type()
[3, 3, 2]
sage: G=SymmetricGroup(3); G('(1,2)').cycle_type()
[2, 1]
sage: G=SymmetricGroup(4); G('(1,2)').cycle_type()
[2, 1, 1]
```

**Keywords:** permutation, cycle type

**Branch/Commit:** [35145b98cacc56bdee36bc8836218d6c4dec5e06](https://github.com/sagemath/sagetrac-mirror/commit/35145b98cacc56bdee36bc8836218d6c4dec5e06)

**Reviewer:** Vincent Delecroix, Travis Scrimshaw

**Author:** Andrew Mathas

**Resolution:** fixed

Issue created by migration from https://trac.sagemath.org/ticket/20561





---

archive/issue_comments_376833.json:
```json
{
    "body": "**Branch:** [u/andrew.mathas/return_cycle_type_of_a_permutation](https://github.com/sagemath/sagetrac-mirror/tree/u/andrew.mathas/return_cycle_type_of_a_permutation)",
    "created_at": "2016-05-05T01:00:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20561#issuecomment-376833",
    "user": "https://github.com/AndrewAtLarge"
}
```

**Branch:** [u/andrew.mathas/return_cycle_type_of_a_permutation](https://github.com/sagemath/sagetrac-mirror/tree/u/andrew.mathas/return_cycle_type_of_a_permutation)



---

archive/issue_comments_376834.json:
```json
{
    "body": "**Changing keywords** from \"\" to \"permutation, cycle type\".",
    "created_at": "2016-05-05T01:04:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20561#issuecomment-376834",
    "user": "https://github.com/AndrewAtLarge"
}
```

**Changing keywords** from "" to "permutation, cycle type".



---

archive/issue_comments_376835.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1,13 @@\n+Given an element of a permutation group, with a fixed embedding in a symmetric group, return the cycle type of the permutation as a partition.\n \n+```python\n+sage: G=DihedralGroup(3)\n+sage: [g.cycle_type() for g in G]\n+[[1, 1, 1], [2, 1], [3], [2, 1], [3], [2, 1]]\n+sage: PermutationGroupElement('(1,2,3)(4,5)(6,7,8)').cycle_type()\n+[3, 3, 2]\n+sage: G=SymmetricGroup(3); G('(1,2)').cycle_type()\n+[2, 1]\n+sage: G=SymmetricGroup(4); G('(1,2)').cycle_type()\n+[2, 1, 1]\n+```\n``````\n",
    "created_at": "2016-05-05T01:04:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20561#issuecomment-376835",
    "user": "https://github.com/AndrewAtLarge"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1,13 @@
+Given an element of a permutation group, with a fixed embedding in a symmetric group, return the cycle type of the permutation as a partition.
 
+```python
+sage: G=DihedralGroup(3)
+sage: [g.cycle_type() for g in G]
+[[1, 1, 1], [2, 1], [3], [2, 1], [3], [2, 1]]
+sage: PermutationGroupElement('(1,2,3)(4,5)(6,7,8)').cycle_type()
+[3, 3, 2]
+sage: G=SymmetricGroup(3); G('(1,2)').cycle_type()
+[2, 1]
+sage: G=SymmetricGroup(4); G('(1,2)').cycle_type()
+[2, 1, 1]
+```
``````




---

archive/issue_comments_376836.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2016-05-05T01:04:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20561#issuecomment-376836",
    "user": "https://github.com/AndrewAtLarge"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_376837.json:
```json
{
    "body": "**Author:** Andrew Mathas",
    "created_at": "2016-05-05T01:04:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20561#issuecomment-376837",
    "user": "https://github.com/AndrewAtLarge"
}
```

**Author:** Andrew Mathas



---

archive/issue_comments_376838.json:
```json
{
    "body": "**Commit:** [c04fdff1839694b538a231c4c7a7dce25da9f2fc](https://github.com/sagemath/sagetrac-mirror/commit/c04fdff1839694b538a231c4c7a7dce25da9f2fc)",
    "created_at": "2016-05-05T01:04:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20561#issuecomment-376838",
    "user": "https://github.com/AndrewAtLarge"
}
```

**Commit:** [c04fdff1839694b538a231c4c7a7dce25da9f2fc](https://github.com/sagemath/sagetrac-mirror/commit/c04fdff1839694b538a231c4c7a7dce25da9f2fc)



---

archive/issue_comments_376839.json:
```json
{
    "body": "**Changing commit** from \"[c04fdff1839694b538a231c4c7a7dce25da9f2fc](https://github.com/sagemath/sagetrac-mirror/commit/c04fdff1839694b538a231c4c7a7dce25da9f2fc)\" to \"[64ee9b244f92ded2b5052b2b23a7eee42d07bf05](https://github.com/sagemath/sagetrac-mirror/commit/64ee9b244f92ded2b5052b2b23a7eee42d07bf05)\".",
    "created_at": "2016-05-05T01:06:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20561#issuecomment-376839",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[c04fdff1839694b538a231c4c7a7dce25da9f2fc](https://github.com/sagemath/sagetrac-mirror/commit/c04fdff1839694b538a231c4c7a7dce25da9f2fc)" to "[64ee9b244f92ded2b5052b2b23a7eee42d07bf05](https://github.com/sagemath/sagetrac-mirror/commit/64ee9b244f92ded2b5052b2b23a7eee42d07bf05)".



---

archive/issue_comments_376840.json:
```json
{
    "body": "<a id='comment:3'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/64ee9b244f92ded2b5052b2b23a7eee42d07bf05\">64ee9b2</a></td><td><code>Implementation of cycle_type</code></td></tr></table>\n",
    "created_at": "2016-05-05T01:06:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20561#issuecomment-376840",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/64ee9b244f92ded2b5052b2b23a7eee42d07bf05">64ee9b2</a></td><td><code>Implementation of cycle_type</code></td></tr></table>




---

archive/issue_comments_376841.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-Given an element of a permutation group, with a fixed embedding in a symmetric group, return the cycle type of the permutation as a partition.\n+Given an element of a permutation group, which automatically comes equipped with a fixed embedding into a symmetric group, return the cycle type of the permutation as a partition.\n \n ```python\n sage: G=DihedralGroup(3)\n``````\n",
    "created_at": "2016-05-05T01:25:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20561#issuecomment-376841",
    "user": "https://github.com/AndrewAtLarge"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-Given an element of a permutation group, with a fixed embedding in a symmetric group, return the cycle type of the permutation as a partition.
+Given an element of a permutation group, which automatically comes equipped with a fixed embedding into a symmetric group, return the cycle type of the permutation as a partition.
 
 ```python
 sage: G=DihedralGroup(3)
``````




---

archive/issue_comments_376842.json:
```json
{
    "body": "<a id='comment:5'></a>\nHello,\n\nYou would better use the option `reverse` of `sort` rather than sorting and inversing.\n\nOn the other hand, constructing the actual cycle tuples to count their length is not optimal... I would rather implement it from scratch.\n\nSided remark: returning a Partition is very costly. Most of the time will be spent in the actual construction of the Partition from the given list.",
    "created_at": "2016-05-08T02:32:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20561#issuecomment-376842",
    "user": "https://github.com/videlec"
}
```

<a id='comment:5'></a>
Hello,

You would better use the option `reverse` of `sort` rather than sorting and inversing.

On the other hand, constructing the actual cycle tuples to count their length is not optimal... I would rather implement it from scratch.

Sided remark: returning a Partition is very costly. Most of the time will be spent in the actual construction of the Partition from the given list.



---

archive/issue_comments_376843.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2016-05-08T02:32:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20561#issuecomment-376843",
    "user": "https://github.com/videlec"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_376844.json:
```json
{
    "body": "<a id='comment:6'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b9acb7729e678ee46ef6db66a694c3040db830d0\">b9acb77</a></td><td><code>Updating as per refereee's comments</code></td></tr></table>\n",
    "created_at": "2016-05-08T13:27:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20561#issuecomment-376844",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b9acb7729e678ee46ef6db66a694c3040db830d0">b9acb77</a></td><td><code>Updating as per refereee's comments</code></td></tr></table>




---

archive/issue_comments_376845.json:
```json
{
    "body": "**Changing commit** from \"[64ee9b244f92ded2b5052b2b23a7eee42d07bf05](https://github.com/sagemath/sagetrac-mirror/commit/64ee9b244f92ded2b5052b2b23a7eee42d07bf05)\" to \"[b9acb7729e678ee46ef6db66a694c3040db830d0](https://github.com/sagemath/sagetrac-mirror/commit/b9acb7729e678ee46ef6db66a694c3040db830d0)\".",
    "created_at": "2016-05-08T13:27:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20561#issuecomment-376845",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[64ee9b244f92ded2b5052b2b23a7eee42d07bf05](https://github.com/sagemath/sagetrac-mirror/commit/64ee9b244f92ded2b5052b2b23a7eee42d07bf05)" to "[b9acb7729e678ee46ef6db66a694c3040db830d0](https://github.com/sagemath/sagetrac-mirror/commit/b9acb7729e678ee46ef6db66a694c3040db830d0)".



---

archive/issue_comments_376846.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2016-05-08T13:34:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20561#issuecomment-376846",
    "user": "https://github.com/AndrewAtLarge"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_376847.json:
```json
{
    "body": "<a id='comment:7'></a>\nReplying to [vdelecroix](#comment%3A5):\n> Hello,\n> \n> You would better use the option `reverse` of `sort` rather than sorting and inversing.\n> \n> Sided remark: returning a Partition is very costly. Most of the time will be spent in the actual construction of the Partition from the given list.\n\n\nI have addressed both of these points: the `reverse=True` is now used and a list is returned.\n\n> On the other hand, constructing the actual cycle tuples to count their length is not optimal... I would rather implement it from scratch.\n\n\nI have not changed this as this seems to be unnecessary code duplication. I have not delved into the cycle code deeply but it seems to me that to extract this information you would essentially rewrite much of the cython code in `cycle_tuples`.",
    "created_at": "2016-05-08T13:34:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20561#issuecomment-376847",
    "user": "https://github.com/AndrewAtLarge"
}
```

<a id='comment:7'></a>
Replying to [vdelecroix](#comment%3A5):
> Hello,
> 
> You would better use the option `reverse` of `sort` rather than sorting and inversing.
> 
> Sided remark: returning a Partition is very costly. Most of the time will be spent in the actual construction of the Partition from the given list.


I have addressed both of these points: the `reverse=True` is now used and a list is returned.

> On the other hand, constructing the actual cycle tuples to count their length is not optimal... I would rather implement it from scratch.


I have not changed this as this seems to be unnecessary code duplication. I have not delved into the cycle code deeply but it seems to me that to extract this information you would essentially rewrite much of the cython code in `cycle_tuples`.



---

archive/issue_comments_376848.json:
```json
{
    "body": "<a id='comment:8'></a>\nConsidering that Sage's permutations return a `Partition`, I think this should also return a `Partition` for consistency. If that extra overhead of constructing a `Partition` is that great, then the act of sorting should be a significant burden as well (which is `O(n log n)` as opposed to `O(n)`).\n\nYou can also get ~10% speedup by using `_Partitions(data)` instead of `Partition(data)`.",
    "created_at": "2016-05-08T14:49:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20561#issuecomment-376848",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:8'></a>
Considering that Sage's permutations return a `Partition`, I think this should also return a `Partition` for consistency. If that extra overhead of constructing a `Partition` is that great, then the act of sorting should be a significant burden as well (which is `O(n log n)` as opposed to `O(n)`).

You can also get ~10% speedup by using `_Partitions(data)` instead of `Partition(data)`.



---

archive/issue_comments_376849.json:
```json
{
    "body": "<a id='comment:9'></a>\nOn a random example **all** the time is taken by actually constructing the partition.\n\n```\nsage: S = SymmetricGroup(20)\nsage: p = S.random_element()\nsage: %timeit c = p.cycle_tuples()\n1000000 loops, best of 3: 1.04 \u00b5s per loop\nsage: c = p.cycle_tuples()\nsage: %timeit l = map(len, c)\n1000000 loops, best of 3: 382 ns per loop\nsage: l = map(len, c)\nsage: %timeit ls = sorted(l, reverse=True)\n1000000 loops, best of 3: 889 ns per loop\nsage: ls = sorted(l, reverse=True)\nsage: %timeit p = Partition(ls)\n10000 loops, best of 3: 14.5 \u00b5s per loop\n```",
    "created_at": "2016-05-08T18:11:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20561#issuecomment-376849",
    "user": "https://github.com/videlec"
}
```

<a id='comment:9'></a>
On a random example **all** the time is taken by actually constructing the partition.

```
sage: S = SymmetricGroup(20)
sage: p = S.random_element()
sage: %timeit c = p.cycle_tuples()
1000000 loops, best of 3: 1.04 µs per loop
sage: c = p.cycle_tuples()
sage: %timeit l = map(len, c)
1000000 loops, best of 3: 382 ns per loop
sage: l = map(len, c)
sage: %timeit ls = sorted(l, reverse=True)
1000000 loops, best of 3: 889 ns per loop
sage: ls = sorted(l, reverse=True)
sage: %timeit p = Partition(ls)
10000 loops, best of 3: 14.5 µs per loop
```



---

archive/issue_comments_376850.json:
```json
{
    "body": "<a id='comment:10'></a>\nYou should fix the `OUTPUT` section.\n\nIn the doctest and the code, there would better be a space on each side of the equality sign `a = b` instead of `a=b`. This is just code convention. But it helps reading if this is uniform.\n \nIt costs nothing to add an option `singletons` to your `cycle_type` method. It is sometimes useful to ignore the fixed points.",
    "created_at": "2016-05-08T18:31:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20561#issuecomment-376850",
    "user": "https://github.com/videlec"
}
```

<a id='comment:10'></a>
You should fix the `OUTPUT` section.

In the doctest and the code, there would better be a space on each side of the equality sign `a = b` instead of `a=b`. This is just code convention. But it helps reading if this is uniform.
 
It costs nothing to add an option `singletons` to your `cycle_type` method. It is sometimes useful to ignore the fixed points.



---

archive/issue_comments_376851.json:
```json
{
    "body": "<a id='comment:11'></a>\nI get much less percentage of time to construct a partition:\n\n```\nsage: S = SymmetricGroup(100)\nsage: p = S.random_element()\nsage: p\n(1,60,19,34,68,36,55,29,54,89,23,87,99,95,31,24,83,98,6,82,2,10,76,5,80,52,32,77,22,37,93)(3,91,8,90,67,59,33,58,64,66,63,12,78,75,70,51,86,96,56,25,69,81,27,28,13,94,17,62,88,47,49,4,16,65,74,14,85,20,39,9,92,72,71,40,30,50,11,35,44,43)(7,84,45,73,38,21,61,97,53,18,41,79,26,100,42,48,57)(15,46)\nsage: %timeit c = p.cycle_tuples()\n100000 loops, best of 3: 3.63 \u00b5s per loop\nsage: c = p.cycle_tuples(singletons=True)\nsage: %timeit l = [len(x) for x in c]\n1000000 loops, best of 3: 286 ns per loop\nsage: l = [len(x) for x in c]\nsage: %timeit ls = sorted(l, reverse=True)\n1000000 loops, best of 3: 995 ns per loop\nsage: ls = sorted(l, reverse=True)\nsage: P = Partitions()\nsage: %timeit p = P(ls)\n100000 loops, best of 3: 8.92 \u00b5s per loop\n```\nBesides, not everything has to be ultra-super-optimized (plus these operations are not being compared fairly since the `Partition` call is Python). In this case, the consistency is much more desirable. (Technically to be fair, you need to include the singletons, but I believe these are \"rare\".) Averaging over all partitions and using `%lprun`, I get that it takes ~80% of the time.\n\nI would say what would need to be done is improve the creation time of partitions if this is an issue for you Vincent.\n\nAlso, I don't know how it would make sense to disregard singletons. They are needed because the cycle types (with cycle types) determine the conjugacy classes of the symmetric group.\n\nSide note: if you really care about speed, you should use `list.sort(reverse=True)` because it does it in place and does not create a second list.",
    "created_at": "2016-05-08T18:40:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20561#issuecomment-376851",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:11'></a>
I get much less percentage of time to construct a partition:

```
sage: S = SymmetricGroup(100)
sage: p = S.random_element()
sage: p
(1,60,19,34,68,36,55,29,54,89,23,87,99,95,31,24,83,98,6,82,2,10,76,5,80,52,32,77,22,37,93)(3,91,8,90,67,59,33,58,64,66,63,12,78,75,70,51,86,96,56,25,69,81,27,28,13,94,17,62,88,47,49,4,16,65,74,14,85,20,39,9,92,72,71,40,30,50,11,35,44,43)(7,84,45,73,38,21,61,97,53,18,41,79,26,100,42,48,57)(15,46)
sage: %timeit c = p.cycle_tuples()
100000 loops, best of 3: 3.63 µs per loop
sage: c = p.cycle_tuples(singletons=True)
sage: %timeit l = [len(x) for x in c]
1000000 loops, best of 3: 286 ns per loop
sage: l = [len(x) for x in c]
sage: %timeit ls = sorted(l, reverse=True)
1000000 loops, best of 3: 995 ns per loop
sage: ls = sorted(l, reverse=True)
sage: P = Partitions()
sage: %timeit p = P(ls)
100000 loops, best of 3: 8.92 µs per loop
```
Besides, not everything has to be ultra-super-optimized (plus these operations are not being compared fairly since the `Partition` call is Python). In this case, the consistency is much more desirable. (Technically to be fair, you need to include the singletons, but I believe these are "rare".) Averaging over all partitions and using `%lprun`, I get that it takes ~80% of the time.

I would say what would need to be done is improve the creation time of partitions if this is an issue for you Vincent.

Also, I don't know how it would make sense to disregard singletons. They are needed because the cycle types (with cycle types) determine the conjugacy classes of the symmetric group.

Side note: if you really care about speed, you should use `list.sort(reverse=True)` because it does it in place and does not create a second list.



---

archive/issue_comments_376852.json:
```json
{
    "body": "<a id='comment:12'></a>\nReplying to [tscrim](#comment%3A11):\n\n> I get much less percentage of time to construct a partition:\n\n\nYour code is not the same as mine since you ignore the creation of the parent. In Andrew's code the call is precisely `Partition(ls)`. You should time the call `P = Partitions(); p = P(ls)`.\n\n> Besides, not everything has to be ultra-super-optimized (plus these operations are not being compared fairly since the `Partition` call is Python). In this case, the consistency is much more desirable. (Technically to be fair, you need to include the singletons, but I believe these are \"rare\".) Averaging over all partitions and using `%lprun`, I get that it takes ~80% of the time.\n\n\nA 80% gain is not what I would call super-optimization.\n\n> I would say what would need to be done is improve the creation time of partitions if this is an issue for you Vincent.\n\n\nCreating a partition from a tuple is trivial at no extra cost: just do `Partition(l)`. On the other hand, creating a list from a partition is: `list(p)` and this costs a >80% slow down.\n\n> Also, I don't know how it would make sense to disregard singletons. They are needed because the cycle types (with cycle types) determine the conjugacy classes of the symmetric group.\n\n\nIt makes sense in a lot of situations. Especially when you count solutions of equations in the symmetric group. Getting the conjugacy is not the only important thing.\n\n> Side note: if you really care about speed, you should use `list.sort(reverse=True)` because it does it in place and does not create a second list.\n\n\nThis is precisely what is done in Andrew's code and that I asked for in [comment:5].",
    "created_at": "2016-05-08T18:52:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20561#issuecomment-376852",
    "user": "https://github.com/videlec"
}
```

<a id='comment:12'></a>
Replying to [tscrim](#comment%3A11):

> I get much less percentage of time to construct a partition:


Your code is not the same as mine since you ignore the creation of the parent. In Andrew's code the call is precisely `Partition(ls)`. You should time the call `P = Partitions(); p = P(ls)`.

> Besides, not everything has to be ultra-super-optimized (plus these operations are not being compared fairly since the `Partition` call is Python). In this case, the consistency is much more desirable. (Technically to be fair, you need to include the singletons, but I believe these are "rare".) Averaging over all partitions and using `%lprun`, I get that it takes ~80% of the time.


A 80% gain is not what I would call super-optimization.

> I would say what would need to be done is improve the creation time of partitions if this is an issue for you Vincent.


Creating a partition from a tuple is trivial at no extra cost: just do `Partition(l)`. On the other hand, creating a list from a partition is: `list(p)` and this costs a >80% slow down.

> Also, I don't know how it would make sense to disregard singletons. They are needed because the cycle types (with cycle types) determine the conjugacy classes of the symmetric group.


It makes sense in a lot of situations. Especially when you count solutions of equations in the symmetric group. Getting the conjugacy is not the only important thing.

> Side note: if you really care about speed, you should use `list.sort(reverse=True)` because it does it in place and does not create a second list.


This is precisely what is done in Andrew's code and that I asked for in [comment:5].



---

archive/issue_comments_376853.json:
```json
{
    "body": "<a id='comment:13'></a>\nReplying to [vdelecroix](#comment%3A12):\n> Replying to [tscrim](#comment%3A11):\n> \n> > I get much less percentage of time to construct a partition:\n\n> \n> Your code is not the same as mine since you ignore the creation of the parent. In Andrew's code the call is precisely `Partition(ls)`. You should time the call `P = Partitions(); p = P(ls)`.\n\n\nSee the last part of[comment:8](#comment%3A8).\n\n> > Besides, not everything has to be ultra-super-optimized (plus these operations are not being compared fairly since the `Partition` call is Python). In this case, the consistency is much more desirable. (Technically to be fair, you need to include the singletons, but I believe these are \"rare\".) Averaging over all partitions and using `%lprun`, I get that it takes ~80% of the time.\n\n> \n> A 80% gain is not what I would call super-optimization.\n\n\nI forgot that sarcasm can be lost. Let me be more precise, we don't have to optimize everything, and it is not like it causes a significant slowdown. This is on the order of microseconds.\n\n> > I would say what would need to be done is improve the creation time of partitions if this is an issue for you Vincent.\n\n> \n> Creating a partition from a tuple is trivial at no extra cost: just do `Partition(l)`. On the other hand, creating a list from a partition is: `list(p)` and this costs a >80% slow down.\n\n\nDespite how loaded your phrasing is, you should not be doing `list(p)` because partitions behave like lists (well, more like tuples). We also want to make things accessible to the user, and in particular, the conjugacy classes of permutations are always considered as partitions in the areas I know. So this makes things nice for the non-programmer-users who would expect this to be a partition.\n\nAgain, having this not return a partition would introduce an inconsistency with `cycle_type` of `Permutation`.\n\n> > Also, I don't know how it would make sense to disregard singletons. They are needed because the cycle types (with cycle types) determine the conjugacy classes of the symmetric group.\n\n> \n> It makes sense in a lot of situations. Especially when you count solutions of equations in the symmetric group. Getting the conjugacy is not the only important thing.\n\n\nThen just use the cycle tuples; it doesn't sound like you care about the ordering.\n\n> > Side note: if you really care about speed, you should use `list.sort(reverse=True)` because it does it in place and does not create a second list.\n\n\n> This is precisely what is done in Andrew's code and that I asked for in [comment:5].\n\n\nAh, sorry; I misread that comment (I thought you said `sorted`).",
    "created_at": "2016-05-08T19:09:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20561#issuecomment-376853",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:13'></a>
Replying to [vdelecroix](#comment%3A12):
> Replying to [tscrim](#comment%3A11):
> 
> > I get much less percentage of time to construct a partition:

> 
> Your code is not the same as mine since you ignore the creation of the parent. In Andrew's code the call is precisely `Partition(ls)`. You should time the call `P = Partitions(); p = P(ls)`.


See the last part of[comment:8](#comment%3A8).

> > Besides, not everything has to be ultra-super-optimized (plus these operations are not being compared fairly since the `Partition` call is Python). In this case, the consistency is much more desirable. (Technically to be fair, you need to include the singletons, but I believe these are "rare".) Averaging over all partitions and using `%lprun`, I get that it takes ~80% of the time.

> 
> A 80% gain is not what I would call super-optimization.


I forgot that sarcasm can be lost. Let me be more precise, we don't have to optimize everything, and it is not like it causes a significant slowdown. This is on the order of microseconds.

> > I would say what would need to be done is improve the creation time of partitions if this is an issue for you Vincent.

> 
> Creating a partition from a tuple is trivial at no extra cost: just do `Partition(l)`. On the other hand, creating a list from a partition is: `list(p)` and this costs a >80% slow down.


Despite how loaded your phrasing is, you should not be doing `list(p)` because partitions behave like lists (well, more like tuples). We also want to make things accessible to the user, and in particular, the conjugacy classes of permutations are always considered as partitions in the areas I know. So this makes things nice for the non-programmer-users who would expect this to be a partition.

Again, having this not return a partition would introduce an inconsistency with `cycle_type` of `Permutation`.

> > Also, I don't know how it would make sense to disregard singletons. They are needed because the cycle types (with cycle types) determine the conjugacy classes of the symmetric group.

> 
> It makes sense in a lot of situations. Especially when you count solutions of equations in the symmetric group. Getting the conjugacy is not the only important thing.


Then just use the cycle tuples; it doesn't sound like you care about the ordering.

> > Side note: if you really care about speed, you should use `list.sort(reverse=True)` because it does it in place and does not create a second list.


> This is precisely what is done in Andrew's code and that I asked for in [comment:5].


Ah, sorry; I misread that comment (I thought you said `sorted`).



---

archive/issue_comments_376854.json:
```json
{
    "body": "**Changing commit** from \"[b9acb7729e678ee46ef6db66a694c3040db830d0](https://github.com/sagemath/sagetrac-mirror/commit/b9acb7729e678ee46ef6db66a694c3040db830d0)\" to \"[18f179963a10ef1b0facb71591f88080f3f0ba1a](https://github.com/sagemath/sagetrac-mirror/commit/18f179963a10ef1b0facb71591f88080f3f0ba1a)\".",
    "created_at": "2016-05-09T07:56:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20561#issuecomment-376854",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[b9acb7729e678ee46ef6db66a694c3040db830d0](https://github.com/sagemath/sagetrac-mirror/commit/b9acb7729e678ee46ef6db66a694c3040db830d0)" to "[18f179963a10ef1b0facb71591f88080f3f0ba1a](https://github.com/sagemath/sagetrac-mirror/commit/18f179963a10ef1b0facb71591f88080f3f0ba1a)".



---

archive/issue_comments_376855.json:
```json
{
    "body": "<a id='comment:14'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/18f179963a10ef1b0facb71591f88080f3f0ba1a\">18f1799</a></td><td><code>Merge branch 'develop' into t/20561/return_cycle_type_of_a_permutation</code></td></tr></table>\n",
    "created_at": "2016-05-09T07:56:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20561#issuecomment-376855",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/18f179963a10ef1b0facb71591f88080f3f0ba1a">18f1799</a></td><td><code>Merge branch 'develop' into t/20561/return_cycle_type_of_a_permutation</code></td></tr></table>




---

archive/issue_comments_376856.json:
```json
{
    "body": "**Changing commit** from \"[18f179963a10ef1b0facb71591f88080f3f0ba1a](https://github.com/sagemath/sagetrac-mirror/commit/18f179963a10ef1b0facb71591f88080f3f0ba1a)\" to \"[35145b98cacc56bdee36bc8836218d6c4dec5e06](https://github.com/sagemath/sagetrac-mirror/commit/35145b98cacc56bdee36bc8836218d6c4dec5e06)\".",
    "created_at": "2016-05-09T07:59:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20561#issuecomment-376856",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[18f179963a10ef1b0facb71591f88080f3f0ba1a](https://github.com/sagemath/sagetrac-mirror/commit/18f179963a10ef1b0facb71591f88080f3f0ba1a)" to "[35145b98cacc56bdee36bc8836218d6c4dec5e06](https://github.com/sagemath/sagetrac-mirror/commit/35145b98cacc56bdee36bc8836218d6c4dec5e06)".



---

archive/issue_comments_376857.json:
```json
{
    "body": "<a id='comment:15'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/35145b98cacc56bdee36bc8836218d6c4dec5e06\">35145b9</a></td><td><code>Adding comment about using as_list for speed</code></td></tr></table>\n",
    "created_at": "2016-05-09T07:59:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20561#issuecomment-376857",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/35145b98cacc56bdee36bc8836218d6c4dec5e06">35145b9</a></td><td><code>Adding comment about using as_list for speed</code></td></tr></table>




---

archive/issue_comments_376858.json:
```json
{
    "body": "<a id='comment:16'></a>\nI am amused how much bandwidth such a trivial ticket can generate:)\n\nI agree with Vincent that allowing singletons to be ignored will probably be useful, is more consistent with the other `cycle_*` methods and that it is trivial to implement. For all of these reasons, it should be implemented so I have added an optional `singletons` argument for this.\n\nI also agree with Travis that the casual user will expect that `cycle_type` will return a partition so I have made this the default, using `_Partitions` as Travis recommends. The non-casual user may well not want a partition so I have added a second optional argument `as_list` that , when `True`, will cause a list to be returned.\n\nHere are some new timings with these changes:\n\n```python\nsage: S = SymmetricGroup(100)\nsage: p = S.random_element()\nsage:  %timeit c = p.cycle_type()\n10000 loops, best of 3: 47.5 \u00b5s per loop\nsage: %timeit c = p.cycle_type(singletons=True)\n10000 loops, best of 3: 50.2 \u00b5s per loop\nsage: %timeit c = p.cycle_type(as_list=True)\n100000 loops, best of 3: 11.9 \u00b5s per loop\nsage: %timeit c = p.cycle_type(singletons=True, as_list=True)\n100000 loops, best of 3: 11.6 \u00b5s per loop\nsage: %timeit c = p.cycle_tuples()\n100000 loops, best of 3: 9.83 \u00b5s per loop\n```\n\nSo it seems that returning a partition is relatively costly but I think that it is more user friendly so should be the default. I have added a remark in the documentation that `as_list=True` should be used when speed is an issue.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/18f179963a10ef1b0facb71591f88080f3f0ba1a\">18f1799</a></td><td><code>Merge branch 'develop' into t/20561/return_cycle_type_of_a_permutation</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/35145b98cacc56bdee36bc8836218d6c4dec5e06\">35145b9</a></td><td><code>Adding comment about using as_list for speed</code></td></tr></table>\n",
    "created_at": "2016-05-09T08:00:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20561#issuecomment-376858",
    "user": "https://github.com/AndrewAtLarge"
}
```

<a id='comment:16'></a>
I am amused how much bandwidth such a trivial ticket can generate:)

I agree with Vincent that allowing singletons to be ignored will probably be useful, is more consistent with the other `cycle_*` methods and that it is trivial to implement. For all of these reasons, it should be implemented so I have added an optional `singletons` argument for this.

I also agree with Travis that the casual user will expect that `cycle_type` will return a partition so I have made this the default, using `_Partitions` as Travis recommends. The non-casual user may well not want a partition so I have added a second optional argument `as_list` that , when `True`, will cause a list to be returned.

Here are some new timings with these changes:

```python
sage: S = SymmetricGroup(100)
sage: p = S.random_element()
sage:  %timeit c = p.cycle_type()
10000 loops, best of 3: 47.5 µs per loop
sage: %timeit c = p.cycle_type(singletons=True)
10000 loops, best of 3: 50.2 µs per loop
sage: %timeit c = p.cycle_type(as_list=True)
100000 loops, best of 3: 11.9 µs per loop
sage: %timeit c = p.cycle_type(singletons=True, as_list=True)
100000 loops, best of 3: 11.6 µs per loop
sage: %timeit c = p.cycle_tuples()
100000 loops, best of 3: 9.83 µs per loop
```

So it seems that returning a partition is relatively costly but I think that it is more user friendly so should be the default. I have added a remark in the documentation that `as_list=True` should be used when speed is an issue.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/18f179963a10ef1b0facb71591f88080f3f0ba1a">18f1799</a></td><td><code>Merge branch 'develop' into t/20561/return_cycle_type_of_a_permutation</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/35145b98cacc56bdee36bc8836218d6c4dec5e06">35145b9</a></td><td><code>Adding comment about using as_list for speed</code></td></tr></table>




---

archive/issue_events_063073.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2016-05-09T14:43:14Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/20561",
    "milestone": "sage-7.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20561#event-63073"
}
```



---

archive/issue_comments_376859.json:
```json
{
    "body": "<a id='comment:17'></a>\nI am okay with it. Vincent (to whom, thank you for your input)?\n\nFrom this, I figure it is about time that we rework `Partition` a bit so that has faster initialization.",
    "created_at": "2016-05-09T14:43:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20561#issuecomment-376859",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:17'></a>
I am okay with it. Vincent (to whom, thank you for your input)?

From this, I figure it is about time that we rework `Partition` a bit so that has faster initialization.



---

archive/issue_comments_376860.json:
```json
{
    "body": "**Reviewer:** Vincent Delecroix, Travis Scrimshaw",
    "created_at": "2016-05-09T14:43:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20561#issuecomment-376860",
    "user": "https://github.com/tscrim"
}
```

**Reviewer:** Vincent Delecroix, Travis Scrimshaw



---

archive/issue_comments_376861.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2016-05-09T21:51:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20561#issuecomment-376861",
    "user": "https://github.com/videlec"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_events_063074.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-05-19T22:38:42Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/20561",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20561#event-63074"
}
```



---

archive/issue_comments_376862.json:
```json
{
    "body": "**Changing branch** from \"[u/andrew.mathas/return_cycle_type_of_a_permutation](https://github.com/sagemath/sagetrac-mirror/tree/u/andrew.mathas/return_cycle_type_of_a_permutation)\" to \"[35145b98cacc56bdee36bc8836218d6c4dec5e06](https://github.com/sagemath/sagetrac-mirror/commit/35145b98cacc56bdee36bc8836218d6c4dec5e06)\".",
    "created_at": "2016-05-19T22:38:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20561#issuecomment-376862",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/andrew.mathas/return_cycle_type_of_a_permutation](https://github.com/sagemath/sagetrac-mirror/tree/u/andrew.mathas/return_cycle_type_of_a_permutation)" to "[35145b98cacc56bdee36bc8836218d6c4dec5e06](https://github.com/sagemath/sagetrac-mirror/commit/35145b98cacc56bdee36bc8836218d6c4dec5e06)".



---

archive/issue_comments_376863.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2016-05-19T22:38:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20561#issuecomment-376863",
    "user": "https://github.com/vbraun"
}
```

**Resolution:** fixed
