# Issue 20565: Fix LinearCode.wtdist_gap method

archive/issues_020328.json:
```json
{
    "body": "There are three main issues with the `wtdist_gap` method namely:\n1) Name of the method\n2) Poor documentation\n3) It should be a private function\n\n\nAssignee: @arpitdm\n\nCC:  dlucas @johanrosenkilde\n\nBranch/Commit: 191d1c4aa70a36e995406abb9d6e5fbb2f96beee\n\nReviewer: David Lucas\n\nAuthor: Arpit Merchant\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/20565\n\n",
    "closed_at": "2016-05-28T14:19:46Z",
    "created_at": "2016-05-06T09:29:54Z",
    "labels": [
        "component: coding theory",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.3",
    "title": "Fix LinearCode.wtdist_gap method",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/20565",
    "user": "https://github.com/arpitdm"
}
```
There are three main issues with the `wtdist_gap` method namely:
1) Name of the method
2) Poor documentation
3) It should be a private function


Assignee: @arpitdm

CC:  dlucas @johanrosenkilde

Branch/Commit: 191d1c4aa70a36e995406abb9d6e5fbb2f96beee

Reviewer: David Lucas

Author: Arpit Merchant

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/20565





---

archive/issue_comments_373928.json:
```json
{
    "body": "Attachment [wtdist_gap.txt](tarball://root/attachments/some-uuid/ticket20565/wtdist_gap.txt) by @arpitdm created at 2016-05-06 09:30:42\n\nNotes on the issues with the method and proposed corrections.",
    "created_at": "2016-05-06T09:30:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20565#issuecomment-373928",
    "user": "https://github.com/arpitdm"
}
```

Attachment [wtdist_gap.txt](tarball://root/attachments/some-uuid/ticket20565/wtdist_gap.txt) by @arpitdm created at 2016-05-06 09:30:42

Notes on the issues with the method and proposed corrections.



---

archive/issue_comments_373929.json:
```json
{
    "body": "Set assignee to @arpitdm.",
    "created_at": "2016-05-06T09:31:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20565#issuecomment-373929",
    "user": "https://github.com/arpitdm"
}
```

Set assignee to @arpitdm.



---

archive/issue_comments_373930.json:
```json
{
    "body": "Changing branch from \"\" to \"u/arpitdm/fix_wtdist_gap_method\"",
    "created_at": "2016-05-14T10:48:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20565#issuecomment-373930",
    "user": "https://github.com/arpitdm"
}
```

Changing branch from "" to "u/arpitdm/fix_wtdist_gap_method"



---

archive/issue_comments_373931.json:
```json
{
    "body": "<a id='comment:3'></a>\nNew commits:\n|                                                                                                                                          |                                                                                       |\n|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------|\n|[3c62c14](http://git.sagemath.org/sage.git/commit/?id=3c62c141b1747290a12a3647d6e939bff13a590f)|`improved name and documentation of the wtdist_gap method. made this a private method.`|",
    "created_at": "2016-05-14T10:49:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20565#issuecomment-373931",
    "user": "https://github.com/arpitdm"
}
```

<a id='comment:3'></a>
New commits:
|                                                                                                                                          |                                                                                       |
|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------|
|[3c62c14](http://git.sagemath.org/sage.git/commit/?id=3c62c141b1747290a12a3647d6e939bff13a590f)|`improved name and documentation of the wtdist_gap method. made this a private method.`|



---

archive/issue_comments_373932.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-05-14T10:49:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20565#issuecomment-373932",
    "user": "https://github.com/arpitdm"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_373933.json:
```json
{
    "body": "Changing commit from \"\" to \"3c62c141b1747290a12a3647d6e939bff13a590f\"",
    "created_at": "2016-05-14T10:49:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20565#issuecomment-373933",
    "user": "https://github.com/arpitdm"
}
```

Changing commit from "" to "3c62c141b1747290a12a3647d6e939bff13a590f"



---

archive/issue_comments_373934.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-05-14T14:23:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20565#issuecomment-373934",
    "user": "https://github.com/arpitdm"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_373935.json:
```json
{
    "body": "<a id='comment:5'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                                                                                                                                                                                                            |\n|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n|[161a268](http://git.sagemath.org/sage.git/commit/?id=161a2681636d3139a589aafe64f289d982c54bd6)|`placed method inside AbstractLinearCode class. made it private by using a single leading underscore. improved documentation to show how to use the function. updated description of Gstr in documentation.`|",
    "created_at": "2016-05-15T02:39:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20565#issuecomment-373935",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                                                                                                                                                                                                            |
|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|[161a268](http://git.sagemath.org/sage.git/commit/?id=161a2681636d3139a589aafe64f289d982c54bd6)|`placed method inside AbstractLinearCode class. made it private by using a single leading underscore. improved documentation to show how to use the function. updated description of Gstr in documentation.`|



---

archive/issue_comments_373936.json:
```json
{
    "body": "Changing commit from \"3c62c141b1747290a12a3647d6e939bff13a590f\" to \"161a2681636d3139a589aafe64f289d982c54bd6\"",
    "created_at": "2016-05-15T02:39:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20565#issuecomment-373936",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "3c62c141b1747290a12a3647d6e939bff13a590f" to "161a2681636d3139a589aafe64f289d982c54bd6"



---

archive/issue_comments_373937.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-05-15T02:40:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20565#issuecomment-373937",
    "user": "https://github.com/arpitdm"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_373938.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-05-23T09:14:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20565#issuecomment-373938",
    "user": "https://trac.sagemath.org/admin/accounts/users/dlucas"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_373939.json:
```json
{
    "body": "<a id='comment:7'></a>\nHello Arpit,\n\nA few remarks:\n\n- in Sage, you cannot delete/change the signature of a method silently, you have to support the old method for a year. To do that, you need to use [deprecation warnings](http://doc.sagemath.org/html/en/developer/coding_in_python.html#deprecation) to notify users about the new functionality (and warn them the old one will be deleted soon). You can use the following line:\n`wtdist_gap = deprecated_function_alias(20565, _weight_distribution)`.\nThen, call the old `wtdist_gap` and you should see a warning.\n\n- I'm not sure the weight distribution should be a private method: it's an interesting \"property\" to compute, and I'm sure some users expect to see it here (maybe Johan can confirm what I'm saying).\nIn any case, I have a specific method `weight_distribution` in `grs.py` (as you have a faster algorithm to compute it on MDS codes) and it's not private. So, for consistency, it should be private everywhere or nowhere (I vote for nowhere).\n\n- Also, I think we can completely remove the input of this method: as you're making it a method of `AbstractLinearCode`, it's no longer needed to pass `n` and `F` (as `self.length()` and `self.base_ring()` will recover `n` and `F`) and I think having to pass the generator matrix in it's GAP string format is very annoying...\nOne should just call `C.weight_distribution()` and get the list.\nIt's possible to get the GAP format of a matrix by typing `M._gap_()`.\n\nOtherwise, I agree with other changes, the documentation and the new names.\n\nBest,\n\nDavid",
    "created_at": "2016-05-23T09:14:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20565#issuecomment-373939",
    "user": "https://trac.sagemath.org/admin/accounts/users/dlucas"
}
```

<a id='comment:7'></a>
Hello Arpit,

A few remarks:

- in Sage, you cannot delete/change the signature of a method silently, you have to support the old method for a year. To do that, you need to use [deprecation warnings](http://doc.sagemath.org/html/en/developer/coding_in_python.html#deprecation) to notify users about the new functionality (and warn them the old one will be deleted soon). You can use the following line:
`wtdist_gap = deprecated_function_alias(20565, _weight_distribution)`.
Then, call the old `wtdist_gap` and you should see a warning.

- I'm not sure the weight distribution should be a private method: it's an interesting "property" to compute, and I'm sure some users expect to see it here (maybe Johan can confirm what I'm saying).
In any case, I have a specific method `weight_distribution` in `grs.py` (as you have a faster algorithm to compute it on MDS codes) and it's not private. So, for consistency, it should be private everywhere or nowhere (I vote for nowhere).

- Also, I think we can completely remove the input of this method: as you're making it a method of `AbstractLinearCode`, it's no longer needed to pass `n` and `F` (as `self.length()` and `self.base_ring()` will recover `n` and `F`) and I think having to pass the generator matrix in it's GAP string format is very annoying...
One should just call `C.weight_distribution()` and get the list.
It's possible to get the GAP format of a matrix by typing `M._gap_()`.

Otherwise, I agree with other changes, the documentation and the new names.

Best,

David



---

archive/issue_events_055477.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/dlucas",
    "created_at": "2016-05-23T09:14:09Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/20565",
    "milestone": "sage-7.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20565#event-55477"
}
```



---

archive/issue_comments_373940.json:
```json
{
    "body": "<a id='comment:8'></a>\n> - I'm not sure the weight distribution should be a private method: it's an interesting \"property\" to compute, and I'm sure some users expect to see it here...\n\n\nThe function that Arpit has been working on is a helper-function for `AbstractLinearCode.spectrum` which has the alias `AbstractLinearCode.weight_distribution`. That method has the signature you ask for. The function Arpit has modified is just a helper for that.\n\nPerhaps it should therefore be named `AbstractLinearCode._spectrum_from_gap`. Its signature could still be changed to not take any arguments if one just changes how it is called in `spectrum`. That would make sense.\n\nBest,\nJohan",
    "created_at": "2016-05-23T09:39:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20565#issuecomment-373940",
    "user": "https://github.com/johanrosenkilde"
}
```

<a id='comment:8'></a>
> - I'm not sure the weight distribution should be a private method: it's an interesting "property" to compute, and I'm sure some users expect to see it here...


The function that Arpit has been working on is a helper-function for `AbstractLinearCode.spectrum` which has the alias `AbstractLinearCode.weight_distribution`. That method has the signature you ask for. The function Arpit has modified is just a helper for that.

Perhaps it should therefore be named `AbstractLinearCode._spectrum_from_gap`. Its signature could still be changed to not take any arguments if one just changes how it is called in `spectrum`. That would make sense.

Best,
Johan



---

archive/issue_comments_373941.json:
```json
{
    "body": "<a id='comment:9'></a>\n1. Deprecation warnings:\nUnderstood. I'm adding the line now.\n\n2. Name and Private:\n`AbstractLinearCode.spectrum` computes the spectrum using three algorithms \"binary\", \"gap\" and \"leon\" each of which is implemented differently. \"binary\" imports a function from another file and then calls the \"weight_dist\" function from it while \"leon\" is implemented within `spectrum`. I think the entire method needs to be refactored so that the code is more modular.\nAnd so perhaps, the name `weight_distribution` is a misnomer. Like Johan suggests, it should be titled `_spectrum_from_gap` (and so on for the other two as well).\n\n3. Input to the method:\nAgreed. I'll make changes accordingly.",
    "created_at": "2016-05-23T10:07:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20565#issuecomment-373941",
    "user": "https://github.com/arpitdm"
}
```

<a id='comment:9'></a>
1. Deprecation warnings:
Understood. I'm adding the line now.

2. Name and Private:
`AbstractLinearCode.spectrum` computes the spectrum using three algorithms "binary", "gap" and "leon" each of which is implemented differently. "binary" imports a function from another file and then calls the "weight_dist" function from it while "leon" is implemented within `spectrum`. I think the entire method needs to be refactored so that the code is more modular.
And so perhaps, the name `weight_distribution` is a misnomer. Like Johan suggests, it should be titled `_spectrum_from_gap` (and so on for the other two as well).

3. Input to the method:
Agreed. I'll make changes accordingly.



---

archive/issue_comments_373942.json:
```json
{
    "body": "<a id='comment:10'></a>\nReplying to [jsrn](#comment%3A8):\n> > - I'm not sure the weight distribution should be a private method: it's an interesting \"property\" to compute, and I'm sure some users expect to see it here...\n \n> \n> The function that Arpit has been working on is a helper-function for `AbstractLinearCode.spectrum` which has the alias `AbstractLinearCode.weight_distribution`. That method has the signature you ask for. The function Arpit has modified is just a helper for that.\n> \n> Perhaps it should therefore be named `AbstractLinearCode._spectrum_from_gap`. Its signature could still be changed to not take any arguments if one just changes how it is called in `spectrum`. That would make sense.\n> \n> Best,\n> Johan\n\n\nYes, you're right, please ignore my remarks on this!\n\nDavid",
    "created_at": "2016-05-23T10:31:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20565#issuecomment-373942",
    "user": "https://trac.sagemath.org/admin/accounts/users/dlucas"
}
```

<a id='comment:10'></a>
Replying to [jsrn](#comment%3A8):
> > - I'm not sure the weight distribution should be a private method: it's an interesting "property" to compute, and I'm sure some users expect to see it here...
 
> 
> The function that Arpit has been working on is a helper-function for `AbstractLinearCode.spectrum` which has the alias `AbstractLinearCode.weight_distribution`. That method has the signature you ask for. The function Arpit has modified is just a helper for that.
> 
> Perhaps it should therefore be named `AbstractLinearCode._spectrum_from_gap`. Its signature could still be changed to not take any arguments if one just changes how it is called in `spectrum`. That would make sense.
> 
> Best,
> Johan


Yes, you're right, please ignore my remarks on this!

David



---

archive/issue_comments_373943.json:
```json
{
    "body": "<a id='comment:11'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                                                                                                                                                           |\n|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------|\n|[1114267](http://git.sagemath.org/sage.git/commit/?id=111426739cd1bb4eb395117ff5000d9aafdc23ac)|`added deprecation warning for the changed method name. removed input parameters since they are directly accessible. changed name to _spectrum_from_gap().`|",
    "created_at": "2016-05-23T11:21:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20565#issuecomment-373943",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                                                                                                                                                           |
|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------|
|[1114267](http://git.sagemath.org/sage.git/commit/?id=111426739cd1bb4eb395117ff5000d9aafdc23ac)|`added deprecation warning for the changed method name. removed input parameters since they are directly accessible. changed name to _spectrum_from_gap().`|



---

archive/issue_comments_373944.json:
```json
{
    "body": "Changing commit from \"161a2681636d3139a589aafe64f289d982c54bd6\" to \"111426739cd1bb4eb395117ff5000d9aafdc23ac\"",
    "created_at": "2016-05-23T11:21:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20565#issuecomment-373944",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "161a2681636d3139a589aafe64f289d982c54bd6" to "111426739cd1bb4eb395117ff5000d9aafdc23ac"



---

archive/issue_comments_373945.json:
```json
{
    "body": "<a id='comment:12'></a>\nHello,\n\nThere's still a few problems:\n\n- You deleted some lines from `spectrum`, especially the ones defining the local variables (like `F = self.base_ring()`)... Which results in several failures in this method (l. 3306, for instance, returns `global name F not known`) because it tries to use variables that are no longer defined.\n\n- (this is quite my fault), the deprecation warning does not work. As you put\n  `wtdist_gap = deprecated_function_alias(20565, _spectrum_from_gap)` in `AbstractLinearCode`, it does not respect the old signature anymore. With the deprecation mechanism working as expected, one should be able to call\n\n```\nsage: Gstr = 'Z(2)*[[1,1,1,0,0,0,0], [1,0,0,1,1,0,0], [0,1,0,1,0,1,0], [1,1,0,1,0,0,1]]'\nsage: F = GF(2)\nsage: sage.coding.linear_code.wtdist_gap(Gstr, 7, F)\n```\n get a warning and the expected result.\n Plus, as I suggested you to remove the input from `_spectrum_from_gap`, if one calls `C.wtdist_gap(Gstr, 7, F)` because `C._spectrum_from_gap(Gstr, 7, F)` does not exist...\n\n So, I propose to reinstate `wtdist_gap` where it was and as it was, but to change its code: now it will send a deprecation warning and call `_spectrum_from_gap`. It should look like this:\n\n```\n def wtdist_gap(Gmat, n, F):\n    from sage.misc.superseded import deprecation\n    deprecation(20565, \"wtdist_gap is now deprecated. Please use AbstractLinearCode._spectrum_from_gap instead.\")\n    #create a linear code C\n    return C._spectrum_from_gap()\n```\n\n It's kind of an idiotic behaviour but it will work.\n\nBest,\n\nDavid",
    "created_at": "2016-05-24T08:43:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20565#issuecomment-373945",
    "user": "https://trac.sagemath.org/admin/accounts/users/dlucas"
}
```

<a id='comment:12'></a>
Hello,

There's still a few problems:

- You deleted some lines from `spectrum`, especially the ones defining the local variables (like `F = self.base_ring()`)... Which results in several failures in this method (l. 3306, for instance, returns `global name F not known`) because it tries to use variables that are no longer defined.

- (this is quite my fault), the deprecation warning does not work. As you put
  `wtdist_gap = deprecated_function_alias(20565, _spectrum_from_gap)` in `AbstractLinearCode`, it does not respect the old signature anymore. With the deprecation mechanism working as expected, one should be able to call

```
sage: Gstr = 'Z(2)*[[1,1,1,0,0,0,0], [1,0,0,1,1,0,0], [0,1,0,1,0,1,0], [1,1,0,1,0,0,1]]'
sage: F = GF(2)
sage: sage.coding.linear_code.wtdist_gap(Gstr, 7, F)
```
 get a warning and the expected result.
 Plus, as I suggested you to remove the input from `_spectrum_from_gap`, if one calls `C.wtdist_gap(Gstr, 7, F)` because `C._spectrum_from_gap(Gstr, 7, F)` does not exist...

 So, I propose to reinstate `wtdist_gap` where it was and as it was, but to change its code: now it will send a deprecation warning and call `_spectrum_from_gap`. It should look like this:

```
 def wtdist_gap(Gmat, n, F):
    from sage.misc.superseded import deprecation
    deprecation(20565, "wtdist_gap is now deprecated. Please use AbstractLinearCode._spectrum_from_gap instead.")
    #create a linear code C
    return C._spectrum_from_gap()
```

 It's kind of an idiotic behaviour but it will work.

Best,

David



---

archive/issue_comments_373946.json:
```json
{
    "body": "<a id='comment:13'></a>\nI've added back the definitions of the local variables such as `F = self.base_ring()`. \n\nThe reason to put back `wtdist_gap` as it was, is to allow for users to get accustomed to the changes, right? That's why we need all the redirects. \n1. Do we want that `spectrum` also call wtdist_gap() which then calls _spectrum_from_gap()? Or can `spectrum` directly call the latter?\n2. The original wtdist_gap took the generator matrix in a gap string format. Is it possible to reconvert this representation into a regular generator matrix from which a linear code can be constructed?",
    "created_at": "2016-05-26T07:29:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20565#issuecomment-373946",
    "user": "https://github.com/arpitdm"
}
```

<a id='comment:13'></a>
I've added back the definitions of the local variables such as `F = self.base_ring()`. 

The reason to put back `wtdist_gap` as it was, is to allow for users to get accustomed to the changes, right? That's why we need all the redirects. 
1. Do we want that `spectrum` also call wtdist_gap() which then calls _spectrum_from_gap()? Or can `spectrum` directly call the latter?
2. The original wtdist_gap took the generator matrix in a gap string format. Is it possible to reconvert this representation into a regular generator matrix from which a linear code can be constructed?



---

archive/issue_comments_373947.json:
```json
{
    "body": "<a id='comment:14'></a>\n> I've added back the definitions of the local variables such as `F = self.base_ring()`. \n\n\nOk, good!\n\n> The reason to put back `wtdist_gap` as it was, is to allow for users to get accustomed to the changes, right? That's why we need all the redirects. \n\n\nExactly. In Sage, whenever you change something, you have to be retrocompatible with the old feature for a year.\n\n> Do we want that `spectrum` also call `wtdist_gap()` which then calls `_spectrum_from_gap()`? Or can `spectrum` directly call the latter? \n\n\n`spectrum` can directly call `_spectrum_from_gap`. With all these deprecation warnings, the general rule is to allow the user to access the old feature for a year. So, as long as you still provide the old method/signature/output, replacing the old stuff everywhere else is fine.\n\n\n> The original wtdist_gap took the generator matrix in a gap string format. Is it possible to reconvert this representation into a regular generator matrix from which a linear code can be constructed? \n\n\nYup, for instance:\n\n```\nsage: M = matrix(GF(7), [[1,2,3], [4,5,6]])\nsage: Mg = M._gap_()\nsage: Ms = Mg._matrix_(GF(7))\nsage: Ms == M\nTrue\n```",
    "created_at": "2016-05-26T08:13:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20565#issuecomment-373947",
    "user": "https://trac.sagemath.org/admin/accounts/users/dlucas"
}
```

<a id='comment:14'></a>
> I've added back the definitions of the local variables such as `F = self.base_ring()`. 


Ok, good!

> The reason to put back `wtdist_gap` as it was, is to allow for users to get accustomed to the changes, right? That's why we need all the redirects. 


Exactly. In Sage, whenever you change something, you have to be retrocompatible with the old feature for a year.

> Do we want that `spectrum` also call `wtdist_gap()` which then calls `_spectrum_from_gap()`? Or can `spectrum` directly call the latter? 


`spectrum` can directly call `_spectrum_from_gap`. With all these deprecation warnings, the general rule is to allow the user to access the old feature for a year. So, as long as you still provide the old method/signature/output, replacing the old stuff everywhere else is fine.


> The original wtdist_gap took the generator matrix in a gap string format. Is it possible to reconvert this representation into a regular generator matrix from which a linear code can be constructed? 


Yup, for instance:

```
sage: M = matrix(GF(7), [[1,2,3], [4,5,6]])
sage: Mg = M._gap_()
sage: Ms = Mg._matrix_(GF(7))
sage: Ms == M
True
```



---

archive/issue_comments_373948.json:
```json
{
    "body": "<a id='comment:15'></a>\nOne more thing. We need to have the original wtdist_gap documentation also. The doctest there fails with the following message:\n\n```\nFile \"src/sage/coding/linear_code.py\", line 315, in sage.coding.linear_code.wtdist_gap\nFailed example:\n    sage.coding.linear_code.wtdist_gap(Gstr, 7, F)\nExpected:\n    DeprecationWarning: wtdist_gap is now deprecated. Please use AbstractLinearCode._spectrum_from_gap instead.\n    See http://trac.sagemath.org/20565 for details.\n    [1, 0, 0, 7, 7, 0, 0, 1]\nGot:\n    doctest:1: DeprecationWarning: wtdist_gap is now deprecated. Please use AbstractLinearCode._spectrum_from_gap instead.\n    See http://trac.sagemath.org/20565 for details.\n    [1, 0, 0, 7, 7, 0, 0, 1]\n```\nWhat is the correct way to add the deprecation warning to the doctest?\n\nWhen I run the wtdist_gap method, it gives a bunch of other deprecation warnings. Are these fine or do I need to change anything here?\n\n```\nsage: sage.coding.linear_code.wtdist_gap(Gstr, 7, F)\n/home/arpit/Documents/GSOC_16/sage-7.1/src/bin/sage-ipython:1: DeprecationWarning: wtdist_gap is now deprecated. Please use AbstractLinearCode._spectrum_from_gap instead.\nSee http://trac.sagemath.org/20565 for details.\n  #!/usr/bin/env python\n/home/arpit/Documents/GSOC_16/sage-7.1/local/lib/python2.7/site-packages/IPython/core/formatters.py:92: DeprecationWarning: DisplayFormatter._ipython_display_formatter_default is deprecated: use @default decorator instead.\n  def _ipython_display_formatter_default(self):\n/home/arpit/Documents/GSOC_16/sage-7.1/local/lib/python2.7/site-packages/IPython/core/formatters.py:98: DeprecationWarning: DisplayFormatter._formatters_default is deprecated: use @default decorator instead.\n  def _formatters_default(self):\n/home/arpit/Documents/GSOC_16/sage-7.1/local/lib/python2.7/site-packages/IPython/core/formatters.py:677: DeprecationWarning: PlainTextFormatter._deferred_printers_default is deprecated: use @default decorator instead.\n  def _deferred_printers_default(self):\n/home/arpit/Documents/GSOC_16/sage-7.1/local/lib/python2.7/site-packages/IPython/core/formatters.py:669: DeprecationWarning: PlainTextFormatter._singleton_printers_default is deprecated: use @default decorator instead.\n  def _singleton_printers_default(self):\n/home/arpit/Documents/GSOC_16/sage-7.1/local/lib/python2.7/site-packages/IPython/core/formatters.py:672: DeprecationWarning: PlainTextFormatter._type_printers_default is deprecated: use @default decorator instead.\n  def _type_printers_default(self):\n/home/arpit/Documents/GSOC_16/sage-7.1/local/lib/python2.7/site-packages/IPython/core/formatters.py:669: DeprecationWarning: PlainTextFormatter._singleton_printers_default is deprecated: use @default decorator instead.\n  def _singleton_printers_default(self):\n/home/arpit/Documents/GSOC_16/sage-7.1/local/lib/python2.7/site-packages/IPython/core/formatters.py:672: DeprecationWarning: PlainTextFormatter._type_printers_default is deprecated: use @default decorator instead.\n  def _type_printers_default(self):\n/home/arpit/Documents/GSOC_16/sage-7.1/local/lib/python2.7/site-packages/IPython/core/formatters.py:677: DeprecationWarning: PlainTextFormatter._deferred_printers_default is deprecated: use @default decorator instead.\n  def _deferred_printers_default(self):\n[1, 0, 0, 7, 7, 0, 0, 1]\n```",
    "created_at": "2016-05-26T08:51:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20565#issuecomment-373948",
    "user": "https://github.com/arpitdm"
}
```

<a id='comment:15'></a>
One more thing. We need to have the original wtdist_gap documentation also. The doctest there fails with the following message:

```
File "src/sage/coding/linear_code.py", line 315, in sage.coding.linear_code.wtdist_gap
Failed example:
    sage.coding.linear_code.wtdist_gap(Gstr, 7, F)
Expected:
    DeprecationWarning: wtdist_gap is now deprecated. Please use AbstractLinearCode._spectrum_from_gap instead.
    See http://trac.sagemath.org/20565 for details.
    [1, 0, 0, 7, 7, 0, 0, 1]
Got:
    doctest:1: DeprecationWarning: wtdist_gap is now deprecated. Please use AbstractLinearCode._spectrum_from_gap instead.
    See http://trac.sagemath.org/20565 for details.
    [1, 0, 0, 7, 7, 0, 0, 1]
```
What is the correct way to add the deprecation warning to the doctest?

When I run the wtdist_gap method, it gives a bunch of other deprecation warnings. Are these fine or do I need to change anything here?

```
sage: sage.coding.linear_code.wtdist_gap(Gstr, 7, F)
/home/arpit/Documents/GSOC_16/sage-7.1/src/bin/sage-ipython:1: DeprecationWarning: wtdist_gap is now deprecated. Please use AbstractLinearCode._spectrum_from_gap instead.
See http://trac.sagemath.org/20565 for details.
  #!/usr/bin/env python
/home/arpit/Documents/GSOC_16/sage-7.1/local/lib/python2.7/site-packages/IPython/core/formatters.py:92: DeprecationWarning: DisplayFormatter._ipython_display_formatter_default is deprecated: use @default decorator instead.
  def _ipython_display_formatter_default(self):
/home/arpit/Documents/GSOC_16/sage-7.1/local/lib/python2.7/site-packages/IPython/core/formatters.py:98: DeprecationWarning: DisplayFormatter._formatters_default is deprecated: use @default decorator instead.
  def _formatters_default(self):
/home/arpit/Documents/GSOC_16/sage-7.1/local/lib/python2.7/site-packages/IPython/core/formatters.py:677: DeprecationWarning: PlainTextFormatter._deferred_printers_default is deprecated: use @default decorator instead.
  def _deferred_printers_default(self):
/home/arpit/Documents/GSOC_16/sage-7.1/local/lib/python2.7/site-packages/IPython/core/formatters.py:669: DeprecationWarning: PlainTextFormatter._singleton_printers_default is deprecated: use @default decorator instead.
  def _singleton_printers_default(self):
/home/arpit/Documents/GSOC_16/sage-7.1/local/lib/python2.7/site-packages/IPython/core/formatters.py:672: DeprecationWarning: PlainTextFormatter._type_printers_default is deprecated: use @default decorator instead.
  def _type_printers_default(self):
/home/arpit/Documents/GSOC_16/sage-7.1/local/lib/python2.7/site-packages/IPython/core/formatters.py:669: DeprecationWarning: PlainTextFormatter._singleton_printers_default is deprecated: use @default decorator instead.
  def _singleton_printers_default(self):
/home/arpit/Documents/GSOC_16/sage-7.1/local/lib/python2.7/site-packages/IPython/core/formatters.py:672: DeprecationWarning: PlainTextFormatter._type_printers_default is deprecated: use @default decorator instead.
  def _type_printers_default(self):
/home/arpit/Documents/GSOC_16/sage-7.1/local/lib/python2.7/site-packages/IPython/core/formatters.py:677: DeprecationWarning: PlainTextFormatter._deferred_printers_default is deprecated: use @default decorator instead.
  def _deferred_printers_default(self):
[1, 0, 0, 7, 7, 0, 0, 1]
```



---

archive/issue_comments_373949.json:
```json
{
    "body": "<a id='comment:16'></a>\n> One more thing. We need to have the original wtdist_gap documentation also. The doctest there fails with the following message\n\n\nUsually, I just delete the old documentation and leave only the code of the old method.\nSee for instance what I did with `ReedSolomonCode` in `code_constructions.py`.\n\nMy argument is the following: as it's an old feature we keep only for retrocompatibility purposes, I don't see the point of keeping its documentation. Indeed, users which have old code using the deprecated feature already know how the old method works and are using it correctly, so they don't need the documentation. On any other case, people are not supposed to use the old feature, and maintaining proper documentation for an old feature might confuse them and lead them to use it - while we don't want them to do that!\n\n> When I run the wtdist_gap method, it gives a bunch of other deprecation warnings. Are these fine or do I need to change anything here?\n\n\nThat's fine, don't worry!\n\nDavid",
    "created_at": "2016-05-26T09:04:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20565#issuecomment-373949",
    "user": "https://trac.sagemath.org/admin/accounts/users/dlucas"
}
```

<a id='comment:16'></a>
> One more thing. We need to have the original wtdist_gap documentation also. The doctest there fails with the following message


Usually, I just delete the old documentation and leave only the code of the old method.
See for instance what I did with `ReedSolomonCode` in `code_constructions.py`.

My argument is the following: as it's an old feature we keep only for retrocompatibility purposes, I don't see the point of keeping its documentation. Indeed, users which have old code using the deprecated feature already know how the old method works and are using it correctly, so they don't need the documentation. On any other case, people are not supposed to use the old feature, and maintaining proper documentation for an old feature might confuse them and lead them to use it - while we don't want them to do that!

> When I run the wtdist_gap method, it gives a bunch of other deprecation warnings. Are these fine or do I need to change anything here?


That's fine, don't worry!

David



---

archive/issue_comments_373950.json:
```json
{
    "body": "Changing commit from \"111426739cd1bb4eb395117ff5000d9aafdc23ac\" to \"10d7ca77d6699ff4877797072b0c5670881b6ab2\"",
    "created_at": "2016-05-26T09:17:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20565#issuecomment-373950",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "111426739cd1bb4eb395117ff5000d9aafdc23ac" to "10d7ca77d6699ff4877797072b0c5670881b6ab2"



---

archive/issue_comments_373951.json:
```json
{
    "body": "<a id='comment:17'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                                                                                      |\n|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------|\n|[10d7ca7](http://git.sagemath.org/sage.git/commit/?id=10d7ca77d6699ff4877797072b0c5670881b6ab2)|`reinstated the input, signatures and output of the now-deprecated wtdist_gap method.`|",
    "created_at": "2016-05-26T09:17:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20565#issuecomment-373951",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:17'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                                                                                      |
|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------|
|[10d7ca7](http://git.sagemath.org/sage.git/commit/?id=10d7ca77d6699ff4877797072b0c5670881b6ab2)|`reinstated the input, signatures and output of the now-deprecated wtdist_gap method.`|



---

archive/issue_comments_373952.json:
```json
{
    "body": "<a id='comment:18'></a>\nHello,\n\nOne last tweak: l. 530 in `linear_code.py`, `references := ...` became `:3references := ...` I assume it's a typo.\nCan you fix it please?\nOtherwise, tests passes and I agree with your changes, so as soon as this typo is fix, I'll give this ticket a `positive_review`.\n\nWell done!\n\nDavid",
    "created_at": "2016-05-26T13:21:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20565#issuecomment-373952",
    "user": "https://trac.sagemath.org/admin/accounts/users/dlucas"
}
```

<a id='comment:18'></a>
Hello,

One last tweak: l. 530 in `linear_code.py`, `references := ...` became `:3references := ...` I assume it's a typo.
Can you fix it please?
Otherwise, tests passes and I agree with your changes, so as soon as this typo is fix, I'll give this ticket a `positive_review`.

Well done!

David



---

archive/issue_comments_373953.json:
```json
{
    "body": "Changing commit from \"10d7ca77d6699ff4877797072b0c5670881b6ab2\" to \"191d1c4aa70a36e995406abb9d6e5fbb2f96beee\"",
    "created_at": "2016-05-26T13:40:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20565#issuecomment-373953",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "10d7ca77d6699ff4877797072b0c5670881b6ab2" to "191d1c4aa70a36e995406abb9d6e5fbb2f96beee"



---

archive/issue_comments_373954.json:
```json
{
    "body": "<a id='comment:19'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                                                   |\n|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------|\n|[191d1c4](http://git.sagemath.org/sage.git/commit/?id=191d1c4aa70a36e995406abb9d6e5fbb2f96beee)|`fixed small typo that had inadvertantly crept in.`|",
    "created_at": "2016-05-26T13:40:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20565#issuecomment-373954",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:19'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                                                   |
|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------|
|[191d1c4](http://git.sagemath.org/sage.git/commit/?id=191d1c4aa70a36e995406abb9d6e5fbb2f96beee)|`fixed small typo that had inadvertantly crept in.`|



---

archive/issue_comments_373955.json:
```json
{
    "body": "<a id='comment:20'></a>\nYup. It was a typo. Don't know how it got in there. :P",
    "created_at": "2016-05-26T13:42:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20565#issuecomment-373955",
    "user": "https://github.com/arpitdm"
}
```

<a id='comment:20'></a>
Yup. It was a typo. Don't know how it got in there. :P



---

archive/issue_comments_373956.json:
```json
{
    "body": "<a id='comment:21'></a>\nIf you're using vim, it might be a `:w` which ended up as a `:3`\nThis kind of stuff happens quite often :)\n\nAnyway, I'm setting this ticket to `positive_review`.\n\nDavid",
    "created_at": "2016-05-26T13:47:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20565#issuecomment-373956",
    "user": "https://trac.sagemath.org/admin/accounts/users/dlucas"
}
```

<a id='comment:21'></a>
If you're using vim, it might be a `:w` which ended up as a `:3`
This kind of stuff happens quite often :)

Anyway, I'm setting this ticket to `positive_review`.

David



---

archive/issue_comments_373957.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2016-05-26T13:47:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20565#issuecomment-373957",
    "user": "https://trac.sagemath.org/admin/accounts/users/dlucas"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_373958.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2016-05-27T22:42:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20565#issuecomment-373958",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_373959.json:
```json
{
    "body": "<a id='comment:22'></a>\nCan you fill out the reviewer field?",
    "created_at": "2016-05-27T22:42:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20565#issuecomment-373959",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:22'></a>
Can you fill out the reviewer field?



---

archive/issue_comments_373960.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2016-05-28T08:18:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20565#issuecomment-373960",
    "user": "https://trac.sagemath.org/admin/accounts/users/dlucas"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_373961.json:
```json
{
    "body": "<a id='comment:23'></a>\n> Can you fill out the reviewer field?\n\n\nSorry, done now.\n\nBTW, the patchbot says \"tests failed\" but it's in a completely unrelated file (`intefaces/qepcad.py`) so I don't think it's because of this ticket. I'm resetting it to `needs_review`.",
    "created_at": "2016-05-28T08:18:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20565#issuecomment-373961",
    "user": "https://trac.sagemath.org/admin/accounts/users/dlucas"
}
```

<a id='comment:23'></a>
> Can you fill out the reviewer field?


Sorry, done now.

BTW, the patchbot says "tests failed" but it's in a completely unrelated file (`intefaces/qepcad.py`) so I don't think it's because of this ticket. I'm resetting it to `needs_review`.



---

archive/issue_comments_373962.json:
```json
{
    "body": "Changing reviewer from \"\" to \"David Lucas\"",
    "created_at": "2016-05-28T08:18:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20565#issuecomment-373962",
    "user": "https://trac.sagemath.org/admin/accounts/users/dlucas"
}
```

Changing reviewer from "" to "David Lucas"



---

archive/issue_comments_373963.json:
```json
{
    "body": "Changing branch from \"u/arpitdm/fix_wtdist_gap_method\" to \"191d1c4aa70a36e995406abb9d6e5fbb2f96beee\"",
    "created_at": "2016-05-28T14:19:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20565#issuecomment-373963",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/arpitdm/fix_wtdist_gap_method" to "191d1c4aa70a36e995406abb9d6e5fbb2f96beee"



---

archive/issue_comments_373964.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-05-28T14:19:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20565#issuecomment-373964",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_055478.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-05-28T14:19:46Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/20565",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20565#event-55478"
}
```
