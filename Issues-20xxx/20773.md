# Issue 20773: MixedIntegerLinearProgram.new_variable could optionally take a "static" list of component indices

archive/issues_020536.json:
```json
{
    "body": "Currently, `new_variable` allocates backend indices to MIP variable component indices very dynamically.\n\n```\nsage: p = MixedIntegerLinearProgram()\nsage: x = p.new_variable()\nsage: x[7]\nx_0\nsage: x[2]\nx_1\n```\n\nSometimes it could be nice to have a predictable order in the backend; for example, when `.polyhedron()` is to be called. And sometimes it could be nice to declare ahead of time which component indices are valid, making accesses to other indices an error (rather than creating a new backend variable); this could help debug MIP models.\n\nThis could look like this:\n\n```\nsage: p = MixedIntegerLinearProgram()\nsage: x = p.new_variable(indices=range(7))\nsage: p.number_of_variables()\n7\nsage: x[3]\nx_3\nsage: x[11]\nIndexError: 11 does not index a component of MIPVariable of dimension 1\n```\n(This is optional; if no `indices` argument is passed, it keeps the fully dynamic current behavior.)\n\n\nCC:  @dimpase @videlec @jdemeyer @nbruin @fchapoton tmonteil @dcoudert @tscrim\n\nKeywords: lp\n\nBranch/Commit: 23689ddb190d6e2847fd492c91c996a7afa2bbea\n\nReviewer: Travis Scrimshaw\n\nAuthor: Matthias Koeppe\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/20773\n\n",
    "closed_at": "2018-09-21T22:20:38Z",
    "created_at": "2016-06-03T16:19:03Z",
    "labels": [
        "component: numerical"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.4",
    "title": "MixedIntegerLinearProgram.new_variable could optionally take a \"static\" list of component indices",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/20773",
    "user": "https://github.com/mkoeppe"
}
```
Currently, `new_variable` allocates backend indices to MIP variable component indices very dynamically.

```
sage: p = MixedIntegerLinearProgram()
sage: x = p.new_variable()
sage: x[7]
x_0
sage: x[2]
x_1
```

Sometimes it could be nice to have a predictable order in the backend; for example, when `.polyhedron()` is to be called. And sometimes it could be nice to declare ahead of time which component indices are valid, making accesses to other indices an error (rather than creating a new backend variable); this could help debug MIP models.

This could look like this:

```
sage: p = MixedIntegerLinearProgram()
sage: x = p.new_variable(indices=range(7))
sage: p.number_of_variables()
7
sage: x[3]
x_3
sage: x[11]
IndexError: 11 does not index a component of MIPVariable of dimension 1
```
(This is optional; if no `indices` argument is passed, it keeps the fully dynamic current behavior.)


CC:  @dimpase @videlec @jdemeyer @nbruin @fchapoton tmonteil @dcoudert @tscrim

Keywords: lp

Branch/Commit: 23689ddb190d6e2847fd492c91c996a7afa2bbea

Reviewer: Travis Scrimshaw

Author: Matthias Koeppe

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/20773





---

archive/issue_comments_378854.json:
```json
{
    "body": "Changing branch from \"\" to \"u/mkoeppe/mixedintegerlinearprogram_new_variable_could_optionally_take_a__static__list_of_component_indices\"",
    "created_at": "2018-09-18T15:42:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20773",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20773#issuecomment-378854",
    "user": "https://github.com/mkoeppe"
}
```

Changing branch from "" to "u/mkoeppe/mixedintegerlinearprogram_new_variable_could_optionally_take_a__static__list_of_component_indices"



---

archive/issue_comments_378855.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -15,13 +15,13 @@\n \n ```\n sage: p = MixedIntegerLinearProgram()\n-sage: x = p.new_variable(components=range(7))\n+sage: x = p.new_variable(indices=range(7))\n sage: p.number_of_variables()\n 7\n sage: x[3]\n x_3\n sage: x[11]\n-IndexError: MIPVariable component index out of range\n+IndexError: 11 does not index a component of MIPVariable of dimension 1\n ```\n-(This would be optional; if no `components` argument is passed, it would match the fully dynamic current behavior.)\n+(This is optional; if no `indices` argument is passed, it keeps the fully dynamic current behavior.)\n \n``````\n",
    "created_at": "2018-09-18T15:49:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20773",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20773#issuecomment-378855",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -15,13 +15,13 @@
 
 ```
 sage: p = MixedIntegerLinearProgram()
-sage: x = p.new_variable(components=range(7))
+sage: x = p.new_variable(indices=range(7))
 sage: p.number_of_variables()
 7
 sage: x[3]
 x_3
 sage: x[11]
-IndexError: MIPVariable component index out of range
+IndexError: 11 does not index a component of MIPVariable of dimension 1
 ```
-(This would be optional; if no `components` argument is passed, it would match the fully dynamic current behavior.)
+(This is optional; if no `indices` argument is passed, it keeps the fully dynamic current behavior.)
 
``````




---

archive/issue_events_055782.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2018-09-18T15:49:54Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/20773",
    "milestone": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20773#event-55782"
}
```



---

archive/issue_comments_378856.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-09-18T15:49:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20773",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20773#issuecomment-378856",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_378857.json:
```json
{
    "body": "Changing commit from \"\" to \"7cb2b3a54149fa30ea6bc2f47b50a311dca6935d\"",
    "created_at": "2018-09-18T15:49:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20773",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20773#issuecomment-378857",
    "user": "https://github.com/mkoeppe"
}
```

Changing commit from "" to "7cb2b3a54149fa30ea6bc2f47b50a311dca6935d"



---

archive/issue_comments_378858.json:
```json
{
    "body": "Changing author from \"\" to \"Matthias Koeppe\"",
    "created_at": "2018-09-18T15:49:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20773",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20773#issuecomment-378858",
    "user": "https://github.com/mkoeppe"
}
```

Changing author from "" to "Matthias Koeppe"



---

archive/issue_comments_378859.json:
```json
{
    "body": "<a id='comment:2'></a>Needs review. Comments on the proposed interface are welcome.\n\n---\nNew commits:",
    "created_at": "2018-09-18T15:49:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20773",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20773#issuecomment-378859",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'></a>Needs review. Comments on the proposed interface are welcome.

---
New commits:



---

archive/issue_comments_378860.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Travis Scrimshaw\"",
    "created_at": "2018-09-18T23:15:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20773",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20773#issuecomment-378860",
    "user": "https://github.com/tscrim"
}
```

Changing reviewer from "" to "Travis Scrimshaw"



---

archive/issue_comments_378861.json:
```json
{
    "body": "<a id='comment:3'></a>While it might be a little less verbose, it is more conceptually an optional argument if the default was `None`. Then you could also write the doc as\n\n```\n        - ``indices`` -- (optional) an iterable of keys; components\n          corresponding to these keys are created in order,\n          and access to components with other keys will raise an\n          error; otherwise components of this variable can be\n          indexed by arbitrary keys and are created dynamically\n          on access\n```\nHowever, I don't care strongly either way. So if you want to keep the current version, then you can set a positive review on my behalf.",
    "created_at": "2018-09-18T23:15:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20773",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20773#issuecomment-378861",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:3'></a>While it might be a little less verbose, it is more conceptually an optional argument if the default was `None`. Then you could also write the doc as

```
        - ``indices`` -- (optional) an iterable of keys; components
          corresponding to these keys are created in order,
          and access to components with other keys will raise an
          error; otherwise components of this variable can be
          indexed by arbitrary keys and are created dynamically
          on access
```
However, I don't care strongly either way. So if you want to keep the current version, then you can set a positive review on my behalf.



---

archive/issue_comments_378862.json:
```json
{
    "body": "<a id='comment:4'></a>Replying to [comment:3 tscrim]:\n> While it might be a little less verbose, it is more conceptually an optional argument if the default was `None`. \n\n\nRight, but I definitely want to distinguish `[]` from the default argument (and from a discussion on `Polyhedron` I remember that one developer (Volker?) seems to hold the opinion that `None` and `[]` should never (?) be distinguished by Python methods). \n\n(`indices = []` must give a static-index MIP variable for which any component access is an error.)",
    "created_at": "2018-09-19T13:11:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20773",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20773#issuecomment-378862",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:4'></a>Replying to [comment:3 tscrim]:
> While it might be a little less verbose, it is more conceptually an optional argument if the default was `None`. 


Right, but I definitely want to distinguish `[]` from the default argument (and from a discussion on `Polyhedron` I remember that one developer (Volker?) seems to hold the opinion that `None` and `[]` should never (?) be distinguished by Python methods). 

(`indices = []` must give a static-index MIP variable for which any component access is an error.)



---

archive/issue_comments_378863.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -9,7 +9,7 @@\n x_1\n ```\n \n-Sometimes it could be nice to have a predictable order in the backend. And sometimes it could be nice to declare ahead of time which component indices are valid, making accesses to other indices an error (rather than creating a new backend variable); this could help debug MIP models.\n+Sometimes it could be nice to have a predictable order in the backend; for example, when `.polyhedron()` is to be called. And sometimes it could be nice to declare ahead of time which component indices are valid, making accesses to other indices an error (rather than creating a new backend variable); this could help debug MIP models.\n \n This could look like this:\n \n``````\n",
    "created_at": "2018-09-19T13:18:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20773",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20773#issuecomment-378863",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -9,7 +9,7 @@
 x_1
 ```
 
-Sometimes it could be nice to have a predictable order in the backend. And sometimes it could be nice to declare ahead of time which component indices are valid, making accesses to other indices an error (rather than creating a new backend variable); this could help debug MIP models.
+Sometimes it could be nice to have a predictable order in the backend; for example, when `.polyhedron()` is to be called. And sometimes it could be nice to declare ahead of time which component indices are valid, making accesses to other indices an error (rather than creating a new backend variable); this could help debug MIP models.
 
 This could look like this:
 
``````




---

archive/issue_comments_378864.json:
```json
{
    "body": "<a id='comment:6'></a>Replying to [comment:4 mkoeppe]:\n> Replying to [comment:3 tscrim]:\n> > While it might be a little less verbose, it is more conceptually an optional argument if the default was `None`. \n\n> \n> Right, but I definitely want to distinguish `[]` from the default argument (and from a discussion on `Polyhedron` I remember that one developer (Volker?) seems to hold the opinion that `None` and `[]` should never (?) be distinguished by Python methods). \n\n\nThat is not a good rule IMO:\n\n```\nsage: Partition([])\n[]\nsage: Partition(None)  # This makes no sense and rightly raises an error.\n```\nThe only thing you have to be careful about is `if foo:` just needs to be `if foo is None:`. It seems like you having such a non-`False`-bool default value is more likely to cause issues given how Python code usually can be written, and it can mean a more arbitrary default that has less meaning for the code. It also does not mesh well with Cython either. I would be curious to hearing what the argument for this is, but I think `None` and `[]` should be considered as distinguishable. Unless you also want `False`, `()`, and `0` to not be distinguishable either? At least, that is what I think the logic of this rule leads me to conclude.",
    "created_at": "2018-09-19T13:46:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20773",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20773#issuecomment-378864",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:6'></a>Replying to [comment:4 mkoeppe]:
> Replying to [comment:3 tscrim]:
> > While it might be a little less verbose, it is more conceptually an optional argument if the default was `None`. 

> 
> Right, but I definitely want to distinguish `[]` from the default argument (and from a discussion on `Polyhedron` I remember that one developer (Volker?) seems to hold the opinion that `None` and `[]` should never (?) be distinguished by Python methods). 


That is not a good rule IMO:

```
sage: Partition([])
[]
sage: Partition(None)  # This makes no sense and rightly raises an error.
```
The only thing you have to be careful about is `if foo:` just needs to be `if foo is None:`. It seems like you having such a non-`False`-bool default value is more likely to cause issues given how Python code usually can be written, and it can mean a more arbitrary default that has less meaning for the code. It also does not mesh well with Cython either. I would be curious to hearing what the argument for this is, but I think `None` and `[]` should be considered as distinguishable. Unless you also want `False`, `()`, and `0` to not be distinguishable either? At least, that is what I think the logic of this rule leads me to conclude.



---

archive/issue_comments_378865.json:
```json
{
    "body": "<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-09-19T13:56:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20773",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20773#issuecomment-378865",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_378866.json:
```json
{
    "body": "Changing commit from \"7cb2b3a54149fa30ea6bc2f47b50a311dca6935d\" to \"604b2c76f28df5d7b9684a2c874ee41e9de51bfd\"",
    "created_at": "2018-09-19T13:56:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20773",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20773#issuecomment-378866",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "7cb2b3a54149fa30ea6bc2f47b50a311dca6935d" to "604b2c76f28df5d7b9684a2c874ee41e9de51bfd"



---

archive/issue_comments_378867.json:
```json
{
    "body": "<a id='comment:8'></a>Thanks for the discussion. I've changed it to `None`. Needs review",
    "created_at": "2018-09-19T13:58:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20773",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20773#issuecomment-378867",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:8'></a>Thanks for the discussion. I've changed it to `None`. Needs review



---

archive/issue_comments_378868.json:
```json
{
    "body": "Changing commit from \"604b2c76f28df5d7b9684a2c874ee41e9de51bfd\" to \"23689ddb190d6e2847fd492c91c996a7afa2bbea\"",
    "created_at": "2018-09-20T02:09:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20773",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20773#issuecomment-378868",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "604b2c76f28df5d7b9684a2c874ee41e9de51bfd" to "23689ddb190d6e2847fd492c91c996a7afa2bbea"



---

archive/issue_comments_378869.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-09-20T02:09:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20773",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20773#issuecomment-378869",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_378870.json:
```json
{
    "body": "<a id='comment:10'></a>Replying to [comment:4 mkoeppe]:\n>  I definitely want to distinguish `[]` from the default argument ...\n\n> (`indices = []` must give a static-index MIP variable for which any component access is an error.)\n\nI've added a doctest for this.\n\nReady for final review",
    "created_at": "2018-09-20T02:10:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20773",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20773#issuecomment-378870",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:10'></a>Replying to [comment:4 mkoeppe]:
>  I definitely want to distinguish `[]` from the default argument ...

> (`indices = []` must give a static-index MIP variable for which any component access is an error.)

I've added a doctest for this.

Ready for final review



---

archive/issue_comments_378871.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-09-20T02:27:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20773",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20773#issuecomment-378871",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_378872.json:
```json
{
    "body": "<a id='comment:11'></a>Thanks. LGTM.",
    "created_at": "2018-09-20T02:27:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20773",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20773#issuecomment-378872",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:11'></a>Thanks. LGTM.



---

archive/issue_comments_378873.json:
```json
{
    "body": "Changing branch from \"u/mkoeppe/mixedintegerlinearprogram_new_variable_could_optionally_take_a__static__list_of_component_indices\" to \"23689ddb190d6e2847fd492c91c996a7afa2bbea\"",
    "created_at": "2018-09-21T22:20:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20773",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20773#issuecomment-378873",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/mkoeppe/mixedintegerlinearprogram_new_variable_could_optionally_take_a__static__list_of_component_indices" to "23689ddb190d6e2847fd492c91c996a7afa2bbea"



---

archive/issue_events_055783.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-09-21T22:20:38Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/20773",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20773#event-55783"
}
```



---

archive/issue_comments_378874.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-09-21T22:20:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20773",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20773#issuecomment-378874",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
