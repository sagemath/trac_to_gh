# Issue 20773: MixedIntegerLinearProgram.new_variable could optionally take a "static" list of component indices

archive/issues_020536.json:
```json
{
    "body": "Currently, `new_variable` allocates backend indices to MIP variable component indices very dynamically.\n\n```\nsage: p = MixedIntegerLinearProgram()\nsage: x = p.new_variable()\nsage: x[7]\nx_0\nsage: x[2]\nx_1\n```\n\nSometimes it could be nice to have a predictable order in the backend; for example, when `.polyhedron()` is to be called. And sometimes it could be nice to declare ahead of time which component indices are valid, making accesses to other indices an error (rather than creating a new backend variable); this could help debug MIP models.\n\nThis could look like this:\n\n```\nsage: p = MixedIntegerLinearProgram()\nsage: x = p.new_variable(indices=range(7))\nsage: p.number_of_variables()\n7\nsage: x[3]\nx_3\nsage: x[11]\nIndexError: 11 does not index a component of MIPVariable of dimension 1\n```\n(This is optional; if no `indices` argument is passed, it keeps the fully dynamic current behavior.)\n\n\nCC:  @dimpase @videlec @jdemeyer @nbruin @fchapoton tmonteil @dcoudert @tscrim\n\nKeywords: lp\n\nBranch/Commit: 23689ddb190d6e2847fd492c91c996a7afa2bbea\n\nReviewer: Travis Scrimshaw\n\nAuthor: Matthias Koeppe\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/20773\n\n",
    "closed_at": "2018-09-21T22:20:38Z",
    "created_at": "2016-06-03T16:19:03Z",
    "labels": [
        "component: numerical"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.4",
    "title": "MixedIntegerLinearProgram.new_variable could optionally take a \"static\" list of component indices",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/20773",
    "user": "https://github.com/mkoeppe"
}
```
Currently, `new_variable` allocates backend indices to MIP variable component indices very dynamically.

```
sage: p = MixedIntegerLinearProgram()
sage: x = p.new_variable()
sage: x[7]
x_0
sage: x[2]
x_1
```

Sometimes it could be nice to have a predictable order in the backend; for example, when `.polyhedron()` is to be called. And sometimes it could be nice to declare ahead of time which component indices are valid, making accesses to other indices an error (rather than creating a new backend variable); this could help debug MIP models.

This could look like this:

```
sage: p = MixedIntegerLinearProgram()
sage: x = p.new_variable(indices=range(7))
sage: p.number_of_variables()
7
sage: x[3]
x_3
sage: x[11]
IndexError: 11 does not index a component of MIPVariable of dimension 1
```
(This is optional; if no `indices` argument is passed, it keeps the fully dynamic current behavior.)


CC:  @dimpase @videlec @jdemeyer @nbruin @fchapoton tmonteil @dcoudert @tscrim

Keywords: lp

Branch/Commit: 23689ddb190d6e2847fd492c91c996a7afa2bbea

Reviewer: Travis Scrimshaw

Author: Matthias Koeppe

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/20773





---

archive/issue_comments_301770.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -15,15 +15,16 @@\n \n \\`\\`\\`\n sage: p = MixedIntegerLinearProgram()\n-sage: x = p.new_variable(components=range(7))\n+sage: x = p.new_variable(indices=range(7))\n sage: p.number_of_variables()\n 7\n sage: x[3]\n x_3\n sage: x[11]\n-IndexError: MIPVariable component index out of range\n+IndexError: 11 does not index a component of MIPVariable of dimension 1\n \\`\\`\\`\n-(This would be optional; if no \\`components\\` argument is passed, it would match the fully dynamic current behavior.)\n+(This is optional; if no \\`indices\\` argument is passed, it keeps the fully dynamic current behavior.)\n+\n \n Comment: 1\n \n```\n",
    "created_at": "2018-09-18T15:49:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20773",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20773#issuecomment-301770",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -15,15 +15,16 @@
 
 \`\`\`
 sage: p = MixedIntegerLinearProgram()
-sage: x = p.new_variable(components=range(7))
+sage: x = p.new_variable(indices=range(7))
 sage: p.number_of_variables()
 7
 sage: x[3]
 x_3
 sage: x[11]
-IndexError: MIPVariable component index out of range
+IndexError: 11 does not index a component of MIPVariable of dimension 1
 \`\`\`
-(This would be optional; if no \`components\` argument is passed, it would match the fully dynamic current behavior.)
+(This is optional; if no \`indices\` argument is passed, it keeps the fully dynamic current behavior.)
+
 
 Comment: 1
 
```




---

archive/issue_events_055782.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2018-09-18T15:49:54Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/20773",
    "milestone": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20773#event-55782"
}
```



---

archive/issue_comments_301771.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-09-18T15:49:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20773",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20773#issuecomment-301771",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_301772.json:
```json
{
    "body": "<a id='comment:2'></a>Needs review. Comments on the proposed interface are welcome.\n\n---\nNew commits:",
    "created_at": "2018-09-18T15:49:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20773",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20773#issuecomment-301772",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'></a>Needs review. Comments on the proposed interface are welcome.

---
New commits:



---

archive/issue_comments_301773.json:
```json
{
    "body": "<a id='comment:3'></a>While it might be a little less verbose, it is more conceptually an optional argument if the default was `None`. Then you could also write the doc as\n\n```\n        - ``indices`` -- (optional) an iterable of keys; components\n          corresponding to these keys are created in order,\n          and access to components with other keys will raise an\n          error; otherwise components of this variable can be\n          indexed by arbitrary keys and are created dynamically\n          on access\n```\nHowever, I don't care strongly either way. So if you want to keep the current version, then you can set a positive review on my behalf.",
    "created_at": "2018-09-18T23:15:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20773",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20773#issuecomment-301773",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:3'></a>While it might be a little less verbose, it is more conceptually an optional argument if the default was `None`. Then you could also write the doc as

```
        - ``indices`` -- (optional) an iterable of keys; components
          corresponding to these keys are created in order,
          and access to components with other keys will raise an
          error; otherwise components of this variable can be
          indexed by arbitrary keys and are created dynamically
          on access
```
However, I don't care strongly either way. So if you want to keep the current version, then you can set a positive review on my behalf.



---

archive/issue_comments_301774.json:
```json
{
    "body": "<a id='comment:4'></a>Replying to [comment:3 tscrim]:\n> While it might be a little less verbose, it is more conceptually an optional argument if the default was `None`. \n\n\nRight, but I definitely want to distinguish `[]` from the default argument (and from a discussion on `Polyhedron` I remember that one developer (Volker?) seems to hold the opinion that `None` and `[]` should never (?) be distinguished by Python methods). \n\n(`indices = []` must give a static-index MIP variable for which any component access is an error.)",
    "created_at": "2018-09-19T13:11:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20773",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20773#issuecomment-301774",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:4'></a>Replying to [comment:3 tscrim]:
> While it might be a little less verbose, it is more conceptually an optional argument if the default was `None`. 


Right, but I definitely want to distinguish `[]` from the default argument (and from a discussion on `Polyhedron` I remember that one developer (Volker?) seems to hold the opinion that `None` and `[]` should never (?) be distinguished by Python methods). 

(`indices = []` must give a static-index MIP variable for which any component access is an error.)



---

archive/issue_comments_301775.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,29 @@\n+Currently, \\`new_variable\\` allocates backend indices to MIP variable component indices very dynamically.\n+\n+\\`\\`\\`\n+sage: p = MixedIntegerLinearProgram()\n+sage: x = p.new_variable()\n+sage: x[7]\n+x_0\n+sage: x[2]\n+x_1\n+\\`\\`\\`\n+\n+Sometimes it could be nice to have a predictable order in the backend; for example, when \\`.polyhedron()\\` is to be called. And sometimes it could be nice to declare ahead of time which component indices are valid, making accesses to other indices an error (rather than creating a new backend variable); this could help debug MIP models.\n+\n+This could look like this:\n+\n+\\`\\`\\`\n+sage: p = MixedIntegerLinearProgram()\n+sage: x = p.new_variable(indices=range(7))\n+sage: p.number_of_variables()\n+7\n+sage: x[3]\n+x_3\n+sage: x[11]\n+IndexError: 11 does not index a component of MIPVariable of dimension 1\n+\\`\\`\\`\n+(This is optional; if no \\`indices\\` argument is passed, it keeps the fully dynamic current behavior.)\n \n \n Comment: 1\n```\n",
    "created_at": "2018-09-19T13:18:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20773",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20773#issuecomment-301775",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,29 @@
+Currently, \`new_variable\` allocates backend indices to MIP variable component indices very dynamically.
+
+\`\`\`
+sage: p = MixedIntegerLinearProgram()
+sage: x = p.new_variable()
+sage: x[7]
+x_0
+sage: x[2]
+x_1
+\`\`\`
+
+Sometimes it could be nice to have a predictable order in the backend; for example, when \`.polyhedron()\` is to be called. And sometimes it could be nice to declare ahead of time which component indices are valid, making accesses to other indices an error (rather than creating a new backend variable); this could help debug MIP models.
+
+This could look like this:
+
+\`\`\`
+sage: p = MixedIntegerLinearProgram()
+sage: x = p.new_variable(indices=range(7))
+sage: p.number_of_variables()
+7
+sage: x[3]
+x_3
+sage: x[11]
+IndexError: 11 does not index a component of MIPVariable of dimension 1
+\`\`\`
+(This is optional; if no \`indices\` argument is passed, it keeps the fully dynamic current behavior.)
 
 
 Comment: 1
```




---

archive/issue_comments_301776.json:
```json
{
    "body": "<a id='comment:6'></a>Replying to [comment:4 mkoeppe]:\n> Replying to [comment:3 tscrim]:\n> > While it might be a little less verbose, it is more conceptually an optional argument if the default was `None`. \n\n> \n> Right, but I definitely want to distinguish `[]` from the default argument (and from a discussion on `Polyhedron` I remember that one developer (Volker?) seems to hold the opinion that `None` and `[]` should never (?) be distinguished by Python methods). \n\n\nThat is not a good rule IMO:\n\n```\nsage: Partition([])\n[]\nsage: Partition(None)  # This makes no sense and rightly raises an error.\n```\nThe only thing you have to be careful about is `if foo:` just needs to be `if foo is None:`. It seems like you having such a non-`False`-bool default value is more likely to cause issues given how Python code usually can be written, and it can mean a more arbitrary default that has less meaning for the code. It also does not mesh well with Cython either. I would be curious to hearing what the argument for this is, but I think `None` and `[]` should be considered as distinguishable. Unless you also want `False`, `()`, and `0` to not be distinguishable either? At least, that is what I think the logic of this rule leads me to conclude.",
    "created_at": "2018-09-19T13:46:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20773",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20773#issuecomment-301776",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:6'></a>Replying to [comment:4 mkoeppe]:
> Replying to [comment:3 tscrim]:
> > While it might be a little less verbose, it is more conceptually an optional argument if the default was `None`. 

> 
> Right, but I definitely want to distinguish `[]` from the default argument (and from a discussion on `Polyhedron` I remember that one developer (Volker?) seems to hold the opinion that `None` and `[]` should never (?) be distinguished by Python methods). 


That is not a good rule IMO:

```
sage: Partition([])
[]
sage: Partition(None)  # This makes no sense and rightly raises an error.
```
The only thing you have to be careful about is `if foo:` just needs to be `if foo is None:`. It seems like you having such a non-`False`-bool default value is more likely to cause issues given how Python code usually can be written, and it can mean a more arbitrary default that has less meaning for the code. It also does not mesh well with Cython either. I would be curious to hearing what the argument for this is, but I think `None` and `[]` should be considered as distinguishable. Unless you also want `False`, `()`, and `0` to not be distinguishable either? At least, that is what I think the logic of this rule leads me to conclude.



---

archive/issue_comments_301777.json:
```json
{
    "body": "<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-09-19T13:56:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20773",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20773#issuecomment-301777",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_301778.json:
```json
{
    "body": "<a id='comment:8'></a>Thanks for the discussion. I've changed it to `None`. Needs review",
    "created_at": "2018-09-19T13:58:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20773",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20773#issuecomment-301778",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:8'></a>Thanks for the discussion. I've changed it to `None`. Needs review



---

archive/issue_comments_301779.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-09-20T02:09:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20773",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20773#issuecomment-301779",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_301780.json:
```json
{
    "body": "<a id='comment:10'></a>Replying to [comment:4 mkoeppe]:\n>  I definitely want to distinguish `[]` from the default argument ...\n\n> (`indices = []` must give a static-index MIP variable for which any component access is an error.)\n\nI've added a doctest for this.\n\nReady for final review",
    "created_at": "2018-09-20T02:10:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20773",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20773#issuecomment-301780",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:10'></a>Replying to [comment:4 mkoeppe]:
>  I definitely want to distinguish `[]` from the default argument ...

> (`indices = []` must give a static-index MIP variable for which any component access is an error.)

I've added a doctest for this.

Ready for final review



---

archive/issue_comments_301781.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-09-20T02:27:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20773",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20773#issuecomment-301781",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_301782.json:
```json
{
    "body": "<a id='comment:11'></a>Thanks. LGTM.",
    "created_at": "2018-09-20T02:27:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20773",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20773#issuecomment-301782",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:11'></a>Thanks. LGTM.



---

archive/issue_events_055783.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-09-21T22:20:38Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/20773",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20773#event-55783"
}
```



---

archive/issue_comments_301783.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-09-21T22:20:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20773",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20773#issuecomment-301783",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
