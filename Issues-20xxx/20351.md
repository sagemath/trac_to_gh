# Issue 20351: sage.libs.ppl.MIP_Problem: Add support for integer variables

archive/issues_020114.json:
```json
{
    "body": "PPL's solver is a rational *MIP* solver. \nIts support for integer variables should be exposed in Sage.\n\nReference: http://bugseng.com/products/ppl/documentation/user/ppl-user-1.2-html/classParma__Polyhedra__Library_1_1MIP__Problem.html\n\nFor `sage.libs.ppl.MIP_Problem`, I think one just needs to add a wrapper for this method:\n\n```\nvoid Parma_Polyhedra_Library::MIP_Problem::add_to_integer_space_dimensions(const Variables_Set &i_vars)\t\n```\nand then a wrapper class for [`Variables_Set`](http://bugseng.com/products/ppl/documentation/user/ppl-user-1.2-html/classParma__Polyhedra__Library_1_1Variables__Set.html).\n\nOn another ticket (#20354), `PPLBackend` will be updated accordingly.\n\nCC:  @dimpase @videlec @jdemeyer\n\nKeywords: lp\n\nBranch/Commit: 9f35b65ae443d565bcf53319fc57751baf640fc8\n\nReviewer: Dima Pasechnik\n\nAuthor: Matthias Koeppe\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/20351\n\n",
    "closed_at": "2016-04-05T16:41:18Z",
    "created_at": "2016-04-03T16:13:17Z",
    "labels": [
        "component: numerical"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.2",
    "title": "sage.libs.ppl.MIP_Problem: Add support for integer variables",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/20351",
    "user": "https://github.com/mkoeppe"
}
```
PPL's solver is a rational *MIP* solver. 
Its support for integer variables should be exposed in Sage.

Reference: http://bugseng.com/products/ppl/documentation/user/ppl-user-1.2-html/classParma__Polyhedra__Library_1_1MIP__Problem.html

For `sage.libs.ppl.MIP_Problem`, I think one just needs to add a wrapper for this method:

```
void Parma_Polyhedra_Library::MIP_Problem::add_to_integer_space_dimensions(const Variables_Set &i_vars)	
```
and then a wrapper class for [`Variables_Set`](http://bugseng.com/products/ppl/documentation/user/ppl-user-1.2-html/classParma__Polyhedra__Library_1_1Variables__Set.html).

On another ticket (#20354), `PPLBackend` will be updated accordingly.

CC:  @dimpase @videlec @jdemeyer

Keywords: lp

Branch/Commit: 9f35b65ae443d565bcf53319fc57751baf640fc8

Reviewer: Dima Pasechnik

Author: Matthias Koeppe

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/20351





---

archive/issue_comments_372590.json:
```json
{
    "body": "<a id='comment:2'></a>\nGood catch! I wish I knew this when I still had the student, who wrote the Cython bindings for the ppl LP, around. (He is now at Facebook...)",
    "created_at": "2016-04-03T17:12:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20351#issuecomment-372590",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:2'></a>
Good catch! I wish I knew this when I still had the student, who wrote the Cython bindings for the ppl LP, around. (He is now at Facebook...)



---

archive/issue_comments_372591.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,12 @@\n PPL is a rational MIP solver. \n Its support for integer variables should be exposed in Sage.\n \n+Reference: http://bugseng.com/products/ppl/documentation/user/ppl-user-1.2-html/classParma__Polyhedra__Library_1_1MIP__Problem.html\n \n+For `sage.libs.ppl.MIP_Problem`, I think one just needs to add a wrapper for this method:\n+\n+```\n+void Parma_Polyhedra_Library::MIP_Problem::add_to_integer_space_dimensions(const Variables_Set &i_vars)\t\n+```\n+and then a wrapper class for `Variables_Set`.\n+\n``````\n",
    "created_at": "2016-04-03T17:13:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20351#issuecomment-372591",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,12 @@
 PPL is a rational MIP solver. 
 Its support for integer variables should be exposed in Sage.
 
+Reference: http://bugseng.com/products/ppl/documentation/user/ppl-user-1.2-html/classParma__Polyhedra__Library_1_1MIP__Problem.html
 
+For `sage.libs.ppl.MIP_Problem`, I think one just needs to add a wrapper for this method:
+
+```
+void Parma_Polyhedra_Library::MIP_Problem::add_to_integer_space_dimensions(const Variables_Set &i_vars)	
+```
+and then a wrapper class for `Variables_Set`.
+
``````




---

archive/issue_comments_372592.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -8,5 +8,5 @@\n ```\n void Parma_Polyhedra_Library::MIP_Problem::add_to_integer_space_dimensions(const Variables_Set &i_vars)\t\n ```\n-and then a wrapper class for `Variables_Set`.\n+and then a wrapper class for [`Variables_Set`](http://bugseng.com/products/ppl/documentation/user/ppl-user-1.2-html/classParma__Polyhedra__Library_1_1Variables__Set.html).\n \n``````\n",
    "created_at": "2016-04-03T17:20:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20351#issuecomment-372592",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -8,5 +8,5 @@
 ```
 void Parma_Polyhedra_Library::MIP_Problem::add_to_integer_space_dimensions(const Variables_Set &i_vars)	
 ```
-and then a wrapper class for `Variables_Set`.
+and then a wrapper class for [`Variables_Set`](http://bugseng.com/products/ppl/documentation/user/ppl-user-1.2-html/classParma__Polyhedra__Library_1_1Variables__Set.html).
 
``````




---

archive/issue_comments_372593.json:
```json
{
    "body": "<a id='comment:5'></a>\nReplying to [dimpase](#comment%3A2):\n> Good catch! I wish I knew this when I still had the student, who wrote the Cython bindings for the ppl LP, around. (He is now at Facebook...)\n\n\nI'll write it if you review my other tickets ;)",
    "created_at": "2016-04-03T17:28:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20351#issuecomment-372593",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:5'></a>
Replying to [dimpase](#comment%3A2):
> Good catch! I wish I knew this when I still had the student, who wrote the Cython bindings for the ppl LP, around. (He is now at Facebook...)


I'll write it if you review my other tickets ;)



---

archive/issue_comments_372594.json:
```json
{
    "body": "Changing branch from \"\" to \"u/mkoeppe/sage_libs_ppl_mip_problem_and_pplbackend__add_support_for_integer_variables\"",
    "created_at": "2016-04-04T07:14:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20351#issuecomment-372594",
    "user": "https://github.com/mkoeppe"
}
```

Changing branch from "" to "u/mkoeppe/sage_libs_ppl_mip_problem_and_pplbackend__add_support_for_integer_variables"



---

archive/issue_comments_372595.json:
```json
{
    "body": "Changing commit from \"\" to \"9f35b65ae443d565bcf53319fc57751baf640fc8\"",
    "created_at": "2016-04-04T07:25:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20351#issuecomment-372595",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "" to "9f35b65ae443d565bcf53319fc57751baf640fc8"



---

archive/issue_comments_372596.json:
```json
{
    "body": "<a id='comment:7'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                                                  |\n|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------|\n|[9f35b65](https://github.com/sagemath/sagetrac-mirror/commit/9f35b65ae443d565bcf53319fc57751baf640fc8)|`Wrap MIP_Problem.add_to_integer_space_dimensions`|",
    "created_at": "2016-04-04T07:25:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20351#issuecomment-372596",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                                                  |
|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------|
|[9f35b65](https://github.com/sagemath/sagetrac-mirror/commit/9f35b65ae443d565bcf53319fc57751baf640fc8)|`Wrap MIP_Problem.add_to_integer_space_dimensions`|



---

archive/issue_comments_372597.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-PPL is a rational MIP solver. \n+PPL's solver is a rational *MIP* solver. \n Its support for integer variables should be exposed in Sage.\n \n Reference: http://bugseng.com/products/ppl/documentation/user/ppl-user-1.2-html/classParma__Polyhedra__Library_1_1MIP__Problem.html\n@@ -10,3 +10,4 @@\n ```\n and then a wrapper class for [`Variables_Set`](http://bugseng.com/products/ppl/documentation/user/ppl-user-1.2-html/classParma__Polyhedra__Library_1_1Variables__Set.html).\n \n+On another ticket, PPLBackend will be updated accordingly.\n``````\n",
    "created_at": "2016-04-04T07:27:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20351#issuecomment-372597",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-PPL is a rational MIP solver. 
+PPL's solver is a rational *MIP* solver. 
 Its support for integer variables should be exposed in Sage.
 
 Reference: http://bugseng.com/products/ppl/documentation/user/ppl-user-1.2-html/classParma__Polyhedra__Library_1_1MIP__Problem.html
@@ -10,3 +10,4 @@
 ```
 and then a wrapper class for [`Variables_Set`](http://bugseng.com/products/ppl/documentation/user/ppl-user-1.2-html/classParma__Polyhedra__Library_1_1Variables__Set.html).
 
+On another ticket, PPLBackend will be updated accordingly.
``````




---

archive/issue_events_062751.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/20351",
    "rename": {
        "from": "sage.libs.ppl.MIP_Problem and PPLBackend: Add support for integer variables",
        "to": "sage.libs.ppl.MIP_Problem: Add support for integer variables"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20351#event-62751"
}
```



---

archive/issue_comments_372598.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-04-04T07:27:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20351#issuecomment-372598",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_372599.json:
```json
{
    "body": "Changing author from \"\" to \"Matthias Koeppe\"",
    "created_at": "2016-04-04T07:27:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20351#issuecomment-372599",
    "user": "https://github.com/mkoeppe"
}
```

Changing author from "" to "Matthias Koeppe"



---

archive/issue_comments_372600.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -10,4 +10,4 @@\n ```\n and then a wrapper class for [`Variables_Set`](http://bugseng.com/products/ppl/documentation/user/ppl-user-1.2-html/classParma__Polyhedra__Library_1_1Variables__Set.html).\n \n-On another ticket, PPLBackend will be updated accordingly.\n+On another ticket (#20354), `PPLBackend` will be updated accordingly.\n``````\n",
    "created_at": "2016-04-04T07:30:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20351#issuecomment-372600",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -10,4 +10,4 @@
 ```
 and then a wrapper class for [`Variables_Set`](http://bugseng.com/products/ppl/documentation/user/ppl-user-1.2-html/classParma__Polyhedra__Library_1_1Variables__Set.html).
 
-On another ticket, PPLBackend will be updated accordingly.
+On another ticket (#20354), `PPLBackend` will be updated accordingly.
``````




---

archive/issue_comments_372601.json:
```json
{
    "body": "<a id='comment:10'></a>\nAre indices of variables 0-based, 1-based?\nCould this info be added to docs?",
    "created_at": "2016-04-04T09:55:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20351#issuecomment-372601",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:10'></a>
Are indices of variables 0-based, 1-based?
Could this info be added to docs?



---

archive/issue_comments_372602.json:
```json
{
    "body": "<a id='comment:11'></a>\nCan one use this to generate integer hull of a polytope defined by inequalities (perhaps after adjusting the corresponding Polyhedron code)?\nOr is this optimisation-only thing?",
    "created_at": "2016-04-04T10:27:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20351#issuecomment-372602",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:11'></a>
Can one use this to generate integer hull of a polytope defined by inequalities (perhaps after adjusting the corresponding Polyhedron code)?
Or is this optimisation-only thing?



---

archive/issue_comments_372603.json:
```json
{
    "body": "<a id='comment:12'></a>\n> Are indices of variables 0-based, 1-based?\n> Could this info be added to docs?\n\n\nThis is already documented in the class docstring of `Variable`. (It's 0-based.)\n\n> Can one use this to generate integer hull of a polytope defined by inequalities (perhaps after adjusting the corresponding Polyhedron code)?\n> Or is this optimisation-only thing?\n\n\nNo, PPL does not have code for computing integer hulls. \nThe closest that there is in the polyhedron code is the following interesting function:\n\n```\nvoid Parma_Polyhedra_Library::Polyhedron::drop_some_non_integer_points(Complexity_Class complexity = ANY_COMPLEXITY)\t\nPossibly tightens *this by dropping some points with non-integer coordinates.\n```\n\nI would be quite interested in having code in Sage that computes a polyhedron given only by a linear optimization oracle [for example, implemented by a MIP solver], see for example http://arxiv.org/pdf/1412.3987.pdf. But this has nothing to do with this ticket.",
    "created_at": "2016-04-04T18:59:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20351#issuecomment-372603",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:12'></a>
> Are indices of variables 0-based, 1-based?
> Could this info be added to docs?


This is already documented in the class docstring of `Variable`. (It's 0-based.)

> Can one use this to generate integer hull of a polytope defined by inequalities (perhaps after adjusting the corresponding Polyhedron code)?
> Or is this optimisation-only thing?


No, PPL does not have code for computing integer hulls. 
The closest that there is in the polyhedron code is the following interesting function:

```
void Parma_Polyhedra_Library::Polyhedron::drop_some_non_integer_points(Complexity_Class complexity = ANY_COMPLEXITY)	
Possibly tightens *this by dropping some points with non-integer coordinates.
```

I would be quite interested in having code in Sage that computes a polyhedron given only by a linear optimization oracle [for example, implemented by a MIP solver], see for example http://arxiv.org/pdf/1412.3987.pdf. But this has nothing to do with this ticket.



---

archive/issue_comments_372604.json:
```json
{
    "body": "<a id='comment:13'></a>\nIMHO in `add_to_integer_space_dimensions` one should have `sig_on()` inside `try:` block, not outside. And `sig_off()` should be immediately after the call to the backend.\n\nsee [catch_interrupts()](http://www.sagemath.org/git-developer-guide/coding_in_cython.html)",
    "created_at": "2016-04-04T19:50:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20351#issuecomment-372604",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:13'></a>
IMHO in `add_to_integer_space_dimensions` one should have `sig_on()` inside `try:` block, not outside. And `sig_off()` should be immediately after the call to the backend.

see [catch_interrupts()](http://www.sagemath.org/git-developer-guide/coding_in_cython.html)



---

archive/issue_comments_372605.json:
```json
{
    "body": "<a id='comment:14'></a>\nThe code in `add_to_integer_space_dimensions` matches the last example in the documentation that you cited. I'm assuming it's correct. Besides, it was copy-paste from elsewhere in ppl.pyx. \n\n```\nAlternatively, you can use try/finally which will also catch exceptions raised by subroutines inside the try:\n\ndef try_finally_example():\n    sig_on()\n    try:\n        # (some long computation, potentially raising exceptions)\n    finally:\n        sig_off()\n    return something\n```",
    "created_at": "2016-04-05T05:14:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20351#issuecomment-372605",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:14'></a>
The code in `add_to_integer_space_dimensions` matches the last example in the documentation that you cited. I'm assuming it's correct. Besides, it was copy-paste from elsewhere in ppl.pyx. 

```
Alternatively, you can use try/finally which will also catch exceptions raised by subroutines inside the try:

def try_finally_example():
    sig_on()
    try:
        # (some long computation, potentially raising exceptions)
    finally:
        sig_off()
    return something
```



---

archive/issue_comments_372606.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-04-05T08:16:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20351#issuecomment-372606",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_372607.json:
```json
{
    "body": "<a id='comment:15'></a>\nOK, good. Although I am a bit concerned about few `def` statements that could be `cdef` or `cpdef`, for efficiency reasons.",
    "created_at": "2016-04-05T08:16:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20351#issuecomment-372607",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:15'></a>
OK, good. Although I am a bit concerned about few `def` statements that could be `cdef` or `cpdef`, for efficiency reasons.



---

archive/issue_comments_372608.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Dima Pasechnik\"",
    "created_at": "2016-04-05T08:16:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20351#issuecomment-372608",
    "user": "https://github.com/dimpase"
}
```

Changing reviewer from "" to "Dima Pasechnik"



---

archive/issue_comments_372609.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-04-05T16:41:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20351#issuecomment-372609",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_372610.json:
```json
{
    "body": "Changing branch from \"u/mkoeppe/sage_libs_ppl_mip_problem_and_pplbackend__add_support_for_integer_variables\" to \"9f35b65ae443d565bcf53319fc57751baf640fc8\"",
    "created_at": "2016-04-05T16:41:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20351#issuecomment-372610",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/mkoeppe/sage_libs_ppl_mip_problem_and_pplbackend__add_support_for_integer_variables" to "9f35b65ae443d565bcf53319fc57751baf640fc8"



---

archive/issue_events_062752.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-04-05T16:41:18Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/20351",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20351#event-62752"
}
```
