# Issue 20528: upgrade patchbot to 2.5.7

archive/issues_020291.json:
```json
{
    "assignees": [],
    "body": "with a better treatment of startup modules\n\nalso correcting a detail about owner option\n\nand no longer using os.getcwd()\n\nTarball: \u200b\u200b\u200bhttp://www-irma.u-strasbg.fr/~chapoton/patchbot-2.5.7.tar.bz2\n\n**CC:**  @jdemeyer @videlec @embray\n\n**Branch/Commit:** [e5a230d0395754fcbfd5afa2917198dbbea22b23](https://github.com/sagemath/sagetrac-mirror/commit/e5a230d0395754fcbfd5afa2917198dbbea22b23)\n\n**Reviewer:** Jeroen Demeyer\n\n**Author:** Fr\u00e9d\u00e9ric Chapoton\n\nIssue created by migration from https://trac.sagemath.org/ticket/20528\n\n",
    "closed_at": "2016-05-24T22:25:42Z",
    "created_at": "2016-05-01T13:32:23Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20packages%3A%20optional",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-7.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "upgrade patchbot to 2.5.7",
    "type": "issue",
    "updated_at": "2016-05-24T22:25:42Z",
    "url": "https://github.com/sagemath/sage/issues/20528",
    "user": "https://github.com/fchapoton"
}
```
with a better treatment of startup modules

also correcting a detail about owner option

and no longer using os.getcwd()

Tarball: ​​​http://www-irma.u-strasbg.fr/~chapoton/patchbot-2.5.7.tar.bz2

**CC:**  @jdemeyer @videlec @embray

**Branch/Commit:** [e5a230d0395754fcbfd5afa2917198dbbea22b23](https://github.com/sagemath/sagetrac-mirror/commit/e5a230d0395754fcbfd5afa2917198dbbea22b23)

**Reviewer:** Jeroen Demeyer

**Author:** Frédéric Chapoton

Issue created by migration from https://trac.sagemath.org/ticket/20528





---

archive/issue_events_250000.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-05-01T13:32:23Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/20528",
    "milestone_number": null,
    "milestone_title": "sage-7.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20528#event-250000"
}
```



---

archive/issue_events_250001.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-05-01T13:32:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20528",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20packages%3A%20optional",
    "label_color": "08517b",
    "label_name": "component: packages: optional",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20528#event-250001"
}
```



---

archive/issue_events_250002.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-05-01T13:32:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20528",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "008080",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20528#event-250002"
}
```



---

archive/issue_comments_299080.json:
```json
{
    "body": "**Branch:** [public/20528](https://github.com/sagemath/sagetrac-mirror/tree/public/20528)",
    "created_at": "2016-05-01T13:37:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20528#issuecomment-299080",
    "user": "https://github.com/fchapoton"
}
```

**Branch:** [public/20528](https://github.com/sagemath/sagetrac-mirror/tree/public/20528)



---

archive/issue_comments_299081.json:
```json
{
    "body": "**Commit:** [66cacb81e26e5a4ebfc1e4ad181c5dd9fcb6707c](https://github.com/sagemath/sagetrac-mirror/commit/66cacb81e26e5a4ebfc1e4ad181c5dd9fcb6707c)",
    "created_at": "2016-05-01T13:37:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20528#issuecomment-299081",
    "user": "https://github.com/fchapoton"
}
```

**Commit:** [66cacb81e26e5a4ebfc1e4ad181c5dd9fcb6707c](https://github.com/sagemath/sagetrac-mirror/commit/66cacb81e26e5a4ebfc1e4ad181c5dd9fcb6707c)



---

archive/issue_comments_299082.json:
```json
{
    "body": "<a id='comment:1'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/66cacb81e26e5a4ebfc1e4ad181c5dd9fcb6707c\">66cacb8</a></td><td><code>update patchbot to 2.5.6</code></td></tr></table>\n",
    "created_at": "2016-05-01T13:37:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20528#issuecomment-299082",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:1'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/66cacb81e26e5a4ebfc1e4ad181c5dd9fcb6707c">66cacb8</a></td><td><code>update patchbot to 2.5.6</code></td></tr></table>




---

archive/issue_events_250003.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-05-01T13:37:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20528",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20528#event-250003"
}
```



---

archive/issue_events_250004.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-05-03T08:29:07Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20528",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20528#event-250004"
}
```



---

archive/issue_events_250005.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-05-03T08:29:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20528",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20528#event-250005"
}
```



---

archive/issue_comments_299083.json:
```json
{
    "body": "<a id='comment:3'></a>\n\n```\nFound local metadata for patchbot-2.5.6\nInvalid checksum for cached file /home/worker/sage-patchbot/upstream/patchbot-2.5.6.tar.bz2, deleting\n```",
    "created_at": "2016-05-03T08:29:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20528#issuecomment-299083",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:3'></a>

```
Found local metadata for patchbot-2.5.6
Invalid checksum for cached file /home/worker/sage-patchbot/upstream/patchbot-2.5.6.tar.bz2, deleting
```



---

archive/issue_comments_299084.json:
```json
{
    "body": "<a id='comment:4'></a>\nping?",
    "created_at": "2016-05-09T09:43:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20528#issuecomment-299084",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:4'></a>
ping?



---

archive/issue_comments_299085.json:
```json
{
    "body": "<a id='comment:5'></a>\nI am not currently able to upload files to the place where I usually store my patchbot tars. So I cannot do anything for that ticket right now, sorry.",
    "created_at": "2016-05-09T09:50:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20528#issuecomment-299085",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:5'></a>
I am not currently able to upload files to the place where I usually store my patchbot tars. So I cannot do anything for that ticket right now, sorry.



---

archive/issue_comments_299086.json:
```json
{
    "body": "<a id='comment:6'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/92845e2568c309eaa968d5ea7df5d4ee7724b6fc\">92845e2</a></td><td><code>Merge branch 'public/20528' into 7.2.rc1</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0b9787026bfd07d7fb7c9754804eb1a8b2282278\">0b97870</a></td><td><code>fixing checksum for patchbot 2.5.6</code></td></tr></table>\n",
    "created_at": "2016-05-09T10:03:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20528#issuecomment-299086",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:6'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/92845e2568c309eaa968d5ea7df5d4ee7724b6fc">92845e2</a></td><td><code>Merge branch 'public/20528' into 7.2.rc1</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0b9787026bfd07d7fb7c9754804eb1a8b2282278">0b97870</a></td><td><code>fixing checksum for patchbot 2.5.6</code></td></tr></table>




---

archive/issue_comments_299087.json:
```json
{
    "body": "**Changing commit** from \"[66cacb81e26e5a4ebfc1e4ad181c5dd9fcb6707c](https://github.com/sagemath/sagetrac-mirror/commit/66cacb81e26e5a4ebfc1e4ad181c5dd9fcb6707c)\" to \"[0b9787026bfd07d7fb7c9754804eb1a8b2282278](https://github.com/sagemath/sagetrac-mirror/commit/0b9787026bfd07d7fb7c9754804eb1a8b2282278)\".",
    "created_at": "2016-05-09T10:03:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20528#issuecomment-299087",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[66cacb81e26e5a4ebfc1e4ad181c5dd9fcb6707c](https://github.com/sagemath/sagetrac-mirror/commit/66cacb81e26e5a4ebfc1e4ad181c5dd9fcb6707c)" to "[0b9787026bfd07d7fb7c9754804eb1a8b2282278](https://github.com/sagemath/sagetrac-mirror/commit/0b9787026bfd07d7fb7c9754804eb1a8b2282278)".



---

archive/issue_comments_299088.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -2,4 +2,4 @@\n \n also correcting a detail about owner option\n \n-Tarball: \u200b\u200b\u200bhttp://chapoton.perso.math.cnrs.fr/patchbot-2.5.6.tar.bz2\n+Tarball: \u200b\u200b\u200bhttp://irma.u-strasbg.fr/~chapoton/patchbot-2.5.6.tar.bz2\n``````\n",
    "created_at": "2016-05-09T10:07:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20528#issuecomment-299088",
    "user": "https://github.com/fchapoton"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -2,4 +2,4 @@
 
 also correcting a detail about owner option
 
-Tarball: ​​​http://chapoton.perso.math.cnrs.fr/patchbot-2.5.6.tar.bz2
+Tarball: ​​​http://irma.u-strasbg.fr/~chapoton/patchbot-2.5.6.tar.bz2
``````




---

archive/issue_comments_299089.json:
```json
{
    "body": "<a id='comment:7'></a>\nok, here is a corrected and working branch, with the tar.bz2 put on my website",
    "created_at": "2016-05-09T10:07:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20528#issuecomment-299089",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:7'></a>
ok, here is a corrected and working branch, with the tar.bz2 put on my website



---

archive/issue_events_250006.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-05-09T10:07:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20528",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20528#event-250006"
}
```



---

archive/issue_events_250007.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-05-09T10:07:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20528",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20528#event-250007"
}
```



---

archive/issue_comments_299090.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -2,4 +2,4 @@\n \n also correcting a detail about owner option\n \n-Tarball: \u200b\u200b\u200bhttp://irma.u-strasbg.fr/~chapoton/patchbot-2.5.6.tar.bz2\n+Tarball: \u200b\u200b\u200bhttp://www-irma.u-strasbg.fr/~chapoton/patchbot-2.5.6.tar.bz2\n``````\n",
    "created_at": "2016-05-10T06:07:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20528#issuecomment-299090",
    "user": "https://github.com/fchapoton"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -2,4 +2,4 @@
 
 also correcting a detail about owner option
 
-Tarball: ​​​http://irma.u-strasbg.fr/~chapoton/patchbot-2.5.6.tar.bz2
+Tarball: ​​​http://www-irma.u-strasbg.fr/~chapoton/patchbot-2.5.6.tar.bz2
``````




---

archive/issue_comments_299091.json:
```json
{
    "body": "<a id='comment:9'></a>\nI will test this on `sage4` and `arando`.",
    "created_at": "2016-05-11T08:09:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20528#issuecomment-299091",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:9'></a>
I will test this on `sage4` and `arando`.



---

archive/issue_comments_299092.json:
```json
{
    "body": "<a id='comment:10'></a>\nseems to be ok on sage4, but meeting problems in arando",
    "created_at": "2016-05-11T11:20:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20528#issuecomment-299092",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:10'></a>
seems to be ok on sage4, but meeting problems in arando



---

archive/issue_comments_299093.json:
```json
{
    "body": "<a id='comment:11'></a>\nThe patchbot on arando is stuck on\n\n```\n[2016-05-12 09:40:11] The following tickets will be skipped: #15590 (until 1463039060.99)\n[2016-05-12 09:40:11] Check base.\nTraceback (most recent call last):\n  File \"/home/patchbot/sage-patchbot/local/bin/patchbot/patchbot.py\", line 1432, in main\n    if not patchbot.check_base():\n  File \"/home/patchbot/sage-patchbot/local/bin/patchbot/patchbot.py\", line 689, in check_base\n    cwd = os.getcwd()\nOSError: [Errno 2] No such file or directory\n```",
    "created_at": "2016-05-12T09:45:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20528#issuecomment-299093",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:11'></a>
The patchbot on arando is stuck on

```
[2016-05-12 09:40:11] The following tickets will be skipped: #15590 (until 1463039060.99)
[2016-05-12 09:40:11] Check base.
Traceback (most recent call last):
  File "/home/patchbot/sage-patchbot/local/bin/patchbot/patchbot.py", line 1432, in main
    if not patchbot.check_base():
  File "/home/patchbot/sage-patchbot/local/bin/patchbot/patchbot.py", line 689, in check_base
    cwd = os.getcwd()
OSError: [Errno 2] No such file or directory
```



---

archive/issue_comments_299094.json:
```json
{
    "body": "<a id='comment:12'></a>\nHmm, this could be caused by a directory being removed, or by a filesystem problem.\nIn which dir are you when launching the patchbot ? Have you removed this dir ?\n\nI could wrap that with a `try except` clause. But I am using the variable `cwd` to get back to the original directory at the end of the function (by using os.chdir(cwd)). This is because I need to be in the sage_root directory when performing git operations.\n\nEDIT: or maybe I could try to use `os.getenv('PWD')` instead ?",
    "created_at": "2016-05-12T10:00:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20528#issuecomment-299094",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:12'></a>
Hmm, this could be caused by a directory being removed, or by a filesystem problem.
In which dir are you when launching the patchbot ? Have you removed this dir ?

I could wrap that with a `try except` clause. But I am using the variable `cwd` to get back to the original directory at the end of the function (by using os.chdir(cwd)). This is because I need to be in the sage_root directory when performing git operations.

EDIT: or maybe I could try to use `os.getenv('PWD')` instead ?



---

archive/issue_comments_299095.json:
```json
{
    "body": "<a id='comment:13'></a>\nReplying to [@fchapoton](#comment%3A12):\n> Hmm, this could be caused by a directory being removed, or by a filesystem problem.\n> In which dir are you when launching the patchbot ?\n\n`/home/patchbot/sage-patchbot`\n\n> Have you removed this dir ?\n\nNo.\n\n> But I am using the variable cwd to get back to the original directory\n\nIs this really needed? I don't know the code exactly, but why can't you just `chdir()` to `SAGE_ROOT` and stay there?\n\nIf you *really* need to go back to the potentially-removed directory, you should use `os.fchdir()` instead of `os.chdir()` which will work even on deleted or moved directories.",
    "created_at": "2016-05-12T11:27:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20528#issuecomment-299095",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:13'></a>
Replying to [@fchapoton](#comment%3A12):
> Hmm, this could be caused by a directory being removed, or by a filesystem problem.
> In which dir are you when launching the patchbot ?

`/home/patchbot/sage-patchbot`

> Have you removed this dir ?

No.

> But I am using the variable cwd to get back to the original directory

Is this really needed? I don't know the code exactly, but why can't you just `chdir()` to `SAGE_ROOT` and stay there?

If you *really* need to go back to the potentially-removed directory, you should use `os.fchdir()` instead of `os.chdir()` which will work even on deleted or moved directories.



---

archive/issue_comments_299096.json:
```json
{
    "body": "**Changing commit** from \"[0b9787026bfd07d7fb7c9754804eb1a8b2282278](https://github.com/sagemath/sagetrac-mirror/commit/0b9787026bfd07d7fb7c9754804eb1a8b2282278)\" to \"[e5a230d0395754fcbfd5afa2917198dbbea22b23](https://github.com/sagemath/sagetrac-mirror/commit/e5a230d0395754fcbfd5afa2917198dbbea22b23)\".",
    "created_at": "2016-05-12T13:43:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20528#issuecomment-299096",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[0b9787026bfd07d7fb7c9754804eb1a8b2282278](https://github.com/sagemath/sagetrac-mirror/commit/0b9787026bfd07d7fb7c9754804eb1a8b2282278)" to "[e5a230d0395754fcbfd5afa2917198dbbea22b23](https://github.com/sagemath/sagetrac-mirror/commit/e5a230d0395754fcbfd5afa2917198dbbea22b23)".



---

archive/issue_comments_299097.json:
```json
{
    "body": "<a id='comment:14'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e5a230d0395754fcbfd5afa2917198dbbea22b23\">e5a230d</a></td><td><code>patchbot 2.5.7, without using os.getcwd()</code></td></tr></table>\n",
    "created_at": "2016-05-12T13:43:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20528#issuecomment-299097",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:14'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e5a230d0395754fcbfd5afa2917198dbbea22b23">e5a230d</a></td><td><code>patchbot 2.5.7, without using os.getcwd()</code></td></tr></table>




---

archive/issue_comments_299098.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -2,4 +2,6 @@\n \n also correcting a detail about owner option\n \n-Tarball: \u200b\u200b\u200bhttp://www-irma.u-strasbg.fr/~chapoton/patchbot-2.5.6.tar.bz2\n+and no longer using os.getcwd()\n+\n+Tarball: \u200b\u200b\u200bhttp://www-irma.u-strasbg.fr/~chapoton/patchbot-2.5.7.tar.bz2\n``````\n",
    "created_at": "2016-05-12T13:44:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20528#issuecomment-299098",
    "user": "https://github.com/fchapoton"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -2,4 +2,6 @@
 
 also correcting a detail about owner option
 
-Tarball: ​​​http://www-irma.u-strasbg.fr/~chapoton/patchbot-2.5.6.tar.bz2
+and no longer using os.getcwd()
+
+Tarball: ​​​http://www-irma.u-strasbg.fr/~chapoton/patchbot-2.5.7.tar.bz2
``````




---

archive/issue_comments_299099.json:
```json
{
    "body": "<a id='comment:15'></a>\nhere is a new version not using os.getcwd, simply changing dir to sage root",
    "created_at": "2016-05-12T13:44:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20528#issuecomment-299099",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:15'></a>
here is a new version not using os.getcwd, simply changing dir to sage root



---

archive/issue_events_250008.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-05-12T13:44:39Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/20528",
    "rename": {
        "from": "upgrade patchbot to 2.5.6",
        "to": "upgrade patchbot to 2.5.7"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20528#event-250008"
}
```



---

archive/issue_comments_299100.json:
```json
{
    "body": "<a id='comment:16'></a>\nI will test the new version on arando and sage4\n\nQuestion (unrelated to this ticket): do you think that the patchbot should also test all optional packages with doctests? It might be a good idea to do that, to run all `# optional` tests depending on optional packages.",
    "created_at": "2016-05-13T08:43:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20528#issuecomment-299100",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:16'></a>
I will test the new version on arando and sage4

Question (unrelated to this ticket): do you think that the patchbot should also test all optional packages with doctests? It might be a good idea to do that, to run all `# optional` tests depending on optional packages.



---

archive/issue_comments_299101.json:
```json
{
    "body": "<a id='comment:17'></a>\nI saw this in the patchbot log while handling ticket #0. I don't know how serious it is.\n\n```\nTraceback (most recent call last):\n  File \"/home/patchbot/sage-patchbot/local/bin/patchbot/patchbot.py\", line 1280, in report_ticket\n    report['owner'] = self.owner\nAttributeError: 'Patchbot' object has no attribute 'owner'\n```",
    "created_at": "2016-05-13T11:49:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20528#issuecomment-299101",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:17'></a>
I saw this in the patchbot log while handling ticket #0. I don't know how serious it is.

```
Traceback (most recent call last):
  File "/home/patchbot/sage-patchbot/local/bin/patchbot/patchbot.py", line 1280, in report_ticket
    report['owner'] = self.owner
AttributeError: 'Patchbot' object has no attribute 'owner'
```



---

archive/issue_comments_299102.json:
```json
{
    "body": "<a id='comment:18'></a>\nThis has been solved in patchbot >= 2.5.6.\n\nFor which version of the bot do you see that ?",
    "created_at": "2016-05-13T11:50:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20528#issuecomment-299102",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:18'></a>
This has been solved in patchbot >= 2.5.6.

For which version of the bot do you see that ?



---

archive/issue_comments_299103.json:
```json
{
    "body": "<a id='comment:19'></a>\nIt seems that the patchbot auto-downgrades itself to 2.5.5. Is this the normal behaviour ? I know that we auto-upgrade optional packages.. Anyway, this should not be a problem, once the patchbot is launched and running smoothly. But everytime you stop it, in this testing phase, you must be careful to re-install the latest version before re-launching.",
    "created_at": "2016-05-13T12:07:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20528#issuecomment-299103",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:19'></a>
It seems that the patchbot auto-downgrades itself to 2.5.5. Is this the normal behaviour ? I know that we auto-upgrade optional packages.. Anyway, this should not be a problem, once the patchbot is launched and running smoothly. But everytime you stop it, in this testing phase, you must be careful to re-install the latest version before re-launching.



---

archive/issue_comments_299104.json:
```json
{
    "body": "<a id='comment:20'></a>\nConcerning the optional doctests in general, I do not quite understand what is the status currently. Looking at the log\n\nhttp://patchbot.sagemath.org/log/0/Ubuntu/14.04/i686/3.13.0-76-generic/arando/2016-05-13%2010:28:37?short\n\none sees the lines\n\n```\nUsing --optional=4ti2,benzene,bliss,buckygen,cbc,ccache,coxeter3,csdp,database_cremona_ellcurve,database_gap,database_jones_numfield,database_mutation_class,database_odlyzko_zeta,database_pari,database_stein_watkins,database_symbolic_data,dot2tex,gambit,gap_packages,gdb,giac,giacpy,lrslib,mcqd,meataxe,modular_decomposition,mpir,patchbot,plantri,python2,qepcad,saclib,sage,tdlib,tides,topcom\nDoctesting entire Sage library.\n```\nSo it seems that indeed all optional things are tested. But maybe you did something special to achieve that ?\n\n\nSee also #20604 for fixing the optional doctest failing with coxeter3.",
    "created_at": "2016-05-13T12:16:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20528#issuecomment-299104",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:20'></a>
Concerning the optional doctests in general, I do not quite understand what is the status currently. Looking at the log

http://patchbot.sagemath.org/log/0/Ubuntu/14.04/i686/3.13.0-76-generic/arando/2016-05-13%2010:28:37?short

one sees the lines

```
Using --optional=4ti2,benzene,bliss,buckygen,cbc,ccache,coxeter3,csdp,database_cremona_ellcurve,database_gap,database_jones_numfield,database_mutation_class,database_odlyzko_zeta,database_pari,database_stein_watkins,database_symbolic_data,dot2tex,gambit,gap_packages,gdb,giac,giacpy,lrslib,mcqd,meataxe,modular_decomposition,mpir,patchbot,plantri,python2,qepcad,saclib,sage,tdlib,tides,topcom
Doctesting entire Sage library.
```
So it seems that indeed all optional things are tested. But maybe you did something special to achieve that ?


See also #20604 for fixing the optional doctest failing with coxeter3.



---

archive/issue_comments_299105.json:
```json
{
    "body": "<a id='comment:21'></a>\nReplying to [@fchapoton](#comment%3A20):\n> But maybe you did something special to achieve that ?\n\nYes, I manually installed all doctested optional packages. This was my question in [comment:16]: perhaps it would be nice to automatically do this.",
    "created_at": "2016-05-13T12:40:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20528#issuecomment-299105",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:21'></a>
Replying to [@fchapoton](#comment%3A20):
> But maybe you did something special to achieve that ?

Yes, I manually installed all doctested optional packages. This was my question in [comment:16]: perhaps it would be nice to automatically do this.



---

archive/issue_comments_299106.json:
```json
{
    "body": "<a id='comment:22'></a>\nReplying to [@fchapoton](#comment%3A19):\n> I know that we auto-upgrade optional packages..\n\nAnd we also auto-upgrade optional packages which have been \"downgraded\". I now installed 2.5.7 again on arando.",
    "created_at": "2016-05-13T12:41:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20528#issuecomment-299106",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:22'></a>
Replying to [@fchapoton](#comment%3A19):
> I know that we auto-upgrade optional packages..

And we also auto-upgrade optional packages which have been "downgraded". I now installed 2.5.7 again on arando.



---

archive/issue_comments_299107.json:
```json
{
    "body": "<a id='comment:23'></a>\nSo far, things are looking good. I suggest to leave the bots running for a few more days and then set this to positive review.",
    "created_at": "2016-05-17T08:16:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20528#issuecomment-299107",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:23'></a>
So far, things are looking good. I suggest to leave the bots running for a few more days and then set this to positive review.



---

archive/issue_comments_299108.json:
```json
{
    "body": "<a id='comment:24'></a>\nWell, arando is still not happy with TOPCOM, for some reason.\n\nsee http://patchbot.sagemath.org/ticket/0/\n\nBy the way, I have started to try making the patchbot a correct python package. I would appreciate any help to do that. There is a branch here:\n\nhttps://github.com/robertwb/sage-patchbot/branches",
    "created_at": "2016-05-17T08:30:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20528#issuecomment-299108",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:24'></a>
Well, arando is still not happy with TOPCOM, for some reason.

see http://patchbot.sagemath.org/ticket/0/

By the way, I have started to try making the patchbot a correct python package. I would appreciate any help to do that. There is a branch here:

https://github.com/robertwb/sage-patchbot/branches



---

archive/issue_comments_299109.json:
```json
{
    "body": "<a id='comment:25'></a>\nReplying to [@fchapoton](#comment%3A24):\n> Well, arando is still not happy with TOPCOM, for some reason.\n> \n> see http://patchbot.sagemath.org/ticket/0/\n\nReally? But then why does it continue to run anyway, if there is a problem with ticket 0?",
    "created_at": "2016-05-17T08:32:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20528#issuecomment-299109",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:25'></a>
Replying to [@fchapoton](#comment%3A24):
> Well, arando is still not happy with TOPCOM, for some reason.
> 
> see http://patchbot.sagemath.org/ticket/0/

Really? But then why does it continue to run anyway, if there is a problem with ticket 0?



---

archive/issue_comments_299110.json:
```json
{
    "body": "<a id='comment:26'></a>\nReplying to [@fchapoton](#comment%3A24):\n> By the way, I have started to try making the patchbot a correct python package.\n\nDid you look at the instructions on https://packaging.python.org/en/latest/distributing/",
    "created_at": "2016-05-17T08:34:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20528#issuecomment-299110",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:26'></a>
Replying to [@fchapoton](#comment%3A24):
> By the way, I have started to try making the patchbot a correct python package.

Did you look at the instructions on https://packaging.python.org/en/latest/distributing/



---

archive/issue_comments_299111.json:
```json
{
    "body": "<a id='comment:27'></a>\n* concerning arando, it should have stopped after failing on 0, unless you specified\n  the option \"skip_base=True\". This being said, it does not meet on other tickets the\n  failing doctest that we can see on ticket 0.\n\n* concerning the packaging, yes, I read that and did my best, but this is nevertheless my first try. And this change probably also require changing the inner gears of sage --patchbot\"",
    "created_at": "2016-05-17T08:37:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20528#issuecomment-299111",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:27'></a>
* concerning arando, it should have stopped after failing on 0, unless you specified
  the option "skip_base=True". This being said, it does not meet on other tickets the
  failing doctest that we can see on ticket 0.

* concerning the packaging, yes, I read that and did my best, but this is nevertheless my first try. And this change probably also require changing the inner gears of sage --patchbot"



---

archive/issue_comments_299112.json:
```json
{
    "body": "<a id='comment:28'></a>\nReplying to [@fchapoton](#comment%3A27):\n> * concerning arando, it should have stopped after failing on 0, unless you specified\n>   the option \"skip_base=True\".\n\nI don't think that I specified `\"skip_base=True\"`, because I remember it breaking on other errors before (like the `coxeter3` failure).\n\nHowever, it seems that this test of ticket 0 was not the initial test, but some later test (maybe because a new release came out?). It seems that these later tests of ticket 0 do not cause the patchbot to abort.",
    "created_at": "2016-05-17T08:43:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20528#issuecomment-299112",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:28'></a>
Replying to [@fchapoton](#comment%3A27):
> * concerning arando, it should have stopped after failing on 0, unless you specified
>   the option "skip_base=True".

I don't think that I specified `"skip_base=True"`, because I remember it breaking on other errors before (like the `coxeter3` failure).

However, it seems that this test of ticket 0 was not the initial test, but some later test (maybe because a new release came out?). It seems that these later tests of ticket 0 do not cause the patchbot to abort.



---

archive/issue_comments_299113.json:
```json
{
    "body": "<a id='comment:29'></a>\nReplying to [@fchapoton](#comment%3A27):\n> * concerning the packaging, yes, I read that and did my best, but this is nevertheless my first try.\n\nI think it's best if you try to get started and then see if and where you get stuck.",
    "created_at": "2016-05-17T08:43:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20528#issuecomment-299113",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:29'></a>
Replying to [@fchapoton](#comment%3A27):
> * concerning the packaging, yes, I read that and did my best, but this is nevertheless my first try.

I think it's best if you try to get started and then see if and where you get stuck.



---

archive/issue_comments_299114.json:
```json
{
    "body": "<a id='comment:30'></a>\nQuestion: which tickets does the patchbot test? Only those which needs_review, or also positive_review or needs_info...?",
    "created_at": "2016-05-20T07:50:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20528#issuecomment-299114",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:30'></a>
Question: which tickets does the patchbot test? Only those which needs_review, or also positive_review or needs_info...?



---

archive/issue_comments_299115.json:
```json
{
    "body": "<a id='comment:31'></a>\nIn principle all of them, but there is a priority given to \"needs_review\", I think. The problem is that we are currently seriously lacking running patchbots. Only poseidon is running, with a quite old but stable version of the bot. I do not know what happened to the other bots.\n\nEDIT:\n\n```\n  default_bonus = {\"needs_review\": 1000,\n    \"positive_review\": 500,\"blocker\": 100,\"critical\": 60,\"major\": 10,\"unique\": 40,\"applies\": 20,\"behind\": 1}\n```",
    "created_at": "2016-05-20T07:55:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20528#issuecomment-299115",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:31'></a>
In principle all of them, but there is a priority given to "needs_review", I think. The problem is that we are currently seriously lacking running patchbots. Only poseidon is running, with a quite old but stable version of the bot. I do not know what happened to the other bots.

EDIT:

```
  default_bonus = {"needs_review": 1000,
    "positive_review": 500,"blocker": 100,"critical": 60,"major": 10,"unique": 40,"applies": 20,"behind": 1}
```



---

archive/issue_comments_299116.json:
```json
{
    "body": "<a id='comment:32'></a>\nReplying to [@fchapoton](#comment%3A31):\n> The problem is that we are currently seriously lacking running patchbots.\n\nIt doesn't look so bad to me.\n\n> Only poseidon is running\n\nWhat about `sage4`? And I noticed that `arando` indeed went down, I'm restarting it now.",
    "created_at": "2016-05-20T08:18:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20528#issuecomment-299116",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:32'></a>
Replying to [@fchapoton](#comment%3A31):
> The problem is that we are currently seriously lacking running patchbots.

It doesn't look so bad to me.

> Only poseidon is running

What about `sage4`? And I noticed that `arando` indeed went down, I'm restarting it now.



---

archive/issue_comments_299117.json:
```json
{
    "body": "<a id='comment:33'></a>\nMaybe this could be considered as ready to go, no ?\n\nI plan to work on \"patchbot as a correct python pkg\" after this is closed.",
    "created_at": "2016-05-23T20:06:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20528#issuecomment-299117",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:33'></a>
Maybe this could be considered as ready to go, no ?

I plan to work on "patchbot as a correct python pkg" after this is closed.



---

archive/issue_events_250009.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-05-24T07:59:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20528",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20528#event-250009"
}
```



---

archive/issue_events_250010.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-05-24T07:59:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20528",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20528#event-250010"
}
```



---

archive/issue_comments_299118.json:
```json
{
    "body": "**Reviewer:** Jeroen Demeyer",
    "created_at": "2016-05-24T07:59:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20528#issuecomment-299118",
    "user": "https://github.com/jdemeyer"
}
```

**Reviewer:** Jeroen Demeyer



---

archive/issue_events_250011.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-05-24T22:25:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20528",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20528#event-250011"
}
```



---

archive/issue_events_250012.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "fb798e7f9de690e81314b26ec76ba0b19f53f5d4",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2016-05-24T22:25:42Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/20528",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20528#event-250012"
}
```



---

archive/issue_comments_299119.json:
```json
{
    "body": "**Changing branch** from \"[public/20528](https://github.com/sagemath/sagetrac-mirror/tree/public/20528)\" to \"[e5a230d0395754fcbfd5afa2917198dbbea22b23](https://github.com/sagemath/sagetrac-mirror/commit/e5a230d0395754fcbfd5afa2917198dbbea22b23)\".",
    "created_at": "2016-05-24T22:25:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20528",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20528#issuecomment-299119",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[public/20528](https://github.com/sagemath/sagetrac-mirror/tree/public/20528)" to "[e5a230d0395754fcbfd5afa2917198dbbea22b23](https://github.com/sagemath/sagetrac-mirror/commit/e5a230d0395754fcbfd5afa2917198dbbea22b23)".
