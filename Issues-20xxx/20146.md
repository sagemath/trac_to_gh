# Issue 20146: Bug in computing the Gröner fan

archive/issues_019909.json:
```json
{
    "body": "I get\n\n```\nsage: P = PolynomialRing(QQ,\"x11,x12,x13,x14,x15,x21,x22,x23,x24,x25,x31,x32,x33,x34,x35\"); x = P.gens(); M = Matrix(3,x)\nsage: M\n[x11 x12 x13 x14 x15]\n[x21 x22 x23 x24 x25]\n[x31 x32 x33 x34 x35]\nsage: I = P.ideal(M.minors(2))\nsage: gf = I.groebner_fan()\nsage: rgbs = gf.reduced_groebner_bases()\n---------------------------------------------------------------------------\nRuntimeError                              Traceback (most recent call last)\n...\nRuntimeError: Unknown variable:olynomialSequencewith30Polynomialsin15Variable\ngfan_bases: parser.cpp:276: virtual Monomial CharacterBasedParser::parseMonomial(const PolynomialRing&): Assertion `0' failed.\n```\nThe same computation with 3 or 4 columns does work.\n\nKeywords: Gr\u00f6bner basis, Gr\u00f6bner fan, gfan\n\nBranch/Commit: [0a06a2c3096a0244c3f478e144b913e7a3fff157](https://github.com/sagemath/sagetrac-mirror/commit/0a06a2c3096a0244c3f478e144b913e7a3fff157)\n\nReviewer: Miguel Marco, Dima Pasechnik\n\nAuthor: Christian Stump\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/20146\n\n",
    "closed_at": "2016-03-05T09:47:54Z",
    "created_at": "2016-03-02T11:19:03Z",
    "labels": [
        "component: commutative algebra",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.1",
    "title": "Bug in computing the Gr\u00f6ner fan",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/20146",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```
I get

```
sage: P = PolynomialRing(QQ,"x11,x12,x13,x14,x15,x21,x22,x23,x24,x25,x31,x32,x33,x34,x35"); x = P.gens(); M = Matrix(3,x)
sage: M
[x11 x12 x13 x14 x15]
[x21 x22 x23 x24 x25]
[x31 x32 x33 x34 x35]
sage: I = P.ideal(M.minors(2))
sage: gf = I.groebner_fan()
sage: rgbs = gf.reduced_groebner_bases()
---------------------------------------------------------------------------
RuntimeError                              Traceback (most recent call last)
...
RuntimeError: Unknown variable:olynomialSequencewith30Polynomialsin15Variable
gfan_bases: parser.cpp:276: virtual Monomial CharacterBasedParser::parseMonomial(const PolynomialRing&): Assertion `0' failed.
```
The same computation with 3 or 4 columns does work.

Keywords: Gröbner basis, Gröbner fan, gfan

Branch/Commit: [0a06a2c3096a0244c3f478e144b913e7a3fff157](https://github.com/sagemath/sagetrac-mirror/commit/0a06a2c3096a0244c3f478e144b913e7a3fff157)

Reviewer: Miguel Marco, Dima Pasechnik

Author: Christian Stump

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/20146





---

archive/issue_comments_367561.json:
```json
{
    "body": "<a id='comment:1'></a>\nThe following is actually also really annoying when doing many computations:\n\n```\nsage: P = PolynomialRing(QQ,3*5,\"x\"); x = P.gens(); M = Matrix(3,x)\nsage: M\n[ x0  x1  x2  x3  x4]\n[ x5  x6  x7  x8  x9]\n[x10 x11 x12 x13 x14]\nsage: I = P.ideal(M.minors(2))\nsage: I.groebner_fan()\n---------------------------------------------------------------------------\nRuntimeError                              Traceback (most recent call last)\n...\nRuntimeError: Ring variables cannot contain each other as prefixes\n```",
    "created_at": "2016-03-02T11:28:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20146#issuecomment-367561",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

<a id='comment:1'></a>
The following is actually also really annoying when doing many computations:

```
sage: P = PolynomialRing(QQ,3*5,"x"); x = P.gens(); M = Matrix(3,x)
sage: M
[ x0  x1  x2  x3  x4]
[ x5  x6  x7  x8  x9]
[x10 x11 x12 x13 x14]
sage: I = P.ideal(M.minors(2))
sage: I.groebner_fan()
---------------------------------------------------------------------------
RuntimeError                              Traceback (most recent call last)
...
RuntimeError: Ring variables cannot contain each other as prefixes
```



---

archive/issue_comments_367562.json:
```json
{
    "body": "<a id='comment:2'></a>\nthis is a limitation of gfan, cf. Sect. A.2 (p.34) of http://home.math.au.dk/jensen/software/gfan/gfanmanual0.5.pdf\n\na better interface should automatically do renaming.\n\nsee also [5.y.o. post on sage-support](https://groups.google.com/d/topic/sage-support/-Cs3U7-nILw/discussion)",
    "created_at": "2016-03-02T14:27:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20146#issuecomment-367562",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:2'></a>
this is a limitation of gfan, cf. Sect. A.2 (p.34) of http://home.math.au.dk/jensen/software/gfan/gfanmanual0.5.pdf

a better interface should automatically do renaming.

see also [5.y.o. post on sage-support](https://groups.google.com/d/topic/sage-support/-Cs3U7-nILw/discussion)



---

archive/issue_comments_367563.json:
```json
{
    "body": "<a id='comment:3'></a>\n> a better interface should automatically do renaming.\n\n\nThis applies only to my comment about the variable names, or do you also mean to address the bug report?",
    "created_at": "2016-03-02T14:35:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20146#issuecomment-367563",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

<a id='comment:3'></a>
> a better interface should automatically do renaming.


This applies only to my comment about the variable names, or do you also mean to address the bug report?



---

archive/issue_comments_367564.json:
```json
{
    "body": "<a id='comment:4'></a>\nReplying to [stumpc5](#comment%3A3):\n> > a better interface should automatically do renaming.\n\n> \n> This applies only to my comment about the variable names, or do you also mean to address the bug report?\n\n\nI meant to say that the Sage gfan interface should do automatic variable renaming to prevent this sort of a problem. Should not be hard to fix, in fact.",
    "created_at": "2016-03-02T14:47:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20146#issuecomment-367564",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:4'></a>
Replying to [stumpc5](#comment%3A3):
> > a better interface should automatically do renaming.

> 
> This applies only to my comment about the variable names, or do you also mean to address the bug report?


I meant to say that the Sage gfan interface should do automatic variable renaming to prevent this sort of a problem. Should not be hard to fix, in fact.



---

archive/issue_comments_367565.json:
```json
{
    "body": "<a id='comment:5'></a>\nThe problem is that the gfan code uses `ideal_to_gfan_format` which expects the generators of an ideal to come as a list. But they don't:\n\n```\nsage: P = PolynomialRing(QQ,\"x11,x12,x13,x14,x21,x22,x23,x24,x31,x32,x33,x34\"); x = P.gens(); M = Matrix(3,x)\nsage: I = P.ideal(M.minors(2))\nsage: I.gens()\n[-x12*x21 + x11*x22, -x13*x21 + x11*x23, -x14*x21 + x11*x24, -x13*x22 + x12*x23, -x14*x22 + x12*x24, -x14*x23 + x13*x24, -x12*x31 + x11*x32, -x13*x31 + x11*x33, -x14*x31 + x11*x34, -x13*x32 + x12*x33, -x14*x32 + x12*x34, -x14*x33 + x13*x34, -x22*x31 + x21*x32, -x23*x31 + x21*x33, -x24*x31 + x21*x34, -x23*x32 + x22*x33, -x24*x32 + x22*x34, -x24*x33 + x23*x34]\nsage: P = PolynomialRing(QQ,\"x11,x12,x13,x14,x15,x21,x22,x23,x24,x25,x31,x32,x33,x34,x35\"); x = P.gens(); M = Matrix(3,x)\nsage: I = P.ideal(M.minors(2))\nsage: I.gens()\nPolynomial Sequence with 30 Polynomials in 15 Variables\n```\n\nI will provide a patch preparsing `I.gens()` before giving it to `ideal_to_gfan_format`.",
    "created_at": "2016-03-02T15:31:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20146#issuecomment-367565",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

<a id='comment:5'></a>
The problem is that the gfan code uses `ideal_to_gfan_format` which expects the generators of an ideal to come as a list. But they don't:

```
sage: P = PolynomialRing(QQ,"x11,x12,x13,x14,x21,x22,x23,x24,x31,x32,x33,x34"); x = P.gens(); M = Matrix(3,x)
sage: I = P.ideal(M.minors(2))
sage: I.gens()
[-x12*x21 + x11*x22, -x13*x21 + x11*x23, -x14*x21 + x11*x24, -x13*x22 + x12*x23, -x14*x22 + x12*x24, -x14*x23 + x13*x24, -x12*x31 + x11*x32, -x13*x31 + x11*x33, -x14*x31 + x11*x34, -x13*x32 + x12*x33, -x14*x32 + x12*x34, -x14*x33 + x13*x34, -x22*x31 + x21*x32, -x23*x31 + x21*x33, -x24*x31 + x21*x34, -x23*x32 + x22*x33, -x24*x32 + x22*x34, -x24*x33 + x23*x34]
sage: P = PolynomialRing(QQ,"x11,x12,x13,x14,x15,x21,x22,x23,x24,x25,x31,x32,x33,x34,x35"); x = P.gens(); M = Matrix(3,x)
sage: I = P.ideal(M.minors(2))
sage: I.gens()
Polynomial Sequence with 30 Polynomials in 15 Variables
```

I will provide a patch preparsing `I.gens()` before giving it to `ideal_to_gfan_format`.



---

archive/issue_comments_367566.json:
```json
{
    "body": "Changing branch from \"\" to \"u/stumpc5/20146\"",
    "created_at": "2016-03-02T16:01:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20146#issuecomment-367566",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

Changing branch from "" to "u/stumpc5/20146"



---

archive/issue_comments_367567.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-03-02T16:02:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20146#issuecomment-367567",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_367568.json:
```json
{
    "body": "Changing commit from \"\" to \"0a06a2c3096a0244c3f478e144b913e7a3fff157\"",
    "created_at": "2016-03-02T16:02:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20146#issuecomment-367568",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

Changing commit from "" to "0a06a2c3096a0244c3f478e144b913e7a3fff157"



---

archive/issue_comments_367569.json:
```json
{
    "body": "<a id='comment:7'></a>\nNew commits:\n|                                                                                                                                          |              |\n|------------------------------------------------------------------------------------------------------------------------------------------|--------------|\n|[0a06a2c](https://github.com/sagemath/sagetrac-mirror/commit/0a06a2c3096a0244c3f478e144b913e7a3fff157)|`fixed #20146`|",
    "created_at": "2016-03-02T16:02:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20146#issuecomment-367569",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

<a id='comment:7'></a>
New commits:
|                                                                                                                                          |              |
|------------------------------------------------------------------------------------------------------------------------------------------|--------------|
|[0a06a2c](https://github.com/sagemath/sagetrac-mirror/commit/0a06a2c3096a0244c3f478e144b913e7a3fff157)|`fixed #20146`|



---

archive/issue_comments_367570.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Miguel Marco\"",
    "created_at": "2016-03-02T17:27:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20146#issuecomment-367570",
    "user": "https://github.com/miguelmarco"
}
```

Changing reviewer from "" to "Miguel Marco"



---

archive/issue_comments_367571.json:
```json
{
    "body": "<a id='comment:8'></a>\nThat is indeed the problem. Did you test that the testsuite passes and the documentation builds correctly?\n\nIf you did, put your name on the Authors field, and you can set it to positive review.",
    "created_at": "2016-03-02T17:27:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20146#issuecomment-367571",
    "user": "https://github.com/miguelmarco"
}
```

<a id='comment:8'></a>
That is indeed the problem. Did you test that the testsuite passes and the documentation builds correctly?

If you did, put your name on the Authors field, and you can set it to positive review.



---

archive/issue_comments_367572.json:
```json
{
    "body": "Changing author from \"\" to \"Christian Stump\"",
    "created_at": "2016-03-03T14:27:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20146#issuecomment-367572",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

Changing author from "" to "Christian Stump"



---

archive/issue_comments_367573.json:
```json
{
    "body": "Changing reviewer from \"Miguel Marco\" to \"Miguel Marco, Dima Pasechnik\"",
    "created_at": "2016-03-03T22:22:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20146#issuecomment-367573",
    "user": "https://github.com/dimpase"
}
```

Changing reviewer from "Miguel Marco" to "Miguel Marco, Dima Pasechnik"



---

archive/issue_comments_367574.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-03-03T22:22:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20146#issuecomment-367574",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_367575.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-03-05T09:47:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20146#issuecomment-367575",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_062317.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-03-05T09:47:54Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/20146",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20146#event-62317"
}
```



---

archive/issue_comments_367576.json:
```json
{
    "body": "Changing branch from \"u/stumpc5/20146\" to \"0a06a2c3096a0244c3f478e144b913e7a3fff157\"",
    "created_at": "2016-03-05T09:47:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20146#issuecomment-367576",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/stumpc5/20146" to "0a06a2c3096a0244c3f478e144b913e7a3fff157"
