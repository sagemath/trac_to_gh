# Issue 20893: Meta-ticket: Improve live documentation in the Jupyter notebook

archive/issues_020656.json:
```json
{
    "body": "Since #20690 we have access to documentation (with live execution)\nwithin the Jupyter notebook. It was decided to keep the code simple.\nThere are two ongoing projects within Jupyter for having this working.\nIt might be wiser to wait for them...\n\nSome of the improvements mentioned in #20690 were:\n\n- [  ] Configure Sphinx to add a small header to our html page with\n  Thebe configuration: use the Jupyter instance serving the page.\n  We currently use `window.location.origin`; is this the right thing?\n\n- [ ] Currently it takes 10s for 100 prompts while some sage files\n  contain up to 1000 prompts. Profile Thebe and optimize it or use\n  a separate thread to properly support large files.\n\n- [ ] Expand the activate button with a menu or other widgets for user customization\n  of the Jupyter server. This typically would let the user choose between:\n  - tmpnb (will only be useful for Sage\n    [when tmpnb will include a Sage kernel](https://github.com/jupyter/tmpnb/issues/203); there are ongoing discussions for providing an alternative sage-enabled tmpnb)\n  - a local Jupyter server,\n  - whichever Jupyter server the browser is currently connected to?\n  - a user-specified server.\n\n- [ ] Check whether Jupyter could be configured to dynamically\n  negotiate incoming connections that don't fall within the\n  `-NotebookApp.allow_origin pattern`, by opening a user dialog such\n  as \"Page xxx requests starting a new kernel on this server; do\n  you accept? yes/no/always for this site\".\n\n- [ ] Add support in Thebe for customizable (continuation) prompts, with striping and splitting as above, and automatic setting of the kernel. The customization option could look like:\n  {{{\n  prompts = {\n      \"sage: \": {continuations=[\"....:\", \"...  \"], kernel=\"sagemath\"},\n      \">>>> \": {continuation=\"...  \", kernel=\"python\"}\n  }\n  }}}\n\n- [ ] Have Thebe provide good TAB-completion.\n\n- [ ] Let the cursor switch to the next cell after evaluation (SHIFT+ENTER).\n\n- [ ] Extract support for Thebe as a [Sphinx](http://www.sphinx-doc.org/en/stable/)  extension with (see the related [sage-cell](https://github.com/sagemath/sphinx-sagecell-ext) extension):\n  - [ ] Explicit markup to specify which code blocks are editable and with\n    which kernel, or setup kernel auto-detection from the prompt.\n  - [ ] The possibility for setting a default value for the above.\n\n- [ ] Refactor the Sage Sphinx configuration to use the above.\n\n- [x] Configure [sage-sample](https://github.com/sagemath/sage_sample) / [sage-package](https://github.com/sagemath/sage-package) to use it, to enable live documentation for Sage packages.\n\n- [ ] Add support in Thebe for basic export to Jupyter notebooks. A\n  quality loss (in particular in terms of the hierarchical\n  structure) is acceptable.\n\n- [ ] Allow to save the current state of the webpage as a `.ipynb` worksheet, to be able to continue working on it later, see [This is the Trac macro */ticket/20690* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#/ticket/20690-macro).\n\nTickets:\n- #33309 Make Sage documentation functional (disables use of old thebe)\n- #33529 Remove old thebe package\n- #24593 Replace Thebe by ThebeLab for live documentation support\n- #33507 `sagemath_doc_html`: Use jupyter-sphinx for 3D graphics\n- #33320 Rework on Thebe for live sage documentation\n\nSee also:\n- Meta-ticket #20080: Sage docbuild\n\n\nCC:  @vbraun @rbeezer @nthiery fhivert @slel fcayre @jdemeyer @dimpase @kwankyu\n\nKeywords: thebe, thebelab\n\nStatus: new\n\nDependencies: #20690\n\nIssue created by migration from https://trac.sagemath.org/ticket/20893\n\n",
    "created_at": "2016-06-27T16:15:17Z",
    "labels": [
        "component: documentation"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Meta-ticket: Improve live documentation in the Jupyter notebook",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/20893",
    "user": "https://github.com/videlec"
}
```
Since #20690 we have access to documentation (with live execution)
within the Jupyter notebook. It was decided to keep the code simple.
There are two ongoing projects within Jupyter for having this working.
It might be wiser to wait for them...

Some of the improvements mentioned in #20690 were:

- [  ] Configure Sphinx to add a small header to our html page with
  Thebe configuration: use the Jupyter instance serving the page.
  We currently use `window.location.origin`; is this the right thing?

- [ ] Currently it takes 10s for 100 prompts while some sage files
  contain up to 1000 prompts. Profile Thebe and optimize it or use
  a separate thread to properly support large files.

- [ ] Expand the activate button with a menu or other widgets for user customization
  of the Jupyter server. This typically would let the user choose between:
  - tmpnb (will only be useful for Sage
    [when tmpnb will include a Sage kernel](https://github.com/jupyter/tmpnb/issues/203); there are ongoing discussions for providing an alternative sage-enabled tmpnb)
  - a local Jupyter server,
  - whichever Jupyter server the browser is currently connected to?
  - a user-specified server.

- [ ] Check whether Jupyter could be configured to dynamically
  negotiate incoming connections that don't fall within the
  `-NotebookApp.allow_origin pattern`, by opening a user dialog such
  as "Page xxx requests starting a new kernel on this server; do
  you accept? yes/no/always for this site".

- [ ] Add support in Thebe for customizable (continuation) prompts, with striping and splitting as above, and automatic setting of the kernel. The customization option could look like:
  {{{
  prompts = {
      "sage: ": {continuations=["....:", "...  "], kernel="sagemath"},
      ">>>> ": {continuation="...  ", kernel="python"}
  }
  }}}

- [ ] Have Thebe provide good TAB-completion.

- [ ] Let the cursor switch to the next cell after evaluation (SHIFT+ENTER).

- [ ] Extract support for Thebe as a [Sphinx](http://www.sphinx-doc.org/en/stable/)  extension with (see the related [sage-cell](https://github.com/sagemath/sphinx-sagecell-ext) extension):
  - [ ] Explicit markup to specify which code blocks are editable and with
    which kernel, or setup kernel auto-detection from the prompt.
  - [ ] The possibility for setting a default value for the above.

- [ ] Refactor the Sage Sphinx configuration to use the above.

- [x] Configure [sage-sample](https://github.com/sagemath/sage_sample) / [sage-package](https://github.com/sagemath/sage-package) to use it, to enable live documentation for Sage packages.

- [ ] Add support in Thebe for basic export to Jupyter notebooks. A
  quality loss (in particular in terms of the hierarchical
  structure) is acceptable.

- [ ] Allow to save the current state of the webpage as a `.ipynb` worksheet, to be able to continue working on it later, see [This is the Trac macro */ticket/20690* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#/ticket/20690-macro).

Tickets:
- #33309 Make Sage documentation functional (disables use of old thebe)
- #33529 Remove old thebe package
- #24593 Replace Thebe by ThebeLab for live documentation support
- #33507 `sagemath_doc_html`: Use jupyter-sphinx for 3D graphics
- #33320 Rework on Thebe for live sage documentation

See also:
- Meta-ticket #20080: Sage docbuild


CC:  @vbraun @rbeezer @nthiery fhivert @slel fcayre @jdemeyer @dimpase @kwankyu

Keywords: thebe, thebelab

Status: new

Dependencies: #20690

Issue created by migration from https://trac.sagemath.org/ticket/20893





---

archive/issue_comments_284903.json:
```json
{
    "body": "<a id='comment:3'></a>Fix formatting in ticket description.\n\nRegarding \"There are two ongoing projects within Jupyter for having this working\",\nwould someone add links?",
    "created_at": "2016-08-30T09:04:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20893",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20893#issuecomment-284903",
    "user": "https://github.com/slel"
}
```

<a id='comment:3'></a>Fix formatting in ticket description.

Regarding "There are two ongoing projects within Jupyter for having this working",
would someone add links?



---

archive/issue_comments_284904.json:
```json
{
    "body": "<a id='comment:4'></a>Editing ticket description to add link to\n[tmpnb issue 203: \"Octave kernel and SageMath kernel\"](https://github.com/jupyter/tmpnb/issues/203).",
    "created_at": "2016-08-30T09:12:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20893",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20893#issuecomment-284904",
    "user": "https://github.com/slel"
}
```

<a id='comment:4'></a>Editing ticket description to add link to
[tmpnb issue 203: "Octave kernel and SageMath kernel"](https://github.com/jupyter/tmpnb/issues/203).



---

archive/issue_comments_284905.json:
```json
{
    "body": "<a id='comment:11'></a>Update: Min RK reported to me that he had started reimplementing Thebe on top of JupyterLab. At this stage, this seemed to confirm our hope that Thebe will become just a thin layer on top of plain JupyterLab, making it sustainable.",
    "created_at": "2017-05-04T14:25:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20893",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20893#issuecomment-284905",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:11'></a>Update: Min RK reported to me that he had started reimplementing Thebe on top of JupyterLab. At this stage, this seemed to confirm our hope that Thebe will become just a thin layer on top of plain JupyterLab, making it sustainable.



---

archive/issue_comments_284906.json:
```json
{
    "body": "<a id='comment:14'></a>A source of inspiration: [sympylive](http://live.sympy.org/).",
    "created_at": "2017-05-04T14:37:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20893",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20893#issuecomment-284906",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:14'></a>A source of inspiration: [sympylive](http://live.sympy.org/).



---

archive/issue_comments_284907.json:
```json
{
    "body": "<a id='comment:15'></a>Replying to [comment:11 nthiery]:\n> Update: Min RK reported to me that he had started reimplementing Thebe on top of JupyterLab. At this stage, this seemed to confirm our hope that Thebe will become just a thin layer on top of plain JupyterLab, making it sustainable.\n\n\nIs an export to a standalone .ipynb file part of the plan (so that people can save their work on some live doc) ?",
    "created_at": "2017-05-04T15:59:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20893",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20893#issuecomment-284907",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:15'></a>Replying to [comment:11 nthiery]:
> Update: Min RK reported to me that he had started reimplementing Thebe on top of JupyterLab. At this stage, this seemed to confirm our hope that Thebe will become just a thin layer on top of plain JupyterLab, making it sustainable.


Is an export to a standalone .ipynb file part of the plan (so that people can save their work on some live doc) ?



---

archive/issue_comments_284908.json:
```json
{
    "body": "<a id='comment:16'></a>Replying to [comment:15 tmonteil]:\n> Is an export to a standalone .ipynb file part of the plan (so that people can save their work on some live doc) ?\n\n\nAh, shoot, I forgot to discuss this specific point.\n\nThat being said, Thebe is meant to be embedded in any web page. So, at the level of Thebe itself, and without a minimum of structure specified, I believe it would be hard to define a meaningful export to .ipynb.\n\nPlausibly we would instead be shooting for a link \"download document as ipynb\" pointing to the notebook generated from the original sources, either statically or on the fly. The inconvenient being of course that users won't keep their history in this scenario if they play with Thebe before switching to the notebook.",
    "created_at": "2017-05-08T20:46:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20893",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20893#issuecomment-284908",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:16'></a>Replying to [comment:15 tmonteil]:
> Is an export to a standalone .ipynb file part of the plan (so that people can save their work on some live doc) ?


Ah, shoot, I forgot to discuss this specific point.

That being said, Thebe is meant to be embedded in any web page. So, at the level of Thebe itself, and without a minimum of structure specified, I believe it would be hard to define a meaningful export to .ipynb.

Plausibly we would instead be shooting for a link "download document as ipynb" pointing to the notebook generated from the original sources, either statically or on the fly. The inconvenient being of course that users won't keep their history in this scenario if they play with Thebe before switching to the notebook.



---

archive/issue_comments_284909.json:
```json
{
    "body": "Changing keywords from \"\" to \"thebe, thebelab\".",
    "created_at": "2018-03-07T13:53:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20893",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20893#issuecomment-284909",
    "user": "https://github.com/nthiery"
}
```

Changing keywords from "" to "thebe, thebelab".



---

archive/issue_events_055979.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-19T20:30:46Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/20893",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20893#event-55979"
}
```



---

archive/issue_comments_284910.json:
```json
{
    "body": "<a id='comment:18'></a>This ticket needs clarification / update. Is it a meta ticket?",
    "created_at": "2020-08-19T20:30:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20893",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20893#issuecomment-284910",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:18'></a>This ticket needs clarification / update. Is it a meta ticket?



---

archive/issue_events_055980.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-24T20:15:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/20893",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20893#event-55980"
}
```



---

archive/issue_events_055981.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-24T20:15:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/20893",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20893#event-55981"
}
```



---

archive/issue_comments_284911.json:
```json
{
    "body": "<a id='comment:21'></a>Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-03-24T02:04:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20893",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20893#issuecomment-284911",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:21'></a>Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_events_055982.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-24T02:04:25Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/20893",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20893#event-55982"
}
```



---

archive/issue_events_055983.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-24T02:04:25Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/20893",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20893#event-55983"
}
```



---

archive/issue_events_055984.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T01:16:42Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/20893",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20893#event-55984"
}
```



---

archive/issue_events_055985.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T01:16:42Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/20893",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20893#event-55985"
}
```



---

archive/issue_events_055986.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:41:23Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/20893",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20893#event-55986"
}
```



---

archive/issue_events_055987.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:41:23Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/20893",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20893#event-55987"
}
```



---

archive/issue_events_055988.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-05-03T15:17:06Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/20893",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20893#event-55988"
}
```



---

archive/issue_events_055989.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-05-03T15:17:06Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/20893",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20893#event-55989"
}
```



---

archive/issue_events_055990.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/20893",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20893#event-55990"
}
```



---

archive/issue_events_055991.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/20893",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20893#event-55991"
}
```
