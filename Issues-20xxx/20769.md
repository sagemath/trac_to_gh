# Issue 20769: Upgrade to IPython 5.0

archive/issues_020769.json:
```json
{
    "body": "CC:  @kiwifb\n\nIPython 5.0 and various minor updates\n\nIssue created by migration from https://trac.sagemath.org/ticket/21006\n\n",
    "closed_at": "2016-08-07T20:00:04Z",
    "created_at": "2016-07-11T21:28:07Z",
    "labels": [
        "component: packages: standard"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.4",
    "title": "Upgrade to IPython 5.0",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/20769",
    "user": "https://github.com/vbraun"
}
```
CC:  @kiwifb

IPython 5.0 and various minor updates

Issue created by migration from https://trac.sagemath.org/ticket/21006





---

archive/issue_comments_286671.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-07-11T21:36:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20769#issuecomment-286671",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_286672.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to packages: standard.",
    "created_at": "2016-07-11T21:45:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20769#issuecomment-286672",
    "user": "https://github.com/vbraun"
}
```

Changing component from PLEASE CHANGE to packages: standard.



---

archive/issue_comments_286673.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to enhancement.",
    "created_at": "2016-07-11T21:45:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20769#issuecomment-286673",
    "user": "https://github.com/vbraun"
}
```

Changing type from PLEASE CHANGE to enhancement.



---

archive/issue_comments_286674.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-07-11T22:11:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20769#issuecomment-286674",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_286675.json:
```json
{
    "body": "Prompt configuration was also changed\n\n```\n$ ./sage\n[...]\n/home/vbraun/Sage/git-develop/local/lib/python2.7/site-packages/IPython/core/interactiveshell.py:440: UserWarning: As of IPython 5.0 `PromptManager` config will have no effect and has been replaced by TerminalInteractiveShell.prompts_class\n  warn('As of IPython 5.0 `PromptManager` config will have no effect'\nIn [1]: \n```",
    "created_at": "2016-07-11T22:17:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20769#issuecomment-286675",
    "user": "https://github.com/vbraun"
}
```

Prompt configuration was also changed

```
$ ./sage
[...]
/home/vbraun/Sage/git-develop/local/lib/python2.7/site-packages/IPython/core/interactiveshell.py:440: UserWarning: As of IPython 5.0 `PromptManager` config will have no effect and has been replaced by TerminalInteractiveShell.prompts_class
  warn('As of IPython 5.0 `PromptManager` config will have no effect'
In [1]: 
```



---

archive/issue_comments_286676.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2016-07-11T22:34:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20769#issuecomment-286676",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_286677.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-07-13T19:20:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20769#issuecomment-286677",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_286678.json:
```json
{
    "body": "IPython's `run_cell()` seems to be broken on Python2: https://github.com/ipython/ipython/issues/9756",
    "created_at": "2016-07-13T19:21:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20769#issuecomment-286678",
    "user": "https://github.com/vbraun"
}
```

IPython's `run_cell()` seems to be broken on Python2: https://github.com/ipython/ipython/issues/9756



---

archive/issue_comments_286679.json:
```json
{
    "body": "Will this be the last `ipython` supporting python 2? I remember a post a while ago stating that a branch would be maintained for python2 but not get any new features.",
    "created_at": "2016-07-13T19:58:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20769#issuecomment-286679",
    "user": "https://github.com/kiwifb"
}
```

Will this be the last `ipython` supporting python 2? I remember a post a while ago stating that a branch would be maintained for python2 but not get any new features.



---

archive/issue_comments_286680.json:
```json
{
    "body": "Yes, though IPython 5 is supposed to get long-term support because of that.",
    "created_at": "2016-07-13T20:50:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20769#issuecomment-286680",
    "user": "https://github.com/vbraun"
}
```

Yes, though IPython 5 is supposed to get long-term support because of that.



---

archive/issue_comments_286681.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-07-23T20:20:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20769#issuecomment-286681",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_286682.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-07-23T20:52:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20769#issuecomment-286682",
    "user": "https://github.com/vbraun"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_286683.json:
```json
{
    "body": "All tests pass",
    "created_at": "2016-07-23T20:52:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20769#issuecomment-286683",
    "user": "https://github.com/vbraun"
}
```

All tests pass



---

archive/issue_comments_286684.json:
```json
{
    "body": "OK, I am not really ready but let's go. It's even more urgent that this also move `pyzmq` and I wonder how we avoided https://bugs.gentoo.org/show_bug.cgi?id=583192 for all the time that `cython-0.24+` and `pyzmq-15.2.0` have been in sage simultaneously.",
    "created_at": "2016-07-23T21:16:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20769#issuecomment-286684",
    "user": "https://github.com/kiwifb"
}
```

OK, I am not really ready but let's go. It's even more urgent that this also move `pyzmq` and I wonder how we avoided https://bugs.gentoo.org/show_bug.cgi?id=583192 for all the time that `cython-0.24+` and `pyzmq-15.2.0` have been in sage simultaneously.



---

archive/issue_comments_286685.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-07-23T21:16:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20769#issuecomment-286685",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_056183.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-07-24T09:18:30Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/20769",
    "milestone": "sage-7.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20769#event-56183"
}
```



---

archive/issue_comments_286686.json:
```json
{
    "body": "Since its a bigger UI change, lets postpone it to the next beta cycle.",
    "created_at": "2016-07-24T09:18:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20769#issuecomment-286686",
    "user": "https://github.com/vbraun"
}
```

Since its a bigger UI change, lets postpone it to the next beta cycle.



---

archive/issue_comments_286687.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2016-07-24T11:55:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20769#issuecomment-286687",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_286688.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2016-07-24T11:55:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20769#issuecomment-286688",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_286689.json:
```json
{
    "body": "Just adding \"upgrade\" to the ticket summary so that it appears in\n\nhttps://trac.sagemath.org/query?summary=~upgrade&desc=1&order=status",
    "created_at": "2016-07-28T10:51:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20769#issuecomment-286689",
    "user": "https://github.com/slel"
}
```

Just adding "upgrade" to the ticket summary so that it appears in

https://trac.sagemath.org/query?summary=~upgrade&desc=1&order=status



---

archive/issue_comments_286690.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-08-06T17:06:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20769#issuecomment-286690",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_286691.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2016-08-06T18:23:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20769#issuecomment-286691",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_286692.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2016-08-06T18:23:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20769#issuecomment-286692",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_286693.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-08-07T20:00:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20769#issuecomment-286693",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_056184.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-08-07T20:00:04Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/20769",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20769#event-56184"
}
```



---

archive/issue_comments_286694.json:
```json
{
    "body": "This presumably broke `sage_mode` (cf. [this post on sage-devel](http://permalink.gmane.org/gmane.comp.mathematics.sage.devel/88271)).\n\nAnd this also seems related:\n\n```\nAfter the update, on exit from Sage I get\n\nExiting Sage (CPU time 0m0.17s, Wall time 0m44.15s).\n:0: UserWarning: You do not have a working installation of the service_identity module: 'No module named service_identity'.  Please install it from <https://pypi.python.org/pypi/service_identity> and make sure all of its dependencies are satisfied.  Without the service_identity module and a recent enough pyOpenSSL to support it, Twisted can perform only rudimentary TLS client hostname verification.  Many valid certificate/hostname mappings may be rejected.\n\nAfter doing \"sage --pip install service_identity\"\nthis warning goes away.\n\nAny idea what happens here?\n\nDima\n```\n(from sage-release)",
    "created_at": "2016-08-11T21:46:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20769#issuecomment-286694",
    "user": "https://github.com/nexttime"
}
```

This presumably broke `sage_mode` (cf. [this post on sage-devel](http://permalink.gmane.org/gmane.comp.mathematics.sage.devel/88271)).

And this also seems related:

```
After the update, on exit from Sage I get

Exiting Sage (CPU time 0m0.17s, Wall time 0m44.15s).
:0: UserWarning: You do not have a working installation of the service_identity module: 'No module named service_identity'.  Please install it from <https://pypi.python.org/pypi/service_identity> and make sure all of its dependencies are satisfied.  Without the service_identity module and a recent enough pyOpenSSL to support it, Twisted can perform only rudimentary TLS client hostname verification.  Many valid certificate/hostname mappings may be rejected.

After doing "sage --pip install service_identity"
this warning goes away.

Any idea what happens here?

Dima
```
(from sage-release)



---

archive/issue_comments_286695.json:
```json
{
    "body": "Replying to [comment:22 leif]:\n> This presumably broke `sage_mode` (cf. [this post on sage-devel](http://permalink.gmane.org/gmane.comp.mathematics.sage.devel/88271)).\n\n\nSee #21227.",
    "created_at": "2016-08-11T21:56:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20769#issuecomment-286695",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:22 leif]:
> This presumably broke `sage_mode` (cf. [this post on sage-devel](http://permalink.gmane.org/gmane.comp.mathematics.sage.devel/88271)).


See #21227.



---

archive/issue_comments_286696.json:
```json
{
    "body": "I think this also broke `line_profiler`:\n\n```\n$ sage\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 SageMath version 7.4.beta0, Release Date: 2016-08-10               \u2502\n\u2502 Type \"notebook()\" for the browser-based notebook interface.        \u2502\n\u2502 Type \"help()\" for help.                                            \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250f\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n\u2503 Warning: this is a prerelease version, and it may be unstable.     \u2503\n\u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251b\n[SageTerminalApp] WARNING | Error in loading extension: line_profiler\nCheck your config files in /Users/palmieri/.sage/ipython_genutils-0.1.0/profile_default\nTraceback (most recent call last):\n  File \"/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/IPython/core/shellapp.py\", line 246, in init_extensions\n    self.shell.extension_manager.load_extension(ext)\n  File \"/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/IPython/core/extensions.py\", line 85, in load_extension\n    if self._call_load_ipython_extension(mod):\n  File \"/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/IPython/core/extensions.py\", line 132, in _call_load_ipython_extension\n    mod.load_ipython_extension(self.shell)\n  File \"/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/line_profiler.py\", line 372, in load_ipython_extension\n    ip.define_magic('lprun', magic_lprun)\nAttributeError: 'SageTerminalInteractiveShell' object has no attribute 'define_magic'\nsage: %lprun?\nObject `%lprun` not found.\n```",
    "created_at": "2016-08-11T22:36:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20769#issuecomment-286696",
    "user": "https://github.com/jhpalmieri"
}
```

I think this also broke `line_profiler`:

```
$ sage
┌────────────────────────────────────────────────────────────────────┐
│ SageMath version 7.4.beta0, Release Date: 2016-08-10               │
│ Type "notebook()" for the browser-based notebook interface.        │
│ Type "help()" for help.                                            │
└────────────────────────────────────────────────────────────────────┘
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Warning: this is a prerelease version, and it may be unstable.     ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
[SageTerminalApp] WARNING | Error in loading extension: line_profiler
Check your config files in /Users/palmieri/.sage/ipython_genutils-0.1.0/profile_default
Traceback (most recent call last):
  File "/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/IPython/core/shellapp.py", line 246, in init_extensions
    self.shell.extension_manager.load_extension(ext)
  File "/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/IPython/core/extensions.py", line 85, in load_extension
    if self._call_load_ipython_extension(mod):
  File "/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/IPython/core/extensions.py", line 132, in _call_load_ipython_extension
    mod.load_ipython_extension(self.shell)
  File "/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/line_profiler.py", line 372, in load_ipython_extension
    ip.define_magic('lprun', magic_lprun)
AttributeError: 'SageTerminalInteractiveShell' object has no attribute 'define_magic'
sage: %lprun?
Object `%lprun` not found.
```



---

archive/issue_comments_286697.json:
```json
{
    "body": "Replying to [comment:24 jhpalmieri]:\n> I think this also broke `line_profiler`:\n\n\nSee #21457.",
    "created_at": "2016-09-09T00:12:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20769#issuecomment-286697",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Replying to [comment:24 jhpalmieri]:
> I think this also broke `line_profiler`:


See #21457.
