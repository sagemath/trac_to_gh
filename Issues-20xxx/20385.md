# Issue 20385: Update GMP-ECM to version 7.0

archive/issues_020148.json:
```json
{
    "body": "GMP-ECM 7.0.4 is available at [https://gforge.inria.fr/frs/download.php/file/36224/ecm-7.0.4.tar.gz](https://gforge.inria.fr/frs/download.php/file/36224/ecm-7.0.4.tar.gz).\n\n---\n\n(This was referring to version 7.0:)\n\nSome issues were reported for the Debian package:\\\\\n\n[https://buildd.debian.org/status/package.php?p=gmp-ecm](https://buildd.debian.org/status/package.php?p=gmp-ecm), in particular on 32-bit PowerPC and FreeBSD. Is there any such machine on the Sage build farm?\n\n---\n\nUpgrade GMP-ECM to 7.0.4\n    \n* I haven't repackaged the upstream tarball (`.tar.gz`) [yet].\n  Not sure whether we could/should also delete some stuff not\n  needed for Sage (cf. `SPKG.txt`); at least there's no `spkg-src`\n  script.\n    \n* I haven't touched `spkg-install` yet.  We may address potential\n  issues with `SAGE_FAT_BINARY` (mentioned both there and in `SPKG.txt`),\n  as well as known problems with `-march=native -O3` on bdver[1-4]\n  (AMD FX-???? !Bulldozer/Piledriver, AMD Opteron 6[23]xx, etc.)\n  where we should add `-mno-xop` because of bugs in (AFAIK) **every**\n  GCC version that supports these processors, silently leading\n  to broken code (\"just\" testsuite failures IIRC).\n  Also, we currently copy Sage's `config.guess` (because it was newer\n  at some point), which presumably is no longer necessary (but\n  shouldn't hurt either, provided we keep Sage's up-to-date *and*\n  GMP-ECM won't rely on its own).\n    \n* The doctests in `sage/libs/libecm.pyx` may need some changes,\n  especially with respect to `verbose` mode tests.  (But I'll presumably\n  work on them elsewhere anyway, independently of this upgrade.)\n\n* We definitely also have to fix the pexpect interface to `ecm`\n  in `src/sage/interfaces/ecm.py`, as the command line interface\n  has changed in GMP-ECM 7.x.\n\n\n**CC:**  @kiwifb\n\n**Branch:** [946c5808691c5437cb6b2148fe0a5b7a200ce140](https://github.com/sagemath/sagetrac-mirror/commit/946c5808691c5437cb6b2148fe0a5b7a200ce140)\n\n**Reviewer:** Jean-Pierre Flori\n\n**Author:** Leif Leonhardy, Jeroen Demeyer, Fran\u00e7ois Bissey, Antonio Rojas\n\n**Resolution:** fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/20385\n\n",
    "closed_at": "2017-05-14T08:20:09Z",
    "created_at": "2016-04-08T06:54:54Z",
    "labels": [
        "component: packages: standard"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.4",
    "title": "Update GMP-ECM to version 7.0",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/20385",
    "user": "https://github.com/zimmermann6"
}
```
GMP-ECM 7.0.4 is available at [https://gforge.inria.fr/frs/download.php/file/36224/ecm-7.0.4.tar.gz](https://gforge.inria.fr/frs/download.php/file/36224/ecm-7.0.4.tar.gz).

---

(This was referring to version 7.0:)

Some issues were reported for the Debian package:\\

[https://buildd.debian.org/status/package.php?p=gmp-ecm](https://buildd.debian.org/status/package.php?p=gmp-ecm), in particular on 32-bit PowerPC and FreeBSD. Is there any such machine on the Sage build farm?

---

Upgrade GMP-ECM to 7.0.4
    
* I haven't repackaged the upstream tarball (`.tar.gz`) [yet].
  Not sure whether we could/should also delete some stuff not
  needed for Sage (cf. `SPKG.txt`); at least there's no `spkg-src`
  script.
    
* I haven't touched `spkg-install` yet.  We may address potential
  issues with `SAGE_FAT_BINARY` (mentioned both there and in `SPKG.txt`),
  as well as known problems with `-march=native -O3` on bdver[1-4]
  (AMD FX-???? !Bulldozer/Piledriver, AMD Opteron 6[23]xx, etc.)
  where we should add `-mno-xop` because of bugs in (AFAIK) **every**
  GCC version that supports these processors, silently leading
  to broken code ("just" testsuite failures IIRC).
  Also, we currently copy Sage's `config.guess` (because it was newer
  at some point), which presumably is no longer necessary (but
  shouldn't hurt either, provided we keep Sage's up-to-date *and*
  GMP-ECM won't rely on its own).
    
* The doctests in `sage/libs/libecm.pyx` may need some changes,
  especially with respect to `verbose` mode tests.  (But I'll presumably
  work on them elsewhere anyway, independently of this upgrade.)

* We definitely also have to fix the pexpect interface to `ecm`
  in `src/sage/interfaces/ecm.py`, as the command line interface
  has changed in GMP-ECM 7.x.


**CC:**  @kiwifb

**Branch:** [946c5808691c5437cb6b2148fe0a5b7a200ce140](https://github.com/sagemath/sagetrac-mirror/commit/946c5808691c5437cb6b2148fe0a5b7a200ce140)

**Reviewer:** Jean-Pierre Flori

**Author:** Leif Leonhardy, Jeroen Demeyer, François Bissey, Antonio Rojas

**Resolution:** fixed

Issue created by migration from https://trac.sagemath.org/ticket/20385





---

archive/issue_comments_373206.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,6 +1,4 @@\n-GMP-ECM 7.0 is available at `https://gforge.inria.fr/frs/download.php/file/35642/ecm-7.0.tar.gz`.\n+GMP-ECM 7.0 is available at [https://gforge.inria.fr/frs/download.php/file/35642/ecm-7.0.tar.gz](https://gforge.inria.fr/frs/download.php/file/35642/ecm-7.0.tar.gz).\n \n Some issues were reported for the Debian package:\n-\n-```\n-https://buildd.debian.org/status/package.php?p=gmp-ecm}}}, in particular on 32-bit PowerPC and FreeBSD. Is there any such machine on the Sage build farm?\n+[https://buildd.debian.org/status/package.php?p=gmp-ecm](https://buildd.debian.org/status/package.php?p=gmp-ecm), in particular on 32-bit PowerPC and FreeBSD. Is there any such machine on the Sage build farm?\n``````\n",
    "created_at": "2016-04-08T07:26:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373206",
    "user": "https://github.com/kiwifb"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,6 +1,4 @@
-GMP-ECM 7.0 is available at `https://gforge.inria.fr/frs/download.php/file/35642/ecm-7.0.tar.gz`.
+GMP-ECM 7.0 is available at [https://gforge.inria.fr/frs/download.php/file/35642/ecm-7.0.tar.gz](https://gforge.inria.fr/frs/download.php/file/35642/ecm-7.0.tar.gz).
 
 Some issues were reported for the Debian package:
-
-```
-https://buildd.debian.org/status/package.php?p=gmp-ecm}}}, in particular on 32-bit PowerPC and FreeBSD. Is there any such machine on the Sage build farm?
+[https://buildd.debian.org/status/package.php?p=gmp-ecm](https://buildd.debian.org/status/package.php?p=gmp-ecm), in particular on 32-bit PowerPC and FreeBSD. Is there any such machine on the Sage build farm?
``````




---

archive/issue_events_062793.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2016-07-31T03:39:32Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "milestone": "sage-7.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20385#event-62793"
}
```



---

archive/issue_comments_373207.json:
```json
{
    "body": "<a id='comment:3'></a>\nCool!",
    "created_at": "2016-08-02T23:37:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373207",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:3'></a>
Cool!



---

archive/issue_comments_373208.json:
```json
{
    "body": "Replying to [ticket:20385 zimmerma]:\n> Some issues were reported for the Debian package:\n> [https://buildd.debian.org/status/package.php?p=gmp-ecm](https://buildd.debian.org/status/package.php?p=gmp-ecm), in particular on 32-bit PowerPC and FreeBSD. Is there any such machine on the Sage build farm?\n\n\nI fail to see failures there by now (the version listed there also is 7.0.3+ds-1 though).\n\nAnd no, AFAICT we don't have any PowerPC (neither 32-bit nor 64-bit) nor any FreeBSD *buildbot*.\n\n\nI guess Fran\u00e7ois regularly tests on Linux PowerPC64 though, and I think Jeroen still has access to some PowerPC running MacOS X 10.5 (we might no longer support; AFAIK 32-bit OS, not sure, but 64-bit CPU).",
    "created_at": "2016-08-02T23:51:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373208",
    "user": "https://github.com/nexttime"
}
```

Replying to [ticket:20385 zimmerma]:
> Some issues were reported for the Debian package:
> [https://buildd.debian.org/status/package.php?p=gmp-ecm](https://buildd.debian.org/status/package.php?p=gmp-ecm), in particular on 32-bit PowerPC and FreeBSD. Is there any such machine on the Sage build farm?


I fail to see failures there by now (the version listed there also is 7.0.3+ds-1 though).

And no, AFAICT we don't have any PowerPC (neither 32-bit nor 64-bit) nor any FreeBSD *buildbot*.


I guess François regularly tests on Linux PowerPC64 though, and I think Jeroen still has access to some PowerPC running MacOS X 10.5 (we might no longer support; AFAIK 32-bit OS, not sure, but 64-bit CPU).



---

archive/issue_comments_373209.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,4 +1,9 @@\n-GMP-ECM 7.0 is available at [https://gforge.inria.fr/frs/download.php/file/35642/ecm-7.0.tar.gz](https://gforge.inria.fr/frs/download.php/file/35642/ecm-7.0.tar.gz).\n+GMP-ECM 7.0.3 is available at [https://gforge.inria.fr/frs/download.php/file/36043/ecm-7.0.3.tar.gz](https://gforge.inria.fr/frs/download.php/file/36043/ecm-7.0.3.tar.gz).\n \n-Some issues were reported for the Debian package:\n+---\n+\n+(This was referring to version 7.0:)\n+\n+Some issues were reported for the Debian package:\\\\\n+\n [https://buildd.debian.org/status/package.php?p=gmp-ecm](https://buildd.debian.org/status/package.php?p=gmp-ecm), in particular on 32-bit PowerPC and FreeBSD. Is there any such machine on the Sage build farm?\n``````\n",
    "created_at": "2016-08-03T00:13:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373209",
    "user": "https://github.com/nexttime"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,4 +1,9 @@
-GMP-ECM 7.0 is available at [https://gforge.inria.fr/frs/download.php/file/35642/ecm-7.0.tar.gz](https://gforge.inria.fr/frs/download.php/file/35642/ecm-7.0.tar.gz).
+GMP-ECM 7.0.3 is available at [https://gforge.inria.fr/frs/download.php/file/36043/ecm-7.0.3.tar.gz](https://gforge.inria.fr/frs/download.php/file/36043/ecm-7.0.3.tar.gz).
 
-Some issues were reported for the Debian package:
+---
+
+(This was referring to version 7.0:)
+
+Some issues were reported for the Debian package:\\
+
 [https://buildd.debian.org/status/package.php?p=gmp-ecm](https://buildd.debian.org/status/package.php?p=gmp-ecm), in particular on 32-bit PowerPC and FreeBSD. Is there any such machine on the Sage build farm?
``````




---

archive/issue_comments_373210.json:
```json
{
    "body": "<a id='comment:5'></a>\n\"Upgraded\" to version 7.0.3 (of July 4th, currently the latest available).\n\n(Strange that this version and 7.0.2 apparently haven't been tagged in the svn repo.)",
    "created_at": "2016-08-03T00:13:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373210",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:5'></a>
"Upgraded" to version 7.0.3 (of July 4th, currently the latest available).

(Strange that this version and 7.0.2 apparently haven't been tagged in the svn repo.)



---

archive/issue_comments_373211.json:
```json
{
    "body": "<a id='comment:6'></a>\nAccording to [comment:ticket:19233:16 Paul's comment], we can drop the only patch (from #19233) we currently have in Sage.",
    "created_at": "2016-08-03T00:52:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373211",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:6'></a>
According to [comment:ticket:19233:16 Paul's comment], we can drop the only patch (from #19233) we currently have in Sage.



---

archive/issue_comments_373212.json:
```json
{
    "body": "<a id='comment:7'></a>\nShould we repackage the tarball with `bzip2`?",
    "created_at": "2016-08-03T00:55:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373212",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:7'></a>
Should we repackage the tarball with `bzip2`?



---

archive/issue_comments_373213.json:
```json
{
    "body": "<a id='comment:8'></a>\nReplying to [leif](#comment%3A7):\n> Should we repackage the tarball with `bzip2`?\n\n\n```\n900K\tecm-7.0.3.tar.bz2\n1.1M\tecm-7.0.3.tar.gz\n```",
    "created_at": "2016-08-03T00:59:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373213",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:8'></a>
Replying to [leif](#comment%3A7):
> Should we repackage the tarball with `bzip2`?


```
900K	ecm-7.0.3.tar.bz2
1.1M	ecm-7.0.3.tar.gz
```



---

archive/issue_comments_373214.json:
```json
{
    "body": "**Author:** Leif Leonhardy",
    "created_at": "2016-08-03T02:51:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373214",
    "user": "https://github.com/nexttime"
}
```

**Author:** Leif Leonhardy



---

archive/issue_comments_373215.json:
```json
{
    "body": "<a id='comment:9'></a>\nNote that the patch is preliminary (cf. the commit message / ticket description), but I'm setting it to \"needs review\" as there's something that can already be tested.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c0f78464d52f731e6fcb4486c281c93bf76bcdbc\">c0f7846</a></td><td><code>GMP-ECM: #20385: Upgrade package to 7.0.3 (preliminary patch, see below)</code></td></tr></table>\n",
    "created_at": "2016-08-03T02:51:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373215",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:9'></a>
Note that the patch is preliminary (cf. the commit message / ticket description), but I'm setting it to "needs review" as there's something that can already be tested.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c0f78464d52f731e6fcb4486c281c93bf76bcdbc">c0f7846</a></td><td><code>GMP-ECM: #20385: Upgrade package to 7.0.3 (preliminary patch, see below)</code></td></tr></table>




---

archive/issue_comments_373216.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2016-08-03T02:51:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373216",
    "user": "https://github.com/nexttime"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_373217.json:
```json
{
    "body": "**Branch:** [u/leif/gmp-ecm-7.x](https://github.com/sagemath/sagetrac-mirror/tree/u/leif/gmp-ecm-7.x)",
    "created_at": "2016-08-03T02:51:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373217",
    "user": "https://github.com/nexttime"
}
```

**Branch:** [u/leif/gmp-ecm-7.x](https://github.com/sagemath/sagetrac-mirror/tree/u/leif/gmp-ecm-7.x)



---

archive/issue_comments_373218.json:
```json
{
    "body": "**Commit:** [c0f78464d52f731e6fcb4486c281c93bf76bcdbc](https://github.com/sagemath/sagetrac-mirror/commit/c0f78464d52f731e6fcb4486c281c93bf76bcdbc)",
    "created_at": "2016-08-03T02:51:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373218",
    "user": "https://github.com/nexttime"
}
```

**Commit:** [c0f78464d52f731e6fcb4486c281c93bf76bcdbc](https://github.com/sagemath/sagetrac-mirror/commit/c0f78464d52f731e6fcb4486c281c93bf76bcdbc)



---

archive/issue_comments_373219.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -7,3 +7,29 @@\n Some issues were reported for the Debian package:\\\\\n \n [https://buildd.debian.org/status/package.php?p=gmp-ecm](https://buildd.debian.org/status/package.php?p=gmp-ecm), in particular on 32-bit PowerPC and FreeBSD. Is there any such machine on the Sage build farm?\n+\n+---\n+\n+Upgrade GMP-ECM to 7.0.3\n+    \n+* I haven't repackaged the upstream tarball (`.tar.gz`) [yet].\n+  Not sure whether we could/should also delete some stuff not\n+  needed for Sage (cf. `SPKG.txt`); at least there's no `spkg-src`\n+  script.\n+    \n+* I haven't touched `spkg-install` yet.  We may address potential\n+  issues with `SAGE_FAT_BINARY` (mentioned both there and in `SPKG.txt`),\n+  as well as known problems with `-march=native -O3` on bdver[1-4]\n+  (AMD FX-???? !Bulldozer/Piledriver, AMD Opteron 6[23]xx, etc.)\n+  where we should add `-mno-xop` because of bugs in (AFAIK) **every**\n+  GCC version that supports these processors, silently leading\n+  to broken code (\"just\" testsuite failures IIRC).\n+  Also, we currently copy Sage's `config.guess` (because it was newer\n+  at some point), which presumably is no longer necessary (but\n+  shouldn't hurt either, provided we keep Sage's up-to-date *and*\n+  GMP-ECM won't rely on its own).\n+    \n+* The doctests in `sage/libs/libecm.pyx` may need some changes,\n+  especially with respect to `verbose` mode tests.  (But I'll presumably\n+  work on them elsewhere anyway, independently of this upgrade.)\n+\n``````\n",
    "created_at": "2016-08-03T02:51:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373219",
    "user": "https://github.com/nexttime"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -7,3 +7,29 @@
 Some issues were reported for the Debian package:\\
 
 [https://buildd.debian.org/status/package.php?p=gmp-ecm](https://buildd.debian.org/status/package.php?p=gmp-ecm), in particular on 32-bit PowerPC and FreeBSD. Is there any such machine on the Sage build farm?
+
+---
+
+Upgrade GMP-ECM to 7.0.3
+    
+* I haven't repackaged the upstream tarball (`.tar.gz`) [yet].
+  Not sure whether we could/should also delete some stuff not
+  needed for Sage (cf. `SPKG.txt`); at least there's no `spkg-src`
+  script.
+    
+* I haven't touched `spkg-install` yet.  We may address potential
+  issues with `SAGE_FAT_BINARY` (mentioned both there and in `SPKG.txt`),
+  as well as known problems with `-march=native -O3` on bdver[1-4]
+  (AMD FX-???? !Bulldozer/Piledriver, AMD Opteron 6[23]xx, etc.)
+  where we should add `-mno-xop` because of bugs in (AFAIK) **every**
+  GCC version that supports these processors, silently leading
+  to broken code ("just" testsuite failures IIRC).
+  Also, we currently copy Sage's `config.guess` (because it was newer
+  at some point), which presumably is no longer necessary (but
+  shouldn't hurt either, provided we keep Sage's up-to-date *and*
+  GMP-ECM won't rely on its own).
+    
+* The doctests in `sage/libs/libecm.pyx` may need some changes,
+  especially with respect to `verbose` mode tests.  (But I'll presumably
+  work on them elsewhere anyway, independently of this upgrade.)
+
``````




---

archive/issue_comments_373220.json:
```json
{
    "body": "Replying to [ticket:20385 leif's ticket description]:\n>     * I haven't touched `spkg-install` yet.  We may address [...]\n>       known problems with `-march=native -O3` on bdver[1-4]\n>       (AMD FX-???? !Bulldozer/Piledriver, AMD Opteron 6[23]xx, etc.)\n>       where we should add `-mno-xop` because of bugs in (AFAIK) **every**\n>       GCC version that supports these processors, silently leading\n>       to broken code (\"just\" testsuite failures IIRC).\n\n\nThis is still true for 7.0.3 (and Ubuntu's GCC 4.6.3 at least), while what used to be `make check` is now `make longcheck`:\n\n```\n...\nGMP-ECM 7.0.3 [configured with GMP 5.1.1, --enable-asm-redc] [P+1]\nInput number is 2277189375098448170118558775447117254551111605543304035536750762506158547102293199086726265869065639109 (103 digits)\nUsing B1=1000000, B2=0, polynomial x^1, x0=3\nStep 1 took 584ms\nGMP-ECM 7.0.3 [configured with GMP 5.1.1, --enable-asm-redc] [P+1]\n############### ERROR ###############\nExpected return code 14 but got 0\nmake: *** [longcheck] Error 1\n```\n\nI think we should do `make check && make longcheck` in `spkg-check` then.",
    "created_at": "2016-08-03T04:11:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373220",
    "user": "https://github.com/nexttime"
}
```

Replying to [ticket:20385 leif's ticket description]:
>     * I haven't touched `spkg-install` yet.  We may address [...]
>       known problems with `-march=native -O3` on bdver[1-4]
>       (AMD FX-???? !Bulldozer/Piledriver, AMD Opteron 6[23]xx, etc.)
>       where we should add `-mno-xop` because of bugs in (AFAIK) **every**
>       GCC version that supports these processors, silently leading
>       to broken code ("just" testsuite failures IIRC).


This is still true for 7.0.3 (and Ubuntu's GCC 4.6.3 at least), while what used to be `make check` is now `make longcheck`:

```
...
GMP-ECM 7.0.3 [configured with GMP 5.1.1, --enable-asm-redc] [P+1]
Input number is 2277189375098448170118558775447117254551111605543304035536750762506158547102293199086726265869065639109 (103 digits)
Using B1=1000000, B2=0, polynomial x^1, x0=3
Step 1 took 584ms
GMP-ECM 7.0.3 [configured with GMP 5.1.1, --enable-asm-redc] [P+1]
############### ERROR ###############
Expected return code 14 but got 0
make: *** [longcheck] Error 1
```

I think we should do `make check && make longcheck` in `spkg-check` then.



---

archive/issue_comments_373221.json:
```json
{
    "body": "<a id='comment:11'></a>\nOoops, on the other hand `make check` now **fails** with `-march=native -mno-xop -O3 -g` (while it passed without `-mno-xop`?!?!):\n\n```\nFAIL: test.pp1\nPASS: test.pm1\nPASS: test.ecm\n============================================================================\nTestsuite summary for ecm 7.0.3\n============================================================================\n# TOTAL: 3\n# PASS:  2\n# SKIP:  0\n# XFAIL: 0\n# FAIL:  1\n# XPASS: 0\n# ERROR: 0\n============================================================================\nSee ./test-suite.log\nPlease report to ecm-discuss@lists.gforge.inria.fr\n============================================================================\nmake[3]: *** [test-suite.log] Error 1\nmake[3]: Leaving directory `/home/leif/build/ecm-7.0.3-build.bulldozer-gcc-4.6.3-default'\nmake[2]: *** [check-TESTS] Error 2\nmake[2]: Leaving directory `/home/leif/build/ecm-7.0.3-build.bulldozer-gcc-4.6.3-default'\nmake[1]: *** [check-am] Error 2\nmake[1]: Leaving directory `/home/leif/build/ecm-7.0.3-build.bulldozer-gcc-4.6.3-default'\nmake: *** [check-recursive] Error 1\n```\n\n`test-suite.log`:\n\n```\n...\nGMP-ECM 7.0.3 [configured with GMP 5.1.1, --enable-asm-redc] [P+1]\nInput number is 2277189375098448170118558775447117254551111605543304035536750762506158547102293199086726265869065639109 (103 digits)\nUsing B1=2337233, B2=173055082, polynomial x^1, x0=3\nStep 1 took 1368ms\nStep 2 took 104ms\n********** Factor found in step 2: 4190453151940208656715582382315221647\nFound prime factor of 37 digits: 4190453151940208656715582382315221647\nPrime cofactor 543423179434447039008165356160798838947285203071935410761431031147 has 66 digits\nGMP-ECM 7.0.3 [configured with GMP 5.1.1, --enable-asm-redc] [P+1]\nSave file test.pp1.save already exists, will not overwrite\n############### ERROR ###############\nExpected return code 0 but got 1\nFAIL test.pp1 (exit status: 1)\n```\n(`make longcheck` fails in the same way as it apparently also performs the same test(s).)",
    "created_at": "2016-08-03T04:31:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373221",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:11'></a>
Ooops, on the other hand `make check` now **fails** with `-march=native -mno-xop -O3 -g` (while it passed without `-mno-xop`?!?!):

```
FAIL: test.pp1
PASS: test.pm1
PASS: test.ecm
============================================================================
Testsuite summary for ecm 7.0.3
============================================================================
# TOTAL: 3
# PASS:  2
# SKIP:  0
# XFAIL: 0
# FAIL:  1
# XPASS: 0
# ERROR: 0
============================================================================
See ./test-suite.log
Please report to ecm-discuss@lists.gforge.inria.fr
============================================================================
make[3]: *** [test-suite.log] Error 1
make[3]: Leaving directory `/home/leif/build/ecm-7.0.3-build.bulldozer-gcc-4.6.3-default'
make[2]: *** [check-TESTS] Error 2
make[2]: Leaving directory `/home/leif/build/ecm-7.0.3-build.bulldozer-gcc-4.6.3-default'
make[1]: *** [check-am] Error 2
make[1]: Leaving directory `/home/leif/build/ecm-7.0.3-build.bulldozer-gcc-4.6.3-default'
make: *** [check-recursive] Error 1
```

`test-suite.log`:

```
...
GMP-ECM 7.0.3 [configured with GMP 5.1.1, --enable-asm-redc] [P+1]
Input number is 2277189375098448170118558775447117254551111605543304035536750762506158547102293199086726265869065639109 (103 digits)
Using B1=2337233, B2=173055082, polynomial x^1, x0=3
Step 1 took 1368ms
Step 2 took 104ms
********** Factor found in step 2: 4190453151940208656715582382315221647
Found prime factor of 37 digits: 4190453151940208656715582382315221647
Prime cofactor 543423179434447039008165356160798838947285203071935410761431031147 has 66 digits
GMP-ECM 7.0.3 [configured with GMP 5.1.1, --enable-asm-redc] [P+1]
Save file test.pp1.save already exists, will not overwrite
############### ERROR ###############
Expected return code 0 but got 1
FAIL test.pp1 (exit status: 1)
```
(`make longcheck` fails in the same way as it apparently also performs the same test(s).)



---

archive/issue_comments_373222.json:
```json
{
    "body": "<a id='comment:12'></a>\nHmmm, or maybe not, and `make clean` was just not enough.\n\nAfter `make distclean`, `make check` again passes with `-march=native -mtune=native -mno-xop -O3 -g` in `gmp.h` (but now also `--enable-assert`).\n\nBut in `make longcheck`, I'm now getting a different, apparently unrelated error:\n\n```\n...\nGMP-ECM 7.0.3 [configured with GMP 5.1.1, --enable-asm-redc, --enable-assert] [P+1]\nInput number is 18446744073709551337 (20 digits)\nUsing B1=70823, B2=1320588, polynomial x^1, x0=2\nStep 1 took 16ms\n********** Factor found in step 1: 18446744073709551337\nFound input number N\n../../src/ecm-7.0.3/test.pp1: 151: ../../src/ecm-7.0.3/test.pp1: cannot open ./c155: No such file\n############### ERROR ###############\nExpected return code 0 but got 2\nmake: *** [longcheck] Error 1\n```",
    "created_at": "2016-08-03T04:50:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373222",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:12'></a>
Hmmm, or maybe not, and `make clean` was just not enough.

After `make distclean`, `make check` again passes with `-march=native -mtune=native -mno-xop -O3 -g` in `gmp.h` (but now also `--enable-assert`).

But in `make longcheck`, I'm now getting a different, apparently unrelated error:

```
...
GMP-ECM 7.0.3 [configured with GMP 5.1.1, --enable-asm-redc, --enable-assert] [P+1]
Input number is 18446744073709551337 (20 digits)
Using B1=70823, B2=1320588, polynomial x^1, x0=2
Step 1 took 16ms
********** Factor found in step 1: 18446744073709551337
Found input number N
../../src/ecm-7.0.3/test.pp1: 151: ../../src/ecm-7.0.3/test.pp1: cannot open ./c155: No such file
############### ERROR ###############
Expected return code 0 but got 2
make: *** [longcheck] Error 1
```



---

archive/issue_comments_373223.json:
```json
{
    "body": "**Changing commit** from \"[c0f78464d52f731e6fcb4486c281c93bf76bcdbc](https://github.com/sagemath/sagetrac-mirror/commit/c0f78464d52f731e6fcb4486c281c93bf76bcdbc)\" to \"[64eb69eca4d560773a8057b533a341f18c5ab3cf](https://github.com/sagemath/sagetrac-mirror/commit/64eb69eca4d560773a8057b533a341f18c5ab3cf)\".",
    "created_at": "2016-08-03T05:28:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373223",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[c0f78464d52f731e6fcb4486c281c93bf76bcdbc](https://github.com/sagemath/sagetrac-mirror/commit/c0f78464d52f731e6fcb4486c281c93bf76bcdbc)" to "[64eb69eca4d560773a8057b533a341f18c5ab3cf](https://github.com/sagemath/sagetrac-mirror/commit/64eb69eca4d560773a8057b533a341f18c5ab3cf)".



---

archive/issue_comments_373224.json:
```json
{
    "body": "<a id='comment:13'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/64eb69eca4d560773a8057b533a341f18c5ab3cf\">64eb69e</a></td><td><code>GMP-ECM: #20385: (Also) run 'make longcheck' in spkg-check</code></td></tr></table>\n",
    "created_at": "2016-08-03T05:28:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373224",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/64eb69eca4d560773a8057b533a341f18c5ab3cf">64eb69e</a></td><td><code>GMP-ECM: #20385: (Also) run 'make longcheck' in spkg-check</code></td></tr></table>




---

archive/issue_comments_373225.json:
```json
{
    "body": "<a id='comment:14'></a>\nIt seems `make longcheck` needs some upstream work, as I'm also getting (ignored!) \"meta-errors\" (syntax errors etc.) with a clean, fresh build on another (non-AMD) machine.",
    "created_at": "2016-08-03T06:04:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373225",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:14'></a>
It seems `make longcheck` needs some upstream work, as I'm also getting (ignored!) "meta-errors" (syntax errors etc.) with a clean, fresh build on another (non-AMD) machine.



---

archive/issue_comments_373226.json:
```json
{
    "body": "<a id='comment:15'></a>\nReplying to [leif](#comment%3A14):\n> It seems `make longcheck` needs some upstream work, as I'm also getting (ignored!) \"meta-errors\" (syntax errors etc.) with a clean, fresh build on another (non-AMD) machine.\n\n\nApparently also building out-of-tree is broken (more precisely, running `make longcheck` in an out-of-tree build, which definitely fails).",
    "created_at": "2016-08-03T07:05:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373226",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:15'></a>
Replying to [leif](#comment%3A14):
> It seems `make longcheck` needs some upstream work, as I'm also getting (ignored!) "meta-errors" (syntax errors etc.) with a clean, fresh build on another (non-AMD) machine.


Apparently also building out-of-tree is broken (more precisely, running `make longcheck` in an out-of-tree build, which definitely fails).



---

archive/issue_comments_373227.json:
```json
{
    "body": "<a id='comment:16'></a>\nLooks like I wasn't on cc even so Paul explicitly added me when the ticket was created. I missed all your action from the last few hours.\nMy gentoo ebuild passes \"make check\" but then I don't do fancy flags. Will try \"make longcheck\". \nBefore the release Paul opened a conversation on the last ecm upgrade ticket. Apart from the doctest there is interface change to deal with [https://trac.sagemath.org/ticket/14151#comment:46](https://trac.sagemath.org/ticket/14151#comment:46)",
    "created_at": "2016-08-03T07:52:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373227",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:16'></a>
Looks like I wasn't on cc even so Paul explicitly added me when the ticket was created. I missed all your action from the last few hours.
My gentoo ebuild passes "make check" but then I don't do fancy flags. Will try "make longcheck". 
Before the release Paul opened a conversation on the last ecm upgrade ticket. Apart from the doctest there is interface change to deal with [https://trac.sagemath.org/ticket/14151#comment:46](https://trac.sagemath.org/ticket/14151#comment:46)



---

archive/issue_comments_373228.json:
```json
{
    "body": "<a id='comment:17'></a>\nReplying to [fbissey](#comment%3A16):\n> Looks like I wasn't on cc even so Paul explicitly added me when the ticket was created. I missed all your action from the last few hours.\n\n\nHmmm, perhaps recheck your trac notification preferences as you already commented on this ticket, too (so you should by default receive notifications even when not explicitly cc'ed).\n\n\\\\\n \n> My gentoo ebuild passes \"make check\" but then I don't do fancy flags. Will try \"make longcheck\". \n> Before the release Paul opened a conversation on the last ecm upgrade ticket. Apart from the doctest there is interface change to deal with [https://trac.sagemath.org/ticket/14151#comment:46](https://trac.sagemath.org/ticket/14151#comment:46)\n\n\nAnd although I participated in that old ticket, I somehow missed all that discussion from a couple of months ago...\n\nI have to admit I totally forgot Sage's pexpect interface to `ecm`.\n\nIs the execstack issue meanwhile resolved upstream?",
    "created_at": "2016-08-03T08:28:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373228",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:17'></a>
Replying to [fbissey](#comment%3A16):
> Looks like I wasn't on cc even so Paul explicitly added me when the ticket was created. I missed all your action from the last few hours.


Hmmm, perhaps recheck your trac notification preferences as you already commented on this ticket, too (so you should by default receive notifications even when not explicitly cc'ed).

\\
 
> My gentoo ebuild passes "make check" but then I don't do fancy flags. Will try "make longcheck". 
> Before the release Paul opened a conversation on the last ecm upgrade ticket. Apart from the doctest there is interface change to deal with [https://trac.sagemath.org/ticket/14151#comment:46](https://trac.sagemath.org/ticket/14151#comment:46)


And although I participated in that old ticket, I somehow missed all that discussion from a couple of months ago...

I have to admit I totally forgot Sage's pexpect interface to `ecm`.

Is the execstack issue meanwhile resolved upstream?



---

archive/issue_comments_373229.json:
```json
{
    "body": "<a id='comment:18'></a>\nReplying to [leif](#comment%3A17):\n> Replying to [fbissey](#comment%3A16):\n> \n> Is the execstack issue meanwhile resolved upstream?\n> \n\n\nNope. I have added myself to cc because I din't get your last message either.",
    "created_at": "2016-08-03T08:32:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373229",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:18'></a>
Replying to [leif](#comment%3A17):
> Replying to [fbissey](#comment%3A16):
> 
> Is the execstack issue meanwhile resolved upstream?
> 


Nope. I have added myself to cc because I din't get your last message either.



---

archive/issue_comments_373230.json:
```json
{
    "body": "**Changing commit** from \"[64eb69eca4d560773a8057b533a341f18c5ab3cf](https://github.com/sagemath/sagetrac-mirror/commit/64eb69eca4d560773a8057b533a341f18c5ab3cf)\" to \"[0affd290f491cf624f15fec080f3b349bd07477c](https://github.com/sagemath/sagetrac-mirror/commit/0affd290f491cf624f15fec080f3b349bd07477c)\".",
    "created_at": "2016-08-03T08:42:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373230",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[64eb69eca4d560773a8057b533a341f18c5ab3cf](https://github.com/sagemath/sagetrac-mirror/commit/64eb69eca4d560773a8057b533a341f18c5ab3cf)" to "[0affd290f491cf624f15fec080f3b349bd07477c](https://github.com/sagemath/sagetrac-mirror/commit/0affd290f491cf624f15fec080f3b349bd07477c)".



---

archive/issue_comments_373231.json:
```json
{
    "body": "<a id='comment:19'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0affd290f491cf624f15fec080f3b349bd07477c\">0affd29</a></td><td><code>GMP-ECM: #20385: Restore note on work-around in SPKG.txt that accidentally got dropped in the 6.4.4 package.</code></td></tr></table>\n",
    "created_at": "2016-08-03T08:42:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373231",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:19'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0affd290f491cf624f15fec080f3b349bd07477c">0affd29</a></td><td><code>GMP-ECM: #20385: Restore note on work-around in SPKG.txt that accidentally got dropped in the 6.4.4 package.</code></td></tr></table>




---

archive/issue_comments_373232.json:
```json
{
    "body": "<a id='comment:20'></a>\nHope you get this now, as the cc field was still empty...",
    "created_at": "2016-08-03T08:46:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373232",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:20'></a>
Hope you get this now, as the cc field was still empty...



---

archive/issue_comments_373233.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -33,3 +33,7 @@\n   especially with respect to `verbose` mode tests.  (But I'll presumably\n   work on them elsewhere anyway, independently of this upgrade.)\n \n+* We definitely also have to fix the pexpect interface to `ecm`\n+  in `src/sage/interfaces/ecm.py`, as the command line interface\n+  has changed in GMP-ECM 7.x.\n+\n``````\n",
    "created_at": "2016-08-03T09:09:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373233",
    "user": "https://github.com/nexttime"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -33,3 +33,7 @@
   especially with respect to `verbose` mode tests.  (But I'll presumably
   work on them elsewhere anyway, independently of this upgrade.)
 
+* We definitely also have to fix the pexpect interface to `ecm`
+  in `src/sage/interfaces/ecm.py`, as the command line interface
+  has changed in GMP-ECM 7.x.
+
``````




---

archive/issue_comments_373234.json:
```json
{
    "body": "<a id='comment:21'></a>\nAdded command line interface change to be addressed.",
    "created_at": "2016-08-03T09:09:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373234",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:21'></a>
Added command line interface change to be addressed.



---

archive/issue_comments_373235.json:
```json
{
    "body": "<a id='comment:22'></a>\nReplying to [fbissey](#comment%3A18):\n> Replying to [leif](#comment%3A17):\n> > Is the execstack issue meanwhile resolved upstream?\n\n> Nope.\n\nShould we add `-Wl,-z,noexecstack` in `spkg-install` until that's fixed upstream?",
    "created_at": "2016-08-03T09:14:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373235",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:22'></a>
Replying to [fbissey](#comment%3A18):
> Replying to [leif](#comment%3A17):
> > Is the execstack issue meanwhile resolved upstream?

> Nope.

Should we add `-Wl,-z,noexecstack` in `spkg-install` until that's fixed upstream?



---

archive/issue_comments_373236.json:
```json
{
    "body": "<a id='comment:23'></a>\nReplying to [leif](#comment%3A22):\n> Replying to [fbissey](#comment%3A18):\n> > Replying to [leif](#comment%3A17):\n> > > Is the execstack issue meanwhile resolved upstream?\n\n> > Nope.\n> \n> Should we add `-Wl,-z,noexecstack` in `spkg-install` until that's fixed upstream?\n\n\nYes. Upstream is open to a patch. Problem is the files are generated so you have to carefully fix the generator :(\n\nStill no notification, I'll have to inspect the spam filter tomorrow but I suspect it is not even making it there. May have to change the email address for my notification. And go to the dashboard to see if I missed updates on other tickets.",
    "created_at": "2016-08-03T09:35:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373236",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:23'></a>
Replying to [leif](#comment%3A22):
> Replying to [fbissey](#comment%3A18):
> > Replying to [leif](#comment%3A17):
> > > Is the execstack issue meanwhile resolved upstream?

> > Nope.
> 
> Should we add `-Wl,-z,noexecstack` in `spkg-install` until that's fixed upstream?


Yes. Upstream is open to a patch. Problem is the files are generated so you have to carefully fix the generator :(

Still no notification, I'll have to inspect the spam filter tomorrow but I suspect it is not even making it there. May have to change the email address for my notification. And go to the dashboard to see if I missed updates on other tickets.



---

archive/issue_comments_373237.json:
```json
{
    "body": "<a id='comment:24'></a>\nMy goodness! notification this time.",
    "created_at": "2016-08-03T09:38:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373237",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:24'></a>
My goodness! notification this time.



---

archive/issue_comments_373238.json:
```json
{
    "body": "<a id='comment:25'></a>\nSo after N attempts, I finally built GMP-ECM *in-place* two times (separate folders) on a Bulldozer (Opteron 6276), once with `-march=native -mtune=native -O3 -g`, and once with `-march=native -mtune=native -mno-xop -O3 -g`.\n\nIn **both** cases, `make check` and `make longcheck` succeeded now.\n\n(This presumably means the relevant code in GMP-ECM 6.x has changed enough to no longer expose the bugs in GCC when mixing XOP and AVX instructions at higher optimization levels.  That's not too surprising, as even minor changes made the issue vanish when I tried (hard!) to create a testcase for bugzilla.)",
    "created_at": "2016-08-03T09:40:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373238",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:25'></a>
So after N attempts, I finally built GMP-ECM *in-place* two times (separate folders) on a Bulldozer (Opteron 6276), once with `-march=native -mtune=native -O3 -g`, and once with `-march=native -mtune=native -mno-xop -O3 -g`.

In **both** cases, `make check` and `make longcheck` succeeded now.

(This presumably means the relevant code in GMP-ECM 6.x has changed enough to no longer expose the bugs in GCC when mixing XOP and AVX instructions at higher optimization levels.  That's not too surprising, as even minor changes made the issue vanish when I tried (hard!) to create a testcase for bugzilla.)



---

archive/issue_comments_373239.json:
```json
{
    "body": "<a id='comment:26'></a>\nReplying to [fbissey](#comment%3A23):\n> Problem is the files are generated so you have to carefully fix the generator :(\n\n\n?  `LDFLAGS`?  Perhaps `CCASFLAGS`?\n\nActually, upstream should add a `configure` check and add the appropriate flags when supported.\n\nDo we have to care about anything but Linux (x86/x86_64/ppc/ppc64/SPARC...)?\n\nAnything but GNU ld?  (Yes, on Solaris, the Sun linker may get used, but Solaris' not Linux.)",
    "created_at": "2016-08-03T09:49:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373239",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:26'></a>
Replying to [fbissey](#comment%3A23):
> Problem is the files are generated so you have to carefully fix the generator :(


?  `LDFLAGS`?  Perhaps `CCASFLAGS`?

Actually, upstream should add a `configure` check and add the appropriate flags when supported.

Do we have to care about anything but Linux (x86/x86_64/ppc/ppc64/SPARC...)?

Anything but GNU ld?  (Yes, on Solaris, the Sun linker may get used, but Solaris' not Linux.)



---

archive/issue_comments_373240.json:
```json
{
    "body": "<a id='comment:27'></a>\n`LDFLAGS`, linux x86(_64) only I think. As for `ld` I still suffer AIX boxes on ppc64 but sage won't build over there anyway (building python packages need hand holding for starter).",
    "created_at": "2016-08-03T10:01:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373240",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:27'></a>
`LDFLAGS`, linux x86(_64) only I think. As for `ld` I still suffer AIX boxes on ppc64 but sage won't build over there anyway (building python packages need hand holding for starter).



---

archive/issue_comments_373241.json:
```json
{
    "body": "<a id='comment:28'></a>\nGMP (6.1.1) has this:\n\n```sh\ndnl Checks whether the stack can be marked nonexecutable by passing an option\ndnl to the C-compiler when acting on .s files. Appends that option to ASMFLAGS.\ndnl This macro is adapted from one found in GLIBC-2.3.5.\ndnl FIXME: This test looks broken. It tests that a file with .note.GNU-stack...\ndnl can be compiled/assembled with -Wa,--noexecstack.  It does not determine\ndnl if that command-line option has any effect on general asm code.\nAC_DEFUN([CL_AS_NOEXECSTACK],[\ndnl AC_REQUIRE([AC_PROG_CC]) GMP uses something else\nAC_CACHE_CHECK([whether assembler supports --noexecstack option],\ncl_cv_as_noexecstack, [dnl\n  cat > conftest.c <<EOF\nvoid foo() {}\nEOF\n  if AC_TRY_COMMAND([${CC} $CFLAGS $CPPFLAGS\n                     -S -o conftest.s conftest.c >/dev/null]) \\\n     && grep .note.GNU-stack conftest.s >/dev/null \\\n     && AC_TRY_COMMAND([${CC} $CFLAGS $CPPFLAGS -Wa,--noexecstack\n                       -c -o conftest.o conftest.s >/dev/null])\n  then\n    cl_cv_as_noexecstack=yes\n  else\n    cl_cv_as_noexecstack=no\n  fi\n  rm -f conftest*])\n  if test \"$cl_cv_as_noexecstack\" = yes; then\n    ASMFLAGS=\"$ASMFLAGS -Wa,--noexecstack\"\n  fi\n  AC_SUBST(ASMFLAGS)\n])\n```\nNote that `--noexecstack` gets eventually passed to the *assembler*, not `-z noexecstack` to the *linker*.",
    "created_at": "2016-08-03T10:14:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373241",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:28'></a>
GMP (6.1.1) has this:

```sh
dnl Checks whether the stack can be marked nonexecutable by passing an option
dnl to the C-compiler when acting on .s files. Appends that option to ASMFLAGS.
dnl This macro is adapted from one found in GLIBC-2.3.5.
dnl FIXME: This test looks broken. It tests that a file with .note.GNU-stack...
dnl can be compiled/assembled with -Wa,--noexecstack.  It does not determine
dnl if that command-line option has any effect on general asm code.
AC_DEFUN([CL_AS_NOEXECSTACK],[
dnl AC_REQUIRE([AC_PROG_CC]) GMP uses something else
AC_CACHE_CHECK([whether assembler supports --noexecstack option],
cl_cv_as_noexecstack, [dnl
  cat > conftest.c <<EOF
void foo() {}
EOF
  if AC_TRY_COMMAND([${CC} $CFLAGS $CPPFLAGS
                     -S -o conftest.s conftest.c >/dev/null]) \
     && grep .note.GNU-stack conftest.s >/dev/null \
     && AC_TRY_COMMAND([${CC} $CFLAGS $CPPFLAGS -Wa,--noexecstack
                       -c -o conftest.o conftest.s >/dev/null])
  then
    cl_cv_as_noexecstack=yes
  else
    cl_cv_as_noexecstack=no
  fi
  rm -f conftest*])
  if test "$cl_cv_as_noexecstack" = yes; then
    ASMFLAGS="$ASMFLAGS -Wa,--noexecstack"
  fi
  AC_SUBST(ASMFLAGS)
])
```
Note that `--noexecstack` gets eventually passed to the *assembler*, not `-z noexecstack` to the *linker*.



---

archive/issue_comments_373242.json:
```json
{
    "body": "<a id='comment:29'></a>\nHa, when I was looking at 7.0rc with Paul I only had gmp-6.1.0 and I still had a message about the executable stack from portage if I didn't add `-Wl,-z,noexecstack` to `LDFLAGS`. I moved to 6.1.1 on 21st of June. And indeed I don't need to add it anymore, it is added automatically:\n\n```\nlibtool: link: x86_64-pc-linux-gnu-gcc -shared  -fPIC -DPIC  .libs/libecm_la-ecm.o .libs/libecm_la-ecm2.o .libs/libecm_la-pm1.o .libs/libecm_la-pp1.o .libs/libecm_la-getprime_r.o .libs/libecm_la-listz.o .libs/libecm_la-lucas.o .libs/libecm_la-stage2.o .libs/libecm_la-mpmod.o .libs/libecm_la-mul_lo.o .libs/libecm_la-polyeval.o .libs/libecm_la-median.o .libs/libecm_la-schoen_strass.o .libs/libecm_la-ks-multiply.o .libs/libecm_la-rho.o .libs/libecm_la-bestd.o .libs/libecm_la-auxlib.o .libs/libecm_la-random.o .libs/libecm_la-factor.o .libs/libecm_la-sp.o .libs/libecm_la-spv.o .libs/libecm_la-spm.o .libs/libecm_la-mpzspm.o .libs/libecm_la-mpzspv.o .libs/libecm_la-ntt_gfp.o .libs/libecm_la-ecm_ntt.o .libs/libecm_la-pm1fs2.o .libs/libecm_la-sets_long.o .libs/libecm_la-auxarith.o .libs/libecm_la-batch.o .libs/libecm_la-parametrizations.o .libs/libecm_la-cudawrapper.o aprtcle/.libs/libecm_la-mpz_aprcl.o  -Wl,--whole-archive ./x86_64/.libs/libmulredc.a -Wl,--no-whole-archive  -lgmp -lrt -lm  -g -O1 -march=native -ggdb -g -Wl,-znoexecstack -Wl,-O1 -Wl,--as-needed -O1 -march=native -ggdb   -Wl,-soname -Wl,libecm.so.1 -o .libs/libecm.so.1.0.0\n```",
    "created_at": "2016-08-03T10:29:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373242",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:29'></a>
Ha, when I was looking at 7.0rc with Paul I only had gmp-6.1.0 and I still had a message about the executable stack from portage if I didn't add `-Wl,-z,noexecstack` to `LDFLAGS`. I moved to 6.1.1 on 21st of June. And indeed I don't need to add it anymore, it is added automatically:

```
libtool: link: x86_64-pc-linux-gnu-gcc -shared  -fPIC -DPIC  .libs/libecm_la-ecm.o .libs/libecm_la-ecm2.o .libs/libecm_la-pm1.o .libs/libecm_la-pp1.o .libs/libecm_la-getprime_r.o .libs/libecm_la-listz.o .libs/libecm_la-lucas.o .libs/libecm_la-stage2.o .libs/libecm_la-mpmod.o .libs/libecm_la-mul_lo.o .libs/libecm_la-polyeval.o .libs/libecm_la-median.o .libs/libecm_la-schoen_strass.o .libs/libecm_la-ks-multiply.o .libs/libecm_la-rho.o .libs/libecm_la-bestd.o .libs/libecm_la-auxlib.o .libs/libecm_la-random.o .libs/libecm_la-factor.o .libs/libecm_la-sp.o .libs/libecm_la-spv.o .libs/libecm_la-spm.o .libs/libecm_la-mpzspm.o .libs/libecm_la-mpzspv.o .libs/libecm_la-ntt_gfp.o .libs/libecm_la-ecm_ntt.o .libs/libecm_la-pm1fs2.o .libs/libecm_la-sets_long.o .libs/libecm_la-auxarith.o .libs/libecm_la-batch.o .libs/libecm_la-parametrizations.o .libs/libecm_la-cudawrapper.o aprtcle/.libs/libecm_la-mpz_aprcl.o  -Wl,--whole-archive ./x86_64/.libs/libmulredc.a -Wl,--no-whole-archive  -lgmp -lrt -lm  -g -O1 -march=native -ggdb -g -Wl,-znoexecstack -Wl,-O1 -Wl,--as-needed -O1 -march=native -ggdb   -Wl,-soname -Wl,libecm.so.1 -o .libs/libecm.so.1.0.0
```



---

archive/issue_comments_373243.json:
```json
{
    "body": "<a id='comment:30'></a>\nI was just about to note that GMP-ECM consistently uses `CCAS` (which defaults to `CC`) and `CCASFLAGS` (which default to `CFLAGS`)...",
    "created_at": "2016-08-03T10:35:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373243",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:30'></a>
I was just about to note that GMP-ECM consistently uses `CCAS` (which defaults to `CC`) and `CCASFLAGS` (which default to `CFLAGS`)...



---

archive/issue_comments_373244.json:
```json
{
    "body": "<a id='comment:31'></a>\nIn any case sage's default is `mpir` so we should pass it in the default case. Passing it with gmp-6.1.1 doesn't really hurt.",
    "created_at": "2016-08-03T10:46:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373244",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:31'></a>
In any case sage's default is `mpir` so we should pass it in the default case. Passing it with gmp-6.1.1 doesn't really hurt.



---

archive/issue_comments_373245.json:
```json
{
    "body": "<a id='comment:32'></a>\nOh, GMP-ECM just harcodes it into `Makefile.am`:\n\n```\nlibecm_la_LDFLAGS = $(LIBECM_LDFLAGS) -version-info 1:0:0 -g -Wl,-znoexecstack\n```\n\n(Executables are *not* linked with that option, but link to the above library, and presumably don't contain any other asm modules.)\n\nAnd some linkers require a space IIRC...",
    "created_at": "2016-08-03T10:46:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373245",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:32'></a>
Oh, GMP-ECM just harcodes it into `Makefile.am`:

```
libecm_la_LDFLAGS = $(LIBECM_LDFLAGS) -version-info 1:0:0 -g -Wl,-znoexecstack
```

(Executables are *not* linked with that option, but link to the above library, and presumably don't contain any other asm modules.)

And some linkers require a space IIRC...



---

archive/issue_comments_373246.json:
```json
{
    "body": "<a id='comment:33'></a>\nReplying to [fbissey](#comment%3A31):\n> In any case sage's default is `mpir` so we should pass it in the default case. Passing it with gmp-6.1.1 doesn't really hurt.\n\n\n?  The option doesn't originate from GMP (see my last comment).",
    "created_at": "2016-08-03T10:49:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373246",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:33'></a>
Replying to [fbissey](#comment%3A31):
> In any case sage's default is `mpir` so we should pass it in the default case. Passing it with gmp-6.1.1 doesn't really hurt.


?  The option doesn't originate from GMP (see my last comment).



---

archive/issue_comments_373247.json:
```json
{
    "body": "<a id='comment:34'></a>\ncollision. I posted before you. I guess it must have steamed from me communicating my concern to Paul. It definitely wasn't there in 7.0rc and I don't think it was in 7.0 either. One less thing to worry about.",
    "created_at": "2016-08-03T10:52:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373247",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:34'></a>
collision. I posted before you. I guess it must have steamed from me communicating my concern to Paul. It definitely wasn't there in 7.0rc and I don't think it was in 7.0 either. One less thing to worry about.



---

archive/issue_comments_373248.json:
```json
{
    "body": "<a id='comment:35'></a>\nReplying to [fbissey](#comment%3A34):\n> collision. I posted before you. I guess it must have steamed from me communicating my concern to Paul. It definitely wasn't there in 7.0rc and I don't think it was in 7.0 either. One less thing to worry about.\n\n\nWell, until some linker bails out on that flag...  Or is libtool smart enough to remove it in case it isn't supported?",
    "created_at": "2016-08-03T10:56:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373248",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:35'></a>
Replying to [fbissey](#comment%3A34):
> collision. I posted before you. I guess it must have steamed from me communicating my concern to Paul. It definitely wasn't there in 7.0rc and I don't think it was in 7.0 either. One less thing to worry about.


Well, until some linker bails out on that flag...  Or is libtool smart enough to remove it in case it isn't supported?



---

archive/issue_comments_373249.json:
```json
{
    "body": "**Work_Issues:** Fix doctests and pexpect interface to ecm",
    "created_at": "2016-08-03T11:08:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373249",
    "user": "https://github.com/nexttime"
}
```

**Work_Issues:** Fix doctests and pexpect interface to ecm



---

archive/issue_comments_373250.json:
```json
{
    "body": "<a id='comment:37'></a>\nReplying to [leif](#comment%3A35):\n> Replying to [fbissey](#comment%3A34):\n> > collision. I posted before you. I guess it must have steamed from me communicating my concern to Paul. It definitely wasn't there in 7.0rc and I don't think it was in 7.0 either. One less thing to worry about.\n  \n> \n> Well, until some linker bails out on that flag...  Or is libtool smart enough to remove it in case it isn't supported?\n> \nPoint. Most linkers discard unrecognised option without side effect, the problem is when it can be interpreted in a completely different way by the linker (yes I have a \"funny\" example of that - it involves AIX's linker). It would be better if the flag was tested for in configure.",
    "created_at": "2016-08-03T11:14:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373250",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:37'></a>
Replying to [leif](#comment%3A35):
> Replying to [fbissey](#comment%3A34):
> > collision. I posted before you. I guess it must have steamed from me communicating my concern to Paul. It definitely wasn't there in 7.0rc and I don't think it was in 7.0 either. One less thing to worry about.
  
> 
> Well, until some linker bails out on that flag...  Or is libtool smart enough to remove it in case it isn't supported?
> 
Point. Most linkers discard unrecognised option without side effect, the problem is when it can be interpreted in a completely different way by the linker (yes I have a "funny" example of that - it involves AIX's linker). It would be better if the flag was tested for in configure.



---

archive/issue_comments_373251.json:
```json
{
    "body": "<a id='comment:38'></a>\nDid you already give it a try on MacOS X (recently)?",
    "created_at": "2016-08-03T11:17:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373251",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:38'></a>
Did you already give it a try on MacOS X (recently)?



---

archive/issue_comments_373252.json:
```json
{
    "body": "<a id='comment:39'></a>\nNo, and it will have to wait until morning now because it is my bed time. And I don't think upstream does regular check on OS X.",
    "created_at": "2016-08-03T11:31:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373252",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:39'></a>
No, and it will have to wait until morning now because it is my bed time. And I don't think upstream does regular check on OS X.



---

archive/issue_comments_373253.json:
```json
{
    "body": "<a id='comment:40'></a>\nWhat's weird is that despite\n\n```\n  --enable-shared[=PKGS]  build shared libraries [default=no]\n  --enable-static[=PKGS]  build static libraries [default=yes]\n```\n**and**\n\n```\n...\nchecking whether the gcc-6.1 linker (ld -m elf_x86_64) supports shared libraries... yes\nchecking dynamic linker characteristics... GNU/Linux ld.so\nchecking how to hardcode library paths into programs... immediate\nchecking whether stripping libraries is possible... yes\nchecking if libtool supports shared libraries... yes\nchecking whether to build shared libraries... no\nchecking whether to build static libraries... yes\n...\n```\nstill a *shared* library gets built.",
    "created_at": "2016-08-03T11:35:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373253",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:40'></a>
What's weird is that despite

```
  --enable-shared[=PKGS]  build shared libraries [default=no]
  --enable-static[=PKGS]  build static libraries [default=yes]
```
**and**

```
...
checking whether the gcc-6.1 linker (ld -m elf_x86_64) supports shared libraries... yes
checking dynamic linker characteristics... GNU/Linux ld.so
checking how to hardcode library paths into programs... immediate
checking whether stripping libraries is possible... yes
checking if libtool supports shared libraries... yes
checking whether to build shared libraries... no
checking whether to build static libraries... yes
...
```
still a *shared* library gets built.



---

archive/issue_comments_373254.json:
```json
{
    "body": "<a id='comment:41'></a>\nOk, at least within Sage, only a static library gets *installed*.",
    "created_at": "2016-08-03T11:39:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373254",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:41'></a>
Ok, at least within Sage, only a static library gets *installed*.



---

archive/issue_comments_373255.json:
```json
{
    "body": "<a id='comment:42'></a>\nReplying to [leif](#comment%3A41):\n> Ok, at least within Sage, only a static library gets *installed*.\n\n\nI personally don't think it is a good idea. Yes that's supposed to be better performance but if your going to mix it python module it will probably have to be compiled with `pic` which will remove part of your performance gain. Unless you have specialised hardware (embedded, BlueGene) the benefits are marginal in my opinion.",
    "created_at": "2016-08-03T21:44:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373255",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:42'></a>
Replying to [leif](#comment%3A41):
> Ok, at least within Sage, only a static library gets *installed*.


I personally don't think it is a good idea. Yes that's supposed to be better performance but if your going to mix it python module it will probably have to be compiled with `pic` which will remove part of your performance gain. Unless you have specialised hardware (embedded, BlueGene) the benefits are marginal in my opinion.



---

archive/issue_comments_373256.json:
```json
{
    "body": "<a id='comment:43'></a>\nReplying to [fbissey](#comment%3A42):\n> Replying to [leif](#comment%3A41):\n> > Ok, at least within Sage, only a static library gets *installed*.\n\n> \n> [...] if your going to mix it python module it will probably have to be compiled with `pic`\n\n\nWe of course enforce that in `spkg-install`. \n\n> which will remove part of your performance gain.\n\n\nNot necessarily, depends on the processor.  You need relative addressing, but not indirect function calls, and most symbols will get resolved at .so build time, not when loading the shared library. \n\n> Unless you have specialised hardware (embedded, BlueGene) the benefits are marginal in my opinion.\n\n\nHmmm, but having a static library included in the Python extension module (which of course is a shared library) prevents us from further headaches, too, IMHO. :-)",
    "created_at": "2016-08-03T21:56:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373256",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:43'></a>
Replying to [fbissey](#comment%3A42):
> Replying to [leif](#comment%3A41):
> > Ok, at least within Sage, only a static library gets *installed*.

> 
> [...] if your going to mix it python module it will probably have to be compiled with `pic`


We of course enforce that in `spkg-install`. 

> which will remove part of your performance gain.


Not necessarily, depends on the processor.  You need relative addressing, but not indirect function calls, and most symbols will get resolved at .so build time, not when loading the shared library. 

> Unless you have specialised hardware (embedded, BlueGene) the benefits are marginal in my opinion.


Hmmm, but having a static library included in the Python extension module (which of course is a shared library) prevents us from further headaches, too, IMHO. :-)



---

archive/issue_comments_373257.json:
```json
{
    "body": "<a id='comment:44'></a>\nOS X doesn't like this thing much\n\n```\n/bin/sh ./libtool  --tag=CC   --mode=link gcc  -g -march=native -g -O3  -fPIC  -version-info 1:0:0 -g -Wl,-znoexecstack  -L/Users/fbissey/build/sage-7.2.beta5/local/lib -Wl,-rpath,/Users/fbissey/build/sage-7.2.beta5/local/lib   -o libecm.la -rpath /Users/fbissey/build/sage-7.2.beta5/local/lib libecm_la-ecm.lo libecm_la-ecm2.lo libecm_la-pm1.lo libecm_la-pp1.lo libecm_la-getprime_r.lo libecm_la-listz.lo libecm_la-lucas.lo libecm_la-stage2.lo libecm_la-mpmod.lo libecm_la-mul_lo.lo libecm_la-polyeval.lo libecm_la-median.lo libecm_la-schoen_strass.lo libecm_la-ks-multiply.lo libecm_la-rho.lo libecm_la-bestd.lo libecm_la-auxlib.lo libecm_la-random.lo libecm_la-factor.lo libecm_la-sp.lo libecm_la-spv.lo libecm_la-spm.lo libecm_la-mpzspm.lo libecm_la-mpzspv.lo libecm_la-ntt_gfp.lo libecm_la-ecm_ntt.lo libecm_la-pm1fs2.lo libecm_la-sets_long.lo libecm_la-auxarith.lo libecm_la-batch.lo libecm_la-parametrizations.lo libecm_la-cudawrapper.lo aprtcle/libecm_la-mpz_aprcl.lo   ./x86_64/libmulredc.la  /Users/fbissey/build/sage-7.2.beta5/local/lib/libgmp.a -lm -lm -lm -lm -lm  \n\n*** Warning: Linking the shared library libecm.la against the\n*** static library /Users/fbissey/build/sage-7.2.beta5/local/lib/libgmp.a is not portable!\nlibtool: link: (cd .libs/libecm.lax/libmulredc.a && ar x \"/Users/fbissey/build/sage-7.2.beta5/local/var/tmp/sage/build/ecm-7.0.3/src/./x86_64/.libs/libmulredc.a\")\nlibtool: link: ar cru .libs/libecm.a /Users/fbissey/build/sage-7.2.beta5/local/lib/libgmp.a  libecm_la-ecm.o libecm_la-ecm2.o libecm_la-pm1.o libecm_la-pp1.o libecm_la-getprime_r.o libecm_la-listz.o libecm_la-lucas.o libecm_la-stage2.o libecm_la-mpmod.o libecm_la-mul_lo.o libecm_la-polyeval.o libecm_la-median.o libecm_la-schoen_strass.o libecm_la-ks-multiply.o libecm_la-rho.o libecm_la-bestd.o libecm_la-auxlib.o libecm_la-random.o libecm_la-factor.o libecm_la-sp.o libecm_la-spv.o libecm_la-spm.o libecm_la-mpzspm.o libecm_la-mpzspv.o libecm_la-ntt_gfp.o libecm_la-ecm_ntt.o libecm_la-pm1fs2.o libecm_la-sets_long.o libecm_la-auxarith.o libecm_la-batch.o libecm_la-parametrizations.o libecm_la-cudawrapper.o aprtcle/libecm_la-mpz_aprcl.o  .libs/libecm.lax/libmulredc.a/mulredc1.o .libs/libecm.lax/libmulredc.a/mulredc10.o .libs/libecm.lax/libmulredc.a/mulredc11.o .libs/libecm.lax/libmulredc.a/mulredc12.o .libs/libecm.lax/libmulredc.a/mulredc13.o .libs/libecm.lax/libmulredc.a/mulredc14.o .libs/libecm.lax/libmulredc.a/mulredc15.o .libs/libecm.lax/libmulredc.a/mulredc16.o .libs/libecm.lax/libmulredc.a/mulredc17.o .libs/libecm.lax/libmulredc.a/mulredc18.o .libs/libecm.lax/libmulredc.a/mulredc19.o .libs/libecm.lax/libmulredc.a/mulredc1_10.o .libs/libecm.lax/libmulredc.a/mulredc1_11.o .libs/libecm.lax/libmulredc.a/mulredc1_12.o .libs/libecm.lax/libmulredc.a/mulredc1_13.o .libs/libecm.lax/libmulredc.a/mulredc1_14.o .libs/libecm.lax/libmulredc.a/mulredc1_15.o .libs/libecm.lax/libmulredc.a/mulredc1_16.o .libs/libecm.lax/libmulredc.a/mulredc1_17.o .libs/libecm.lax/libmulredc.a/mulredc1_18.o .libs/libecm.lax/libmulredc.a/mulredc1_19.o .libs/libecm.lax/libmulredc.a/mulredc1_2.o .libs/libecm.lax/libmulredc.a/mulredc1_20.o .libs/libecm.lax/libmulredc.a/mulredc1_3.o .libs/libecm.lax/libmulredc.a/mulredc1_4.o .libs/libecm.lax/libmulredc.a/mulredc1_5.o .libs/libecm.lax/libmulredc.a/mulredc1_6.o .libs/libecm.lax/libmulredc.a/mulredc1_7.o .libs/libecm.lax/libmulredc.a/mulredc1_8.o .libs/libecm.lax/libmulredc.a/mulredc1_9.o .libs/libecm.lax/libmulredc.a/mulredc2.o .libs/libecm.lax/libmulredc.a/mulredc20.o .libs/libecm.lax/libmulredc.a/mulredc3.o .libs/libecm.lax/libmulredc.a/mulredc4.o .libs/libecm.lax/libmulredc.a/mulredc5.o .libs/libecm.lax/libmulredc.a/mulredc6.o .libs/libecm.lax/libmulredc.a/mulredc7.o .libs/libecm.lax/libmulredc.a/mulredc8.o .libs/libecm.lax/libmulredc.a/mulredc9.o \n/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/ranlib: file: .libs/libecm.a(libecm_la-cudawrapper.o) has no symbols\nlibtool: link: ranlib .libs/libecm.a\n/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/ranlib: file: .libs/libecm.a(libecm_la-cudawrapper.o) has no symbols\nlibtool: link: rm -fr .libs/libecm.lax\nlibtool: link: ( cd \".libs\" && rm -f \"libecm.la\" && ln -s \"../libecm.la\" \"libecm.la\" )\ngcc -DHAVE_CONFIG_H -I.  -DOUTSIDE_LIBECM -I/Users/fbissey/build/sage-7.2.beta5/local/include -I/Users/fbissey/build/sage-7.2.beta5/local/include  -g -march=native -g -O3  -fPIC -MT ecm-auxi.o -MD -MP -MF .deps/ecm-auxi.Tpo -c -o ecm-auxi.o `test -f 'auxi.c' || echo './'`auxi.c\nmv -f .deps/ecm-auxi.Tpo .deps/ecm-auxi.Po\ngcc -DHAVE_CONFIG_H -I.  -DOUTSIDE_LIBECM -I/Users/fbissey/build/sage-7.2.beta5/local/include -I/Users/fbissey/build/sage-7.2.beta5/local/include  -g -march=native -g -O3  -fPIC -MT ecm-b1_ainc.o -MD -MP -MF .deps/ecm-b1_ainc.Tpo -c -o ecm-b1_ainc.o `test -f 'b1_ainc.c' || echo './'`b1_ainc.c\nmv -f .deps/ecm-b1_ainc.Tpo .deps/ecm-b1_ainc.Po\ngcc -DHAVE_CONFIG_H -I.  -DOUTSIDE_LIBECM -I/Users/fbissey/build/sage-7.2.beta5/local/include -I/Users/fbissey/build/sage-7.2.beta5/local/include  -g -march=native -g -O3  -fPIC -MT ecm-candi.o -MD -MP -MF .deps/ecm-candi.Tpo -c -o ecm-candi.o `test -f 'candi.c' || echo './'`candi.c\nmv -f .deps/ecm-candi.Tpo .deps/ecm-candi.Po\ngcc -DHAVE_CONFIG_H -I.  -DOUTSIDE_LIBECM -I/Users/fbissey/build/sage-7.2.beta5/local/include -I/Users/fbissey/build/sage-7.2.beta5/local/include  -g -march=native -g -O3  -fPIC -MT ecm-eval.o -MD -MP -MF .deps/ecm-eval.Tpo -c -o ecm-eval.o `test -f 'eval.c' || echo './'`eval.c\nmv -f .deps/ecm-eval.Tpo .deps/ecm-eval.Po\ngcc -DHAVE_CONFIG_H -I.  -DOUTSIDE_LIBECM -I/Users/fbissey/build/sage-7.2.beta5/local/include -I/Users/fbissey/build/sage-7.2.beta5/local/include  -g -march=native -g -O3  -fPIC -MT ecm-main.o -MD -MP -MF .deps/ecm-main.Tpo -c -o ecm-main.o `test -f 'main.c' || echo './'`main.c\nmv -f .deps/ecm-main.Tpo .deps/ecm-main.Po\ngcc -DHAVE_CONFIG_H -I.  -DOUTSIDE_LIBECM -I/Users/fbissey/build/sage-7.2.beta5/local/include -I/Users/fbissey/build/sage-7.2.beta5/local/include  -g -march=native -g -O3  -fPIC -MT ecm-resume.o -MD -MP -MF .deps/ecm-resume.Tpo -c -o ecm-resume.o `test -f 'resume.c' || echo './'`resume.c\nmv -f .deps/ecm-resume.Tpo .deps/ecm-resume.Po\ngcc -DHAVE_CONFIG_H -I.  -DOUTSIDE_LIBECM -I/Users/fbissey/build/sage-7.2.beta5/local/include -I/Users/fbissey/build/sage-7.2.beta5/local/include  -g -march=native -g -O3  -fPIC -MT ecm-getprime_r.o -MD -MP -MF .deps/ecm-getprime_r.Tpo -c -o ecm-getprime_r.o `test -f 'getprime_r.c' || echo './'`getprime_r.c\nmv -f .deps/ecm-getprime_r.Tpo .deps/ecm-getprime_r.Po\ngcc -DHAVE_CONFIG_H -I.  -DOUTSIDE_LIBECM -I/Users/fbissey/build/sage-7.2.beta5/local/include -I/Users/fbissey/build/sage-7.2.beta5/local/include  -g -march=native -g -O3  -fPIC -MT aprtcle/ecm-mpz_aprcl.o -MD -MP -MF aprtcle/.deps/ecm-mpz_aprcl.Tpo -c -o aprtcle/ecm-mpz_aprcl.o `test -f 'aprtcle/mpz_aprcl.c' || echo './'`aprtcle/mpz_aprcl.c\nmv -f aprtcle/.deps/ecm-mpz_aprcl.Tpo aprtcle/.deps/ecm-mpz_aprcl.Po\ngcc -DHAVE_CONFIG_H -I.  -DOUTSIDE_LIBECM -I/Users/fbissey/build/sage-7.2.beta5/local/include -I/Users/fbissey/build/sage-7.2.beta5/local/include  -g -march=native -g -O3  -fPIC -MT ecm-memusage.o -MD -MP -MF .deps/ecm-memusage.Tpo -c -o ecm-memusage.o `test -f 'memusage.c' || echo './'`memusage.c\nmv -f .deps/ecm-memusage.Tpo .deps/ecm-memusage.Po\n/bin/sh ./libtool  --tag=CC   --mode=link gcc  -g -march=native -g -O3  -fPIC  -L/Users/fbissey/build/sage-7.2.beta5/local/lib -Wl,-rpath,/Users/fbissey/build/sage-7.2.beta5/local/lib   -o ecm ecm-auxi.o ecm-b1_ainc.o ecm-candi.o ecm-eval.o ecm-main.o ecm-resume.o ecm-getprime_r.o aprtcle/ecm-mpz_aprcl.o ecm-memusage.o libecm.la /Users/fbissey/build/sage-7.2.beta5/local/lib/libgmp.a -lm -lm -lm -lm -lm  \nlibtool: link: gcc -g -march=native -g -O3 -fPIC -Wl,-rpath -Wl,/Users/fbissey/build/sage-7.2.beta5/local/lib -o ecm ecm-auxi.o ecm-b1_ainc.o ecm-candi.o ecm-eval.o ecm-main.o ecm-resume.o ecm-getprime_r.o aprtcle/ecm-mpz_aprcl.o ecm-memusage.o  -L/Users/fbissey/build/sage-7.2.beta5/local/lib ./.libs/libecm.a /Users/fbissey/build/sage-7.2.beta5/local/lib/libgmp.a -lm\nld: warning: ignoring file ./.libs/libecm.a, file was built for archive which is not the architecture being linked (x86_64): ./.libs/libecm.a\nUndefined symbols for architecture x86_64:\n  \"___ecm_cputime\", referenced from:\n      _main in ecm-main.o\n  \"_ecm_clear\", referenced from:\n      _main in ecm-main.o\n  \"_ecm_factor\", referenced from:\n      _main in ecm-main.o\n  \"_ecm_init\", referenced from:\n      _main in ecm-main.o\n  \"_ecm_version\", referenced from:\n      _main in ecm-main.o\nld: symbol(s) not found for architecture x86_64\ncollect2: error: ld returned 1 exit status\nmake[2]: *** [ecm] Error 1\nmake[1]: *** [all-recursive] Error 1\nmake: *** [all] Error 2\nError building GMP-ECM.\n```\nIt is not obvious that `znoexecstack` is at fault but I cannot rule it out.\n\nI am otherwise in the camp that says dynamic linking is actually the lesser trouble :)",
    "created_at": "2016-08-03T22:00:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373257",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:44'></a>
OS X doesn't like this thing much

```
/bin/sh ./libtool  --tag=CC   --mode=link gcc  -g -march=native -g -O3  -fPIC  -version-info 1:0:0 -g -Wl,-znoexecstack  -L/Users/fbissey/build/sage-7.2.beta5/local/lib -Wl,-rpath,/Users/fbissey/build/sage-7.2.beta5/local/lib   -o libecm.la -rpath /Users/fbissey/build/sage-7.2.beta5/local/lib libecm_la-ecm.lo libecm_la-ecm2.lo libecm_la-pm1.lo libecm_la-pp1.lo libecm_la-getprime_r.lo libecm_la-listz.lo libecm_la-lucas.lo libecm_la-stage2.lo libecm_la-mpmod.lo libecm_la-mul_lo.lo libecm_la-polyeval.lo libecm_la-median.lo libecm_la-schoen_strass.lo libecm_la-ks-multiply.lo libecm_la-rho.lo libecm_la-bestd.lo libecm_la-auxlib.lo libecm_la-random.lo libecm_la-factor.lo libecm_la-sp.lo libecm_la-spv.lo libecm_la-spm.lo libecm_la-mpzspm.lo libecm_la-mpzspv.lo libecm_la-ntt_gfp.lo libecm_la-ecm_ntt.lo libecm_la-pm1fs2.lo libecm_la-sets_long.lo libecm_la-auxarith.lo libecm_la-batch.lo libecm_la-parametrizations.lo libecm_la-cudawrapper.lo aprtcle/libecm_la-mpz_aprcl.lo   ./x86_64/libmulredc.la  /Users/fbissey/build/sage-7.2.beta5/local/lib/libgmp.a -lm -lm -lm -lm -lm  

*** Warning: Linking the shared library libecm.la against the
*** static library /Users/fbissey/build/sage-7.2.beta5/local/lib/libgmp.a is not portable!
libtool: link: (cd .libs/libecm.lax/libmulredc.a && ar x "/Users/fbissey/build/sage-7.2.beta5/local/var/tmp/sage/build/ecm-7.0.3/src/./x86_64/.libs/libmulredc.a")
libtool: link: ar cru .libs/libecm.a /Users/fbissey/build/sage-7.2.beta5/local/lib/libgmp.a  libecm_la-ecm.o libecm_la-ecm2.o libecm_la-pm1.o libecm_la-pp1.o libecm_la-getprime_r.o libecm_la-listz.o libecm_la-lucas.o libecm_la-stage2.o libecm_la-mpmod.o libecm_la-mul_lo.o libecm_la-polyeval.o libecm_la-median.o libecm_la-schoen_strass.o libecm_la-ks-multiply.o libecm_la-rho.o libecm_la-bestd.o libecm_la-auxlib.o libecm_la-random.o libecm_la-factor.o libecm_la-sp.o libecm_la-spv.o libecm_la-spm.o libecm_la-mpzspm.o libecm_la-mpzspv.o libecm_la-ntt_gfp.o libecm_la-ecm_ntt.o libecm_la-pm1fs2.o libecm_la-sets_long.o libecm_la-auxarith.o libecm_la-batch.o libecm_la-parametrizations.o libecm_la-cudawrapper.o aprtcle/libecm_la-mpz_aprcl.o  .libs/libecm.lax/libmulredc.a/mulredc1.o .libs/libecm.lax/libmulredc.a/mulredc10.o .libs/libecm.lax/libmulredc.a/mulredc11.o .libs/libecm.lax/libmulredc.a/mulredc12.o .libs/libecm.lax/libmulredc.a/mulredc13.o .libs/libecm.lax/libmulredc.a/mulredc14.o .libs/libecm.lax/libmulredc.a/mulredc15.o .libs/libecm.lax/libmulredc.a/mulredc16.o .libs/libecm.lax/libmulredc.a/mulredc17.o .libs/libecm.lax/libmulredc.a/mulredc18.o .libs/libecm.lax/libmulredc.a/mulredc19.o .libs/libecm.lax/libmulredc.a/mulredc1_10.o .libs/libecm.lax/libmulredc.a/mulredc1_11.o .libs/libecm.lax/libmulredc.a/mulredc1_12.o .libs/libecm.lax/libmulredc.a/mulredc1_13.o .libs/libecm.lax/libmulredc.a/mulredc1_14.o .libs/libecm.lax/libmulredc.a/mulredc1_15.o .libs/libecm.lax/libmulredc.a/mulredc1_16.o .libs/libecm.lax/libmulredc.a/mulredc1_17.o .libs/libecm.lax/libmulredc.a/mulredc1_18.o .libs/libecm.lax/libmulredc.a/mulredc1_19.o .libs/libecm.lax/libmulredc.a/mulredc1_2.o .libs/libecm.lax/libmulredc.a/mulredc1_20.o .libs/libecm.lax/libmulredc.a/mulredc1_3.o .libs/libecm.lax/libmulredc.a/mulredc1_4.o .libs/libecm.lax/libmulredc.a/mulredc1_5.o .libs/libecm.lax/libmulredc.a/mulredc1_6.o .libs/libecm.lax/libmulredc.a/mulredc1_7.o .libs/libecm.lax/libmulredc.a/mulredc1_8.o .libs/libecm.lax/libmulredc.a/mulredc1_9.o .libs/libecm.lax/libmulredc.a/mulredc2.o .libs/libecm.lax/libmulredc.a/mulredc20.o .libs/libecm.lax/libmulredc.a/mulredc3.o .libs/libecm.lax/libmulredc.a/mulredc4.o .libs/libecm.lax/libmulredc.a/mulredc5.o .libs/libecm.lax/libmulredc.a/mulredc6.o .libs/libecm.lax/libmulredc.a/mulredc7.o .libs/libecm.lax/libmulredc.a/mulredc8.o .libs/libecm.lax/libmulredc.a/mulredc9.o 
/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/ranlib: file: .libs/libecm.a(libecm_la-cudawrapper.o) has no symbols
libtool: link: ranlib .libs/libecm.a
/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/ranlib: file: .libs/libecm.a(libecm_la-cudawrapper.o) has no symbols
libtool: link: rm -fr .libs/libecm.lax
libtool: link: ( cd ".libs" && rm -f "libecm.la" && ln -s "../libecm.la" "libecm.la" )
gcc -DHAVE_CONFIG_H -I.  -DOUTSIDE_LIBECM -I/Users/fbissey/build/sage-7.2.beta5/local/include -I/Users/fbissey/build/sage-7.2.beta5/local/include  -g -march=native -g -O3  -fPIC -MT ecm-auxi.o -MD -MP -MF .deps/ecm-auxi.Tpo -c -o ecm-auxi.o `test -f 'auxi.c' || echo './'`auxi.c
mv -f .deps/ecm-auxi.Tpo .deps/ecm-auxi.Po
gcc -DHAVE_CONFIG_H -I.  -DOUTSIDE_LIBECM -I/Users/fbissey/build/sage-7.2.beta5/local/include -I/Users/fbissey/build/sage-7.2.beta5/local/include  -g -march=native -g -O3  -fPIC -MT ecm-b1_ainc.o -MD -MP -MF .deps/ecm-b1_ainc.Tpo -c -o ecm-b1_ainc.o `test -f 'b1_ainc.c' || echo './'`b1_ainc.c
mv -f .deps/ecm-b1_ainc.Tpo .deps/ecm-b1_ainc.Po
gcc -DHAVE_CONFIG_H -I.  -DOUTSIDE_LIBECM -I/Users/fbissey/build/sage-7.2.beta5/local/include -I/Users/fbissey/build/sage-7.2.beta5/local/include  -g -march=native -g -O3  -fPIC -MT ecm-candi.o -MD -MP -MF .deps/ecm-candi.Tpo -c -o ecm-candi.o `test -f 'candi.c' || echo './'`candi.c
mv -f .deps/ecm-candi.Tpo .deps/ecm-candi.Po
gcc -DHAVE_CONFIG_H -I.  -DOUTSIDE_LIBECM -I/Users/fbissey/build/sage-7.2.beta5/local/include -I/Users/fbissey/build/sage-7.2.beta5/local/include  -g -march=native -g -O3  -fPIC -MT ecm-eval.o -MD -MP -MF .deps/ecm-eval.Tpo -c -o ecm-eval.o `test -f 'eval.c' || echo './'`eval.c
mv -f .deps/ecm-eval.Tpo .deps/ecm-eval.Po
gcc -DHAVE_CONFIG_H -I.  -DOUTSIDE_LIBECM -I/Users/fbissey/build/sage-7.2.beta5/local/include -I/Users/fbissey/build/sage-7.2.beta5/local/include  -g -march=native -g -O3  -fPIC -MT ecm-main.o -MD -MP -MF .deps/ecm-main.Tpo -c -o ecm-main.o `test -f 'main.c' || echo './'`main.c
mv -f .deps/ecm-main.Tpo .deps/ecm-main.Po
gcc -DHAVE_CONFIG_H -I.  -DOUTSIDE_LIBECM -I/Users/fbissey/build/sage-7.2.beta5/local/include -I/Users/fbissey/build/sage-7.2.beta5/local/include  -g -march=native -g -O3  -fPIC -MT ecm-resume.o -MD -MP -MF .deps/ecm-resume.Tpo -c -o ecm-resume.o `test -f 'resume.c' || echo './'`resume.c
mv -f .deps/ecm-resume.Tpo .deps/ecm-resume.Po
gcc -DHAVE_CONFIG_H -I.  -DOUTSIDE_LIBECM -I/Users/fbissey/build/sage-7.2.beta5/local/include -I/Users/fbissey/build/sage-7.2.beta5/local/include  -g -march=native -g -O3  -fPIC -MT ecm-getprime_r.o -MD -MP -MF .deps/ecm-getprime_r.Tpo -c -o ecm-getprime_r.o `test -f 'getprime_r.c' || echo './'`getprime_r.c
mv -f .deps/ecm-getprime_r.Tpo .deps/ecm-getprime_r.Po
gcc -DHAVE_CONFIG_H -I.  -DOUTSIDE_LIBECM -I/Users/fbissey/build/sage-7.2.beta5/local/include -I/Users/fbissey/build/sage-7.2.beta5/local/include  -g -march=native -g -O3  -fPIC -MT aprtcle/ecm-mpz_aprcl.o -MD -MP -MF aprtcle/.deps/ecm-mpz_aprcl.Tpo -c -o aprtcle/ecm-mpz_aprcl.o `test -f 'aprtcle/mpz_aprcl.c' || echo './'`aprtcle/mpz_aprcl.c
mv -f aprtcle/.deps/ecm-mpz_aprcl.Tpo aprtcle/.deps/ecm-mpz_aprcl.Po
gcc -DHAVE_CONFIG_H -I.  -DOUTSIDE_LIBECM -I/Users/fbissey/build/sage-7.2.beta5/local/include -I/Users/fbissey/build/sage-7.2.beta5/local/include  -g -march=native -g -O3  -fPIC -MT ecm-memusage.o -MD -MP -MF .deps/ecm-memusage.Tpo -c -o ecm-memusage.o `test -f 'memusage.c' || echo './'`memusage.c
mv -f .deps/ecm-memusage.Tpo .deps/ecm-memusage.Po
/bin/sh ./libtool  --tag=CC   --mode=link gcc  -g -march=native -g -O3  -fPIC  -L/Users/fbissey/build/sage-7.2.beta5/local/lib -Wl,-rpath,/Users/fbissey/build/sage-7.2.beta5/local/lib   -o ecm ecm-auxi.o ecm-b1_ainc.o ecm-candi.o ecm-eval.o ecm-main.o ecm-resume.o ecm-getprime_r.o aprtcle/ecm-mpz_aprcl.o ecm-memusage.o libecm.la /Users/fbissey/build/sage-7.2.beta5/local/lib/libgmp.a -lm -lm -lm -lm -lm  
libtool: link: gcc -g -march=native -g -O3 -fPIC -Wl,-rpath -Wl,/Users/fbissey/build/sage-7.2.beta5/local/lib -o ecm ecm-auxi.o ecm-b1_ainc.o ecm-candi.o ecm-eval.o ecm-main.o ecm-resume.o ecm-getprime_r.o aprtcle/ecm-mpz_aprcl.o ecm-memusage.o  -L/Users/fbissey/build/sage-7.2.beta5/local/lib ./.libs/libecm.a /Users/fbissey/build/sage-7.2.beta5/local/lib/libgmp.a -lm
ld: warning: ignoring file ./.libs/libecm.a, file was built for archive which is not the architecture being linked (x86_64): ./.libs/libecm.a
Undefined symbols for architecture x86_64:
  "___ecm_cputime", referenced from:
      _main in ecm-main.o
  "_ecm_clear", referenced from:
      _main in ecm-main.o
  "_ecm_factor", referenced from:
      _main in ecm-main.o
  "_ecm_init", referenced from:
      _main in ecm-main.o
  "_ecm_version", referenced from:
      _main in ecm-main.o
ld: symbol(s) not found for architecture x86_64
collect2: error: ld returned 1 exit status
make[2]: *** [ecm] Error 1
make[1]: *** [all-recursive] Error 1
make: *** [all] Error 2
Error building GMP-ECM.
```
It is not obvious that `znoexecstack` is at fault but I cannot rule it out.

I am otherwise in the camp that says dynamic linking is actually the lesser trouble :)



---

archive/issue_comments_373258.json:
```json
{
    "body": "<a id='comment:45'></a>\nP.S.: Actually `libgmp.a` should get linked into the Python extension module as well, but that's currently not the case.",
    "created_at": "2016-08-03T22:04:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373258",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:45'></a>
P.S.: Actually `libgmp.a` should get linked into the Python extension module as well, but that's currently not the case.



---

archive/issue_comments_373259.json:
```json
{
    "body": "<a id='comment:46'></a>\nInteresting `znoexecstack` is not a problem building static - it is probably just ignored but build shared with `ECM_CONFIGURE=\"--enable-shared --disable-static` \n\n```\nlibtool: link: gcc -dynamiclib -Wl,-undefined -Wl,dynamic_lookup -o .libs/libecm.1.dylib  .libs/libecm_la-ecm.o .libs/libecm_la-ecm2.o .libs/libecm_la-pm1.o .libs/libecm_la-pp1.o .libs/libecm_la-getprime_r.o .libs/libecm_la-listz.o .libs/libecm_la-lucas.o .libs/libecm_la-stage2.o .libs/libecm_la-mpmod.o .libs/libecm_la-mul_lo.o .libs/libecm_la-polyeval.o .libs/libecm_la-median.o .libs/libecm_la-schoen_strass.o .libs/libecm_la-ks-multiply.o .libs/libecm_la-rho.o .libs/libecm_la-bestd.o .libs/libecm_la-auxlib.o .libs/libecm_la-random.o .libs/libecm_la-factor.o .libs/libecm_la-sp.o .libs/libecm_la-spv.o .libs/libecm_la-spm.o .libs/libecm_la-mpzspm.o .libs/libecm_la-mpzspv.o .libs/libecm_la-ntt_gfp.o .libs/libecm_la-ecm_ntt.o .libs/libecm_la-pm1fs2.o .libs/libecm_la-sets_long.o .libs/libecm_la-auxarith.o .libs/libecm_la-batch.o .libs/libecm_la-parametrizations.o .libs/libecm_la-cudawrapper.o aprtcle/.libs/libecm_la-mpz_aprcl.o   -Wl,-force_load,./x86_64/.libs/libmulredc.a  -L/Users/fbissey/build/sage-7.2.beta5/local/lib -lgmp -lm  -g -march=native -g -O3 -g -Wl,-znoexecstack -Wl,-rpath -Wl,/Users/fbissey/build/sage-7.2.beta5/local/lib   -install_name  /Users/fbissey/build/sage-7.2.beta5/local/lib/libecm.1.dylib -compatibility_version 2 -current_version 2.0 -Wl,-single_module\nld: unknown option: -znoexecstack\ncollect2: error: ld returned 1 exit status\n```\nAnd that definitely kills the linking. So we will need to remove it from upstream sources.\n\nYes once you link static stuff you need to provide all the bits (dependencies) since static libraries are dumb objects.",
    "created_at": "2016-08-03T22:08:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373259",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:46'></a>
Interesting `znoexecstack` is not a problem building static - it is probably just ignored but build shared with `ECM_CONFIGURE="--enable-shared --disable-static` 

```
libtool: link: gcc -dynamiclib -Wl,-undefined -Wl,dynamic_lookup -o .libs/libecm.1.dylib  .libs/libecm_la-ecm.o .libs/libecm_la-ecm2.o .libs/libecm_la-pm1.o .libs/libecm_la-pp1.o .libs/libecm_la-getprime_r.o .libs/libecm_la-listz.o .libs/libecm_la-lucas.o .libs/libecm_la-stage2.o .libs/libecm_la-mpmod.o .libs/libecm_la-mul_lo.o .libs/libecm_la-polyeval.o .libs/libecm_la-median.o .libs/libecm_la-schoen_strass.o .libs/libecm_la-ks-multiply.o .libs/libecm_la-rho.o .libs/libecm_la-bestd.o .libs/libecm_la-auxlib.o .libs/libecm_la-random.o .libs/libecm_la-factor.o .libs/libecm_la-sp.o .libs/libecm_la-spv.o .libs/libecm_la-spm.o .libs/libecm_la-mpzspm.o .libs/libecm_la-mpzspv.o .libs/libecm_la-ntt_gfp.o .libs/libecm_la-ecm_ntt.o .libs/libecm_la-pm1fs2.o .libs/libecm_la-sets_long.o .libs/libecm_la-auxarith.o .libs/libecm_la-batch.o .libs/libecm_la-parametrizations.o .libs/libecm_la-cudawrapper.o aprtcle/.libs/libecm_la-mpz_aprcl.o   -Wl,-force_load,./x86_64/.libs/libmulredc.a  -L/Users/fbissey/build/sage-7.2.beta5/local/lib -lgmp -lm  -g -march=native -g -O3 -g -Wl,-znoexecstack -Wl,-rpath -Wl,/Users/fbissey/build/sage-7.2.beta5/local/lib   -install_name  /Users/fbissey/build/sage-7.2.beta5/local/lib/libecm.1.dylib -compatibility_version 2 -current_version 2.0 -Wl,-single_module
ld: unknown option: -znoexecstack
collect2: error: ld returned 1 exit status
```
And that definitely kills the linking. So we will need to remove it from upstream sources.

Yes once you link static stuff you need to provide all the bits (dependencies) since static libraries are dumb objects.



---

archive/issue_comments_373260.json:
```json
{
    "body": "<a id='comment:47'></a>\nPresumably unrelated, but 7.2.beta5?\n\nWhat \"architecture\" in Apple speak do the object files in libecm.a have?",
    "created_at": "2016-08-03T22:10:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373260",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:47'></a>
Presumably unrelated, but 7.2.beta5?

What "architecture" in Apple speak do the object files in libecm.a have?



---

archive/issue_comments_373261.json:
```json
{
    "body": "<a id='comment:48'></a>\nReplying to [leif](#comment%3A47):\n> Presumably unrelated, but 7.2.beta5?\n> \n\n\nThat's just the tarball I initially downloaded, but I pulled the latest develop and then your branch. I fully rebuild not so long ago.\n\n> What \"architecture\" in Apple speak do the object files in libecm.a have?\n\n\nGood question, I'll see if I can figure it out.",
    "created_at": "2016-08-03T22:14:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373261",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:48'></a>
Replying to [leif](#comment%3A47):
> Presumably unrelated, but 7.2.beta5?
> 


That's just the tarball I initially downloaded, but I pulled the latest develop and then your branch. I fully rebuild not so long ago.

> What "architecture" in Apple speak do the object files in libecm.a have?


Good question, I'll see if I can figure it out.



---

archive/issue_comments_373262.json:
```json
{
    "body": "<a id='comment:49'></a>\nReplying to [fbissey](#comment%3A46):\n> Interesting `znoexecstack` is not a problem building static - it is probably just ignored\n\n\nIt's not used at all when building static stuff, or more precisely, only when building `libecm.la`.\n\n\\\\\n\n> but build shared with `ECM_CONFIGURE=\"--enable-shared --disable-static`\n> \n> ```\n> ld: unknown option: -znoexecstack\n> collect2: error: ld returned 1 exit status\n> ```\n> And that definitely kills the linking.\n\n\nI told you so... ;-)\n\n\\\\\n\n> So we will need to remove it from upstream sources.\n\n\nWell, patch a comma into it.  (It's in `Makefile.am` and hence also in what's built from it.)",
    "created_at": "2016-08-03T22:17:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373262",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:49'></a>
Replying to [fbissey](#comment%3A46):
> Interesting `znoexecstack` is not a problem building static - it is probably just ignored


It's not used at all when building static stuff, or more precisely, only when building `libecm.la`.

\\

> but build shared with `ECM_CONFIGURE="--enable-shared --disable-static`
> 
> ```
> ld: unknown option: -znoexecstack
> collect2: error: ld returned 1 exit status
> ```
> And that definitely kills the linking.


I told you so... ;-)

\\

> So we will need to remove it from upstream sources.


Well, patch a comma into it.  (It's in `Makefile.am` and hence also in what's built from it.)



---

archive/issue_comments_373263.json:
```json
{
    "body": "<a id='comment:50'></a>\nReplying to [leif](#comment%3A49):\n> Replying to [fbissey](#comment%3A46):\n> > \n> > ```\n> > ld: unknown option: -znoexecstack\n> > collect2: error: ld returned 1 exit status\n\n> Well, patch a comma into it.  (It's in `Makefile.am` and hence also in what's built from it.)\n\nThat is, in the ''source tarball'' only one instance in the top-level `Makefile.in`.\n\nI wouldn't even use `patch` for that... ;-)",
    "created_at": "2016-08-03T22:28:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373263",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:50'></a>
Replying to [leif](#comment%3A49):
> Replying to [fbissey](#comment%3A46):
> > 
> > ```
> > ld: unknown option: -znoexecstack
> > collect2: error: ld returned 1 exit status

> Well, patch a comma into it.  (It's in `Makefile.am` and hence also in what's built from it.)

That is, in the ''source tarball'' only one instance in the top-level `Makefile.in`.

I wouldn't even use `patch` for that... ;-)



---

archive/issue_comments_373264.json:
```json
{
    "body": "<a id='comment:51'></a>\nBut I'm really in favour of submitting something upstream that in `configure` adds `-Wa,--noexecstack` to `CCASFLAGS` when supported (or maybe `-Wl,-z,noexecstack` to some `*LDFLAGS`).",
    "created_at": "2016-08-03T22:33:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373264",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:51'></a>
But I'm really in favour of submitting something upstream that in `configure` adds `-Wa,--noexecstack` to `CCASFLAGS` when supported (or maybe `-Wl,-z,noexecstack` to some `*LDFLAGS`).



---

archive/issue_comments_373265.json:
```json
{
    "body": "<a id='comment:52'></a>\nReplying to [leif](#comment%3A50):\n> Replying to [leif](#comment%3A49):\n> > Replying to [fbissey](#comment%3A46):\n> > > \n> > > ```\n> > > ld: unknown option: -znoexecstack\n> > > collect2: error: ld returned 1 exit status\n\n> > Well, patch a comma into it.  (It's in `Makefile.am` and hence also in what's built from it.)\n> \n> That is, in the ''source tarball'' only one instance in the top-level `Makefile.in`.\n> \n> I wouldn't even use `patch` for that... ;-)\n\nMay be you wouldn't. But in terms of sage, I would do a `spkg-src`. You can only be that dirty in a big collaborative project of that kind for so long. That kind of stuff just doesn't scale and hurt you in the long term.\n\nIn my opinion the whole `spkg-install` is overdone. Just let the build system do its job unless you want to produce a binary.\n\n\n+1 for a report upstream.",
    "created_at": "2016-08-03T22:34:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373265",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:52'></a>
Replying to [leif](#comment%3A50):
> Replying to [leif](#comment%3A49):
> > Replying to [fbissey](#comment%3A46):
> > > 
> > > ```
> > > ld: unknown option: -znoexecstack
> > > collect2: error: ld returned 1 exit status

> > Well, patch a comma into it.  (It's in `Makefile.am` and hence also in what's built from it.)
> 
> That is, in the ''source tarball'' only one instance in the top-level `Makefile.in`.
> 
> I wouldn't even use `patch` for that... ;-)

May be you wouldn't. But in terms of sage, I would do a `spkg-src`. You can only be that dirty in a big collaborative project of that kind for so long. That kind of stuff just doesn't scale and hurt you in the long term.

In my opinion the whole `spkg-install` is overdone. Just let the build system do its job unless you want to produce a binary.


+1 for a report upstream.



---

archive/issue_comments_373266.json:
```json
{
    "body": "<a id='comment:53'></a>\nIt's just always a headache to patch autotools files, and `spkg-src` is IMHO not a good idea unless you pull some svn version (as opposed to a released tarball), or really remove loads of unnecessary files in order to keep the tarball small.",
    "created_at": "2016-08-03T22:40:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373266",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:53'></a>
It's just always a headache to patch autotools files, and `spkg-src` is IMHO not a good idea unless you pull some svn version (as opposed to a released tarball), or really remove loads of unnecessary files in order to keep the tarball small.



---

archive/issue_comments_373267.json:
```json
{
    "body": "<a id='comment:54'></a>\n(Sage's \"build system\" doesn't yet support upstream tarball URLs though, and the \"design\" of for example `checksums.ini` is ... -- can't say that here.)",
    "created_at": "2016-08-03T22:45:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373267",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:54'></a>
(Sage's "build system" doesn't yet support upstream tarball URLs though, and the "design" of for example `checksums.ini` is ... -- can't say that here.)



---

archive/issue_comments_373268.json:
```json
{
    "body": "<a id='comment:55'></a>\nNo comment. I am the sage-on-gentoo maintainer - anything I say on the matter is kind of political.\n\nBack to our little problem on OS X. It looks like it is something done in `spkg-install`, going to a sage shell and the build location I just do \n\n```\nmake distclean\n./configure # by default only build static\nmake\n```\nis successful and \n\n```\n(sage-sh) fbissey@Mirage:src$ make check\nMaking check in x86_64\nmake[1]: Nothing to be done for `check'.\nmake  ecm \\\n\t  test.pp1 test.pm1 test.ecm \nmake[2]: `ecm' is up to date.\nmake[2]: Nothing to be done for `test.pp1'.\nmake[2]: Nothing to be done for `test.pm1'.\nmake[2]: Nothing to be done for `test.ecm'.\nmake  check-TESTS\nPASS: test.pp1\nPASS: test.pm1\nPASS: test.ecm\n============================================================================\nTestsuite summary for ecm 7.0.3\n============================================================================\n# TOTAL: 3\n# PASS:  3\n# SKIP:  0\n# XFAIL: 0\n# FAIL:  0\n# XPASS: 0\n# ERROR: 0\n============================================================================\n```\nso it is definitely the configuration/environment from `spkg-install`, the configuration picked up sage's gcc as the compiler and sage's mpir as gmp without a hitch and assembly code has been used.",
    "created_at": "2016-08-03T22:58:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373268",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:55'></a>
No comment. I am the sage-on-gentoo maintainer - anything I say on the matter is kind of political.

Back to our little problem on OS X. It looks like it is something done in `spkg-install`, going to a sage shell and the build location I just do 

```
make distclean
./configure # by default only build static
make
```
is successful and 

```
(sage-sh) fbissey@Mirage:src$ make check
Making check in x86_64
make[1]: Nothing to be done for `check'.
make  ecm \
	  test.pp1 test.pm1 test.ecm 
make[2]: `ecm' is up to date.
make[2]: Nothing to be done for `test.pp1'.
make[2]: Nothing to be done for `test.pm1'.
make[2]: Nothing to be done for `test.ecm'.
make  check-TESTS
PASS: test.pp1
PASS: test.pm1
PASS: test.ecm
============================================================================
Testsuite summary for ecm 7.0.3
============================================================================
# TOTAL: 3
# PASS:  3
# SKIP:  0
# XFAIL: 0
# FAIL:  0
# XPASS: 0
# ERROR: 0
============================================================================
```
so it is definitely the configuration/environment from `spkg-install`, the configuration picked up sage's gcc as the compiler and sage's mpir as gmp without a hitch and assembly code has been used.



---

archive/issue_comments_373269.json:
```json
{
    "body": "<a id='comment:56'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6741ee0e6e3d3570157fb453c54bcde586bffea8\">6741ee0</a></td><td><code>GMP-ECM: #20385: Add temporary patch for '-Wl,znoexecstack' [sic] (Makefile.{am,in})</code></td></tr></table>\n",
    "created_at": "2016-08-03T23:26:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373269",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:56'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6741ee0e6e3d3570157fb453c54bcde586bffea8">6741ee0</a></td><td><code>GMP-ECM: #20385: Add temporary patch for '-Wl,znoexecstack' [sic] (Makefile.{am,in})</code></td></tr></table>




---

archive/issue_comments_373270.json:
```json
{
    "body": "**Changing commit** from \"[0affd290f491cf624f15fec080f3b349bd07477c](https://github.com/sagemath/sagetrac-mirror/commit/0affd290f491cf624f15fec080f3b349bd07477c)\" to \"[6741ee0e6e3d3570157fb453c54bcde586bffea8](https://github.com/sagemath/sagetrac-mirror/commit/6741ee0e6e3d3570157fb453c54bcde586bffea8)\".",
    "created_at": "2016-08-03T23:26:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373270",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[0affd290f491cf624f15fec080f3b349bd07477c](https://github.com/sagemath/sagetrac-mirror/commit/0affd290f491cf624f15fec080f3b349bd07477c)" to "[6741ee0e6e3d3570157fb453c54bcde586bffea8](https://github.com/sagemath/sagetrac-mirror/commit/6741ee0e6e3d3570157fb453c54bcde586bffea8)".



---

archive/issue_comments_373271.json:
```json
{
    "body": "<a id='comment:57'></a>\n\n```patch\n#20385:  Fix currently hardcoded '-Wl,znoexecstack' because\nthere's a space missing.  (E.g. Apple's linker bails out on\n'-znoexecstack', while GNU ld just treats it as if it was\n'-z noexecstack', the correct form.)\n\nThis is an ugly, temporary fix until we submit something\nbetter upstream.\n\nFirst of all, 'configure' should check whether this is / which\noptions are supported and add them based on that, and it's\npresumably better to just put '-Wa,--noexecstack' into\nCCASFLAGS when the assembler supports that option.\n\n\ndiff -Naur ecm-7.0.3.orig/Makefile.am ecm-7.0.3/Makefile.am\n--- ecm-7.0.3/Makefile.am\t2016-06-27 23:22:08.000000000 -0700\n+++ ecm-7.0.3/Makefile.am\t2016-08-03 16:02:21.901175462 -0700\n@@ -50,7 +50,7 @@\n # www.gnu.org/software/libtool/manual/html_node/Updating-version-info.html\n # If any interfaces have been added, removed, or changed since the last\n # update, increment current, and set revision to 0.\n-libecm_la_LDFLAGS = $(LIBECM_LDFLAGS) -version-info 1:0:0 -g -Wl,-znoexecstack\n+libecm_la_LDFLAGS = $(LIBECM_LDFLAGS) -version-info 1:0:0 -g -Wl,-z,noexecstack\n libecm_la_LIBADD = $(MULREDCLIBRARY)\n if WANT_GPU \n   libecm_la_SOURCES += cudakernel.cu\ndiff -Naur ecm-7.0.3.orig/Makefile.in ecm-7.0.3/Makefile.in\n--- ecm-7.0.3/Makefile.in\t2016-07-04 01:02:58.000000000 -0700\n+++ ecm-7.0.3/Makefile.in\t2016-08-03 16:03:13.181175501 -0700\n@@ -715,7 +715,7 @@\n # If any interfaces have been added, removed, or changed since the last\n # update, increment current, and set revision to 0.\n libecm_la_LDFLAGS = $(LIBECM_LDFLAGS) -version-info 1:0:0 -g \\\n-\t-Wl,-znoexecstack $(am__append_5)\n+\t-Wl,-z,noexecstack $(am__append_5)\n libecm_la_LIBADD = $(MULREDCLIBRARY) $(am__append_4) $(GMPLIB)\n @WANT_GPU_TRUE@ecm_LDFLAGS = $(CUDARPATH)\n @WITH_GWNUM_TRUE@ecm_LDFLAGS = $(AM_LDFLAGS) -Wl,gwdata.ld\n```\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6741ee0e6e3d3570157fb453c54bcde586bffea8\">6741ee0</a></td><td><code>GMP-ECM: #20385: Add temporary patch for '-Wl,znoexecstack' [sic] (Makefile.{am,in})</code></td></tr></table>\n",
    "created_at": "2016-08-03T23:28:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373271",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:57'></a>

```patch
#20385:  Fix currently hardcoded '-Wl,znoexecstack' because
there's a space missing.  (E.g. Apple's linker bails out on
'-znoexecstack', while GNU ld just treats it as if it was
'-z noexecstack', the correct form.)

This is an ugly, temporary fix until we submit something
better upstream.

First of all, 'configure' should check whether this is / which
options are supported and add them based on that, and it's
presumably better to just put '-Wa,--noexecstack' into
CCASFLAGS when the assembler supports that option.


diff -Naur ecm-7.0.3.orig/Makefile.am ecm-7.0.3/Makefile.am
--- ecm-7.0.3/Makefile.am	2016-06-27 23:22:08.000000000 -0700
+++ ecm-7.0.3/Makefile.am	2016-08-03 16:02:21.901175462 -0700
@@ -50,7 +50,7 @@
 # www.gnu.org/software/libtool/manual/html_node/Updating-version-info.html
 # If any interfaces have been added, removed, or changed since the last
 # update, increment current, and set revision to 0.
-libecm_la_LDFLAGS = $(LIBECM_LDFLAGS) -version-info 1:0:0 -g -Wl,-znoexecstack
+libecm_la_LDFLAGS = $(LIBECM_LDFLAGS) -version-info 1:0:0 -g -Wl,-z,noexecstack
 libecm_la_LIBADD = $(MULREDCLIBRARY)
 if WANT_GPU 
   libecm_la_SOURCES += cudakernel.cu
diff -Naur ecm-7.0.3.orig/Makefile.in ecm-7.0.3/Makefile.in
--- ecm-7.0.3/Makefile.in	2016-07-04 01:02:58.000000000 -0700
+++ ecm-7.0.3/Makefile.in	2016-08-03 16:03:13.181175501 -0700
@@ -715,7 +715,7 @@
 # If any interfaces have been added, removed, or changed since the last
 # update, increment current, and set revision to 0.
 libecm_la_LDFLAGS = $(LIBECM_LDFLAGS) -version-info 1:0:0 -g \
-	-Wl,-znoexecstack $(am__append_5)
+	-Wl,-z,noexecstack $(am__append_5)
 libecm_la_LIBADD = $(MULREDCLIBRARY) $(am__append_4) $(GMPLIB)
 @WANT_GPU_TRUE@ecm_LDFLAGS = $(CUDARPATH)
 @WITH_GWNUM_TRUE@ecm_LDFLAGS = $(AM_LDFLAGS) -Wl,gwdata.ld
```

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6741ee0e6e3d3570157fb453c54bcde586bffea8">6741ee0</a></td><td><code>GMP-ECM: #20385: Add temporary patch for '-Wl,znoexecstack' [sic] (Makefile.{am,in})</code></td></tr></table>




---

archive/issue_comments_373272.json:
```json
{
    "body": "<a id='comment:58'></a>\nWith that I have \n\n```\nld: unknown option: -z\n```\nnow when enabling shared libraries on OS X. At least that's consistent with the man page.",
    "created_at": "2016-08-03T23:40:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373272",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:58'></a>
With that I have 

```
ld: unknown option: -z
```
now when enabling shared libraries on OS X. At least that's consistent with the man page.



---

archive/issue_comments_373273.json:
```json
{
    "body": "<a id='comment:59'></a>\nReplying to [fbissey](#comment%3A55):\n> Back to our little problem on OS X. It looks like it is something done in `spkg-install`, going to a sage shell and the build location I just do \n> \n> ```\n> make distclean\n> ./configure # by default only build static\n> make\n> ```\n> is successful [...]\n> so it is definitely the configuration/environment from `spkg-install`, the configuration picked up sage's gcc as the compiler and sage's mpir as gmp without a hitch and assembly code has been used.\n\n\nWell, post the part of the log where `spkg-install` prints all the relevant environment variables and `configure` options passed.",
    "created_at": "2016-08-03T23:40:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373273",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:59'></a>
Replying to [fbissey](#comment%3A55):
> Back to our little problem on OS X. It looks like it is something done in `spkg-install`, going to a sage shell and the build location I just do 
> 
> ```
> make distclean
> ./configure # by default only build static
> make
> ```
> is successful [...]
> so it is definitely the configuration/environment from `spkg-install`, the configuration picked up sage's gcc as the compiler and sage's mpir as gmp without a hitch and assembly code has been used.


Well, post the part of the log where `spkg-install` prints all the relevant environment variables and `configure` options passed.



---

archive/issue_comments_373274.json:
```json
{
    "body": "<a id='comment:60'></a>\nReplying to [fbissey](#comment%3A58):\n> With that I have \n> \n> ```\n> ld: unknown option: -z\n> ```\n> now when enabling shared libraries on OS X. At least that's consistent with the man page.\n\n\nWhat does `gcc -c -Wa,--noexecstack foo.c` give?  (`foo.c` at your like, e.g. `void foo() {}`.)\n\n(And probably also `gcc -v -o foo ...` without `-c`.)",
    "created_at": "2016-08-03T23:45:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373274",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:60'></a>
Replying to [fbissey](#comment%3A58):
> With that I have 
> 
> ```
> ld: unknown option: -z
> ```
> now when enabling shared libraries on OS X. At least that's consistent with the man page.


What does `gcc -c -Wa,--noexecstack foo.c` give?  (`foo.c` at your like, e.g. `void foo() {}`.)

(And probably also `gcc -v -o foo ...` without `-c`.)



---

archive/issue_comments_373275.json:
```json
{
    "body": "<a id='comment:61'></a>\nReplying to [leif](#comment%3A60):\n> (And probably also `gcc -v -o foo ...` without `-c`.)\n\n\nAhem, forget that.",
    "created_at": "2016-08-03T23:48:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373275",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:61'></a>
Replying to [leif](#comment%3A60):
> (And probably also `gcc -v -o foo ...` without `-c`.)


Ahem, forget that.



---

archive/issue_comments_373276.json:
```json
{
    "body": "<a id='comment:62'></a>\n\n```\nclang: error: unsupported option '--noexecstack'\n```\nNot in the manual either.",
    "created_at": "2016-08-03T23:52:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373276",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:62'></a>

```
clang: error: unsupported option '--noexecstack'
```
Not in the manual either.



---

archive/issue_comments_373277.json:
```json
{
    "body": "<a id='comment:63'></a>\nAnd/or attach the log of the last failed build here.",
    "created_at": "2016-08-03T23:54:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373277",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:63'></a>
And/or attach the log of the last failed build here.



---

archive/issue_comments_373278.json:
```json
{
    "body": "ecm log - bare spkg-install run",
    "created_at": "2016-08-04T00:01:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373278",
    "user": "https://github.com/kiwifb"
}
```

ecm log - bare spkg-install run



---

archive/issue_comments_373279.json:
```json
{
    "body": "Attachment [config.log](tarball://root/attachments/some-uuid/ticket20385/config.log) by @kiwifb created at 2016-08-04 00:02:41\n\nconfig.log matching ecm.log",
    "created_at": "2016-08-04T00:02:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373279",
    "user": "https://github.com/kiwifb"
}
```

Attachment [config.log](tarball://root/attachments/some-uuid/ticket20385/config.log) by @kiwifb created at 2016-08-04 00:02:41

config.log matching ecm.log



---

archive/issue_comments_373280.json:
```json
{
    "body": "<a id='comment:64'></a>\nDone. So just plain `./sage -p ecm` logs. No funky things in `ECM_CONFIGURE`.",
    "created_at": "2016-08-04T00:03:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373280",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:64'></a>
Done. So just plain `./sage -p ecm` logs. No funky things in `ECM_CONFIGURE`.



---

archive/issue_comments_373281.json:
```json
{
    "body": "<a id='comment:65'></a>\n> * Attachment ecm.log\u200b added\n> ecm log - bare spkg-install run\n\n\nInterestingly, `ld` there didn't bail out on `-z noexecstack`, for whatever reason.  (Did it at all get invoked?)\n\nOtherwise I'm stuck at libtool weirdness and what Apple's ld considers \"not x86_64 architecture\". \n\nAlso, while we have\n\n```\nchecking for gcc option to produce PIC... -fno-common -DPIC\nchecking if gcc PIC flag -fno-common -DPIC works... yes\nchecking if gcc static flag -static works... no\n``` \nonly `-fPIC` is used (which we add in `spkg-install`).\n\nAnd libtool *of course<sup>TM</sup>* keeps building `.o` **and** `.lo` files, and both `foo.a` and `foo.la`.",
    "created_at": "2016-08-04T00:45:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373281",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:65'></a>
> * Attachment ecm.log​ added
> ecm log - bare spkg-install run


Interestingly, `ld` there didn't bail out on `-z noexecstack`, for whatever reason.  (Did it at all get invoked?)

Otherwise I'm stuck at libtool weirdness and what Apple's ld considers "not x86_64 architecture". 

Also, while we have

```
checking for gcc option to produce PIC... -fno-common -DPIC
checking if gcc PIC flag -fno-common -DPIC works... yes
checking if gcc static flag -static works... no
``` 
only `-fPIC` is used (which we add in `spkg-install`).

And libtool *of course<sup>TM</sup>* keeps building `.o` **and** `.lo` files, and both `foo.a` and `foo.la`.



---

archive/issue_comments_373282.json:
```json
{
    "body": "<a id='comment:66'></a>\nFound the bit that cause problem `--with-gmp=${SAGE_LOCAL}` without it configure tells me\n\n```\nconfigure: Configuration:\nconfigure: Build for host type x86_64-apple-darwin15.6.0\nconfigure: CC=gcc, CFLAGS=-g -O2\nconfigure: Linking GMP with -lgmp\n```\nand the build succeeds. With it\n\n```\nconfigure: Configuration:\nconfigure: Build for host type x86_64-apple-darwin15.6.0\nconfigure: CC=gcc, CFLAGS=-g -O2\nconfigure: Linking GMP with /Users/fbissey/build/sage-7.2.beta5/local/lib/libgmp.a\n```\nand the build fails....",
    "created_at": "2016-08-04T01:02:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373282",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:66'></a>
Found the bit that cause problem `--with-gmp=${SAGE_LOCAL}` without it configure tells me

```
configure: Configuration:
configure: Build for host type x86_64-apple-darwin15.6.0
configure: CC=gcc, CFLAGS=-g -O2
configure: Linking GMP with -lgmp
```
and the build succeeds. With it

```
configure: Configuration:
configure: Build for host type x86_64-apple-darwin15.6.0
configure: CC=gcc, CFLAGS=-g -O2
configure: Linking GMP with /Users/fbissey/build/sage-7.2.beta5/local/lib/libgmp.a
```
and the build fails....



---

archive/issue_comments_373283.json:
```json
{
    "body": "<a id='comment:67'></a>\nRebuilding develop branch from scratch to make sure `mpir` is as sane as it can be.",
    "created_at": "2016-08-04T01:05:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373283",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:67'></a>
Rebuilding develop branch from scratch to make sure `mpir` is as sane as it can be.



---

archive/issue_comments_373284.json:
```json
{
    "body": "<a id='comment:68'></a>\nReplying to [fbissey](#comment%3A66):\n> Found the bit that cause problem `--with-gmp=${SAGE_LOCAL}` without it configure tells me\n> \n> ```\n> configure: Configuration:\n> configure: Build for host type x86_64-apple-darwin15.6.0\n> configure: CC=gcc, CFLAGS=-g -O2\n> configure: Linking GMP with -lgmp\n> ```\n\n\nI thought of that, but you told me *\"the configuration picked up sage's gcc as the compiler **and sage's mpir** as gmp without a hitch\"* and I was wondering whether that's due to Sage GCC's configuration.\n\n\\\\\n\nBut before my internet connection went down the drain 8/ I was about to post:\n\n---\n\nAnd then I'd need a log from your successful \"manual\" build (`make distclean && ./configure && make`) from within a Sage subshell to compare with.\n\nOTOH the only (major) difference -- regarding the environment when `configure` is invoked -- should be `-fPIC` in `CFLAGS`, as ECM picks up MPIR's when `CFLAGS` are empty / not set (which is the case in a Sage subshell unless you've set them yourself).\n\nNot sure how libtool reacts to that, or whether there's anything in `configure` that's influenced by that.\n\n---\n\nNow clearly the difference seems to (also) be that you don't have a static libgmp installed system-wide.",
    "created_at": "2016-08-04T01:55:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373284",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:68'></a>
Replying to [fbissey](#comment%3A66):
> Found the bit that cause problem `--with-gmp=${SAGE_LOCAL}` without it configure tells me
> 
> ```
> configure: Configuration:
> configure: Build for host type x86_64-apple-darwin15.6.0
> configure: CC=gcc, CFLAGS=-g -O2
> configure: Linking GMP with -lgmp
> ```


I thought of that, but you told me *"the configuration picked up sage's gcc as the compiler **and sage's mpir** as gmp without a hitch"* and I was wondering whether that's due to Sage GCC's configuration.

\\

But before my internet connection went down the drain 8/ I was about to post:

---

And then I'd need a log from your successful "manual" build (`make distclean && ./configure && make`) from within a Sage subshell to compare with.

OTOH the only (major) difference -- regarding the environment when `configure` is invoked -- should be `-fPIC` in `CFLAGS`, as ECM picks up MPIR's when `CFLAGS` are empty / not set (which is the case in a Sage subshell unless you've set them yourself).

Not sure how libtool reacts to that, or whether there's anything in `configure` that's influenced by that.

---

Now clearly the difference seems to (also) be that you don't have a static libgmp installed system-wide.



---

archive/issue_comments_373285.json:
```json
{
    "body": "<a id='comment:69'></a>\nI don't even have a dynamic one. \n\nThe environment passes `-L${SAGE_LOCAL}/lib` and `-Wl,-rpath=${SAGE_LOCAL}/lib`, further the configure script identifies `gmp` as being in fact `mpir` in both case. So the `-lgmp` picked can only be from `${SAGE_LOCAL}/lib`. \n\nEven further when outside of the sage shell configure bails out because it cannot find any gmp. So the only gmp available is in sage's install.\n\nOn another front I separately tried to add `-fPIC` to CFLAGS for configuration and that wasn't a problem. Just adding `-fPIC` lead to a successful compilation. \n\nlibgmp.a or the process of using libgmp.a wholesale is causing trouble. Using libgmp.a that way tries to fold the gmp archive inside libecm.a (so you don't need to link with libgmp.a as it is already inside), apparently it causes trouble on OS X. Possibly something in `mpir` rather than `ecm` in my opinion.",
    "created_at": "2016-08-04T02:08:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373285",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:69'></a>
I don't even have a dynamic one. 

The environment passes `-L${SAGE_LOCAL}/lib` and `-Wl,-rpath=${SAGE_LOCAL}/lib`, further the configure script identifies `gmp` as being in fact `mpir` in both case. So the `-lgmp` picked can only be from `${SAGE_LOCAL}/lib`. 

Even further when outside of the sage shell configure bails out because it cannot find any gmp. So the only gmp available is in sage's install.

On another front I separately tried to add `-fPIC` to CFLAGS for configuration and that wasn't a problem. Just adding `-fPIC` lead to a successful compilation. 

libgmp.a or the process of using libgmp.a wholesale is causing trouble. Using libgmp.a that way tries to fold the gmp archive inside libecm.a (so you don't need to link with libgmp.a as it is already inside), apparently it causes trouble on OS X. Possibly something in `mpir` rather than `ecm` in my opinion.



---

archive/issue_comments_373286.json:
```json
{
    "body": "<a id='comment:70'></a>\nReplying to [fbissey](#comment%3A69):\n> libgmp.a or the process of using libgmp.a wholesale is causing trouble. Using libgmp.a that way tries to fold the gmp archive inside libecm.a (so you don't need to link with libgmp.a as it is already inside), apparently it causes trouble on OS X. Possibly something in `mpir` rather than `ecm` in my opinion.\n\n\nIt shouldn't.  You cannot \"fold\" a static library into another, you can include object files from one into another, or when you build a *shared* library, include object files into the former (as needed -- symbols get resolved and the object files from which they originate get included, all ending up in the same single text segment etc.).\n\n\\\\\n\nWondering whether we build MPIR's/GMP's static library also with PIC.  (Btw., ECM also has `--with-pic`.)\n\n\\\\\n\nMy guess is rather that it's ECM's fault.",
    "created_at": "2016-08-04T02:32:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373286",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:70'></a>
Replying to [fbissey](#comment%3A69):
> libgmp.a or the process of using libgmp.a wholesale is causing trouble. Using libgmp.a that way tries to fold the gmp archive inside libecm.a (so you don't need to link with libgmp.a as it is already inside), apparently it causes trouble on OS X. Possibly something in `mpir` rather than `ecm` in my opinion.


It shouldn't.  You cannot "fold" a static library into another, you can include object files from one into another, or when you build a *shared* library, include object files into the former (as needed -- symbols get resolved and the object files from which they originate get included, all ending up in the same single text segment etc.).

\\

Wondering whether we build MPIR's/GMP's static library also with PIC.  (Btw., ECM also has `--with-pic`.)

\\

My guess is rather that it's ECM's fault.



---

archive/issue_comments_373287.json:
```json
{
    "body": "<a id='comment:71'></a>\nReplying to [leif](#comment%3A70):\n> Wondering whether we build MPIR's/GMP's static library also with PIC.\n\n\nLooks like it (MPIR, not explicitly we) does (`-fPIC -DPIC`).",
    "created_at": "2016-08-04T02:49:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373287",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:71'></a>
Replying to [leif](#comment%3A70):
> Wondering whether we build MPIR's/GMP's static library also with PIC.


Looks like it (MPIR, not explicitly we) does (`-fPIC -DPIC`).



---

archive/issue_comments_373288.json:
```json
{
    "body": "<a id='comment:72'></a>\nNote that in\n\n```\nlibtool: link: gcc -g -march=native -g -O3 -fPIC\n    -Wl,-rpath -Wl,/Users/fbissey/build/sage-7.2.beta5/local/lib \n    -o ecm\n    ecm-auxi.o ecm-b1_ainc.o ecm-candi.o ecm-eval.o ecm-main.o ecm-resume.o\n    ecm-getprime_r.o aprtcle/ecm-mpz_aprcl.o ecm-memusage.o\n    -L/Users/fbissey/build/sage-7.2.beta5/local/lib ./.libs/libecm.a\n    /Users/fbissey/build/sage-7.2.beta5/local/lib/libgmp.a -lm\nld: warning: ignoring file ./.libs/libecm.a, file was built for archive which is not the architecture being linked (x86_64): ./.libs/libecm.a\n```\nthe linker only complains about `libecm.a`, but not `libgmp.a`.",
    "created_at": "2016-08-04T02:58:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373288",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:72'></a>
Note that in

```
libtool: link: gcc -g -march=native -g -O3 -fPIC
    -Wl,-rpath -Wl,/Users/fbissey/build/sage-7.2.beta5/local/lib 
    -o ecm
    ecm-auxi.o ecm-b1_ainc.o ecm-candi.o ecm-eval.o ecm-main.o ecm-resume.o
    ecm-getprime_r.o aprtcle/ecm-mpz_aprcl.o ecm-memusage.o
    -L/Users/fbissey/build/sage-7.2.beta5/local/lib ./.libs/libecm.a
    /Users/fbissey/build/sage-7.2.beta5/local/lib/libgmp.a -lm
ld: warning: ignoring file ./.libs/libecm.a, file was built for archive which is not the architecture being linked (x86_64): ./.libs/libecm.a
```
the linker only complains about `libecm.a`, but not `libgmp.a`.



---

archive/issue_comments_373289.json:
```json
{
    "body": "<a id='comment:73'></a>\nBut you're right, ECM actually adds `libgmp.a` to `libecm.a`:\n\n```\nlibtool: link: ar cru .libs/libecm.a /Users/fbissey/build/sage-7.2.beta5/local/lib/libgmp.a  libecm_la-ecm.o libecm_la-ecm2.o libecm_la-pm1.o libecm_la-pp1.o libecm_la-getprime_r.o libecm_la-listz.o libecm_la-lucas.o libecm_la-stage2.o libecm_la-mpmod.o libecm_la-mul_lo.o libecm_la-polyeval.o libecm_la-median.o libecm_la-schoen_strass.o libecm_la-ks-multiply.o libecm_la-rho.o libecm_la-bestd.o libecm_la-auxlib.o libecm_la-random.o libecm_la-factor.o libecm_la-sp.o libecm_la-spv.o libecm_la-spm.o libecm_la-mpzspm.o libecm_la-mpzspv.o libecm_la-ntt_gfp.o libecm_la-ecm_ntt.o libecm_la-pm1fs2.o libecm_la-sets_long.o libecm_la-auxarith.o libecm_la-batch.o libecm_la-parametrizations.o libecm_la-cudawrapper.o aprtcle/libecm_la-mpz_aprcl.o  .libs/libecm.lax/libmulredc.a/mulredc1.o .libs/libecm.lax/libmulredc.a/mulredc10.o .libs/libecm.lax/libmulredc.a/mulredc11.o .libs/libecm.lax/libmulredc.a/mulredc12.o .libs/libecm.lax/libmulredc.a/mulredc13.o .libs/libecm.lax/libmulredc.a/mulredc14.o .libs/libecm.lax/libmulredc.a/mulredc15.o .libs/libecm.lax/libmulredc.a/mulredc16.o .libs/libecm.lax/libmulredc.a/mulredc17.o .libs/libecm.lax/libmulredc.a/mulredc18.o .libs/libecm.lax/libmulredc.a/mulredc19.o .libs/libecm.lax/libmulredc.a/mulredc1_10.o .libs/libecm.lax/libmulredc.a/mulredc1_11.o .libs/libecm.lax/libmulredc.a/mulredc1_12.o .libs/libecm.lax/libmulredc.a/mulredc1_13.o .libs/libecm.lax/libmulredc.a/mulredc1_14.o .libs/libecm.lax/libmulredc.a/mulredc1_15.o .libs/libecm.lax/libmulredc.a/mulredc1_16.o .libs/libecm.lax/libmulredc.a/mulredc1_17.o .libs/libecm.lax/libmulredc.a/mulredc1_18.o .libs/libecm.lax/libmulredc.a/mulredc1_19.o .libs/libecm.lax/libmulredc.a/mulredc1_2.o .libs/libecm.lax/libmulredc.a/mulredc1_20.o .libs/libecm.lax/libmulredc.a/mulredc1_3.o .libs/libecm.lax/libmulredc.a/mulredc1_4.o .libs/libecm.lax/libmulredc.a/mulredc1_5.o .libs/libecm.lax/libmulredc.a/mulredc1_6.o .libs/libecm.lax/libmulredc.a/mulredc1_7.o .libs/libecm.lax/libmulredc.a/mulredc1_8.o .libs/libecm.lax/libmulredc.a/mulredc1_9.o .libs/libecm.lax/libmulredc.a/mulredc2.o .libs/libecm.lax/libmulredc.a/mulredc20.o .libs/libecm.lax/libmulredc.a/mulredc3.o .libs/libecm.lax/libmulredc.a/mulredc4.o .libs/libecm.lax/libmulredc.a/mulredc5.o .libs/libecm.lax/libmulredc.a/mulredc6.o .libs/libecm.lax/libmulredc.a/mulredc7.o .libs/libecm.lax/libmulredc.a/mulredc8.o .libs/libecm.lax/libmulredc.a/mulredc9.o \n```\nand that's presumably the entry Apple's `ld` complains about (and instead of ignoring the entry, it drops the whole archive, libecm.a).",
    "created_at": "2016-08-04T03:13:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373289",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:73'></a>
But you're right, ECM actually adds `libgmp.a` to `libecm.a`:

```
libtool: link: ar cru .libs/libecm.a /Users/fbissey/build/sage-7.2.beta5/local/lib/libgmp.a  libecm_la-ecm.o libecm_la-ecm2.o libecm_la-pm1.o libecm_la-pp1.o libecm_la-getprime_r.o libecm_la-listz.o libecm_la-lucas.o libecm_la-stage2.o libecm_la-mpmod.o libecm_la-mul_lo.o libecm_la-polyeval.o libecm_la-median.o libecm_la-schoen_strass.o libecm_la-ks-multiply.o libecm_la-rho.o libecm_la-bestd.o libecm_la-auxlib.o libecm_la-random.o libecm_la-factor.o libecm_la-sp.o libecm_la-spv.o libecm_la-spm.o libecm_la-mpzspm.o libecm_la-mpzspv.o libecm_la-ntt_gfp.o libecm_la-ecm_ntt.o libecm_la-pm1fs2.o libecm_la-sets_long.o libecm_la-auxarith.o libecm_la-batch.o libecm_la-parametrizations.o libecm_la-cudawrapper.o aprtcle/libecm_la-mpz_aprcl.o  .libs/libecm.lax/libmulredc.a/mulredc1.o .libs/libecm.lax/libmulredc.a/mulredc10.o .libs/libecm.lax/libmulredc.a/mulredc11.o .libs/libecm.lax/libmulredc.a/mulredc12.o .libs/libecm.lax/libmulredc.a/mulredc13.o .libs/libecm.lax/libmulredc.a/mulredc14.o .libs/libecm.lax/libmulredc.a/mulredc15.o .libs/libecm.lax/libmulredc.a/mulredc16.o .libs/libecm.lax/libmulredc.a/mulredc17.o .libs/libecm.lax/libmulredc.a/mulredc18.o .libs/libecm.lax/libmulredc.a/mulredc19.o .libs/libecm.lax/libmulredc.a/mulredc1_10.o .libs/libecm.lax/libmulredc.a/mulredc1_11.o .libs/libecm.lax/libmulredc.a/mulredc1_12.o .libs/libecm.lax/libmulredc.a/mulredc1_13.o .libs/libecm.lax/libmulredc.a/mulredc1_14.o .libs/libecm.lax/libmulredc.a/mulredc1_15.o .libs/libecm.lax/libmulredc.a/mulredc1_16.o .libs/libecm.lax/libmulredc.a/mulredc1_17.o .libs/libecm.lax/libmulredc.a/mulredc1_18.o .libs/libecm.lax/libmulredc.a/mulredc1_19.o .libs/libecm.lax/libmulredc.a/mulredc1_2.o .libs/libecm.lax/libmulredc.a/mulredc1_20.o .libs/libecm.lax/libmulredc.a/mulredc1_3.o .libs/libecm.lax/libmulredc.a/mulredc1_4.o .libs/libecm.lax/libmulredc.a/mulredc1_5.o .libs/libecm.lax/libmulredc.a/mulredc1_6.o .libs/libecm.lax/libmulredc.a/mulredc1_7.o .libs/libecm.lax/libmulredc.a/mulredc1_8.o .libs/libecm.lax/libmulredc.a/mulredc1_9.o .libs/libecm.lax/libmulredc.a/mulredc2.o .libs/libecm.lax/libmulredc.a/mulredc20.o .libs/libecm.lax/libmulredc.a/mulredc3.o .libs/libecm.lax/libmulredc.a/mulredc4.o .libs/libecm.lax/libmulredc.a/mulredc5.o .libs/libecm.lax/libmulredc.a/mulredc6.o .libs/libecm.lax/libmulredc.a/mulredc7.o .libs/libecm.lax/libmulredc.a/mulredc8.o .libs/libecm.lax/libmulredc.a/mulredc9.o 
```
and that's presumably the entry Apple's `ld` complains about (and instead of ignoring the entry, it drops the whole archive, libecm.a).



---

archive/issue_comments_373290.json:
```json
{
    "body": "<a id='comment:74'></a>\nI guess this is the culprit (in `Makefile.am`, line 61):\n\n```make\nlibecm_la_LIBADD += $(GMPLIB)\n```\n(In `Makefile.in`, on line 719.)\n\n\\\\\n\nNew tentative patch:\n\n```diff\n#20385:  Don't put $(GMPLIB) (=libgmp.a) into libecm.a, as Darwin's\nlinker bails out on nested archives.  Probably a weird idea anyway,\nor some libtool bug, as it's presumably supposed to add *the contents*\n(i.e., the object files) of libgmp.a into libecm.a.\n\n\ndiff -Naur ecm-7.0.3.orig/Makefile.am ecm-7.0.3/Makefile.am\n--- ecm-7.0.3/Makefile.am\t2016-06-27 23:22:08.000000000 -0700\n+++ ecm-7.0.3/Makefile.am\t2016-08-03 23:20:24.352113089 -0700\n@@ -58,7 +58,7 @@\n   libecm_la_LDFLAGS += $(CUDALDFLAGS)\n   ecm_LDFLAGS = $(CUDARPATH)\n endif\n-libecm_la_LIBADD += $(GMPLIB)\n+# libecm_la_LIBADD += $(GMPLIB)\n \n bin_PROGRAMS = ecm\n noinst_PROGRAMS = tune ecmfactor bench_mulredc aprcl\ndiff -Naur ecm-7.0.3.orig/Makefile.in ecm-7.0.3/Makefile.in\n--- ecm-7.0.3/Makefile.in\t2016-07-04 01:02:58.000000000 -0700\n+++ ecm-7.0.3/Makefile.in\t2016-08-03 23:19:34.952113147 -0700\n@@ -716,7 +716,7 @@\n # update, increment current, and set revision to 0.\n libecm_la_LDFLAGS = $(LIBECM_LDFLAGS) -version-info 1:0:0 -g \\\n \t-Wl,-znoexecstack $(am__append_5)\n-libecm_la_LIBADD = $(MULREDCLIBRARY) $(am__append_4) $(GMPLIB)\n+libecm_la_LIBADD = $(MULREDCLIBRARY) $(am__append_4)\n @WANT_GPU_TRUE@ecm_LDFLAGS = $(CUDARPATH)\n @WITH_GWNUM_TRUE@ecm_LDFLAGS = $(AM_LDFLAGS) -Wl,gwdata.ld\n # Most binaries want to link libecm.la, and the ones which don't will\n```\n\nNote that this new patch gets applied *before* the other one, so I had to change the latter as well since they unfortunately overlap.  (But the first I added will get dropped later anyway, if Darwin's linker doesn't understand `-z ...` **and** also errors out on it.)",
    "created_at": "2016-08-04T07:07:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373290",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:74'></a>
I guess this is the culprit (in `Makefile.am`, line 61):

```make
libecm_la_LIBADD += $(GMPLIB)
```
(In `Makefile.in`, on line 719.)

\\

New tentative patch:

```diff
#20385:  Don't put $(GMPLIB) (=libgmp.a) into libecm.a, as Darwin's
linker bails out on nested archives.  Probably a weird idea anyway,
or some libtool bug, as it's presumably supposed to add *the contents*
(i.e., the object files) of libgmp.a into libecm.a.


diff -Naur ecm-7.0.3.orig/Makefile.am ecm-7.0.3/Makefile.am
--- ecm-7.0.3/Makefile.am	2016-06-27 23:22:08.000000000 -0700
+++ ecm-7.0.3/Makefile.am	2016-08-03 23:20:24.352113089 -0700
@@ -58,7 +58,7 @@
   libecm_la_LDFLAGS += $(CUDALDFLAGS)
   ecm_LDFLAGS = $(CUDARPATH)
 endif
-libecm_la_LIBADD += $(GMPLIB)
+# libecm_la_LIBADD += $(GMPLIB)
 
 bin_PROGRAMS = ecm
 noinst_PROGRAMS = tune ecmfactor bench_mulredc aprcl
diff -Naur ecm-7.0.3.orig/Makefile.in ecm-7.0.3/Makefile.in
--- ecm-7.0.3/Makefile.in	2016-07-04 01:02:58.000000000 -0700
+++ ecm-7.0.3/Makefile.in	2016-08-03 23:19:34.952113147 -0700
@@ -716,7 +716,7 @@
 # update, increment current, and set revision to 0.
 libecm_la_LDFLAGS = $(LIBECM_LDFLAGS) -version-info 1:0:0 -g \
 	-Wl,-znoexecstack $(am__append_5)
-libecm_la_LIBADD = $(MULREDCLIBRARY) $(am__append_4) $(GMPLIB)
+libecm_la_LIBADD = $(MULREDCLIBRARY) $(am__append_4)
 @WANT_GPU_TRUE@ecm_LDFLAGS = $(CUDARPATH)
 @WITH_GWNUM_TRUE@ecm_LDFLAGS = $(AM_LDFLAGS) -Wl,gwdata.ld
 # Most binaries want to link libecm.la, and the ones which don't will
```

Note that this new patch gets applied *before* the other one, so I had to change the latter as well since they unfortunately overlap.  (But the first I added will get dropped later anyway, if Darwin's linker doesn't understand `-z ...` **and** also errors out on it.)



---

archive/issue_comments_373291.json:
```json
{
    "body": "<a id='comment:75'></a>\nI'll push the changes in a couple of minutes...",
    "created_at": "2016-08-04T07:08:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373291",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:75'></a>
I'll push the changes in a couple of minutes...



---

archive/issue_comments_373292.json:
```json
{
    "body": "<a id='comment:76'></a>\nYes, removing that bit looks right. After all it is already added to `LDFLAGS` by `configure`. For the record I successfully installed ecm-7.0.3 on OS X with the following change\n\n```diff\ndiff --git a/build/pkgs/ecm/spkg-install b/build/pkgs/ecm/spkg-install\nindex fc49b3d..7c1e42a 100755\n--- a/build/pkgs/ecm/spkg-install\n+++ b/build/pkgs/ecm/spkg-install\n@@ -237,7 +237,6 @@ else\n fi\n echo \"  --prefix=\\\"$SAGE_LOCAL\\\"\"\n echo \"  --libdir=\\\"$SAGE_LOCAL/lib\\\"\"\n-echo \"  --with-gmp=\\\"$SAGE_LOCAL\\\"\"\n for opt in $ECM_CONFIGURE; do\n     echo \"  $opt\"\n done\n@@ -249,7 +248,6 @@ fi\n echo\n \n ./configure --prefix=\"$SAGE_LOCAL\" --libdir=\"$SAGE_LOCAL/lib\" \\\n-            --with-gmp=\"$SAGE_LOCAL\" \\\n             $ECM_CONFIGURE\n if [ $? -ne 0 ]; then\n     echo >&2 \"Error configuring GMP-ECM.\"\n```\nJust doing that removes `libgmp.a` from the `ar` call\n\n```\nlibtool: link: (cd .libs/libecm.lax/libmulredc.a && ar x \"/Users/fbissey/build/sage-7.2.beta5/local/var/tmp/sage/build/ecm-7.0.3/src/./x86_64/.libs/libmulredc.a\")\nlibtool: link: ar cru .libs/libecm.a  libecm_la-ecm.o libecm_la-ecm2.o libecm_la-pm1.o libecm_la-pp1.o libecm_la-getprime_r.o libecm_la-listz.o libecm_la-lucas.o libecm_la-stage2.o libecm_la-mpmod.o libecm_la-mul_lo.o libecm_la-polyeval.o libecm_la-median.o libecm_la-schoen_strass.o libecm_la-ks-multiply.o libecm_la-rho.o libecm_la-bestd.o libecm_la-auxlib.o libecm_la-random.o libecm_la-factor.o libecm_la-sp.o libecm_la-spv.o libecm_la-spm.o libecm_la-mpzspm.o libecm_la-mpzspv.o libecm_la-ntt_gfp.o libecm_la-ecm_ntt.o libecm_la-pm1fs2.o libecm_la-sets_long.o libecm_la-auxarith.o libecm_la-batch.o libecm_la-parametrizations.o libecm_la-cudawrapper.o aprtcle/libecm_la-mpz_aprcl.o  .libs/libecm.lax/libmulredc.a/mulredc1.o .libs/libecm.lax/libmulredc.a/mulredc10.o .libs/libecm.lax/libmulredc.a/mulredc11.o .libs/libecm.lax/libmulredc.a/mulredc12.o .libs/libecm.lax/libmulredc.a/mulredc13.o .libs/libecm.lax/libmulredc.a/mulredc14.o .libs/libecm.lax/libmulredc.a/mulredc15.o .libs/libecm.lax/libmulredc.a/mulredc16.o .libs/libecm.lax/libmulredc.a/mulredc17.o .libs/libecm.lax/libmulredc.a/mulredc18.o .libs/libecm.lax/libmulredc.a/mulredc19.o .libs/libecm.lax/libmulredc.a/mulredc1_10.o .libs/libecm.lax/libmulredc.a/mulredc1_11.o .libs/libecm.lax/libmulredc.a/mulredc1_12.o .libs/libecm.lax/libmulredc.a/mulredc1_13.o .libs/libecm.lax/libmulredc.a/mulredc1_14.o .libs/libecm.lax/libmulredc.a/mulredc1_15.o .libs/libecm.lax/libmulredc.a/mulredc1_16.o .libs/libecm.lax/libmulredc.a/mulredc1_17.o .libs/libecm.lax/libmulredc.a/mulredc1_18.o .libs/libecm.lax/libmulredc.a/mulredc1_19.o .libs/libecm.lax/libmulredc.a/mulredc1_2.o .libs/libecm.lax/libmulredc.a/mulredc1_20.o .libs/libecm.lax/libmulredc.a/mulredc1_3.o .libs/libecm.lax/libmulredc.a/mulredc1_4.o .libs/libecm.lax/libmulredc.a/mulredc1_5.o .libs/libecm.lax/libmulredc.a/mulredc1_6.o .libs/libecm.lax/libmulredc.a/mulredc1_7.o .libs/libecm.lax/libmulredc.a/mulredc1_8.o .libs/libecm.lax/libmulredc.a/mulredc1_9.o .libs/libecm.lax/libmulredc.a/mulredc2.o .libs/libecm.lax/libmulredc.a/mulredc20.o .libs/libecm.lax/libmulredc.a/mulredc3.o .libs/libecm.lax/libmulredc.a/mulredc4.o .libs/libecm.lax/libmulredc.a/mulredc5.o .libs/libecm.lax/libmulredc.a/mulredc6.o .libs/libecm.lax/libmulredc.a/mulredc7.o .libs/libecm.lax/libmulredc.a/mulredc8.o .libs/libecm.lax/libmulredc.a/mulredc9.o \n/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/ranlib: file: .libs/libecm.a(libecm_la-cudawrapper.o) has no symbols\nlibtool: link: ranlib .libs/libecm.a\n```",
    "created_at": "2016-08-04T07:43:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373292",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:76'></a>
Yes, removing that bit looks right. After all it is already added to `LDFLAGS` by `configure`. For the record I successfully installed ecm-7.0.3 on OS X with the following change

```diff
diff --git a/build/pkgs/ecm/spkg-install b/build/pkgs/ecm/spkg-install
index fc49b3d..7c1e42a 100755
--- a/build/pkgs/ecm/spkg-install
+++ b/build/pkgs/ecm/spkg-install
@@ -237,7 +237,6 @@ else
 fi
 echo "  --prefix=\"$SAGE_LOCAL\""
 echo "  --libdir=\"$SAGE_LOCAL/lib\""
-echo "  --with-gmp=\"$SAGE_LOCAL\""
 for opt in $ECM_CONFIGURE; do
     echo "  $opt"
 done
@@ -249,7 +248,6 @@ fi
 echo
 
 ./configure --prefix="$SAGE_LOCAL" --libdir="$SAGE_LOCAL/lib" \
-            --with-gmp="$SAGE_LOCAL" \
             $ECM_CONFIGURE
 if [ $? -ne 0 ]; then
     echo >&2 "Error configuring GMP-ECM."
```
Just doing that removes `libgmp.a` from the `ar` call

```
libtool: link: (cd .libs/libecm.lax/libmulredc.a && ar x "/Users/fbissey/build/sage-7.2.beta5/local/var/tmp/sage/build/ecm-7.0.3/src/./x86_64/.libs/libmulredc.a")
libtool: link: ar cru .libs/libecm.a  libecm_la-ecm.o libecm_la-ecm2.o libecm_la-pm1.o libecm_la-pp1.o libecm_la-getprime_r.o libecm_la-listz.o libecm_la-lucas.o libecm_la-stage2.o libecm_la-mpmod.o libecm_la-mul_lo.o libecm_la-polyeval.o libecm_la-median.o libecm_la-schoen_strass.o libecm_la-ks-multiply.o libecm_la-rho.o libecm_la-bestd.o libecm_la-auxlib.o libecm_la-random.o libecm_la-factor.o libecm_la-sp.o libecm_la-spv.o libecm_la-spm.o libecm_la-mpzspm.o libecm_la-mpzspv.o libecm_la-ntt_gfp.o libecm_la-ecm_ntt.o libecm_la-pm1fs2.o libecm_la-sets_long.o libecm_la-auxarith.o libecm_la-batch.o libecm_la-parametrizations.o libecm_la-cudawrapper.o aprtcle/libecm_la-mpz_aprcl.o  .libs/libecm.lax/libmulredc.a/mulredc1.o .libs/libecm.lax/libmulredc.a/mulredc10.o .libs/libecm.lax/libmulredc.a/mulredc11.o .libs/libecm.lax/libmulredc.a/mulredc12.o .libs/libecm.lax/libmulredc.a/mulredc13.o .libs/libecm.lax/libmulredc.a/mulredc14.o .libs/libecm.lax/libmulredc.a/mulredc15.o .libs/libecm.lax/libmulredc.a/mulredc16.o .libs/libecm.lax/libmulredc.a/mulredc17.o .libs/libecm.lax/libmulredc.a/mulredc18.o .libs/libecm.lax/libmulredc.a/mulredc19.o .libs/libecm.lax/libmulredc.a/mulredc1_10.o .libs/libecm.lax/libmulredc.a/mulredc1_11.o .libs/libecm.lax/libmulredc.a/mulredc1_12.o .libs/libecm.lax/libmulredc.a/mulredc1_13.o .libs/libecm.lax/libmulredc.a/mulredc1_14.o .libs/libecm.lax/libmulredc.a/mulredc1_15.o .libs/libecm.lax/libmulredc.a/mulredc1_16.o .libs/libecm.lax/libmulredc.a/mulredc1_17.o .libs/libecm.lax/libmulredc.a/mulredc1_18.o .libs/libecm.lax/libmulredc.a/mulredc1_19.o .libs/libecm.lax/libmulredc.a/mulredc1_2.o .libs/libecm.lax/libmulredc.a/mulredc1_20.o .libs/libecm.lax/libmulredc.a/mulredc1_3.o .libs/libecm.lax/libmulredc.a/mulredc1_4.o .libs/libecm.lax/libmulredc.a/mulredc1_5.o .libs/libecm.lax/libmulredc.a/mulredc1_6.o .libs/libecm.lax/libmulredc.a/mulredc1_7.o .libs/libecm.lax/libmulredc.a/mulredc1_8.o .libs/libecm.lax/libmulredc.a/mulredc1_9.o .libs/libecm.lax/libmulredc.a/mulredc2.o .libs/libecm.lax/libmulredc.a/mulredc20.o .libs/libecm.lax/libmulredc.a/mulredc3.o .libs/libecm.lax/libmulredc.a/mulredc4.o .libs/libecm.lax/libmulredc.a/mulredc5.o .libs/libecm.lax/libmulredc.a/mulredc6.o .libs/libecm.lax/libmulredc.a/mulredc7.o .libs/libecm.lax/libmulredc.a/mulredc8.o .libs/libecm.lax/libmulredc.a/mulredc9.o 
/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/ranlib: file: .libs/libecm.a(libecm_la-cudawrapper.o) has no symbols
libtool: link: ranlib .libs/libecm.a
```



---

archive/issue_comments_373293.json:
```json
{
    "body": "<a id='comment:77'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e115141455e83eb0213a83d4153f72d80a767e2d\">e115141</a></td><td><code>GMP-ECM: #20385: Add another patch avoiding nested archives and rebase the previous on it.</code></td></tr></table>\n",
    "created_at": "2016-08-04T07:50:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373293",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:77'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e115141455e83eb0213a83d4153f72d80a767e2d">e115141</a></td><td><code>GMP-ECM: #20385: Add another patch avoiding nested archives and rebase the previous on it.</code></td></tr></table>




---

archive/issue_comments_373294.json:
```json
{
    "body": "**Changing commit** from \"[6741ee0e6e3d3570157fb453c54bcde586bffea8](https://github.com/sagemath/sagetrac-mirror/commit/6741ee0e6e3d3570157fb453c54bcde586bffea8)\" to \"[e115141455e83eb0213a83d4153f72d80a767e2d](https://github.com/sagemath/sagetrac-mirror/commit/e115141455e83eb0213a83d4153f72d80a767e2d)\".",
    "created_at": "2016-08-04T07:50:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373294",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[6741ee0e6e3d3570157fb453c54bcde586bffea8](https://github.com/sagemath/sagetrac-mirror/commit/6741ee0e6e3d3570157fb453c54bcde586bffea8)" to "[e115141455e83eb0213a83d4153f72d80a767e2d](https://github.com/sagemath/sagetrac-mirror/commit/e115141455e83eb0213a83d4153f72d80a767e2d)".



---

archive/issue_comments_373295.json:
```json
{
    "body": "<a id='comment:78'></a>\nPushed the new patch(es), and thereby deleted my comment I hadn't posted yet -- no idea what I had written... >8(  Thanks, HTTPS!\n\n... I seem to remember that I had speculated that `..._LIBADD = $(GMPLIB)` would presumably have worked if `$(GMPLIB)` was `libgmp.la`, as libtool indeed *unpacks* `$(MULREDCLIBRARY)` and adds *its contents* to the libecm archive.\n\n---\n\nStill have to see what harm my patch does to a *shared* libecm; it *may*get underlinked now.",
    "created_at": "2016-08-04T08:01:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373295",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:78'></a>
Pushed the new patch(es), and thereby deleted my comment I hadn't posted yet -- no idea what I had written... >8(  Thanks, HTTPS!

... I seem to remember that I had speculated that `..._LIBADD = $(GMPLIB)` would presumably have worked if `$(GMPLIB)` was `libgmp.la`, as libtool indeed *unpacks* `$(MULREDCLIBRARY)` and adds *its contents* to the libecm archive.

---

Still have to see what harm my patch does to a *shared* libecm; it *may*get underlinked now.



---

archive/issue_comments_373296.json:
```json
{
    "body": "<a id='comment:79'></a>\nReplying to [leif](#comment%3A78):\n> Pushed the new patch(es), and thereby deleted my comment I hadn't posted yet -- no idea what I had written... >8(  Thanks, HTTPS!\n> \n> ... I seem to remember that I had speculated that `..._LIBADD = $(GMPLIB)` would presumably have worked if `$(GMPLIB)` was `libgmp.la`, as libtool indeed *unpacks* `$(MULREDCLIBRARY)` and adds *its contents* to the libecm archive.\n> \n>   \n> ---\n> \n> Still have to see what harm my patch does to a *shared* libecm; it *may*get underlinked now.\n\n\nI wouldn't think so. Using `libgmp.la` means that it has to be present on the system. Relying on an installed, external to your project, `.la` file is extremely fragile. In any case I don't appear to have any `lib{gmp,mpir}.la` installed on OS X so it would fail - miserably.",
    "created_at": "2016-08-04T08:15:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373296",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:79'></a>
Replying to [leif](#comment%3A78):
> Pushed the new patch(es), and thereby deleted my comment I hadn't posted yet -- no idea what I had written... >8(  Thanks, HTTPS!
> 
> ... I seem to remember that I had speculated that `..._LIBADD = $(GMPLIB)` would presumably have worked if `$(GMPLIB)` was `libgmp.la`, as libtool indeed *unpacks* `$(MULREDCLIBRARY)` and adds *its contents* to the libecm archive.
> 
>   
> ---
> 
> Still have to see what harm my patch does to a *shared* libecm; it *may*get underlinked now.


I wouldn't think so. Using `libgmp.la` means that it has to be present on the system. Relying on an installed, external to your project, `.la` file is extremely fragile. In any case I don't appear to have any `lib{gmp,mpir}.la` installed on OS X so it would fail - miserably.



---

archive/issue_comments_373297.json:
```json
{
    "body": "<a id='comment:80'></a>\nReplying to [leif](#comment%3A78):\n> Still have to see what harm my patch does to a *shared* libecm; it *may* get underlinked now.\n\n\nExactly that happens.",
    "created_at": "2016-08-04T08:15:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373297",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:80'></a>
Replying to [leif](#comment%3A78):
> Still have to see what harm my patch does to a *shared* libecm; it *may* get underlinked now.


Exactly that happens.



---

archive/issue_comments_373298.json:
```json
{
    "body": "<a id='comment:81'></a>\n`libecm_la_LDFLAGS += $(GMPLIB)` to avoid underlinking?",
    "created_at": "2016-08-04T08:20:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373298",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:81'></a>
`libecm_la_LDFLAGS += $(GMPLIB)` to avoid underlinking?



---

archive/issue_comments_373299.json:
```json
{
    "body": "<a id='comment:82'></a>\nReplying to [leif](#comment%3A81):\n> `libecm_la_LDFLAGS += $(GMPLIB)` to avoid underlinking?\n\n\nRather `libecm_la_LDADD += $(GMPLIB)` I think.",
    "created_at": "2016-08-04T08:30:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373299",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:82'></a>
Replying to [leif](#comment%3A81):
> `libecm_la_LDFLAGS += $(GMPLIB)` to avoid underlinking?


Rather `libecm_la_LDADD += $(GMPLIB)` I think.



---

archive/issue_comments_373300.json:
```json
{
    "body": "<a id='comment:83'></a>\nReplying to [leif](#comment%3A80):\n> Replying to [leif](#comment%3A78):\n> > Still have to see what harm my patch does to a *shared* libecm; it *may* get underlinked now.\n\n> \n> Exactly that happens.\n\n\nBut AFAICS that wouldn't be a regression w.r.t. GMP-ECM 6.4.4 at least...",
    "created_at": "2016-08-04T08:35:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373300",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:83'></a>
Replying to [leif](#comment%3A80):
> Replying to [leif](#comment%3A78):
> > Still have to see what harm my patch does to a *shared* libecm; it *may* get underlinked now.

> 
> Exactly that happens.


But AFAICS that wouldn't be a regression w.r.t. GMP-ECM 6.4.4 at least...



---

archive/issue_comments_373301.json:
```json
{
    "body": "<a id='comment:84'></a>\nReplying to [leif](#comment%3A82):\n> Replying to [leif](#comment%3A81):\n> > `libecm_la_LDFLAGS += $(GMPLIB)` to avoid underlinking?\n\n> \n> Rather `libecm_la_LDADD += $(GMPLIB)` I think.\n\n\nFran\u00e7ois, could you test this (adding the latter to `Makefile.am`)?\n\nI don't have automake 1.15 installed...",
    "created_at": "2016-08-04T08:43:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373301",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:84'></a>
Replying to [leif](#comment%3A82):
> Replying to [leif](#comment%3A81):
> > `libecm_la_LDFLAGS += $(GMPLIB)` to avoid underlinking?

> 
> Rather `libecm_la_LDADD += $(GMPLIB)` I think.


François, could you test this (adding the latter to `Makefile.am`)?

I don't have automake 1.15 installed...



---

archive/issue_comments_373302.json:
```json
{
    "body": "<a id='comment:85'></a>\nJust looked at ecm's `configure.ac`. I am not impressed but I guess this is geared towards static linking. However the proper way tp link statically is not add `$path_to/libname.a`, if you have gcc you pass `-static`.\n\nI can test adding that stuff, give me a few minutes (i may suffer from interruptions from a 5 year old that needs to go to bed).",
    "created_at": "2016-08-04T08:49:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373302",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:85'></a>
Just looked at ecm's `configure.ac`. I am not impressed but I guess this is geared towards static linking. However the proper way tp link statically is not add `$path_to/libname.a`, if you have gcc you pass `-static`.

I can test adding that stuff, give me a few minutes (i may suffer from interruptions from a 5 year old that needs to go to bed).



---

archive/issue_comments_373303.json:
```json
{
    "body": "<a id='comment:86'></a>\nReplying to [fbissey](#comment%3A85):\n> Just looked at ecm's `configure.ac`. I am not impressed but I guess this is geared towards static linking. However the proper way to link statically is not add `$path_to/libname.a`, if you have gcc you pass `-static`.\n\n\nBut that apparently doesn't work on Darwin, as in your log we had:\n\n```\nchecking if gcc static flag -static works... no\n```\nNot sure what libtool magic offers.\n\nPassing `foo.a` is certainly safer and more portable.",
    "created_at": "2016-08-04T08:58:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373303",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:86'></a>
Replying to [fbissey](#comment%3A85):
> Just looked at ecm's `configure.ac`. I am not impressed but I guess this is geared towards static linking. However the proper way to link statically is not add `$path_to/libname.a`, if you have gcc you pass `-static`.


But that apparently doesn't work on Darwin, as in your log we had:

```
checking if gcc static flag -static works... no
```
Not sure what libtool magic offers.

Passing `foo.a` is certainly safer and more portable.



---

archive/issue_comments_373304.json:
```json
{
    "body": "<a id='comment:87'></a>\nOne to bed. libtool as an `-all-static` mode for linking program that use only static libraries, not sure how it applies on OS X. But you cannot do that with libraries. You don't link static libraries, you just just `ar`+`ranlib` or equivalent. Folding one library in another is probably frowned on by libtool.",
    "created_at": "2016-08-04T09:13:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373304",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:87'></a>
One to bed. libtool as an `-all-static` mode for linking program that use only static libraries, not sure how it applies on OS X. But you cannot do that with libraries. You don't link static libraries, you just just `ar`+`ranlib` or equivalent. Folding one library in another is probably frowned on by libtool.



---

archive/issue_comments_373305.json:
```json
{
    "body": "<a id='comment:88'></a>\nReplying to [leif](#comment%3A84):\n> Replying to [leif](#comment%3A82):\n> > Replying to [leif](#comment%3A81):\n> > > `libecm_la_LDFLAGS += $(GMPLIB)` to avoid underlinking?\n\n> > \n> > Rather `libecm_la_LDADD += $(GMPLIB)` I think.\n\n> \n> Fran\u00e7ois, could you test this (adding the latter to `Makefile.am`)?\n> \n> I don't have automake 1.15 installed...\n\n\n\nDidn't really like it\n\n```\n***** automake *****\n***** PWD: /scratch2/portage/sci-mathematics/gmp-ecm-7.0.3-r1/work/ecm-7.0.3\n***** automake --add-missing --copy --force-missing\n\nconfigure.ac:161: installing './compile'\nconfigure.ac:8: installing './missing'\nMakefile.am:61: error: libecm_la_LDADD must be set with '=' before using '+='\nMakefile.am:61: error: use 'libecm_la_LIBADD', not 'libecm_la_LDADD'\nMakefile.am: installing './depcomp'\nMakefile.am:61: warning: variable 'libecm_la_LDADD' is defined but no program or\nMakefile.am:61: library has 'libecm_la' as canonical name (possible typo)\n```\nUsing `=` instead of `+=` doesn't really help the second message\n\n```\n***** automake *****\n***** PWD: /scratch2/portage/sci-mathematics/gmp-ecm-7.0.3-r1/work/ecm-7.0.3\n***** automake --add-missing --copy --force-missing\n\nconfigure.ac:161: installing './compile'\nconfigure.ac:8: installing './missing'\nMakefile.am:61: error: use 'libecm_la_LIBADD', not 'libecm_la_LDADD'\nMakefile.am: installing './depcomp'\nMakefile.am:61: warning: variable 'libecm_la_LDADD' is defined but no program or\nMakefile.am:61: library has 'libecm_la' as canonical name (possible typo)\n```",
    "created_at": "2016-08-04T09:34:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373305",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:88'></a>
Replying to [leif](#comment%3A84):
> Replying to [leif](#comment%3A82):
> > Replying to [leif](#comment%3A81):
> > > `libecm_la_LDFLAGS += $(GMPLIB)` to avoid underlinking?

> > 
> > Rather `libecm_la_LDADD += $(GMPLIB)` I think.

> 
> François, could you test this (adding the latter to `Makefile.am`)?
> 
> I don't have automake 1.15 installed...



Didn't really like it

```
***** automake *****
***** PWD: /scratch2/portage/sci-mathematics/gmp-ecm-7.0.3-r1/work/ecm-7.0.3
***** automake --add-missing --copy --force-missing

configure.ac:161: installing './compile'
configure.ac:8: installing './missing'
Makefile.am:61: error: libecm_la_LDADD must be set with '=' before using '+='
Makefile.am:61: error: use 'libecm_la_LIBADD', not 'libecm_la_LDADD'
Makefile.am: installing './depcomp'
Makefile.am:61: warning: variable 'libecm_la_LDADD' is defined but no program or
Makefile.am:61: library has 'libecm_la' as canonical name (possible typo)
```
Using `=` instead of `+=` doesn't really help the second message

```
***** automake *****
***** PWD: /scratch2/portage/sci-mathematics/gmp-ecm-7.0.3-r1/work/ecm-7.0.3
***** automake --add-missing --copy --force-missing

configure.ac:161: installing './compile'
configure.ac:8: installing './missing'
Makefile.am:61: error: use 'libecm_la_LIBADD', not 'libecm_la_LDADD'
Makefile.am: installing './depcomp'
Makefile.am:61: warning: variable 'libecm_la_LDADD' is defined but no program or
Makefile.am:61: library has 'libecm_la' as canonical name (possible typo)
```



---

archive/issue_comments_373306.json:
```json
{
    "body": "<a id='comment:89'></a>\nWhile I've now installed automake 1.15, it removes\n\n```\nrunstatedir = @runstatedir@\n```\nfrom `Makefile.in` (without me having made any changes to `Makefile.am`)...",
    "created_at": "2016-08-04T09:55:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373306",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:89'></a>
While I've now installed automake 1.15, it removes

```
runstatedir = @runstatedir@
```
from `Makefile.in` (without me having made any changes to `Makefile.am`)...



---

archive/issue_comments_373307.json:
```json
{
    "body": "<a id='comment:90'></a>\nThat's the bit I don't like in `configure.ac`:\n\n```\nGMPLDFLAGS=\"\"\nif test -d \"$with_gmp_lib\"; then\n  GMPLDFLAGS=\"-L$with_gmp_lib\"\nfi\nGMPLIB=\"-lgmp\"\nif test \"x$enable_shared\" != xyes; then\n  if test -r \"$with_gmp_lib/libgmp.a\"; then\n    GMPLIB=\"$with_gmp_lib/libgmp.a\"  <==================================\n    dnl Don't need -L flag since we give full path to libgmp.a\n    GMPLDFLAGS=\"\"\n  fi\nfi\nAC_SUBST([GMPLIB])\nLDFLAGS=\"$LDFLAGS $GMPLDFLAGS\"\n```",
    "created_at": "2016-08-04T09:57:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373307",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:90'></a>
That's the bit I don't like in `configure.ac`:

```
GMPLDFLAGS=""
if test -d "$with_gmp_lib"; then
  GMPLDFLAGS="-L$with_gmp_lib"
fi
GMPLIB="-lgmp"
if test "x$enable_shared" != xyes; then
  if test -r "$with_gmp_lib/libgmp.a"; then
    GMPLIB="$with_gmp_lib/libgmp.a"  <==================================
    dnl Don't need -L flag since we give full path to libgmp.a
    GMPLDFLAGS=""
  fi
fi
AC_SUBST([GMPLIB])
LDFLAGS="$LDFLAGS $GMPLDFLAGS"
```



---

archive/issue_comments_373308.json:
```json
{
    "body": "<a id='comment:91'></a>\nReplying to [fbissey](#comment%3A87):\n> You don't link static libraries, you just just `ar`+`ranlib` or equivalent.\n> Folding one library in another is probably frowned on by libtool.\n\n\nNo, that's exactly what it does with `$(MULREDCLIBRARY)` (aka `libmulredc.[l]a`), and it doesn't nest the archive, but \"flattens\" both libraries / archives into one.\n\n(And there's also `ld -r ...`, but merging all object files into one is even more crude and will not always work.)",
    "created_at": "2016-08-04T10:15:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373308",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:91'></a>
Replying to [fbissey](#comment%3A87):
> You don't link static libraries, you just just `ar`+`ranlib` or equivalent.
> Folding one library in another is probably frowned on by libtool.


No, that's exactly what it does with `$(MULREDCLIBRARY)` (aka `libmulredc.[l]a`), and it doesn't nest the archive, but "flattens" both libraries / archives into one.

(And there's also `ld -r ...`, but merging all object files into one is even more crude and will not always work.)



---

archive/issue_comments_373309.json:
```json
{
    "body": "<a id='comment:92'></a>\nReplying to [fbissey](#comment%3A90):\n> That's the bit I don't like in `configure.ac`:\n> \n> ```\n> GMPLDFLAGS=\"\"\n> if test -d \"$with_gmp_lib\"; then\n>   GMPLDFLAGS=\"-L$with_gmp_lib\"\n> fi\n> GMPLIB=\"-lgmp\"\n> if test \"x$enable_shared\" != xyes; then\n>   if test -r \"$with_gmp_lib/libgmp.a\"; then\n>     GMPLIB=\"$with_gmp_lib/libgmp.a\"  <==================================\n>     dnl Don't need -L flag since we give full path to libgmp.a\n>     GMPLDFLAGS=\"\"\n>   fi\n> fi\n> AC_SUBST([GMPLIB])\n> LDFLAGS=\"$LDFLAGS $GMPLDFLAGS\"\n> ```\n\n\nWell add\n\n```\n  if test -r \"$with_gmp_lib/libgmp.la\"; then\n    GMPLIB=\"$with_gmp_lib/libgmp.la\" # That would have worked on Darwin as well.\n  elif test -r \"$with_gmp_lib/libgmp.a\"; then\n    GMPLIB=\"$with_gmp_lib/libgmp.a\"\n  ...\n```\n\nThe meaning of `--enable-shared` isn't always clear.\n\nOf course, you want a shared library (also) built, but that doesn't necessarily imply you want it itself to be dynamically linked (to libraries it depends on, no matter whether also built by the package or externally supplied).\n\nI'd add an option `--prefer-static[-gmp]`, say, in addition.",
    "created_at": "2016-08-04T10:26:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373309",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:92'></a>
Replying to [fbissey](#comment%3A90):
> That's the bit I don't like in `configure.ac`:
> 
> ```
> GMPLDFLAGS=""
> if test -d "$with_gmp_lib"; then
>   GMPLDFLAGS="-L$with_gmp_lib"
> fi
> GMPLIB="-lgmp"
> if test "x$enable_shared" != xyes; then
>   if test -r "$with_gmp_lib/libgmp.a"; then
>     GMPLIB="$with_gmp_lib/libgmp.a"  <==================================
>     dnl Don't need -L flag since we give full path to libgmp.a
>     GMPLDFLAGS=""
>   fi
> fi
> AC_SUBST([GMPLIB])
> LDFLAGS="$LDFLAGS $GMPLDFLAGS"
> ```


Well add

```
  if test -r "$with_gmp_lib/libgmp.la"; then
    GMPLIB="$with_gmp_lib/libgmp.la" # That would have worked on Darwin as well.
  elif test -r "$with_gmp_lib/libgmp.a"; then
    GMPLIB="$with_gmp_lib/libgmp.a"
  ...
```

The meaning of `--enable-shared` isn't always clear.

Of course, you want a shared library (also) built, but that doesn't necessarily imply you want it itself to be dynamically linked (to libraries it depends on, no matter whether also built by the package or externally supplied).

I'd add an option `--prefer-static[-gmp]`, say, in addition.



---

archive/issue_comments_373310.json:
```json
{
    "body": "<a id='comment:93'></a>\nP.S.:  IMHO the real bug in what you pointed out is that ECM allows to build static and dynamic libraries *at the same time*, so it should (if present) define and use both `GMPLIB` (static) and `GMPDYLIB` (say, shared).",
    "created_at": "2016-08-04T10:30:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373310",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:93'></a>
P.S.:  IMHO the real bug in what you pointed out is that ECM allows to build static and dynamic libraries *at the same time*, so it should (if present) define and use both `GMPLIB` (static) and `GMPDYLIB` (say, shared).



---

archive/issue_comments_373311.json:
```json
{
    "body": "<a id='comment:94'></a>\nI spent some time with the libtool mailing list and done some experiments. If you want to have a full static binary (program only), you will have to add `-all-static` to ${prog}_LDFLAGS. If you miss one of dependent library in static form: boom\n\n```\n/bin/sh ./libtool  --tag=CC   --mode=link x86_64-pc-linux-gnu-gcc  -g -O1 -march=native -pipe -ggdb -all-static -Wl,-O1 -Wl,--as-needed -O1 -march=native -pipe -ggdb  -o ecm ecm-auxi.o ecm-b1_ainc.o ecm-candi.o ecm-eval.o ecm-main.o ecm-resume.o ecm-getprime_r.o aprtcle/ecm-mpz_aprcl.o ecm-memusage.o libecm.la -lgmp -lrt -lm -lm -lm -lm -lm  \n/bin/sh ./libtool  --tag=CC   --mode=link x86_64-pc-linux-gnu-gcc  -lpthread -O1 -march=native -pipe -ggdb  -Wl,-O1 -Wl,--as-needed -O1 -march=native -pipe -ggdb  -o ecmfactor ecmfactor-ecmfactor.o libecm.la -lgmp -lrt -lm -lm -lm -lm -lm  \nlibtool: link: x86_64-pc-linux-gnu-gcc -O1 -march=native -pipe -ggdb -Wl,-O1 -O1 -march=native -pipe -ggdb -o ecmfactor ecmfactor-ecmfactor.o  -lpthread -Wl,--as-needed ./.libs/libecm.a -lgmp -lrt -lm\nlibtool: link: x86_64-pc-linux-gnu-gcc -g -O1 -march=native -pipe -ggdb -static -Wl,-O1 -O1 -march=native -pipe -ggdb -o ecm ecm-auxi.o ecm-b1_ainc.o ecm-candi.o ecm-eval.o ecm-main.o ecm-resume.o ecm-getprime_r.o aprtcle/ecm-mpz_aprcl.o ecm-memusage.o  -Wl,--as-needed ./.libs/libecm.a -lgmp -lrt -lm\n/usr/lib/gcc/x86_64-pc-linux-gnu/5.3.0/../../../../x86_64-pc-linux-gnu/bin/ld: cannot find -lgmp\ncollect2: error: ld returned 1 exit status\n```\n\nIn a normal scenario it is ok to build both static and dynamic at the same time. The dynamic library can be linked to the dependent libraries and the static one usually doesn't incorporate the dependent libraries (whatever you want to call the process). \n\nThe `--enable-{shared,static}` are concerning the building of libraries only. It doesn't say anything about programs which will be linked the default way unless you take steps.\n\nYou are right there is problem here when you try to build both static and dynamic libraries because the static one can use a deifferent recipe from normal if a static gmp is also available. At that point we have a break down.\n\nThe intent is probably to really have a mega-archive libecm.a including libgmp.a - while it is ok to incorporate internal libraies it is doubtful to do it with external ones. The best, sane, option I can offer is to compile the `ecm` executable all static if libgmp.a is available.",
    "created_at": "2016-08-04T11:10:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373311",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:94'></a>
I spent some time with the libtool mailing list and done some experiments. If you want to have a full static binary (program only), you will have to add `-all-static` to ${prog}_LDFLAGS. If you miss one of dependent library in static form: boom

```
/bin/sh ./libtool  --tag=CC   --mode=link x86_64-pc-linux-gnu-gcc  -g -O1 -march=native -pipe -ggdb -all-static -Wl,-O1 -Wl,--as-needed -O1 -march=native -pipe -ggdb  -o ecm ecm-auxi.o ecm-b1_ainc.o ecm-candi.o ecm-eval.o ecm-main.o ecm-resume.o ecm-getprime_r.o aprtcle/ecm-mpz_aprcl.o ecm-memusage.o libecm.la -lgmp -lrt -lm -lm -lm -lm -lm  
/bin/sh ./libtool  --tag=CC   --mode=link x86_64-pc-linux-gnu-gcc  -lpthread -O1 -march=native -pipe -ggdb  -Wl,-O1 -Wl,--as-needed -O1 -march=native -pipe -ggdb  -o ecmfactor ecmfactor-ecmfactor.o libecm.la -lgmp -lrt -lm -lm -lm -lm -lm  
libtool: link: x86_64-pc-linux-gnu-gcc -O1 -march=native -pipe -ggdb -Wl,-O1 -O1 -march=native -pipe -ggdb -o ecmfactor ecmfactor-ecmfactor.o  -lpthread -Wl,--as-needed ./.libs/libecm.a -lgmp -lrt -lm
libtool: link: x86_64-pc-linux-gnu-gcc -g -O1 -march=native -pipe -ggdb -static -Wl,-O1 -O1 -march=native -pipe -ggdb -o ecm ecm-auxi.o ecm-b1_ainc.o ecm-candi.o ecm-eval.o ecm-main.o ecm-resume.o ecm-getprime_r.o aprtcle/ecm-mpz_aprcl.o ecm-memusage.o  -Wl,--as-needed ./.libs/libecm.a -lgmp -lrt -lm
/usr/lib/gcc/x86_64-pc-linux-gnu/5.3.0/../../../../x86_64-pc-linux-gnu/bin/ld: cannot find -lgmp
collect2: error: ld returned 1 exit status
```

In a normal scenario it is ok to build both static and dynamic at the same time. The dynamic library can be linked to the dependent libraries and the static one usually doesn't incorporate the dependent libraries (whatever you want to call the process). 

The `--enable-{shared,static}` are concerning the building of libraries only. It doesn't say anything about programs which will be linked the default way unless you take steps.

You are right there is problem here when you try to build both static and dynamic libraries because the static one can use a deifferent recipe from normal if a static gmp is also available. At that point we have a break down.

The intent is probably to really have a mega-archive libecm.a including libgmp.a - while it is ok to incorporate internal libraies it is doubtful to do it with external ones. The best, sane, option I can offer is to compile the `ecm` executable all static if libgmp.a is available.



---

archive/issue_comments_373312.json:
```json
{
    "body": "<a id='comment:95'></a>\nI think this is (almost) what we want:\n\n```diff\n#20385:  After having removed $(GMPLIB) from libecm_la_LIBADD,\nput it into libecm_la_LDFLAGS again, such that a dynamic library\n(if built) won't be underlinked.\n\n(I think this was ECM's intention.)\n\n\n--- ecm-7.0.3/Makefile.am\t2016-08-04 01:10:13.752113843 -0700\n+++ ecm-7.0.3/Makefile.am\t2016-08-04 02:50:06.931521105 -0700\n@@ -59,6 +59,7 @@\n   ecm_LDFLAGS = $(CUDARPATH)\n endif\n # libecm_la_LIBADD += $(GMPLIB)\n+libecm_la_LDFLAGS += $(GMPLIB)\n \n bin_PROGRAMS = ecm\n noinst_PROGRAMS = tune ecmfactor bench_mulredc aprcl\n--- ecm-7.0.3/Makefile.in\t2016-08-04 01:10:13.752113843 -0700\n+++ ecm-7.0.3/Makefile.in\t2016-08-04 02:50:15.254613020 -0700\n@@ -714,8 +712,9 @@\n # www.gnu.org/software/libtool/manual/html_node/Updating-version-info.html\n # If any interfaces have been added, removed, or changed since the last\n # update, increment current, and set revision to 0.\n+# libecm_la_LIBADD += $(GMPLIB)\n libecm_la_LDFLAGS = $(LIBECM_LDFLAGS) -version-info 1:0:0 -g \\\n-\t-Wl,-z,noexecstack $(am__append_5)\n+\t-Wl,-z,noexecstack $(am__append_5) $(GMPLIB)\n libecm_la_LIBADD = $(MULREDCLIBRARY) $(am__append_4)\n @WANT_GPU_TRUE@ecm_LDFLAGS = $(CUDARPATH)\n @WITH_GWNUM_TRUE@ecm_LDFLAGS = $(AM_LDFLAGS) -Wl,gwdata.ld\n```\n\n(Without modifying `configure.ac` [yet] at least.)",
    "created_at": "2016-08-04T11:10:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373312",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:95'></a>
I think this is (almost) what we want:

```diff
#20385:  After having removed $(GMPLIB) from libecm_la_LIBADD,
put it into libecm_la_LDFLAGS again, such that a dynamic library
(if built) won't be underlinked.

(I think this was ECM's intention.)


--- ecm-7.0.3/Makefile.am	2016-08-04 01:10:13.752113843 -0700
+++ ecm-7.0.3/Makefile.am	2016-08-04 02:50:06.931521105 -0700
@@ -59,6 +59,7 @@
   ecm_LDFLAGS = $(CUDARPATH)
 endif
 # libecm_la_LIBADD += $(GMPLIB)
+libecm_la_LDFLAGS += $(GMPLIB)
 
 bin_PROGRAMS = ecm
 noinst_PROGRAMS = tune ecmfactor bench_mulredc aprcl
--- ecm-7.0.3/Makefile.in	2016-08-04 01:10:13.752113843 -0700
+++ ecm-7.0.3/Makefile.in	2016-08-04 02:50:15.254613020 -0700
@@ -714,8 +712,9 @@
 # www.gnu.org/software/libtool/manual/html_node/Updating-version-info.html
 # If any interfaces have been added, removed, or changed since the last
 # update, increment current, and set revision to 0.
+# libecm_la_LIBADD += $(GMPLIB)
 libecm_la_LDFLAGS = $(LIBECM_LDFLAGS) -version-info 1:0:0 -g \
-	-Wl,-z,noexecstack $(am__append_5)
+	-Wl,-z,noexecstack $(am__append_5) $(GMPLIB)
 libecm_la_LIBADD = $(MULREDCLIBRARY) $(am__append_4)
 @WANT_GPU_TRUE@ecm_LDFLAGS = $(CUDARPATH)
 @WITH_GWNUM_TRUE@ecm_LDFLAGS = $(AM_LDFLAGS) -Wl,gwdata.ld
```

(Without modifying `configure.ac` [yet] at least.)



---

archive/issue_comments_373313.json:
```json
{
    "body": "<a id='comment:96'></a>\nIn `Makefile.am` you want to change line 52 which already has a definition for `libecm_la_LDFLAGS`.",
    "created_at": "2016-08-04T11:17:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373313",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:96'></a>
In `Makefile.am` you want to change line 52 which already has a definition for `libecm_la_LDFLAGS`.



---

archive/issue_comments_373314.json:
```json
{
    "body": "<a id='comment:97'></a>\nWe should really ask upstream what they want(ed) or intend(ed), for example it IMHO makes sense to build statically linked programs (or incorporate libgmp.a) provided a static libgmp is available, unless `--disable-static` was given.\n\nBuilding \"everything\" dynamically linked just because `--enable-shared` was (also) given IMHO doesn't make sense here.\n\n(And I'd actually incorporate libgmp.a into libecm.so unless specified otherwise, which would require a new `configure` option.)",
    "created_at": "2016-08-04T11:29:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373314",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:97'></a>
We should really ask upstream what they want(ed) or intend(ed), for example it IMHO makes sense to build statically linked programs (or incorporate libgmp.a) provided a static libgmp is available, unless `--disable-static` was given.

Building "everything" dynamically linked just because `--enable-shared` was (also) given IMHO doesn't make sense here.

(And I'd actually incorporate libgmp.a into libecm.so unless specified otherwise, which would require a new `configure` option.)



---

archive/issue_comments_373315.json:
```json
{
    "body": "<a id='comment:98'></a>\nReplying to [fbissey](#comment%3A96):\n> In `Makefile.am` you want to change line 52 which already has a definition for `libecm_la_LDFLAGS`.\n\n\nOooops, forgot a plus, but for whatever reason, it worked for me (with version info etc.):\n\n```\n/bin/bash ./libtool  --tag=CC   --mode=link gcc-6.1  -g -march=native -g -O3   -version-info 1:0:0 -g -Wl,-z,noexecstack  -lgmp -L/data/Sage/release/devel/sage-7.3.rc0-gcc-6.1.0/local/lib -Wl,-rpath,/data/Sage/release/devel/sage-7.3.rc0-gcc-6.1.0/local/lib  -L/data/Sage/release/devel/sage-7.3.rc0-gcc-6.1.0/local/lib -o libecm.la -rpath /data/Sage/release/devel/sage-7.3.rc0-gcc-6.1.0/local/lib libecm_la-ecm.lo libecm_la-ecm2.lo libecm_la-pm1.lo libecm_la-pp1.lo libecm_la-getprime_r.lo libecm_la-listz.lo libecm_la-lucas.lo libecm_la-stage2.lo libecm_la-mpmod.lo libecm_la-mul_lo.lo libecm_la-polyeval.lo libecm_la-median.lo libecm_la-schoen_strass.lo libecm_la-ks-multiply.lo libecm_la-rho.lo libecm_la-bestd.lo libecm_la-auxlib.lo libecm_la-random.lo libecm_la-factor.lo libecm_la-sp.lo libecm_la-spv.lo libecm_la-spm.lo libecm_la-mpzspm.lo libecm_la-mpzspv.lo libecm_la-ntt_gfp.lo libecm_la-ecm_ntt.lo libecm_la-pm1fs2.lo libecm_la-sets_long.lo libecm_la-auxarith.lo libecm_la-batch.lo libecm_la-parametrizations.lo libecm_la-cudawrapper.lo aprtcle/libecm_la-mpz_aprcl.lo   ./x86_64/libmulredc.la  -lrt -lm -lm -lm -lm -lm\nlibtool: link: gcc-6.1 -shared  -fPIC -DPIC  .libs/libecm_la-ecm.o .libs/libecm_la-ecm2.o .libs/libecm_la-pm1.o .libs/libecm_la-pp1.o .libs/libecm_la-getprime_r.o .libs/libecm_la-listz.o .libs/libecm_la-lucas.o .libs/libecm_la-stage2.o .libs/libecm_la-mpmod.o .libs/libecm_la-mul_lo.o .libs/libecm_la-polyeval.o .libs/libecm_la-median.o .libs/libecm_la-schoen_strass.o .libs/libecm_la-ks-multiply.o .libs/libecm_la-rho.o .libs/libecm_la-bestd.o .libs/libecm_la-auxlib.o .libs/libecm_la-random.o .libs/libecm_la-factor.o .libs/libecm_la-sp.o .libs/libecm_la-spv.o .libs/libecm_la-spm.o .libs/libecm_la-mpzspm.o .libs/libecm_la-mpzspv.o .libs/libecm_la-ntt_gfp.o .libs/libecm_la-ecm_ntt.o .libs/libecm_la-pm1fs2.o .libs/libecm_la-sets_long.o .libs/libecm_la-auxarith.o .libs/libecm_la-batch.o .libs/libecm_la-parametrizations.o .libs/libecm_la-cudawrapper.o aprtcle/.libs/libecm_la-mpz_aprcl.o  -Wl,--whole-archive ./x86_64/.libs/libmulredc.a -Wl,--no-whole-archive  -lgmp -L/data/Sage/release/devel/sage-7.3.rc0-gcc-6.1.0/local/lib -lrt -lm  -g -march=native -g -O3 -g -Wl,-z -Wl,noexecstack -Wl,-rpath -Wl,/data/Sage/release/devel/sage-7.3.rc0-gcc-6.1.0/local/lib   -Wl,-soname -Wl,libecm.so.1 -o .libs/libecm.so.1.0.0\nlibtool: link: (cd \".libs\" && rm -f \"libecm.so.1\" && ln -s \"libecm.so.1.0.0\" \"libecm.so.1\")\nlibtool: link: (cd \".libs\" && rm -f \"libecm.so\" && ln -s \"libecm.so.1.0.0\" \"libecm.so\")\nlibtool: link: (cd .libs/libecm.lax/libmulredc.a && ar x \"/tmp/sage-build-tmp/ecm-7.0.3/src/./x86_64/.libs/libmulredc.a\")\nlibtool: link: ar cru .libs/libecm.a  libecm_la-ecm.o libecm_la-ecm2.o libecm_la-pm1.o libecm_la-pp1.o libecm_la-getprime_r.o libecm_la-listz.o libecm_la-lucas.o libecm_la-stage2.o libecm_la-mpmod.o libecm_la-mul_lo.o libecm_la-polyeval.o libecm_la-median.o libecm_la-schoen_strass.o libecm_la-ks-multiply.o libecm_la-rho.o libecm_la-bestd.o libecm_la-auxlib.o libecm_la-random.o libecm_la-factor.o libecm_la-sp.o libecm_la-spv.o libecm_la-spm.o libecm_la-mpzspm.o libecm_la-mpzspv.o libecm_la-ntt_gfp.o libecm_la-ecm_ntt.o libecm_la-pm1fs2.o libecm_la-sets_long.o libecm_la-auxarith.o libecm_la-batch.o libecm_la-parametrizations.o libecm_la-cudawrapper.o aprtcle/libecm_la-mpz_aprcl.o  .libs/libecm.lax/libmulredc.a/mulredc1.o .libs/libecm.lax/libmulredc.a/mulredc10.o .libs/libecm.lax/libmulredc.a/mulredc11.o .libs/libecm.lax/libmulredc.a/mulredc12.o .libs/libecm.lax/libmulredc.a/mulredc13.o .libs/libecm.lax/libmulredc.a/mulredc14.o .libs/libecm.lax/libmulredc.a/mulredc15.o .libs/libecm.lax/libmulredc.a/mulredc16.o .libs/libecm.lax/libmulredc.a/mulredc17.o .libs/libecm.lax/libmulredc.a/mulredc18.o .libs/libecm.lax/libmulredc.a/mulredc19.o .libs/libecm.lax/libmulredc.a/mulredc1_10.o .libs/libecm.lax/libmulredc.a/mulredc1_11.o .libs/libecm.lax/libmulredc.a/mulredc1_12.o .libs/libecm.lax/libmulredc.a/mulredc1_13.o .libs/libecm.lax/libmulredc.a/mulredc1_14.o .libs/libecm.lax/libmulredc.a/mulredc1_15.o .libs/libecm.lax/libmulredc.a/mulredc1_16.o .libs/libecm.lax/libmulredc.a/mulredc1_17.o .libs/libecm.lax/libmulredc.a/mulredc1_18.o .libs/libecm.lax/libmulredc.a/mulredc1_19.o .libs/libecm.lax/libmulredc.a/mulredc1_2.o .libs/libecm.lax/libmulredc.a/mulredc1_20.o .libs/libecm.lax/libmulredc.a/mulredc1_3.o .libs/libecm.lax/libmulredc.a/mulredc1_4.o .libs/libecm.lax/libmulredc.a/mulredc1_5.o .libs/libecm.lax/libmulredc.a/mulredc1_6.o .libs/libecm.lax/libmulredc.a/mulredc1_7.o .libs/libecm.lax/libmulredc.a/mulredc1_8.o .libs/libecm.lax/libmulredc.a/mulredc1_9.o .libs/libecm.lax/libmulredc.a/mulredc2.o .libs/libecm.lax/libmulredc.a/mulredc20.o .libs/libecm.lax/libmulredc.a/mulredc3.o .libs/libecm.lax/libmulredc.a/mulredc4.o .libs/libecm.lax/libmulredc.a/mulredc5.o .libs/libecm.lax/libmulredc.a/mulredc6.o .libs/libecm.lax/libmulredc.a/mulredc7.o .libs/libecm.lax/libmulredc.a/mulredc8.o .libs/libecm.lax/libmulredc.a/mulredc9.o\nlibtool: link: ranlib .libs/libecm.a\nlibtool: link: rm -fr .libs/libecm.lax\nlibtool: link: ( cd \".libs\" && rm -f \"libecm.la\" && ln -s \"../libecm.la\" \"libecm.la\" )\n```\n(`env ECM_CONFIGURE=\"--enable-shared\" ./sage -f ecm`)",
    "created_at": "2016-08-04T11:39:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373315",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:98'></a>
Replying to [fbissey](#comment%3A96):
> In `Makefile.am` you want to change line 52 which already has a definition for `libecm_la_LDFLAGS`.


Oooops, forgot a plus, but for whatever reason, it worked for me (with version info etc.):

```
/bin/bash ./libtool  --tag=CC   --mode=link gcc-6.1  -g -march=native -g -O3   -version-info 1:0:0 -g -Wl,-z,noexecstack  -lgmp -L/data/Sage/release/devel/sage-7.3.rc0-gcc-6.1.0/local/lib -Wl,-rpath,/data/Sage/release/devel/sage-7.3.rc0-gcc-6.1.0/local/lib  -L/data/Sage/release/devel/sage-7.3.rc0-gcc-6.1.0/local/lib -o libecm.la -rpath /data/Sage/release/devel/sage-7.3.rc0-gcc-6.1.0/local/lib libecm_la-ecm.lo libecm_la-ecm2.lo libecm_la-pm1.lo libecm_la-pp1.lo libecm_la-getprime_r.lo libecm_la-listz.lo libecm_la-lucas.lo libecm_la-stage2.lo libecm_la-mpmod.lo libecm_la-mul_lo.lo libecm_la-polyeval.lo libecm_la-median.lo libecm_la-schoen_strass.lo libecm_la-ks-multiply.lo libecm_la-rho.lo libecm_la-bestd.lo libecm_la-auxlib.lo libecm_la-random.lo libecm_la-factor.lo libecm_la-sp.lo libecm_la-spv.lo libecm_la-spm.lo libecm_la-mpzspm.lo libecm_la-mpzspv.lo libecm_la-ntt_gfp.lo libecm_la-ecm_ntt.lo libecm_la-pm1fs2.lo libecm_la-sets_long.lo libecm_la-auxarith.lo libecm_la-batch.lo libecm_la-parametrizations.lo libecm_la-cudawrapper.lo aprtcle/libecm_la-mpz_aprcl.lo   ./x86_64/libmulredc.la  -lrt -lm -lm -lm -lm -lm
libtool: link: gcc-6.1 -shared  -fPIC -DPIC  .libs/libecm_la-ecm.o .libs/libecm_la-ecm2.o .libs/libecm_la-pm1.o .libs/libecm_la-pp1.o .libs/libecm_la-getprime_r.o .libs/libecm_la-listz.o .libs/libecm_la-lucas.o .libs/libecm_la-stage2.o .libs/libecm_la-mpmod.o .libs/libecm_la-mul_lo.o .libs/libecm_la-polyeval.o .libs/libecm_la-median.o .libs/libecm_la-schoen_strass.o .libs/libecm_la-ks-multiply.o .libs/libecm_la-rho.o .libs/libecm_la-bestd.o .libs/libecm_la-auxlib.o .libs/libecm_la-random.o .libs/libecm_la-factor.o .libs/libecm_la-sp.o .libs/libecm_la-spv.o .libs/libecm_la-spm.o .libs/libecm_la-mpzspm.o .libs/libecm_la-mpzspv.o .libs/libecm_la-ntt_gfp.o .libs/libecm_la-ecm_ntt.o .libs/libecm_la-pm1fs2.o .libs/libecm_la-sets_long.o .libs/libecm_la-auxarith.o .libs/libecm_la-batch.o .libs/libecm_la-parametrizations.o .libs/libecm_la-cudawrapper.o aprtcle/.libs/libecm_la-mpz_aprcl.o  -Wl,--whole-archive ./x86_64/.libs/libmulredc.a -Wl,--no-whole-archive  -lgmp -L/data/Sage/release/devel/sage-7.3.rc0-gcc-6.1.0/local/lib -lrt -lm  -g -march=native -g -O3 -g -Wl,-z -Wl,noexecstack -Wl,-rpath -Wl,/data/Sage/release/devel/sage-7.3.rc0-gcc-6.1.0/local/lib   -Wl,-soname -Wl,libecm.so.1 -o .libs/libecm.so.1.0.0
libtool: link: (cd ".libs" && rm -f "libecm.so.1" && ln -s "libecm.so.1.0.0" "libecm.so.1")
libtool: link: (cd ".libs" && rm -f "libecm.so" && ln -s "libecm.so.1.0.0" "libecm.so")
libtool: link: (cd .libs/libecm.lax/libmulredc.a && ar x "/tmp/sage-build-tmp/ecm-7.0.3/src/./x86_64/.libs/libmulredc.a")
libtool: link: ar cru .libs/libecm.a  libecm_la-ecm.o libecm_la-ecm2.o libecm_la-pm1.o libecm_la-pp1.o libecm_la-getprime_r.o libecm_la-listz.o libecm_la-lucas.o libecm_la-stage2.o libecm_la-mpmod.o libecm_la-mul_lo.o libecm_la-polyeval.o libecm_la-median.o libecm_la-schoen_strass.o libecm_la-ks-multiply.o libecm_la-rho.o libecm_la-bestd.o libecm_la-auxlib.o libecm_la-random.o libecm_la-factor.o libecm_la-sp.o libecm_la-spv.o libecm_la-spm.o libecm_la-mpzspm.o libecm_la-mpzspv.o libecm_la-ntt_gfp.o libecm_la-ecm_ntt.o libecm_la-pm1fs2.o libecm_la-sets_long.o libecm_la-auxarith.o libecm_la-batch.o libecm_la-parametrizations.o libecm_la-cudawrapper.o aprtcle/libecm_la-mpz_aprcl.o  .libs/libecm.lax/libmulredc.a/mulredc1.o .libs/libecm.lax/libmulredc.a/mulredc10.o .libs/libecm.lax/libmulredc.a/mulredc11.o .libs/libecm.lax/libmulredc.a/mulredc12.o .libs/libecm.lax/libmulredc.a/mulredc13.o .libs/libecm.lax/libmulredc.a/mulredc14.o .libs/libecm.lax/libmulredc.a/mulredc15.o .libs/libecm.lax/libmulredc.a/mulredc16.o .libs/libecm.lax/libmulredc.a/mulredc17.o .libs/libecm.lax/libmulredc.a/mulredc18.o .libs/libecm.lax/libmulredc.a/mulredc19.o .libs/libecm.lax/libmulredc.a/mulredc1_10.o .libs/libecm.lax/libmulredc.a/mulredc1_11.o .libs/libecm.lax/libmulredc.a/mulredc1_12.o .libs/libecm.lax/libmulredc.a/mulredc1_13.o .libs/libecm.lax/libmulredc.a/mulredc1_14.o .libs/libecm.lax/libmulredc.a/mulredc1_15.o .libs/libecm.lax/libmulredc.a/mulredc1_16.o .libs/libecm.lax/libmulredc.a/mulredc1_17.o .libs/libecm.lax/libmulredc.a/mulredc1_18.o .libs/libecm.lax/libmulredc.a/mulredc1_19.o .libs/libecm.lax/libmulredc.a/mulredc1_2.o .libs/libecm.lax/libmulredc.a/mulredc1_20.o .libs/libecm.lax/libmulredc.a/mulredc1_3.o .libs/libecm.lax/libmulredc.a/mulredc1_4.o .libs/libecm.lax/libmulredc.a/mulredc1_5.o .libs/libecm.lax/libmulredc.a/mulredc1_6.o .libs/libecm.lax/libmulredc.a/mulredc1_7.o .libs/libecm.lax/libmulredc.a/mulredc1_8.o .libs/libecm.lax/libmulredc.a/mulredc1_9.o .libs/libecm.lax/libmulredc.a/mulredc2.o .libs/libecm.lax/libmulredc.a/mulredc20.o .libs/libecm.lax/libmulredc.a/mulredc3.o .libs/libecm.lax/libmulredc.a/mulredc4.o .libs/libecm.lax/libmulredc.a/mulredc5.o .libs/libecm.lax/libmulredc.a/mulredc6.o .libs/libecm.lax/libmulredc.a/mulredc7.o .libs/libecm.lax/libmulredc.a/mulredc8.o .libs/libecm.lax/libmulredc.a/mulredc9.o
libtool: link: ranlib .libs/libecm.a
libtool: link: rm -fr .libs/libecm.lax
libtool: link: ( cd ".libs" && rm -f "libecm.la" && ln -s "../libecm.la" "libecm.la" )
```
(`env ECM_CONFIGURE="--enable-shared" ./sage -f ecm`)



---

archive/issue_comments_373316.json:
```json
{
    "body": "<a id='comment:99'></a>\nReplying to [leif](#comment%3A98):\n> Replying to [fbissey](#comment%3A96):\n> > In `Makefile.am` you want to change line 52 which already has a definition for `libecm_la_LDFLAGS`.\n\n> \n> Oooops, forgot a plus, but for whatever reason, it worked for me (with version info etc.).\n\n\nNo, after taking a closer look, I did **not** forget the plus.  So nothing mysterious going on.",
    "created_at": "2016-08-04T11:46:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373316",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:99'></a>
Replying to [leif](#comment%3A98):
> Replying to [fbissey](#comment%3A96):
> > In `Makefile.am` you want to change line 52 which already has a definition for `libecm_la_LDFLAGS`.

> 
> Oooops, forgot a plus, but for whatever reason, it worked for me (with version info etc.).


No, after taking a closer look, I did **not** forget the plus.  So nothing mysterious going on.



---

archive/issue_comments_373317.json:
```json
{
    "body": "<a id='comment:0'></a>\nBut _I_ missed it :) real time for bed for me.",
    "created_at": "2016-08-04T11:54:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373317",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:0'></a>
But _I_ missed it :) real time for bed for me.



---

archive/issue_comments_373318.json:
```json
{
    "body": "<a id='comment:1'></a>\nDreaming of libtool I guess... ;-)",
    "created_at": "2016-08-04T11:57:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373318",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:1'></a>
Dreaming of libtool I guess... ;-)



---

archive/issue_comments_373319.json:
```json
{
    "body": "<a id='comment:2'></a>\nOh-oh, it seems the last patch brings back `ar cru libecm.a libgmp.a ...` when building *only* a static library...",
    "created_at": "2016-08-04T12:10:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373319",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:2'></a>
Oh-oh, it seems the last patch brings back `ar cru libecm.a libgmp.a ...` when building *only* a static library...



---

archive/issue_comments_373320.json:
```json
{
    "body": "<a id='comment:3'></a>\nI think we are majorly bike shedding.\n\nThings to do:\n1) -z noexecstack is a gnu ld option. Doesn't work on OS X. Change this and get it upstream.\n\n2) if you provide enough info to configure to get the path to libgmp.a (not just detecting that you can link to gmp) and you build a static libecm then the build system will try to include libgmp.a in libecm.a.\n* this fails on OS X\n* if you build both a static and dynamic library interesting things will probably happen to the dynamic library, especially if libgmp.a has not been compiled with `pic` flags.\n8 this is a recipe to squeeze as much performance as possible by getting an all static linking - it is possible to get the `ecm` binary compiled all static in some more portable ways (I think).\n\nNumber (2) is occurring in sage because we pass the install path to gmp/mpir when it is not needed to get gmp detected. This is my[comment:76](#comment%3A76).\n\n(1) has to be talked about with upstream (2) can easily build by adopting[comment:76](#comment%3A76) in spkg-install.",
    "created_at": "2016-08-05T10:15:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373320",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:3'></a>
I think we are majorly bike shedding.

Things to do:
1) -z noexecstack is a gnu ld option. Doesn't work on OS X. Change this and get it upstream.

2) if you provide enough info to configure to get the path to libgmp.a (not just detecting that you can link to gmp) and you build a static libecm then the build system will try to include libgmp.a in libecm.a.
* this fails on OS X
* if you build both a static and dynamic library interesting things will probably happen to the dynamic library, especially if libgmp.a has not been compiled with `pic` flags.
8 this is a recipe to squeeze as much performance as possible by getting an all static linking - it is possible to get the `ecm` binary compiled all static in some more portable ways (I think).

Number (2) is occurring in sage because we pass the install path to gmp/mpir when it is not needed to get gmp detected. This is my[comment:76](#comment%3A76).

(1) has to be talked about with upstream (2) can easily build by adopting[comment:76](#comment%3A76) in spkg-install.



---

archive/issue_comments_373321.json:
```json
{
    "body": "<a id='comment:4'></a>\nYep.\n\nFor 1) we can just patch out `-Wl,znoexecstack` here and add it (or `-Wa,--noexecstack`) back in `spkg-install` when appropriate (i.e., supported; presumably just Linux or probably [recent] GAS).\n\nAnd submit something upstream later.\n\nTo 2 ), dropping `--with-gmp` should IMHO only be a temporary work-around.",
    "created_at": "2016-08-05T10:39:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373321",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:4'></a>
Yep.

For 1) we can just patch out `-Wl,znoexecstack` here and add it (or `-Wa,--noexecstack`) back in `spkg-install` when appropriate (i.e., supported; presumably just Linux or probably [recent] GAS).

And submit something upstream later.

To 2 ), dropping `--with-gmp` should IMHO only be a temporary work-around.



---

archive/issue_comments_373322.json:
```json
{
    "body": "<a id='comment:105'></a>\nReplying to [leif](#comment%3A104):\n> To 2), dropping `--with-gmp` should IMHO only be a temporary work-around. \n\n\nIs this sufficient or do we (still) have to patch out (the apparently plain wrong, with a static library at least)\n\n```make\nlibecm_la_LIBADD += $(GMPLIB)\n```\n?\n\nI'll be back in a couple of hours...",
    "created_at": "2016-08-05T11:02:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373322",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:105'></a>
Replying to [leif](#comment%3A104):
> To 2), dropping `--with-gmp` should IMHO only be a temporary work-around. 


Is this sufficient or do we (still) have to patch out (the apparently plain wrong, with a static library at least)

```make
libecm_la_LIBADD += $(GMPLIB)
```
?

I'll be back in a couple of hours...



---

archive/issue_comments_373323.json:
```json
{
    "body": "<a id='comment:106'></a>\nReplying to [leif](#comment%3A105):\n> Replying to [leif](#comment%3A104):\n> > To 2), dropping `--with-gmp` should IMHO only be a temporary work-around. \n\n> \n> Is this sufficient or do we (still) have to patch out (the apparently plain wrong, with a static library at least)\n> \n> ```\n> #!make\n> libecm_la_LIBADD += $(GMPLIB)\n> ```\n> ?\n> \n> I'll be back in a couple of hours...\n\n\nIt is sufficient. I don't think `Makefile.am` is wrong. It is just feed something toxic in a corner case which upstream goes to great length to create. \n\nGenerally speaking OS X doesn't like static libraries much (still doable but some things are made difficult or more limited). So it probably should be avoided there.",
    "created_at": "2016-08-05T11:13:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373323",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:106'></a>
Replying to [leif](#comment%3A105):
> Replying to [leif](#comment%3A104):
> > To 2), dropping `--with-gmp` should IMHO only be a temporary work-around. 

> 
> Is this sufficient or do we (still) have to patch out (the apparently plain wrong, with a static library at least)
> 
> ```
> #!make
> libecm_la_LIBADD += $(GMPLIB)
> ```
> ?
> 
> I'll be back in a couple of hours...


It is sufficient. I don't think `Makefile.am` is wrong. It is just feed something toxic in a corner case which upstream goes to great length to create. 

Generally speaking OS X doesn't like static libraries much (still doable but some things are made difficult or more limited). So it probably should be avoided there.



---

archive/issue_comments_373324.json:
```json
{
    "body": "<a id='comment:7'></a>\n[Post to wrong ticket deleted.]",
    "created_at": "2016-08-06T19:01:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373324",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:7'></a>
[Post to wrong ticket deleted.]



---

archive/issue_comments_373325.json:
```json
{
    "body": "<a id='comment:8'></a>\nOuch, wrong ticket... :-)",
    "created_at": "2016-08-06T19:02:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373325",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:8'></a>
Ouch, wrong ticket... :-)



---

archive/issue_comments_373326.json:
```json
{
    "body": "<a id='comment:9'></a>\nJust for the record, #21223 adds a Cygwin patch to the 6.4.4 package.",
    "created_at": "2016-08-11T13:25:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373326",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:9'></a>
Just for the record, #21223 adds a Cygwin patch to the 6.4.4 package.



---

archive/issue_comments_373327.json:
```json
{
    "body": "<a id='comment:110'></a>\nReplying to [leif](#comment%3A109):\n> Just for the record, #21223 adds a Cygwin patch to the 6.4.4 package.\n\n\n... and we need to (trivially) backport that to 7.0.3 at least.\n\n(Patches `configure[.{in,ac}]`, single-line change each.)",
    "created_at": "2016-08-11T13:43:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373327",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:110'></a>
Replying to [leif](#comment%3A109):
> Just for the record, #21223 adds a Cygwin patch to the 6.4.4 package.


... and we need to (trivially) backport that to 7.0.3 at least.

(Patches `configure[.{in,ac}]`, single-line change each.)



---

archive/issue_comments_373328.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2016-08-11T13:43:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373328",
    "user": "https://github.com/nexttime"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_373329.json:
```json
{
    "body": "<a id='comment:1'></a>\nI'm back from vacation, and I see about 100 messages in this ticket, woowww!!!!\nThe 7.0.2 and 7.0.3 releases now each have a tag.\nPlease tell me if you have still issues with 7.0.3, and some patches to be applied upstream.\n\nPaul",
    "created_at": "2016-08-22T11:26:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373329",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:1'></a>
I'm back from vacation, and I see about 100 messages in this ticket, woowww!!!!
The 7.0.2 and 7.0.3 releases now each have a tag.
Please tell me if you have still issues with 7.0.3, and some patches to be applied upstream.

Paul



---

archive/issue_comments_373330.json:
```json
{
    "body": "<a id='comment:112'></a>\nReplying to [zimmerma](#comment%3A111):\n> I'm back from vacation, and I see about 100 messages in this ticket, woowww!!!!\n> The 7.0.2 and 7.0.3 releases now each have a tag.\n> Please tell me if you have still issues with 7.0.3, and some patches to be applied upstream.\n> \n> Paul\n\n\nI guess there are two main things we'll have to deal with:\n* `-Wl,znoexecstack` only works with gnu ld. It causes OS X ld to choke.\n* building against libgmp.a is also not working on OS X. That can be filtered out in configure.ac with an extra test in the logic to select `pathto/libgmp.a`\n\nThat's on top of my head.",
    "created_at": "2016-08-22T11:40:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373330",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:112'></a>
Replying to [zimmerma](#comment%3A111):
> I'm back from vacation, and I see about 100 messages in this ticket, woowww!!!!
> The 7.0.2 and 7.0.3 releases now each have a tag.
> Please tell me if you have still issues with 7.0.3, and some patches to be applied upstream.
> 
> Paul


I guess there are two main things we'll have to deal with:
* `-Wl,znoexecstack` only works with gnu ld. It causes OS X ld to choke.
* building against libgmp.a is also not working on OS X. That can be filtered out in configure.ac with an extra test in the logic to select `pathto/libgmp.a`

That's on top of my head.



---

archive/issue_comments_373331.json:
```json
{
    "body": "<a id='comment:113'></a>\n> Apparently also building out-of-tree is broken (more precisely, running `make longcheck` in an out-of-tree build, which definitely fails).\n\n\nshould be fixed in revision 2974.\n\nPaul",
    "created_at": "2016-08-22T11:44:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373331",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:113'></a>
> Apparently also building out-of-tree is broken (more precisely, running `make longcheck` in an out-of-tree build, which definitely fails).


should be fixed in revision 2974.

Paul



---

archive/issue_comments_373332.json:
```json
{
    "body": "<a id='comment:4'></a>\n> should be fixed in revision 2974.\n\n\nsorry, it should read 2975.\n\nPaul",
    "created_at": "2016-08-22T11:45:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373332",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:4'></a>
> should be fixed in revision 2974.


sorry, it should read 2975.

Paul



---

archive/issue_comments_373333.json:
```json
{
    "body": "<a id='comment:5'></a>\nfor the -Wl,znoexecstack issue, I've added a configure test in revision 2978.\nPlease can you check it works on OS X now?\n\nFor the libgmp.a issue, please can you provide a patch?\n\nPaul",
    "created_at": "2016-08-23T12:32:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373333",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:5'></a>
for the -Wl,znoexecstack issue, I've added a configure test in revision 2978.
Please can you check it works on OS X now?

For the libgmp.a issue, please can you provide a patch?

Paul



---

archive/issue_comments_373334.json:
```json
{
    "body": "<a id='comment:6'></a>\nPosting back the issue I reported on #21223:\n* on cygwin64, the assebmly for redc uses the GOT which is not supported on Windows when `WANT_ASSERT` is set and it is by default (passing `--disable-assert` circumvents the problem).\n\nI'll now try different combinations of `--enable-asm-redc` and `--enable-sse2` on Cygwin32 and Cygwin64 and report.",
    "created_at": "2016-08-23T17:30:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373334",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:6'></a>
Posting back the issue I reported on #21223:
* on cygwin64, the assebmly for redc uses the GOT which is not supported on Windows when `WANT_ASSERT` is set and it is by default (passing `--disable-assert` circumvents the problem).

I'll now try different combinations of `--enable-asm-redc` and `--enable-sse2` on Cygwin32 and Cygwin64 and report.



---

archive/issue_comments_373335.json:
```json
{
    "body": "<a id='comment:7'></a>\n(Do we need a so complicated `spkg-install`???)",
    "created_at": "2016-08-23T17:32:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373335",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:7'></a>
(Do we need a so complicated `spkg-install`???)



---

archive/issue_comments_373336.json:
```json
{
    "body": "<a id='comment:8'></a>\nOn my side, `make check` passes on a x86_64 machine with Cygwin32 passing `--enable-sse2 --enable-asm-redc`.\n\nSame under Cygwin64 (modulo rebasing issues and passing `--disable-assert`).",
    "created_at": "2016-08-23T18:10:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373336",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:8'></a>
On my side, `make check` passes on a x86_64 machine with Cygwin32 passing `--enable-sse2 --enable-asm-redc`.

Same under Cygwin64 (modulo rebasing issues and passing `--disable-assert`).



---

archive/issue_comments_373337.json:
```json
{
    "body": "<a id='comment:119'></a>\nReplying to [jpflori](#comment%3A117):\n> (Do we need a so complicated `spkg-install`???)\n\n\nI personally don't think so... Too much hand holding on flags in my opinion.",
    "created_at": "2016-08-23T20:43:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373337",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:119'></a>
Replying to [jpflori](#comment%3A117):
> (Do we need a so complicated `spkg-install`???)


I personally don't think so... Too much hand holding on flags in my opinion.



---

archive/issue_comments_373338.json:
```json
{
    "body": "<a id='comment:120'></a>\nReplying to [zimmerma](#comment%3A115):\n> for the -Wl,znoexecstack issue, I've added a configure test in revision 2978.\n> Please can you check it works on OS X now?\n> \n\n\nI'll give it go when I have time (hopefully in the next few hours).\n\n> For the libgmp.a issue, please can you provide a patch?\n> \n\n\nYes, I'll definitely work on that. \n\nFrancois",
    "created_at": "2016-08-23T20:44:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373338",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:120'></a>
Replying to [zimmerma](#comment%3A115):
> for the -Wl,znoexecstack issue, I've added a configure test in revision 2978.
> Please can you check it works on OS X now?
> 


I'll give it go when I have time (hopefully in the next few hours).

> For the libgmp.a issue, please can you provide a patch?
> 


Yes, I'll definitely work on that. 

Francois



---

archive/issue_comments_373339.json:
```json
{
    "body": "<a id='comment:1'></a>\nOn revision 2978 on OS X inside sage\n\n```\nconfigure: Memory debugging disabled\n\nNow building GMP-ECM...\nmake  all-recursive\nMaking all in x86_64\nm4 -I../ -DOPERATION_mulredc1 `test -f mulredc1.asm || echo './'`mulredc1.asm >mulredc1.s\n/bin/sh ../libtool    --mode=compile gcc  -march=native -g -O3  -fPIC -c -o mulredc1.lo mulredc1.s\nlibtool: compile:  gcc -march=native -g -O3 -fPIC -c mulredc1.s -o mulredc1.o\nmulredc1.s:59:2: error: unsupported symbol modifier in branch relocation\n        call    abort@plt\n        ^\nmake[2]: *** [mulredc1.lo] Error 1\nrm mulredc1.s\nmake[1]: *** [all-recursive] Error 1\nmake: *** [all] Error 2\nError building GMP-ECM.\n```\n\nOuch...",
    "created_at": "2016-08-23T21:15:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373339",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:1'></a>
On revision 2978 on OS X inside sage

```
configure: Memory debugging disabled

Now building GMP-ECM...
make  all-recursive
Making all in x86_64
m4 -I../ -DOPERATION_mulredc1 `test -f mulredc1.asm || echo './'`mulredc1.asm >mulredc1.s
/bin/sh ../libtool    --mode=compile gcc  -march=native -g -O3  -fPIC -c -o mulredc1.lo mulredc1.s
libtool: compile:  gcc -march=native -g -O3 -fPIC -c mulredc1.s -o mulredc1.o
mulredc1.s:59:2: error: unsupported symbol modifier in branch relocation
        call    abort@plt
        ^
make[2]: *** [mulredc1.lo] Error 1
rm mulredc1.s
make[1]: *** [all-recursive] Error 1
make: *** [all] Error 2
Error building GMP-ECM.
```

Ouch...



---

archive/issue_comments_373340.json:
```json
{
    "body": "<a id='comment:2'></a>\nPass `--disable-assert` :p",
    "created_at": "2016-08-23T21:16:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373340",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:2'></a>
Pass `--disable-assert` :p



---

archive/issue_comments_373341.json:
```json
{
    "body": "<a id='comment:3'></a>\nThanks, that worked. Will we have to pass it for anything other than linux? Or should it be magically set?\n\nIn any case the main test was whether --noexecstack was properly disabled on OS X and it is.",
    "created_at": "2016-08-24T00:51:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373341",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:3'></a>
Thanks, that worked. Will we have to pass it for anything other than linux? Or should it be magically set?

In any case the main test was whether --noexecstack was properly disabled on OS X and it is.



---

archive/issue_comments_373342.json:
```json
{
    "body": "<a id='comment:124'></a>\nReplying to [fbissey](#comment%3A123):\n> Thanks, that worked. Will we have to pass it for anything other than linux? Or should it be magically set?\n\nI would say it's a bug.\nThe assembly should be modified because:\n* `GOT` is not supported on Windows (where everything is alway PIC),\n* the `call` syntax is broken on OS X.\nUsing `--disable-assert` is just a workaround as it excludes the harming code.\nNote that we could still live without asserts on Cygwin and OS X.\n> \n> In any case the main test was whether --noexecstack was properly disabled on OS X and it is.\n\nGood!",
    "created_at": "2016-08-24T05:42:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373342",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:124'></a>
Replying to [fbissey](#comment%3A123):
> Thanks, that worked. Will we have to pass it for anything other than linux? Or should it be magically set?

I would say it's a bug.
The assembly should be modified because:
* `GOT` is not supported on Windows (where everything is alway PIC),
* the `call` syntax is broken on OS X.
Using `--disable-assert` is just a workaround as it excludes the harming code.
Note that we could still live without asserts on Cygwin and OS X.
> 
> In any case the main test was whether --noexecstack was properly disabled on OS X and it is.

Good!



---

archive/issue_comments_373343.json:
```json
{
    "body": "<a id='comment:5'></a>\nabout the issue from comment [comment:121] (GOT not supported on Windows), I can't help on that. Please can someone provide a patch?\n\nSince the noexecstack issue is now solved in the development version, it only remains to solve the libgmp.a issue, for which Francois is working on a patch.\n\nPaul",
    "created_at": "2016-08-25T10:55:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373343",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:5'></a>
about the issue from comment [comment:121] (GOT not supported on Windows), I can't help on that. Please can someone provide a patch?

Since the noexecstack issue is now solved in the development version, it only remains to solve the libgmp.a issue, for which Francois is working on a patch.

Paul



---

archive/issue_comments_373344.json:
```json
{
    "body": "<a id='comment:126'></a>\nReplying to [zimmerma](#comment%3A125):\n> about the issue from comment [comment:121] (GOT not supported on Windows), I can't help on that. Please can someone provide a patch?\n\nNote that the assembly line from [comment:121] gives issues on OS X not Windows:\n\n```\ncall abort@plt\n```\nThe problematic line on Windows from #21223 is the previous one which uses:\n\n```\n$_GLOBAL_OFFSET_TABLE\n```\n\nThe workaround I suggested is to use `--disable-assert` as both these lines are surrounded by a (`m4`-equivalent) of `#ifdef HAVE_ASSERT`.\n\nA proper fix would be to:\n* find equivalent assembly on OS X and Windows to keep asserts support,\n* or always disable this code path on OS X and Windows.",
    "created_at": "2016-08-25T11:14:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373344",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:126'></a>
Replying to [zimmerma](#comment%3A125):
> about the issue from comment [comment:121] (GOT not supported on Windows), I can't help on that. Please can someone provide a patch?

Note that the assembly line from [comment:121] gives issues on OS X not Windows:

```
call abort@plt
```
The problematic line on Windows from #21223 is the previous one which uses:

```
$_GLOBAL_OFFSET_TABLE
```

The workaround I suggested is to use `--disable-assert` as both these lines are surrounded by a (`m4`-equivalent) of `#ifdef HAVE_ASSERT`.

A proper fix would be to:
* find equivalent assembly on OS X and Windows to keep asserts support,
* or always disable this code path on OS X and Windows.



---

archive/issue_comments_373345.json:
```json
{
    "body": "<a id='comment:7'></a>\nThis comes from:\nhttps://gforge.inria.fr/scm/viewvc.php/ecm/trunk/x86_64/mulredc1.asm?r1=1460&r2=1526\nand yes it is not portable!\n\nIn fact this only appeared here because in configure.ac (https://gforge.inria.fr/scm/viewvc.php/ecm/trunk/configure.ac?view=markup#l51):\n\n```\ndnl Assertions are enabled by default for beta/rc releases.\n```",
    "created_at": "2016-08-25T11:42:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373345",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:7'></a>
This comes from:
https://gforge.inria.fr/scm/viewvc.php/ecm/trunk/x86_64/mulredc1.asm?r1=1460&r2=1526
and yes it is not portable!

In fact this only appeared here because in configure.ac (https://gforge.inria.fr/scm/viewvc.php/ecm/trunk/configure.ac?view=markup#l51):

```
dnl Assertions are enabled by default for beta/rc releases.
```



---

archive/issue_comments_373346.json:
```json
{
    "body": "<a id='comment:8'></a>\nthank you Jean-Pierre. If we go back to revision 1460, would it solve the OS X and Windows issues?",
    "created_at": "2016-08-25T12:09:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373346",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:8'></a>
thank you Jean-Pierre. If we go back to revision 1460, would it solve the OS X and Windows issues?



---

archive/issue_comments_373347.json:
```json
{
    "body": "<a id='comment:9'></a>\nNot completely sure if you mean go back to r1460 for OS X and Windows only or for all Oses.\n\nWhatsoever, with no testing and realknowledge of what I'm talking about, I'd say that indeed using:\n* using the r1460 code on Windows should do the trick: there the code is always PIC and hopefully no dark magic is needed to call abort;\n* using the r1460 code on OS X I have no idea but it cannot be worse than now: binaries are not ELF, so no PLT, not sure if the simple `call` would always work in both shared and static libraries.\nAs far as Linux is concerned :\n* either always use the r1526 code which according to the commit message always works,\n* or use it only in PIC code and use the r1460 in non-PIC code.",
    "created_at": "2016-08-25T12:18:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373347",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:9'></a>
Not completely sure if you mean go back to r1460 for OS X and Windows only or for all Oses.

Whatsoever, with no testing and realknowledge of what I'm talking about, I'd say that indeed using:
* using the r1460 code on Windows should do the trick: there the code is always PIC and hopefully no dark magic is needed to call abort;
* using the r1460 code on OS X I have no idea but it cannot be worse than now: binaries are not ELF, so no PLT, not sure if the simple `call` would always work in both shared and static libraries.
As far as Linux is concerned :
* either always use the r1526 code which according to the commit message always works,
* or use it only in PIC code and use the r1460 in non-PIC code.



---

archive/issue_comments_373348.json:
```json
{
    "body": "<a id='comment:0'></a>\nI was meaning go back to r1460 in all cases. But I now propose to simply remove this WANT_ASSERT stuff in the assembly code. Anyway if something goes wrong, it will be detected by the assertions in the C code.\n\nPaul",
    "created_at": "2016-08-25T12:25:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373348",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:0'></a>
I was meaning go back to r1460 in all cases. But I now propose to simply remove this WANT_ASSERT stuff in the assembly code. Anyway if something goes wrong, it will be detected by the assertions in the C code.

Paul



---

archive/issue_comments_373349.json:
```json
{
    "body": "<a id='comment:1'></a>\nSure that's the more portable and easiest to maintain solution.\n\n(And after a few more seconds searching about OS X, it might be the case that the toolchain there does the plt or equivalent black magic by itself.)",
    "created_at": "2016-08-25T12:32:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373349",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:1'></a>
Sure that's the more portable and easiest to maintain solution.

(And after a few more seconds searching about OS X, it might be the case that the toolchain there does the plt or equivalent black magic by itself.)



---

archive/issue_comments_373350.json:
```json
{
    "body": "<a id='comment:2'></a>\nthe WANT_ASSERT stuff has been removed in upstream revision 2981.\nThis should solve the OS X and Windows issues.\n\nPaul",
    "created_at": "2016-08-25T13:46:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373350",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:2'></a>
the WANT_ASSERT stuff has been removed in upstream revision 2981.
This should solve the OS X and Windows issues.

Paul



---

archive/issue_comments_373351.json:
```json
{
    "body": "<a id='comment:133'></a>\nReplying to [zimmerma](#comment%3A125):\n> about the issue from comment [comment:121] (GOT not supported on Windows), I can't help on that. Please can someone provide a patch?\n> \n> Since the noexecstack issue is now solved in the development version, it only remains to solve the libgmp.a issue, for which Francois is working on a patch.\n> \n> Paul\n\n\nSent your way in a private email.\n\nFrancois",
    "created_at": "2016-08-26T01:35:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373351",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:133'></a>
Replying to [zimmerma](#comment%3A125):
> about the issue from comment [comment:121] (GOT not supported on Windows), I can't help on that. Please can someone provide a patch?
> 
> Since the noexecstack issue is now solved in the development version, it only remains to solve the libgmp.a issue, for which Francois is working on a patch.
> 
> Paul


Sent your way in a private email.

Francois



---

archive/issue_comments_373352.json:
```json
{
    "body": "<a id='comment:4'></a>\nthe patch for the libgmp.a issue on OS X is integrated in upstream revision 2982.\nAre all known issues solved now?\n\nPaul\n\nPS: I'll probably make a 7.0.4 patch release since a bug was reported in mpres_pow().",
    "created_at": "2016-08-26T07:21:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373352",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:4'></a>
the patch for the libgmp.a issue on OS X is integrated in upstream revision 2982.
Are all known issues solved now?

Paul

PS: I'll probably make a 7.0.4 patch release since a bug was reported in mpres_pow().



---

archive/issue_comments_373353.json:
```json
{
    "body": "<a id='comment:5'></a>\na new release candidate is available at\n\nhttps://members.loria.fr/PZimmermann/ecm-7.0.4-rc1.tar.gz\n\nPlease test and report success or failure.\n\nPaul",
    "created_at": "2016-08-26T13:19:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373353",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:5'></a>
a new release candidate is available at

https://members.loria.fr/PZimmermann/ecm-7.0.4-rc1.tar.gz

Please test and report success or failure.

Paul



---

archive/issue_comments_373354.json:
```json
{
    "body": "<a id='comment:6'></a>\nI still need `--disable-assert` on OS X otherwise I get \n\n```\n/bin/sh ./libtool  --tag=CC   --mode=link gcc  -g -march=native -g -O3  -fPIC  -L/Users/fbissey/build/sage-7.2.beta5/local/lib -Wl,-rpath,/Users/fbissey/build/sage-7.2.beta5/local/lib  -L/Users/fbissey/build/sage-7.2.beta5/local/lib -o ecm ecm-auxi.o ecm-b1_ainc.o ecm-candi.o ecm-eval.o ecm-main.o ecm-resume.o ecm-getprime_r.o aprtcle/ecm-mpz_aprcl.o ecm-memusage.o libecm.la -lgmp -lm -lm -lm -lm -lm  \nlibtool: link: gcc -g -march=native -g -O3 -fPIC -Wl,-rpath -Wl,/Users/fbissey/build/sage-7.2.beta5/local/lib -o ecm ecm-auxi.o ecm-b1_ainc.o ecm-candi.o ecm-eval.o ecm-main.o ecm-resume.o ecm-getprime_r.o aprtcle/ecm-mpz_aprcl.o ecm-memusage.o  -L/Users/fbissey/build/sage-7.2.beta5/local/lib ./.libs/libecm.a -lgmp -lm\nUndefined symbols for architecture x86_64:\n  \"_fft_adjust_limbs\", referenced from:\n      ___ecm_mpres_mul_z_to_z in libecm.a(libecm_la-mpmod.o)\n      ___ecm_mpres_mul in libecm.a(libecm_la-mpmod.o)\nld: symbol(s) not found for architecture x86_64\ncollect2: error: ld returned 1 exit status\nmake[2]: *** [ecm] Error 1\n```\n`ecm` test suite is currently running but I am not expecting any failures.",
    "created_at": "2016-08-30T10:04:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373354",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:6'></a>
I still need `--disable-assert` on OS X otherwise I get 

```
/bin/sh ./libtool  --tag=CC   --mode=link gcc  -g -march=native -g -O3  -fPIC  -L/Users/fbissey/build/sage-7.2.beta5/local/lib -Wl,-rpath,/Users/fbissey/build/sage-7.2.beta5/local/lib  -L/Users/fbissey/build/sage-7.2.beta5/local/lib -o ecm ecm-auxi.o ecm-b1_ainc.o ecm-candi.o ecm-eval.o ecm-main.o ecm-resume.o ecm-getprime_r.o aprtcle/ecm-mpz_aprcl.o ecm-memusage.o libecm.la -lgmp -lm -lm -lm -lm -lm  
libtool: link: gcc -g -march=native -g -O3 -fPIC -Wl,-rpath -Wl,/Users/fbissey/build/sage-7.2.beta5/local/lib -o ecm ecm-auxi.o ecm-b1_ainc.o ecm-candi.o ecm-eval.o ecm-main.o ecm-resume.o ecm-getprime_r.o aprtcle/ecm-mpz_aprcl.o ecm-memusage.o  -L/Users/fbissey/build/sage-7.2.beta5/local/lib ./.libs/libecm.a -lgmp -lm
Undefined symbols for architecture x86_64:
  "_fft_adjust_limbs", referenced from:
      ___ecm_mpres_mul_z_to_z in libecm.a(libecm_la-mpmod.o)
      ___ecm_mpres_mul in libecm.a(libecm_la-mpmod.o)
ld: symbol(s) not found for architecture x86_64
collect2: error: ld returned 1 exit status
make[2]: *** [ecm] Error 1
```
`ecm` test suite is currently running but I am not expecting any failures.



---

archive/issue_comments_373355.json:
```json
{
    "body": "<a id='comment:7'></a>\nFrancois, I guess you are compiling GMP-ECM with MPIR, not with GMP.\nSince there is currently no public FFT interface for GMP, and the internal functions differ between GMP and MPIR, I decided to only support the GMP side.\nThus unless someone volunteers to maintain GMP-ECM up to date with changes in MPIR\n(apparently fft_adjust_limbs now disappeared), MPIR will not be supported any more.\n\nPaul",
    "created_at": "2016-08-30T13:53:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373355",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:7'></a>
Francois, I guess you are compiling GMP-ECM with MPIR, not with GMP.
Since there is currently no public FFT interface for GMP, and the internal functions differ between GMP and MPIR, I decided to only support the GMP side.
Thus unless someone volunteers to maintain GMP-ECM up to date with changes in MPIR
(apparently fft_adjust_limbs now disappeared), MPIR will not be supported any more.

Paul



---

archive/issue_comments_373356.json:
```json
{
    "body": "<a id='comment:8'></a>\nIndeed I was compiling from inside a sagemath install with `mpir`. Which of course is the default in this case. Your comments make me wonder about what is happening on the linux side. Anyone???",
    "created_at": "2016-08-30T21:09:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373356",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:8'></a>
Indeed I was compiling from inside a sagemath install with `mpir`. Which of course is the default in this case. Your comments make me wonder about what is happening on the linux side. Anyone???



---

archive/issue_comments_373357.json:
```json
{
    "body": "<a id='comment:9'></a>\nAs long as this only fails with `--enable-assert` we could live with that failure.\nFrom a quick discussion with Bill Hart, I don't see anything on the MPIR side to converge back to the GMP interface in the near future.\n\nI'll test on Linux when I find some time this week.",
    "created_at": "2016-08-31T16:10:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373357",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:9'></a>
As long as this only fails with `--enable-assert` we could live with that failure.
From a quick discussion with Bill Hart, I don't see anything on the MPIR side to converge back to the GMP interface in the near future.

I'll test on Linux when I find some time this week.



---

archive/issue_comments_373358.json:
```json
{
    "body": "<a id='comment:0'></a>\nI get the same failure on Linux with `--enable-assert`:\n\n```\ntune-mpmod.o: In function `__ecm_mpres_mul_z_to_z':\n/home/jpflori/trunk/mpmod.c:1594: undefined reference to `fft_adjust_limbs'\ntune-mpmod.o: In function `__ecm_mpres_mul':\n/home/jpflori/trunk/mpmod.c:1419: undefined reference to `fft_adjust_limbs'\ncollect2: error: ld returned 1 exit status\n```\nNo issue with `--disable-assert`.",
    "created_at": "2016-09-01T09:29:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373358",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:0'></a>
I get the same failure on Linux with `--enable-assert`:

```
tune-mpmod.o: In function `__ecm_mpres_mul_z_to_z':
/home/jpflori/trunk/mpmod.c:1594: undefined reference to `fft_adjust_limbs'
tune-mpmod.o: In function `__ecm_mpres_mul':
/home/jpflori/trunk/mpmod.c:1419: undefined reference to `fft_adjust_limbs'
collect2: error: ld returned 1 exit status
```
No issue with `--disable-assert`.



---

archive/issue_comments_373359.json:
```json
{
    "body": "<a id='comment:1'></a>\nIs there really any more work needed here?\nWait for a new upstream dot release ?\nAdd `--disable-assert` to our configuration?",
    "created_at": "2016-10-11T09:06:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373359",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:1'></a>
Is there really any more work needed here?
Wait for a new upstream dot release ?
Add `--disable-assert` to our configuration?



---

archive/issue_comments_373360.json:
```json
{
    "body": "<a id='comment:2'></a>\nI guess we should check if 7.0.4 is out and use `--disable-assert`.",
    "created_at": "2016-10-11T09:11:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373360",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:2'></a>
I guess we should check if 7.0.4 is out and use `--disable-assert`.



---

archive/issue_comments_373361.json:
```json
{
    "body": "<a id='comment:3'></a>\n7.0.4 is now out.\n\nPaul",
    "created_at": "2016-10-11T09:50:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373361",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:3'></a>
7.0.4 is now out.

Paul



---

archive/issue_comments_373362.json:
```json
{
    "body": "<a id='comment:4'></a>\nOK, I'll try to put the branch in shape in the next 48hours.",
    "created_at": "2016-10-22T22:48:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373362",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:4'></a>
OK, I'll try to put the branch in shape in the next 48hours.



---

archive/issue_comments_373363.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-GMP-ECM 7.0.3 is available at [https://gforge.inria.fr/frs/download.php/file/36043/ecm-7.0.3.tar.gz](https://gforge.inria.fr/frs/download.php/file/36043/ecm-7.0.3.tar.gz).\n+GMP-ECM 7.0.4 is available at [https://gforge.inria.fr/frs/download.php/file/36224/ecm-7.0.4.tar.gz](https://gforge.inria.fr/frs/download.php/file/36224/ecm-7.0.4.tar.gz).\n \n ---\n \n@@ -10,7 +10,7 @@\n \n ---\n \n-Upgrade GMP-ECM to 7.0.3\n+Upgrade GMP-ECM to 7.0.4\n     \n * I haven't repackaged the upstream tarball (`.tar.gz`) [yet].\n   Not sure whether we could/should also delete some stuff not\n``````\n",
    "created_at": "2016-10-23T02:38:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373363",
    "user": "https://github.com/kiwifb"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-GMP-ECM 7.0.3 is available at [https://gforge.inria.fr/frs/download.php/file/36043/ecm-7.0.3.tar.gz](https://gforge.inria.fr/frs/download.php/file/36043/ecm-7.0.3.tar.gz).
+GMP-ECM 7.0.4 is available at [https://gforge.inria.fr/frs/download.php/file/36224/ecm-7.0.4.tar.gz](https://gforge.inria.fr/frs/download.php/file/36224/ecm-7.0.4.tar.gz).
 
 ---
 
@@ -10,7 +10,7 @@
 
 ---
 
-Upgrade GMP-ECM to 7.0.3
+Upgrade GMP-ECM to 7.0.4
     
 * I haven't repackaged the upstream tarball (`.tar.gz`) [yet].
   Not sure whether we could/should also delete some stuff not
``````




---

archive/issue_comments_373364.json:
```json
{
    "body": "<a id='comment:6'></a>\nOr 48days :)",
    "created_at": "2016-11-17T15:19:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373364",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:6'></a>
Or 48days :)



---

archive/issue_comments_373365.json:
```json
{
    "body": "<a id='comment:7'></a>\nI have a branch sitting there and for some reasons I don't remember I didn't push. I'll have to examine what it is. It is not finished in any case as changes in ecm interfaces are not yet taken into account in sage. It is just the package right now.",
    "created_at": "2016-11-17T21:30:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373365",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:7'></a>
I have a branch sitting there and for some reasons I don't remember I didn't push. I'll have to examine what it is. It is not finished in any case as changes in ecm interfaces are not yet taken into account in sage. It is just the package right now.



---

archive/issue_comments_373366.json:
```json
{
    "body": "<a id='comment:8'></a>\nHere's a patch that fixes sage interface, https://git.archlinux.org/svntogit/community.git/tree/trunk/ecm-7.patch?h=packages/sagemath",
    "created_at": "2017-03-19T04:32:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373366",
    "user": "https://github.com/isuruf"
}
```

<a id='comment:8'></a>
Here's a patch that fixes sage interface, https://git.archlinux.org/svntogit/community.git/tree/trunk/ecm-7.patch?h=packages/sagemath



---

archive/issue_comments_373367.json:
```json
{
    "body": "<a id='comment:9'></a>\nI should compare it to the debian one. I was hoping that a debian or arch dev would finish the ticket so they can be properly credited but obviously someone else will have to.",
    "created_at": "2017-03-19T05:17:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373367",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:9'></a>
I should compare it to the debian one. I was hoping that a debian or arch dev would finish the ticket so they can be properly credited but obviously someone else will have to.



---

archive/issue_comments_373368.json:
```json
{
    "body": "<a id='comment:0'></a>\ndebian patch is from arch. You can give credit by setting the git author to the author of the patch, https://git.archlinux.org/svntogit/community.git/patch/trunk/ecm-7.patch?id=e6b360003ee0d12fcc7c2a7e3eaa60bdb570325f",
    "created_at": "2017-03-19T05:58:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373368",
    "user": "https://github.com/isuruf"
}
```

<a id='comment:0'></a>
debian patch is from arch. You can give credit by setting the git author to the author of the patch, https://git.archlinux.org/svntogit/community.git/patch/trunk/ecm-7.patch?id=e6b360003ee0d12fcc7c2a7e3eaa60bdb570325f



---

archive/issue_comments_373369.json:
```json
{
    "body": "**Changing branch** from \"[u/leif/gmp-ecm-7.x](https://github.com/sagemath/sagetrac-mirror/tree/u/leif/gmp-ecm-7.x)\" to \"[u/jdemeyer/gmp-ecm-7.x](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/gmp-ecm-7.x)\".",
    "created_at": "2017-04-27T12:36:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373369",
    "user": "https://github.com/jdemeyer"
}
```

**Changing branch** from "[u/leif/gmp-ecm-7.x](https://github.com/sagemath/sagetrac-mirror/tree/u/leif/gmp-ecm-7.x)" to "[u/jdemeyer/gmp-ecm-7.x](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/gmp-ecm-7.x)".



---

archive/issue_comments_373370.json:
```json
{
    "body": "<a id='comment:2'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/eaee6e002fd1b89dc5c63401f72a3ff93678825c\">eaee6e0</a></td><td><code>Fix libecm doctests</code></td></tr></table>\n",
    "created_at": "2017-04-27T13:54:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373370",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/eaee6e002fd1b89dc5c63401f72a3ff93678825c">eaee6e0</a></td><td><code>Fix libecm doctests</code></td></tr></table>




---

archive/issue_comments_373371.json:
```json
{
    "body": "**Changing commit** from \"[e115141455e83eb0213a83d4153f72d80a767e2d](https://github.com/sagemath/sagetrac-mirror/commit/e115141455e83eb0213a83d4153f72d80a767e2d)\" to \"[eaee6e002fd1b89dc5c63401f72a3ff93678825c](https://github.com/sagemath/sagetrac-mirror/commit/eaee6e002fd1b89dc5c63401f72a3ff93678825c)\".",
    "created_at": "2017-04-27T13:54:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373371",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[e115141455e83eb0213a83d4153f72d80a767e2d](https://github.com/sagemath/sagetrac-mirror/commit/e115141455e83eb0213a83d4153f72d80a767e2d)" to "[eaee6e002fd1b89dc5c63401f72a3ff93678825c](https://github.com/sagemath/sagetrac-mirror/commit/eaee6e002fd1b89dc5c63401f72a3ff93678825c)".



---

archive/issue_comments_373372.json:
```json
{
    "body": "<a id='comment:3'></a>\n`@`jeroen: more work needed?",
    "created_at": "2017-04-28T15:07:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373372",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:3'></a>
`@`jeroen: more work needed?



---

archive/issue_comments_373373.json:
```json
{
    "body": "This has not been addressed yet:\n\nReplying to [ticket:20385 zimmerma]:\n>     * We definitely also have to fix the pexpect interface to `ecm`\n>       in `src/sage/interfaces/ecm.py`, as the command line interface\n>       has changed in GMP-ECM 7.x.",
    "created_at": "2017-04-28T15:12:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373373",
    "user": "https://github.com/jdemeyer"
}
```

This has not been addressed yet:

Replying to [ticket:20385 zimmerma]:
>     * We definitely also have to fix the pexpect interface to `ecm`
>       in `src/sage/interfaces/ecm.py`, as the command line interface
>       has changed in GMP-ECM 7.x.



---

archive/issue_comments_373374.json:
```json
{
    "body": "<a id='comment:5'></a>\nI don't plan to work more on this for now.",
    "created_at": "2017-04-28T15:13:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373374",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:5'></a>
I don't plan to work more on this for now.



---

archive/issue_comments_373375.json:
```json
{
    "body": "**Changing branch** from \"[u/jdemeyer/gmp-ecm-7.x](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/gmp-ecm-7.x)\" to \"[u/fbissey/gmp-ecm-7.x](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/gmp-ecm-7.x)\".",
    "created_at": "2017-05-11T01:53:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373375",
    "user": "https://github.com/kiwifb"
}
```

**Changing branch** from "[u/jdemeyer/gmp-ecm-7.x](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/gmp-ecm-7.x)" to "[u/fbissey/gmp-ecm-7.x](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/gmp-ecm-7.x)".



---

archive/issue_comments_373376.json:
```json
{
    "body": "**Changing commit** from \"[eaee6e002fd1b89dc5c63401f72a3ff93678825c](https://github.com/sagemath/sagetrac-mirror/commit/eaee6e002fd1b89dc5c63401f72a3ff93678825c)\" to \"[dde736b3c5382de6617fadd7597e4f48131af4cb](https://github.com/sagemath/sagetrac-mirror/commit/dde736b3c5382de6617fadd7597e4f48131af4cb)\".",
    "created_at": "2017-05-11T01:53:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373376",
    "user": "https://github.com/kiwifb"
}
```

**Changing commit** from "[eaee6e002fd1b89dc5c63401f72a3ff93678825c](https://github.com/sagemath/sagetrac-mirror/commit/eaee6e002fd1b89dc5c63401f72a3ff93678825c)" to "[dde736b3c5382de6617fadd7597e4f48131af4cb](https://github.com/sagemath/sagetrac-mirror/commit/dde736b3c5382de6617fadd7597e4f48131af4cb)".



---

archive/issue_comments_373377.json:
```json
{
    "body": "<a id='comment:6'></a>\nAdding the patch from arch linux (and credit the author properly) and let's try to finish this.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dea25cde0565301bbb2016ec9aea8784c928fd75\">dea25cd</a></td><td><code>Merge branch 'develop' into gmp-ecm-7.x</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dde736b3c5382de6617fadd7597e4f48131af4cb\">dde736b</a></td><td><code>Add interface patch for emc 7 from the Arch linux port. The Arch commit is credited to Antonio Rojas (arojas@archlinux.org)</code></td></tr></table>\n",
    "created_at": "2017-05-11T01:53:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373377",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:6'></a>
Adding the patch from arch linux (and credit the author properly) and let's try to finish this.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dea25cde0565301bbb2016ec9aea8784c928fd75">dea25cd</a></td><td><code>Merge branch 'develop' into gmp-ecm-7.x</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dde736b3c5382de6617fadd7597e4f48131af4cb">dde736b</a></td><td><code>Add interface patch for emc 7 from the Arch linux port. The Arch commit is credited to Antonio Rojas (arojas@archlinux.org)</code></td></tr></table>




---

archive/issue_comments_373378.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2017-05-11T01:53:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373378",
    "user": "https://github.com/kiwifb"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_373379.json:
```json
{
    "body": "**Changing author** from \"Leif Leonhardy\" to \"Leif Leonhardy, Jeroen Demeyer, Fran\u00e7ois Bissey, Antonio Rojas\".",
    "created_at": "2017-05-11T01:53:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373379",
    "user": "https://github.com/kiwifb"
}
```

**Changing author** from "Leif Leonhardy" to "Leif Leonhardy, Jeroen Demeyer, François Bissey, Antonio Rojas".



---

archive/issue_comments_373380.json:
```json
{
    "body": "<a id='comment:7'></a>\nThanks I was working on this but it will be faster to just review this patch.",
    "created_at": "2017-05-11T10:25:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373380",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:7'></a>
Thanks I was working on this but it will be faster to just review this patch.



---

archive/issue_comments_373381.json:
```json
{
    "body": "**Reviewer:** Jean-Pierre Flori",
    "created_at": "2017-05-11T11:12:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373381",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

**Reviewer:** Jean-Pierre Flori



---

archive/issue_comments_373382.json:
```json
{
    "body": "**Changing work_issues** from \"Fix doctests and pexpect interface to ecm\" to \"\".",
    "created_at": "2017-05-11T11:12:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373382",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

**Changing work_issues** from "Fix doctests and pexpect interface to ecm" to "".



---

archive/issue_comments_373383.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2017-05-11T11:12:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373383",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_373384.json:
```json
{
    "body": "**Changing status** from positive_review to needs_work.",
    "created_at": "2017-05-12T22:05:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373384",
    "user": "https://github.com/vbraun"
}
```

**Changing status** from positive_review to needs_work.



---

archive/issue_comments_373385.json:
```json
{
    "body": "<a id='comment:9'></a>\nTestsuite fails:\n\n```\n[ecm-7.0.4.p0] ********** Factor found in step 2: 4190453151940208656715582382315221647\n[ecm-7.0.4.p0] Found prime factor of 37 digits: 4190453151940208656715582382315221647\n[ecm-7.0.4.p0] Prime cofactor 543423179434447039008165356160798838947285203071935410761431031147 has 66 digits\n[ecm-7.0.4.p0] GMP-ECM 7.0.4 [configured with MPIR 2.7.2, --enable-asm-redc] [P+1]\n[ecm-7.0.4.p0] Save file test.pp1.save already exists, will not overwrite\n[ecm-7.0.4.p0] ############### ERROR ###############\n[ecm-7.0.4.p0] Expected return code 0 but got 1\n[ecm-7.0.4.p0] Makefile:2521: recipe for target 'longcheck' failed\n[ecm-7.0.4.p0] make[3]: *** [longcheck] Error 1\n[ecm-7.0.4.p0] PASS: test.pm1\n[ecm-7.0.4.p0] PASS: test.pp1\n[ecm-7.0.4.p0] PASS: test.ecm\n[ecm-7.0.4.p0] ============================================================================\n[ecm-7.0.4.p0] Testsuite summary for ecm 7.0.4\n[ecm-7.0.4.p0] ============================================================================\n[ecm-7.0.4.p0] # TOTAL: 3\n[ecm-7.0.4.p0] # PASS:  3\n[ecm-7.0.4.p0] # SKIP:  0\n[ecm-7.0.4.p0] # XFAIL: 0\n[ecm-7.0.4.p0] # FAIL:  0\n[ecm-7.0.4.p0] # XPASS: 0\n[ecm-7.0.4.p0] # ERROR: 0\n[ecm-7.0.4.p0] ============================================================================\n[ecm-7.0.4.p0] make[6]: Leaving directory '/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/var/tmp/sage/build/ecm-7.0.4.p0/src'\n[ecm-7.0.4.p0] make[5]: Leaving directory '/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/var/tmp/sage/build/ecm-7.0.4.p0/src'\n[ecm-7.0.4.p0] make[4]: Leaving directory '/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/var/tmp/sage/build/ecm-7.0.4.p0/src'\n[ecm-7.0.4.p0] make[3]: Leaving directory '/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/var/tmp/sage/build/ecm-7.0.4.p0/src'\n[ecm-7.0.4.p0] Error: GMP-ECM's test suite failed.\n```\n* http://build.sagedev.org/#/builders/82/builds/8/steps/5/logs/stdio\n* http://build.sagedev.org/#/builders/38/builds/6/steps/5/logs/stdio",
    "created_at": "2017-05-12T22:05:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373385",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:9'></a>
Testsuite fails:

```
[ecm-7.0.4.p0] ********** Factor found in step 2: 4190453151940208656715582382315221647
[ecm-7.0.4.p0] Found prime factor of 37 digits: 4190453151940208656715582382315221647
[ecm-7.0.4.p0] Prime cofactor 543423179434447039008165356160798838947285203071935410761431031147 has 66 digits
[ecm-7.0.4.p0] GMP-ECM 7.0.4 [configured with MPIR 2.7.2, --enable-asm-redc] [P+1]
[ecm-7.0.4.p0] Save file test.pp1.save already exists, will not overwrite
[ecm-7.0.4.p0] ############### ERROR ###############
[ecm-7.0.4.p0] Expected return code 0 but got 1
[ecm-7.0.4.p0] Makefile:2521: recipe for target 'longcheck' failed
[ecm-7.0.4.p0] make[3]: *** [longcheck] Error 1
[ecm-7.0.4.p0] PASS: test.pm1
[ecm-7.0.4.p0] PASS: test.pp1
[ecm-7.0.4.p0] PASS: test.ecm
[ecm-7.0.4.p0] ============================================================================
[ecm-7.0.4.p0] Testsuite summary for ecm 7.0.4
[ecm-7.0.4.p0] ============================================================================
[ecm-7.0.4.p0] # TOTAL: 3
[ecm-7.0.4.p0] # PASS:  3
[ecm-7.0.4.p0] # SKIP:  0
[ecm-7.0.4.p0] # XFAIL: 0
[ecm-7.0.4.p0] # FAIL:  0
[ecm-7.0.4.p0] # XPASS: 0
[ecm-7.0.4.p0] # ERROR: 0
[ecm-7.0.4.p0] ============================================================================
[ecm-7.0.4.p0] make[6]: Leaving directory '/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/var/tmp/sage/build/ecm-7.0.4.p0/src'
[ecm-7.0.4.p0] make[5]: Leaving directory '/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/var/tmp/sage/build/ecm-7.0.4.p0/src'
[ecm-7.0.4.p0] make[4]: Leaving directory '/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/var/tmp/sage/build/ecm-7.0.4.p0/src'
[ecm-7.0.4.p0] make[3]: Leaving directory '/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/var/tmp/sage/build/ecm-7.0.4.p0/src'
[ecm-7.0.4.p0] Error: GMP-ECM's test suite failed.
```
* http://build.sagedev.org/#/builders/82/builds/8/steps/5/logs/stdio
* http://build.sagedev.org/#/builders/38/builds/6/steps/5/logs/stdio



---

archive/issue_comments_373386.json:
```json
{
    "body": "<a id='comment:0'></a>\nLooks like a race condition in the test suite.",
    "created_at": "2017-05-12T23:05:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373386",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:0'></a>
Looks like a race condition in the test suite.



---

archive/issue_comments_373387.json:
```json
{
    "body": "<a id='comment:1'></a>\nYes, from Makefile.am\n\n```\nlongcheck: ecm$(EXEEXT)\n        $(srcdir)/test.pp1 \"$(VALGRIND) ./ecm$(EXEEXT)\"\n        $(srcdir)/test.pp1 \"$(VALGRIND) ./ecm$(EXEEXT) -no-ntt\"\n        $(srcdir)/test.pp1 \"$(VALGRIND) ./ecm$(EXEEXT) -modmuln\"\n        $(srcdir)/test.pp1 \"$(VALGRIND) ./ecm$(EXEEXT) -redc\"\n        $(srcdir)/test.pp1 \"$(VALGRIND) ./ecm$(EXEEXT) -mpzmod\"\n        $(srcdir)/test.pm1 \"$(VALGRIND) ./ecm$(EXEEXT)\"\n        $(srcdir)/test.pm1 \"$(VALGRIND) ./ecm$(EXEEXT) -no-ntt\"\n        $(srcdir)/test.pm1 \"$(VALGRIND) ./ecm$(EXEEXT) -modmuln\"\n        $(srcdir)/test.pm1 \"$(VALGRIND) ./ecm$(EXEEXT) -redc\"\n        $(srcdir)/test.pm1 \"$(VALGRIND) ./ecm$(EXEEXT) -mpzmod\"\n        $(srcdir)/test.ecm \"$(VALGRIND) ./ecm$(EXEEXT)\"\n        $(srcdir)/test.ecm \"$(VALGRIND) ./ecm$(EXEEXT) -no-ntt\"\n        $(srcdir)/test.ecm \"$(VALGRIND) ./ecm$(EXEEXT) -modmuln\"\n        $(srcdir)/test.ecm \"$(VALGRIND) ./ecm$(EXEEXT) -redc\"\n        $(srcdir)/test.ecm \"$(VALGRIND) ./ecm$(EXEEXT) -mpzmod\"\n        $(srcdir)/test.ecm \"$(VALGRIND) ./ecm$(EXEEXT) -treefile tree\"\n        $(srcdir)/testlong.pp1 \"$(VALGRIND) ./ecm$(EXEEXT)\"\n        $(srcdir)/testlong.pm1 \"$(VALGRIND) ./ecm$(EXEEXT)\"\n        $(srcdir)/testlong.ecm \"$(VALGRIND) ./ecm$(EXEEXT)\"\n```\nand on both bots the test are probably with `-j8`. Each instance of `test.pp1` can write `test.pp1.save`. There could be similar problem with other tests. The only solution, I think, is to run the longcheck serially.",
    "created_at": "2017-05-12T23:32:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373387",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:1'></a>
Yes, from Makefile.am

```
longcheck: ecm$(EXEEXT)
        $(srcdir)/test.pp1 "$(VALGRIND) ./ecm$(EXEEXT)"
        $(srcdir)/test.pp1 "$(VALGRIND) ./ecm$(EXEEXT) -no-ntt"
        $(srcdir)/test.pp1 "$(VALGRIND) ./ecm$(EXEEXT) -modmuln"
        $(srcdir)/test.pp1 "$(VALGRIND) ./ecm$(EXEEXT) -redc"
        $(srcdir)/test.pp1 "$(VALGRIND) ./ecm$(EXEEXT) -mpzmod"
        $(srcdir)/test.pm1 "$(VALGRIND) ./ecm$(EXEEXT)"
        $(srcdir)/test.pm1 "$(VALGRIND) ./ecm$(EXEEXT) -no-ntt"
        $(srcdir)/test.pm1 "$(VALGRIND) ./ecm$(EXEEXT) -modmuln"
        $(srcdir)/test.pm1 "$(VALGRIND) ./ecm$(EXEEXT) -redc"
        $(srcdir)/test.pm1 "$(VALGRIND) ./ecm$(EXEEXT) -mpzmod"
        $(srcdir)/test.ecm "$(VALGRIND) ./ecm$(EXEEXT)"
        $(srcdir)/test.ecm "$(VALGRIND) ./ecm$(EXEEXT) -no-ntt"
        $(srcdir)/test.ecm "$(VALGRIND) ./ecm$(EXEEXT) -modmuln"
        $(srcdir)/test.ecm "$(VALGRIND) ./ecm$(EXEEXT) -redc"
        $(srcdir)/test.ecm "$(VALGRIND) ./ecm$(EXEEXT) -mpzmod"
        $(srcdir)/test.ecm "$(VALGRIND) ./ecm$(EXEEXT) -treefile tree"
        $(srcdir)/testlong.pp1 "$(VALGRIND) ./ecm$(EXEEXT)"
        $(srcdir)/testlong.pm1 "$(VALGRIND) ./ecm$(EXEEXT)"
        $(srcdir)/testlong.ecm "$(VALGRIND) ./ecm$(EXEEXT)"
```
and on both bots the test are probably with `-j8`. Each instance of `test.pp1` can write `test.pp1.save`. There could be similar problem with other tests. The only solution, I think, is to run the longcheck serially.



---

archive/issue_comments_373388.json:
```json
{
    "body": "**Changing commit** from \"[dde736b3c5382de6617fadd7597e4f48131af4cb](https://github.com/sagemath/sagetrac-mirror/commit/dde736b3c5382de6617fadd7597e4f48131af4cb)\" to \"[946c5808691c5437cb6b2148fe0a5b7a200ce140](https://github.com/sagemath/sagetrac-mirror/commit/946c5808691c5437cb6b2148fe0a5b7a200ce140)\".",
    "created_at": "2017-05-12T23:40:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373388",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[dde736b3c5382de6617fadd7597e4f48131af4cb](https://github.com/sagemath/sagetrac-mirror/commit/dde736b3c5382de6617fadd7597e4f48131af4cb)" to "[946c5808691c5437cb6b2148fe0a5b7a200ce140](https://github.com/sagemath/sagetrac-mirror/commit/946c5808691c5437cb6b2148fe0a5b7a200ce140)".



---

archive/issue_comments_373389.json:
```json
{
    "body": "<a id='comment:2'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/946c5808691c5437cb6b2148fe0a5b7a200ce140\">946c580</a></td><td><code>making the longcheck tests run serially</code></td></tr></table>\n",
    "created_at": "2017-05-12T23:40:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373389",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/946c5808691c5437cb6b2148fe0a5b7a200ce140">946c580</a></td><td><code>making the longcheck tests run serially</code></td></tr></table>




---

archive/issue_comments_373390.json:
```json
{
    "body": "**Changing status** from needs_work to positive_review.",
    "created_at": "2017-05-12T23:40:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373390",
    "user": "https://github.com/kiwifb"
}
```

**Changing status** from needs_work to positive_review.



---

archive/issue_comments_373391.json:
```json
{
    "body": "<a id='comment:3'></a>\nPutting back to positive review to send back to the bots.",
    "created_at": "2017-05-12T23:40:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373391",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:3'></a>
Putting back to positive review to send back to the bots.



---

archive/issue_comments_373392.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2017-05-14T08:20:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373392",
    "user": "https://github.com/vbraun"
}
```

**Resolution:** fixed



---

archive/issue_events_062794.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-05-14T08:20:09Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20385#event-62794"
}
```



---

archive/issue_comments_373393.json:
```json
{
    "body": "**Changing branch** from \"[u/fbissey/gmp-ecm-7.x](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/gmp-ecm-7.x)\" to \"[946c5808691c5437cb6b2148fe0a5b7a200ce140](https://github.com/sagemath/sagetrac-mirror/commit/946c5808691c5437cb6b2148fe0a5b7a200ce140)\".",
    "created_at": "2017-05-14T08:20:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373393",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/fbissey/gmp-ecm-7.x](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/gmp-ecm-7.x)" to "[946c5808691c5437cb6b2148fe0a5b7a200ce140](https://github.com/sagemath/sagetrac-mirror/commit/946c5808691c5437cb6b2148fe0a5b7a200ce140)".



---

archive/issue_comments_373394.json:
```json
{
    "body": "<a id='comment:5'></a>\nfor the record, I have fixed upstream (svn revision 3022) so that we can now run `make check` in parallel. You could also apply the corresponding patch.",
    "created_at": "2017-05-16T11:11:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373394",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:5'></a>
for the record, I have fixed upstream (svn revision 3022) so that we can now run `make check` in parallel. You could also apply the corresponding patch.



---

archive/issue_comments_373395.json:
```json
{
    "body": "**Changing commit** from \"[946c5808691c5437cb6b2148fe0a5b7a200ce140](https://github.com/sagemath/sagetrac-mirror/commit/946c5808691c5437cb6b2148fe0a5b7a200ce140)\" to \"\".",
    "created_at": "2017-05-16T11:11:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373395",
    "user": "https://github.com/zimmermann6"
}
```

**Changing commit** from "[946c5808691c5437cb6b2148fe0a5b7a200ce140](https://github.com/sagemath/sagetrac-mirror/commit/946c5808691c5437cb6b2148fe0a5b7a200ce140)" to "".



---

archive/issue_comments_373396.json:
```json
{
    "body": "<a id='comment:6'></a>\nI see, you made all those little checkpointing files unique rather than re-using the same one all the time. Well this ticket is closed but we could have a follow up. And hopefully it won't languish for as much time as this one.",
    "created_at": "2017-05-16T11:26:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373396",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:6'></a>
I see, you made all those little checkpointing files unique rather than re-using the same one all the time. Well this ticket is closed but we could have a follow up. And hopefully it won't languish for as much time as this one.



---

archive/issue_comments_373397.json:
```json
{
    "body": "<a id='comment:7'></a>\nFollowup at #23013",
    "created_at": "2017-05-16T22:24:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373397",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:7'></a>
Followup at #23013



---

archive/issue_comments_373398.json:
```json
{
    "body": "<a id='comment:8'></a>\nSince this hasn't been released yet, why not just unmerge this?",
    "created_at": "2017-05-17T07:15:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373398",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'></a>
Since this hasn't been released yet, why not just unmerge this?



---

archive/issue_comments_373399.json:
```json
{
    "body": "<a id='comment:9'></a>\nNo particular reason...",
    "created_at": "2017-05-17T19:50:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20385",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20385#issuecomment-373399",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:9'></a>
No particular reason...
