# Issue 20943: Update a missing important speed improvement for subword complexes

archive/issues_020706.json:
```json
{
    "assignees": [],
    "body": "The method `_flip_c` currently uses\n\n```\nnr_ref = len(W.long_element(as_word=True))\n```\nwhich drastically slows down computations (here: the construction of cluster complexes using subword complexes through the greedy flip algorithm).\n\nCC:  @tscrim @fchapoton @nthiery\n\nKeywords: **reflection group, coxeter group, subword complex, days80**\n\nBranch/Commit: **[6f2172b](https://github.com/sagemath/sagetrac-mirror/commit/6f2172b794ec53d55bd7920125b92662dc17edc8)**\n\nReviewer: **Fr\u00e9d\u00e9ric Chapoton**\n\nAuthor: **Christian Stump**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/20943_\n\n",
    "closed_at": "2016-07-08T07:09:49Z",
    "created_at": "2016-07-05T18:33:21Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20combinatorics",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-7.3",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Update a missing important speed improvement for subword complexes",
    "type": "issue",
    "updated_at": "2016-07-08T07:09:49Z",
    "url": "https://github.com/sagemath/sage/issues/20943",
    "user": "https://github.com/sagetrac-stumpc5"
}
```
The method `_flip_c` currently uses

```
nr_ref = len(W.long_element(as_word=True))
```
which drastically slows down computations (here: the construction of cluster complexes using subword complexes through the greedy flip algorithm).

CC:  @tscrim @fchapoton @nthiery

Keywords: **reflection group, coxeter group, subword complex, days80**

Branch/Commit: **[6f2172b](https://github.com/sagemath/sagetrac-mirror/commit/6f2172b794ec53d55bd7920125b92662dc17edc8)**

Reviewer: **Frédéric Chapoton**

Author: **Christian Stump**

_Issue created by migration from https://trac.sagemath.org/ticket/20943_





---

archive/issue_events_276796.json:
```json
{
    "actor": "https://github.com/sagetrac-stumpc5",
    "created_at": "2016-07-05T18:33:21Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/20943",
    "milestone_number": null,
    "milestone_title": "sage-7.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20943#event-276796"
}
```



---

archive/issue_events_276797.json:
```json
{
    "actor": "https://github.com/sagetrac-stumpc5",
    "created_at": "2016-07-05T18:33:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20943",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20combinatorics",
    "label_color": "0000ff",
    "label_name": "component: combinatorics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20943#event-276797"
}
```



---

archive/issue_events_276798.json:
```json
{
    "actor": "https://github.com/sagetrac-stumpc5",
    "created_at": "2016-07-05T18:33:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20943",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20943#event-276798"
}
```



---

archive/issue_events_276799.json:
```json
{
    "actor": "https://github.com/sagetrac-stumpc5",
    "created_at": "2016-07-05T18:33:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20943",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20943#event-276799"
}
```



---

archive/issue_comments_306949.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">Comment 1</div>\n\nI will provide code in a minute; any suggestions how to properly do get the number of reflections in the fastest way for `WeylGroups` or `CoxeterGroups`? Currently, it uses the definition of the degrees, but that is too slow given that it should and can be fast.",
    "created_at": "2016-07-05T18:35:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20943",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20943#issuecomment-306949",
    "user": "https://github.com/sagetrac-stumpc5"
}
```

<div id="comment:1" align="right">Comment 1</div>

I will provide code in a minute; any suggestions how to properly do get the number of reflections in the fastest way for `WeylGroups` or `CoxeterGroups`? Currently, it uses the definition of the degrees, but that is too slow given that it should and can be fast.



---

archive/issue_comments_306950.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">Comment 2</div>\n\nFor Weyl groups, I get\n\n```\nsage: W = WeylGroup(['E',7])\nsage: %timeit len(W.long_element(as_word=True))\n10 loops, best of 3: 98.6 ms per loop\nsage: %timeit W.number_of_reflections()\n1 loop, best of 3: 208 ms per loop\n```\nand for Coxeter groups, I get\n\n```\nsage: W = CoxeterGroup(['E',7])\nsage: %timeit len(W.long_element(as_word=True))\n1 loop, best of 3: 206 ms per loop\nsage: %timeit W.number_of_reflections()\n1 loop, best of 3: 378 ms per loop\n```\nso I leave the current implementation for those (though this is not as clean as it should be).",
    "created_at": "2016-07-05T18:44:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20943",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20943#issuecomment-306950",
    "user": "https://github.com/sagetrac-stumpc5"
}
```

<div id="comment:2" align="right">Comment 2</div>

For Weyl groups, I get

```
sage: W = WeylGroup(['E',7])
sage: %timeit len(W.long_element(as_word=True))
10 loops, best of 3: 98.6 ms per loop
sage: %timeit W.number_of_reflections()
1 loop, best of 3: 208 ms per loop
```
and for Coxeter groups, I get

```
sage: W = CoxeterGroup(['E',7])
sage: %timeit len(W.long_element(as_word=True))
1 loop, best of 3: 206 ms per loop
sage: %timeit W.number_of_reflections()
1 loop, best of 3: 378 ms per loop
```
so I leave the current implementation for those (though this is not as clean as it should be).



---

archive/issue_comments_306951.json:
```json
{
    "body": "Branch: **[u/stumpc5/20943](https://github.com/sagemath/sagetrac-mirror/tree/u/stumpc5/20943)**",
    "created_at": "2016-07-05T18:56:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20943",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20943#issuecomment-306951",
    "user": "https://github.com/sagetrac-stumpc5"
}
```

Branch: **[u/stumpc5/20943](https://github.com/sagemath/sagetrac-mirror/tree/u/stumpc5/20943)**



---

archive/issue_comments_306952.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">Comment 4</div>\n\n\n```\nsage: W = ReflectionGroup(['A',6]); c = list(W.index_set())\nsage: Q = c+W.w0.coxeter_sorting_word(c)\nsage: %time S = SubwordComplex(Q,W.w0,algorithm=\"greedy\")\n```\nwith the fix, I get\n\n```\nCPU times: user 222 ms, sys: 16.1 ms, total: 238 ms\nWall time: 248 ms\n```\nand without the fix, I get\n\n```\nCPU times: user 1.35 s, sys: 37.7 ms, total: 1.39 s\nWall time: 1.4 s\n```\nFor types E, it becomes obviously much worse.",
    "created_at": "2016-07-05T18:58:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20943",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20943#issuecomment-306952",
    "user": "https://github.com/sagetrac-stumpc5"
}
```

<div id="comment:4" align="right">Comment 4</div>


```
sage: W = ReflectionGroup(['A',6]); c = list(W.index_set())
sage: Q = c+W.w0.coxeter_sorting_word(c)
sage: %time S = SubwordComplex(Q,W.w0,algorithm="greedy")
```
with the fix, I get

```
CPU times: user 222 ms, sys: 16.1 ms, total: 238 ms
Wall time: 248 ms
```
and without the fix, I get

```
CPU times: user 1.35 s, sys: 37.7 ms, total: 1.39 s
Wall time: 1.4 s
```
For types E, it becomes obviously much worse.



---

archive/issue_comments_306953.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">Comment 5</div>\n\nI tried to push and to set the branch by hand, but I am not sure it actually worked...",
    "created_at": "2016-07-05T19:16:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20943",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20943#issuecomment-306953",
    "user": "https://github.com/sagetrac-stumpc5"
}
```

<div id="comment:5" align="right">Comment 5</div>

I tried to push and to set the branch by hand, but I am not sure it actually worked...



---

archive/issue_comments_306954.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-The method ``_flip_c`` currently uses\n+The method `_flip_c` currently uses\n \n ```\n nr_ref = len(W.long_element(as_word=True))\n``````\n",
    "created_at": "2016-07-05T19:16:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20943",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20943#issuecomment-306954",
    "user": "https://github.com/sagetrac-stumpc5"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-The method ``_flip_c`` currently uses
+The method `_flip_c` currently uses
 
 ```
 nr_ref = len(W.long_element(as_word=True))
``````




---

archive/issue_events_276800.json:
```json
{
    "actor": "https://github.com/sagetrac-stumpc5",
    "created_at": "2016-07-05T19:17:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20943",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20943#event-276800"
}
```



---

archive/issue_comments_306955.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">Comment 7</div>\n\nSorry, but I do not understand the logic of your change.\n\nWhat is this attribute `__number_of_reflections` ? Does it exist only in the complex reflection group implementation ?\n\nOne should also replace the default code for `number_of_reflections` by the faster\n\n```\nfrom sage.rings.all import ZZ\nreturn ZZ.sum(self.degrees() - 1)\n```\nthat avoid to use rank.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dad4de4b43bb5405f3a2103ced4fc91cef5e9d65\">dad4de4</a></td><td><code>fixed the bux</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/aaf771ed669652a1b09d69b5e7c539afa950120a\">aaf771e</a></td><td><code>Merge branch 'develop' into u/stumpc5/20943</code></td></tr></table>\n",
    "created_at": "2016-07-06T09:55:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20943",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20943#issuecomment-306955",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:7" align="right">Comment 7</div>

Sorry, but I do not understand the logic of your change.

What is this attribute `__number_of_reflections` ? Does it exist only in the complex reflection group implementation ?

One should also replace the default code for `number_of_reflections` by the faster

```
from sage.rings.all import ZZ
return ZZ.sum(self.degrees() - 1)
```
that avoid to use rank.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dad4de4b43bb5405f3a2103ced4fc91cef5e9d65">dad4de4</a></td><td><code>fixed the bux</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/aaf771ed669652a1b09d69b5e7c539afa950120a">aaf771e</a></td><td><code>Merge branch 'develop' into u/stumpc5/20943</code></td></tr></table>




---

archive/issue_comments_306956.json:
```json
{
    "body": "Commit: **[aaf771e](https://github.com/sagemath/sagetrac-mirror/commit/aaf771ed669652a1b09d69b5e7c539afa950120a)**",
    "created_at": "2016-07-06T09:55:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20943",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20943#issuecomment-306956",
    "user": "https://github.com/fchapoton"
}
```

Commit: **[aaf771e](https://github.com/sagemath/sagetrac-mirror/commit/aaf771ed669652a1b09d69b5e7c539afa950120a)**



---

archive/issue_comments_306957.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">Comment 8</div>\n\nthe doctests are missing the `# optional`",
    "created_at": "2016-07-06T10:05:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20943",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20943#issuecomment-306957",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:8" align="right">Comment 8</div>

the doctests are missing the `# optional`



---

archive/issue_comments_306958.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">Comment 9</div>\n\nOkay, I guess you are right. I should and will do it properly:\n\n1. make the method `ReflectionGroup.number_of_reflections` use the attribute `ReflectionGroup._number_of_reflections` instead of recomputing it,\n\n2. make this flip code use the method instead of the attribute for `ReflectionGroup` and also use this attribute for `WeylGroup` and `CoxeterGroup`, and finally\n\n3. make `WeylGroup` and `CoxeterGroup` compute the number of reflections in the fastest possible way.",
    "created_at": "2016-07-06T12:01:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20943",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20943#issuecomment-306958",
    "user": "https://github.com/sagetrac-stumpc5"
}
```

<div id="comment:9" align="right">Comment 9</div>

Okay, I guess you are right. I should and will do it properly:

1. make the method `ReflectionGroup.number_of_reflections` use the attribute `ReflectionGroup._number_of_reflections` instead of recomputing it,

2. make this flip code use the method instead of the attribute for `ReflectionGroup` and also use this attribute for `WeylGroup` and `CoxeterGroup`, and finally

3. make `WeylGroup` and `CoxeterGroup` compute the number of reflections in the fastest possible way.



---

archive/issue_comments_306959.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">Comment 10</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f17422a1df8f9a0d15f7d51f7340f416625c4417\">f17422a</a></td><td><code>working out the proper way to compute the number of reflections</code></td></tr></table>\n",
    "created_at": "2016-07-06T12:10:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20943",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20943#issuecomment-306959",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:10" align="right">Comment 10</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f17422a1df8f9a0d15f7d51f7340f416625c4417">f17422a</a></td><td><code>working out the proper way to compute the number of reflections</code></td></tr></table>




---

archive/issue_comments_306960.json:
```json
{
    "body": "Changed commit from **[aaf771e](https://github.com/sagemath/sagetrac-mirror/commit/aaf771ed669652a1b09d69b5e7c539afa950120a)** to **[f17422a](https://github.com/sagemath/sagetrac-mirror/commit/f17422a1df8f9a0d15f7d51f7340f416625c4417)**",
    "created_at": "2016-07-06T12:10:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20943",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20943#issuecomment-306960",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[aaf771e](https://github.com/sagemath/sagetrac-mirror/commit/aaf771ed669652a1b09d69b5e7c539afa950120a)** to **[f17422a](https://github.com/sagemath/sagetrac-mirror/commit/f17422a1df8f9a0d15f7d51f7340f416625c4417)**



---

archive/issue_comments_306961.json:
```json
{
    "body": "Changed commit from **[f17422a](https://github.com/sagemath/sagetrac-mirror/commit/f17422a1df8f9a0d15f7d51f7340f416625c4417)** to **[6e97757](https://github.com/sagemath/sagetrac-mirror/commit/6e97757e2d1181e51ea381a49161e157b6df5418)**",
    "created_at": "2016-07-06T12:14:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20943",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20943#issuecomment-306961",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[f17422a](https://github.com/sagemath/sagetrac-mirror/commit/f17422a1df8f9a0d15f7d51f7340f416625c4417)** to **[6e97757](https://github.com/sagemath/sagetrac-mirror/commit/6e97757e2d1181e51ea381a49161e157b6df5418)**



---

archive/issue_comments_306962.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">Comment 11</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6e97757e2d1181e51ea381a49161e157b6df5418\">6e97757</a></td><td><code>updated the new doctests to be optional</code></td></tr></table>\n",
    "created_at": "2016-07-06T12:14:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20943",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20943#issuecomment-306962",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:11" align="right">Comment 11</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6e97757e2d1181e51ea381a49161e157b6df5418">6e97757</a></td><td><code>updated the new doctests to be optional</code></td></tr></table>




---

archive/issue_comments_306963.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">Comment 12</div>\n\nok. Looks much better.\n\nHave you re-done the timings to compare the new \"number_of_reflections\"\nwith the previously used len of the longest word ?",
    "created_at": "2016-07-06T12:20:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20943",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20943#issuecomment-306963",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:12" align="right">Comment 12</div>

ok. Looks much better.

Have you re-done the timings to compare the new "number_of_reflections"
with the previously used len of the longest word ?



---

archive/issue_comments_306964.json:
```json
{
    "body": "Changed commit from **[6e97757](https://github.com/sagemath/sagetrac-mirror/commit/6e97757e2d1181e51ea381a49161e157b6df5418)** to **[35a98d7](https://github.com/sagemath/sagetrac-mirror/commit/35a98d714455b0c2408e0420550997c0f7232dd9)**",
    "created_at": "2016-07-06T12:22:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20943",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20943#issuecomment-306964",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[6e97757](https://github.com/sagemath/sagetrac-mirror/commit/6e97757e2d1181e51ea381a49161e157b6df5418)** to **[35a98d7](https://github.com/sagemath/sagetrac-mirror/commit/35a98d714455b0c2408e0420550997c0f7232dd9)**



---

archive/issue_comments_306965.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">Comment 13</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/35a98d714455b0c2408e0420550997c0f7232dd9\">35a98d7</a></td><td><code>fixed the new doctests, all tests seem to pass now</code></td></tr></table>\n",
    "created_at": "2016-07-06T12:22:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20943",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20943#issuecomment-306965",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:13" align="right">Comment 13</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/35a98d714455b0c2408e0420550997c0f7232dd9">35a98d7</a></td><td><code>fixed the new doctests, all tests seem to pass now</code></td></tr></table>




---

archive/issue_comments_306966.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">Comment 14</div>\n\nThe timings should still be the old as the change\n\n```\n-            return ZZ.sum(self.degrees()) - self.rank()\n+            return ZZ.sum(deg-1 for deg in self.degrees())\n```\nshould not make any difference... (just checked, no change there). It would be better if we either do a speed improvement of the `degrees` method for `WeylGroup` and `CoxeterGroup`, or make `number_of_reflections` there use the length of the longest element there instead.",
    "created_at": "2016-07-06T12:25:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20943",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20943#issuecomment-306966",
    "user": "https://github.com/sagetrac-stumpc5"
}
```

<div id="comment:14" align="right">Comment 14</div>

The timings should still be the old as the change

```
-            return ZZ.sum(self.degrees()) - self.rank()
+            return ZZ.sum(deg-1 for deg in self.degrees())
```
should not make any difference... (just checked, no change there). It would be better if we either do a speed improvement of the `degrees` method for `WeylGroup` and `CoxeterGroup`, or make `number_of_reflections` there use the length of the longest element there instead.



---

archive/issue_comments_306967.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">Comment 15</div>\n\nBut I think that should go into a different ticket.",
    "created_at": "2016-07-06T12:26:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20943",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20943#issuecomment-306967",
    "user": "https://github.com/sagetrac-stumpc5"
}
```

<div id="comment:15" align="right">Comment 15</div>

But I think that should go into a different ticket.



---

archive/issue_comments_306968.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">Comment 16</div>\n\nReplying to [@sagetrac-stumpc5](#comment%3A15):\n> But I think that should go into a different ticket.\n\nok, indeed.",
    "created_at": "2016-07-06T12:29:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20943",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20943#issuecomment-306968",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:16" align="right">Comment 16</div>

Replying to [@sagetrac-stumpc5](#comment%3A15):
> But I think that should go into a different ticket.

ok, indeed.



---

archive/issue_comments_306969.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">Comment 17</div>\n\nAn idea: why not make `number_of_reflection` a `cached_method` in all cases?",
    "created_at": "2016-07-06T12:31:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20943",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20943#issuecomment-306969",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:17" align="right">Comment 17</div>

An idea: why not make `number_of_reflection` a `cached_method` in all cases?



---

archive/issue_comments_306970.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">Comment 18</div>\n\nThat is now #20956.",
    "created_at": "2016-07-06T12:34:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20943",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20943#issuecomment-306970",
    "user": "https://github.com/sagetrac-stumpc5"
}
```

<div id="comment:18" align="right">Comment 18</div>

That is now #20956.



---

archive/issue_comments_306971.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">Comment 19</div>\n\nReplying to [@fchapoton](#comment%3A17):\n> An idea: why not make `number_of_reflection` a `cached_method` in all cases?\n\nWhy not, we could also do that. Maybe that's even the \"right\" solution, as the caching doesn't take any memory while avoids recomputing a bigger computation again and again.",
    "created_at": "2016-07-06T12:36:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20943",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20943#issuecomment-306971",
    "user": "https://github.com/sagetrac-stumpc5"
}
```

<div id="comment:19" align="right">Comment 19</div>

Replying to [@fchapoton](#comment%3A17):
> An idea: why not make `number_of_reflection` a `cached_method` in all cases?

Why not, we could also do that. Maybe that's even the "right" solution, as the caching doesn't take any memory while avoids recomputing a bigger computation again and again.



---

archive/issue_comments_306972.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">Comment 20</div>\n\nIf you do not object, I would add this here to this ticket and make the other a duplicate.",
    "created_at": "2016-07-06T12:36:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20943",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20943#issuecomment-306972",
    "user": "https://github.com/sagetrac-stumpc5"
}
```

<div id="comment:20" align="right">Comment 20</div>

If you do not object, I would add this here to this ticket and make the other a duplicate.



---

archive/issue_comments_306973.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">Comment 21</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/250aaee516c3ee3cee3751090e5435d94b79b998\">250aaee</a></td><td><code>added cached methods to number of reflections/hyperplanes and rank</code></td></tr></table>\n",
    "created_at": "2016-07-06T12:43:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20943",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20943#issuecomment-306973",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:21" align="right">Comment 21</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/250aaee516c3ee3cee3751090e5435d94b79b998">250aaee</a></td><td><code>added cached methods to number of reflections/hyperplanes and rank</code></td></tr></table>




---

archive/issue_comments_306974.json:
```json
{
    "body": "Changed commit from **[35a98d7](https://github.com/sagemath/sagetrac-mirror/commit/35a98d714455b0c2408e0420550997c0f7232dd9)** to **[250aaee](https://github.com/sagemath/sagetrac-mirror/commit/250aaee516c3ee3cee3751090e5435d94b79b998)**",
    "created_at": "2016-07-06T12:43:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20943",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20943#issuecomment-306974",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[35a98d7](https://github.com/sagemath/sagetrac-mirror/commit/35a98d714455b0c2408e0420550997c0f7232dd9)** to **[250aaee](https://github.com/sagemath/sagetrac-mirror/commit/250aaee516c3ee3cee3751090e5435d94b79b998)**



---

archive/issue_comments_306975.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">Comment 22</div>\n\nok, then you can get rid of the attribute and the method in reflection_group_complex",
    "created_at": "2016-07-06T12:45:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20943",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20943#issuecomment-306975",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:22" align="right">Comment 22</div>

ok, then you can get rid of the attribute and the method in reflection_group_complex



---

archive/issue_comments_306976.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">Comment 23</div>\n\nReplying to [@fchapoton](#comment%3A22):\n> ok, then you can get rid of the attribute and the method in reflection_group_complex\n\nOut of curiosity: is it faster to use a cached method, or to use an attribute? Or is that difference never important?",
    "created_at": "2016-07-06T12:57:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20943",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20943#issuecomment-306976",
    "user": "https://github.com/sagetrac-stumpc5"
}
```

<div id="comment:23" align="right">Comment 23</div>

Replying to [@fchapoton](#comment%3A22):
> ok, then you can get rid of the attribute and the method in reflection_group_complex

Out of curiosity: is it faster to use a cached method, or to use an attribute? Or is that difference never important?



---

archive/issue_comments_306977.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">Comment 24</div>\n\nI do not know, sorry. I guess both are fast enough for our purposes, but we can aim\nfor simplicity for the moment, maybe ?",
    "created_at": "2016-07-06T13:01:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20943",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20943#issuecomment-306977",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:24" align="right">Comment 24</div>

I do not know, sorry. I guess both are fast enough for our purposes, but we can aim
for simplicity for the moment, maybe ?



---

archive/issue_comments_306978.json:
```json
{
    "body": "Changed commit from **[250aaee](https://github.com/sagemath/sagetrac-mirror/commit/250aaee516c3ee3cee3751090e5435d94b79b998)** to **[6f2172b](https://github.com/sagemath/sagetrac-mirror/commit/6f2172b794ec53d55bd7920125b92662dc17edc8)**",
    "created_at": "2016-07-06T13:04:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20943",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20943#issuecomment-306978",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[250aaee](https://github.com/sagemath/sagetrac-mirror/commit/250aaee516c3ee3cee3751090e5435d94b79b998)** to **[6f2172b](https://github.com/sagemath/sagetrac-mirror/commit/6f2172b794ec53d55bd7920125b92662dc17edc8)**



---

archive/issue_comments_306979.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">Comment 25</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6f2172b794ec53d55bd7920125b92662dc17edc8\">6f2172b</a></td><td><code>replaced _number_of_reflections by number_of_reflections() everywhere</code></td></tr></table>\n",
    "created_at": "2016-07-06T13:04:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20943",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20943#issuecomment-306979",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:25" align="right">Comment 25</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6f2172b794ec53d55bd7920125b92662dc17edc8">6f2172b</a></td><td><code>replaced _number_of_reflections by number_of_reflections() everywhere</code></td></tr></table>




---

archive/issue_comments_306980.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">Comment 26</div>\n\nok, let it be.",
    "created_at": "2016-07-06T13:20:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20943",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20943#issuecomment-306980",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:26" align="right">Comment 26</div>

ok, let it be.



---

archive/issue_comments_306981.json:
```json
{
    "body": "Reviewer: **Fr\u00e9d\u00e9ric Chapoton**",
    "created_at": "2016-07-06T13:20:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20943",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20943#issuecomment-306981",
    "user": "https://github.com/fchapoton"
}
```

Reviewer: **Frédéric Chapoton**



---

archive/issue_events_276801.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-07-06T13:20:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20943",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20943#event-276801"
}
```



---

archive/issue_events_276802.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-07-06T13:20:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20943",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20943#event-276802"
}
```



---

archive/issue_comments_306982.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">Comment 27</div>\n\nReplying to [@fchapoton](#comment%3A26):\n> ok, let it be.\n\nthanks!",
    "created_at": "2016-07-06T13:21:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20943",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20943#issuecomment-306982",
    "user": "https://github.com/sagetrac-stumpc5"
}
```

<div id="comment:27" align="right">Comment 27</div>

Replying to [@fchapoton](#comment%3A26):
> ok, let it be.

thanks!



---

archive/issue_comments_306983.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">Comment 28</div>\n\nJust FYI - calling a `@cached_method` is ~10% slower than a (Python) attribute lookup:\n\n```python\nsage: class Foo(object):\n....:     def __init__(self, x):\n....:         self.x = x\n....:         self._y = x\n....:     @cached_method\n....:     def y(self):\n....:         return self._y\n....:     \nsage: F = Foo(5)\nsage: %timeit F.x\nThe slowest run took 73.41 times longer than the fastest. This could mean that an intermediate result is being cached.\n10000000 loops, best of 3: 42.2 ns per loop\nsage: %timeit F.y()\nThe slowest run took 2799.35 times longer than the fastest. This could mean that an intermediate result is being cached.\n10000000 loops, best of 3: 57.1 ns per loop\n```\nHowever, it is better code (IMO) to use the cached method mechanism, and it makes it easier to change/override it.",
    "created_at": "2016-07-06T21:09:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20943",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20943#issuecomment-306983",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:28" align="right">Comment 28</div>

Just FYI - calling a `@cached_method` is ~10% slower than a (Python) attribute lookup:

```python
sage: class Foo(object):
....:     def __init__(self, x):
....:         self.x = x
....:         self._y = x
....:     @cached_method
....:     def y(self):
....:         return self._y
....:     
sage: F = Foo(5)
sage: %timeit F.x
The slowest run took 73.41 times longer than the fastest. This could mean that an intermediate result is being cached.
10000000 loops, best of 3: 42.2 ns per loop
sage: %timeit F.y()
The slowest run took 2799.35 times longer than the fastest. This could mean that an intermediate result is being cached.
10000000 loops, best of 3: 57.1 ns per loop
```
However, it is better code (IMO) to use the cached method mechanism, and it makes it easier to change/override it.



---

archive/issue_events_276803.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-07-08T07:09:49Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20943",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20943#event-276803"
}
```



---

archive/issue_events_276804.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "f658e72f900bf85b1b03628680147dfb0ee99d7e",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2016-07-08T07:09:49Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/20943",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20943#event-276804"
}
```



---

archive/issue_comments_306984.json:
```json
{
    "body": "Changed branch from **[u/stumpc5/20943](https://github.com/sagemath/sagetrac-mirror/tree/u/stumpc5/20943)** to **[6f2172b](https://github.com/sagemath/sagetrac-mirror/commit/6f2172b794ec53d55bd7920125b92662dc17edc8)**",
    "created_at": "2016-07-08T07:09:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20943",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20943#issuecomment-306984",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/stumpc5/20943](https://github.com/sagemath/sagetrac-mirror/tree/u/stumpc5/20943)** to **[6f2172b](https://github.com/sagemath/sagetrac-mirror/commit/6f2172b794ec53d55bd7920125b92662dc17edc8)**
