# Issue 20166: Implement non-recursive iterator for (weighted) integer vectors

archive/issues_019929.json:
```json
{
    "body": "By implementing a non-recursive iterator, we avoid some overhead. With this branch, we get the following:\n\n```\nsage: I = IntegerVectors(12,7)\nsage: %timeit list(I.__iter__())\n10 loops, best of 3: 20.8 ms per loop\nsage: I = WeightedIntegerVectors(12, [4,1,2,2])\nsage: %timeit list(I.__iter__())\n1000 loops, best of 3: 291 \u00b5s per loop\nsage: I = WeightedIntegerVectors(12, [2,1,1,2])\nsage: %timeit list(I.__iter__())\n1000 loops, best of 3: 556 \u00b5s per loop\nsage: I = WeightedIntegerVectors(17, [2,1,1,2,1,1,2])\nsage: %timeit list(I.__iter__())\n10 loops, best of 3: 56.4 ms per loop\nsage: I = WeightedIntegerVectors(26, [2,1,1,2,1,1,2])\nsage: %timeit list(I.__iter__())\n1 loop, best of 3: 443 ms per loop\n```\nversus the current version:\n\n```\nsage: I = IntegerVectors(12,7)\nsage: %timeit list(I.__iter__())\n10 loops, best of 3: 50.3 ms per loop\nsage: %timeit list(I.__iter__())\nThe slowest run took 8.13 times longer than the fastest. This could mean that an intermediate result is being cached.\n1000 loops, best of 3: 301 \u00b5s per loop\nsage: I = WeightedIntegerVectors(12, [2,1,1,2])\nsage: %timeit list(I.__iter__())\n1000 loops, best of 3: 554 \u00b5s per loop\nsage: I = WeightedIntegerVectors(17, [2,1,1,2,1,1,2])\nsage: %timeit list(I.__iter__())\n10 loops, best of 3: 68.1 ms per loop\nsage: I = WeightedIntegerVectors(26, [2,1,1,2,1,1,2])\nsage: %timeit list(I.__iter__())\n1 loop , best of 3: 528 ms per loop\n```\n\nAssignee: sage-combinat\n\nCC:  sage-combinat @fchapoton @videlec\n\nReviewer: Vincent Delecroix\n\nAuthor: Travis Scrimshaw\n\nBranch: 6a4acb53d3eb196e2d508b32508d57888884dc28\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/20166\n\n",
    "closed_at": "2016-04-17T11:27:32Z",
    "created_at": "2016-03-05T14:45:49Z",
    "labels": [
        "component: combinatorics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.2",
    "title": "Implement non-recursive iterator for (weighted) integer vectors",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/20166",
    "user": "https://github.com/tscrim"
}
```
By implementing a non-recursive iterator, we avoid some overhead. With this branch, we get the following:

```
sage: I = IntegerVectors(12,7)
sage: %timeit list(I.__iter__())
10 loops, best of 3: 20.8 ms per loop
sage: I = WeightedIntegerVectors(12, [4,1,2,2])
sage: %timeit list(I.__iter__())
1000 loops, best of 3: 291 µs per loop
sage: I = WeightedIntegerVectors(12, [2,1,1,2])
sage: %timeit list(I.__iter__())
1000 loops, best of 3: 556 µs per loop
sage: I = WeightedIntegerVectors(17, [2,1,1,2,1,1,2])
sage: %timeit list(I.__iter__())
10 loops, best of 3: 56.4 ms per loop
sage: I = WeightedIntegerVectors(26, [2,1,1,2,1,1,2])
sage: %timeit list(I.__iter__())
1 loop, best of 3: 443 ms per loop
```
versus the current version:

```
sage: I = IntegerVectors(12,7)
sage: %timeit list(I.__iter__())
10 loops, best of 3: 50.3 ms per loop
sage: %timeit list(I.__iter__())
The slowest run took 8.13 times longer than the fastest. This could mean that an intermediate result is being cached.
1000 loops, best of 3: 301 µs per loop
sage: I = WeightedIntegerVectors(12, [2,1,1,2])
sage: %timeit list(I.__iter__())
1000 loops, best of 3: 554 µs per loop
sage: I = WeightedIntegerVectors(17, [2,1,1,2,1,1,2])
sage: %timeit list(I.__iter__())
10 loops, best of 3: 68.1 ms per loop
sage: I = WeightedIntegerVectors(26, [2,1,1,2,1,1,2])
sage: %timeit list(I.__iter__())
1 loop , best of 3: 528 ms per loop
```

Assignee: sage-combinat

CC:  sage-combinat @fchapoton @videlec

Reviewer: Vincent Delecroix

Author: Travis Scrimshaw

Branch: 6a4acb53d3eb196e2d508b32508d57888884dc28

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/20166





---

archive/issue_comments_364807.json:
```json
{
    "body": "<a id='comment:1'></a>\nNew commits:\n|                                                                                                                                          |                                                           |\n|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------|\n|[f5ed6dc](http://git.sagemath.org/sage.git/commit/?id=f5ed6dc5dac4a5c93465b2fcd179975deddd0583)|`Implemented a non-recursive iterator for integer vectors.`|\n|[1df837d](http://git.sagemath.org/sage.git/commit/?id=1df837d59345c9a06e113657c6fc35ef8561a69c)|`Implemented a non-recursive iterator for (weighted) integer vectors.`|",
    "created_at": "2016-03-05T14:47:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20166#issuecomment-364807",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:1'></a>
New commits:
|                                                                                                                                          |                                                           |
|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------|
|[f5ed6dc](http://git.sagemath.org/sage.git/commit/?id=f5ed6dc5dac4a5c93465b2fcd179975deddd0583)|`Implemented a non-recursive iterator for integer vectors.`|
|[1df837d](http://git.sagemath.org/sage.git/commit/?id=1df837d59345c9a06e113657c6fc35ef8561a69c)|`Implemented a non-recursive iterator for (weighted) integer vectors.`|



---

archive/issue_comments_364808.json:
```json
{
    "body": "Changing commit from \"\" to \"1df837d59345c9a06e113657c6fc35ef8561a69c\"",
    "created_at": "2016-03-05T14:47:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20166#issuecomment-364808",
    "user": "https://github.com/tscrim"
}
```

Changing commit from "" to "1df837d59345c9a06e113657c6fc35ef8561a69c"



---

archive/issue_comments_364809.json:
```json
{
    "body": "Changing branch from \"\" to \"public/combinat/integer_vectors_iterator-20166\"",
    "created_at": "2016-03-05T14:47:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20166#issuecomment-364809",
    "user": "https://github.com/tscrim"
}
```

Changing branch from "" to "public/combinat/integer_vectors_iterator-20166"



---

archive/issue_comments_364810.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-03-05T14:47:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20166#issuecomment-364810",
    "user": "https://github.com/tscrim"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_364811.json:
```json
{
    "body": "Changing commit from \"1df837d59345c9a06e113657c6fc35ef8561a69c\" to \"36222eb9333ea8b7ba3266b5dc26e54511074c37\"",
    "created_at": "2016-04-10T08:57:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20166#issuecomment-364811",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "1df837d59345c9a06e113657c6fc35ef8561a69c" to "36222eb9333ea8b7ba3266b5dc26e54511074c37"



---

archive/issue_comments_364812.json:
```json
{
    "body": "<a id='comment:2'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                                                                                                                                             |\n|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------|\n|[3f1ec77](http://git.sagemath.org/sage.git/commit/?id=3f1ec77d5390ac80af4cf43c1038810a6c8f43e2)|`Merge branch 'public/combinat/integer_vectors_iterator-20166' of trac.sagemath.org:sage into public/combinat/integer_vectors_iterator-20166`|\n|[36222eb](http://git.sagemath.org/sage.git/commit/?id=36222eb9333ea8b7ba3266b5dc26e54511074c37)|`If checking mod == 0, then make sure to do the division.`|",
    "created_at": "2016-04-10T08:57:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20166#issuecomment-364812",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                                                                                                                                             |
|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------|
|[3f1ec77](http://git.sagemath.org/sage.git/commit/?id=3f1ec77d5390ac80af4cf43c1038810a6c8f43e2)|`Merge branch 'public/combinat/integer_vectors_iterator-20166' of trac.sagemath.org:sage into public/combinat/integer_vectors_iterator-20166`|
|[36222eb](http://git.sagemath.org/sage.git/commit/?id=36222eb9333ea8b7ba3266b5dc26e54511074c37)|`If checking mod == 0, then make sure to do the division.`|



---

archive/issue_comments_364813.json:
```json
{
    "body": "<a id='comment:3'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                                                                                                                                             |\n|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------|\n|[0875489](http://git.sagemath.org/sage.git/commit/?id=087548974f1b52ca22ace93170af8dc48d1890bf)|`Merge branch 'public/combinat/integer_vectors_iterator-20166' of trac.sagemath.org:sage into public/combinat/integer_vectors_iterator-20166`|\n|[39642ea](http://git.sagemath.org/sage.git/commit/?id=39642ea067ed12f8e0fd28f8da481720d7c5778e)|`Make sure for the iterator that k is an int.`|",
    "created_at": "2016-04-15T16:05:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20166#issuecomment-364813",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                                                                                                                                             |
|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------|
|[0875489](http://git.sagemath.org/sage.git/commit/?id=087548974f1b52ca22ace93170af8dc48d1890bf)|`Merge branch 'public/combinat/integer_vectors_iterator-20166' of trac.sagemath.org:sage into public/combinat/integer_vectors_iterator-20166`|
|[39642ea](http://git.sagemath.org/sage.git/commit/?id=39642ea067ed12f8e0fd28f8da481720d7c5778e)|`Make sure for the iterator that k is an int.`|



---

archive/issue_comments_364814.json:
```json
{
    "body": "Changing commit from \"36222eb9333ea8b7ba3266b5dc26e54511074c37\" to \"39642ea067ed12f8e0fd28f8da481720d7c5778e\"",
    "created_at": "2016-04-15T16:05:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20166#issuecomment-364814",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "36222eb9333ea8b7ba3266b5dc26e54511074c37" to "39642ea067ed12f8e0fd28f8da481720d7c5778e"



---

archive/issue_events_054817.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2016-04-15T16:06:14Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/20166",
    "milestone": "sage-7.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20166#event-54817"
}
```



---

archive/issue_comments_364815.json:
```json
{
    "body": "Changing commit from \"39642ea067ed12f8e0fd28f8da481720d7c5778e\" to \"6a4acb53d3eb196e2d508b32508d57888884dc28\"",
    "created_at": "2016-04-16T14:03:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20166#issuecomment-364815",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "39642ea067ed12f8e0fd28f8da481720d7c5778e" to "6a4acb53d3eb196e2d508b32508d57888884dc28"



---

archive/issue_comments_364816.json:
```json
{
    "body": "<a id='comment:5'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                                         |\n|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------|\n|[6a4acb5](http://git.sagemath.org/sage.git/commit/?id=6a4acb53d3eb196e2d508b32508d57888884dc28)|`Trac 20166: change order + optimisation`|",
    "created_at": "2016-04-16T14:03:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20166#issuecomment-364816",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                                         |
|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------|
|[6a4acb5](http://git.sagemath.org/sage.git/commit/?id=6a4acb53d3eb196e2d508b32508d57888884dc28)|`Trac 20166: change order + optimisation`|



---

archive/issue_comments_364817.json:
```json
{
    "body": "<a id='comment:6'></a>\nUp to twice faster than your version ;-)\n\n- it is always a bad idea to use `list.insert(0, XX)` and `list.pop(0)`. Lists are implemented as C arrays, and modifications at the bottom is `O(n)`. Whereas `list.append()` and `list.pop()` are always `O(1)` (if we ignore memory allocation).\n\n- it is always good to avoid coercion `int / ZZ`.\n\nIt is good to go for me",
    "created_at": "2016-04-16T14:05:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20166#issuecomment-364817",
    "user": "https://github.com/videlec"
}
```

<a id='comment:6'></a>
Up to twice faster than your version ;-)

- it is always a bad idea to use `list.insert(0, XX)` and `list.pop(0)`. Lists are implemented as C arrays, and modifications at the bottom is `O(n)`. Whereas `list.append()` and `list.pop()` are always `O(1)` (if we ignore memory allocation).

- it is always good to avoid coercion `int / ZZ`.

It is good to go for me



---

archive/issue_comments_364818.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Vincent Delecroix\"",
    "created_at": "2016-04-16T14:06:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20166#issuecomment-364818",
    "user": "https://github.com/videlec"
}
```

Changing reviewer from "" to "Vincent Delecroix"



---

archive/issue_comments_364819.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-04-16T18:45:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20166#issuecomment-364819",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_364820.json:
```json
{
    "body": "<a id='comment:8'></a>\nLGTM. Thank you!",
    "created_at": "2016-04-16T18:45:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20166#issuecomment-364820",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:8'></a>
LGTM. Thank you!



---

archive/issue_comments_364821.json:
```json
{
    "body": "Changing branch from \"public/combinat/integer_vectors_iterator-20166\" to \"6a4acb53d3eb196e2d508b32508d57888884dc28\"",
    "created_at": "2016-04-17T11:27:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20166#issuecomment-364821",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "public/combinat/integer_vectors_iterator-20166" to "6a4acb53d3eb196e2d508b32508d57888884dc28"



---

archive/issue_events_054818.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-04-17T11:27:32Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/20166",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20166#event-54818"
}
```



---

archive/issue_comments_364822.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-04-17T11:27:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20166#issuecomment-364822",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_364823.json:
```json
{
    "body": "<a id='comment:10'></a>\nI think this causes the problem at #20491.",
    "created_at": "2016-04-23T23:35:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20166#issuecomment-364823",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:10'></a>
I think this causes the problem at #20491.



---

archive/issue_comments_364824.json:
```json
{
    "body": "Changing commit from \"6a4acb53d3eb196e2d508b32508d57888884dc28\" to \"\"",
    "created_at": "2016-04-23T23:35:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20166#issuecomment-364824",
    "user": "https://github.com/jhpalmieri"
}
```

Changing commit from "6a4acb53d3eb196e2d508b32508d57888884dc28" to ""
