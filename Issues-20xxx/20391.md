# Issue 20391: count_points breaks on even-degree hyperelliptic curves

archive/issues_020154.json:
```json
{
    "assignees": [],
    "body": "The following is currently broken:\n\n```\nsage: x = polygen(GF(4099))\nsage: H = HyperellipticCurve(x^6 + x + 1)\nsage: H.count_points(1)\n...\nValueError: Q must be a monic polynomial of odd degree >= 3\n```\nThe problem is that ultimately this is trying to call hypellfrob, which is only implemented for odd degree polynomials. One can patch around this using either PARI's hyperellcharpoly or the naive point counting code.\n\nIn the longer term, some more intelligent switching needs to be implemented for this method, as well as the related zeta_function and zeta_series methods; these do not all optimize the same way. See #965, #16931, #18916, #20309 for related discussions.\n\nDepends on #18916\n\nCC:  @JohnCremona\n\nKeywords: **hyperelliptic curve, number of points**\n\nBranch/Commit: **[`dabfdd8`](https://github.com/sagemath/sagetrac-mirror/commit/dabfdd8c05077107b64d4c038fe20f6609f893c3)**\n\nReviewer: **Jean-Pierre Flori**\n\nAuthor: **Kiran Kedlaya**\n\nComponent: **algebraic geometry**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/20391_\n\n",
    "closed_at": "2016-11-19T16:35:02Z",
    "created_at": "2016-04-08T16:37:05Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20algebraic%20geometry",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-7.5",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "count_points breaks on even-degree hyperelliptic curves",
    "type": "issue",
    "updated_at": "2016-11-19T16:35:02Z",
    "url": "https://github.com/sagemath/sage/issues/20391",
    "user": "https://github.com/kedlaya"
}
```
The following is currently broken:

```
sage: x = polygen(GF(4099))
sage: H = HyperellipticCurve(x^6 + x + 1)
sage: H.count_points(1)
...
ValueError: Q must be a monic polynomial of odd degree >= 3
```
The problem is that ultimately this is trying to call hypellfrob, which is only implemented for odd degree polynomials. One can patch around this using either PARI's hyperellcharpoly or the naive point counting code.

In the longer term, some more intelligent switching needs to be implemented for this method, as well as the related zeta_function and zeta_series methods; these do not all optimize the same way. See #965, #16931, #18916, #20309 for related discussions.

Depends on #18916

CC:  @JohnCremona

Keywords: **hyperelliptic curve, number of points**

Branch/Commit: **[`dabfdd8`](https://github.com/sagemath/sagetrac-mirror/commit/dabfdd8c05077107b64d4c038fe20f6609f893c3)**

Reviewer: **Jean-Pierre Flori**

Author: **Kiran Kedlaya**

Component: **algebraic geometry**

_Issue created by migration from https://trac.sagemath.org/ticket/20391_





---

archive/issue_events_287686.json:
```json
{
    "actor": "https://github.com/kedlaya",
    "created_at": "2016-04-08T16:37:05Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/20391",
    "milestone_number": null,
    "milestone_title": "sage-7.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20391#event-287686"
}
```



---

archive/issue_events_287687.json:
```json
{
    "actor": "https://github.com/kedlaya",
    "created_at": "2016-04-08T16:37:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20391",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20algebraic%20geometry",
    "label_color": "0000ff",
    "label_name": "c: algebraic geometry",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20391#event-287687"
}
```



---

archive/issue_events_287688.json:
```json
{
    "actor": "https://github.com/kedlaya",
    "created_at": "2016-04-08T16:37:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20391",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20391#event-287688"
}
```



---

archive/issue_events_287689.json:
```json
{
    "actor": "https://github.com/kedlaya",
    "created_at": "2016-04-08T16:37:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20391",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20391#event-287689"
}
```



---

archive/issue_comments_294494.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nThere is a commit on #18916 that addresses this breakage.",
    "created_at": "2016-04-08T23:51:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20391#issuecomment-294494",
    "user": "https://github.com/kedlaya"
}
```

<div id="comment:1" align="right">comment:1</div>

There is a commit on #18916 that addresses this breakage.



---

archive/issue_comments_294495.json:
```json
{
    "body": "Dependencies: **#18916**",
    "created_at": "2016-08-14T16:10:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20391#issuecomment-294495",
    "user": "https://github.com/kedlaya"
}
```

Dependencies: **#18916**



---

archive/issue_comments_294496.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nPlease close after #18916 is merged.",
    "created_at": "2016-08-17T01:01:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20391#issuecomment-294496",
    "user": "https://github.com/kedlaya"
}
```

<div id="comment:3" align="right">comment:3</div>

Please close after #18916 is merged.



---

archive/issue_events_287690.json:
```json
{
    "actor": "https://github.com/kedlaya",
    "created_at": "2016-08-17T14:38:24Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/20391",
    "milestone_number": null,
    "milestone_title": "sage-7.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20391#event-287690"
}
```



---

archive/issue_events_287691.json:
```json
{
    "actor": "https://github.com/kedlaya",
    "created_at": "2016-08-17T14:38:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20391",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20391#event-287691"
}
```



---

archive/issue_events_287692.json:
```json
{
    "actor": "https://github.com/kedlaya",
    "created_at": "2016-08-17T14:38:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20391",
    "label": "https://github.com/sagemath/sage/labels/invalid",
    "label_color": "a6a6a6",
    "label_name": "invalid",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20391#event-287692"
}
```



---

archive/issue_events_287693.json:
```json
{
    "actor": "https://github.com/kedlaya",
    "created_at": "2016-08-17T14:38:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20391",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20391#event-287693"
}
```



---

archive/issue_comments_294497.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nAs reported by cremona, this is not completely resolved by #18916 after all. This call syntax should also be covered:\n\n```\nsage: F=GF(23) \nsage: x=polygen(F) \nsage: C=HyperellipticCurve(x^8+1) \nsage: C.cardinality()\n... \nValueError: Q must be a monic polynomial of odd degree >= 3 \n```",
    "created_at": "2016-10-27T14:48:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20391#issuecomment-294497",
    "user": "https://github.com/kedlaya"
}
```

<div id="comment:5" align="right">comment:5</div>

As reported by cremona, this is not completely resolved by #18916 after all. This call syntax should also be covered:

```
sage: F=GF(23) 
sage: x=polygen(F) 
sage: C=HyperellipticCurve(x^8+1) 
sage: C.cardinality()
... 
ValueError: Q must be a monic polynomial of odd degree >= 3 
```



---

archive/issue_events_287694.json:
```json
{
    "actor": "https://github.com/kedlaya",
    "created_at": "2016-10-27T14:48:19Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20391",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20391#event-287694"
}
```



---

archive/issue_events_287695.json:
```json
{
    "actor": "https://github.com/kedlaya",
    "created_at": "2016-10-27T14:48:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20391",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20391#event-287695"
}
```



---

archive/issue_events_287696.json:
```json
{
    "actor": "https://github.com/kedlaya",
    "created_at": "2016-10-27T14:52:04Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/20391",
    "milestone_number": null,
    "milestone_title": "sage-7.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20391#event-287696"
}
```



---

archive/issue_comments_294498.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nThanks for the update --  I had not noticed this ticket before.",
    "created_at": "2016-10-27T14:55:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20391#issuecomment-294498",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:7" align="right">comment:7</div>

Thanks for the update --  I had not noticed this ticket before.



---

archive/issue_comments_294499.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nThis is ultimately a dispatching issue: the code in #18916 includes some updated decision-making about what algorithm to use, but the `cardinality` method doesn't currently route through this decision point. This should be easy to fix!",
    "created_at": "2016-10-27T15:52:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20391#issuecomment-294499",
    "user": "https://github.com/kedlaya"
}
```

<div id="comment:8" align="right">comment:8</div>

This is ultimately a dispatching issue: the code in #18916 includes some updated decision-making about what algorithm to use, but the `cardinality` method doesn't currently route through this decision point. This should be easy to fix!



---

archive/issue_comments_294500.json:
```json
{
    "body": "Commit: **[`dabfdd8`](https://github.com/sagemath/sagetrac-mirror/commit/dabfdd8c05077107b64d4c038fe20f6609f893c3)**",
    "created_at": "2016-10-27T22:23:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20391#issuecomment-294500",
    "user": "https://github.com/kedlaya"
}
```

Commit: **[`dabfdd8`](https://github.com/sagemath/sagetrac-mirror/commit/dabfdd8c05077107b64d4c038fe20f6609f893c3)**



---

archive/issue_events_287697.json:
```json
{
    "actor": "https://github.com/kedlaya",
    "created_at": "2016-10-27T22:23:14Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20391",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20391#event-287697"
}
```



---

archive/issue_events_287698.json:
```json
{
    "actor": "https://github.com/kedlaya",
    "created_at": "2016-10-27T22:23:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20391",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20391#event-287698"
}
```



---

archive/issue_comments_294501.json:
```json
{
    "body": "Branch: **[u/kedlaya/count_points_breaks_on_even-degree_hyperelliptic_curves](https://github.com/sagemath/sagetrac-mirror/tree/u/kedlaya/count_points_breaks_on_even-degree_hyperelliptic_curves)**",
    "created_at": "2016-10-27T22:23:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20391#issuecomment-294501",
    "user": "https://github.com/kedlaya"
}
```

Branch: **[u/kedlaya/count_points_breaks_on_even-degree_hyperelliptic_curves](https://github.com/sagemath/sagetrac-mirror/tree/u/kedlaya/count_points_breaks_on_even-degree_hyperelliptic_curves)**



---

archive/issue_comments_294502.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nApparently what I did for `count_points` was the trivial patch: in the even-degree case, just drop down to counting points. This is of course not the correct solution long-term, but it does fix the reported bug. Anyway, I copied that trivial fix over to `cardinality`.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dabfdd8c05077107b64d4c038fe20f6609f893c3\"><code>dabfdd8</code></a></td><td><code>Avoid breakage of cardinality for even-degree curves</code></td></tr></table>\n",
    "created_at": "2016-10-27T22:23:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20391#issuecomment-294502",
    "user": "https://github.com/kedlaya"
}
```

<div id="comment:9" align="right">comment:9</div>

Apparently what I did for `count_points` was the trivial patch: in the even-degree case, just drop down to counting points. This is of course not the correct solution long-term, but it does fix the reported bug. Anyway, I copied that trivial fix over to `cardinality`.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dabfdd8c05077107b64d4c038fe20f6609f893c3"><code>dabfdd8</code></a></td><td><code>Avoid breakage of cardinality for even-degree curves</code></td></tr></table>




---

archive/issue_comments_294503.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nOk let's go with this at the moment.",
    "created_at": "2016-11-17T15:39:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20391#issuecomment-294503",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:10" align="right">comment:10</div>

Ok let's go with this at the moment.



---

archive/issue_events_287699.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2016-11-17T15:39:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20391",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20391#event-287699"
}
```



---

archive/issue_events_287700.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2016-11-17T15:39:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20391",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20391#event-287700"
}
```



---

archive/issue_comments_294504.json:
```json
{
    "body": "Reviewer: **Jean-Pierre Flori**",
    "created_at": "2016-11-17T15:39:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20391#issuecomment-294504",
    "user": "https://github.com/jpflori"
}
```

Reviewer: **Jean-Pierre Flori**



---

archive/issue_comments_294505.json:
```json
{
    "body": "Author: **Kiran Kedlaya**",
    "created_at": "2016-11-17T15:39:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20391#issuecomment-294505",
    "user": "https://github.com/jpflori"
}
```

Author: **Kiran Kedlaya**



---

archive/issue_comments_294506.json:
```json
{
    "body": "Changed branch from **[u/kedlaya/count_points_breaks_on_even-degree_hyperelliptic_curves](https://github.com/sagemath/sagetrac-mirror/tree/u/kedlaya/count_points_breaks_on_even-degree_hyperelliptic_curves)** to **[`dabfdd8`](https://github.com/sagemath/sagetrac-mirror/commit/dabfdd8c05077107b64d4c038fe20f6609f893c3)**",
    "created_at": "2016-11-19T16:35:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20391#issuecomment-294506",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/kedlaya/count_points_breaks_on_even-degree_hyperelliptic_curves](https://github.com/sagemath/sagetrac-mirror/tree/u/kedlaya/count_points_breaks_on_even-degree_hyperelliptic_curves)** to **[`dabfdd8`](https://github.com/sagemath/sagetrac-mirror/commit/dabfdd8c05077107b64d4c038fe20f6609f893c3)**



---

archive/issue_events_287701.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-11-19T16:35:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20391",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20391#event-287701"
}
```



---

archive/issue_events_287702.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "62cc9f9ee072be49c5550f90ed5117090aa1d0e9",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2016-11-19T16:35:02Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/20391",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20391#event-287702"
}
```
