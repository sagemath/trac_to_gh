# Issue 20690: Live documentation in Jupyter using Thebe

archive/issues_020453.json:
```json
{
    "body": "Thebe is a Jupyter javascript plugin for static sites that allows for\nrendering selected divs of the HTML as live cells connected to a\nJupyter server:\n\n  https://oreillymedia.github.io/thebe/\n\nThe goal of this ticket is to use this technology to implement live\ndocumentation in the Jupyter notebook as we had in the legacy Sage\nnotebook.\n\nKudos to Rob Beezer for pointing us to Thebe in his presentation of\nMathBookXML at Sage Days 77.\n\nSteps:\n- [X] Configure Sphinx to add the Thebe javascript library in the static page\n- [X] Configure Sphinx to add a small header to our html page with:\n  - [X] Inclusion of the Thebe javascript\n  - [X] Thebe configuration: which divs to make live\n\n    Currently, we include all <pre> tags that contain the \"sage:\" prompt.\n\n    TODO: shall we change to <pre> tags that start with the \"sage:\" prompt?\n\nTODO:\n- [X] Only activate Thebe if the page is served by a Jupyter instance\n\n  Currently we check that the protocol is http\n- [X] A button to activate live cells\n- [X] Configure the Jupyter notebook in Sage to somehow provide the\n  server configuration to Thebe (not needed in fact)\n- [X] Preparse or customize/configure Thebe to support Sage's doctest syntax:\n  - [X] Strip out the \"sage: \" prompts and \"....:\" and \"...  \" continuation prompts\n  - [X] Strip out the outputs\n\n    Bonus: show the included outputs below the cell until the new output is computed\n\n    What's been done here is: output is show until the \"activate\" button is clicked.\n\n- [X] Support doctests with several commands by spliting into several cells\n- [X] Ship Thebe from a dedicated spkg (#21309).\n\nThis ticket solves #17269. Follow-up ticket for possible improvements: #20893.\n\n\nCC:  @videlec @vbraun @rbeezer @slel tmonteil\n\nKeywords: days77, jupyter, thebe, notebook, sd75\n\nReviewer: Vincent Delecroix, Thierry Monteil\n\nAuthor: Florent Cayr\u00e9, Nicolas M. Thi\u00e9ry\n\nBranch: 8c8e731a11790c135c906dbdf00dffd9fe616a9a\n\nDependencies: #21309\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/20690\n\n",
    "closed_at": "2016-09-10T09:00:23Z",
    "created_at": "2016-05-27T08:42:15Z",
    "labels": [
        "component: documentation"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.4",
    "title": "Live documentation in Jupyter using Thebe",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/20690",
    "user": "https://github.com/nthiery"
}
```
Thebe is a Jupyter javascript plugin for static sites that allows for
rendering selected divs of the HTML as live cells connected to a
Jupyter server:

  https://oreillymedia.github.io/thebe/

The goal of this ticket is to use this technology to implement live
documentation in the Jupyter notebook as we had in the legacy Sage
notebook.

Kudos to Rob Beezer for pointing us to Thebe in his presentation of
MathBookXML at Sage Days 77.

Steps:
- [X] Configure Sphinx to add the Thebe javascript library in the static page
- [X] Configure Sphinx to add a small header to our html page with:
  - [X] Inclusion of the Thebe javascript
  - [X] Thebe configuration: which divs to make live

    Currently, we include all <pre> tags that contain the "sage:" prompt.

    TODO: shall we change to <pre> tags that start with the "sage:" prompt?

TODO:
- [X] Only activate Thebe if the page is served by a Jupyter instance

  Currently we check that the protocol is http
- [X] A button to activate live cells
- [X] Configure the Jupyter notebook in Sage to somehow provide the
  server configuration to Thebe (not needed in fact)
- [X] Preparse or customize/configure Thebe to support Sage's doctest syntax:
  - [X] Strip out the "sage: " prompts and "....:" and "...  " continuation prompts
  - [X] Strip out the outputs

    Bonus: show the included outputs below the cell until the new output is computed

    What's been done here is: output is show until the "activate" button is clicked.

- [X] Support doctests with several commands by spliting into several cells
- [X] Ship Thebe from a dedicated spkg (#21309).

This ticket solves #17269. Follow-up ticket for possible improvements: #20893.


CC:  @videlec @vbraun @rbeezer @slel tmonteil

Keywords: days77, jupyter, thebe, notebook, sd75

Reviewer: Vincent Delecroix, Thierry Monteil

Author: Florent Cayré, Nicolas M. Thiéry

Branch: 8c8e731a11790c135c906dbdf00dffd9fe616a9a

Dependencies: #21309

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/20690





---

archive/issue_comments_281619.json:
```json
{
    "body": "<a id='comment:3'></a>New commits:",
    "created_at": "2016-05-27T09:07:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20690#issuecomment-281619",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:3'></a>New commits:



---

archive/issue_comments_281620.json:
```json
{
    "body": "<a id='comment:5'></a>The current branch is not to be merged in Sage, as it contains some edits in the Sage's faq that are just here for quick testing (compiling the faq is fast!).",
    "created_at": "2016-05-27T09:09:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20690#issuecomment-281620",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:5'></a>The current branch is not to be merged in Sage, as it contains some edits in the Sage's faq that are just here for quick testing (compiling the faq is fast!).



---

archive/issue_comments_281621.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-05-27T15:43:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20690#issuecomment-281621",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_281622.json:
```json
{
    "body": "Changing keywords from \"\" to \"days77, jupyter, thebe, notebook\".",
    "created_at": "2016-05-28T09:13:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20690#issuecomment-281622",
    "user": "https://github.com/nthiery"
}
```

Changing keywords from "" to "days77, jupyter, thebe, notebook".



---

archive/issue_comments_281623.json:
```json
{
    "body": "<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-06-15T20:38:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20690#issuecomment-281623",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_281624.json:
```json
{
    "body": "<a id='comment:15'></a>Everything seems to work (nice!). Some naive questions from a user point of view:\n\n- would it be possible to remove the \"sage: \" string in the cells? It would be convenient since it perturb the editor. It would even be worse with the continuation \"....:\" since these are not ignored by the sage preparser...\n\nLess importantly:\n\n- why did you decide to have this \"Run\" and \"Run Again\" buttons? These do not exist in the standard Jupyter notebook. Would it be possible to simply remove them?\n\n- the cells are properly executed when pressing \"Shift + Enter\" but, contrarily to the case of the notebook, after pressing \"Shift + Enter\" the focus is kept in the same cell. Not sure that it is desirable to move the focus (since the next cell might be very far).",
    "created_at": "2016-06-27T08:16:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20690#issuecomment-281624",
    "user": "https://github.com/videlec"
}
```

<a id='comment:15'></a>Everything seems to work (nice!). Some naive questions from a user point of view:

- would it be possible to remove the "sage: " string in the cells? It would be convenient since it perturb the editor. It would even be worse with the continuation "....:" since these are not ignored by the sage preparser...

Less importantly:

- why did you decide to have this "Run" and "Run Again" buttons? These do not exist in the standard Jupyter notebook. Would it be possible to simply remove them?

- the cells are properly executed when pressing "Shift + Enter" but, contrarily to the case of the notebook, after pressing "Shift + Enter" the focus is kept in the same cell. Not sure that it is desirable to move the focus (since the next cell might be very far).



---

archive/issue_comments_281625.json:
```json
{
    "body": "<a id='comment:18'></a>I moved the part related to improvements to #20893. I definitely think that we should try to have something ready for the next beta release. And it is in good shape!",
    "created_at": "2016-06-27T16:18:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20690#issuecomment-281625",
    "user": "https://github.com/videlec"
}
```

<a id='comment:18'></a>I moved the part related to improvements to #20893. I definitely think that we should try to have something ready for the next beta release. And it is in good shape!



---

archive/issue_comments_281626.json:
```json
{
    "body": "<a id='comment:20'></a>As discussed with Florent (by mail) the first step should be ready (see #20893 for next steps). I am going through the changes and testing this version.",
    "created_at": "2016-07-01T06:49:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20690#issuecomment-281626",
    "user": "https://github.com/videlec"
}
```

<a id='comment:20'></a>As discussed with Florent (by mail) the first step should be ready (see #20893 for next steps). I am going through the changes and testing this version.



---

archive/issue_comments_281627.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-07-01T06:49:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20690#issuecomment-281627",
    "user": "https://github.com/videlec"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_281628.json:
```json
{
    "body": "<a id='comment:21'></a>This ticket solves #17269.",
    "created_at": "2016-08-22T13:38:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20690#issuecomment-281628",
    "user": "https://github.com/slel"
}
```

<a id='comment:21'></a>This ticket solves #17269.



---

archive/issue_comments_281629.json:
```json
{
    "body": "<a id='comment:22'></a>Replying to [comment:21 slelievre]:\n> This ticket solves #17269.\n\n\nThanks for letting me know about the current ticket. This is indeed a blocker to leave sage notebook for good (this, and the fact that jupyter doen not handle `.rst` files as worksheets, let me continue to use the former during tutorials).",
    "created_at": "2016-08-22T13:55:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20690#issuecomment-281629",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:22'></a>Replying to [comment:21 slelievre]:
> This ticket solves #17269.


Thanks for letting me know about the current ticket. This is indeed a blocker to leave sage notebook for good (this, and the fact that jupyter doen not handle `.rst` files as worksheets, let me continue to use the former during tutorials).



---

archive/issue_comments_281630.json:
```json
{
    "body": "<a id='comment:23'></a>With the current version, the button `activate` does not appear in all situation. It does for the reference manual but not for `Help -> Thematic Tutorials -> Tutorial: Sage Introductory Programming (PREP)`.",
    "created_at": "2016-08-22T14:08:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20690#issuecomment-281630",
    "user": "https://github.com/videlec"
}
```

<a id='comment:23'></a>With the current version, the button `activate` does not appear in all situation. It does for the reference manual but not for `Help -> Thematic Tutorials -> Tutorial: Sage Introductory Programming (PREP)`.



---

archive/issue_comments_281631.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-08-22T14:08:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20690#issuecomment-281631",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_events_055667.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2016-08-22T14:08:32Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/20690",
    "milestone": "sage-7.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20690#event-55667"
}
```



---

archive/issue_comments_281632.json:
```json
{
    "body": "<a id='comment:24'></a>`thebe.js` should not be raw copied to Sage source code. Instead, it should be installed as a Sage package, so that it is easier to keep it up-to-date. Typically, the script you copied is adapted to Jupyter 4.0.5.",
    "created_at": "2016-08-22T14:13:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20690#issuecomment-281632",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:24'></a>`thebe.js` should not be raw copied to Sage source code. Instead, it should be installed as a Sage package, so that it is easier to keep it up-to-date. Typically, the script you copied is adapted to Jupyter 4.0.5.



---

archive/issue_comments_281633.json:
```json
{
    "body": "<a id='comment:25'></a>Hi Thierry,\n\nThanks for looking at this!\n\nIt was Volker's suggestion to just raw copy thebe.js in the sources.\n\nOne part of the rationale is simplicity. The other is that, once jupyterlab will have matured out, thebe.js is likely to become a thin layer on top of it, if not just a part of it. So it's not that crucial to take the efforts of a super clean long term solution.\n\nBut I don't have a strong opinion either.",
    "created_at": "2016-08-22T15:29:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20690#issuecomment-281633",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:25'></a>Hi Thierry,

Thanks for looking at this!

It was Volker's suggestion to just raw copy thebe.js in the sources.

One part of the rationale is simplicity. The other is that, once jupyterlab will have matured out, thebe.js is likely to become a thin layer on top of it, if not just a part of it. So it's not that crucial to take the efforts of a super clean long term solution.

But I don't have a strong opinion either.



---

archive/issue_comments_281634.json:
```json
{
    "body": "<a id='comment:26'></a>Having a dedicated spkg is not such a huge effort, and there are tons of temporary things in Sage that wait to be cleaned for years, let us not make things worse when we can avoid it. Let me just give a try.",
    "created_at": "2016-08-22T19:03:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20690#issuecomment-281634",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:26'></a>Having a dedicated spkg is not such a huge effort, and there are tons of temporary things in Sage that wait to be cleaned for years, let us not make things worse when we can avoid it. Let me just give a try.



---

archive/issue_comments_281635.json:
```json
{
    "body": "<a id='comment:28'></a>I wrote #21309 to package thebe.js (needs review) and let the current branch depend on that one (i.e. i replaced the hardcoded code to a symlink to the file provided by the spkg). It works well on my machine.\n\n---\nNew commits:",
    "created_at": "2016-08-22T19:40:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20690#issuecomment-281635",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:28'></a>I wrote #21309 to package thebe.js (needs review) and let the current branch depend on that one (i.e. i replaced the hardcoded code to a symlink to the file provided by the spkg). It works well on my machine.

---
New commits:



---

archive/issue_comments_281636.json:
```json
{
    "body": "<a id='comment:29'></a>Replying to [comment:23 vdelecroix]:\n> With the current version, the button `activate` does not appear in all situation. It does for the reference manual but not for `Help -> Thematic Tutorials -> Tutorial: Sage Introductory Programming (PREP)`.\n\n\nI double checked this. Actually, the button does not appear when the pages do  not have cells (the first pages of the PREP are just pictures, no computations), but it does otherwise (see e.g. the \"Calculus 1\" page), so it is somehow a good feature.",
    "created_at": "2016-08-22T20:32:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20690#issuecomment-281636",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:29'></a>Replying to [comment:23 vdelecroix]:
> With the current version, the button `activate` does not appear in all situation. It does for the reference manual but not for `Help -> Thematic Tutorials -> Tutorial: Sage Introductory Programming (PREP)`.


I double checked this. Actually, the button does not appear when the pages do  not have cells (the first pages of the PREP are just pictures, no computations), but it does otherwise (see e.g. the "Calculus 1" page), so it is somehow a good feature.



---

archive/issue_comments_281637.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-08-22T20:32:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20690#issuecomment-281637",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_281638.json:
```json
{
    "body": "<a id='comment:30'></a>Replying to [comment:28 tmonteil]:\n> I wrote #21309 to package thebe.js (needs review) and let the current branch depend on that one (i.e. i replaced the hardcoded code to a symlink to the file provided by the spkg). It works well on my machine.\n\n\n\u00c7a c'est gentil!\n\nFor the record, I had Florent Cayr\u00e9 on the phone this morning. He started looking at this, but somehow he has a technical issue posting messages on trac which we did not manage to debug. Anyway, we should be able to review this shortly (e.g. tomorrow during the Sage Days).",
    "created_at": "2016-08-23T15:21:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20690#issuecomment-281638",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:30'></a>Replying to [comment:28 tmonteil]:
> I wrote #21309 to package thebe.js (needs review) and let the current branch depend on that one (i.e. i replaced the hardcoded code to a symlink to the file provided by the spkg). It works well on my machine.


Ça c'est gentil!

For the record, I had Florent Cayré on the phone this morning. He started looking at this, but somehow he has a technical issue posting messages on trac which we did not manage to debug. Anyway, we should be able to review this shortly (e.g. tomorrow during the Sage Days).



---

archive/issue_comments_281639.json:
```json
{
    "body": "Changing keywords from \"days77, jupyter, thebe, notebook\" to \"days77, jupyter, thebe, notebook, sd75\".",
    "created_at": "2016-08-23T17:55:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20690#issuecomment-281639",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Changing keywords from "days77, jupyter, thebe, notebook" to "days77, jupyter, thebe, notebook, sd75".



---

archive/issue_comments_281640.json:
```json
{
    "body": "<a id='comment:31'></a>Great ! (i just arrived at Cernay, barbecue tonight!)",
    "created_at": "2016-08-23T17:55:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20690#issuecomment-281640",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:31'></a>Great ! (i just arrived at Cernay, barbecue tonight!)



---

archive/issue_comments_281641.json:
```json
{
    "body": "<a id='comment:33'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-25T17:17:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20690#issuecomment-281641",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:33'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_281642.json:
```json
{
    "body": "<a id='comment:34'></a>(Just editing ticket description, fixing formatting.)",
    "created_at": "2016-08-30T09:21:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20690#issuecomment-281642",
    "user": "https://github.com/slel"
}
```

<a id='comment:34'></a>(Just editing ticket description, fixing formatting.)



---

archive/issue_comments_281643.json:
```json
{
    "body": "<a id='comment:35'></a>Hi Vincent, Thierry,\nBesides merging the latest #21309 when it's polished, do you consider this as ready to go?\nIt would be nice to be done with this!\nThanks,",
    "created_at": "2016-09-04T15:34:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20690#issuecomment-281643",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:35'></a>Hi Vincent, Thierry,
Besides merging the latest #21309 when it's polished, do you consider this as ready to go?
It would be nice to be done with this!
Thanks,



---

archive/issue_comments_281644.json:
```json
{
    "body": "<a id='comment:37'></a>I changed the symlink from `local/share/thebejs/thebe.js` to `local/share/thebe/thebe.js` according to the renaming done in #21309. Since the two branches were completely entangled (lot of merges), i went back to the last Florent's commit, fixed the symlink and added (and updated) Nicola's comment in `thebe-sage.js` header. Now the two branches are completely independant, apart from the very last merge.\n\nIf you plan to modify something in the current ticket or in #21309, please undo the last merge before, or it will start to knit again.\n\n---\nNew commits:",
    "created_at": "2016-09-04T21:57:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20690#issuecomment-281644",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:37'></a>I changed the symlink from `local/share/thebejs/thebe.js` to `local/share/thebe/thebe.js` according to the renaming done in #21309. Since the two branches were completely entangled (lot of merges), i went back to the last Florent's commit, fixed the symlink and added (and updated) Nicola's comment in `thebe-sage.js` header. Now the two branches are completely independant, apart from the very last merge.

If you plan to modify something in the current ticket or in #21309, please undo the last merge before, or it will start to knit again.

---
New commits:



---

archive/issue_comments_281645.json:
```json
{
    "body": "<a id='comment:38'></a>Replying to [comment:35 nthiery]:\n> Hi Vincent, Thierry,\n> Besides merging the latest #21309 when it's polished, do you consider this as ready to go?\n> It would be nice to be done with this!\n> Thanks,\n\n\nI did not inspect `thebe-sage.js` as i would have done for Python files. But its behaviour corresponds to the claimed feature and the code seem not malicious. So i guess it will be OK for me once the dependencies will be satisfied.",
    "created_at": "2016-09-04T22:09:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20690#issuecomment-281645",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:38'></a>Replying to [comment:35 nthiery]:
> Hi Vincent, Thierry,
> Besides merging the latest #21309 when it's polished, do you consider this as ready to go?
> It would be nice to be done with this!
> Thanks,


I did not inspect `thebe-sage.js` as i would have done for Python files. But its behaviour corresponds to the claimed feature and the code seem not malicious. So i guess it will be OK for me once the dependencies will be satisfied.



---

archive/issue_comments_281646.json:
```json
{
    "body": "<a id='comment:39'></a>Thanks Thierry for the final version of #21309 (Jeroen is double checking it right now) and for cleaning the history.\n\nI agree that we are on a thin line here since we don't have strong review standards set for js files like this one. For example we are missing tests! However writing such tests would take some infrastructure; we should discuss how to setup such infrastructure with the Jupyter people at some point, but for now I guess that's ok.\n\nVincent, any further comment?\n\nCheers,\n                                 Nicolas",
    "created_at": "2016-09-05T07:01:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20690#issuecomment-281646",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:39'></a>Thanks Thierry for the final version of #21309 (Jeroen is double checking it right now) and for cleaning the history.

I agree that we are on a thin line here since we don't have strong review standards set for js files like this one. For example we are missing tests! However writing such tests would take some infrastructure; we should discuss how to setup such infrastructure with the Jupyter people at some point, but for now I guess that's ok.

Vincent, any further comment?

Cheers,
                                 Nicolas



---

archive/issue_comments_281647.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-09-05T08:07:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20690#issuecomment-281647",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_281648.json:
```json
{
    "body": "<a id='comment:40'></a>I have a doubt: to avoid race condition, i guess we should add thebe to the doc build dependencies.",
    "created_at": "2016-09-05T08:07:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20690#issuecomment-281648",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:40'></a>I have a doubt: to avoid race condition, i guess we should add thebe to the doc build dependencies.



---

archive/issue_comments_281649.json:
```json
{
    "body": "<a id='comment:41'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-09-05T10:05:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20690#issuecomment-281649",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:41'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_281650.json:
```json
{
    "body": "<a id='comment:42'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-09-05T10:06:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20690#issuecomment-281650",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:42'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_281651.json:
```json
{
    "body": "<a id='comment:43'></a>Replying to [comment:40 tmonteil]:\n> I have a doubt: to avoid race condition, i guess we should add thebe to the doc build dependencies.\n\n\nFor this, i had to merge with sage.7.3 because the exact same line in `build/make/deps` changed there. Let us test the build like this (it might take some time). Again, if you plan to do some modifications, do not forget to undo the very last merge (with #21309) before.",
    "created_at": "2016-09-05T10:10:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20690#issuecomment-281651",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:43'></a>Replying to [comment:40 tmonteil]:
> I have a doubt: to avoid race condition, i guess we should add thebe to the doc build dependencies.


For this, i had to merge with sage.7.3 because the exact same line in `build/make/deps` changed there. Let us test the build like this (it might take some time). Again, if you plan to do some modifications, do not forget to undo the very last merge (with #21309) before.



---

archive/issue_comments_281652.json:
```json
{
    "body": "<a id='comment:44'></a>Replying to [comment:43 tmonteil]:\n> Replying to [comment:40 tmonteil]:\n> > I have a doubt: to avoid race condition, i guess we should add thebe to the doc build dependencies.\n\n> \n> For this, i had to merge with sage.7.3 because the exact same line in `build/make/deps` changed there. Let us test the build like this (it might take some time).\n\n\nOk, thanks!\n\n> Again, if you plan to do some modifications, do not forget to undo the very last merge (with #21309) before.\n\n\nWe discussed this with Jeroen this morning. Unless Vincent has a specific requestion, we don't plan for further modifications.",
    "created_at": "2016-09-05T13:58:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20690#issuecomment-281652",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:44'></a>Replying to [comment:43 tmonteil]:
> Replying to [comment:40 tmonteil]:
> > I have a doubt: to avoid race condition, i guess we should add thebe to the doc build dependencies.

> 
> For this, i had to merge with sage.7.3 because the exact same line in `build/make/deps` changed there. Let us test the build like this (it might take some time).


Ok, thanks!

> Again, if you plan to do some modifications, do not forget to undo the very last merge (with #21309) before.


We discussed this with Jeroen this morning. Unless Vincent has a specific requestion, we don't plan for further modifications.



---

archive/issue_comments_281653.json:
```json
{
    "body": "<a id='comment:45'></a>(good for me)",
    "created_at": "2016-09-05T15:57:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20690#issuecomment-281653",
    "user": "https://github.com/videlec"
}
```

<a id='comment:45'></a>(good for me)



---

archive/issue_comments_281654.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2016-09-05T16:01:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20690#issuecomment-281654",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_281655.json:
```json
{
    "body": "<a id='comment:47'></a>I don't want to remove the positive review but I would like some info about `/src/doc/common/themes/sage/static/thebe.js` which reads\n\n```\n../../../../../../local/share/thebe/thebe.js\n```\nWould there be a better way to refer to the `thebe.js` file installed by the `thebe` package? The above assume a particular sage install. I don't usually let people get away with putting `/local/` in anything these days as it is bad for stuff like sage-on-gentoo and more broadly sage-on-distro.",
    "created_at": "2016-09-06T23:45:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20690#issuecomment-281655",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:47'></a>I don't want to remove the positive review but I would like some info about `/src/doc/common/themes/sage/static/thebe.js` which reads

```
../../../../../../local/share/thebe/thebe.js
```
Would there be a better way to refer to the `thebe.js` file installed by the `thebe` package? The above assume a particular sage install. I don't usually let people get away with putting `/local/` in anything these days as it is bad for stuff like sage-on-gentoo and more broadly sage-on-distro.



---

archive/issue_comments_281656.json:
```json
{
    "body": "<a id='comment:48'></a>I have no idea on how to do that. This kind of symlink already appears for `mathjax`, but the symlink is done when sagenb is installed. Unfortunately, there is no `sage_documentation` package where we could add a `spkg-install` script to install the symlink at build time. I you have an idea to improve this situation, it would be nice to implement it here and for mathjax as well.",
    "created_at": "2016-09-07T09:39:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20690#issuecomment-281656",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:48'></a>I have no idea on how to do that. This kind of symlink already appears for `mathjax`, but the symlink is done when sagenb is installed. Unfortunately, there is no `sage_documentation` package where we could add a `spkg-install` script to install the symlink at build time. I you have an idea to improve this situation, it would be nice to implement it here and for mathjax as well.



---

archive/issue_comments_281657.json:
```json
{
    "body": "<a id='comment:49'></a>I have no solution right now. I will have to find a way to live with it. I'll come up with something, I usually do in the end. It doesn't always make sense in vanilla sage unfortunately.",
    "created_at": "2016-09-07T09:48:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20690#issuecomment-281657",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:49'></a>I have no solution right now. I will have to find a way to live with it. I'll come up with something, I usually do in the end. It doesn't always make sense in vanilla sage unfortunately.



---

archive/issue_events_055668.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-09-10T09:00:23Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/20690",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20690#event-55668"
}
```



---

archive/issue_comments_281658.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-09-10T09:00:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20690#issuecomment-281658",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_281659.json:
```json
{
    "body": "<a id='comment:51'></a>Adding a symbolic link from the sources to some installation directory really makes no sense, especially because it is hardcoded. Having it installed by the `thebe` package would at least make slightly more sense. Of course, ideally we would just use `thebe.js` from the installation directory.",
    "created_at": "2016-09-18T11:00:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20690#issuecomment-281659",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:51'></a>Adding a symbolic link from the sources to some installation directory really makes no sense, especially because it is hardcoded. Having it installed by the `thebe` package would at least make slightly more sense. Of course, ideally we would just use `thebe.js` from the installation directory.



---

archive/issue_comments_281660.json:
```json
{
    "body": "<a id='comment:52'></a>See #21527 for a follow-up on the symbolic link issue.",
    "created_at": "2016-09-18T19:57:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20690#issuecomment-281660",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:52'></a>See #21527 for a follow-up on the symbolic link issue.



---

archive/issue_comments_281661.json:
```json
{
    "body": "<a id='comment:53'></a>Here is some feedback after real-life testing. I am currently teaching for a 3-week Sage tutorial, and there is a workflow issue, somehow `thebe.js` miss the main point of the sagenb live documentation.\n\nOn sagenb notebook, say the students work on some thematic tutorial, they do some tests, copy some lecturer's examples and want to keep their changes. What they can do is to click on `File` (top left) and then `Copy worksheet` so that the live documentation becomes a true sagenb worksheet they can save to come back on it later.\n\nIn the current case, we can do some tests and modifications (which is great), but all the work is lost when we close the webpage. We should have a button to export the current state into a (possibly degradated, we do not really care about the subtle html structure) `.ipynb` file that can then be saved.",
    "created_at": "2016-10-16T19:52:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20690#issuecomment-281661",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:53'></a>Here is some feedback after real-life testing. I am currently teaching for a 3-week Sage tutorial, and there is a workflow issue, somehow `thebe.js` miss the main point of the sagenb live documentation.

On sagenb notebook, say the students work on some thematic tutorial, they do some tests, copy some lecturer's examples and want to keep their changes. What they can do is to click on `File` (top left) and then `Copy worksheet` so that the live documentation becomes a true sagenb worksheet they can save to come back on it later.

In the current case, we can do some tests and modifications (which is great), but all the work is lost when we close the webpage. We should have a button to export the current state into a (possibly degradated, we do not really care about the subtle html structure) `.ipynb` file that can then be saved.



---

archive/issue_comments_281662.json:
```json
{
    "body": "<a id='comment:54'></a>Thanks Thierry for the feedback!\n\nYes, this is a very desirable feature, which we had already listed on #20893:\n\n> - [ ] Add support in Thebe for basic export to Jupyter notebooks. A\n>   quality loss (in particular in terms of the hierarchical\n>   structure) is acceptable.\n\n\nDo you mind merging this item with the new one you added there?",
    "created_at": "2016-10-17T07:25:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20690#issuecomment-281662",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:54'></a>Thanks Thierry for the feedback!

Yes, this is a very desirable feature, which we had already listed on #20893:

> - [ ] Add support in Thebe for basic export to Jupyter notebooks. A
>   quality loss (in particular in terms of the hierarchical
>   structure) is acceptable.


Do you mind merging this item with the new one you added there?



---

archive/issue_comments_281663.json:
```json
{
    "body": "<a id='comment:55'></a>While preparing the report for OpenDreamKit, I just noticed that this is completely broken: #22458",
    "created_at": "2017-02-27T11:58:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20690",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20690#issuecomment-281663",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:55'></a>While preparing the report for OpenDreamKit, I just noticed that this is completely broken: #22458
