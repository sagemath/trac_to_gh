# Issue 20427: docstring wide optional markup

archive/issues_020190.json:
```json
{
    "assignees": [],
    "body": "It's quite common that optional tests come in batch, typically when documenting a method that is only available when a certain feature or package is available. Having to mark each and every test with # optional xxx is redundant and reduces readability.\n\nThis ticket implements a Sphinx style markup to disable all doctests following it::\n\n```\n    \"\"\"\n    ...\n    EXAMPLES::\n \n        sage: ...      \n\n    .. OPTIONAL:: gap3\n\n    ::\n\n        sage: gap3(...)\n        sage: gap3(...)\n    \"\"\"\n```\n\nTODO:\n\n- Is this the right markup? I would prefer \".. REQUIRE:: gap3\" but this is not super consistent with the line-by-line markup.\n- It could be desirable to have a markup to disable all tests in the module; possibly by using the above markup in the module docstring.\n\n\n\nCC:  @mmasdeu\n\nBranch/Commit: **[u/nthiery/docstring_wide_optional_markup](https://github.com/sagemath/sagetrac-mirror/tree/u/nthiery/docstring_wide_optional_markup) @ [ae1d9e4](https://github.com/sagemath/sagetrac-mirror/commit/ae1d9e400e1ca28586bb7fa943c48938e25698ec)**\n\nAuthor: **Nicolas M. Thi\u00e9ry**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/20427_\n\n",
    "created_at": "2016-04-11T21:40:38Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20doctest%20framework",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "docstring wide optional markup",
    "type": "issue",
    "updated_at": "2022-12-29T01:35:57Z",
    "url": "https://github.com/sagemath/sage/issues/20427",
    "user": "https://github.com/nthiery"
}
```
It's quite common that optional tests come in batch, typically when documenting a method that is only available when a certain feature or package is available. Having to mark each and every test with # optional xxx is redundant and reduces readability.

This ticket implements a Sphinx style markup to disable all doctests following it::

```
    """
    ...
    EXAMPLES::
 
        sage: ...      

    .. OPTIONAL:: gap3

    ::

        sage: gap3(...)
        sage: gap3(...)
    """
```

TODO:

- Is this the right markup? I would prefer ".. REQUIRE:: gap3" but this is not super consistent with the line-by-line markup.
- It could be desirable to have a markup to disable all tests in the module; possibly by using the above markup in the module docstring.



CC:  @mmasdeu

Branch/Commit: **[u/nthiery/docstring_wide_optional_markup](https://github.com/sagemath/sagetrac-mirror/tree/u/nthiery/docstring_wide_optional_markup) @ [ae1d9e4](https://github.com/sagemath/sagetrac-mirror/commit/ae1d9e400e1ca28586bb7fa943c48938e25698ec)**

Author: **Nicolas M. Thi√©ry**

_Issue created by migration from https://trac.sagemath.org/ticket/20427_





---

archive/issue_events_270176.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2016-04-11T21:40:38Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/20427",
    "milestone_number": null,
    "milestone_title": "sage-7.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20427#event-270176"
}
```



---

archive/issue_events_270177.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2016-04-11T21:40:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20427",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20doctest%20framework",
    "label_color": "000080",
    "label_name": "component: doctest framework",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20427#event-270177"
}
```



---

archive/issue_events_270178.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2016-04-11T21:40:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20427",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20427#event-270178"
}
```



---

archive/issue_events_270179.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2016-04-11T21:40:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20427",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20427#event-270179"
}
```



---

archive/issue_comments_297538.json:
```json
{
    "body": "Branch: **[u/nthiery/docstring_wide_optional_markup](https://github.com/sagemath/sagetrac-mirror/tree/u/nthiery/docstring_wide_optional_markup)**",
    "created_at": "2016-04-11T21:55:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20427#issuecomment-297538",
    "user": "https://github.com/nthiery"
}
```

Branch: **[u/nthiery/docstring_wide_optional_markup](https://github.com/sagemath/sagetrac-mirror/tree/u/nthiery/docstring_wide_optional_markup)**



---

archive/issue_comments_297539.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">Comment 2</div>\n\nLet me know when you need a reviewer (in case sage-devel approves of this in the end.)\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ae1d9e400e1ca28586bb7fa943c48938e25698ec\">ae1d9e4</a></td><td><code>20427: preliminary implementation of the .. OPTIONAL:: markup</code></td></tr></table>\n",
    "created_at": "2016-04-12T17:21:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20427#issuecomment-297539",
    "user": "https://github.com/saraedum"
}
```

<div id="comment:2" align="right">Comment 2</div>

Let me know when you need a reviewer (in case sage-devel approves of this in the end.)

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ae1d9e400e1ca28586bb7fa943c48938e25698ec">ae1d9e4</a></td><td><code>20427: preliminary implementation of the .. OPTIONAL:: markup</code></td></tr></table>




---

archive/issue_comments_297540.json:
```json
{
    "body": "Commit: **[ae1d9e4](https://github.com/sagemath/sagetrac-mirror/commit/ae1d9e400e1ca28586bb7fa943c48938e25698ec)**",
    "created_at": "2016-04-12T17:21:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20427#issuecomment-297540",
    "user": "https://github.com/saraedum"
}
```

Commit: **[ae1d9e4](https://github.com/sagemath/sagetrac-mirror/commit/ae1d9e400e1ca28586bb7fa943c48938e25698ec)**



---

archive/issue_comments_297541.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">Comment 3</div>\n\nSee also #3260.",
    "created_at": "2016-08-12T09:14:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20427#issuecomment-297541",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:3" align="right">Comment 3</div>

See also #3260.



---

archive/issue_comments_297542.json:
```json
{
    "body": "Replying to [ticket:20427 nthiery]:\n> Having to mark each and every test with # optional xxx is redundant and reduces readability.\n\nOne the other hand, it's not always needed to mark *every* test `# optional`. In many cases, a module depending on an optional package still has some stuff which does *not* need the package and which could be tested unconditionally. Typically you have some high-level object modelling something and creating/displaying/modifying that object does not require the optional package. The package is only needed when doing something mathematically interesting.\n\nThe above paragraph certainly does not apply to all optional packages, but we should we careful that people don't become lazy and mark a whole file `# optional` when many doctests in that file are not optional.",
    "created_at": "2017-01-24T09:28:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20427#issuecomment-297542",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [ticket:20427 nthiery]:
> Having to mark each and every test with # optional xxx is redundant and reduces readability.

One the other hand, it's not always needed to mark *every* test `# optional`. In many cases, a module depending on an optional package still has some stuff which does *not* need the package and which could be tested unconditionally. Typically you have some high-level object modelling something and creating/displaying/modifying that object does not require the optional package. The package is only needed when doing something mathematically interesting.

The above paragraph certainly does not apply to all optional packages, but we should we careful that people don't become lazy and mark a whole file `# optional` when many doctests in that file are not optional.



---

archive/issue_comments_297543.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">Comment 6</div>\n\nFor a module-level directive in the same direction, see #30778",
    "created_at": "2021-02-18T01:11:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20427#issuecomment-297543",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:6" align="right">Comment 6</div>

For a module-level directive in the same direction, see #30778



---

archive/issue_events_270180.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-12-29T01:35:57Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/20427",
    "milestone_number": null,
    "milestone_title": "sage-7.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20427#event-270180"
}
```
