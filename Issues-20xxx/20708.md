# Issue 20708: Improve sage-logger

archive/issues_020471.json:
```json
{
    "assignees": [],
    "body": "1. Don't use the `-p` option at the top-level which only prints a useless `[install] `.\n\n2. Use `sed` instead of `read/echo`. This preserves whitespace.\n\nCC:  @embray\n\nBranch/Commit: **[`ffb5922`](https://github.com/sagemath/sagetrac-mirror/commit/ffb59227f6b80c4d938b34d2e3493eeb429323d1)**\n\nReviewer: **Erik Bray**\n\nAuthor: **Jeroen Demeyer**\n\nComponent: **build**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/20708_\n\n",
    "closed_at": "2016-05-31T22:53:58Z",
    "created_at": "2016-05-29T18:40:47Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20build",
        "https://github.com/sagemath/sage/labels/p%3A%201%20%E2%80%93%20blocker",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-7.3",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Improve sage-logger",
    "type": "issue",
    "updated_at": "2016-05-31T22:53:58Z",
    "url": "https://github.com/sagemath/sage/issues/20708",
    "user": "https://github.com/jdemeyer"
}
```
1. Don't use the `-p` option at the top-level which only prints a useless `[install] `.

2. Use `sed` instead of `read/echo`. This preserves whitespace.

CC:  @embray

Branch/Commit: **[`ffb5922`](https://github.com/sagemath/sagetrac-mirror/commit/ffb59227f6b80c4d938b34d2e3493eeb429323d1)**

Reviewer: **Erik Bray**

Author: **Jeroen Demeyer**

Component: **build**

_Issue created by migration from https://trac.sagemath.org/ticket/20708_





---

archive/issue_events_291584.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-05-29T18:40:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/20708",
    "milestone_number": null,
    "milestone_title": "sage-7.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20708#event-291584"
}
```



---

archive/issue_events_291585.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-05-29T18:40:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20708",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20build",
    "label_color": "000080",
    "label_name": "c: build",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20708#event-291585"
}
```



---

archive/issue_events_291586.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-05-29T18:40:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20708",
    "label": "https://github.com/sagemath/sage/labels/p%3A%201%20%E2%80%93%20blocker",
    "label_color": "ff0000",
    "label_name": "p: 1 \u2013 blocker",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20708#event-291586"
}
```



---

archive/issue_events_291587.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-05-29T18:40:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20708",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20708#event-291587"
}
```



---

archive/issue_comments_299806.json:
```json
{
    "body": "Branch: **[u/jdemeyer/improve_sage_logger](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/improve_sage_logger)**",
    "created_at": "2016-05-29T19:07:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20708",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20708#issuecomment-299806",
    "user": "https://github.com/jdemeyer"
}
```

Branch: **[u/jdemeyer/improve_sage_logger](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/improve_sage_logger)**



---

archive/issue_comments_299807.json:
```json
{
    "body": "<div id=\"comment:2\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ffb59227f6b80c4d938b34d2e3493eeb429323d1\"><code>ffb5922</code></a></td><td><code>Minor improvements to logging</code></td></tr></table>\n",
    "created_at": "2016-05-29T19:16:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20708",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20708#issuecomment-299807",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:2"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ffb59227f6b80c4d938b34d2e3493eeb429323d1"><code>ffb5922</code></a></td><td><code>Minor improvements to logging</code></td></tr></table>




---

archive/issue_events_291588.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-05-29T19:16:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20708",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20708#event-291588"
}
```



---

archive/issue_comments_299808.json:
```json
{
    "body": "Commit: **[`ffb5922`](https://github.com/sagemath/sagetrac-mirror/commit/ffb59227f6b80c4d938b34d2e3493eeb429323d1)**",
    "created_at": "2016-05-29T19:16:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20708",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20708#issuecomment-299808",
    "user": "https://github.com/jdemeyer"
}
```

Commit: **[`ffb5922`](https://github.com/sagemath/sagetrac-mirror/commit/ffb59227f6b80c4d938b34d2e3493eeb429323d1)**



---

archive/issue_comments_299809.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nThis looks good to me. It works on OS X, for example the early parts of the `matplotlib` log look better with this, but someone should test it on some linux machines. (I don't think this is doctested, so the patchbot won't help.)",
    "created_at": "2016-05-30T07:57:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20708",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20708#issuecomment-299809",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:3" align="right">comment:3</div>

This looks good to me. It works on OS X, for example the early parts of the `matplotlib` log look better with this, but someone should test it on some linux machines. (I don't think this is doctested, so the patchbot won't help.)



---

archive/issue_comments_299810.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nWell, it works for me (on Gentoo Linux).",
    "created_at": "2016-05-30T08:00:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20708",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20708#issuecomment-299810",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:4" align="right">comment:4</div>

Well, it works for me (on Gentoo Linux).



---

archive/issue_comments_299811.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nI think this is fine.  I didn't mind having `[install]` on every line, because when you run `make` *not* every step is necessarily in install, but most of the time it's clear enough from context that it isn't needed.\n\nI think it's a bit silly to call this a \"blocker\" though don't you?",
    "created_at": "2016-05-30T09:35:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20708",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20708#issuecomment-299811",
    "user": "https://github.com/embray"
}
```

<div id="comment:5" align="right">comment:5</div>

I think this is fine.  I didn't mind having `[install]` on every line, because when you run `make` *not* every step is necessarily in install, but most of the time it's clear enough from context that it isn't needed.

I think it's a bit silly to call this a "blocker" though don't you?



---

archive/issue_events_291589.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2016-05-30T09:35:17Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20708",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20708#event-291589"
}
```



---

archive/issue_events_291590.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2016-05-30T09:35:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20708",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20708#event-291590"
}
```



---

archive/issue_comments_299812.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nReviewer name",
    "created_at": "2016-05-30T10:10:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20708",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20708#issuecomment-299812",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:6" align="right">comment:6</div>

Reviewer name



---

archive/issue_events_291591.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-05-30T10:10:01Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20708",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20708#event-291591"
}
```



---

archive/issue_events_291592.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-05-30T10:10:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20708",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20708#event-291592"
}
```



---

archive/issue_events_291593.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-05-30T10:11:23Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20708",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20708#event-291593"
}
```



---

archive/issue_events_291594.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-05-30T10:11:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20708",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20708#event-291594"
}
```



---

archive/issue_comments_299813.json:
```json
{
    "body": "Reviewer: **Erik Bray**",
    "created_at": "2016-05-30T10:11:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20708",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20708#issuecomment-299813",
    "user": "https://github.com/jdemeyer"
}
```

Reviewer: **Erik Bray**



---

archive/issue_comments_299814.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nThe recent sage-logger changes from #20640 seem to cause a minor problem.\n\nWhen installing an \"experimental\" package, Sage warns a lot and then prompts the user. \nBecause of line buffering, one does not see the prompt, but Sage just waits indefinitely.\n\n```\nsage -f latte_int\n...\n[latte_int-1.7.3] =========================== WARNING ===========================\n[latte_int-1.7.3] You are about to download and install an experimental package.\n[latte_int-1.7.3] This probably won't work at all for you! There is no guarantee\n[latte_int-1.7.3] that it will build correctly, or behave as expected.\n[latte_int-1.7.3] Use at your own risk!\n[latte_int-1.7.3] ===============================================================\n```\n<--- This is where it asks \"[latte_int-1.7.3] Are you sure you want to continue [Y/n]?\" but this is line-buffered and not visible to the user.",
    "created_at": "2016-05-31T09:17:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20708",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20708#issuecomment-299814",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:8" align="right">comment:8</div>

The recent sage-logger changes from #20640 seem to cause a minor problem.

When installing an "experimental" package, Sage warns a lot and then prompts the user. 
Because of line buffering, one does not see the prompt, but Sage just waits indefinitely.

```
sage -f latte_int
...
[latte_int-1.7.3] =========================== WARNING ===========================
[latte_int-1.7.3] You are about to download and install an experimental package.
[latte_int-1.7.3] This probably won't work at all for you! There is no guarantee
[latte_int-1.7.3] that it will build correctly, or behave as expected.
[latte_int-1.7.3] Use at your own risk!
[latte_int-1.7.3] ===============================================================
```
<--- This is where it asks "[latte_int-1.7.3] Are you sure you want to continue [Y/n]?" but this is line-buffered and not visible to the user.



---

archive/issue_comments_299815.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nReplying to [@mkoeppe](#comment:8):\n> The recent sage-logger changes from #20640 seem to cause a minor problem.\n\nOn which operating system is this? And does the problem remain after applying #20708?",
    "created_at": "2016-05-31T09:23:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20708",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20708#issuecomment-299815",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:9" align="right">comment:9</div>

Replying to [@mkoeppe](#comment:8):
> The recent sage-logger changes from #20640 seem to cause a minor problem.

On which operating system is this? And does the problem remain after applying #20708?



---

archive/issue_comments_299816.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nThis is on Mac OS X, after merging #20708.",
    "created_at": "2016-05-31T11:17:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20708",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20708#issuecomment-299816",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:10" align="right">comment:10</div>

This is on Mac OS X, after merging #20708.



---

archive/issue_comments_299817.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nReplying to [@mkoeppe](#comment:8):\n> The recent sage-logger changes from #20640 seem to cause a minor problem.\n> \n> When installing an \"experimental\" package, Sage warns a lot and then prompts the user. \n> Because of line buffering, one does not see the prompt, but Sage just waits indefinitely.\n\nI have noticed this as well.  But I think jdmeyer's fix in this ticket *should* fix it due to the use of unbuffered sed.  (The keyboard input is still accepted, you just don't see the prompt until later).",
    "created_at": "2016-05-31T12:59:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20708",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20708#issuecomment-299817",
    "user": "https://github.com/embray"
}
```

<div id="comment:11" align="right">comment:11</div>

Replying to [@mkoeppe](#comment:8):
> The recent sage-logger changes from #20640 seem to cause a minor problem.
> 
> When installing an "experimental" package, Sage warns a lot and then prompts the user. 
> Because of line buffering, one does not see the prompt, but Sage just waits indefinitely.

I have noticed this as well.  But I think jdmeyer's fix in this ticket *should* fix it due to the use of unbuffered sed.  (The keyboard input is still accepted, you just don't see the prompt until later).



---

archive/issue_comments_299818.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nFrom man sed(1) on OS X:\n\n```\n     -l      Make output line buffered.\n```\nLine buffered is not unbuffered.",
    "created_at": "2016-05-31T15:29:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20708",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20708#issuecomment-299818",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:12" align="right">comment:12</div>

From man sed(1) on OS X:

```
     -l      Make output line buffered.
```
Line buffered is not unbuffered.



---

archive/issue_events_291595.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-05-31T22:53:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20708",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20708#event-291595"
}
```



---

archive/issue_events_291596.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "39a63ab3964497c1f574ebf62331f0b90ffcc625",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2016-05-31T22:53:58Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/20708",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20708#event-291596"
}
```



---

archive/issue_comments_299819.json:
```json
{
    "body": "Changed branch from **[u/jdemeyer/improve_sage_logger](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/improve_sage_logger)** to **[`ffb5922`](https://github.com/sagemath/sagetrac-mirror/commit/ffb59227f6b80c4d938b34d2e3493eeb429323d1)**",
    "created_at": "2016-05-31T22:53:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20708",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20708#issuecomment-299819",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/jdemeyer/improve_sage_logger](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/improve_sage_logger)** to **[`ffb5922`](https://github.com/sagemath/sagetrac-mirror/commit/ffb59227f6b80c4d938b34d2e3493eeb429323d1)**
