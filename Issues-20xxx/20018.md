# Issue 20018: init for endomorphism of projective subschemes fails

archive/issues_019781.json:
```json
{
    "body": "The following example does not work\n\n```\nsage: R.<t>=PolynomialRing(QQ)\nsage: P.<x,y,z> = ProjectiveSpace(R,2)\nsage: X = P.subscheme(x^2-y^2)\nsage: H = Hom(X,X)\nsage: f = H([x^2,y^2,x*z])\n```\n\nbut does work in affine space. It seems that the check in init is not quite doing the right thing.\n\n**Assignee:** @bhutz\n\n**Branch/Commit:** [03736f56d5bff62e77344494349864f42a43fdd0](https://github.com/sagemath/sagetrac-mirror/commit/03736f56d5bff62e77344494349864f42a43fdd0)\n\n**Reviewer:** Adam Towsley\n\n**Author:** Ben Hutz\n\n**Resolution:** fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/20018\n\n",
    "closed_at": "2016-02-28T00:52:33Z",
    "created_at": "2016-02-05T22:47:00Z",
    "labels": [
        "component: algebraic geometry",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.1",
    "title": "init for endomorphism of projective subschemes fails",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/20018",
    "user": "https://github.com/bhutz"
}
```
The following example does not work

```
sage: R.<t>=PolynomialRing(QQ)
sage: P.<x,y,z> = ProjectiveSpace(R,2)
sage: X = P.subscheme(x^2-y^2)
sage: H = Hom(X,X)
sage: f = H([x^2,y^2,x*z])
```

but does work in affine space. It seems that the check in init is not quite doing the right thing.

**Assignee:** @bhutz

**Branch/Commit:** [03736f56d5bff62e77344494349864f42a43fdd0](https://github.com/sagemath/sagetrac-mirror/commit/03736f56d5bff62e77344494349864f42a43fdd0)

**Reviewer:** Adam Towsley

**Author:** Ben Hutz

**Resolution:** fixed

Issue created by migration from https://trac.sagemath.org/ticket/20018





---

archive/issue_comments_364299.json:
```json
{
    "body": "**Branch:** [u/bhutz/ticket/20018](https://github.com/sagemath/sagetrac-mirror/tree/u/bhutz/ticket/20018)",
    "created_at": "2016-02-09T22:44:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20018#issuecomment-364299",
    "user": "https://github.com/bhutz"
}
```

**Branch:** [u/bhutz/ticket/20018](https://github.com/sagemath/sagetrac-mirror/tree/u/bhutz/ticket/20018)



---

archive/issue_comments_364300.json:
```json
{
    "body": "<a id='comment:2'></a>\nSince I didn't get any input from the sage-devel thread I went ahead an implemented one possible correction to these issues. At this stage I welcome comments on the solution.\n\nThe key points are as follows\n\n- the actual coordinates of the map remain in the coordinate ring of the ambient space (i.e., this is unchanged)\n\n- if you initialize the map with variables from the coordinate ring of the ambient space, they are not reduced modulo the defining ideal of the subscheme (new behavior)\n\n- if you initialize the map with variables from the coordinate ring of the subscheme, they are in the quotient, so are reduced. (unchanged)\n\nThis allows initialization to work in more situations such as for the problem in the description, but also corrects the weird behavior such as:\n\nold behavior\n\n```\nsage: P.<x,y,z> = ProjectiveSpace(QQ,2)\nsage: X=P.subscheme([x^2-y^2])\nsage: H = End(X)\nsage: f = H([x^2,y^2,z^2])\nsage: f.multiplier(X([1,1]),1)\n[0 2]\n[0 2]\n```\n\nnew behavior\n\n```\nsage: P.<x,y,z> = ProjectiveSpace(QQ,2)\nsage: X=P.subscheme([x^2-y^2])\nsage: H = End(X)\nsage: f = H([x^2,y^2,z^2])\nsage: f.multiplier(X([1,1]),1)\n[2 0]\n[0 2]\n```\n\nOne consequence is the projective_embedding functionality in toric variety seems to be programmed to expect the reduction. Consequently, I've had the creation code use the quotient ring variables, so that behavior matches the current doctests.\n\nIn a couple places in elliptic_curve/jacobian.py the morphism returned is now in a slightly different form. This did not seem to big a difference, so I just updated those doctests.",
    "created_at": "2016-02-09T22:53:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20018#issuecomment-364300",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:2'></a>
Since I didn't get any input from the sage-devel thread I went ahead an implemented one possible correction to these issues. At this stage I welcome comments on the solution.

The key points are as follows

- the actual coordinates of the map remain in the coordinate ring of the ambient space (i.e., this is unchanged)

- if you initialize the map with variables from the coordinate ring of the ambient space, they are not reduced modulo the defining ideal of the subscheme (new behavior)

- if you initialize the map with variables from the coordinate ring of the subscheme, they are in the quotient, so are reduced. (unchanged)

This allows initialization to work in more situations such as for the problem in the description, but also corrects the weird behavior such as:

old behavior

```
sage: P.<x,y,z> = ProjectiveSpace(QQ,2)
sage: X=P.subscheme([x^2-y^2])
sage: H = End(X)
sage: f = H([x^2,y^2,z^2])
sage: f.multiplier(X([1,1]),1)
[0 2]
[0 2]
```

new behavior

```
sage: P.<x,y,z> = ProjectiveSpace(QQ,2)
sage: X=P.subscheme([x^2-y^2])
sage: H = End(X)
sage: f = H([x^2,y^2,z^2])
sage: f.multiplier(X([1,1]),1)
[2 0]
[0 2]
```

One consequence is the projective_embedding functionality in toric variety seems to be programmed to expect the reduction. Consequently, I've had the creation code use the quotient ring variables, so that behavior matches the current doctests.

In a couple places in elliptic_curve/jacobian.py the morphism returned is now in a slightly different form. This did not seem to big a difference, so I just updated those doctests.



---

archive/issue_comments_364301.json:
```json
{
    "body": "**Commit:** [bcb68d013dc8786c8f897f5d2b0c3329a93822a5](https://github.com/sagemath/sagetrac-mirror/commit/bcb68d013dc8786c8f897f5d2b0c3329a93822a5)",
    "created_at": "2016-02-09T22:53:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20018#issuecomment-364301",
    "user": "https://github.com/bhutz"
}
```

**Commit:** [bcb68d013dc8786c8f897f5d2b0c3329a93822a5](https://github.com/sagemath/sagetrac-mirror/commit/bcb68d013dc8786c8f897f5d2b0c3329a93822a5)



---

archive/issue_comments_364302.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2016-02-09T22:53:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20018#issuecomment-364302",
    "user": "https://github.com/bhutz"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_364303.json:
```json
{
    "body": "**Author:** Ben Hutz",
    "created_at": "2016-02-09T22:53:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20018#issuecomment-364303",
    "user": "https://github.com/bhutz"
}
```

**Author:** Ben Hutz



---

archive/issue_comments_364304.json:
```json
{
    "body": "<a id='comment:3'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dd2c436278540666c3afd93f48ca7cae5977f64d\">dd2c436</a></td><td><code>20018: changes to scheme morphism polynomial initialization</code></td></tr></table>\n",
    "created_at": "2016-02-10T02:11:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20018#issuecomment-364304",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dd2c436278540666c3afd93f48ca7cae5977f64d">dd2c436</a></td><td><code>20018: changes to scheme morphism polynomial initialization</code></td></tr></table>




---

archive/issue_comments_364305.json:
```json
{
    "body": "**Changing commit** from \"[bcb68d013dc8786c8f897f5d2b0c3329a93822a5](https://github.com/sagemath/sagetrac-mirror/commit/bcb68d013dc8786c8f897f5d2b0c3329a93822a5)\" to \"[dd2c436278540666c3afd93f48ca7cae5977f64d](https://github.com/sagemath/sagetrac-mirror/commit/dd2c436278540666c3afd93f48ca7cae5977f64d)\".",
    "created_at": "2016-02-10T02:11:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20018#issuecomment-364305",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[bcb68d013dc8786c8f897f5d2b0c3329a93822a5](https://github.com/sagemath/sagetrac-mirror/commit/bcb68d013dc8786c8f897f5d2b0c3329a93822a5)" to "[dd2c436278540666c3afd93f48ca7cae5977f64d](https://github.com/sagemath/sagetrac-mirror/commit/dd2c436278540666c3afd93f48ca7cae5977f64d)".



---

archive/issue_comments_364306.json:
```json
{
    "body": "**Changing commit** from \"[dd2c436278540666c3afd93f48ca7cae5977f64d](https://github.com/sagemath/sagetrac-mirror/commit/dd2c436278540666c3afd93f48ca7cae5977f64d)\" to \"[9fcdd5bc8e44c0553c2d26bb9752d57534afa4a4](https://github.com/sagemath/sagetrac-mirror/commit/9fcdd5bc8e44c0553c2d26bb9752d57534afa4a4)\".",
    "created_at": "2016-02-16T17:50:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20018#issuecomment-364306",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[dd2c436278540666c3afd93f48ca7cae5977f64d](https://github.com/sagemath/sagetrac-mirror/commit/dd2c436278540666c3afd93f48ca7cae5977f64d)" to "[9fcdd5bc8e44c0553c2d26bb9752d57534afa4a4](https://github.com/sagemath/sagetrac-mirror/commit/9fcdd5bc8e44c0553c2d26bb9752d57534afa4a4)".



---

archive/issue_comments_364307.json:
```json
{
    "body": "<a id='comment:4'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/76633515ceefd76e837b73f48331f74c55b5f7ee\">7663351</a></td><td><code>Merge branch '7.1.beta3' into ticket/20018</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9fcdd5bc8e44c0553c2d26bb9752d57534afa4a4\">9fcdd5b</a></td><td><code>20018: correct doc test for beta3</code></td></tr></table>\n",
    "created_at": "2016-02-16T17:50:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20018#issuecomment-364307",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/76633515ceefd76e837b73f48331f74c55b5f7ee">7663351</a></td><td><code>Merge branch '7.1.beta3' into ticket/20018</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9fcdd5bc8e44c0553c2d26bb9752d57534afa4a4">9fcdd5b</a></td><td><code>20018: correct doc test for beta3</code></td></tr></table>




---

archive/issue_comments_364308.json:
```json
{
    "body": "<a id='comment:5'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/03736f56d5bff62e77344494349864f42a43fdd0\">03736f5</a></td><td><code>Merge branch '7.1.beta5' into ticket/20018</code></td></tr></table>\n",
    "created_at": "2016-02-26T01:50:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20018#issuecomment-364308",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/03736f56d5bff62e77344494349864f42a43fdd0">03736f5</a></td><td><code>Merge branch '7.1.beta5' into ticket/20018</code></td></tr></table>




---

archive/issue_comments_364309.json:
```json
{
    "body": "**Changing commit** from \"[9fcdd5bc8e44c0553c2d26bb9752d57534afa4a4](https://github.com/sagemath/sagetrac-mirror/commit/9fcdd5bc8e44c0553c2d26bb9752d57534afa4a4)\" to \"[03736f56d5bff62e77344494349864f42a43fdd0](https://github.com/sagemath/sagetrac-mirror/commit/03736f56d5bff62e77344494349864f42a43fdd0)\".",
    "created_at": "2016-02-26T01:50:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20018#issuecomment-364309",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[9fcdd5bc8e44c0553c2d26bb9752d57534afa4a4](https://github.com/sagemath/sagetrac-mirror/commit/9fcdd5bc8e44c0553c2d26bb9752d57534afa4a4)" to "[03736f56d5bff62e77344494349864f42a43fdd0](https://github.com/sagemath/sagetrac-mirror/commit/03736f56d5bff62e77344494349864f42a43fdd0)".



---

archive/issue_comments_364310.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2016-02-26T17:30:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20018#issuecomment-364310",
    "user": "https://trac.sagemath.org/admin/accounts/users/atowsley"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_364311.json:
```json
{
    "body": "<a id='comment:7'></a>\nReviewer name is missing",
    "created_at": "2016-02-26T21:28:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20018#issuecomment-364311",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:7'></a>
Reviewer name is missing



---

archive/issue_comments_364312.json:
```json
{
    "body": "**Changing status** from positive_review to needs_work.",
    "created_at": "2016-02-26T21:28:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20018#issuecomment-364312",
    "user": "https://github.com/vbraun"
}
```

**Changing status** from positive_review to needs_work.



---

archive/issue_comments_364313.json:
```json
{
    "body": "**Changing status** from needs_work to positive_review.",
    "created_at": "2016-02-26T21:37:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20018#issuecomment-364313",
    "user": "https://trac.sagemath.org/admin/accounts/users/atowsley"
}
```

**Changing status** from needs_work to positive_review.



---

archive/issue_comments_364314.json:
```json
{
    "body": "**Reviewer:** Adam Towsley",
    "created_at": "2016-02-26T21:37:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20018#issuecomment-364314",
    "user": "https://trac.sagemath.org/admin/accounts/users/atowsley"
}
```

**Reviewer:** Adam Towsley



---

archive/issue_events_062035.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-02-28T00:52:33Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/20018",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20018#event-62035"
}
```



---

archive/issue_comments_364315.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2016-02-28T00:52:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20018#issuecomment-364315",
    "user": "https://github.com/vbraun"
}
```

**Resolution:** fixed



---

archive/issue_comments_364316.json:
```json
{
    "body": "**Changing branch** from \"[u/bhutz/ticket/20018](https://github.com/sagemath/sagetrac-mirror/tree/u/bhutz/ticket/20018)\" to \"[03736f56d5bff62e77344494349864f42a43fdd0](https://github.com/sagemath/sagetrac-mirror/commit/03736f56d5bff62e77344494349864f42a43fdd0)\".",
    "created_at": "2016-02-28T00:52:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20018#issuecomment-364316",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/bhutz/ticket/20018](https://github.com/sagemath/sagetrac-mirror/tree/u/bhutz/ticket/20018)" to "[03736f56d5bff62e77344494349864f42a43fdd0](https://github.com/sagemath/sagetrac-mirror/commit/03736f56d5bff62e77344494349864f42a43fdd0)".
