# Issue 20018: init for endomorphism of projective subschemes fails

archive/issues_019781.json:
```json
{
    "body": "The following example does not work\n\n```\nsage: R.<t>=PolynomialRing(QQ)\nsage: P.<x,y,z> = ProjectiveSpace(R,2)\nsage: X = P.subscheme(x^2-y^2)\nsage: H = Hom(X,X)\nsage: f = H([x^2,y^2,x*z])\n```\n\nbut does work in affine space. It seems that the check in init is not quite doing the right thing.\n\nAssignee: @bhutz\n\nReviewer: Adam Towsley\n\nAuthor: Ben Hutz\n\nBranch: 03736f56d5bff62e77344494349864f42a43fdd0\n\nCommit: 03736f56d5bff62e77344494349864f42a43fdd0\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/20018\n\n",
    "closed_at": "2016-02-28T00:52:33Z",
    "created_at": "2016-02-05T22:47:00Z",
    "labels": [
        "component: algebraic geometry",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.1",
    "title": "init for endomorphism of projective subschemes fails",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/20018",
    "user": "https://github.com/bhutz"
}
```
The following example does not work

```
sage: R.<t>=PolynomialRing(QQ)
sage: P.<x,y,z> = ProjectiveSpace(R,2)
sage: X = P.subscheme(x^2-y^2)
sage: H = Hom(X,X)
sage: f = H([x^2,y^2,x*z])
```

but does work in affine space. It seems that the check in init is not quite doing the right thing.

Assignee: @bhutz

Reviewer: Adam Towsley

Author: Ben Hutz

Branch: 03736f56d5bff62e77344494349864f42a43fdd0

Commit: 03736f56d5bff62e77344494349864f42a43fdd0

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/20018





---

archive/issue_comments_271507.json:
```json
{
    "body": "<a id='comment:2'></a>Since I didn't get any input from the sage-devel thread I went ahead an implemented one possible correction to these issues. At this stage I welcome comments on the solution.\n\nThe key points are as follows\n\n- the actual coordinates of the map remain in the coordinate ring of the ambient space (i.e., this is unchanged)\n\n- if you initialize the map with variables from the coordinate ring of the ambient space, they are not reduced modulo the defining ideal of the subscheme (new behavior)\n\n- if you initialize the map with variables from the coordinate ring of the subscheme, they are in the quotient, so are reduced. (unchanged)\n\nThis allows initialization to work in more situations such as for the problem in the description, but also corrects the weird behavior such as:\n\nold behavior\n\n```\nsage: P.<x,y,z> = ProjectiveSpace(QQ,2)\nsage: X=P.subscheme([x^2-y^2])\nsage: H = End(X)\nsage: f = H([x^2,y^2,z^2])\nsage: f.multiplier(X([1,1]),1)\n[0 2]\n[0 2]\n```\n\nnew behavior\n\n```\nsage: P.<x,y,z> = ProjectiveSpace(QQ,2)\nsage: X=P.subscheme([x^2-y^2])\nsage: H = End(X)\nsage: f = H([x^2,y^2,z^2])\nsage: f.multiplier(X([1,1]),1)\n[2 0]\n[0 2]\n```\n\nOne consequence is the projective_embedding functionality in toric variety seems to be programmed to expect the reduction. Consequently, I've had the creation code use the quotient ring variables, so that behavior matches the current doctests.\n\nIn a couple places in elliptic_curve/jacobian.py the morphism returned is now in a slightly different form. This did not seem to big a difference, so I just updated those doctests.",
    "created_at": "2016-02-09T22:53:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20018#issuecomment-271507",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:2'></a>Since I didn't get any input from the sage-devel thread I went ahead an implemented one possible correction to these issues. At this stage I welcome comments on the solution.

The key points are as follows

- the actual coordinates of the map remain in the coordinate ring of the ambient space (i.e., this is unchanged)

- if you initialize the map with variables from the coordinate ring of the ambient space, they are not reduced modulo the defining ideal of the subscheme (new behavior)

- if you initialize the map with variables from the coordinate ring of the subscheme, they are in the quotient, so are reduced. (unchanged)

This allows initialization to work in more situations such as for the problem in the description, but also corrects the weird behavior such as:

old behavior

```
sage: P.<x,y,z> = ProjectiveSpace(QQ,2)
sage: X=P.subscheme([x^2-y^2])
sage: H = End(X)
sage: f = H([x^2,y^2,z^2])
sage: f.multiplier(X([1,1]),1)
[0 2]
[0 2]
```

new behavior

```
sage: P.<x,y,z> = ProjectiveSpace(QQ,2)
sage: X=P.subscheme([x^2-y^2])
sage: H = End(X)
sage: f = H([x^2,y^2,z^2])
sage: f.multiplier(X([1,1]),1)
[2 0]
[0 2]
```

One consequence is the projective_embedding functionality in toric variety seems to be programmed to expect the reduction. Consequently, I've had the creation code use the quotient ring variables, so that behavior matches the current doctests.

In a couple places in elliptic_curve/jacobian.py the morphism returned is now in a slightly different form. This did not seem to big a difference, so I just updated those doctests.



---

archive/issue_comments_271508.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-02-09T22:53:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20018#issuecomment-271508",
    "user": "https://github.com/bhutz"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_271509.json:
```json
{
    "body": "<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-02-10T02:11:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20018#issuecomment-271509",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_271510.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-02-16T17:50:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20018#issuecomment-271510",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_271511.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-02-26T01:50:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20018#issuecomment-271511",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_271512.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-02-26T17:30:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20018#issuecomment-271512",
    "user": "https://trac.sagemath.org/admin/accounts/users/atowsley"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_271513.json:
```json
{
    "body": "<a id='comment:7'></a>Reviewer name is missing",
    "created_at": "2016-02-26T21:28:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20018#issuecomment-271513",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:7'></a>Reviewer name is missing



---

archive/issue_comments_271514.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2016-02-26T21:28:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20018#issuecomment-271514",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_271515.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2016-02-26T21:37:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20018#issuecomment-271515",
    "user": "https://trac.sagemath.org/admin/accounts/users/atowsley"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_events_054554.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-02-28T00:52:33Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/20018",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20018#event-54554"
}
```



---

archive/issue_comments_271516.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-02-28T00:52:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20018#issuecomment-271516",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
