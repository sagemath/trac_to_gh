# Issue 20181: number_field_elements_from_algebraics should create embedded number field elements

archive/issues_019944.json:
```json
{
    "assignees": [],
    "body": "<div id=\"comment:0\"></div>\n\nThis is a follow-up on #17830 and #18819.\n\n#17830 made this possible:\n\n```\nsage: x = polygen(ZZ)\nsage: K.<cbrt2> = NumberField(x^3 - 2, embedding=AA.polynomial_root(x^3-2, RIF(0,3)))\nsage: 6064/4813 < cbrt2 < 90325/71691\nTrue\n```\n\nBut if one uses `number_field_elements_from_algebraics`, one gets only non-embedded number field elements:\n\n```\nsage: x = polygen(ZZ)\nsage: K, cbrt2, hom = number_field_elements_from_algebraics(AA.polynomial_root(x^3-2, RIF(0,3)))\nsage: 6064/4813 < cbrt2 < 90325/71691\nFalse            # (an perhaps an error in Python 3?)\n```\n\nThis ticket adds an option `embedded` to create embedded number field elements.\n\n```\nsage: x = polygen(ZZ)\nsage: K, cbrt2, hom = number_field_elements_from_algebraics(AA.polynomial_root(x^3-2, RIF(0,3)), embedded=True)\nsage: 6064/4813 < cbrt2 < 90325/71691\nTrue\n```\n\nTODECIDE:\n\n- Close ticket #5355?\n\nCC:  @vbraun @gagern @videlec @sagetrac-tmonteil @jjermann @staroste @jplab @mo271 @yuan-zhou @JohnCremona @tscrim\n\nComponent: **number fields**\n\nKeywords: **IMA-PolyGeom**\n\nAuthor: **Jean-Philippe Labb\u00e9**\n\nBranch: **[`9255f2c`](https://github.com/sagemath/sagetrac-mirror/commit/9255f2c89588c79de496660c8c9030f087b5ebfd)**\n\nReviewer: **Matthias Koeppe, John Cremona**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/20181_\n\n",
    "closed_at": "2019-04-29T12:35:34Z",
    "created_at": "2016-03-09T03:17:39Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20number%20fields",
        "https://github.com/sagemath/sage/labels/p%3A%20minor%20/%204",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.8",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "number_field_elements_from_algebraics should create embedded number field elements",
    "type": "issue",
    "updated_at": "2019-05-04T18:06:25Z",
    "url": "https://github.com/sagemath/sage/issues/20181",
    "user": "https://github.com/mkoeppe"
}
```
<div id="comment:0"></div>

This is a follow-up on #17830 and #18819.

#17830 made this possible:

```
sage: x = polygen(ZZ)
sage: K.<cbrt2> = NumberField(x^3 - 2, embedding=AA.polynomial_root(x^3-2, RIF(0,3)))
sage: 6064/4813 < cbrt2 < 90325/71691
True
```

But if one uses `number_field_elements_from_algebraics`, one gets only non-embedded number field elements:

```
sage: x = polygen(ZZ)
sage: K, cbrt2, hom = number_field_elements_from_algebraics(AA.polynomial_root(x^3-2, RIF(0,3)))
sage: 6064/4813 < cbrt2 < 90325/71691
False            # (an perhaps an error in Python 3?)
```

This ticket adds an option `embedded` to create embedded number field elements.

```
sage: x = polygen(ZZ)
sage: K, cbrt2, hom = number_field_elements_from_algebraics(AA.polynomial_root(x^3-2, RIF(0,3)), embedded=True)
sage: 6064/4813 < cbrt2 < 90325/71691
True
```

TODECIDE:

- Close ticket #5355?

CC:  @vbraun @gagern @videlec @sagetrac-tmonteil @jjermann @staroste @jplab @mo271 @yuan-zhou @JohnCremona @tscrim

Component: **number fields**

Keywords: **IMA-PolyGeom**

Author: **Jean-Philippe LabbÃ©**

Branch: **[`9255f2c`](https://github.com/sagemath/sagetrac-mirror/commit/9255f2c89588c79de496660c8c9030f087b5ebfd)**

Reviewer: **Matthias Koeppe, John Cremona**

_Issue created by migration from https://trac.sagemath.org/ticket/20181_





---

archive/issue_events_282383.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2016-03-09T03:17:39Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "milestone_number": null,
    "milestone_title": "sage-7.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20181#event-282383"
}
```



---

archive/issue_events_282384.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2016-03-09T03:17:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20number%20fields",
    "label_color": "0000ff",
    "label_name": "c: number fields",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20181#event-282384"
}
```



---

archive/issue_events_282385.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2016-03-09T03:17:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20minor%20/%204",
    "label_color": "ffe799",
    "label_name": "p: minor / 4",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20181#event-282385"
}
```



---

archive/issue_events_282386.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2016-03-09T03:17:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20181#event-282386"
}
```



---

archive/issue_comments_289968.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nWhile looking at related tickets, I noticed the very old ticket #5355, which should be closed I think.",
    "created_at": "2016-03-09T03:21:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20181#issuecomment-289968",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:1" align="right">comment:1</div>

While looking at related tickets, I noticed the very old ticket #5355, which should be closed I think.



---

archive/issue_comments_289969.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -12,7 +12,8 @@\n But if one uses `number_field_elements_from_algebraics`, one gets only non-embedded number field elements:\n \n ```\n-sage: cbrt2 = number_field_elements_from_algebraics(AA.polynomial_root(x^3-2, RIF(0,3)))\n+sage: x = polygen(ZZ)\n+sage: K, cbrt2, hom = number_field_elements_from_algebraics(AA.polynomial_root(x^3-2, RIF(0,3)))\n sage: 6064/4813 < cbrt2 < 90325/71691\n False\n ```\n``````\n",
    "created_at": "2016-03-11T18:25:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20181#issuecomment-289969",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -12,7 +12,8 @@
 But if one uses `number_field_elements_from_algebraics`, one gets only non-embedded number field elements:
 
 ```
-sage: cbrt2 = number_field_elements_from_algebraics(AA.polynomial_root(x^3-2, RIF(0,3)))
+sage: x = polygen(ZZ)
+sage: K, cbrt2, hom = number_field_elements_from_algebraics(AA.polynomial_root(x^3-2, RIF(0,3)))
 sage: 6064/4813 < cbrt2 < 90325/71691
 False
 ```
``````




---

archive/issue_comments_289970.json:
```json
{
    "body": "Commit: **[`26dc3e4`](https://github.com/sagemath/sagetrac-mirror/commit/26dc3e4e6a26f6f613a69d57929ea492c278dad0)**",
    "created_at": "2018-04-05T22:58:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20181#issuecomment-289970",
    "user": "https://github.com/jplab"
}
```

Commit: **[`26dc3e4`](https://github.com/sagemath/sagetrac-mirror/commit/26dc3e4e6a26f6f613a69d57929ea492c278dad0)**



---

archive/issue_events_282387.json:
```json
{
    "actor": "https://github.com/jplab",
    "created_at": "2018-04-05T22:58:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20181#event-282387"
}
```



---

archive/issue_comments_289971.json:
```json
{
    "body": "Branch: **[public/algnum_to_numberfield](https://github.com/sagemath/sagetrac-mirror/tree/public/algnum_to_numberfield)**",
    "created_at": "2018-04-05T22:58:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20181#issuecomment-289971",
    "user": "https://github.com/jplab"
}
```

Branch: **[public/algnum_to_numberfield](https://github.com/sagemath/sagetrac-mirror/tree/public/algnum_to_numberfield)**



---

archive/issue_comments_289972.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nHere is a first version. Comments are welcome.\n\nOne question is whether `RealIntervalField` is the right choice?\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/26dc3e4e6a26f6f613a69d57929ea492c278dad0\"><code>26dc3e4</code></a></td><td><code>Added option for embedded NumberField</code></td></tr></table>\n",
    "created_at": "2018-04-05T22:58:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20181#issuecomment-289972",
    "user": "https://github.com/jplab"
}
```

<div id="comment:5" align="right">comment:5</div>

Here is a first version. Comments are welcome.

One question is whether `RealIntervalField` is the right choice?

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/26dc3e4e6a26f6f613a69d57929ea492c278dad0"><code>26dc3e4</code></a></td><td><code>Added option for embedded NumberField</code></td></tr></table>




---

archive/issue_comments_289973.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nMaybe it would be nice to also add the optional parameter to the method `as_number_field_element` as well...",
    "created_at": "2018-04-05T23:01:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20181#issuecomment-289973",
    "user": "https://github.com/jplab"
}
```

<div id="comment:6" align="right">comment:6</div>

Maybe it would be nice to also add the optional parameter to the method `as_number_field_element` as well...



---

archive/issue_comments_289974.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nThe following should work but it does not:\n\n```\nsage: UCF = UniversalCyclotomicField()\nsage: E = UCF.gen(5)\nsage: my_nums = [-52*E - 136*E^2 - 136*E^3 - 52*E^4, -66*E - 168*E^2 - 168*E^3 - 66*E^4, -46*E - 114*E^2 - 114*E^3 - 46*E^4, -24*E - 58*E^2 - 58*E\n....: ^3 - 24*E^4, sqrt(2)]\nsage: [n(_) for _ in my_nums]\n[187.914855054991 - 8.67361737988404e-18*I,\n 231.039466852489 - 1.04083408558608e-17*I,\n 156.026311234993 - 8.67361737988404e-18*I,\n 79.0131556174964 - 4.33680868994202e-18*I,\n 1.41421356237310]\nsage: res = number_field_elements_from_algebraics(my_nums,embedded=True)\nTraceback (most recent call last):\n...\nTypeError: unable to convert -0.4370160244488211? - 1.344997023927915?*I to real interval\n```\n\nThe choice of root shoould always be made real...",
    "created_at": "2018-04-05T23:50:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20181#issuecomment-289974",
    "user": "https://github.com/jplab"
}
```

<div id="comment:7" align="right">comment:7</div>

The following should work but it does not:

```
sage: UCF = UniversalCyclotomicField()
sage: E = UCF.gen(5)
sage: my_nums = [-52*E - 136*E^2 - 136*E^3 - 52*E^4, -66*E - 168*E^2 - 168*E^3 - 66*E^4, -46*E - 114*E^2 - 114*E^3 - 46*E^4, -24*E - 58*E^2 - 58*E
....: ^3 - 24*E^4, sqrt(2)]
sage: [n(_) for _ in my_nums]
[187.914855054991 - 8.67361737988404e-18*I,
 231.039466852489 - 1.04083408558608e-17*I,
 156.026311234993 - 8.67361737988404e-18*I,
 79.0131556174964 - 4.33680868994202e-18*I,
 1.41421356237310]
sage: res = number_field_elements_from_algebraics(my_nums,embedded=True)
Traceback (most recent call last):
...
TypeError: unable to convert -0.4370160244488211? - 1.344997023927915?*I to real interval
```

The choice of root shoould always be made real...



---

archive/issue_comments_289975.json:
```json
{
    "body": "<div id=\"comment:8\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/db778eeeb93978335aa113e09a51ccabfe2350e4\"><code>db778ee</code></a></td><td><code>Made it possible to deal with complex number fields</code></td></tr></table>\n",
    "created_at": "2018-04-06T16:50:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20181#issuecomment-289975",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:8"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/db778eeeb93978335aa113e09a51ccabfe2350e4"><code>db778ee</code></a></td><td><code>Made it possible to deal with complex number fields</code></td></tr></table>




---

archive/issue_comments_289976.json:
```json
{
    "body": "Changed commit from **[`26dc3e4`](https://github.com/sagemath/sagetrac-mirror/commit/26dc3e4e6a26f6f613a69d57929ea492c278dad0)** to **[`db778ee`](https://github.com/sagemath/sagetrac-mirror/commit/db778eeeb93978335aa113e09a51ccabfe2350e4)**",
    "created_at": "2018-04-06T16:50:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20181#issuecomment-289976",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`26dc3e4`](https://github.com/sagemath/sagetrac-mirror/commit/26dc3e4e6a26f6f613a69d57929ea492c278dad0)** to **[`db778ee`](https://github.com/sagemath/sagetrac-mirror/commit/db778eeeb93978335aa113e09a51ccabfe2350e4)**



---

archive/issue_comments_289977.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nIt is now possible to get this:\n\n```\nsage: UCF = UniversalCyclotomicField()\nsage: E = UCF.gen(5)\nsage: L.<b> = NumberField(x^2-189*x+16, embedding=200)\nsage: my_nums = [-52*E - 136*E^2 - 136*E^3 - 52*E^4, L.gen()._algebraic_(AA),sqrt(2)]\nsage: aa_my_nums = [AA(_) for _ in my_nums]\nsage: res = number_field_elements_from_algebraics(aa_my_nums,embedded=True)\nsage: res\n(Number Field in a with defining polynomial y^8 - 35670*y^6 + 476899047*y^4 - 2832410271650*y^2 + 6305298701739921,\n [2310/26212773509*a^7 - 185432947/78638320527*a^5 + 1652517502195/78638320527*a^3 - 4904676315215467/78638320527*a + 94,\n  -1238/2803377488467023*a^7 + 185460719/11213509953868092*a^5 - 2754936849443/11213509953868092*a^3 + 8180694680816975/3737836651289364*a + 189/2,\n  -1979/1887160880826*a^7 + 26472586/943580440413*a^5 - 235822245043/943580440413*a^3 + 466325019915415/629053626942*a],\n Ring morphism:\n   From: Number Field in a with defining polynomial y^8 - 35670*y^6 + 476899047*y^4 - 2832410271650*y^2 + 6305298701739921\n   To:   Algebraic Real Field\n   Defn: a |--> 96.9475535136628?)\nsage: res[0].gen_embedding()\n96.9475535136628?\nsage: res = number_field_elements_from_algebraics(aa_my_nums,embedded=False)\nsage: res[0].gen_embedding()  # Nothing is returned(!?!?!)\nsage:\n```\n\nPerhaps it would be nice to say that there is no embedding instead of returning nothing?",
    "created_at": "2018-04-06T16:53:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20181#issuecomment-289977",
    "user": "https://github.com/jplab"
}
```

<div id="comment:9" align="right">comment:9</div>

It is now possible to get this:

```
sage: UCF = UniversalCyclotomicField()
sage: E = UCF.gen(5)
sage: L.<b> = NumberField(x^2-189*x+16, embedding=200)
sage: my_nums = [-52*E - 136*E^2 - 136*E^3 - 52*E^4, L.gen()._algebraic_(AA),sqrt(2)]
sage: aa_my_nums = [AA(_) for _ in my_nums]
sage: res = number_field_elements_from_algebraics(aa_my_nums,embedded=True)
sage: res
(Number Field in a with defining polynomial y^8 - 35670*y^6 + 476899047*y^4 - 2832410271650*y^2 + 6305298701739921,
 [2310/26212773509*a^7 - 185432947/78638320527*a^5 + 1652517502195/78638320527*a^3 - 4904676315215467/78638320527*a + 94,
  -1238/2803377488467023*a^7 + 185460719/11213509953868092*a^5 - 2754936849443/11213509953868092*a^3 + 8180694680816975/3737836651289364*a + 189/2,
  -1979/1887160880826*a^7 + 26472586/943580440413*a^5 - 235822245043/943580440413*a^3 + 466325019915415/629053626942*a],
 Ring morphism:
   From: Number Field in a with defining polynomial y^8 - 35670*y^6 + 476899047*y^4 - 2832410271650*y^2 + 6305298701739921
   To:   Algebraic Real Field
   Defn: a |--> 96.9475535136628?)
sage: res[0].gen_embedding()
96.9475535136628?
sage: res = number_field_elements_from_algebraics(aa_my_nums,embedded=False)
sage: res[0].gen_embedding()  # Nothing is returned(!?!?!)
sage:
```

Perhaps it would be nice to say that there is no embedding instead of returning nothing?



---

archive/issue_events_282388.json:
```json
{
    "actor": "https://github.com/jplab",
    "created_at": "2018-04-06T17:27:51Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20181#event-282388"
}
```



---

archive/issue_events_282389.json:
```json
{
    "actor": "https://github.com/jplab",
    "created_at": "2018-04-06T17:27:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20181#event-282389"
}
```



---

archive/issue_comments_289978.json:
```json
{
    "body": "Author: **Jean-Philippe Labb\u00e9**",
    "created_at": "2018-04-06T19:05:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20181#issuecomment-289978",
    "user": "https://github.com/jplab"
}
```

Author: **Jean-Philippe LabbÃ©**



---

archive/issue_comments_289979.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nThe returned morphism is not able to convert the elements.\n\n```\nsage: res[2](my_nums[0])\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-8-74370e91d982> in <module>()\n----> 1 res[Integer(2)](my_nums[Integer(0)])\n\n/Users/mkoeppe/s/sage/some-sage-install-prefix/lib/python2.7/site-packages/sage/categories/map.pyx in sage.categories.map.Map.__call__ (build/cythonized/sage/categories/map.c:6978)()\n    781                 x = D(x)\n    782             except (TypeError, NotImplementedError):\n--> 783                 raise TypeError(\"%s fails to convert into the map's domain %s, but a `pushforward` method is not properly implemented\" % (x, D))\n    784         else:\n    785             x = converter(x)\n\nTypeError: -52*E(5) - 136*E(5)^2 - 136*E(5)^3 - 52*E(5)^4 fails to convert into the map's domain Number Field in a with defining polynomial y^8 - 35670*y^6 + 476899047*y^4 - 2832410271650*y^2 + 6305298701739921, but a `pushforward` method is not properly implemented\n```\n\nEdit: I withdraw this comment; I misremembered what `hom` is supposed to do.",
    "created_at": "2018-04-06T22:10:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20181#issuecomment-289979",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:12" align="right">comment:12</div>

The returned morphism is not able to convert the elements.

```
sage: res[2](my_nums[0])
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-8-74370e91d982> in <module>()
----> 1 res[Integer(2)](my_nums[Integer(0)])

/Users/mkoeppe/s/sage/some-sage-install-prefix/lib/python2.7/site-packages/sage/categories/map.pyx in sage.categories.map.Map.__call__ (build/cythonized/sage/categories/map.c:6978)()
    781                 x = D(x)
    782             except (TypeError, NotImplementedError):
--> 783                 raise TypeError("%s fails to convert into the map's domain %s, but a `pushforward` method is not properly implemented" % (x, D))
    784         else:
    785             x = converter(x)

TypeError: -52*E(5) - 136*E(5)^2 - 136*E(5)^3 - 52*E(5)^4 fails to convert into the map's domain Number Field in a with defining polynomial y^8 - 35670*y^6 + 476899047*y^4 - 2832410271650*y^2 + 6305298701739921, but a `pushforward` method is not properly implemented
```

Edit: I withdraw this comment; I misremembered what `hom` is supposed to do.



---

archive/issue_comments_289980.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nTwo quick comments:\n* you may want to pathc `as_number_field_element()` too,\n* don't forget to add tests covering the case where some or all of the elements are rationals or elements of quadratic extensions (rationals, quadratic number field elements and higher-degree number field elements don't have exactly the same interface...)",
    "created_at": "2018-04-07T08:02:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20181#issuecomment-289980",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:13" align="right">comment:13</div>

Two quick comments:
* you may want to pathc `as_number_field_element()` too,
* don't forget to add tests covering the case where some or all of the elements are rationals or elements of quadratic extensions (rationals, quadratic number field elements and higher-degree number field elements don't have exactly the same interface...)



---

archive/issue_comments_289981.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReplying to [@mezzarobba](#comment%3A13):\n> Two quick comments:\n> * you may want to pathc `as_number_field_element()` too,\n> * don't forget to add tests covering the case where some or all of the elements are rationals or elements of quadratic extensions (rationals, quadratic number field elements and higher-degree number field elements don't have exactly the same interface...)\n\nYes, that sounds very reasonable. I will do that, along with fixing what mkoeppe mentionned above.",
    "created_at": "2018-04-07T13:21:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20181#issuecomment-289981",
    "user": "https://github.com/jplab"
}
```

<div id="comment:14" align="right">comment:14</div>

Replying to [@mezzarobba](#comment%3A13):
> Two quick comments:
> * you may want to pathc `as_number_field_element()` too,
> * don't forget to add tests covering the case where some or all of the elements are rationals or elements of quadratic extensions (rationals, quadratic number field elements and higher-degree number field elements don't have exactly the same interface...)

Yes, that sounds very reasonable. I will do that, along with fixing what mkoeppe mentionned above.



---

archive/issue_events_282390.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2018-04-07T21:28:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20181#event-282390"
}
```



---

archive/issue_events_282391.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2018-04-07T21:28:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20181#event-282391"
}
```



---

archive/issue_comments_289982.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nDoesn't always seem to give real embeddings:\n\n```\nsage: x = polygen(ZZ); elts = number_field_elements_from_algebraics([sqrt(2), AA.polynomial_root(x^3-2, RIF(0,3))], embedded=True)[1]\nsage: [AA(y) for y in elts]\n...\nTypeError: unable to convert -0.561231024154687? - 0.9720806486198328?*I to real interval\n```",
    "created_at": "2018-04-08T00:18:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20181#issuecomment-289982",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:16" align="right">comment:16</div>

Doesn't always seem to give real embeddings:

```
sage: x = polygen(ZZ); elts = number_field_elements_from_algebraics([sqrt(2), AA.polynomial_root(x^3-2, RIF(0,3))], embedded=True)[1]
sage: [AA(y) for y in elts]
...
TypeError: unable to convert -0.561231024154687? - 0.9720806486198328?*I to real interval
```



---

archive/issue_comments_289983.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nReplying to [@mkoeppe](#comment%3A12):\n> The returned morphism is not able to convert the elements.\n> \n> ```\n> sage: res[2](my_nums[0])\n> ---------------------------------------------------------------------------\n> TypeError                                 Traceback (most recent call last)\n> <ipython-input-8-74370e91d982> in <module>()\n> ----> 1 res[Integer(2)](my_nums[Integer(0)])\n> \n> /Users/mkoeppe/s/sage/some-sage-install-prefix/lib/python2.7/site-packages/sage/categories/map.pyx in sage.categories.map.Map.__call__ (build/cythonized/sage/categories/map.c:6978)()\n>     781                 x = D(x)\n>     782             except (TypeError, NotImplementedError):\n> --> 783                 raise TypeError(\"%s fails to convert into the map's domain %s, but a `pushforward` method is not properly implemented\" % (x, D))\n>     784         else:\n>     785             x = converter(x)\n> \n> TypeError: -52*E(5) - 136*E(5)^2 - 136*E(5)^3 - 52*E(5)^4 fails to convert into the map's domain Number Field in a with defining polynomial y^8 - 35670*y^6 + 476899047*y^4 - 2832410271650*y^2 + 6305298701739921, but a `pushforward` method is not properly implemented\n> ```\n\nThe homomorphism goes the other way around... Thanks to Moritz for noticing that.",
    "created_at": "2018-04-08T21:19:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20181#issuecomment-289983",
    "user": "https://github.com/jplab"
}
```

<div id="comment:17" align="right">comment:17</div>

Replying to [@mkoeppe](#comment%3A12):
> The returned morphism is not able to convert the elements.
> 
> ```
> sage: res[2](my_nums[0])
> ---------------------------------------------------------------------------
> TypeError                                 Traceback (most recent call last)
> <ipython-input-8-74370e91d982> in <module>()
> ----> 1 res[Integer(2)](my_nums[Integer(0)])
> 
> /Users/mkoeppe/s/sage/some-sage-install-prefix/lib/python2.7/site-packages/sage/categories/map.pyx in sage.categories.map.Map.__call__ (build/cythonized/sage/categories/map.c:6978)()
>     781                 x = D(x)
>     782             except (TypeError, NotImplementedError):
> --> 783                 raise TypeError("%s fails to convert into the map's domain %s, but a `pushforward` method is not properly implemented" % (x, D))
>     784         else:
>     785             x = converter(x)
> 
> TypeError: -52*E(5) - 136*E(5)^2 - 136*E(5)^3 - 52*E(5)^4 fails to convert into the map's domain Number Field in a with defining polynomial y^8 - 35670*y^6 + 476899047*y^4 - 2832410271650*y^2 + 6305298701739921, but a `pushforward` method is not properly implemented
> ```

The homomorphism goes the other way around... Thanks to Moritz for noticing that.



---

archive/issue_comments_289984.json:
```json
{
    "body": "Changed commit from **[`db778ee`](https://github.com/sagemath/sagetrac-mirror/commit/db778eeeb93978335aa113e09a51ccabfe2350e4)** to **[`a9045bf`](https://github.com/sagemath/sagetrac-mirror/commit/a9045bf8a3aab2d0aa00be17e91227bc1b50262a)**",
    "created_at": "2018-04-08T22:22:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20181#issuecomment-289984",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`db778ee`](https://github.com/sagemath/sagetrac-mirror/commit/db778eeeb93978335aa113e09a51ccabfe2350e4)** to **[`a9045bf`](https://github.com/sagemath/sagetrac-mirror/commit/a9045bf8a3aab2d0aa00be17e91227bc1b50262a)**



---

archive/issue_comments_289985.json:
```json
{
    "body": "<div id=\"comment:18\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a9045bf8a3aab2d0aa00be17e91227bc1b50262a\"><code>a9045bf</code></a></td><td><code>Added tests and made them pass</code></td></tr></table>\n",
    "created_at": "2018-04-08T22:22:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20181#issuecomment-289985",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:18"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a9045bf8a3aab2d0aa00be17e91227bc1b50262a"><code>a9045bf</code></a></td><td><code>Added tests and made them pass</code></td></tr></table>




---

archive/issue_comments_289986.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nOkay. I added some tests and now it seems to work.\n\nWith the current commit, I have one failing doctest for which I do not know what to do:\n\n```\nFile \"qqbar.py\", line 2098, in sage.rings.qqbar.number_field_elements_from_algebraics\nFailed example:\n    number_field_elements_from_algebraics(rt2c)\nExpected:\n    (Number Field in a with defining polynomial y^4 + 2*y^2 + 4, 1/2*a^3, Ring morphism:\n        From: Number Field in a with defining polynomial y^4 + 2*y^2 + 4\n        To:   Algebraic Field\n        Defn: a |--> -0.7071067811865475? - 1.224744871391589?*I)\nGot:\n    (Number Field in a with defining polynomial y^2 - 2, a, Ring morphism:\n       From: Number Field in a with defining polynomial y^2 - 2\n       To:   Algebraic Real Field\n       Defn: a |--> 1.414213562373095?)\n```\n\nThis is in the tests section and the explanation given is exactly a situation that we have to outsmart when we want to be able to accept cyclotomic fields elements to be parsed to real embedded number fields.\n\nIt seems to me that the proposed code improves the situation as Sage now recognize that it is a real number... I can not see a reason right now to go against that. Am I missing something?",
    "created_at": "2018-04-08T22:26:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20181#issuecomment-289986",
    "user": "https://github.com/jplab"
}
```

<div id="comment:19" align="right">comment:19</div>

Okay. I added some tests and now it seems to work.

With the current commit, I have one failing doctest for which I do not know what to do:

```
File "qqbar.py", line 2098, in sage.rings.qqbar.number_field_elements_from_algebraics
Failed example:
    number_field_elements_from_algebraics(rt2c)
Expected:
    (Number Field in a with defining polynomial y^4 + 2*y^2 + 4, 1/2*a^3, Ring morphism:
        From: Number Field in a with defining polynomial y^4 + 2*y^2 + 4
        To:   Algebraic Field
        Defn: a |--> -0.7071067811865475? - 1.224744871391589?*I)
Got:
    (Number Field in a with defining polynomial y^2 - 2, a, Ring morphism:
       From: Number Field in a with defining polynomial y^2 - 2
       To:   Algebraic Real Field
       Defn: a |--> 1.414213562373095?)
```

This is in the tests section and the explanation given is exactly a situation that we have to outsmart when we want to be able to accept cyclotomic fields elements to be parsed to real embedded number fields.

It seems to me that the proposed code improves the situation as Sage now recognize that it is a real number... I can not see a reason right now to go against that. Am I missing something?



---

archive/issue_events_282392.json:
```json
{
    "actor": "https://github.com/jplab",
    "created_at": "2018-04-09T16:00:51Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20181#event-282392"
}
```



---

archive/issue_events_282393.json:
```json
{
    "actor": "https://github.com/jplab",
    "created_at": "2018-04-09T16:00:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20181#event-282393"
}
```



---

archive/issue_comments_289987.json:
```json
{
    "body": "Changed keywords from none to **IMA-PolyGeom**",
    "created_at": "2018-04-10T23:31:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20181#issuecomment-289987",
    "user": "https://github.com/jplab"
}
```

Changed keywords from none to **IMA-PolyGeom**



---

archive/issue_events_282394.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2018-04-13T15:50:35Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "milestone_number": null,
    "milestone_title": "sage-7.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20181#event-282394"
}
```



---

archive/issue_events_282395.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2018-04-13T15:50:35Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "milestone_number": null,
    "milestone_title": "sage-8.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20181#event-282395"
}
```



---

archive/issue_comments_289988.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nModifying the test in comment 19 looks OK to me, but perhaps John can confirm I'm not missing anything...",
    "created_at": "2018-04-13T16:27:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20181#issuecomment-289988",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:23" align="right">comment:23</div>

Modifying the test in comment 19 looks OK to me, but perhaps John can confirm I'm not missing anything...



---

archive/issue_comments_289989.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nYou should just go on and fix the doctest, I think.",
    "created_at": "2018-04-15T19:42:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20181#issuecomment-289989",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:24" align="right">comment:24</div>

You should just go on and fix the doctest, I think.



---

archive/issue_comments_289990.json:
```json
{
    "body": "Reviewer: **Matthias Koeppe**",
    "created_at": "2018-04-16T09:18:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20181#issuecomment-289990",
    "user": "https://github.com/mkoeppe"
}
```

Reviewer: **Matthias Koeppe**



---

archive/issue_comments_289991.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\n`as_number_field_element` needs to pass on its new arguments, and corresponding doctests should be added.",
    "created_at": "2018-04-16T09:18:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20181#issuecomment-289991",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:25" align="right">comment:25</div>

`as_number_field_element` needs to pass on its new arguments, and corresponding doctests should be added.



---

archive/issue_events_282396.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2018-04-16T09:18:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20181#event-282396"
}
```



---

archive/issue_events_282397.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2018-04-16T09:18:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20181#event-282397"
}
```



---

archive/issue_comments_289992.json:
```json
{
    "body": "Changed commit from **[`a9045bf`](https://github.com/sagemath/sagetrac-mirror/commit/a9045bf8a3aab2d0aa00be17e91227bc1b50262a)** to **[`60c527f`](https://github.com/sagemath/sagetrac-mirror/commit/60c527f8ef3f2ed7bb75220fceeb532ff7096120)**",
    "created_at": "2018-09-15T06:29:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20181#issuecomment-289992",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`a9045bf`](https://github.com/sagemath/sagetrac-mirror/commit/a9045bf8a3aab2d0aa00be17e91227bc1b50262a)** to **[`60c527f`](https://github.com/sagemath/sagetrac-mirror/commit/60c527f8ef3f2ed7bb75220fceeb532ff7096120)**



---

archive/issue_comments_289993.json:
```json
{
    "body": "<div id=\"comment:26\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/60c527f8ef3f2ed7bb75220fceeb532ff7096120\"><code>60c527f</code></a></td><td><code>Merge remote-tracking branch 'trac/develop' into t/20181/public/algnum_to_numberfield</code></td></tr></table>\n",
    "created_at": "2018-09-15T06:29:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20181#issuecomment-289993",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:26"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/60c527f8ef3f2ed7bb75220fceeb532ff7096120"><code>60c527f</code></a></td><td><code>Merge remote-tracking branch 'trac/develop' into t/20181/public/algnum_to_numberfield</code></td></tr></table>




---

archive/issue_comments_289994.json:
```json
{
    "body": "<div id=\"comment:27\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f1627e7a51c74327cfb91e37eaecadd6b3aee173\"><code>f1627e7</code></a></td><td><code>AlgebraicNumber_base.as_number_field_element: Pass new kwargs to number_field_elements_from_algebraics</code></td></tr></table>\n",
    "created_at": "2018-09-15T06:52:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20181#issuecomment-289994",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:27"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f1627e7a51c74327cfb91e37eaecadd6b3aee173"><code>f1627e7</code></a></td><td><code>AlgebraicNumber_base.as_number_field_element: Pass new kwargs to number_field_elements_from_algebraics</code></td></tr></table>




---

archive/issue_comments_289995.json:
```json
{
    "body": "Changed commit from **[`60c527f`](https://github.com/sagemath/sagetrac-mirror/commit/60c527f8ef3f2ed7bb75220fceeb532ff7096120)** to **[`f1627e7`](https://github.com/sagemath/sagetrac-mirror/commit/f1627e7a51c74327cfb91e37eaecadd6b3aee173)**",
    "created_at": "2018-09-15T06:52:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20181#issuecomment-289995",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`60c527f`](https://github.com/sagemath/sagetrac-mirror/commit/60c527f8ef3f2ed7bb75220fceeb532ff7096120)** to **[`f1627e7`](https://github.com/sagemath/sagetrac-mirror/commit/f1627e7a51c74327cfb91e37eaecadd6b3aee173)**



---

archive/issue_comments_289996.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\n... still needs a corresponding doctest",
    "created_at": "2018-09-15T06:53:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20181#issuecomment-289996",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:28" align="right">comment:28</div>

... still needs a corresponding doctest



---

archive/issue_comments_289997.json:
```json
{
    "body": "<div id=\"comment:29\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d7e31a226abe0af44fc3300d234d61239a1b6766\"><code>d7e31a2</code></a></td><td><code>AlgebraicNumber_base.as_number_field_element: Add doctest</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/284c2172e1b6be10387ab3a15aad957be466bc86\"><code>284c217</code></a></td><td><code>Merge remote-tracking branch 'trac/develop' into t/20181/public/algnum_to_numberfield</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/41b1142066d3c718006ee3363d41f4367949bc03\"><code>41b1142</code></a></td><td><code>AlgebraicNumber_base.as_number_field_element: Add doctests (currently failing)</code></td></tr></table>\n",
    "created_at": "2018-09-16T00:20:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20181#issuecomment-289997",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:29"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d7e31a226abe0af44fc3300d234d61239a1b6766"><code>d7e31a2</code></a></td><td><code>AlgebraicNumber_base.as_number_field_element: Add doctest</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/284c2172e1b6be10387ab3a15aad957be466bc86"><code>284c217</code></a></td><td><code>Merge remote-tracking branch 'trac/develop' into t/20181/public/algnum_to_numberfield</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/41b1142066d3c718006ee3363d41f4367949bc03"><code>41b1142</code></a></td><td><code>AlgebraicNumber_base.as_number_field_element: Add doctests (currently failing)</code></td></tr></table>




---

archive/issue_comments_289998.json:
```json
{
    "body": "Changed commit from **[`f1627e7`](https://github.com/sagemath/sagetrac-mirror/commit/f1627e7a51c74327cfb91e37eaecadd6b3aee173)** to **[`41b1142`](https://github.com/sagemath/sagetrac-mirror/commit/41b1142066d3c718006ee3363d41f4367949bc03)**",
    "created_at": "2018-09-16T00:20:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20181#issuecomment-289998",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`f1627e7`](https://github.com/sagemath/sagetrac-mirror/commit/f1627e7a51c74327cfb91e37eaecadd6b3aee173)** to **[`41b1142`](https://github.com/sagemath/sagetrac-mirror/commit/41b1142066d3c718006ee3363d41f4367949bc03)**



---

archive/issue_comments_289999.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nI've added some doctests, but the implementation needs more work as there are failures.",
    "created_at": "2018-09-16T00:21:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20181#issuecomment-289999",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:30" align="right">comment:30</div>

I've added some doctests, but the implementation needs more work as there are failures.



---

archive/issue_comments_290000.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -15,8 +15,16 @@\n sage: x = polygen(ZZ)\n sage: K, cbrt2, hom = number_field_elements_from_algebraics(AA.polynomial_root(x^3-2, RIF(0,3)))\n sage: 6064/4813 < cbrt2 < 90325/71691\n-False\n+False            # (an perhaps an error in Python 3?)\n ```\n \n-It would be nice to have `number_field_elements_from_algebraics` construct embedded ones, either by default, or by some option.\n+This ticket adds an option `embedded` to create embedded number field elements.\n \n+```\n+sage: x = polygen(ZZ)\n+sage: K, cbrt2, hom = number_field_elements_from_algebraics(AA.polynomial_root(x^3-2, RIF(0,3)), embedded=True)\n+sage: 6064/4813 < cbrt2 < 90325/71691\n+True\n+```\n+\n+\n``````\n",
    "created_at": "2018-09-16T00:26:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20181#issuecomment-290000",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -15,8 +15,16 @@
 sage: x = polygen(ZZ)
 sage: K, cbrt2, hom = number_field_elements_from_algebraics(AA.polynomial_root(x^3-2, RIF(0,3)))
 sage: 6064/4813 < cbrt2 < 90325/71691
-False
+False            # (an perhaps an error in Python 3?)
 ```
 
-It would be nice to have `number_field_elements_from_algebraics` construct embedded ones, either by default, or by some option.
+This ticket adds an option `embedded` to create embedded number field elements.
 
+```
+sage: x = polygen(ZZ)
+sage: K, cbrt2, hom = number_field_elements_from_algebraics(AA.polynomial_root(x^3-2, RIF(0,3)), embedded=True)
+sage: 6064/4813 < cbrt2 < 90325/71691
+True
+```
+
+
``````




---

archive/issue_events_282398.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2018-09-16T00:26:17Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "milestone_number": null,
    "milestone_title": "sage-8.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20181#event-282398"
}
```



---

archive/issue_events_282399.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2018-09-16T00:26:17Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "milestone_number": null,
    "milestone_title": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20181#event-282399"
}
```



---

archive/issue_comments_290001.json:
```json
{
    "body": "<div id=\"comment:32\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2eb332053089cccf9266850d2fbd964a3c24b9fe\"><code>2eb3320</code></a></td><td><code>number_field_elements_from_algebraics: Mark a random doctest # random</code></td></tr></table>\n",
    "created_at": "2018-09-16T00:30:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20181#issuecomment-290001",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:32"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2eb332053089cccf9266850d2fbd964a3c24b9fe"><code>2eb3320</code></a></td><td><code>number_field_elements_from_algebraics: Mark a random doctest # random</code></td></tr></table>




---

archive/issue_comments_290002.json:
```json
{
    "body": "Changed commit from **[`41b1142`](https://github.com/sagemath/sagetrac-mirror/commit/41b1142066d3c718006ee3363d41f4367949bc03)** to **[`2eb3320`](https://github.com/sagemath/sagetrac-mirror/commit/2eb332053089cccf9266850d2fbd964a3c24b9fe)**",
    "created_at": "2018-09-16T00:30:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20181#issuecomment-290002",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`41b1142`](https://github.com/sagemath/sagetrac-mirror/commit/41b1142066d3c718006ee3363d41f4367949bc03)** to **[`2eb3320`](https://github.com/sagemath/sagetrac-mirror/commit/2eb332053089cccf9266850d2fbd964a3c24b9fe)**



---

archive/issue_comments_290003.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nReplying to [@dimpase](#comment%3A23):\n> Modifying the test in comment 19 looks OK to me, but perhaps John can confirm I'm not missing anything...\n\nThe context of this doctest suggested that it should be marked `# random`, which I did in 2eb3320.",
    "created_at": "2018-09-16T00:31:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20181#issuecomment-290003",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:33" align="right">comment:33</div>

Replying to [@dimpase](#comment%3A23):
> Modifying the test in comment 19 looks OK to me, but perhaps John can confirm I'm not missing anything...

The context of this doctest suggested that it should be marked `# random`, which I did in 2eb3320.



---

archive/issue_comments_290004.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nReady for re-review?\n\nSome quick comments. It is considered a bad practice to have bare `except:` statements. It is probably sufficient to catch `ValueError` and `TypeError`. Also, the standard doc format for `INPUT:` would be\n\n```\n    - ``numbers`` -- a number or list of numbers\n\n    - ``minimal`` -- boolean (default: ``False``); whether to minimize the\n      degree of the extension\n\n    - ``same_field`` -- boolean (default: ``False``); see below\n\n    - ``embedded`` -- boolean (default: ``False``); whether to make the\n      :func:`NumberField` embedded\n\n    - ``prec`` -- integer (default: ``53``); the number of bit of precision for\n      the embedding\n```\n\n```\n        - ``minimal`` -- boolean (default: ``False``); whether to minimize the\n          degree of the extension\n\n        - ``embedded`` -- boolean (default: ``False``); whether to make the\n          :func:`NumberField` embedded\n    \n        - ``prec`` -- integer (default: ``53``); the number of bit of precision for\n          the embedding\n```",
    "created_at": "2018-09-16T00:53:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20181#issuecomment-290004",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:34" align="right">comment:34</div>

Ready for re-review?

Some quick comments. It is considered a bad practice to have bare `except:` statements. It is probably sufficient to catch `ValueError` and `TypeError`. Also, the standard doc format for `INPUT:` would be

```
    - ``numbers`` -- a number or list of numbers

    - ``minimal`` -- boolean (default: ``False``); whether to minimize the
      degree of the extension

    - ``same_field`` -- boolean (default: ``False``); see below

    - ``embedded`` -- boolean (default: ``False``); whether to make the
      :func:`NumberField` embedded

    - ``prec`` -- integer (default: ``53``); the number of bit of precision for
      the embedding
```

```
        - ``minimal`` -- boolean (default: ``False``); whether to minimize the
          degree of the extension

        - ``embedded`` -- boolean (default: ``False``); whether to make the
          :func:`NumberField` embedded
    
        - ``prec`` -- integer (default: ``53``); the number of bit of precision for
          the embedding
```



---

archive/issue_comments_290005.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nNot ready for review; this needs more work -- see the failing doctests that I added in 41b1142.",
    "created_at": "2018-09-16T01:49:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20181#issuecomment-290005",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:35" align="right">comment:35</div>

Not ready for review; this needs more work -- see the failing doctests that I added in 41b1142.



---

archive/issue_comments_290006.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nReplying to [@mkoeppe](#comment%3A35):\n> Not ready for review; this needs more work -- see the failing doctests that I added in 41b1142.\n\nFor reference: These are the doctest failures. \n\n```\n$ sage -t src/sage/rings/qqbar.py \ntoo many failed tests, not using stored timings\nRunning doctests with ID 2018-09-27-16-59-10-65572ec7.\nUsing --optional=4ti2,bliss,ccache,dochtml,gdb,latte_int,lidia,lrslib,mpir,normaliz,notedown,pandoc_attributes,pynormaliz,pyqnormaliz,python2,rst2ipynb,sage\nDoctesting 1 file.\nsage -t src/sage/rings/qqbar.py\n**********************************************************************\nFile \"src/sage/rings/qqbar.py\", line 3696, in sage.rings.qqbar.AlgebraicNumber_base.as_number_field_element\nFailed example:\n    elt == rt\nExpected:\n    True\nGot:\n    False\n**********************************************************************\nFile \"src/sage/rings/qqbar.py\", line 3698, in sage.rings.qqbar.AlgebraicNumber_base.as_number_field_element\nFailed example:\n    AA(elt)\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/mkoeppe/s/sage/sage-rebasing/worktree-clean/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 659, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/Users/mkoeppe/s/sage/sage-rebasing/worktree-clean/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 1070, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.rings.qqbar.AlgebraicNumber_base.as_number_field_element[12]>\", line 1, in <module>\n        AA(elt)\n      File \"sage/structure/parent.pyx\", line 921, in sage.structure.parent.Parent.__call__ (build/cythonized/sage/structure/parent.c:9679)\n        return mor._call_(x)\n      File \"sage/structure/coerce_maps.pyx\", line 145, in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4574)\n        raise\n      File \"sage/structure/coerce_maps.pyx\", line 140, in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4442)\n        return C._element_constructor(x)\n      File \"/Users/mkoeppe/s/sage/sage-rebasing/worktree-clean/local/lib/python2.7/site-packages/sage/rings/qqbar.py\", line 738, in _element_constructor_\n        return x._algebraic_(AA)\n      File \"sage/rings/number_field/number_field_element.pyx\", line 2709, in sage.rings.number_field.number_field_element.NumberFieldElement._algebraic_ (build/cythonized/sage/rings/number_field/number_field_element.cpp:26930)\n        emb = refine_embedding(emb, infinity)\n      File \"/Users/mkoeppe/s/sage/sage-rebasing/worktree-clean/local/lib/python2.7/site-packages/sage/rings/number_field/number_field.py\", line 11329, in refine_embedding\n        diffs = [(RC(ee(K.gen()))-old_root).abs() for ee in elist]\n      File \"sage/rings/real_mpfi.pyx\", line 699, in sage.rings.real_mpfi.RealIntervalField_class.__call__ (build/cythonized/sage/rings/real_mpfi.c:6094)\n        return Parent.__call__(self, x)\n      File \"sage/structure/parent.pyx\", line 921, in sage.structure.parent.Parent.__call__ (build/cythonized/sage/structure/parent.c:9679)\n        return mor._call_(x)\n      File \"sage/structure/coerce_maps.pyx\", line 271, in sage.structure.coerce_maps.NamedConvertMap._call_ (build/cythonized/sage/structure/coerce_maps.c:5999)\n        cdef Element e = method(C)\n      File \"/Users/mkoeppe/s/sage/sage-rebasing/worktree-clean/local/lib/python2.7/site-packages/sage/rings/qqbar.py\", line 4007, in interval\n        raise TypeError(\"unable to convert {} to real interval\".format(self))\n    TypeError: unable to convert -2.618826569900552? - 0.2237500597843041?*I to real interval\n**********************************************************************\nFile \"src/sage/rings/qqbar.py\", line 3700, in sage.rings.qqbar.AlgebraicNumber_base.as_number_field_element\nFailed example:\n    RR(elt)\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/mkoeppe/s/sage/sage-rebasing/worktree-clean/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 659, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/Users/mkoeppe/s/sage/sage-rebasing/worktree-clean/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 1070, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.rings.qqbar.AlgebraicNumber_base.as_number_field_element[13]>\", line 1, in <module>\n        RR(elt)\n      File \"sage/structure/parent.pyx\", line 921, in sage.structure.parent.Parent.__call__ (build/cythonized/sage/structure/parent.c:9679)\n        return mor._call_(x)\n      File \"sage/structure/coerce_maps.pyx\", line 271, in sage.structure.coerce_maps.NamedConvertMap._call_ (build/cythonized/sage/structure/coerce_maps.c:5993)\n        cdef Element e = method(C)\n      File \"sage/rings/number_field/number_field_element.pyx\", line 1802, in sage.rings.number_field.number_field_element.NumberFieldElement._mpfr_ (build/cythonized/sage/rings/number_field/number_field_element.cpp:19625)\n        return R(R.complex_field()(self))\n      File \"/Users/mkoeppe/s/sage/sage-rebasing/worktree-clean/local/lib/python2.7/site-packages/sage/rings/complex_field.py\", line 381, in __call__\n        return Parent.__call__(self, x)\n      File \"sage/structure/parent.pyx\", line 921, in sage.structure.parent.Parent.__call__ (build/cythonized/sage/structure/parent.c:9679)\n        return mor._call_(x)\n      File \"sage/structure/coerce_maps.pyx\", line 145, in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4574)\n        raise\n      File \"sage/structure/coerce_maps.pyx\", line 140, in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4442)\n        return C._element_constructor(x)\n      File \"/Users/mkoeppe/s/sage/sage-rebasing/worktree-clean/local/lib/python2.7/site-packages/sage/rings/complex_field.py\", line 423, in _element_constructor_\n        return ComplexNumber(self, x)\n      File \"sage/rings/complex_number.pyx\", line 200, in sage.rings.complex_number.ComplexNumber.__init__ (build/cythonized/sage/rings/complex_number.c:4535)\n        rr = R(real)\n      File \"sage/structure/parent.pyx\", line 921, in sage.structure.parent.Parent.__call__ (build/cythonized/sage/structure/parent.c:9679)\n        return mor._call_(x)\n      File \"sage/structure/coerce_maps.pyx\", line 271, in sage.structure.coerce_maps.NamedConvertMap._call_ (build/cythonized/sage/structure/coerce_maps.c:5993)\n        cdef Element e = method(C)\n      File \"sage/rings/number_field/number_field_element.pyx\", line 1802, in sage.rings.number_field.number_field_element.NumberFieldElement._mpfr_ (build/cythonized/sage/rings/number_field/number_field_element.cpp:19625)\n        return R(R.complex_field()(self))\n      File \"/Users/mkoeppe/s/sage/sage-rebasing/worktree-clean/local/lib/python2.7/site-packages/sage/rings/complex_field.py\", line 381, in __call__\n        return Parent.__call__(self, x)\n      File \"sage/structure/parent.pyx\", line 921, in sage.structure.parent.Parent.__call__ (build/cythonized/sage/structure/parent.c:9679)\n        return mor._call_(x)\n      File \"sage/structure/coerce_maps.pyx\", line 145, in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4574)\n        raise\n      File \"sage/structure/coerce_maps.pyx\", line 140, in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4442)\n.....................\n      File \"sage/categories/map.pyx\", line 176, in sage.categories.map.Map.__copy__ (build/cythonized/sage/categories/map.c:4133)\n        cdef Map out = Element.__copy__(self)\n      File \"sage/structure/element.pyx\", line 605, in sage.structure.element.Element.__copy__ (build/cythonized/sage/structure/element.c:5273)\n        D = self.__dict__\n      File \"sage/structure/element.pyx\", line 493, in sage.structure.element.Element.__getattr__ (build/cythonized/sage/structure/element.c:4550)\n        return self.getattr_from_category(name)\n      File \"sage/structure/element.pyx\", line 506, in sage.structure.element.Element.getattr_from_category (build/cythonized/sage/structure/element.c:4659)\n        return getattr_from_other_class(self, cls, name)\n      File \"sage/cpython/getattr.pyx\", line 386, in sage.cpython.getattr.getattr_from_other_class (build/cythonized/sage/cpython/getattr.c:2428)\n        if isinstance(self, cls):\n    RuntimeError: maximum recursion depth exceeded while calling a Python object\n**********************************************************************\n1 item had failures:\n   3 of  21 in sage.rings.qqbar.AlgebraicNumber_base.as_number_field_element\n    [1438 tests, 3 failures, 14.69 s]\n----------------------------------------------------------------------\nsage -t src/sage/rings/qqbar.py  # 3 doctests failed\n----------------------------------------------------------------------\n```\nFor the infinite recursion in the last failure, perhaps could someone experienced with the Sage coercion system help?",
    "created_at": "2018-09-28T00:04:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20181#issuecomment-290006",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:36" align="right">comment:36</div>

Replying to [@mkoeppe](#comment%3A35):
> Not ready for review; this needs more work -- see the failing doctests that I added in 41b1142.

For reference: These are the doctest failures. 

```
$ sage -t src/sage/rings/qqbar.py 
too many failed tests, not using stored timings
Running doctests with ID 2018-09-27-16-59-10-65572ec7.
Using --optional=4ti2,bliss,ccache,dochtml,gdb,latte_int,lidia,lrslib,mpir,normaliz,notedown,pandoc_attributes,pynormaliz,pyqnormaliz,python2,rst2ipynb,sage
Doctesting 1 file.
sage -t src/sage/rings/qqbar.py
**********************************************************************
File "src/sage/rings/qqbar.py", line 3696, in sage.rings.qqbar.AlgebraicNumber_base.as_number_field_element
Failed example:
    elt == rt
Expected:
    True
Got:
    False
**********************************************************************
File "src/sage/rings/qqbar.py", line 3698, in sage.rings.qqbar.AlgebraicNumber_base.as_number_field_element
Failed example:
    AA(elt)
Exception raised:
    Traceback (most recent call last):
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-clean/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 659, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-clean/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1070, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.rings.qqbar.AlgebraicNumber_base.as_number_field_element[12]>", line 1, in <module>
        AA(elt)
      File "sage/structure/parent.pyx", line 921, in sage.structure.parent.Parent.__call__ (build/cythonized/sage/structure/parent.c:9679)
        return mor._call_(x)
      File "sage/structure/coerce_maps.pyx", line 145, in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4574)
        raise
      File "sage/structure/coerce_maps.pyx", line 140, in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4442)
        return C._element_constructor(x)
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-clean/local/lib/python2.7/site-packages/sage/rings/qqbar.py", line 738, in _element_constructor_
        return x._algebraic_(AA)
      File "sage/rings/number_field/number_field_element.pyx", line 2709, in sage.rings.number_field.number_field_element.NumberFieldElement._algebraic_ (build/cythonized/sage/rings/number_field/number_field_element.cpp:26930)
        emb = refine_embedding(emb, infinity)
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-clean/local/lib/python2.7/site-packages/sage/rings/number_field/number_field.py", line 11329, in refine_embedding
        diffs = [(RC(ee(K.gen()))-old_root).abs() for ee in elist]
      File "sage/rings/real_mpfi.pyx", line 699, in sage.rings.real_mpfi.RealIntervalField_class.__call__ (build/cythonized/sage/rings/real_mpfi.c:6094)
        return Parent.__call__(self, x)
      File "sage/structure/parent.pyx", line 921, in sage.structure.parent.Parent.__call__ (build/cythonized/sage/structure/parent.c:9679)
        return mor._call_(x)
      File "sage/structure/coerce_maps.pyx", line 271, in sage.structure.coerce_maps.NamedConvertMap._call_ (build/cythonized/sage/structure/coerce_maps.c:5999)
        cdef Element e = method(C)
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-clean/local/lib/python2.7/site-packages/sage/rings/qqbar.py", line 4007, in interval
        raise TypeError("unable to convert {} to real interval".format(self))
    TypeError: unable to convert -2.618826569900552? - 0.2237500597843041?*I to real interval
**********************************************************************
File "src/sage/rings/qqbar.py", line 3700, in sage.rings.qqbar.AlgebraicNumber_base.as_number_field_element
Failed example:
    RR(elt)
Exception raised:
    Traceback (most recent call last):
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-clean/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 659, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-clean/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1070, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.rings.qqbar.AlgebraicNumber_base.as_number_field_element[13]>", line 1, in <module>
        RR(elt)
      File "sage/structure/parent.pyx", line 921, in sage.structure.parent.Parent.__call__ (build/cythonized/sage/structure/parent.c:9679)
        return mor._call_(x)
      File "sage/structure/coerce_maps.pyx", line 271, in sage.structure.coerce_maps.NamedConvertMap._call_ (build/cythonized/sage/structure/coerce_maps.c:5993)
        cdef Element e = method(C)
      File "sage/rings/number_field/number_field_element.pyx", line 1802, in sage.rings.number_field.number_field_element.NumberFieldElement._mpfr_ (build/cythonized/sage/rings/number_field/number_field_element.cpp:19625)
        return R(R.complex_field()(self))
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-clean/local/lib/python2.7/site-packages/sage/rings/complex_field.py", line 381, in __call__
        return Parent.__call__(self, x)
      File "sage/structure/parent.pyx", line 921, in sage.structure.parent.Parent.__call__ (build/cythonized/sage/structure/parent.c:9679)
        return mor._call_(x)
      File "sage/structure/coerce_maps.pyx", line 145, in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4574)
        raise
      File "sage/structure/coerce_maps.pyx", line 140, in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4442)
        return C._element_constructor(x)
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-clean/local/lib/python2.7/site-packages/sage/rings/complex_field.py", line 423, in _element_constructor_
        return ComplexNumber(self, x)
      File "sage/rings/complex_number.pyx", line 200, in sage.rings.complex_number.ComplexNumber.__init__ (build/cythonized/sage/rings/complex_number.c:4535)
        rr = R(real)
      File "sage/structure/parent.pyx", line 921, in sage.structure.parent.Parent.__call__ (build/cythonized/sage/structure/parent.c:9679)
        return mor._call_(x)
      File "sage/structure/coerce_maps.pyx", line 271, in sage.structure.coerce_maps.NamedConvertMap._call_ (build/cythonized/sage/structure/coerce_maps.c:5993)
        cdef Element e = method(C)
      File "sage/rings/number_field/number_field_element.pyx", line 1802, in sage.rings.number_field.number_field_element.NumberFieldElement._mpfr_ (build/cythonized/sage/rings/number_field/number_field_element.cpp:19625)
        return R(R.complex_field()(self))
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-clean/local/lib/python2.7/site-packages/sage/rings/complex_field.py", line 381, in __call__
        return Parent.__call__(self, x)
      File "sage/structure/parent.pyx", line 921, in sage.structure.parent.Parent.__call__ (build/cythonized/sage/structure/parent.c:9679)
        return mor._call_(x)
      File "sage/structure/coerce_maps.pyx", line 145, in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4574)
        raise
      File "sage/structure/coerce_maps.pyx", line 140, in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4442)
.....................
      File "sage/categories/map.pyx", line 176, in sage.categories.map.Map.__copy__ (build/cythonized/sage/categories/map.c:4133)
        cdef Map out = Element.__copy__(self)
      File "sage/structure/element.pyx", line 605, in sage.structure.element.Element.__copy__ (build/cythonized/sage/structure/element.c:5273)
        D = self.__dict__
      File "sage/structure/element.pyx", line 493, in sage.structure.element.Element.__getattr__ (build/cythonized/sage/structure/element.c:4550)
        return self.getattr_from_category(name)
      File "sage/structure/element.pyx", line 506, in sage.structure.element.Element.getattr_from_category (build/cythonized/sage/structure/element.c:4659)
        return getattr_from_other_class(self, cls, name)
      File "sage/cpython/getattr.pyx", line 386, in sage.cpython.getattr.getattr_from_other_class (build/cythonized/sage/cpython/getattr.c:2428)
        if isinstance(self, cls):
    RuntimeError: maximum recursion depth exceeded while calling a Python object
**********************************************************************
1 item had failures:
   3 of  21 in sage.rings.qqbar.AlgebraicNumber_base.as_number_field_element
    [1438 tests, 3 failures, 14.69 s]
----------------------------------------------------------------------
sage -t src/sage/rings/qqbar.py  # 3 doctests failed
----------------------------------------------------------------------
```
For the infinite recursion in the last failure, perhaps could someone experienced with the Sage coercion system help?



---

archive/issue_comments_290007.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nSo I think I know what is going wrong. The issue is that there is no coercion from `RIF -> RR`; it goes the other way around. So with these changes, I can avoid the infinite recursion with `RR(elt)`, but I get other failures:\n\n```diff\ndiff --git a/src/sage/rings/qqbar.py b/src/sage/rings/qqbar.py\nindex b32aa1a..7453d89 100644\n--- a/src/sage/rings/qqbar.py\n+++ b/src/sage/rings/qqbar.py\n@@ -2197,10 +2197,11 @@ def number_field_elements_from_algebraics(numbers, minimal=False, same_field=False, embedded=False, prec=53):\n \n     # Make the numbers have a real root\n     real_numbers = []\n+    from sage.rings.real_mpfr import RealField\n     for v in numbers:\n         if v._exact_field().is_complex() and real_case:\n             # the number comes from a complex algebraic number field\n-            embedded_rt = v.interval_fast(RealIntervalField(prec))\n+            embedded_rt = v.interval_fast(RealField(prec))\n             root = ANRoot(v.minpoly(), embedded_rt)\n             real_nf = NumberField(v.minpoly(),'a')\n             new_ef = AlgebraicGenerator(real_nf, root)\n@@ -2223,10 +2224,9 @@ def number_field_elements_from_algebraics(numbers, minimal=False, same_field=False, embedded=False, prec=53):\n     if fld is not QQ and embedded:\n         assert real_case\n         exact_generator = hom(fld.gen(0))\n-        embedding_field = RealIntervalField(prec)\n+        embedding_field = RealField(prec)\n         embedded_gen = embedding_field(exact_generator)\n         embedded_field = NumberField(fld.defining_polynomial(),fld.variable_name(),embedding=embedded_gen)\n-        \n         inter_hom = fld.hom([embedded_field.gen(0)])\n         nums = map(inter_hom, nums)\n         hom = embedded_field.hom([gen.root_as_algebraic()])\n```\nNote that with your current branch, the replacement of the `RR(elt)` by `RIF(elt)` works.\n\nThe reason you get the infinite recursion is somewhere in the number field coercion (conversion?)( code, it is trying to construct a complex number, which then tries to create the `RR`, but it cannot do that, so it tried to construct a number field element, and hence the cycle. Or something like that. The reason it normally doesn't cycle is because it separately knows how to get the the information it needs (if it even falls into this cycle). I don't completely understand the mechanism, but this is what the traceback is suggesting to me.",
    "created_at": "2018-09-28T23:29:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20181#issuecomment-290007",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:37" align="right">comment:37</div>

So I think I know what is going wrong. The issue is that there is no coercion from `RIF -> RR`; it goes the other way around. So with these changes, I can avoid the infinite recursion with `RR(elt)`, but I get other failures:

```diff
diff --git a/src/sage/rings/qqbar.py b/src/sage/rings/qqbar.py
index b32aa1a..7453d89 100644
--- a/src/sage/rings/qqbar.py
+++ b/src/sage/rings/qqbar.py
@@ -2197,10 +2197,11 @@ def number_field_elements_from_algebraics(numbers, minimal=False, same_field=False, embedded=False, prec=53):
 
     # Make the numbers have a real root
     real_numbers = []
+    from sage.rings.real_mpfr import RealField
     for v in numbers:
         if v._exact_field().is_complex() and real_case:
             # the number comes from a complex algebraic number field
-            embedded_rt = v.interval_fast(RealIntervalField(prec))
+            embedded_rt = v.interval_fast(RealField(prec))
             root = ANRoot(v.minpoly(), embedded_rt)
             real_nf = NumberField(v.minpoly(),'a')
             new_ef = AlgebraicGenerator(real_nf, root)
@@ -2223,10 +2224,9 @@ def number_field_elements_from_algebraics(numbers, minimal=False, same_field=False, embedded=False, prec=53):
     if fld is not QQ and embedded:
         assert real_case
         exact_generator = hom(fld.gen(0))
-        embedding_field = RealIntervalField(prec)
+        embedding_field = RealField(prec)
         embedded_gen = embedding_field(exact_generator)
         embedded_field = NumberField(fld.defining_polynomial(),fld.variable_name(),embedding=embedded_gen)
-        
         inter_hom = fld.hom([embedded_field.gen(0)])
         nums = map(inter_hom, nums)
         hom = embedded_field.hom([gen.root_as_algebraic()])
```
Note that with your current branch, the replacement of the `RR(elt)` by `RIF(elt)` works.

The reason you get the infinite recursion is somewhere in the number field coercion (conversion?)( code, it is trying to construct a complex number, which then tries to create the `RR`, but it cannot do that, so it tried to construct a number field element, and hence the cycle. Or something like that. The reason it normally doesn't cycle is because it separately knows how to get the the information it needs (if it even falls into this cycle). I don't completely understand the mechanism, but this is what the traceback is suggesting to me.



---

archive/issue_comments_290008.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nReplying to [@tscrim](#comment%3A37):\n> So I think I know what is going wrong. The issue is that there is no coercion from `RIF -> RR`; it goes the other way around.\n\nNote that #15114 is for removing this coercion, but is currently blocked by more or less the same issues with comparisons between elements of different parents that need to be solved for the Python\u00a03 transition.",
    "created_at": "2018-09-29T07:55:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20181#issuecomment-290008",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:38" align="right">comment:38</div>

Replying to [@tscrim](#comment%3A37):
> So I think I know what is going wrong. The issue is that there is no coercion from `RIF -> RR`; it goes the other way around.

Note that #15114 is for removing this coercion, but is currently blocked by more or less the same issues with comparisons between elements of different parents that need to be solved for the PythonÂ 3 transition.



---

archive/issue_comments_290009.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -27,4 +27,6 @@\n True\n ```\n \n+TODECIDE:\n \n+- Close ticket #5355?\n``````\n",
    "created_at": "2019-03-13T09:48:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20181#issuecomment-290009",
    "user": "https://github.com/jplab"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -27,4 +27,6 @@
 True
 ```
 
+TODECIDE:
 
+- Close ticket #5355?
``````




---

archive/issue_comments_290010.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nJust as a summary here are things that need to be done (maybe some of them are already done):\n\n- you may want to patch `as_number_field_element()` too,\n- don't forget to add tests covering the case where some or all of the elements are rationals or elements of quadratic extensions (rationals, quadratic number field elements and higher-degree number field elements don't have exactly the same interface...) \n- Fix doctest in File \"qqbar.py\", line 2098, in sage.rings.qqbar.number_field_elements_from_algebraics\n- `as_number_field_element` needs to pass on its new arguments, and corresponding doctests should be added. \n- Fix Comment 34 and Comment 36.",
    "created_at": "2019-03-14T09:06:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20181#issuecomment-290010",
    "user": "https://github.com/jplab"
}
```

<div id="comment:40" align="right">comment:40</div>

Just as a summary here are things that need to be done (maybe some of them are already done):

- you may want to patch `as_number_field_element()` too,
- don't forget to add tests covering the case where some or all of the elements are rationals or elements of quadratic extensions (rationals, quadratic number field elements and higher-degree number field elements don't have exactly the same interface...) 
- Fix doctest in File "qqbar.py", line 2098, in sage.rings.qqbar.number_field_elements_from_algebraics
- `as_number_field_element` needs to pass on its new arguments, and corresponding doctests should be added. 
- Fix Comment 34 and Comment 36.



---

archive/issue_comments_290011.json:
```json
{
    "body": "Changed commit from **[`2eb3320`](https://github.com/sagemath/sagetrac-mirror/commit/2eb332053089cccf9266850d2fbd964a3c24b9fe)** to **[`5793bcf`](https://github.com/sagemath/sagetrac-mirror/commit/5793bcfce6f66f5740fce05c4d89c1587eaee872)**",
    "created_at": "2019-04-17T07:42:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20181#issuecomment-290011",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`2eb3320`](https://github.com/sagemath/sagetrac-mirror/commit/2eb332053089cccf9266850d2fbd964a3c24b9fe)** to **[`5793bcf`](https://github.com/sagemath/sagetrac-mirror/commit/5793bcfce6f66f5740fce05c4d89c1587eaee872)**



---

archive/issue_comments_290012.json:
```json
{
    "body": "<div id=\"comment:41\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5793bcfce6f66f5740fce05c4d89c1587eaee872\"><code>5793bcf</code></a></td><td><code>Merge branch 'public/algnum_to_numberfield' of trac.sagemath.org:sage into 20181</code></td></tr></table>\n",
    "created_at": "2019-04-17T07:42:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20181#issuecomment-290012",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:41"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5793bcfce6f66f5740fce05c4d89c1587eaee872"><code>5793bcf</code></a></td><td><code>Merge branch 'public/algnum_to_numberfield' of trac.sagemath.org:sage into 20181</code></td></tr></table>




---

archive/issue_comments_290013.json:
```json
{
    "body": "<div id=\"comment:42\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5793bcfce6f66f5740fce05c4d89c1587eaee872\"><code>5793bcf</code></a></td><td><code>Merge branch 'public/algnum_to_numberfield' of trac.sagemath.org:sage into 20181</code></td></tr></table>\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5793bcfce6f66f5740fce05c4d89c1587eaee872\"><code>5793bcf</code></a></td><td><code>Merge branch 'public/algnum_to_numberfield' of trac.sagemath.org:sage into 20181</code></td></tr></table>\n",
    "created_at": "2019-04-17T07:42:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20181#issuecomment-290013",
    "user": "https://github.com/jplab"
}
```

<div id="comment:42"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5793bcfce6f66f5740fce05c4d89c1587eaee872"><code>5793bcf</code></a></td><td><code>Merge branch 'public/algnum_to_numberfield' of trac.sagemath.org:sage into 20181</code></td></tr></table>

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5793bcfce6f66f5740fce05c4d89c1587eaee872"><code>5793bcf</code></a></td><td><code>Merge branch 'public/algnum_to_numberfield' of trac.sagemath.org:sage into 20181</code></td></tr></table>




---

archive/issue_events_282400.json:
```json
{
    "actor": "https://github.com/jplab",
    "created_at": "2019-04-17T07:42:41Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "milestone_number": null,
    "milestone_title": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20181#event-282400"
}
```



---

archive/issue_events_282401.json:
```json
{
    "actor": "https://github.com/jplab",
    "created_at": "2019-04-17T07:42:41Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "milestone_number": null,
    "milestone_title": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20181#event-282401"
}
```



---

archive/issue_comments_290014.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nWhile rereading the docstring, I realized that it is quite confusing. Especially the following lines:\n\n```\n2154     Note that for the first example, where \\sage does not realize that \n2155     the number is real, we get a homomorphism to ``QQbar``; but with\n2156     ``minimal=True``, we get a homomorphism to ``AA``.  If we specify\n2157     both ``minimal=True`` and ``same_field=True``, we get a second\n2158     degree extension (minimal) that maps back to ``QQbar``.\n```",
    "created_at": "2019-04-17T08:00:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20181#issuecomment-290014",
    "user": "https://github.com/jplab"
}
```

<div id="comment:43" align="right">comment:43</div>

While rereading the docstring, I realized that it is quite confusing. Especially the following lines:

```
2154     Note that for the first example, where \sage does not realize that 
2155     the number is real, we get a homomorphism to ``QQbar``; but with
2156     ``minimal=True``, we get a homomorphism to ``AA``.  If we specify
2157     both ``minimal=True`` and ``same_field=True``, we get a second
2158     degree extension (minimal) that maps back to ``QQbar``.
```



---

archive/issue_comments_290015.json:
```json
{
    "body": "<div id=\"comment:44\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cb63fe51cda3ac27a67c297e9a05289b2911c865\"><code>cb63fe5</code></a></td><td><code>Added some doctest for embedded case</code></td></tr></table>\n",
    "created_at": "2019-04-22T08:49:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20181#issuecomment-290015",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:44"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cb63fe51cda3ac27a67c297e9a05289b2911c865"><code>cb63fe5</code></a></td><td><code>Added some doctest for embedded case</code></td></tr></table>




---

archive/issue_comments_290016.json:
```json
{
    "body": "Changed commit from **[`5793bcf`](https://github.com/sagemath/sagetrac-mirror/commit/5793bcfce6f66f5740fce05c4d89c1587eaee872)** to **[`cb63fe5`](https://github.com/sagemath/sagetrac-mirror/commit/cb63fe51cda3ac27a67c297e9a05289b2911c865)**",
    "created_at": "2019-04-22T08:49:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20181#issuecomment-290016",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`5793bcf`](https://github.com/sagemath/sagetrac-mirror/commit/5793bcfce6f66f5740fce05c4d89c1587eaee872)** to **[`cb63fe5`](https://github.com/sagemath/sagetrac-mirror/commit/cb63fe51cda3ac27a67c297e9a05289b2911c865)**



---

archive/issue_comments_290017.json:
```json
{
    "body": "Changed commit from **[`cb63fe5`](https://github.com/sagemath/sagetrac-mirror/commit/cb63fe51cda3ac27a67c297e9a05289b2911c865)** to **[`b913dcc`](https://github.com/sagemath/sagetrac-mirror/commit/b913dcc0bc20886e637ffe2e05a88907f8eccdf2)**",
    "created_at": "2019-04-22T12:52:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20181#issuecomment-290017",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`cb63fe5`](https://github.com/sagemath/sagetrac-mirror/commit/cb63fe51cda3ac27a67c297e9a05289b2911c865)** to **[`b913dcc`](https://github.com/sagemath/sagetrac-mirror/commit/b913dcc0bc20886e637ffe2e05a88907f8eccdf2)**



---

archive/issue_comments_290018.json:
```json
{
    "body": "<div id=\"comment:45\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b913dcc0bc20886e637ffe2e05a88907f8eccdf2\"><code>b913dcc</code></a></td><td><code>Fixed usage of RealField and docstring</code></td></tr></table>\n",
    "created_at": "2019-04-22T12:52:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20181#issuecomment-290018",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:45"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b913dcc0bc20886e637ffe2e05a88907f8eccdf2"><code>b913dcc</code></a></td><td><code>Fixed usage of RealField and docstring</code></td></tr></table>




---

archive/issue_comments_290019.json:
```json
{
    "body": "Changed commit from **[`b913dcc`](https://github.com/sagemath/sagetrac-mirror/commit/b913dcc0bc20886e637ffe2e05a88907f8eccdf2)** to **[`b153ef7`](https://github.com/sagemath/sagetrac-mirror/commit/b153ef700dd3bab9966283e69ae24afc3bbf2245)**",
    "created_at": "2019-04-22T12:56:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20181#issuecomment-290019",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`b913dcc`](https://github.com/sagemath/sagetrac-mirror/commit/b913dcc0bc20886e637ffe2e05a88907f8eccdf2)** to **[`b153ef7`](https://github.com/sagemath/sagetrac-mirror/commit/b153ef700dd3bab9966283e69ae24afc3bbf2245)**



---

archive/issue_comments_290020.json:
```json
{
    "body": "<div id=\"comment:46\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b153ef700dd3bab9966283e69ae24afc3bbf2245\"><code>b153ef7</code></a></td><td><code>fixed docstring</code></td></tr></table>\n",
    "created_at": "2019-04-22T12:56:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20181#issuecomment-290020",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:46"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b153ef700dd3bab9966283e69ae24afc3bbf2245"><code>b153ef7</code></a></td><td><code>fixed docstring</code></td></tr></table>




---

archive/issue_comments_290021.json:
```json
{
    "body": "<div id=\"comment:47\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/61e4df9fabf9e06a21d75eb6320ab3179bc28096\"><code>61e4df9</code></a></td><td><code>Fix docstring even more</code></td></tr></table>\n",
    "created_at": "2019-04-22T13:14:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20181#issuecomment-290021",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:47"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/61e4df9fabf9e06a21d75eb6320ab3179bc28096"><code>61e4df9</code></a></td><td><code>Fix docstring even more</code></td></tr></table>




---

archive/issue_comments_290022.json:
```json
{
    "body": "Changed commit from **[`b153ef7`](https://github.com/sagemath/sagetrac-mirror/commit/b153ef700dd3bab9966283e69ae24afc3bbf2245)** to **[`61e4df9`](https://github.com/sagemath/sagetrac-mirror/commit/61e4df9fabf9e06a21d75eb6320ab3179bc28096)**",
    "created_at": "2019-04-22T13:14:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20181#issuecomment-290022",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`b153ef7`](https://github.com/sagemath/sagetrac-mirror/commit/b153ef700dd3bab9966283e69ae24afc3bbf2245)** to **[`61e4df9`](https://github.com/sagemath/sagetrac-mirror/commit/61e4df9fabf9e06a21d75eb6320ab3179bc28096)**



---

archive/issue_events_282402.json:
```json
{
    "actor": "https://github.com/jplab",
    "created_at": "2019-04-22T13:47:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20181#event-282402"
}
```



---

archive/issue_events_282403.json:
```json
{
    "actor": "https://github.com/jplab",
    "created_at": "2019-04-22T13:47:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20181#event-282403"
}
```



---

archive/issue_comments_290023.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">comment:48</div>\n\nI deleted an old comment that should have been deleted in 2010 from ticket #9343.\n\nIt now looks ready for review.",
    "created_at": "2019-04-22T13:47:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20181#issuecomment-290023",
    "user": "https://github.com/jplab"
}
```

<div id="comment:48" align="right">comment:48</div>

I deleted an old comment that should have been deleted in 2010 from ticket #9343.

It now looks ready for review.



---

archive/issue_comments_290024.json:
```json
{
    "body": "Changed commit from **[`61e4df9`](https://github.com/sagemath/sagetrac-mirror/commit/61e4df9fabf9e06a21d75eb6320ab3179bc28096)** to **[`9255f2c`](https://github.com/sagemath/sagetrac-mirror/commit/9255f2c89588c79de496660c8c9030f087b5ebfd)**",
    "created_at": "2019-04-22T17:57:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20181#issuecomment-290024",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`61e4df9`](https://github.com/sagemath/sagetrac-mirror/commit/61e4df9fabf9e06a21d75eb6320ab3179bc28096)** to **[`9255f2c`](https://github.com/sagemath/sagetrac-mirror/commit/9255f2c89588c79de496660c8c9030f087b5ebfd)**



---

archive/issue_comments_290025.json:
```json
{
    "body": "<div id=\"comment:49\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9255f2c89588c79de496660c8c9030f087b5ebfd\"><code>9255f2c</code></a></td><td><code>pyflakes</code></td></tr></table>\n",
    "created_at": "2019-04-22T17:57:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20181#issuecomment-290025",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:49"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9255f2c89588c79de496660c8c9030f087b5ebfd"><code>9255f2c</code></a></td><td><code>pyflakes</code></td></tr></table>




---

archive/issue_comments_290026.json:
```json
{
    "body": "<div id=\"comment:50\" align=\"right\">comment:50</div>\n\nLooks good to me and works well within #25097.\nBut it would be good if another reviewer could take a look as well.",
    "created_at": "2019-04-23T21:41:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20181#issuecomment-290026",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:50" align="right">comment:50</div>

Looks good to me and works well within #25097.
But it would be good if another reviewer could take a look as well.



---

archive/issue_comments_290027.json:
```json
{
    "body": "<div id=\"comment:51\" align=\"right\">comment:51</div>\n\nIt would be great is a semi-full-time number theorist looks into this...",
    "created_at": "2019-04-24T10:48:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20181#issuecomment-290027",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:51" align="right">comment:51</div>

It would be great is a semi-full-time number theorist looks into this...



---

archive/issue_comments_290028.json:
```json
{
    "body": "<div id=\"comment:52\" align=\"right\">comment:52</div>\n\nI almost never use embedded number fields (instead I make explicit embeddings into RR or CC as needed), but this all looks reasonable and there is a lot of new documentation and examples, which is good.  So OK from me.",
    "created_at": "2019-04-24T18:23:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20181#issuecomment-290028",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:52" align="right">comment:52</div>

I almost never use embedded number fields (instead I make explicit embeddings into RR or CC as needed), but this all looks reasonable and there is a lot of new documentation and examples, which is good.  So OK from me.



---

archive/issue_comments_290029.json:
```json
{
    "body": "Changed reviewer from **Matthias Koeppe** to **Matthias Koeppe, John Cremona**",
    "created_at": "2019-04-24T18:51:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20181#issuecomment-290029",
    "user": "https://github.com/mkoeppe"
}
```

Changed reviewer from **Matthias Koeppe** to **Matthias Koeppe, John Cremona**



---

archive/issue_events_282404.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2019-04-24T18:51:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20181#event-282404"
}
```



---

archive/issue_events_282405.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2019-04-24T18:51:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20181#event-282405"
}
```



---

archive/issue_events_282406.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-04-29T12:35:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20181#event-282406"
}
```



---

archive/issue_events_282407.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "1c481bfa6a553ec7891b7b429e027b75ecc262c7",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2019-04-29T12:35:34Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20181#event-282407"
}
```



---

archive/issue_comments_290030.json:
```json
{
    "body": "Changed branch from **[public/algnum_to_numberfield](https://github.com/sagemath/sagetrac-mirror/tree/public/algnum_to_numberfield)** to **[`9255f2c`](https://github.com/sagemath/sagetrac-mirror/commit/9255f2c89588c79de496660c8c9030f087b5ebfd)**",
    "created_at": "2019-04-29T12:35:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20181#issuecomment-290030",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[public/algnum_to_numberfield](https://github.com/sagemath/sagetrac-mirror/tree/public/algnum_to_numberfield)** to **[`9255f2c`](https://github.com/sagemath/sagetrac-mirror/commit/9255f2c89588c79de496660c8c9030f087b5ebfd)**



---

archive/issue_comments_290031.json:
```json
{
    "body": "Changed commit from **[`9255f2c`](https://github.com/sagemath/sagetrac-mirror/commit/9255f2c89588c79de496660c8c9030f087b5ebfd)** to none",
    "created_at": "2019-05-04T18:06:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20181#issuecomment-290031",
    "user": "https://github.com/fchapoton"
}
```

Changed commit from **[`9255f2c`](https://github.com/sagemath/sagetrac-mirror/commit/9255f2c89588c79de496660c8c9030f087b5ebfd)** to none



---

archive/issue_comments_290032.json:
```json
{
    "body": "<div id=\"comment:55\" align=\"right\">comment:55</div>\n\nyou used \"map\" in a way that is not compatible with py3, please review the fix in #27767",
    "created_at": "2019-05-04T18:06:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20181#issuecomment-290032",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:55" align="right">comment:55</div>

you used "map" in a way that is not compatible with py3, please review the fix in #27767
