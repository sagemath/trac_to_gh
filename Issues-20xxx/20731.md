# Issue 20731: shortcut coercion for Integer-Rational operations

archive/issues_020494.json:
```json
{
    "body": "Doing some shortcut to coercion actually fasten the code by a factor 3...\n\nOld version\n\n```\nsage: z = 2\nsage: q = QQ((-1,5))\nsage: %timeit z + q\n1000000 loops, best of 3: 930 ns per loop\nsage: %timeit q + z\n1000000 loops, best of 3: 930 ns per loop\nsage: %timeit z - q\n1000000 loops, best of 3: 848 ns per loop\nsage: %timeit q - z\n1000000 loops, best of 3: 776 ns per loop\nsage: %timeit z * q\n1000000 loops, best of 3: 1.15 \u00b5s per loop\nsage: %timeit q * z\n1000000 loops, best of 3: 1.17 \u00b5s per loop\nsage: %timeit z / q\n1000000 loops, best of 3: 1.09 \u00b5s per loop\nsage: %timeit q / z\n1000000 loops, best of 3: 1.1 \u00b5s per loop\n```\nNew version\n\n```\nsage: z = 2\nsage: q = QQ((-1,5))\nsage: %timeit z + q\n1000000 loops, best of 3: 265 ns per loop\nsage: %timeit q + z\n1000000 loops, best of 3: 323 ns per loop\nsage: %timeit z - q\n1000000 loops, best of 3: 261 ns per loop\nsage: %timeit q - z\n1000000 loops, best of 3: 319 ns per loop\nsage: %timeit z * q\n1000000 loops, best of 3: 255 ns per loop\nsage: %timeit q * z\n1000000 loops, best of 3: 332 ns per loop\nsage: %timeit z / q\n1000000 loops, best of 3: 289 ns per loop\nsage: %timeit q / z\n1000000 loops, best of 3: 314 ns per loop\n```\n\n**CC:**  @jdemeyer\n\n**Keywords:** days74\n\n**Branch/Commit:** [d535aee38e629195fa6319a8a1d1d2efaecebec6](https://github.com/sagemath/sagetrac-mirror/commit/d535aee38e629195fa6319a8a1d1d2efaecebec6)\n\n**Reviewer:** Jeroen Demeyer, Travis Scrimshaw\n\n**Author:** Vincent Delecroix\n\n**Resolution:** fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/20731\n\n",
    "closed_at": "2016-07-23T18:38:25Z",
    "created_at": "2016-05-31T13:38:42Z",
    "labels": [
        "component: coercion"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.3",
    "title": "shortcut coercion for Integer-Rational operations",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/20731",
    "user": "https://github.com/videlec"
}
```
Doing some shortcut to coercion actually fasten the code by a factor 3...

Old version

```
sage: z = 2
sage: q = QQ((-1,5))
sage: %timeit z + q
1000000 loops, best of 3: 930 ns per loop
sage: %timeit q + z
1000000 loops, best of 3: 930 ns per loop
sage: %timeit z - q
1000000 loops, best of 3: 848 ns per loop
sage: %timeit q - z
1000000 loops, best of 3: 776 ns per loop
sage: %timeit z * q
1000000 loops, best of 3: 1.15 µs per loop
sage: %timeit q * z
1000000 loops, best of 3: 1.17 µs per loop
sage: %timeit z / q
1000000 loops, best of 3: 1.09 µs per loop
sage: %timeit q / z
1000000 loops, best of 3: 1.1 µs per loop
```
New version

```
sage: z = 2
sage: q = QQ((-1,5))
sage: %timeit z + q
1000000 loops, best of 3: 265 ns per loop
sage: %timeit q + z
1000000 loops, best of 3: 323 ns per loop
sage: %timeit z - q
1000000 loops, best of 3: 261 ns per loop
sage: %timeit q - z
1000000 loops, best of 3: 319 ns per loop
sage: %timeit z * q
1000000 loops, best of 3: 255 ns per loop
sage: %timeit q * z
1000000 loops, best of 3: 332 ns per loop
sage: %timeit z / q
1000000 loops, best of 3: 289 ns per loop
sage: %timeit q / z
1000000 loops, best of 3: 314 ns per loop
```

**CC:**  @jdemeyer

**Keywords:** days74

**Branch/Commit:** [d535aee38e629195fa6319a8a1d1d2efaecebec6](https://github.com/sagemath/sagetrac-mirror/commit/d535aee38e629195fa6319a8a1d1d2efaecebec6)

**Reviewer:** Jeroen Demeyer, Travis Scrimshaw

**Author:** Vincent Delecroix

**Resolution:** fixed

Issue created by migration from https://trac.sagemath.org/ticket/20731





---

archive/issue_comments_380651.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,18 +1,26 @@\n-Doing some shortcut to coercion actually fasten the code\n+Doing some shortcut to coercion actually fasten the code by a factor 3...\n \n Old version\n \n ```\n sage: z = 2\n sage: q = QQ((-1,5))\n-sage: %timeit z + q\n-sage: %timeit q + z\n-sage: %timeit z - q\n-sage: %timeit q - z\n-sage: %timeit z * q\n-sage: %timeit q * z\n-sage: %timeit z / q\n-sage: %timeit q / z\n+sage: sage: %timeit z + q\n+1000000 loops, best of 3: 930 ns per loop\n+sage: sage: %timeit q + z\n+1000000 loops, best of 3: 930 ns per loop\n+sage: sage: %timeit z - q\n+1000000 loops, best of 3: 848 ns per loop\n+sage: sage: %timeit q - z\n+1000000 loops, best of 3: 776 ns per loop\n+sage: sage: %timeit z * q\n+1000000 loops, best of 3: 1.15 \u00b5s per loop\n+sage: sage: %timeit q * z\n+1000000 loops, best of 3: 1.17 \u00b5s per loop\n+sage: sage: %timeit z / q\n+1000000 loops, best of 3: 1.09 \u00b5s per loop\n+sage: sage: %timeit q / z\n+1000000 loops, best of 3: 1.1 \u00b5s per loop\n ```\n New version\n \n``````\n",
    "created_at": "2016-05-31T13:44:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20731#issuecomment-380651",
    "user": "https://github.com/videlec"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,18 +1,26 @@
-Doing some shortcut to coercion actually fasten the code
+Doing some shortcut to coercion actually fasten the code by a factor 3...
 
 Old version
 
 ```
 sage: z = 2
 sage: q = QQ((-1,5))
-sage: %timeit z + q
-sage: %timeit q + z
-sage: %timeit z - q
-sage: %timeit q - z
-sage: %timeit z * q
-sage: %timeit q * z
-sage: %timeit z / q
-sage: %timeit q / z
+sage: sage: %timeit z + q
+1000000 loops, best of 3: 930 ns per loop
+sage: sage: %timeit q + z
+1000000 loops, best of 3: 930 ns per loop
+sage: sage: %timeit z - q
+1000000 loops, best of 3: 848 ns per loop
+sage: sage: %timeit q - z
+1000000 loops, best of 3: 776 ns per loop
+sage: sage: %timeit z * q
+1000000 loops, best of 3: 1.15 µs per loop
+sage: sage: %timeit q * z
+1000000 loops, best of 3: 1.17 µs per loop
+sage: sage: %timeit z / q
+1000000 loops, best of 3: 1.09 µs per loop
+sage: sage: %timeit q / z
+1000000 loops, best of 3: 1.1 µs per loop
 ```
 New version
 
``````




---

archive/issue_comments_380652.json:
```json
{
    "body": "**Branch:** [u/vdelecroix/20731](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/20731)",
    "created_at": "2016-05-31T13:44:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20731#issuecomment-380652",
    "user": "https://github.com/videlec"
}
```

**Branch:** [u/vdelecroix/20731](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/20731)



---

archive/issue_comments_380653.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2016-05-31T13:44:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20731#issuecomment-380653",
    "user": "https://github.com/videlec"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_380654.json:
```json
{
    "body": "<a id='comment:2'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/33f9fd432ff127a5234b120bebda1f7b63bb0f84\">33f9fd4</a></td><td><code>Trac 20731: shortcut coercion for Integer-Rational</code></td></tr></table>\n",
    "created_at": "2016-05-31T13:44:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20731#issuecomment-380654",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/33f9fd432ff127a5234b120bebda1f7b63bb0f84">33f9fd4</a></td><td><code>Trac 20731: shortcut coercion for Integer-Rational</code></td></tr></table>




---

archive/issue_comments_380655.json:
```json
{
    "body": "**Commit:** [33f9fd432ff127a5234b120bebda1f7b63bb0f84](https://github.com/sagemath/sagetrac-mirror/commit/33f9fd432ff127a5234b120bebda1f7b63bb0f84)",
    "created_at": "2016-05-31T13:44:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20731#issuecomment-380655",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Commit:** [33f9fd432ff127a5234b120bebda1f7b63bb0f84](https://github.com/sagemath/sagetrac-mirror/commit/33f9fd432ff127a5234b120bebda1f7b63bb0f84)



---

archive/issue_comments_380656.json:
```json
{
    "body": "**Changing commit** from \"[33f9fd432ff127a5234b120bebda1f7b63bb0f84](https://github.com/sagemath/sagetrac-mirror/commit/33f9fd432ff127a5234b120bebda1f7b63bb0f84)\" to \"[19c075bf18073049fea1607b483c591feef7df22](https://github.com/sagemath/sagetrac-mirror/commit/19c075bf18073049fea1607b483c591feef7df22)\".",
    "created_at": "2016-05-31T19:20:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20731#issuecomment-380656",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[33f9fd432ff127a5234b120bebda1f7b63bb0f84](https://github.com/sagemath/sagetrac-mirror/commit/33f9fd432ff127a5234b120bebda1f7b63bb0f84)" to "[19c075bf18073049fea1607b483c591feef7df22](https://github.com/sagemath/sagetrac-mirror/commit/19c075bf18073049fea1607b483c591feef7df22)".



---

archive/issue_comments_380657.json:
```json
{
    "body": "<a id='comment:3'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/19c075bf18073049fea1607b483c591feef7df22\">19c075b</a></td><td><code>Trac 20731: fix doctests</code></td></tr></table>\n",
    "created_at": "2016-05-31T19:20:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20731#issuecomment-380657",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/19c075bf18073049fea1607b483c591feef7df22">19c075b</a></td><td><code>Trac 20731: fix doctests</code></td></tr></table>




---

archive/issue_comments_380658.json:
```json
{
    "body": "<a id='comment:4'></a>\nMove `src/sage/rings/binop.pyx` to `src/sage/libs/gmp` since it has nothing to with rings. And I would just use a `.pxd` file with inline functions, no `.pyx` file.",
    "created_at": "2016-06-01T08:21:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20731#issuecomment-380658",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:4'></a>
Move `src/sage/rings/binop.pyx` to `src/sage/libs/gmp` since it has nothing to with rings. And I would just use a `.pxd` file with inline functions, no `.pyx` file.



---

archive/issue_comments_380659.json:
```json
{
    "body": "<a id='comment:5'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fdf79acfa3433ef167ee3e865c16dd429caf24e6\">fdf79ac</a></td><td><code>Trac 20731: get rid of ZZ._div</code></td></tr></table>\n",
    "created_at": "2016-06-01T08:26:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20731#issuecomment-380659",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fdf79acfa3433ef167ee3e865c16dd429caf24e6">fdf79ac</a></td><td><code>Trac 20731: get rid of ZZ._div</code></td></tr></table>




---

archive/issue_comments_380660.json:
```json
{
    "body": "**Changing commit** from \"[19c075bf18073049fea1607b483c591feef7df22](https://github.com/sagemath/sagetrac-mirror/commit/19c075bf18073049fea1607b483c591feef7df22)\" to \"[fdf79acfa3433ef167ee3e865c16dd429caf24e6](https://github.com/sagemath/sagetrac-mirror/commit/fdf79acfa3433ef167ee3e865c16dd429caf24e6)\".",
    "created_at": "2016-06-01T08:26:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20731#issuecomment-380660",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[19c075bf18073049fea1607b483c591feef7df22](https://github.com/sagemath/sagetrac-mirror/commit/19c075bf18073049fea1607b483c591feef7df22)" to "[fdf79acfa3433ef167ee3e865c16dd429caf24e6](https://github.com/sagemath/sagetrac-mirror/commit/fdf79acfa3433ef167ee3e865c16dd429caf24e6)".



---

archive/issue_comments_380661.json:
```json
{
    "body": "**Changing commit** from \"[fdf79acfa3433ef167ee3e865c16dd429caf24e6](https://github.com/sagemath/sagetrac-mirror/commit/fdf79acfa3433ef167ee3e865c16dd429caf24e6)\" to \"[eec41681c0fc9bb3b377ad67a31634a40d277782](https://github.com/sagemath/sagetrac-mirror/commit/eec41681c0fc9bb3b377ad67a31634a40d277782)\".",
    "created_at": "2016-06-01T08:30:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20731#issuecomment-380661",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[fdf79acfa3433ef167ee3e865c16dd429caf24e6](https://github.com/sagemath/sagetrac-mirror/commit/fdf79acfa3433ef167ee3e865c16dd429caf24e6)" to "[eec41681c0fc9bb3b377ad67a31634a40d277782](https://github.com/sagemath/sagetrac-mirror/commit/eec41681c0fc9bb3b377ad67a31634a40d277782)".



---

archive/issue_comments_380662.json:
```json
{
    "body": "<a id='comment:6'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9078830d92c33d8a2e06ebb065e113e97a31d0e1\">9078830</a></td><td><code>Trac 20731: moving binop</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/eec41681c0fc9bb3b377ad67a31634a40d277782\">eec4168</a></td><td><code>Trac 20731: fix the move</code></td></tr></table>\n",
    "created_at": "2016-06-01T08:30:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20731#issuecomment-380662",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9078830d92c33d8a2e06ebb065e113e97a31d0e1">9078830</a></td><td><code>Trac 20731: moving binop</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/eec41681c0fc9bb3b377ad67a31634a40d277782">eec4168</a></td><td><code>Trac 20731: fix the move</code></td></tr></table>




---

archive/issue_comments_380663.json:
```json
{
    "body": "<a id='comment:7'></a>\nI think that `mpq_mul_z` and `mpq_div_z` are overkill. Why don't you just multiply the numerator or denominator with the integer and call `mpq_canonicalize`, similar to what you do for `Integer/Integer` division?",
    "created_at": "2016-06-01T15:52:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20731#issuecomment-380663",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:7'></a>
I think that `mpq_mul_z` and `mpq_div_z` are overkill. Why don't you just multiply the numerator or denominator with the integer and call `mpq_canonicalize`, similar to what you do for `Integer/Integer` division?



---

archive/issue_comments_380664.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2016-06-01T15:52:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20731#issuecomment-380664",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_380665.json:
```json
{
    "body": "<a id='comment:8'></a>\n\n```\nQQ((2^100, 3^100)) * 3^100}}}",
    "created_at": "2016-06-01T16:24:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20731#issuecomment-380665",
    "user": "https://github.com/videlec"
}
```

<a id='comment:8'></a>

```
QQ((2^100, 3^100)) * 3^100}}}



---

archive/issue_comments_380666.json:
```json
{
    "body": "<a id='comment:9'></a>\nRight, but that's a rather artificial example. What about simple cases?",
    "created_at": "2016-06-01T16:28:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20731#issuecomment-380666",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:9'></a>
Right, but that's a rather artificial example. What about simple cases?



---

archive/issue_comments_380667.json:
```json
{
    "body": "<a id='comment:10'></a>\nIn `src/sage/repl/interpreter.py`, there is a good reason that the line numbers were changed to `...`",
    "created_at": "2016-06-01T16:30:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20731#issuecomment-380667",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:10'></a>
In `src/sage/repl/interpreter.py`, there is a good reason that the line numbers were changed to `...`



---

archive/issue_comments_380668.json:
```json
{
    "body": "<a id='comment:11'></a>\nI just thought about the following very simple algorithm for the multiplication (division is analogous):\n\nTo compute `(A/B) * C`, you initialize the result as `C/B`, canonicalize it and then multiply the numerator by `A`.\n\nYou don't need to canonicalize the final result, since `gcd(A,B) = 1` by assumption.",
    "created_at": "2016-06-01T19:55:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20731#issuecomment-380668",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:11'></a>
I just thought about the following very simple algorithm for the multiplication (division is analogous):

To compute `(A/B) * C`, you initialize the result as `C/B`, canonicalize it and then multiply the numerator by `A`.

You don't need to canonicalize the final result, since `gcd(A,B) = 1` by assumption.



---

archive/issue_comments_380669.json:
```json
{
    "body": "<a id='comment:12'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/72f77b99ad55fd2ba186d33c69010214fa569405\">72f77b9</a></td><td><code>Trac 20731: simpler operations</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c7a8d8e5b44d49654aab2827f3b5359f4c7acd60\">c7a8d8e</a></td><td><code>20731: simpler mpq_mul_z/mpq_div_z</code></td></tr></table>\n",
    "created_at": "2016-06-02T02:44:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20731#issuecomment-380669",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/72f77b99ad55fd2ba186d33c69010214fa569405">72f77b9</a></td><td><code>Trac 20731: simpler operations</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c7a8d8e5b44d49654aab2827f3b5359f4c7acd60">c7a8d8e</a></td><td><code>20731: simpler mpq_mul_z/mpq_div_z</code></td></tr></table>




---

archive/issue_comments_380670.json:
```json
{
    "body": "**Changing commit** from \"[eec41681c0fc9bb3b377ad67a31634a40d277782](https://github.com/sagemath/sagetrac-mirror/commit/eec41681c0fc9bb3b377ad67a31634a40d277782)\" to \"[c7a8d8e5b44d49654aab2827f3b5359f4c7acd60](https://github.com/sagemath/sagetrac-mirror/commit/c7a8d8e5b44d49654aab2827f3b5359f4c7acd60)\".",
    "created_at": "2016-06-02T02:44:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20731#issuecomment-380670",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[eec41681c0fc9bb3b377ad67a31634a40d277782](https://github.com/sagemath/sagetrac-mirror/commit/eec41681c0fc9bb3b377ad67a31634a40d277782)" to "[c7a8d8e5b44d49654aab2827f3b5359f4c7acd60](https://github.com/sagemath/sagetrac-mirror/commit/c7a8d8e5b44d49654aab2827f3b5359f4c7acd60)".



---

archive/issue_comments_380671.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2016-06-02T07:19:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20731#issuecomment-380671",
    "user": "https://github.com/videlec"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_380672.json:
```json
{
    "body": "<a id='comment:14'></a>\n[comment:10]",
    "created_at": "2016-06-02T08:13:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20731#issuecomment-380672",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:14'></a>
[comment:10]



---

archive/issue_comments_380673.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2016-06-02T08:13:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20731#issuecomment-380673",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_380674.json:
```json
{
    "body": "<a id='comment:15'></a>\nWhich line numbers?",
    "created_at": "2016-06-02T08:19:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20731#issuecomment-380674",
    "user": "https://github.com/videlec"
}
```

<a id='comment:15'></a>
Which line numbers?



---

archive/issue_comments_380675.json:
```json
{
    "body": "<a id='comment:16'></a>\nI see...",
    "created_at": "2016-06-02T08:20:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20731#issuecomment-380675",
    "user": "https://github.com/videlec"
}
```

<a id='comment:16'></a>
I see...



---

archive/issue_comments_380676.json:
```json
{
    "body": "**Changing commit** from \"[c7a8d8e5b44d49654aab2827f3b5359f4c7acd60](https://github.com/sagemath/sagetrac-mirror/commit/c7a8d8e5b44d49654aab2827f3b5359f4c7acd60)\" to \"[97a809ecbc63d4dad9c794af1b1fda089fece267](https://github.com/sagemath/sagetrac-mirror/commit/97a809ecbc63d4dad9c794af1b1fda089fece267)\".",
    "created_at": "2016-06-02T08:25:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20731#issuecomment-380676",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[c7a8d8e5b44d49654aab2827f3b5359f4c7acd60](https://github.com/sagemath/sagetrac-mirror/commit/c7a8d8e5b44d49654aab2827f3b5359f4c7acd60)" to "[97a809ecbc63d4dad9c794af1b1fda089fece267](https://github.com/sagemath/sagetrac-mirror/commit/97a809ecbc63d4dad9c794af1b1fda089fece267)".



---

archive/issue_comments_380677.json:
```json
{
    "body": "<a id='comment:17'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/97a809ecbc63d4dad9c794af1b1fda089fece267\">97a809e</a></td><td><code>Trac 20731: remove line numbers in a doctest</code></td></tr></table>\n",
    "created_at": "2016-06-02T08:25:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20731#issuecomment-380677",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:17'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/97a809ecbc63d4dad9c794af1b1fda089fece267">97a809e</a></td><td><code>Trac 20731: remove line numbers in a doctest</code></td></tr></table>




---

archive/issue_comments_380678.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2016-06-02T08:26:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20731#issuecomment-380678",
    "user": "https://github.com/videlec"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_380679.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2016-06-02T08:36:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20731#issuecomment-380679",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_380680.json:
```json
{
    "body": "<a id='comment:19'></a>\n`12883`",
    "created_at": "2016-06-02T08:36:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20731#issuecomment-380680",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:19'></a>
`12883`



---

archive/issue_comments_380681.json:
```json
{
    "body": "<a id='comment:20'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/647a17bc7965f7c5daa91490d311eea894a31983\">647a17b</a></td><td><code>Trac 20731: one more line number</code></td></tr></table>\n",
    "created_at": "2016-06-02T08:40:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20731#issuecomment-380681",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:20'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/647a17bc7965f7c5daa91490d311eea894a31983">647a17b</a></td><td><code>Trac 20731: one more line number</code></td></tr></table>




---

archive/issue_comments_380682.json:
```json
{
    "body": "**Changing commit** from \"[97a809ecbc63d4dad9c794af1b1fda089fece267](https://github.com/sagemath/sagetrac-mirror/commit/97a809ecbc63d4dad9c794af1b1fda089fece267)\" to \"[647a17bc7965f7c5daa91490d311eea894a31983](https://github.com/sagemath/sagetrac-mirror/commit/647a17bc7965f7c5daa91490d311eea894a31983)\".",
    "created_at": "2016-06-02T08:40:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20731#issuecomment-380682",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[97a809ecbc63d4dad9c794af1b1fda089fece267](https://github.com/sagemath/sagetrac-mirror/commit/97a809ecbc63d4dad9c794af1b1fda089fece267)" to "[647a17bc7965f7c5daa91490d311eea894a31983](https://github.com/sagemath/sagetrac-mirror/commit/647a17bc7965f7c5daa91490d311eea894a31983)".



---

archive/issue_comments_380683.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2016-06-02T08:41:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20731#issuecomment-380683",
    "user": "https://github.com/videlec"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_380684.json:
```json
{
    "body": "<a id='comment:22'></a>\nGiven that the block\n\n```\n        mpz_set(mpq_numref(X), A)\n        mpz_set(mpq_denref(X), B)\n        mpq_canonicalize(X)\n```\noccurs many times, you should probably make it a separate inline function too, let's call it `mpq_div_zz`.",
    "created_at": "2016-06-02T09:34:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20731#issuecomment-380684",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:22'></a>
Given that the block

```
        mpz_set(mpq_numref(X), A)
        mpz_set(mpq_denref(X), B)
        mpq_canonicalize(X)
```
occurs many times, you should probably make it a separate inline function too, let's call it `mpq_div_zz`.



---

archive/issue_comments_380685.json:
```json
{
    "body": "<a id='comment:23'></a>\nI'm still not convinced by the `if type(x) is type(y)`. That would break if somebody wants to subclass `Integer` for some reason. You can check the types first as an optimization, but you should still support the case where `isinstance(x, Integer) and isinstance(y, Integer)`.",
    "created_at": "2016-06-02T09:42:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20731#issuecomment-380685",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:23'></a>
I'm still not convinced by the `if type(x) is type(y)`. That would break if somebody wants to subclass `Integer` for some reason. You can check the types first as an optimization, but you should still support the case where `isinstance(x, Integer) and isinstance(y, Integer)`.



---

archive/issue_comments_380686.json:
```json
{
    "body": "<a id='comment:24'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/675f8e617bdcc66e718d18089938b8d1458d0724\">675f8e6</a></td><td><code>Trac 20731: some factorization</code></td></tr></table>\n",
    "created_at": "2016-06-02T12:34:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20731#issuecomment-380686",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:24'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/675f8e617bdcc66e718d18089938b8d1458d0724">675f8e6</a></td><td><code>Trac 20731: some factorization</code></td></tr></table>




---

archive/issue_comments_380687.json:
```json
{
    "body": "**Changing commit** from \"[647a17bc7965f7c5daa91490d311eea894a31983](https://github.com/sagemath/sagetrac-mirror/commit/647a17bc7965f7c5daa91490d311eea894a31983)\" to \"[675f8e617bdcc66e718d18089938b8d1458d0724](https://github.com/sagemath/sagetrac-mirror/commit/675f8e617bdcc66e718d18089938b8d1458d0724)\".",
    "created_at": "2016-06-02T12:34:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20731#issuecomment-380687",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[647a17bc7965f7c5daa91490d311eea894a31983](https://github.com/sagemath/sagetrac-mirror/commit/647a17bc7965f7c5daa91490d311eea894a31983)" to "[675f8e617bdcc66e718d18089938b8d1458d0724](https://github.com/sagemath/sagetrac-mirror/commit/675f8e617bdcc66e718d18089938b8d1458d0724)".



---

archive/issue_comments_380688.json:
```json
{
    "body": "<a id='comment:25'></a>\nReplying to [jdemeyer](#comment%3A23):\n> I'm still not convinced by the `if type(x) is type(y)`. That would break if somebody wants to subclass `Integer` for some reason. You can check the types first as an optimization, but you should still support the case where `isinstance(x, Integer) and isinstance(y, Integer)`.\n\n\nIt perfectly works ;-)\n\n```\nsage: class A(Integer): pass\nsage: A() + 1\n1\nsage: 1 + A()\n1\n```",
    "created_at": "2016-06-02T13:11:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20731#issuecomment-380688",
    "user": "https://github.com/videlec"
}
```

<a id='comment:25'></a>
Replying to [jdemeyer](#comment%3A23):
> I'm still not convinced by the `if type(x) is type(y)`. That would break if somebody wants to subclass `Integer` for some reason. You can check the types first as an optimization, but you should still support the case where `isinstance(x, Integer) and isinstance(y, Integer)`.


It perfectly works ;-)

```
sage: class A(Integer): pass
sage: A() + 1
1
sage: 1 + A()
1
```



---

archive/issue_comments_380689.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -5,21 +5,21 @@\n ```\n sage: z = 2\n sage: q = QQ((-1,5))\n-sage: sage: %timeit z + q\n+sage: %timeit z + q\n 1000000 loops, best of 3: 930 ns per loop\n-sage: sage: %timeit q + z\n+sage: %timeit q + z\n 1000000 loops, best of 3: 930 ns per loop\n-sage: sage: %timeit z - q\n+sage: %timeit z - q\n 1000000 loops, best of 3: 848 ns per loop\n-sage: sage: %timeit q - z\n+sage: %timeit q - z\n 1000000 loops, best of 3: 776 ns per loop\n-sage: sage: %timeit z * q\n+sage: %timeit z * q\n 1000000 loops, best of 3: 1.15 \u00b5s per loop\n-sage: sage: %timeit q * z\n+sage: %timeit q * z\n 1000000 loops, best of 3: 1.17 \u00b5s per loop\n-sage: sage: %timeit z / q\n+sage: %timeit z / q\n 1000000 loops, best of 3: 1.09 \u00b5s per loop\n-sage: sage: %timeit q / z\n+sage: %timeit q / z\n 1000000 loops, best of 3: 1.1 \u00b5s per loop\n ```\n New version\n@@ -36,11 +36,11 @@\n sage: %timeit q - z\n 1000000 loops, best of 3: 319 ns per loop\n sage: %timeit z * q\n-1000000 loops, best of 3: 341 ns per loop\n+1000000 loops, best of 3: 255 ns per loop\n sage: %timeit q * z\n-1000000 loops, best of 3: 446 ns per loop\n+1000000 loops, best of 3: 332 ns per loop\n sage: %timeit z / q\n-1000000 loops, best of 3: 341 ns per loop\n+1000000 loops, best of 3: 289 ns per loop\n sage: %timeit q / z\n-1000000 loops, best of 3: 396 ns per loop\n+1000000 loops, best of 3: 314 ns per loop\n ```\n``````\n",
    "created_at": "2016-06-02T13:13:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20731#issuecomment-380689",
    "user": "https://github.com/videlec"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -5,21 +5,21 @@
 ```
 sage: z = 2
 sage: q = QQ((-1,5))
-sage: sage: %timeit z + q
+sage: %timeit z + q
 1000000 loops, best of 3: 930 ns per loop
-sage: sage: %timeit q + z
+sage: %timeit q + z
 1000000 loops, best of 3: 930 ns per loop
-sage: sage: %timeit z - q
+sage: %timeit z - q
 1000000 loops, best of 3: 848 ns per loop
-sage: sage: %timeit q - z
+sage: %timeit q - z
 1000000 loops, best of 3: 776 ns per loop
-sage: sage: %timeit z * q
+sage: %timeit z * q
 1000000 loops, best of 3: 1.15 µs per loop
-sage: sage: %timeit q * z
+sage: %timeit q * z
 1000000 loops, best of 3: 1.17 µs per loop
-sage: sage: %timeit z / q
+sage: %timeit z / q
 1000000 loops, best of 3: 1.09 µs per loop
-sage: sage: %timeit q / z
+sage: %timeit q / z
 1000000 loops, best of 3: 1.1 µs per loop
 ```
 New version
@@ -36,11 +36,11 @@
 sage: %timeit q - z
 1000000 loops, best of 3: 319 ns per loop
 sage: %timeit z * q
-1000000 loops, best of 3: 341 ns per loop
+1000000 loops, best of 3: 255 ns per loop
 sage: %timeit q * z
-1000000 loops, best of 3: 446 ns per loop
+1000000 loops, best of 3: 332 ns per loop
 sage: %timeit z / q
-1000000 loops, best of 3: 341 ns per loop
+1000000 loops, best of 3: 289 ns per loop
 sage: %timeit q / z
-1000000 loops, best of 3: 396 ns per loop
+1000000 loops, best of 3: 314 ns per loop
 ```
``````




---

archive/issue_comments_380690.json:
```json
{
    "body": "<a id='comment:27'></a>\nRight, subclassing `Integer` works because `__add__` calls the coercion model and the coercion model calls `_add_` (single underscore).",
    "created_at": "2016-06-03T08:25:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20731#issuecomment-380690",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:27'></a>
Right, subclassing `Integer` works because `__add__` calls the coercion model and the coercion model calls `_add_` (single underscore).



---

archive/issue_comments_380691.json:
```json
{
    "body": "<a id='comment:28'></a>\nSome ---hopefully final--- notes:\n\n1. Check documentation (for example, `Rational.__sub__` documents plus)\n\n2. In `mpq_div_z`, you do not need to check the sign since the denominator is the product of two denominators, so it must be positive.\n\n3. I would remove functions `mpq_sub_z` and `mpq_div_z` since they do not commute and are less useful: just implement them directly. Then you can also avoid `mpq_neg` and `mpq_inv` if you do it correctly.",
    "created_at": "2016-06-03T08:33:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20731#issuecomment-380691",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:28'></a>
Some ---hopefully final--- notes:

1. Check documentation (for example, `Rational.__sub__` documents plus)

2. In `mpq_div_z`, you do not need to check the sign since the denominator is the product of two denominators, so it must be positive.

3. I would remove functions `mpq_sub_z` and `mpq_div_z` since they do not commute and are less useful: just implement them directly. Then you can also avoid `mpq_neg` and `mpq_inv` if you do it correctly.



---

archive/issue_comments_380692.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2016-06-03T08:33:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20731#issuecomment-380692",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_380693.json:
```json
{
    "body": "<a id='comment:29'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/07f054b3e21eac33ee027e8fac148bcefb77fcb5\">07f054b</a></td><td><code>Trac 20731: fix doc + simpler code</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1c87b3cbb27e4f3489707ec30757dd5caa79df73\">1c87b3c</a></td><td><code>Trac 20731: remove mpq_sub_z and mpq_div_z</code></td></tr></table>\n",
    "created_at": "2016-06-04T11:20:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20731#issuecomment-380693",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:29'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/07f054b3e21eac33ee027e8fac148bcefb77fcb5">07f054b</a></td><td><code>Trac 20731: fix doc + simpler code</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1c87b3cbb27e4f3489707ec30757dd5caa79df73">1c87b3c</a></td><td><code>Trac 20731: remove mpq_sub_z and mpq_div_z</code></td></tr></table>




---

archive/issue_comments_380694.json:
```json
{
    "body": "**Changing commit** from \"[675f8e617bdcc66e718d18089938b8d1458d0724](https://github.com/sagemath/sagetrac-mirror/commit/675f8e617bdcc66e718d18089938b8d1458d0724)\" to \"[1c87b3cbb27e4f3489707ec30757dd5caa79df73](https://github.com/sagemath/sagetrac-mirror/commit/1c87b3cbb27e4f3489707ec30757dd5caa79df73)\".",
    "created_at": "2016-06-04T11:20:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20731#issuecomment-380694",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[675f8e617bdcc66e718d18089938b8d1458d0724](https://github.com/sagemath/sagetrac-mirror/commit/675f8e617bdcc66e718d18089938b8d1458d0724)" to "[1c87b3cbb27e4f3489707ec30757dd5caa79df73](https://github.com/sagemath/sagetrac-mirror/commit/1c87b3cbb27e4f3489707ec30757dd5caa79df73)".



---

archive/issue_comments_380695.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2016-06-04T11:26:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20731#issuecomment-380695",
    "user": "https://github.com/videlec"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_380696.json:
```json
{
    "body": "<a id='comment:31'></a>\nCuriously `Integer + Rational` is faster than `Rational + Integer`\n\n```\nsage: z = 2\nsage: q = QQ((-1,5))\nsage: %timeit z + q\n1000000 loops, best of 3: 251 ns per loop\nsage: %timeit q + z\n1000000 loops, best of 3: 323 ns per loop\n```",
    "created_at": "2016-06-04T11:27:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20731#issuecomment-380696",
    "user": "https://github.com/videlec"
}
```

<a id='comment:31'></a>
Curiously `Integer + Rational` is faster than `Rational + Integer`

```
sage: z = 2
sage: q = QQ((-1,5))
sage: %timeit z + q
1000000 loops, best of 3: 251 ns per loop
sage: %timeit q + z
1000000 loops, best of 3: 323 ns per loop
```



---

archive/issue_comments_380697.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2016-06-25T04:17:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20731#issuecomment-380697",
    "user": "https://github.com/tscrim"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_380698.json:
```json
{
    "body": "**Changing keywords** from \"sd74\" to \"days74\".",
    "created_at": "2016-06-25T04:17:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20731#issuecomment-380698",
    "user": "https://github.com/tscrim"
}
```

**Changing keywords** from "sd74" to "days74".



---

archive/issue_comments_380699.json:
```json
{
    "body": "<a id='comment:32'></a>\nI'm not quite sure without looking through it. It might be something at a lower level than Sage.\n\nHowever, this needs rebasing.",
    "created_at": "2016-06-25T04:17:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20731#issuecomment-380699",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:32'></a>
I'm not quite sure without looking through it. It might be something at a lower level than Sage.

However, this needs rebasing.



---

archive/issue_comments_380700.json:
```json
{
    "body": "<a id='comment:33'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1a93a12c39522dbe60b958757e2e3922aa9c23ed\">1a93a12</a></td><td><code>Merge branch 'develop' into int_rat_coercion</code></td></tr></table>\n",
    "created_at": "2016-06-26T20:53:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20731#issuecomment-380700",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:33'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1a93a12c39522dbe60b958757e2e3922aa9c23ed">1a93a12</a></td><td><code>Merge branch 'develop' into int_rat_coercion</code></td></tr></table>




---

archive/issue_comments_380701.json:
```json
{
    "body": "**Changing commit** from \"[1c87b3cbb27e4f3489707ec30757dd5caa79df73](https://github.com/sagemath/sagetrac-mirror/commit/1c87b3cbb27e4f3489707ec30757dd5caa79df73)\" to \"[1a93a12c39522dbe60b958757e2e3922aa9c23ed](https://github.com/sagemath/sagetrac-mirror/commit/1a93a12c39522dbe60b958757e2e3922aa9c23ed)\".",
    "created_at": "2016-06-26T20:53:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20731#issuecomment-380701",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[1c87b3cbb27e4f3489707ec30757dd5caa79df73](https://github.com/sagemath/sagetrac-mirror/commit/1c87b3cbb27e4f3489707ec30757dd5caa79df73)" to "[1a93a12c39522dbe60b958757e2e3922aa9c23ed](https://github.com/sagemath/sagetrac-mirror/commit/1a93a12c39522dbe60b958757e2e3922aa9c23ed)".



---

archive/issue_comments_380702.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2016-06-26T20:56:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20731#issuecomment-380702",
    "user": "https://github.com/videlec"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_380703.json:
```json
{
    "body": "<a id='comment:34'></a>\nReplying to [tscrim](#comment%3A32):\n> I'm not quite sure without looking through it. It might be something at a lower level than Sage.\n\n\nI really do not understand this comment.\n\n> However, this needs rebasing.\n\n\nThis I understood. Done!",
    "created_at": "2016-06-26T20:56:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20731#issuecomment-380703",
    "user": "https://github.com/videlec"
}
```

<a id='comment:34'></a>
Replying to [tscrim](#comment%3A32):
> I'm not quite sure without looking through it. It might be something at a lower level than Sage.


I really do not understand this comment.

> However, this needs rebasing.


This I understood. Done!



---

archive/issue_comments_380704.json:
```json
{
    "body": "<a id='comment:35'></a>\nReplying to [vdelecroix](#comment%3A34):\n> Replying to [tscrim](#comment%3A32):\n> > I'm not quite sure without looking through it. It might be something at a lower level than Sage.\n\n> \n> I really do not understand this comment.\n\n\nThis was in reference to[comment:31](#comment%3A31), where I was thinking the issue with the time difference might be something in mpz instead of something we are doing in Sage. It might be better to take the faster version and utilize that addition/multiplication is commutative to get that extra little bit of speed.",
    "created_at": "2016-06-26T21:29:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20731#issuecomment-380704",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:35'></a>
Replying to [vdelecroix](#comment%3A34):
> Replying to [tscrim](#comment%3A32):
> > I'm not quite sure without looking through it. It might be something at a lower level than Sage.

> 
> I really do not understand this comment.


This was in reference to[comment:31](#comment%3A31), where I was thinking the issue with the time difference might be something in mpz instead of something we are doing in Sage. It might be better to take the faster version and utilize that addition/multiplication is commutative to get that extra little bit of speed.



---

archive/issue_comments_380705.json:
```json
{
    "body": "<a id='comment:36'></a>\nReplying to [tscrim](#comment%3A35):\n> Replying to [vdelecroix](#comment%3A34):\n> > Replying to [tscrim](#comment%3A32):\n> > > I'm not quite sure without looking through it. It might be something at a lower level than Sage.\n\n> > \n> > I really do not understand this comment.\n\n> \n> This was in reference to[comment:31](#comment%3A31), where I was thinking the issue with the time difference might be something in mpz instead of something we are doing in Sage. It might be better to take the faster version and utilize that addition/multiplication is commutative to get that extra little bit of speed.\n\n\nThere is no fundamental difference between `z+q` and `q+z`. The code is copy paste calling the very same functions. [comment:31](#comment%3A31) is just something that I do not understand.",
    "created_at": "2016-06-27T05:45:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20731#issuecomment-380705",
    "user": "https://github.com/videlec"
}
```

<a id='comment:36'></a>
Replying to [tscrim](#comment%3A35):
> Replying to [vdelecroix](#comment%3A34):
> > Replying to [tscrim](#comment%3A32):
> > > I'm not quite sure without looking through it. It might be something at a lower level than Sage.

> > 
> > I really do not understand this comment.

> 
> This was in reference to[comment:31](#comment%3A31), where I was thinking the issue with the time difference might be something in mpz instead of something we are doing in Sage. It might be better to take the faster version and utilize that addition/multiplication is commutative to get that extra little bit of speed.


There is no fundamental difference between `z+q` and `q+z`. The code is copy paste calling the very same functions. [comment:31](#comment%3A31) is just something that I do not understand.



---

archive/issue_comments_380706.json:
```json
{
    "body": "**Reviewer:** Jeroen Demeyer, Travis Scrimshaw",
    "created_at": "2016-06-27T13:58:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20731#issuecomment-380706",
    "user": "https://github.com/tscrim"
}
```

**Reviewer:** Jeroen Demeyer, Travis Scrimshaw



---

archive/issue_comments_380707.json:
```json
{
    "body": "<a id='comment:37'></a>\nAh, I see it now. I guess the only difference is checking `isinstance` for `Integer` is longer than that of `Rational` because of a longer MRO:\n\n```\nsage: p = 2\nsage: p.__class__.__mro__\n(<type 'sage.rings.integer.Integer'>,\n <type 'sage.structure.element.EuclideanDomainElement'>,\n <type 'sage.structure.element.PrincipalIdealDomainElement'>,\n <type 'sage.structure.element.DedekindDomainElement'>,\n <type 'sage.structure.element.IntegralDomainElement'>,\n <type 'sage.structure.element.CommutativeRingElement'>,\n <type 'sage.structure.element.RingElement'>,\n <type 'sage.structure.element.ModuleElement'>,\n <type 'sage.structure.element.Element'>,\n <type 'sage.structure.sage_object.SageObject'>,\n <type 'object'>)\nsage: q = 2/3\nsage: q.__class__.__mro__\n(<type 'sage.rings.rational.Rational'>,\n <type 'sage.structure.element.FieldElement'>,\n <type 'sage.structure.element.CommutativeRingElement'>,\n <type 'sage.structure.element.RingElement'>,\n <type 'sage.structure.element.ModuleElement'>,\n <type 'sage.structure.element.Element'>,\n <type 'sage.structure.sage_object.SageObject'>,\n <type 'object'>)\n```\n\nI'm happy with this ticket as-is. Jeroen, any more comments?",
    "created_at": "2016-06-27T13:58:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20731#issuecomment-380707",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:37'></a>
Ah, I see it now. I guess the only difference is checking `isinstance` for `Integer` is longer than that of `Rational` because of a longer MRO:

```
sage: p = 2
sage: p.__class__.__mro__
(<type 'sage.rings.integer.Integer'>,
 <type 'sage.structure.element.EuclideanDomainElement'>,
 <type 'sage.structure.element.PrincipalIdealDomainElement'>,
 <type 'sage.structure.element.DedekindDomainElement'>,
 <type 'sage.structure.element.IntegralDomainElement'>,
 <type 'sage.structure.element.CommutativeRingElement'>,
 <type 'sage.structure.element.RingElement'>,
 <type 'sage.structure.element.ModuleElement'>,
 <type 'sage.structure.element.Element'>,
 <type 'sage.structure.sage_object.SageObject'>,
 <type 'object'>)
sage: q = 2/3
sage: q.__class__.__mro__
(<type 'sage.rings.rational.Rational'>,
 <type 'sage.structure.element.FieldElement'>,
 <type 'sage.structure.element.CommutativeRingElement'>,
 <type 'sage.structure.element.RingElement'>,
 <type 'sage.structure.element.ModuleElement'>,
 <type 'sage.structure.element.Element'>,
 <type 'sage.structure.sage_object.SageObject'>,
 <type 'object'>)
```

I'm happy with this ticket as-is. Jeroen, any more comments?



---

archive/issue_comments_380708.json:
```json
{
    "body": "<a id='comment:38'></a>\nOne way to shortcut the `isinstance(right, Rational)` is to instead do `type(right) is Rational`. That would actually be the fastest. (And it will still work with an element that inherits from `Rational` since `_add_`, `_mul_` etc are properly implemented.) What do you think?",
    "created_at": "2016-07-08T20:37:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20731#issuecomment-380708",
    "user": "https://github.com/videlec"
}
```

<a id='comment:38'></a>
One way to shortcut the `isinstance(right, Rational)` is to instead do `type(right) is Rational`. That would actually be the fastest. (And it will still work with an element that inherits from `Rational` since `_add_`, `_mul_` etc are properly implemented.) What do you think?



---

archive/issue_comments_380709.json:
```json
{
    "body": "<a id='comment:39'></a>\nI was originally thinking that we should keep it as `isinstance`, but since we explicitly construct a new `Rational` (and I don't think it could be made to work with subtypes [easily]), I think we should only test against `Rational`. Plus those extra little nanoseconds can matter at this level. Subclasses can just fall into the coercion framework.",
    "created_at": "2016-07-09T19:19:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20731#issuecomment-380709",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:39'></a>
I was originally thinking that we should keep it as `isinstance`, but since we explicitly construct a new `Rational` (and I don't think it could be made to work with subtypes [easily]), I think we should only test against `Rational`. Plus those extra little nanoseconds can matter at this level. Subclasses can just fall into the coercion framework.



---

archive/issue_comments_380710.json:
```json
{
    "body": "<a id='comment:40'></a>\nhum... with `isinstance(X,Y)`\n\n```\nsage: %timeit z+q                                                              \n1000000 loops, best of 3: 242 ns per loop\nsage: %timeit q+z                                                              \n1000000 loops, best of 3: 306 ns per loop\n```\nwith `type(X) is Y`\n\n```\nsage: %timeit z+q\n1000000 loops, best of 3: 243 ns per loop                                      \nsage: %timeit q+z\n1000000 loops, best of 3: 334 ns per loop\n```",
    "created_at": "2016-07-09T20:35:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20731#issuecomment-380710",
    "user": "https://github.com/videlec"
}
```

<a id='comment:40'></a>
hum... with `isinstance(X,Y)`

```
sage: %timeit z+q                                                              
1000000 loops, best of 3: 242 ns per loop
sage: %timeit q+z                                                              
1000000 loops, best of 3: 306 ns per loop
```
with `type(X) is Y`

```
sage: %timeit z+q
1000000 loops, best of 3: 243 ns per loop                                      
sage: %timeit q+z
1000000 loops, best of 3: 334 ns per loop
```



---

archive/issue_comments_380711.json:
```json
{
    "body": "<a id='comment:41'></a>\nIndependent time testing with a Cython class (without inheritance)\n\n|  code | relative time |\n|:-------:|:---------------:|\n| `type(a) == A`      | 10500000ns|\n| `isinstance(a,A)`   |   559000ns|\n| `type(a) is A`      |       55ns|\n\nI guess something else is happening with `z+q` versus `q+z`...",
    "created_at": "2016-07-09T20:50:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20731#issuecomment-380711",
    "user": "https://github.com/videlec"
}
```

<a id='comment:41'></a>
Independent time testing with a Cython class (without inheritance)

|  code | relative time |
|:-------:|:---------------:|
| `type(a) == A`      | 10500000ns|
| `isinstance(a,A)`   |   559000ns|
| `type(a) is A`      |       55ns|

I guess something else is happening with `z+q` versus `q+z`...



---

archive/issue_comments_380712.json:
```json
{
    "body": "<a id='comment:42'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dd2defb5ddf707d2dc5a84419a41fdbcd5c75a30\">dd2defb</a></td><td><code>Trac 20731: isinstance(X,Y) -> type(X) is Y</code></td></tr></table>\n",
    "created_at": "2016-07-09T20:51:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20731#issuecomment-380712",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:42'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dd2defb5ddf707d2dc5a84419a41fdbcd5c75a30">dd2defb</a></td><td><code>Trac 20731: isinstance(X,Y) -> type(X) is Y</code></td></tr></table>




---

archive/issue_comments_380713.json:
```json
{
    "body": "**Changing commit** from \"[1a93a12c39522dbe60b958757e2e3922aa9c23ed](https://github.com/sagemath/sagetrac-mirror/commit/1a93a12c39522dbe60b958757e2e3922aa9c23ed)\" to \"[dd2defb5ddf707d2dc5a84419a41fdbcd5c75a30](https://github.com/sagemath/sagetrac-mirror/commit/dd2defb5ddf707d2dc5a84419a41fdbcd5c75a30)\".",
    "created_at": "2016-07-09T20:51:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20731#issuecomment-380713",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[1a93a12c39522dbe60b958757e2e3922aa9c23ed](https://github.com/sagemath/sagetrac-mirror/commit/1a93a12c39522dbe60b958757e2e3922aa9c23ed)" to "[dd2defb5ddf707d2dc5a84419a41fdbcd5c75a30](https://github.com/sagemath/sagetrac-mirror/commit/dd2defb5ddf707d2dc5a84419a41fdbcd5c75a30)".



---

archive/issue_comments_380714.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2016-07-10T18:01:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20731#issuecomment-380714",
    "user": "https://github.com/tscrim"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_380715.json:
```json
{
    "body": "<a id='comment:43'></a>\nThat really suggests that it has to do with the MRO length (comment:37), but I am somewhat surprised that does matter. Well, this is a definite improvement and should get into 7.3.",
    "created_at": "2016-07-10T18:01:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20731#issuecomment-380715",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:43'></a>
That really suggests that it has to do with the MRO length (comment:37), but I am somewhat surprised that does matter. Well, this is a definite improvement and should get into 7.3.



---

archive/issue_comments_380716.json:
```json
{
    "body": "**Changing status** from positive_review to needs_work.",
    "created_at": "2016-07-10T21:44:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20731#issuecomment-380716",
    "user": "https://github.com/vbraun"
}
```

**Changing status** from positive_review to needs_work.



---

archive/issue_comments_380717.json:
```json
{
    "body": "<a id='comment:44'></a>\n\n```\nsage -t --long src/sage/repl/interpreter.py\n**********************************************************************\nFile \"src/sage/repl/interpreter.py\", line 77, in sage.repl.interpreter\nFailed example:\n    shell.run_cell('1/0')\nExpected:\n    ---------------------------------------------------------------------------\n    ZeroDivisionError                         Traceback (most recent call last)\n    <ipython-input-...> in <module>()\n    ----> 1 Integer(1)/Integer(0)\n    <BLANKLINE>\n    .../src/sage/rings/integer.pyx in sage.rings.integer.Integer.__div__ (build/cythonized/sage/rings/integer.c:...)()\n       ...          if type(left) is type(right):\n       ...              if mpz_sgn((<Integer>right).value) == 0:\n    -> ...                  raise ZeroDivisionError(\"rational division by zero\")\n       ...              x = <Rational> Rational.__new__(Rational)\n       ...              mpq_div_zz(x.value, (<Integer>left).value, (<Integer>right).value)\n    <BLANKLINE>\n    ZeroDivisionError: rational division by zero\nGot:\n    ---------------------------------------------------------------------------\n    ZeroDivisionError                         Traceback (most recent call last)\n    <ipython-input-1-6f88eab09598> in <module>()\n    ----> 1 Integer(1)/Integer(0)\n    <BLANKLINE>\n    /home/buildslave-sage/slave/sage_git/build/src/sage/rings/integer.pyx in sage.rings.integer.Integer.__div__ (/home/buildslave-sage/slave/sage_git/build/src/build/cythonized/sage/rings/integer.c:12882)()\n       1841         if type(left) is type(right):\n       1842             if mpz_sgn((<Integer>right).value) == 0:\n    -> 1843                 raise ZeroDivisionError(\"rational division by zero\")\n       1844             x = <Rational> Rational.__new__(Rational)\n       1845             mpq_div_zz(x.value, (<Integer>left).value, (<Integer>right).value)\n    <BLANKLINE>\n    ZeroDivisionError: rational division by zero\n**********************************************************************\n1 item had failures:\n   1 of   5 in sage.repl.interpreter\n    [133 tests, 1 failure, 3.60 s]\n```",
    "created_at": "2016-07-10T21:44:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20731#issuecomment-380717",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:44'></a>

```
sage -t --long src/sage/repl/interpreter.py
**********************************************************************
File "src/sage/repl/interpreter.py", line 77, in sage.repl.interpreter
Failed example:
    shell.run_cell('1/0')
Expected:
    ---------------------------------------------------------------------------
    ZeroDivisionError                         Traceback (most recent call last)
    <ipython-input-...> in <module>()
    ----> 1 Integer(1)/Integer(0)
    <BLANKLINE>
    .../src/sage/rings/integer.pyx in sage.rings.integer.Integer.__div__ (build/cythonized/sage/rings/integer.c:...)()
       ...          if type(left) is type(right):
       ...              if mpz_sgn((<Integer>right).value) == 0:
    -> ...                  raise ZeroDivisionError("rational division by zero")
       ...              x = <Rational> Rational.__new__(Rational)
       ...              mpq_div_zz(x.value, (<Integer>left).value, (<Integer>right).value)
    <BLANKLINE>
    ZeroDivisionError: rational division by zero
Got:
    ---------------------------------------------------------------------------
    ZeroDivisionError                         Traceback (most recent call last)
    <ipython-input-1-6f88eab09598> in <module>()
    ----> 1 Integer(1)/Integer(0)
    <BLANKLINE>
    /home/buildslave-sage/slave/sage_git/build/src/sage/rings/integer.pyx in sage.rings.integer.Integer.__div__ (/home/buildslave-sage/slave/sage_git/build/src/build/cythonized/sage/rings/integer.c:12882)()
       1841         if type(left) is type(right):
       1842             if mpz_sgn((<Integer>right).value) == 0:
    -> 1843                 raise ZeroDivisionError("rational division by zero")
       1844             x = <Rational> Rational.__new__(Rational)
       1845             mpq_div_zz(x.value, (<Integer>left).value, (<Integer>right).value)
    <BLANKLINE>
    ZeroDivisionError: rational division by zero
**********************************************************************
1 item had failures:
   1 of   5 in sage.repl.interpreter
    [133 tests, 1 failure, 3.60 s]
```



---

archive/issue_comments_380718.json:
```json
{
    "body": "<a id='comment:45'></a>\nDear Volker,\n\nI am not able to reproduce this... could you tell us on which kind of configuration you obtained that?\n\nVincent",
    "created_at": "2016-07-11T16:15:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20731#issuecomment-380718",
    "user": "https://github.com/videlec"
}
```

<a id='comment:45'></a>
Dear Volker,

I am not able to reproduce this... could you tell us on which kind of configuration you obtained that?

Vincent



---

archive/issue_comments_380719.json:
```json
{
    "body": "<a id='comment:46'></a>\nI think the test is just fragile:\n\n```\n    .../src/sage/rings/integer.pyx in sage.rings.integer.Integer.__div__ (build/cythonized/sage/rings/integer.c:...)()\n```\nvs the actual output:\n\n```\n    /home/buildslave-sage/slave/sage_git/build/src/sage/rings/integer.pyx in sage.rings.integer.Integer.__div__ (/home/buildslave-sage/slave/sage_git/build/src/build/cythonized/sage/rings/integer.c:12882)()\n```\nNote the path is `.../build/src/...` and compare with the previous doctest output format.",
    "created_at": "2016-07-15T20:00:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20731#issuecomment-380719",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:46'></a>
I think the test is just fragile:

```
    .../src/sage/rings/integer.pyx in sage.rings.integer.Integer.__div__ (build/cythonized/sage/rings/integer.c:...)()
```
vs the actual output:

```
    /home/buildslave-sage/slave/sage_git/build/src/sage/rings/integer.pyx in sage.rings.integer.Integer.__div__ (/home/buildslave-sage/slave/sage_git/build/src/build/cythonized/sage/rings/integer.c:12882)()
```
Note the path is `.../build/src/...` and compare with the previous doctest output format.



---

archive/issue_comments_380720.json:
```json
{
    "body": "<a id='comment:47'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d535aee38e629195fa6319a8a1d1d2efaecebec6\">d535aee</a></td><td><code>Trac 20731: fix doctest</code></td></tr></table>\n",
    "created_at": "2016-07-22T22:41:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20731#issuecomment-380720",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:47'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d535aee38e629195fa6319a8a1d1d2efaecebec6">d535aee</a></td><td><code>Trac 20731: fix doctest</code></td></tr></table>




---

archive/issue_comments_380721.json:
```json
{
    "body": "**Changing commit** from \"[dd2defb5ddf707d2dc5a84419a41fdbcd5c75a30](https://github.com/sagemath/sagetrac-mirror/commit/dd2defb5ddf707d2dc5a84419a41fdbcd5c75a30)\" to \"[d535aee38e629195fa6319a8a1d1d2efaecebec6](https://github.com/sagemath/sagetrac-mirror/commit/d535aee38e629195fa6319a8a1d1d2efaecebec6)\".",
    "created_at": "2016-07-22T22:41:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20731#issuecomment-380721",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[dd2defb5ddf707d2dc5a84419a41fdbcd5c75a30](https://github.com/sagemath/sagetrac-mirror/commit/dd2defb5ddf707d2dc5a84419a41fdbcd5c75a30)" to "[d535aee38e629195fa6319a8a1d1d2efaecebec6](https://github.com/sagemath/sagetrac-mirror/commit/d535aee38e629195fa6319a8a1d1d2efaecebec6)".



---

archive/issue_comments_380722.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2016-07-22T22:42:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20731#issuecomment-380722",
    "user": "https://github.com/videlec"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_380723.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2016-07-22T22:47:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20731#issuecomment-380723",
    "user": "https://github.com/tscrim"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_380724.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2016-07-23T18:38:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20731#issuecomment-380724",
    "user": "https://github.com/vbraun"
}
```

**Resolution:** fixed



---

archive/issue_events_063359.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-07-23T18:38:25Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/20731",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20731#event-63359"
}
```



---

archive/issue_comments_380725.json:
```json
{
    "body": "**Changing branch** from \"[u/vdelecroix/20731](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/20731)\" to \"[d535aee38e629195fa6319a8a1d1d2efaecebec6](https://github.com/sagemath/sagetrac-mirror/commit/d535aee38e629195fa6319a8a1d1d2efaecebec6)\".",
    "created_at": "2016-07-23T18:38:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20731#issuecomment-380725",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/vdelecroix/20731](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/20731)" to "[d535aee38e629195fa6319a8a1d1d2efaecebec6](https://github.com/sagemath/sagetrac-mirror/commit/d535aee38e629195fa6319a8a1d1d2efaecebec6)".
