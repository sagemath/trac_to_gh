# Issue 20731: shortcut coercion for Integer-Rational operations

archive/issues_020494.json:
```json
{
    "assignees": [],
    "body": "Doing some shortcut to coercion actually fasten the code by a factor 3...\n\nOld version\n\n```\nsage: z = 2\nsage: q = QQ((-1,5))\nsage: %timeit z + q\n1000000 loops, best of 3: 930 ns per loop\nsage: %timeit q + z\n1000000 loops, best of 3: 930 ns per loop\nsage: %timeit z - q\n1000000 loops, best of 3: 848 ns per loop\nsage: %timeit q - z\n1000000 loops, best of 3: 776 ns per loop\nsage: %timeit z * q\n1000000 loops, best of 3: 1.15 \u00b5s per loop\nsage: %timeit q * z\n1000000 loops, best of 3: 1.17 \u00b5s per loop\nsage: %timeit z / q\n1000000 loops, best of 3: 1.09 \u00b5s per loop\nsage: %timeit q / z\n1000000 loops, best of 3: 1.1 \u00b5s per loop\n```\nNew version\n\n```\nsage: z = 2\nsage: q = QQ((-1,5))\nsage: %timeit z + q\n1000000 loops, best of 3: 265 ns per loop\nsage: %timeit q + z\n1000000 loops, best of 3: 323 ns per loop\nsage: %timeit z - q\n1000000 loops, best of 3: 261 ns per loop\nsage: %timeit q - z\n1000000 loops, best of 3: 319 ns per loop\nsage: %timeit z * q\n1000000 loops, best of 3: 255 ns per loop\nsage: %timeit q * z\n1000000 loops, best of 3: 332 ns per loop\nsage: %timeit z / q\n1000000 loops, best of 3: 289 ns per loop\nsage: %timeit q / z\n1000000 loops, best of 3: 314 ns per loop\n```\n\nCC:  @jdemeyer\n\nKeywords: **days74**\n\nBranch/Commit: **[d535aee](https://github.com/sagemath/sagetrac-mirror/commit/d535aee38e629195fa6319a8a1d1d2efaecebec6)**\n\nReviewer: **Jeroen Demeyer, Travis Scrimshaw**\n\nAuthor: **Vincent Delecroix**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/20731_\n\n",
    "closed_at": "2016-07-23T18:38:25Z",
    "created_at": "2016-05-31T13:38:42Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20coercion",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-7.3",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "shortcut coercion for Integer-Rational operations",
    "type": "issue",
    "updated_at": "2016-07-23T18:38:25Z",
    "url": "https://github.com/sagemath/sage/issues/20731",
    "user": "https://github.com/videlec"
}
```
Doing some shortcut to coercion actually fasten the code by a factor 3...

Old version

```
sage: z = 2
sage: q = QQ((-1,5))
sage: %timeit z + q
1000000 loops, best of 3: 930 ns per loop
sage: %timeit q + z
1000000 loops, best of 3: 930 ns per loop
sage: %timeit z - q
1000000 loops, best of 3: 848 ns per loop
sage: %timeit q - z
1000000 loops, best of 3: 776 ns per loop
sage: %timeit z * q
1000000 loops, best of 3: 1.15 µs per loop
sage: %timeit q * z
1000000 loops, best of 3: 1.17 µs per loop
sage: %timeit z / q
1000000 loops, best of 3: 1.09 µs per loop
sage: %timeit q / z
1000000 loops, best of 3: 1.1 µs per loop
```
New version

```
sage: z = 2
sage: q = QQ((-1,5))
sage: %timeit z + q
1000000 loops, best of 3: 265 ns per loop
sage: %timeit q + z
1000000 loops, best of 3: 323 ns per loop
sage: %timeit z - q
1000000 loops, best of 3: 261 ns per loop
sage: %timeit q - z
1000000 loops, best of 3: 319 ns per loop
sage: %timeit z * q
1000000 loops, best of 3: 255 ns per loop
sage: %timeit q * z
1000000 loops, best of 3: 332 ns per loop
sage: %timeit z / q
1000000 loops, best of 3: 289 ns per loop
sage: %timeit q / z
1000000 loops, best of 3: 314 ns per loop
```

CC:  @jdemeyer

Keywords: **days74**

Branch/Commit: **[d535aee](https://github.com/sagemath/sagetrac-mirror/commit/d535aee38e629195fa6319a8a1d1d2efaecebec6)**

Reviewer: **Jeroen Demeyer, Travis Scrimshaw**

Author: **Vincent Delecroix**

_Issue created by migration from https://trac.sagemath.org/ticket/20731_





---

archive/issue_events_264122.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2016-05-31T13:38:42Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "milestone_number": null,
    "milestone_title": "sage-7.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20731#event-264122"
}
```



---

archive/issue_events_264123.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2016-05-31T13:38:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20coercion",
    "label_color": "0000ff",
    "label_name": "component: coercion",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20731#event-264123"
}
```



---

archive/issue_events_264124.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2016-05-31T13:38:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20731#event-264124"
}
```



---

archive/issue_events_264125.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2016-05-31T13:38:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20731#event-264125"
}
```



---

archive/issue_comments_302834.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,18 +1,26 @@\n-Doing some shortcut to coercion actually fasten the code\n+Doing some shortcut to coercion actually fasten the code by a factor 3...\n \n Old version\n \n ```\n sage: z = 2\n sage: q = QQ((-1,5))\n-sage: %timeit z + q\n-sage: %timeit q + z\n-sage: %timeit z - q\n-sage: %timeit q - z\n-sage: %timeit z * q\n-sage: %timeit q * z\n-sage: %timeit z / q\n-sage: %timeit q / z\n+sage: sage: %timeit z + q\n+1000000 loops, best of 3: 930 ns per loop\n+sage: sage: %timeit q + z\n+1000000 loops, best of 3: 930 ns per loop\n+sage: sage: %timeit z - q\n+1000000 loops, best of 3: 848 ns per loop\n+sage: sage: %timeit q - z\n+1000000 loops, best of 3: 776 ns per loop\n+sage: sage: %timeit z * q\n+1000000 loops, best of 3: 1.15 \u00b5s per loop\n+sage: sage: %timeit q * z\n+1000000 loops, best of 3: 1.17 \u00b5s per loop\n+sage: sage: %timeit z / q\n+1000000 loops, best of 3: 1.09 \u00b5s per loop\n+sage: sage: %timeit q / z\n+1000000 loops, best of 3: 1.1 \u00b5s per loop\n ```\n New version\n \n``````\n",
    "created_at": "2016-05-31T13:44:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20731#issuecomment-302834",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,18 +1,26 @@
-Doing some shortcut to coercion actually fasten the code
+Doing some shortcut to coercion actually fasten the code by a factor 3...
 
 Old version
 
 ```
 sage: z = 2
 sage: q = QQ((-1,5))
-sage: %timeit z + q
-sage: %timeit q + z
-sage: %timeit z - q
-sage: %timeit q - z
-sage: %timeit z * q
-sage: %timeit q * z
-sage: %timeit z / q
-sage: %timeit q / z
+sage: sage: %timeit z + q
+1000000 loops, best of 3: 930 ns per loop
+sage: sage: %timeit q + z
+1000000 loops, best of 3: 930 ns per loop
+sage: sage: %timeit z - q
+1000000 loops, best of 3: 848 ns per loop
+sage: sage: %timeit q - z
+1000000 loops, best of 3: 776 ns per loop
+sage: sage: %timeit z * q
+1000000 loops, best of 3: 1.15 µs per loop
+sage: sage: %timeit q * z
+1000000 loops, best of 3: 1.17 µs per loop
+sage: sage: %timeit z / q
+1000000 loops, best of 3: 1.09 µs per loop
+sage: sage: %timeit q / z
+1000000 loops, best of 3: 1.1 µs per loop
 ```
 New version
 
``````




---

archive/issue_comments_302835.json:
```json
{
    "body": "Branch: **[u/vdelecroix/20731](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/20731)**",
    "created_at": "2016-05-31T13:44:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20731#issuecomment-302835",
    "user": "https://github.com/videlec"
}
```

Branch: **[u/vdelecroix/20731](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/20731)**



---

archive/issue_events_264126.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2016-05-31T13:44:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20731#event-264126"
}
```



---

archive/issue_comments_302836.json:
```json
{
    "body": "<a id='comment:2'>Comment 2:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/33f9fd432ff127a5234b120bebda1f7b63bb0f84\">33f9fd4</a></td><td><code>Trac 20731: shortcut coercion for Integer-Rational</code></td></tr></table>\n",
    "created_at": "2016-05-31T13:44:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20731#issuecomment-302836",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:2'>Comment 2:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/33f9fd432ff127a5234b120bebda1f7b63bb0f84">33f9fd4</a></td><td><code>Trac 20731: shortcut coercion for Integer-Rational</code></td></tr></table>




---

archive/issue_comments_302837.json:
```json
{
    "body": "Commit: **[33f9fd4](https://github.com/sagemath/sagetrac-mirror/commit/33f9fd432ff127a5234b120bebda1f7b63bb0f84)**",
    "created_at": "2016-05-31T13:44:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20731#issuecomment-302837",
    "user": "https://github.com/sagetrac-git"
}
```

Commit: **[33f9fd4](https://github.com/sagemath/sagetrac-mirror/commit/33f9fd432ff127a5234b120bebda1f7b63bb0f84)**



---

archive/issue_comments_302838.json:
```json
{
    "body": "Changed commit from **[33f9fd4](https://github.com/sagemath/sagetrac-mirror/commit/33f9fd432ff127a5234b120bebda1f7b63bb0f84)** to **[19c075b](https://github.com/sagemath/sagetrac-mirror/commit/19c075bf18073049fea1607b483c591feef7df22)**",
    "created_at": "2016-05-31T19:20:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20731#issuecomment-302838",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[33f9fd4](https://github.com/sagemath/sagetrac-mirror/commit/33f9fd432ff127a5234b120bebda1f7b63bb0f84)** to **[19c075b](https://github.com/sagemath/sagetrac-mirror/commit/19c075bf18073049fea1607b483c591feef7df22)**



---

archive/issue_comments_302839.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/19c075bf18073049fea1607b483c591feef7df22\">19c075b</a></td><td><code>Trac 20731: fix doctests</code></td></tr></table>\n",
    "created_at": "2016-05-31T19:20:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20731#issuecomment-302839",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:3'>Comment 3:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/19c075bf18073049fea1607b483c591feef7df22">19c075b</a></td><td><code>Trac 20731: fix doctests</code></td></tr></table>




---

archive/issue_comments_302840.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nMove `src/sage/rings/binop.pyx` to `src/sage/libs/gmp` since it has nothing to with rings. And I would just use a `.pxd` file with inline functions, no `.pyx` file.",
    "created_at": "2016-06-01T08:21:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20731#issuecomment-302840",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:4'>Comment 4:</a>
Move `src/sage/rings/binop.pyx` to `src/sage/libs/gmp` since it has nothing to with rings. And I would just use a `.pxd` file with inline functions, no `.pyx` file.



---

archive/issue_comments_302841.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fdf79acfa3433ef167ee3e865c16dd429caf24e6\">fdf79ac</a></td><td><code>Trac 20731: get rid of ZZ._div</code></td></tr></table>\n",
    "created_at": "2016-06-01T08:26:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20731#issuecomment-302841",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:5'>Comment 5:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fdf79acfa3433ef167ee3e865c16dd429caf24e6">fdf79ac</a></td><td><code>Trac 20731: get rid of ZZ._div</code></td></tr></table>




---

archive/issue_comments_302842.json:
```json
{
    "body": "Changed commit from **[19c075b](https://github.com/sagemath/sagetrac-mirror/commit/19c075bf18073049fea1607b483c591feef7df22)** to **[fdf79ac](https://github.com/sagemath/sagetrac-mirror/commit/fdf79acfa3433ef167ee3e865c16dd429caf24e6)**",
    "created_at": "2016-06-01T08:26:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20731#issuecomment-302842",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[19c075b](https://github.com/sagemath/sagetrac-mirror/commit/19c075bf18073049fea1607b483c591feef7df22)** to **[fdf79ac](https://github.com/sagemath/sagetrac-mirror/commit/fdf79acfa3433ef167ee3e865c16dd429caf24e6)**



---

archive/issue_comments_302843.json:
```json
{
    "body": "Changed commit from **[fdf79ac](https://github.com/sagemath/sagetrac-mirror/commit/fdf79acfa3433ef167ee3e865c16dd429caf24e6)** to **[eec4168](https://github.com/sagemath/sagetrac-mirror/commit/eec41681c0fc9bb3b377ad67a31634a40d277782)**",
    "created_at": "2016-06-01T08:30:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20731#issuecomment-302843",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[fdf79ac](https://github.com/sagemath/sagetrac-mirror/commit/fdf79acfa3433ef167ee3e865c16dd429caf24e6)** to **[eec4168](https://github.com/sagemath/sagetrac-mirror/commit/eec41681c0fc9bb3b377ad67a31634a40d277782)**



---

archive/issue_comments_302844.json:
```json
{
    "body": "<a id='comment:6'>Comment 6:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9078830d92c33d8a2e06ebb065e113e97a31d0e1\">9078830</a></td><td><code>Trac 20731: moving binop</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/eec41681c0fc9bb3b377ad67a31634a40d277782\">eec4168</a></td><td><code>Trac 20731: fix the move</code></td></tr></table>\n",
    "created_at": "2016-06-01T08:30:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20731#issuecomment-302844",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:6'>Comment 6:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9078830d92c33d8a2e06ebb065e113e97a31d0e1">9078830</a></td><td><code>Trac 20731: moving binop</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/eec41681c0fc9bb3b377ad67a31634a40d277782">eec4168</a></td><td><code>Trac 20731: fix the move</code></td></tr></table>




---

archive/issue_comments_302845.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nI think that `mpq_mul_z` and `mpq_div_z` are overkill. Why don't you just multiply the numerator or denominator with the integer and call `mpq_canonicalize`, similar to what you do for `Integer/Integer` division?",
    "created_at": "2016-06-01T15:52:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20731#issuecomment-302845",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:7'>Comment 7:</a>
I think that `mpq_mul_z` and `mpq_div_z` are overkill. Why don't you just multiply the numerator or denominator with the integer and call `mpq_canonicalize`, similar to what you do for `Integer/Integer` division?



---

archive/issue_events_264127.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-06-01T15:52:51Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20731#event-264127"
}
```



---

archive/issue_events_264128.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-06-01T15:52:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20731#event-264128"
}
```



---

archive/issue_comments_302846.json:
```json
{
    "body": "<a id='comment:8'>Comment 8:</a>\n`QQ((2^100, 3^100)) * 3^100`",
    "created_at": "2016-06-01T16:24:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20731#issuecomment-302846",
    "user": "https://github.com/videlec"
}
```

<a id='comment:8'>Comment 8:</a>
`QQ((2^100, 3^100)) * 3^100`



---

archive/issue_comments_302847.json:
```json
{
    "body": "<a id='comment:9'>Comment 9:</a>\nRight, but that's a rather artificial example. What about simple cases?",
    "created_at": "2016-06-01T16:28:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20731#issuecomment-302847",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:9'>Comment 9:</a>
Right, but that's a rather artificial example. What about simple cases?



---

archive/issue_comments_302848.json:
```json
{
    "body": "<a id='comment:10'>Comment 10:</a>\nIn `src/sage/repl/interpreter.py`, there is a good reason that the line numbers were changed to `...`",
    "created_at": "2016-06-01T16:30:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20731#issuecomment-302848",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:10'>Comment 10:</a>
In `src/sage/repl/interpreter.py`, there is a good reason that the line numbers were changed to `...`



---

archive/issue_comments_302849.json:
```json
{
    "body": "<a id='comment:11'>Comment 11:</a>\nI just thought about the following very simple algorithm for the multiplication (division is analogous):\n\nTo compute `(A/B) * C`, you initialize the result as `C/B`, canonicalize it and then multiply the numerator by `A`.\n\nYou don't need to canonicalize the final result, since `gcd(A,B) = 1` by assumption.",
    "created_at": "2016-06-01T19:55:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20731#issuecomment-302849",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:11'>Comment 11:</a>
I just thought about the following very simple algorithm for the multiplication (division is analogous):

To compute `(A/B) * C`, you initialize the result as `C/B`, canonicalize it and then multiply the numerator by `A`.

You don't need to canonicalize the final result, since `gcd(A,B) = 1` by assumption.



---

archive/issue_comments_302850.json:
```json
{
    "body": "<a id='comment:12'>Comment 12:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/72f77b99ad55fd2ba186d33c69010214fa569405\">72f77b9</a></td><td><code>Trac 20731: simpler operations</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c7a8d8e5b44d49654aab2827f3b5359f4c7acd60\">c7a8d8e</a></td><td><code>20731: simpler mpq_mul_z/mpq_div_z</code></td></tr></table>\n",
    "created_at": "2016-06-02T02:44:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20731#issuecomment-302850",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:12'>Comment 12:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/72f77b99ad55fd2ba186d33c69010214fa569405">72f77b9</a></td><td><code>Trac 20731: simpler operations</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c7a8d8e5b44d49654aab2827f3b5359f4c7acd60">c7a8d8e</a></td><td><code>20731: simpler mpq_mul_z/mpq_div_z</code></td></tr></table>




---

archive/issue_comments_302851.json:
```json
{
    "body": "Changed commit from **[eec4168](https://github.com/sagemath/sagetrac-mirror/commit/eec41681c0fc9bb3b377ad67a31634a40d277782)** to **[c7a8d8e](https://github.com/sagemath/sagetrac-mirror/commit/c7a8d8e5b44d49654aab2827f3b5359f4c7acd60)**",
    "created_at": "2016-06-02T02:44:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20731#issuecomment-302851",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[eec4168](https://github.com/sagemath/sagetrac-mirror/commit/eec41681c0fc9bb3b377ad67a31634a40d277782)** to **[c7a8d8e](https://github.com/sagemath/sagetrac-mirror/commit/c7a8d8e5b44d49654aab2827f3b5359f4c7acd60)**



---

archive/issue_events_264129.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2016-06-02T07:19:23Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20731#event-264129"
}
```



---

archive/issue_events_264130.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2016-06-02T07:19:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20731#event-264130"
}
```



---

archive/issue_comments_302852.json:
```json
{
    "body": "<a id='comment:14'>Comment 14:</a>\n[comment:10]",
    "created_at": "2016-06-02T08:13:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20731#issuecomment-302852",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:14'>Comment 14:</a>
[comment:10]



---

archive/issue_events_264131.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-06-02T08:13:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20731#event-264131"
}
```



---

archive/issue_events_264132.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-06-02T08:13:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20731#event-264132"
}
```



---

archive/issue_comments_302853.json:
```json
{
    "body": "<a id='comment:15'>Comment 15:</a>\nWhich line numbers?",
    "created_at": "2016-06-02T08:19:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20731#issuecomment-302853",
    "user": "https://github.com/videlec"
}
```

<a id='comment:15'>Comment 15:</a>
Which line numbers?



---

archive/issue_comments_302854.json:
```json
{
    "body": "<a id='comment:16'>Comment 16:</a>\nI see...",
    "created_at": "2016-06-02T08:20:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20731#issuecomment-302854",
    "user": "https://github.com/videlec"
}
```

<a id='comment:16'>Comment 16:</a>
I see...



---

archive/issue_comments_302855.json:
```json
{
    "body": "Changed commit from **[c7a8d8e](https://github.com/sagemath/sagetrac-mirror/commit/c7a8d8e5b44d49654aab2827f3b5359f4c7acd60)** to **[97a809e](https://github.com/sagemath/sagetrac-mirror/commit/97a809ecbc63d4dad9c794af1b1fda089fece267)**",
    "created_at": "2016-06-02T08:25:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20731#issuecomment-302855",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[c7a8d8e](https://github.com/sagemath/sagetrac-mirror/commit/c7a8d8e5b44d49654aab2827f3b5359f4c7acd60)** to **[97a809e](https://github.com/sagemath/sagetrac-mirror/commit/97a809ecbc63d4dad9c794af1b1fda089fece267)**



---

archive/issue_comments_302856.json:
```json
{
    "body": "<a id='comment:17'>Comment 17:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/97a809ecbc63d4dad9c794af1b1fda089fece267\">97a809e</a></td><td><code>Trac 20731: remove line numbers in a doctest</code></td></tr></table>\n",
    "created_at": "2016-06-02T08:25:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20731#issuecomment-302856",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:17'>Comment 17:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/97a809ecbc63d4dad9c794af1b1fda089fece267">97a809e</a></td><td><code>Trac 20731: remove line numbers in a doctest</code></td></tr></table>




---

archive/issue_events_264133.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2016-06-02T08:26:19Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20731#event-264133"
}
```



---

archive/issue_events_264134.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2016-06-02T08:26:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20731#event-264134"
}
```



---

archive/issue_events_264135.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-06-02T08:36:49Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20731#event-264135"
}
```



---

archive/issue_events_264136.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-06-02T08:36:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20731#event-264136"
}
```



---

archive/issue_comments_302857.json:
```json
{
    "body": "<a id='comment:19'>Comment 19:</a>\n`12883`",
    "created_at": "2016-06-02T08:36:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20731#issuecomment-302857",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:19'>Comment 19:</a>
`12883`



---

archive/issue_comments_302858.json:
```json
{
    "body": "<a id='comment:20'>Comment 20:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/647a17bc7965f7c5daa91490d311eea894a31983\">647a17b</a></td><td><code>Trac 20731: one more line number</code></td></tr></table>\n",
    "created_at": "2016-06-02T08:40:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20731#issuecomment-302858",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:20'>Comment 20:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/647a17bc7965f7c5daa91490d311eea894a31983">647a17b</a></td><td><code>Trac 20731: one more line number</code></td></tr></table>




---

archive/issue_comments_302859.json:
```json
{
    "body": "Changed commit from **[97a809e](https://github.com/sagemath/sagetrac-mirror/commit/97a809ecbc63d4dad9c794af1b1fda089fece267)** to **[647a17b](https://github.com/sagemath/sagetrac-mirror/commit/647a17bc7965f7c5daa91490d311eea894a31983)**",
    "created_at": "2016-06-02T08:40:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20731#issuecomment-302859",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[97a809e](https://github.com/sagemath/sagetrac-mirror/commit/97a809ecbc63d4dad9c794af1b1fda089fece267)** to **[647a17b](https://github.com/sagemath/sagetrac-mirror/commit/647a17bc7965f7c5daa91490d311eea894a31983)**



---

archive/issue_events_264137.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2016-06-02T08:41:03Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20731#event-264137"
}
```



---

archive/issue_events_264138.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2016-06-02T08:41:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20731#event-264138"
}
```



---

archive/issue_comments_302860.json:
```json
{
    "body": "<a id='comment:22'>Comment 22:</a>\nGiven that the block\n\n```\n        mpz_set(mpq_numref(X), A)\n        mpz_set(mpq_denref(X), B)\n        mpq_canonicalize(X)\n```\noccurs many times, you should probably make it a separate inline function too, let's call it `mpq_div_zz`.",
    "created_at": "2016-06-02T09:34:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20731#issuecomment-302860",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:22'>Comment 22:</a>
Given that the block

```
        mpz_set(mpq_numref(X), A)
        mpz_set(mpq_denref(X), B)
        mpq_canonicalize(X)
```
occurs many times, you should probably make it a separate inline function too, let's call it `mpq_div_zz`.



---

archive/issue_comments_302861.json:
```json
{
    "body": "<a id='comment:23'>Comment 23:</a>\nI'm still not convinced by the `if type(x) is type(y)`. That would break if somebody wants to subclass `Integer` for some reason. You can check the types first as an optimization, but you should still support the case where `isinstance(x, Integer) and isinstance(y, Integer)`.",
    "created_at": "2016-06-02T09:42:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20731#issuecomment-302861",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:23'>Comment 23:</a>
I'm still not convinced by the `if type(x) is type(y)`. That would break if somebody wants to subclass `Integer` for some reason. You can check the types first as an optimization, but you should still support the case where `isinstance(x, Integer) and isinstance(y, Integer)`.



---

archive/issue_comments_302862.json:
```json
{
    "body": "<a id='comment:24'>Comment 24:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/675f8e617bdcc66e718d18089938b8d1458d0724\">675f8e6</a></td><td><code>Trac 20731: some factorization</code></td></tr></table>\n",
    "created_at": "2016-06-02T12:34:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20731#issuecomment-302862",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:24'>Comment 24:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/675f8e617bdcc66e718d18089938b8d1458d0724">675f8e6</a></td><td><code>Trac 20731: some factorization</code></td></tr></table>




---

archive/issue_comments_302863.json:
```json
{
    "body": "Changed commit from **[647a17b](https://github.com/sagemath/sagetrac-mirror/commit/647a17bc7965f7c5daa91490d311eea894a31983)** to **[675f8e6](https://github.com/sagemath/sagetrac-mirror/commit/675f8e617bdcc66e718d18089938b8d1458d0724)**",
    "created_at": "2016-06-02T12:34:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20731#issuecomment-302863",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[647a17b](https://github.com/sagemath/sagetrac-mirror/commit/647a17bc7965f7c5daa91490d311eea894a31983)** to **[675f8e6](https://github.com/sagemath/sagetrac-mirror/commit/675f8e617bdcc66e718d18089938b8d1458d0724)**



---

archive/issue_comments_302864.json:
```json
{
    "body": "<a id='comment:25'>Comment 25:</a>\nReplying to [@jdemeyer](#comment%3A23):\n> I'm still not convinced by the `if type(x) is type(y)`. That would break if somebody wants to subclass `Integer` for some reason. You can check the types first as an optimization, but you should still support the case where `isinstance(x, Integer) and isinstance(y, Integer)`.\n\nIt perfectly works ;-)\n\n```\nsage: class A(Integer): pass\nsage: A() + 1\n1\nsage: 1 + A()\n1\n```",
    "created_at": "2016-06-02T13:11:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20731#issuecomment-302864",
    "user": "https://github.com/videlec"
}
```

<a id='comment:25'>Comment 25:</a>
Replying to [@jdemeyer](#comment%3A23):
> I'm still not convinced by the `if type(x) is type(y)`. That would break if somebody wants to subclass `Integer` for some reason. You can check the types first as an optimization, but you should still support the case where `isinstance(x, Integer) and isinstance(y, Integer)`.

It perfectly works ;-)

```
sage: class A(Integer): pass
sage: A() + 1
1
sage: 1 + A()
1
```



---

archive/issue_comments_302865.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -5,21 +5,21 @@\n ```\n sage: z = 2\n sage: q = QQ((-1,5))\n-sage: sage: %timeit z + q\n+sage: %timeit z + q\n 1000000 loops, best of 3: 930 ns per loop\n-sage: sage: %timeit q + z\n+sage: %timeit q + z\n 1000000 loops, best of 3: 930 ns per loop\n-sage: sage: %timeit z - q\n+sage: %timeit z - q\n 1000000 loops, best of 3: 848 ns per loop\n-sage: sage: %timeit q - z\n+sage: %timeit q - z\n 1000000 loops, best of 3: 776 ns per loop\n-sage: sage: %timeit z * q\n+sage: %timeit z * q\n 1000000 loops, best of 3: 1.15 \u00b5s per loop\n-sage: sage: %timeit q * z\n+sage: %timeit q * z\n 1000000 loops, best of 3: 1.17 \u00b5s per loop\n-sage: sage: %timeit z / q\n+sage: %timeit z / q\n 1000000 loops, best of 3: 1.09 \u00b5s per loop\n-sage: sage: %timeit q / z\n+sage: %timeit q / z\n 1000000 loops, best of 3: 1.1 \u00b5s per loop\n ```\n New version\n@@ -36,11 +36,11 @@\n sage: %timeit q - z\n 1000000 loops, best of 3: 319 ns per loop\n sage: %timeit z * q\n-1000000 loops, best of 3: 341 ns per loop\n+1000000 loops, best of 3: 255 ns per loop\n sage: %timeit q * z\n-1000000 loops, best of 3: 446 ns per loop\n+1000000 loops, best of 3: 332 ns per loop\n sage: %timeit z / q\n-1000000 loops, best of 3: 341 ns per loop\n+1000000 loops, best of 3: 289 ns per loop\n sage: %timeit q / z\n-1000000 loops, best of 3: 396 ns per loop\n+1000000 loops, best of 3: 314 ns per loop\n ```\n``````\n",
    "created_at": "2016-06-02T13:13:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20731#issuecomment-302865",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -5,21 +5,21 @@
 ```
 sage: z = 2
 sage: q = QQ((-1,5))
-sage: sage: %timeit z + q
+sage: %timeit z + q
 1000000 loops, best of 3: 930 ns per loop
-sage: sage: %timeit q + z
+sage: %timeit q + z
 1000000 loops, best of 3: 930 ns per loop
-sage: sage: %timeit z - q
+sage: %timeit z - q
 1000000 loops, best of 3: 848 ns per loop
-sage: sage: %timeit q - z
+sage: %timeit q - z
 1000000 loops, best of 3: 776 ns per loop
-sage: sage: %timeit z * q
+sage: %timeit z * q
 1000000 loops, best of 3: 1.15 µs per loop
-sage: sage: %timeit q * z
+sage: %timeit q * z
 1000000 loops, best of 3: 1.17 µs per loop
-sage: sage: %timeit z / q
+sage: %timeit z / q
 1000000 loops, best of 3: 1.09 µs per loop
-sage: sage: %timeit q / z
+sage: %timeit q / z
 1000000 loops, best of 3: 1.1 µs per loop
 ```
 New version
@@ -36,11 +36,11 @@
 sage: %timeit q - z
 1000000 loops, best of 3: 319 ns per loop
 sage: %timeit z * q
-1000000 loops, best of 3: 341 ns per loop
+1000000 loops, best of 3: 255 ns per loop
 sage: %timeit q * z
-1000000 loops, best of 3: 446 ns per loop
+1000000 loops, best of 3: 332 ns per loop
 sage: %timeit z / q
-1000000 loops, best of 3: 341 ns per loop
+1000000 loops, best of 3: 289 ns per loop
 sage: %timeit q / z
-1000000 loops, best of 3: 396 ns per loop
+1000000 loops, best of 3: 314 ns per loop
 ```
``````




---

archive/issue_comments_302866.json:
```json
{
    "body": "<a id='comment:27'>Comment 27:</a>\nRight, subclassing `Integer` works because `__add__` calls the coercion model and the coercion model calls `_add_` (single underscore).",
    "created_at": "2016-06-03T08:25:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20731#issuecomment-302866",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:27'>Comment 27:</a>
Right, subclassing `Integer` works because `__add__` calls the coercion model and the coercion model calls `_add_` (single underscore).



---

archive/issue_comments_302867.json:
```json
{
    "body": "<a id='comment:28'>Comment 28:</a>\nSome ---hopefully final--- notes:\n\n1. Check documentation (for example, `Rational.__sub__` documents plus)\n\n2. In `mpq_div_z`, you do not need to check the sign since the denominator is the product of two denominators, so it must be positive.\n\n3. I would remove functions `mpq_sub_z` and `mpq_div_z` since they do not commute and are less useful: just implement them directly. Then you can also avoid `mpq_neg` and `mpq_inv` if you do it correctly.",
    "created_at": "2016-06-03T08:33:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20731#issuecomment-302867",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:28'>Comment 28:</a>
Some ---hopefully final--- notes:

1. Check documentation (for example, `Rational.__sub__` documents plus)

2. In `mpq_div_z`, you do not need to check the sign since the denominator is the product of two denominators, so it must be positive.

3. I would remove functions `mpq_sub_z` and `mpq_div_z` since they do not commute and are less useful: just implement them directly. Then you can also avoid `mpq_neg` and `mpq_inv` if you do it correctly.



---

archive/issue_events_264139.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-06-03T08:33:20Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20731#event-264139"
}
```



---

archive/issue_events_264140.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-06-03T08:33:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20731#event-264140"
}
```



---

archive/issue_comments_302868.json:
```json
{
    "body": "<a id='comment:29'>Comment 29:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/07f054b3e21eac33ee027e8fac148bcefb77fcb5\">07f054b</a></td><td><code>Trac 20731: fix doc + simpler code</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1c87b3cbb27e4f3489707ec30757dd5caa79df73\">1c87b3c</a></td><td><code>Trac 20731: remove mpq_sub_z and mpq_div_z</code></td></tr></table>\n",
    "created_at": "2016-06-04T11:20:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20731#issuecomment-302868",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:29'>Comment 29:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/07f054b3e21eac33ee027e8fac148bcefb77fcb5">07f054b</a></td><td><code>Trac 20731: fix doc + simpler code</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1c87b3cbb27e4f3489707ec30757dd5caa79df73">1c87b3c</a></td><td><code>Trac 20731: remove mpq_sub_z and mpq_div_z</code></td></tr></table>




---

archive/issue_comments_302869.json:
```json
{
    "body": "Changed commit from **[675f8e6](https://github.com/sagemath/sagetrac-mirror/commit/675f8e617bdcc66e718d18089938b8d1458d0724)** to **[1c87b3c](https://github.com/sagemath/sagetrac-mirror/commit/1c87b3cbb27e4f3489707ec30757dd5caa79df73)**",
    "created_at": "2016-06-04T11:20:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20731#issuecomment-302869",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[675f8e6](https://github.com/sagemath/sagetrac-mirror/commit/675f8e617bdcc66e718d18089938b8d1458d0724)** to **[1c87b3c](https://github.com/sagemath/sagetrac-mirror/commit/1c87b3cbb27e4f3489707ec30757dd5caa79df73)**



---

archive/issue_events_264141.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2016-06-04T11:26:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20731#event-264141"
}
```



---

archive/issue_events_264142.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2016-06-04T11:26:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20731#event-264142"
}
```



---

archive/issue_comments_302870.json:
```json
{
    "body": "<a id='comment:31'>Comment 31:</a>\nCuriously `Integer + Rational` is faster than `Rational + Integer`\n\n```\nsage: z = 2\nsage: q = QQ((-1,5))\nsage: %timeit z + q\n1000000 loops, best of 3: 251 ns per loop\nsage: %timeit q + z\n1000000 loops, best of 3: 323 ns per loop\n```",
    "created_at": "2016-06-04T11:27:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20731#issuecomment-302870",
    "user": "https://github.com/videlec"
}
```

<a id='comment:31'>Comment 31:</a>
Curiously `Integer + Rational` is faster than `Rational + Integer`

```
sage: z = 2
sage: q = QQ((-1,5))
sage: %timeit z + q
1000000 loops, best of 3: 251 ns per loop
sage: %timeit q + z
1000000 loops, best of 3: 323 ns per loop
```



---

archive/issue_events_264143.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2016-06-25T04:17:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20731#event-264143"
}
```



---

archive/issue_events_264144.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2016-06-25T04:17:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20731#event-264144"
}
```



---

archive/issue_comments_302871.json:
```json
{
    "body": "Changed keywords from **sd74** to **days74**",
    "created_at": "2016-06-25T04:17:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20731#issuecomment-302871",
    "user": "https://github.com/tscrim"
}
```

Changed keywords from **sd74** to **days74**



---

archive/issue_comments_302872.json:
```json
{
    "body": "<a id='comment:32'>Comment 32:</a>\nI'm not quite sure without looking through it. It might be something at a lower level than Sage.\n\nHowever, this needs rebasing.",
    "created_at": "2016-06-25T04:17:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20731#issuecomment-302872",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:32'>Comment 32:</a>
I'm not quite sure without looking through it. It might be something at a lower level than Sage.

However, this needs rebasing.



---

archive/issue_comments_302873.json:
```json
{
    "body": "<a id='comment:33'>Comment 33:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1a93a12c39522dbe60b958757e2e3922aa9c23ed\">1a93a12</a></td><td><code>Merge branch 'develop' into int_rat_coercion</code></td></tr></table>\n",
    "created_at": "2016-06-26T20:53:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20731#issuecomment-302873",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:33'>Comment 33:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1a93a12c39522dbe60b958757e2e3922aa9c23ed">1a93a12</a></td><td><code>Merge branch 'develop' into int_rat_coercion</code></td></tr></table>




---

archive/issue_comments_302874.json:
```json
{
    "body": "Changed commit from **[1c87b3c](https://github.com/sagemath/sagetrac-mirror/commit/1c87b3cbb27e4f3489707ec30757dd5caa79df73)** to **[1a93a12](https://github.com/sagemath/sagetrac-mirror/commit/1a93a12c39522dbe60b958757e2e3922aa9c23ed)**",
    "created_at": "2016-06-26T20:53:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20731#issuecomment-302874",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[1c87b3c](https://github.com/sagemath/sagetrac-mirror/commit/1c87b3cbb27e4f3489707ec30757dd5caa79df73)** to **[1a93a12](https://github.com/sagemath/sagetrac-mirror/commit/1a93a12c39522dbe60b958757e2e3922aa9c23ed)**



---

archive/issue_events_264145.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2016-06-26T20:56:32Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20731#event-264145"
}
```



---

archive/issue_events_264146.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2016-06-26T20:56:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20731#event-264146"
}
```



---

archive/issue_comments_302875.json:
```json
{
    "body": "<a id='comment:34'>Comment 34:</a>\nReplying to [@tscrim](#comment%3A32):\n> I'm not quite sure without looking through it. It might be something at a lower level than Sage.\n\nI really do not understand this comment.\n\n> However, this needs rebasing.\n\nThis I understood. Done!",
    "created_at": "2016-06-26T20:56:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20731#issuecomment-302875",
    "user": "https://github.com/videlec"
}
```

<a id='comment:34'>Comment 34:</a>
Replying to [@tscrim](#comment%3A32):
> I'm not quite sure without looking through it. It might be something at a lower level than Sage.

I really do not understand this comment.

> However, this needs rebasing.

This I understood. Done!



---

archive/issue_comments_302876.json:
```json
{
    "body": "<a id='comment:35'>Comment 35:</a>\nReplying to [@videlec](#comment%3A34):\n> Replying to [@tscrim](#comment%3A32):\n> > I'm not quite sure without looking through it. It might be something at a lower level than Sage.\n\n> \n> I really do not understand this comment.\n\nThis was in reference to [comment:31](#comment%3A31), where I was thinking the issue with the time difference might be something in mpz instead of something we are doing in Sage. It might be better to take the faster version and utilize that addition/multiplication is commutative to get that extra little bit of speed.",
    "created_at": "2016-06-26T21:29:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20731#issuecomment-302876",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:35'>Comment 35:</a>
Replying to [@videlec](#comment%3A34):
> Replying to [@tscrim](#comment%3A32):
> > I'm not quite sure without looking through it. It might be something at a lower level than Sage.

> 
> I really do not understand this comment.

This was in reference to [comment:31](#comment%3A31), where I was thinking the issue with the time difference might be something in mpz instead of something we are doing in Sage. It might be better to take the faster version and utilize that addition/multiplication is commutative to get that extra little bit of speed.



---

archive/issue_comments_302877.json:
```json
{
    "body": "<a id='comment:36'>Comment 36:</a>\nReplying to [@tscrim](#comment%3A35):\n> Replying to [@videlec](#comment%3A34):\n> > Replying to [@tscrim](#comment%3A32):\n> > > I'm not quite sure without looking through it. It might be something at a lower level than Sage.\n\n> > \n> > I really do not understand this comment.\n\n> \n> This was in reference to [comment:31](#comment%3A31), where I was thinking the issue with the time difference might be something in mpz instead of something we are doing in Sage. It might be better to take the faster version and utilize that addition/multiplication is commutative to get that extra little bit of speed.\n\nThere is no fundamental difference between `z+q` and `q+z`. The code is copy paste calling the very same functions. [comment:31](#comment%3A31) is just something that I do not understand.",
    "created_at": "2016-06-27T05:45:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20731#issuecomment-302877",
    "user": "https://github.com/videlec"
}
```

<a id='comment:36'>Comment 36:</a>
Replying to [@tscrim](#comment%3A35):
> Replying to [@videlec](#comment%3A34):
> > Replying to [@tscrim](#comment%3A32):
> > > I'm not quite sure without looking through it. It might be something at a lower level than Sage.

> > 
> > I really do not understand this comment.

> 
> This was in reference to [comment:31](#comment%3A31), where I was thinking the issue with the time difference might be something in mpz instead of something we are doing in Sage. It might be better to take the faster version and utilize that addition/multiplication is commutative to get that extra little bit of speed.

There is no fundamental difference between `z+q` and `q+z`. The code is copy paste calling the very same functions. [comment:31](#comment%3A31) is just something that I do not understand.



---

archive/issue_comments_302878.json:
```json
{
    "body": "Reviewer: **Jeroen Demeyer, Travis Scrimshaw**",
    "created_at": "2016-06-27T13:58:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20731#issuecomment-302878",
    "user": "https://github.com/tscrim"
}
```

Reviewer: **Jeroen Demeyer, Travis Scrimshaw**



---

archive/issue_comments_302879.json:
```json
{
    "body": "<a id='comment:37'>Comment 37:</a>\nAh, I see it now. I guess the only difference is checking `isinstance` for `Integer` is longer than that of `Rational` because of a longer MRO:\n\n```\nsage: p = 2\nsage: p.__class__.__mro__\n(<type 'sage.rings.integer.Integer'>,\n <type 'sage.structure.element.EuclideanDomainElement'>,\n <type 'sage.structure.element.PrincipalIdealDomainElement'>,\n <type 'sage.structure.element.DedekindDomainElement'>,\n <type 'sage.structure.element.IntegralDomainElement'>,\n <type 'sage.structure.element.CommutativeRingElement'>,\n <type 'sage.structure.element.RingElement'>,\n <type 'sage.structure.element.ModuleElement'>,\n <type 'sage.structure.element.Element'>,\n <type 'sage.structure.sage_object.SageObject'>,\n <type 'object'>)\nsage: q = 2/3\nsage: q.__class__.__mro__\n(<type 'sage.rings.rational.Rational'>,\n <type 'sage.structure.element.FieldElement'>,\n <type 'sage.structure.element.CommutativeRingElement'>,\n <type 'sage.structure.element.RingElement'>,\n <type 'sage.structure.element.ModuleElement'>,\n <type 'sage.structure.element.Element'>,\n <type 'sage.structure.sage_object.SageObject'>,\n <type 'object'>)\n```\n\nI'm happy with this ticket as-is. Jeroen, any more comments?",
    "created_at": "2016-06-27T13:58:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20731#issuecomment-302879",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:37'>Comment 37:</a>
Ah, I see it now. I guess the only difference is checking `isinstance` for `Integer` is longer than that of `Rational` because of a longer MRO:

```
sage: p = 2
sage: p.__class__.__mro__
(<type 'sage.rings.integer.Integer'>,
 <type 'sage.structure.element.EuclideanDomainElement'>,
 <type 'sage.structure.element.PrincipalIdealDomainElement'>,
 <type 'sage.structure.element.DedekindDomainElement'>,
 <type 'sage.structure.element.IntegralDomainElement'>,
 <type 'sage.structure.element.CommutativeRingElement'>,
 <type 'sage.structure.element.RingElement'>,
 <type 'sage.structure.element.ModuleElement'>,
 <type 'sage.structure.element.Element'>,
 <type 'sage.structure.sage_object.SageObject'>,
 <type 'object'>)
sage: q = 2/3
sage: q.__class__.__mro__
(<type 'sage.rings.rational.Rational'>,
 <type 'sage.structure.element.FieldElement'>,
 <type 'sage.structure.element.CommutativeRingElement'>,
 <type 'sage.structure.element.RingElement'>,
 <type 'sage.structure.element.ModuleElement'>,
 <type 'sage.structure.element.Element'>,
 <type 'sage.structure.sage_object.SageObject'>,
 <type 'object'>)
```

I'm happy with this ticket as-is. Jeroen, any more comments?



---

archive/issue_comments_302880.json:
```json
{
    "body": "<a id='comment:38'>Comment 38:</a>\nOne way to shortcut the `isinstance(right, Rational)` is to instead do `type(right) is Rational`. That would actually be the fastest. (And it will still work with an element that inherits from `Rational` since `_add_`, `_mul_` etc are properly implemented.) What do you think?",
    "created_at": "2016-07-08T20:37:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20731#issuecomment-302880",
    "user": "https://github.com/videlec"
}
```

<a id='comment:38'>Comment 38:</a>
One way to shortcut the `isinstance(right, Rational)` is to instead do `type(right) is Rational`. That would actually be the fastest. (And it will still work with an element that inherits from `Rational` since `_add_`, `_mul_` etc are properly implemented.) What do you think?



---

archive/issue_comments_302881.json:
```json
{
    "body": "<a id='comment:39'>Comment 39:</a>\nI was originally thinking that we should keep it as `isinstance`, but since we explicitly construct a new `Rational` (and I don't think it could be made to work with subtypes [easily]), I think we should only test against `Rational`. Plus those extra little nanoseconds can matter at this level. Subclasses can just fall into the coercion framework.",
    "created_at": "2016-07-09T19:19:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20731#issuecomment-302881",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:39'>Comment 39:</a>
I was originally thinking that we should keep it as `isinstance`, but since we explicitly construct a new `Rational` (and I don't think it could be made to work with subtypes [easily]), I think we should only test against `Rational`. Plus those extra little nanoseconds can matter at this level. Subclasses can just fall into the coercion framework.



---

archive/issue_comments_302882.json:
```json
{
    "body": "<a id='comment:40'>Comment 40:</a>\nhum... with `isinstance(X,Y)`\n\n```\nsage: %timeit z+q                                                              \n1000000 loops, best of 3: 242 ns per loop\nsage: %timeit q+z                                                              \n1000000 loops, best of 3: 306 ns per loop\n```\nwith `type(X) is Y`\n\n```\nsage: %timeit z+q\n1000000 loops, best of 3: 243 ns per loop                                      \nsage: %timeit q+z\n1000000 loops, best of 3: 334 ns per loop\n```",
    "created_at": "2016-07-09T20:35:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20731#issuecomment-302882",
    "user": "https://github.com/videlec"
}
```

<a id='comment:40'>Comment 40:</a>
hum... with `isinstance(X,Y)`

```
sage: %timeit z+q                                                              
1000000 loops, best of 3: 242 ns per loop
sage: %timeit q+z                                                              
1000000 loops, best of 3: 306 ns per loop
```
with `type(X) is Y`

```
sage: %timeit z+q
1000000 loops, best of 3: 243 ns per loop                                      
sage: %timeit q+z
1000000 loops, best of 3: 334 ns per loop
```



---

archive/issue_comments_302883.json:
```json
{
    "body": "<a id='comment:41'>Comment 41:</a>\nIndependent time testing with a Cython class (without inheritance)\n\n|  code | relative time |\n|:-------:|:---------------:|\n| `type(a) == A`      | 10500000ns|\n| `isinstance(a,A)`   |   559000ns|\n| `type(a) is A`      |       55ns|\n\nI guess something else is happening with `z+q` versus `q+z`...",
    "created_at": "2016-07-09T20:50:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20731#issuecomment-302883",
    "user": "https://github.com/videlec"
}
```

<a id='comment:41'>Comment 41:</a>
Independent time testing with a Cython class (without inheritance)

|  code | relative time |
|:-------:|:---------------:|
| `type(a) == A`      | 10500000ns|
| `isinstance(a,A)`   |   559000ns|
| `type(a) is A`      |       55ns|

I guess something else is happening with `z+q` versus `q+z`...



---

archive/issue_comments_302884.json:
```json
{
    "body": "<a id='comment:42'>Comment 42:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dd2defb5ddf707d2dc5a84419a41fdbcd5c75a30\">dd2defb</a></td><td><code>Trac 20731: isinstance(X,Y) -> type(X) is Y</code></td></tr></table>\n",
    "created_at": "2016-07-09T20:51:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20731#issuecomment-302884",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:42'>Comment 42:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dd2defb5ddf707d2dc5a84419a41fdbcd5c75a30">dd2defb</a></td><td><code>Trac 20731: isinstance(X,Y) -> type(X) is Y</code></td></tr></table>




---

archive/issue_comments_302885.json:
```json
{
    "body": "Changed commit from **[1a93a12](https://github.com/sagemath/sagetrac-mirror/commit/1a93a12c39522dbe60b958757e2e3922aa9c23ed)** to **[dd2defb](https://github.com/sagemath/sagetrac-mirror/commit/dd2defb5ddf707d2dc5a84419a41fdbcd5c75a30)**",
    "created_at": "2016-07-09T20:51:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20731#issuecomment-302885",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[1a93a12](https://github.com/sagemath/sagetrac-mirror/commit/1a93a12c39522dbe60b958757e2e3922aa9c23ed)** to **[dd2defb](https://github.com/sagemath/sagetrac-mirror/commit/dd2defb5ddf707d2dc5a84419a41fdbcd5c75a30)**



---

archive/issue_events_264147.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2016-07-10T18:01:19Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20731#event-264147"
}
```



---

archive/issue_events_264148.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2016-07-10T18:01:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20731#event-264148"
}
```



---

archive/issue_comments_302886.json:
```json
{
    "body": "<a id='comment:43'>Comment 43:</a>\nThat really suggests that it has to do with the MRO length (comment:37), but I am somewhat surprised that does matter. Well, this is a definite improvement and should get into 7.3.",
    "created_at": "2016-07-10T18:01:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20731#issuecomment-302886",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:43'>Comment 43:</a>
That really suggests that it has to do with the MRO length (comment:37), but I am somewhat surprised that does matter. Well, this is a definite improvement and should get into 7.3.



---

archive/issue_events_264149.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-07-10T21:44:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20731#event-264149"
}
```



---

archive/issue_events_264150.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-07-10T21:44:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20731#event-264150"
}
```



---

archive/issue_comments_302887.json:
```json
{
    "body": "<a id='comment:44'>Comment 44:</a>\n\n```\nsage -t --long src/sage/repl/interpreter.py\n**********************************************************************\nFile \"src/sage/repl/interpreter.py\", line 77, in sage.repl.interpreter\nFailed example:\n    shell.run_cell('1/0')\nExpected:\n    ---------------------------------------------------------------------------\n    ZeroDivisionError                         Traceback (most recent call last)\n    <ipython-input-...> in <module>()\n    ----> 1 Integer(1)/Integer(0)\n    <BLANKLINE>\n    .../src/sage/rings/integer.pyx in sage.rings.integer.Integer.__div__ (build/cythonized/sage/rings/integer.c:...)()\n       ...          if type(left) is type(right):\n       ...              if mpz_sgn((<Integer>right).value) == 0:\n    -> ...                  raise ZeroDivisionError(\"rational division by zero\")\n       ...              x = <Rational> Rational.__new__(Rational)\n       ...              mpq_div_zz(x.value, (<Integer>left).value, (<Integer>right).value)\n    <BLANKLINE>\n    ZeroDivisionError: rational division by zero\nGot:\n    ---------------------------------------------------------------------------\n    ZeroDivisionError                         Traceback (most recent call last)\n    <ipython-input-1-6f88eab09598> in <module>()\n    ----> 1 Integer(1)/Integer(0)\n    <BLANKLINE>\n    /home/buildslave-sage/slave/sage_git/build/src/sage/rings/integer.pyx in sage.rings.integer.Integer.__div__ (/home/buildslave-sage/slave/sage_git/build/src/build/cythonized/sage/rings/integer.c:12882)()\n       1841         if type(left) is type(right):\n       1842             if mpz_sgn((<Integer>right).value) == 0:\n    -> 1843                 raise ZeroDivisionError(\"rational division by zero\")\n       1844             x = <Rational> Rational.__new__(Rational)\n       1845             mpq_div_zz(x.value, (<Integer>left).value, (<Integer>right).value)\n    <BLANKLINE>\n    ZeroDivisionError: rational division by zero\n**********************************************************************\n1 item had failures:\n   1 of   5 in sage.repl.interpreter\n    [133 tests, 1 failure, 3.60 s]\n```",
    "created_at": "2016-07-10T21:44:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20731#issuecomment-302887",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:44'>Comment 44:</a>

```
sage -t --long src/sage/repl/interpreter.py
**********************************************************************
File "src/sage/repl/interpreter.py", line 77, in sage.repl.interpreter
Failed example:
    shell.run_cell('1/0')
Expected:
    ---------------------------------------------------------------------------
    ZeroDivisionError                         Traceback (most recent call last)
    <ipython-input-...> in <module>()
    ----> 1 Integer(1)/Integer(0)
    <BLANKLINE>
    .../src/sage/rings/integer.pyx in sage.rings.integer.Integer.__div__ (build/cythonized/sage/rings/integer.c:...)()
       ...          if type(left) is type(right):
       ...              if mpz_sgn((<Integer>right).value) == 0:
    -> ...                  raise ZeroDivisionError("rational division by zero")
       ...              x = <Rational> Rational.__new__(Rational)
       ...              mpq_div_zz(x.value, (<Integer>left).value, (<Integer>right).value)
    <BLANKLINE>
    ZeroDivisionError: rational division by zero
Got:
    ---------------------------------------------------------------------------
    ZeroDivisionError                         Traceback (most recent call last)
    <ipython-input-1-6f88eab09598> in <module>()
    ----> 1 Integer(1)/Integer(0)
    <BLANKLINE>
    /home/buildslave-sage/slave/sage_git/build/src/sage/rings/integer.pyx in sage.rings.integer.Integer.__div__ (/home/buildslave-sage/slave/sage_git/build/src/build/cythonized/sage/rings/integer.c:12882)()
       1841         if type(left) is type(right):
       1842             if mpz_sgn((<Integer>right).value) == 0:
    -> 1843                 raise ZeroDivisionError("rational division by zero")
       1844             x = <Rational> Rational.__new__(Rational)
       1845             mpq_div_zz(x.value, (<Integer>left).value, (<Integer>right).value)
    <BLANKLINE>
    ZeroDivisionError: rational division by zero
**********************************************************************
1 item had failures:
   1 of   5 in sage.repl.interpreter
    [133 tests, 1 failure, 3.60 s]
```



---

archive/issue_comments_302888.json:
```json
{
    "body": "<a id='comment:45'>Comment 45:</a>\nDear Volker,\n\nI am not able to reproduce this... could you tell us on which kind of configuration you obtained that?\n\nVincent",
    "created_at": "2016-07-11T16:15:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20731#issuecomment-302888",
    "user": "https://github.com/videlec"
}
```

<a id='comment:45'>Comment 45:</a>
Dear Volker,

I am not able to reproduce this... could you tell us on which kind of configuration you obtained that?

Vincent



---

archive/issue_comments_302889.json:
```json
{
    "body": "<a id='comment:46'>Comment 46:</a>\nI think the test is just fragile:\n\n```\n    .../src/sage/rings/integer.pyx in sage.rings.integer.Integer.__div__ (build/cythonized/sage/rings/integer.c:...)()\n```\nvs the actual output:\n\n```\n    /home/buildslave-sage/slave/sage_git/build/src/sage/rings/integer.pyx in sage.rings.integer.Integer.__div__ (/home/buildslave-sage/slave/sage_git/build/src/build/cythonized/sage/rings/integer.c:12882)()\n```\nNote the path is `.../build/src/...` and compare with the previous doctest output format.",
    "created_at": "2016-07-15T20:00:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20731#issuecomment-302889",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:46'>Comment 46:</a>
I think the test is just fragile:

```
    .../src/sage/rings/integer.pyx in sage.rings.integer.Integer.__div__ (build/cythonized/sage/rings/integer.c:...)()
```
vs the actual output:

```
    /home/buildslave-sage/slave/sage_git/build/src/sage/rings/integer.pyx in sage.rings.integer.Integer.__div__ (/home/buildslave-sage/slave/sage_git/build/src/build/cythonized/sage/rings/integer.c:12882)()
```
Note the path is `.../build/src/...` and compare with the previous doctest output format.



---

archive/issue_comments_302890.json:
```json
{
    "body": "<a id='comment:47'>Comment 47:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d535aee38e629195fa6319a8a1d1d2efaecebec6\">d535aee</a></td><td><code>Trac 20731: fix doctest</code></td></tr></table>\n",
    "created_at": "2016-07-22T22:41:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20731#issuecomment-302890",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:47'>Comment 47:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d535aee38e629195fa6319a8a1d1d2efaecebec6">d535aee</a></td><td><code>Trac 20731: fix doctest</code></td></tr></table>




---

archive/issue_comments_302891.json:
```json
{
    "body": "Changed commit from **[dd2defb](https://github.com/sagemath/sagetrac-mirror/commit/dd2defb5ddf707d2dc5a84419a41fdbcd5c75a30)** to **[d535aee](https://github.com/sagemath/sagetrac-mirror/commit/d535aee38e629195fa6319a8a1d1d2efaecebec6)**",
    "created_at": "2016-07-22T22:41:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20731#issuecomment-302891",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[dd2defb](https://github.com/sagemath/sagetrac-mirror/commit/dd2defb5ddf707d2dc5a84419a41fdbcd5c75a30)** to **[d535aee](https://github.com/sagemath/sagetrac-mirror/commit/d535aee38e629195fa6319a8a1d1d2efaecebec6)**



---

archive/issue_events_264151.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2016-07-22T22:42:10Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20731#event-264151"
}
```



---

archive/issue_events_264152.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2016-07-22T22:42:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20731#event-264152"
}
```



---

archive/issue_events_264153.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2016-07-22T22:47:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20731#event-264153"
}
```



---

archive/issue_events_264154.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2016-07-22T22:47:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20731#event-264154"
}
```



---

archive/issue_events_264155.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-07-23T18:38:25Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20731#event-264155"
}
```



---

archive/issue_events_264156.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "38381dffbdc9e9b4755c937bc1761b90bb8a5016",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2016-07-23T18:38:25Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20731#event-264156"
}
```



---

archive/issue_comments_302892.json:
```json
{
    "body": "Changed branch from **[u/vdelecroix/20731](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/20731)** to **[d535aee](https://github.com/sagemath/sagetrac-mirror/commit/d535aee38e629195fa6319a8a1d1d2efaecebec6)**",
    "created_at": "2016-07-23T18:38:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20731#issuecomment-302892",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/vdelecroix/20731](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/20731)** to **[d535aee](https://github.com/sagemath/sagetrac-mirror/commit/d535aee38e629195fa6319a8a1d1d2efaecebec6)**
