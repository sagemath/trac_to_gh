# Issue 20133: Use pkg-config for Sage setup

archive/issues_019896.json:
```json
{
    "body": "Use pkg-config for linking Sage extension modules where possible\n\n**CC:**  @kiwifb\n\n**Branch/Commit:** [5d1cf572adbda8742305e5c59711c46b5f96fcf9](https://github.com/sagemath/sagetrac-mirror/commit/5d1cf572adbda8742305e5c59711c46b5f96fcf9)\n\n**Reviewer:** Volker Braun, Fran\u00e7ois Bissey\n\n**Author:** Volker Braun, Fran\u00e7ois Bissey\n\nIssue created by migration from https://trac.sagemath.org/ticket/20133\n\n",
    "closed_at": "2016-03-05T09:47:53Z",
    "created_at": "2016-02-28T14:05:44Z",
    "labels": [
        "component: build",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-7.1",
    "title": "Use pkg-config for Sage setup",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/20133",
    "user": "https://github.com/vbraun"
}
```
Use pkg-config for linking Sage extension modules where possible

**CC:**  @kiwifb

**Branch/Commit:** [5d1cf572adbda8742305e5c59711c46b5f96fcf9](https://github.com/sagemath/sagetrac-mirror/commit/5d1cf572adbda8742305e5c59711c46b5f96fcf9)

**Reviewer:** Volker Braun, François Bissey

**Author:** Volker Braun, François Bissey

Issue created by migration from https://trac.sagemath.org/ticket/20133





---

archive/issue_comments_291476.json:
```json
{
    "body": "**Branch:** [u/vbraun/use_pkg_config_for_sage_setup](https://github.com/sagemath/sagetrac-mirror/tree/u/vbraun/use_pkg_config_for_sage_setup)",
    "created_at": "2016-02-28T14:06:55Z",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20133#issuecomment-291476",
    "user": "https://github.com/vbraun"
}
```

**Branch:** [u/vbraun/use_pkg_config_for_sage_setup](https://github.com/sagemath/sagetrac-mirror/tree/u/vbraun/use_pkg_config_for_sage_setup)



---

archive/issue_comments_291477.json:
```json
{
    "body": "<a id='comment:2'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/066d7e8fd64c8466cfeb3407919d2781a3404c4e\">066d7e8</a></td><td><code>Use pkg-config for Sage linking</code></td></tr></table>\n",
    "created_at": "2016-02-28T14:39:46Z",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20133#issuecomment-291477",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/066d7e8fd64c8466cfeb3407919d2781a3404c4e">066d7e8</a></td><td><code>Use pkg-config for Sage linking</code></td></tr></table>




---

archive/issue_comments_291478.json:
```json
{
    "body": "**Commit:** [066d7e8fd64c8466cfeb3407919d2781a3404c4e](https://github.com/sagemath/sagetrac-mirror/commit/066d7e8fd64c8466cfeb3407919d2781a3404c4e)",
    "created_at": "2016-02-28T14:39:46Z",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20133#issuecomment-291478",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Commit:** [066d7e8fd64c8466cfeb3407919d2781a3404c4e](https://github.com/sagemath/sagetrac-mirror/commit/066d7e8fd64c8466cfeb3407919d2781a3404c4e)



---

archive/issue_comments_291479.json:
```json
{
    "body": "**Author:** Volker Braun",
    "created_at": "2016-02-28T14:52:53Z",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20133#issuecomment-291479",
    "user": "https://github.com/vbraun"
}
```

**Author:** Volker Braun



---

archive/issue_events_180739.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-02-28T14:52:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "label": "enhancement",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20133#event-180739"
}
```



---

archive/issue_events_180740.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-02-28T14:52:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "label": "component: build",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20133#event-180740"
}
```



---

archive/issue_comments_291480.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-\n+Use pkg-config for linking Sage extension modules where possible\n``````\n",
    "created_at": "2016-02-28T14:52:53Z",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20133#issuecomment-291480",
    "user": "https://github.com/vbraun"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1 @@
-
+Use pkg-config for linking Sage extension modules where possible
``````




---

archive/issue_comments_291481.json:
```json
{
    "body": "**Dependencies:** #20130",
    "created_at": "2016-02-28T15:11:57Z",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20133#issuecomment-291481",
    "user": "https://github.com/vbraun"
}
```

**Dependencies:** #20130



---

archive/issue_comments_291482.json:
```json
{
    "body": "<a id='comment:5'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/18d59bf4dda7b0521395b917e30edb5f026f524f\">18d59bf</a></td><td><code>Move third-party packages to pkg-config blas</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/de7efd23ffb7c9ed223bf769e55f585f47566d1a\">de7efd2</a></td><td><code>Fix typo: use lapack.pc not blas.pc</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f1302b23fb533a17e91f66bda951c3394eed1463\">f1302b2</a></td><td><code>Bump patchlevels</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/555b25811afe8da5d83c3ed6461e423a70f961f7\">555b258</a></td><td><code>Iml version/patchlevel fix</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8f0e007485addd84f429b4dbd82831c4352c66ed\">8f0e007</a></td><td><code>Use pkg-config for Sage linking</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/33d50b200d54bcf827b99d54184b16062db0ea85\">33d50b2</a></td><td><code>Fix typo</code></td></tr></table>\n",
    "created_at": "2016-02-28T15:23:12Z",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20133#issuecomment-291482",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/18d59bf4dda7b0521395b917e30edb5f026f524f">18d59bf</a></td><td><code>Move third-party packages to pkg-config blas</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/de7efd23ffb7c9ed223bf769e55f585f47566d1a">de7efd2</a></td><td><code>Fix typo: use lapack.pc not blas.pc</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f1302b23fb533a17e91f66bda951c3394eed1463">f1302b2</a></td><td><code>Bump patchlevels</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/555b25811afe8da5d83c3ed6461e423a70f961f7">555b258</a></td><td><code>Iml version/patchlevel fix</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8f0e007485addd84f429b4dbd82831c4352c66ed">8f0e007</a></td><td><code>Use pkg-config for Sage linking</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/33d50b200d54bcf827b99d54184b16062db0ea85">33d50b2</a></td><td><code>Fix typo</code></td></tr></table>




---

archive/issue_comments_291483.json:
```json
{
    "body": "**Changing commit** from \"[066d7e8fd64c8466cfeb3407919d2781a3404c4e](https://github.com/sagemath/sagetrac-mirror/commit/066d7e8fd64c8466cfeb3407919d2781a3404c4e)\" to \"[33d50b200d54bcf827b99d54184b16062db0ea85](https://github.com/sagemath/sagetrac-mirror/commit/33d50b200d54bcf827b99d54184b16062db0ea85)\".",
    "created_at": "2016-02-28T15:23:12Z",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20133#issuecomment-291483",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[066d7e8fd64c8466cfeb3407919d2781a3404c4e](https://github.com/sagemath/sagetrac-mirror/commit/066d7e8fd64c8466cfeb3407919d2781a3404c4e)" to "[33d50b200d54bcf827b99d54184b16062db0ea85](https://github.com/sagemath/sagetrac-mirror/commit/33d50b200d54bcf827b99d54184b16062db0ea85)".



---

archive/issue_comments_291484.json:
```json
{
    "body": "<a id='comment:6'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a7772cee4683aeb42ab7ecd26792850bcaa794e5\">a7772ce</a></td><td><code>Do not doctest that cblas has a particular name</code></td></tr></table>\n",
    "created_at": "2016-02-28T15:37:49Z",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20133#issuecomment-291484",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a7772cee4683aeb42ab7ecd26792850bcaa794e5">a7772ce</a></td><td><code>Do not doctest that cblas has a particular name</code></td></tr></table>




---

archive/issue_comments_291485.json:
```json
{
    "body": "**Changing commit** from \"[33d50b200d54bcf827b99d54184b16062db0ea85](https://github.com/sagemath/sagetrac-mirror/commit/33d50b200d54bcf827b99d54184b16062db0ea85)\" to \"[a7772cee4683aeb42ab7ecd26792850bcaa794e5](https://github.com/sagemath/sagetrac-mirror/commit/a7772cee4683aeb42ab7ecd26792850bcaa794e5)\".",
    "created_at": "2016-02-28T15:37:49Z",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20133#issuecomment-291485",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[33d50b200d54bcf827b99d54184b16062db0ea85](https://github.com/sagemath/sagetrac-mirror/commit/33d50b200d54bcf827b99d54184b16062db0ea85)" to "[a7772cee4683aeb42ab7ecd26792850bcaa794e5](https://github.com/sagemath/sagetrac-mirror/commit/a7772cee4683aeb42ab7ecd26792850bcaa794e5)".



---

archive/issue_events_180741.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-02-28T19:16:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20133#event-180741"
}
```



---

archive/issue_events_180742.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2016-02-28T20:42:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20133#event-180742"
}
```



---

archive/issue_events_180743.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2016-02-28T20:42:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20133#event-180743"
}
```



---

archive/issue_comments_291486.json:
```json
{
    "body": "<a id='comment:8'></a>\nI think there is more to do in `cython.py`. In sage-on-gentoo I added a `libdir` in the output of `pyx_preparse` to take into account potential `blas/lapack` outside of sage.\n\nWhich means I had also to add it in `cython`, the extra stuff look like this\n\n```\n@@ -208,8 +192,8 @@\n         '.../sage/ext',\n         '.../cysignals'],\n         'c',\n-        [], ['-w', '-O2'])\n-        sage: s, libs, inc, lang, f, args = pyx_preparse(\"# clang c++\\n #clib foo\\n # cinclude bar\\n\")\n+        [], ['-w', '-O2'],...)\n+        sage: s, libs, inc, lang, f, args, libdirs = pyx_preparse(\"# clang c++\\n #clib foo\\n # cinclude bar\\n\")\n         sage: lang\n         'c++'\n \n@@ -234,7 +218,7 @@\n         '.../sage/ext',\n         '.../cysignals']\n \n-        sage: s, libs, inc, lang, f, args = pyx_preparse(\"# cargs -O3 -ggdb\\n\")\n+        sage: s, libs, inc, lang, f, args, libdirs = pyx_preparse(\"# cargs -O3 -ggdb\\n\")\n         sage: args\n         ['-w', '-O2', '-O3', '-ggdb']\n \n@@ -263,6 +247,7 @@\n     s = \"\"\"\\ninclude \"cdefs.pxi\"\\n\"\"\" + s\n     s = \"\"\"\\ninclude \"cysignals/signals.pxi\"  # ctrl-c interrupt block support\\ninclude \"stdsage.pxi\"\\n\"\"\" + s\n     args, s = parse_keywords('cargs', s)\n+    libdirs = cblas_library_dirs()\n     args = ['-w','-O2'] + args\n \n     # Add cysignals directory to includes\n@@ -271,7 +256,7 @@\n         if os.path.isdir(cysignals_path):\n             inc.append(cysignals_path)\n \n-    return s, libs, inc, lang, additional_source_files, args\n+    return s, libs, inc, lang, additional_source_files, args, libdirs\n \n ################################################################\n # If the user attaches a .spyx file and changes it, we have\n@@ -413,7 +398,7 @@\n \n     F = open(filename).read()\n \n-    F, libs, includes, language, additional_source_files, extra_args = pyx_preparse(F)\n+    F, libs, includes, language, additional_source_files, extra_args, libdirs = pyx_preparse(F)\n \n     # add the working directory to the includes so custom headers etc. work\n     includes.append(os.path.split(os.path.splitext(filename)[0])[0])\n@@ -453,19 +438,17 @@\n \n from sage.env import SAGE_LOCAL\n \n-extra_link_args =  ['-L' + SAGE_LOCAL + '/lib']\n extra_compile_args = %s\n \n ext_modules = [Extension('%s', sources=['%s.%s', %s],\n                      libraries=%s,\n-                     library_dirs=[SAGE_LOCAL + '/lib/'],\n+                     library_dirs=[SAGE_LOCAL + '/lib/', '%s'],\n                      extra_compile_args = extra_compile_args,\n-                     extra_link_args = extra_link_args,\n                      language = '%s' )]\n \n setup(ext_modules = ext_modules,\n       include_dirs = %s)\n-    \"\"\"%(extra_args, name, name, extension, additional_source_files, libs, language, includes)\n+    \"\"\"%(extra_args, name, name, extension, additional_source_files, libs, libdirs, language, includes)\n     open('%s/setup.py'%build_dir,'w').write(setup)\n     cython_include = ' '.join([\"-I '%s'\"%x for x in includes if len(x.strip()) > 0 ])\n \n```\nunless you have that sorted some other way I didn't notice, I would that part to be included.",
    "created_at": "2016-02-28T20:42:05Z",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20133#issuecomment-291486",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:8'></a>
I think there is more to do in `cython.py`. In sage-on-gentoo I added a `libdir` in the output of `pyx_preparse` to take into account potential `blas/lapack` outside of sage.

Which means I had also to add it in `cython`, the extra stuff look like this

```
@@ -208,8 +192,8 @@
         '.../sage/ext',
         '.../cysignals'],
         'c',
-        [], ['-w', '-O2'])
-        sage: s, libs, inc, lang, f, args = pyx_preparse("# clang c++\n #clib foo\n # cinclude bar\n")
+        [], ['-w', '-O2'],...)
+        sage: s, libs, inc, lang, f, args, libdirs = pyx_preparse("# clang c++\n #clib foo\n # cinclude bar\n")
         sage: lang
         'c++'
 
@@ -234,7 +218,7 @@
         '.../sage/ext',
         '.../cysignals']
 
-        sage: s, libs, inc, lang, f, args = pyx_preparse("# cargs -O3 -ggdb\n")
+        sage: s, libs, inc, lang, f, args, libdirs = pyx_preparse("# cargs -O3 -ggdb\n")
         sage: args
         ['-w', '-O2', '-O3', '-ggdb']
 
@@ -263,6 +247,7 @@
     s = """\ninclude "cdefs.pxi"\n""" + s
     s = """\ninclude "cysignals/signals.pxi"  # ctrl-c interrupt block support\ninclude "stdsage.pxi"\n""" + s
     args, s = parse_keywords('cargs', s)
+    libdirs = cblas_library_dirs()
     args = ['-w','-O2'] + args
 
     # Add cysignals directory to includes
@@ -271,7 +256,7 @@
         if os.path.isdir(cysignals_path):
             inc.append(cysignals_path)
 
-    return s, libs, inc, lang, additional_source_files, args
+    return s, libs, inc, lang, additional_source_files, args, libdirs
 
 ################################################################
 # If the user attaches a .spyx file and changes it, we have
@@ -413,7 +398,7 @@
 
     F = open(filename).read()
 
-    F, libs, includes, language, additional_source_files, extra_args = pyx_preparse(F)
+    F, libs, includes, language, additional_source_files, extra_args, libdirs = pyx_preparse(F)
 
     # add the working directory to the includes so custom headers etc. work
     includes.append(os.path.split(os.path.splitext(filename)[0])[0])
@@ -453,19 +438,17 @@
 
 from sage.env import SAGE_LOCAL
 
-extra_link_args =  ['-L' + SAGE_LOCAL + '/lib']
 extra_compile_args = %s
 
 ext_modules = [Extension('%s', sources=['%s.%s', %s],
                      libraries=%s,
-                     library_dirs=[SAGE_LOCAL + '/lib/'],
+                     library_dirs=[SAGE_LOCAL + '/lib/', '%s'],
                      extra_compile_args = extra_compile_args,
-                     extra_link_args = extra_link_args,
                      language = '%s' )]
 
 setup(ext_modules = ext_modules,
       include_dirs = %s)
-    """%(extra_args, name, name, extension, additional_source_files, libs, language, includes)
+    """%(extra_args, name, name, extension, additional_source_files, libs, libdirs, language, includes)
     open('%s/setup.py'%build_dir,'w').write(setup)
     cython_include = ' '.join(["-I '%s'"%x for x in includes if len(x.strip()) > 0 ])
 
```
unless you have that sorted some other way I didn't notice, I would that part to be included.



---

archive/issue_comments_291487.json:
```json
{
    "body": "<a id='comment:9'></a>\nFine with me; Since you already have it as a patch can you just add a commit so I don't have to apply your diff by hand?",
    "created_at": "2016-02-28T21:41:38Z",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20133#issuecomment-291487",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:9'></a>
Fine with me; Since you already have it as a patch can you just add a commit so I don't have to apply your diff by hand?



---

archive/issue_comments_291488.json:
```json
{
    "body": "<a id='comment:10'></a>\nWill do as soon as my day job allows me, I'll put it in positive review afterwards.",
    "created_at": "2016-02-28T22:32:15Z",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20133#issuecomment-291488",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:10'></a>
Will do as soon as my day job allows me, I'll put it in positive review afterwards.



---

archive/issue_comments_291489.json:
```json
{
    "body": "<a id='comment:11'></a>\nI suggest to move the `pkgconfig` stuff you added to `src/module_list.py` to some place within the `sage` package. Then it can more easily be imported by other packages too, analogous to the `sage_include_directories()` function in `src/sage/env.py`.\n\nSuppose I write a spkg which uses Sage and also links against BLAS, then it would be nice if I could reuse that code. That would also remove the need to duplicate that code in `cython.py`.",
    "created_at": "2016-02-28T23:46:58Z",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20133#issuecomment-291489",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:11'></a>
I suggest to move the `pkgconfig` stuff you added to `src/module_list.py` to some place within the `sage` package. Then it can more easily be imported by other packages too, analogous to the `sage_include_directories()` function in `src/sage/env.py`.

Suppose I write a spkg which uses Sage and also links against BLAS, then it would be nice if I could reuse that code. That would also remove the need to duplicate that code in `cython.py`.



---

archive/issue_comments_291490.json:
```json
{
    "body": "<a id='comment:12'></a>\nAdmittedly, it sounds like a good idea. I guess it should be a new file otherwise `env.py` will end up being a dumping ground. But when you talk about `blas` in particular it is true that we have a straight duplication between `cython.py` and `module_list.py` (even in my original version in sage-on-gentoo). \n\nOn the other hand I am not sure why in your use case you couldn't use the `.pc` files directly. \n\nOf course that could be more convenient but I have a feeling it is on the slippery slope of putting the kitchen sink into sage.",
    "created_at": "2016-02-29T00:36:58Z",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20133#issuecomment-291490",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:12'></a>
Admittedly, it sounds like a good idea. I guess it should be a new file otherwise `env.py` will end up being a dumping ground. But when you talk about `blas` in particular it is true that we have a straight duplication between `cython.py` and `module_list.py` (even in my original version in sage-on-gentoo). 

On the other hand I am not sure why in your use case you couldn't use the `.pc` files directly. 

Of course that could be more convenient but I have a feeling it is on the slippery slope of putting the kitchen sink into sage.



---

archive/issue_comments_291491.json:
```json
{
    "body": "**Changing commit** from \"[a7772cee4683aeb42ab7ecd26792850bcaa794e5](https://github.com/sagemath/sagetrac-mirror/commit/a7772cee4683aeb42ab7ecd26792850bcaa794e5)\" to \"[6d8e32f88985f4498c0e7e1f95c7aef0b8170781](https://github.com/sagemath/sagetrac-mirror/commit/6d8e32f88985f4498c0e7e1f95c7aef0b8170781)\".",
    "created_at": "2016-02-29T02:24:50Z",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20133#issuecomment-291491",
    "user": "https://github.com/kiwifb"
}
```

**Changing commit** from "[a7772cee4683aeb42ab7ecd26792850bcaa794e5](https://github.com/sagemath/sagetrac-mirror/commit/a7772cee4683aeb42ab7ecd26792850bcaa794e5)" to "[6d8e32f88985f4498c0e7e1f95c7aef0b8170781](https://github.com/sagemath/sagetrac-mirror/commit/6d8e32f88985f4498c0e7e1f95c7aef0b8170781)".



---

archive/issue_comments_291492.json:
```json
{
    "body": "**Changing branch** from \"[u/vbraun/use_pkg_config_for_sage_setup](https://github.com/sagemath/sagetrac-mirror/tree/u/vbraun/use_pkg_config_for_sage_setup)\" to \"[u/fbissey/use_pkg_config_for_sage_setup](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/use_pkg_config_for_sage_setup)\".",
    "created_at": "2016-02-29T02:24:50Z",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20133#issuecomment-291492",
    "user": "https://github.com/kiwifb"
}
```

**Changing branch** from "[u/vbraun/use_pkg_config_for_sage_setup](https://github.com/sagemath/sagetrac-mirror/tree/u/vbraun/use_pkg_config_for_sage_setup)" to "[u/fbissey/use_pkg_config_for_sage_setup](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/use_pkg_config_for_sage_setup)".



---

archive/issue_comments_291493.json:
```json
{
    "body": "<a id='comment:13'></a>\nOK pushing branch including changes to `pyx_preparse` note that cblas' include directory is not currently added. It hasn't proved necessary yet but could be in the future.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6d8e32f88985f4498c0e7e1f95c7aef0b8170781\">6d8e32f</a></td><td><code>Add libdirs (including blas' libdir) pyx_preparse</code></td></tr></table>\n",
    "created_at": "2016-02-29T02:24:50Z",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20133#issuecomment-291493",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:13'></a>
OK pushing branch including changes to `pyx_preparse` note that cblas' include directory is not currently added. It hasn't proved necessary yet but could be in the future.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6d8e32f88985f4498c0e7e1f95c7aef0b8170781">6d8e32f</a></td><td><code>Add libdirs (including blas' libdir) pyx_preparse</code></td></tr></table>




---

archive/issue_events_180744.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2016-02-29T02:26:26Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20133#event-180744"
}
```



---

archive/issue_events_180745.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2016-02-29T02:26:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20133#event-180745"
}
```



---

archive/issue_comments_291494.json:
```json
{
    "body": "**Changing commit** from \"[6d8e32f88985f4498c0e7e1f95c7aef0b8170781](https://github.com/sagemath/sagetrac-mirror/commit/6d8e32f88985f4498c0e7e1f95c7aef0b8170781)\" to \"[dd84287f8f793661387977e65e9761722809c759](https://github.com/sagemath/sagetrac-mirror/commit/dd84287f8f793661387977e65e9761722809c759)\".",
    "created_at": "2016-02-29T04:17:08Z",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20133#issuecomment-291494",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[6d8e32f88985f4498c0e7e1f95c7aef0b8170781](https://github.com/sagemath/sagetrac-mirror/commit/6d8e32f88985f4498c0e7e1f95c7aef0b8170781)" to "[dd84287f8f793661387977e65e9761722809c759](https://github.com/sagemath/sagetrac-mirror/commit/dd84287f8f793661387977e65e9761722809c759)".



---

archive/issue_events_180746.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/git",
    "created_at": "2016-02-29T04:17:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20133#event-180746"
}
```



---

archive/issue_events_180747.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/git",
    "created_at": "2016-02-29T04:17:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20133#event-180747"
}
```



---

archive/issue_comments_291495.json:
```json
{
    "body": "<a id='comment:15'></a>\n**Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dd84287f8f793661387977e65e9761722809c759\">dd84287</a></td><td><code>remove extranauseous brackets</code></td></tr></table>\n",
    "created_at": "2016-02-29T04:17:08Z",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20133#issuecomment-291495",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>
**Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dd84287f8f793661387977e65e9761722809c759">dd84287</a></td><td><code>remove extranauseous brackets</code></td></tr></table>




---

archive/issue_comments_291496.json:
```json
{
    "body": "<a id='comment:16'></a>\nSorry for the noise, I thought I had removed those brackets before the last commit.",
    "created_at": "2016-02-29T04:18:14Z",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20133#issuecomment-291496",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:16'></a>
Sorry for the noise, I thought I had removed those brackets before the last commit.



---

archive/issue_comments_291497.json:
```json
{
    "body": "<a id='comment:17'></a>\nOK, Volker has done things differently from what I used to do and now I have found that the difference is fairly important.",
    "created_at": "2016-02-29T07:44:38Z",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20133#issuecomment-291497",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:17'></a>
OK, Volker has done things differently from what I used to do and now I have found that the difference is fairly important.



---

archive/issue_events_180748.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2016-02-29T07:44:38Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20133#event-180748"
}
```



---

archive/issue_events_180749.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2016-02-29T07:44:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20133#event-180749"
}
```



---

archive/issue_comments_291498.json:
```json
{
    "body": "<a id='comment:18'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/12d54b5620e55af324a9b1dddefc2acda3142d88\">12d54b5</a></td><td><code>proper list building for library_dir</code></td></tr></table>\n",
    "created_at": "2016-02-29T08:04:56Z",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20133#issuecomment-291498",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:18'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/12d54b5620e55af324a9b1dddefc2acda3142d88">12d54b5</a></td><td><code>proper list building for library_dir</code></td></tr></table>




---

archive/issue_comments_291499.json:
```json
{
    "body": "**Changing commit** from \"[dd84287f8f793661387977e65e9761722809c759](https://github.com/sagemath/sagetrac-mirror/commit/dd84287f8f793661387977e65e9761722809c759)\" to \"[12d54b5620e55af324a9b1dddefc2acda3142d88](https://github.com/sagemath/sagetrac-mirror/commit/12d54b5620e55af324a9b1dddefc2acda3142d88)\".",
    "created_at": "2016-02-29T08:04:56Z",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20133#issuecomment-291499",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[dd84287f8f793661387977e65e9761722809c759](https://github.com/sagemath/sagetrac-mirror/commit/dd84287f8f793661387977e65e9761722809c759)" to "[12d54b5620e55af324a9b1dddefc2acda3142d88](https://github.com/sagemath/sagetrac-mirror/commit/12d54b5620e55af324a9b1dddefc2acda3142d88)".



---

archive/issue_comments_291500.json:
```json
{
    "body": "<a id='comment:19'></a>\nNot a difference between I have done and Volker has done. It looks like I had a bug for some time that happens not to be triggered in the common case in sage-on-gentoo. Let's see if the patchbot will come clean this time.",
    "created_at": "2016-02-29T08:07:26Z",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20133#issuecomment-291500",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:19'></a>
Not a difference between I have done and Volker has done. It looks like I had a bug for some time that happens not to be triggered in the common case in sage-on-gentoo. Let's see if the patchbot will come clean this time.



---

archive/issue_comments_291501.json:
```json
{
    "body": "<a id='comment:20'></a>\nIMHO in an ideal world you'd just run `pkg-config --libs blas gsl zlib`. By telling pkg-config all dependencies you enable it to order the libraries, too. The current verbosity is just a symptom of not having pc files for all libraries. We should rather work on that than move the current workaround into the Sage library.",
    "created_at": "2016-02-29T08:48:02Z",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20133#issuecomment-291501",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:20'></a>
IMHO in an ideal world you'd just run `pkg-config --libs blas gsl zlib`. By telling pkg-config all dependencies you enable it to order the libraries, too. The current verbosity is just a symptom of not having pc files for all libraries. We should rather work on that than move the current workaround into the Sage library.



---

archive/issue_comments_291502.json:
```json
{
    "body": "<a id='comment:21'></a>\nIf you need to add flags like\n\n```diff\n+              library_dirs = gsl_library_dirs,\n+              include_dirs = gsl_include_dirs),\n```\nyou must put them in the `.pxd` files, not in `module_list.py`. The reason is that there are a lot more extensions than the ones in `sage/gsl/*.pyx` which use the gsl library. If you add those dirs and includes to the gsl `.pxd` files, then all extensions using gsl will automatically have the correct flags added.\n\nThis currently applies only to gsl, since all other libraries that you changed are listed directly in `module_list.py`.",
    "created_at": "2016-02-29T10:05:11Z",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20133#issuecomment-291502",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:21'></a>
If you need to add flags like

```diff
+              library_dirs = gsl_library_dirs,
+              include_dirs = gsl_include_dirs),
```
you must put them in the `.pxd` files, not in `module_list.py`. The reason is that there are a lot more extensions than the ones in `sage/gsl/*.pyx` which use the gsl library. If you add those dirs and includes to the gsl `.pxd` files, then all extensions using gsl will automatically have the correct flags added.

This currently applies only to gsl, since all other libraries that you changed are listed directly in `module_list.py`.



---

archive/issue_comments_291503.json:
```json
{
    "body": "<a id='comment:22'></a>\nGiven that you add the BLAS libs to `gsl_libs`, I guess you should also add the BLAS library and include dirs to the GSL library and include dirs.",
    "created_at": "2016-02-29T10:08:06Z",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20133#issuecomment-291503",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:22'></a>
Given that you add the BLAS libs to `gsl_libs`, I guess you should also add the BLAS library and include dirs to the GSL library and include dirs.



---

archive/issue_comments_291504.json:
```json
{
    "body": "<a id='comment:23'></a>\nCorrectly treating library and include dirs is only relevant for non-Sage, non-system GSL installs. IMHO there is no point in worrying about that at the moment as we can't test it so it isn't going to work no matter what. First we need a way to configure Sage to not build our own GSL...",
    "created_at": "2016-02-29T10:37:29Z",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20133#issuecomment-291504",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:23'></a>
Correctly treating library and include dirs is only relevant for non-Sage, non-system GSL installs. IMHO there is no point in worrying about that at the moment as we can't test it so it isn't going to work no matter what. First we need a way to configure Sage to not build our own GSL...



---

archive/issue_comments_291505.json:
```json
{
    "body": "<a id='comment:24'></a>\nReplying to [vbraun](#comment%3A23):\n> IMHO there is no point in worrying about that at the moment\n\nIn that case, just leave GSL alone in this branch: either do it right or don't do it at all.\n\nI am very much against adding known-broken code with the excuse that you cannot test it, so you cannot see that it is in fact broken.",
    "created_at": "2016-02-29T10:51:38Z",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20133#issuecomment-291505",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:24'></a>
Replying to [vbraun](#comment%3A23):
> IMHO there is no point in worrying about that at the moment

In that case, just leave GSL alone in this branch: either do it right or don't do it at all.

I am very much against adding known-broken code with the excuse that you cannot test it, so you cannot see that it is in fact broken.



---

archive/issue_comments_291506.json:
```json
{
    "body": "<a id='comment:25'></a>\nI must say that I was surprised by Volker carpet bombing of all things that have a `.pc` file when we could have limited ourselves to `blas` and `lapack` (for `coinor`) where we want to be able to use something installed outside of `sage`.\n\nI don't think it would be needed for moving to `hashstack` as you would build everything in same prefix (I think). Now if you want to package for something like `spack` that becomes more interesting. But some other stuff will have to happen before you get anywhere there.",
    "created_at": "2016-02-29T21:02:23Z",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20133#issuecomment-291506",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:25'></a>
I must say that I was surprised by Volker carpet bombing of all things that have a `.pc` file when we could have limited ourselves to `blas` and `lapack` (for `coinor`) where we want to be able to use something installed outside of `sage`.

I don't think it would be needed for moving to `hashstack` as you would build everything in same prefix (I think). Now if you want to package for something like `spack` that becomes more interesting. But some other stuff will have to happen before you get anywhere there.



---

archive/issue_comments_291507.json:
```json
{
    "body": "<a id='comment:26'></a>\nIMHO not having a pc file for a shared library is a bug in an of itself. We are just reinventing the wheel if we try to write our own shared library configuration system. Pkgconfig a proven tool, just use it. E.g. look how elegantly xorg and Gnome handle >~100 shared libraries whereas we are to the hilt in a shit creek with just a handful.",
    "created_at": "2016-02-29T22:20:32Z",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20133#issuecomment-291507",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:26'></a>
IMHO not having a pc file for a shared library is a bug in an of itself. We are just reinventing the wheel if we try to write our own shared library configuration system. Pkgconfig a proven tool, just use it. E.g. look how elegantly xorg and Gnome handle >~100 shared libraries whereas we are to the hilt in a shit creek with just a handful.



---

archive/issue_comments_291508.json:
```json
{
    "body": "<a id='comment:27'></a>\nCorrection: Both not having a pc file and not using an existing pc file are a bug in an of itself.",
    "created_at": "2016-02-29T22:34:46Z",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20133#issuecomment-291508",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:27'></a>
Correction: Both not having a pc file and not using an existing pc file are a bug in an of itself.



---

archive/issue_comments_291509.json:
```json
{
    "body": "**Changing commit** from \"[12d54b5620e55af324a9b1dddefc2acda3142d88](https://github.com/sagemath/sagetrac-mirror/commit/12d54b5620e55af324a9b1dddefc2acda3142d88)\" to \"[d4525c0860db5ea8657959ebcf33afb33c5b2b03](https://github.com/sagemath/sagetrac-mirror/commit/d4525c0860db5ea8657959ebcf33afb33c5b2b03)\".",
    "created_at": "2016-02-29T23:24:17Z",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20133#issuecomment-291509",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[12d54b5620e55af324a9b1dddefc2acda3142d88](https://github.com/sagemath/sagetrac-mirror/commit/12d54b5620e55af324a9b1dddefc2acda3142d88)" to "[d4525c0860db5ea8657959ebcf33afb33c5b2b03](https://github.com/sagemath/sagetrac-mirror/commit/d4525c0860db5ea8657959ebcf33afb33c5b2b03)".



---

archive/issue_comments_291510.json:
```json
{
    "body": "<a id='comment:28'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d4525c0860db5ea8657959ebcf33afb33c5b2b03\">d4525c0</a></td><td><code>Add extra output to pyx_preparse doctest</code></td></tr></table>\n",
    "created_at": "2016-02-29T23:24:17Z",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20133#issuecomment-291510",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:28'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d4525c0860db5ea8657959ebcf33afb33c5b2b03">d4525c0</a></td><td><code>Add extra output to pyx_preparse doctest</code></td></tr></table>




---

archive/issue_comments_291511.json:
```json
{
    "body": "<a id='comment:29'></a>\nReplying to [vbraun](#comment%3A27):\n> Correction: Both not having a pc file and not using an existing pc file are a bug in an of itself.\n\n\nFine it is a bug. But if we are drinking that kool-aid, we'll have to also drink Jeroen's kool-aid about `.pxd` files. Otherwise it would be like \"having your cake and eat it too\" as the English would say.\n\nAnd apologies for missing one last bit of my old patch to that doctest.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d4525c0860db5ea8657959ebcf33afb33c5b2b03\">d4525c0</a></td><td><code>Add extra output to pyx_preparse doctest</code></td></tr></table>\n",
    "created_at": "2016-02-29T23:28:22Z",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20133#issuecomment-291511",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:29'></a>
Replying to [vbraun](#comment%3A27):
> Correction: Both not having a pc file and not using an existing pc file are a bug in an of itself.


Fine it is a bug. But if we are drinking that kool-aid, we'll have to also drink Jeroen's kool-aid about `.pxd` files. Otherwise it would be like "having your cake and eat it too" as the English would say.

And apologies for missing one last bit of my old patch to that doctest.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d4525c0860db5ea8657959ebcf33afb33c5b2b03">d4525c0</a></td><td><code>Add extra output to pyx_preparse doctest</code></td></tr></table>




---

archive/issue_comments_291512.json:
```json
{
    "body": "<a id='comment:30'></a>\nMigrating building directives to `.pxd` files is an ongoing process. I suggest we merge this ticket as is but start to migrate more aggressively. We have one migration to blas/lapack `.pc` to do on the top of my head and that is `numpy` and `scipy`. Once that is done, use of alternative blas/lapack in vanilla sage will have come a long way.",
    "created_at": "2016-03-01T09:23:46Z",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20133#issuecomment-291512",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:30'></a>
Migrating building directives to `.pxd` files is an ongoing process. I suggest we merge this ticket as is but start to migrate more aggressively. We have one migration to blas/lapack `.pc` to do on the top of my head and that is `numpy` and `scipy`. Once that is done, use of alternative blas/lapack in vanilla sage will have come a long way.



---

archive/issue_comments_291513.json:
```json
{
    "body": "<a id='comment:31'></a>\nReplying to [fbissey](#comment%3A30):\n> Migrating building directives to `.pxd` files is an ongoing process.\n\n\nIn the case of GSL, the library declarations are already migrated to `.pxd` files. So, if you want to fine-tune these declarations (by adding `library_dirs` for example), those fine-tuned declarations should also be in `.pxd` files. Otherwise it's a mess and we're worse off than before.\n\nConcretely, this should be reverted:\n\n```diff\n-    Extension('*', ['sage/gsl/*.pyx']),\n+    Extension('*', ['sage/gsl/*.pyx'],\n+              library_dirs = gsl_library_dirs,\n+              include_dirs = gsl_include_dirs),\n```",
    "created_at": "2016-03-01T09:44:36Z",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20133#issuecomment-291513",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:31'></a>
Replying to [fbissey](#comment%3A30):
> Migrating building directives to `.pxd` files is an ongoing process.


In the case of GSL, the library declarations are already migrated to `.pxd` files. So, if you want to fine-tune these declarations (by adding `library_dirs` for example), those fine-tuned declarations should also be in `.pxd` files. Otherwise it's a mess and we're worse off than before.

Concretely, this should be reverted:

```diff
-    Extension('*', ['sage/gsl/*.pyx']),
+    Extension('*', ['sage/gsl/*.pyx'],
+              library_dirs = gsl_library_dirs,
+              include_dirs = gsl_include_dirs),
```



---

archive/issue_comments_291514.json:
```json
{
    "body": "<a id='comment:32'></a>\nOK I will take care of that but that may be in the morning in my time zone.",
    "created_at": "2016-03-01T09:56:36Z",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20133#issuecomment-291514",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:32'></a>
OK I will take care of that but that may be in the morning in my time zone.



---

archive/issue_comments_291515.json:
```json
{
    "body": "**Work Issues:** fix gsl build instructions",
    "created_at": "2016-03-01T09:56:36Z",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20133#issuecomment-291515",
    "user": "https://github.com/kiwifb"
}
```

**Work Issues:** fix gsl build instructions



---

archive/issue_comments_291516.json:
```json
{
    "body": "<a id='comment:33'></a>\nNote that this ticket conflicts badly with #17635.",
    "created_at": "2016-03-01T13:02:20Z",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20133#issuecomment-291516",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:33'></a>
Note that this ticket conflicts badly with #17635.



---

archive/issue_comments_291517.json:
```json
{
    "body": "<a id='comment:34'></a>\nReplying to [jdemeyer](#comment%3A31):\n> Replying to [fbissey](#comment%3A30):\n> > Migrating building directives to `.pxd` files is an ongoing process.\n\n> \n> In the case of GSL, the library declarations are already migrated to `.pxd` files. So, if you want to fine-tune these declarations (by adding `library_dirs` for example), those fine-tuned declarations should also be in `.pxd` files. Otherwise it's a mess and we're worse off than before.\n> \n> Concretely, this should be reverted:\n> \n> ```diff\n> -    Extension('*', ['sage/gsl/*.pyx']),\n> +    Extension('*', ['sage/gsl/*.pyx'],\n> +              library_dirs = gsl_library_dirs,\n> +              include_dirs = gsl_include_dirs),\n> ```\n\n\nJeroen, I can see that some distutils stuff is indeed already present for `sage/libs/gsl/*.pxd` files, but there is nothing for `sage/gsl/*.pxd` should I regularise that as well or is there something I am missing (like why is there `sage/libs/gsl/` and `sage/gsl/`)?",
    "created_at": "2016-03-01T21:33:47Z",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20133#issuecomment-291517",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:34'></a>
Replying to [jdemeyer](#comment%3A31):
> Replying to [fbissey](#comment%3A30):
> > Migrating building directives to `.pxd` files is an ongoing process.

> 
> In the case of GSL, the library declarations are already migrated to `.pxd` files. So, if you want to fine-tune these declarations (by adding `library_dirs` for example), those fine-tuned declarations should also be in `.pxd` files. Otherwise it's a mess and we're worse off than before.
> 
> Concretely, this should be reverted:
> 
> ```diff
> -    Extension('*', ['sage/gsl/*.pyx']),
> +    Extension('*', ['sage/gsl/*.pyx'],
> +              library_dirs = gsl_library_dirs,
> +              include_dirs = gsl_include_dirs),
> ```


Jeroen, I can see that some distutils stuff is indeed already present for `sage/libs/gsl/*.pxd` files, but there is nothing for `sage/gsl/*.pxd` should I regularise that as well or is there something I am missing (like why is there `sage/libs/gsl/` and `sage/gsl/`)?



---

archive/issue_comments_291518.json:
```json
{
    "body": "<a id='comment:35'></a>\nReplying to [fbissey](#comment%3A34):\n> but there is nothing for `sage/gsl/*.pxd`\n\nIndeed and it should be that way. The `# distutils` stuff should be put where the library interface is declared and only there.",
    "created_at": "2016-03-01T21:50:55Z",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20133#issuecomment-291518",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:35'></a>
Replying to [fbissey](#comment%3A34):
> but there is nothing for `sage/gsl/*.pxd`

Indeed and it should be that way. The `# distutils` stuff should be put where the library interface is declared and only there.



---

archive/issue_comments_291519.json:
```json
{
    "body": "<a id='comment:36'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6203f778428cd2af89a24633262fb9e441d19a43\">6203f77</a></td><td><code>Use the information of gsl.pc directly in sage/libs/gsl/*.pxd files as necessary</code></td></tr></table>\n",
    "created_at": "2016-03-01T23:44:06Z",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20133#issuecomment-291519",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:36'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6203f778428cd2af89a24633262fb9e441d19a43">6203f77</a></td><td><code>Use the information of gsl.pc directly in sage/libs/gsl/*.pxd files as necessary</code></td></tr></table>




---

archive/issue_comments_291520.json:
```json
{
    "body": "**Changing commit** from \"[d4525c0860db5ea8657959ebcf33afb33c5b2b03](https://github.com/sagemath/sagetrac-mirror/commit/d4525c0860db5ea8657959ebcf33afb33c5b2b03)\" to \"[6203f778428cd2af89a24633262fb9e441d19a43](https://github.com/sagemath/sagetrac-mirror/commit/6203f778428cd2af89a24633262fb9e441d19a43)\".",
    "created_at": "2016-03-01T23:44:06Z",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20133#issuecomment-291520",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[d4525c0860db5ea8657959ebcf33afb33c5b2b03](https://github.com/sagemath/sagetrac-mirror/commit/d4525c0860db5ea8657959ebcf33afb33c5b2b03)" to "[6203f778428cd2af89a24633262fb9e441d19a43](https://github.com/sagemath/sagetrac-mirror/commit/6203f778428cd2af89a24633262fb9e441d19a43)".



---

archive/issue_comments_291521.json:
```json
{
    "body": "<a id='comment:37'></a>\nOK, hope I did it all correctly. Three `.pxd` files didn't have any distutils instructions. For those I only added stuff as I was thinking it could be necessary (include directory for two of them)..",
    "created_at": "2016-03-01T23:46:32Z",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20133#issuecomment-291521",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:37'></a>
OK, hope I did it all correctly. Three `.pxd` files didn't have any distutils instructions. For those I only added stuff as I was thinking it could be necessary (include directory for two of them)..



---

archive/issue_comments_291522.json:
```json
{
    "body": "<a id='comment:38'></a>\nAnyone has a clue why the librae patchbot has an apparently unrelated doctest failure\n\n```\nsage -t --long src/sage/all.py\n**********************************************************************\nFile \"src/sage/all.py\", line 305, in sage.all._write_started_file\nFailed example:\n    os.path.isfile(started_file)\nExpected:\n    True\nGot:\n    False\n**********************************************************************\n1 item had failures:\n   1 of   3 in sage.all._write_started_file\n    [20 tests, 1 failure, 0.57 s]\n----------------------------------------------------------------------\nsage -t --long src/sage/all.py  # 1 doctest failed\n----------------------------------------------------------------------\n```\nAll other doctests passing.",
    "created_at": "2016-03-02T09:04:13Z",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20133#issuecomment-291522",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:38'></a>
Anyone has a clue why the librae patchbot has an apparently unrelated doctest failure

```
sage -t --long src/sage/all.py
**********************************************************************
File "src/sage/all.py", line 305, in sage.all._write_started_file
Failed example:
    os.path.isfile(started_file)
Expected:
    True
Got:
    False
**********************************************************************
1 item had failures:
   1 of   3 in sage.all._write_started_file
    [20 tests, 1 failure, 0.57 s]
----------------------------------------------------------------------
sage -t --long src/sage/all.py  # 1 doctest failed
----------------------------------------------------------------------
```
All other doctests passing.



---

archive/issue_comments_291523.json:
```json
{
    "body": "**Changing work issues** from \"fix gsl build instructions\" to \"fix gsl build instructionsl pkgconfig import\".",
    "created_at": "2016-03-02T09:17:44Z",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20133#issuecomment-291523",
    "user": "https://github.com/jdemeyer"
}
```

**Changing work issues** from "fix gsl build instructions" to "fix gsl build instructionsl pkgconfig import".



---

archive/issue_comments_291524.json:
```json
{
    "body": "<a id='comment:39'></a>\n1. You need to define the GSL aliases, note the command line:\n\n> gcc -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -fPIC **-Igsl_include_dirs** -I/home/worker/sage-patchbot/local/lib/python2.7/site-packages/cysignals -I/home/worker/sage-patchbot/local/include -I/home/worker/sage-patchbot/local/include/python2.7 -I/home/worker/sage-patchbot/local/lib/python2.7/site-packages/numpy/core/include -I/home/worker/sage-patchbot/src -I/home/worker/sage-patchbot/src/sage/ext -I/home/worker/sage-patchbot/src/build/cythonized -I/home/worker/sage-patchbot/src/build/cythonized/sage/ext -I/home/worker/sage-patchbot/local/include/python2.7 -c /home/worker/sage-patchbot/src/build/cythonized/sage/gsl/gsl_array.c -o build/temp.linux-x86_64-2.7/home/worker/sage-patchbot/src/build/cythonized/sage/gsl/gsl_array.o -DGSL_DISABLE_DEPRECATED -fno-strict-aliasing -w\n\n\n2. Can you try to not import `pkgconfig` every time that Sage starts?",
    "created_at": "2016-03-02T09:17:44Z",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20133#issuecomment-291524",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:39'></a>
1. You need to define the GSL aliases, note the command line:

> gcc -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -fPIC **-Igsl_include_dirs** -I/home/worker/sage-patchbot/local/lib/python2.7/site-packages/cysignals -I/home/worker/sage-patchbot/local/include -I/home/worker/sage-patchbot/local/include/python2.7 -I/home/worker/sage-patchbot/local/lib/python2.7/site-packages/numpy/core/include -I/home/worker/sage-patchbot/src -I/home/worker/sage-patchbot/src/sage/ext -I/home/worker/sage-patchbot/src/build/cythonized -I/home/worker/sage-patchbot/src/build/cythonized/sage/ext -I/home/worker/sage-patchbot/local/include/python2.7 -c /home/worker/sage-patchbot/src/build/cythonized/sage/gsl/gsl_array.c -o build/temp.linux-x86_64-2.7/home/worker/sage-patchbot/src/build/cythonized/sage/gsl/gsl_array.o -DGSL_DISABLE_DEPRECATED -fno-strict-aliasing -w


2. Can you try to not import `pkgconfig` every time that Sage starts?



---

archive/issue_comments_291525.json:
```json
{
    "body": "<a id='comment:40'></a>\nI should have known.\n \nI supposed `pkgconfig` is called from `cython.py` somehow at startup. Would putting the `import pkgconfig` in a method stop that problem?",
    "created_at": "2016-03-02T09:28:56Z",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20133#issuecomment-291525",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:40'></a>
I should have known.
 
I supposed `pkgconfig` is called from `cython.py` somehow at startup. Would putting the `import pkgconfig` in a method stop that problem?



---

archive/issue_comments_291526.json:
```json
{
    "body": "<a id='comment:41'></a>\nReplying to [fbissey](#comment%3A40):\n> Would putting the `import pkgconfig` in a method stop that problem?\n\n\nYes. Even better, import the whole `cython.py` lazily.",
    "created_at": "2016-03-02T09:31:12Z",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20133#issuecomment-291526",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:41'></a>
Replying to [fbissey](#comment%3A40):
> Would putting the `import pkgconfig` in a method stop that problem?


Yes. Even better, import the whole `cython.py` lazily.



---

archive/issue_comments_291527.json:
```json
{
    "body": "<a id='comment:42'></a>\nThis should work if you add `import sage.misc.cython` to some doctests:\n\n```diff\ndiff --git a/src/sage/misc/all.py b/src/sage/misc/all.py\nindex 25838c1..071c6d5 100644\n--- a/src/sage/misc/all.py\n+++ b/src/sage/misc/all.py\n@@ -76,8 +76,8 @@ from sage_eval import sage_eval, sageobj\n \n from sage_input import sage_input\n \n-from cython import cython_lambda, cython_create_local_so\n-from cython_c import cython_compile as cython\n+lazy_import(\"sage.misc.cython\", [\"cython_lambda\", \"cython_create_local_so\"])\n+lazy_import(\"sage.misc.cython_c\", \"cython_compile\", \"cython\")\n lazy_import(\"sage.misc.cython_c\", \"cython_compile\", \"pyrex\", deprecation=9552)\n lazy_import(\"sage.misc.cython_c\", \"cython_compile\", \"sagex\", deprecation=9552)\n \n```",
    "created_at": "2016-03-02T09:37:05Z",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20133#issuecomment-291527",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:42'></a>
This should work if you add `import sage.misc.cython` to some doctests:

```diff
diff --git a/src/sage/misc/all.py b/src/sage/misc/all.py
index 25838c1..071c6d5 100644
--- a/src/sage/misc/all.py
+++ b/src/sage/misc/all.py
@@ -76,8 +76,8 @@ from sage_eval import sage_eval, sageobj
 
 from sage_input import sage_input
 
-from cython import cython_lambda, cython_create_local_so
-from cython_c import cython_compile as cython
+lazy_import("sage.misc.cython", ["cython_lambda", "cython_create_local_so"])
+lazy_import("sage.misc.cython_c", "cython_compile", "cython")
 lazy_import("sage.misc.cython_c", "cython_compile", "pyrex", deprecation=9552)
 lazy_import("sage.misc.cython_c", "cython_compile", "sagex", deprecation=9552)
 
```



---

archive/issue_comments_291528.json:
```json
{
    "body": "<a id='comment:43'></a>\nRe-building and running doctests to find any needed `import sage.misc.cython`.",
    "created_at": "2016-03-02T20:36:56Z",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20133#issuecomment-291528",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:43'></a>
Re-building and running doctests to find any needed `import sage.misc.cython`.



---

archive/issue_comments_291529.json:
```json
{
    "body": "<a id='comment:44'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/37ba00adb3ac1d549778c3603555ea8851a71142\">37ba00a</a></td><td><code>Using aliases properly, and lazy import from cython</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/44c1ac5d8d60dcbe990159157f4b34ff8334dac7\">44c1ac5</a></td><td><code>Fix doctests after lazy importing of cython.py</code></td></tr></table>\n",
    "created_at": "2016-03-03T04:21:26Z",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20133#issuecomment-291529",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:44'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/37ba00adb3ac1d549778c3603555ea8851a71142">37ba00a</a></td><td><code>Using aliases properly, and lazy import from cython</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/44c1ac5d8d60dcbe990159157f4b34ff8334dac7">44c1ac5</a></td><td><code>Fix doctests after lazy importing of cython.py</code></td></tr></table>




---

archive/issue_comments_291530.json:
```json
{
    "body": "**Changing commit** from \"[6203f778428cd2af89a24633262fb9e441d19a43](https://github.com/sagemath/sagetrac-mirror/commit/6203f778428cd2af89a24633262fb9e441d19a43)\" to \"[44c1ac5d8d60dcbe990159157f4b34ff8334dac7](https://github.com/sagemath/sagetrac-mirror/commit/44c1ac5d8d60dcbe990159157f4b34ff8334dac7)\".",
    "created_at": "2016-03-03T04:21:26Z",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20133#issuecomment-291530",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[6203f778428cd2af89a24633262fb9e441d19a43](https://github.com/sagemath/sagetrac-mirror/commit/6203f778428cd2af89a24633262fb9e441d19a43)" to "[44c1ac5d8d60dcbe990159157f4b34ff8334dac7](https://github.com/sagemath/sagetrac-mirror/commit/44c1ac5d8d60dcbe990159157f4b34ff8334dac7)".



---

archive/issue_events_180750.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2016-03-03T07:17:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20133#event-180750"
}
```



---

archive/issue_events_180751.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2016-03-03T07:17:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20133#event-180751"
}
```



---

archive/issue_comments_291531.json:
```json
{
    "body": "<a id='comment:45'></a>\nIf you would like to have a look and mark it positive Jeroen.",
    "created_at": "2016-03-03T07:17:11Z",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20133#issuecomment-291531",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:45'></a>
If you would like to have a look and mark it positive Jeroen.



---

archive/issue_comments_291532.json:
```json
{
    "body": "**Changing author** from \"Volker Braun\" to \"Volker Braun, Fran\u00e7ois Bissey\".",
    "created_at": "2016-03-03T07:17:11Z",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20133#issuecomment-291532",
    "user": "https://github.com/kiwifb"
}
```

**Changing author** from "Volker Braun" to "Volker Braun, François Bissey".



---

archive/issue_comments_291533.json:
```json
{
    "body": "<a id='comment:46'></a>\nReplying to [fbissey](#comment%3A45):\n> If you would like to have a look and mark it positive Jeroen.\n\n\nCan it wait until the next beta? There are already a lot of tickets closed-but-not-yet-in-develop involving the build system, let's not push things...",
    "created_at": "2016-03-03T08:23:03Z",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20133#issuecomment-291533",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:46'></a>
Replying to [fbissey](#comment%3A45):
> If you would like to have a look and mark it positive Jeroen.


Can it wait until the next beta? There are already a lot of tickets closed-but-not-yet-in-develop involving the build system, let's not push things...



---

archive/issue_comments_291534.json:
```json
{
    "body": "<a id='comment:47'></a>\nSure it is turning to be a very busy beta cycle. Not sure where Volker will want to cut things out.",
    "created_at": "2016-03-03T08:38:15Z",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20133#issuecomment-291534",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:47'></a>
Sure it is turning to be a very busy beta cycle. Not sure where Volker will want to cut things out.



---

archive/issue_comments_291535.json:
```json
{
    "body": "**Changing work issues** from \"fix gsl build instructionsl pkgconfig import\" to \"\".",
    "created_at": "2016-03-03T08:41:49Z",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20133#issuecomment-291535",
    "user": "https://github.com/jdemeyer"
}
```

**Changing work issues** from "fix gsl build instructionsl pkgconfig import" to "".



---

archive/issue_comments_291536.json:
```json
{
    "body": "**Changing dependencies** from \"#20130\" to \"\".",
    "created_at": "2016-03-03T21:24:22Z",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20133#issuecomment-291536",
    "user": "https://github.com/jdemeyer"
}
```

**Changing dependencies** from "#20130" to "".



---

archive/issue_comments_291537.json:
```json
{
    "body": "<a id='comment:50'></a>\nIs this ticket supposed to make it possible to use openblas instead of ATLAS?",
    "created_at": "2016-03-03T21:25:54Z",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20133#issuecomment-291537",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:50'></a>
Is this ticket supposed to make it possible to use openblas instead of ATLAS?



---

archive/issue_comments_291538.json:
```json
{
    "body": "**Changing branch** from \"[u/fbissey/use_pkg_config_for_sage_setup](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/use_pkg_config_for_sage_setup)\" to \"[u/jdemeyer/use_pkg_config_for_sage_setup](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/use_pkg_config_for_sage_setup)\".",
    "created_at": "2016-03-03T21:27:35Z",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20133#issuecomment-291538",
    "user": "https://github.com/jdemeyer"
}
```

**Changing branch** from "[u/fbissey/use_pkg_config_for_sage_setup](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/use_pkg_config_for_sage_setup)" to "[u/jdemeyer/use_pkg_config_for_sage_setup](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/use_pkg_config_for_sage_setup)".



---

archive/issue_comments_291539.json:
```json
{
    "body": "**Changing commit** from \"[44c1ac5d8d60dcbe990159157f4b34ff8334dac7](https://github.com/sagemath/sagetrac-mirror/commit/44c1ac5d8d60dcbe990159157f4b34ff8334dac7)\" to \"[252f00206b00580d015486506feb9285588658db](https://github.com/sagemath/sagetrac-mirror/commit/252f00206b00580d015486506feb9285588658db)\".",
    "created_at": "2016-03-03T21:27:45Z",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20133#issuecomment-291539",
    "user": "https://github.com/jdemeyer"
}
```

**Changing commit** from "[44c1ac5d8d60dcbe990159157f4b34ff8334dac7](https://github.com/sagemath/sagetrac-mirror/commit/44c1ac5d8d60dcbe990159157f4b34ff8334dac7)" to "[252f00206b00580d015486506feb9285588658db](https://github.com/sagemath/sagetrac-mirror/commit/252f00206b00580d015486506feb9285588658db)".



---

archive/issue_comments_291540.json:
```json
{
    "body": "<a id='comment:52'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/252f00206b00580d015486506feb9285588658db\">252f002</a></td><td><code>Merge tag '7.1.beta6' into t/20133/use_pkg_config_for_sage_setup</code></td></tr></table>\n",
    "created_at": "2016-03-03T21:27:45Z",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20133#issuecomment-291540",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:52'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/252f00206b00580d015486506feb9285588658db">252f002</a></td><td><code>Merge tag '7.1.beta6' into t/20133/use_pkg_config_for_sage_setup</code></td></tr></table>




---

archive/issue_comments_291541.json:
```json
{
    "body": "**Changing branch** from \"[u/jdemeyer/use_pkg_config_for_sage_setup](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/use_pkg_config_for_sage_setup)\" to \"[u/fbissey/use_pkg_config_for_sage_setup](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/use_pkg_config_for_sage_setup)\".",
    "created_at": "2016-03-03T21:31:15Z",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20133#issuecomment-291541",
    "user": "https://github.com/kiwifb"
}
```

**Changing branch** from "[u/jdemeyer/use_pkg_config_for_sage_setup](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/use_pkg_config_for_sage_setup)" to "[u/fbissey/use_pkg_config_for_sage_setup](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/use_pkg_config_for_sage_setup)".



---

archive/issue_comments_291542.json:
```json
{
    "body": "<a id='comment:53'></a>\nNot quite. We still haven't converted numpy/scipy to use `.pc` files - I don't know there is a ticket yet for that. And there is a ticket to select your blas somewhere. But once we deal with numpy/scipy you could get there with a bit of hand holding.",
    "created_at": "2016-03-03T21:31:15Z",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20133#issuecomment-291542",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:53'></a>
Not quite. We still haven't converted numpy/scipy to use `.pc` files - I don't know there is a ticket yet for that. And there is a ticket to select your blas somewhere. But once we deal with numpy/scipy you could get there with a bit of hand holding.



---

archive/issue_comments_291543.json:
```json
{
    "body": "**Changing commit** from \"[252f00206b00580d015486506feb9285588658db](https://github.com/sagemath/sagetrac-mirror/commit/252f00206b00580d015486506feb9285588658db)\" to \"[44c1ac5d8d60dcbe990159157f4b34ff8334dac7](https://github.com/sagemath/sagetrac-mirror/commit/44c1ac5d8d60dcbe990159157f4b34ff8334dac7)\".",
    "created_at": "2016-03-03T21:31:15Z",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20133#issuecomment-291543",
    "user": "https://github.com/kiwifb"
}
```

**Changing commit** from "[252f00206b00580d015486506feb9285588658db](https://github.com/sagemath/sagetrac-mirror/commit/252f00206b00580d015486506feb9285588658db)" to "[44c1ac5d8d60dcbe990159157f4b34ff8334dac7](https://github.com/sagemath/sagetrac-mirror/commit/44c1ac5d8d60dcbe990159157f4b34ff8334dac7)".



---

archive/issue_comments_291544.json:
```json
{
    "body": "<a id='comment:54'></a>\nThere is no way to NOT build ATLAS afaik so thats still missing....",
    "created_at": "2016-03-03T21:34:01Z",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20133#issuecomment-291544",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:54'></a>
There is no way to NOT build ATLAS afaik so thats still missing....



---

archive/issue_comments_291545.json:
```json
{
    "body": "<a id='comment:55'></a>\nSomeone determined could link `build/pkgs/atlas` to `build/pkgs/openblas` but I have to agree that's not really something I can recommend.",
    "created_at": "2016-03-03T21:40:20Z",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20133#issuecomment-291545",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:55'></a>
Someone determined could link `build/pkgs/atlas` to `build/pkgs/openblas` but I have to agree that's not really something I can recommend.



---

archive/issue_comments_291546.json:
```json
{
    "body": "<a id='comment:56'></a>\nReplying to [vbraun](#comment%3A54):\n> There is no way to NOT build ATLAS afaik so thats still missing....\n\n\nRight, but I meant the `pkgconfig` part...",
    "created_at": "2016-03-03T22:38:36Z",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20133#issuecomment-291546",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:56'></a>
Replying to [vbraun](#comment%3A54):
> There is no way to NOT build ATLAS afaik so thats still missing....


Right, but I meant the `pkgconfig` part...



---

archive/issue_comments_291547.json:
```json
{
    "body": "<a id='comment:57'></a>\nI am looking into getting `numpy` and `scipy` on board. I'll create a ticket when I am satisfied.",
    "created_at": "2016-03-03T23:29:04Z",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20133#issuecomment-291547",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:57'></a>
I am looking into getting `numpy` and `scipy` on board. I'll create a ticket when I am satisfied.



---

archive/issue_comments_291548.json:
```json
{
    "body": "<a id='comment:58'></a>\nI have started #20157 for getting `numpy` and `scipy` to use `.pc` files. But to come back to Jeroen's technical question and after working on `numpy` for a bit. If you were to build `openblas` instead `atlas` then yes it should all build and work (but there is at least one doctest producing numerical noise). Note that `numpy` tries `openblas` before `atlas`. So if you have both installed `openblas` will be favored by default.",
    "created_at": "2016-03-04T04:14:32Z",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20133#issuecomment-291548",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:58'></a>
I have started #20157 for getting `numpy` and `scipy` to use `.pc` files. But to come back to Jeroen's technical question and after working on `numpy` for a bit. If you were to build `openblas` instead `atlas` then yes it should all build and work (but there is at least one doctest producing numerical noise). Note that `numpy` tries `openblas` before `atlas`. So if you have both installed `openblas` will be favored by default.



---

archive/issue_events_180752.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-03-04T06:48:14Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20133#event-180752"
}
```



---

archive/issue_events_180753.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-03-04T06:48:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20133#event-180753"
}
```



---

archive/issue_comments_291549.json:
```json
{
    "body": "<a id='comment:59'></a>\nThe Sage library should depend on `pkgconfig`.",
    "created_at": "2016-03-04T06:48:14Z",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20133#issuecomment-291549",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:59'></a>
The Sage library should depend on `pkgconfig`.



---

archive/issue_comments_291550.json:
```json
{
    "body": "**Changing commit** from \"[44c1ac5d8d60dcbe990159157f4b34ff8334dac7](https://github.com/sagemath/sagetrac-mirror/commit/44c1ac5d8d60dcbe990159157f4b34ff8334dac7)\" to \"[5d1cf572adbda8742305e5c59711c46b5f96fcf9](https://github.com/sagemath/sagetrac-mirror/commit/5d1cf572adbda8742305e5c59711c46b5f96fcf9)\".",
    "created_at": "2016-03-04T07:15:33Z",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20133#issuecomment-291550",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[44c1ac5d8d60dcbe990159157f4b34ff8334dac7](https://github.com/sagemath/sagetrac-mirror/commit/44c1ac5d8d60dcbe990159157f4b34ff8334dac7)" to "[5d1cf572adbda8742305e5c59711c46b5f96fcf9](https://github.com/sagemath/sagetrac-mirror/commit/5d1cf572adbda8742305e5c59711c46b5f96fcf9)".



---

archive/issue_comments_291551.json:
```json
{
    "body": "<a id='comment:60'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7fa6239be3467b027b76ad3ec1554d0e2776b8c9\">7fa6239</a></td><td><code>Merge branch 'develop' into use_pkg_config_for_sage_setup</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5d1cf572adbda8742305e5c59711c46b5f96fcf9\">5d1cf57</a></td><td><code>Add pkgconfig to sagelib's dependencies</code></td></tr></table>\n",
    "created_at": "2016-03-04T07:15:33Z",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20133#issuecomment-291551",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:60'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7fa6239be3467b027b76ad3ec1554d0e2776b8c9">7fa6239</a></td><td><code>Merge branch 'develop' into use_pkg_config_for_sage_setup</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5d1cf572adbda8742305e5c59711c46b5f96fcf9">5d1cf57</a></td><td><code>Add pkgconfig to sagelib's dependencies</code></td></tr></table>




---

archive/issue_events_180754.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2016-03-04T07:16:46Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20133#event-180754"
}
```



---

archive/issue_events_180755.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2016-03-04T07:16:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20133#event-180755"
}
```



---

archive/issue_events_180756.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-03-04T22:54:28Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20133#event-180756"
}
```



---

archive/issue_events_180757.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-03-04T22:54:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20133#event-180757"
}
```



---

archive/issue_comments_291552.json:
```json
{
    "body": "**Reviewer:** Volker Braun, Fran\u00e7ois Bissey",
    "created_at": "2016-03-04T22:54:28Z",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20133#issuecomment-291552",
    "user": "https://github.com/vbraun"
}
```

**Reviewer:** Volker Braun, François Bissey



---

archive/issue_events_180758.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-03-05T09:47:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20133#event-180758"
}
```



---

archive/issue_events_180759.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "b29453ecfbdcae4d338c8d7c83e1f2b1aec89d31",
    "created_at": "2016-03-05T09:47:53Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20133#event-180759"
}
```



---

archive/issue_comments_291553.json:
```json
{
    "body": "**Changing branch** from \"[u/fbissey/use_pkg_config_for_sage_setup](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/use_pkg_config_for_sage_setup)\" to \"[5d1cf572adbda8742305e5c59711c46b5f96fcf9](https://github.com/sagemath/sagetrac-mirror/commit/5d1cf572adbda8742305e5c59711c46b5f96fcf9)\".",
    "created_at": "2016-03-05T09:47:53Z",
    "issue": "https://github.com/sagemath/sage/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20133#issuecomment-291553",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/fbissey/use_pkg_config_for_sage_setup](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/use_pkg_config_for_sage_setup)" to "[5d1cf572adbda8742305e5c59711c46b5f96fcf9](https://github.com/sagemath/sagetrac-mirror/commit/5d1cf572adbda8742305e5c59711c46b5f96fcf9)".
