# Issue 20133: Use pkg-config for Sage setup

archive/issues_019896.json:
```json
{
    "body": "CC:  @kiwifb\n\nUse pkg-config for linking Sage extension modules where possible\n\nIssue created by migration from https://trac.sagemath.org/ticket/20133\n\n",
    "closed_at": "2016-03-05T09:47:53Z",
    "created_at": "2016-02-28T14:05:44Z",
    "labels": [
        "component: build"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.1",
    "title": "Use pkg-config for Sage setup",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/20133",
    "user": "https://github.com/vbraun"
}
```
CC:  @kiwifb

Use pkg-config for linking Sage extension modules where possible

Issue created by migration from https://trac.sagemath.org/ticket/20133





---

archive/issue_comments_273275.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-02-28T14:39:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20133#issuecomment-273275",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_273276.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to enhancement.",
    "created_at": "2016-02-28T14:52:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20133#issuecomment-273276",
    "user": "https://github.com/vbraun"
}
```

Changing type from PLEASE CHANGE to enhancement.



---

archive/issue_comments_273277.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to build.",
    "created_at": "2016-02-28T14:52:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20133#issuecomment-273277",
    "user": "https://github.com/vbraun"
}
```

Changing component from PLEASE CHANGE to build.



---

archive/issue_comments_273278.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-02-28T15:23:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20133#issuecomment-273278",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_273279.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-02-28T15:37:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20133#issuecomment-273279",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_273280.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-02-28T19:16:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20133#issuecomment-273280",
    "user": "https://github.com/vbraun"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_273281.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-02-28T20:42:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20133#issuecomment-273281",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_273282.json:
```json
{
    "body": "I think there is more to do in `cython.py`. In sage-on-gentoo I added a `libdir` in the output of `pyx_preparse` to take into account potential `blas/lapack` outside of sage.\n\nWhich means I had also to add it in `cython`, the extra stuff look like this\n\n```\n@@ -208,8 +192,8 @@\n         '.../sage/ext',\n         '.../cysignals'],\n         'c',\n-        [], ['-w', '-O2'])\n-        sage: s, libs, inc, lang, f, args = pyx_preparse(\"# clang c++\\n #clib foo\\n # cinclude bar\\n\")\n+        [], ['-w', '-O2'],...)\n+        sage: s, libs, inc, lang, f, args, libdirs = pyx_preparse(\"# clang c++\\n #clib foo\\n # cinclude bar\\n\")\n         sage: lang\n         'c++'\n \n@@ -234,7 +218,7 @@\n         '.../sage/ext',\n         '.../cysignals']\n \n-        sage: s, libs, inc, lang, f, args = pyx_preparse(\"# cargs -O3 -ggdb\\n\")\n+        sage: s, libs, inc, lang, f, args, libdirs = pyx_preparse(\"# cargs -O3 -ggdb\\n\")\n         sage: args\n         ['-w', '-O2', '-O3', '-ggdb']\n \n@@ -263,6 +247,7 @@\n     s = \"\"\"\\ninclude \"cdefs.pxi\"\\n\"\"\" + s\n     s = \"\"\"\\ninclude \"cysignals/signals.pxi\"  # ctrl-c interrupt block support\\ninclude \"stdsage.pxi\"\\n\"\"\" + s\n     args, s = parse_keywords('cargs', s)\n+    libdirs = cblas_library_dirs()\n     args = ['-w','-O2'] + args\n \n     # Add cysignals directory to includes\n@@ -271,7 +256,7 @@\n         if os.path.isdir(cysignals_path):\n             inc.append(cysignals_path)\n \n-    return s, libs, inc, lang, additional_source_files, args\n+    return s, libs, inc, lang, additional_source_files, args, libdirs\n \n ################################################################\n # If the user attaches a .spyx file and changes it, we have\n@@ -413,7 +398,7 @@\n \n     F = open(filename).read()\n \n-    F, libs, includes, language, additional_source_files, extra_args = pyx_preparse(F)\n+    F, libs, includes, language, additional_source_files, extra_args, libdirs = pyx_preparse(F)\n \n     # add the working directory to the includes so custom headers etc. work\n     includes.append(os.path.split(os.path.splitext(filename)[0])[0])\n@@ -453,19 +438,17 @@\n \n from sage.env import SAGE_LOCAL\n \n-extra_link_args =  ['-L' + SAGE_LOCAL + '/lib']\n extra_compile_args = %s\n \n ext_modules = [Extension('%s', sources=['%s.%s', %s],\n                      libraries=%s,\n-                     library_dirs=[SAGE_LOCAL + '/lib/'],\n+                     library_dirs=[SAGE_LOCAL + '/lib/', '%s'],\n                      extra_compile_args = extra_compile_args,\n-                     extra_link_args = extra_link_args,\n                      language = '%s' )]\n \n setup(ext_modules = ext_modules,\n       include_dirs = %s)\n-    \"\"\"%(extra_args, name, name, extension, additional_source_files, libs, language, includes)\n+    \"\"\"%(extra_args, name, name, extension, additional_source_files, libs, libdirs, language, includes)\n     open('%s/setup.py'%build_dir,'w').write(setup)\n     cython_include = ' '.join([\"-I '%s'\"%x for x in includes if len(x.strip()) > 0 ])\n \n```\nunless you have that sorted some other way I didn't notice, I would that part to be included.",
    "created_at": "2016-02-28T20:42:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20133#issuecomment-273282",
    "user": "https://github.com/kiwifb"
}
```

I think there is more to do in `cython.py`. In sage-on-gentoo I added a `libdir` in the output of `pyx_preparse` to take into account potential `blas/lapack` outside of sage.

Which means I had also to add it in `cython`, the extra stuff look like this

```
@@ -208,8 +192,8 @@
         '.../sage/ext',
         '.../cysignals'],
         'c',
-        [], ['-w', '-O2'])
-        sage: s, libs, inc, lang, f, args = pyx_preparse("# clang c++\n #clib foo\n # cinclude bar\n")
+        [], ['-w', '-O2'],...)
+        sage: s, libs, inc, lang, f, args, libdirs = pyx_preparse("# clang c++\n #clib foo\n # cinclude bar\n")
         sage: lang
         'c++'
 
@@ -234,7 +218,7 @@
         '.../sage/ext',
         '.../cysignals']
 
-        sage: s, libs, inc, lang, f, args = pyx_preparse("# cargs -O3 -ggdb\n")
+        sage: s, libs, inc, lang, f, args, libdirs = pyx_preparse("# cargs -O3 -ggdb\n")
         sage: args
         ['-w', '-O2', '-O3', '-ggdb']
 
@@ -263,6 +247,7 @@
     s = """\ninclude "cdefs.pxi"\n""" + s
     s = """\ninclude "cysignals/signals.pxi"  # ctrl-c interrupt block support\ninclude "stdsage.pxi"\n""" + s
     args, s = parse_keywords('cargs', s)
+    libdirs = cblas_library_dirs()
     args = ['-w','-O2'] + args
 
     # Add cysignals directory to includes
@@ -271,7 +256,7 @@
         if os.path.isdir(cysignals_path):
             inc.append(cysignals_path)
 
-    return s, libs, inc, lang, additional_source_files, args
+    return s, libs, inc, lang, additional_source_files, args, libdirs
 
 ################################################################
 # If the user attaches a .spyx file and changes it, we have
@@ -413,7 +398,7 @@
 
     F = open(filename).read()
 
-    F, libs, includes, language, additional_source_files, extra_args = pyx_preparse(F)
+    F, libs, includes, language, additional_source_files, extra_args, libdirs = pyx_preparse(F)
 
     # add the working directory to the includes so custom headers etc. work
     includes.append(os.path.split(os.path.splitext(filename)[0])[0])
@@ -453,19 +438,17 @@
 
 from sage.env import SAGE_LOCAL
 
-extra_link_args =  ['-L' + SAGE_LOCAL + '/lib']
 extra_compile_args = %s
 
 ext_modules = [Extension('%s', sources=['%s.%s', %s],
                      libraries=%s,
-                     library_dirs=[SAGE_LOCAL + '/lib/'],
+                     library_dirs=[SAGE_LOCAL + '/lib/', '%s'],
                      extra_compile_args = extra_compile_args,
-                     extra_link_args = extra_link_args,
                      language = '%s' )]
 
 setup(ext_modules = ext_modules,
       include_dirs = %s)
-    """%(extra_args, name, name, extension, additional_source_files, libs, language, includes)
+    """%(extra_args, name, name, extension, additional_source_files, libs, libdirs, language, includes)
     open('%s/setup.py'%build_dir,'w').write(setup)
     cython_include = ' '.join(["-I '%s'"%x for x in includes if len(x.strip()) > 0 ])
 
```
unless you have that sorted some other way I didn't notice, I would that part to be included.



---

archive/issue_comments_273283.json:
```json
{
    "body": "Fine with me; Since you already have it as a patch can you just add a commit so I don't have to apply your diff by hand?",
    "created_at": "2016-02-28T21:41:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20133#issuecomment-273283",
    "user": "https://github.com/vbraun"
}
```

Fine with me; Since you already have it as a patch can you just add a commit so I don't have to apply your diff by hand?



---

archive/issue_comments_273284.json:
```json
{
    "body": "Will do as soon as my day job allows me, I'll put it in positive review afterwards.",
    "created_at": "2016-02-28T22:32:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20133#issuecomment-273284",
    "user": "https://github.com/kiwifb"
}
```

Will do as soon as my day job allows me, I'll put it in positive review afterwards.



---

archive/issue_comments_273285.json:
```json
{
    "body": "I suggest to move the `pkgconfig` stuff you added to `src/module_list.py` to some place within the `sage` package. Then it can more easily be imported by other packages too, analogous to the `sage_include_directories()` function in `src/sage/env.py`.\n\nSuppose I write a spkg which uses Sage and also links against BLAS, then it would be nice if I could reuse that code. That would also remove the need to duplicate that code in `cython.py`.",
    "created_at": "2016-02-28T23:46:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20133#issuecomment-273285",
    "user": "https://github.com/jdemeyer"
}
```

I suggest to move the `pkgconfig` stuff you added to `src/module_list.py` to some place within the `sage` package. Then it can more easily be imported by other packages too, analogous to the `sage_include_directories()` function in `src/sage/env.py`.

Suppose I write a spkg which uses Sage and also links against BLAS, then it would be nice if I could reuse that code. That would also remove the need to duplicate that code in `cython.py`.



---

archive/issue_comments_273286.json:
```json
{
    "body": "Admittedly, it sounds like a good idea. I guess it should be a new file otherwise `env.py` will end up being a dumping ground. But when you talk about `blas` in particular it is true that we have a straight duplication between `cython.py` and `module_list.py` (even in my original version in sage-on-gentoo). \n\nOn the other hand I am not sure why in your use case you couldn't use the `.pc` files directly. \n\nOf course that could be more convenient but I have a feeling it is on the slippery slope of putting the kitchen sink into sage.",
    "created_at": "2016-02-29T00:36:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20133#issuecomment-273286",
    "user": "https://github.com/kiwifb"
}
```

Admittedly, it sounds like a good idea. I guess it should be a new file otherwise `env.py` will end up being a dumping ground. But when you talk about `blas` in particular it is true that we have a straight duplication between `cython.py` and `module_list.py` (even in my original version in sage-on-gentoo). 

On the other hand I am not sure why in your use case you couldn't use the `.pc` files directly. 

Of course that could be more convenient but I have a feeling it is on the slippery slope of putting the kitchen sink into sage.



---

archive/issue_comments_273287.json:
```json
{
    "body": "OK pushing branch including changes to `pyx_preparse` note that cblas' include directory is not currently added. It hasn't proved necessary yet but could be in the future.\n\n---\nNew commits:",
    "created_at": "2016-02-29T02:24:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20133#issuecomment-273287",
    "user": "https://github.com/kiwifb"
}
```

OK pushing branch including changes to `pyx_preparse` note that cblas' include directory is not currently added. It hasn't proved necessary yet but could be in the future.

---
New commits:



---

archive/issue_comments_273288.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2016-02-29T02:26:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20133#issuecomment-273288",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_273289.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2016-02-29T04:17:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20133#issuecomment-273289",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_273290.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2016-02-29T04:17:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20133#issuecomment-273290",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_273291.json:
```json
{
    "body": "Sorry for the noise, I thought I had removed those brackets before the last commit.",
    "created_at": "2016-02-29T04:18:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20133#issuecomment-273291",
    "user": "https://github.com/kiwifb"
}
```

Sorry for the noise, I thought I had removed those brackets before the last commit.



---

archive/issue_comments_273292.json:
```json
{
    "body": "OK, Volker has done things differently from what I used to do and now I have found that the difference is fairly important.",
    "created_at": "2016-02-29T07:44:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20133#issuecomment-273292",
    "user": "https://github.com/kiwifb"
}
```

OK, Volker has done things differently from what I used to do and now I have found that the difference is fairly important.



---

archive/issue_comments_273293.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-02-29T07:44:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20133#issuecomment-273293",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_273294.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-02-29T08:04:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20133#issuecomment-273294",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_273295.json:
```json
{
    "body": "Not a difference between I have done and Volker has done. It looks like I had a bug for some time that happens not to be triggered in the common case in sage-on-gentoo. Let's see if the patchbot will come clean this time.",
    "created_at": "2016-02-29T08:07:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20133#issuecomment-273295",
    "user": "https://github.com/kiwifb"
}
```

Not a difference between I have done and Volker has done. It looks like I had a bug for some time that happens not to be triggered in the common case in sage-on-gentoo. Let's see if the patchbot will come clean this time.



---

archive/issue_comments_273296.json:
```json
{
    "body": "IMHO in an ideal world you'd just run `pkg-config --libs blas gsl zlib`. By telling pkg-config all dependencies you enable it to order the libraries, too. The current verbosity is just a symptom of not having pc files for all libraries. We should rather work on that than move the current workaround into the Sage library.",
    "created_at": "2016-02-29T08:48:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20133#issuecomment-273296",
    "user": "https://github.com/vbraun"
}
```

IMHO in an ideal world you'd just run `pkg-config --libs blas gsl zlib`. By telling pkg-config all dependencies you enable it to order the libraries, too. The current verbosity is just a symptom of not having pc files for all libraries. We should rather work on that than move the current workaround into the Sage library.



---

archive/issue_comments_273297.json:
```json
{
    "body": "If you need to add flags like\n\n```diff\n+              library_dirs = gsl_library_dirs,\n+              include_dirs = gsl_include_dirs),\n```\nyou must put them in the `.pxd` files, not in `module_list.py`. The reason is that there are a lot more extensions than the ones in `sage/gsl/*.pyx` which use the gsl library. If you add those dirs and includes to the gsl `.pxd` files, then all extensions using gsl will automatically have the correct flags added.\n\nThis currently applies only to gsl, since all other libraries that you changed are listed directly in `module_list.py`.",
    "created_at": "2016-02-29T10:05:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20133#issuecomment-273297",
    "user": "https://github.com/jdemeyer"
}
```

If you need to add flags like

```diff
+              library_dirs = gsl_library_dirs,
+              include_dirs = gsl_include_dirs),
```
you must put them in the `.pxd` files, not in `module_list.py`. The reason is that there are a lot more extensions than the ones in `sage/gsl/*.pyx` which use the gsl library. If you add those dirs and includes to the gsl `.pxd` files, then all extensions using gsl will automatically have the correct flags added.

This currently applies only to gsl, since all other libraries that you changed are listed directly in `module_list.py`.



---

archive/issue_comments_273298.json:
```json
{
    "body": "Given that you add the BLAS libs to `gsl_libs`, I guess you should also add the BLAS library and include dirs to the GSL library and include dirs.",
    "created_at": "2016-02-29T10:08:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20133#issuecomment-273298",
    "user": "https://github.com/jdemeyer"
}
```

Given that you add the BLAS libs to `gsl_libs`, I guess you should also add the BLAS library and include dirs to the GSL library and include dirs.



---

archive/issue_comments_273299.json:
```json
{
    "body": "Correctly treating library and include dirs is only relevant for non-Sage, non-system GSL installs. IMHO there is no point in worrying about that at the moment as we can't test it so it isn't going to work no matter what. First we need a way to configure Sage to not build our own GSL...",
    "created_at": "2016-02-29T10:37:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20133#issuecomment-273299",
    "user": "https://github.com/vbraun"
}
```

Correctly treating library and include dirs is only relevant for non-Sage, non-system GSL installs. IMHO there is no point in worrying about that at the moment as we can't test it so it isn't going to work no matter what. First we need a way to configure Sage to not build our own GSL...



---

archive/issue_comments_273300.json:
```json
{
    "body": "Replying to [comment:23 vbraun]:\n> IMHO there is no point in worrying about that at the moment\n\nIn that case, just leave GSL alone in this branch: either do it right or don't do it at all.\n\nI am very much against adding known-broken code with the excuse that you cannot test it, so you cannot see that it is in fact broken.",
    "created_at": "2016-02-29T10:51:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20133#issuecomment-273300",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:23 vbraun]:
> IMHO there is no point in worrying about that at the moment

In that case, just leave GSL alone in this branch: either do it right or don't do it at all.

I am very much against adding known-broken code with the excuse that you cannot test it, so you cannot see that it is in fact broken.



---

archive/issue_comments_273301.json:
```json
{
    "body": "I must say that I was surprised by Volker carpet bombing of all things that have a `.pc` file when we could have limited ourselves to `blas` and `lapack` (for `coinor`) where we want to be able to use something installed outside of `sage`.\n\nI don't think it would be needed for moving to `hashstack` as you would build everything in same prefix (I think). Now if you want to package for something like `spack` that becomes more interesting. But some other stuff will have to happen before you get anywhere there.",
    "created_at": "2016-02-29T21:02:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20133#issuecomment-273301",
    "user": "https://github.com/kiwifb"
}
```

I must say that I was surprised by Volker carpet bombing of all things that have a `.pc` file when we could have limited ourselves to `blas` and `lapack` (for `coinor`) where we want to be able to use something installed outside of `sage`.

I don't think it would be needed for moving to `hashstack` as you would build everything in same prefix (I think). Now if you want to package for something like `spack` that becomes more interesting. But some other stuff will have to happen before you get anywhere there.



---

archive/issue_comments_273302.json:
```json
{
    "body": "IMHO not having a pc file for a shared library is a bug in an of itself. We are just reinventing the wheel if we try to write our own shared library configuration system. Pkgconfig a proven tool, just use it. E.g. look how elegantly xorg and Gnome handle >~100 shared libraries whereas we are to the hilt in a shit creek with just a handful.",
    "created_at": "2016-02-29T22:20:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20133#issuecomment-273302",
    "user": "https://github.com/vbraun"
}
```

IMHO not having a pc file for a shared library is a bug in an of itself. We are just reinventing the wheel if we try to write our own shared library configuration system. Pkgconfig a proven tool, just use it. E.g. look how elegantly xorg and Gnome handle >~100 shared libraries whereas we are to the hilt in a shit creek with just a handful.



---

archive/issue_comments_273303.json:
```json
{
    "body": "Correction: Both not having a pc file and not using an existing pc file are a bug in an of itself.",
    "created_at": "2016-02-29T22:34:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20133#issuecomment-273303",
    "user": "https://github.com/vbraun"
}
```

Correction: Both not having a pc file and not using an existing pc file are a bug in an of itself.



---

archive/issue_comments_273304.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-02-29T23:24:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20133#issuecomment-273304",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_273305.json:
```json
{
    "body": "Replying to [comment:27 vbraun]:\n> Correction: Both not having a pc file and not using an existing pc file are a bug in an of itself.\n\n\nFine it is a bug. But if we are drinking that kool-aid, we'll have to also drink Jeroen's kool-aid about `.pxd` files. Otherwise it would be like \"having your cake and eat it too\" as the English would say.\n\nAnd apologies for missing one last bit of my old patch to that doctest.\n\n---\nNew commits:",
    "created_at": "2016-02-29T23:28:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20133#issuecomment-273305",
    "user": "https://github.com/kiwifb"
}
```

Replying to [comment:27 vbraun]:
> Correction: Both not having a pc file and not using an existing pc file are a bug in an of itself.


Fine it is a bug. But if we are drinking that kool-aid, we'll have to also drink Jeroen's kool-aid about `.pxd` files. Otherwise it would be like "having your cake and eat it too" as the English would say.

And apologies for missing one last bit of my old patch to that doctest.

---
New commits:



---

archive/issue_comments_273306.json:
```json
{
    "body": "Migrating building directives to `.pxd` files is an ongoing process. I suggest we merge this ticket as is but start to migrate more aggressively. We have one migration to blas/lapack `.pc` to do on the top of my head and that is `numpy` and `scipy`. Once that is done, use of alternative blas/lapack in vanilla sage will have come a long way.",
    "created_at": "2016-03-01T09:23:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20133#issuecomment-273306",
    "user": "https://github.com/kiwifb"
}
```

Migrating building directives to `.pxd` files is an ongoing process. I suggest we merge this ticket as is but start to migrate more aggressively. We have one migration to blas/lapack `.pc` to do on the top of my head and that is `numpy` and `scipy`. Once that is done, use of alternative blas/lapack in vanilla sage will have come a long way.



---

archive/issue_comments_273307.json:
```json
{
    "body": "Replying to [comment:30 fbissey]:\n> Migrating building directives to `.pxd` files is an ongoing process.\n\n\nIn the case of GSL, the library declarations are already migrated to `.pxd` files. So, if you want to fine-tune these declarations (by adding `library_dirs` for example), those fine-tuned declarations should also be in `.pxd` files. Otherwise it's a mess and we're worse off than before.\n\nConcretely, this should be reverted:\n\n```diff\n-    Extension('*', ['sage/gsl/*.pyx']),\n+    Extension('*', ['sage/gsl/*.pyx'],\n+              library_dirs = gsl_library_dirs,\n+              include_dirs = gsl_include_dirs),\n```",
    "created_at": "2016-03-01T09:44:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20133#issuecomment-273307",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:30 fbissey]:
> Migrating building directives to `.pxd` files is an ongoing process.


In the case of GSL, the library declarations are already migrated to `.pxd` files. So, if you want to fine-tune these declarations (by adding `library_dirs` for example), those fine-tuned declarations should also be in `.pxd` files. Otherwise it's a mess and we're worse off than before.

Concretely, this should be reverted:

```diff
-    Extension('*', ['sage/gsl/*.pyx']),
+    Extension('*', ['sage/gsl/*.pyx'],
+              library_dirs = gsl_library_dirs,
+              include_dirs = gsl_include_dirs),
```



---

archive/issue_comments_273308.json:
```json
{
    "body": "OK I will take care of that but that may be in the morning in my time zone.",
    "created_at": "2016-03-01T09:56:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20133#issuecomment-273308",
    "user": "https://github.com/kiwifb"
}
```

OK I will take care of that but that may be in the morning in my time zone.



---

archive/issue_comments_273309.json:
```json
{
    "body": "Note that this ticket conflicts badly with #17635.",
    "created_at": "2016-03-01T13:02:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20133#issuecomment-273309",
    "user": "https://github.com/jdemeyer"
}
```

Note that this ticket conflicts badly with #17635.



---

archive/issue_comments_273310.json:
```json
{
    "body": "Replying to [comment:31 jdemeyer]:\n> Replying to [comment:30 fbissey]:\n> > Migrating building directives to `.pxd` files is an ongoing process.\n\n> \n> In the case of GSL, the library declarations are already migrated to `.pxd` files. So, if you want to fine-tune these declarations (by adding `library_dirs` for example), those fine-tuned declarations should also be in `.pxd` files. Otherwise it's a mess and we're worse off than before.\n> \n> Concretely, this should be reverted:\n> \n> ```\n> #!diff\n> -    Extension('*', ['sage/gsl/*.pyx']),\n> +    Extension('*', ['sage/gsl/*.pyx'],\n> +              library_dirs = gsl_library_dirs,\n> +              include_dirs = gsl_include_dirs),\n> ```\n\n\nJeroen, I can see that some distutils stuff is indeed already present for `sage/libs/gsl/*.pxd` files, but there is nothing for `sage/gsl/*.pxd` should I regularise that as well or is there something I am missing (like why is there `sage/libs/gsl/` and `sage/gsl/`)?",
    "created_at": "2016-03-01T21:33:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20133#issuecomment-273310",
    "user": "https://github.com/kiwifb"
}
```

Replying to [comment:31 jdemeyer]:
> Replying to [comment:30 fbissey]:
> > Migrating building directives to `.pxd` files is an ongoing process.

> 
> In the case of GSL, the library declarations are already migrated to `.pxd` files. So, if you want to fine-tune these declarations (by adding `library_dirs` for example), those fine-tuned declarations should also be in `.pxd` files. Otherwise it's a mess and we're worse off than before.
> 
> Concretely, this should be reverted:
> 
> ```
> #!diff
> -    Extension('*', ['sage/gsl/*.pyx']),
> +    Extension('*', ['sage/gsl/*.pyx'],
> +              library_dirs = gsl_library_dirs,
> +              include_dirs = gsl_include_dirs),
> ```


Jeroen, I can see that some distutils stuff is indeed already present for `sage/libs/gsl/*.pxd` files, but there is nothing for `sage/gsl/*.pxd` should I regularise that as well or is there something I am missing (like why is there `sage/libs/gsl/` and `sage/gsl/`)?



---

archive/issue_comments_273311.json:
```json
{
    "body": "Replying to [comment:34 fbissey]:\n> but there is nothing for `sage/gsl/*.pxd`\n\nIndeed and it should be that way. The `# distutils` stuff should be put where the library interface is declared and only there.",
    "created_at": "2016-03-01T21:50:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20133#issuecomment-273311",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:34 fbissey]:
> but there is nothing for `sage/gsl/*.pxd`

Indeed and it should be that way. The `# distutils` stuff should be put where the library interface is declared and only there.



---

archive/issue_comments_273312.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-03-01T23:44:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20133#issuecomment-273312",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_273313.json:
```json
{
    "body": "OK, hope I did it all correctly. Three `.pxd` files didn't have any distutils instructions. For those I only added stuff as I was thinking it could be necessary (include directory for two of them)..",
    "created_at": "2016-03-01T23:46:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20133#issuecomment-273313",
    "user": "https://github.com/kiwifb"
}
```

OK, hope I did it all correctly. Three `.pxd` files didn't have any distutils instructions. For those I only added stuff as I was thinking it could be necessary (include directory for two of them)..



---

archive/issue_comments_273314.json:
```json
{
    "body": "Anyone has a clue why the librae patchbot has an apparently unrelated doctest failure\n\n```\nsage -t --long src/sage/all.py\n**********************************************************************\nFile \"src/sage/all.py\", line 305, in sage.all._write_started_file\nFailed example:\n    os.path.isfile(started_file)\nExpected:\n    True\nGot:\n    False\n**********************************************************************\n1 item had failures:\n   1 of   3 in sage.all._write_started_file\n    [20 tests, 1 failure, 0.57 s]\n----------------------------------------------------------------------\nsage -t --long src/sage/all.py  # 1 doctest failed\n----------------------------------------------------------------------\n```\nAll other doctests passing.",
    "created_at": "2016-03-02T09:04:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20133#issuecomment-273314",
    "user": "https://github.com/kiwifb"
}
```

Anyone has a clue why the librae patchbot has an apparently unrelated doctest failure

```
sage -t --long src/sage/all.py
**********************************************************************
File "src/sage/all.py", line 305, in sage.all._write_started_file
Failed example:
    os.path.isfile(started_file)
Expected:
    True
Got:
    False
**********************************************************************
1 item had failures:
   1 of   3 in sage.all._write_started_file
    [20 tests, 1 failure, 0.57 s]
----------------------------------------------------------------------
sage -t --long src/sage/all.py  # 1 doctest failed
----------------------------------------------------------------------
```
All other doctests passing.



---

archive/issue_comments_273315.json:
```json
{
    "body": "1. You need to define the GSL aliases, note the command line:\n\n> gcc -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -fPIC **-Igsl_include_dirs** -I/home/worker/sage-patchbot/local/lib/python2.7/site-packages/cysignals -I/home/worker/sage-patchbot/local/include -I/home/worker/sage-patchbot/local/include/python2.7 -I/home/worker/sage-patchbot/local/lib/python2.7/site-packages/numpy/core/include -I/home/worker/sage-patchbot/src -I/home/worker/sage-patchbot/src/sage/ext -I/home/worker/sage-patchbot/src/build/cythonized -I/home/worker/sage-patchbot/src/build/cythonized/sage/ext -I/home/worker/sage-patchbot/local/include/python2.7 -c /home/worker/sage-patchbot/src/build/cythonized/sage/gsl/gsl_array.c -o build/temp.linux-x86_64-2.7/home/worker/sage-patchbot/src/build/cythonized/sage/gsl/gsl_array.o -DGSL_DISABLE_DEPRECATED -fno-strict-aliasing -w\n\n\n2. Can you try to not import `pkgconfig` every time that Sage starts?",
    "created_at": "2016-03-02T09:17:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20133#issuecomment-273315",
    "user": "https://github.com/jdemeyer"
}
```

1. You need to define the GSL aliases, note the command line:

> gcc -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -fPIC **-Igsl_include_dirs** -I/home/worker/sage-patchbot/local/lib/python2.7/site-packages/cysignals -I/home/worker/sage-patchbot/local/include -I/home/worker/sage-patchbot/local/include/python2.7 -I/home/worker/sage-patchbot/local/lib/python2.7/site-packages/numpy/core/include -I/home/worker/sage-patchbot/src -I/home/worker/sage-patchbot/src/sage/ext -I/home/worker/sage-patchbot/src/build/cythonized -I/home/worker/sage-patchbot/src/build/cythonized/sage/ext -I/home/worker/sage-patchbot/local/include/python2.7 -c /home/worker/sage-patchbot/src/build/cythonized/sage/gsl/gsl_array.c -o build/temp.linux-x86_64-2.7/home/worker/sage-patchbot/src/build/cythonized/sage/gsl/gsl_array.o -DGSL_DISABLE_DEPRECATED -fno-strict-aliasing -w


2. Can you try to not import `pkgconfig` every time that Sage starts?



---

archive/issue_comments_273316.json:
```json
{
    "body": "I should have known.\n \nI supposed `pkgconfig` is called from `cython.py` somehow at startup. Would putting the `import pkgconfig` in a method stop that problem?",
    "created_at": "2016-03-02T09:28:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20133#issuecomment-273316",
    "user": "https://github.com/kiwifb"
}
```

I should have known.
 
I supposed `pkgconfig` is called from `cython.py` somehow at startup. Would putting the `import pkgconfig` in a method stop that problem?



---

archive/issue_comments_273317.json:
```json
{
    "body": "Replying to [comment:40 fbissey]:\n> Would putting the `import pkgconfig` in a method stop that problem?\n\n\nYes. Even better, import the whole `cython.py` lazily.",
    "created_at": "2016-03-02T09:31:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20133#issuecomment-273317",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:40 fbissey]:
> Would putting the `import pkgconfig` in a method stop that problem?


Yes. Even better, import the whole `cython.py` lazily.



---

archive/issue_comments_273318.json:
```json
{
    "body": "This should work if you add `import sage.misc.cython` to some doctests:\n\n```diff\ndiff --git a/src/sage/misc/all.py b/src/sage/misc/all.py\nindex 25838c1..071c6d5 100644\n--- a/src/sage/misc/all.py\n+++ b/src/sage/misc/all.py\n@@ -76,8 +76,8 @@ from sage_eval import sage_eval, sageobj\n \n from sage_input import sage_input\n \n-from cython import cython_lambda, cython_create_local_so\n-from cython_c import cython_compile as cython\n+lazy_import(\"sage.misc.cython\", [\"cython_lambda\", \"cython_create_local_so\"])\n+lazy_import(\"sage.misc.cython_c\", \"cython_compile\", \"cython\")\n lazy_import(\"sage.misc.cython_c\", \"cython_compile\", \"pyrex\", deprecation=9552)\n lazy_import(\"sage.misc.cython_c\", \"cython_compile\", \"sagex\", deprecation=9552)\n \n```",
    "created_at": "2016-03-02T09:37:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20133#issuecomment-273318",
    "user": "https://github.com/jdemeyer"
}
```

This should work if you add `import sage.misc.cython` to some doctests:

```diff
diff --git a/src/sage/misc/all.py b/src/sage/misc/all.py
index 25838c1..071c6d5 100644
--- a/src/sage/misc/all.py
+++ b/src/sage/misc/all.py
@@ -76,8 +76,8 @@ from sage_eval import sage_eval, sageobj
 
 from sage_input import sage_input
 
-from cython import cython_lambda, cython_create_local_so
-from cython_c import cython_compile as cython
+lazy_import("sage.misc.cython", ["cython_lambda", "cython_create_local_so"])
+lazy_import("sage.misc.cython_c", "cython_compile", "cython")
 lazy_import("sage.misc.cython_c", "cython_compile", "pyrex", deprecation=9552)
 lazy_import("sage.misc.cython_c", "cython_compile", "sagex", deprecation=9552)
 
```



---

archive/issue_comments_273319.json:
```json
{
    "body": "Re-building and running doctests to find any needed `import sage.misc.cython`.",
    "created_at": "2016-03-02T20:36:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20133#issuecomment-273319",
    "user": "https://github.com/kiwifb"
}
```

Re-building and running doctests to find any needed `import sage.misc.cython`.



---

archive/issue_comments_273320.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-03-03T04:21:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20133#issuecomment-273320",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_273321.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-03-03T07:17:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20133#issuecomment-273321",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_273322.json:
```json
{
    "body": "If you would like to have a look and mark it positive Jeroen.",
    "created_at": "2016-03-03T07:17:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20133#issuecomment-273322",
    "user": "https://github.com/kiwifb"
}
```

If you would like to have a look and mark it positive Jeroen.



---

archive/issue_comments_273323.json:
```json
{
    "body": "Replying to [comment:45 fbissey]:\n> If you would like to have a look and mark it positive Jeroen.\n\n\nCan it wait until the next beta? There are already a lot of tickets closed-but-not-yet-in-develop involving the build system, let's not push things...",
    "created_at": "2016-03-03T08:23:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20133#issuecomment-273323",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:45 fbissey]:
> If you would like to have a look and mark it positive Jeroen.


Can it wait until the next beta? There are already a lot of tickets closed-but-not-yet-in-develop involving the build system, let's not push things...



---

archive/issue_comments_273324.json:
```json
{
    "body": "Sure it is turning to be a very busy beta cycle. Not sure where Volker will want to cut things out.",
    "created_at": "2016-03-03T08:38:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20133#issuecomment-273324",
    "user": "https://github.com/kiwifb"
}
```

Sure it is turning to be a very busy beta cycle. Not sure where Volker will want to cut things out.



---

archive/issue_comments_273325.json:
```json
{
    "body": "Is this ticket supposed to make it possible to use openblas instead of ATLAS?",
    "created_at": "2016-03-03T21:25:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20133#issuecomment-273325",
    "user": "https://github.com/jdemeyer"
}
```

Is this ticket supposed to make it possible to use openblas instead of ATLAS?



---

archive/issue_comments_273326.json:
```json
{
    "body": "New commits:",
    "created_at": "2016-03-03T21:27:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20133#issuecomment-273326",
    "user": "https://github.com/jdemeyer"
}
```

New commits:



---

archive/issue_comments_273327.json:
```json
{
    "body": "Not quite. We still haven't converted numpy/scipy to use `.pc` files - I don't know there is a ticket yet for that. And there is a ticket to select your blas somewhere. But once we deal with numpy/scipy you could get there with a bit of hand holding.",
    "created_at": "2016-03-03T21:31:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20133#issuecomment-273327",
    "user": "https://github.com/kiwifb"
}
```

Not quite. We still haven't converted numpy/scipy to use `.pc` files - I don't know there is a ticket yet for that. And there is a ticket to select your blas somewhere. But once we deal with numpy/scipy you could get there with a bit of hand holding.



---

archive/issue_comments_273328.json:
```json
{
    "body": "There is no way to NOT build ATLAS afaik so thats still missing....",
    "created_at": "2016-03-03T21:34:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20133#issuecomment-273328",
    "user": "https://github.com/vbraun"
}
```

There is no way to NOT build ATLAS afaik so thats still missing....



---

archive/issue_comments_273329.json:
```json
{
    "body": "Someone determined could link `build/pkgs/atlas` to `build/pkgs/openblas` but I have to agree that's not really something I can recommend.",
    "created_at": "2016-03-03T21:40:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20133#issuecomment-273329",
    "user": "https://github.com/kiwifb"
}
```

Someone determined could link `build/pkgs/atlas` to `build/pkgs/openblas` but I have to agree that's not really something I can recommend.



---

archive/issue_comments_273330.json:
```json
{
    "body": "Replying to [comment:54 vbraun]:\n> There is no way to NOT build ATLAS afaik so thats still missing....\n\n\nRight, but I meant the `pkgconfig` part...",
    "created_at": "2016-03-03T22:38:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20133#issuecomment-273330",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:54 vbraun]:
> There is no way to NOT build ATLAS afaik so thats still missing....


Right, but I meant the `pkgconfig` part...



---

archive/issue_comments_273331.json:
```json
{
    "body": "I am looking into getting `numpy` and `scipy` on board. I'll create a ticket when I am satisfied.",
    "created_at": "2016-03-03T23:29:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20133#issuecomment-273331",
    "user": "https://github.com/kiwifb"
}
```

I am looking into getting `numpy` and `scipy` on board. I'll create a ticket when I am satisfied.



---

archive/issue_comments_273332.json:
```json
{
    "body": "I have started #20157 for getting `numpy` and `scipy` to use `.pc` files. But to come back to Jeroen's technical question and after working on `numpy` for a bit. If you were to build `openblas` instead `atlas` then yes it should all build and work (but there is at least one doctest producing numerical noise). Note that `numpy` tries `openblas` before `atlas`. So if you have both installed `openblas` will be favored by default.",
    "created_at": "2016-03-04T04:14:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20133#issuecomment-273332",
    "user": "https://github.com/kiwifb"
}
```

I have started #20157 for getting `numpy` and `scipy` to use `.pc` files. But to come back to Jeroen's technical question and after working on `numpy` for a bit. If you were to build `openblas` instead `atlas` then yes it should all build and work (but there is at least one doctest producing numerical noise). Note that `numpy` tries `openblas` before `atlas`. So if you have both installed `openblas` will be favored by default.



---

archive/issue_comments_273333.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-03-04T06:48:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20133#issuecomment-273333",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_273334.json:
```json
{
    "body": "The Sage library should depend on `pkgconfig`.",
    "created_at": "2016-03-04T06:48:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20133#issuecomment-273334",
    "user": "https://github.com/jdemeyer"
}
```

The Sage library should depend on `pkgconfig`.



---

archive/issue_comments_273335.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-03-04T07:15:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20133#issuecomment-273335",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_273336.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-03-04T07:16:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20133#issuecomment-273336",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_273337.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-03-04T22:54:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20133#issuecomment-273337",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_273338.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-03-05T09:47:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20133#issuecomment-273338",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_054762.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-03-05T09:47:53Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/20133",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20133#event-54762"
}
```
