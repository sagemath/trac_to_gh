# Issue 20507: Slight annoyance wrt Numpy and ATLAS

archive/issues_020270.json:
```json
{
    "assignees": [],
    "body": "Since #20157 when I build Numpy, as well as anything else that uses `numpy.distutils` (namely SciPy) I get a lot of the warning:\n\n```\natlas_blas_info:\nDisabled atlas_blas_info: (ATLAS is None)\n  libraries f77blas,cblas,atlas not found in []\n  NOT AVAILABLE\n\n/home/embray/src/sagemath/sage/local/var/tmp/sage/build/numpy-1.11.0/src/numpy/distutils/system_info.py:1584: UserWarning:\n    Atlas (http://math-atlas.sourceforge.net/) libraries not found.\n    Directories to search for the libraries can be specified in the\n    numpy/distutils/site.cfg file (section [atlas]) or by setting\n    the ATLAS environment variable.\n```\n\nThis caused me deep confusion considering that my laptop just spent a long, hard night compiling ATLAS :)  Of course, what's actually going on is that Numpy is being configured to use whatever generic blas/lapack it has (which is correctly including `-latlas` in its linker flags).\n\nHowver, the `spkg-install` for Numpy sets the environment variable `ATLAS=None` which forces Numpy's system_info to report that it doesn't have ATLAS.  Of course, it does, so AFAICT this is just a user interface issue albeit a confusing one.\n\nIs there some way we could modify this so that when we do know what BLAS library we're using we at least let Numpy report it correctly?  It could figure this out at install time by checking the lapack.pc and/or blas.pc files.\n\nReviewer: **Michael Orlitzky**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/20507_\n\n",
    "closed_at": "2021-10-04T23:44:13Z",
    "created_at": "2016-04-27T12:13:57Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/bug",
        "https://github.com/sagemath/sage/labels/component%3A%20packages%3A%20standard",
        "https://github.com/sagemath/sage/labels/invalid"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Slight annoyance wrt Numpy and ATLAS",
    "type": "issue",
    "updated_at": "2021-10-04T23:44:13Z",
    "url": "https://github.com/sagemath/sage/issues/20507",
    "user": "https://github.com/embray"
}
```
Since #20157 when I build Numpy, as well as anything else that uses `numpy.distutils` (namely SciPy) I get a lot of the warning:

```
atlas_blas_info:
Disabled atlas_blas_info: (ATLAS is None)
  libraries f77blas,cblas,atlas not found in []
  NOT AVAILABLE

/home/embray/src/sagemath/sage/local/var/tmp/sage/build/numpy-1.11.0/src/numpy/distutils/system_info.py:1584: UserWarning:
    Atlas (http://math-atlas.sourceforge.net/) libraries not found.
    Directories to search for the libraries can be specified in the
    numpy/distutils/site.cfg file (section [atlas]) or by setting
    the ATLAS environment variable.
```

This caused me deep confusion considering that my laptop just spent a long, hard night compiling ATLAS :)  Of course, what's actually going on is that Numpy is being configured to use whatever generic blas/lapack it has (which is correctly including `-latlas` in its linker flags).

Howver, the `spkg-install` for Numpy sets the environment variable `ATLAS=None` which forces Numpy's system_info to report that it doesn't have ATLAS.  Of course, it does, so AFAICT this is just a user interface issue albeit a confusing one.

Is there some way we could modify this so that when we do know what BLAS library we're using we at least let Numpy report it correctly?  It could figure this out at install time by checking the lapack.pc and/or blas.pc files.

Reviewer: **Michael Orlitzky**

_Issue created by migration from https://trac.sagemath.org/ticket/20507_





---

archive/issue_events_271122.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2016-04-27T12:13:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20507",
    "label": "https://github.com/sagemath/sage/labels/p4%20%E2%80%93%20minor",
    "label_color": "ffe799",
    "label_name": "p4 \u2013 minor",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20507#event-271122"
}
```



---

archive/issue_events_271123.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2016-04-27T12:13:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20507",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20507#event-271123"
}
```



---

archive/issue_comments_298683.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">Comment 1</div>\n\nIt would be nice but it may not be what we want. The only way to feed your user configuration whatever it is is to set those variables to `None`. I did this in #20157 and the goal is to have the user choice respected whatever they are. You can read the description in #20157, without disabling everything, I could get whatever is found first in the list rather than what I want. Note that at least one new implementation has been added to the list in 1.11 if I am not mistaken (`bliss`).\n\nAs far as I am concerned `numpy` should take user's wishes first and work out what it is if it can.",
    "created_at": "2016-04-27T20:20:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20507#issuecomment-298683",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:1" align="right">Comment 1</div>

It would be nice but it may not be what we want. The only way to feed your user configuration whatever it is is to set those variables to `None`. I did this in #20157 and the goal is to have the user choice respected whatever they are. You can read the description in #20157, without disabling everything, I could get whatever is found first in the list rather than what I want. Note that at least one new implementation has been added to the list in 1.11 if I am not mistaken (`bliss`).

As far as I am concerned `numpy` should take user's wishes first and work out what it is if it can.



---

archive/issue_comments_298684.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">Comment 2</div>\n\nI tried reading through #20157 but there's a lot of context missing that makes it hard to tease out what the issues really are.\n\nSo what do you mean by \"feed your user configuration\" in this case?  In #20157 you write \"Since we want the choice of blas/lapack to be configurable by .pc files\" but that could be better specified.  What do you mean by that exactly?  What if I don't want to edit a .pc file to change my BLAS or LAPACK libs and instead want to tell Numpy exactly what I'm using through the means it already provides?\n\nWhat this should really be doing is setting all the `ATLAS,PTATLAS,OPENBLAS,MKL,BLISS,etc.` environment variables to 'None' *except* the one for th implementation I'm actually using.\n\nFor now I changed my `spkg-install` for Numpy to just search for `-latlas` in `blas.pc` and unset `ATLAS` if found.  This does the correct thing, but it's still a hack since relying on the `.pc` file alone is not a great way to determine what BLAS I'm actually using (except in this case there is a way, just ad-hoc).",
    "created_at": "2016-05-02T09:50:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20507#issuecomment-298684",
    "user": "https://github.com/embray"
}
```

<div id="comment:2" align="right">Comment 2</div>

I tried reading through #20157 but there's a lot of context missing that makes it hard to tease out what the issues really are.

So what do you mean by "feed your user configuration" in this case?  In #20157 you write "Since we want the choice of blas/lapack to be configurable by .pc files" but that could be better specified.  What do you mean by that exactly?  What if I don't want to edit a .pc file to change my BLAS or LAPACK libs and instead want to tell Numpy exactly what I'm using through the means it already provides?

What this should really be doing is setting all the `ATLAS,PTATLAS,OPENBLAS,MKL,BLISS,etc.` environment variables to 'None' *except* the one for th implementation I'm actually using.

For now I changed my `spkg-install` for Numpy to just search for `-latlas` in `blas.pc` and unset `ATLAS` if found.  This does the correct thing, but it's still a hack since relying on the `.pc` file alone is not a great way to determine what BLAS I'm actually using (except in this case there is a way, just ad-hoc).



---

archive/issue_comments_298685.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">Comment 3</div>\n\nThe means used by `numpy`sucks. Why do you even need to know which blas/lapack you are using? For `ATLAS` it means that `numpy` may use `ATLAS` c interface to lapack - well if you want to do that may be you should look for lapacke instead, something with a standard interface.\n\nThe point being, if you are after blas/lapack functions, they are standard and you shouldn't worry about the implementation underneath. `numpy`'s mechanism is a cute way (at best) to try various known libraries in a given order of preference. My preference would be for `numpy` to start looking for something I feed it before/rather than trying autodetection.",
    "created_at": "2016-05-02T10:06:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20507#issuecomment-298685",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:3" align="right">Comment 3</div>

The means used by `numpy`sucks. Why do you even need to know which blas/lapack you are using? For `ATLAS` it means that `numpy` may use `ATLAS` c interface to lapack - well if you want to do that may be you should look for lapacke instead, something with a standard interface.

The point being, if you are after blas/lapack functions, they are standard and you shouldn't worry about the implementation underneath. `numpy`'s mechanism is a cute way (at best) to try various known libraries in a given order of preference. My preference would be for `numpy` to start looking for something I feed it before/rather than trying autodetection.



---

archive/issue_comments_298686.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">Comment 4</div>\n\nIf I set `ATLAS` to something more useful then it will look for something I'm feeding it.\n\nLike I said in the original ticket, it's a minor but confusing annoyance that Numpy tells me it can't find ATLAS even when it is using ATLAS.  I agree it doesn't matter for the end result, but it makes it impossible to read the build log and determine what BLAS implementation Numpy did find.  This is even more confusing when configuring SciPy.\n\nIs there some discussion you could refer me to where it was decided what the best way should be to configure BLAS for Sage?  Because somewhere along the line you probably *do* know what you're using.  And if you don't then you're using ATLAS since that's what Sage builds by default.  So there's no reason for Numpy to report something inaccurate.\n\nAs I wrote in my previous comment if I know I'm using ATLAS and I unset the `ATLAS` environment variable then the issue is resolved.  What the `spkg-install` is doing currently removes context from the Numpy configuration unnecessarily.",
    "created_at": "2016-05-02T10:14:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20507#issuecomment-298686",
    "user": "https://github.com/embray"
}
```

<div id="comment:4" align="right">Comment 4</div>

If I set `ATLAS` to something more useful then it will look for something I'm feeding it.

Like I said in the original ticket, it's a minor but confusing annoyance that Numpy tells me it can't find ATLAS even when it is using ATLAS.  I agree it doesn't matter for the end result, but it makes it impossible to read the build log and determine what BLAS implementation Numpy did find.  This is even more confusing when configuring SciPy.

Is there some discussion you could refer me to where it was decided what the best way should be to configure BLAS for Sage?  Because somewhere along the line you probably *do* know what you're using.  And if you don't then you're using ATLAS since that's what Sage builds by default.  So there's no reason for Numpy to report something inaccurate.

As I wrote in my previous comment if I know I'm using ATLAS and I unset the `ATLAS` environment variable then the issue is resolved.  What the `spkg-install` is doing currently removes context from the Numpy configuration unnecessarily.



---

archive/issue_comments_298687.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">Comment 5</div>\n\nOK the current default in `sage` is to build ATLAS but Volker and I have been in this conspiracy for at least a couple of year to make `sage` use any blas/lapack we like - mirroring a possibility already existing in sage-on-gentoo. \nWe left a track of tickets, although there has been a few private emails as well, starting with bringing pkgconf in `sage` (although it had other side purpose) then its python interface. So we got the current ATLAS spkg install a .pc and probably also the optional openblas spkg and started to make use of .pc files all over the place.\nnumpy/scipy was the latest place not using the .pc file for blas/lapack and I made it behave, with a slightly lighter hand than what is done in pure Gentoo actually.\n\nThere has been the occasional email on sage-devel about using MKL and other alternatives blas/lapack but only few people have shown a big interest.",
    "created_at": "2016-05-02T10:29:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20507#issuecomment-298687",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:5" align="right">Comment 5</div>

OK the current default in `sage` is to build ATLAS but Volker and I have been in this conspiracy for at least a couple of year to make `sage` use any blas/lapack we like - mirroring a possibility already existing in sage-on-gentoo. 
We left a track of tickets, although there has been a few private emails as well, starting with bringing pkgconf in `sage` (although it had other side purpose) then its python interface. So we got the current ATLAS spkg install a .pc and probably also the optional openblas spkg and started to make use of .pc files all over the place.
numpy/scipy was the latest place not using the .pc file for blas/lapack and I made it behave, with a slightly lighter hand than what is done in pure Gentoo actually.

There has been the occasional email on sage-devel about using MKL and other alternatives blas/lapack but only few people have shown a big interest.



---

archive/issue_comments_298688.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">Comment 6</div>\n\nI think those are fine goals to have, and are not necessarily contradictory with what I'm proposing--in fact the opposite.  If there were a clearer way during a build of sage+dependencies to specify which BLAS implementation is being built with, it wouldn't be necessary to disable detection of that library in Numpy, Scipy, or anything else that uses `numpy.distutils`.\n\nIn other words, it would be good to configure Sage at build time what BLAS it's using in such a way that it can pass that on to other packages as well in case they do care, or just for the sake of provenance / reporting.\n\nIn the meantime this *can* be sort of done in the limited case of ATLAS, albeit in a somewhat fragile sense, by checking for `-latlas`.  If/when Sage improves support for other libraries that could be handled on a case-by-case basis.",
    "created_at": "2016-05-02T12:37:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20507#issuecomment-298688",
    "user": "https://github.com/embray"
}
```

<div id="comment:6" align="right">Comment 6</div>

I think those are fine goals to have, and are not necessarily contradictory with what I'm proposing--in fact the opposite.  If there were a clearer way during a build of sage+dependencies to specify which BLAS implementation is being built with, it wouldn't be necessary to disable detection of that library in Numpy, Scipy, or anything else that uses `numpy.distutils`.

In other words, it would be good to configure Sage at build time what BLAS it's using in such a way that it can pass that on to other packages as well in case they do care, or just for the sake of provenance / reporting.

In the meantime this *can* be sort of done in the limited case of ATLAS, albeit in a somewhat fragile sense, by checking for `-latlas`.  If/when Sage improves support for other libraries that could be handled on a case-by-case basis.



---

archive/issue_comments_298689.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">Comment 7</div>\n\nReplying to [@embray](#comment%3A6):\n> If there were a clearer way during a build of sage+dependencies to specify which BLAS implementation is being built with\n\nWasn't that the whole point of #17075?",
    "created_at": "2016-05-02T12:42:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20507#issuecomment-298689",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:7" align="right">Comment 7</div>

Replying to [@embray](#comment%3A6):
> If there were a clearer way during a build of sage+dependencies to specify which BLAS implementation is being built with

Wasn't that the whole point of #17075?



---

archive/issue_comments_298690.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">Comment 8</div>\n\nI don't know if that was the whole point of #17075, but the result of that ticket does not achieve what I'm talking about.",
    "created_at": "2016-05-02T12:45:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20507#issuecomment-298690",
    "user": "https://github.com/embray"
}
```

<div id="comment:8" align="right">Comment 8</div>

I don't know if that was the whole point of #17075, but the result of that ticket does not achieve what I'm talking about.



---

archive/issue_comments_298691.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">Comment 9</div>\n\nReplying to [@embray](#comment%3A8):\n> I don't know if that was the whole point of #17075, but the result of that ticket does not achieve what I'm talking about.\n\nReally? Then I am missing something, either in this ticket or in #17075...\n\nBecause of #17075, you no longer need to know which BLAS implementation Sage uses, just query `pkgconfig`. See `src/module_list.py` for an implementation of this. So we just need numpy to respect these `pkgconfig` files, right?",
    "created_at": "2016-05-02T13:08:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20507#issuecomment-298691",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:9" align="right">Comment 9</div>

Replying to [@embray](#comment%3A8):
> I don't know if that was the whole point of #17075, but the result of that ticket does not achieve what I'm talking about.

Really? Then I am missing something, either in this ticket or in #17075...

Because of #17075, you no longer need to know which BLAS implementation Sage uses, just query `pkgconfig`. See `src/module_list.py` for an implementation of this. So we just need numpy to respect these `pkgconfig` files, right?



---

archive/issue_comments_298692.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">Comment 10</div>\n\nNext step may be to add options in `configure` for users to provide details of the blas/lapack setup instead of using the old environment variable for system ATLAS. But that's orthogonal to this ticket.",
    "created_at": "2016-05-02T23:10:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20507#issuecomment-298692",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:10" align="right">Comment 10</div>

Next step may be to add options in `configure` for users to provide details of the blas/lapack setup instead of using the old environment variable for system ATLAS. But that's orthogonal to this ticket.



---

archive/issue_comments_298693.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">Comment 11</div>\n\nMaybe I can try to be more specific.  Indeed there are two issues here.  The first is pretty far removed from this issue but not \"orthogonal\" either.\n\nOn the pkg-config files I think it would be good to emulate Debian's work on this.  For each BLAS implementation (and LAPACK) it installs a .pc file *specific* to that implementation.  For example \"blas-atlas.pc\".  (It also makes good distinction between `Libs` and `Libs.private` in those files--for example `-latlas` is only needed in `Libs.private`).  The libraries themselves are installed in `${prefix}/lib/atlas-base` (roughly speaking).  There under `${prefix}/lib` and `${prefix}/lib/pkgconfig` there are generic symlinkss for `libblas.so` and `blas.pc` respectively.  The Debian alternatives system is used to manage which implementation those symlinks point to.  Point being that it's clear on inspection which implementation is being used at any given time, and the library name and version can also be used at build time for provenance purposes.\n\nSage doesn't have anything quite like Debian alternatives that I'm aware of.  But it could, at least for the specific case of linear algebra libraries, and I think that would be a little nicer than the current situation where installing ATLAS just (partially) clobbers OpenBLAS and vice-versa.  For example up above fbissey suggested using `configure` to provide the BLAS we want to use.  Right now the only supported values are \"atlas\" or \"openblas\" but that's fine.  Those spkgs can also be responsible for deciding whether to build a copy for Sage or use the user's system installation, as the ATLAS spkg currently does (but not OpenBLAS from the look of it).  Selecting one of these at configure time would set a make variable called `$(BLAS)` (for example) that points to the appropriate spkg.\n\nA generic meta-package called simply \"blas\" can be used as a dependencies of other packages that currently explicitly depend on \"atlas\" (unless some package *specifically* requires ATLAS).  The only (?) dependency of the \"blas\" metapackage is `$(BLAS)`.  Installing the \"blas\" metapackage can also handle the `update-alternatives` like functionality of moving symlinks around depending on `$(BLAS)`.\n\nAnyways that's my current thinking on the subject.  Getting back to Numpy *specifically* (and scipy), if there is a `$SAGE_BLAS`-like variable available when its `spkg-install` is run we don't have to set all of Numpy's `BLAS`-related environment variables to `None`.  Just all except the one we have explicitly selected to build Sage with.  Then it is unnecessary as far as I can tell to completely hobble Numpy's auto-detection.  It is guiding the auto-detection to pick exactly the implementation you want and nothing more, and it can at least accurately report what BLAS it was configured with (which it currently does not in Sage, and that's what was confusing to me in the first place).\n\nI'll grant you that currently there are hardly any places where this matters practically (there is one place in SciPy that it does and I'm not sure it's that significant).  That's why I marked this as \"minor\".  It just struck me as unnecessarily limited, and an indication of an area where improvement could still be used.",
    "created_at": "2016-05-03T09:36:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20507#issuecomment-298693",
    "user": "https://github.com/embray"
}
```

<div id="comment:11" align="right">Comment 11</div>

Maybe I can try to be more specific.  Indeed there are two issues here.  The first is pretty far removed from this issue but not "orthogonal" either.

On the pkg-config files I think it would be good to emulate Debian's work on this.  For each BLAS implementation (and LAPACK) it installs a .pc file *specific* to that implementation.  For example "blas-atlas.pc".  (It also makes good distinction between `Libs` and `Libs.private` in those files--for example `-latlas` is only needed in `Libs.private`).  The libraries themselves are installed in `${prefix}/lib/atlas-base` (roughly speaking).  There under `${prefix}/lib` and `${prefix}/lib/pkgconfig` there are generic symlinkss for `libblas.so` and `blas.pc` respectively.  The Debian alternatives system is used to manage which implementation those symlinks point to.  Point being that it's clear on inspection which implementation is being used at any given time, and the library name and version can also be used at build time for provenance purposes.

Sage doesn't have anything quite like Debian alternatives that I'm aware of.  But it could, at least for the specific case of linear algebra libraries, and I think that would be a little nicer than the current situation where installing ATLAS just (partially) clobbers OpenBLAS and vice-versa.  For example up above fbissey suggested using `configure` to provide the BLAS we want to use.  Right now the only supported values are "atlas" or "openblas" but that's fine.  Those spkgs can also be responsible for deciding whether to build a copy for Sage or use the user's system installation, as the ATLAS spkg currently does (but not OpenBLAS from the look of it).  Selecting one of these at configure time would set a make variable called `$(BLAS)` (for example) that points to the appropriate spkg.

A generic meta-package called simply "blas" can be used as a dependencies of other packages that currently explicitly depend on "atlas" (unless some package *specifically* requires ATLAS).  The only (?) dependency of the "blas" metapackage is `$(BLAS)`.  Installing the "blas" metapackage can also handle the `update-alternatives` like functionality of moving symlinks around depending on `$(BLAS)`.

Anyways that's my current thinking on the subject.  Getting back to Numpy *specifically* (and scipy), if there is a `$SAGE_BLAS`-like variable available when its `spkg-install` is run we don't have to set all of Numpy's `BLAS`-related environment variables to `None`.  Just all except the one we have explicitly selected to build Sage with.  Then it is unnecessary as far as I can tell to completely hobble Numpy's auto-detection.  It is guiding the auto-detection to pick exactly the implementation you want and nothing more, and it can at least accurately report what BLAS it was configured with (which it currently does not in Sage, and that's what was confusing to me in the first place).

I'll grant you that currently there are hardly any places where this matters practically (there is one place in SciPy that it does and I'm not sure it's that significant).  That's why I marked this as "minor".  It just struck me as unnecessarily limited, and an indication of an area where improvement could still be used.



---

archive/issue_comments_298694.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">Comment 12</div>\n\nI am familiar with debian alternatives and its equivalent implementation in gentoo. I am sure Jeroen is too. Like you say I am not sure we want to go the full way in sage.\n\nA meta package is I guess a vehicle we all have in mind but no one has committed to writing that yet. Although the current spkg is partly a meta-package already.\n\nWhen I wrote about `configure` I didn't think about choosing the \"internal\" blas/lapack but providing a system one if desired, but choosing an internal one should probably be covered there as well.\n\nI'll note that numpy/scipy is an oddity in informing you of the blas/lapack used. Auto-detection by configure script  is difficult because of the variety of implementations. Most configure script just ask for the library you want to use and don't really care what they are, only that they work.\n\nBut to go back to your point, once you have gone to .pc files some information is held in `{blas,cblas,lapack}.pc` the content could be a bit more informative at least when set up by an internal spkg.\n\n```\nSAGE_ROOT=/Users/fbissey/build/sage-7.2.beta5\nprefix=${SAGE_ROOT}/local\nlibdir=${prefix}/lib\nincludedir=${prefix}/include\nName: blas\nVersion: 1.0\nDescription: blas for sage, set up by the ATLAS spkg.\nLibs: -L${libdir} -lblas\n```\nabove the `blas.pc` on my mac. On mac we use Apple's accelerate framework (and it is set up by the atlas spkg, as I say that spkg already has meta bits). The description could reflect the fact that it is accelerate not just that it has been set by the atlas spkg.",
    "created_at": "2016-05-03T10:34:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20507#issuecomment-298694",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:12" align="right">Comment 12</div>

I am familiar with debian alternatives and its equivalent implementation in gentoo. I am sure Jeroen is too. Like you say I am not sure we want to go the full way in sage.

A meta package is I guess a vehicle we all have in mind but no one has committed to writing that yet. Although the current spkg is partly a meta-package already.

When I wrote about `configure` I didn't think about choosing the "internal" blas/lapack but providing a system one if desired, but choosing an internal one should probably be covered there as well.

I'll note that numpy/scipy is an oddity in informing you of the blas/lapack used. Auto-detection by configure script  is difficult because of the variety of implementations. Most configure script just ask for the library you want to use and don't really care what they are, only that they work.

But to go back to your point, once you have gone to .pc files some information is held in `{blas,cblas,lapack}.pc` the content could be a bit more informative at least when set up by an internal spkg.

```
SAGE_ROOT=/Users/fbissey/build/sage-7.2.beta5
prefix=${SAGE_ROOT}/local
libdir=${prefix}/lib
includedir=${prefix}/include
Name: blas
Version: 1.0
Description: blas for sage, set up by the ATLAS spkg.
Libs: -L${libdir} -lblas
```
above the `blas.pc` on my mac. On mac we use Apple's accelerate framework (and it is set up by the atlas spkg, as I say that spkg already has meta bits). The description could reflect the fact that it is accelerate not just that it has been set by the atlas spkg.



---

archive/issue_comments_298695.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">Comment 13</div>\n\nReplying to [@embray](#comment%3A11):\n> Sage doesn't have anything quite like Debian alternatives that I'm aware of.  But it could, at least for the specific case of linear algebra libraries, and I think that would be a little nicer than the current situation where installing ATLAS just (partially) clobbers OpenBLAS and vice-versa.\n\nI think it's overkill to allow side-by-side installation of different BLAS libraries within Sage. I agree that there should be a choice (just like we already have between MPIR and GMP or between Python2 and Python3) but there is no need to support two installations at the same time.",
    "created_at": "2016-05-03T11:23:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20507#issuecomment-298695",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:13" align="right">Comment 13</div>

Replying to [@embray](#comment%3A11):
> Sage doesn't have anything quite like Debian alternatives that I'm aware of.  But it could, at least for the specific case of linear algebra libraries, and I think that would be a little nicer than the current situation where installing ATLAS just (partially) clobbers OpenBLAS and vice-versa.

I think it's overkill to allow side-by-side installation of different BLAS libraries within Sage. I agree that there should be a choice (just like we already have between MPIR and GMP or between Python2 and Python3) but there is no need to support two installations at the same time.



---

archive/issue_comments_298696.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">Comment 14</div>\n\nI don't think it's overkill at all, and as I described above is fairly straightforward to do.  For example if you wanted to do performance comparisons between BLAS libraries having parallel installations would make it easy--otherwise one would have to have fully separate parallel Sage installs.",
    "created_at": "2016-05-03T12:37:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20507#issuecomment-298696",
    "user": "https://github.com/embray"
}
```

<div id="comment:14" align="right">Comment 14</div>

I don't think it's overkill at all, and as I described above is fairly straightforward to do.  For example if you wanted to do performance comparisons between BLAS libraries having parallel installations would make it easy--otherwise one would have to have fully separate parallel Sage installs.



---

archive/issue_comments_298697.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">Comment 15</div>\n\nReplying to [@embray](#comment%3A14):\n> as I described above is fairly straightforward to do.\n\nI have big doubts about this statement...\n\nIt's not sufficient to deal just with the BLAS libraries themselves, but also other packages (Python packages, other libraries) depending on BLAS...",
    "created_at": "2016-05-03T12:46:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20507#issuecomment-298697",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:15" align="right">Comment 15</div>

Replying to [@embray](#comment%3A14):
> as I described above is fairly straightforward to do.

I have big doubts about this statement...

It's not sufficient to deal just with the BLAS libraries themselves, but also other packages (Python packages, other libraries) depending on BLAS...



---

archive/issue_comments_298698.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">Comment 16</div>\n\nI created a ticket #20542 to allow using openblas instead of ATLAS in Sage (but not a side-by-side installation of both).",
    "created_at": "2016-05-03T12:48:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20507#issuecomment-298698",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:16" align="right">Comment 16</div>

I created a ticket #20542 to allow using openblas instead of ATLAS in Sage (but not a side-by-side installation of both).



---

archive/issue_comments_298699.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">Comment 17</div>\n\nIf I spent some 24 hours waiting for ATLAS to build, and then I install OpenBLAS, it will clobber my ATLAS installation.  That alone is a good reason to allow side-by-side installation.\n\nI'm not saying that other packages might not need to be rebuilt if you switch (some maybe, others no), but switching shouldn't be a matter of effectively uninstalling one library or the other.",
    "created_at": "2016-05-03T13:33:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20507#issuecomment-298699",
    "user": "https://github.com/embray"
}
```

<div id="comment:17" align="right">Comment 17</div>

If I spent some 24 hours waiting for ATLAS to build, and then I install OpenBLAS, it will clobber my ATLAS installation.  That alone is a good reason to allow side-by-side installation.

I'm not saying that other packages might not need to be rebuilt if you switch (some maybe, others no), but switching shouldn't be a matter of effectively uninstalling one library or the other.



---

archive/issue_comments_298700.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">Comment 18</div>\n\nI see your point but I still think it's a large effort for a small gain...",
    "created_at": "2016-05-03T13:38:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20507#issuecomment-298700",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:18" align="right">Comment 18</div>

I see your point but I still think it's a large effort for a small gain...



---

archive/issue_comments_298701.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">Comment 19</div>\n\nI don't know. I think #20542 did a large portion of the work (thanks!).  Maybe there's something I'm not seeing that you think makes this difficult.",
    "created_at": "2016-05-03T13:43:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20507#issuecomment-298701",
    "user": "https://github.com/embray"
}
```

<div id="comment:19" align="right">Comment 19</div>

I don't know. I think #20542 did a large portion of the work (thanks!).  Maybe there's something I'm not seeing that you think makes this difficult.



---

archive/issue_events_271124.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-04-24T14:52:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20507",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20packages%3A%20standard",
    "label_color": "000080",
    "label_name": "component: packages: standard",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20507#event-271124"
}
```



---

archive/issue_events_271125.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-09-25T17:36:20Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20507",
    "label": "https://github.com/sagemath/sage/labels/p4%20%E2%80%93%20minor",
    "label_color": "ffe799",
    "label_name": "p4 \u2013 minor",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20507#event-271125"
}
```



---

archive/issue_events_271126.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-09-25T17:36:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20507",
    "label": "https://github.com/sagemath/sage/labels/invalid",
    "label_color": "a6a6a6",
    "label_name": "invalid",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20507#event-271126"
}
```



---

archive/issue_comments_298702.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">Comment 21</div>\n\nOutdated, should close",
    "created_at": "2021-09-25T17:36:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20507#issuecomment-298702",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:21" align="right">Comment 21</div>

Outdated, should close



---

archive/issue_events_271127.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-09-25T17:36:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20507",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20507#event-271127"
}
```



---

archive/issue_events_271128.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2021-10-04T23:25:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20507",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20507#event-271128"
}
```



---

archive/issue_events_271129.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2021-10-04T23:25:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20507",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20507#event-271129"
}
```



---

archive/issue_comments_298703.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">Comment 22</div>\n\nSPKG management problems should generally be solved with a system package, not by adding more complexity to sage's duct-tape package manager. In any case, Atlas is being removed soon in #30350.",
    "created_at": "2021-10-04T23:25:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20507#issuecomment-298703",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:22" align="right">Comment 22</div>

SPKG management problems should generally be solved with a system package, not by adding more complexity to sage's duct-tape package manager. In any case, Atlas is being removed soon in #30350.



---

archive/issue_comments_298704.json:
```json
{
    "body": "Reviewer: **Michael Orlitzky**",
    "created_at": "2021-10-04T23:25:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20507#issuecomment-298704",
    "user": "https://github.com/orlitzky"
}
```

Reviewer: **Michael Orlitzky**



---

archive/issue_events_271130.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-10-04T23:44:13Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20507",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20507#event-271130"
}
```



---

archive/issue_events_271131.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-10-04T23:44:13Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/20507",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20507#event-271131"
}
```
