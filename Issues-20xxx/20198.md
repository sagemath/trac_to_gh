# Issue 20198: `LinearCode(C)` for some code `C` should construct a code

archive/issues_019961.json:
```json
{
    "body": "With the recent sub-classing framework for linear codes, it is now often useful to recast a code from some family as a generic linear code, thus forgetting its structure, e.g.\n\n```\nsage: C = codes.GeneralizedReedSolomonCode(GF(23).list(), 12)\nsage: Chan = channels.StaticErrorRateChannel(GF(23)^7, 2)\nsage: %timeit C.decode(Chan(C.random_element()))\n<some short time>\nsage: C_dumb = LinearCode(C)\nsage: %timeit C_dumb.decode(Chan(C_dumb.random_element()))\n<loong time>\n```\n\nExcept the above code doesn't work, since `LinearCode` expects a matrix, and can't understand a code as input.\n\n\nCC:  dlucas\n\nKeywords: linear code, beginner\n\nBranch/Commit: 6162d956dff16a29fa9a57fe28329473a8e1c706\n\nReviewer: Johan Sebastian Rosenkilde Nielsen\n\nAuthor: Charles Prior\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/20198\n\n",
    "closed_at": "2016-03-31T18:41:44Z",
    "created_at": "2016-03-11T10:39:59Z",
    "labels": [
        "component: coding theory"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.1",
    "title": "`LinearCode(C)` for some code `C` should construct a code",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/20198",
    "user": "https://github.com/johanrosenkilde"
}
```
With the recent sub-classing framework for linear codes, it is now often useful to recast a code from some family as a generic linear code, thus forgetting its structure, e.g.

```
sage: C = codes.GeneralizedReedSolomonCode(GF(23).list(), 12)
sage: Chan = channels.StaticErrorRateChannel(GF(23)^7, 2)
sage: %timeit C.decode(Chan(C.random_element()))
<some short time>
sage: C_dumb = LinearCode(C)
sage: %timeit C_dumb.decode(Chan(C_dumb.random_element()))
<loong time>
```

Except the above code doesn't work, since `LinearCode` expects a matrix, and can't understand a code as input.


CC:  dlucas

Keywords: linear code, beginner

Branch/Commit: 6162d956dff16a29fa9a57fe28329473a8e1c706

Reviewer: Johan Sebastian Rosenkilde Nielsen

Author: Charles Prior

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/20198





---

archive/issue_comments_274446.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-03-29T21:50:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20198",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20198#issuecomment-274446",
    "user": "https://trac.sagemath.org/admin/accounts/users/cprior"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_274447.json:
```json
{
    "body": "<a id='comment:3'></a>New commits:",
    "created_at": "2016-03-29T21:50:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20198",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20198#issuecomment-274447",
    "user": "https://trac.sagemath.org/admin/accounts/users/cprior"
}
```

<a id='comment:3'></a>New commits:



---

archive/issue_comments_274448.json:
```json
{
    "body": "<a id='comment:4'></a>Note that the provided example (ignoring the part relating to the requested functionality) never worked. We have:\n\n```\nsage: C = codes.GeneralizedReedSolomonCode(GF(23).list(), 12)\nsage: Chan = channels.StaticErrorRateChannel(GF(23)^7, 2)\nsage: C.decode(Chan(C.random_element()))\nTraceback (most recent call last)\n...\nTypeError: Message must be an element of the input space for the given channel\n```\n\nPerhaps you meant something more like this?\n\n```\nsage: C = codes.GeneralizedReedSolomonCode(GF(23).list(), 12)\nsage: Chan = channels.StaticErrorRateChannel(GF(23)^23, 2)\nsage: C.decode_to_code(Chan(C.random_element())) # using the superseding decode_to_code function\n(10, 17, 5, 20, 9, 1, 3, 18, 8, 20, 13, 5, 20, 16, 12, 22, 18, 3, 13, 17, 11, 11, 4) # random\n```\n\nThis doesn't affect my patch, unless you were to use this example to test it.",
    "created_at": "2016-03-29T21:58:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20198",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20198#issuecomment-274448",
    "user": "https://trac.sagemath.org/admin/accounts/users/cprior"
}
```

<a id='comment:4'></a>Note that the provided example (ignoring the part relating to the requested functionality) never worked. We have:

```
sage: C = codes.GeneralizedReedSolomonCode(GF(23).list(), 12)
sage: Chan = channels.StaticErrorRateChannel(GF(23)^7, 2)
sage: C.decode(Chan(C.random_element()))
Traceback (most recent call last)
...
TypeError: Message must be an element of the input space for the given channel
```

Perhaps you meant something more like this?

```
sage: C = codes.GeneralizedReedSolomonCode(GF(23).list(), 12)
sage: Chan = channels.StaticErrorRateChannel(GF(23)^23, 2)
sage: C.decode_to_code(Chan(C.random_element())) # using the superseding decode_to_code function
(10, 17, 5, 20, 9, 1, 3, 18, 8, 20, 13, 5, 20, 16, 12, 22, 18, 3, 13, 17, 11, 11, 4) # random
```

This doesn't affect my patch, unless you were to use this example to test it.



---

archive/issue_comments_274449.json:
```json
{
    "body": "<a id='comment:5'></a>Awesome, thanks for the patch! I'll look at it momentarily.\n\nYou're right about my typo: it should have been `^23` and not `^7`. What do you mean \"superseding `decode_to_code`\" -- that method is not superseded (contrarily, that and `decode_to_message` both supersede `decode`).\n\nBest,\nJohan",
    "created_at": "2016-03-30T07:01:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20198",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20198#issuecomment-274449",
    "user": "https://github.com/johanrosenkilde"
}
```

<a id='comment:5'></a>Awesome, thanks for the patch! I'll look at it momentarily.

You're right about my typo: it should have been `^23` and not `^7`. What do you mean "superseding `decode_to_code`" -- that method is not superseded (contrarily, that and `decode_to_message` both supersede `decode`).

Best,
Johan



---

archive/issue_comments_274450.json:
```json
{
    "body": "<a id='comment:6'></a>I think your logic can be simplified somewhat: In the code case, you should use something like `generator = generator.generator_matrix()` instead. You are promised that this is a full rank matrix (that's part of the contract of that method). So the check that `basis` is as long as the rank of `generator` is not necessary here and can be moved into the `try` block for the generator matrix case. And now the computation of `basis` does not have to be done twice.\n\nBest,\nJohan",
    "created_at": "2016-03-30T07:21:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20198",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20198#issuecomment-274450",
    "user": "https://github.com/johanrosenkilde"
}
```

<a id='comment:6'></a>I think your logic can be simplified somewhat: In the code case, you should use something like `generator = generator.generator_matrix()` instead. You are promised that this is a full rank matrix (that's part of the contract of that method). So the check that `basis` is as long as the rank of `generator` is not necessary here and can be moved into the `try` block for the generator matrix case. And now the computation of `basis` does not have to be done twice.

Best,
Johan



---

archive/issue_comments_274451.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-03-30T13:09:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20198",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20198#issuecomment-274451",
    "user": "https://github.com/johanrosenkilde"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_274452.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-03-30T14:23:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20198",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20198#issuecomment-274452",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_274453.json:
```json
{
    "body": "<a id='comment:9'></a>Replying to [comment:6 jsrn]:\n> I think your logic can be simplified somewhat: In the code case, you should use something like `generator = generator.generator_matrix()` instead. You are promised that this is a full rank matrix (that's part of the contract of that method). So the check that `basis` is as long as the rank of `generator` is not necessary here and can be moved into the `try` block for the generator matrix case. And now the computation of `basis` does not have to be done twice.\n> \n> Best,\n> Johan\n\n\nI implemented your suggestions, let me know what you think.\n\nReplying to [comment:5 jsrn]:\n> Awesome, thanks for the patch! I'll look at it momentarily.\n> \n> You're right about my typo: it should have been `^23` and not `^7`. What do you mean \"superseding `decode_to_code`\" -- that method is not superseded (contrarily, that and `decode_to_message` both supersede `decode`).\n> \n> Best,\n> Johan\n\n\nSorry I was unclear. I meant that ``decode_to_code`` supersedes ``decode``.",
    "created_at": "2016-03-30T14:27:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20198",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20198#issuecomment-274453",
    "user": "https://trac.sagemath.org/admin/accounts/users/cprior"
}
```

<a id='comment:9'></a>Replying to [comment:6 jsrn]:
> I think your logic can be simplified somewhat: In the code case, you should use something like `generator = generator.generator_matrix()` instead. You are promised that this is a full rank matrix (that's part of the contract of that method). So the check that `basis` is as long as the rank of `generator` is not necessary here and can be moved into the `try` block for the generator matrix case. And now the computation of `basis` does not have to be done twice.
> 
> Best,
> Johan


I implemented your suggestions, let me know what you think.

Replying to [comment:5 jsrn]:
> Awesome, thanks for the patch! I'll look at it momentarily.
> 
> You're right about my typo: it should have been `^23` and not `^7`. What do you mean "superseding `decode_to_code`" -- that method is not superseded (contrarily, that and `decode_to_message` both supersede `decode`).
> 
> Best,
> Johan


Sorry I was unclear. I meant that ``decode_to_code`` supersedes ``decode``.



---

archive/issue_comments_274454.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-03-30T14:27:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20198",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20198#issuecomment-274454",
    "user": "https://trac.sagemath.org/admin/accounts/users/cprior"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_274455.json:
```json
{
    "body": "<a id='comment:12'></a>> \n> I implemented your suggestions, let me know what you think.\n\n\nYou still needlessly recomputed `basis` so I removed that, and also removed some other minor recomputations (which are probably cached anyway, but still). Other than that your code looks good and I accept it. I've run tests on `src/sage/coding` and it's currently testing the rest of the Sage lib, but I'm not expecting any problems. If you can accept my changes, just set to positive_review :-)\n\nBest,\nJohan\n\n---\nNew commits:",
    "created_at": "2016-03-30T18:58:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20198",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20198#issuecomment-274455",
    "user": "https://github.com/johanrosenkilde"
}
```

<a id='comment:12'></a>> 
> I implemented your suggestions, let me know what you think.


You still needlessly recomputed `basis` so I removed that, and also removed some other minor recomputations (which are probably cached anyway, but still). Other than that your code looks good and I accept it. I've run tests on `src/sage/coding` and it's currently testing the rest of the Sage lib, but I'm not expecting any problems. If you can accept my changes, just set to positive_review :-)

Best,
Johan

---
New commits:



---

archive/issue_comments_274456.json:
```json
{
    "body": "<a id='comment:13'></a>Ah sorry that slipped my mind! I looked over the changes you made and they're fine, I also re-ran the doctests on the updated file just to make sure everything's okay as a third-party. I'll set the ticket to positive_review :)\n\nThanks,\nCharlie\n\nP.S. Do we need to change the milestone to sage-7.2? I branched from sage-7.2.beta1 so we shouldn't need to merge anything in.",
    "created_at": "2016-03-30T20:29:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20198",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20198#issuecomment-274456",
    "user": "https://trac.sagemath.org/admin/accounts/users/cprior"
}
```

<a id='comment:13'></a>Ah sorry that slipped my mind! I looked over the changes you made and they're fine, I also re-ran the doctests on the updated file just to make sure everything's okay as a third-party. I'll set the ticket to positive_review :)

Thanks,
Charlie

P.S. Do we need to change the milestone to sage-7.2? I branched from sage-7.2.beta1 so we shouldn't need to merge anything in.



---

archive/issue_comments_274457.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-03-30T20:30:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20198",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20198#issuecomment-274457",
    "user": "https://trac.sagemath.org/admin/accounts/users/cprior"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_054875.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-03-31T18:41:44Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/20198",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20198#event-54875"
}
```



---

archive/issue_comments_274458.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-03-31T18:41:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20198",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20198#issuecomment-274458",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
