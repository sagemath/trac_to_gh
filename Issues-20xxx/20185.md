# Issue 20185: Upgrade to SymPy-1.0

archive/issues_019948.json:
```json
{
    "assignees": [],
    "body": "https://github.com/sympy/sympy/wiki/Release-Notes-for-1.0\n\nIt could be installed as usually \nhttps://github.com/sympy/sympy/releases/download/sympy-1.0/sympy-1.0.tar.gz\nor via `pip install -U sympy`.\n\nBranch/Commit: **[3872f81](https://github.com/sagemath/sagetrac-mirror/commit/3872f81c60ab0ae37d2ec64e240cce80a053edc8)**\n\nReviewer: **Travis Scrimshaw, Ralf Stephan, Volker Braun**\n\nAuthor: **Ralf Stephan**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/20185_\n\n",
    "closed_at": "2016-03-23T12:46:48Z",
    "created_at": "2016-03-10T14:25:21Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20packages%3A%20standard",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-7.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Upgrade to SymPy-1.0",
    "type": "issue",
    "updated_at": "2016-03-23T12:46:48Z",
    "url": "https://github.com/sagemath/sage/issues/20185",
    "user": "https://github.com/rwst"
}
```
https://github.com/sympy/sympy/wiki/Release-Notes-for-1.0

It could be installed as usually 
https://github.com/sympy/sympy/releases/download/sympy-1.0/sympy-1.0.tar.gz
or via `pip install -U sympy`.

Branch/Commit: **[3872f81](https://github.com/sagemath/sagetrac-mirror/commit/3872f81c60ab0ae37d2ec64e240cce80a053edc8)**

Reviewer: **Travis Scrimshaw, Ralf Stephan, Volker Braun**

Author: **Ralf Stephan**

_Issue created by migration from https://trac.sagemath.org/ticket/20185_





---

archive/issue_events_267118.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2016-03-10T14:25:21Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "milestone_number": null,
    "milestone_title": "sage-7.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20185#event-267118"
}
```



---

archive/issue_events_267119.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2016-03-10T14:25:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20packages%3A%20standard",
    "label_color": "000080",
    "label_name": "component: packages: standard",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20185#event-267119"
}
```



---

archive/issue_events_267120.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2016-03-10T14:25:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20185#event-267120"
}
```



---

archive/issue_events_267121.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2016-03-10T14:25:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20185#event-267121"
}
```



---

archive/issue_comments_292782.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,5 @@\n https://github.com/sympy/sympy/wiki/Release-Notes-for-1.0\n \n-It could be installed as usually or via `pip install -U sympy`.\n+It could be installed as usually \n+https://github.com/sympy/sympy/releases/download/sympy-1.0/sympy-1.0.tar.gz\n+or via `pip install -U sympy`.\n``````\n",
    "created_at": "2016-03-10T16:20:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292782",
    "user": "https://github.com/rwst"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,5 @@
 https://github.com/sympy/sympy/wiki/Release-Notes-for-1.0
 
-It could be installed as usually or via `pip install -U sympy`.
+It could be installed as usually 
+https://github.com/sympy/sympy/releases/download/sympy-1.0/sympy-1.0.tar.gz
+or via `pip install -U sympy`.
``````




---

archive/issue_comments_292783.json:
```json
{
    "body": "Branch: **[u/rws/upgrade_to_sympy_1_0](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/upgrade_to_sympy_1_0)**",
    "created_at": "2016-03-10T16:32:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292783",
    "user": "https://github.com/rwst"
}
```

Branch: **[u/rws/upgrade_to_sympy_1_0](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/upgrade_to_sympy_1_0)**



---

archive/issue_comments_292784.json:
```json
{
    "body": "Commit: **[6971607](https://github.com/sagemath/sagetrac-mirror/commit/6971607ce1b72388e57a742ab8f5f0ffb4af1c0e)**",
    "created_at": "2016-03-10T16:32:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292784",
    "user": "https://github.com/rwst"
}
```

Commit: **[6971607](https://github.com/sagemath/sagetrac-mirror/commit/6971607ce1b72388e57a742ab8f5f0ffb4af1c0e)**



---

archive/issue_comments_292785.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">Comment 3</div>\n\n\n```\n$ ./sage -p mpmath\nSuccessfully installed mpmath-0.19\n$ ./sage -p sympy\nbuilding sympy\nPlease install the mpmath package with a version >= 0.19\nError building sympy\n```\nAny hints?\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6971607ce1b72388e57a742ab8f5f0ffb4af1c0e\">6971607</a></td><td><code>pkg version/chksum/patch removed</code></td></tr></table>\n",
    "created_at": "2016-03-10T16:32:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292785",
    "user": "https://github.com/rwst"
}
```

<div id="comment:3" align="right">Comment 3</div>


```
$ ./sage -p mpmath
Successfully installed mpmath-0.19
$ ./sage -p sympy
building sympy
Please install the mpmath package with a version >= 0.19
Error building sympy
```
Any hints?

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6971607ce1b72388e57a742ab8f5f0ffb4af1c0e">6971607</a></td><td><code>pkg version/chksum/patch removed</code></td></tr></table>




---

archive/issue_comments_292786.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">Comment 4</div>\n\nReplying to [@rwst](#comment%3A3):\n> \n> ```\n> $ ./sage -p mpmath\n> Successfully installed mpmath-0.19\n> $ ./sage -p sympy\n> building sympy\n> Please install the mpmath package with a version >= 0.19\n> Error building sympy\n> ```\n> Any hints?\n> \n> ---\n> New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6971607ce1b72388e57a742ab8f5f0ffb4af1c0e\">6971607</a></td><td><code>pkg version/chksum/patch removed</code></td></tr></table>\n\nI think I have. In the past (prior to this version) `sympy`'s `setup.py` was importing `sympy` itself. The danger then was to import the previously installed `sympy` rather the new `sympy`. So we add this\n\n```\nexport PYTHONPATH=\".\"\necho \"building sympy\"\npython -S setup.py build\n```\nThe `-S` is the cause of your trouble, look it up. So you should remove the `PYTHONPATH` stuff, the `-S` and remove the corresponding comments in `spkg-install`.",
    "created_at": "2016-03-11T06:18:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292786",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:4" align="right">Comment 4</div>

Replying to [@rwst](#comment%3A3):
> 
> ```
> $ ./sage -p mpmath
> Successfully installed mpmath-0.19
> $ ./sage -p sympy
> building sympy
> Please install the mpmath package with a version >= 0.19
> Error building sympy
> ```
> Any hints?
> 
> ---
> New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6971607ce1b72388e57a742ab8f5f0ffb4af1c0e">6971607</a></td><td><code>pkg version/chksum/patch removed</code></td></tr></table>

I think I have. In the past (prior to this version) `sympy`'s `setup.py` was importing `sympy` itself. The danger then was to import the previously installed `sympy` rather the new `sympy`. So we add this

```
export PYTHONPATH="."
echo "building sympy"
python -S setup.py build
```
The `-S` is the cause of your trouble, look it up. So you should remove the `PYTHONPATH` stuff, the `-S` and remove the corresponding comments in `spkg-install`.



---

archive/issue_comments_292787.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">Comment 5</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9cdde13f3f20603b467733e881c2bbfb5c1a81a3\">9cdde13</a></td><td><code>20185: remove python -S stuff</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/907bedc76d3289455a701051d1af6c1be64135b1\">907bedc</a></td><td><code>Merge branch 'develop' into t/20185/upgrade_to_sympy_1_0</code></td></tr></table>\n",
    "created_at": "2016-03-11T08:09:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292787",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:5" align="right">Comment 5</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9cdde13f3f20603b467733e881c2bbfb5c1a81a3">9cdde13</a></td><td><code>20185: remove python -S stuff</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/907bedc76d3289455a701051d1af6c1be64135b1">907bedc</a></td><td><code>Merge branch 'develop' into t/20185/upgrade_to_sympy_1_0</code></td></tr></table>




---

archive/issue_comments_292788.json:
```json
{
    "body": "Changed commit from **[6971607](https://github.com/sagemath/sagetrac-mirror/commit/6971607ce1b72388e57a742ab8f5f0ffb4af1c0e)** to **[907bedc](https://github.com/sagemath/sagetrac-mirror/commit/907bedc76d3289455a701051d1af6c1be64135b1)**",
    "created_at": "2016-03-11T08:09:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292788",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[6971607](https://github.com/sagemath/sagetrac-mirror/commit/6971607ce1b72388e57a742ab8f5f0ffb4af1c0e)** to **[907bedc](https://github.com/sagemath/sagetrac-mirror/commit/907bedc76d3289455a701051d1af6c1be64135b1)**



---

archive/issue_comments_292789.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">Comment 6</div>\n\nThanks, that was it. So there are changes that affect doctests:\n\n```\nsage -t --warn-long 27.4 src/sage/symbolic/integration/integral.py  # 1 doctest failed\nsage -t --warn-long 27.4 src/sage/symbolic/expression.pyx  # 3 doctests failed\nsage -t --warn-long 27.2 src/sage/tests/french_book/recequadiff.py  # 2 doctests failed\n```\nThat's only from a partial quick scan.",
    "created_at": "2016-03-11T08:10:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292789",
    "user": "https://github.com/rwst"
}
```

<div id="comment:6" align="right">Comment 6</div>

Thanks, that was it. So there are changes that affect doctests:

```
sage -t --warn-long 27.4 src/sage/symbolic/integration/integral.py  # 1 doctest failed
sage -t --warn-long 27.4 src/sage/symbolic/expression.pyx  # 3 doctests failed
sage -t --warn-long 27.2 src/sage/tests/french_book/recequadiff.py  # 2 doctests failed
```
That's only from a partial quick scan.



---

archive/issue_comments_292790.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">Comment 7</div>\n\n> \n> ```\n> sage -t --warn-long 27.2 src/sage/tests/french_book/recequadiff.py  # 2 doctests failed\n> ```\n\nThis can be minimized to\n\n```\nsage: import sympy\nsage: u = sympy.Function('u'); n = sympy.Symbol('n', integer=True)\nsage: sympy.sympify(3*u(n), evaluate=False)\nNotImplementedError: SymPy function 'u' doesn't exist\n```\nwhich disappears when `3*u(n)` is changed to `u(n)*3` or `u(n)`\n\nEDIT: I will just change the order in the muls for the doctest, and open a ticket. The case is rare and can be fixed after the upgrade.",
    "created_at": "2016-03-11T08:47:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292790",
    "user": "https://github.com/rwst"
}
```

<div id="comment:7" align="right">Comment 7</div>

> 
> ```
> sage -t --warn-long 27.2 src/sage/tests/french_book/recequadiff.py  # 2 doctests failed
> ```

This can be minimized to

```
sage: import sympy
sage: u = sympy.Function('u'); n = sympy.Symbol('n', integer=True)
sage: sympy.sympify(3*u(n), evaluate=False)
NotImplementedError: SymPy function 'u' doesn't exist
```
which disappears when `3*u(n)` is changed to `u(n)*3` or `u(n)`

EDIT: I will just change the order in the muls for the doctest, and open a ticket. The case is rare and can be fixed after the upgrade.



---

archive/issue_comments_292791.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">Comment 8</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f92f927e44e1638efb08f01f2136010d236daaef\">f92f927</a></td><td><code>fix doctests</code></td></tr></table>\n",
    "created_at": "2016-03-11T09:11:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292791",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:8" align="right">Comment 8</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f92f927e44e1638efb08f01f2136010d236daaef">f92f927</a></td><td><code>fix doctests</code></td></tr></table>




---

archive/issue_comments_292792.json:
```json
{
    "body": "Changed commit from **[907bedc](https://github.com/sagemath/sagetrac-mirror/commit/907bedc76d3289455a701051d1af6c1be64135b1)** to **[f92f927](https://github.com/sagemath/sagetrac-mirror/commit/f92f927e44e1638efb08f01f2136010d236daaef)**",
    "created_at": "2016-03-11T09:11:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292792",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[907bedc](https://github.com/sagemath/sagetrac-mirror/commit/907bedc76d3289455a701051d1af6c1be64135b1)** to **[f92f927](https://github.com/sagemath/sagetrac-mirror/commit/f92f927e44e1638efb08f01f2136010d236daaef)**



---

archive/issue_comments_292793.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">Comment 9</div>\n\nIMO [comment:7](#comment%3A7) (#20194) is a serious regression and it should be fixed with the upgrade.",
    "created_at": "2016-03-11T09:52:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292793",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:9" align="right">Comment 9</div>

IMO [comment:7](#comment%3A7) (#20194) is a serious regression and it should be fixed with the upgrade.



---

archive/issue_comments_292794.json:
```json
{
    "body": "Changed commit from **[f92f927](https://github.com/sagemath/sagetrac-mirror/commit/f92f927e44e1638efb08f01f2136010d236daaef)** to **[0391252](https://github.com/sagemath/sagetrac-mirror/commit/03912520043631024635c3d6d09b86743b6c411e)**",
    "created_at": "2016-03-11T16:03:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292794",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[f92f927](https://github.com/sagemath/sagetrac-mirror/commit/f92f927e44e1638efb08f01f2136010d236daaef)** to **[0391252](https://github.com/sagemath/sagetrac-mirror/commit/03912520043631024635c3d6d09b86743b6c411e)**



---

archive/issue_comments_292795.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">Comment 10</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/03912520043631024635c3d6d09b86743b6c411e\">0391252</a></td><td><code>fix doctest</code></td></tr></table>\n",
    "created_at": "2016-03-11T16:03:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292795",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:10" align="right">Comment 10</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/03912520043631024635c3d6d09b86743b6c411e">0391252</a></td><td><code>fix doctest</code></td></tr></table>




---

archive/issue_comments_292796.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">Comment 11</div>\n\nThe doctest is fixed but something seems not right in the sympification of undefined Sage functions. The case in #20194 crashes Sympy's parser and I have reported in https://github.com/sympy/sympy/issues/10795",
    "created_at": "2016-03-11T16:15:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292796",
    "user": "https://github.com/rwst"
}
```

<div id="comment:11" align="right">Comment 11</div>

The doctest is fixed but something seems not right in the sympification of undefined Sage functions. The case in #20194 crashes Sympy's parser and I have reported in https://github.com/sympy/sympy/issues/10795



---

archive/issue_comments_292797.json:
```json
{
    "body": "Author: **Ralf Stephan**",
    "created_at": "2016-03-11T16:16:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292797",
    "user": "https://github.com/rwst"
}
```

Author: **Ralf Stephan**



---

archive/issue_events_267122.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2016-03-11T16:16:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20185#event-267122"
}
```



---

archive/issue_comments_292798.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">Comment 13</div>\n\nDo I understand you correctly that [0391252](https://github.com/sagemath/sagetrac-mirror/commit/03912520043631024635c3d6d09b86743b6c411e) means you do not have to change the test in the French book?",
    "created_at": "2016-03-11T23:03:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292798",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:13" align="right">Comment 13</div>

Do I understand you correctly that [0391252](https://github.com/sagemath/sagetrac-mirror/commit/03912520043631024635c3d6d09b86743b6c411e) means you do not have to change the test in the French book?



---

archive/issue_comments_292799.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">Comment 14</div>\n\nNow that my Sage has finished rebuilding, the answer to my question is no, we still have a regression.",
    "created_at": "2016-03-11T23:53:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292799",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:14" align="right">Comment 14</div>

Now that my Sage has finished rebuilding, the answer to my question is no, we still have a regression.



---

archive/issue_comments_292800.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">Comment 15</div>\n\nWith this branch, we have:\n\n```\nsage: import sympy\nsage: u = sympy.Function('u'); n = sympy.Symbol('n', integer=True)\nsage: x = int(3)\nsage: x*u(n)\n3*u(n)\nsage: sympy.sympify(x*u(n))\n3*u(n)\nsage: sympy.sympify(x*u(n), evaluate=False)\n3*u(n)\n\nsage: x = 3._sympy_()\nsage: sympy.sympify(x*u(n), evaluate=False)\n3*u(n)\n```\nHowever, I think this is the problem:\n\n```\nsage: type(3*u(n))\n<type 'sage.symbolic.expression.Expression'>\nsage: type(u(n)*3)\n<class 'sympy.core.mul.Mul'>\n\nsage: x = int(3)\nsage: type(x*u(n))\n<class 'sympy.core.mul.Mul'>\nsage: type(u(n)*x)\n<class 'sympy.core.mul.Mul'>\n```\nSo it is probably something on our end.",
    "created_at": "2016-03-12T01:11:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292800",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:15" align="right">Comment 15</div>

With this branch, we have:

```
sage: import sympy
sage: u = sympy.Function('u'); n = sympy.Symbol('n', integer=True)
sage: x = int(3)
sage: x*u(n)
3*u(n)
sage: sympy.sympify(x*u(n))
3*u(n)
sage: sympy.sympify(x*u(n), evaluate=False)
3*u(n)

sage: x = 3._sympy_()
sage: sympy.sympify(x*u(n), evaluate=False)
3*u(n)
```
However, I think this is the problem:

```
sage: type(3*u(n))
<type 'sage.symbolic.expression.Expression'>
sage: type(u(n)*3)
<class 'sympy.core.mul.Mul'>

sage: x = int(3)
sage: type(x*u(n))
<class 'sympy.core.mul.Mul'>
sage: type(u(n)*x)
<class 'sympy.core.mul.Mul'>
```
So it is probably something on our end.



---

archive/issue_comments_292801.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">Comment 16</div>\n\nYes, that is the behavior change. Contrast that with the current 7.1.rc0:\n\n```\nsage: import sympy\nsage: u = sympy.Function('u'); n = sympy.Symbol('n', integer=True)\nsage: type(3*u(n))\n<class 'sympy.core.mul.Mul'>\nsage: type(u(n)*3)\n<class 'sympy.core.mul.Mul'>\n```",
    "created_at": "2016-03-12T01:13:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292801",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:16" align="right">Comment 16</div>

Yes, that is the behavior change. Contrast that with the current 7.1.rc0:

```
sage: import sympy
sage: u = sympy.Function('u'); n = sympy.Symbol('n', integer=True)
sage: type(3*u(n))
<class 'sympy.core.mul.Mul'>
sage: type(u(n)*3)
<class 'sympy.core.mul.Mul'>
```



---

archive/issue_comments_292802.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">Comment 17</div>\n\nI also get the same behavior in [comment:15](#comment%3A15) when I am at commit [f92f927](https://github.com/sagemath/sagetrac-mirror/commit/f92f927e44e1638efb08f01f2136010d236daaef).",
    "created_at": "2016-03-12T01:17:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292802",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:17" align="right">Comment 17</div>

I also get the same behavior in [comment:15](#comment%3A15) when I am at commit [f92f927](https://github.com/sagemath/sagetrac-mirror/commit/f92f927e44e1638efb08f01f2136010d236daaef).



---

archive/issue_comments_292803.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">Comment 18</div>\n\nThis is SymPy-0.7.6.1:\n\n```\nsage: parent(u)\n<class 'sympy.core.function.UndefinedFunction'>\nsage: cm = sage.structure.element.get_coercion_model()\nsage: steps,res = cm.analyse(ZZ, parent(u))\nsage: steps\n['Will try _r_action and _l_action']\n```\nThis is 1.0:\n\n```\nsage: parent(u)\n<class 'sympy.core.function.UndefinedFunction'>\nsage: cm = sage.structure.element.get_coercion_model()\nsage: steps,res = cm.analyse(ZZ, parent(u))\nsage: steps\n['Right operand is not Sage element, will try _sage_.',\n 'Will try _r_action and _l_action']\n\nConversion map:\n  From: Integer Ring\n  To:   Symbolic Ring, None))\n```",
    "created_at": "2016-03-13T08:52:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292803",
    "user": "https://github.com/rwst"
}
```

<div id="comment:18" align="right">Comment 18</div>

This is SymPy-0.7.6.1:

```
sage: parent(u)
<class 'sympy.core.function.UndefinedFunction'>
sage: cm = sage.structure.element.get_coercion_model()
sage: steps,res = cm.analyse(ZZ, parent(u))
sage: steps
['Will try _r_action and _l_action']
```
This is 1.0:

```
sage: parent(u)
<class 'sympy.core.function.UndefinedFunction'>
sage: cm = sage.structure.element.get_coercion_model()
sage: steps,res = cm.analyse(ZZ, parent(u))
sage: steps
['Right operand is not Sage element, will try _sage_.',
 'Will try _r_action and _l_action']

Conversion map:
  From: Integer Ring
  To:   Symbolic Ring, None))
```



---

archive/issue_comments_292804.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">Comment 19</div>\n\nSo it seems the issue is coming from the fact that in 0.7.6.1, we have `type(parent(u)) is type` returning `False` before but with 1.0, it is `True`. Which, AFAICS, is only involved in `discover_action`, but the result is still a `None`.\n\n```\nsage: cm.discover_action(ZZ, parent(u(n)), operator.mul)   # Same in 0.7.6.1\n```\nAlthough to be fair, I think we should test against `u(n)` since parentheses get evaluated before `*`. In that case, I get the same result in both versions:\n\n```\nsage: parent(u)\n<class 'sympy.core.function.UndefinedFunction'>\nsage: parent(u(n))\nu\nsage: steps,res = cm.analyse(ZZ, parent(u(n))); steps\n['Will try _r_action and _l_action']\n```\n\nI'm thinking we will need someone who is much more familiar with the coercion framework than I am.",
    "created_at": "2016-03-13T11:33:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292804",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:19" align="right">Comment 19</div>

So it seems the issue is coming from the fact that in 0.7.6.1, we have `type(parent(u)) is type` returning `False` before but with 1.0, it is `True`. Which, AFAICS, is only involved in `discover_action`, but the result is still a `None`.

```
sage: cm.discover_action(ZZ, parent(u(n)), operator.mul)   # Same in 0.7.6.1
```
Although to be fair, I think we should test against `u(n)` since parentheses get evaluated before `*`. In that case, I get the same result in both versions:

```
sage: parent(u)
<class 'sympy.core.function.UndefinedFunction'>
sage: parent(u(n))
u
sage: steps,res = cm.analyse(ZZ, parent(u(n))); steps
['Will try _r_action and _l_action']
```

I'm thinking we will need someone who is much more familiar with the coercion framework than I am.



---

archive/issue_comments_292805.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">Comment 20</div>\n\nAnd indeed, it was #14723 which prompted the addition of `_sage_` methods to many SymPy classes. So no way out of fixing coercion here.",
    "created_at": "2016-03-13T14:08:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292805",
    "user": "https://github.com/rwst"
}
```

<div id="comment:20" align="right">Comment 20</div>

And indeed, it was #14723 which prompted the addition of `_sage_` methods to many SymPy classes. So no way out of fixing coercion here.



---

archive/issue_comments_292806.json:
```json
{
    "body": "Changed commit from **[0391252](https://github.com/sagemath/sagetrac-mirror/commit/03912520043631024635c3d6d09b86743b6c411e)** to **[76a47e8](https://github.com/sagemath/sagetrac-mirror/commit/76a47e825dfc3e2cc0d56244ababdc9fb92d5481)**",
    "created_at": "2016-03-13T16:39:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292806",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[0391252](https://github.com/sagemath/sagetrac-mirror/commit/03912520043631024635c3d6d09b86743b6c411e)** to **[76a47e8](https://github.com/sagemath/sagetrac-mirror/commit/76a47e825dfc3e2cc0d56244ababdc9fb92d5481)**



---

archive/issue_comments_292807.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">Comment 21</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/12cdb58d7a02391224477d0d99312be8fc03f678\">12cdb58</a></td><td><code>revert french book test; add sympy patch to remove UndefFunction._sage_</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/114733df4d9ea52e0f55f77793ac070bfa1dfc75\">114733d</a></td><td><code>Merge branch 'u/rws/upgrade_to_sympy_1_0' of git://trac.sagemath.org/sage into t/20185/upgrade_to_sympy_1_0</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/76a47e825dfc3e2cc0d56244ababdc9fb92d5481\">76a47e8</a></td><td><code>20185: revert an unnecessary change</code></td></tr></table>\n",
    "created_at": "2016-03-13T16:39:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292807",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:21" align="right">Comment 21</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/12cdb58d7a02391224477d0d99312be8fc03f678">12cdb58</a></td><td><code>revert french book test; add sympy patch to remove UndefFunction._sage_</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/114733df4d9ea52e0f55f77793ac070bfa1dfc75">114733d</a></td><td><code>Merge branch 'u/rws/upgrade_to_sympy_1_0' of git://trac.sagemath.org/sage into t/20185/upgrade_to_sympy_1_0</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/76a47e825dfc3e2cc0d56244ababdc9fb92d5481">76a47e8</a></td><td><code>20185: revert an unnecessary change</code></td></tr></table>




---

archive/issue_comments_292808.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">Comment 22</div>\n\nAs you can see from #14723 the `UndefFunction._sage_` addition only affects future changes. This branch now has this removed from SymPy-1.0 to make it work with current Sage. Any changes to the coercion system because of future inclusion of `UndefFunction._sage_` can then be dealt with in a separate ticket which I'll open shortly. I didn't do a full test on this, so I'll have to have a final look at this tomorrow.",
    "created_at": "2016-03-13T16:44:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292808",
    "user": "https://github.com/rwst"
}
```

<div id="comment:22" align="right">Comment 22</div>

As you can see from #14723 the `UndefFunction._sage_` addition only affects future changes. This branch now has this removed from SymPy-1.0 to make it work with current Sage. Any changes to the coercion system because of future inclusion of `UndefFunction._sage_` can then be dealt with in a separate ticket which I'll open shortly. I didn't do a full test on this, so I'll have to have a final look at this tomorrow.



---

archive/issue_comments_292809.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">Comment 23</div>\n\nOkay, I think I have a better understanding of things. So here's what I think is going on. The coercion system is working fine:\n\n```\nsage: import sympy\nsage: u = sympy.Function('u'); n = sympy.Symbol('n', integer=True)\nsage: import operator\nsage: cm = sage.structure.element.get_coercion_model()\n\nsage: cm.common_parent(3, u(n))\nSymbolic Ring\nsage: cm.common_parent(u(n), 3)\nSymbolic Ring\nsage: type(cm.bin_op(3, u(n), operator.mul))\n<type 'sage.symbolic.expression.Expression'>\nsage: type(cm.bin_op(u(n), 3, operator.mul))\n<type 'sage.symbolic.expression.Expression'>\n```\nThat is now returning something rather than erroring out. This is coming from\n\n```\nsage: (u(n))._sage_()\nu(n)\nsage: type(_)\n<type 'sage.symbolic.expression.Expression'>\n```\nWe go to the coercion framework because of `__mul__` from integers. Previously, because it was erroring out, the multiplication code then tried `__rmul__` from the SymPy function, which resulted in a SymPy object. Now, we get different behaviors because when the SymPy object is on the left, we call its `__mul__`, which results in a SymPy object.\n\nI'm also retracting the last part of [comment:15](#comment%3A15), and the issue might be in SymPy and how it tries to parse our symbolic expressions:\n\n```\nsage: f = function('f')\nsage: x = var('x')\nsage: sympy.sympify(f(x), evaluate=False)\nf(x)\nsage: sympy.sympify(3*f(x), evaluate=False)\nAttributeError: 'Call' object has no attribute 'id'\n```\nHowever, we do seem to have our own troubles of constructing SymPy objects from symbolic expressions. All of these result in errors:\n\n```\nsage: f._sympy_()\nsage: f(x)._sympy_()\nsage: (f(x)+3)._sympy_()\n```\n\nI'm okay with your patch. Although we typically set the first patched version to `p0`.",
    "created_at": "2016-03-13T22:38:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292809",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:23" align="right">Comment 23</div>

Okay, I think I have a better understanding of things. So here's what I think is going on. The coercion system is working fine:

```
sage: import sympy
sage: u = sympy.Function('u'); n = sympy.Symbol('n', integer=True)
sage: import operator
sage: cm = sage.structure.element.get_coercion_model()

sage: cm.common_parent(3, u(n))
Symbolic Ring
sage: cm.common_parent(u(n), 3)
Symbolic Ring
sage: type(cm.bin_op(3, u(n), operator.mul))
<type 'sage.symbolic.expression.Expression'>
sage: type(cm.bin_op(u(n), 3, operator.mul))
<type 'sage.symbolic.expression.Expression'>
```
That is now returning something rather than erroring out. This is coming from

```
sage: (u(n))._sage_()
u(n)
sage: type(_)
<type 'sage.symbolic.expression.Expression'>
```
We go to the coercion framework because of `__mul__` from integers. Previously, because it was erroring out, the multiplication code then tried `__rmul__` from the SymPy function, which resulted in a SymPy object. Now, we get different behaviors because when the SymPy object is on the left, we call its `__mul__`, which results in a SymPy object.

I'm also retracting the last part of [comment:15](#comment%3A15), and the issue might be in SymPy and how it tries to parse our symbolic expressions:

```
sage: f = function('f')
sage: x = var('x')
sage: sympy.sympify(f(x), evaluate=False)
f(x)
sage: sympy.sympify(3*f(x), evaluate=False)
AttributeError: 'Call' object has no attribute 'id'
```
However, we do seem to have our own troubles of constructing SymPy objects from symbolic expressions. All of these result in errors:

```
sage: f._sympy_()
sage: f(x)._sympy_()
sage: (f(x)+3)._sympy_()
```

I'm okay with your patch. Although we typically set the first patched version to `p0`.



---

archive/issue_comments_292810.json:
```json
{
    "body": "Reviewer: **Travis Scrimshaw**",
    "created_at": "2016-03-13T23:16:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292810",
    "user": "https://github.com/tscrim"
}
```

Reviewer: **Travis Scrimshaw**



---

archive/issue_comments_292811.json:
```json
{
    "body": "Changed commit from **[76a47e8](https://github.com/sagemath/sagetrac-mirror/commit/76a47e825dfc3e2cc0d56244ababdc9fb92d5481)** to **[42dbc89](https://github.com/sagemath/sagetrac-mirror/commit/42dbc8986991f8be078e0e4c61a2c55eb17febda)**",
    "created_at": "2016-03-13T23:16:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292811",
    "user": "https://github.com/tscrim"
}
```

Changed commit from **[76a47e8](https://github.com/sagemath/sagetrac-mirror/commit/76a47e825dfc3e2cc0d56244ababdc9fb92d5481)** to **[42dbc89](https://github.com/sagemath/sagetrac-mirror/commit/42dbc8986991f8be078e0e4c61a2c55eb17febda)**



---

archive/issue_comments_292812.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">Comment 24</div>\n\nI changed the version to `p0`, but this is likely to only affect you (and really, doesn't do anything). I also fixed a failing doctest in `unicode_art.py` as it sends things to SymPy to create teh art. Otherwise all tests pass for me.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/42dbc8986991f8be078e0e4c61a2c55eb17febda\">42dbc89</a></td><td><code>Changing version to p0 and fixing doctest in unicode_art.py.</code></td></tr></table>\n",
    "created_at": "2016-03-13T23:16:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292812",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:24" align="right">Comment 24</div>

I changed the version to `p0`, but this is likely to only affect you (and really, doesn't do anything). I also fixed a failing doctest in `unicode_art.py` as it sends things to SymPy to create teh art. Otherwise all tests pass for me.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/42dbc8986991f8be078e0e4c61a2c55eb17febda">42dbc89</a></td><td><code>Changing version to p0 and fixing doctest in unicode_art.py.</code></td></tr></table>




---

archive/issue_comments_292813.json:
```json
{
    "body": "Changed branch from **[u/rws/upgrade_to_sympy_1_0](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/upgrade_to_sympy_1_0)** to **[public/packages/upgrade_sympy-20185](https://github.com/sagemath/sagetrac-mirror/tree/public/packages/upgrade_sympy-20185)**",
    "created_at": "2016-03-13T23:16:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292813",
    "user": "https://github.com/tscrim"
}
```

Changed branch from **[u/rws/upgrade_to_sympy_1_0](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/upgrade_to_sympy_1_0)** to **[public/packages/upgrade_sympy-20185](https://github.com/sagemath/sagetrac-mirror/tree/public/packages/upgrade_sympy-20185)**



---

archive/issue_comments_292814.json:
```json
{
    "body": "Changed reviewer from **Travis Scrimshaw** to **Travis Scrimshaw, Ralf Stephan**",
    "created_at": "2016-03-14T07:10:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292814",
    "user": "https://github.com/rwst"
}
```

Changed reviewer from **Travis Scrimshaw** to **Travis Scrimshaw, Ralf Stephan**



---

archive/issue_comments_292815.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">Comment 25</div>\n\nYour changes are fine. Consider them as reviewed.",
    "created_at": "2016-03-14T07:10:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292815",
    "user": "https://github.com/rwst"
}
```

<div id="comment:25" align="right">Comment 25</div>

Your changes are fine. Consider them as reviewed.



---

archive/issue_comments_292816.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">Comment 26</div>\n\n> ...Any changes ~~to the coercion system~~ because of future inclusion of `UndefFunction._sage_` can then be dealt with in a separate ticket which I'll open shortly.\n\nSee #20204.",
    "created_at": "2016-03-14T07:51:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292816",
    "user": "https://github.com/rwst"
}
```

<div id="comment:26" align="right">Comment 26</div>

> ...Any changes ~~to the coercion system~~ because of future inclusion of `UndefFunction._sage_` can then be dealt with in a separate ticket which I'll open shortly.

See #20204.



---

archive/issue_comments_292817.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">Comment 27</div>\n\nThank you.",
    "created_at": "2016-03-14T20:41:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292817",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:27" align="right">Comment 27</div>

Thank you.



---

archive/issue_events_267123.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2016-03-14T20:41:21Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20185#event-267123"
}
```



---

archive/issue_events_267124.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2016-03-14T20:41:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20185#event-267124"
}
```



---

archive/issue_comments_292818.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">Comment 28</div>\n\nThanks for the review.",
    "created_at": "2016-03-15T07:09:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292818",
    "user": "https://github.com/rwst"
}
```

<div id="comment:28" align="right">Comment 28</div>

Thanks for the review.



---

archive/issue_comments_292819.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">Comment 29</div>\n\nPDF docs fail\n\n```\n! Emergency stop.\n<inserted text> \n                $\nl.22231 \\PYG{g+go}{    \u23ae   \u221ax}\n```",
    "created_at": "2016-03-20T20:14:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292819",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:29" align="right">Comment 29</div>

PDF docs fail

```
! Emergency stop.
<inserted text> 
                $
l.22231 \PYG{g+go}{    ⎮   √x}
```



---

archive/issue_events_267125.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-03-20T20:14:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20185#event-267125"
}
```



---

archive/issue_events_267126.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-03-20T20:14:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20185#event-267126"
}
```



---

archive/issue_comments_292820.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">Comment 30</div>\n\nCannot confirm with `./sage --docbuild all pdf`. This is on OpenSuSE Leap with TeXLive 201384.",
    "created_at": "2016-03-21T07:28:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292820",
    "user": "https://github.com/rwst"
}
```

<div id="comment:30" align="right">Comment 30</div>

Cannot confirm with `./sage --docbuild all pdf`. This is on OpenSuSE Leap with TeXLive 201384.



---

archive/issue_events_267127.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2016-03-21T07:28:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20185#event-267127"
}
```



---

archive/issue_events_267128.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2016-03-21T07:28:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20185#event-267128"
}
```



---

archive/issue_events_267129.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2016-03-22T03:28:49Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "milestone_number": null,
    "milestone_title": "sage-7.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20185#event-267129"
}
```



---

archive/issue_events_267130.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2016-03-22T03:28:49Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "milestone_number": null,
    "milestone_title": "sage-7.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20185#event-267130"
}
```



---

archive/issue_comments_292821.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">Comment 31</div>\n\nI am unable to reproduce this either on my laptop either. Volker, can you post the logs if the buildbot fails again, along with its latex setup? Otherwise what we will have to do is change the test...",
    "created_at": "2016-03-22T03:28:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292821",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:31" align="right">Comment 31</div>

I am unable to reproduce this either on my laptop either. Volker, can you post the logs if the buildbot fails again, along with its latex setup? Otherwise what we will have to do is change the test...



---

archive/issue_events_267131.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2016-03-22T03:28:49Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20185#event-267131"
}
```



---

archive/issue_events_267132.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2016-03-22T03:28:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20185#event-267132"
}
```



---

archive/issue_comments_292822.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">Comment 32</div>\n\n\n```\n$ rpm -q texlive\ntexlive-2014-19.20140525_r34255.fc23.x86_64\n```",
    "created_at": "2016-03-22T15:28:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292822",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:32" align="right">Comment 32</div>


```
$ rpm -q texlive
texlive-2014-19.20140525_r34255.fc23.x86_64
```



---

archive/issue_events_267133.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-03-22T15:28:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20185#event-267133"
}
```



---

archive/issue_events_267134.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-03-22T15:28:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20185#event-267134"
}
```



---

archive/issue_comments_292823.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">Comment 33</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3872f81c60ab0ae37d2ec64e240cce80a053edc8\">3872f81</a></td><td><code>Fix U+221A in pdf docs</code></td></tr></table>\n",
    "created_at": "2016-03-22T15:45:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292823",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:33" align="right">Comment 33</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3872f81c60ab0ae37d2ec64e240cce80a053edc8">3872f81</a></td><td><code>Fix U+221A in pdf docs</code></td></tr></table>




---

archive/issue_comments_292824.json:
```json
{
    "body": "Changed commit from **[42dbc89](https://github.com/sagemath/sagetrac-mirror/commit/42dbc8986991f8be078e0e4c61a2c55eb17febda)** to **[3872f81](https://github.com/sagemath/sagetrac-mirror/commit/3872f81c60ab0ae37d2ec64e240cce80a053edc8)**",
    "created_at": "2016-03-22T15:45:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292824",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[42dbc89](https://github.com/sagemath/sagetrac-mirror/commit/42dbc8986991f8be078e0e4c61a2c55eb17febda)** to **[3872f81](https://github.com/sagemath/sagetrac-mirror/commit/3872f81c60ab0ae37d2ec64e240cce80a053edc8)**



---

archive/issue_comments_292825.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">Comment 34</div>\n\nHow could that have worked for you, `\\sqrt` in text mode should be illegal in all TeX versions.",
    "created_at": "2016-03-22T15:46:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292825",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:34" align="right">Comment 34</div>

How could that have worked for you, `\sqrt` in text mode should be illegal in all TeX versions.



---

archive/issue_events_267135.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-03-22T15:46:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20185#event-267135"
}
```



---

archive/issue_events_267136.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-03-22T15:46:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20185#event-267136"
}
```



---

archive/issue_comments_292826.json:
```json
{
    "body": "Changed reviewer from **Travis Scrimshaw, Ralf Stephan** to **Travis Scrimshaw, Ralf Stephan, Volker Braun**",
    "created_at": "2016-03-22T19:14:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292826",
    "user": "https://github.com/tscrim"
}
```

Changed reviewer from **Travis Scrimshaw, Ralf Stephan** to **Travis Scrimshaw, Ralf Stephan, Volker Braun**



---

archive/issue_events_267137.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2016-03-22T19:14:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20185#event-267137"
}
```



---

archive/issue_events_267138.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2016-03-22T19:14:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20185#event-267138"
}
```



---

archive/issue_comments_292827.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">Comment 35</div>\n\nHmm...strange. With your changes, everything works. Thank you for figuring out what the root of the problem is. :P",
    "created_at": "2016-03-22T19:14:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292827",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:35" align="right">Comment 35</div>

Hmm...strange. With your changes, everything works. Thank you for figuring out what the root of the problem is. :P



---

archive/issue_events_267139.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-03-23T12:46:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20185#event-267139"
}
```



---

archive/issue_events_267140.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "686d0fe1bbf9ec36bbee8a837c918b647c0faf9d",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2016-03-23T12:46:48Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20185#event-267140"
}
```



---

archive/issue_comments_292828.json:
```json
{
    "body": "Changed branch from **[public/packages/upgrade_sympy-20185](https://github.com/sagemath/sagetrac-mirror/tree/public/packages/upgrade_sympy-20185)** to **[3872f81](https://github.com/sagemath/sagetrac-mirror/commit/3872f81c60ab0ae37d2ec64e240cce80a053edc8)**",
    "created_at": "2016-03-23T12:46:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292828",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[public/packages/upgrade_sympy-20185](https://github.com/sagemath/sagetrac-mirror/tree/public/packages/upgrade_sympy-20185)** to **[3872f81](https://github.com/sagemath/sagetrac-mirror/commit/3872f81c60ab0ae37d2ec64e240cce80a053edc8)**
