# Issue 20185: Upgrade to SymPy-1.0

archive/issues_019948.json:
```json
{
    "assignees": [],
    "body": "https://github.com/sympy/sympy/wiki/Release-Notes-for-1.0\n\nIt could be installed as usually \nhttps://github.com/sympy/sympy/releases/download/sympy-1.0/sympy-1.0.tar.gz\nor via `pip install -U sympy`.\n\n**Branch/Commit:** [3872f81c60ab0ae37d2ec64e240cce80a053edc8](https://github.com/sagemath/sagetrac-mirror/commit/3872f81c60ab0ae37d2ec64e240cce80a053edc8)\n\n**Reviewer:** Travis Scrimshaw, Ralf Stephan, Volker Braun\n\n**Author:** Ralf Stephan\n\nIssue created by migration from https://trac.sagemath.org/ticket/20185\n\n",
    "closed_at": "2016-03-23T12:46:48Z",
    "created_at": "2016-03-10T14:25:21Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20packages%3A%20standard",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-7.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Upgrade to SymPy-1.0",
    "type": "issue",
    "updated_at": "2016-03-23T12:46:48Z",
    "url": "https://github.com/sagemath/sage/issues/20185",
    "user": "https://github.com/rwst"
}
```
https://github.com/sympy/sympy/wiki/Release-Notes-for-1.0

It could be installed as usually 
https://github.com/sympy/sympy/releases/download/sympy-1.0/sympy-1.0.tar.gz
or via `pip install -U sympy`.

**Branch/Commit:** [3872f81c60ab0ae37d2ec64e240cce80a053edc8](https://github.com/sagemath/sagetrac-mirror/commit/3872f81c60ab0ae37d2ec64e240cce80a053edc8)

**Reviewer:** Travis Scrimshaw, Ralf Stephan, Volker Braun

**Author:** Ralf Stephan

Issue created by migration from https://trac.sagemath.org/ticket/20185





---

archive/issue_events_246143.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2016-03-10T14:25:21Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "milestone_number": null,
    "milestone_title": "sage-7.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20185#event-246143"
}
```



---

archive/issue_events_246144.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2016-03-10T14:25:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20packages%3A%20standard",
    "label_color": "08517b",
    "label_name": "component: packages: standard",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20185#event-246144"
}
```



---

archive/issue_events_246145.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2016-03-10T14:25:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "008080",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20185#event-246145"
}
```



---

archive/issue_comments_292709.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,3 +1,5 @@\n https://github.com/sympy/sympy/wiki/Release-Notes-for-1.0\n \n-It could be installed as usually or via `pip install -U sympy`.\n+It could be installed as usually \n+https://github.com/sympy/sympy/releases/download/sympy-1.0/sympy-1.0.tar.gz\n+or via `pip install -U sympy`.\n``````\n",
    "created_at": "2016-03-10T16:20:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292709",
    "user": "https://github.com/rwst"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,3 +1,5 @@
 https://github.com/sympy/sympy/wiki/Release-Notes-for-1.0
 
-It could be installed as usually or via `pip install -U sympy`.
+It could be installed as usually 
+https://github.com/sympy/sympy/releases/download/sympy-1.0/sympy-1.0.tar.gz
+or via `pip install -U sympy`.
``````




---

archive/issue_comments_292710.json:
```json
{
    "body": "**Branch:** [u/rws/upgrade_to_sympy_1_0](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/upgrade_to_sympy_1_0)",
    "created_at": "2016-03-10T16:32:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292710",
    "user": "https://github.com/rwst"
}
```

**Branch:** [u/rws/upgrade_to_sympy_1_0](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/upgrade_to_sympy_1_0)



---

archive/issue_comments_292711.json:
```json
{
    "body": "**Commit:** [6971607ce1b72388e57a742ab8f5f0ffb4af1c0e](https://github.com/sagemath/sagetrac-mirror/commit/6971607ce1b72388e57a742ab8f5f0ffb4af1c0e)",
    "created_at": "2016-03-10T16:32:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292711",
    "user": "https://github.com/rwst"
}
```

**Commit:** [6971607ce1b72388e57a742ab8f5f0ffb4af1c0e](https://github.com/sagemath/sagetrac-mirror/commit/6971607ce1b72388e57a742ab8f5f0ffb4af1c0e)



---

archive/issue_comments_292712.json:
```json
{
    "body": "<a id='comment:3'></a>\n\n```\n$ ./sage -p mpmath\nSuccessfully installed mpmath-0.19\n$ ./sage -p sympy\nbuilding sympy\nPlease install the mpmath package with a version >= 0.19\nError building sympy\n```\nAny hints?\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6971607ce1b72388e57a742ab8f5f0ffb4af1c0e\">6971607</a></td><td><code>pkg version/chksum/patch removed</code></td></tr></table>\n",
    "created_at": "2016-03-10T16:32:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292712",
    "user": "https://github.com/rwst"
}
```

<a id='comment:3'></a>

```
$ ./sage -p mpmath
Successfully installed mpmath-0.19
$ ./sage -p sympy
building sympy
Please install the mpmath package with a version >= 0.19
Error building sympy
```
Any hints?

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6971607ce1b72388e57a742ab8f5f0ffb4af1c0e">6971607</a></td><td><code>pkg version/chksum/patch removed</code></td></tr></table>




---

archive/issue_comments_292713.json:
```json
{
    "body": "<a id='comment:4'></a>\nReplying to [@rwst](#comment%3A3):\n> \n> ```\n> $ ./sage -p mpmath\n> Successfully installed mpmath-0.19\n> $ ./sage -p sympy\n> building sympy\n> Please install the mpmath package with a version >= 0.19\n> Error building sympy\n> ```\n> Any hints?\n> \n> ---\n> **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6971607ce1b72388e57a742ab8f5f0ffb4af1c0e\">6971607</a></td><td><code>pkg version/chksum/patch removed</code></td></tr></table>\n\nI think I have. In the past (prior to this version) `sympy`'s `setup.py` was importing `sympy` itself. The danger then was to import the previously installed `sympy` rather the new `sympy`. So we add this\n\n```\nexport PYTHONPATH=\".\"\necho \"building sympy\"\npython -S setup.py build\n```\nThe `-S` is the cause of your trouble, look it up. So you should remove the `PYTHONPATH` stuff, the `-S` and remove the corresponding comments in `spkg-install`.",
    "created_at": "2016-03-11T06:18:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292713",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:4'></a>
Replying to [@rwst](#comment%3A3):
> 
> ```
> $ ./sage -p mpmath
> Successfully installed mpmath-0.19
> $ ./sage -p sympy
> building sympy
> Please install the mpmath package with a version >= 0.19
> Error building sympy
> ```
> Any hints?
> 
> ---
> **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6971607ce1b72388e57a742ab8f5f0ffb4af1c0e">6971607</a></td><td><code>pkg version/chksum/patch removed</code></td></tr></table>

I think I have. In the past (prior to this version) `sympy`'s `setup.py` was importing `sympy` itself. The danger then was to import the previously installed `sympy` rather the new `sympy`. So we add this

```
export PYTHONPATH="."
echo "building sympy"
python -S setup.py build
```
The `-S` is the cause of your trouble, look it up. So you should remove the `PYTHONPATH` stuff, the `-S` and remove the corresponding comments in `spkg-install`.



---

archive/issue_comments_292714.json:
```json
{
    "body": "<a id='comment:5'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9cdde13f3f20603b467733e881c2bbfb5c1a81a3\">9cdde13</a></td><td><code>20185: remove python -S stuff</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/907bedc76d3289455a701051d1af6c1be64135b1\">907bedc</a></td><td><code>Merge branch 'develop' into t/20185/upgrade_to_sympy_1_0</code></td></tr></table>\n",
    "created_at": "2016-03-11T08:09:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292714",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:5'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9cdde13f3f20603b467733e881c2bbfb5c1a81a3">9cdde13</a></td><td><code>20185: remove python -S stuff</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/907bedc76d3289455a701051d1af6c1be64135b1">907bedc</a></td><td><code>Merge branch 'develop' into t/20185/upgrade_to_sympy_1_0</code></td></tr></table>




---

archive/issue_comments_292715.json:
```json
{
    "body": "**Changing commit** from \"[6971607ce1b72388e57a742ab8f5f0ffb4af1c0e](https://github.com/sagemath/sagetrac-mirror/commit/6971607ce1b72388e57a742ab8f5f0ffb4af1c0e)\" to \"[907bedc76d3289455a701051d1af6c1be64135b1](https://github.com/sagemath/sagetrac-mirror/commit/907bedc76d3289455a701051d1af6c1be64135b1)\".",
    "created_at": "2016-03-11T08:09:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292715",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[6971607ce1b72388e57a742ab8f5f0ffb4af1c0e](https://github.com/sagemath/sagetrac-mirror/commit/6971607ce1b72388e57a742ab8f5f0ffb4af1c0e)" to "[907bedc76d3289455a701051d1af6c1be64135b1](https://github.com/sagemath/sagetrac-mirror/commit/907bedc76d3289455a701051d1af6c1be64135b1)".



---

archive/issue_comments_292716.json:
```json
{
    "body": "<a id='comment:6'></a>\nThanks, that was it. So there are changes that affect doctests:\n\n```\nsage -t --warn-long 27.4 src/sage/symbolic/integration/integral.py  # 1 doctest failed\nsage -t --warn-long 27.4 src/sage/symbolic/expression.pyx  # 3 doctests failed\nsage -t --warn-long 27.2 src/sage/tests/french_book/recequadiff.py  # 2 doctests failed\n```\nThat's only from a partial quick scan.",
    "created_at": "2016-03-11T08:10:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292716",
    "user": "https://github.com/rwst"
}
```

<a id='comment:6'></a>
Thanks, that was it. So there are changes that affect doctests:

```
sage -t --warn-long 27.4 src/sage/symbolic/integration/integral.py  # 1 doctest failed
sage -t --warn-long 27.4 src/sage/symbolic/expression.pyx  # 3 doctests failed
sage -t --warn-long 27.2 src/sage/tests/french_book/recequadiff.py  # 2 doctests failed
```
That's only from a partial quick scan.



---

archive/issue_comments_292717.json:
```json
{
    "body": "<a id='comment:7'></a>\n> \n> ```\n> sage -t --warn-long 27.2 src/sage/tests/french_book/recequadiff.py  # 2 doctests failed\n> ```\n\nThis can be minimized to\n\n```\nsage: import sympy\nsage: u = sympy.Function('u'); n = sympy.Symbol('n', integer=True)\nsage: sympy.sympify(3*u(n), evaluate=False)\nNotImplementedError: SymPy function 'u' doesn't exist\n```\nwhich disappears when `3*u(n)` is changed to `u(n)*3` or `u(n)`\n\nEDIT: I will just change the order in the muls for the doctest, and open a ticket. The case is rare and can be fixed after the upgrade.",
    "created_at": "2016-03-11T08:47:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292717",
    "user": "https://github.com/rwst"
}
```

<a id='comment:7'></a>
> 
> ```
> sage -t --warn-long 27.2 src/sage/tests/french_book/recequadiff.py  # 2 doctests failed
> ```

This can be minimized to

```
sage: import sympy
sage: u = sympy.Function('u'); n = sympy.Symbol('n', integer=True)
sage: sympy.sympify(3*u(n), evaluate=False)
NotImplementedError: SymPy function 'u' doesn't exist
```
which disappears when `3*u(n)` is changed to `u(n)*3` or `u(n)`

EDIT: I will just change the order in the muls for the doctest, and open a ticket. The case is rare and can be fixed after the upgrade.



---

archive/issue_comments_292718.json:
```json
{
    "body": "<a id='comment:8'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f92f927e44e1638efb08f01f2136010d236daaef\">f92f927</a></td><td><code>fix doctests</code></td></tr></table>\n",
    "created_at": "2016-03-11T09:11:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292718",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:8'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f92f927e44e1638efb08f01f2136010d236daaef">f92f927</a></td><td><code>fix doctests</code></td></tr></table>




---

archive/issue_comments_292719.json:
```json
{
    "body": "**Changing commit** from \"[907bedc76d3289455a701051d1af6c1be64135b1](https://github.com/sagemath/sagetrac-mirror/commit/907bedc76d3289455a701051d1af6c1be64135b1)\" to \"[f92f927e44e1638efb08f01f2136010d236daaef](https://github.com/sagemath/sagetrac-mirror/commit/f92f927e44e1638efb08f01f2136010d236daaef)\".",
    "created_at": "2016-03-11T09:11:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292719",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[907bedc76d3289455a701051d1af6c1be64135b1](https://github.com/sagemath/sagetrac-mirror/commit/907bedc76d3289455a701051d1af6c1be64135b1)" to "[f92f927e44e1638efb08f01f2136010d236daaef](https://github.com/sagemath/sagetrac-mirror/commit/f92f927e44e1638efb08f01f2136010d236daaef)".



---

archive/issue_comments_292720.json:
```json
{
    "body": "<a id='comment:9'></a>\nIMO [comment:7](#comment%3A7) (#20194) is a serious regression and it should be fixed with the upgrade.",
    "created_at": "2016-03-11T09:52:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292720",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:9'></a>
IMO [comment:7](#comment%3A7) (#20194) is a serious regression and it should be fixed with the upgrade.



---

archive/issue_comments_292721.json:
```json
{
    "body": "**Changing commit** from \"[f92f927e44e1638efb08f01f2136010d236daaef](https://github.com/sagemath/sagetrac-mirror/commit/f92f927e44e1638efb08f01f2136010d236daaef)\" to \"[03912520043631024635c3d6d09b86743b6c411e](https://github.com/sagemath/sagetrac-mirror/commit/03912520043631024635c3d6d09b86743b6c411e)\".",
    "created_at": "2016-03-11T16:03:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292721",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[f92f927e44e1638efb08f01f2136010d236daaef](https://github.com/sagemath/sagetrac-mirror/commit/f92f927e44e1638efb08f01f2136010d236daaef)" to "[03912520043631024635c3d6d09b86743b6c411e](https://github.com/sagemath/sagetrac-mirror/commit/03912520043631024635c3d6d09b86743b6c411e)".



---

archive/issue_comments_292722.json:
```json
{
    "body": "<a id='comment:10'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/03912520043631024635c3d6d09b86743b6c411e\">0391252</a></td><td><code>fix doctest</code></td></tr></table>\n",
    "created_at": "2016-03-11T16:03:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292722",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:10'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/03912520043631024635c3d6d09b86743b6c411e">0391252</a></td><td><code>fix doctest</code></td></tr></table>




---

archive/issue_comments_292723.json:
```json
{
    "body": "<a id='comment:11'></a>\nThe doctest is fixed but something seems not right in the sympification of undefined Sage functions. The case in #20194 crashes Sympy's parser and I have reported in https://github.com/sympy/sympy/issues/10795",
    "created_at": "2016-03-11T16:15:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292723",
    "user": "https://github.com/rwst"
}
```

<a id='comment:11'></a>
The doctest is fixed but something seems not right in the sympification of undefined Sage functions. The case in #20194 crashes Sympy's parser and I have reported in https://github.com/sympy/sympy/issues/10795



---

archive/issue_comments_292724.json:
```json
{
    "body": "**Author:** Ralf Stephan",
    "created_at": "2016-03-11T16:16:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292724",
    "user": "https://github.com/rwst"
}
```

**Author:** Ralf Stephan



---

archive/issue_events_246146.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2016-03-11T16:16:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20185#event-246146"
}
```



---

archive/issue_comments_292725.json:
```json
{
    "body": "<a id='comment:13'></a>\nDo I understand you correctly that [0391252](https://github.com/sagemath/sagetrac-mirror/commit/03912520043631024635c3d6d09b86743b6c411e) means you do not have to change the test in the French book?",
    "created_at": "2016-03-11T23:03:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292725",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:13'></a>
Do I understand you correctly that [0391252](https://github.com/sagemath/sagetrac-mirror/commit/03912520043631024635c3d6d09b86743b6c411e) means you do not have to change the test in the French book?



---

archive/issue_comments_292726.json:
```json
{
    "body": "<a id='comment:14'></a>\nNow that my Sage has finished rebuilding, the answer to my question is no, we still have a regression.",
    "created_at": "2016-03-11T23:53:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292726",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:14'></a>
Now that my Sage has finished rebuilding, the answer to my question is no, we still have a regression.



---

archive/issue_comments_292727.json:
```json
{
    "body": "<a id='comment:15'></a>\nWith this branch, we have:\n\n```\nsage: import sympy\nsage: u = sympy.Function('u'); n = sympy.Symbol('n', integer=True)\nsage: x = int(3)\nsage: x*u(n)\n3*u(n)\nsage: sympy.sympify(x*u(n))\n3*u(n)\nsage: sympy.sympify(x*u(n), evaluate=False)\n3*u(n)\n\nsage: x = 3._sympy_()\nsage: sympy.sympify(x*u(n), evaluate=False)\n3*u(n)\n```\nHowever, I think this is the problem:\n\n```\nsage: type(3*u(n))\n<type 'sage.symbolic.expression.Expression'>\nsage: type(u(n)*3)\n<class 'sympy.core.mul.Mul'>\n\nsage: x = int(3)\nsage: type(x*u(n))\n<class 'sympy.core.mul.Mul'>\nsage: type(u(n)*x)\n<class 'sympy.core.mul.Mul'>\n```\nSo it is probably something on our end.",
    "created_at": "2016-03-12T01:11:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292727",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:15'></a>
With this branch, we have:

```
sage: import sympy
sage: u = sympy.Function('u'); n = sympy.Symbol('n', integer=True)
sage: x = int(3)
sage: x*u(n)
3*u(n)
sage: sympy.sympify(x*u(n))
3*u(n)
sage: sympy.sympify(x*u(n), evaluate=False)
3*u(n)

sage: x = 3._sympy_()
sage: sympy.sympify(x*u(n), evaluate=False)
3*u(n)
```
However, I think this is the problem:

```
sage: type(3*u(n))
<type 'sage.symbolic.expression.Expression'>
sage: type(u(n)*3)
<class 'sympy.core.mul.Mul'>

sage: x = int(3)
sage: type(x*u(n))
<class 'sympy.core.mul.Mul'>
sage: type(u(n)*x)
<class 'sympy.core.mul.Mul'>
```
So it is probably something on our end.



---

archive/issue_comments_292728.json:
```json
{
    "body": "<a id='comment:16'></a>\nYes, that is the behavior change. Contrast that with the current 7.1.rc0:\n\n```\nsage: import sympy\nsage: u = sympy.Function('u'); n = sympy.Symbol('n', integer=True)\nsage: type(3*u(n))\n<class 'sympy.core.mul.Mul'>\nsage: type(u(n)*3)\n<class 'sympy.core.mul.Mul'>\n```",
    "created_at": "2016-03-12T01:13:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292728",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:16'></a>
Yes, that is the behavior change. Contrast that with the current 7.1.rc0:

```
sage: import sympy
sage: u = sympy.Function('u'); n = sympy.Symbol('n', integer=True)
sage: type(3*u(n))
<class 'sympy.core.mul.Mul'>
sage: type(u(n)*3)
<class 'sympy.core.mul.Mul'>
```



---

archive/issue_comments_292729.json:
```json
{
    "body": "<a id='comment:17'></a>\nI also get the same behavior in [comment:15](#comment%3A15) when I am at commit [f92f927](https://github.com/sagemath/sagetrac-mirror/commit/f92f927e44e1638efb08f01f2136010d236daaef).",
    "created_at": "2016-03-12T01:17:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292729",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:17'></a>
I also get the same behavior in [comment:15](#comment%3A15) when I am at commit [f92f927](https://github.com/sagemath/sagetrac-mirror/commit/f92f927e44e1638efb08f01f2136010d236daaef).



---

archive/issue_comments_292730.json:
```json
{
    "body": "<a id='comment:18'></a>\nThis is SymPy-0.7.6.1:\n\n```\nsage: parent(u)\n<class 'sympy.core.function.UndefinedFunction'>\nsage: cm = sage.structure.element.get_coercion_model()\nsage: steps,res = cm.analyse(ZZ, parent(u))\nsage: steps\n['Will try _r_action and _l_action']\n```\nThis is 1.0:\n\n```\nsage: parent(u)\n<class 'sympy.core.function.UndefinedFunction'>\nsage: cm = sage.structure.element.get_coercion_model()\nsage: steps,res = cm.analyse(ZZ, parent(u))\nsage: steps\n['Right operand is not Sage element, will try _sage_.',\n 'Will try _r_action and _l_action']\n\nConversion map:\n  From: Integer Ring\n  To:   Symbolic Ring, None))\n```",
    "created_at": "2016-03-13T08:52:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292730",
    "user": "https://github.com/rwst"
}
```

<a id='comment:18'></a>
This is SymPy-0.7.6.1:

```
sage: parent(u)
<class 'sympy.core.function.UndefinedFunction'>
sage: cm = sage.structure.element.get_coercion_model()
sage: steps,res = cm.analyse(ZZ, parent(u))
sage: steps
['Will try _r_action and _l_action']
```
This is 1.0:

```
sage: parent(u)
<class 'sympy.core.function.UndefinedFunction'>
sage: cm = sage.structure.element.get_coercion_model()
sage: steps,res = cm.analyse(ZZ, parent(u))
sage: steps
['Right operand is not Sage element, will try _sage_.',
 'Will try _r_action and _l_action']

Conversion map:
  From: Integer Ring
  To:   Symbolic Ring, None))
```



---

archive/issue_comments_292731.json:
```json
{
    "body": "<a id='comment:19'></a>\nSo it seems the issue is coming from the fact that in 0.7.6.1, we have `type(parent(u)) is type` returning `False` before but with 1.0, it is `True`. Which, AFAICS, is only involved in `discover_action`, but the result is still a `None`.\n\n```\nsage: cm.discover_action(ZZ, parent(u(n)), operator.mul)   # Same in 0.7.6.1\n```\nAlthough to be fair, I think we should test against `u(n)` since parentheses get evaluated before `*`. In that case, I get the same result in both versions:\n\n```\nsage: parent(u)\n<class 'sympy.core.function.UndefinedFunction'>\nsage: parent(u(n))\nu\nsage: steps,res = cm.analyse(ZZ, parent(u(n))); steps\n['Will try _r_action and _l_action']\n```\n\nI'm thinking we will need someone who is much more familiar with the coercion framework than I am.",
    "created_at": "2016-03-13T11:33:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292731",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:19'></a>
So it seems the issue is coming from the fact that in 0.7.6.1, we have `type(parent(u)) is type` returning `False` before but with 1.0, it is `True`. Which, AFAICS, is only involved in `discover_action`, but the result is still a `None`.

```
sage: cm.discover_action(ZZ, parent(u(n)), operator.mul)   # Same in 0.7.6.1
```
Although to be fair, I think we should test against `u(n)` since parentheses get evaluated before `*`. In that case, I get the same result in both versions:

```
sage: parent(u)
<class 'sympy.core.function.UndefinedFunction'>
sage: parent(u(n))
u
sage: steps,res = cm.analyse(ZZ, parent(u(n))); steps
['Will try _r_action and _l_action']
```

I'm thinking we will need someone who is much more familiar with the coercion framework than I am.



---

archive/issue_comments_292732.json:
```json
{
    "body": "<a id='comment:20'></a>\nAnd indeed, it was #14723 which prompted the addition of `_sage_` methods to many SymPy classes. So no way out of fixing coercion here.",
    "created_at": "2016-03-13T14:08:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292732",
    "user": "https://github.com/rwst"
}
```

<a id='comment:20'></a>
And indeed, it was #14723 which prompted the addition of `_sage_` methods to many SymPy classes. So no way out of fixing coercion here.



---

archive/issue_comments_292733.json:
```json
{
    "body": "**Changing commit** from \"[03912520043631024635c3d6d09b86743b6c411e](https://github.com/sagemath/sagetrac-mirror/commit/03912520043631024635c3d6d09b86743b6c411e)\" to \"[76a47e825dfc3e2cc0d56244ababdc9fb92d5481](https://github.com/sagemath/sagetrac-mirror/commit/76a47e825dfc3e2cc0d56244ababdc9fb92d5481)\".",
    "created_at": "2016-03-13T16:39:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292733",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[03912520043631024635c3d6d09b86743b6c411e](https://github.com/sagemath/sagetrac-mirror/commit/03912520043631024635c3d6d09b86743b6c411e)" to "[76a47e825dfc3e2cc0d56244ababdc9fb92d5481](https://github.com/sagemath/sagetrac-mirror/commit/76a47e825dfc3e2cc0d56244ababdc9fb92d5481)".



---

archive/issue_comments_292734.json:
```json
{
    "body": "<a id='comment:21'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/12cdb58d7a02391224477d0d99312be8fc03f678\">12cdb58</a></td><td><code>revert french book test; add sympy patch to remove UndefFunction._sage_</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/114733df4d9ea52e0f55f77793ac070bfa1dfc75\">114733d</a></td><td><code>Merge branch 'u/rws/upgrade_to_sympy_1_0' of git://trac.sagemath.org/sage into t/20185/upgrade_to_sympy_1_0</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/76a47e825dfc3e2cc0d56244ababdc9fb92d5481\">76a47e8</a></td><td><code>20185: revert an unnecessary change</code></td></tr></table>\n",
    "created_at": "2016-03-13T16:39:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292734",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:21'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/12cdb58d7a02391224477d0d99312be8fc03f678">12cdb58</a></td><td><code>revert french book test; add sympy patch to remove UndefFunction._sage_</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/114733df4d9ea52e0f55f77793ac070bfa1dfc75">114733d</a></td><td><code>Merge branch 'u/rws/upgrade_to_sympy_1_0' of git://trac.sagemath.org/sage into t/20185/upgrade_to_sympy_1_0</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/76a47e825dfc3e2cc0d56244ababdc9fb92d5481">76a47e8</a></td><td><code>20185: revert an unnecessary change</code></td></tr></table>




---

archive/issue_comments_292735.json:
```json
{
    "body": "<a id='comment:22'></a>\nAs you can see from #14723 the `UndefFunction._sage_` addition only affects future changes. This branch now has this removed from SymPy-1.0 to make it work with current Sage. Any changes to the coercion system because of future inclusion of `UndefFunction._sage_` can then be dealt with in a separate ticket which I'll open shortly. I didn't do a full test on this, so I'll have to have a final look at this tomorrow.",
    "created_at": "2016-03-13T16:44:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292735",
    "user": "https://github.com/rwst"
}
```

<a id='comment:22'></a>
As you can see from #14723 the `UndefFunction._sage_` addition only affects future changes. This branch now has this removed from SymPy-1.0 to make it work with current Sage. Any changes to the coercion system because of future inclusion of `UndefFunction._sage_` can then be dealt with in a separate ticket which I'll open shortly. I didn't do a full test on this, so I'll have to have a final look at this tomorrow.



---

archive/issue_comments_292736.json:
```json
{
    "body": "<a id='comment:23'></a>\nOkay, I think I have a better understanding of things. So here's what I think is going on. The coercion system is working fine:\n\n```\nsage: import sympy\nsage: u = sympy.Function('u'); n = sympy.Symbol('n', integer=True)\nsage: import operator\nsage: cm = sage.structure.element.get_coercion_model()\n\nsage: cm.common_parent(3, u(n))\nSymbolic Ring\nsage: cm.common_parent(u(n), 3)\nSymbolic Ring\nsage: type(cm.bin_op(3, u(n), operator.mul))\n<type 'sage.symbolic.expression.Expression'>\nsage: type(cm.bin_op(u(n), 3, operator.mul))\n<type 'sage.symbolic.expression.Expression'>\n```\nThat is now returning something rather than erroring out. This is coming from\n\n```\nsage: (u(n))._sage_()\nu(n)\nsage: type(_)\n<type 'sage.symbolic.expression.Expression'>\n```\nWe go to the coercion framework because of `__mul__` from integers. Previously, because it was erroring out, the multiplication code then tried `__rmul__` from the SymPy function, which resulted in a SymPy object. Now, we get different behaviors because when the SymPy object is on the left, we call its `__mul__`, which results in a SymPy object.\n\nI'm also retracting the last part of [comment:15](#comment%3A15), and the issue might be in SymPy and how it tries to parse our symbolic expressions:\n\n```\nsage: f = function('f')\nsage: x = var('x')\nsage: sympy.sympify(f(x), evaluate=False)\nf(x)\nsage: sympy.sympify(3*f(x), evaluate=False)\nAttributeError: 'Call' object has no attribute 'id'\n```\nHowever, we do seem to have our own troubles of constructing SymPy objects from symbolic expressions. All of these result in errors:\n\n```\nsage: f._sympy_()\nsage: f(x)._sympy_()\nsage: (f(x)+3)._sympy_()\n```\n\nI'm okay with your patch. Although we typically set the first patched version to `p0`.",
    "created_at": "2016-03-13T22:38:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292736",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:23'></a>
Okay, I think I have a better understanding of things. So here's what I think is going on. The coercion system is working fine:

```
sage: import sympy
sage: u = sympy.Function('u'); n = sympy.Symbol('n', integer=True)
sage: import operator
sage: cm = sage.structure.element.get_coercion_model()

sage: cm.common_parent(3, u(n))
Symbolic Ring
sage: cm.common_parent(u(n), 3)
Symbolic Ring
sage: type(cm.bin_op(3, u(n), operator.mul))
<type 'sage.symbolic.expression.Expression'>
sage: type(cm.bin_op(u(n), 3, operator.mul))
<type 'sage.symbolic.expression.Expression'>
```
That is now returning something rather than erroring out. This is coming from

```
sage: (u(n))._sage_()
u(n)
sage: type(_)
<type 'sage.symbolic.expression.Expression'>
```
We go to the coercion framework because of `__mul__` from integers. Previously, because it was erroring out, the multiplication code then tried `__rmul__` from the SymPy function, which resulted in a SymPy object. Now, we get different behaviors because when the SymPy object is on the left, we call its `__mul__`, which results in a SymPy object.

I'm also retracting the last part of [comment:15](#comment%3A15), and the issue might be in SymPy and how it tries to parse our symbolic expressions:

```
sage: f = function('f')
sage: x = var('x')
sage: sympy.sympify(f(x), evaluate=False)
f(x)
sage: sympy.sympify(3*f(x), evaluate=False)
AttributeError: 'Call' object has no attribute 'id'
```
However, we do seem to have our own troubles of constructing SymPy objects from symbolic expressions. All of these result in errors:

```
sage: f._sympy_()
sage: f(x)._sympy_()
sage: (f(x)+3)._sympy_()
```

I'm okay with your patch. Although we typically set the first patched version to `p0`.



---

archive/issue_comments_292737.json:
```json
{
    "body": "**Reviewer:** Travis Scrimshaw",
    "created_at": "2016-03-13T23:16:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292737",
    "user": "https://github.com/tscrim"
}
```

**Reviewer:** Travis Scrimshaw



---

archive/issue_comments_292738.json:
```json
{
    "body": "**Changing commit** from \"[76a47e825dfc3e2cc0d56244ababdc9fb92d5481](https://github.com/sagemath/sagetrac-mirror/commit/76a47e825dfc3e2cc0d56244ababdc9fb92d5481)\" to \"[42dbc8986991f8be078e0e4c61a2c55eb17febda](https://github.com/sagemath/sagetrac-mirror/commit/42dbc8986991f8be078e0e4c61a2c55eb17febda)\".",
    "created_at": "2016-03-13T23:16:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292738",
    "user": "https://github.com/tscrim"
}
```

**Changing commit** from "[76a47e825dfc3e2cc0d56244ababdc9fb92d5481](https://github.com/sagemath/sagetrac-mirror/commit/76a47e825dfc3e2cc0d56244ababdc9fb92d5481)" to "[42dbc8986991f8be078e0e4c61a2c55eb17febda](https://github.com/sagemath/sagetrac-mirror/commit/42dbc8986991f8be078e0e4c61a2c55eb17febda)".



---

archive/issue_comments_292739.json:
```json
{
    "body": "<a id='comment:24'></a>\nI changed the version to `p0`, but this is likely to only affect you (and really, doesn't do anything). I also fixed a failing doctest in `unicode_art.py` as it sends things to SymPy to create teh art. Otherwise all tests pass for me.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/42dbc8986991f8be078e0e4c61a2c55eb17febda\">42dbc89</a></td><td><code>Changing version to p0 and fixing doctest in unicode_art.py.</code></td></tr></table>\n",
    "created_at": "2016-03-13T23:16:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292739",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:24'></a>
I changed the version to `p0`, but this is likely to only affect you (and really, doesn't do anything). I also fixed a failing doctest in `unicode_art.py` as it sends things to SymPy to create teh art. Otherwise all tests pass for me.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/42dbc8986991f8be078e0e4c61a2c55eb17febda">42dbc89</a></td><td><code>Changing version to p0 and fixing doctest in unicode_art.py.</code></td></tr></table>




---

archive/issue_comments_292740.json:
```json
{
    "body": "**Changing branch** from \"[u/rws/upgrade_to_sympy_1_0](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/upgrade_to_sympy_1_0)\" to \"[public/packages/upgrade_sympy-20185](https://github.com/sagemath/sagetrac-mirror/tree/public/packages/upgrade_sympy-20185)\".",
    "created_at": "2016-03-13T23:16:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292740",
    "user": "https://github.com/tscrim"
}
```

**Changing branch** from "[u/rws/upgrade_to_sympy_1_0](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/upgrade_to_sympy_1_0)" to "[public/packages/upgrade_sympy-20185](https://github.com/sagemath/sagetrac-mirror/tree/public/packages/upgrade_sympy-20185)".



---

archive/issue_comments_292741.json:
```json
{
    "body": "**Changing reviewer** from \"Travis Scrimshaw\" to \"Travis Scrimshaw, Ralf Stephan\".",
    "created_at": "2016-03-14T07:10:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292741",
    "user": "https://github.com/rwst"
}
```

**Changing reviewer** from "Travis Scrimshaw" to "Travis Scrimshaw, Ralf Stephan".



---

archive/issue_comments_292742.json:
```json
{
    "body": "<a id='comment:25'></a>\nYour changes are fine. Consider them as reviewed.",
    "created_at": "2016-03-14T07:10:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292742",
    "user": "https://github.com/rwst"
}
```

<a id='comment:25'></a>
Your changes are fine. Consider them as reviewed.



---

archive/issue_comments_292743.json:
```json
{
    "body": "<a id='comment:26'></a>\n> ...Any changes ~~to the coercion system~~ because of future inclusion of `UndefFunction._sage_` can then be dealt with in a separate ticket which I'll open shortly.\n\nSee #20204.",
    "created_at": "2016-03-14T07:51:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292743",
    "user": "https://github.com/rwst"
}
```

<a id='comment:26'></a>
> ...Any changes ~~to the coercion system~~ because of future inclusion of `UndefFunction._sage_` can then be dealt with in a separate ticket which I'll open shortly.

See #20204.



---

archive/issue_comments_292744.json:
```json
{
    "body": "<a id='comment:27'></a>\nThank you.",
    "created_at": "2016-03-14T20:41:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292744",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:27'></a>
Thank you.



---

archive/issue_events_246147.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2016-03-14T20:41:21Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20185#event-246147"
}
```



---

archive/issue_events_246148.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2016-03-14T20:41:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20185#event-246148"
}
```



---

archive/issue_comments_292745.json:
```json
{
    "body": "<a id='comment:28'></a>\nThanks for the review.",
    "created_at": "2016-03-15T07:09:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292745",
    "user": "https://github.com/rwst"
}
```

<a id='comment:28'></a>
Thanks for the review.



---

archive/issue_comments_292746.json:
```json
{
    "body": "<a id='comment:29'></a>\nPDF docs fail\n\n```\n! Emergency stop.\n<inserted text> \n                $\nl.22231 \\PYG{g+go}{    \u23ae   \u221ax}\n```",
    "created_at": "2016-03-20T20:14:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292746",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:29'></a>
PDF docs fail

```
! Emergency stop.
<inserted text> 
                $
l.22231 \PYG{g+go}{    ⎮   √x}
```



---

archive/issue_events_246149.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-03-20T20:14:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20185#event-246149"
}
```



---

archive/issue_events_246150.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-03-20T20:14:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20185#event-246150"
}
```



---

archive/issue_comments_292747.json:
```json
{
    "body": "<a id='comment:30'></a>\nCannot confirm with `./sage --docbuild all pdf`. This is on OpenSuSE Leap with TeXLive 201384.",
    "created_at": "2016-03-21T07:28:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292747",
    "user": "https://github.com/rwst"
}
```

<a id='comment:30'></a>
Cannot confirm with `./sage --docbuild all pdf`. This is on OpenSuSE Leap with TeXLive 201384.



---

archive/issue_events_246151.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2016-03-21T07:28:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20185#event-246151"
}
```



---

archive/issue_events_246152.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2016-03-21T07:28:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "008080",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20185#event-246152"
}
```



---

archive/issue_events_246153.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2016-03-22T03:28:49Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "milestone_number": null,
    "milestone_title": "sage-7.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20185#event-246153"
}
```



---

archive/issue_events_246154.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2016-03-22T03:28:49Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "milestone_number": null,
    "milestone_title": "sage-7.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20185#event-246154"
}
```



---

archive/issue_comments_292748.json:
```json
{
    "body": "<a id='comment:31'></a>\nI am unable to reproduce this either on my laptop either. Volker, can you post the logs if the buildbot fails again, along with its latex setup? Otherwise what we will have to do is change the test...",
    "created_at": "2016-03-22T03:28:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292748",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:31'></a>
I am unable to reproduce this either on my laptop either. Volker, can you post the logs if the buildbot fails again, along with its latex setup? Otherwise what we will have to do is change the test...



---

archive/issue_events_246155.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2016-03-22T03:28:49Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "008080",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20185#event-246155"
}
```



---

archive/issue_events_246156.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2016-03-22T03:28:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20185#event-246156"
}
```



---

archive/issue_comments_292749.json:
```json
{
    "body": "<a id='comment:32'></a>\n\n```\n$ rpm -q texlive\ntexlive-2014-19.20140525_r34255.fc23.x86_64\n```",
    "created_at": "2016-03-22T15:28:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292749",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:32'></a>

```
$ rpm -q texlive
texlive-2014-19.20140525_r34255.fc23.x86_64
```



---

archive/issue_events_246157.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-03-22T15:28:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20185#event-246157"
}
```



---

archive/issue_events_246158.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-03-22T15:28:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20185#event-246158"
}
```



---

archive/issue_comments_292750.json:
```json
{
    "body": "<a id='comment:33'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3872f81c60ab0ae37d2ec64e240cce80a053edc8\">3872f81</a></td><td><code>Fix U+221A in pdf docs</code></td></tr></table>\n",
    "created_at": "2016-03-22T15:45:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292750",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:33'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3872f81c60ab0ae37d2ec64e240cce80a053edc8">3872f81</a></td><td><code>Fix U+221A in pdf docs</code></td></tr></table>




---

archive/issue_comments_292751.json:
```json
{
    "body": "**Changing commit** from \"[42dbc8986991f8be078e0e4c61a2c55eb17febda](https://github.com/sagemath/sagetrac-mirror/commit/42dbc8986991f8be078e0e4c61a2c55eb17febda)\" to \"[3872f81c60ab0ae37d2ec64e240cce80a053edc8](https://github.com/sagemath/sagetrac-mirror/commit/3872f81c60ab0ae37d2ec64e240cce80a053edc8)\".",
    "created_at": "2016-03-22T15:45:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292751",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[42dbc8986991f8be078e0e4c61a2c55eb17febda](https://github.com/sagemath/sagetrac-mirror/commit/42dbc8986991f8be078e0e4c61a2c55eb17febda)" to "[3872f81c60ab0ae37d2ec64e240cce80a053edc8](https://github.com/sagemath/sagetrac-mirror/commit/3872f81c60ab0ae37d2ec64e240cce80a053edc8)".



---

archive/issue_comments_292752.json:
```json
{
    "body": "<a id='comment:34'></a>\nHow could that have worked for you, `\\sqrt` in text mode should be illegal in all TeX versions.",
    "created_at": "2016-03-22T15:46:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292752",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:34'></a>
How could that have worked for you, `\sqrt` in text mode should be illegal in all TeX versions.



---

archive/issue_events_246159.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-03-22T15:46:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20185#event-246159"
}
```



---

archive/issue_events_246160.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-03-22T15:46:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20185#event-246160"
}
```



---

archive/issue_comments_292753.json:
```json
{
    "body": "**Changing reviewer** from \"Travis Scrimshaw, Ralf Stephan\" to \"Travis Scrimshaw, Ralf Stephan, Volker Braun\".",
    "created_at": "2016-03-22T19:14:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292753",
    "user": "https://github.com/tscrim"
}
```

**Changing reviewer** from "Travis Scrimshaw, Ralf Stephan" to "Travis Scrimshaw, Ralf Stephan, Volker Braun".



---

archive/issue_events_246161.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2016-03-22T19:14:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20185#event-246161"
}
```



---

archive/issue_events_246162.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2016-03-22T19:14:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20185#event-246162"
}
```



---

archive/issue_comments_292754.json:
```json
{
    "body": "<a id='comment:35'></a>\nHmm...strange. With your changes, everything works. Thank you for figuring out what the root of the problem is. :P",
    "created_at": "2016-03-22T19:14:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292754",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:35'></a>
Hmm...strange. With your changes, everything works. Thank you for figuring out what the root of the problem is. :P



---

archive/issue_events_246163.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-03-23T12:46:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20185#event-246163"
}
```



---

archive/issue_events_246164.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "686d0fe1bbf9ec36bbee8a837c918b647c0faf9d",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2016-03-23T12:46:48Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20185#event-246164"
}
```



---

archive/issue_comments_292755.json:
```json
{
    "body": "**Changing branch** from \"[public/packages/upgrade_sympy-20185](https://github.com/sagemath/sagetrac-mirror/tree/public/packages/upgrade_sympy-20185)\" to \"[3872f81c60ab0ae37d2ec64e240cce80a053edc8](https://github.com/sagemath/sagetrac-mirror/commit/3872f81c60ab0ae37d2ec64e240cce80a053edc8)\".",
    "created_at": "2016-03-23T12:46:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-292755",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[public/packages/upgrade_sympy-20185](https://github.com/sagemath/sagetrac-mirror/tree/public/packages/upgrade_sympy-20185)" to "[3872f81c60ab0ae37d2ec64e240cce80a053edc8](https://github.com/sagemath/sagetrac-mirror/commit/3872f81c60ab0ae37d2ec64e240cce80a053edc8)".
