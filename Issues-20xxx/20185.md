# Issue 20185: Upgrade to SymPy-1.0

archive/issues_019948.json:
```json
{
    "assignees": [],
    "body": "https://github.com/sympy/sympy/wiki/Release-Notes-for-1.0\n\nIt could be installed as usually \nhttps://github.com/sympy/sympy/releases/download/sympy-1.0/sympy-1.0.tar.gz\nor via `pip install -U sympy`.\n\nComponent: **packages: standard**\n\nAuthor: **Ralf Stephan**\n\nBranch/Commit: **[`3872f81`](https://github.com/sagemath/sagetrac-mirror/commit/3872f81c60ab0ae37d2ec64e240cce80a053edc8)**\n\nReviewer: **Travis Scrimshaw, Ralf Stephan, Volker Braun**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/20185_\n\n",
    "closed_at": "2016-03-23T12:46:48Z",
    "created_at": "2016-03-10T14:25:21Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-7.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Upgrade to SymPy-1.0",
    "type": "issue",
    "updated_at": "2016-03-23T12:46:48Z",
    "url": "https://github.com/sagemath/sage/issues/20185",
    "user": "https://github.com/rwst"
}
```
https://github.com/sympy/sympy/wiki/Release-Notes-for-1.0

It could be installed as usually 
https://github.com/sympy/sympy/releases/download/sympy-1.0/sympy-1.0.tar.gz
or via `pip install -U sympy`.

Component: **packages: standard**

Author: **Ralf Stephan**

Branch/Commit: **[`3872f81`](https://github.com/sagemath/sagetrac-mirror/commit/3872f81c60ab0ae37d2ec64e240cce80a053edc8)**

Reviewer: **Travis Scrimshaw, Ralf Stephan, Volker Braun**

_Issue created by migration from https://trac.sagemath.org/ticket/20185_





---

archive/issue_events_282445.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2016-03-10T14:25:21Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "milestone_number": null,
    "milestone_title": "sage-7.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20185#event-282445"
}
```



---

archive/issue_events_282446.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2016-03-10T14:25:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
    "label_color": "0000b0",
    "label_name": "c: packages: standard",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20185#event-282446"
}
```



---

archive/issue_events_282447.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2016-03-10T14:25:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20185#event-282447"
}
```



---

archive/issue_events_282448.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2016-03-10T14:25:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20185#event-282448"
}
```



---

archive/issue_comments_290155.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,5 @@\n https://github.com/sympy/sympy/wiki/Release-Notes-for-1.0\n \n-It could be installed as usually or via `pip install -U sympy`.\n+It could be installed as usually \n+https://github.com/sympy/sympy/releases/download/sympy-1.0/sympy-1.0.tar.gz\n+or via `pip install -U sympy`.\n``````\n",
    "created_at": "2016-03-10T16:20:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-290155",
    "user": "https://github.com/rwst"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,5 @@
 https://github.com/sympy/sympy/wiki/Release-Notes-for-1.0
 
-It could be installed as usually or via `pip install -U sympy`.
+It could be installed as usually 
+https://github.com/sympy/sympy/releases/download/sympy-1.0/sympy-1.0.tar.gz
+or via `pip install -U sympy`.
``````




---

archive/issue_comments_290156.json:
```json
{
    "body": "Branch: **[u/rws/upgrade_to_sympy_1_0](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/upgrade_to_sympy_1_0)**",
    "created_at": "2016-03-10T16:32:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-290156",
    "user": "https://github.com/rwst"
}
```

Branch: **[u/rws/upgrade_to_sympy_1_0](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/upgrade_to_sympy_1_0)**



---

archive/issue_comments_290157.json:
```json
{
    "body": "Commit: **[`6971607`](https://github.com/sagemath/sagetrac-mirror/commit/6971607ce1b72388e57a742ab8f5f0ffb4af1c0e)**",
    "created_at": "2016-03-10T16:32:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-290157",
    "user": "https://github.com/rwst"
}
```

Commit: **[`6971607`](https://github.com/sagemath/sagetrac-mirror/commit/6971607ce1b72388e57a742ab8f5f0ffb4af1c0e)**



---

archive/issue_comments_290158.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\n\n```\n$ ./sage -p mpmath\nSuccessfully installed mpmath-0.19\n$ ./sage -p sympy\nbuilding sympy\nPlease install the mpmath package with a version >= 0.19\nError building sympy\n```\nAny hints?\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6971607ce1b72388e57a742ab8f5f0ffb4af1c0e\"><code>6971607</code></a></td><td><code>pkg version/chksum/patch removed</code></td></tr></table>\n",
    "created_at": "2016-03-10T16:32:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-290158",
    "user": "https://github.com/rwst"
}
```

<div id="comment:3" align="right">comment:3</div>


```
$ ./sage -p mpmath
Successfully installed mpmath-0.19
$ ./sage -p sympy
building sympy
Please install the mpmath package with a version >= 0.19
Error building sympy
```
Any hints?

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6971607ce1b72388e57a742ab8f5f0ffb4af1c0e"><code>6971607</code></a></td><td><code>pkg version/chksum/patch removed</code></td></tr></table>




---

archive/issue_comments_290159.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nReplying to [@rwst](#comment%3A3):\n> \n> ```\n> $ ./sage -p mpmath\n> Successfully installed mpmath-0.19\n> $ ./sage -p sympy\n> building sympy\n> Please install the mpmath package with a version >= 0.19\n> Error building sympy\n> ```\n> Any hints?\n> \n> ---\n> New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6971607ce1b72388e57a742ab8f5f0ffb4af1c0e\"><code>6971607</code></a></td><td><code>pkg version/chksum/patch removed</code></td></tr></table>\n\nI think I have. In the past (prior to this version) `sympy`'s `setup.py` was importing `sympy` itself. The danger then was to import the previously installed `sympy` rather the new `sympy`. So we add this\n\n```\nexport PYTHONPATH=\".\"\necho \"building sympy\"\npython -S setup.py build\n```\nThe `-S` is the cause of your trouble, look it up. So you should remove the `PYTHONPATH` stuff, the `-S` and remove the corresponding comments in `spkg-install`.",
    "created_at": "2016-03-11T06:18:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-290159",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:4" align="right">comment:4</div>

Replying to [@rwst](#comment%3A3):
> 
> ```
> $ ./sage -p mpmath
> Successfully installed mpmath-0.19
> $ ./sage -p sympy
> building sympy
> Please install the mpmath package with a version >= 0.19
> Error building sympy
> ```
> Any hints?
> 
> ---
> New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6971607ce1b72388e57a742ab8f5f0ffb4af1c0e"><code>6971607</code></a></td><td><code>pkg version/chksum/patch removed</code></td></tr></table>

I think I have. In the past (prior to this version) `sympy`'s `setup.py` was importing `sympy` itself. The danger then was to import the previously installed `sympy` rather the new `sympy`. So we add this

```
export PYTHONPATH="."
echo "building sympy"
python -S setup.py build
```
The `-S` is the cause of your trouble, look it up. So you should remove the `PYTHONPATH` stuff, the `-S` and remove the corresponding comments in `spkg-install`.



---

archive/issue_comments_290160.json:
```json
{
    "body": "<div id=\"comment:5\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9cdde13f3f20603b467733e881c2bbfb5c1a81a3\"><code>9cdde13</code></a></td><td><code>20185: remove python -S stuff</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/907bedc76d3289455a701051d1af6c1be64135b1\"><code>907bedc</code></a></td><td><code>Merge branch 'develop' into t/20185/upgrade_to_sympy_1_0</code></td></tr></table>\n",
    "created_at": "2016-03-11T08:09:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-290160",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:5"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9cdde13f3f20603b467733e881c2bbfb5c1a81a3"><code>9cdde13</code></a></td><td><code>20185: remove python -S stuff</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/907bedc76d3289455a701051d1af6c1be64135b1"><code>907bedc</code></a></td><td><code>Merge branch 'develop' into t/20185/upgrade_to_sympy_1_0</code></td></tr></table>




---

archive/issue_comments_290161.json:
```json
{
    "body": "Changed commit from **[`6971607`](https://github.com/sagemath/sagetrac-mirror/commit/6971607ce1b72388e57a742ab8f5f0ffb4af1c0e)** to **[`907bedc`](https://github.com/sagemath/sagetrac-mirror/commit/907bedc76d3289455a701051d1af6c1be64135b1)**",
    "created_at": "2016-03-11T08:09:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-290161",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`6971607`](https://github.com/sagemath/sagetrac-mirror/commit/6971607ce1b72388e57a742ab8f5f0ffb4af1c0e)** to **[`907bedc`](https://github.com/sagemath/sagetrac-mirror/commit/907bedc76d3289455a701051d1af6c1be64135b1)**



---

archive/issue_comments_290162.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nThanks, that was it. So there are changes that affect doctests:\n\n```\nsage -t --warn-long 27.4 src/sage/symbolic/integration/integral.py  # 1 doctest failed\nsage -t --warn-long 27.4 src/sage/symbolic/expression.pyx  # 3 doctests failed\nsage -t --warn-long 27.2 src/sage/tests/french_book/recequadiff.py  # 2 doctests failed\n```\nThat's only from a partial quick scan.",
    "created_at": "2016-03-11T08:10:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-290162",
    "user": "https://github.com/rwst"
}
```

<div id="comment:6" align="right">comment:6</div>

Thanks, that was it. So there are changes that affect doctests:

```
sage -t --warn-long 27.4 src/sage/symbolic/integration/integral.py  # 1 doctest failed
sage -t --warn-long 27.4 src/sage/symbolic/expression.pyx  # 3 doctests failed
sage -t --warn-long 27.2 src/sage/tests/french_book/recequadiff.py  # 2 doctests failed
```
That's only from a partial quick scan.



---

archive/issue_comments_290163.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\n> \n> ```\n> sage -t --warn-long 27.2 src/sage/tests/french_book/recequadiff.py  # 2 doctests failed\n> ```\n\nThis can be minimized to\n\n```\nsage: import sympy\nsage: u = sympy.Function('u'); n = sympy.Symbol('n', integer=True)\nsage: sympy.sympify(3*u(n), evaluate=False)\nNotImplementedError: SymPy function 'u' doesn't exist\n```\nwhich disappears when `3*u(n)` is changed to `u(n)*3` or `u(n)`\n\nEDIT: I will just change the order in the muls for the doctest, and open a ticket. The case is rare and can be fixed after the upgrade.",
    "created_at": "2016-03-11T08:47:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-290163",
    "user": "https://github.com/rwst"
}
```

<div id="comment:7" align="right">comment:7</div>

> 
> ```
> sage -t --warn-long 27.2 src/sage/tests/french_book/recequadiff.py  # 2 doctests failed
> ```

This can be minimized to

```
sage: import sympy
sage: u = sympy.Function('u'); n = sympy.Symbol('n', integer=True)
sage: sympy.sympify(3*u(n), evaluate=False)
NotImplementedError: SymPy function 'u' doesn't exist
```
which disappears when `3*u(n)` is changed to `u(n)*3` or `u(n)`

EDIT: I will just change the order in the muls for the doctest, and open a ticket. The case is rare and can be fixed after the upgrade.



---

archive/issue_comments_290164.json:
```json
{
    "body": "<div id=\"comment:8\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f92f927e44e1638efb08f01f2136010d236daaef\"><code>f92f927</code></a></td><td><code>fix doctests</code></td></tr></table>\n",
    "created_at": "2016-03-11T09:11:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-290164",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:8"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f92f927e44e1638efb08f01f2136010d236daaef"><code>f92f927</code></a></td><td><code>fix doctests</code></td></tr></table>




---

archive/issue_comments_290165.json:
```json
{
    "body": "Changed commit from **[`907bedc`](https://github.com/sagemath/sagetrac-mirror/commit/907bedc76d3289455a701051d1af6c1be64135b1)** to **[`f92f927`](https://github.com/sagemath/sagetrac-mirror/commit/f92f927e44e1638efb08f01f2136010d236daaef)**",
    "created_at": "2016-03-11T09:11:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-290165",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`907bedc`](https://github.com/sagemath/sagetrac-mirror/commit/907bedc76d3289455a701051d1af6c1be64135b1)** to **[`f92f927`](https://github.com/sagemath/sagetrac-mirror/commit/f92f927e44e1638efb08f01f2136010d236daaef)**



---

archive/issue_comments_290166.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nIMO [comment:7](#comment%3A7) (#20194) is a serious regression and it should be fixed with the upgrade.",
    "created_at": "2016-03-11T09:52:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-290166",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:9" align="right">comment:9</div>

IMO [comment:7](#comment%3A7) (#20194) is a serious regression and it should be fixed with the upgrade.



---

archive/issue_comments_290167.json:
```json
{
    "body": "Changed commit from **[`f92f927`](https://github.com/sagemath/sagetrac-mirror/commit/f92f927e44e1638efb08f01f2136010d236daaef)** to **[`0391252`](https://github.com/sagemath/sagetrac-mirror/commit/03912520043631024635c3d6d09b86743b6c411e)**",
    "created_at": "2016-03-11T16:03:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-290167",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`f92f927`](https://github.com/sagemath/sagetrac-mirror/commit/f92f927e44e1638efb08f01f2136010d236daaef)** to **[`0391252`](https://github.com/sagemath/sagetrac-mirror/commit/03912520043631024635c3d6d09b86743b6c411e)**



---

archive/issue_comments_290168.json:
```json
{
    "body": "<div id=\"comment:10\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/03912520043631024635c3d6d09b86743b6c411e\"><code>0391252</code></a></td><td><code>fix doctest</code></td></tr></table>\n",
    "created_at": "2016-03-11T16:03:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-290168",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:10"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/03912520043631024635c3d6d09b86743b6c411e"><code>0391252</code></a></td><td><code>fix doctest</code></td></tr></table>




---

archive/issue_comments_290169.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nThe doctest is fixed but something seems not right in the sympification of undefined Sage functions. The case in #20194 crashes Sympy's parser and I have reported in https://github.com/sympy/sympy/issues/10795",
    "created_at": "2016-03-11T16:15:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-290169",
    "user": "https://github.com/rwst"
}
```

<div id="comment:11" align="right">comment:11</div>

The doctest is fixed but something seems not right in the sympification of undefined Sage functions. The case in #20194 crashes Sympy's parser and I have reported in https://github.com/sympy/sympy/issues/10795



---

archive/issue_comments_290170.json:
```json
{
    "body": "Author: **Ralf Stephan**",
    "created_at": "2016-03-11T16:16:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-290170",
    "user": "https://github.com/rwst"
}
```

Author: **Ralf Stephan**



---

archive/issue_events_282449.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2016-03-11T16:16:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20185#event-282449"
}
```



---

archive/issue_comments_290171.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nDo I understand you correctly that [0391252](https://github.com/sagemath/sagetrac-mirror/commit/03912520043631024635c3d6d09b86743b6c411e) means you do not have to change the test in the French book?",
    "created_at": "2016-03-11T23:03:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-290171",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:13" align="right">comment:13</div>

Do I understand you correctly that [0391252](https://github.com/sagemath/sagetrac-mirror/commit/03912520043631024635c3d6d09b86743b6c411e) means you do not have to change the test in the French book?



---

archive/issue_comments_290172.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nNow that my Sage has finished rebuilding, the answer to my question is no, we still have a regression.",
    "created_at": "2016-03-11T23:53:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-290172",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:14" align="right">comment:14</div>

Now that my Sage has finished rebuilding, the answer to my question is no, we still have a regression.



---

archive/issue_comments_290173.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nWith this branch, we have:\n\n```\nsage: import sympy\nsage: u = sympy.Function('u'); n = sympy.Symbol('n', integer=True)\nsage: x = int(3)\nsage: x*u(n)\n3*u(n)\nsage: sympy.sympify(x*u(n))\n3*u(n)\nsage: sympy.sympify(x*u(n), evaluate=False)\n3*u(n)\n\nsage: x = 3._sympy_()\nsage: sympy.sympify(x*u(n), evaluate=False)\n3*u(n)\n```\nHowever, I think this is the problem:\n\n```\nsage: type(3*u(n))\n<type 'sage.symbolic.expression.Expression'>\nsage: type(u(n)*3)\n<class 'sympy.core.mul.Mul'>\n\nsage: x = int(3)\nsage: type(x*u(n))\n<class 'sympy.core.mul.Mul'>\nsage: type(u(n)*x)\n<class 'sympy.core.mul.Mul'>\n```\nSo it is probably something on our end.",
    "created_at": "2016-03-12T01:11:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-290173",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:15" align="right">comment:15</div>

With this branch, we have:

```
sage: import sympy
sage: u = sympy.Function('u'); n = sympy.Symbol('n', integer=True)
sage: x = int(3)
sage: x*u(n)
3*u(n)
sage: sympy.sympify(x*u(n))
3*u(n)
sage: sympy.sympify(x*u(n), evaluate=False)
3*u(n)

sage: x = 3._sympy_()
sage: sympy.sympify(x*u(n), evaluate=False)
3*u(n)
```
However, I think this is the problem:

```
sage: type(3*u(n))
<type 'sage.symbolic.expression.Expression'>
sage: type(u(n)*3)
<class 'sympy.core.mul.Mul'>

sage: x = int(3)
sage: type(x*u(n))
<class 'sympy.core.mul.Mul'>
sage: type(u(n)*x)
<class 'sympy.core.mul.Mul'>
```
So it is probably something on our end.



---

archive/issue_comments_290174.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nYes, that is the behavior change. Contrast that with the current 7.1.rc0:\n\n```\nsage: import sympy\nsage: u = sympy.Function('u'); n = sympy.Symbol('n', integer=True)\nsage: type(3*u(n))\n<class 'sympy.core.mul.Mul'>\nsage: type(u(n)*3)\n<class 'sympy.core.mul.Mul'>\n```",
    "created_at": "2016-03-12T01:13:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-290174",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:16" align="right">comment:16</div>

Yes, that is the behavior change. Contrast that with the current 7.1.rc0:

```
sage: import sympy
sage: u = sympy.Function('u'); n = sympy.Symbol('n', integer=True)
sage: type(3*u(n))
<class 'sympy.core.mul.Mul'>
sage: type(u(n)*3)
<class 'sympy.core.mul.Mul'>
```



---

archive/issue_comments_290175.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nI also get the same behavior in [comment:15](#comment%3A15) when I am at commit [f92f927](https://github.com/sagemath/sagetrac-mirror/commit/f92f927e44e1638efb08f01f2136010d236daaef).",
    "created_at": "2016-03-12T01:17:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-290175",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:17" align="right">comment:17</div>

I also get the same behavior in [comment:15](#comment%3A15) when I am at commit [f92f927](https://github.com/sagemath/sagetrac-mirror/commit/f92f927e44e1638efb08f01f2136010d236daaef).



---

archive/issue_comments_290176.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nThis is SymPy-0.7.6.1:\n\n```\nsage: parent(u)\n<class 'sympy.core.function.UndefinedFunction'>\nsage: cm = sage.structure.element.get_coercion_model()\nsage: steps,res = cm.analyse(ZZ, parent(u))\nsage: steps\n['Will try _r_action and _l_action']\n```\nThis is 1.0:\n\n```\nsage: parent(u)\n<class 'sympy.core.function.UndefinedFunction'>\nsage: cm = sage.structure.element.get_coercion_model()\nsage: steps,res = cm.analyse(ZZ, parent(u))\nsage: steps\n['Right operand is not Sage element, will try _sage_.',\n 'Will try _r_action and _l_action']\n\nConversion map:\n  From: Integer Ring\n  To:   Symbolic Ring, None))\n```",
    "created_at": "2016-03-13T08:52:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-290176",
    "user": "https://github.com/rwst"
}
```

<div id="comment:18" align="right">comment:18</div>

This is SymPy-0.7.6.1:

```
sage: parent(u)
<class 'sympy.core.function.UndefinedFunction'>
sage: cm = sage.structure.element.get_coercion_model()
sage: steps,res = cm.analyse(ZZ, parent(u))
sage: steps
['Will try _r_action and _l_action']
```
This is 1.0:

```
sage: parent(u)
<class 'sympy.core.function.UndefinedFunction'>
sage: cm = sage.structure.element.get_coercion_model()
sage: steps,res = cm.analyse(ZZ, parent(u))
sage: steps
['Right operand is not Sage element, will try _sage_.',
 'Will try _r_action and _l_action']

Conversion map:
  From: Integer Ring
  To:   Symbolic Ring, None))
```



---

archive/issue_comments_290177.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nSo it seems the issue is coming from the fact that in 0.7.6.1, we have `type(parent(u)) is type` returning `False` before but with 1.0, it is `True`. Which, AFAICS, is only involved in `discover_action`, but the result is still a `None`.\n\n```\nsage: cm.discover_action(ZZ, parent(u(n)), operator.mul)   # Same in 0.7.6.1\n```\nAlthough to be fair, I think we should test against `u(n)` since parentheses get evaluated before `*`. In that case, I get the same result in both versions:\n\n```\nsage: parent(u)\n<class 'sympy.core.function.UndefinedFunction'>\nsage: parent(u(n))\nu\nsage: steps,res = cm.analyse(ZZ, parent(u(n))); steps\n['Will try _r_action and _l_action']\n```\n\nI'm thinking we will need someone who is much more familiar with the coercion framework than I am.",
    "created_at": "2016-03-13T11:33:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-290177",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:19" align="right">comment:19</div>

So it seems the issue is coming from the fact that in 0.7.6.1, we have `type(parent(u)) is type` returning `False` before but with 1.0, it is `True`. Which, AFAICS, is only involved in `discover_action`, but the result is still a `None`.

```
sage: cm.discover_action(ZZ, parent(u(n)), operator.mul)   # Same in 0.7.6.1
```
Although to be fair, I think we should test against `u(n)` since parentheses get evaluated before `*`. In that case, I get the same result in both versions:

```
sage: parent(u)
<class 'sympy.core.function.UndefinedFunction'>
sage: parent(u(n))
u
sage: steps,res = cm.analyse(ZZ, parent(u(n))); steps
['Will try _r_action and _l_action']
```

I'm thinking we will need someone who is much more familiar with the coercion framework than I am.



---

archive/issue_comments_290178.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nAnd indeed, it was #14723 which prompted the addition of `_sage_` methods to many SymPy classes. So no way out of fixing coercion here.",
    "created_at": "2016-03-13T14:08:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-290178",
    "user": "https://github.com/rwst"
}
```

<div id="comment:20" align="right">comment:20</div>

And indeed, it was #14723 which prompted the addition of `_sage_` methods to many SymPy classes. So no way out of fixing coercion here.



---

archive/issue_comments_290179.json:
```json
{
    "body": "Changed commit from **[`0391252`](https://github.com/sagemath/sagetrac-mirror/commit/03912520043631024635c3d6d09b86743b6c411e)** to **[`76a47e8`](https://github.com/sagemath/sagetrac-mirror/commit/76a47e825dfc3e2cc0d56244ababdc9fb92d5481)**",
    "created_at": "2016-03-13T16:39:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-290179",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`0391252`](https://github.com/sagemath/sagetrac-mirror/commit/03912520043631024635c3d6d09b86743b6c411e)** to **[`76a47e8`](https://github.com/sagemath/sagetrac-mirror/commit/76a47e825dfc3e2cc0d56244ababdc9fb92d5481)**



---

archive/issue_comments_290180.json:
```json
{
    "body": "<div id=\"comment:21\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/12cdb58d7a02391224477d0d99312be8fc03f678\"><code>12cdb58</code></a></td><td><code>revert french book test; add sympy patch to remove UndefFunction._sage_</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/114733df4d9ea52e0f55f77793ac070bfa1dfc75\"><code>114733d</code></a></td><td><code>Merge branch 'u/rws/upgrade_to_sympy_1_0' of git://trac.sagemath.org/sage into t/20185/upgrade_to_sympy_1_0</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/76a47e825dfc3e2cc0d56244ababdc9fb92d5481\"><code>76a47e8</code></a></td><td><code>20185: revert an unnecessary change</code></td></tr></table>\n",
    "created_at": "2016-03-13T16:39:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-290180",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:21"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/12cdb58d7a02391224477d0d99312be8fc03f678"><code>12cdb58</code></a></td><td><code>revert french book test; add sympy patch to remove UndefFunction._sage_</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/114733df4d9ea52e0f55f77793ac070bfa1dfc75"><code>114733d</code></a></td><td><code>Merge branch 'u/rws/upgrade_to_sympy_1_0' of git://trac.sagemath.org/sage into t/20185/upgrade_to_sympy_1_0</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/76a47e825dfc3e2cc0d56244ababdc9fb92d5481"><code>76a47e8</code></a></td><td><code>20185: revert an unnecessary change</code></td></tr></table>




---

archive/issue_comments_290181.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nAs you can see from #14723 the `UndefFunction._sage_` addition only affects future changes. This branch now has this removed from SymPy-1.0 to make it work with current Sage. Any changes to the coercion system because of future inclusion of `UndefFunction._sage_` can then be dealt with in a separate ticket which I'll open shortly. I didn't do a full test on this, so I'll have to have a final look at this tomorrow.",
    "created_at": "2016-03-13T16:44:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-290181",
    "user": "https://github.com/rwst"
}
```

<div id="comment:22" align="right">comment:22</div>

As you can see from #14723 the `UndefFunction._sage_` addition only affects future changes. This branch now has this removed from SymPy-1.0 to make it work with current Sage. Any changes to the coercion system because of future inclusion of `UndefFunction._sage_` can then be dealt with in a separate ticket which I'll open shortly. I didn't do a full test on this, so I'll have to have a final look at this tomorrow.



---

archive/issue_comments_290182.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nOkay, I think I have a better understanding of things. So here's what I think is going on. The coercion system is working fine:\n\n```\nsage: import sympy\nsage: u = sympy.Function('u'); n = sympy.Symbol('n', integer=True)\nsage: import operator\nsage: cm = sage.structure.element.get_coercion_model()\n\nsage: cm.common_parent(3, u(n))\nSymbolic Ring\nsage: cm.common_parent(u(n), 3)\nSymbolic Ring\nsage: type(cm.bin_op(3, u(n), operator.mul))\n<type 'sage.symbolic.expression.Expression'>\nsage: type(cm.bin_op(u(n), 3, operator.mul))\n<type 'sage.symbolic.expression.Expression'>\n```\nThat is now returning something rather than erroring out. This is coming from\n\n```\nsage: (u(n))._sage_()\nu(n)\nsage: type(_)\n<type 'sage.symbolic.expression.Expression'>\n```\nWe go to the coercion framework because of `__mul__` from integers. Previously, because it was erroring out, the multiplication code then tried `__rmul__` from the SymPy function, which resulted in a SymPy object. Now, we get different behaviors because when the SymPy object is on the left, we call its `__mul__`, which results in a SymPy object.\n\nI'm also retracting the last part of [comment:15](#comment%3A15), and the issue might be in SymPy and how it tries to parse our symbolic expressions:\n\n```\nsage: f = function('f')\nsage: x = var('x')\nsage: sympy.sympify(f(x), evaluate=False)\nf(x)\nsage: sympy.sympify(3*f(x), evaluate=False)\nAttributeError: 'Call' object has no attribute 'id'\n```\nHowever, we do seem to have our own troubles of constructing SymPy objects from symbolic expressions. All of these result in errors:\n\n```\nsage: f._sympy_()\nsage: f(x)._sympy_()\nsage: (f(x)+3)._sympy_()\n```\n\nI'm okay with your patch. Although we typically set the first patched version to `p0`.",
    "created_at": "2016-03-13T22:38:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-290182",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:23" align="right">comment:23</div>

Okay, I think I have a better understanding of things. So here's what I think is going on. The coercion system is working fine:

```
sage: import sympy
sage: u = sympy.Function('u'); n = sympy.Symbol('n', integer=True)
sage: import operator
sage: cm = sage.structure.element.get_coercion_model()

sage: cm.common_parent(3, u(n))
Symbolic Ring
sage: cm.common_parent(u(n), 3)
Symbolic Ring
sage: type(cm.bin_op(3, u(n), operator.mul))
<type 'sage.symbolic.expression.Expression'>
sage: type(cm.bin_op(u(n), 3, operator.mul))
<type 'sage.symbolic.expression.Expression'>
```
That is now returning something rather than erroring out. This is coming from

```
sage: (u(n))._sage_()
u(n)
sage: type(_)
<type 'sage.symbolic.expression.Expression'>
```
We go to the coercion framework because of `__mul__` from integers. Previously, because it was erroring out, the multiplication code then tried `__rmul__` from the SymPy function, which resulted in a SymPy object. Now, we get different behaviors because when the SymPy object is on the left, we call its `__mul__`, which results in a SymPy object.

I'm also retracting the last part of [comment:15](#comment%3A15), and the issue might be in SymPy and how it tries to parse our symbolic expressions:

```
sage: f = function('f')
sage: x = var('x')
sage: sympy.sympify(f(x), evaluate=False)
f(x)
sage: sympy.sympify(3*f(x), evaluate=False)
AttributeError: 'Call' object has no attribute 'id'
```
However, we do seem to have our own troubles of constructing SymPy objects from symbolic expressions. All of these result in errors:

```
sage: f._sympy_()
sage: f(x)._sympy_()
sage: (f(x)+3)._sympy_()
```

I'm okay with your patch. Although we typically set the first patched version to `p0`.



---

archive/issue_comments_290183.json:
```json
{
    "body": "Reviewer: **Travis Scrimshaw**",
    "created_at": "2016-03-13T23:16:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-290183",
    "user": "https://github.com/tscrim"
}
```

Reviewer: **Travis Scrimshaw**



---

archive/issue_comments_290184.json:
```json
{
    "body": "Changed commit from **[`76a47e8`](https://github.com/sagemath/sagetrac-mirror/commit/76a47e825dfc3e2cc0d56244ababdc9fb92d5481)** to **[`42dbc89`](https://github.com/sagemath/sagetrac-mirror/commit/42dbc8986991f8be078e0e4c61a2c55eb17febda)**",
    "created_at": "2016-03-13T23:16:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-290184",
    "user": "https://github.com/tscrim"
}
```

Changed commit from **[`76a47e8`](https://github.com/sagemath/sagetrac-mirror/commit/76a47e825dfc3e2cc0d56244ababdc9fb92d5481)** to **[`42dbc89`](https://github.com/sagemath/sagetrac-mirror/commit/42dbc8986991f8be078e0e4c61a2c55eb17febda)**



---

archive/issue_comments_290185.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nI changed the version to `p0`, but this is likely to only affect you (and really, doesn't do anything). I also fixed a failing doctest in `unicode_art.py` as it sends things to SymPy to create teh art. Otherwise all tests pass for me.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/42dbc8986991f8be078e0e4c61a2c55eb17febda\"><code>42dbc89</code></a></td><td><code>Changing version to p0 and fixing doctest in unicode_art.py.</code></td></tr></table>\n",
    "created_at": "2016-03-13T23:16:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-290185",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:24" align="right">comment:24</div>

I changed the version to `p0`, but this is likely to only affect you (and really, doesn't do anything). I also fixed a failing doctest in `unicode_art.py` as it sends things to SymPy to create teh art. Otherwise all tests pass for me.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/42dbc8986991f8be078e0e4c61a2c55eb17febda"><code>42dbc89</code></a></td><td><code>Changing version to p0 and fixing doctest in unicode_art.py.</code></td></tr></table>




---

archive/issue_comments_290186.json:
```json
{
    "body": "Changed branch from **[u/rws/upgrade_to_sympy_1_0](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/upgrade_to_sympy_1_0)** to **[public/packages/upgrade_sympy-20185](https://github.com/sagemath/sagetrac-mirror/tree/public/packages/upgrade_sympy-20185)**",
    "created_at": "2016-03-13T23:16:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-290186",
    "user": "https://github.com/tscrim"
}
```

Changed branch from **[u/rws/upgrade_to_sympy_1_0](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/upgrade_to_sympy_1_0)** to **[public/packages/upgrade_sympy-20185](https://github.com/sagemath/sagetrac-mirror/tree/public/packages/upgrade_sympy-20185)**



---

archive/issue_comments_290187.json:
```json
{
    "body": "Changed reviewer from **Travis Scrimshaw** to **Travis Scrimshaw, Ralf Stephan**",
    "created_at": "2016-03-14T07:10:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-290187",
    "user": "https://github.com/rwst"
}
```

Changed reviewer from **Travis Scrimshaw** to **Travis Scrimshaw, Ralf Stephan**



---

archive/issue_comments_290188.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nYour changes are fine. Consider them as reviewed.",
    "created_at": "2016-03-14T07:10:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-290188",
    "user": "https://github.com/rwst"
}
```

<div id="comment:25" align="right">comment:25</div>

Your changes are fine. Consider them as reviewed.



---

archive/issue_comments_290189.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\n> ...Any changes ~~to the coercion system~~ because of future inclusion of `UndefFunction._sage_` can then be dealt with in a separate ticket which I'll open shortly.\n\nSee #20204.",
    "created_at": "2016-03-14T07:51:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-290189",
    "user": "https://github.com/rwst"
}
```

<div id="comment:26" align="right">comment:26</div>

> ...Any changes ~~to the coercion system~~ because of future inclusion of `UndefFunction._sage_` can then be dealt with in a separate ticket which I'll open shortly.

See #20204.



---

archive/issue_comments_290190.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nThank you.",
    "created_at": "2016-03-14T20:41:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-290190",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:27" align="right">comment:27</div>

Thank you.



---

archive/issue_events_282450.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2016-03-14T20:41:21Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20185#event-282450"
}
```



---

archive/issue_events_282451.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2016-03-14T20:41:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20185#event-282451"
}
```



---

archive/issue_comments_290191.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nThanks for the review.",
    "created_at": "2016-03-15T07:09:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-290191",
    "user": "https://github.com/rwst"
}
```

<div id="comment:28" align="right">comment:28</div>

Thanks for the review.



---

archive/issue_comments_290192.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nPDF docs fail\n\n```\n! Emergency stop.\n<inserted text> \n                $\nl.22231 \\PYG{g+go}{    \u23ae   \u221ax}\n```",
    "created_at": "2016-03-20T20:14:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-290192",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:29" align="right">comment:29</div>

PDF docs fail

```
! Emergency stop.
<inserted text> 
                $
l.22231 \PYG{g+go}{    ⎮   √x}
```



---

archive/issue_events_282452.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-03-20T20:14:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20185#event-282452"
}
```



---

archive/issue_events_282453.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-03-20T20:14:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20185#event-282453"
}
```



---

archive/issue_comments_290193.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nCannot confirm with `./sage --docbuild all pdf`. This is on OpenSuSE Leap with TeXLive 201384.",
    "created_at": "2016-03-21T07:28:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-290193",
    "user": "https://github.com/rwst"
}
```

<div id="comment:30" align="right">comment:30</div>

Cannot confirm with `./sage --docbuild all pdf`. This is on OpenSuSE Leap with TeXLive 201384.



---

archive/issue_events_282454.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2016-03-21T07:28:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20185#event-282454"
}
```



---

archive/issue_events_282455.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2016-03-21T07:28:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20185#event-282455"
}
```



---

archive/issue_events_282456.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2016-03-22T03:28:49Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "milestone_number": null,
    "milestone_title": "sage-7.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20185#event-282456"
}
```



---

archive/issue_events_282457.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2016-03-22T03:28:49Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "milestone_number": null,
    "milestone_title": "sage-7.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20185#event-282457"
}
```



---

archive/issue_comments_290194.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nI am unable to reproduce this either on my laptop either. Volker, can you post the logs if the buildbot fails again, along with its latex setup? Otherwise what we will have to do is change the test...",
    "created_at": "2016-03-22T03:28:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-290194",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:31" align="right">comment:31</div>

I am unable to reproduce this either on my laptop either. Volker, can you post the logs if the buildbot fails again, along with its latex setup? Otherwise what we will have to do is change the test...



---

archive/issue_events_282458.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2016-03-22T03:28:49Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20185#event-282458"
}
```



---

archive/issue_events_282459.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2016-03-22T03:28:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20185#event-282459"
}
```



---

archive/issue_comments_290195.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\n\n```\n$ rpm -q texlive\ntexlive-2014-19.20140525_r34255.fc23.x86_64\n```",
    "created_at": "2016-03-22T15:28:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-290195",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:32" align="right">comment:32</div>


```
$ rpm -q texlive
texlive-2014-19.20140525_r34255.fc23.x86_64
```



---

archive/issue_events_282460.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-03-22T15:28:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20185#event-282460"
}
```



---

archive/issue_events_282461.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-03-22T15:28:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20185#event-282461"
}
```



---

archive/issue_comments_290196.json:
```json
{
    "body": "<div id=\"comment:33\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3872f81c60ab0ae37d2ec64e240cce80a053edc8\"><code>3872f81</code></a></td><td><code>Fix U+221A in pdf docs</code></td></tr></table>\n",
    "created_at": "2016-03-22T15:45:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-290196",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:33"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3872f81c60ab0ae37d2ec64e240cce80a053edc8"><code>3872f81</code></a></td><td><code>Fix U+221A in pdf docs</code></td></tr></table>




---

archive/issue_comments_290197.json:
```json
{
    "body": "Changed commit from **[`42dbc89`](https://github.com/sagemath/sagetrac-mirror/commit/42dbc8986991f8be078e0e4c61a2c55eb17febda)** to **[`3872f81`](https://github.com/sagemath/sagetrac-mirror/commit/3872f81c60ab0ae37d2ec64e240cce80a053edc8)**",
    "created_at": "2016-03-22T15:45:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-290197",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`42dbc89`](https://github.com/sagemath/sagetrac-mirror/commit/42dbc8986991f8be078e0e4c61a2c55eb17febda)** to **[`3872f81`](https://github.com/sagemath/sagetrac-mirror/commit/3872f81c60ab0ae37d2ec64e240cce80a053edc8)**



---

archive/issue_comments_290198.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nHow could that have worked for you, `\\sqrt` in text mode should be illegal in all TeX versions.",
    "created_at": "2016-03-22T15:46:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-290198",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:34" align="right">comment:34</div>

How could that have worked for you, `\sqrt` in text mode should be illegal in all TeX versions.



---

archive/issue_events_282462.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-03-22T15:46:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20185#event-282462"
}
```



---

archive/issue_events_282463.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-03-22T15:46:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20185#event-282463"
}
```



---

archive/issue_comments_290199.json:
```json
{
    "body": "Changed reviewer from **Travis Scrimshaw, Ralf Stephan** to **Travis Scrimshaw, Ralf Stephan, Volker Braun**",
    "created_at": "2016-03-22T19:14:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-290199",
    "user": "https://github.com/tscrim"
}
```

Changed reviewer from **Travis Scrimshaw, Ralf Stephan** to **Travis Scrimshaw, Ralf Stephan, Volker Braun**



---

archive/issue_events_282464.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2016-03-22T19:14:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20185#event-282464"
}
```



---

archive/issue_events_282465.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2016-03-22T19:14:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20185#event-282465"
}
```



---

archive/issue_comments_290200.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nHmm...strange. With your changes, everything works. Thank you for figuring out what the root of the problem is. :P",
    "created_at": "2016-03-22T19:14:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-290200",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:35" align="right">comment:35</div>

Hmm...strange. With your changes, everything works. Thank you for figuring out what the root of the problem is. :P



---

archive/issue_events_282466.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-03-23T12:46:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20185#event-282466"
}
```



---

archive/issue_events_282467.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "686d0fe1bbf9ec36bbee8a837c918b647c0faf9d",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2016-03-23T12:46:48Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20185#event-282467"
}
```



---

archive/issue_comments_290201.json:
```json
{
    "body": "Changed branch from **[public/packages/upgrade_sympy-20185](https://github.com/sagemath/sagetrac-mirror/tree/public/packages/upgrade_sympy-20185)** to **[`3872f81`](https://github.com/sagemath/sagetrac-mirror/commit/3872f81c60ab0ae37d2ec64e240cce80a053edc8)**",
    "created_at": "2016-03-23T12:46:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20185#issuecomment-290201",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[public/packages/upgrade_sympy-20185](https://github.com/sagemath/sagetrac-mirror/tree/public/packages/upgrade_sympy-20185)** to **[`3872f81`](https://github.com/sagemath/sagetrac-mirror/commit/3872f81c60ab0ae37d2ec64e240cce80a053edc8)**
