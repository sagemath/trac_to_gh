# Issue 20774: Basic singularity analysis for algebraic curves

archive/issues_020537.json:
```json
{
    "assignees": [],
    "body": "Compute the set of singular points of a generic algebraic curve and determine their multiplicities.\n\nFor plane curves, implement functionality to compute the tangents of the curve at a point, and to determine whether a singular point is ordinary or not.\n\n**CC:**  @bhutz @miguelmarco\n\n**Keywords:** gsoc2016\n\n**Branch/Commit:** [4282a4ff695ae038c1b3268255e23f2f580af6c5](https://github.com/sagemath/sagetrac-mirror/commit/4282a4ff695ae038c1b3268255e23f2f580af6c5)\n\n**Reviewer:** Ben Hutz\n\n**Author:** Grayson Jorgenson\n\nIssue created by migration from https://trac.sagemath.org/ticket/20774\n\n",
    "closed_at": "2016-06-15T18:47:25Z",
    "created_at": "2016-06-03T18:23:25Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20algebraic%20geometry",
        "https://github.com/sagemath/sage/labels/minor",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-7.3",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Basic singularity analysis for algebraic curves",
    "type": "issue",
    "updated_at": "2016-06-15T18:47:25Z",
    "url": "https://github.com/sagemath/sage/issues/20774",
    "user": "https://github.com/sagetrac-gjorgenson"
}
```
Compute the set of singular points of a generic algebraic curve and determine their multiplicities.

For plane curves, implement functionality to compute the tangents of the curve at a point, and to determine whether a singular point is ordinary or not.

**CC:**  @bhutz @miguelmarco

**Keywords:** gsoc2016

**Branch/Commit:** [4282a4ff695ae038c1b3268255e23f2f580af6c5](https://github.com/sagemath/sagetrac-mirror/commit/4282a4ff695ae038c1b3268255e23f2f580af6c5)

**Reviewer:** Ben Hutz

**Author:** Grayson Jorgenson

Issue created by migration from https://trac.sagemath.org/ticket/20774





---

archive/issue_events_252916.json:
```json
{
    "actor": "https://github.com/sagetrac-gjorgenson",
    "created_at": "2016-06-03T18:23:25Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/20774",
    "milestone_number": null,
    "milestone_title": "sage-7.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20774#event-252916"
}
```



---

archive/issue_events_252917.json:
```json
{
    "actor": "https://github.com/sagetrac-gjorgenson",
    "created_at": "2016-06-03T18:23:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20774",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20algebraic%20geometry",
    "label_color": "08517b",
    "label_name": "component: algebraic geometry",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20774#event-252917"
}
```



---

archive/issue_events_252918.json:
```json
{
    "actor": "https://github.com/sagetrac-gjorgenson",
    "created_at": "2016-06-03T18:23:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20774",
    "label": "https://github.com/sagemath/sage/labels/minor",
    "label_color": "ff0000",
    "label_name": "minor",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20774#event-252918"
}
```



---

archive/issue_events_252919.json:
```json
{
    "actor": "https://github.com/sagetrac-gjorgenson",
    "created_at": "2016-06-03T18:23:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20774",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "008080",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20774#event-252919"
}
```



---

archive/issue_comments_303823.json:
```json
{
    "body": "**Branch:** [u/gjorgenson/ticket/20774](https://github.com/sagemath/sagetrac-mirror/tree/u/gjorgenson/ticket/20774)",
    "created_at": "2016-06-10T01:51:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20774#issuecomment-303823",
    "user": "https://github.com/sagetrac-gjorgenson"
}
```

**Branch:** [u/gjorgenson/ticket/20774](https://github.com/sagemath/sagetrac-mirror/tree/u/gjorgenson/ticket/20774)



---

archive/issue_comments_303824.json:
```json
{
    "body": "<a id='comment:2'>**Comment 2:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **Last 10 new commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/39dd215adb96f07bc67854c5debd1f1b49c08032\">39dd215</a></td><td><code>20676: Attempt to keep track of ambient spaces.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/02349fe0fe9b2db2c4d3c66e19cf2de5e6591636\">02349fe</a></td><td><code>20676: projective_embedding revision and projective_closure.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ef65acaab97ed5a1de6fa6ca9900ef942bc6f9f0\">ef65aca</a></td><td><code>20676: Merge ticket 20697 into this ticket.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3ffc3aabc0b17be5658c69bf0b54b87f8d8ccc31\">3ffc3aa</a></td><td><code>20676: Merge ticket 20698 into this ticket.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c6fe8401f1ddf7d53f6af060e5db2d9766f05ed3\">c6fe840</a></td><td><code>20676: implemented curve-level functions.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/54f4e623b5e676bc746e1f1da1aa5bb627b0826a\">54f4e62</a></td><td><code>20676: Merge again with 20697.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0039d7b13dad64025ef70542f407bf3af7423e1a\">0039d7b</a></td><td><code>20676: Update example strings to match changes from 20697.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9262ae5923e1c14192b87314288902d50e08b104\">9262ae5</a></td><td><code>20676: changes from review, and spacing fixes.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4fce7ed8dd40a6e6956947983e3aed08019a30ab\">4fce7ed</a></td><td><code>20774: Merge this ticket with 20676.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4655c72f7de4b9b251d0837cabf1f81a41454182\">4655c72</a></td><td><code>20774: Implement multiplicity, tangents, and is_ordinary_singularity</code></td></tr></table>\n",
    "created_at": "2016-06-10T01:54:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20774#issuecomment-303824",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:2'>**Comment 2:**</a>
**Branch pushed to git repo; I updated commit sha1.** **Last 10 new commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/39dd215adb96f07bc67854c5debd1f1b49c08032">39dd215</a></td><td><code>20676: Attempt to keep track of ambient spaces.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/02349fe0fe9b2db2c4d3c66e19cf2de5e6591636">02349fe</a></td><td><code>20676: projective_embedding revision and projective_closure.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ef65acaab97ed5a1de6fa6ca9900ef942bc6f9f0">ef65aca</a></td><td><code>20676: Merge ticket 20697 into this ticket.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3ffc3aabc0b17be5658c69bf0b54b87f8d8ccc31">3ffc3aa</a></td><td><code>20676: Merge ticket 20698 into this ticket.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c6fe8401f1ddf7d53f6af060e5db2d9766f05ed3">c6fe840</a></td><td><code>20676: implemented curve-level functions.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/54f4e623b5e676bc746e1f1da1aa5bb627b0826a">54f4e62</a></td><td><code>20676: Merge again with 20697.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0039d7b13dad64025ef70542f407bf3af7423e1a">0039d7b</a></td><td><code>20676: Update example strings to match changes from 20697.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9262ae5923e1c14192b87314288902d50e08b104">9262ae5</a></td><td><code>20676: changes from review, and spacing fixes.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4fce7ed8dd40a6e6956947983e3aed08019a30ab">4fce7ed</a></td><td><code>20774: Merge this ticket with 20676.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4655c72f7de4b9b251d0837cabf1f81a41454182">4655c72</a></td><td><code>20774: Implement multiplicity, tangents, and is_ordinary_singularity</code></td></tr></table>




---

archive/issue_comments_303825.json:
```json
{
    "body": "**Commit:** [4655c72f7de4b9b251d0837cabf1f81a41454182](https://github.com/sagemath/sagetrac-mirror/commit/4655c72f7de4b9b251d0837cabf1f81a41454182)",
    "created_at": "2016-06-10T01:54:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20774#issuecomment-303825",
    "user": "https://github.com/sagetrac-git"
}
```

**Commit:** [4655c72f7de4b9b251d0837cabf1f81a41454182](https://github.com/sagemath/sagetrac-mirror/commit/4655c72f7de4b9b251d0837cabf1f81a41454182)



---

archive/issue_comments_303826.json:
```json
{
    "body": "**Changing commit** from \"[4655c72f7de4b9b251d0837cabf1f81a41454182](https://github.com/sagemath/sagetrac-mirror/commit/4655c72f7de4b9b251d0837cabf1f81a41454182)\" to \"[e1f15291034546dd48d91284790df481af5aacdf](https://github.com/sagemath/sagetrac-mirror/commit/e1f15291034546dd48d91284790df481af5aacdf)\".",
    "created_at": "2016-06-10T04:26:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20774#issuecomment-303826",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[4655c72f7de4b9b251d0837cabf1f81a41454182](https://github.com/sagemath/sagetrac-mirror/commit/4655c72f7de4b9b251d0837cabf1f81a41454182)" to "[e1f15291034546dd48d91284790df481af5aacdf](https://github.com/sagemath/sagetrac-mirror/commit/e1f15291034546dd48d91284790df481af5aacdf)".



---

archive/issue_comments_303827.json:
```json
{
    "body": "<a id='comment:3'>**Comment 3:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e1f15291034546dd48d91284790df481af5aacdf\">e1f1529</a></td><td><code>20774: Merge with 7.3 beta3</code></td></tr></table>\n",
    "created_at": "2016-06-10T04:26:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20774#issuecomment-303827",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:3'>**Comment 3:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e1f15291034546dd48d91284790df481af5aacdf">e1f1529</a></td><td><code>20774: Merge with 7.3 beta3</code></td></tr></table>




---

archive/issue_comments_303828.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n-Compute the set of singular points of a generic algebraic curve.\n+Compute the set of singular points of a generic algebraic curve and determine their multiplicities.\n \n-For plane curves, implement functionality to compute the multiplicity of a singular point, determine whether a singular point is ordinary or not, and compute the tangents of the curve at a point.\n+For plane curves, implement functionality to compute the tangents of the curve at a point, and to determine whether a singular point is ordinary or not.\n``````\n",
    "created_at": "2016-06-10T04:31:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20774#issuecomment-303828",
    "user": "https://github.com/sagetrac-gjorgenson"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
-Compute the set of singular points of a generic algebraic curve.
+Compute the set of singular points of a generic algebraic curve and determine their multiplicities.
 
-For plane curves, implement functionality to compute the multiplicity of a singular point, determine whether a singular point is ordinary or not, and compute the tangents of the curve at a point.
+For plane curves, implement functionality to compute the tangents of the curve at a point, and to determine whether a singular point is ordinary or not.
``````




---

archive/issue_events_252920.json:
```json
{
    "actor": "https://github.com/sagetrac-gjorgenson",
    "created_at": "2016-06-10T04:31:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20774",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20774#event-252920"
}
```



---

archive/issue_events_252921.json:
```json
{
    "actor": "https://github.com/bhutz",
    "created_at": "2016-06-10T12:48:21Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20774",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20774#event-252921"
}
```



---

archive/issue_events_252922.json:
```json
{
    "actor": "https://github.com/bhutz",
    "created_at": "2016-06-10T12:48:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20774",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20774#event-252922"
}
```



---

archive/issue_comments_303829.json:
```json
{
    "body": "<a id='comment:5'>**Comment 5:**</a>\nsome comments in no particular order\n\n- the values I've checked agree with Magma.\n\n- I would rather see a while loop than a for/break since you are using the loop variable later when you are getting an appropriate affine patch\n\n- examples are all QQ or number field. I'd like to see some other fields (assuming they work)\n\n- in multiplicity: why don't you change ring first to get the ordering, and then use R.ideal to create the ideal. That way you only have to change_ring once instead of twice.\n\n- OUTPUT: an integer.   You don't have to make a list when it is a simple output\n\n- multiplicity = 0: do you really want to allow this? I think returning an error that the point is not on the curve may be more intuitive. If you change it: in tangents: if r < 1 isn't needed. Either way, this should be described in the doc\n\n- in is_ordinary: OUTPUT: Boolean. You should document that an error is returned for a non-singular point\n\n- in singular_points: I think putting F=F is better than adding the 0 as the first parameter.\n\n- do you want to add C.singular_subscheme()?\n\n- I see many places you are restricting to fields. Should there be a field subclass?\n\n- Things like Q.is_ordinary_singularity(), Q.tangents(), Q.multiplicity() don't work when Q is the curve point.\n\n- Q.is_singular() and C.is_singular(Q) would be nice to have.",
    "created_at": "2016-06-10T12:48:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20774#issuecomment-303829",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:5'>**Comment 5:**</a>
some comments in no particular order

- the values I've checked agree with Magma.

- I would rather see a while loop than a for/break since you are using the loop variable later when you are getting an appropriate affine patch

- examples are all QQ or number field. I'd like to see some other fields (assuming they work)

- in multiplicity: why don't you change ring first to get the ordering, and then use R.ideal to create the ideal. That way you only have to change_ring once instead of twice.

- OUTPUT: an integer.   You don't have to make a list when it is a simple output

- multiplicity = 0: do you really want to allow this? I think returning an error that the point is not on the curve may be more intuitive. If you change it: in tangents: if r < 1 isn't needed. Either way, this should be described in the doc

- in is_ordinary: OUTPUT: Boolean. You should document that an error is returned for a non-singular point

- in singular_points: I think putting F=F is better than adding the 0 as the first parameter.

- do you want to add C.singular_subscheme()?

- I see many places you are restricting to fields. Should there be a field subclass?

- Things like Q.is_ordinary_singularity(), Q.tangents(), Q.multiplicity() don't work when Q is the curve point.

- Q.is_singular() and C.is_singular(Q) would be nice to have.



---

archive/issue_comments_303830.json:
```json
{
    "body": "**Reviewer:** Ben Hutz",
    "created_at": "2016-06-10T12:48:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20774#issuecomment-303830",
    "user": "https://github.com/bhutz"
}
```

**Reviewer:** Ben Hutz



---

archive/issue_comments_303831.json:
```json
{
    "body": "**Changing commit** from \"[e1f15291034546dd48d91284790df481af5aacdf](https://github.com/sagemath/sagetrac-mirror/commit/e1f15291034546dd48d91284790df481af5aacdf)\" to \"[e6f1a9364395b0507ba872b4addf5b11d3e17ef8](https://github.com/sagemath/sagetrac-mirror/commit/e6f1a9364395b0507ba872b4addf5b11d3e17ef8)\".",
    "created_at": "2016-06-11T07:10:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20774#issuecomment-303831",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[e1f15291034546dd48d91284790df481af5aacdf](https://github.com/sagemath/sagetrac-mirror/commit/e1f15291034546dd48d91284790df481af5aacdf)" to "[e6f1a9364395b0507ba872b4addf5b11d3e17ef8](https://github.com/sagemath/sagetrac-mirror/commit/e6f1a9364395b0507ba872b4addf5b11d3e17ef8)".



---

archive/issue_comments_303832.json:
```json
{
    "body": "<a id='comment:6'>**Comment 6:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e6f1a9364395b0507ba872b4addf5b11d3e17ef8\">e6f1a93</a></td><td><code>20774: Changes from first review.</code></td></tr></table>\n",
    "created_at": "2016-06-11T07:10:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20774#issuecomment-303832",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:6'>**Comment 6:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e6f1a9364395b0507ba872b4addf5b11d3e17ef8">e6f1a93</a></td><td><code>20774: Changes from first review.</code></td></tr></table>




---

archive/issue_comments_303833.json:
```json
{
    "body": "<a id='comment:7'>**Comment 7:**</a>\nThanks. I added some examples with different fields. It looks like multiplicity works with RR and CC, and with finite fields. I think only number fields work with the tangents functions though, since they use the function factor().\n\nI implemented an is_singular function which just uses the is_smooth functions of affine/projective subschemes. If given a point it returns whether it's singular or not, otherwise it returns whether the curve is singular or not. I added a singular_subscheme function as well.\n\nCurrently, only plane curves over general rings can be defined. In the space curve initialization, dimension is checked. Could we get around this by checking the dimension of the new curve created by embedding the defining polynomials of the original curve into the polynomial ring with coefficients from the field of fractions of the base ring (assuming it's an integral domain)?\n\nIf we add classes for curves over rings, would the naming scheme AffineCurve_ring, ProjectiveCurve_ring for generic curves over rings, and renaming\nAffineCurve --> AffineCurve_field\nProjectiveCurve --> ProjectiveCurve_field\nbe okay?\n\nI haven't yet implemented the corresponding singularity analysis functions for points on curves; do you think it might be good for me to create classes for points on  general curves first? Maybe similar to what's done in ell_point.py for points on elliptic curves?",
    "created_at": "2016-06-11T07:20:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20774#issuecomment-303833",
    "user": "https://github.com/sagetrac-gjorgenson"
}
```

<a id='comment:7'>**Comment 7:**</a>
Thanks. I added some examples with different fields. It looks like multiplicity works with RR and CC, and with finite fields. I think only number fields work with the tangents functions though, since they use the function factor().

I implemented an is_singular function which just uses the is_smooth functions of affine/projective subschemes. If given a point it returns whether it's singular or not, otherwise it returns whether the curve is singular or not. I added a singular_subscheme function as well.

Currently, only plane curves over general rings can be defined. In the space curve initialization, dimension is checked. Could we get around this by checking the dimension of the new curve created by embedding the defining polynomials of the original curve into the polynomial ring with coefficients from the field of fractions of the base ring (assuming it's an integral domain)?

If we add classes for curves over rings, would the naming scheme AffineCurve_ring, ProjectiveCurve_ring for generic curves over rings, and renaming
AffineCurve --> AffineCurve_field
ProjectiveCurve --> ProjectiveCurve_field
be okay?

I haven't yet implemented the corresponding singularity analysis functions for points on curves; do you think it might be good for me to create classes for points on  general curves first? Maybe similar to what's done in ell_point.py for points on elliptic curves?



---

archive/issue_comments_303834.json:
```json
{
    "body": "<a id='comment:8'>**Comment 8:**</a>\nAt a quick glance the code changes look good, but due to traveling I won't get to really test them for a couple days.\n\nI forgot we need to check dimension in the curve initialization. Yes, you could probably pass to the fractionfield in most cases and go from there (certainly for projective curves), but with that much complication, creating a field/ring class should be a different ticket. I consider it low priority and can be done possibly at a later date if you decide you have enough differentiated functionality to warrant it.\n\nIt does look to me like it is time for a point class for curves. Some things can be done in the corresponding point class for subschemes, but I think you have enough curve.point specific functionality to warrant its own class. This can be a different ticket where you create the class and add the corresponding singular analysis point functions. Most of the basic functionality for points can just inherit directly from appropriate subscheme point class.",
    "created_at": "2016-06-11T13:14:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20774#issuecomment-303834",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:8'>**Comment 8:**</a>
At a quick glance the code changes look good, but due to traveling I won't get to really test them for a couple days.

I forgot we need to check dimension in the curve initialization. Yes, you could probably pass to the fractionfield in most cases and go from there (certainly for projective curves), but with that much complication, creating a field/ring class should be a different ticket. I consider it low priority and can be done possibly at a later date if you decide you have enough differentiated functionality to warrant it.

It does look to me like it is time for a point class for curves. Some things can be done in the corresponding point class for subschemes, but I think you have enough curve.point specific functionality to warrant its own class. This can be a different ticket where you create the class and add the corresponding singular analysis point functions. Most of the basic functionality for points can just inherit directly from appropriate subscheme point class.



---

archive/issue_comments_303835.json:
```json
{
    "body": "<a id='comment:9'>**Comment 9:**</a>\nOkay, if classes and singularity analysis for points are implemented in another ticket, I think this one is ready for review. I opened #20811 for the points functionality. Is it okay to put the new point classes in the files for the subscheme point classes, or would it be better to make a points file in the curves folder for them?",
    "created_at": "2016-06-11T17:26:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20774#issuecomment-303835",
    "user": "https://github.com/sagetrac-gjorgenson"
}
```

<a id='comment:9'>**Comment 9:**</a>
Okay, if classes and singularity analysis for points are implemented in another ticket, I think this one is ready for review. I opened #20811 for the points functionality. Is it okay to put the new point classes in the files for the subscheme point classes, or would it be better to make a points file in the curves folder for them?



---

archive/issue_events_252923.json:
```json
{
    "actor": "https://github.com/sagetrac-gjorgenson",
    "created_at": "2016-06-11T17:26:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20774",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20774#event-252923"
}
```



---

archive/issue_events_252924.json:
```json
{
    "actor": "https://github.com/sagetrac-gjorgenson",
    "created_at": "2016-06-11T17:26:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20774",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20774#event-252924"
}
```



---

archive/issue_events_252925.json:
```json
{
    "actor": "https://github.com/bhutz",
    "created_at": "2016-06-13T12:46:29Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20774",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20774#event-252925"
}
```



---

archive/issue_events_252926.json:
```json
{
    "actor": "https://github.com/bhutz",
    "created_at": "2016-06-13T12:46:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20774",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20774#event-252926"
}
```



---

archive/issue_comments_303836.json:
```json
{
    "body": "<a id='comment:10'>**Comment 10:**</a>\nexcept for the merge conflict, this functionality looks fine.",
    "created_at": "2016-06-13T12:46:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20774#issuecomment-303836",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:10'>**Comment 10:**</a>
except for the merge conflict, this functionality looks fine.



---

archive/issue_comments_303837.json:
```json
{
    "body": "<a id='comment:11'>**Comment 11:**</a>\nMaybe you should add doctests that illustrate the possible errors raised.",
    "created_at": "2016-06-13T13:10:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20774#issuecomment-303837",
    "user": "https://github.com/miguelmarco"
}
```

<a id='comment:11'>**Comment 11:**</a>
Maybe you should add doctests that illustrate the possible errors raised.



---

archive/issue_comments_303838.json:
```json
{
    "body": "<a id='comment:12'>**Comment 12:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1f0d7ab498a3c21aefa651b83a752d0f05d8d121\">1f0d7ab</a></td><td><code>20774: Merge with 7.3 beta4.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bfcd05e6885d0f66ee55556deaf2dacc792a8c96\">bfcd05e</a></td><td><code>20774: Added some error tests, and updated error messages.</code></td></tr></table>\n",
    "created_at": "2016-06-13T23:31:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20774#issuecomment-303838",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:12'>**Comment 12:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1f0d7ab498a3c21aefa651b83a752d0f05d8d121">1f0d7ab</a></td><td><code>20774: Merge with 7.3 beta4.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bfcd05e6885d0f66ee55556deaf2dacc792a8c96">bfcd05e</a></td><td><code>20774: Added some error tests, and updated error messages.</code></td></tr></table>




---

archive/issue_comments_303839.json:
```json
{
    "body": "**Changing commit** from \"[e6f1a9364395b0507ba872b4addf5b11d3e17ef8](https://github.com/sagemath/sagetrac-mirror/commit/e6f1a9364395b0507ba872b4addf5b11d3e17ef8)\" to \"[bfcd05e6885d0f66ee55556deaf2dacc792a8c96](https://github.com/sagemath/sagetrac-mirror/commit/bfcd05e6885d0f66ee55556deaf2dacc792a8c96)\".",
    "created_at": "2016-06-13T23:31:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20774#issuecomment-303839",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[e6f1a9364395b0507ba872b4addf5b11d3e17ef8](https://github.com/sagemath/sagetrac-mirror/commit/e6f1a9364395b0507ba872b4addf5b11d3e17ef8)" to "[bfcd05e6885d0f66ee55556deaf2dacc792a8c96](https://github.com/sagemath/sagetrac-mirror/commit/bfcd05e6885d0f66ee55556deaf2dacc792a8c96)".



---

archive/issue_comments_303840.json:
```json
{
    "body": "<a id='comment:13'>**Comment 13:**</a>\nMerging with beta4 broke the example in the singular_points function at line 260 of curve.py; too few points seem to be returned now.\n\nIt looks like this is due to the point search changes for 0 dimensional subschemes from #20780. Replacing the new point search with the old one from before the merge resolves the problem. Here's the failed example modified a bit:\n\n```\nR.<a> = QQ[]\nK.<b> = NumberField(a^8 - a^4 + 1)\nP.<x,y,z> = ProjectiveSpace(K, 2)\nC = Curve([359/12*x*y^2*z^2 + 2*y*z^4 + 187/12*y^3*z^2 + x*z^4\\\n+ 67/3*x^2*y*z^2 + 117/4*y^5 + 9*x^5 + 6*x^3*z^2 + 393/4*x*y^4\\\n+ 145*x^2*y^3 + 115*x^3*y^2 + 49*x^4*y], P)\nX = C.singular_subscheme()\nQ = P([1/2*b^5 + 1/2*b^3 - 1/2*b - 1,1,0])\nX(Q)\n(1/2*b^5 + 1/2*b^3 - 1/2*b - 1 : 1 : 0)\nX.rational_points() # Q is on X, but not in set of rational points anymore\n[(2/3*b^4 - 1/3 : 0 : 1), (b^6 : -b^6 : 1), (-b^6 : b^6 : 1), (-2/3*b^4 + 1/3 : 0 : 1)]\n```\n\nI thought the point search method in #20780 looked good when I reviewed it, and I think this issue might just be from a weird special case. For this example, during the part of the algorithm using the affine patch corresponding to y = 1, the Groebner basis used is `[x^2 + 2*x + 1/2*z^2 + 3/2, x*z + z, z^3 + z]`. The rightmost polynomial has z = 0 among its roots, but substituting z = 0 and y = 1 into the next polynomial `x*z + z` yields 0, and I think this causes the algorithm to skip any points with z = 0, y = 1. But if those values had been kept for the last polynomial `x^2 + 2*x + 1/2*z^2 + 3/2`, substituting them in would give `x^2 + 2*x + 3/2` which would give the x values of the missing points.\n\nI think a way to resolve this might be to just add something like\n\n```\nelse:\n    new_points.append(P)\n    good = 1\n```\nafter the if statement `if L != 0:` in line 159 of projective_homset.py. Doing this doesn't seem to break any examples, but does it mess up the algorithm at all?",
    "created_at": "2016-06-14T07:38:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20774#issuecomment-303840",
    "user": "https://github.com/sagetrac-gjorgenson"
}
```

<a id='comment:13'>**Comment 13:**</a>
Merging with beta4 broke the example in the singular_points function at line 260 of curve.py; too few points seem to be returned now.

It looks like this is due to the point search changes for 0 dimensional subschemes from #20780. Replacing the new point search with the old one from before the merge resolves the problem. Here's the failed example modified a bit:

```
R.<a> = QQ[]
K.<b> = NumberField(a^8 - a^4 + 1)
P.<x,y,z> = ProjectiveSpace(K, 2)
C = Curve([359/12*x*y^2*z^2 + 2*y*z^4 + 187/12*y^3*z^2 + x*z^4\
+ 67/3*x^2*y*z^2 + 117/4*y^5 + 9*x^5 + 6*x^3*z^2 + 393/4*x*y^4\
+ 145*x^2*y^3 + 115*x^3*y^2 + 49*x^4*y], P)
X = C.singular_subscheme()
Q = P([1/2*b^5 + 1/2*b^3 - 1/2*b - 1,1,0])
X(Q)
(1/2*b^5 + 1/2*b^3 - 1/2*b - 1 : 1 : 0)
X.rational_points() # Q is on X, but not in set of rational points anymore
[(2/3*b^4 - 1/3 : 0 : 1), (b^6 : -b^6 : 1), (-b^6 : b^6 : 1), (-2/3*b^4 + 1/3 : 0 : 1)]
```

I thought the point search method in #20780 looked good when I reviewed it, and I think this issue might just be from a weird special case. For this example, during the part of the algorithm using the affine patch corresponding to y = 1, the Groebner basis used is `[x^2 + 2*x + 1/2*z^2 + 3/2, x*z + z, z^3 + z]`. The rightmost polynomial has z = 0 among its roots, but substituting z = 0 and y = 1 into the next polynomial `x*z + z` yields 0, and I think this causes the algorithm to skip any points with z = 0, y = 1. But if those values had been kept for the last polynomial `x^2 + 2*x + 1/2*z^2 + 3/2`, substituting them in would give `x^2 + 2*x + 3/2` which would give the x values of the missing points.

I think a way to resolve this might be to just add something like

```
else:
    new_points.append(P)
    good = 1
```
after the if statement `if L != 0:` in line 159 of projective_homset.py. Doing this doesn't seem to break any examples, but does it mess up the algorithm at all?



---

archive/issue_comments_303841.json:
```json
{
    "body": "<a id='comment:14'>**Comment 14:**</a>\nYes, I agree with that fix for points. It looks like it was dropping the point if the 'next' poly in the basis was already 0. Your 'else' makes sure it keeps that point.",
    "created_at": "2016-06-14T12:40:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20774#issuecomment-303841",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:14'>**Comment 14:**</a>
Yes, I agree with that fix for points. It looks like it was dropping the point if the 'next' poly in the basis was already 0. Your 'else' makes sure it keeps that point.



---

archive/issue_comments_303842.json:
```json
{
    "body": "<a id='comment:15'>**Comment 15:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4282a4ff695ae038c1b3268255e23f2f580af6c5\">4282a4f</a></td><td><code>20774: addressed small bug with point search</code></td></tr></table>\n",
    "created_at": "2016-06-14T20:08:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20774#issuecomment-303842",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:15'>**Comment 15:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4282a4ff695ae038c1b3268255e23f2f580af6c5">4282a4f</a></td><td><code>20774: addressed small bug with point search</code></td></tr></table>




---

archive/issue_comments_303843.json:
```json
{
    "body": "**Changing commit** from \"[bfcd05e6885d0f66ee55556deaf2dacc792a8c96](https://github.com/sagemath/sagetrac-mirror/commit/bfcd05e6885d0f66ee55556deaf2dacc792a8c96)\" to \"[4282a4ff695ae038c1b3268255e23f2f580af6c5](https://github.com/sagemath/sagetrac-mirror/commit/4282a4ff695ae038c1b3268255e23f2f580af6c5)\".",
    "created_at": "2016-06-14T20:08:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20774#issuecomment-303843",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[bfcd05e6885d0f66ee55556deaf2dacc792a8c96](https://github.com/sagemath/sagetrac-mirror/commit/bfcd05e6885d0f66ee55556deaf2dacc792a8c96)" to "[4282a4ff695ae038c1b3268255e23f2f580af6c5](https://github.com/sagemath/sagetrac-mirror/commit/4282a4ff695ae038c1b3268255e23f2f580af6c5)".



---

archive/issue_events_252927.json:
```json
{
    "actor": "https://github.com/sagetrac-gjorgenson",
    "created_at": "2016-06-14T20:10:03Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20774",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20774#event-252927"
}
```



---

archive/issue_events_252928.json:
```json
{
    "actor": "https://github.com/sagetrac-gjorgenson",
    "created_at": "2016-06-14T20:10:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20774",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20774#event-252928"
}
```



---

archive/issue_events_252929.json:
```json
{
    "actor": "https://github.com/bhutz",
    "created_at": "2016-06-14T21:04:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20774",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20774#event-252929"
}
```



---

archive/issue_events_252930.json:
```json
{
    "actor": "https://github.com/bhutz",
    "created_at": "2016-06-14T21:04:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20774",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20774#event-252930"
}
```



---

archive/issue_comments_303844.json:
```json
{
    "body": "<a id='comment:17'>**Comment 17:**</a>\nInterestingly the point issue came up in another ticket I was testing today as well. This fix also resolves those instances as well.\n\ntests pass and docs build for me.",
    "created_at": "2016-06-14T21:04:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20774#issuecomment-303844",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:17'>**Comment 17:**</a>
Interestingly the point issue came up in another ticket I was testing today as well. This fix also resolves those instances as well.

tests pass and docs build for me.



---

archive/issue_events_252931.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-06-15T18:47:25Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20774",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20774#event-252931"
}
```



---

archive/issue_events_252932.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "e484cb1c9744ec4f73093835f458232789d1609c",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2016-06-15T18:47:25Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/20774",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20774#event-252932"
}
```



---

archive/issue_comments_303845.json:
```json
{
    "body": "**Changing branch** from \"[u/gjorgenson/ticket/20774](https://github.com/sagemath/sagetrac-mirror/tree/u/gjorgenson/ticket/20774)\" to \"[4282a4ff695ae038c1b3268255e23f2f580af6c5](https://github.com/sagemath/sagetrac-mirror/commit/4282a4ff695ae038c1b3268255e23f2f580af6c5)\".",
    "created_at": "2016-06-15T18:47:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20774#issuecomment-303845",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/gjorgenson/ticket/20774](https://github.com/sagemath/sagetrac-mirror/tree/u/gjorgenson/ticket/20774)" to "[4282a4ff695ae038c1b3268255e23f2f580af6c5](https://github.com/sagemath/sagetrac-mirror/commit/4282a4ff695ae038c1b3268255e23f2f580af6c5)".
