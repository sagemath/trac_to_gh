# Issue 20463: Pari segfault on Sage startup in Cygwin (2)

archive/issues_020226.json:
```json
{
    "assignees": [],
    "body": "Due to a Cygwin bug https://cygwin.com/ml/cygwin/2016-05/msg00140.html there is a segmentation fault when the PARI maximum stack size is larger than 4GB.\n\nThe issue has also been reported to PARI: http://pari.math.u-bordeaux.fr/archives/pari-dev-1605/threads.html\n\nKeywords: **cygwin windows**\n\nBranch/Commit: **[`856f128`](https://github.com/sagemath/sagetrac-mirror/commit/856f128777c04a88e4efe6295e98292a2f0cc7e2)**\n\nUpstream: **Fixed upstream, in a later stable release.**\n\nReviewer: **Jeroen Demeyer**\n\nAuthor: **Erik Bray**\n\nComponent: **porting: Cygwin**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/20463_\n\n",
    "closed_at": "2016-09-10T09:00:27Z",
    "created_at": "2016-04-19T07:58:26Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20porting%3A%20cygwin",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/bug",
        "https://github.com/sagemath/sage/labels/c%3A%20porting%3A%20cygwin"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-7.3",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Pari segfault on Sage startup in Cygwin (2)",
    "type": "issue",
    "updated_at": "2016-09-10T09:00:27Z",
    "url": "https://github.com/sagemath/sage/issues/20463",
    "user": "https://github.com/embray"
}
```
Due to a Cygwin bug https://cygwin.com/ml/cygwin/2016-05/msg00140.html there is a segmentation fault when the PARI maximum stack size is larger than 4GB.

The issue has also been reported to PARI: http://pari.math.u-bordeaux.fr/archives/pari-dev-1605/threads.html

Keywords: **cygwin windows**

Branch/Commit: **[`856f128`](https://github.com/sagemath/sagetrac-mirror/commit/856f128777c04a88e4efe6295e98292a2f0cc7e2)**

Upstream: **Fixed upstream, in a later stable release.**

Reviewer: **Jeroen Demeyer**

Author: **Erik Bray**

Component: **porting: Cygwin**

_Issue created by migration from https://trac.sagemath.org/ticket/20463_





---

archive/issue_events_285888.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2016-04-19T07:58:26Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/20463",
    "milestone_number": null,
    "milestone_title": "sage-7.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20463#event-285888"
}
```



---

archive/issue_events_285889.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2016-04-19T07:58:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20463",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20porting%3A%20cygwin",
    "label_color": "0000b0",
    "label_name": "c: porting: cygwin",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20463#event-285889"
}
```



---

archive/issue_events_285890.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2016-04-19T07:58:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20463",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20463#event-285890"
}
```



---

archive/issue_events_285891.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2016-04-19T07:58:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20463",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20463#event-285891"
}
```



---

archive/issue_events_285892.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2016-05-12T13:47:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20463",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20463#event-285892"
}
```



---

archive/issue_comments_295294.json:
```json
{
    "body": "Author: **Erik Bray**",
    "created_at": "2016-05-12T13:47:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20463#issuecomment-295294",
    "user": "https://github.com/embray"
}
```

Author: **Erik Bray**



---

archive/issue_comments_295295.json:
```json
{
    "body": "Changed keywords from none to **cygwin windows**",
    "created_at": "2016-05-12T13:47:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20463#issuecomment-295295",
    "user": "https://github.com/embray"
}
```

Changed keywords from none to **cygwin windows**



---

archive/issue_comments_295296.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nI have discovered what I think is the cause of this issue, and have reported it upstream--I believe it to be an issue in Cygwin: https://cygwin.com/ml/cygwin/2016-05/msg00140.html\n\nI've attached a workaround for the issue from the Sage end.  I'm not terribly happy with it, because if I understand correctly PARI will automatically grow its stack size as needed, and if it grows beyond 4GB this bug *could* still occur (though I haven't tested this yet--anyone want to suggest to me a good way to test it?)\n\nI'm not sure how best to work around that though without completely taking over PARI's stack management.  Probably fine just to leave it as a known issue until there's a fix in Cygwin. It's more important that we don't immediately segfault as soon as the first PARI number is created.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d0ca39615c9d83ed76e9ab0916925b35d9131183\"><code>d0ca396</code></a></td><td><code>Workaround for Segfault during start up due to PARI's stack size being made too large for Cygwin (due to a bug in Cygwin; see http://trac.sagemath.org/ticket/20463)</code></td></tr></table>\n",
    "created_at": "2016-05-12T13:47:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20463#issuecomment-295296",
    "user": "https://github.com/embray"
}
```

<div id="comment:1" align="right">comment:1</div>

I have discovered what I think is the cause of this issue, and have reported it upstream--I believe it to be an issue in Cygwin: https://cygwin.com/ml/cygwin/2016-05/msg00140.html

I've attached a workaround for the issue from the Sage end.  I'm not terribly happy with it, because if I understand correctly PARI will automatically grow its stack size as needed, and if it grows beyond 4GB this bug *could* still occur (though I haven't tested this yet--anyone want to suggest to me a good way to test it?)

I'm not sure how best to work around that though without completely taking over PARI's stack management.  Probably fine just to leave it as a known issue until there's a fix in Cygwin. It's more important that we don't immediately segfault as soon as the first PARI number is created.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d0ca39615c9d83ed76e9ab0916925b35d9131183"><code>d0ca396</code></a></td><td><code>Workaround for Segfault during start up due to PARI's stack size being made too large for Cygwin (due to a bug in Cygwin; see http://trac.sagemath.org/ticket/20463)</code></td></tr></table>




---

archive/issue_comments_295297.json:
```json
{
    "body": "Branch: **[u/embray/pari-mmap-cygwin](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/pari-mmap-cygwin)**",
    "created_at": "2016-05-12T13:47:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20463#issuecomment-295297",
    "user": "https://github.com/embray"
}
```

Branch: **[u/embray/pari-mmap-cygwin](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/pari-mmap-cygwin)**



---

archive/issue_comments_295298.json:
```json
{
    "body": "Upstream: **Reported upstream. No feedback yet.**",
    "created_at": "2016-05-12T13:47:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20463#issuecomment-295298",
    "user": "https://github.com/embray"
}
```

Upstream: **Reported upstream. No feedback yet.**



---

archive/issue_comments_295299.json:
```json
{
    "body": "Commit: **[`d0ca396`](https://github.com/sagemath/sagetrac-mirror/commit/d0ca39615c9d83ed76e9ab0916925b35d9131183)**",
    "created_at": "2016-05-12T13:47:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20463#issuecomment-295299",
    "user": "https://github.com/embray"
}
```

Commit: **[`d0ca396`](https://github.com/sagemath/sagetrac-mirror/commit/d0ca39615c9d83ed76e9ab0916925b35d9131183)**



---

archive/issue_comments_295300.json:
```json
{
    "body": "<div id=\"comment:2\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fcc10fc6cebcfb92ac71207099f80fa120afb04d\"><code>fcc10fc</code></a></td><td><code>Workaround for Segfault during start up due to PARI's stack size being made too large for Cygwin (due to a bug in Cygwin; see http://trac.sagemath.org/ticket/20463)</code></td></tr></table>\n",
    "created_at": "2016-05-12T13:48:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20463#issuecomment-295300",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:2"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fcc10fc6cebcfb92ac71207099f80fa120afb04d"><code>fcc10fc</code></a></td><td><code>Workaround for Segfault during start up due to PARI's stack size being made too large for Cygwin (due to a bug in Cygwin; see http://trac.sagemath.org/ticket/20463)</code></td></tr></table>




---

archive/issue_comments_295301.json:
```json
{
    "body": "Changed commit from **[`d0ca396`](https://github.com/sagemath/sagetrac-mirror/commit/d0ca39615c9d83ed76e9ab0916925b35d9131183)** to **[`fcc10fc`](https://github.com/sagemath/sagetrac-mirror/commit/fcc10fc6cebcfb92ac71207099f80fa120afb04d)**",
    "created_at": "2016-05-12T13:48:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20463#issuecomment-295301",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`d0ca396`](https://github.com/sagemath/sagetrac-mirror/commit/d0ca39615c9d83ed76e9ab0916925b35d9131183)** to **[`fcc10fc`](https://github.com/sagemath/sagetrac-mirror/commit/fcc10fc6cebcfb92ac71207099f80fa120afb04d)**



---

archive/issue_comments_295302.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\n(Oops, had a typo in the original commit)",
    "created_at": "2016-05-12T13:49:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20463#issuecomment-295302",
    "user": "https://github.com/embray"
}
```

<div id="comment:3" align="right">comment:3</div>

(Oops, had a typo in the original commit)



---

archive/issue_comments_295303.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nReplying to [@embray](#comment%3A1):\n> if I understand correctly PARI will automatically grow its stack size as needed\n\nPARI will automatically grow its stack up to some user-provided maximum. The function is\n\n```\nparistack_setsize(size, vsize)       \n```\nwhere `size` is the actual size and `vsize` the maximum size.",
    "created_at": "2016-05-12T15:05:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20463#issuecomment-295303",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:4" align="right">comment:4</div>

Replying to [@embray](#comment%3A1):
> if I understand correctly PARI will automatically grow its stack size as needed

PARI will automatically grow its stack up to some user-provided maximum. The function is

```
paristack_setsize(size, vsize)       
```
where `size` is the actual size and `vsize` the maximum size.



---

archive/issue_comments_295304.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\n...which implies that the correct work-around for Cygwin is simply to limit the second argument of `paristack_setsize()`.",
    "created_at": "2016-05-12T15:06:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20463#issuecomment-295304",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:5" align="right">comment:5</div>

...which implies that the correct work-around for Cygwin is simply to limit the second argument of `paristack_setsize()`.



---

archive/issue_events_285893.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-05-12T15:06:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/20463",
    "milestone_number": null,
    "milestone_title": "sage-7.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20463#event-285893"
}
```



---

archive/issue_events_285894.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-05-12T15:06:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/20463",
    "milestone_number": null,
    "milestone_title": "sage-7.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20463#event-285894"
}
```



---

archive/issue_events_285895.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-05-12T15:06:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20463",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20463#event-285895"
}
```



---

archive/issue_events_285896.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-05-12T15:06:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20463",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20463#event-285896"
}
```



---

archive/issue_comments_295305.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nNote also that *not* calling `paristack_setsize()` is not really an option: you would end up with a small stack which cannot be increased. I'm pretty sure that some Sage functionality assumes a PARI stack which is larger than the default size.",
    "created_at": "2016-05-12T15:14:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20463#issuecomment-295305",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:6" align="right">comment:6</div>

Note also that *not* calling `paristack_setsize()` is not really an option: you would end up with a small stack which cannot be increased. I'm pretty sure that some Sage functionality assumes a PARI stack which is larger than the default size.



---

archive/issue_comments_295306.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nWe should probably also report this to upstream PARI (I guess the problem can be reproduced inside PARI/GP itself), such that they might apply the workaround.",
    "created_at": "2016-05-12T20:22:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20463#issuecomment-295306",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:7" align="right">comment:7</div>

We should probably also report this to upstream PARI (I guess the problem can be reproduced inside PARI/GP itself), such that they might apply the workaround.



---

archive/issue_comments_295307.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,5 +1 @@\n-This is the same issue as #11551, but as that issue was closed several years ago (with no satisfying resolution) it was suggested I open a new ticket.  The code has changed a little bit since then too.  Most notably as of [ade4f752](https://github.com/sagemath/sagetrac-mirror/compare/ade4f7521ad77c03e9791bc3768d9a9e3a2daca4...develop) there are no longer `bot`, `top` and `avma` global variables in `paridecl.pxi` (then `decl.pxi`).  Now there is a single struct `pari_mainstack` with these pointers as elements.  I don't think that makes an enormous difference though, but it does change the discussion somewhat.\n-\n-Otherwise the !Python/Cython level stacktrace is almost the same as before.  The segfault occurs on [this line](https://github.com/sagemath/sagetrac-mirror/blob/develop/src/sage/rings/real_mpfr.pyx?h=976c0f3d0f9f0ac744e535ea734dadf2e7918991#n3138) which I guess happens to be reached the first time any PARI object is created during import.  I haven't debugged deeper than that yet but I'm guessing it's the same issue as in the original ticket--that the PARI stack somehow hasn't been initialized yet.\n-\n-[Incidentally, one thing that did seem to work is cysignals--it caught the segfault and raised a Python exception for it. So I don't *think* cysignals is related here but I wouldn't necessarily rule it out either.]\n+Due to a Cygwin bug https://cygwin.com/ml/cygwin/2016-05/msg00140.html there is a segmentation fault when the PARI maximum stack size is larger than 4GB.\n``````\n",
    "created_at": "2016-05-13T09:13:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20463#issuecomment-295307",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,5 +1 @@
-This is the same issue as #11551, but as that issue was closed several years ago (with no satisfying resolution) it was suggested I open a new ticket.  The code has changed a little bit since then too.  Most notably as of [ade4f752](https://github.com/sagemath/sagetrac-mirror/compare/ade4f7521ad77c03e9791bc3768d9a9e3a2daca4...develop) there are no longer `bot`, `top` and `avma` global variables in `paridecl.pxi` (then `decl.pxi`).  Now there is a single struct `pari_mainstack` with these pointers as elements.  I don't think that makes an enormous difference though, but it does change the discussion somewhat.
-
-Otherwise the !Python/Cython level stacktrace is almost the same as before.  The segfault occurs on [this line](https://github.com/sagemath/sagetrac-mirror/blob/develop/src/sage/rings/real_mpfr.pyx?h=976c0f3d0f9f0ac744e535ea734dadf2e7918991#n3138) which I guess happens to be reached the first time any PARI object is created during import.  I haven't debugged deeper than that yet but I'm guessing it's the same issue as in the original ticket--that the PARI stack somehow hasn't been initialized yet.
-
-[Incidentally, one thing that did seem to work is cysignals--it caught the segfault and raised a Python exception for it. So I don't *think* cysignals is related here but I wouldn't necessarily rule it out either.]
+Due to a Cygwin bug https://cygwin.com/ml/cygwin/2016-05/msg00140.html there is a segmentation fault when the PARI maximum stack size is larger than 4GB.
``````




---

archive/issue_comments_295308.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nI was under the assumption that it would grow automatically as needed, but maybe I shouldn't assume that it works nicely....",
    "created_at": "2016-05-13T09:30:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20463#issuecomment-295308",
    "user": "https://github.com/embray"
}
```

<div id="comment:9" align="right">comment:9</div>

I was under the assumption that it would grow automatically as needed, but maybe I shouldn't assume that it works nicely....



---

archive/issue_comments_295309.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,3 @@\n Due to a Cygwin bug https://cygwin.com/ml/cygwin/2016-05/msg00140.html there is a segmentation fault when the PARI maximum stack size is larger than 4GB.\n+\n+The issue has also been reported to PARI: http://pari.math.u-bordeaux.fr/archives/pari-dev-1605/threads.html\n``````\n",
    "created_at": "2016-05-13T11:25:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20463#issuecomment-295309",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,3 @@
 Due to a Cygwin bug https://cygwin.com/ml/cygwin/2016-05/msg00140.html there is a segmentation fault when the PARI maximum stack size is larger than 4GB.
+
+The issue has also been reported to PARI: http://pari.math.u-bordeaux.fr/archives/pari-dev-1605/threads.html
``````




---

archive/issue_comments_295310.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nI have an update to this patch somewhere, I just haven't gotten around to pushing it yet.\n\nIn the meantime Cygwin has acknowledged the bug and pushed the fix.  I just confirmed that the fix seems to work (there's no segfault, at least): https://www.cygwin.com/ml/cygwin/2016-05/msg00240.html\n\nNot sure yet when the fix will be in a release.  I may update this to include a version check on Cygwin once it makes sense to.",
    "created_at": "2016-05-31T13:50:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20463#issuecomment-295310",
    "user": "https://github.com/embray"
}
```

<div id="comment:11" align="right">comment:11</div>

I have an update to this patch somewhere, I just haven't gotten around to pushing it yet.

In the meantime Cygwin has acknowledged the bug and pushed the fix.  I just confirmed that the fix seems to work (there's no segfault, at least): https://www.cygwin.com/ml/cygwin/2016-05/msg00240.html

Not sure yet when the fix will be in a release.  I may update this to include a version check on Cygwin once it makes sense to.



---

archive/issue_comments_295311.json:
```json
{
    "body": "Changed upstream from **Reported upstream. No feedback yet.** to **Fixed upstream, in a later stable release.**",
    "created_at": "2016-05-31T13:50:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20463#issuecomment-295311",
    "user": "https://github.com/embray"
}
```

Changed upstream from **Reported upstream. No feedback yet.** to **Fixed upstream, in a later stable release.**



---

archive/issue_comments_295312.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nPer [this commit](https://sourceware.org/git/gitweb.cgi?p=newlib-cygwin.git;a=blobdiff;f=winsup/cygwin/release/2.5.2;h=c60f0fc032e08ddbf3d5bb293afad10f777e7f06;hp=0ea77206faa62491b185f5a35200b389139548ed;hb=4e434bf223c301cd2690a3fe1cde2a84c0d5b624;hpb=0aa738220bb9dea2ad479e484560767b36701947), the fix for this should appear in Cygwin v2.5.2.",
    "created_at": "2016-05-31T13:53:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20463#issuecomment-295312",
    "user": "https://github.com/embray"
}
```

<div id="comment:12" align="right">comment:12</div>

Per [this commit](https://sourceware.org/git/gitweb.cgi?p=newlib-cygwin.git;a=blobdiff;f=winsup/cygwin/release/2.5.2;h=c60f0fc032e08ddbf3d5bb293afad10f777e7f06;hp=0ea77206faa62491b185f5a35200b389139548ed;hb=4e434bf223c301cd2690a3fe1cde2a84c0d5b624;hpb=0aa738220bb9dea2ad479e484560767b36701947), the fix for this should appear in Cygwin v2.5.2.



---

archive/issue_comments_295313.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nIf I were to put in a constant or function to get the Cygwin version (where relevant) where would be a good place to put that?  `sage.env`, maybe?",
    "created_at": "2016-05-31T14:00:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20463#issuecomment-295313",
    "user": "https://github.com/embray"
}
```

<div id="comment:13" align="right">comment:13</div>

If I were to put in a constant or function to get the Cygwin version (where relevant) where would be a good place to put that?  `sage.env`, maybe?



---

archive/issue_comments_295314.json:
```json
{
    "body": "<div id=\"comment:14\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7223ab0b303a84ee92932b83b5bc700a28552aa5\"><code>7223ab0</code></a></td><td><code>Instead of not setting the stack size at all, set it to a small size that should not trigger the bug.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d976c6d201a52d6edcfdcd6246a01bbda353a93d\"><code>d976c6d</code></a></td><td><code>Add a CYGWIN_VERSION variable to sage.env.  Use this to check both whether we're in Cygwin at all, and if its version requires this workaround.</code></td></tr></table>\n",
    "created_at": "2016-06-30T16:38:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20463#issuecomment-295314",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:14"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7223ab0b303a84ee92932b83b5bc700a28552aa5"><code>7223ab0</code></a></td><td><code>Instead of not setting the stack size at all, set it to a small size that should not trigger the bug.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d976c6d201a52d6edcfdcd6246a01bbda353a93d"><code>d976c6d</code></a></td><td><code>Add a CYGWIN_VERSION variable to sage.env.  Use this to check both whether we're in Cygwin at all, and if its version requires this workaround.</code></td></tr></table>




---

archive/issue_comments_295315.json:
```json
{
    "body": "Changed commit from **[`fcc10fc`](https://github.com/sagemath/sagetrac-mirror/commit/fcc10fc6cebcfb92ac71207099f80fa120afb04d)** to **[`d976c6d`](https://github.com/sagemath/sagetrac-mirror/commit/d976c6d201a52d6edcfdcd6246a01bbda353a93d)**",
    "created_at": "2016-06-30T16:38:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20463#issuecomment-295315",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`fcc10fc`](https://github.com/sagemath/sagetrac-mirror/commit/fcc10fc6cebcfb92ac71207099f80fa120afb04d)** to **[`d976c6d`](https://github.com/sagemath/sagetrac-mirror/commit/d976c6d201a52d6edcfdcd6246a01bbda353a93d)**



---

archive/issue_comments_295316.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nNow always calls `paristack_setsize()`, but to a smaller value on platforms with this issue.\n\nAlso added an explicit check on the cygwin version, and does not invoke the workaround for Cygwin v2.5.2 where this is fixed.",
    "created_at": "2016-06-30T16:39:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20463#issuecomment-295316",
    "user": "https://github.com/embray"
}
```

<div id="comment:15" align="right">comment:15</div>

Now always calls `paristack_setsize()`, but to a smaller value on platforms with this issue.

Also added an explicit check on the cygwin version, and does not invoke the workaround for Cygwin v2.5.2 where this is fixed.



---

archive/issue_events_285897.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2016-06-30T16:39:26Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20463",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20463#event-285897"
}
```



---

archive/issue_events_285898.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2016-06-30T16:39:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20463",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20463#event-285898"
}
```



---

archive/issue_comments_295317.json:
```json
{
    "body": "<div id=\"comment:17\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e06dd9513ff729b4e0f8baff35550512ca08f388\"><code>e06dd95</code></a></td><td><code>Cygwin version should be a tuple of ints, not strings</code></td></tr></table>\n",
    "created_at": "2016-07-27T09:07:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20463#issuecomment-295317",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:17"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e06dd9513ff729b4e0f8baff35550512ca08f388"><code>e06dd95</code></a></td><td><code>Cygwin version should be a tuple of ints, not strings</code></td></tr></table>




---

archive/issue_comments_295318.json:
```json
{
    "body": "Changed commit from **[`d976c6d`](https://github.com/sagemath/sagetrac-mirror/commit/d976c6d201a52d6edcfdcd6246a01bbda353a93d)** to **[`e06dd95`](https://github.com/sagemath/sagetrac-mirror/commit/e06dd9513ff729b4e0f8baff35550512ca08f388)**",
    "created_at": "2016-07-27T09:07:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20463#issuecomment-295318",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`d976c6d`](https://github.com/sagemath/sagetrac-mirror/commit/d976c6d201a52d6edcfdcd6246a01bbda353a93d)** to **[`e06dd95`](https://github.com/sagemath/sagetrac-mirror/commit/e06dd9513ff729b4e0f8baff35550512ca08f388)**



---

archive/issue_comments_295319.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nI would prefer something along the lines of\n\n```\nsizemax = mem.virtual_memory_limit() // 4\n\nif USING_BROKEN_VERSION_OF_CYGWIN and sizemax > KNOWN_WORKING_SIZE:\n    # Cygwin's mmap is broken for large mmaps (>~ 4GB):\n    # * https://trac.sagemath.org/ticket/20463\n    # * https://cygwin.com/ml/cygwin/2016-05/msg00140.html\n    #\n    # The underlying issue is fixed in Cygwin v2.5.2\n    sizemax = KNOWN_WORKING_SIZE\n\nparistack_setsize(size, sizemax)\n```",
    "created_at": "2016-07-27T10:34:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20463#issuecomment-295319",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:18" align="right">comment:18</div>

I would prefer something along the lines of

```
sizemax = mem.virtual_memory_limit() // 4

if USING_BROKEN_VERSION_OF_CYGWIN and sizemax > KNOWN_WORKING_SIZE:
    # Cygwin's mmap is broken for large mmaps (>~ 4GB):
    # * https://trac.sagemath.org/ticket/20463
    # * https://cygwin.com/ml/cygwin/2016-05/msg00140.html
    #
    # The underlying issue is fixed in Cygwin v2.5.2
    sizemax = KNOWN_WORKING_SIZE

paristack_setsize(size, sizemax)
```



---

archive/issue_events_285899.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-07-27T10:34:44Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20463",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20463#event-285899"
}
```



---

archive/issue_events_285900.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-07-27T10:34:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20463",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20463#event-285900"
}
```



---

archive/issue_comments_295320.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nThat's fine, but you don't literally mean `USING_BROKEN_VERSION_OF_CYGWIN` do you?  The explicit version check that's there is much clearer.",
    "created_at": "2016-07-27T11:00:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20463#issuecomment-295320",
    "user": "https://github.com/embray"
}
```

<div id="comment:19" align="right">comment:19</div>

That's fine, but you don't literally mean `USING_BROKEN_VERSION_OF_CYGWIN` do you?  The explicit version check that's there is much clearer.



---

archive/issue_comments_295321.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nNo, not literal. Replace `USING_BROKEN_VERSION_OF_CYGWIN` and `KNOWN_WORKING_SIZE` by whatever you want.",
    "created_at": "2016-07-27T12:29:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20463#issuecomment-295321",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:20" align="right">comment:20</div>

No, not literal. Replace `USING_BROKEN_VERSION_OF_CYGWIN` and `KNOWN_WORKING_SIZE` by whatever you want.



---

archive/issue_comments_295322.json:
```json
{
    "body": "Changed commit from **[`e06dd95`](https://github.com/sagemath/sagetrac-mirror/commit/e06dd9513ff729b4e0f8baff35550512ca08f388)** to **[`e89c838`](https://github.com/sagemath/sagetrac-mirror/commit/e89c838f485a03c25aa9b0d8ad532ab9bbfce3a0)**",
    "created_at": "2016-08-16T13:40:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20463#issuecomment-295322",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`e06dd95`](https://github.com/sagemath/sagetrac-mirror/commit/e06dd9513ff729b4e0f8baff35550512ca08f388)** to **[`e89c838`](https://github.com/sagemath/sagetrac-mirror/commit/e89c838f485a03c25aa9b0d8ad532ab9bbfce3a0)**



---

archive/issue_comments_295323.json:
```json
{
    "body": "<div id=\"comment:21\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e89c838f485a03c25aa9b0d8ad532ab9bbfce3a0\"><code>e89c838</code></a></td><td><code>Slight reordering to make it clearer that the Cygwin workaround is a special case, not the default.</code></td></tr></table>\n",
    "created_at": "2016-08-16T13:40:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20463#issuecomment-295323",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:21"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e89c838f485a03c25aa9b0d8ad532ab9bbfce3a0"><code>e89c838</code></a></td><td><code>Slight reordering to make it clearer that the Cygwin workaround is a special case, not the default.</code></td></tr></table>




---

archive/issue_events_285901.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2016-08-16T13:40:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20463",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20463#event-285901"
}
```



---

archive/issue_events_285902.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2016-08-16T13:40:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20463",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20463#event-285902"
}
```



---

archive/issue_comments_295324.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nYes, this is better.\n\nI just don't understand why you talk of a limit of 4GB but then use 1GB (actually0x3fffffff) in the code?",
    "created_at": "2016-08-16T14:17:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20463#issuecomment-295324",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:23" align="right">comment:23</div>

Yes, this is better.

I just don't understand why you talk of a limit of 4GB but then use 1GB (actually0x3fffffff) in the code?



---

archive/issue_events_285903.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-08-16T14:17:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20463",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20463#event-285903"
}
```



---

archive/issue_events_285904.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-08-16T14:17:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20463",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20463#event-285904"
}
```



---

archive/issue_comments_295325.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nTo be honest I'm not exactly sure why either, though I might have been at one time (it's not like I've really worked on this recently.  I know that for starters I was just going by how the default takes `mem.virtual_memory_limit() // 4` so I also divided by 4.  And then when I went much over that it still crashed so I just kept it at 1GB (minus 1)",
    "created_at": "2016-08-16T14:35:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20463#issuecomment-295325",
    "user": "https://github.com/embray"
}
```

<div id="comment:24" align="right">comment:24</div>

To be honest I'm not exactly sure why either, though I might have been at one time (it's not like I've really worked on this recently.  I know that for starters I was just going by how the default takes `mem.virtual_memory_limit() // 4` so I also divided by 4.  And then when I went much over that it still crashed so I just kept it at 1GB (minus 1)



---

archive/issue_comments_295326.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nReplying to [@embray](#comment%3A24):\n> I was just going by how the default takes `mem.virtual_memory_limit() // 4`\n\nThat division by 4 is simply to determine how much memory should be used. It is a totally arbitrary number and it should be unrelated to the limit on Cygwin.\n\nDid you run full doctests (`make ptestlong`) on Cygwin with this patch?",
    "created_at": "2016-08-16T14:44:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20463#issuecomment-295326",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:25" align="right">comment:25</div>

Replying to [@embray](#comment%3A24):
> I was just going by how the default takes `mem.virtual_memory_limit() // 4`

That division by 4 is simply to determine how much memory should be used. It is a totally arbitrary number and it should be unrelated to the limit on Cygwin.

Did you run full doctests (`make ptestlong`) on Cygwin with this patch?



---

archive/issue_comments_295327.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\n`make ptestlog` is kind of useless right now because many other tests are failing (though I'm closing to having them all fixed now).  That said, with this patch I haven't gotten any further segfaults from the Pari interface.\n\nI'll have to double check on the actual limit.  IIRC using just under 4 GB still didn't work, although possibly due to page alignment requirements, etc.  It's been a while since I experimented with it.  Another problem I remember having was there was a heisenbug where the pari interface segfaults *only* in gdb unless I remove the `paristack_setsize` call entirely.  Outside the debugger though it works.",
    "created_at": "2016-08-16T14:52:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20463#issuecomment-295327",
    "user": "https://github.com/embray"
}
```

<div id="comment:26" align="right">comment:26</div>

`make ptestlog` is kind of useless right now because many other tests are failing (though I'm closing to having them all fixed now).  That said, with this patch I haven't gotten any further segfaults from the Pari interface.

I'll have to double check on the actual limit.  IIRC using just under 4 GB still didn't work, although possibly due to page alignment requirements, etc.  It's been a while since I experimented with it.  Another problem I remember having was there was a heisenbug where the pari interface segfaults *only* in gdb unless I remove the `paristack_setsize` call entirely.  Outside the debugger though it works.



---

archive/issue_comments_295328.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nWould a limit of, say `0xf0000000` (3.75 GB) work?",
    "created_at": "2016-08-16T14:56:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20463#issuecomment-295328",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:27" align="right">comment:27</div>

Would a limit of, say `0xf0000000` (3.75 GB) work?



---

archive/issue_comments_295329.json:
```json
{
    "body": "Changed commit from **[`e89c838`](https://github.com/sagemath/sagetrac-mirror/commit/e89c838f485a03c25aa9b0d8ad532ab9bbfce3a0)** to **[`ef2f8f1`](https://github.com/sagemath/sagetrac-mirror/commit/ef2f8f1d5344552630c93301d5826d6e715c521e)**",
    "created_at": "2016-09-05T12:29:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20463#issuecomment-295329",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`e89c838`](https://github.com/sagemath/sagetrac-mirror/commit/e89c838f485a03c25aa9b0d8ad532ab9bbfce3a0)** to **[`ef2f8f1`](https://github.com/sagemath/sagetrac-mirror/commit/ef2f8f1d5344552630c93301d5826d6e715c521e)**



---

archive/issue_comments_295330.json:
```json
{
    "body": "<div id=\"comment:28\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ef2f8f1d5344552630c93301d5826d6e715c521e\"><code>ef2f8f1</code></a></td><td><code>Changed the max size to mmap to a little closer to 4GB.  Putting it at *right* under 4 GB (ex: 0xffffffff) still breaks things, possibly due to subtle alignment issues.  But this is good enough.  In any case the most important thing is it doesn't crash.</code></td></tr></table>\n",
    "created_at": "2016-09-05T12:29:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20463#issuecomment-295330",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:28"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ef2f8f1d5344552630c93301d5826d6e715c521e"><code>ef2f8f1</code></a></td><td><code>Changed the max size to mmap to a little closer to 4GB.  Putting it at *right* under 4 GB (ex: 0xffffffff) still breaks things, possibly due to subtle alignment issues.  But this is good enough.  In any case the most important thing is it doesn't crash.</code></td></tr></table>




---

archive/issue_comments_295331.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nConfirmed that `0xf0000000` works, so that's close enough.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ef2f8f1d5344552630c93301d5826d6e715c521e\"><code>ef2f8f1</code></a></td><td><code>Changed the max size to mmap to a little closer to 4GB.  Putting it at *right* under 4 GB (ex: 0xffffffff) still breaks things, possibly due to subtle alignment issues.  But this is good enough.  In any case the most important thing is it doesn't crash.</code></td></tr></table>\n",
    "created_at": "2016-09-05T12:29:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20463#issuecomment-295331",
    "user": "https://github.com/embray"
}
```

<div id="comment:29" align="right">comment:29</div>

Confirmed that `0xf0000000` works, so that's close enough.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ef2f8f1d5344552630c93301d5826d6e715c521e"><code>ef2f8f1</code></a></td><td><code>Changed the max size to mmap to a little closer to 4GB.  Putting it at *right* under 4 GB (ex: 0xffffffff) still breaks things, possibly due to subtle alignment issues.  But this is good enough.  In any case the most important thing is it doesn't crash.</code></td></tr></table>




---

archive/issue_events_285905.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2016-09-05T12:29:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20463",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20463#event-285905"
}
```



---

archive/issue_events_285906.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2016-09-05T12:29:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20463",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20463#event-285906"
}
```



---

archive/issue_comments_295332.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nThis comment does not really makes sense, I suggest to delete these 2 lines:\n\n```\n            # So we will just let the pari stack size grow as needed; if\n            # it grows beyond 4GB this issue could still be triggered\n```\nThe stack will only grow \"as needed\" up to the virtual stack size, which is at most `0xf0000000`.",
    "created_at": "2016-09-05T13:46:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20463#issuecomment-295332",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:30" align="right">comment:30</div>

This comment does not really makes sense, I suggest to delete these 2 lines:

```
            # So we will just let the pari stack size grow as needed; if
            # it grows beyond 4GB this issue could still be triggered
```
The stack will only grow "as needed" up to the virtual stack size, which is at most `0xf0000000`.



---

archive/issue_comments_295333.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nOh, you're right. That's from an older version of the patch where it wasn't setting a max stack size at all.",
    "created_at": "2016-09-06T07:54:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20463#issuecomment-295333",
    "user": "https://github.com/embray"
}
```

<div id="comment:31" align="right">comment:31</div>

Oh, you're right. That's from an older version of the patch where it wasn't setting a max stack size at all.



---

archive/issue_comments_295334.json:
```json
{
    "body": "Changed commit from **[`ef2f8f1`](https://github.com/sagemath/sagetrac-mirror/commit/ef2f8f1d5344552630c93301d5826d6e715c521e)** to **[`856f128`](https://github.com/sagemath/sagetrac-mirror/commit/856f128777c04a88e4efe6295e98292a2f0cc7e2)**",
    "created_at": "2016-09-06T07:58:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20463#issuecomment-295334",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`ef2f8f1`](https://github.com/sagemath/sagetrac-mirror/commit/ef2f8f1d5344552630c93301d5826d6e715c521e)** to **[`856f128`](https://github.com/sagemath/sagetrac-mirror/commit/856f128777c04a88e4efe6295e98292a2f0cc7e2)**



---

archive/issue_comments_295335.json:
```json
{
    "body": "<div id=\"comment:32\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/856f128777c04a88e4efe6295e98292a2f0cc7e2\"><code>856f128</code></a></td><td><code>Updated the comment on this to more accurately reflect what's going on</code></td></tr></table>\n",
    "created_at": "2016-09-06T07:58:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20463#issuecomment-295335",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:32"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/856f128777c04a88e4efe6295e98292a2f0cc7e2"><code>856f128</code></a></td><td><code>Updated the comment on this to more accurately reflect what's going on</code></td></tr></table>




---

archive/issue_comments_295336.json:
```json
{
    "body": "Reviewer: **Jeroen Demeyer**",
    "created_at": "2016-09-06T22:21:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20463#issuecomment-295336",
    "user": "https://github.com/jdemeyer"
}
```

Reviewer: **Jeroen Demeyer**



---

archive/issue_events_285907.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-09-06T22:21:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20463",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20463#event-285907"
}
```



---

archive/issue_events_285908.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-09-06T22:21:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/20463",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20463#event-285908"
}
```



---

archive/issue_comments_295337.json:
```json
{
    "body": "Changed branch from **[u/embray/pari-mmap-cygwin](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/pari-mmap-cygwin)** to **[`856f128`](https://github.com/sagemath/sagetrac-mirror/commit/856f128777c04a88e4efe6295e98292a2f0cc7e2)**",
    "created_at": "2016-09-10T09:00:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/20463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/20463#issuecomment-295337",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/embray/pari-mmap-cygwin](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/pari-mmap-cygwin)** to **[`856f128`](https://github.com/sagemath/sagetrac-mirror/commit/856f128777c04a88e4efe6295e98292a2f0cc7e2)**



---

archive/issue_events_285909.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-09-10T09:00:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/20463",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20463#event-285909"
}
```



---

archive/issue_events_285910.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "05ace733b28123e1b504193ee91ffa334e13c470",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2016-09-10T09:00:27Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/20463",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/20463#event-285910"
}
```
