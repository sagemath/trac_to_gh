# Issue 20228: Spectral radius of graphs

archive/issues_019991.json:
```json
{
    "body": "There are no current way to compute the spectral radius of a graph (the Perron-Frobenius eigenvalue of its adjacency matrix). We provide a method `spectral_radius` that provides an interval of floating approximations.\n\nIt is much faster than previously available methods (where the exact methods are unusable because of characteristic polynomial computation)\n\n```\nsage: G = digraphs.RandomDirectedGNM(10,40)\nsage: %timeit max(G.adjacency_matrix().charpoly().roots(AA, multiplicities=False))\n100 loops, best of 3: 6.23 ms per loop\nsage: %timeit G.spectral_radius()\n1000 loops, best of 3: 178 \u00b5s per loop\n```\nAnd for a larger graph\n\n```\nsage: G = digraphs.RandomDirectedGNM(400, 6000)\nsage: %timeit max(G.adjacency_matrix().charpoly().roots(AA, multiplicities=False))\n1 loop, best of 3: 4.63 s per loop\nsage: %timeit G.spectral_radius()\n10 loops, best of 3: 13 ms per loop\n```\nThe new method `spectral_radius` can be used for much larger graph as soon as the spectral gap is large enough to ensure the convergence.\n\nKeywords: days71\n\nBranch/Commit: 89f2c1043479a24fe7dc719a92501f9e38c3b0ae\n\nReviewer: Maurizio Monge\n\nAuthor: Vincent Delecroix\n\nDependencies: #20210\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/20228\n\n",
    "closed_at": "2016-03-23T12:46:46Z",
    "created_at": "2016-03-17T23:00:57Z",
    "labels": [
        "component: graph theory"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.2",
    "title": "Spectral radius of graphs",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/20228",
    "user": "https://github.com/videlec"
}
```
There are no current way to compute the spectral radius of a graph (the Perron-Frobenius eigenvalue of its adjacency matrix). We provide a method `spectral_radius` that provides an interval of floating approximations.

It is much faster than previously available methods (where the exact methods are unusable because of characteristic polynomial computation)

```
sage: G = digraphs.RandomDirectedGNM(10,40)
sage: %timeit max(G.adjacency_matrix().charpoly().roots(AA, multiplicities=False))
100 loops, best of 3: 6.23 ms per loop
sage: %timeit G.spectral_radius()
1000 loops, best of 3: 178 Âµs per loop
```
And for a larger graph

```
sage: G = digraphs.RandomDirectedGNM(400, 6000)
sage: %timeit max(G.adjacency_matrix().charpoly().roots(AA, multiplicities=False))
1 loop, best of 3: 4.63 s per loop
sage: %timeit G.spectral_radius()
10 loops, best of 3: 13 ms per loop
```
The new method `spectral_radius` can be used for much larger graph as soon as the spectral gap is large enough to ensure the convergence.

Keywords: days71

Branch/Commit: 89f2c1043479a24fe7dc719a92501f9e38c3b0ae

Reviewer: Maurizio Monge

Author: Vincent Delecroix

Dependencies: #20210

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/20228





---

archive/issue_comments_275015.json:
```json
{
    "body": "<a id='comment:1'></a>New commits:",
    "created_at": "2016-03-17T23:01:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20228#issuecomment-275015",
    "user": "https://github.com/videlec"
}
```

<a id='comment:1'></a>New commits:



---

archive/issue_comments_275016.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-03-17T23:01:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20228#issuecomment-275016",
    "user": "https://github.com/videlec"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_275017.json:
```json
{
    "body": "<a id='comment:3'></a>Is there a reason for not using Sage's interval arithmetic?\nhttp://doc.sagemath.org/html/en/reference/rings_numerical/sage/rings/real_mpfi.html\nSage's interval library is already taking care of lowlevel floating point rounding problems, and could remove complexity from the function.\nApart from this everything looks fine.",
    "created_at": "2016-03-21T14:38:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20228#issuecomment-275017",
    "user": "https://trac.sagemath.org/admin/accounts/users/maurimo"
}
```

<a id='comment:3'></a>Is there a reason for not using Sage's interval arithmetic?
http://doc.sagemath.org/html/en/reference/rings_numerical/sage/rings/real_mpfi.html
Sage's interval library is already taking care of lowlevel floating point rounding problems, and could remove complexity from the function.
Apart from this everything looks fine.



---

archive/issue_comments_275018.json:
```json
{
    "body": "Changing keywords from \"\" to \"days71\".",
    "created_at": "2016-03-21T14:38:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20228#issuecomment-275018",
    "user": "https://trac.sagemath.org/admin/accounts/users/maurimo"
}
```

Changing keywords from "" to "days71".



---

archive/issue_comments_275019.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2016-03-21T14:38:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20228#issuecomment-275019",
    "user": "https://trac.sagemath.org/admin/accounts/users/maurimo"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_275020.json:
```json
{
    "body": "<a id='comment:4'></a>Hello Maurizio,\n\nThanks for having a look!\n\nInterval arithmetic does not use machine floating point but [mpfr](http://www.mpfr.org/). It would be much slower than the version I wrote. This would only be a constant time slower which on my computer seems to be a factor `x8`. The intended application of this method is for huge sparse graphs (let say with `~1000000` vertices) and a `x8` speedup is not negligible. Similarly, I could have used ball arithmetic [arb](http://fredrikj.net/arb/) which is also shipped with Sage (and should be faster than interval arithmetic).\n\nMoreover, it is a certain amount of work to write `matrix/vector` code using either `mpir` or `arb`. Using `mpir` or `arb` would also decrease readability since multiplying numbers with `mpfr` is done via `mpfr_mul(x, a, b, MPFR_RNDN)` which is much less readable than `x = a*b`. Though the approach using either mpir or arb would have the advantage of making available higher precision. This would indeed be interesting for small graphs.\n\nOn the other hand, the function I made is written in C. It is not reasonable to use the Cython wrapper we have in Sage as allocating/deallocating million of Python classes is expensive.\n\nThe only thing that can easily be done would be to return an element in `RIF` instead of a tuple of Python float.\n\nWhat I wrote is not the \"best and fastest algorithm\" to get the Perron-Frobenius eigenvalue. For example, it suffers from slow convergence in absence of spectral gap. But it was very helpful to me and might as well be helpful for others. I consider than having an arbitrary precision version using `mpfr`, `mpir` or `arb` would be indeed good for another ticket. It will need some care because you want to increase slowly the precision (it makes no sense to use the full precision on the first iterations). Moreover, it is not immediate to determine what is the precision needed for the computation to obtain a given precision for the answer.\n\nI need to fix a mistake (the condition in the loop should be `(e_max - e_min) > e_max * c_prec` instead of `e_max * (e_max - e_min) > c_prec`). I would also like to move the `sage_free` inside the `finally` block (to avoid unfreed memory). I am waiting for your comments before submitting the commit.",
    "created_at": "2016-03-21T15:23:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20228#issuecomment-275020",
    "user": "https://github.com/videlec"
}
```

<a id='comment:4'></a>Hello Maurizio,

Thanks for having a look!

Interval arithmetic does not use machine floating point but [mpfr](http://www.mpfr.org/). It would be much slower than the version I wrote. This would only be a constant time slower which on my computer seems to be a factor `x8`. The intended application of this method is for huge sparse graphs (let say with `~1000000` vertices) and a `x8` speedup is not negligible. Similarly, I could have used ball arithmetic [arb](http://fredrikj.net/arb/) which is also shipped with Sage (and should be faster than interval arithmetic).

Moreover, it is a certain amount of work to write `matrix/vector` code using either `mpir` or `arb`. Using `mpir` or `arb` would also decrease readability since multiplying numbers with `mpfr` is done via `mpfr_mul(x, a, b, MPFR_RNDN)` which is much less readable than `x = a*b`. Though the approach using either mpir or arb would have the advantage of making available higher precision. This would indeed be interesting for small graphs.

On the other hand, the function I made is written in C. It is not reasonable to use the Cython wrapper we have in Sage as allocating/deallocating million of Python classes is expensive.

The only thing that can easily be done would be to return an element in `RIF` instead of a tuple of Python float.

What I wrote is not the "best and fastest algorithm" to get the Perron-Frobenius eigenvalue. For example, it suffers from slow convergence in absence of spectral gap. But it was very helpful to me and might as well be helpful for others. I consider than having an arbitrary precision version using `mpfr`, `mpir` or `arb` would be indeed good for another ticket. It will need some care because you want to increase slowly the precision (it makes no sense to use the full precision on the first iterations). Moreover, it is not immediate to determine what is the precision needed for the computation to obtain a given precision for the answer.

I need to fix a mistake (the condition in the loop should be `(e_max - e_min) > e_max * c_prec` instead of `e_max * (e_max - e_min) > c_prec`). I would also like to move the `sage_free` inside the `finally` block (to avoid unfreed memory). I am waiting for your comments before submitting the commit.



---

archive/issue_comments_275021.json:
```json
{
    "body": "Changing status from needs_info to needs_work.",
    "created_at": "2016-03-21T15:35:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20228#issuecomment-275021",
    "user": "https://trac.sagemath.org/admin/accounts/users/maurimo"
}
```

Changing status from needs_info to needs_work.



---

archive/issue_comments_275022.json:
```json
{
    "body": "<a id='comment:5'></a>Hi Vincent,\nSure, yours is a really good reason. When you fix the mistakes you are talking about you have my approval for the patch.",
    "created_at": "2016-03-21T15:35:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20228#issuecomment-275022",
    "user": "https://trac.sagemath.org/admin/accounts/users/maurimo"
}
```

<a id='comment:5'></a>Hi Vincent,
Sure, yours is a really good reason. When you fix the mistakes you are talking about you have my approval for the patch.



---

archive/issue_comments_275023.json:
```json
{
    "body": "<a id='comment:6'></a>Replying to [comment:5 maurimo]:\n> Hi Vincent,\n> Sure, yours is a really good reason. When you fix the mistakes you are talking about you have my approval for the patch.\n\n\nNope. The mistakes have to be fixed. It was about the rest. For example, I am not sure whether it makes more sense to return a pair of `float` or an element of `RIF` (the standard field for interval arithmetic).",
    "created_at": "2016-03-21T15:38:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20228#issuecomment-275023",
    "user": "https://github.com/videlec"
}
```

<a id='comment:6'></a>Replying to [comment:5 maurimo]:
> Hi Vincent,
> Sure, yours is a really good reason. When you fix the mistakes you are talking about you have my approval for the patch.


Nope. The mistakes have to be fixed. It was about the rest. For example, I am not sure whether it makes more sense to return a pair of `float` or an element of `RIF` (the standard field for interval arithmetic).



---

archive/issue_comments_275024.json:
```json
{
    "body": "<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-03-21T15:50:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20228#issuecomment-275024",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_275025.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-03-21T15:51:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20228#issuecomment-275025",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_275026.json:
```json
{
    "body": "<a id='comment:9'></a>Well,\nIn my opinion a pair of float is fine, if you are not using intervals internally we can avoid an unnecessary dependency, a user can easily create an interval from the float pair if necessary.\nWaiting for your last word, and I will accept your patch.",
    "created_at": "2016-03-21T17:20:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20228#issuecomment-275026",
    "user": "https://trac.sagemath.org/admin/accounts/users/maurimo"
}
```

<a id='comment:9'></a>Well,
In my opinion a pair of float is fine, if you are not using intervals internally we can avoid an unnecessary dependency, a user can easily create an interval from the float pair if necessary.
Waiting for your last word, and I will accept your patch.



---

archive/issue_comments_275027.json:
```json
{
    "body": "<a id='comment:10'></a>I have nothing to add. Thanks.",
    "created_at": "2016-03-21T17:40:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20228#issuecomment-275027",
    "user": "https://github.com/videlec"
}
```

<a id='comment:10'></a>I have nothing to add. Thanks.



---

archive/issue_comments_275028.json:
```json
{
    "body": "<a id='comment:11'></a>There is a conflict with #20210. I need to rebase this ticket over it.",
    "created_at": "2016-03-21T17:43:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20228#issuecomment-275028",
    "user": "https://github.com/videlec"
}
```

<a id='comment:11'></a>There is a conflict with #20210. I need to rebase this ticket over it.



---

archive/issue_comments_275029.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-03-21T17:43:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20228#issuecomment-275029",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_events_054955.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2016-03-21T17:46:49Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/20228",
    "milestone": "sage-7.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20228#event-54955"
}
```



---

archive/issue_comments_275030.json:
```json
{
    "body": "<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-03-21T18:53:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20228#issuecomment-275030",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_275031.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-03-21T18:53:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20228#issuecomment-275031",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_275032.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-03-22T14:15:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20228#issuecomment-275032",
    "user": "https://trac.sagemath.org/admin/accounts/users/maurimo"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_054956.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-03-23T12:46:46Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/20228",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20228#event-54956"
}
```



---

archive/issue_comments_275033.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-03-23T12:46:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20228#issuecomment-275033",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
