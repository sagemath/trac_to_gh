# Issue 34016: Add discrete logarithm for anomalous elliptic curves

archive/issues_034016.json:
```json
{
    "body": "Keywords: p-adic discrete logarithm\n\nA fast method to solve the discrete logarithm in anomalous elliptic curves uses the p-adic logarithm as described in: https://link.springer.com/article/10.1007/s001459900052. I implemented the algorithm based on https://crypto.stackexchange.com/questions/70454/why-smarts-attack-doesnt-work-on-this-ecdlp/70508#70508 for `EllipticCurvePoint_finite_field`\n\nIssue created by migration from https://trac.sagemath.org/ticket/34253\n\n",
    "created_at": "2022-07-31T13:59:31Z",
    "labels": [
        "component: number theory",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.7",
    "title": "Add discrete logarithm for anomalous elliptic curves",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/34016",
    "user": "https://github.com/sylvainpelissier"
}
```
Keywords: p-adic discrete logarithm

A fast method to solve the discrete logarithm in anomalous elliptic curves uses the p-adic logarithm as described in: https://link.springer.com/article/10.1007/s001459900052. I implemented the algorithm based on https://crypto.stackexchange.com/questions/70454/why-smarts-attack-doesnt-work-on-this-ecdlp/70508#70508 for `EllipticCurvePoint_finite_field`

Issue created by migration from https://trac.sagemath.org/ticket/34253





---

archive/issue_comments_482193.json:
```json
{
    "body": "Thanks for writing this code, it looks very nice! A few comments:\n\n- The test\n\n```diff\n+        if E.order() == E.base().order():\n```\n\n  can be very expensive if the order of the curve hasn't been computed yet. (Not a very common scenario, but possible by using `.set_order()` on points.)\n  Suggestion: Replace by\n\n```python\nn == E.base_field().cardinality()\n```\n\n  or something like that.\n\n- If I remember correctly, `E.formal_group().log()` is another way to construct the power series underlying this mapping. Perhaps we should add `SEEALSO` cross-references, and/or reuse that method (assuming it doesn't make things slower or otherwise worse)?\n\n- Here\n\n```diff\n+        For anomalous curves with `#E = p`, the `padic_elliptic_logarithm`\n```\n\n  you can use the syntax\n\n```\n:meth:`padic_elliptic_logarithm`\n```\n\n   to turn the `padic_elliptic_logarithm` reference into a link in the HTML documentation.\n\n- This change\n\n```diff\n-        EXAMPLES::\n+        EXAMPLES:\n\n             sage: F = GF((3,6),'a')\n```\n\n  is incorrect; the documentation format requires a double colon before an indented block.",
    "created_at": "2022-08-02T03:46:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34016",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34016#issuecomment-482193",
    "user": "https://github.com/yyyyx4"
}
```

Thanks for writing this code, it looks very nice! A few comments:

- The test

```diff
+        if E.order() == E.base().order():
```

  can be very expensive if the order of the curve hasn't been computed yet. (Not a very common scenario, but possible by using `.set_order()` on points.)
  Suggestion: Replace by

```python
n == E.base_field().cardinality()
```

  or something like that.

- If I remember correctly, `E.formal_group().log()` is another way to construct the power series underlying this mapping. Perhaps we should add `SEEALSO` cross-references, and/or reuse that method (assuming it doesn't make things slower or otherwise worse)?

- Here

```diff
+        For anomalous curves with `#E = p`, the `padic_elliptic_logarithm`
```

  you can use the syntax

```
:meth:`padic_elliptic_logarithm`
```

   to turn the `padic_elliptic_logarithm` reference into a link in the HTML documentation.

- This change

```diff
-        EXAMPLES::
+        EXAMPLES:

             sage: F = GF((3,6),'a')
```

  is incorrect; the documentation format requires a double colon before an indented block.



---

archive/issue_comments_482194.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-02T07:56:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34016",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34016#issuecomment-482194",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_482195.json:
```json
{
    "body": "Thank you for your remarks they are helpful. I corrected everything expect the one related to `E.formal_group().log()`. I would need more time to test and understand if it works the same way or bring improvements.",
    "created_at": "2022-08-02T08:01:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34016",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34016#issuecomment-482195",
    "user": "https://github.com/sylvainpelissier"
}
```

Thank you for your remarks they are helpful. I corrected everything expect the one related to `E.formal_group().log()`. I would need more time to test and understand if it works the same way or bring improvements.



---

archive/issue_comments_482196.json:
```json
{
    "body": "Looks good.\n\nOne last thing: Much of the new code is a slightly modified version of [https://crypto.stackexchange.com/a/70508](https://crypto.stackexchange.com/a/70508), so we must give proper attribution in the docstring (e.g., in the `AUTHORS` or the `ALGORITHM` part).",
    "created_at": "2022-08-03T02:09:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34016",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34016#issuecomment-482196",
    "user": "https://github.com/yyyyx4"
}
```

Looks good.

One last thing: Much of the new code is a slightly modified version of [https://crypto.stackexchange.com/a/70508](https://crypto.stackexchange.com/a/70508), so we must give proper attribution in the docstring (e.g., in the `AUTHORS` or the `ALGORITHM` part).



---

archive/issue_comments_482197.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-03T05:51:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34016",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34016#issuecomment-482197",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_482198.json:
```json
{
    "body": "Yes you are right. This should be fine now.",
    "created_at": "2022-08-03T05:52:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34016",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34016#issuecomment-482198",
    "user": "https://github.com/sylvainpelissier"
}
```

Yes you are right. This should be fine now.



---

archive/issue_comments_482199.json:
```json
{
    "body": "Here's an example for which this branch fails to compute `.discrete_log()`:\n\n\n```sage\nsage: R.<x> = ZZ[]\nsage: F.<i> = GF(787^2, modulus=x^2+1)\nsage: E = EllipticCurve([268*i + 507, 42*i + 772])\n```\n\n\nYou could either add an `.is_prime_field()` check, or (better) generalize the code to non-prime finite fields.\n\n(By the way, you should set the ticket to \"needs review\" once it's ready from your perspective. I looked at this anyway because I didn't notice it was still \"new\", but in general you will only attract reviewers by setting the correct status.)",
    "created_at": "2022-08-04T07:50:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34016",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34016#issuecomment-482199",
    "user": "https://github.com/yyyyx4"
}
```

Here's an example for which this branch fails to compute `.discrete_log()`:


```sage
sage: R.<x> = ZZ[]
sage: F.<i> = GF(787^2, modulus=x^2+1)
sage: E = EllipticCurve([268*i + 507, 42*i + 772])
```


You could either add an `.is_prime_field()` check, or (better) generalize the code to non-prime finite fields.

(By the way, you should set the ticket to "needs review" once it's ready from your perspective. I looked at this anyway because I didn't notice it was still "new", but in general you will only attract reviewers by setting the correct status.)



---

archive/issue_comments_482200.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-04T17:00:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34016",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34016#issuecomment-482200",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_482201.json:
```json
{
    "body": "I've added the primality test. I have to figure out how to handle the non prime field case. Do you want me to open another ticket for that ?",
    "created_at": "2022-08-04T17:05:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34016",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34016#issuecomment-482201",
    "user": "https://github.com/sylvainpelissier"
}
```

I've added the primality test. I have to figure out how to handle the non prime field case. Do you want me to open another ticket for that ?



---

archive/issue_comments_482202.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-08-04T17:07:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34016",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34016#issuecomment-482202",
    "user": "https://github.com/sylvainpelissier"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_482203.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-04T17:16:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34016",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34016#issuecomment-482203",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_482204.json:
```json
{
    "body": "I think this is incorrect for non-anomalous curves over prime fields: In that case, the first `if` holds (so the `elif` branches are skipped), but for a non-cyclic group we do still have to run the pairing check to ensure there's a solution.\n\nGiven that the prime case is already working and useful on its own, I think the non-prime case should go into a new ticket.",
    "created_at": "2022-08-05T07:36:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34016",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34016#issuecomment-482204",
    "user": "https://github.com/yyyyx4"
}
```

I think this is incorrect for non-anomalous curves over prime fields: In that case, the first `if` holds (so the `elif` branches are skipped), but for a non-cyclic group we do still have to run the pairing check to ensure there's a solution.

Given that the prime case is already working and useful on its own, I think the non-prime case should go into a new ticket.



---

archive/issue_comments_482205.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-05T15:36:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34016",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34016#issuecomment-482205",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_482206.json:
```json
{
    "body": "Good catch thank you. It is corrected.",
    "created_at": "2022-08-05T15:37:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34016",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34016#issuecomment-482206",
    "user": "https://github.com/sylvainpelissier"
}
```

Good catch thank you. It is corrected.



---

archive/issue_comments_482207.json:
```json
{
    "body": "Thanks!",
    "created_at": "2022-08-06T01:01:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34016",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34016#issuecomment-482207",
    "user": "https://github.com/yyyyx4"
}
```

Thanks!



---

archive/issue_comments_482208.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-08-06T01:01:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34016",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34016#issuecomment-482208",
    "user": "https://github.com/yyyyx4"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_482209.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-08-07T22:55:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34016",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34016#issuecomment-482209",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_089294.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-08-07T22:55:24Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/34016",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/34016#event-89294"
}
```
