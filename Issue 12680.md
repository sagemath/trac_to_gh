# Issue 12680: dashed arrows have arrowheads that are not solid

Issue created by migration from https://trac.sagemath.org/ticket/12852

Original creator: jason

Original creation time: 2012-04-17 19:02:27

Assignee: jason, was

CC:  kcrisman mjo ppurka

Right now, if you have a dashed arrow, the arrowhead is also drawn with a dashed linestyle, which really looks bad.  Compare before and after for `arrow((0,0), (1,1), linestyle='dashed')`.

This code works around a design issue in matplotlib. Currently, the specified linestyle is used to draw both the path and the arrowhead.  If linestyle is 'dashed', this looks really odd.  This code is from Jae-Joon Lee in response to a post to the matplotlib mailing list.  See http://sourceforge.net/mailarchive/forum.php?thread_name=CAG%3DuJ%2Bnw2dE05P9TOXTz_zp-mGP3cY801vMH7yt6vgP9_WzU8w%40mail.gmail.com&forum_name=matplotlib-users


---

Attachment


---

Comment by jason created at 2012-04-17 19:07:06

I'm not sure how to do a doctest for this one, since we can't check graphical output.


---

Comment by kcrisman created at 2012-04-18 01:06:28

Will this cause our coverage to go down?  Will it still accept all other optional arguments this way?

Doctest is not a problem; we just add a dashed arrow to the docs somewhere as a test.  People should be checking the visual output in the "live" notebook in any case upon big changes in graphics handling.

I don't have enough familiarity with mpl to review this quickly, I'm sorry.  I'm a little puzzled why it needs to be so big, but I guess it's hard to access just the arrowhead?


---

Comment by jason created at 2012-04-18 01:13:15

I don't *think* it will cause doctest coverage to go down since it's a class inside of a function.  It should accept all other optional arguments.  Jae-Joon (one of the core matplotlib developers) is just using advanced functionality inside matplotlib that allows someone to modify how it draws things.  The reason it needs to be so big is to work around a design issue in matplotlib.  The cleanest fix is to fix matplotlib, but that isn't very easy because you have to change its design.  I'm putting the patch here because I plan to apply it to my own server, and it might be good enough to go into Sage (as it does fix an ugly problem), and I don't have time to try to make the change to matplotlib and push that change there.


---

Comment by jason created at 2012-04-18 01:13:15

Changing status from new to needs_review.


---

Comment by jason created at 2012-04-18 01:13:57

Changing status from needs_review to needs_work.


---

Comment by jason created at 2012-04-18 01:13:57

(hence I'm setting it to needs work, as it probably at least needs a TESTS doctest explaining what is going on (that the arrowhead is solid even if the linestyle is dashed).


---

Comment by mjo created at 2012-04-18 02:53:16

Kind of lame, but hoping to make up for it with clever points:


```
sage: dashed = arrow((0,0), (1,1), linestyle='dashed')
sage: dashed.show(filename='dashed.eps')
```


The EPS format calls `[6 6] 0 setdash` to enable the dashes, and `[] 0 setdash` to disable them. Before the patch, we enable the dashes, stroke two objects, and then disable them:


```
gantu ~ $ cat dashed.eps | tr '\n' ' ' | grep -P -q 'setdash.*stroke.*stroke.*setdash'
gantu ~ $ echo $?
0
```


After the patch, we enable the dashes, stroke one object, and then disable the dashes:


```
gantu ~ $ cat dashed-patched.eps | tr '\n' ' ' | grep -P -q 'setdash.*stroke.*stroke.*setdash'
gantu ~ $ echo $?
1
```



---

Comment by kcrisman created at 2012-04-18 14:03:29

Interesting!  Perhaps one could then call system things from Python to check it... but then one would have to use a temp file of the Sage type to make this legit.


---

Comment by mjo created at 2012-04-18 14:49:50

Sure, this works.


---

Comment by mjo created at 2012-09-03 13:50:22

Changing status from needs_work to needs_review.


---

Comment by kcrisman created at 2013-06-12 20:53:01

Needs rebasing.


---

Comment by kcrisman created at 2013-06-12 21:03:13

I can confirm that Michael's patch documents this properly (we should totally use this trick in the future to document other plot fixes, if possible...), and that the arrowheads look nice now and that the eps files at any rate really do change properly (who knows about other formats).  But I don't feel comfortable reviewing Jae-Joon's code.  Jason, can you (or Michael) do that?


---

Comment by kcrisman created at 2013-06-12 21:05:15

Changing status from needs_review to positive_review.


---

Comment by kcrisman created at 2013-06-12 21:05:15

In fact, I assume Jason is okay with that other code...


---

Comment by jason created at 2013-06-12 21:10:24

I think that's a safe assumption, since I put Jae-Joon's code up here and at least once applied it to my own server.


---

Comment by jdemeyer created at 2013-06-14 07:06:56

The review patch doesn't apply:

```
applying /release/merger/patches/trac_12852-dashedarrows.patch
applying /release/merger/patches/sage-trac_12852-review.patch
patching file sage/plot/arrow.py
Hunk #2 FAILED at 300
1 out of 2 hunks FAILED -- saving rejects to file sage/plot/arrow.py.rej
abort: patch failed to apply
```



---

Comment by jdemeyer created at 2013-06-14 07:06:56

Changing status from positive_review to needs_work.


---

Comment by kcrisman created at 2013-06-14 12:08:45

Thanks for the reminder; I even said needs rebasing above.  I guess I never actually rebased it?  Oh, I did but didn't actually post it.  Coming up.


---

Comment by kcrisman created at 2013-06-14 12:10:55

Patchbot, apply trac_12852-dashedarrows.patch and trac_12852-review-rebase.patch


---

Comment by kcrisman created at 2013-06-14 12:10:55

Changing status from needs_work to positive_review.


---

Comment by jdemeyer created at 2013-06-14 12:12:31

Would you mind using the new `....:` doctest continuation instead of `...`?


---

Comment by jdemeyer created at 2013-06-14 12:14:34

Also, you should use

```
tmp_filename(ext=".eps")
```

instead of

```
os.path.join(SAGE_TMP, 'arrow.eps')
```



---

Comment by kcrisman created at 2013-06-14 12:20:01

> Would you mind using the new `....:` doctest continuation instead of `...`?
Well, it's not _my_ review patch :-) but I can.  I see that it's now in the developer guide, but it would have been helpful to send an email to sage-devel about this.  Also, note that the example immediately above where this is encouraged still has the "old-style" continuation.
> Also, you should use
Same comment, though I don't think we deprecated `SAGE_TMP` yet, did we?

Anyway, coming right up.


---

Comment by jdemeyer created at 2013-06-14 12:25:23

Replying to [comment:20 kcrisman]:
> it would have been helpful to send an email to sage-devel about this.
I'm pretty sure I did that...

> Same comment, though I don't think we deprecated `SAGE_TMP` yet, did we?
No, and it's not clear that we should do this. In some (rare) cases, it might be needed to access `SAGE_TMP` directly. Also it would imply changing all places where `SAGE_TMP` is still used.


---

Comment by jdemeyer created at 2013-06-14 12:28:01

`SAGE_TMP` is nowhere mentioned in the Develop's Guide, while `tmp_filename()` is mentioned in [http://sagemath.org/doc/developer/conventions.html#further-conventions-for-automated-testing-of-examples](http://sagemath.org/doc/developer/conventions.html#further-conventions-for-automated-testing-of-examples)


---

Attachment


---

Comment by kcrisman created at 2013-06-14 14:02:20

Should be all set.

Where did the original review patch go?  Are we in the habit of deleting patches now?  I've never seen this before... sometimes I wish I could delete my _own_ patches, but I can't even do that :-)


---

Comment by jdemeyer created at 2013-06-14 14:11:43

Replying to [comment:23 kcrisman]:
> Where did the original review patch go?
I removed it in order to avoid possible confusion, but perhaps I should not have done that.


---

Comment by mjo created at 2013-06-14 14:57:26

After a year of needs_review you guys decide to work on this while I'm out of the office huh? Anything left you need me to do?


---

Comment by kcrisman created at 2013-06-14 15:15:26

> After a year of needs_review you guys decide to work on this while I'm out of the office huh? Anything left you need me to do?
Well, it just depends on when one has time :-) and I just tried it out, it needed rebasing, and I had some time...


---

Comment by jdemeyer created at 2013-06-19 12:24:35

Resolution: fixed
