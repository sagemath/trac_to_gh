# Issue 20578: libbraiding as an optional package.

Issue created by migration from https://trac.sagemath.org/ticket/20815

Original creator: mmarco

Original creation time: 2016-06-12 10:44:15

CC:  kcrisman amitjamadagni fugelde tscrim jdemeyer

braiding[1] is a C++ program writen by Juan Gonzalez-Meneses to compute several properties of braids. Specially related to the conjugacy problem in the braid group.

I did a fork of it to convert it into a shared library[2].

The cython interface, and the methods in the braid groups will be handled in other tickets.


---

Attachment


---

Comment by mmarco created at 2016-06-12 11:06:26

Changing status from new to needs_review.


---

Comment by mmarco created at 2016-06-12 11:06:26

New commits:


---

Comment by tscrim created at 2016-06-12 17:15:19

From what we did with libhomfly, I felt that it would have been better to do everything on one ticket. That way we could make changes at all stages (the backend library, cython interface, and the Sage frontend) in one localized place. To me, it doesn't quite make sense to just add the spkg.


---

Comment by mmarco created at 2016-06-12 18:14:47

Fair enough. Working on that now.


---

Comment by mmarco created at 2016-06-12 18:26:46

Changing status from needs_review to needs_work.


---

Comment by git created at 2016-06-12 18:27:46

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-06-12 23:41:28

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-06-13 18:50:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mmarco created at 2016-06-13 18:51:22

Changing status from needs_work to needs_review.


---

Comment by mmarco created at 2016-06-13 18:51:22

I think it id ready for review.


---

Comment by jdemeyer created at 2016-06-13 19:51:12

Remove these comments:


```
#clang C++
#clib braiding
```



---

Comment by jdemeyer created at 2016-06-13 19:51:12

Changing status from needs_review to needs_work.


---

Comment by git created at 2016-06-13 20:18:13

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mmarco created at 2016-06-13 20:19:17

Changing status from needs_work to needs_review.


---

Comment by mmarco created at 2016-06-13 20:19:17

Done.


---

Comment by jdemeyer created at 2016-06-13 20:58:58


```
sage -t src/sage/libs/braiding.pyx
**********************************************************************
File "src/sage/libs/braiding.pyx", line 66, in sage.libs.braiding.conjugatingbraid
Failed example:
    from sage.libs.braiding import conjugatingbraid
Exception raised:
    Traceback (most recent call last):
      File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 498, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 861, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.libs.braiding.conjugatingbraid[0]>", line 1, in <module>
        from sage.libs.braiding import conjugatingbraid
    ImportError: No module named braiding
**********************************************************************
File "src/sage/libs/braiding.pyx", line 99, in sage.libs.braiding.leftnormalform
Failed example:
    from sage.libs.braiding import leftnormalform
Exception raised:
    Traceback (most recent call last):
      File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 498, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 861, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.libs.braiding.leftnormalform[0]>", line 1, in <module>
        from sage.libs.braiding import leftnormalform
    ImportError: No module named braiding
**********************************************************************
File "src/sage/libs/braiding.pyx", line 130, in sage.libs.braiding.rightnormalform
Failed example:
    from sage.libs.braiding import rightnormalform
Exception raised:
    Traceback (most recent call last):
      File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 498, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 861, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.libs.braiding.rightnormalform[0]>", line 1, in <module>
        from sage.libs.braiding import rightnormalform
    ImportError: No module named braiding
**********************************************************************
File "src/sage/libs/braiding.pyx", line 162, in sage.libs.braiding.greatestcommondivisor
Failed example:
    from sage.libs.braiding import greatestcommondivisor
Exception raised:
    Traceback (most recent call last):
      File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 498, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 861, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.libs.braiding.greatestcommondivisor[0]>", line 1, in <module>
        from sage.libs.braiding import greatestcommondivisor
    ImportError: No module named braiding
**********************************************************************
File "src/sage/libs/braiding.pyx", line 196, in sage.libs.braiding.leastcommonmultiple
Failed example:
    from sage.libs.braiding import leastcommonmultiple
Exception raised:
    Traceback (most recent call last):
      File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 498, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 861, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.libs.braiding.leastcommonmultiple[0]>", line 1, in <module>
        from sage.libs.braiding import leastcommonmultiple
    ImportError: No module named braiding
**********************************************************************
File "src/sage/libs/braiding.pyx", line 228, in sage.libs.braiding.centralizer
Failed example:
    from sage.libs.braiding import centralizer
Exception raised:
    Traceback (most recent call last):
      File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 498, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 861, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.libs.braiding.centralizer[0]>", line 1, in <module>
        from sage.libs.braiding import centralizer
    ImportError: No module named braiding
**********************************************************************
File "src/sage/libs/braiding.pyx", line 266, in sage.libs.braiding.supersummitset
Failed example:
    from sage.libs.braiding import supersummitset
Exception raised:
    Traceback (most recent call last):
      File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 498, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 861, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.libs.braiding.supersummitset[0]>", line 1, in <module>
        from sage.libs.braiding import supersummitset
    ImportError: No module named braiding
**********************************************************************
File "src/sage/libs/braiding.pyx", line 297, in sage.libs.braiding.ultrasummitset
Failed example:
    from sage.libs.braiding import ultrasummitset
Exception raised:
    Traceback (most recent call last):
      File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 498, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 861, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.libs.braiding.ultrasummitset[0]>", line 1, in <module>
        from sage.libs.braiding import ultrasummitset
    ImportError: No module named braiding
**********************************************************************
File "src/sage/libs/braiding.pyx", line 328, in sage.libs.braiding.thurston_type
Failed example:
    from sage.libs.braiding import thurston_type
Exception raised:
    Traceback (most recent call last):
      File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 498, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 861, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.libs.braiding.thurston_type[0]>", line 1, in <module>
        from sage.libs.braiding import thurston_type
    ImportError: No module named braiding
**********************************************************************
File "src/sage/libs/braiding.pyx", line 369, in sage.libs.braiding.rigidity
Failed example:
    from sage.libs.braiding import rigidity
Exception raised:
    Traceback (most recent call last):
      File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 498, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 861, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.libs.braiding.rigidity[0]>", line 1, in <module>
        from sage.libs.braiding import rigidity
    ImportError: No module named braiding
**********************************************************************
File "src/sage/libs/braiding.pyx", line 399, in sage.libs.braiding.sliding_circuits
Failed example:
    from sage.libs.braiding import sliding_circuits
Exception raised:
    Traceback (most recent call last):
      File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 498, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 861, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.libs.braiding.sliding_circuits[0]>", line 1, in <module>
        from sage.libs.braiding import sliding_circuits
    ImportError: No module named braiding
**********************************************************************
```

----
New commits:


---

Comment by jdemeyer created at 2016-06-13 20:58:58

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2016-06-13 20:59:46

This is pointless since the module cannot even be imported without the package:

```
    if not is_package_installed('libbraiding'):
        raise NotImplementedError("This functionality requires the libbraiding package")
```



---

Comment by mmarco created at 2016-06-13 21:41:07

Ok. Does it make sense to  put it in the braid methods?


---

Comment by git created at 2016-06-13 21:41:44

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2016-06-14 05:13:09

Replying to [comment:16 mmarco]:
> Ok. Does it make sense to  put it in the braid methods?

Yes, but

1. avoid `is_package_installed`, use `except ImportError` instead.
2. use the `PackageNotFoundError` exception instead of `NotImplementedError`.


---

Comment by git created at 2016-06-20 14:14:11

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mmarco created at 2016-06-20 14:15:19

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2016-06-20 15:06:29

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2016-06-20 15:06:29

The exception should be

```
PackageNotFoundError("libbraiding")
```



---

Comment by git created at 2016-06-20 17:27:45

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mmarco created at 2016-06-28 09:01:52

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2016-06-29 18:10:26

I've done some cleanup of the files wrt documentation and whitespace. Otherwise LGTM.
----
New commits:


---

Comment by mmarco created at 2016-06-29 19:02:24

Positive review then?


---

Comment by tscrim created at 2016-06-29 19:11:58

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2016-06-29 19:11:58

Yep.


---

Comment by vbraun created at 2016-06-29 23:06:52

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2016-06-29 23:06:52


```
sage -t --long src/sage/groups/braid.py
**********************************************************************
File "src/sage/groups/braid.py", line 1445, in sage.groups.braid.Braid.sliding_circuits
Failed example:
    b.sliding_circuits()
Exception raised:
    Traceback (most recent call last):
      File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 498, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 861, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.groups.braid.Braid.sliding_circuits[3]>", line 1, in <module>
        b.sliding_circuits()
      File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/groups/braid.py", line 1456, in sliding_circuits
        raise PackageNotFoundError("libbraiding")
    NameError: global name 'PackageNotFoundError' is not defined
**********************************************************************
1 item had failures:
   1 of   5 in sage.groups.braid.Braid.sliding_circuits
    [313 tests, 1 failure, 17.35 s]
```



---

Comment by git created at 2016-06-30 04:24:53

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-06-30 04:25:19

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by tscrim created at 2016-06-30 04:26:02

Changing status from needs_work to positive_review.


---

Comment by tscrim created at 2016-06-30 04:26:02

Missed one doctest that was suppose to be marked as optional, as well as just a realignment of the doctest output.


---

Comment by vbraun created at 2016-07-01 16:57:08

Resolution: fixed
