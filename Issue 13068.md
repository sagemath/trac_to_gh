# Issue 13068: Give posets polynomails (order, characteristic, zeta, etc.)

archive/issues_013068.json:
```json
{
    "body": "Assignee: sage-combinat\n\nCC:  @kevindilks\n\nKeywords: sd40\n\nAdding some of the polynomials from Stembridge's Posets package for Maple (see http://www.math.lsa.umich.edu/~jrs/software/posetshelp.html), namely:\n\n* characteristic polynomial\n* W-polynomial\n* zeta polynomial\n* flag f-polynomial\n* flag h-polynomial\n* f-polynomial\n* h-polynomial\n* order polynomial\n\nIssue created by migration from https://trac.sagemath.org/ticket/13240\n\n",
    "created_at": "2012-07-12T17:02:42Z",
    "labels": [
        "component: combinatorics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.13",
    "title": "Give posets polynomails (order, characteristic, zeta, etc.)",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13068",
    "user": "https://trac.sagemath.org/admin/accounts/users/csar"
}
```
Assignee: sage-combinat

CC:  @kevindilks

Keywords: sd40

Adding some of the polynomials from Stembridge's Posets package for Maple (see http://www.math.lsa.umich.edu/~jrs/software/posetshelp.html), namely:

* characteristic polynomial
* W-polynomial
* zeta polynomial
* flag f-polynomial
* flag h-polynomial
* f-polynomial
* h-polynomial
* order polynomial

Issue created by migration from https://trac.sagemath.org/ticket/13240





---

archive/issue_comments_158470.json:
```json
{
    "body": "Changing keywords from \"sd40\" to \"sd40, days45\".",
    "created_at": "2013-02-14T16:22:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13068",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13068#issuecomment-158470",
    "user": "https://trac.sagemath.org/admin/accounts/users/csar"
}
```

Changing keywords from "sd40" to "sd40, days45".



---

archive/issue_comments_158471.json:
```json
{
    "body": "A first patch, with three of the simplest polynomials",
    "created_at": "2013-05-05T19:39:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13068",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13068#issuecomment-158471",
    "user": "https://github.com/fchapoton"
}
```

A first patch, with three of the simplest polynomials



---

archive/issue_comments_158472.json:
```json
{
    "body": "I have added the flag f-vector",
    "created_at": "2013-05-14T19:32:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13068",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13068#issuecomment-158472",
    "user": "https://github.com/fchapoton"
}
```

I have added the flag f-vector



---

archive/issue_comments_158473.json:
```json
{
    "body": "I have added the flag h-polynomial",
    "created_at": "2013-05-15T18:38:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13068",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13068#issuecomment-158473",
    "user": "https://github.com/fchapoton"
}
```

I have added the flag h-polynomial



---

archive/issue_comments_158474.json:
```json
{
    "body": "I have added the characteristic polynomial",
    "created_at": "2013-05-24T16:53:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13068",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13068#issuecomment-158474",
    "user": "https://github.com/fchapoton"
}
```

I have added the characteristic polynomial



---

archive/issue_comments_158475.json:
```json
{
    "body": "I think we have code from Sage Days 45 for the order polynomial (which is one line once you have zeta), the antichain polynomial and the chain polynomial.",
    "created_at": "2013-05-24T17:20:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13068",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13068#issuecomment-158475",
    "user": "https://trac.sagemath.org/admin/accounts/users/csar"
}
```

I think we have code from Sage Days 45 for the order polynomial (which is one line once you have zeta), the antichain polynomial and the chain polynomial.



---

archive/issue_comments_158476.json:
```json
{
    "body": "great ! could you post it here as a patch on top of mine ?",
    "created_at": "2013-05-24T19:02:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13068",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13068#issuecomment-158476",
    "user": "https://github.com/fchapoton"
}
```

great ! could you post it here as a patch on top of mine ?



---

archive/issue_comments_158477.json:
```json
{
    "body": "Will do. I'm compiling sage at the moment, but I should be able to do it sometime this evening (GMT -6).\n\nNote several hours later: compiling took way longer than expected. Will add to the patch tomorrow.",
    "created_at": "2013-05-24T20:03:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13068",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13068#issuecomment-158477",
    "user": "https://trac.sagemath.org/admin/accounts/users/csar"
}
```

Will do. I'm compiling sage at the moment, but I should be able to do it sometime this evening (GMT -6).

Note several hours later: compiling took way longer than expected. Will add to the patch tomorrow.



---

archive/issue_comments_158478.json:
```json
{
    "body": "The patch didn't apply. I'm pretty sure it's a problem on my end and my installation is still messed up. I'll add things when I get it fixed.",
    "created_at": "2013-05-26T03:00:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13068",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13068#issuecomment-158478",
    "user": "https://trac.sagemath.org/admin/accounts/users/csar"
}
```

The patch didn't apply. I'm pretty sure it's a problem on my end and my installation is still messed up. I'll add things when I get it fixed.



---

archive/issue_comments_158479.json:
```json
{
    "body": "Attachment [trac_12340_poset_polynomials-csar.patch](tarball://root/attachments/some-uuid/ticket13240/trac_12340_poset_polynomials-csar.patch) by csar created at 2013-05-27 21:43:08\n\nadd chain polynomial and order polynomial",
    "created_at": "2013-05-27T21:43:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13068",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13068#issuecomment-158479",
    "user": "https://trac.sagemath.org/admin/accounts/users/csar"
}
```

Attachment [trac_12340_poset_polynomials-csar.patch](tarball://root/attachments/some-uuid/ticket13240/trac_12340_poset_polynomials-csar.patch) by csar created at 2013-05-27 21:43:08

add chain polynomial and order polynomial



---

archive/issue_comments_158480.json:
```json
{
    "body": "Okay, I've added the chain polynomial and the order polynomial. We had something written for the antichain polynomial, but I didn't include it as I wanted to check with Kevin if he knew a better way of doing it like he worked out for the chain polynomial.\n\nThe chain polynomial is written so you can ask for it in terms of something other than q. So, for example, `P.chain_polynomial(1)` would give you the chain polynomial evaluated at one. Obviously, things should be consistent as to whether you get to choose the variable, but it's a minor change to go either direction.\n\nI made a second patch on top of yours because I wasn't sure if I should be making a separate one or just adding to the patch, and combining them shouldn't be hard.",
    "created_at": "2013-05-27T21:50:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13068",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13068#issuecomment-158480",
    "user": "https://trac.sagemath.org/admin/accounts/users/csar"
}
```

Okay, I've added the chain polynomial and the order polynomial. We had something written for the antichain polynomial, but I didn't include it as I wanted to check with Kevin if he knew a better way of doing it like he worked out for the chain polynomial.

The chain polynomial is written so you can ask for it in terms of something other than q. So, for example, `P.chain_polynomial(1)` would give you the chain polynomial evaluated at one. Obviously, things should be consistent as to whether you get to choose the variable, but it's a minor change to go either direction.

I made a second patch on top of yours because I wasn't sure if I should be making a separate one or just adding to the patch, and combining them shouldn't be hard.



---

archive/issue_comments_158481.json:
```json
{
    "body": "Yes, it is better to upload a patch that applies on top of mine.\n\nI will have a closer look at your code soon.",
    "created_at": "2013-05-28T08:25:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13068",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13068#issuecomment-158481",
    "user": "https://github.com/fchapoton"
}
```

Yes, it is better to upload a patch that applies on top of mine.

I will have a closer look at your code soon.



---

archive/issue_comments_158482.json:
```json
{
    "body": "ok, here is a short review patch of your code.\n\nI have removed trailing whitespaces that you had introduced, and made small changes to the code. I have also made sure that each method starts with a brief (one-line) description of what it does. Details are then given on other lines.\n\nI would prefer not to propose the use of another variable in the code, but rather give no option. The user will get a polynomial, that he can then evaluate on whatever he wants. I think this keeps the code cleaner and shorter.\n\nCombining patches is indeed easy, and can be done just once when everything is ready.",
    "created_at": "2013-05-28T18:40:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13068",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13068#issuecomment-158482",
    "user": "https://github.com/fchapoton"
}
```

ok, here is a short review patch of your code.

I have removed trailing whitespaces that you had introduced, and made small changes to the code. I have also made sure that each method starts with a brief (one-line) description of what it does. Details are then given on other lines.

I would prefer not to propose the use of another variable in the code, but rather give no option. The user will get a polynomial, that he can then evaluate on whatever he wants. I think this keeps the code cleaner and shorter.

Combining patches is indeed easy, and can be done just once when everything is ready.



---

archive/issue_comments_158483.json:
```json
{
    "body": "maybe we could stop here adding other polynomials, and try to let this set of polynomials enter sage ?",
    "created_at": "2013-06-22T20:43:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13068",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13068#issuecomment-158483",
    "user": "https://github.com/fchapoton"
}
```

maybe we could stop here adding other polynomials, and try to let this set of polynomials enter sage ?



---

archive/issue_comments_158484.json:
```json
{
    "body": "apply trac_1324O_first_step-fc.patch, trac_12340_poset_polynomials-csar.patch, trac_13240-review1-fc.patch",
    "created_at": "2013-06-30T07:55:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13068",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13068#issuecomment-158484",
    "user": "https://github.com/fchapoton"
}
```

apply trac_1324O_first_step-fc.patch, trac_12340_poset_polynomials-csar.patch, trac_13240-review1-fc.patch



---

archive/issue_comments_158485.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-06-30T16:25:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13068",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13068#issuecomment-158485",
    "user": "https://github.com/fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_158486.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-07-04T09:34:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13068",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13068#issuecomment-158486",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_158487.json:
```json
{
    "body": "Hello !\n\nWould it be possible to add definitions of what these polynomials are, possibly as links toward wikipedia pages ?\n\nI also think that you should cache minimal and maximal elements in the code of `remove_top_and_bottom`, otherwise you compute the maximal and minimal elements for each vertex :\n\n\n```\nsage: def a():                                 \n....:     print \"Hey\"\n....:     return [1]\n....: \nsage: [x for x in range(5) if x in a()]\nHey\nHey\nHey\nHey\nHey\n[1]\n```\n\n\nHence if you want to write this function, this really should not be computed so many times.\n\nBesides : you only implement this method for bounded posets, which means that there is one max and one min elements. Hence this complicated line only checks that each vertex is different from two given vertices.\n\nI personally do not think that this `remove_top_and_bottom` method is useful, especially when it build a copy of the whole poset, which can be very costly. You would probably save yourself a lot of time if you worked on `self` in each of your methods, and just ignored the top and bottom elements. No copies of the poset, no call to `remove_to_and_bottom` either.\n\nOh, and Florent thinks that it would be nice to add \"seealso\" sections toward \"is_bounded\", or toward polynomials that are related with each other.\n\nSee youuuuuuuuuuuuuuuuUU !!\n\nNathann",
    "created_at": "2013-07-04T09:34:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13068",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13068#issuecomment-158487",
    "user": "https://github.com/nathanncohen"
}
```

Hello !

Would it be possible to add definitions of what these polynomials are, possibly as links toward wikipedia pages ?

I also think that you should cache minimal and maximal elements in the code of `remove_top_and_bottom`, otherwise you compute the maximal and minimal elements for each vertex :


```
sage: def a():                                 
....:     print "Hey"
....:     return [1]
....: 
sage: [x for x in range(5) if x in a()]
Hey
Hey
Hey
Hey
Hey
[1]
```


Hence if you want to write this function, this really should not be computed so many times.

Besides : you only implement this method for bounded posets, which means that there is one max and one min elements. Hence this complicated line only checks that each vertex is different from two given vertices.

I personally do not think that this `remove_top_and_bottom` method is useful, especially when it build a copy of the whole poset, which can be very costly. You would probably save yourself a lot of time if you worked on `self` in each of your methods, and just ignored the top and bottom elements. No copies of the poset, no call to `remove_to_and_bottom` either.

Oh, and Florent thinks that it would be nice to add "seealso" sections toward "is_bounded", or toward polynomials that are related with each other.

See youuuuuuuuuuuuuuuuUU !!

Nathann



---

archive/issue_comments_158488.json:
```json
{
    "body": "I'm not actually sure there are definitions on Wikipedia for any/some/most of these (I took a quick look and didn't find any). But one could include references to EC1.",
    "created_at": "2013-07-04T13:26:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13068",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13068#issuecomment-158488",
    "user": "https://trac.sagemath.org/admin/accounts/users/csar"
}
```

I'm not actually sure there are definitions on Wikipedia for any/some/most of these (I took a quick look and didn't find any). But one could include references to EC1.



---

archive/issue_comments_158489.json:
```json
{
    "body": "Here is a new patch\n\nI have tried to adress some of the points raised by Nathan:\n\n* I have got rid of remove_top_and_bottom, but introduced chains_with_bounds\n\nThere remains to explain the definition of every polynomial, and give the references to EC1",
    "created_at": "2013-07-05T19:11:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13068",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13068#issuecomment-158489",
    "user": "https://github.com/fchapoton"
}
```

Here is a new patch

I have tried to adress some of the points raised by Nathan:

* I have got rid of remove_top_and_bottom, but introduced chains_with_bounds

There remains to explain the definition of every polynomial, and give the references to EC1



---

archive/issue_comments_158490.json:
```json
{
    "body": "Attachment [trac_1324O_first_step-fc.patch](tarball://root/attachments/some-uuid/ticket13240/trac_1324O_first_step-fc.patch) by @fchapoton created at 2013-09-13 18:17:08\n\napply trac_1324O_first_step-fc.patch,trac_12340_poset_polynomials-csar.patch,trac_13240-review1-fc.patch",
    "created_at": "2013-09-13T18:17:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13068",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13068#issuecomment-158490",
    "user": "https://github.com/fchapoton"
}
```

Attachment [trac_1324O_first_step-fc.patch](tarball://root/attachments/some-uuid/ticket13240/trac_1324O_first_step-fc.patch) by @fchapoton created at 2013-09-13 18:17:08

apply trac_1324O_first_step-fc.patch,trac_12340_poset_polynomials-csar.patch,trac_13240-review1-fc.patch



---

archive/issue_comments_158491.json:
```json
{
    "body": "I have added a few more reference to Enum. Comb. 1",
    "created_at": "2013-09-13T18:37:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13068",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13068#issuecomment-158491",
    "user": "https://github.com/fchapoton"
}
```

I have added a few more reference to Enum. Comb. 1



---

archive/issue_comments_158492.json:
```json
{
    "body": "Maybe this ticket can be considered good enough ?\n\nOne patchbot has turned green, so there is an opportunity right now.",
    "created_at": "2013-09-22T14:00:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13068",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13068#issuecomment-158492",
    "user": "https://github.com/fchapoton"
}
```

Maybe this ticket can be considered good enough ?

One patchbot has turned green, so there is an opportunity right now.



---

archive/issue_comments_158493.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-09-22T14:01:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13068",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13068#issuecomment-158493",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_158494.json:
```json
{
    "body": "Helooooooo !\n\nThere still isn't any definition of what `f_polynomial` and `h_polynomial` return. Also, I personally do not think that a function named \"chains with bounds\" should exist (and so I will let somebody else give a positive review to this ticket), but in any case if you want to implement such a thing I'd think better to do it the following way :\n\n* create a copy of the poset without the top/bottom element\n* list its chains\n* return each of them after adding the top and bottom element at each end of the chain.\n\nNathann",
    "created_at": "2013-09-22T16:31:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13068",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13068#issuecomment-158494",
    "user": "https://github.com/nathanncohen"
}
```

Helooooooo !

There still isn't any definition of what `f_polynomial` and `h_polynomial` return. Also, I personally do not think that a function named "chains with bounds" should exist (and so I will let somebody else give a positive review to this ticket), but in any case if you want to implement such a thing I'd think better to do it the following way :

* create a copy of the poset without the top/bottom element
* list its chains
* return each of them after adding the top and bottom element at each end of the chain.

Nathann



---

archive/issue_comments_158495.json:
```json
{
    "body": "Hello Nathann,\n\nwell, `chains_with_bounds` has been written to try to cope with your previous comments, that suggested to avoid copying the poset. And now you suggest to copy the poset..\n\nWould it be better to make `chains_with_bounds` a hidden method ?",
    "created_at": "2013-09-22T16:58:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13068",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13068#issuecomment-158495",
    "user": "https://github.com/fchapoton"
}
```

Hello Nathann,

well, `chains_with_bounds` has been written to try to cope with your previous comments, that suggested to avoid copying the poset. And now you suggest to copy the poset..

Would it be better to make `chains_with_bounds` a hidden method ?



---

archive/issue_comments_158496.json:
```json
{
    "body": "> well, `chains_with_bounds` has been written to try to cope with your previous comments, that suggested to avoid copying the poset. And now you suggest to copy the poset..\n\nWell, yes. The best way out is to not copy the poset, to not call the `.chains()` method, and to rewrite what `chains()` does directly on this poset, ignoring the top/bottom elements on the fly. There's no need to copy.\n\nThough if you want to call this `chains()` method you will enumerate 4 times too many things chains, and you need *each time* to check if the two vertices belong to the list (by the way, you already know WHERE in the list they will appear if they do, so you can save time there too).\n\n> Would it be better to make `chains_with_bounds` a hidden method \n\nWhat about making it an option of \"chains\" ?\n\nNathann",
    "created_at": "2013-09-22T17:13:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13068",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13068#issuecomment-158496",
    "user": "https://github.com/nathanncohen"
}
```

> well, `chains_with_bounds` has been written to try to cope with your previous comments, that suggested to avoid copying the poset. And now you suggest to copy the poset..

Well, yes. The best way out is to not copy the poset, to not call the `.chains()` method, and to rewrite what `chains()` does directly on this poset, ignoring the top/bottom elements on the fly. There's no need to copy.

Though if you want to call this `chains()` method you will enumerate 4 times too many things chains, and you need *each time* to check if the two vertices belong to the list (by the way, you already know WHERE in the list they will appear if they do, so you can save time there too).

> Would it be better to make `chains_with_bounds` a hidden method 

What about making it an option of "chains" ?

Nathann



---

archive/issue_comments_158497.json:
```json
{
    "body": "Attachment [trac_13240-review1-fc.patch](tarball://root/attachments/some-uuid/ticket13240/trac_13240-review1-fc.patch) by @fchapoton created at 2013-09-23 19:19:31\n\nHello Nathann,\n\nthanks for spending time on this ticket.\n\nI have removed `chains_with_bounds`, instead adding a parameter `exclude` to the method `chains`.\n\nI have also added more documentation.",
    "created_at": "2013-09-23T19:19:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13068",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13068#issuecomment-158497",
    "user": "https://github.com/fchapoton"
}
```

Attachment [trac_13240-review1-fc.patch](tarball://root/attachments/some-uuid/ticket13240/trac_13240-review1-fc.patch) by @fchapoton created at 2013-09-23 19:19:31

Hello Nathann,

thanks for spending time on this ticket.

I have removed `chains_with_bounds`, instead adding a parameter `exclude` to the method `chains`.

I have also added more documentation.



---

archive/issue_comments_158498.json:
```json
{
    "body": "Wow ! It sure looks cleaner this way `:-)`\n\nI don't see anything wrong in this patch right now... Though I'm a bit embarassed because I don't understand the maths  at all, and it would be nice if somebody could just check that the polynomials are indeed what they should be `^^;`\n\nNathann",
    "created_at": "2013-09-25T09:19:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13068",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13068#issuecomment-158498",
    "user": "https://github.com/nathanncohen"
}
```

Wow ! It sure looks cleaner this way `:-)`

I don't see anything wrong in this patch right now... Though I'm a bit embarassed because I don't understand the maths  at all, and it would be nice if somebody could just check that the polynomials are indeed what they should be `^^;`

Nathann



---

archive/issue_comments_158499.json:
```json
{
    "body": "The csar patch applied with fuzz for me (5.13beta0):\n\n\n```\napplying trac_12340_poset_polynomials-csar.patch\npatching file sage/combinat/posets/posets.py\nHunk #1 succeeded at 28 with fuzz 1 (offset 0 lines).\nHunk #2 succeeded at 84 with fuzz 2 (offset 5 lines).\n```\n\n\nThe file I'm uploading in a few seconds is just a qfold so that I get a better view of the changes myself.",
    "created_at": "2013-10-20T20:09:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13068",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13068#issuecomment-158499",
    "user": "https://github.com/darijgr"
}
```

The csar patch applied with fuzz for me (5.13beta0):


```
applying trac_12340_poset_polynomials-csar.patch
patching file sage/combinat/posets/posets.py
Hunk #1 succeeded at 28 with fuzz 1 (offset 0 lines).
Hunk #2 succeeded at 84 with fuzz 2 (offset 5 lines).
```


The file I'm uploading in a few seconds is just a qfold so that I get a better view of the changes myself.



---

archive/issue_comments_158500.json:
```json
{
    "body": "qfold",
    "created_at": "2013-10-20T20:09:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13068",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13068#issuecomment-158500",
    "user": "https://github.com/darijgr"
}
```

qfold



---

archive/issue_comments_158501.json:
```json
{
    "body": "Attachment [trac_13240-qfold.patch](tarball://root/attachments/some-uuid/ticket13240/trac_13240-qfold.patch) by @darijgr created at 2013-10-21 02:48:35\n\nUPDATED! everything reviewed, except for the two flag_* functions which I don't really understand nor can find a reference for.",
    "created_at": "2013-10-21T02:48:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13068",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13068#issuecomment-158501",
    "user": "https://github.com/darijgr"
}
```

Attachment [trac_13240-qfold.patch](tarball://root/attachments/some-uuid/ticket13240/trac_13240-qfold.patch) by @darijgr created at 2013-10-21 02:48:35

UPDATED! everything reviewed, except for the two flag_* functions which I don't really understand nor can find a reference for.



---

archive/issue_comments_158502.json:
```json
{
    "body": "Attachment [trac_13240-almost-review-dg.patch](tarball://root/attachments/some-uuid/ticket13240/trac_13240-almost-review-dg.patch) by @darijgr created at 2013-10-21 02:49:57\n\nThanks, Nathan, for alerting me to this patch!\n\nThe file I just attached gives a review of everything but the two flag polynomials (f and h) which I couldn't find in literature. Please give a reference or a full definition (how exactly are those monomials built from the ranks etc.).\n\n#13223 notwithstanding, I've replaced the hyperpolynomial-time `is_graded` method by a polynomial-time (and memory) one. Speed comparisons:\n\nbefore:\n\n```\nsage: B2 = Posets.BooleanLattice(2)\nsage: %timeit B2.is_graded()\n10000 loops, best of 3: 84.9 us per loop\nsage: B3 = Posets.BooleanLattice(3)\nsage: %timeit B3.is_graded()\n10000 loops, best of 3: 195 us per loop\nsage: B4 = Posets.BooleanLattice(4)\nsage: %timeit B4.is_graded()\n1000 loops, best of 3: 663 us per loop\nsage: B5 = Posets.BooleanLattice(5)\nsage: %timeit B5.is_graded()\n100 loops, best of 3: 2.86 ms per loop\nsage: B6 = Posets.BooleanLattice(6)\nsage: %timeit B6.is_graded()\n100 loops, best of 3: 16 ms per loop\nsage: B7 = Posets.BooleanLattice(7)\nsage: %timeit B7.is_graded()\n10 loops, best of 3: 109 ms per loop\nsage: P = Poset({1: [2, 3], 3: [4, 5], 2: [6]})\nsage: %timeit P.is_graded()\n10000 loops, best of 3: 103 us per loop\nsage: C = Poset([list(B7) + [1337], B7.cover_relations() + [[127, 1337]]])\nsage: %timeit C.is_graded()\n10 loops, best of 3: 146 ms per loop\n```\n\n\nafter:\n\n```\nsage: B2 = Posets.BooleanLattice(2)\nsage: %timeit B2.is_graded()\n10000 loops, best of 3: 82.3 us per loop\nsage: B3 = Posets.BooleanLattice(3)\nsage: %timeit B3.is_graded()\n10000 loops, best of 3: 149 us per loop\nsage: B4 = Posets.BooleanLattice(4)\nsage: %timeit B4.is_graded()\n1000 loops, best of 3: 290 us per loop\nsage: B5 = Posets.BooleanLattice(5)\nsage: %timeit B5.is_graded()\n1000 loops, best of 3: 525 us per loop\nsage: B6 = Posets.BooleanLattice(6)\nsage: %timeit B6.is_graded()\n1000 loops, best of 3: 1.02 ms per loop\nsage: B7 = Posets.BooleanLattice(7)\nsage: %timeit B7.is_graded()\n100 loops, best of 3: 2.07 ms per loop\nsage: P = Poset({1: [2, 3], 3: [4, 5], 2: [6]})\nsage: %timeit P.is_graded()\n10000 loops, best of 3: 108 us per loop\nsage: C = Poset([list(B7) + [1337], B7.cover_relations() + [[127, 1337]]])\nsage: %timeit C.is_graded()\n100 loops, best of 3: 2.14 ms per loop\n```\n\n\nAlso I have optimized the polynomial-computing methods (apart from the ones I don't understand) by letting them work with the `_hasse_diagram` of the poset rather than the poset itself, because all methods that are used (minimal elements, top, Moebius etc.) currently work by calling the corresponding methods on the Hasse diagram and then relabelling vertices back. This also fixes the issue of `chain_polynomial` throwing errors if the poset wasn't labelled 0,1,...,n (one of the doctests I made checks for this now).\n\nProbably someone will have to review my review...\n\nfor the patchbots:\n\napply trac_13240-qfold.patch\u200b trac_13240-almost-review-dg.patch\u200b",
    "created_at": "2013-10-21T02:49:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13068",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13068#issuecomment-158502",
    "user": "https://github.com/darijgr"
}
```

Attachment [trac_13240-almost-review-dg.patch](tarball://root/attachments/some-uuid/ticket13240/trac_13240-almost-review-dg.patch) by @darijgr created at 2013-10-21 02:49:57

Thanks, Nathan, for alerting me to this patch!

The file I just attached gives a review of everything but the two flag polynomials (f and h) which I couldn't find in literature. Please give a reference or a full definition (how exactly are those monomials built from the ranks etc.).

#13223 notwithstanding, I've replaced the hyperpolynomial-time `is_graded` method by a polynomial-time (and memory) one. Speed comparisons:

before:

```
sage: B2 = Posets.BooleanLattice(2)
sage: %timeit B2.is_graded()
10000 loops, best of 3: 84.9 us per loop
sage: B3 = Posets.BooleanLattice(3)
sage: %timeit B3.is_graded()
10000 loops, best of 3: 195 us per loop
sage: B4 = Posets.BooleanLattice(4)
sage: %timeit B4.is_graded()
1000 loops, best of 3: 663 us per loop
sage: B5 = Posets.BooleanLattice(5)
sage: %timeit B5.is_graded()
100 loops, best of 3: 2.86 ms per loop
sage: B6 = Posets.BooleanLattice(6)
sage: %timeit B6.is_graded()
100 loops, best of 3: 16 ms per loop
sage: B7 = Posets.BooleanLattice(7)
sage: %timeit B7.is_graded()
10 loops, best of 3: 109 ms per loop
sage: P = Poset({1: [2, 3], 3: [4, 5], 2: [6]})
sage: %timeit P.is_graded()
10000 loops, best of 3: 103 us per loop
sage: C = Poset([list(B7) + [1337], B7.cover_relations() + [[127, 1337]]])
sage: %timeit C.is_graded()
10 loops, best of 3: 146 ms per loop
```


after:

```
sage: B2 = Posets.BooleanLattice(2)
sage: %timeit B2.is_graded()
10000 loops, best of 3: 82.3 us per loop
sage: B3 = Posets.BooleanLattice(3)
sage: %timeit B3.is_graded()
10000 loops, best of 3: 149 us per loop
sage: B4 = Posets.BooleanLattice(4)
sage: %timeit B4.is_graded()
1000 loops, best of 3: 290 us per loop
sage: B5 = Posets.BooleanLattice(5)
sage: %timeit B5.is_graded()
1000 loops, best of 3: 525 us per loop
sage: B6 = Posets.BooleanLattice(6)
sage: %timeit B6.is_graded()
1000 loops, best of 3: 1.02 ms per loop
sage: B7 = Posets.BooleanLattice(7)
sage: %timeit B7.is_graded()
100 loops, best of 3: 2.07 ms per loop
sage: P = Poset({1: [2, 3], 3: [4, 5], 2: [6]})
sage: %timeit P.is_graded()
10000 loops, best of 3: 108 us per loop
sage: C = Poset([list(B7) + [1337], B7.cover_relations() + [[127, 1337]]])
sage: %timeit C.is_graded()
100 loops, best of 3: 2.14 ms per loop
```


Also I have optimized the polynomial-computing methods (apart from the ones I don't understand) by letting them work with the `_hasse_diagram` of the poset rather than the poset itself, because all methods that are used (minimal elements, top, Moebius etc.) currently work by calling the corresponding methods on the Hasse diagram and then relabelling vertices back. This also fixes the issue of `chain_polynomial` throwing errors if the poset wasn't labelled 0,1,...,n (one of the doctests I made checks for this now).

Probably someone will have to review my review...

for the patchbots:

apply trac_13240-qfold.patch​ trac_13240-almost-review-dg.patch​



---

archive/issue_comments_158503.json:
```json
{
    "body": "Yooooooooooooooo !!\n\nWell, all I can understand makes sense ! It was nice to merge these calls to `is_bounded` and getting the top/bottom elements in particular. It could even become an optional argument eventually : `p.is_bounded(if_it_is_bounded_return_top_and_bottom_not_true=True)` `:-)`\n\nThaaaaaaaanks Darij !\n\nNathann",
    "created_at": "2013-10-21T13:23:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13068",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13068#issuecomment-158503",
    "user": "https://github.com/nathanncohen"
}
```

Yooooooooooooooo !!

Well, all I can understand makes sense ! It was nice to merge these calls to `is_bounded` and getting the top/bottom elements in particular. It could even become an optional argument eventually : `p.is_bounded(if_it_is_bounded_return_top_and_bottom_not_true=True)` `:-)`

Thaaaaaaaanks Darij !

Nathann



---

archive/issue_comments_158504.json:
```json
{
    "body": "Thanks Darij, for your review patch.\n\nYour review looks good to me.\n\nconcerning flag f-vector and flag h-vector, there is something here : http://en.wikipedia.org/wiki/H-vector#Flag_h-vector_and_cd-index\n\nIt can also probably go through the hasse diagram.",
    "created_at": "2013-10-21T19:47:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13068",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13068#issuecomment-158504",
    "user": "https://github.com/fchapoton"
}
```

Thanks Darij, for your review patch.

Your review looks good to me.

concerning flag f-vector and flag h-vector, there is something here : http://en.wikipedia.org/wiki/H-vector#Flag_h-vector_and_cd-index

It can also probably go through the hasse diagram.



---

archive/issue_comments_158505.json:
```json
{
    "body": "Attachment [trac_13240-review2-dg.patch](tarball://root/attachments/some-uuid/ticket13240/trac_13240-review2-dg.patch) by @darijgr created at 2013-10-22 03:09:59\n\ncompleted review patch. ignore the almost-review one.",
    "created_at": "2013-10-22T03:09:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13068",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13068#issuecomment-158505",
    "user": "https://github.com/darijgr"
}
```

Attachment [trac_13240-review2-dg.patch](tarball://root/attachments/some-uuid/ticket13240/trac_13240-review2-dg.patch) by @darijgr created at 2013-10-22 03:09:59

completed review patch. ignore the almost-review one.



---

archive/issue_comments_158506.json:
```json
{
    "body": "Hi Frederic,\n\nI've completed my review, editing again all four f/h-polynomials (flag and usual). Please check that:\n\n1) the definitions I've added to the docstring are correct (I have deduced them from the implementation, except for the size-1 poset case which I just found had to give 1 for reasons of consistency);\n\n2) all four methods return what they should in the case of a poset with 1 vertex (this is doctested, but I don't know if it's what you want);\n\n3) you really want the flag h-polynomial to be returned as a polynomial over QQ, even if it has integer coefficients.\n\nIf these are fine, feel free to set this to positive review!\n\nfor the patchbot:\n\napply trac_13240-qfold.patch\u200b trac_13240-review2-dg.patch",
    "created_at": "2013-10-22T03:13:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13068",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13068#issuecomment-158506",
    "user": "https://github.com/darijgr"
}
```

Hi Frederic,

I've completed my review, editing again all four f/h-polynomials (flag and usual). Please check that:

1) the definitions I've added to the docstring are correct (I have deduced them from the implementation, except for the size-1 poset case which I just found had to give 1 for reasons of consistency);

2) all four methods return what they should in the case of a poset with 1 vertex (this is doctested, but I don't know if it's what you want);

3) you really want the flag h-polynomial to be returned as a polynomial over QQ, even if it has integer coefficients.

If these are fine, feel free to set this to positive review!

for the patchbot:

apply trac_13240-qfold.patch​ trac_13240-review2-dg.patch



---

archive/issue_comments_158507.json:
```json
{
    "body": "Thanks Darij,\n\nI will have a serious look later today.\n\nfor the **patchbots** (beware of invisible characters when copy pasting!)\n\napply trac_13240-qfold.patch trac_13240-review2-dg.patch",
    "created_at": "2013-10-22T07:49:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13068",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13068#issuecomment-158507",
    "user": "https://github.com/fchapoton"
}
```

Thanks Darij,

I will have a serious look later today.

for the **patchbots** (beware of invisible characters when copy pasting!)

apply trac_13240-qfold.patch trac_13240-review2-dg.patch



---

archive/issue_comments_158508.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-10-22T18:29:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13068",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13068#issuecomment-158508",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_158509.json:
```json
{
    "body": "ok, I am happy enough with the current patch. Positive review !\n\n:)",
    "created_at": "2013-10-22T18:29:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13068",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13068#issuecomment-158509",
    "user": "https://github.com/fchapoton"
}
```

ok, I am happy enough with the current patch. Positive review !

:)



---

archive/issue_events_012996.json:
```json
{
    "actor": "@jdemeyer",
    "created_at": "2013-10-31T19:16:05Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/13068",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13068#event-12996"
}
```



---

archive/issue_comments_158510.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-10-31T19:16:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13068",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13068#issuecomment-158510",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed
