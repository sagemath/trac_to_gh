# Issue 22832: Add an option to the test runner to exit immediately upon the first failure

archive/issues_022595.json:
```json
{
    "body": "Inspired by the `--exitfirst` option to `py.test`, this adds a `--exitfirst` option to Sage's test runner to exit immediately upon the first test failure.\n\nI've wanted something like this at several points, but one reason in particular is that part of the build of the patchbot Docker image is to perform the baseline test run, so that the image itself can be reused without having to rebuild the baseline each time.  Obviously, if a test fails during the baseline test run then I want the Docker image build to fail immediately, and not wait until the rest of the test suite has run.\n\nBranch/Commit: c6a5b40146506795873a1cb7b64e645258251a90\n\nReviewer: Jeroen Demeyer\n\nAuthor: Erik Bray\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/22832\n\n",
    "closed_at": "2017-04-23T12:57:20Z",
    "created_at": "2017-04-19T11:41:36Z",
    "labels": [
        "component: doctest framework"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.0",
    "title": "Add an option to the test runner to exit immediately upon the first failure",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22832",
    "user": "https://github.com/embray"
}
```
Inspired by the `--exitfirst` option to `py.test`, this adds a `--exitfirst` option to Sage's test runner to exit immediately upon the first test failure.

I've wanted something like this at several points, but one reason in particular is that part of the build of the patchbot Docker image is to perform the baseline test run, so that the image itself can be reused without having to rebuild the baseline each time.  Obviously, if a test fails during the baseline test run then I want the Docker image build to fail immediately, and not wait until the rest of the test suite has run.

Branch/Commit: c6a5b40146506795873a1cb7b64e645258251a90

Reviewer: Jeroen Demeyer

Author: Erik Bray

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/22832





---

archive/issue_comments_420846.json:
```json
{
    "body": "<a id='comment:1'></a>\nNew commits:\n|                                                                                                                                          |                                                                                                            |\n|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------|\n|[c12a4d3](https://github.com/sagemath/sagetrac-mirror/commit/c12a4d387fcce94dca376cea02d763f49a8c3760)|`Initial attempt to add a test runner option to stop a test run as soon as a single failure is encountered.`|\n|[2f359e8](https://github.com/sagemath/sagetrac-mirror/commit/2f359e8a5e5da8b8dba9475e7b168b2cf74c0e65)|`Make --fail-once work with parallel doctests.`|",
    "created_at": "2017-04-19T11:42:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22832#issuecomment-420846",
    "user": "https://github.com/embray"
}
```

<a id='comment:1'></a>
New commits:
|                                                                                                                                          |                                                                                                            |
|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------|
|[c12a4d3](https://github.com/sagemath/sagetrac-mirror/commit/c12a4d387fcce94dca376cea02d763f49a8c3760)|`Initial attempt to add a test runner option to stop a test run as soon as a single failure is encountered.`|
|[2f359e8](https://github.com/sagemath/sagetrac-mirror/commit/2f359e8a5e5da8b8dba9475e7b168b2cf74c0e65)|`Make --fail-once work with parallel doctests.`|



---

archive/issue_comments_420847.json:
```json
{
    "body": "Changing commit from \"\" to \"2f359e8a5e5da8b8dba9475e7b168b2cf74c0e65\"",
    "created_at": "2017-04-19T11:42:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22832#issuecomment-420847",
    "user": "https://github.com/embray"
}
```

Changing commit from "" to "2f359e8a5e5da8b8dba9475e7b168b2cf74c0e65"



---

archive/issue_comments_420848.json:
```json
{
    "body": "Changing author from \"\" to \"Erik Bray\"",
    "created_at": "2017-04-19T11:42:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22832#issuecomment-420848",
    "user": "https://github.com/embray"
}
```

Changing author from "" to "Erik Bray"



---

archive/issue_comments_420849.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-04-19T11:42:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22832#issuecomment-420849",
    "user": "https://github.com/embray"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_420850.json:
```json
{
    "body": "Changing branch from \"\" to \"u/embray/tests/fail-once\"",
    "created_at": "2017-04-19T11:42:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22832#issuecomment-420850",
    "user": "https://github.com/embray"
}
```

Changing branch from "" to "u/embray/tests/fail-once"



---

archive/issue_comments_420851.json:
```json
{
    "body": "Replying to [ticket:22832 embray]:\n> Inspired by the `--exitfirst` option to `py.test`, this adds a `--fail-once` option to Sage's test runner to exit immediately upon the first test failure.\n\n\nObvious question: why not call the Sage option `exitfirst`? I find it a better name than `fail-once`.",
    "created_at": "2017-04-19T12:32:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22832#issuecomment-420851",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [ticket:22832 embray]:
> Inspired by the `--exitfirst` option to `py.test`, this adds a `--fail-once` option to Sage's test runner to exit immediately upon the first test failure.


Obvious question: why not call the Sage option `exitfirst`? I find it a better name than `fail-once`.



---

archive/issue_comments_420852.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-04-19T12:42:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22832#issuecomment-420852",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_420853.json:
```json
{
    "body": "<a id='comment:3'></a>\nI'm making some changes, hang on...",
    "created_at": "2017-04-19T12:42:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22832#issuecomment-420853",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:3'></a>
I'm making some changes, hang on...



---

archive/issue_comments_420854.json:
```json
{
    "body": "Changing branch from \"u/embray/tests/fail-once\" to \"u/jdemeyer/tests/fail-once\"",
    "created_at": "2017-04-19T15:00:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22832#issuecomment-420854",
    "user": "https://github.com/jdemeyer"
}
```

Changing branch from "u/embray/tests/fail-once" to "u/jdemeyer/tests/fail-once"



---

archive/issue_comments_420855.json:
```json
{
    "body": "Changing commit from \"2f359e8a5e5da8b8dba9475e7b168b2cf74c0e65\" to \"c2bff84e640507306d52b108e3ee440eb555ddba\"",
    "created_at": "2017-04-19T15:03:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22832#issuecomment-420855",
    "user": "https://github.com/jdemeyer"
}
```

Changing commit from "2f359e8a5e5da8b8dba9475e7b168b2cf74c0e65" to "c2bff84e640507306d52b108e3ee440eb555ddba"



---

archive/issue_comments_420856.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n-Inspired by the `--exitfirst` option to `py.test`, this adds a `--fail-once` option to Sage's test runner to exit immediately upon the first test failure.\n+Inspired by the `--exitfirst` option to `py.test`, this adds a `--exitfirst` option to Sage's test runner to exit immediately upon the first test failure.\n \n I've wanted something like this at several points, but one reason in particular is that part of the build of the patchbot Docker image is to perform the baseline test run, so that the image itself can be reused without having to rebuild the baseline each time.  Obviously, if a test fails during the baseline test run then I want the Docker image build to fail immediately, and not wait until the rest of the test suite has run.\n``````\n",
    "created_at": "2017-04-19T15:03:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22832#issuecomment-420856",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
-Inspired by the `--exitfirst` option to `py.test`, this adds a `--fail-once` option to Sage's test runner to exit immediately upon the first test failure.
+Inspired by the `--exitfirst` option to `py.test`, this adds a `--exitfirst` option to Sage's test runner to exit immediately upon the first test failure.
 
 I've wanted something like this at several points, but one reason in particular is that part of the build of the patchbot Docker image is to perform the baseline test run, so that the image itself can be reused without having to rebuild the baseline each time.  Obviously, if a test fails during the baseline test run then I want the Docker image build to fail immediately, and not wait until the rest of the test suite has run.
``````




---

archive/issue_comments_420857.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-04-19T15:03:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22832#issuecomment-420857",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_420858.json:
```json
{
    "body": "<a id='comment:5'></a>\nNew commits:\n|                                                                                                                                          |                                                                                                            |\n|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------|\n|[f26f64e](https://github.com/sagemath/sagetrac-mirror/commit/f26f64e6aecc9c86280164ba34e1bf02a4cb379b)|`Initial attempt to add a test runner option to stop a test run as soon as a single failure is encountered.`|\n|[2e9a80c](https://github.com/sagemath/sagetrac-mirror/commit/2e9a80cc857e33069a642656c3138dbfa4e30058)|`Make --fail-once work with parallel doctests.`|\n|[c2bff84](https://github.com/sagemath/sagetrac-mirror/commit/c2bff84e640507306d52b108e3ee440eb555ddba)|`Rename --fail-once to --exitfirst; minor fixes; add test`|",
    "created_at": "2017-04-19T15:03:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22832#issuecomment-420858",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:5'></a>
New commits:
|                                                                                                                                          |                                                                                                            |
|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------|
|[f26f64e](https://github.com/sagemath/sagetrac-mirror/commit/f26f64e6aecc9c86280164ba34e1bf02a4cb379b)|`Initial attempt to add a test runner option to stop a test run as soon as a single failure is encountered.`|
|[2e9a80c](https://github.com/sagemath/sagetrac-mirror/commit/2e9a80cc857e33069a642656c3138dbfa4e30058)|`Make --fail-once work with parallel doctests.`|
|[c2bff84](https://github.com/sagemath/sagetrac-mirror/commit/c2bff84e640507306d52b108e3ee440eb555ddba)|`Rename --fail-once to --exitfirst; minor fixes; add test`|



---

archive/issue_comments_420859.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Jeroen Demeyer\"",
    "created_at": "2017-04-19T15:03:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22832#issuecomment-420859",
    "user": "https://github.com/jdemeyer"
}
```

Changing reviewer from "" to "Jeroen Demeyer"



---

archive/issue_comments_420860.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-04-20T09:09:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22832#issuecomment-420860",
    "user": "https://github.com/embray"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_420861.json:
```json
{
    "body": "<a id='comment:6'></a>\nI'm fine with that, thanks.",
    "created_at": "2017-04-20T09:09:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22832#issuecomment-420861",
    "user": "https://github.com/embray"
}
```

<a id='comment:6'></a>
I'm fine with that, thanks.



---

archive/issue_comments_420862.json:
```json
{
    "body": "<a id='comment:7'></a>\nReplying to [jdemeyer](#comment%3A2):\n> Replying to [ticket:22832 embray]:\n> > Inspired by the `--exitfirst` option to `py.test`, this adds a `--fail-once` option to Sage's test runner to exit immediately upon the first test failure.\n\n> \n> Obvious question: why not call the Sage option `exitfirst`? I find it a better name than `fail-once`.\n\n\nI personally find \"fail once\" to be clearer than \"exit first\"--\"Exit first what?\" is what it makes me ask.  That said, the documentation makes it clear enough, and I don't mind the consistency.",
    "created_at": "2017-04-20T09:22:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22832#issuecomment-420862",
    "user": "https://github.com/embray"
}
```

<a id='comment:7'></a>
Replying to [jdemeyer](#comment%3A2):
> Replying to [ticket:22832 embray]:
> > Inspired by the `--exitfirst` option to `py.test`, this adds a `--fail-once` option to Sage's test runner to exit immediately upon the first test failure.

> 
> Obvious question: why not call the Sage option `exitfirst`? I find it a better name than `fail-once`.


I personally find "fail once" to be clearer than "exit first"--"Exit first what?" is what it makes me ask.  That said, the documentation makes it clear enough, and I don't mind the consistency.



---

archive/issue_comments_420863.json:
```json
{
    "body": "<a id='comment:8'></a>\nOops, one little nitpick--you forgot to remove the line `fail_immediately=False` after renaming it to `abort_now` everywhere else.",
    "created_at": "2017-04-20T09:31:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22832#issuecomment-420863",
    "user": "https://github.com/embray"
}
```

<a id='comment:8'></a>
Oops, one little nitpick--you forgot to remove the line `fail_immediately=False` after renaming it to `abort_now` everywhere else.



---

archive/issue_comments_420864.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-04-20T09:31:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22832#issuecomment-420864",
    "user": "https://github.com/embray"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_420865.json:
```json
{
    "body": "Changing commit from \"c2bff84e640507306d52b108e3ee440eb555ddba\" to \"c6a5b40146506795873a1cb7b64e645258251a90\"",
    "created_at": "2017-04-20T09:34:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22832#issuecomment-420865",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "c2bff84e640507306d52b108e3ee440eb555ddba" to "c6a5b40146506795873a1cb7b64e645258251a90"



---

archive/issue_comments_420866.json:
```json
{
    "body": "<a id='comment:9'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                       |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------|\n|[c6a5b40](https://github.com/sagemath/sagetrac-mirror/commit/c6a5b40146506795873a1cb7b64e645258251a90)|`Remove forgotten line`|",
    "created_at": "2017-04-20T09:34:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22832#issuecomment-420866",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                       |
|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------|
|[c6a5b40](https://github.com/sagemath/sagetrac-mirror/commit/c6a5b40146506795873a1cb7b64e645258251a90)|`Remove forgotten line`|



---

archive/issue_comments_420867.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2017-04-20T09:36:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22832#issuecomment-420867",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_events_075312.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-04-23T12:57:20Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/22832",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22832#event-75312"
}
```



---

archive/issue_comments_420868.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-04-23T12:57:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22832#issuecomment-420868",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_420869.json:
```json
{
    "body": "Changing branch from \"u/jdemeyer/tests/fail-once\" to \"c6a5b40146506795873a1cb7b64e645258251a90\"",
    "created_at": "2017-04-23T12:57:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22832#issuecomment-420869",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/jdemeyer/tests/fail-once" to "c6a5b40146506795873a1cb7b64e645258251a90"
