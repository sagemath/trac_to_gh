# Issue 22604: autodoc unforking again

archive/issues_022367.json:
```json
{
    "assignees": [],
    "body": "Move some changes from upstream Sphinx `autodoc.py` to `sage_autodoc.py`\n\nCC:  @hivert @embray\n\nBranch/Commit: **[`14b02b0`](https://github.com/sagemath/sagetrac-mirror/commit/14b02b01c572840e1c7958a80a397af840f7b1ed)**\n\nReviewer: **Erik Bray**\n\nAuthor: **Jeroen Demeyer**\n\nComponent: **build**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/22604_\n\n",
    "closed_at": "2018-05-08T17:27:24Z",
    "created_at": "2017-03-15T11:48:14Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20build",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "autodoc unforking again",
    "type": "issue",
    "updated_at": "2018-05-08T17:27:24Z",
    "url": "https://github.com/sagemath/sage/issues/22604",
    "user": "https://github.com/jdemeyer"
}
```
Move some changes from upstream Sphinx `autodoc.py` to `sage_autodoc.py`

CC:  @hivert @embray

Branch/Commit: **[`14b02b0`](https://github.com/sagemath/sagetrac-mirror/commit/14b02b01c572840e1c7958a80a397af840f7b1ed)**

Reviewer: **Erik Bray**

Author: **Jeroen Demeyer**

Component: **build**

_Issue created by migration from https://trac.sagemath.org/ticket/22604_





---

archive/issue_events_315760.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-03-15T11:48:14Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/22604",
    "milestone_number": null,
    "milestone_title": "sage-7.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22604#event-315760"
}
```



---

archive/issue_events_315761.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-03-15T11:48:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22604",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20build",
    "label_color": "000080",
    "label_name": "c: build",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22604#event-315761"
}
```



---

archive/issue_events_315762.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-03-15T11:48:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22604",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22604#event-315762"
}
```



---

archive/issue_events_315763.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-03-15T11:48:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22604",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22604#event-315763"
}
```



---

archive/issue_comments_335153.json:
```json
{
    "body": "Dependencies: **#22601**",
    "created_at": "2017-03-15T12:01:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22604",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22604#issuecomment-335153",
    "user": "https://github.com/jdemeyer"
}
```

Dependencies: **#22601**



---

archive/issue_comments_335154.json:
```json
{
    "body": "Branch: **[u/jdemeyer/ticket/22604](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/22604)**",
    "created_at": "2017-03-15T21:19:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22604",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22604#issuecomment-335154",
    "user": "https://github.com/jdemeyer"
}
```

Branch: **[u/jdemeyer/ticket/22604](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/22604)**



---

archive/issue_comments_335155.json:
```json
{
    "body": "Commit: **[`130be6d`](https://github.com/sagemath/sagetrac-mirror/commit/130be6d92070befcf662862c1900156656b5f1ec)**",
    "created_at": "2017-03-15T21:21:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22604",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22604#issuecomment-335155",
    "user": "https://github.com/jdemeyer"
}
```

Commit: **[`130be6d`](https://github.com/sagemath/sagetrac-mirror/commit/130be6d92070befcf662862c1900156656b5f1ec)**



---

archive/issue_comments_335156.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nThis isn't perfect but it's a step in the right direction.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/879c401a54a4c4cb9e0d77fadd1f010c44d9b2a8\"><code>879c401</code></a></td><td><code>Upgrade to Sphinx 1.5.3</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/78e671810360d3e02ec1e0fa6643a0e63f727f39\"><code>78e6718</code></a></td><td><code>Docbuild fixes for Sphinx 1.5.x</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ced49200aefa25b91ff96bb2cbc03fe418ec425b\"><code>ced4920</code></a></td><td><code>Allow running Sphinx without SSL</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3a4e3a13f8dd4a7c683459806f1a4f35c2a228fb\"><code>3a4e3a1</code></a></td><td><code>Upgrade docutils</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/130be6d92070befcf662862c1900156656b5f1ec\"><code>130be6d</code></a></td><td><code>Move upstream changes to autodoc into Sage</code></td></tr></table>\n",
    "created_at": "2017-03-15T21:21:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22604",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22604#issuecomment-335156",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:3" align="right">comment:3</div>

This isn't perfect but it's a step in the right direction.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/879c401a54a4c4cb9e0d77fadd1f010c44d9b2a8"><code>879c401</code></a></td><td><code>Upgrade to Sphinx 1.5.3</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/78e671810360d3e02ec1e0fa6643a0e63f727f39"><code>78e6718</code></a></td><td><code>Docbuild fixes for Sphinx 1.5.x</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ced49200aefa25b91ff96bb2cbc03fe418ec425b"><code>ced4920</code></a></td><td><code>Allow running Sphinx without SSL</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3a4e3a13f8dd4a7c683459806f1a4f35c2a228fb"><code>3a4e3a1</code></a></td><td><code>Upgrade docutils</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/130be6d92070befcf662862c1900156656b5f1ec"><code>130be6d</code></a></td><td><code>Move upstream changes to autodoc into Sage</code></td></tr></table>




---

archive/issue_events_315764.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-03-15T21:21:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22604",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22604#event-315764"
}
```



---

archive/issue_comments_335157.json:
```json
{
    "body": "Changed dependencies from **#22601** to none",
    "created_at": "2018-01-25T08:46:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22604",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22604#issuecomment-335157",
    "user": "https://github.com/jdemeyer"
}
```

Changed dependencies from **#22601** to none



---

archive/issue_events_315765.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-01-25T08:46:20Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/22604",
    "milestone_number": null,
    "milestone_title": "sage-7.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22604#event-315765"
}
```



---

archive/issue_events_315766.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-01-25T08:46:20Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/22604",
    "milestone_number": null,
    "milestone_title": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22604#event-315766"
}
```



---

archive/issue_comments_335158.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nI'm not exactly clear on what this is doing.  Is sage_autodoc a copy of the autodoc module from Sphinx with some patches applied?  Is the point here just to re-apply those patches on top of a newer copy of the module?\n\n(I assume the goal is to eventually do away with the copy entirely...?)",
    "created_at": "2018-03-09T13:17:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22604",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22604#issuecomment-335158",
    "user": "https://github.com/embray"
}
```

<div id="comment:5" align="right">comment:5</div>

I'm not exactly clear on what this is doing.  Is sage_autodoc a copy of the autodoc module from Sphinx with some patches applied?  Is the point here just to re-apply those patches on top of a newer copy of the module?

(I assume the goal is to eventually do away with the copy entirely...?)



---

archive/issue_comments_335159.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nReplying to [@embray](#comment:5):\n> Is sage_autodoc a copy of the autodoc module from Sphinx with some patches applied?\n\nYes.\n\n> Is the point here just to re-apply those patches on top of a newer copy of the module?\n\nNo. The point is to reduce the patching, i.e. reduce the diff between the real autodoc and the Sage autodoc.\n\nIdeally, we should eventually reduce the diff to zero (by fixing Sage and/or Sphinx).",
    "created_at": "2018-03-09T13:22:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22604",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22604#issuecomment-335159",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:6" align="right">comment:6</div>

Replying to [@embray](#comment:5):
> Is sage_autodoc a copy of the autodoc module from Sphinx with some patches applied?

Yes.

> Is the point here just to re-apply those patches on top of a newer copy of the module?

No. The point is to reduce the patching, i.e. reduce the diff between the real autodoc and the Sage autodoc.

Ideally, we should eventually reduce the diff to zero (by fixing Sage and/or Sphinx).



---

archive/issue_comments_335160.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nWell reduce, sure, but it seems like some of both.  That is, you started with the new upstream version, re-applied any patches from Sage, sans patches that are no longer necessary.",
    "created_at": "2018-03-09T13:36:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22604",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22604#issuecomment-335160",
    "user": "https://github.com/embray"
}
```

<div id="comment:7" align="right">comment:7</div>

Well reduce, sure, but it seems like some of both.  That is, you started with the new upstream version, re-applied any patches from Sage, sans patches that are no longer necessary.



---

archive/issue_comments_335161.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nIt might be nice if there were a comment in the module specifying exactly what version of the upstream code this is based on (e.g. with a link to GitHub at the correct revision).  That way it would be easy enough to compare to the original to see what the differences are.",
    "created_at": "2018-03-09T13:38:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22604",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22604#issuecomment-335161",
    "user": "https://github.com/embray"
}
```

<div id="comment:8" align="right">comment:8</div>

It might be nice if there were a comment in the module specifying exactly what version of the upstream code this is based on (e.g. with a link to GitHub at the correct revision).  That way it would be easy enough to compare to the original to see what the differences are.



---

archive/issue_comments_335162.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nReplying to [@embray](#comment:8):\n> It might be nice if there were a comment in the module specifying exactly what version of the upstream code this is based on\n\nIt all started a very long time ago as a fork of the Sphinx autodoc. Many changes have been made, some upstream changes were merged. It's not meaningful to say that it is a fork of a single upstream commit, it's much messier than that.",
    "created_at": "2018-03-16T16:01:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22604",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22604#issuecomment-335162",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:9" align="right">comment:9</div>

Replying to [@embray](#comment:8):
> It might be nice if there were a comment in the module specifying exactly what version of the upstream code this is based on

It all started a very long time ago as a fork of the Sphinx autodoc. Many changes have been made, some upstream changes were merged. It's not meaningful to say that it is a fork of a single upstream commit, it's much messier than that.



---

archive/issue_comments_335163.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nReplying to [@embray](#comment:8):\n> compare to the original to see what the differences are.\n\nWhen I created this ticket, Sage was using Sphinx 1.5.3 so I guess it's best to compare against that: https://github.com/sphinx-doc/sphinx/blob/v1.5.3/sphinx/ext/autodoc.py",
    "created_at": "2018-03-16T16:04:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22604",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22604#issuecomment-335163",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:10" align="right">comment:10</div>

Replying to [@embray](#comment:8):
> compare to the original to see what the differences are.

When I created this ticket, Sage was using Sphinx 1.5.3 so I guess it's best to compare against that: https://github.com/sphinx-doc/sphinx/blob/v1.5.3/sphinx/ext/autodoc.py



---

archive/issue_comments_335164.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nWhat I mean is to just add such a link in the comments in the source, sort of like I did in the comment near the top of https://github.com/sagemath/sagetrac-mirror/blob/develop/src/sage/cpython/_py2_random.py?id=3ee11e056d80c4a9163e5a8d1a8c92e12c34f25b\n\nYou can set positive review once that's done so we can move forward on this.",
    "created_at": "2018-03-21T17:07:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22604",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22604#issuecomment-335164",
    "user": "https://github.com/embray"
}
```

<div id="comment:11" align="right">comment:11</div>

What I mean is to just add such a link in the comments in the source, sort of like I did in the comment near the top of https://github.com/sagemath/sagetrac-mirror/blob/develop/src/sage/cpython/_py2_random.py?id=3ee11e056d80c4a9163e5a8d1a8c92e12c34f25b

You can set positive review once that's done so we can move forward on this.



---

archive/issue_comments_335165.json:
```json
{
    "body": "Reviewer: **Erik Bray**",
    "created_at": "2018-03-21T17:07:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22604",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22604#issuecomment-335165",
    "user": "https://github.com/embray"
}
```

Reviewer: **Erik Bray**



---

archive/issue_comments_335166.json:
```json
{
    "body": "<div id=\"comment:12\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/14b02b01c572840e1c7958a80a397af840f7b1ed\"><code>14b02b0</code></a></td><td><code>Move upstream changes to autodoc into Sage</code></td></tr></table>\n",
    "created_at": "2018-03-22T09:41:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22604",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22604#issuecomment-335166",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:12"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/14b02b01c572840e1c7958a80a397af840f7b1ed"><code>14b02b0</code></a></td><td><code>Move upstream changes to autodoc into Sage</code></td></tr></table>




---

archive/issue_comments_335167.json:
```json
{
    "body": "Changed commit from **[`130be6d`](https://github.com/sagemath/sagetrac-mirror/commit/130be6d92070befcf662862c1900156656b5f1ec)** to **[`14b02b0`](https://github.com/sagemath/sagetrac-mirror/commit/14b02b01c572840e1c7958a80a397af840f7b1ed)**",
    "created_at": "2018-03-22T09:41:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22604",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22604#issuecomment-335167",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`130be6d`](https://github.com/sagemath/sagetrac-mirror/commit/130be6d92070befcf662862c1900156656b5f1ec)** to **[`14b02b0`](https://github.com/sagemath/sagetrac-mirror/commit/14b02b01c572840e1c7958a80a397af840f7b1ed)**



---

archive/issue_events_315767.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-03-22T09:42:29Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22604",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22604#event-315767"
}
```



---

archive/issue_events_315768.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-03-22T09:42:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22604",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22604#event-315768"
}
```



---

archive/issue_events_315769.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-05-08T17:27:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22604",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22604#event-315769"
}
```



---

archive/issue_events_315770.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "cd4ad379e206a7176ec2f5be7170eb4b0d899dad",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2018-05-08T17:27:24Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/22604",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22604#event-315770"
}
```



---

archive/issue_comments_335168.json:
```json
{
    "body": "Changed branch from **[u/jdemeyer/ticket/22604](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/22604)** to **[`14b02b0`](https://github.com/sagemath/sagetrac-mirror/commit/14b02b01c572840e1c7958a80a397af840f7b1ed)**",
    "created_at": "2018-05-08T17:27:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22604",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22604#issuecomment-335168",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/jdemeyer/ticket/22604](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/22604)** to **[`14b02b0`](https://github.com/sagemath/sagetrac-mirror/commit/14b02b01c572840e1c7958a80a397af840f7b1ed)**
