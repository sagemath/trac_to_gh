# Issue 22604: autodoc unforking again

archive/issues_022367.json:
```json
{
    "body": "Move some changes from upstream Sphinx `autodoc.py` to `sage_autodoc.py`\n\n**CC:**  @hivert @embray\n\n**Branch/Commit:** [14b02b01c572840e1c7958a80a397af840f7b1ed](https://github.com/sagemath/sagetrac-mirror/commit/14b02b01c572840e1c7958a80a397af840f7b1ed)\n\n**Reviewer:** Erik Bray\n\n**Author:** Jeroen Demeyer\n\nIssue created by migration from https://trac.sagemath.org/ticket/22604\n\n",
    "closed_at": "2018-05-08T17:27:24Z",
    "created_at": "2017-03-15T11:48:14Z",
    "labels": [
        "component: build",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.2",
    "title": "autodoc unforking again",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22604",
    "user": "https://github.com/jdemeyer"
}
```
Move some changes from upstream Sphinx `autodoc.py` to `sage_autodoc.py`

**CC:**  @hivert @embray

**Branch/Commit:** [14b02b01c572840e1c7958a80a397af840f7b1ed](https://github.com/sagemath/sagetrac-mirror/commit/14b02b01c572840e1c7958a80a397af840f7b1ed)

**Reviewer:** Erik Bray

**Author:** Jeroen Demeyer

Issue created by migration from https://trac.sagemath.org/ticket/22604





---

archive/issue_comments_337612.json:
```json
{
    "body": "**Dependencies:** #22601",
    "created_at": "2017-03-15T12:01:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22604",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22604#issuecomment-337612",
    "user": "https://github.com/jdemeyer"
}
```

**Dependencies:** #22601



---

archive/issue_comments_337613.json:
```json
{
    "body": "**Branch:** [u/jdemeyer/ticket/22604](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/22604)",
    "created_at": "2017-03-15T21:19:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22604",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22604#issuecomment-337613",
    "user": "https://github.com/jdemeyer"
}
```

**Branch:** [u/jdemeyer/ticket/22604](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/22604)



---

archive/issue_comments_337614.json:
```json
{
    "body": "**Commit:** [130be6d92070befcf662862c1900156656b5f1ec](https://github.com/sagemath/sagetrac-mirror/commit/130be6d92070befcf662862c1900156656b5f1ec)",
    "created_at": "2017-03-15T21:21:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22604",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22604#issuecomment-337614",
    "user": "https://github.com/jdemeyer"
}
```

**Commit:** [130be6d92070befcf662862c1900156656b5f1ec](https://github.com/sagemath/sagetrac-mirror/commit/130be6d92070befcf662862c1900156656b5f1ec)



---

archive/issue_comments_337615.json:
```json
{
    "body": "<a id='comment:3'></a>\nThis isn't perfect but it's a step in the right direction.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/879c401a54a4c4cb9e0d77fadd1f010c44d9b2a8\">879c401</a></td><td><code>Upgrade to Sphinx 1.5.3</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/78e671810360d3e02ec1e0fa6643a0e63f727f39\">78e6718</a></td><td><code>Docbuild fixes for Sphinx 1.5.x</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ced49200aefa25b91ff96bb2cbc03fe418ec425b\">ced4920</a></td><td><code>Allow running Sphinx without SSL</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3a4e3a13f8dd4a7c683459806f1a4f35c2a228fb\">3a4e3a1</a></td><td><code>Upgrade docutils</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/130be6d92070befcf662862c1900156656b5f1ec\">130be6d</a></td><td><code>Move upstream changes to autodoc into Sage</code></td></tr></table>\n",
    "created_at": "2017-03-15T21:21:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22604",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22604#issuecomment-337615",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:3'></a>
This isn't perfect but it's a step in the right direction.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/879c401a54a4c4cb9e0d77fadd1f010c44d9b2a8">879c401</a></td><td><code>Upgrade to Sphinx 1.5.3</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/78e671810360d3e02ec1e0fa6643a0e63f727f39">78e6718</a></td><td><code>Docbuild fixes for Sphinx 1.5.x</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ced49200aefa25b91ff96bb2cbc03fe418ec425b">ced4920</a></td><td><code>Allow running Sphinx without SSL</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3a4e3a13f8dd4a7c683459806f1a4f35c2a228fb">3a4e3a1</a></td><td><code>Upgrade docutils</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/130be6d92070befcf662862c1900156656b5f1ec">130be6d</a></td><td><code>Move upstream changes to autodoc into Sage</code></td></tr></table>




---

archive/issue_events_201719.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-03-15T21:21:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22604",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22604#event-201719"
}
```



---

archive/issue_comments_337616.json:
```json
{
    "body": "**Changing dependencies** from \"#22601\" to \"\".",
    "created_at": "2018-01-25T08:46:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22604",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22604#issuecomment-337616",
    "user": "https://github.com/jdemeyer"
}
```

**Changing dependencies** from "#22601" to "".



---

archive/issue_events_201720.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-01-25T08:46:20Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/22604",
    "milestone": "sage-7.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22604#event-201720"
}
```



---

archive/issue_events_201721.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-01-25T08:46:20Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/22604",
    "milestone": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22604#event-201721"
}
```



---

archive/issue_comments_337617.json:
```json
{
    "body": "<a id='comment:5'></a>\nI'm not exactly clear on what this is doing.  Is sage_autodoc a copy of the autodoc module from Sphinx with some patches applied?  Is the point here just to re-apply those patches on top of a newer copy of the module?\n\n(I assume the goal is to eventually do away with the copy entirely...?)",
    "created_at": "2018-03-09T13:17:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22604",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22604#issuecomment-337617",
    "user": "https://github.com/embray"
}
```

<a id='comment:5'></a>
I'm not exactly clear on what this is doing.  Is sage_autodoc a copy of the autodoc module from Sphinx with some patches applied?  Is the point here just to re-apply those patches on top of a newer copy of the module?

(I assume the goal is to eventually do away with the copy entirely...?)



---

archive/issue_comments_337618.json:
```json
{
    "body": "<a id='comment:6'></a>\nReplying to [embray](#comment%3A5):\n> Is sage_autodoc a copy of the autodoc module from Sphinx with some patches applied?\n\n\nYes.\n\n> Is the point here just to re-apply those patches on top of a newer copy of the module?\n\n\nNo. The point is to reduce the patching, i.e. reduce the diff between the real autodoc and the Sage autodoc.\n\nIdeally, we should eventually reduce the diff to zero (by fixing Sage and/or Sphinx).",
    "created_at": "2018-03-09T13:22:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22604",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22604#issuecomment-337618",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:6'></a>
Replying to [embray](#comment%3A5):
> Is sage_autodoc a copy of the autodoc module from Sphinx with some patches applied?


Yes.

> Is the point here just to re-apply those patches on top of a newer copy of the module?


No. The point is to reduce the patching, i.e. reduce the diff between the real autodoc and the Sage autodoc.

Ideally, we should eventually reduce the diff to zero (by fixing Sage and/or Sphinx).



---

archive/issue_comments_337619.json:
```json
{
    "body": "<a id='comment:7'></a>\nWell reduce, sure, but it seems like some of both.  That is, you started with the new upstream version, re-applied any patches from Sage, sans patches that are no longer necessary.",
    "created_at": "2018-03-09T13:36:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22604",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22604#issuecomment-337619",
    "user": "https://github.com/embray"
}
```

<a id='comment:7'></a>
Well reduce, sure, but it seems like some of both.  That is, you started with the new upstream version, re-applied any patches from Sage, sans patches that are no longer necessary.



---

archive/issue_comments_337620.json:
```json
{
    "body": "<a id='comment:8'></a>\nIt might be nice if there were a comment in the module specifying exactly what version of the upstream code this is based on (e.g. with a link to GitHub at the correct revision).  That way it would be easy enough to compare to the original to see what the differences are.",
    "created_at": "2018-03-09T13:38:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22604",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22604#issuecomment-337620",
    "user": "https://github.com/embray"
}
```

<a id='comment:8'></a>
It might be nice if there were a comment in the module specifying exactly what version of the upstream code this is based on (e.g. with a link to GitHub at the correct revision).  That way it would be easy enough to compare to the original to see what the differences are.



---

archive/issue_comments_337621.json:
```json
{
    "body": "<a id='comment:9'></a>\nReplying to [embray](#comment%3A8):\n> It might be nice if there were a comment in the module specifying exactly what version of the upstream code this is based on\n\n\nIt all started a very long time ago as a fork of the Sphinx autodoc. Many changes have been made, some upstream changes were merged. It's not meaningful to say that it is a fork of a single upstream commit, it's much messier than that.",
    "created_at": "2018-03-16T16:01:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22604",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22604#issuecomment-337621",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:9'></a>
Replying to [embray](#comment%3A8):
> It might be nice if there were a comment in the module specifying exactly what version of the upstream code this is based on


It all started a very long time ago as a fork of the Sphinx autodoc. Many changes have been made, some upstream changes were merged. It's not meaningful to say that it is a fork of a single upstream commit, it's much messier than that.



---

archive/issue_comments_337622.json:
```json
{
    "body": "<a id='comment:10'></a>\nReplying to [embray](#comment%3A8):\n> compare to the original to see what the differences are.\n\n\nWhen I created this ticket, Sage was using Sphinx 1.5.3 so I guess it's best to compare against that: https://github.com/sphinx-doc/sphinx/blob/v1.5.3/sphinx/ext/autodoc.py",
    "created_at": "2018-03-16T16:04:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22604",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22604#issuecomment-337622",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:10'></a>
Replying to [embray](#comment%3A8):
> compare to the original to see what the differences are.


When I created this ticket, Sage was using Sphinx 1.5.3 so I guess it's best to compare against that: https://github.com/sphinx-doc/sphinx/blob/v1.5.3/sphinx/ext/autodoc.py



---

archive/issue_comments_337623.json:
```json
{
    "body": "<a id='comment:11'></a>\nWhat I mean is to just add such a link in the comments in the source, sort of like I did in the comment near the top of https://github.com/sagemath/sagetrac-mirror/blob/master/src/sage/cpython/_py2_random.py?id=3ee11e056d80c4a9163e5a8d1a8c92e12c34f25b\n\nYou can set positive review once that's done so we can move forward on this.",
    "created_at": "2018-03-21T17:07:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22604",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22604#issuecomment-337623",
    "user": "https://github.com/embray"
}
```

<a id='comment:11'></a>
What I mean is to just add such a link in the comments in the source, sort of like I did in the comment near the top of https://github.com/sagemath/sagetrac-mirror/blob/master/src/sage/cpython/_py2_random.py?id=3ee11e056d80c4a9163e5a8d1a8c92e12c34f25b

You can set positive review once that's done so we can move forward on this.



---

archive/issue_comments_337624.json:
```json
{
    "body": "**Reviewer:** Erik Bray",
    "created_at": "2018-03-21T17:07:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22604",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22604#issuecomment-337624",
    "user": "https://github.com/embray"
}
```

**Reviewer:** Erik Bray



---

archive/issue_comments_337625.json:
```json
{
    "body": "<a id='comment:12'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/14b02b01c572840e1c7958a80a397af840f7b1ed\">14b02b0</a></td><td><code>Move upstream changes to autodoc into Sage</code></td></tr></table>\n",
    "created_at": "2018-03-22T09:41:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22604",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22604#issuecomment-337625",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/14b02b01c572840e1c7958a80a397af840f7b1ed">14b02b0</a></td><td><code>Move upstream changes to autodoc into Sage</code></td></tr></table>




---

archive/issue_comments_337626.json:
```json
{
    "body": "**Changing commit** from \"[130be6d92070befcf662862c1900156656b5f1ec](https://github.com/sagemath/sagetrac-mirror/commit/130be6d92070befcf662862c1900156656b5f1ec)\" to \"[14b02b01c572840e1c7958a80a397af840f7b1ed](https://github.com/sagemath/sagetrac-mirror/commit/14b02b01c572840e1c7958a80a397af840f7b1ed)\".",
    "created_at": "2018-03-22T09:41:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22604",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22604#issuecomment-337626",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[130be6d92070befcf662862c1900156656b5f1ec](https://github.com/sagemath/sagetrac-mirror/commit/130be6d92070befcf662862c1900156656b5f1ec)" to "[14b02b01c572840e1c7958a80a397af840f7b1ed](https://github.com/sagemath/sagetrac-mirror/commit/14b02b01c572840e1c7958a80a397af840f7b1ed)".



---

archive/issue_events_201722.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-03-22T09:42:29Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22604",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22604#event-201722"
}
```



---

archive/issue_events_201723.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-03-22T09:42:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22604",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22604#event-201723"
}
```



---

archive/issue_events_201724.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-05-08T17:27:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22604",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22604#event-201724"
}
```



---

archive/issue_events_201725.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-05-08T17:27:24Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/22604",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22604#event-201725"
}
```



---

archive/issue_comments_337627.json:
```json
{
    "body": "**Changing branch** from \"[u/jdemeyer/ticket/22604](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/22604)\" to \"[14b02b01c572840e1c7958a80a397af840f7b1ed](https://github.com/sagemath/sagetrac-mirror/commit/14b02b01c572840e1c7958a80a397af840f7b1ed)\".",
    "created_at": "2018-05-08T17:27:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22604",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22604#issuecomment-337627",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/jdemeyer/ticket/22604](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/22604)" to "[14b02b01c572840e1c7958a80a397af840f7b1ed](https://github.com/sagemath/sagetrac-mirror/commit/14b02b01c572840e1c7958a80a397af840f7b1ed)".
