# Issue 22841: Speed up hermite normal form and weak popov form for polynomial matrices

archive/issues_022604.json:
```json
{
    "body": "This ticket provides faster Hermite normal form and weak Popov form computations for polynomial matrices. \n\nBranch/Commit: dd0d0654cc9a4781aba4643443074853c2f03bce\n\nReviewer: Vincent Delecroix\n\nAuthor: Kwankyu Lee\n\nDependencies: #23050\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/22841\n\n",
    "closed_at": "2017-06-22T07:23:36Z",
    "created_at": "2017-04-20T13:45:43Z",
    "labels": [
        "component: linear algebra",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.0",
    "title": "Speed up hermite normal form and weak popov form for polynomial matrices",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22841",
    "user": "https://github.com/kwankyu"
}
```
This ticket provides faster Hermite normal form and weak Popov form computations for polynomial matrices. 

Branch/Commit: dd0d0654cc9a4781aba4643443074853c2f03bce

Reviewer: Vincent Delecroix

Author: Kwankyu Lee

Dependencies: #23050

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/22841





---

archive/issue_comments_335792.json:
```json
{
    "body": "<a id='comment:1'></a>New commits:",
    "created_at": "2017-04-20T13:48:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22841",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22841#issuecomment-335792",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:1'></a>New commits:



---

archive/issue_comments_335793.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-This ticket provides faster Hermite normal form and weak Popov form computations for polynomial matrices.\n+This ticket provides faster Hermite normal form and weak Popov form computations for polynomial matrices. A new reversed Hermite normal form method is added; This is useful for some applications.\n \n Comment: 1\n \n```\n",
    "created_at": "2017-04-20T13:52:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22841",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22841#issuecomment-335793",
    "user": "https://github.com/kwankyu"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,4 @@
-This ticket provides faster Hermite normal form and weak Popov form computations for polynomial matrices.
+This ticket provides faster Hermite normal form and weak Popov form computations for polynomial matrices. A new reversed Hermite normal form method is added; This is useful for some applications.
 
 Comment: 1
 
```




---

archive/issue_comments_335794.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-04-24T23:45:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22841",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22841#issuecomment-335794",
    "user": "https://github.com/kwankyu"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_335795.json:
```json
{
    "body": "<a id='comment:4'></a>The code looks good.\n\n1) Why these new methods are cpdef? It will make any difference if you **repeatedly** call such method. Which I do not think is the case for most application.\n\n2) The logic of\n\n```\nshift = False\nif shifts:\n    shift = True\n```\nis quite confusing. You can use `if shifts` instead of `if shift` anywhere.\n\n3) Does `hermite_form_reversed` just the transposed of the hermite form of the transposed matrix or with respect to row/column ordering? If so, you can just remove the method (one can apply some permutations of entries first and then call the standard algorithm). If not, you should clarify the documentation.\n\n4) As far as I can see, most of the code in `_hermite_form_euclidean` is not polynomial specific but would work as soon as you have `xgcd`. The only missing piece is the normalization to monic polynomial. Am I right? In that case, it would be good to have this code available more generally.\n\n5) Instead of\n\n```\nif transformation:\n    U = A._hermite_form_euclidean(transformation=True)\n    if not include_zero_rows:\n        i = A.nrows() - 1\n        while i >= 0 and A.row(i) == 0:\n            i -= 1\n        A = A[:i+1]\n        U = U[:i+1]\n    return A, U\nelse:\n    A._hermite_form_euclidean(transformation=False)\n    if not include_zero_rows:\n        i = A.nrows() - 1\n        while i >= 0 and A.row(i) == 0:\n            i -= 1\n        A = A[:i+1]\n    return A\n```\nwhy not\n\n```\nU = A._hermite_form_euclidean(transformation=transformation)\nif not include_zero_rows:\n    i = A.nrows() - 1\n    while i >= 0 and A.row(i) == 0:\n        i -= 1\n    A = A[:i+1]\n    if transformation\n        U = U[:i+1]\n\nreturn (A, U) if transformation else A\n```\n\n7) You claim that there is a speed up. Could you provide some relevant timings?\n\n8) Please fill the \"Authors\" field of the ticket with your full name",
    "created_at": "2017-05-19T18:08:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22841",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22841#issuecomment-335795",
    "user": "https://github.com/videlec"
}
```

<a id='comment:4'></a>The code looks good.

1) Why these new methods are cpdef? It will make any difference if you **repeatedly** call such method. Which I do not think is the case for most application.

2) The logic of

```
shift = False
if shifts:
    shift = True
```
is quite confusing. You can use `if shifts` instead of `if shift` anywhere.

3) Does `hermite_form_reversed` just the transposed of the hermite form of the transposed matrix or with respect to row/column ordering? If so, you can just remove the method (one can apply some permutations of entries first and then call the standard algorithm). If not, you should clarify the documentation.

4) As far as I can see, most of the code in `_hermite_form_euclidean` is not polynomial specific but would work as soon as you have `xgcd`. The only missing piece is the normalization to monic polynomial. Am I right? In that case, it would be good to have this code available more generally.

5) Instead of

```
if transformation:
    U = A._hermite_form_euclidean(transformation=True)
    if not include_zero_rows:
        i = A.nrows() - 1
        while i >= 0 and A.row(i) == 0:
            i -= 1
        A = A[:i+1]
        U = U[:i+1]
    return A, U
else:
    A._hermite_form_euclidean(transformation=False)
    if not include_zero_rows:
        i = A.nrows() - 1
        while i >= 0 and A.row(i) == 0:
            i -= 1
        A = A[:i+1]
    return A
```
why not

```
U = A._hermite_form_euclidean(transformation=transformation)
if not include_zero_rows:
    i = A.nrows() - 1
    while i >= 0 and A.row(i) == 0:
        i -= 1
    A = A[:i+1]
    if transformation
        U = U[:i+1]

return (A, U) if transformation else A
```

7) You claim that there is a speed up. Could you provide some relevant timings?

8) Please fill the "Authors" field of the ticket with your full name



---

archive/issue_comments_335796.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-05-19T18:08:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22841",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22841#issuecomment-335796",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_335797.json:
```json
{
    "body": "<a id='comment:5'></a>> 3) Does `hermite_form_reversed` just the transposed of the hermite form of the transposed matrix or with respect to row/column ordering? If so, you can just remove the method (one can apply some permutations of entries first and then call the standard algorithm). If not, you should clarify the documentation.\n\n\nThe output of `hermite_form_reversed` for matrix X is the row-and-column-reversed matrix of the hermite_form of the row-and-column-reversed matrix of X. So you are right that `hermite_form_reversed` can be implemented with the standard hermite form algorithm and some reversals of entries. \n\nThe issue is speed. I have an application for which reversed hermite forms are natural, and it is crucial to have this algorithm as fast as possible. I cannot lose any time in reversing entries. For me, I would rather keep `hermite_form_reversed` and make `hermite_form` do the reversals! But should I?\n\n(I will respond to your other comments later)",
    "created_at": "2017-05-19T22:39:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22841",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22841#issuecomment-335797",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:5'></a>> 3) Does `hermite_form_reversed` just the transposed of the hermite form of the transposed matrix or with respect to row/column ordering? If so, you can just remove the method (one can apply some permutations of entries first and then call the standard algorithm). If not, you should clarify the documentation.


The output of `hermite_form_reversed` for matrix X is the row-and-column-reversed matrix of the hermite_form of the row-and-column-reversed matrix of X. So you are right that `hermite_form_reversed` can be implemented with the standard hermite form algorithm and some reversals of entries. 

The issue is speed. I have an application for which reversed hermite forms are natural, and it is crucial to have this algorithm as fast as possible. I cannot lose any time in reversing entries. For me, I would rather keep `hermite_form_reversed` and make `hermite_form` do the reversals! But should I?

(I will respond to your other comments later)



---

archive/issue_comments_335798.json:
```json
{
    "body": "<a id='comment:6'></a>Replying to [comment:5 klee]:\n> > 3) Does `hermite_form_reversed` just the transposed of the hermite form of the transposed matrix or with respect to row/column ordering? If so, you can just remove the method (one can apply some permutations of entries first and then call the standard algorithm). If not, you should clarify the documentation.\n\n> \n> The output of `hermite_form_reversed` for matrix X is the row-and-column-reversed matrix of the hermite_form of the row-and-column-reversed matrix of X. So you are right that `hermite_form_reversed` can be implemented with the standard hermite form algorithm and some reversals of entries. \n> \n> The issue is speed. I have an application for which reversed hermite forms are natural, and it is crucial to have this algorithm as fast as possible. I cannot lose any time in reversing entries. For me, I would rather keep `hermite_form_reversed` and make `hermite_form` do the reversals! But should I?\n\n\nReversing the entries will definitely not be time critical (zero copy, it is just swapping some pointers). The algorithm will spend much more time doing polynomial divisions. Am I correct that you call the row-and-column reversed matrix `(i,j) -> m[nrows - i - 1, ncols - j - 1]`?\n\nIf I had to choose I would implement only `hermite_form` and do in your algorithm\n\n```\nmy_matrix.reverse_rows_and_columns()\nhnf = my_matrix.hermite_form()\nmy_matrix.reverse_rows_and_columns()  # put back the matrix in the right order\n```\nIf you need help, I can implement this `reverse_rows_and_columns`.",
    "created_at": "2017-05-22T07:01:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22841",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22841#issuecomment-335798",
    "user": "https://github.com/videlec"
}
```

<a id='comment:6'></a>Replying to [comment:5 klee]:
> > 3) Does `hermite_form_reversed` just the transposed of the hermite form of the transposed matrix or with respect to row/column ordering? If so, you can just remove the method (one can apply some permutations of entries first and then call the standard algorithm). If not, you should clarify the documentation.

> 
> The output of `hermite_form_reversed` for matrix X is the row-and-column-reversed matrix of the hermite_form of the row-and-column-reversed matrix of X. So you are right that `hermite_form_reversed` can be implemented with the standard hermite form algorithm and some reversals of entries. 
> 
> The issue is speed. I have an application for which reversed hermite forms are natural, and it is crucial to have this algorithm as fast as possible. I cannot lose any time in reversing entries. For me, I would rather keep `hermite_form_reversed` and make `hermite_form` do the reversals! But should I?


Reversing the entries will definitely not be time critical (zero copy, it is just swapping some pointers). The algorithm will spend much more time doing polynomial divisions. Am I correct that you call the row-and-column reversed matrix `(i,j) -> m[nrows - i - 1, ncols - j - 1]`?

If I had to choose I would implement only `hermite_form` and do in your algorithm

```
my_matrix.reverse_rows_and_columns()
hnf = my_matrix.hermite_form()
my_matrix.reverse_rows_and_columns()  # put back the matrix in the right order
```
If you need help, I can implement this `reverse_rows_and_columns`.



---

archive/issue_comments_335799.json:
```json
{
    "body": "<a id='comment:7'></a>Replying to [comment:6 vdelecroix]: \n> Reversing the entries will definitely not be time critical (zero copy, it is just swapping some pointers). The algorithm will spend much more time doing polynomial divisions. \n\n\nI know. I once experimented with that row-and-column reversing. At that time, I was obsessed with timings and could not afford even that small time losing in reversing. My application computes lots of reversed hermite form. Here it is\n\nhttps://trac.sagemath.org/ticket/22982\n\nif you are interested.\n\n> Am I correct that you call the row-and-column reversed matrix `(i,j) -> m[nrows - i - 1, ncols - j - 1]`?\n\n\nYes.\n\n> If I had to choose I would implement only `hermite_form` and do in your algorithm\n> \n> ```\n> my_matrix.reverse_rows_and_columns()\n> hnf = my_matrix.hermite_form()\n> my_matrix.reverse_rows_and_columns()  # put back the matrix in the right order\n> ```\n\n\nI understand your concern; it is a burden to keep two versions of essentially the same algorithm. Hmm. Now that I am out of that timing obsession, I will check again if I can live with only the standard hermite form. \n\n> If you need help, I can implement this `reverse_rows_and_columns`.\n\n\nCan you think of an implementation simpler or faster than this?\n\n```\ndef reverse_rows_and_columns(m):\n    return matrix([e for e in reversed(m.list())])\n```",
    "created_at": "2017-05-22T07:25:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22841",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22841#issuecomment-335799",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:7'></a>Replying to [comment:6 vdelecroix]: 
> Reversing the entries will definitely not be time critical (zero copy, it is just swapping some pointers). The algorithm will spend much more time doing polynomial divisions. 


I know. I once experimented with that row-and-column reversing. At that time, I was obsessed with timings and could not afford even that small time losing in reversing. My application computes lots of reversed hermite form. Here it is

https://trac.sagemath.org/ticket/22982

if you are interested.

> Am I correct that you call the row-and-column reversed matrix `(i,j) -> m[nrows - i - 1, ncols - j - 1]`?


Yes.

> If I had to choose I would implement only `hermite_form` and do in your algorithm
> 
> ```
> my_matrix.reverse_rows_and_columns()
> hnf = my_matrix.hermite_form()
> my_matrix.reverse_rows_and_columns()  # put back the matrix in the right order
> ```


I understand your concern; it is a burden to keep two versions of essentially the same algorithm. Hmm. Now that I am out of that timing obsession, I will check again if I can live with only the standard hermite form. 

> If you need help, I can implement this `reverse_rows_and_columns`.


Can you think of an implementation simpler or faster than this?

```
def reverse_rows_and_columns(m):
    return matrix([e for e in reversed(m.list())])
```



---

archive/issue_comments_335800.json:
```json
{
    "body": "<a id='comment:8'></a>Replying to [comment:7 klee]:\n> Replying to [comment:6 vdelecroix]: \n> Can you think of an implementation simpler or faster than this?\n> \n> ```\n> def reverse_rows_and_columns(m):\n>     return matrix([e for e in reversed(m.list())])\n> ```\n\n\nOf course! This is damn slow (and makes a copy).",
    "created_at": "2017-05-22T07:29:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22841",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22841#issuecomment-335800",
    "user": "https://github.com/videlec"
}
```

<a id='comment:8'></a>Replying to [comment:7 klee]:
> Replying to [comment:6 vdelecroix]: 
> Can you think of an implementation simpler or faster than this?
> 
> ```
> def reverse_rows_and_columns(m):
>     return matrix([e for e in reversed(m.list())])
> ```


Of course! This is damn slow (and makes a copy).



---

archive/issue_comments_335801.json:
```json
{
    "body": "<a id='comment:9'></a>Replying to [comment:8 vdelecroix]:\n> Replying to [comment:7 klee]:\n> > Replying to [comment:6 vdelecroix]: \n> > Can you think of an implementation simpler or faster than this?\n> > \n> > ```\n> > def reverse_rows_and_columns(m):\n> >     return matrix([e for e in reversed(m.list())])\n> > ```\n\n> \n> Of course! This is damn slow (and makes a copy).\n\n\nSee #23050.",
    "created_at": "2017-05-22T08:05:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22841",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22841#issuecomment-335801",
    "user": "https://github.com/videlec"
}
```

<a id='comment:9'></a>Replying to [comment:8 vdelecroix]:
> Replying to [comment:7 klee]:
> > Replying to [comment:6 vdelecroix]: 
> > Can you think of an implementation simpler or faster than this?
> > 
> > ```
> > def reverse_rows_and_columns(m):
> >     return matrix([e for e in reversed(m.list())])
> > ```

> 
> Of course! This is damn slow (and makes a copy).


See #23050.



---

archive/issue_comments_335802.json:
```json
{
    "body": "<a id='comment:10'></a>And for timings\n\n```\nsage: m = random_matrix(ZZ['x'], 10, 10)\nsage: %timeit m.reverse_rows_and_columns()\n10000000 loops, best of 3: 100 ns per loop\n\nsage: m = random_matrix(ZZ['x'], 100, 100)\nsage: %timeit m.reverse_rows_and_columns()\n100000 loops, best of 3: 3.76 \u00b5s per loop\n```",
    "created_at": "2017-05-22T08:06:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22841",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22841#issuecomment-335802",
    "user": "https://github.com/videlec"
}
```

<a id='comment:10'></a>And for timings

```
sage: m = random_matrix(ZZ['x'], 10, 10)
sage: %timeit m.reverse_rows_and_columns()
10000000 loops, best of 3: 100 ns per loop

sage: m = random_matrix(ZZ['x'], 100, 100)
sage: %timeit m.reverse_rows_and_columns()
100000 loops, best of 3: 3.76 µs per loop
```



---

archive/issue_comments_335803.json:
```json
{
    "body": "<a id='comment:11'></a>Your version with the function is 2000x slower for 10x10 matrices!",
    "created_at": "2017-05-22T08:09:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22841",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22841#issuecomment-335803",
    "user": "https://github.com/videlec"
}
```

<a id='comment:11'></a>Your version with the function is 2000x slower for 10x10 matrices!



---

archive/issue_comments_335804.json:
```json
{
    "body": "<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-05-22T21:52:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22841",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22841#issuecomment-335804",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_335805.json:
```json
{
    "body": "<a id='comment:13'></a>Some timings\n\nBefore the patch:\n\n```\nsage: P.<x> = GF(5)[]\nsage: m = matrix(P,5,[x^((i-j) % 5) + i for i in range(5) for j in range(5)])\nsage: timeit('m.weak_popov_form()')\n625 loops, best of 3: 54.4 \u00b5s per loop\nsage: timeit('m.hermite_form()')\n125 loops, best of 3: 2.49 ms per loop\n```\n\nAfter the patch:\n\n```\nsage: P.<x> = GF(5)[]\nsage: m = matrix(P,5,[x^((i-j) % 5) + i for i in range(5) for j in range(5)])\nsage: timeit('m.weak_popov_form()')\n625 loops, best of 3: 5.17 \u00b5s per loop\nsage: timeit('m.hermite_form()')\n625 loops, best of 3: 171 \u00b5s per loop\n```",
    "created_at": "2017-05-22T22:02:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22841",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22841#issuecomment-335805",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:13'></a>Some timings

Before the patch:

```
sage: P.<x> = GF(5)[]
sage: m = matrix(P,5,[x^((i-j) % 5) + i for i in range(5) for j in range(5)])
sage: timeit('m.weak_popov_form()')
625 loops, best of 3: 54.4 µs per loop
sage: timeit('m.hermite_form()')
125 loops, best of 3: 2.49 ms per loop
```

After the patch:

```
sage: P.<x> = GF(5)[]
sage: m = matrix(P,5,[x^((i-j) % 5) + i for i in range(5) for j in range(5)])
sage: timeit('m.weak_popov_form()')
625 loops, best of 3: 5.17 µs per loop
sage: timeit('m.hermite_form()')
625 loops, best of 3: 171 µs per loop
```



---

archive/issue_comments_335806.json:
```json
{
    "body": "<a id='comment:14'></a>More timings for a larger matrix:\n\nBefore the patch:\n\n```\nsage: P.<x> = GF(5)[]\nsage: m = matrix(P,50,[x^((i-j) % 20) + i for i in range(50) for j in range(50)])\nsage: timeit('m.hermite_form()')\n... (seemingly takes forever; interrupted)\nsage: timeit('m.weak_popov_form()')\n125 loops, best of 3: 2.61 ms per loop\n```\n\nAfter the patch:\n\n```\nsage: P.<x> = GF(5)[]\nsage: m = matrix(P,50,[x^((i-j) % 20) + i for i in range(50) for j in range(50)])\nsage: timeit('m.hermite_form()')\n5 loops, best of 3: 116 ms per loop\nsage: timeit('m.weak_popov_form()')\n625 loops, best of 3: 1.61 ms per loop\n```",
    "created_at": "2017-05-22T22:11:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22841",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22841#issuecomment-335806",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:14'></a>More timings for a larger matrix:

Before the patch:

```
sage: P.<x> = GF(5)[]
sage: m = matrix(P,50,[x^((i-j) % 20) + i for i in range(50) for j in range(50)])
sage: timeit('m.hermite_form()')
... (seemingly takes forever; interrupted)
sage: timeit('m.weak_popov_form()')
125 loops, best of 3: 2.61 ms per loop
```

After the patch:

```
sage: P.<x> = GF(5)[]
sage: m = matrix(P,50,[x^((i-j) % 20) + i for i in range(50) for j in range(50)])
sage: timeit('m.hermite_form()')
5 loops, best of 3: 116 ms per loop
sage: timeit('m.weak_popov_form()')
625 loops, best of 3: 1.61 ms per loop
```



---

archive/issue_comments_335807.json:
```json
{
    "body": "<a id='comment:15'></a>> 1) Why these new methods are cpdef? \n\n\nNow they are `def` methods.\n\n> 2) You can use `if shifts` instead of `if shift` anywhere.\n\n\nThat will incur many useless conversions (from a list to a boolean). I kept `shift` but reshaped the code slightly to be less confusing, hopefully.\n \n> 4) As far as I can see, most of the code in `_hermite_form_euclidean` is not polynomial specific but would work as soon as you have `xgcd`. The only missing piece is the normalization to monic polynomial. Am I right? In that case, it would be good to have this code available more generally.\n\n\nTrue. But for that, the normalization part should be removed, and I am not interested in doing this work myself. I want to leave this work to a separate ticket and to others.\n> \n> 5) Instead of ...\n\n\nDone. Thanks.\n\n> 7) You claim that there is a speed up. Could you provide some relevant timings?\n\n\nDone.\n \n> 8) Please fill the \"Authors\" field of the ticket with your full name\n\n\nDone.",
    "created_at": "2017-05-22T22:26:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22841",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22841#issuecomment-335807",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:15'></a>> 1) Why these new methods are cpdef? 


Now they are `def` methods.

> 2) You can use `if shifts` instead of `if shift` anywhere.


That will incur many useless conversions (from a list to a boolean). I kept `shift` but reshaped the code slightly to be less confusing, hopefully.
 
> 4) As far as I can see, most of the code in `_hermite_form_euclidean` is not polynomial specific but would work as soon as you have `xgcd`. The only missing piece is the normalization to monic polynomial. Am I right? In that case, it would be good to have this code available more generally.


True. But for that, the normalization part should be removed, and I am not interested in doing this work myself. I want to leave this work to a separate ticket and to others.
> 
> 5) Instead of ...


Done. Thanks.

> 7) You claim that there is a speed up. Could you provide some relevant timings?


Done.
 
> 8) Please fill the "Authors" field of the ticket with your full name


Done.



---

archive/issue_comments_335808.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,6 @@\n+This ticket provides faster Hermite normal form and weak Popov form computations for polynomial matrices. A new reversed Hermite normal form method is added; This is useful for some applications.\n \n+Dependency:  #23050 (merged to the patch)\n \n Comment: 1\n \n```\n",
    "created_at": "2017-05-22T22:29:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22841",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22841#issuecomment-335808",
    "user": "https://github.com/kwankyu"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,6 @@
+This ticket provides faster Hermite normal form and weak Popov form computations for polynomial matrices. A new reversed Hermite normal form method is added; This is useful for some applications.
 
+Dependency:  #23050 (merged to the patch)
 
 Comment: 1
 
```




---

archive/issue_comments_335809.json:
```json
{
    "body": "<a id='comment:17'></a>AFAIK, there is no penalty for making a method `cpdef`, but there could be a benefit for those times it does get called though a C codepath. IIRC, it also means it gets to call `cdef` functions as C functions without some extra. Vincent, is there a reason I don't know about for not making these `cpdef`? There also looks like there are some other variables that you could explicitly declare their types.\n\nThis is not true:\n\n```\nboolean (default: ``None``) A tuple or list of integers\n```\nAlso, the boolean check of, e.g., a list should be very quick and insignificant in terms of speed, but it can make the code easier to maintain in the long run.\n\nSomething I have found that I wish Python would do is return the object even when you do something that mutates it. This allows you to chain operations together in a more natural way, e.g.,\n\n```\nM._weak_popov_form().transpose()\n```",
    "created_at": "2017-05-23T04:20:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22841",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22841#issuecomment-335809",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:17'></a>AFAIK, there is no penalty for making a method `cpdef`, but there could be a benefit for those times it does get called though a C codepath. IIRC, it also means it gets to call `cdef` functions as C functions without some extra. Vincent, is there a reason I don't know about for not making these `cpdef`? There also looks like there are some other variables that you could explicitly declare their types.

This is not true:

```
boolean (default: ``None``) A tuple or list of integers
```
Also, the boolean check of, e.g., a list should be very quick and insignificant in terms of speed, but it can make the code easier to maintain in the long run.

Something I have found that I wish Python would do is return the object even when you do something that mutates it. This allows you to chain operations together in a more natural way, e.g.,

```
M._weak_popov_form().transpose()
```



---

archive/issue_comments_335810.json:
```json
{
    "body": "<a id='comment:18'></a>Replying to [comment:17 tscrim]:\n> AFAIK, there is no penalty for making a method `cpdef`, but there could be a benefit for those times it does get called though a C codepath. IIRC, it also means it gets to call `cdef` functions as C functions without some extra. Vincent, is there a reason I don't know about for not making these `cpdef`? \n\n\n-1 the time is not spent in the function call. It is an extra complication for no use. If the code can stay simpler keep it simpler.\n\n> There also looks like there are some other variables that you could explicitly declare their types.\n\n\n+1\n\n> Also, the boolean check of, e.g., a list should be very quick and insignificant in terms of speed, but it can make the code easier to maintain in the long run.\n\n\n+1. There is no such thing as a conversion. `if my_list` is as fast as it can be. Anyway, if you seriously care about speed, this is not the kind of things you want to optimize.",
    "created_at": "2017-05-23T06:41:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22841",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22841#issuecomment-335810",
    "user": "https://github.com/videlec"
}
```

<a id='comment:18'></a>Replying to [comment:17 tscrim]:
> AFAIK, there is no penalty for making a method `cpdef`, but there could be a benefit for those times it does get called though a C codepath. IIRC, it also means it gets to call `cdef` functions as C functions without some extra. Vincent, is there a reason I don't know about for not making these `cpdef`? 


-1 the time is not spent in the function call. It is an extra complication for no use. If the code can stay simpler keep it simpler.

> There also looks like there are some other variables that you could explicitly declare their types.


+1

> Also, the boolean check of, e.g., a list should be very quick and insignificant in terms of speed, but it can make the code easier to maintain in the long run.


+1. There is no such thing as a conversion. `if my_list` is as fast as it can be. Anyway, if you seriously care about speed, this is not the kind of things you want to optimize.



---

archive/issue_comments_335811.json:
```json
{
    "body": "<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-05-23T16:09:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22841",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22841#issuecomment-335811",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_335812.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-05-23T16:11:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22841",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22841#issuecomment-335812",
    "user": "https://github.com/kwankyu"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_335813.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,6 @@\n+This ticket provides faster Hermite normal form and weak Popov form computations for polynomial matrices. A new reversed Hermite normal form method is added; This is useful for some applications.\n \n+Depends:  #23050 (merged to the patch)\n \n Comment: 1\n \n```\n",
    "created_at": "2017-05-23T16:11:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22841",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22841#issuecomment-335813",
    "user": "https://github.com/kwankyu"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,6 @@
+This ticket provides faster Hermite normal form and weak Popov form computations for polynomial matrices. A new reversed Hermite normal form method is added; This is useful for some applications.
 
+Depends:  #23050 (merged to the patch)
 
 Comment: 1
 
```




---

archive/issue_comments_335814.json:
```json
{
    "body": "<a id='comment:21'></a>There is a field \"Dependencies\" in the ticket for dependencies...",
    "created_at": "2017-05-23T16:12:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22841",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22841#issuecomment-335814",
    "user": "https://github.com/videlec"
}
```

<a id='comment:21'></a>There is a field "Dependencies" in the ticket for dependencies...



---

archive/issue_comments_335815.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-\n+This ticket provides faster Hermite normal form and weak Popov form computations for polynomial matrices. A new reversed Hermite normal form method is added; This is useful for some applications.\n \n Comment: 1\n \n```\n",
    "created_at": "2017-05-23T16:12:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22841",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22841#issuecomment-335815",
    "user": "https://github.com/videlec"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,4 @@
-
+This ticket provides faster Hermite normal form and weak Popov form computations for polynomial matrices. A new reversed Hermite normal form method is added; This is useful for some applications.
 
 Comment: 1
 
```




---

archive/issue_comments_335816.json:
```json
{
    "body": "<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-05-23T16:25:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22841",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22841#issuecomment-335816",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_335817.json:
```json
{
    "body": "<a id='comment:23'></a>Replying to [comment:4 vdelecroix]:\n\n> 4) As far as I can see, most of the code in `_hermite_form_euclidean` is not polynomial specific but would work as soon as you have `xgcd`. The only missing piece is the normalization to monic polynomial. Am I right? In that case, it would be good to have this code available more generally.\n\n\nMy previous response to this comment was somewhat adequate. I now try to answer again.\n\nI didn't want to put the code into a more general place like `matrix2.pyx`, because that would incur some condition checking for every call of `hermite_form`.  It was just clean to put the code into the file dedicated for polynomial matrices. \n\nNow it occurs to me that putting just `_hermite_form_euclidean` to `matrix2.pyx` (but keeping `hermite_form` to the present place) may not hurt. The normalization code depending on `lc()` may be put into a `try` clause. Then  the `_hermite_form_euclidean` could be used to provide `hermite_form()` for matrices for other euclidean domains, in future.\n\nIf you agree, then I can do this part: putting `_hermite_form_euclidean` to `matrix2.pyx`. But I will leave it as a future task to to provide `hermite_form()` for matrices for other euclidean domains (though I cannot imagine what these would be in practice right now...).\n\nPerhaps this was in your mind when you wrote the comment :-)",
    "created_at": "2017-05-23T21:04:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22841",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22841#issuecomment-335817",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:23'></a>Replying to [comment:4 vdelecroix]:

> 4) As far as I can see, most of the code in `_hermite_form_euclidean` is not polynomial specific but would work as soon as you have `xgcd`. The only missing piece is the normalization to monic polynomial. Am I right? In that case, it would be good to have this code available more generally.


My previous response to this comment was somewhat adequate. I now try to answer again.

I didn't want to put the code into a more general place like `matrix2.pyx`, because that would incur some condition checking for every call of `hermite_form`.  It was just clean to put the code into the file dedicated for polynomial matrices. 

Now it occurs to me that putting just `_hermite_form_euclidean` to `matrix2.pyx` (but keeping `hermite_form` to the present place) may not hurt. The normalization code depending on `lc()` may be put into a `try` clause. Then  the `_hermite_form_euclidean` could be used to provide `hermite_form()` for matrices for other euclidean domains, in future.

If you agree, then I can do this part: putting `_hermite_form_euclidean` to `matrix2.pyx`. But I will leave it as a future task to to provide `hermite_form()` for matrices for other euclidean domains (though I cannot imagine what these would be in practice right now...).

Perhaps this was in your mind when you wrote the comment :-)



---

archive/issue_comments_335818.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-05-24T10:25:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22841",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22841#issuecomment-335818",
    "user": "https://github.com/kwankyu"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_335819.json:
```json
{
    "body": "<a id='comment:25'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-05-24T11:57:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22841",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22841#issuecomment-335819",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:25'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_335820.json:
```json
{
    "body": "<a id='comment:26'></a>> I can do this part: putting `_hermite_form_euclidean` to `matrix2.pyx`. \n\n\nDone.",
    "created_at": "2017-05-24T12:00:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22841",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22841#issuecomment-335820",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:26'></a>> I can do this part: putting `_hermite_form_euclidean` to `matrix2.pyx`. 


Done.



---

archive/issue_comments_335821.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-05-24T12:00:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22841",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22841#issuecomment-335821",
    "user": "https://github.com/kwankyu"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_335822.json:
```json
{
    "body": "<a id='comment:28'></a>I don't mind that you move `_hermite_form_euclidean`. But if you do, it must be tested with other base rings than polynomials. My question was more of a prospective form (Hermite form is useful to study submodules and quotients of free modules).",
    "created_at": "2017-05-24T13:09:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22841",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22841#issuecomment-335822",
    "user": "https://github.com/videlec"
}
```

<a id='comment:28'></a>I don't mind that you move `_hermite_form_euclidean`. But if you do, it must be tested with other base rings than polynomials. My question was more of a prospective form (Hermite form is useful to study submodules and quotients of free modules).



---

archive/issue_comments_335823.json:
```json
{
    "body": "<a id='comment:29'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-05-24T16:34:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22841",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22841#issuecomment-335823",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:29'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_335824.json:
```json
{
    "body": "<a id='comment:30'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-05-26T17:42:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22841",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22841#issuecomment-335824",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:30'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_335825.json:
```json
{
    "body": "<a id='comment:31'></a>Is there a need for both `hermite_form_reversed` and `_reversed_hermite_form_euclidean`?",
    "created_at": "2017-05-29T14:10:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22841",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22841#issuecomment-335825",
    "user": "https://github.com/videlec"
}
```

<a id='comment:31'></a>Is there a need for both `hermite_form_reversed` and `_reversed_hermite_form_euclidean`?



---

archive/issue_comments_335826.json:
```json
{
    "body": "<a id='comment:32'></a>Would be more natural to replace\n\n```\nfor c in range(j,n):\n    temp = A.get_unsafe(k,c)\n    A.set_unsafe(k, c, p * A.get_unsafe(k,c) + q * A.get_unsafe(l,c))\n    A.set_unsafe(l, c, (-f) * temp + e * A.get_unsafe(l,c))\n```\nwith\n\n```\nfor c in range(j,n):\n    Akc = A.get_unsafe(k,c)\n    Alc = A.get_unsafe(l,c)\n    A.set_unsafe(k, c, p * Akc + q * Alc)\n    A.set_unsafe(l, c, -f * Akc + e * Alc)\n```",
    "created_at": "2017-05-29T14:16:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22841",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22841#issuecomment-335826",
    "user": "https://github.com/videlec"
}
```

<a id='comment:32'></a>Would be more natural to replace

```
for c in range(j,n):
    temp = A.get_unsafe(k,c)
    A.set_unsafe(k, c, p * A.get_unsafe(k,c) + q * A.get_unsafe(l,c))
    A.set_unsafe(l, c, (-f) * temp + e * A.get_unsafe(l,c))
```
with

```
for c in range(j,n):
    Akc = A.get_unsafe(k,c)
    Alc = A.get_unsafe(l,c)
    A.set_unsafe(k, c, p * Akc + q * Alc)
    A.set_unsafe(l, c, -f * Akc + e * Alc)
```



---

archive/issue_comments_335827.json:
```json
{
    "body": "<a id='comment:33'></a>Replying to [comment:31 vdelecroix]:\n> Is there a need for both `hermite_form_reversed` and `_reversed_hermite_form_euclidean`?\n\n\nAs you see, `hermite_form_reversed` returns a new matrix from self while `_reversed_hermite_form_euclidean` transforms self in place. This is obvious. Did I understand your question correctly?",
    "created_at": "2017-05-29T15:52:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22841",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22841#issuecomment-335827",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:33'></a>Replying to [comment:31 vdelecroix]:
> Is there a need for both `hermite_form_reversed` and `_reversed_hermite_form_euclidean`?


As you see, `hermite_form_reversed` returns a new matrix from self while `_reversed_hermite_form_euclidean` transforms self in place. This is obvious. Did I understand your question correctly?



---

archive/issue_comments_335828.json:
```json
{
    "body": "<a id='comment:34'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-05-29T16:29:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22841",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22841#issuecomment-335828",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:34'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_335829.json:
```json
{
    "body": "<a id='comment:35'></a>Further gain by the last commit:\n\n```\nsage: P.<x> = GF(5)[]\nsage: m = matrix(5,[(x+i)^((i-j)%7) for i in range(5) for j in range(5)])\nsage: timeit('m.hermite_form_reversed(transformation=True)')\n625 loops, best of 3: 957 \u00b5s per loop\n```\n\nvs\n\n```\nsage: P.<x> = GF(5)[]\nsage: m = matrix(5,[(x+i)^((i-j)%7) for i in range(5) for j in range(5)])\nsage: timeit('m.hermite_form_reversed(transformation=True)')\n625 loops, best of 3: 431 \u00b5s per loop\n```",
    "created_at": "2017-05-29T16:32:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22841",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22841#issuecomment-335829",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:35'></a>Further gain by the last commit:

```
sage: P.<x> = GF(5)[]
sage: m = matrix(5,[(x+i)^((i-j)%7) for i in range(5) for j in range(5)])
sage: timeit('m.hermite_form_reversed(transformation=True)')
625 loops, best of 3: 957 µs per loop
```

vs

```
sage: P.<x> = GF(5)[]
sage: m = matrix(5,[(x+i)^((i-j)%7) for i in range(5) for j in range(5)])
sage: timeit('m.hermite_form_reversed(transformation=True)')
625 loops, best of 3: 431 µs per loop
```



---

archive/issue_comments_335830.json:
```json
{
    "body": "<a id='comment:36'></a>Replying to [comment:31 vdelecroix]:\n> Is there a need for both `hermite_form_reversed` and `_reversed_hermite_form_euclidean`?\n\n\nAre you asking if I can get rid of both of those methods from the patch (and implement them in my own application for personal use)?",
    "created_at": "2017-05-30T16:07:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22841",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22841#issuecomment-335830",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:36'></a>Replying to [comment:31 vdelecroix]:
> Is there a need for both `hermite_form_reversed` and `_reversed_hermite_form_euclidean`?


Are you asking if I can get rid of both of those methods from the patch (and implement them in my own application for personal use)?



---

archive/issue_comments_335831.json:
```json
{
    "body": "<a id='comment:37'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-06-02T08:48:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22841",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22841#issuecomment-335831",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:37'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_335832.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-\n+This ticket provides faster Hermite normal form and weak Popov form computations for polynomial matrices. \n \n Comment: 1\n \n```\n",
    "created_at": "2017-06-02T08:49:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22841",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22841#issuecomment-335832",
    "user": "https://github.com/kwankyu"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,4 @@
-
+This ticket provides faster Hermite normal form and weak Popov form computations for polynomial matrices. 
 
 Comment: 1
 
```




---

archive/issue_comments_335833.json:
```json
{
    "body": "<a id='comment:39'></a>Replying to [comment:36 klee]:\n> Replying to [comment:31 vdelecroix]:\n> > Is there a need for both `hermite_form_reversed` and `_reversed_hermite_form_euclidean`?\n\n> \n> Are you asking if I can get rid of both of those methods from the patch (and implement them in my own application for personal use)?\n\n\nPerhaps, the reversed hermite form methods have little use, except to me. I removed them.",
    "created_at": "2017-06-02T08:59:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22841",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22841#issuecomment-335833",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:39'></a>Replying to [comment:36 klee]:
> Replying to [comment:31 vdelecroix]:
> > Is there a need for both `hermite_form_reversed` and `_reversed_hermite_form_euclidean`?

> 
> Are you asking if I can get rid of both of those methods from the patch (and implement them in my own application for personal use)?


Perhaps, the reversed hermite form methods have little use, except to me. I removed them.



---

archive/issue_comments_335834.json:
```json
{
    "body": "<a id='comment:40'></a>The present `hermite_form` method returns an immutable matrix only when `include_zero_rows=False`, because of the side effect of taking `A[:i]`. This raises some questions:\n\n(1) Should `hermite_form` always return an immutable matrix?\n\n(2) `A[:i]` returns an immutable matrix even if A is not? Is this expected or a bug?\n\nIf the answer to (1) is true, then `reversed_hermite_form` cannot be obtained just by wrapping `hermite_form` with `reverse_rows_and_columns` because you cannot \"reverse\" an immutable matrix.",
    "created_at": "2017-06-02T11:59:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22841",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22841#issuecomment-335834",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:40'></a>The present `hermite_form` method returns an immutable matrix only when `include_zero_rows=False`, because of the side effect of taking `A[:i]`. This raises some questions:

(1) Should `hermite_form` always return an immutable matrix?

(2) `A[:i]` returns an immutable matrix even if A is not? Is this expected or a bug?

If the answer to (1) is true, then `reversed_hermite_form` cannot be obtained just by wrapping `hermite_form` with `reverse_rows_and_columns` because you cannot "reverse" an immutable matrix.



---

archive/issue_comments_335835.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-06-02T11:59:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22841",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22841#issuecomment-335835",
    "user": "https://github.com/kwankyu"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_335836.json:
```json
{
    "body": "<a id='comment:42'></a>The best would be to follow the conventions of `echelon_form`\n\n```\nsage: m = matrix(QQ, 2, [1, 2, 3, 4])\nsage: h = m.echelon_form()\nsage: h.is_mutable()\nFalse\n```\nSo I would answer yes to (1).\n\nConcerning (2), you can always get a copy using `m.__copy__()`.",
    "created_at": "2017-06-02T14:12:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22841",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22841#issuecomment-335836",
    "user": "https://github.com/videlec"
}
```

<a id='comment:42'></a>The best would be to follow the conventions of `echelon_form`

```
sage: m = matrix(QQ, 2, [1, 2, 3, 4])
sage: h = m.echelon_form()
sage: h.is_mutable()
False
```
So I would answer yes to (1).

Concerning (2), you can always get a copy using `m.__copy__()`.



---

archive/issue_comments_335837.json:
```json
{
    "body": "<a id='comment:43'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-06-02T14:31:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22841",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22841#issuecomment-335837",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:43'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_335838.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-06-02T14:33:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22841",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22841#issuecomment-335838",
    "user": "https://github.com/kwankyu"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_335839.json:
```json
{
    "body": "<a id='comment:45'></a>I find weird to have this `lc` lying around in the generic implementation. A more appropriate way might be to have an optional `normalize` argument that would be a function\n\n```\ndef _hermite_form_euclidean(self, transformation=False, normalize=None):\n    ...\n    # possibly normlize the pivot\n    if normalize:\n        coeff = normalize(pivot)\n        for c in range(j,n):\n            A.set_unsafe(i, c, A.get_unsafe(i,c) * coeff)\n            if transformation:\n                for c in range(m):\n                    U.set_unsafe(i, c, U.get_unsafe(i,c) * coeff)\n```\nThen it could be used as\n\n```\nif transformation:\n    U = A._hermite_form_euclidean(transformation=True, normalize=lambda p: ~p.lc())\nelse:\n    A._hermite_form_euclidean(transformation=False, normalize=lambda p: ~p.lc())\n```\n\n(I am not really convinced by the name `normalize`)",
    "created_at": "2017-06-03T15:18:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22841",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22841#issuecomment-335839",
    "user": "https://github.com/videlec"
}
```

<a id='comment:45'></a>I find weird to have this `lc` lying around in the generic implementation. A more appropriate way might be to have an optional `normalize` argument that would be a function

```
def _hermite_form_euclidean(self, transformation=False, normalize=None):
    ...
    # possibly normlize the pivot
    if normalize:
        coeff = normalize(pivot)
        for c in range(j,n):
            A.set_unsafe(i, c, A.get_unsafe(i,c) * coeff)
            if transformation:
                for c in range(m):
                    U.set_unsafe(i, c, U.get_unsafe(i,c) * coeff)
```
Then it could be used as

```
if transformation:
    U = A._hermite_form_euclidean(transformation=True, normalize=lambda p: ~p.lc())
else:
    A._hermite_form_euclidean(transformation=False, normalize=lambda p: ~p.lc())
```

(I am not really convinced by the name `normalize`)



---

archive/issue_comments_335840.json:
```json
{
    "body": "<a id='comment:46'></a>In `_weak_popov_form` you might want to declare as `cdef list` both `to_row` and `conflicts`.",
    "created_at": "2017-06-03T15:19:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22841",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22841#issuecomment-335840",
    "user": "https://github.com/videlec"
}
```

<a id='comment:46'></a>In `_weak_popov_form` you might want to declare as `cdef list` both `to_row` and `conflicts`.



---

archive/issue_comments_335841.json:
```json
{
    "body": "<a id='comment:47'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-06-03T19:38:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22841",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22841#issuecomment-335841",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:47'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_335842.json:
```json
{
    "body": "<a id='comment:48'></a>Replying to [comment:46 vdelecroix]:\n> In `_weak_popov_form` you might want to declare as `cdef list` both `to_row` and `conflicts`.\n\n\nDone. But I don't notice any difference in speed.",
    "created_at": "2017-06-03T19:40:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22841",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22841#issuecomment-335842",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:48'></a>Replying to [comment:46 vdelecroix]:
> In `_weak_popov_form` you might want to declare as `cdef list` both `to_row` and `conflicts`.


Done. But I don't notice any difference in speed.



---

archive/issue_comments_335843.json:
```json
{
    "body": "<a id='comment:49'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-06-06T08:15:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22841",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22841#issuecomment-335843",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:49'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_335844.json:
```json
{
    "body": "<a id='comment:50'></a>Vincent, it would be good that this is merged to Sage 8.0. Is there anything missing yet?",
    "created_at": "2017-06-09T07:36:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22841",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22841#issuecomment-335844",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:50'></a>Vincent, it would be good that this is merged to Sage 8.0. Is there anything missing yet?



---

archive/issue_comments_335845.json:
```json
{
    "body": "<a id='comment:51'></a>You did not answer to [comment:45 comment:45].",
    "created_at": "2017-06-11T04:47:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22841",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22841#issuecomment-335845",
    "user": "https://github.com/videlec"
}
```

<a id='comment:51'></a>You did not answer to [comment:45 comment:45].



---

archive/issue_comments_335846.json:
```json
{
    "body": "<a id='comment:52'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-06-11T07:35:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22841",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22841#issuecomment-335846",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:52'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_335847.json:
```json
{
    "body": "<a id='comment:53'></a>Replying to [comment:45 vdelecroix]:\n> I find weird to have this `lc` lying around in the generic implementation. A more appropriate way might be to have an optional `normalize` argument that would be a function\n\n\nGood idea. I found one instance where `normalization` is used for a similar purpose. So I use that.",
    "created_at": "2017-06-11T07:39:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22841",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22841#issuecomment-335847",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:53'></a>Replying to [comment:45 vdelecroix]:
> I find weird to have this `lc` lying around in the generic implementation. A more appropriate way might be to have an optional `normalize` argument that would be a function


Good idea. I found one instance where `normalization` is used for a similar purpose. So I use that.



---

archive/issue_comments_335848.json:
```json
{
    "body": "<a id='comment:54'></a>small typo: forgot a `a` in `# possibly normlize the pivot`\n\nA simplification: the following\n\n```\nif transformation:\n    U = A._hermite_form_euclidean(transformation=True, normalization=lambda p: ~p.lc())\nelse:\n    A._hermite_form_euclidean(transformation=False, normalization=lambda p: ~p.lc())\n```\ncould be replaced by\n\n```\nU = A._hermite_form_euclidean(transformation=transformation, normalization=lambda p: ~p.lc())\n```\n(in the second cas `U` will be set to `None` which is fine)",
    "created_at": "2017-06-12T07:33:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22841",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22841#issuecomment-335848",
    "user": "https://github.com/videlec"
}
```

<a id='comment:54'></a>small typo: forgot a `a` in `# possibly normlize the pivot`

A simplification: the following

```
if transformation:
    U = A._hermite_form_euclidean(transformation=True, normalization=lambda p: ~p.lc())
else:
    A._hermite_form_euclidean(transformation=False, normalization=lambda p: ~p.lc())
```
could be replaced by

```
U = A._hermite_form_euclidean(transformation=transformation, normalization=lambda p: ~p.lc())
```
(in the second cas `U` will be set to `None` which is fine)



---

archive/issue_comments_335849.json:
```json
{
    "body": "<a id='comment:55'></a>Could you add an example in `_hermite_form_euclidean` where the argument `normalization` is actually used?",
    "created_at": "2017-06-12T07:34:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22841",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22841#issuecomment-335849",
    "user": "https://github.com/videlec"
}
```

<a id='comment:55'></a>Could you add an example in `_hermite_form_euclidean` where the argument `normalization` is actually used?



---

archive/issue_comments_335850.json:
```json
{
    "body": "<a id='comment:56'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-06-12T09:42:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22841",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22841#issuecomment-335850",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:56'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_335851.json:
```json
{
    "body": "<a id='comment:57'></a>> A simplification: the following\n> \n> ```\n> if transformation:\n>     U = A._hermite_form_euclidean(transformation=True, normalization=lambda p: ~p.lc())\n> else:\n>     A._hermite_form_euclidean(transformation=False, normalization=lambda p: ~p.lc())\n> ```\n> could be replaced by\n> \n> ```\n> U = A._hermite_form_euclidean(transformation=transformation, normalization=lambda p: ~p.lc())\n> ```\n> (in the second cas `U` will be set to `None` which is fine)\n\n\nYes, it works. I didn't know this :-)",
    "created_at": "2017-06-12T09:46:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22841",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22841#issuecomment-335851",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:57'></a>> A simplification: the following
> 
> ```
> if transformation:
>     U = A._hermite_form_euclidean(transformation=True, normalization=lambda p: ~p.lc())
> else:
>     A._hermite_form_euclidean(transformation=False, normalization=lambda p: ~p.lc())
> ```
> could be replaced by
> 
> ```
> U = A._hermite_form_euclidean(transformation=transformation, normalization=lambda p: ~p.lc())
> ```
> (in the second cas `U` will be set to `None` which is fine)


Yes, it works. I didn't know this :-)



---

archive/issue_comments_335852.json:
```json
{
    "body": "<a id='comment:58'></a>The patchbot failures seem unrelated with this patch. I have nothing to do with that. Anything else to do?",
    "created_at": "2017-06-17T23:39:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22841",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22841#issuecomment-335852",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:58'></a>The patchbot failures seem unrelated with this patch. I have nothing to do with that. Anything else to do?



---

archive/issue_comments_335853.json:
```json
{
    "body": "<a id='comment:59'></a>looks good.",
    "created_at": "2017-06-18T20:37:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22841",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22841#issuecomment-335853",
    "user": "https://github.com/videlec"
}
```

<a id='comment:59'></a>looks good.



---

archive/issue_comments_335854.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-06-18T20:37:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22841",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22841#issuecomment-335854",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_059358.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-06-22T07:23:36Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/22841",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22841#event-59358"
}
```



---

archive/issue_comments_335855.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-06-22T07:23:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22841",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22841#issuecomment-335855",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
