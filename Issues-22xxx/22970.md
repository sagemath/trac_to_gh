# Issue 22970: use flint fmpq_mat for rational dense matrices

archive/issues_022733.json:
```json
{
    "assignees": [],
    "body": "The flint library has a builtin type for rational matrices: `fmpq_mat_t`. This ticket proposes to replace the current array of `mpq_t` wrapped by `Matrix_rational_dense` in favor of `fmpq_mat_t`.\n\n(See also the related #22924 and #22872)\n\nCC:  @ClementPernet @mmasdeu\n\nKeywords: **thursdaysbdx**\n\nBranch/Commit: **[`cb0dae1`](https://github.com/sagemath/sagetrac-mirror/commit/cb0dae187cbbf8e8b594a64ef5c87553459b7f71)**\n\nReviewer: **Marc Masdeu**\n\nAuthor: **Vincent Delecroix**\n\nComponent: **linear algebra**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/22970_\n\n",
    "closed_at": "2017-05-31T22:25:35Z",
    "created_at": "2017-05-10T10:03:42Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20linear%20algebra",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.0",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "use flint fmpq_mat for rational dense matrices",
    "type": "issue",
    "updated_at": "2017-05-31T22:25:35Z",
    "url": "https://github.com/sagemath/sage/issues/22970",
    "user": "https://github.com/videlec"
}
```
The flint library has a builtin type for rational matrices: `fmpq_mat_t`. This ticket proposes to replace the current array of `mpq_t` wrapped by `Matrix_rational_dense` in favor of `fmpq_mat_t`.

(See also the related #22924 and #22872)

CC:  @ClementPernet @mmasdeu

Keywords: **thursdaysbdx**

Branch/Commit: **[`cb0dae1`](https://github.com/sagemath/sagetrac-mirror/commit/cb0dae187cbbf8e8b594a64ef5c87553459b7f71)**

Reviewer: **Marc Masdeu**

Author: **Vincent Delecroix**

Component: **linear algebra**

_Issue created by migration from https://trac.sagemath.org/ticket/22970_





---

archive/issue_events_317492.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-05-10T10:03:42Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "milestone_number": null,
    "milestone_title": "sage-8.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22970#event-317492"
}
```



---

archive/issue_events_317493.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-05-10T10:03:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22970#event-317493"
}
```



---

archive/issue_events_317494.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-05-10T10:03:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22970#event-317494"
}
```



---

archive/issue_events_317495.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-05-11T09:43:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20linear%20algebra",
    "label_color": "0000ff",
    "label_name": "c: linear algebra",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22970#event-317495"
}
```



---

archive/issue_comments_343127.json:
```json
{
    "body": "Branch: **[u/vdelecroix/22970](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/22970)**",
    "created_at": "2017-05-11T09:43:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-343127",
    "user": "https://github.com/videlec"
}
```

Branch: **[u/vdelecroix/22970](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/22970)**



---

archive/issue_comments_343128.json:
```json
{
    "body": "<div id=\"comment:1\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f7d368f8e6980ee1e96a13b43a7d92a9725158d5\"><code>f7d368f</code></a></td><td><code>22970: more flint declarations</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fce2da50ecffe067ec75b99fcfd396b3849a18bf\"><code>fce2da5</code></a></td><td><code>22970: pari / fmpq_mat_t conversions</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b52e2c347a28b301485c6cc5bb221873ca5ac636\"><code>b52e2c3</code></a></td><td><code>22970: implement libs/flint/randomize.pxd</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d5ea72b364534c3ce4374c6d78b54852c8333cc3\"><code>d5ea72b</code></a></td><td><code>22970: let rational dense matrix uses fmpq_mat_t</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/83e3a87687ee96e5a4b8cbcb91e825d8009bc4e2\"><code>83e3a87</code></a></td><td><code>22970: adapt codes using rational dense matrices</code></td></tr></table>\n",
    "created_at": "2017-05-11T09:43:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-343128",
    "user": "https://github.com/videlec"
}
```

<div id="comment:1"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f7d368f8e6980ee1e96a13b43a7d92a9725158d5"><code>f7d368f</code></a></td><td><code>22970: more flint declarations</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fce2da50ecffe067ec75b99fcfd396b3849a18bf"><code>fce2da5</code></a></td><td><code>22970: pari / fmpq_mat_t conversions</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b52e2c347a28b301485c6cc5bb221873ca5ac636"><code>b52e2c3</code></a></td><td><code>22970: implement libs/flint/randomize.pxd</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d5ea72b364534c3ce4374c6d78b54852c8333cc3"><code>d5ea72b</code></a></td><td><code>22970: let rational dense matrix uses fmpq_mat_t</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/83e3a87687ee96e5a4b8cbcb91e825d8009bc4e2"><code>83e3a87</code></a></td><td><code>22970: adapt codes using rational dense matrices</code></td></tr></table>




---

archive/issue_comments_343129.json:
```json
{
    "body": "Commit: **[`83e3a87`](https://github.com/sagemath/sagetrac-mirror/commit/83e3a87687ee96e5a4b8cbcb91e825d8009bc4e2)**",
    "created_at": "2017-05-11T09:43:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-343129",
    "user": "https://github.com/videlec"
}
```

Commit: **[`83e3a87`](https://github.com/sagemath/sagetrac-mirror/commit/83e3a87687ee96e5a4b8cbcb91e825d8009bc4e2)**



---

archive/issue_comments_343130.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nFor a discussion about an annoying segfault related to this ticket, see [this thread](https://groups.google.com/forum/#!topic/sage-devel/Vk3gAZiBfQ8).",
    "created_at": "2017-05-11T09:53:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-343130",
    "user": "https://github.com/videlec"
}
```

<div id="comment:2" align="right">comment:2</div>

For a discussion about an annoying segfault related to this ticket, see [this thread](https://groups.google.com/forum/#!topic/sage-devel/Vk3gAZiBfQ8).



---

archive/issue_comments_343131.json:
```json
{
    "body": "<div id=\"comment:3\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3daa7222584cf0c553c7d71ea2a869a3ebf5270f\"><code>3daa722</code></a></td><td><code>22970: more flint declarations</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/26822a248b8f243604392b91c7d99354368645ba\"><code>26822a2</code></a></td><td><code>22970: nonzero versions of gmp randomize functions</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/769d86ca95cdf25ed313b502878066cb25815fad\"><code>769d86c</code></a></td><td><code>22970: pari / fmpq_mat_t conversions</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/99cf14141e23fe63425c064836e04ca7e95486f0\"><code>99cf141</code></a></td><td><code>22970: let rational dense matrix uses fmpq_mat_t</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a254a43e3f4db5e850691bded1fbe7bb59ef0a03\"><code>a254a43</code></a></td><td><code>22970: adapt codes using rational dense matrices</code></td></tr></table>\n",
    "created_at": "2017-05-11T14:54:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-343131",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:3"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3daa7222584cf0c553c7d71ea2a869a3ebf5270f"><code>3daa722</code></a></td><td><code>22970: more flint declarations</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/26822a248b8f243604392b91c7d99354368645ba"><code>26822a2</code></a></td><td><code>22970: nonzero versions of gmp randomize functions</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/769d86ca95cdf25ed313b502878066cb25815fad"><code>769d86c</code></a></td><td><code>22970: pari / fmpq_mat_t conversions</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/99cf14141e23fe63425c064836e04ca7e95486f0"><code>99cf141</code></a></td><td><code>22970: let rational dense matrix uses fmpq_mat_t</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a254a43e3f4db5e850691bded1fbe7bb59ef0a03"><code>a254a43</code></a></td><td><code>22970: adapt codes using rational dense matrices</code></td></tr></table>




---

archive/issue_comments_343132.json:
```json
{
    "body": "Changed commit from **[`83e3a87`](https://github.com/sagemath/sagetrac-mirror/commit/83e3a87687ee96e5a4b8cbcb91e825d8009bc4e2)** to **[`a254a43`](https://github.com/sagemath/sagetrac-mirror/commit/a254a43e3f4db5e850691bded1fbe7bb59ef0a03)**",
    "created_at": "2017-05-11T14:54:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-343132",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`83e3a87`](https://github.com/sagemath/sagetrac-mirror/commit/83e3a87687ee96e5a4b8cbcb91e825d8009bc4e2)** to **[`a254a43`](https://github.com/sagemath/sagetrac-mirror/commit/a254a43e3f4db5e850691bded1fbe7bb59ef0a03)**



---

archive/issue_events_317496.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-05-11T14:55:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22970#event-317496"
}
```



---

archive/issue_comments_343133.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n-The flint library has a builtin type for rational matrices. This ticket proposes to replace the current array of `mpq_t` for the data to the `fmpq_mat_t` type of flint.\n+The flint library has a builtin type for rational matrices: `fmpq_mat_t`. This ticket proposes to replace the current array of `mpq_t` wrapped by `Matrix_rational_dense` in favor of `fmpq_mat_t`.\n \n (See also the related #22924 and #22872)\n``````\n",
    "created_at": "2017-05-11T15:16:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-343133",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
-The flint library has a builtin type for rational matrices. This ticket proposes to replace the current array of `mpq_t` for the data to the `fmpq_mat_t` type of flint.
+The flint library has a builtin type for rational matrices: `fmpq_mat_t`. This ticket proposes to replace the current array of `mpq_t` wrapped by `Matrix_rational_dense` in favor of `fmpq_mat_t`.
 
 (See also the related #22924 and #22872)
``````




---

archive/issue_comments_343134.json:
```json
{
    "body": "Changed keywords from none to **thursdaysbdx**",
    "created_at": "2017-05-11T15:30:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-343134",
    "user": "https://github.com/videlec"
}
```

Changed keywords from none to **thursdaysbdx**



---

archive/issue_comments_343135.json:
```json
{
    "body": "<div id=\"comment:7\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1621ac1e7945ee0df2aa92b47de5bf614bb9148d\"><code>1621ac1</code></a></td><td><code>22970: use flint by default in det/inverse</code></td></tr></table>\n",
    "created_at": "2017-05-12T07:29:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-343135",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:7"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1621ac1e7945ee0df2aa92b47de5bf614bb9148d"><code>1621ac1</code></a></td><td><code>22970: use flint by default in det/inverse</code></td></tr></table>




---

archive/issue_comments_343136.json:
```json
{
    "body": "Changed commit from **[`a254a43`](https://github.com/sagemath/sagetrac-mirror/commit/a254a43e3f4db5e850691bded1fbe7bb59ef0a03)** to **[`1621ac1`](https://github.com/sagemath/sagetrac-mirror/commit/1621ac1e7945ee0df2aa92b47de5bf614bb9148d)**",
    "created_at": "2017-05-12T07:29:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-343136",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`a254a43`](https://github.com/sagemath/sagetrac-mirror/commit/a254a43e3f4db5e850691bded1fbe7bb59ef0a03)** to **[`1621ac1`](https://github.com/sagemath/sagetrac-mirror/commit/1621ac1e7945ee0df2aa92b47de5bf614bb9148d)**



---

archive/issue_comments_343137.json:
```json
{
    "body": "<div id=\"comment:8\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3daa7222584cf0c553c7d71ea2a869a3ebf5270f\"><code>3daa722</code></a></td><td><code>22970: more flint declarations</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/26822a248b8f243604392b91c7d99354368645ba\"><code>26822a2</code></a></td><td><code>22970: nonzero versions of gmp randomize functions</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/769d86ca95cdf25ed313b502878066cb25815fad\"><code>769d86c</code></a></td><td><code>22970: pari / fmpq_mat_t conversions</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/99cf14141e23fe63425c064836e04ca7e95486f0\"><code>99cf141</code></a></td><td><code>22970: let rational dense matrix uses fmpq_mat_t</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a254a43e3f4db5e850691bded1fbe7bb59ef0a03\"><code>a254a43</code></a></td><td><code>22970: adapt codes using rational dense matrices</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1621ac1e7945ee0df2aa92b47de5bf614bb9148d\"><code>1621ac1</code></a></td><td><code>22970: use flint by default in det/inverse</code></td></tr></table>\n",
    "created_at": "2017-05-12T11:42:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-343137",
    "user": "https://github.com/videlec"
}
```

<div id="comment:8"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3daa7222584cf0c553c7d71ea2a869a3ebf5270f"><code>3daa722</code></a></td><td><code>22970: more flint declarations</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/26822a248b8f243604392b91c7d99354368645ba"><code>26822a2</code></a></td><td><code>22970: nonzero versions of gmp randomize functions</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/769d86ca95cdf25ed313b502878066cb25815fad"><code>769d86c</code></a></td><td><code>22970: pari / fmpq_mat_t conversions</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/99cf14141e23fe63425c064836e04ca7e95486f0"><code>99cf141</code></a></td><td><code>22970: let rational dense matrix uses fmpq_mat_t</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a254a43e3f4db5e850691bded1fbe7bb59ef0a03"><code>a254a43</code></a></td><td><code>22970: adapt codes using rational dense matrices</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1621ac1e7945ee0df2aa92b47de5bf614bb9148d"><code>1621ac1</code></a></td><td><code>22970: use flint by default in det/inverse</code></td></tr></table>




---

archive/issue_comments_343138.json:
```json
{
    "body": "<div id=\"comment:9\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/867ed5650aec68870282416055aaecaf0b735dfb\"><code>867ed56</code></a></td><td><code>29970: echelonize/echelon_form using flint</code></td></tr></table>\n",
    "created_at": "2017-05-12T11:42:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-343138",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:9"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/867ed5650aec68870282416055aaecaf0b735dfb"><code>867ed56</code></a></td><td><code>29970: echelonize/echelon_form using flint</code></td></tr></table>




---

archive/issue_comments_343139.json:
```json
{
    "body": "Changed commit from **[`1621ac1`](https://github.com/sagemath/sagetrac-mirror/commit/1621ac1e7945ee0df2aa92b47de5bf614bb9148d)** to **[`867ed56`](https://github.com/sagemath/sagetrac-mirror/commit/867ed5650aec68870282416055aaecaf0b735dfb)**",
    "created_at": "2017-05-12T11:42:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-343139",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`1621ac1`](https://github.com/sagemath/sagetrac-mirror/commit/1621ac1e7945ee0df2aa92b47de5bf614bb9148d)** to **[`867ed56`](https://github.com/sagemath/sagetrac-mirror/commit/867ed5650aec68870282416055aaecaf0b735dfb)**



---

archive/issue_comments_343140.json:
```json
{
    "body": "<div id=\"comment:10\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d1c8d52b65b83268fc1ff6eca155cf85c7797850\"><code>d1c8d52</code></a></td><td><code>29970: echelonize/echelon_form using flint</code></td></tr></table>\n",
    "created_at": "2017-05-12T13:48:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-343140",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:10"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d1c8d52b65b83268fc1ff6eca155cf85c7797850"><code>d1c8d52</code></a></td><td><code>29970: echelonize/echelon_form using flint</code></td></tr></table>




---

archive/issue_comments_343141.json:
```json
{
    "body": "Changed commit from **[`867ed56`](https://github.com/sagemath/sagetrac-mirror/commit/867ed5650aec68870282416055aaecaf0b735dfb)** to **[`d1c8d52`](https://github.com/sagemath/sagetrac-mirror/commit/d1c8d52b65b83268fc1ff6eca155cf85c7797850)**",
    "created_at": "2017-05-12T13:48:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-343141",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`867ed56`](https://github.com/sagemath/sagetrac-mirror/commit/867ed5650aec68870282416055aaecaf0b735dfb)** to **[`d1c8d52`](https://github.com/sagemath/sagetrac-mirror/commit/d1c8d52b65b83268fc1ff6eca155cf85c7797850)**



---

archive/issue_comments_343142.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nThanks for the work Vincent! I think that it's my duty to review this one :-).\n\nWhile I update my develop branch and check the ticket out, could you check that that the docstring in the determinant method is correct? In ``algorithm``, I see ``None`` missing.\n\nAlso, do you happen to have timings? that compare with the previous implementation? Otherwise I can produce some...",
    "created_at": "2017-05-15T11:02:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-343142",
    "user": "https://github.com/mmasdeu"
}
```

<div id="comment:11" align="right">comment:11</div>

Thanks for the work Vincent! I think that it's my duty to review this one :-).

While I update my develop branch and check the ticket out, could you check that that the docstring in the determinant method is correct? In ``algorithm``, I see ``None`` missing.

Also, do you happen to have timings? that compare with the previous implementation? Otherwise I can produce some...



---

archive/issue_events_317497.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-05-15T11:20:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22970#event-317497"
}
```



---

archive/issue_events_317498.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-05-15T11:20:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22970#event-317498"
}
```



---

archive/issue_comments_343143.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nHi Marc,\n\nThanks for proposing the review! I need some more work on my branch as I have strange failing doctests in `sage/modular` that I don't understand right now.\n\nI will provide proper timings for the following methods (tell me if you have more in mind):\n- `determinant`\n- `multiplication`\n- `echelonize`\n- `charpoly` (not yet in flint, but can go through integer matrices)\n- `minpoly` (not yet in flint, but can go through integer matrices)",
    "created_at": "2017-05-15T11:20:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-343143",
    "user": "https://github.com/videlec"
}
```

<div id="comment:12" align="right">comment:12</div>

Hi Marc,

Thanks for proposing the review! I need some more work on my branch as I have strange failing doctests in `sage/modular` that I don't understand right now.

I will provide proper timings for the following methods (tell me if you have more in mind):
- `determinant`
- `multiplication`
- `echelonize`
- `charpoly` (not yet in flint, but can go through integer matrices)
- `minpoly` (not yet in flint, but can go through integer matrices)



---

archive/issue_comments_343144.json:
```json
{
    "body": "Attachment: **[test_file.sage.gz](https://github.com/sagemath/sage/files/ticket22970/test_file.sage.gz)**",
    "created_at": "2017-05-15T13:47:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-343144",
    "user": "https://github.com/videlec"
}
```

Attachment: **[test_file.sage.gz](https://github.com/sagemath/sage/files/ticket22970/test_file.sage.gz)**



---

archive/issue_comments_343145.json:
```json
{
    "body": "<div id=\"comment:13\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f01157c31d5fefe0ff1e91f8fb58c17031632676\"><code>f01157c</code></a></td><td><code>22970: more flint declarations</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/acce30ce3f2d20ebd03a8f9f2fad6bb180f46fa5\"><code>acce30c</code></a></td><td><code>22970: nonzero versions of gmp randomize functions</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/be5ccb46c78092dc8d2259efa80e03a03050931d\"><code>be5ccb4</code></a></td><td><code>22970: pari / fmpq_mat_t conversions</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9ba2c4dd7f6c7d9fe793ba9ca4c5abf9c20dd3a0\"><code>9ba2c4d</code></a></td><td><code>22970: let rational dense matrix uses fmpq_mat_t</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/150631d3d9ad242c481e2efb2bab3d7490d68254\"><code>150631d</code></a></td><td><code>22970: adapt codes using rational dense matrices</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a3b6b3797c78c20309ecdbf1846bfb2ea5fd517a\"><code>a3b6b37</code></a></td><td><code>22970: use flint by default in det/inverse</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/10f6d8cd316897076132d3282b99aab9ec7e33f8\"><code>10f6d8c</code></a></td><td><code>29970: echelonize/echelon_form using flint</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/aef538e5c62e05b5107911a3d610b49f3908370f\"><code>aef538e</code></a></td><td><code>22970: derandomize tests in free_module_integer.py</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/edfa6f46b5bab2c2f9e555c2cd673a4795dd4983\"><code>edfa6f4</code></a></td><td><code>22970: various cleaning in matrix_rational_dense</code></td></tr></table>\n",
    "created_at": "2017-05-15T13:51:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-343145",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:13"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f01157c31d5fefe0ff1e91f8fb58c17031632676"><code>f01157c</code></a></td><td><code>22970: more flint declarations</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/acce30ce3f2d20ebd03a8f9f2fad6bb180f46fa5"><code>acce30c</code></a></td><td><code>22970: nonzero versions of gmp randomize functions</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/be5ccb46c78092dc8d2259efa80e03a03050931d"><code>be5ccb4</code></a></td><td><code>22970: pari / fmpq_mat_t conversions</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9ba2c4dd7f6c7d9fe793ba9ca4c5abf9c20dd3a0"><code>9ba2c4d</code></a></td><td><code>22970: let rational dense matrix uses fmpq_mat_t</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/150631d3d9ad242c481e2efb2bab3d7490d68254"><code>150631d</code></a></td><td><code>22970: adapt codes using rational dense matrices</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a3b6b3797c78c20309ecdbf1846bfb2ea5fd517a"><code>a3b6b37</code></a></td><td><code>22970: use flint by default in det/inverse</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/10f6d8cd316897076132d3282b99aab9ec7e33f8"><code>10f6d8c</code></a></td><td><code>29970: echelonize/echelon_form using flint</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/aef538e5c62e05b5107911a3d610b49f3908370f"><code>aef538e</code></a></td><td><code>22970: derandomize tests in free_module_integer.py</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/edfa6f46b5bab2c2f9e555c2cd673a4795dd4983"><code>edfa6f4</code></a></td><td><code>22970: various cleaning in matrix_rational_dense</code></td></tr></table>




---

archive/issue_comments_343146.json:
```json
{
    "body": "Changed commit from **[`d1c8d52`](https://github.com/sagemath/sagetrac-mirror/commit/d1c8d52b65b83268fc1ff6eca155cf85c7797850)** to **[`edfa6f4`](https://github.com/sagemath/sagetrac-mirror/commit/edfa6f46b5bab2c2f9e555c2cd673a4795dd4983)**",
    "created_at": "2017-05-15T13:51:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-343146",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`d1c8d52`](https://github.com/sagemath/sagetrac-mirror/commit/d1c8d52b65b83268fc1ff6eca155cf85c7797850)** to **[`edfa6f4`](https://github.com/sagemath/sagetrac-mirror/commit/edfa6f46b5bab2c2f9e555c2cd673a4795dd4983)**



---

archive/issue_comments_343147.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nAt commit `edfa6f46b5` using [attachment: test_file.sage](https://github.com/sagemath/sage/files/ticket22970/test_file.sage.gz) I obtain (within different session because of caching)\n\n```\nsage: %runfile test_file.sage\nsage: test(seed=0)\nf = q + 1/2*a1*q^3 + (4*a1 - 26)*q^5 + O(q^6)\nK = Number Field in a1 with defining polynomial x^2 + 32*x - 9984\na = 1/2*a1\nTrue\nFalse\n```\nand\n\n```\nsage: %runfile test_file.sage\nsage: test(seed=1)\nf = q + 1/2*a1*q^3 + (4*a1 - 26)*q^5 + O(q^6)\nK = Number Field in a1 with defining polynomial x^2 + 32*x - 9984\na = 1/2*a1\nFalse\nTrue\n```\nAnd it looks like a bug to me that this result depends on the seed of the random generator...",
    "created_at": "2017-05-15T13:52:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-343147",
    "user": "https://github.com/videlec"
}
```

<div id="comment:14" align="right">comment:14</div>

At commit `edfa6f46b5` using [attachment: test_file.sage](https://github.com/sagemath/sage/files/ticket22970/test_file.sage.gz) I obtain (within different session because of caching)

```
sage: %runfile test_file.sage
sage: test(seed=0)
f = q + 1/2*a1*q^3 + (4*a1 - 26)*q^5 + O(q^6)
K = Number Field in a1 with defining polynomial x^2 + 32*x - 9984
a = 1/2*a1
True
False
```
and

```
sage: %runfile test_file.sage
sage: test(seed=1)
f = q + 1/2*a1*q^3 + (4*a1 - 26)*q^5 + O(q^6)
K = Number Field in a1 with defining polynomial x^2 + 32*x - 9984
a = 1/2*a1
False
True
```
And it looks like a bug to me that this result depends on the seed of the random generator...



---

archive/issue_comments_343148.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nReplying to [comment:14](#comment%3A14): Discussed at \n[this sage-devel thread](https://groups.google.com/forum/#!topic/sage-devel/7VpAxhycBe0).",
    "created_at": "2017-05-15T14:05:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-343148",
    "user": "https://github.com/videlec"
}
```

<div id="comment:15" align="right">comment:15</div>

Replying to [comment:14](#comment%3A14): Discussed at 
[this sage-devel thread](https://groups.google.com/forum/#!topic/sage-devel/7VpAxhycBe0).



---

archive/issue_comments_343149.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nAttachment: **[benchmark_matrices.py.gz](https://github.com/sagemath/sage/files/ticket22970/benchmark_matrices.py.gz)**\n\nFrom [attachment: benchmark_matrices.py](https://github.com/sagemath/sage/files/ticket22970/benchmark_matrices.py.gz)\n\n- echelonize: flint is better except when coefficients are huge in which case multimodular is best\n\n```\nnrows=5  ncols=5  rank=5, density=1.0000 nbits(height)=100\nflint        0.0565\nmultimodular 0.3284\npadic        0.5626\n\nnrows=10  ncols=10  rank=5, density=1.0000 nbits(height)=37\nflint        0.1063\nmultimodular 2.6420\npadic        7.6511\n\nnrows=100  ncols=100  rank=20, density=0.1799 nbits(height)=12\nflint        9.1834\nmultimodular 12.2192\npadic        74.8152\n\nnrows=10  ncols=10  rank=10, density=1.0000 nbits(height)=200\nflint        10.1606\nmultimodular 1.5586\npadic        2.1540\n```\n- determinant\n\n```\ndim=3 density=0.7778 nbits(height)=3\nflint        0.0092\ninteger      0.1334\npari         0.0017\n\ndim=3 density=1.0000 nbits(height)=100\nflint        0.0113\ninteger      0.1188\npari         0.0269\n\ndim=30 density=1.0000 nbits(height)=5\nflint        0.9006\ninteger      1.0754\npari         34.5452\n\ndim=30 density=0.2544 nbits(height)=5\nflint        0.4389\ninteger      0.9986\npari         179.9622\n```\n- charpoly\n\n```\ndim=3 density=0.7778 nbits(height)=2\nflint        0.3875\nlinbox       1.3019\ngeneric      0.0431\n\ndim=4 density=0.5625 nbits(height)=2\nflint        0.1776\nlinbox       1.2013\ngeneric      0.0450\n\ndim=5 density=0.6400 nbits(height)=2\nflint        0.1737\nlinbox       1.2952\ngeneric      0.0532\n\ndim=6 density=0.6111 nbits(height)=2\nflint        0.1850\nlinbox       1.2773\ngeneric      0.0651\n\ndim=10 density=0.4100 nbits(height)=2\nflint        0.2343\nlinbox       1.4250\ngeneric      0.1818\n\ndim=10 density=1.0000 nbits(height)=2\nflint        0.2521\nlinbox       1.4264\ngeneric      0.4842\n\ndim=30 density=1.0000 nbits(height)=2\nflint        4.8531\nlinbox       3.4320\ngeneric      50.0362\n```",
    "created_at": "2017-05-16T08:20:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-343149",
    "user": "https://github.com/videlec"
}
```

<div id="comment:16" align="right">comment:16</div>

Attachment: **[benchmark_matrices.py.gz](https://github.com/sagemath/sage/files/ticket22970/benchmark_matrices.py.gz)**

From [attachment: benchmark_matrices.py](https://github.com/sagemath/sage/files/ticket22970/benchmark_matrices.py.gz)

- echelonize: flint is better except when coefficients are huge in which case multimodular is best

```
nrows=5  ncols=5  rank=5, density=1.0000 nbits(height)=100
flint        0.0565
multimodular 0.3284
padic        0.5626

nrows=10  ncols=10  rank=5, density=1.0000 nbits(height)=37
flint        0.1063
multimodular 2.6420
padic        7.6511

nrows=100  ncols=100  rank=20, density=0.1799 nbits(height)=12
flint        9.1834
multimodular 12.2192
padic        74.8152

nrows=10  ncols=10  rank=10, density=1.0000 nbits(height)=200
flint        10.1606
multimodular 1.5586
padic        2.1540
```
- determinant

```
dim=3 density=0.7778 nbits(height)=3
flint        0.0092
integer      0.1334
pari         0.0017

dim=3 density=1.0000 nbits(height)=100
flint        0.0113
integer      0.1188
pari         0.0269

dim=30 density=1.0000 nbits(height)=5
flint        0.9006
integer      1.0754
pari         34.5452

dim=30 density=0.2544 nbits(height)=5
flint        0.4389
integer      0.9986
pari         179.9622
```
- charpoly

```
dim=3 density=0.7778 nbits(height)=2
flint        0.3875
linbox       1.3019
generic      0.0431

dim=4 density=0.5625 nbits(height)=2
flint        0.1776
linbox       1.2013
generic      0.0450

dim=5 density=0.6400 nbits(height)=2
flint        0.1737
linbox       1.2952
generic      0.0532

dim=6 density=0.6111 nbits(height)=2
flint        0.1850
linbox       1.2773
generic      0.0651

dim=10 density=0.4100 nbits(height)=2
flint        0.2343
linbox       1.4250
generic      0.1818

dim=10 density=1.0000 nbits(height)=2
flint        0.2521
linbox       1.4264
generic      0.4842

dim=30 density=1.0000 nbits(height)=2
flint        4.8531
linbox       3.4320
generic      50.0362
```



---

archive/issue_comments_343150.json:
```json
{
    "body": "<div id=\"comment:17\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ba1787ad88f72b23425f2cb2dd50853e6b941c5b\"><code>ba1787a</code></a></td><td><code>22970: various cleaning in matrix_rational_dense</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/37614675ea8c814e0af3e2fb6664f6c5c0ade0f1\"><code>3761467</code></a></td><td><code>22970: fix doctests in sage/modular/</code></td></tr></table>\n",
    "created_at": "2017-05-16T09:58:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-343150",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:17"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ba1787ad88f72b23425f2cb2dd50853e6b941c5b"><code>ba1787a</code></a></td><td><code>22970: various cleaning in matrix_rational_dense</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/37614675ea8c814e0af3e2fb6664f6c5c0ade0f1"><code>3761467</code></a></td><td><code>22970: fix doctests in sage/modular/</code></td></tr></table>




---

archive/issue_comments_343151.json:
```json
{
    "body": "Changed commit from **[`edfa6f4`](https://github.com/sagemath/sagetrac-mirror/commit/edfa6f46b5bab2c2f9e555c2cd673a4795dd4983)** to **[`3761467`](https://github.com/sagemath/sagetrac-mirror/commit/37614675ea8c814e0af3e2fb6664f6c5c0ade0f1)**",
    "created_at": "2017-05-16T09:58:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-343151",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`edfa6f4`](https://github.com/sagemath/sagetrac-mirror/commit/edfa6f46b5bab2c2f9e555c2cd673a4795dd4983)** to **[`3761467`](https://github.com/sagemath/sagetrac-mirror/commit/37614675ea8c814e0af3e2fb6664f6c5c0ade0f1)**



---

archive/issue_events_317499.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-05-16T09:59:15Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22970#event-317499"
}
```



---

archive/issue_events_317500.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-05-16T09:59:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22970#event-317500"
}
```



---

archive/issue_comments_343152.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nNeeds review again. I tried to make independent of the random seed the annoying doctests in sage/modular...",
    "created_at": "2017-05-16T09:59:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-343152",
    "user": "https://github.com/videlec"
}
```

<div id="comment:18" align="right">comment:18</div>

Needs review again. I tried to make independent of the random seed the annoying doctests in sage/modular...



---

archive/issue_comments_343153.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\npatchbot is green!! (with a weird ascii complaints)",
    "created_at": "2017-05-16T12:59:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-343153",
    "user": "https://github.com/videlec"
}
```

<div id="comment:19" align="right">comment:19</div>

patchbot is green!! (with a weird ascii complaints)



---

archive/issue_comments_343154.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nOn my computer, a call to\n\n```\nsage: CuspForms(101,12).hecke_matrix(3)\n```\n\ntakes 765 seconds with the current develop branch, and 1157 seconds with the proposed patch. I think that most of it is explained by the fact that the method echelon_form is called 1394 times on quite large matrices (dense, over QQ). I was actually looking for speed-ups in existing high-level functionality (like this one), so this is a bit disappointing.\n\nMaybe the default algorithm should be changed if the entries are large?",
    "created_at": "2017-05-16T14:41:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-343154",
    "user": "https://github.com/mmasdeu"
}
```

<div id="comment:20" align="right">comment:20</div>

On my computer, a call to

```
sage: CuspForms(101,12).hecke_matrix(3)
```

takes 765 seconds with the current develop branch, and 1157 seconds with the proposed patch. I think that most of it is explained by the fact that the method echelon_form is called 1394 times on quite large matrices (dense, over QQ). I was actually looking for speed-ups in existing high-level functionality (like this one), so this is a bit disappointing.

Maybe the default algorithm should be changed if the entries are large?



---

archive/issue_comments_343155.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nReplying to [@mmasdeu](#comment%3A20):\n> On my computer, a call to\n> \n> ```\n> sage: CuspForms(101,12).hecke_matrix(3)\n> ```\n> \n> takes 765 seconds with the current develop branch, and 1157 seconds with the proposed patch. I think that most of it is explained by the fact that the method echelon_form is called 1394 times on quite large matrices (dense, over QQ). I was actually looking for speed-ups in existing high-level functionality (like this one), so this is a bit disappointing.\n> \n> Maybe the default algorithm should be changed if the entries are large?\n\nI did not do proper tunings (since I will redo it after #22924 anyway). However, I can try to do something better for `echelon_form/echelonize`. Do you have other relevant examples in mind?",
    "created_at": "2017-05-16T14:49:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-343155",
    "user": "https://github.com/videlec"
}
```

<div id="comment:21" align="right">comment:21</div>

Replying to [@mmasdeu](#comment%3A20):
> On my computer, a call to
> 
> ```
> sage: CuspForms(101,12).hecke_matrix(3)
> ```
> 
> takes 765 seconds with the current develop branch, and 1157 seconds with the proposed patch. I think that most of it is explained by the fact that the method echelon_form is called 1394 times on quite large matrices (dense, over QQ). I was actually looking for speed-ups in existing high-level functionality (like this one), so this is a bit disappointing.
> 
> Maybe the default algorithm should be changed if the entries are large?

I did not do proper tunings (since I will redo it after #22924 anyway). However, I can try to do something better for `echelon_form/echelonize`. Do you have other relevant examples in mind?



---

archive/issue_comments_343156.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nNot at the moment. I haven't done exhaustive tests either, but it seems that in many cases the performance is similar.\n\nAs for other examples, many operations with subquotients involve doing this kind of linear algebra.",
    "created_at": "2017-05-16T15:12:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-343156",
    "user": "https://github.com/mmasdeu"
}
```

<div id="comment:22" align="right">comment:22</div>

Not at the moment. I haven't done exhaustive tests either, but it seems that in many cases the performance is similar.

As for other examples, many operations with subquotients involve doing this kind of linear algebra.



---

archive/issue_comments_343157.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nSome remarks\n- flint has several algorithms for echelon form and this is not finely tuned.\n- On very specific instances, multimodular can be much faster (up to x100). This is the reason why your example `CuspForms(101,12).hecke_matrix(3)` gets slower. I have no idea how to detect such instances.\n- for `random_matrix(QQ, ...)` (ie independent entries) flint looks like to be the best option excepted in the range `10 <= nrows=ncols <= 20` where flint tuning (over Z) is very bad\n\nOne way to go might be to have a global option that controls the default behavior of the echelon form. I am thinking of something that can be used like\n\n```python\ndef my_modular_form_algorithm():\n    with rational_echelon_form('multimodular'):\n        # some relevant code here\n        ....\n```\nWhat do you think?",
    "created_at": "2017-05-17T08:49:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-343157",
    "user": "https://github.com/videlec"
}
```

<div id="comment:23" align="right">comment:23</div>

Some remarks
- flint has several algorithms for echelon form and this is not finely tuned.
- On very specific instances, multimodular can be much faster (up to x100). This is the reason why your example `CuspForms(101,12).hecke_matrix(3)` gets slower. I have no idea how to detect such instances.
- for `random_matrix(QQ, ...)` (ie independent entries) flint looks like to be the best option excepted in the range `10 <= nrows=ncols <= 20` where flint tuning (over Z) is very bad

One way to go might be to have a global option that controls the default behavior of the echelon form. I am thinking of something that can be used like

```python
def my_modular_form_algorithm():
    with rational_echelon_form('multimodular'):
        # some relevant code here
        ....
```
What do you think?



---

archive/issue_comments_343158.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nSecond option, allow the option `algorithm=my_function` where `my_function` takes a matrix as input and returns a valid algorithm for echelon form. (I do prefer this one better)\n\nEDIT: this will not work since `echelon_form` is **indirectly** called in modular function algorithms...",
    "created_at": "2017-05-17T08:56:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-343158",
    "user": "https://github.com/videlec"
}
```

<div id="comment:24" align="right">comment:24</div>

Second option, allow the option `algorithm=my_function` where `my_function` takes a matrix as input and returns a valid algorithm for echelon form. (I do prefer this one better)

EDIT: this will not work since `echelon_form` is **indirectly** called in modular function algorithms...



---

archive/issue_comments_343159.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nImplementing the idea from [comment:23](#comment%3A23) I got\n\n```\nsage: %time m = CuspForms(31, 12).hecke_matrix(3)\nCPU times: user 7.52 s, sys: 63.3 ms, total: 7.59 s\nWall time: 7.55 s\n\nsage: %time c = CuspForms(51, 12).hecke_matrix(3)\nCPU times: user 2min 13s, sys: 203 ms, total: 2min 13s\nWall time: 2min 13s\n\nsage: %time c = CuspForms(101, 12).hecke_matrix(3)\nCPU times: user 5min 10s, sys: 663 ms, total: 5min 10s\nWall time: 5min 10s\n```\nagainst the following in develop\n\n```\nsage: %time m = CuspForms(31, 12).hecke_matrix(3)\nCPU times: user 13.5 s, sys: 43.3 ms, total: 13.6 s\nWall time: 13.5 s\n\nsage: %time c = CuspForms(51, 12).hecke_matrix(3)\nCPU times: user 3min 8s, sys: 250 ms, total: 3min 9s\nWall time: 3min 9s\n\n%time c = CuspForms(101, 12).hecke_matrix(3)\nCPU times: user 8min 7s, sys: 527 ms, total: 8min 8s\nWall time: 8min 8s\n```\n(so close to x2 improvement)\n\nI propose to postpone this improvement to another ticket since this one is already a big change. If you agree I will open a new one and work on it as soon as this one is closed.",
    "created_at": "2017-05-17T09:58:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-343159",
    "user": "https://github.com/videlec"
}
```

<div id="comment:25" align="right">comment:25</div>

Implementing the idea from [comment:23](#comment%3A23) I got

```
sage: %time m = CuspForms(31, 12).hecke_matrix(3)
CPU times: user 7.52 s, sys: 63.3 ms, total: 7.59 s
Wall time: 7.55 s

sage: %time c = CuspForms(51, 12).hecke_matrix(3)
CPU times: user 2min 13s, sys: 203 ms, total: 2min 13s
Wall time: 2min 13s

sage: %time c = CuspForms(101, 12).hecke_matrix(3)
CPU times: user 5min 10s, sys: 663 ms, total: 5min 10s
Wall time: 5min 10s
```
against the following in develop

```
sage: %time m = CuspForms(31, 12).hecke_matrix(3)
CPU times: user 13.5 s, sys: 43.3 ms, total: 13.6 s
Wall time: 13.5 s

sage: %time c = CuspForms(51, 12).hecke_matrix(3)
CPU times: user 3min 8s, sys: 250 ms, total: 3min 9s
Wall time: 3min 9s

%time c = CuspForms(101, 12).hecke_matrix(3)
CPU times: user 8min 7s, sys: 527 ms, total: 8min 8s
Wall time: 8min 8s
```
(so close to x2 improvement)

I propose to postpone this improvement to another ticket since this one is already a big change. If you agree I will open a new one and work on it as soon as this one is closed.



---

archive/issue_comments_343160.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\n1) I agree that this can be dealt with in another ticket, but it is moderately urgent. ModularSymbols / ModularForms becoming twice slower than currently is not good news...\n\nAnother example of a reasonable calculation: with the Sage 7.5.1 the following calculation takes 22 seconds on my laptop. It takes 1min22s (!) with the proposed patch.\n\n```\nsage: %time A = ModularSymbols(11,60).hecke_matrix(3)\n```\n\n2) While reviewing, in `sage/modular/hecke/module.py` there is a doctest that changed in a suspicious way. It seems that a number field was created with a different generator and that causes the output to look different. I propose that the line that causes trouble gets changed into\n\n```\nsage: [o.minpoly() for o in A.system_of_eigenvalues(3)]\n[x - 1, x + 1, x^2 - 2*x - 2]\n```\n\nThe output that appears should not depend on the implementation.\n\n3) There seems to be quite a mess on what are the acceptable values to the 'algorithm' parameter. Maybe it's a good time to change that! My suggestion would be that the default would always be None, and then the docstring would specify what is done in this case.",
    "created_at": "2017-05-18T11:07:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-343160",
    "user": "https://github.com/mmasdeu"
}
```

<div id="comment:26" align="right">comment:26</div>

1) I agree that this can be dealt with in another ticket, but it is moderately urgent. ModularSymbols / ModularForms becoming twice slower than currently is not good news...

Another example of a reasonable calculation: with the Sage 7.5.1 the following calculation takes 22 seconds on my laptop. It takes 1min22s (!) with the proposed patch.

```
sage: %time A = ModularSymbols(11,60).hecke_matrix(3)
```

2) While reviewing, in `sage/modular/hecke/module.py` there is a doctest that changed in a suspicious way. It seems that a number field was created with a different generator and that causes the output to look different. I propose that the line that causes trouble gets changed into

```
sage: [o.minpoly() for o in A.system_of_eigenvalues(3)]
[x - 1, x + 1, x^2 - 2*x - 2]
```

The output that appears should not depend on the implementation.

3) There seems to be quite a mess on what are the acceptable values to the 'algorithm' parameter. Maybe it's a good time to change that! My suggestion would be that the default would always be None, and then the docstring would specify what is done in this case.



---

archive/issue_events_317501.json:
```json
{
    "actor": "https://github.com/mmasdeu",
    "created_at": "2017-05-18T11:07:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22970#event-317501"
}
```



---

archive/issue_events_317502.json:
```json
{
    "actor": "https://github.com/mmasdeu",
    "created_at": "2017-05-18T11:07:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22970#event-317502"
}
```



---

archive/issue_comments_343161.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nI might have an explanation for why Flint is slow for these modular symbol matrices. See:\n\nhttps://github.com/wbhart/flint2/issues/335\n\nIt can be fixed in Flint (if my analysis is correct), but this requires some amount of coding.",
    "created_at": "2017-05-18T16:03:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-343161",
    "user": "https://github.com/fredrik-johansson"
}
```

<div id="comment:27" align="right">comment:27</div>

I might have an explanation for why Flint is slow for these modular symbol matrices. See:

https://github.com/wbhart/flint2/issues/335

It can be fixed in Flint (if my analysis is correct), but this requires some amount of coding.



---

archive/issue_comments_343162.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nReplying to [@fredrik-johansson](#comment%3A27):\n> I might have an explanation for why Flint is slow for these modular symbol matrices. See:\n> \n> https://github.com/wbhart/flint2/issues/335\n> \n> It can be fixed in Flint (if my analysis is correct), but this requires some amount of coding.\n\nWould be tremendous!",
    "created_at": "2017-05-18T16:17:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-343162",
    "user": "https://github.com/videlec"
}
```

<div id="comment:28" align="right">comment:28</div>

Replying to [@fredrik-johansson](#comment%3A27):
> I might have an explanation for why Flint is slow for these modular symbol matrices. See:
> 
> https://github.com/wbhart/flint2/issues/335
> 
> It can be fixed in Flint (if my analysis is correct), but this requires some amount of coding.

Would be tremendous!



---

archive/issue_comments_343163.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\n@mmasdeu: for the sake of this ticket I will set the default to `multimodular` that should actually speed up all modular symbol computations. Then #23026 will deal with making flint the default (that is much faster on random instances).",
    "created_at": "2017-05-18T16:22:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-343163",
    "user": "https://github.com/videlec"
}
```

<div id="comment:29" align="right">comment:29</div>

@mmasdeu: for the sake of this ticket I will set the default to `multimodular` that should actually speed up all modular symbol computations. Then #23026 will deal with making flint the default (that is much faster on random instances).



---

archive/issue_comments_343164.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nThat sounds reasonable...at least there is no regression in speed (hopefully!).",
    "created_at": "2017-05-18T16:32:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-343164",
    "user": "https://github.com/mmasdeu"
}
```

<div id="comment:30" align="right">comment:30</div>

That sounds reasonable...at least there is no regression in speed (hopefully!).



---

archive/issue_comments_343165.json:
```json
{
    "body": "<div id=\"comment:31\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/948cab12b479a1ab0fa1cd4b28ce5a1d8b737b9a\"><code>948cab1</code></a></td><td><code>22970: better doctest in modular/hecke/module.py</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b5f5600ddc92113f3307b07a13c3d60e0bb5a736\"><code>b5f5600</code></a></td><td><code>22970: improved doc + simpler echelonize/echelon_form logic</code></td></tr></table>\n",
    "created_at": "2017-05-18T17:40:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-343165",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:31"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/948cab12b479a1ab0fa1cd4b28ce5a1d8b737b9a"><code>948cab1</code></a></td><td><code>22970: better doctest in modular/hecke/module.py</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b5f5600ddc92113f3307b07a13c3d60e0bb5a736"><code>b5f5600</code></a></td><td><code>22970: improved doc + simpler echelonize/echelon_form logic</code></td></tr></table>




---

archive/issue_comments_343166.json:
```json
{
    "body": "Changed commit from **[`3761467`](https://github.com/sagemath/sagetrac-mirror/commit/37614675ea8c814e0af3e2fb6664f6c5c0ade0f1)** to **[`b5f5600`](https://github.com/sagemath/sagetrac-mirror/commit/b5f5600ddc92113f3307b07a13c3d60e0bb5a736)**",
    "created_at": "2017-05-18T17:40:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-343166",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`3761467`](https://github.com/sagemath/sagetrac-mirror/commit/37614675ea8c814e0af3e2fb6664f6c5c0ade0f1)** to **[`b5f5600`](https://github.com/sagemath/sagetrac-mirror/commit/b5f5600ddc92113f3307b07a13c3d60e0bb5a736)**



---

archive/issue_comments_343167.json:
```json
{
    "body": "<div id=\"comment:32\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/14d31c55cb4ba6d1e4f98af46cced7af7edda194\"><code>14d31c5</code></a></td><td><code>22970: better doctest in modular/hecke/module.py</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0c8b2ce8067e8d5cbf01df1827e921b115167f9d\"><code>0c8b2ce</code></a></td><td><code>22970: improved doc + simpler echelonize/echelon_form logic</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c1720649e5cc015e54d7dd7054fb1920a9065d6b\"><code>c172064</code></a></td><td><code>22970: _new_matrix/from_columns/add_to_entry</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5f2e1bac18839e95198e455897ab81cc35c8923f\"><code>5f2e1ba</code></a></td><td><code>22970: small optimization in modsym/ambient.py</code></td></tr></table>\n",
    "created_at": "2017-05-18T18:32:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-343167",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:32"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/14d31c55cb4ba6d1e4f98af46cced7af7edda194"><code>14d31c5</code></a></td><td><code>22970: better doctest in modular/hecke/module.py</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0c8b2ce8067e8d5cbf01df1827e921b115167f9d"><code>0c8b2ce</code></a></td><td><code>22970: improved doc + simpler echelonize/echelon_form logic</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c1720649e5cc015e54d7dd7054fb1920a9065d6b"><code>c172064</code></a></td><td><code>22970: _new_matrix/from_columns/add_to_entry</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5f2e1bac18839e95198e455897ab81cc35c8923f"><code>5f2e1ba</code></a></td><td><code>22970: small optimization in modsym/ambient.py</code></td></tr></table>




---

archive/issue_comments_343168.json:
```json
{
    "body": "Changed commit from **[`b5f5600`](https://github.com/sagemath/sagetrac-mirror/commit/b5f5600ddc92113f3307b07a13c3d60e0bb5a736)** to **[`5f2e1ba`](https://github.com/sagemath/sagetrac-mirror/commit/5f2e1bac18839e95198e455897ab81cc35c8923f)**",
    "created_at": "2017-05-18T18:32:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-343168",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`b5f5600`](https://github.com/sagemath/sagetrac-mirror/commit/b5f5600ddc92113f3307b07a13c3d60e0bb5a736)** to **[`5f2e1ba`](https://github.com/sagemath/sagetrac-mirror/commit/5f2e1bac18839e95198e455897ab81cc35c8923f)**



---

archive/issue_comments_343169.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nat commit b5f5600 I got\n\n```\nsage: %time m = CuspForms(31, 12).hecke_matrix(3)\nCPU times: user 11.7 s, sys: 40 ms, total: 11.7 s\nWall time: 11.7 s\n\nsage: %time c = CuspForms(51, 12).hecke_matrix(3)\nCPU times: user 2min 52s, sys: 283 ms, total: 2min 52s\nWall time: 2min 52s\n\nsage: %time c = CuspForms(101, 12).hecke_matrix(3)\nCPU times: user 7min 17s, sys: 620 ms, total: 7min 18s\nWall time: 7min 18s\n```\n\nand at 5f2e1ba the even better\n\n```\nsage: %time m = CuspForms(31, 12).hecke_matrix(3)\nCPU times: user 7.5 s, sys: 36.7 ms, total: 7.53 s\nWall time: 7.51 s\n\nsage: %time c = CuspForms(51, 12).hecke_matrix(3)\nCPU times: user 2min 10s, sys: 223 ms, total: 2min 10s\nWall time: 2min 10s\n\nsage: %time c = CuspForms(101, 12).hecke_matrix(3)\nCPU times: user 5min 9s, sys: 603 ms, total: 5min 10s\nWall time: 5min 10s\n```",
    "created_at": "2017-05-18T18:32:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-343169",
    "user": "https://github.com/videlec"
}
```

<div id="comment:33" align="right">comment:33</div>

at commit b5f5600 I got

```
sage: %time m = CuspForms(31, 12).hecke_matrix(3)
CPU times: user 11.7 s, sys: 40 ms, total: 11.7 s
Wall time: 11.7 s

sage: %time c = CuspForms(51, 12).hecke_matrix(3)
CPU times: user 2min 52s, sys: 283 ms, total: 2min 52s
Wall time: 2min 52s

sage: %time c = CuspForms(101, 12).hecke_matrix(3)
CPU times: user 7min 17s, sys: 620 ms, total: 7min 18s
Wall time: 7min 18s
```

and at 5f2e1ba the even better

```
sage: %time m = CuspForms(31, 12).hecke_matrix(3)
CPU times: user 7.5 s, sys: 36.7 ms, total: 7.53 s
Wall time: 7.51 s

sage: %time c = CuspForms(51, 12).hecke_matrix(3)
CPU times: user 2min 10s, sys: 223 ms, total: 2min 10s
Wall time: 2min 10s

sage: %time c = CuspForms(101, 12).hecke_matrix(3)
CPU times: user 5min 9s, sys: 603 ms, total: 5min 10s
Wall time: 5min 10s
```



---

archive/issue_events_317503.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-05-18T18:33:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22970#event-317503"
}
```



---

archive/issue_events_317504.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-05-18T18:33:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22970#event-317504"
}
```



---

archive/issue_comments_343170.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nAnd tests also pass on beta7!",
    "created_at": "2017-05-19T12:32:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-343170",
    "user": "https://github.com/videlec"
}
```

<div id="comment:35" align="right">comment:35</div>

And tests also pass on beta7!



---

archive/issue_comments_343171.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nThis is definitely more than satisfying. The code looks very clean, and all tests pass. Thanks for the great work!",
    "created_at": "2017-05-21T16:32:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-343171",
    "user": "https://github.com/mmasdeu"
}
```

<div id="comment:36" align="right">comment:36</div>

This is definitely more than satisfying. The code looks very clean, and all tests pass. Thanks for the great work!



---

archive/issue_comments_343172.json:
```json
{
    "body": "Reviewer: **Marc Masdeu**",
    "created_at": "2017-05-21T16:32:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-343172",
    "user": "https://github.com/mmasdeu"
}
```

Reviewer: **Marc Masdeu**



---

archive/issue_events_317505.json:
```json
{
    "actor": "https://github.com/mmasdeu",
    "created_at": "2017-05-21T16:32:29Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22970#event-317505"
}
```



---

archive/issue_events_317506.json:
```json
{
    "actor": "https://github.com/mmasdeu",
    "created_at": "2017-05-21T16:32:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22970#event-317506"
}
```



---

archive/issue_comments_343173.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nMerge conflict",
    "created_at": "2017-05-22T22:35:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-343173",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:37" align="right">comment:37</div>

Merge conflict



---

archive/issue_events_317507.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-05-22T22:35:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22970#event-317507"
}
```



---

archive/issue_events_317508.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-05-22T22:35:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22970#event-317508"
}
```



---

archive/issue_comments_343174.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nToo bad. The code is fine on beta7. Can I try to fix it by merging another ticket?",
    "created_at": "2017-05-23T06:45:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-343174",
    "user": "https://github.com/videlec"
}
```

<div id="comment:38" align="right">comment:38</div>

Too bad. The code is fine on beta7. Can I try to fix it by merging another ticket?



---

archive/issue_comments_343175.json:
```json
{
    "body": "<div id=\"comment:39\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/86a305b3a4a701b672ef29aaa72c8f10c58c626c\"><code>86a305b</code></a></td><td><code>22970: adapt codes using rational dense matrices</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b5320ef0ca9d21ba1c1664c05703f7ad59cb092f\"><code>b5320ef</code></a></td><td><code>22970: use flint by default in det/inverse</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fad1b0ded1bab87c2d433195e00c7c830515606b\"><code>fad1b0d</code></a></td><td><code>29970: echelonize/echelon_form using flint</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b68993f0dc24766b4a03df9a043aef41fd0293dd\"><code>b68993f</code></a></td><td><code>22970: derandomize tests in free_module_integer.py</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/91c58356d30aa45588a2f6b46f743c4613b15d8c\"><code>91c5835</code></a></td><td><code>22970: various cleaning in matrix_rational_dense</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9f8391269443bc41b92d8f71e00336d90ae1324b\"><code>9f83912</code></a></td><td><code>22970: fix doctests in sage/modular/</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bcf6b7d05e0a12c9b041ff1b564767c589cc6b3a\"><code>bcf6b7d</code></a></td><td><code>22970: better doctest in modular/hecke/module.py</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/14f3fdb9229ed631dbea407f992353313c51e64b\"><code>14f3fdb</code></a></td><td><code>22970: improved doc + simpler echelonize/echelon_form logic</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fceef5016bbda0a99d383f4a9d5df4fcc881f7d0\"><code>fceef50</code></a></td><td><code>22970: _new_matrix/from_columns/add_to_entry</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cb0dae187cbbf8e8b594a64ef5c87553459b7f71\"><code>cb0dae1</code></a></td><td><code>22970: small optimization in modsym/ambient.py</code></td></tr></table>\n",
    "created_at": "2017-05-29T13:06:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-343175",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:39"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/86a305b3a4a701b672ef29aaa72c8f10c58c626c"><code>86a305b</code></a></td><td><code>22970: adapt codes using rational dense matrices</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b5320ef0ca9d21ba1c1664c05703f7ad59cb092f"><code>b5320ef</code></a></td><td><code>22970: use flint by default in det/inverse</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fad1b0ded1bab87c2d433195e00c7c830515606b"><code>fad1b0d</code></a></td><td><code>29970: echelonize/echelon_form using flint</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b68993f0dc24766b4a03df9a043aef41fd0293dd"><code>b68993f</code></a></td><td><code>22970: derandomize tests in free_module_integer.py</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/91c58356d30aa45588a2f6b46f743c4613b15d8c"><code>91c5835</code></a></td><td><code>22970: various cleaning in matrix_rational_dense</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9f8391269443bc41b92d8f71e00336d90ae1324b"><code>9f83912</code></a></td><td><code>22970: fix doctests in sage/modular/</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bcf6b7d05e0a12c9b041ff1b564767c589cc6b3a"><code>bcf6b7d</code></a></td><td><code>22970: better doctest in modular/hecke/module.py</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/14f3fdb9229ed631dbea407f992353313c51e64b"><code>14f3fdb</code></a></td><td><code>22970: improved doc + simpler echelonize/echelon_form logic</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fceef5016bbda0a99d383f4a9d5df4fcc881f7d0"><code>fceef50</code></a></td><td><code>22970: _new_matrix/from_columns/add_to_entry</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cb0dae187cbbf8e8b594a64ef5c87553459b7f71"><code>cb0dae1</code></a></td><td><code>22970: small optimization in modsym/ambient.py</code></td></tr></table>




---

archive/issue_comments_343176.json:
```json
{
    "body": "Changed commit from **[`5f2e1ba`](https://github.com/sagemath/sagetrac-mirror/commit/5f2e1bac18839e95198e455897ab81cc35c8923f)** to **[`cb0dae1`](https://github.com/sagemath/sagetrac-mirror/commit/cb0dae187cbbf8e8b594a64ef5c87553459b7f71)**",
    "created_at": "2017-05-29T13:06:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-343176",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`5f2e1ba`](https://github.com/sagemath/sagetrac-mirror/commit/5f2e1bac18839e95198e455897ab81cc35c8923f)** to **[`cb0dae1`](https://github.com/sagemath/sagetrac-mirror/commit/cb0dae187cbbf8e8b594a64ef5c87553459b7f71)**



---

archive/issue_comments_343177.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nrebased (I launched the patchbot)",
    "created_at": "2017-05-29T13:07:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-343177",
    "user": "https://github.com/videlec"
}
```

<div id="comment:40" align="right">comment:40</div>

rebased (I launched the patchbot)



---

archive/issue_events_317509.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-05-29T13:07:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22970#event-317509"
}
```



---

archive/issue_events_317510.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-05-29T13:07:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22970#event-317510"
}
```



---

archive/issue_comments_343178.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\npatchbot still happy!",
    "created_at": "2017-05-29T22:01:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-343178",
    "user": "https://github.com/videlec"
}
```

<div id="comment:41" align="right">comment:41</div>

patchbot still happy!



---

archive/issue_events_317511.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-05-29T22:01:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22970#event-317511"
}
```



---

archive/issue_events_317512.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-05-29T22:01:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22970#event-317512"
}
```



---

archive/issue_comments_343179.json:
```json
{
    "body": "Changed branch from **[u/vdelecroix/22970](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/22970)** to **[`cb0dae1`](https://github.com/sagemath/sagetrac-mirror/commit/cb0dae187cbbf8e8b594a64ef5c87553459b7f71)**",
    "created_at": "2017-05-31T22:25:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-343179",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/vdelecroix/22970](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/22970)** to **[`cb0dae1`](https://github.com/sagemath/sagetrac-mirror/commit/cb0dae187cbbf8e8b594a64ef5c87553459b7f71)**



---

archive/issue_events_317513.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-05-31T22:25:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22970#event-317513"
}
```



---

archive/issue_events_317514.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "0db4adab5c7348fffd19d06d2910ec18f468de84",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2017-05-31T22:25:35Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22970#event-317514"
}
```
