# Issue 22970: use flint fmpq_mat for rational dense matrices

archive/issues_022733.json:
```json
{
    "body": "The flint library has a builtin type for rational matrices: `fmpq_mat_t`. This ticket proposes to replace the current array of `mpq_t` wrapped by `Matrix_rational_dense` in favor of `fmpq_mat_t`.\n\n(See also the related #22924 and #22872)\n\n**CC:**  @ClementPernet @mmasdeu\n\n**Keywords:** thursdaysbdx\n\n**Branch/Commit:** [cb0dae187cbbf8e8b594a64ef5c87553459b7f71](https://github.com/sagemath/sagetrac-mirror/commit/cb0dae187cbbf8e8b594a64ef5c87553459b7f71)\n\n**Reviewer:** Marc Masdeu\n\n**Author:** Vincent Delecroix\n\nIssue created by migration from https://trac.sagemath.org/ticket/22970\n\n",
    "closed_at": "2017-05-31T22:25:35Z",
    "created_at": "2017-05-10T10:03:42Z",
    "labels": [
        "component: linear algebra",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.0",
    "title": "use flint fmpq_mat for rational dense matrices",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/22970",
    "user": "https://github.com/videlec"
}
```
The flint library has a builtin type for rational matrices: `fmpq_mat_t`. This ticket proposes to replace the current array of `mpq_t` wrapped by `Matrix_rational_dense` in favor of `fmpq_mat_t`.

(See also the related #22924 and #22872)

**CC:**  @ClementPernet @mmasdeu

**Keywords:** thursdaysbdx

**Branch/Commit:** [cb0dae187cbbf8e8b594a64ef5c87553459b7f71](https://github.com/sagemath/sagetrac-mirror/commit/cb0dae187cbbf8e8b594a64ef5c87553459b7f71)

**Reviewer:** Marc Masdeu

**Author:** Vincent Delecroix

Issue created by migration from https://trac.sagemath.org/ticket/22970





---

archive/issue_events_204665.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-05-11T09:43:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "label": "component: linear algebra",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22970#event-204665"
}
```



---

archive/issue_comments_345697.json:
```json
{
    "body": "**Branch:** [u/vdelecroix/22970](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/22970)",
    "created_at": "2017-05-11T09:43:29Z",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-345697",
    "user": "https://github.com/videlec"
}
```

**Branch:** [u/vdelecroix/22970](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/22970)



---

archive/issue_comments_345698.json:
```json
{
    "body": "<a id='comment:1'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f7d368f8e6980ee1e96a13b43a7d92a9725158d5\">f7d368f</a></td><td><code>22970: more flint declarations</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fce2da50ecffe067ec75b99fcfd396b3849a18bf\">fce2da5</a></td><td><code>22970: pari / fmpq_mat_t conversions</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b52e2c347a28b301485c6cc5bb221873ca5ac636\">b52e2c3</a></td><td><code>22970: implement libs/flint/randomize.pxd</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d5ea72b364534c3ce4374c6d78b54852c8333cc3\">d5ea72b</a></td><td><code>22970: let rational dense matrix uses fmpq_mat_t</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/83e3a87687ee96e5a4b8cbcb91e825d8009bc4e2\">83e3a87</a></td><td><code>22970: adapt codes using rational dense matrices</code></td></tr></table>\n",
    "created_at": "2017-05-11T09:43:29Z",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-345698",
    "user": "https://github.com/videlec"
}
```

<a id='comment:1'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f7d368f8e6980ee1e96a13b43a7d92a9725158d5">f7d368f</a></td><td><code>22970: more flint declarations</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fce2da50ecffe067ec75b99fcfd396b3849a18bf">fce2da5</a></td><td><code>22970: pari / fmpq_mat_t conversions</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b52e2c347a28b301485c6cc5bb221873ca5ac636">b52e2c3</a></td><td><code>22970: implement libs/flint/randomize.pxd</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d5ea72b364534c3ce4374c6d78b54852c8333cc3">d5ea72b</a></td><td><code>22970: let rational dense matrix uses fmpq_mat_t</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/83e3a87687ee96e5a4b8cbcb91e825d8009bc4e2">83e3a87</a></td><td><code>22970: adapt codes using rational dense matrices</code></td></tr></table>




---

archive/issue_comments_345699.json:
```json
{
    "body": "**Commit:** [83e3a87687ee96e5a4b8cbcb91e825d8009bc4e2](https://github.com/sagemath/sagetrac-mirror/commit/83e3a87687ee96e5a4b8cbcb91e825d8009bc4e2)",
    "created_at": "2017-05-11T09:43:29Z",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-345699",
    "user": "https://github.com/videlec"
}
```

**Commit:** [83e3a87687ee96e5a4b8cbcb91e825d8009bc4e2](https://github.com/sagemath/sagetrac-mirror/commit/83e3a87687ee96e5a4b8cbcb91e825d8009bc4e2)



---

archive/issue_comments_345700.json:
```json
{
    "body": "<a id='comment:2'></a>\nFor a discussion about an annoying segfault related to this ticket, see [this thread](https://groups.google.com/forum/#!topic/sage-devel/Vk3gAZiBfQ8).",
    "created_at": "2017-05-11T09:53:47Z",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-345700",
    "user": "https://github.com/videlec"
}
```

<a id='comment:2'></a>
For a discussion about an annoying segfault related to this ticket, see [this thread](https://groups.google.com/forum/#!topic/sage-devel/Vk3gAZiBfQ8).



---

archive/issue_comments_345701.json:
```json
{
    "body": "<a id='comment:3'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3daa7222584cf0c553c7d71ea2a869a3ebf5270f\">3daa722</a></td><td><code>22970: more flint declarations</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/26822a248b8f243604392b91c7d99354368645ba\">26822a2</a></td><td><code>22970: nonzero versions of gmp randomize functions</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/769d86ca95cdf25ed313b502878066cb25815fad\">769d86c</a></td><td><code>22970: pari / fmpq_mat_t conversions</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/99cf14141e23fe63425c064836e04ca7e95486f0\">99cf141</a></td><td><code>22970: let rational dense matrix uses fmpq_mat_t</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a254a43e3f4db5e850691bded1fbe7bb59ef0a03\">a254a43</a></td><td><code>22970: adapt codes using rational dense matrices</code></td></tr></table>\n",
    "created_at": "2017-05-11T14:54:26Z",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-345701",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3daa7222584cf0c553c7d71ea2a869a3ebf5270f">3daa722</a></td><td><code>22970: more flint declarations</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/26822a248b8f243604392b91c7d99354368645ba">26822a2</a></td><td><code>22970: nonzero versions of gmp randomize functions</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/769d86ca95cdf25ed313b502878066cb25815fad">769d86c</a></td><td><code>22970: pari / fmpq_mat_t conversions</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/99cf14141e23fe63425c064836e04ca7e95486f0">99cf141</a></td><td><code>22970: let rational dense matrix uses fmpq_mat_t</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a254a43e3f4db5e850691bded1fbe7bb59ef0a03">a254a43</a></td><td><code>22970: adapt codes using rational dense matrices</code></td></tr></table>




---

archive/issue_comments_345702.json:
```json
{
    "body": "**Changing commit** from \"[83e3a87687ee96e5a4b8cbcb91e825d8009bc4e2](https://github.com/sagemath/sagetrac-mirror/commit/83e3a87687ee96e5a4b8cbcb91e825d8009bc4e2)\" to \"[a254a43e3f4db5e850691bded1fbe7bb59ef0a03](https://github.com/sagemath/sagetrac-mirror/commit/a254a43e3f4db5e850691bded1fbe7bb59ef0a03)\".",
    "created_at": "2017-05-11T14:54:26Z",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-345702",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[83e3a87687ee96e5a4b8cbcb91e825d8009bc4e2](https://github.com/sagemath/sagetrac-mirror/commit/83e3a87687ee96e5a4b8cbcb91e825d8009bc4e2)" to "[a254a43e3f4db5e850691bded1fbe7bb59ef0a03](https://github.com/sagemath/sagetrac-mirror/commit/a254a43e3f4db5e850691bded1fbe7bb59ef0a03)".



---

archive/issue_events_204666.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-05-11T14:55:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22970#event-204666"
}
```



---

archive/issue_comments_345703.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n-The flint library has a builtin type for rational matrices. This ticket proposes to replace the current array of `mpq_t` for the data to the `fmpq_mat_t` type of flint.\n+The flint library has a builtin type for rational matrices: `fmpq_mat_t`. This ticket proposes to replace the current array of `mpq_t` wrapped by `Matrix_rational_dense` in favor of `fmpq_mat_t`.\n \n (See also the related #22924 and #22872)\n``````\n",
    "created_at": "2017-05-11T15:16:04Z",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-345703",
    "user": "https://github.com/videlec"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
-The flint library has a builtin type for rational matrices. This ticket proposes to replace the current array of `mpq_t` for the data to the `fmpq_mat_t` type of flint.
+The flint library has a builtin type for rational matrices: `fmpq_mat_t`. This ticket proposes to replace the current array of `mpq_t` wrapped by `Matrix_rational_dense` in favor of `fmpq_mat_t`.
 
 (See also the related #22924 and #22872)
``````




---

archive/issue_comments_345704.json:
```json
{
    "body": "**Changing keywords** from \"\" to \"thursdaysbdx\".",
    "created_at": "2017-05-11T15:30:04Z",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-345704",
    "user": "https://github.com/videlec"
}
```

**Changing keywords** from "" to "thursdaysbdx".



---

archive/issue_comments_345705.json:
```json
{
    "body": "<a id='comment:7'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1621ac1e7945ee0df2aa92b47de5bf614bb9148d\">1621ac1</a></td><td><code>22970: use flint by default in det/inverse</code></td></tr></table>\n",
    "created_at": "2017-05-12T07:29:15Z",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-345705",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1621ac1e7945ee0df2aa92b47de5bf614bb9148d">1621ac1</a></td><td><code>22970: use flint by default in det/inverse</code></td></tr></table>




---

archive/issue_comments_345706.json:
```json
{
    "body": "**Changing commit** from \"[a254a43e3f4db5e850691bded1fbe7bb59ef0a03](https://github.com/sagemath/sagetrac-mirror/commit/a254a43e3f4db5e850691bded1fbe7bb59ef0a03)\" to \"[1621ac1e7945ee0df2aa92b47de5bf614bb9148d](https://github.com/sagemath/sagetrac-mirror/commit/1621ac1e7945ee0df2aa92b47de5bf614bb9148d)\".",
    "created_at": "2017-05-12T07:29:15Z",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-345706",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[a254a43e3f4db5e850691bded1fbe7bb59ef0a03](https://github.com/sagemath/sagetrac-mirror/commit/a254a43e3f4db5e850691bded1fbe7bb59ef0a03)" to "[1621ac1e7945ee0df2aa92b47de5bf614bb9148d](https://github.com/sagemath/sagetrac-mirror/commit/1621ac1e7945ee0df2aa92b47de5bf614bb9148d)".



---

archive/issue_comments_345707.json:
```json
{
    "body": "<a id='comment:8'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3daa7222584cf0c553c7d71ea2a869a3ebf5270f\">3daa722</a></td><td><code>22970: more flint declarations</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/26822a248b8f243604392b91c7d99354368645ba\">26822a2</a></td><td><code>22970: nonzero versions of gmp randomize functions</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/769d86ca95cdf25ed313b502878066cb25815fad\">769d86c</a></td><td><code>22970: pari / fmpq_mat_t conversions</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/99cf14141e23fe63425c064836e04ca7e95486f0\">99cf141</a></td><td><code>22970: let rational dense matrix uses fmpq_mat_t</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a254a43e3f4db5e850691bded1fbe7bb59ef0a03\">a254a43</a></td><td><code>22970: adapt codes using rational dense matrices</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1621ac1e7945ee0df2aa92b47de5bf614bb9148d\">1621ac1</a></td><td><code>22970: use flint by default in det/inverse</code></td></tr></table>\n",
    "created_at": "2017-05-12T11:42:28Z",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-345707",
    "user": "https://github.com/videlec"
}
```

<a id='comment:8'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3daa7222584cf0c553c7d71ea2a869a3ebf5270f">3daa722</a></td><td><code>22970: more flint declarations</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/26822a248b8f243604392b91c7d99354368645ba">26822a2</a></td><td><code>22970: nonzero versions of gmp randomize functions</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/769d86ca95cdf25ed313b502878066cb25815fad">769d86c</a></td><td><code>22970: pari / fmpq_mat_t conversions</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/99cf14141e23fe63425c064836e04ca7e95486f0">99cf141</a></td><td><code>22970: let rational dense matrix uses fmpq_mat_t</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a254a43e3f4db5e850691bded1fbe7bb59ef0a03">a254a43</a></td><td><code>22970: adapt codes using rational dense matrices</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1621ac1e7945ee0df2aa92b47de5bf614bb9148d">1621ac1</a></td><td><code>22970: use flint by default in det/inverse</code></td></tr></table>




---

archive/issue_comments_345708.json:
```json
{
    "body": "<a id='comment:9'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/867ed5650aec68870282416055aaecaf0b735dfb\">867ed56</a></td><td><code>29970: echelonize/echelon_form using flint</code></td></tr></table>\n",
    "created_at": "2017-05-12T11:42:45Z",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-345708",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/867ed5650aec68870282416055aaecaf0b735dfb">867ed56</a></td><td><code>29970: echelonize/echelon_form using flint</code></td></tr></table>




---

archive/issue_comments_345709.json:
```json
{
    "body": "**Changing commit** from \"[1621ac1e7945ee0df2aa92b47de5bf614bb9148d](https://github.com/sagemath/sagetrac-mirror/commit/1621ac1e7945ee0df2aa92b47de5bf614bb9148d)\" to \"[867ed5650aec68870282416055aaecaf0b735dfb](https://github.com/sagemath/sagetrac-mirror/commit/867ed5650aec68870282416055aaecaf0b735dfb)\".",
    "created_at": "2017-05-12T11:42:45Z",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-345709",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[1621ac1e7945ee0df2aa92b47de5bf614bb9148d](https://github.com/sagemath/sagetrac-mirror/commit/1621ac1e7945ee0df2aa92b47de5bf614bb9148d)" to "[867ed5650aec68870282416055aaecaf0b735dfb](https://github.com/sagemath/sagetrac-mirror/commit/867ed5650aec68870282416055aaecaf0b735dfb)".



---

archive/issue_comments_345710.json:
```json
{
    "body": "<a id='comment:10'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d1c8d52b65b83268fc1ff6eca155cf85c7797850\">d1c8d52</a></td><td><code>29970: echelonize/echelon_form using flint</code></td></tr></table>\n",
    "created_at": "2017-05-12T13:48:35Z",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-345710",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d1c8d52b65b83268fc1ff6eca155cf85c7797850">d1c8d52</a></td><td><code>29970: echelonize/echelon_form using flint</code></td></tr></table>




---

archive/issue_comments_345711.json:
```json
{
    "body": "**Changing commit** from \"[867ed5650aec68870282416055aaecaf0b735dfb](https://github.com/sagemath/sagetrac-mirror/commit/867ed5650aec68870282416055aaecaf0b735dfb)\" to \"[d1c8d52b65b83268fc1ff6eca155cf85c7797850](https://github.com/sagemath/sagetrac-mirror/commit/d1c8d52b65b83268fc1ff6eca155cf85c7797850)\".",
    "created_at": "2017-05-12T13:48:35Z",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-345711",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[867ed5650aec68870282416055aaecaf0b735dfb](https://github.com/sagemath/sagetrac-mirror/commit/867ed5650aec68870282416055aaecaf0b735dfb)" to "[d1c8d52b65b83268fc1ff6eca155cf85c7797850](https://github.com/sagemath/sagetrac-mirror/commit/d1c8d52b65b83268fc1ff6eca155cf85c7797850)".



---

archive/issue_comments_345712.json:
```json
{
    "body": "<a id='comment:11'></a>\nThanks for the work Vincent! I think that it's my duty to review this one :-).\n\nWhile I update my develop branch and check the ticket out, could you check that that the docstring in the determinant method is correct? In ``algorithm``, I see ``None`` missing.\n\nAlso, do you happen to have timings? that compare with the previous implementation? Otherwise I can produce some...",
    "created_at": "2017-05-15T11:02:14Z",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-345712",
    "user": "https://github.com/mmasdeu"
}
```

<a id='comment:11'></a>
Thanks for the work Vincent! I think that it's my duty to review this one :-).

While I update my develop branch and check the ticket out, could you check that that the docstring in the determinant method is correct? In ``algorithm``, I see ``None`` missing.

Also, do you happen to have timings? that compare with the previous implementation? Otherwise I can produce some...



---

archive/issue_events_204667.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-05-15T11:20:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22970#event-204667"
}
```



---

archive/issue_events_204668.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-05-15T11:20:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22970#event-204668"
}
```



---

archive/issue_comments_345713.json:
```json
{
    "body": "<a id='comment:12'></a>\nHi Marc,\n\nThanks for proposing the review! I need some more work on my branch as I have strange failing doctests in `sage/modular` that I don't understand right now.\n\nI will provide proper timings for the following methods (tell me if you have more in mind):\n- `determinant`\n- `multiplication`\n- `echelonize`\n- `charpoly` (not yet in flint, but can go through integer matrices)\n- `minpoly` (not yet in flint, but can go through integer matrices)",
    "created_at": "2017-05-15T11:20:30Z",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-345713",
    "user": "https://github.com/videlec"
}
```

<a id='comment:12'></a>
Hi Marc,

Thanks for proposing the review! I need some more work on my branch as I have strange failing doctests in `sage/modular` that I don't understand right now.

I will provide proper timings for the following methods (tell me if you have more in mind):
- `determinant`
- `multiplication`
- `echelonize`
- `charpoly` (not yet in flint, but can go through integer matrices)
- `minpoly` (not yet in flint, but can go through integer matrices)



---

archive/attachments_020920.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "test_file.sage",
    "asset_url": "tarball://root/attachments/ticket22970/test_file.sage",
    "created_at": "2017-05-15T13:47:47Z",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket22970/test_file.sage",
    "user": "https://github.com/videlec"
}
```



---

archive/issue_comments_345714.json:
```json
{
    "body": "Attachment [test_file.sage](https://github.com/sagemath/sage/files/ticket22970/test_file.sage) by @videlec created at 2017-05-15 13:47:47",
    "created_at": "2017-05-15T13:47:47Z",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-345714",
    "user": "https://github.com/videlec"
}
```

Attachment [test_file.sage](https://github.com/sagemath/sage/files/ticket22970/test_file.sage) by @videlec created at 2017-05-15 13:47:47



---

archive/issue_comments_345715.json:
```json
{
    "body": "<a id='comment:13'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f01157c31d5fefe0ff1e91f8fb58c17031632676\">f01157c</a></td><td><code>22970: more flint declarations</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/acce30ce3f2d20ebd03a8f9f2fad6bb180f46fa5\">acce30c</a></td><td><code>22970: nonzero versions of gmp randomize functions</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/be5ccb46c78092dc8d2259efa80e03a03050931d\">be5ccb4</a></td><td><code>22970: pari / fmpq_mat_t conversions</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9ba2c4dd7f6c7d9fe793ba9ca4c5abf9c20dd3a0\">9ba2c4d</a></td><td><code>22970: let rational dense matrix uses fmpq_mat_t</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/150631d3d9ad242c481e2efb2bab3d7490d68254\">150631d</a></td><td><code>22970: adapt codes using rational dense matrices</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a3b6b3797c78c20309ecdbf1846bfb2ea5fd517a\">a3b6b37</a></td><td><code>22970: use flint by default in det/inverse</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/10f6d8cd316897076132d3282b99aab9ec7e33f8\">10f6d8c</a></td><td><code>29970: echelonize/echelon_form using flint</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/aef538e5c62e05b5107911a3d610b49f3908370f\">aef538e</a></td><td><code>22970: derandomize tests in free_module_integer.py</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/edfa6f46b5bab2c2f9e555c2cd673a4795dd4983\">edfa6f4</a></td><td><code>22970: various cleaning in matrix_rational_dense</code></td></tr></table>\n",
    "created_at": "2017-05-15T13:51:05Z",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-345715",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f01157c31d5fefe0ff1e91f8fb58c17031632676">f01157c</a></td><td><code>22970: more flint declarations</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/acce30ce3f2d20ebd03a8f9f2fad6bb180f46fa5">acce30c</a></td><td><code>22970: nonzero versions of gmp randomize functions</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/be5ccb46c78092dc8d2259efa80e03a03050931d">be5ccb4</a></td><td><code>22970: pari / fmpq_mat_t conversions</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9ba2c4dd7f6c7d9fe793ba9ca4c5abf9c20dd3a0">9ba2c4d</a></td><td><code>22970: let rational dense matrix uses fmpq_mat_t</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/150631d3d9ad242c481e2efb2bab3d7490d68254">150631d</a></td><td><code>22970: adapt codes using rational dense matrices</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a3b6b3797c78c20309ecdbf1846bfb2ea5fd517a">a3b6b37</a></td><td><code>22970: use flint by default in det/inverse</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/10f6d8cd316897076132d3282b99aab9ec7e33f8">10f6d8c</a></td><td><code>29970: echelonize/echelon_form using flint</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/aef538e5c62e05b5107911a3d610b49f3908370f">aef538e</a></td><td><code>22970: derandomize tests in free_module_integer.py</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/edfa6f46b5bab2c2f9e555c2cd673a4795dd4983">edfa6f4</a></td><td><code>22970: various cleaning in matrix_rational_dense</code></td></tr></table>




---

archive/issue_comments_345716.json:
```json
{
    "body": "**Changing commit** from \"[d1c8d52b65b83268fc1ff6eca155cf85c7797850](https://github.com/sagemath/sagetrac-mirror/commit/d1c8d52b65b83268fc1ff6eca155cf85c7797850)\" to \"[edfa6f46b5bab2c2f9e555c2cd673a4795dd4983](https://github.com/sagemath/sagetrac-mirror/commit/edfa6f46b5bab2c2f9e555c2cd673a4795dd4983)\".",
    "created_at": "2017-05-15T13:51:05Z",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-345716",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[d1c8d52b65b83268fc1ff6eca155cf85c7797850](https://github.com/sagemath/sagetrac-mirror/commit/d1c8d52b65b83268fc1ff6eca155cf85c7797850)" to "[edfa6f46b5bab2c2f9e555c2cd673a4795dd4983](https://github.com/sagemath/sagetrac-mirror/commit/edfa6f46b5bab2c2f9e555c2cd673a4795dd4983)".



---

archive/issue_comments_345717.json:
```json
{
    "body": "<a id='comment:14'></a>\nAt commit `edfa6f46b5` using [attachment:test_file.sage] I obtain (within different session because of caching)\n\n```\nsage: %runfile test_file.sage\nsage: test(seed=0)\nf = q + 1/2*a1*q^3 + (4*a1 - 26)*q^5 + O(q^6)\nK = Number Field in a1 with defining polynomial x^2 + 32*x - 9984\na = 1/2*a1\nTrue\nFalse\n```\nand\n\n```\nsage: %runfile test_file.sage\nsage: test(seed=1)\nf = q + 1/2*a1*q^3 + (4*a1 - 26)*q^5 + O(q^6)\nK = Number Field in a1 with defining polynomial x^2 + 32*x - 9984\na = 1/2*a1\nFalse\nTrue\n```\nAnd it looks like a bug to me that this result depends on the seed of the random generator...",
    "created_at": "2017-05-15T13:52:00Z",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-345717",
    "user": "https://github.com/videlec"
}
```

<a id='comment:14'></a>
At commit `edfa6f46b5` using [attachment:test_file.sage] I obtain (within different session because of caching)

```
sage: %runfile test_file.sage
sage: test(seed=0)
f = q + 1/2*a1*q^3 + (4*a1 - 26)*q^5 + O(q^6)
K = Number Field in a1 with defining polynomial x^2 + 32*x - 9984
a = 1/2*a1
True
False
```
and

```
sage: %runfile test_file.sage
sage: test(seed=1)
f = q + 1/2*a1*q^3 + (4*a1 - 26)*q^5 + O(q^6)
K = Number Field in a1 with defining polynomial x^2 + 32*x - 9984
a = 1/2*a1
False
True
```
And it looks like a bug to me that this result depends on the seed of the random generator...



---

archive/issue_comments_345718.json:
```json
{
    "body": "<a id='comment:15'></a>\nReplying to [comment:14](#comment%3A14): Discussed at \n[this sage-devel thread](https://groups.google.com/forum/#!topic/sage-devel/7VpAxhycBe0).",
    "created_at": "2017-05-15T14:05:55Z",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-345718",
    "user": "https://github.com/videlec"
}
```

<a id='comment:15'></a>
Replying to [comment:14](#comment%3A14): Discussed at 
[this sage-devel thread](https://groups.google.com/forum/#!topic/sage-devel/7VpAxhycBe0).



---

archive/attachments_020921.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "benchmark_matrices.py",
    "asset_url": "tarball://root/attachments/ticket22970/benchmark_matrices.py",
    "created_at": "2017-05-16T08:20:12Z",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket22970/benchmark_matrices.py",
    "user": "https://github.com/videlec"
}
```



---

archive/issue_comments_345719.json:
```json
{
    "body": "<a id='comment:16'></a>\nAttachment [benchmark_matrices.py](https://github.com/sagemath/sage/files/ticket22970/benchmark_matrices.py) by @videlec created at 2017-05-16 08:20:12\n\nFrom [attachment:benchmark_matrices.py]\n\n- echelonize: flint is better except when coefficients are huge in which case multimodular is best\n\n```\nnrows=5  ncols=5  rank=5, density=1.0000 nbits(height)=100\nflint        0.0565\nmultimodular 0.3284\npadic        0.5626\n\nnrows=10  ncols=10  rank=5, density=1.0000 nbits(height)=37\nflint        0.1063\nmultimodular 2.6420\npadic        7.6511\n\nnrows=100  ncols=100  rank=20, density=0.1799 nbits(height)=12\nflint        9.1834\nmultimodular 12.2192\npadic        74.8152\n\nnrows=10  ncols=10  rank=10, density=1.0000 nbits(height)=200\nflint        10.1606\nmultimodular 1.5586\npadic        2.1540\n```\n- determinant\n\n```\ndim=3 density=0.7778 nbits(height)=3\nflint        0.0092\ninteger      0.1334\npari         0.0017\n\ndim=3 density=1.0000 nbits(height)=100\nflint        0.0113\ninteger      0.1188\npari         0.0269\n\ndim=30 density=1.0000 nbits(height)=5\nflint        0.9006\ninteger      1.0754\npari         34.5452\n\ndim=30 density=0.2544 nbits(height)=5\nflint        0.4389\ninteger      0.9986\npari         179.9622\n```\n- charpoly\n\n```\ndim=3 density=0.7778 nbits(height)=2\nflint        0.3875\nlinbox       1.3019\ngeneric      0.0431\n\ndim=4 density=0.5625 nbits(height)=2\nflint        0.1776\nlinbox       1.2013\ngeneric      0.0450\n\ndim=5 density=0.6400 nbits(height)=2\nflint        0.1737\nlinbox       1.2952\ngeneric      0.0532\n\ndim=6 density=0.6111 nbits(height)=2\nflint        0.1850\nlinbox       1.2773\ngeneric      0.0651\n\ndim=10 density=0.4100 nbits(height)=2\nflint        0.2343\nlinbox       1.4250\ngeneric      0.1818\n\ndim=10 density=1.0000 nbits(height)=2\nflint        0.2521\nlinbox       1.4264\ngeneric      0.4842\n\ndim=30 density=1.0000 nbits(height)=2\nflint        4.8531\nlinbox       3.4320\ngeneric      50.0362\n```",
    "created_at": "2017-05-16T08:20:12Z",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-345719",
    "user": "https://github.com/videlec"
}
```

<a id='comment:16'></a>
Attachment [benchmark_matrices.py](https://github.com/sagemath/sage/files/ticket22970/benchmark_matrices.py) by @videlec created at 2017-05-16 08:20:12

From [attachment:benchmark_matrices.py]

- echelonize: flint is better except when coefficients are huge in which case multimodular is best

```
nrows=5  ncols=5  rank=5, density=1.0000 nbits(height)=100
flint        0.0565
multimodular 0.3284
padic        0.5626

nrows=10  ncols=10  rank=5, density=1.0000 nbits(height)=37
flint        0.1063
multimodular 2.6420
padic        7.6511

nrows=100  ncols=100  rank=20, density=0.1799 nbits(height)=12
flint        9.1834
multimodular 12.2192
padic        74.8152

nrows=10  ncols=10  rank=10, density=1.0000 nbits(height)=200
flint        10.1606
multimodular 1.5586
padic        2.1540
```
- determinant

```
dim=3 density=0.7778 nbits(height)=3
flint        0.0092
integer      0.1334
pari         0.0017

dim=3 density=1.0000 nbits(height)=100
flint        0.0113
integer      0.1188
pari         0.0269

dim=30 density=1.0000 nbits(height)=5
flint        0.9006
integer      1.0754
pari         34.5452

dim=30 density=0.2544 nbits(height)=5
flint        0.4389
integer      0.9986
pari         179.9622
```
- charpoly

```
dim=3 density=0.7778 nbits(height)=2
flint        0.3875
linbox       1.3019
generic      0.0431

dim=4 density=0.5625 nbits(height)=2
flint        0.1776
linbox       1.2013
generic      0.0450

dim=5 density=0.6400 nbits(height)=2
flint        0.1737
linbox       1.2952
generic      0.0532

dim=6 density=0.6111 nbits(height)=2
flint        0.1850
linbox       1.2773
generic      0.0651

dim=10 density=0.4100 nbits(height)=2
flint        0.2343
linbox       1.4250
generic      0.1818

dim=10 density=1.0000 nbits(height)=2
flint        0.2521
linbox       1.4264
generic      0.4842

dim=30 density=1.0000 nbits(height)=2
flint        4.8531
linbox       3.4320
generic      50.0362
```



---

archive/issue_comments_345720.json:
```json
{
    "body": "<a id='comment:17'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ba1787ad88f72b23425f2cb2dd50853e6b941c5b\">ba1787a</a></td><td><code>22970: various cleaning in matrix_rational_dense</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/37614675ea8c814e0af3e2fb6664f6c5c0ade0f1\">3761467</a></td><td><code>22970: fix doctests in sage/modular/</code></td></tr></table>\n",
    "created_at": "2017-05-16T09:58:36Z",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-345720",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:17'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ba1787ad88f72b23425f2cb2dd50853e6b941c5b">ba1787a</a></td><td><code>22970: various cleaning in matrix_rational_dense</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/37614675ea8c814e0af3e2fb6664f6c5c0ade0f1">3761467</a></td><td><code>22970: fix doctests in sage/modular/</code></td></tr></table>




---

archive/issue_comments_345721.json:
```json
{
    "body": "**Changing commit** from \"[edfa6f46b5bab2c2f9e555c2cd673a4795dd4983](https://github.com/sagemath/sagetrac-mirror/commit/edfa6f46b5bab2c2f9e555c2cd673a4795dd4983)\" to \"[37614675ea8c814e0af3e2fb6664f6c5c0ade0f1](https://github.com/sagemath/sagetrac-mirror/commit/37614675ea8c814e0af3e2fb6664f6c5c0ade0f1)\".",
    "created_at": "2017-05-16T09:58:36Z",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-345721",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[edfa6f46b5bab2c2f9e555c2cd673a4795dd4983](https://github.com/sagemath/sagetrac-mirror/commit/edfa6f46b5bab2c2f9e555c2cd673a4795dd4983)" to "[37614675ea8c814e0af3e2fb6664f6c5c0ade0f1](https://github.com/sagemath/sagetrac-mirror/commit/37614675ea8c814e0af3e2fb6664f6c5c0ade0f1)".



---

archive/issue_events_204669.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-05-16T09:59:15Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22970#event-204669"
}
```



---

archive/issue_events_204670.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-05-16T09:59:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22970#event-204670"
}
```



---

archive/issue_comments_345722.json:
```json
{
    "body": "<a id='comment:18'></a>\nNeeds review again. I tried to make independent of the random seed the annoying doctests in sage/modular...",
    "created_at": "2017-05-16T09:59:15Z",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-345722",
    "user": "https://github.com/videlec"
}
```

<a id='comment:18'></a>
Needs review again. I tried to make independent of the random seed the annoying doctests in sage/modular...



---

archive/issue_comments_345723.json:
```json
{
    "body": "<a id='comment:19'></a>\npatchbot is green!! (with a weird ascii complaints)",
    "created_at": "2017-05-16T12:59:54Z",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-345723",
    "user": "https://github.com/videlec"
}
```

<a id='comment:19'></a>
patchbot is green!! (with a weird ascii complaints)



---

archive/issue_comments_345724.json:
```json
{
    "body": "<a id='comment:20'></a>\nOn my computer, a call to\n\n```\nsage: CuspForms(101,12).hecke_matrix(3)\n```\n\ntakes 765 seconds with the current develop branch, and 1157 seconds with the proposed patch. I think that most of it is explained by the fact that the method echelon_form is called 1394 times on quite large matrices (dense, over QQ). I was actually looking for speed-ups in existing high-level functionality (like this one), so this is a bit disappointing.\n\nMaybe the default algorithm should be changed if the entries are large?",
    "created_at": "2017-05-16T14:41:02Z",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-345724",
    "user": "https://github.com/mmasdeu"
}
```

<a id='comment:20'></a>
On my computer, a call to

```
sage: CuspForms(101,12).hecke_matrix(3)
```

takes 765 seconds with the current develop branch, and 1157 seconds with the proposed patch. I think that most of it is explained by the fact that the method echelon_form is called 1394 times on quite large matrices (dense, over QQ). I was actually looking for speed-ups in existing high-level functionality (like this one), so this is a bit disappointing.

Maybe the default algorithm should be changed if the entries are large?



---

archive/issue_comments_345725.json:
```json
{
    "body": "<a id='comment:21'></a>\nReplying to [mmasdeu](#comment%3A20):\n> On my computer, a call to\n> \n> ```\n> sage: CuspForms(101,12).hecke_matrix(3)\n> ```\n> \n> takes 765 seconds with the current develop branch, and 1157 seconds with the proposed patch. I think that most of it is explained by the fact that the method echelon_form is called 1394 times on quite large matrices (dense, over QQ). I was actually looking for speed-ups in existing high-level functionality (like this one), so this is a bit disappointing.\n> \n> Maybe the default algorithm should be changed if the entries are large?\n\n\nI did not do proper tunings (since I will redo it after #22924 anyway). However, I can try to do something better for `echelon_form/echelonize`. Do you have other relevant examples in mind?",
    "created_at": "2017-05-16T14:49:30Z",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-345725",
    "user": "https://github.com/videlec"
}
```

<a id='comment:21'></a>
Replying to [mmasdeu](#comment%3A20):
> On my computer, a call to
> 
> ```
> sage: CuspForms(101,12).hecke_matrix(3)
> ```
> 
> takes 765 seconds with the current develop branch, and 1157 seconds with the proposed patch. I think that most of it is explained by the fact that the method echelon_form is called 1394 times on quite large matrices (dense, over QQ). I was actually looking for speed-ups in existing high-level functionality (like this one), so this is a bit disappointing.
> 
> Maybe the default algorithm should be changed if the entries are large?


I did not do proper tunings (since I will redo it after #22924 anyway). However, I can try to do something better for `echelon_form/echelonize`. Do you have other relevant examples in mind?



---

archive/issue_comments_345726.json:
```json
{
    "body": "<a id='comment:22'></a>\nNot at the moment. I haven't done exhaustive tests either, but it seems that in many cases the performance is similar.\n\nAs for other examples, many operations with subquotients involve doing this kind of linear algebra.",
    "created_at": "2017-05-16T15:12:14Z",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-345726",
    "user": "https://github.com/mmasdeu"
}
```

<a id='comment:22'></a>
Not at the moment. I haven't done exhaustive tests either, but it seems that in many cases the performance is similar.

As for other examples, many operations with subquotients involve doing this kind of linear algebra.



---

archive/issue_comments_345727.json:
```json
{
    "body": "<a id='comment:23'></a>\nSome remarks\n- flint has several algorithms for echelon form and this is not finely tuned.\n- On very specific instances, multimodular can be much faster (up to x100). This is the reason why your example `CuspForms(101,12).hecke_matrix(3)` gets slower. I have no idea how to detect such instances.\n- for `random_matrix(QQ, ...)` (ie independent entries) flint looks like to be the best option excepted in the range `10 <= nrows=ncols <= 20` where flint tuning (over Z) is very bad\n\nOne way to go might be to have a global option that controls the default behavior of the echelon form. I am thinking of something that can be used like\n\n```python\ndef my_modular_form_algorithm():\n    with rational_echelon_form('multimodular'):\n        # some relevant code here\n        ....\n```\nWhat do you think?",
    "created_at": "2017-05-17T08:49:44Z",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-345727",
    "user": "https://github.com/videlec"
}
```

<a id='comment:23'></a>
Some remarks
- flint has several algorithms for echelon form and this is not finely tuned.
- On very specific instances, multimodular can be much faster (up to x100). This is the reason why your example `CuspForms(101,12).hecke_matrix(3)` gets slower. I have no idea how to detect such instances.
- for `random_matrix(QQ, ...)` (ie independent entries) flint looks like to be the best option excepted in the range `10 <= nrows=ncols <= 20` where flint tuning (over Z) is very bad

One way to go might be to have a global option that controls the default behavior of the echelon form. I am thinking of something that can be used like

```python
def my_modular_form_algorithm():
    with rational_echelon_form('multimodular'):
        # some relevant code here
        ....
```
What do you think?



---

archive/issue_comments_345728.json:
```json
{
    "body": "<a id='comment:24'></a>\nSecond option, allow the option `algorithm=my_function` where `my_function` takes a matrix as input and returns a valid algorithm for echelon form. (I do prefer this one better)\n\nEDIT: this will not work since `echelon_form` is **indirectly** called in modular function algorithms...",
    "created_at": "2017-05-17T08:56:07Z",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-345728",
    "user": "https://github.com/videlec"
}
```

<a id='comment:24'></a>
Second option, allow the option `algorithm=my_function` where `my_function` takes a matrix as input and returns a valid algorithm for echelon form. (I do prefer this one better)

EDIT: this will not work since `echelon_form` is **indirectly** called in modular function algorithms...



---

archive/issue_comments_345729.json:
```json
{
    "body": "<a id='comment:25'></a>\nImplementing the idea from [comment:23](#comment%3A23) I got\n\n```\nsage: %time m = CuspForms(31, 12).hecke_matrix(3)\nCPU times: user 7.52 s, sys: 63.3 ms, total: 7.59 s\nWall time: 7.55 s\n\nsage: %time c = CuspForms(51, 12).hecke_matrix(3)\nCPU times: user 2min 13s, sys: 203 ms, total: 2min 13s\nWall time: 2min 13s\n\nsage: %time c = CuspForms(101, 12).hecke_matrix(3)\nCPU times: user 5min 10s, sys: 663 ms, total: 5min 10s\nWall time: 5min 10s\n```\nagainst the following in develop\n\n```\nsage: %time m = CuspForms(31, 12).hecke_matrix(3)\nCPU times: user 13.5 s, sys: 43.3 ms, total: 13.6 s\nWall time: 13.5 s\n\nsage: %time c = CuspForms(51, 12).hecke_matrix(3)\nCPU times: user 3min 8s, sys: 250 ms, total: 3min 9s\nWall time: 3min 9s\n\n%time c = CuspForms(101, 12).hecke_matrix(3)\nCPU times: user 8min 7s, sys: 527 ms, total: 8min 8s\nWall time: 8min 8s\n```\n(so close to x2 improvement)\n\nI propose to postpone this improvement to another ticket since this one is already a big change. If you agree I will open a new one and work on it as soon as this one is closed.",
    "created_at": "2017-05-17T09:58:04Z",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-345729",
    "user": "https://github.com/videlec"
}
```

<a id='comment:25'></a>
Implementing the idea from [comment:23](#comment%3A23) I got

```
sage: %time m = CuspForms(31, 12).hecke_matrix(3)
CPU times: user 7.52 s, sys: 63.3 ms, total: 7.59 s
Wall time: 7.55 s

sage: %time c = CuspForms(51, 12).hecke_matrix(3)
CPU times: user 2min 13s, sys: 203 ms, total: 2min 13s
Wall time: 2min 13s

sage: %time c = CuspForms(101, 12).hecke_matrix(3)
CPU times: user 5min 10s, sys: 663 ms, total: 5min 10s
Wall time: 5min 10s
```
against the following in develop

```
sage: %time m = CuspForms(31, 12).hecke_matrix(3)
CPU times: user 13.5 s, sys: 43.3 ms, total: 13.6 s
Wall time: 13.5 s

sage: %time c = CuspForms(51, 12).hecke_matrix(3)
CPU times: user 3min 8s, sys: 250 ms, total: 3min 9s
Wall time: 3min 9s

%time c = CuspForms(101, 12).hecke_matrix(3)
CPU times: user 8min 7s, sys: 527 ms, total: 8min 8s
Wall time: 8min 8s
```
(so close to x2 improvement)

I propose to postpone this improvement to another ticket since this one is already a big change. If you agree I will open a new one and work on it as soon as this one is closed.



---

archive/issue_comments_345730.json:
```json
{
    "body": "<a id='comment:26'></a>\n1) I agree that this can be dealt with in another ticket, but it is moderately urgent. ModularSymbols / ModularForms becoming twice slower than currently is not good news...\n\nAnother example of a reasonable calculation: with the Sage 7.5.1 the following calculation takes 22 seconds on my laptop. It takes 1min22s (!) with the proposed patch.\n\n```\nsage: %time A = ModularSymbols(11,60).hecke_matrix(3)\n```\n\n2) While reviewing, in `sage/modular/hecke/module.py` there is a doctest that changed in a suspicious way. It seems that a number field was created with a different generator and that causes the output to look different. I propose that the line that causes trouble gets changed into\n\n```\nsage: [o.minpoly() for o in A.system_of_eigenvalues(3)]\n[x - 1, x + 1, x^2 - 2*x - 2]\n```\n\nThe output that appears should not depend on the implementation.\n\n3) There seems to be quite a mess on what are the acceptable values to the 'algorithm' parameter. Maybe it's a good time to change that! My suggestion would be that the default would always be None, and then the docstring would specify what is done in this case.",
    "created_at": "2017-05-18T11:07:00Z",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-345730",
    "user": "https://github.com/mmasdeu"
}
```

<a id='comment:26'></a>
1) I agree that this can be dealt with in another ticket, but it is moderately urgent. ModularSymbols / ModularForms becoming twice slower than currently is not good news...

Another example of a reasonable calculation: with the Sage 7.5.1 the following calculation takes 22 seconds on my laptop. It takes 1min22s (!) with the proposed patch.

```
sage: %time A = ModularSymbols(11,60).hecke_matrix(3)
```

2) While reviewing, in `sage/modular/hecke/module.py` there is a doctest that changed in a suspicious way. It seems that a number field was created with a different generator and that causes the output to look different. I propose that the line that causes trouble gets changed into

```
sage: [o.minpoly() for o in A.system_of_eigenvalues(3)]
[x - 1, x + 1, x^2 - 2*x - 2]
```

The output that appears should not depend on the implementation.

3) There seems to be quite a mess on what are the acceptable values to the 'algorithm' parameter. Maybe it's a good time to change that! My suggestion would be that the default would always be None, and then the docstring would specify what is done in this case.



---

archive/issue_events_204671.json:
```json
{
    "actor": "https://github.com/mmasdeu",
    "created_at": "2017-05-18T11:07:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22970#event-204671"
}
```



---

archive/issue_events_204672.json:
```json
{
    "actor": "https://github.com/mmasdeu",
    "created_at": "2017-05-18T11:07:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22970#event-204672"
}
```



---

archive/issue_comments_345731.json:
```json
{
    "body": "<a id='comment:27'></a>\nI might have an explanation for why Flint is slow for these modular symbol matrices. See:\n\nhttps://github.com/wbhart/flint2/issues/335\n\nIt can be fixed in Flint (if my analysis is correct), but this requires some amount of coding.",
    "created_at": "2017-05-18T16:03:48Z",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-345731",
    "user": "https://github.com/fredrik-johansson"
}
```

<a id='comment:27'></a>
I might have an explanation for why Flint is slow for these modular symbol matrices. See:

https://github.com/wbhart/flint2/issues/335

It can be fixed in Flint (if my analysis is correct), but this requires some amount of coding.



---

archive/issue_comments_345732.json:
```json
{
    "body": "<a id='comment:28'></a>\nReplying to [fredrik.johansson](#comment%3A27):\n> I might have an explanation for why Flint is slow for these modular symbol matrices. See:\n> \n> https://github.com/wbhart/flint2/issues/335\n> \n> It can be fixed in Flint (if my analysis is correct), but this requires some amount of coding.\n\n\nWould be tremendous!",
    "created_at": "2017-05-18T16:17:36Z",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-345732",
    "user": "https://github.com/videlec"
}
```

<a id='comment:28'></a>
Replying to [fredrik.johansson](#comment%3A27):
> I might have an explanation for why Flint is slow for these modular symbol matrices. See:
> 
> https://github.com/wbhart/flint2/issues/335
> 
> It can be fixed in Flint (if my analysis is correct), but this requires some amount of coding.


Would be tremendous!



---

archive/issue_comments_345733.json:
```json
{
    "body": "<a id='comment:29'></a>\n@mmasdeu: for the sake of this ticket I will set the default to `multimodular` that should actually speed up all modular symbol computations. Then #23026 will deal with making flint the default (that is much faster on random instances).",
    "created_at": "2017-05-18T16:22:44Z",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-345733",
    "user": "https://github.com/videlec"
}
```

<a id='comment:29'></a>
@mmasdeu: for the sake of this ticket I will set the default to `multimodular` that should actually speed up all modular symbol computations. Then #23026 will deal with making flint the default (that is much faster on random instances).



---

archive/issue_comments_345734.json:
```json
{
    "body": "<a id='comment:30'></a>\nThat sounds reasonable...at least there is no regression in speed (hopefully!).",
    "created_at": "2017-05-18T16:32:17Z",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-345734",
    "user": "https://github.com/mmasdeu"
}
```

<a id='comment:30'></a>
That sounds reasonable...at least there is no regression in speed (hopefully!).



---

archive/issue_comments_345735.json:
```json
{
    "body": "<a id='comment:31'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/948cab12b479a1ab0fa1cd4b28ce5a1d8b737b9a\">948cab1</a></td><td><code>22970: better doctest in modular/hecke/module.py</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b5f5600ddc92113f3307b07a13c3d60e0bb5a736\">b5f5600</a></td><td><code>22970: improved doc + simpler echelonize/echelon_form logic</code></td></tr></table>\n",
    "created_at": "2017-05-18T17:40:59Z",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-345735",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:31'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/948cab12b479a1ab0fa1cd4b28ce5a1d8b737b9a">948cab1</a></td><td><code>22970: better doctest in modular/hecke/module.py</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b5f5600ddc92113f3307b07a13c3d60e0bb5a736">b5f5600</a></td><td><code>22970: improved doc + simpler echelonize/echelon_form logic</code></td></tr></table>




---

archive/issue_comments_345736.json:
```json
{
    "body": "**Changing commit** from \"[37614675ea8c814e0af3e2fb6664f6c5c0ade0f1](https://github.com/sagemath/sagetrac-mirror/commit/37614675ea8c814e0af3e2fb6664f6c5c0ade0f1)\" to \"[b5f5600ddc92113f3307b07a13c3d60e0bb5a736](https://github.com/sagemath/sagetrac-mirror/commit/b5f5600ddc92113f3307b07a13c3d60e0bb5a736)\".",
    "created_at": "2017-05-18T17:40:59Z",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-345736",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[37614675ea8c814e0af3e2fb6664f6c5c0ade0f1](https://github.com/sagemath/sagetrac-mirror/commit/37614675ea8c814e0af3e2fb6664f6c5c0ade0f1)" to "[b5f5600ddc92113f3307b07a13c3d60e0bb5a736](https://github.com/sagemath/sagetrac-mirror/commit/b5f5600ddc92113f3307b07a13c3d60e0bb5a736)".



---

archive/issue_comments_345737.json:
```json
{
    "body": "<a id='comment:32'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/14d31c55cb4ba6d1e4f98af46cced7af7edda194\">14d31c5</a></td><td><code>22970: better doctest in modular/hecke/module.py</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0c8b2ce8067e8d5cbf01df1827e921b115167f9d\">0c8b2ce</a></td><td><code>22970: improved doc + simpler echelonize/echelon_form logic</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c1720649e5cc015e54d7dd7054fb1920a9065d6b\">c172064</a></td><td><code>22970: _new_matrix/from_columns/add_to_entry</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5f2e1bac18839e95198e455897ab81cc35c8923f\">5f2e1ba</a></td><td><code>22970: small optimization in modsym/ambient.py</code></td></tr></table>\n",
    "created_at": "2017-05-18T18:32:04Z",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-345737",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:32'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/14d31c55cb4ba6d1e4f98af46cced7af7edda194">14d31c5</a></td><td><code>22970: better doctest in modular/hecke/module.py</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0c8b2ce8067e8d5cbf01df1827e921b115167f9d">0c8b2ce</a></td><td><code>22970: improved doc + simpler echelonize/echelon_form logic</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c1720649e5cc015e54d7dd7054fb1920a9065d6b">c172064</a></td><td><code>22970: _new_matrix/from_columns/add_to_entry</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5f2e1bac18839e95198e455897ab81cc35c8923f">5f2e1ba</a></td><td><code>22970: small optimization in modsym/ambient.py</code></td></tr></table>




---

archive/issue_comments_345738.json:
```json
{
    "body": "**Changing commit** from \"[b5f5600ddc92113f3307b07a13c3d60e0bb5a736](https://github.com/sagemath/sagetrac-mirror/commit/b5f5600ddc92113f3307b07a13c3d60e0bb5a736)\" to \"[5f2e1bac18839e95198e455897ab81cc35c8923f](https://github.com/sagemath/sagetrac-mirror/commit/5f2e1bac18839e95198e455897ab81cc35c8923f)\".",
    "created_at": "2017-05-18T18:32:04Z",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-345738",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[b5f5600ddc92113f3307b07a13c3d60e0bb5a736](https://github.com/sagemath/sagetrac-mirror/commit/b5f5600ddc92113f3307b07a13c3d60e0bb5a736)" to "[5f2e1bac18839e95198e455897ab81cc35c8923f](https://github.com/sagemath/sagetrac-mirror/commit/5f2e1bac18839e95198e455897ab81cc35c8923f)".



---

archive/issue_comments_345739.json:
```json
{
    "body": "<a id='comment:33'></a>\nat commit b5f5600 I got\n\n```\nsage: %time m = CuspForms(31, 12).hecke_matrix(3)\nCPU times: user 11.7 s, sys: 40 ms, total: 11.7 s\nWall time: 11.7 s\n\nsage: %time c = CuspForms(51, 12).hecke_matrix(3)\nCPU times: user 2min 52s, sys: 283 ms, total: 2min 52s\nWall time: 2min 52s\n\nsage: %time c = CuspForms(101, 12).hecke_matrix(3)\nCPU times: user 7min 17s, sys: 620 ms, total: 7min 18s\nWall time: 7min 18s\n```\n\nand at 5f2e1ba the even better\n\n```\nsage: %time m = CuspForms(31, 12).hecke_matrix(3)\nCPU times: user 7.5 s, sys: 36.7 ms, total: 7.53 s\nWall time: 7.51 s\n\nsage: %time c = CuspForms(51, 12).hecke_matrix(3)\nCPU times: user 2min 10s, sys: 223 ms, total: 2min 10s\nWall time: 2min 10s\n\nsage: %time c = CuspForms(101, 12).hecke_matrix(3)\nCPU times: user 5min 9s, sys: 603 ms, total: 5min 10s\nWall time: 5min 10s\n```",
    "created_at": "2017-05-18T18:32:31Z",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-345739",
    "user": "https://github.com/videlec"
}
```

<a id='comment:33'></a>
at commit b5f5600 I got

```
sage: %time m = CuspForms(31, 12).hecke_matrix(3)
CPU times: user 11.7 s, sys: 40 ms, total: 11.7 s
Wall time: 11.7 s

sage: %time c = CuspForms(51, 12).hecke_matrix(3)
CPU times: user 2min 52s, sys: 283 ms, total: 2min 52s
Wall time: 2min 52s

sage: %time c = CuspForms(101, 12).hecke_matrix(3)
CPU times: user 7min 17s, sys: 620 ms, total: 7min 18s
Wall time: 7min 18s
```

and at 5f2e1ba the even better

```
sage: %time m = CuspForms(31, 12).hecke_matrix(3)
CPU times: user 7.5 s, sys: 36.7 ms, total: 7.53 s
Wall time: 7.51 s

sage: %time c = CuspForms(51, 12).hecke_matrix(3)
CPU times: user 2min 10s, sys: 223 ms, total: 2min 10s
Wall time: 2min 10s

sage: %time c = CuspForms(101, 12).hecke_matrix(3)
CPU times: user 5min 9s, sys: 603 ms, total: 5min 10s
Wall time: 5min 10s
```



---

archive/issue_events_204673.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-05-18T18:33:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22970#event-204673"
}
```



---

archive/issue_events_204674.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-05-18T18:33:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22970#event-204674"
}
```



---

archive/issue_comments_345740.json:
```json
{
    "body": "<a id='comment:35'></a>\nAnd tests also pass on beta7!",
    "created_at": "2017-05-19T12:32:48Z",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-345740",
    "user": "https://github.com/videlec"
}
```

<a id='comment:35'></a>
And tests also pass on beta7!



---

archive/issue_comments_345741.json:
```json
{
    "body": "<a id='comment:36'></a>\nThis is definitely more than satisfying. The code looks very clean, and all tests pass. Thanks for the great work!",
    "created_at": "2017-05-21T16:32:29Z",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-345741",
    "user": "https://github.com/mmasdeu"
}
```

<a id='comment:36'></a>
This is definitely more than satisfying. The code looks very clean, and all tests pass. Thanks for the great work!



---

archive/issue_comments_345742.json:
```json
{
    "body": "**Reviewer:** Marc Masdeu",
    "created_at": "2017-05-21T16:32:29Z",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-345742",
    "user": "https://github.com/mmasdeu"
}
```

**Reviewer:** Marc Masdeu



---

archive/issue_events_204675.json:
```json
{
    "actor": "https://github.com/mmasdeu",
    "created_at": "2017-05-21T16:32:29Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22970#event-204675"
}
```



---

archive/issue_events_204676.json:
```json
{
    "actor": "https://github.com/mmasdeu",
    "created_at": "2017-05-21T16:32:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22970#event-204676"
}
```



---

archive/issue_comments_345743.json:
```json
{
    "body": "<a id='comment:37'></a>\nMerge conflict",
    "created_at": "2017-05-22T22:35:06Z",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-345743",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:37'></a>
Merge conflict



---

archive/issue_events_204677.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-05-22T22:35:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22970#event-204677"
}
```



---

archive/issue_events_204678.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-05-22T22:35:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22970#event-204678"
}
```



---

archive/issue_comments_345744.json:
```json
{
    "body": "<a id='comment:38'></a>\nToo bad. The code is fine on beta7. Can I try to fix it by merging another ticket?",
    "created_at": "2017-05-23T06:45:19Z",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-345744",
    "user": "https://github.com/videlec"
}
```

<a id='comment:38'></a>
Too bad. The code is fine on beta7. Can I try to fix it by merging another ticket?



---

archive/issue_comments_345745.json:
```json
{
    "body": "<a id='comment:39'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **Last 10 new commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/86a305b3a4a701b672ef29aaa72c8f10c58c626c\">86a305b</a></td><td><code>22970: adapt codes using rational dense matrices</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b5320ef0ca9d21ba1c1664c05703f7ad59cb092f\">b5320ef</a></td><td><code>22970: use flint by default in det/inverse</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fad1b0ded1bab87c2d433195e00c7c830515606b\">fad1b0d</a></td><td><code>29970: echelonize/echelon_form using flint</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b68993f0dc24766b4a03df9a043aef41fd0293dd\">b68993f</a></td><td><code>22970: derandomize tests in free_module_integer.py</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/91c58356d30aa45588a2f6b46f743c4613b15d8c\">91c5835</a></td><td><code>22970: various cleaning in matrix_rational_dense</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9f8391269443bc41b92d8f71e00336d90ae1324b\">9f83912</a></td><td><code>22970: fix doctests in sage/modular/</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bcf6b7d05e0a12c9b041ff1b564767c589cc6b3a\">bcf6b7d</a></td><td><code>22970: better doctest in modular/hecke/module.py</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/14f3fdb9229ed631dbea407f992353313c51e64b\">14f3fdb</a></td><td><code>22970: improved doc + simpler echelonize/echelon_form logic</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fceef5016bbda0a99d383f4a9d5df4fcc881f7d0\">fceef50</a></td><td><code>22970: _new_matrix/from_columns/add_to_entry</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cb0dae187cbbf8e8b594a64ef5c87553459b7f71\">cb0dae1</a></td><td><code>22970: small optimization in modsym/ambient.py</code></td></tr></table>\n",
    "created_at": "2017-05-29T13:06:10Z",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-345745",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:39'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **Last 10 new commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/86a305b3a4a701b672ef29aaa72c8f10c58c626c">86a305b</a></td><td><code>22970: adapt codes using rational dense matrices</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b5320ef0ca9d21ba1c1664c05703f7ad59cb092f">b5320ef</a></td><td><code>22970: use flint by default in det/inverse</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fad1b0ded1bab87c2d433195e00c7c830515606b">fad1b0d</a></td><td><code>29970: echelonize/echelon_form using flint</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b68993f0dc24766b4a03df9a043aef41fd0293dd">b68993f</a></td><td><code>22970: derandomize tests in free_module_integer.py</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/91c58356d30aa45588a2f6b46f743c4613b15d8c">91c5835</a></td><td><code>22970: various cleaning in matrix_rational_dense</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9f8391269443bc41b92d8f71e00336d90ae1324b">9f83912</a></td><td><code>22970: fix doctests in sage/modular/</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bcf6b7d05e0a12c9b041ff1b564767c589cc6b3a">bcf6b7d</a></td><td><code>22970: better doctest in modular/hecke/module.py</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/14f3fdb9229ed631dbea407f992353313c51e64b">14f3fdb</a></td><td><code>22970: improved doc + simpler echelonize/echelon_form logic</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fceef5016bbda0a99d383f4a9d5df4fcc881f7d0">fceef50</a></td><td><code>22970: _new_matrix/from_columns/add_to_entry</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cb0dae187cbbf8e8b594a64ef5c87553459b7f71">cb0dae1</a></td><td><code>22970: small optimization in modsym/ambient.py</code></td></tr></table>




---

archive/issue_comments_345746.json:
```json
{
    "body": "**Changing commit** from \"[5f2e1bac18839e95198e455897ab81cc35c8923f](https://github.com/sagemath/sagetrac-mirror/commit/5f2e1bac18839e95198e455897ab81cc35c8923f)\" to \"[cb0dae187cbbf8e8b594a64ef5c87553459b7f71](https://github.com/sagemath/sagetrac-mirror/commit/cb0dae187cbbf8e8b594a64ef5c87553459b7f71)\".",
    "created_at": "2017-05-29T13:06:10Z",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-345746",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[5f2e1bac18839e95198e455897ab81cc35c8923f](https://github.com/sagemath/sagetrac-mirror/commit/5f2e1bac18839e95198e455897ab81cc35c8923f)" to "[cb0dae187cbbf8e8b594a64ef5c87553459b7f71](https://github.com/sagemath/sagetrac-mirror/commit/cb0dae187cbbf8e8b594a64ef5c87553459b7f71)".



---

archive/issue_comments_345747.json:
```json
{
    "body": "<a id='comment:40'></a>\nrebased (I launched the patchbot)",
    "created_at": "2017-05-29T13:07:08Z",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-345747",
    "user": "https://github.com/videlec"
}
```

<a id='comment:40'></a>
rebased (I launched the patchbot)



---

archive/issue_events_204679.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-05-29T13:07:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22970#event-204679"
}
```



---

archive/issue_events_204680.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-05-29T13:07:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22970#event-204680"
}
```



---

archive/issue_comments_345748.json:
```json
{
    "body": "<a id='comment:41'></a>\npatchbot still happy!",
    "created_at": "2017-05-29T22:01:47Z",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-345748",
    "user": "https://github.com/videlec"
}
```

<a id='comment:41'></a>
patchbot still happy!



---

archive/issue_events_204681.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-05-29T22:01:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22970#event-204681"
}
```



---

archive/issue_events_204682.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-05-29T22:01:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22970#event-204682"
}
```



---

archive/issue_comments_345749.json:
```json
{
    "body": "**Changing branch** from \"[u/vdelecroix/22970](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/22970)\" to \"[cb0dae187cbbf8e8b594a64ef5c87553459b7f71](https://github.com/sagemath/sagetrac-mirror/commit/cb0dae187cbbf8e8b594a64ef5c87553459b7f71)\".",
    "created_at": "2017-05-31T22:25:35Z",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22970#issuecomment-345749",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/vdelecroix/22970](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/22970)" to "[cb0dae187cbbf8e8b594a64ef5c87553459b7f71](https://github.com/sagemath/sagetrac-mirror/commit/cb0dae187cbbf8e8b594a64ef5c87553459b7f71)".



---

archive/issue_events_204683.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-05-31T22:25:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22970#event-204683"
}
```



---

archive/issue_events_204684.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "0db4adab5c7348fffd19d06d2910ec18f468de84",
    "created_at": "2017-05-31T22:25:35Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/22970",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22970#event-204684"
}
```
