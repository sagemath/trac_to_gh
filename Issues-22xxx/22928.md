# Issue 22928: Conversion between gmpy2 and sage objects

archive/issues_022691.json:
```json
{
    "assignees": [
        "https://github.com/vinklein"
    ],
    "body": "The library `gmpy2` supports conversions by the use of special methods. In order to allow conversion of Sage objects into gmpy2 objects, we implement the following methods\n- `__mpz__` on Sage Integer\n- `__mpq__` on Sage Rational\n- `__mpfr__` on relevant Sage real numbers\n   - `RealNumber` (`sage.rings.real_mpfr`)\n   - `RealDoubleElement` (`sage.rings.real_double`)\n- `__mpc__` on relevant Sage complex numbers\n   - `ComplexDoubleElement` (`sage.rings.complex_double`)\n   - `MPComplexNumber` (`sage.rings.complex_mpc`)\n   - `ComplexNumber` (`sage.rings.complex_number`)\n\nConversly, we make Sage integer, rational, real and complex constructors accept gmpy2 arguments.\n\nUpstream issues:\n- https://github.com/aleaxit/gmpy/pull/180\n- https://github.com/aleaxit/gmpy/pull/181\n\nDepends on #24549\n\nCC:  @videlec\n\nKeywords: **thursdaysbdx**\n\nBranch: **[`e9a6fda`](https://github.com/sagemath/sagetrac-mirror/commit/e9a6fdaf5e130e826929c4d9a6617a2128afe3d0)**\n\nReviewer: **Jeroen Demeyer, Vincent Delecroix**\n\nAuthor: **Vincent Klein**\n\nComponent: **interfaces**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/22928_\n\n",
    "closed_at": "2018-02-02T12:06:15Z",
    "created_at": "2017-05-02T09:03:14Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20interfaces",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Conversion between gmpy2 and sage objects",
    "type": "issue",
    "updated_at": "2018-05-01T09:36:24Z",
    "url": "https://github.com/sagemath/sage/issues/22928",
    "user": "https://github.com/vinklein"
}
```
The library `gmpy2` supports conversions by the use of special methods. In order to allow conversion of Sage objects into gmpy2 objects, we implement the following methods
- `__mpz__` on Sage Integer
- `__mpq__` on Sage Rational
- `__mpfr__` on relevant Sage real numbers
   - `RealNumber` (`sage.rings.real_mpfr`)
   - `RealDoubleElement` (`sage.rings.real_double`)
- `__mpc__` on relevant Sage complex numbers
   - `ComplexDoubleElement` (`sage.rings.complex_double`)
   - `MPComplexNumber` (`sage.rings.complex_mpc`)
   - `ComplexNumber` (`sage.rings.complex_number`)

Conversly, we make Sage integer, rational, real and complex constructors accept gmpy2 arguments.

Upstream issues:
- https://github.com/aleaxit/gmpy/pull/180
- https://github.com/aleaxit/gmpy/pull/181

Depends on #24549

CC:  @videlec

Keywords: **thursdaysbdx**

Branch: **[`e9a6fda`](https://github.com/sagemath/sagetrac-mirror/commit/e9a6fdaf5e130e826929c4d9a6617a2128afe3d0)**

Reviewer: **Jeroen Demeyer, Vincent Delecroix**

Author: **Vincent Klein**

Component: **interfaces**

_Issue created by migration from https://trac.sagemath.org/ticket/22928_





---

archive/issue_events_316946.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2017-05-02T09:03:14Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "milestone_number": null,
    "milestone_title": "sage-8.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22928#event-316946"
}
```



---

archive/issue_events_316947.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2017-05-02T09:03:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20optional",
    "label_color": "0000b0",
    "label_name": "c: packages: optional",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22928#event-316947"
}
```



---

archive/issue_events_316948.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2017-05-02T09:03:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22928#event-316948"
}
```



---

archive/issue_events_316949.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2017-05-02T09:03:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22928#event-316949"
}
```



---

archive/issue_comments_342164.json:
```json
{
    "body": "Dependencies: **#22927**",
    "created_at": "2017-05-02T09:03:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342164",
    "user": "https://github.com/vinklein"
}
```

Dependencies: **#22927**



---

archive/issue_events_316950.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2017-05-02T15:05:37Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "subject": "https://github.com/vinklein",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22928#event-316950"
}
```



---

archive/issue_comments_342165.json:
```json
{
    "body": "Changed keywords from none to **jsb++**",
    "created_at": "2017-05-11T15:26:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342165",
    "user": "https://github.com/videlec"
}
```

Changed keywords from none to **jsb++**



---

archive/issue_comments_342166.json:
```json
{
    "body": "Changed keywords from **jsb++** to **thursdaysbdx**",
    "created_at": "2017-05-11T15:28:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342166",
    "user": "https://github.com/videlec"
}
```

Changed keywords from **jsb++** to **thursdaysbdx**



---

archive/issue_comments_342167.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,5 +1,5 @@\n Conversion between gmpy2 and sage integers:\n - Implement method `__mpz__` on sage integer: return an gmpy2 mpz \n - Implement method `__mpq__` on sage rational: return an gmpy2 mpq\n-- Implement constructor for sage integer and rational with respectively mpz and mpq parameters.\n+- Add conversion functions from gmpy2's mpz and mpq to sage integer and rational.\n - Provide coercion.\n``````\n",
    "created_at": "2017-05-11T16:16:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342167",
    "user": "https://github.com/vinklein"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,5 +1,5 @@
 Conversion between gmpy2 and sage integers:
 - Implement method `__mpz__` on sage integer: return an gmpy2 mpz 
 - Implement method `__mpq__` on sage rational: return an gmpy2 mpq
-- Implement constructor for sage integer and rational with respectively mpz and mpq parameters.
+- Add conversion functions from gmpy2's mpz and mpq to sage integer and rational.
 - Provide coercion.
``````




---

archive/issue_comments_342168.json:
```json
{
    "body": "Branch: **[u/vklein/conversion_between_gmpy2_and_sage_integers](https://github.com/sagemath/sagetrac-mirror/tree/u/vklein/conversion_between_gmpy2_and_sage_integers)**",
    "created_at": "2017-05-15T17:15:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342168",
    "user": "https://github.com/vinklein"
}
```

Branch: **[u/vklein/conversion_between_gmpy2_and_sage_integers](https://github.com/sagemath/sagetrac-mirror/tree/u/vklein/conversion_between_gmpy2_and_sage_integers)**



---

archive/issue_comments_342169.json:
```json
{
    "body": "<div id=\"comment:7\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/48daf5857197f66b880a563ce27c34cf21959c87\"><code>48daf58</code></a></td><td><code>Add path of gmpy2 in include_dirs</code></td></tr></table>\n",
    "created_at": "2017-05-16T14:06:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342169",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:7"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/48daf5857197f66b880a563ce27c34cf21959c87"><code>48daf58</code></a></td><td><code>Add path of gmpy2 in include_dirs</code></td></tr></table>




---

archive/issue_comments_342170.json:
```json
{
    "body": "Commit: **[`48daf58`](https://github.com/sagemath/sagetrac-mirror/commit/48daf5857197f66b880a563ce27c34cf21959c87)**",
    "created_at": "2017-05-16T14:06:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342170",
    "user": "https://github.com/sagetrac-git"
}
```

Commit: **[`48daf58`](https://github.com/sagemath/sagetrac-mirror/commit/48daf5857197f66b880a563ce27c34cf21959c87)**



---

archive/issue_comments_342171.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nLooks good. Some small remarks.\n\n1) For the error about missing `gmpy2` you can use `PackageNotFoundError` from `sage.misc.package`\n\n2) `add __mpz__() to class Rational` should be `add __mpq__() to class Rational`\n\n3) You have an indentation problem here\n\n``` \nCoercion for gmpy2 numbers    \n    sage: from gmpy2 import * # optional - gmpy2\n    sage: a, b = cm.canonical_coercion(mpz(5), 10) # optional - gmpy2\n    sage: a, b # optional - gmpy2\n```\nIt should be\n\n```\nCoercion for gmpy2 numbers::\n\n    sage: from gmpy2 import * # optional - gmpy2\n    sage: a, b = cm.canonical_coercion(mpz(5), 10) # optional - gmpy2\n    sage: a, b # optional - gmpy2\n```\n\n4) There should be tests for `a + b`, `a * b`, `a / b` when one of `a` or `b` is from Sage and the other from `gmpy2`\n\n5) Couldn't you share\n\n```\n#Handle gmpy2 objects\nelif is_gmpy2_type(type(x)):\n    return self.canonical_coercion(py_scalar_to_element(x), y)\nelif is_gmpy2_type(type(y)):\n    return self.canonical_coercion(x, py_scalar_to_element(y))\n```\n  with the associated code that deals with numpy types?",
    "created_at": "2017-05-17T17:22:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342171",
    "user": "https://github.com/videlec"
}
```

<div id="comment:8" align="right">comment:8</div>

Looks good. Some small remarks.

1) For the error about missing `gmpy2` you can use `PackageNotFoundError` from `sage.misc.package`

2) `add __mpz__() to class Rational` should be `add __mpq__() to class Rational`

3) You have an indentation problem here

``` 
Coercion for gmpy2 numbers    
    sage: from gmpy2 import * # optional - gmpy2
    sage: a, b = cm.canonical_coercion(mpz(5), 10) # optional - gmpy2
    sage: a, b # optional - gmpy2
```
It should be

```
Coercion for gmpy2 numbers::

    sage: from gmpy2 import * # optional - gmpy2
    sage: a, b = cm.canonical_coercion(mpz(5), 10) # optional - gmpy2
    sage: a, b # optional - gmpy2
```

4) There should be tests for `a + b`, `a * b`, `a / b` when one of `a` or `b` is from Sage and the other from `gmpy2`

5) Couldn't you share

```
#Handle gmpy2 objects
elif is_gmpy2_type(type(x)):
    return self.canonical_coercion(py_scalar_to_element(x), y)
elif is_gmpy2_type(type(y)):
    return self.canonical_coercion(x, py_scalar_to_element(y))
```
  with the associated code that deals with numpy types?



---

archive/issue_comments_342172.json:
```json
{
    "body": "Changed commit from **[`48daf58`](https://github.com/sagemath/sagetrac-mirror/commit/48daf5857197f66b880a563ce27c34cf21959c87)** to **[`54c04ae`](https://github.com/sagemath/sagetrac-mirror/commit/54c04ae7c0bf7d48ca89c1e21c4184133e4c6a9c)**",
    "created_at": "2017-05-18T11:33:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342172",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`48daf58`](https://github.com/sagemath/sagetrac-mirror/commit/48daf5857197f66b880a563ce27c34cf21959c87)** to **[`54c04ae`](https://github.com/sagemath/sagetrac-mirror/commit/54c04ae7c0bf7d48ca89c1e21c4184133e4c6a9c)**



---

archive/issue_comments_342173.json:
```json
{
    "body": "<div id=\"comment:9\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/54c04ae7c0bf7d48ca89c1e21c4184133e4c6a9c\"><code>54c04ae</code></a></td><td><code>Minor improvements</code></td></tr></table>\n",
    "created_at": "2017-05-18T11:33:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342173",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:9"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/54c04ae7c0bf7d48ca89c1e21c4184133e4c6a9c"><code>54c04ae</code></a></td><td><code>Minor improvements</code></td></tr></table>




---

archive/issue_comments_342174.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nReplying to [@videlec](#comment:8):\nDone with commit [54c04ae](https://github.com/sagemath/sagetrac-mirror/commit/54c04ae7c0bf7d48ca89c1e21c4184133e4c6a9c)",
    "created_at": "2017-05-18T13:27:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342174",
    "user": "https://github.com/vinklein"
}
```

<div id="comment:10" align="right">comment:10</div>

Replying to [@videlec](#comment:8):
Done with commit [54c04ae](https://github.com/sagemath/sagetrac-mirror/commit/54c04ae7c0bf7d48ca89c1e21c4184133e4c6a9c)



---

archive/issue_comments_342175.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -3,3 +3,12 @@\n - Implement method `__mpq__` on sage rational: return an gmpy2 mpq\n - Add conversion functions from gmpy2's mpz and mpq to sage integer and rational.\n - Provide coercion.\n+\n+Once gmpy2 is a standard package with the following features :\n+- direct constructors GMPy_MPZ_From_mpz, GMPy_MPQ_From_mpq, GMPy_MPQ_From_mpz\n+- a gmpy2.pxd file with relevant declarations (to be installed at the same place as gmpy2.h)\n+- #136 robust header detection (ie what should the user do in her setup.py to find out where gmpy2.h/gmpy2.pxd are?)\n+see : [#134](https://github.com/aleaxit/gmpy/pull/134), [https://github.com/aleaxit/gmpy/issues/136136](https://github.com/aleaxit/gmpy/issues/136136).\n+\n+Then remove sage.libs.gmpy2 extension and replace conversion functions gmpy2_mpz_to_sage and gmpy2_mpq_to_sage by having sage integer and rational constructors working with gmpy2 number  \n+\n``````\n",
    "created_at": "2017-05-18T13:52:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342175",
    "user": "https://github.com/vinklein"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -3,3 +3,12 @@
 - Implement method `__mpq__` on sage rational: return an gmpy2 mpq
 - Add conversion functions from gmpy2's mpz and mpq to sage integer and rational.
 - Provide coercion.
+
+Once gmpy2 is a standard package with the following features :
+- direct constructors GMPy_MPZ_From_mpz, GMPy_MPQ_From_mpq, GMPy_MPQ_From_mpz
+- a gmpy2.pxd file with relevant declarations (to be installed at the same place as gmpy2.h)
+- #136 robust header detection (ie what should the user do in her setup.py to find out where gmpy2.h/gmpy2.pxd are?)
+see : [#134](https://github.com/aleaxit/gmpy/pull/134), [https://github.com/aleaxit/gmpy/issues/136136](https://github.com/aleaxit/gmpy/issues/136136).
+
+Then remove sage.libs.gmpy2 extension and replace conversion functions gmpy2_mpz_to_sage and gmpy2_mpq_to_sage by having sage integer and rational constructors working with gmpy2 number  
+
``````




---

archive/issue_comments_342176.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -8,7 +8,7 @@\n - direct constructors GMPy_MPZ_From_mpz, GMPy_MPQ_From_mpq, GMPy_MPQ_From_mpz\n - a gmpy2.pxd file with relevant declarations (to be installed at the same place as gmpy2.h)\n - #136 robust header detection (ie what should the user do in her setup.py to find out where gmpy2.h/gmpy2.pxd are?)\n-see : [#134](https://github.com/aleaxit/gmpy/pull/134), [https://github.com/aleaxit/gmpy/issues/136136](https://github.com/aleaxit/gmpy/issues/136136).\n+see : [#134](https://github.com/aleaxit/gmpy/pull/134), [136](https://github.com/aleaxit/gmpy/issues/136).\n \n Then remove sage.libs.gmpy2 extension and replace conversion functions gmpy2_mpz_to_sage and gmpy2_mpq_to_sage by having sage integer and rational constructors working with gmpy2 number  \n \n``````\n",
    "created_at": "2017-05-18T13:53:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342176",
    "user": "https://github.com/vinklein"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -8,7 +8,7 @@
 - direct constructors GMPy_MPZ_From_mpz, GMPy_MPQ_From_mpq, GMPy_MPQ_From_mpz
 - a gmpy2.pxd file with relevant declarations (to be installed at the same place as gmpy2.h)
 - #136 robust header detection (ie what should the user do in her setup.py to find out where gmpy2.h/gmpy2.pxd are?)
-see : [#134](https://github.com/aleaxit/gmpy/pull/134), [https://github.com/aleaxit/gmpy/issues/136136](https://github.com/aleaxit/gmpy/issues/136136).
+see : [#134](https://github.com/aleaxit/gmpy/pull/134), [136](https://github.com/aleaxit/gmpy/issues/136).
 
 Then remove sage.libs.gmpy2 extension and replace conversion functions gmpy2_mpz_to_sage and gmpy2_mpq_to_sage by having sage integer and rational constructors working with gmpy2 number  
 
``````




---

archive/issue_comments_342177.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -8,7 +8,7 @@\n - direct constructors GMPy_MPZ_From_mpz, GMPy_MPQ_From_mpq, GMPy_MPQ_From_mpz\n - a gmpy2.pxd file with relevant declarations (to be installed at the same place as gmpy2.h)\n - #136 robust header detection (ie what should the user do in her setup.py to find out where gmpy2.h/gmpy2.pxd are?)\n-see : [#134](https://github.com/aleaxit/gmpy/pull/134), [136](https://github.com/aleaxit/gmpy/issues/136).\n+see : [#134](https://github.com/aleaxit/gmpy/pull/134), [#136](https://github.com/aleaxit/gmpy/issues/136).\n \n Then remove sage.libs.gmpy2 extension and replace conversion functions gmpy2_mpz_to_sage and gmpy2_mpq_to_sage by having sage integer and rational constructors working with gmpy2 number  \n \n``````\n",
    "created_at": "2017-05-18T13:57:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342177",
    "user": "https://github.com/vinklein"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -8,7 +8,7 @@
 - direct constructors GMPy_MPZ_From_mpz, GMPy_MPQ_From_mpq, GMPy_MPQ_From_mpz
 - a gmpy2.pxd file with relevant declarations (to be installed at the same place as gmpy2.h)
 - #136 robust header detection (ie what should the user do in her setup.py to find out where gmpy2.h/gmpy2.pxd are?)
-see : [#134](https://github.com/aleaxit/gmpy/pull/134), [136](https://github.com/aleaxit/gmpy/issues/136).
+see : [#134](https://github.com/aleaxit/gmpy/pull/134), [#136](https://github.com/aleaxit/gmpy/issues/136).
 
 Then remove sage.libs.gmpy2 extension and replace conversion functions gmpy2_mpz_to_sage and gmpy2_mpq_to_sage by having sage integer and rational constructors working with gmpy2 number  
 
``````




---

archive/issue_comments_342178.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,9 +6,9 @@\n \n Once gmpy2 is a standard package with the following features :\n - direct constructors GMPy_MPZ_From_mpz, GMPy_MPQ_From_mpq, GMPy_MPQ_From_mpz\n-- a gmpy2.pxd file with relevant declarations (to be installed at the same place as gmpy2.h)\n+- #137 a gmpy2.pxd file with relevant declarations (to be installed at the same place as gmpy2.h)\n - #136 robust header detection (ie what should the user do in her setup.py to find out where gmpy2.h/gmpy2.pxd are?)\n-see : [#134](https://github.com/aleaxit/gmpy/pull/134), [#136](https://github.com/aleaxit/gmpy/issues/136).\n+see : [#134](https://github.com/aleaxit/gmpy/pull/134), [#136](https://github.com/aleaxit/gmpy/issues/136), [#137](https://github.com/aleaxit/gmpy/pull/137).\n \n Then remove sage.libs.gmpy2 extension and replace conversion functions gmpy2_mpz_to_sage and gmpy2_mpq_to_sage by having sage integer and rational constructors working with gmpy2 number  \n \n``````\n",
    "created_at": "2017-05-18T14:18:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342178",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,9 +6,9 @@
 
 Once gmpy2 is a standard package with the following features :
 - direct constructors GMPy_MPZ_From_mpz, GMPy_MPQ_From_mpq, GMPy_MPQ_From_mpz
-- a gmpy2.pxd file with relevant declarations (to be installed at the same place as gmpy2.h)
+- #137 a gmpy2.pxd file with relevant declarations (to be installed at the same place as gmpy2.h)
 - #136 robust header detection (ie what should the user do in her setup.py to find out where gmpy2.h/gmpy2.pxd are?)
-see : [#134](https://github.com/aleaxit/gmpy/pull/134), [#136](https://github.com/aleaxit/gmpy/issues/136).
+see : [#134](https://github.com/aleaxit/gmpy/pull/134), [#136](https://github.com/aleaxit/gmpy/issues/136), [#137](https://github.com/aleaxit/gmpy/pull/137).
 
 Then remove sage.libs.gmpy2 extension and replace conversion functions gmpy2_mpz_to_sage and gmpy2_mpq_to_sage by having sage integer and rational constructors working with gmpy2 number  
 
``````




---

archive/issue_comments_342179.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,8 +6,8 @@\n \n Once gmpy2 is a standard package with the following features :\n - direct constructors GMPy_MPZ_From_mpz, GMPy_MPQ_From_mpq, GMPy_MPQ_From_mpz\n-- #137 a gmpy2.pxd file with relevant declarations (to be installed at the same place as gmpy2.h)\n-- #136 robust header detection (ie what should the user do in her setup.py to find out where gmpy2.h/gmpy2.pxd are?)\n+- [#137](https://github.com/aleaxit/gmpy/pull/137) a gmpy2.pxd file with relevant declarations (to be installed at the same place as gmpy2.h)\n+- [#136](https://github.com/aleaxit/gmpy/issues/136) robust header detection (ie what should the user do in her setup.py to find out where gmpy2.h/gmpy2.pxd are?)\n see : [#134](https://github.com/aleaxit/gmpy/pull/134), [#136](https://github.com/aleaxit/gmpy/issues/136), [#137](https://github.com/aleaxit/gmpy/pull/137).\n \n Then remove sage.libs.gmpy2 extension and replace conversion functions gmpy2_mpz_to_sage and gmpy2_mpq_to_sage by having sage integer and rational constructors working with gmpy2 number  \n``````\n",
    "created_at": "2017-05-18T15:50:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342179",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,8 +6,8 @@
 
 Once gmpy2 is a standard package with the following features :
 - direct constructors GMPy_MPZ_From_mpz, GMPy_MPQ_From_mpq, GMPy_MPQ_From_mpz
-- #137 a gmpy2.pxd file with relevant declarations (to be installed at the same place as gmpy2.h)
-- #136 robust header detection (ie what should the user do in her setup.py to find out where gmpy2.h/gmpy2.pxd are?)
+- [#137](https://github.com/aleaxit/gmpy/pull/137) a gmpy2.pxd file with relevant declarations (to be installed at the same place as gmpy2.h)
+- [#136](https://github.com/aleaxit/gmpy/issues/136) robust header detection (ie what should the user do in her setup.py to find out where gmpy2.h/gmpy2.pxd are?)
 see : [#134](https://github.com/aleaxit/gmpy/pull/134), [#136](https://github.com/aleaxit/gmpy/issues/136), [#137](https://github.com/aleaxit/gmpy/pull/137).
 
 Then remove sage.libs.gmpy2 extension and replace conversion functions gmpy2_mpz_to_sage and gmpy2_mpq_to_sage by having sage integer and rational constructors working with gmpy2 number  
``````




---

archive/issue_comments_342180.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -5,10 +5,10 @@\n - Provide coercion.\n \n Once gmpy2 is a standard package with the following features :\n-- direct constructors GMPy_MPZ_From_mpz, GMPy_MPQ_From_mpq, GMPy_MPQ_From_mpz\n+- [#137](https://github.com/aleaxit/gmpy/pull/137) direct constructors GMPy_MPZ_From_mpz, GMPy_MPQ_From_mpq, GMPy_MPQ_From_mpz\n - [#137](https://github.com/aleaxit/gmpy/pull/137) a gmpy2.pxd file with relevant declarations (to be installed at the same place as gmpy2.h)\n - [#136](https://github.com/aleaxit/gmpy/issues/136) robust header detection (ie what should the user do in her setup.py to find out where gmpy2.h/gmpy2.pxd are?)\n-see : [#134](https://github.com/aleaxit/gmpy/pull/134), [#136](https://github.com/aleaxit/gmpy/issues/136), [#137](https://github.com/aleaxit/gmpy/pull/137).\n+see also: [#134](https://github.com/aleaxit/gmpy/pull/134)\n \n Then remove sage.libs.gmpy2 extension and replace conversion functions gmpy2_mpz_to_sage and gmpy2_mpq_to_sage by having sage integer and rational constructors working with gmpy2 number  \n \n``````\n",
    "created_at": "2017-05-18T15:51:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342180",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -5,10 +5,10 @@
 - Provide coercion.
 
 Once gmpy2 is a standard package with the following features :
-- direct constructors GMPy_MPZ_From_mpz, GMPy_MPQ_From_mpq, GMPy_MPQ_From_mpz
+- [#137](https://github.com/aleaxit/gmpy/pull/137) direct constructors GMPy_MPZ_From_mpz, GMPy_MPQ_From_mpq, GMPy_MPQ_From_mpz
 - [#137](https://github.com/aleaxit/gmpy/pull/137) a gmpy2.pxd file with relevant declarations (to be installed at the same place as gmpy2.h)
 - [#136](https://github.com/aleaxit/gmpy/issues/136) robust header detection (ie what should the user do in her setup.py to find out where gmpy2.h/gmpy2.pxd are?)
-see : [#134](https://github.com/aleaxit/gmpy/pull/134), [#136](https://github.com/aleaxit/gmpy/issues/136), [#137](https://github.com/aleaxit/gmpy/pull/137).
+see also: [#134](https://github.com/aleaxit/gmpy/pull/134)
 
 Then remove sage.libs.gmpy2 extension and replace conversion functions gmpy2_mpz_to_sage and gmpy2_mpq_to_sage by having sage integer and rational constructors working with gmpy2 number  
 
``````




---

archive/issue_comments_342181.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nWith [PR #137 from gmpy2](https://github.com/aleaxit/gmpy/pull/137)\n\n- you can get rid of the function `get_gmpy2_path()` and most of the declarations in `sage/libs/gmpy2.pxd`.\n\n- you can add tests for conversions using the methods `__mpz__` and `__mpq__`\n\n```\nsage: import gmpy2\nsage: gmpy2.mpz(23)\n```\n  and\n\n```\nsage: import gmpy2\nsage: gmpy2.mpq(12/14)    \n```",
    "created_at": "2017-05-18T15:59:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342181",
    "user": "https://github.com/videlec"
}
```

<div id="comment:17" align="right">comment:17</div>

With [PR #137 from gmpy2](https://github.com/aleaxit/gmpy/pull/137)

- you can get rid of the function `get_gmpy2_path()` and most of the declarations in `sage/libs/gmpy2.pxd`.

- you can add tests for conversions using the methods `__mpz__` and `__mpq__`

```
sage: import gmpy2
sage: gmpy2.mpz(23)
```
  and

```
sage: import gmpy2
sage: gmpy2.mpq(12/14)    
```



---

archive/issue_comments_342182.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nIs the coercion really needed? I mean, we cannot add coercion in Sage for every single external package. Is it really important that we can add a Sage polynomial to a gmpy2 integer for example?",
    "created_at": "2017-05-18T16:00:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342182",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:18" align="right">comment:18</div>

Is the coercion really needed? I mean, we cannot add coercion in Sage for every single external package. Is it really important that we can add a Sage polynomial to a gmpy2 integer for example?



---

archive/issue_comments_342183.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nReplying to [@jdemeyer](#comment:18):\n> Is the coercion really needed? I mean, we cannot add coercion in Sage for every single external package. Is it really important that we can add a Sage polynomial to a gmpy2 integer for example?\n\nNot sure. Why do we provide coercion for `numpy`? It is convenient to have `Integer('2') + gmpy2.mpz('3')` working.",
    "created_at": "2017-05-18T16:07:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342183",
    "user": "https://github.com/videlec"
}
```

<div id="comment:19" align="right">comment:19</div>

Replying to [@jdemeyer](#comment:18):
> Is the coercion really needed? I mean, we cannot add coercion in Sage for every single external package. Is it really important that we can add a Sage polynomial to a gmpy2 integer for example?

Not sure. Why do we provide coercion for `numpy`? It is convenient to have `Integer('2') + gmpy2.mpz('3')` working.



---

archive/issue_comments_342184.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nReplying to [@videlec](#comment:19):\n> It is convenient to have `Integer('2') + gmpy2.mpz('3')` working.\n\nEven if you agree with this, one needs to wonder whether the result should be a Sage integer or a gmpy2 integer (that's why I mentioned polynomials in [comment:18])",
    "created_at": "2017-05-18T17:23:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342184",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:20" align="right">comment:20</div>

Replying to [@videlec](#comment:19):
> It is convenient to have `Integer('2') + gmpy2.mpz('3')` working.

Even if you agree with this, one needs to wonder whether the result should be a Sage integer or a gmpy2 integer (that's why I mentioned polynomials in [comment:18])



---

archive/issue_comments_342185.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nThe coercion aspect has been moved into another ticket #23052.",
    "created_at": "2017-05-22T10:21:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342185",
    "user": "https://github.com/vinklein"
}
```

<div id="comment:21" align="right">comment:21</div>

The coercion aspect has been moved into another ticket #23052.



---

archive/issue_comments_342186.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,8 +1,8 @@\n Conversion between gmpy2 and sage integers:\n - Implement method `__mpz__` on sage integer: return an gmpy2 mpz \n - Implement method `__mpq__` on sage rational: return an gmpy2 mpq\n-- Add conversion functions from gmpy2's mpz and mpq to sage integer and rational.\n-- Provide coercion.\n+-  Sage integer and rational constructors should work with gmpy2's mpz and mpq parameters.\n+\n \n Once gmpy2 is a standard package with the following features :\n - [#137](https://github.com/aleaxit/gmpy/pull/137) direct constructors GMPy_MPZ_From_mpz, GMPy_MPQ_From_mpq, GMPy_MPQ_From_mpz\n``````\n",
    "created_at": "2017-05-22T10:21:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342186",
    "user": "https://github.com/vinklein"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,8 +1,8 @@
 Conversion between gmpy2 and sage integers:
 - Implement method `__mpz__` on sage integer: return an gmpy2 mpz 
 - Implement method `__mpq__` on sage rational: return an gmpy2 mpq
-- Add conversion functions from gmpy2's mpz and mpq to sage integer and rational.
-- Provide coercion.
+-  Sage integer and rational constructors should work with gmpy2's mpz and mpq parameters.
+
 
 Once gmpy2 is a standard package with the following features :
 - [#137](https://github.com/aleaxit/gmpy/pull/137) direct constructors GMPy_MPZ_From_mpz, GMPy_MPQ_From_mpq, GMPy_MPQ_From_mpz
``````




---

archive/issue_comments_342187.json:
```json
{
    "body": "<div id=\"comment:22\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/87578d9b02c6f2b88b0cd55d1d27a574316439e7\"><code>87578d9</code></a></td><td><code>Add path of gmpy2 in include_dirs</code></td></tr></table>\n",
    "created_at": "2017-05-22T12:43:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342187",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:22"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/87578d9b02c6f2b88b0cd55d1d27a574316439e7"><code>87578d9</code></a></td><td><code>Add path of gmpy2 in include_dirs</code></td></tr></table>




---

archive/issue_comments_342188.json:
```json
{
    "body": "Changed commit from **[`54c04ae`](https://github.com/sagemath/sagetrac-mirror/commit/54c04ae7c0bf7d48ca89c1e21c4184133e4c6a9c)** to **[`87578d9`](https://github.com/sagemath/sagetrac-mirror/commit/87578d9b02c6f2b88b0cd55d1d27a574316439e7)**",
    "created_at": "2017-05-22T12:43:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342188",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`54c04ae`](https://github.com/sagemath/sagetrac-mirror/commit/54c04ae7c0bf7d48ca89c1e21c4184133e4c6a9c)** to **[`87578d9`](https://github.com/sagemath/sagetrac-mirror/commit/87578d9b02c6f2b88b0cd55d1d27a574316439e7)**



---

archive/issue_comments_342189.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nDidn't we patch Cython in #22728 precisely to avoid needed to mess with include paths?",
    "created_at": "2017-05-22T16:03:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342189",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:23" align="right">comment:23</div>

Didn't we patch Cython in #22728 precisely to avoid needed to mess with include paths?



---

archive/issue_comments_342190.json:
```json
{
    "body": "<div id=\"comment:24\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8cbbe31d808f8eeaa7f1ca970b415863ce63a7e6\"><code>8cbbe31</code></a></td><td><code>update checksum and package version</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ea8aeabc90ff7479e805ca5aa6657bd5c7cf2597\"><code>ea8aeab</code></a></td><td><code>Integer and rational constructors support gmpy2 params</code></td></tr></table>\n",
    "created_at": "2017-05-22T23:37:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342190",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:24"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8cbbe31d808f8eeaa7f1ca970b415863ce63a7e6"><code>8cbbe31</code></a></td><td><code>update checksum and package version</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ea8aeabc90ff7479e805ca5aa6657bd5c7cf2597"><code>ea8aeab</code></a></td><td><code>Integer and rational constructors support gmpy2 params</code></td></tr></table>




---

archive/issue_comments_342191.json:
```json
{
    "body": "Changed commit from **[`87578d9`](https://github.com/sagemath/sagetrac-mirror/commit/87578d9b02c6f2b88b0cd55d1d27a574316439e7)** to **[`ea8aeab`](https://github.com/sagemath/sagetrac-mirror/commit/ea8aeabc90ff7479e805ca5aa6657bd5c7cf2597)**",
    "created_at": "2017-05-22T23:37:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342191",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`87578d9`](https://github.com/sagemath/sagetrac-mirror/commit/87578d9b02c6f2b88b0cd55d1d27a574316439e7)** to **[`ea8aeab`](https://github.com/sagemath/sagetrac-mirror/commit/ea8aeabc90ff7479e805ca5aa6657bd5c7cf2597)**



---

archive/issue_comments_342192.json:
```json
{
    "body": "Changed commit from **[`ea8aeab`](https://github.com/sagemath/sagetrac-mirror/commit/ea8aeabc90ff7479e805ca5aa6657bd5c7cf2597)** to **[`c28a1ee`](https://github.com/sagemath/sagetrac-mirror/commit/c28a1eee830fa3937e58f3657814f7c0aaa187dc)**",
    "created_at": "2017-05-22T23:40:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342192",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`ea8aeab`](https://github.com/sagemath/sagetrac-mirror/commit/ea8aeabc90ff7479e805ca5aa6657bd5c7cf2597)** to **[`c28a1ee`](https://github.com/sagemath/sagetrac-mirror/commit/c28a1eee830fa3937e58f3657814f7c0aaa187dc)**



---

archive/issue_comments_342193.json:
```json
{
    "body": "<div id=\"comment:25\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c28a1eee830fa3937e58f3657814f7c0aaa187dc\"><code>c28a1ee</code></a></td><td><code>remove OptionalExtension sage.libs.gmpy2</code></td></tr></table>\n",
    "created_at": "2017-05-22T23:40:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342193",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:25"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c28a1eee830fa3937e58f3657814f7c0aaa187dc"><code>c28a1ee</code></a></td><td><code>remove OptionalExtension sage.libs.gmpy2</code></td></tr></table>




---

archive/issue_events_316951.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-05-23T06:48:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20optional",
    "label_color": "0000b0",
    "label_name": "c: packages: optional",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22928#event-316951"
}
```



---

archive/issue_events_316952.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-05-23T06:48:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
    "label_color": "0000b0",
    "label_name": "c: packages: standard",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22928#event-316952"
}
```



---

archive/issue_comments_342194.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\n- Is there a need of `get_gmpy2_path`?\n- I think we should avoid the import `gmpy2` completely and that `is_gmpy2_type` can be much faster. I made [issue #139](https://github.com/aleaxit/gmpy/issues/139)\n- Also test\n\n```\nsage: Integer(mpz(3))\nsage: Rational(mpq(2, 3))\nsage: Rational(mpz(5))\n```",
    "created_at": "2017-05-23T07:03:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342194",
    "user": "https://github.com/videlec"
}
```

<div id="comment:27" align="right">comment:27</div>

- Is there a need of `get_gmpy2_path`?
- I think we should avoid the import `gmpy2` completely and that `is_gmpy2_type` can be much faster. I made [issue #139](https://github.com/aleaxit/gmpy/issues/139)
- Also test

```
sage: Integer(mpz(3))
sage: Rational(mpq(2, 3))
sage: Rational(mpz(5))
```



---

archive/issue_comments_342195.json:
```json
{
    "body": "Changed commit from **[`c28a1ee`](https://github.com/sagemath/sagetrac-mirror/commit/c28a1eee830fa3937e58f3657814f7c0aaa187dc)** to **[`7edcfe4`](https://github.com/sagemath/sagetrac-mirror/commit/7edcfe46cb8d4abdb922f98d39604475a1350c78)**",
    "created_at": "2017-05-23T14:25:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342195",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`c28a1ee`](https://github.com/sagemath/sagetrac-mirror/commit/c28a1eee830fa3937e58f3657814f7c0aaa187dc)** to **[`7edcfe4`](https://github.com/sagemath/sagetrac-mirror/commit/7edcfe46cb8d4abdb922f98d39604475a1350c78)**



---

archive/issue_comments_342196.json:
```json
{
    "body": "<div id=\"comment:28\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/db380861ff50d4396e402712ecb7d303eab085bb\"><code>db38086</code></a></td><td><code>remove get_gmpy2_path()</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7edcfe46cb8d4abdb922f98d39604475a1350c78\"><code>7edcfe4</code></a></td><td><code>Add few doctests</code></td></tr></table>\n",
    "created_at": "2017-05-23T14:25:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342196",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:28"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/db380861ff50d4396e402712ecb7d303eab085bb"><code>db38086</code></a></td><td><code>remove get_gmpy2_path()</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7edcfe46cb8d4abdb922f98d39604475a1350c78"><code>7edcfe4</code></a></td><td><code>Add few doctests</code></td></tr></table>




---

archive/issue_comments_342197.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -12,3 +12,4 @@\n \n Then remove sage.libs.gmpy2 extension and replace conversion functions gmpy2_mpz_to_sage and gmpy2_mpq_to_sage by having sage integer and rational constructors working with gmpy2 number  \n \n+Make gmpy2 an standard package (open a thread on sage-devel)\n``````\n",
    "created_at": "2017-05-23T15:41:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342197",
    "user": "https://github.com/vinklein"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -12,3 +12,4 @@
 
 Then remove sage.libs.gmpy2 extension and replace conversion functions gmpy2_mpz_to_sage and gmpy2_mpq_to_sage by having sage integer and rational constructors working with gmpy2 number  
 
+Make gmpy2 an standard package (open a thread on sage-devel)
``````




---

archive/issue_comments_342198.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -12,4 +12,4 @@\n \n Then remove sage.libs.gmpy2 extension and replace conversion functions gmpy2_mpz_to_sage and gmpy2_mpq_to_sage by having sage integer and rational constructors working with gmpy2 number  \n \n-Make gmpy2 an standard package (open a thread on sage-devel)\n+Make gmpy2 a standard package (open a thread on sage-devel)\n``````\n",
    "created_at": "2017-05-23T15:41:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342198",
    "user": "https://github.com/vinklein"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -12,4 +12,4 @@
 
 Then remove sage.libs.gmpy2 extension and replace conversion functions gmpy2_mpz_to_sage and gmpy2_mpq_to_sage by having sage integer and rational constructors working with gmpy2 number  
 
-Make gmpy2 an standard package (open a thread on sage-devel)
+Make gmpy2 a standard package (open a thread on sage-devel)
``````




---

archive/issue_comments_342199.json:
```json
{
    "body": "Changed commit from **[`7edcfe4`](https://github.com/sagemath/sagetrac-mirror/commit/7edcfe46cb8d4abdb922f98d39604475a1350c78)** to **[`6bf31ba`](https://github.com/sagemath/sagetrac-mirror/commit/6bf31bab5e23764516042ad45047ef633886e01d)**",
    "created_at": "2017-05-24T15:08:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342199",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`7edcfe4`](https://github.com/sagemath/sagetrac-mirror/commit/7edcfe46cb8d4abdb922f98d39604475a1350c78)** to **[`6bf31ba`](https://github.com/sagemath/sagetrac-mirror/commit/6bf31bab5e23764516042ad45047ef633886e01d)**



---

archive/issue_comments_342200.json:
```json
{
    "body": "<div id=\"comment:31\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6bf31bab5e23764516042ad45047ef633886e01d\"><code>6bf31ba</code></a></td><td><code>Use of MPZ_Check and MPQ_Check functions from gmpy2 C-API</code></td></tr></table>\n",
    "created_at": "2017-05-24T15:08:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342200",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:31"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6bf31bab5e23764516042ad45047ef633886e01d"><code>6bf31ba</code></a></td><td><code>Use of MPZ_Check and MPQ_Check functions from gmpy2 C-API</code></td></tr></table>




---

archive/issue_comments_342201.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nIn case a `mpz` is used to construct a `Rational` I would modify \n\n```\nself.__set_value(integer.Integer(x), base)\n```\nto\n\n```\nmpq_set_z(self.value, MPZ(<MPZ_Object *> x))\n```",
    "created_at": "2017-05-24T15:59:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342201",
    "user": "https://github.com/videlec"
}
```

<div id="comment:32" align="right">comment:32</div>

In case a `mpz` is used to construct a `Rational` I would modify 

```
self.__set_value(integer.Integer(x), base)
```
to

```
mpq_set_z(self.value, MPZ(<MPZ_Object *> x))
```



---

archive/issue_comments_342202.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nIt may be faster but you lose a standard processing for all integer types.\nFor example if \n\n```\nelif isinstance(x, integer.Integer):\n            set_from_Integer(self, x)\n``` \nevolve in some way you must copy the modification for the MPZ_Object case.",
    "created_at": "2017-05-24T16:15:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342202",
    "user": "https://github.com/vinklein"
}
```

<div id="comment:33" align="right">comment:33</div>

It may be faster but you lose a standard processing for all integer types.
For example if 

```
elif isinstance(x, integer.Integer):
            set_from_Integer(self, x)
``` 
evolve in some way you must copy the modification for the MPZ_Object case.



---

archive/issue_comments_342203.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nReplying to [@vinklein](#comment:33):\n> It may be faster but you lose a standard processing for all integer types.\n> For example if \n> \n> ```\n> elif isinstance(x, integer.Integer):\n>             set_from_Integer(self, x)\n> ``` \n> evolve in some way you must copy the modification for the MPZ_Object case. \n\nIt is not only faster, it is much easier to read.\n\nThe concerned code is the following\n\n```\nelif MPQ_Check(<PyObject *> x):\n    mpq_set(self.value, MPQ(<MPQ_Object *> x))\nelif MPZ_Check(<PyObject *> x):\n    self.__set_value(integer.Integer(x), base)\n```\nI don't see the logic in converting `x` to a Sage Integer and then calling `__set_value` instead of using the straightforward `mpq_set_z(...)`.\n\nBTW, I don't understand your comment. What should be an evolution of `set_from_Integer`? An integer is a rational with denominator 1. This will not change in any near future.",
    "created_at": "2017-06-01T19:54:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342203",
    "user": "https://github.com/videlec"
}
```

<div id="comment:34" align="right">comment:34</div>

Replying to [@vinklein](#comment:33):
> It may be faster but you lose a standard processing for all integer types.
> For example if 
> 
> ```
> elif isinstance(x, integer.Integer):
>             set_from_Integer(self, x)
> ``` 
> evolve in some way you must copy the modification for the MPZ_Object case. 

It is not only faster, it is much easier to read.

The concerned code is the following

```
elif MPQ_Check(<PyObject *> x):
    mpq_set(self.value, MPQ(<MPQ_Object *> x))
elif MPZ_Check(<PyObject *> x):
    self.__set_value(integer.Integer(x), base)
```
I don't see the logic in converting `x` to a Sage Integer and then calling `__set_value` instead of using the straightforward `mpq_set_z(...)`.

BTW, I don't understand your comment. What should be an evolution of `set_from_Integer`? An integer is a rational with denominator 1. This will not change in any near future.



---

archive/issue_comments_342204.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nReplying to [@videlec](#comment:34):\n> ...\n> It is not only faster, it is much easier to read.\n> \n\nNot sure if there is a clear difference in readability between the two options, \nby the way there are many recursive call in this function.\n\nAnother reason for the present choice was to be consistent with numpy.integer processing.\nWhen modifying an existing code i tend to stick to the preceding coding style,\n(And having a standard processing for all int type is an understandable design choice).\nOn the other hand in numpy.integer case doing a recursive call seems to be most concise way to do it, \nwich as you demonstrated is not the case for gmpy2 mpz.\n\nThat being said i got your point and prefer your solution.",
    "created_at": "2017-06-01T21:43:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342204",
    "user": "https://github.com/vinklein"
}
```

<div id="comment:35" align="right">comment:35</div>

Replying to [@videlec](#comment:34):
> ...
> It is not only faster, it is much easier to read.
> 

Not sure if there is a clear difference in readability between the two options, 
by the way there are many recursive call in this function.

Another reason for the present choice was to be consistent with numpy.integer processing.
When modifying an existing code i tend to stick to the preceding coding style,
(And having a standard processing for all int type is an understandable design choice).
On the other hand in numpy.integer case doing a recursive call seems to be most concise way to do it, 
wich as you demonstrated is not the case for gmpy2 mpz.

That being said i got your point and prefer your solution.



---

archive/issue_comments_342205.json:
```json
{
    "body": "Changed commit from **[`6bf31ba`](https://github.com/sagemath/sagetrac-mirror/commit/6bf31bab5e23764516042ad45047ef633886e01d)** to **[`53b8d50`](https://github.com/sagemath/sagetrac-mirror/commit/53b8d500d1cfa1d837cb02f3779be15f106e4cb2)**",
    "created_at": "2017-06-07T16:25:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342205",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`6bf31ba`](https://github.com/sagemath/sagetrac-mirror/commit/6bf31bab5e23764516042ad45047ef633886e01d)** to **[`53b8d50`](https://github.com/sagemath/sagetrac-mirror/commit/53b8d500d1cfa1d837cb02f3779be15f106e4cb2)**



---

archive/issue_comments_342206.json:
```json
{
    "body": "<div id=\"comment:36\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/53b8d500d1cfa1d837cb02f3779be15f106e4cb2\"><code>53b8d50</code></a></td><td><code>Change way of creating a Rational from a mpz</code></td></tr></table>\n",
    "created_at": "2017-06-07T16:25:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342206",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:36"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/53b8d500d1cfa1d837cb02f3779be15f106e4cb2"><code>53b8d50</code></a></td><td><code>Change way of creating a Rational from a mpz</code></td></tr></table>




---

archive/issue_comments_342207.json:
```json
{
    "body": "<div id=\"comment:37\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8bbf2d3a475a9252833c2d8734d1c640a634b945\"><code>8bbf2d3</code></a></td><td><code>update checksum, snapshot version update in setup.py</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/08c7a721506fc1c9edf01bd5c3a8670561c21bd8\"><code>08c7a72</code></a></td><td><code>Add path of gmpy2 in include_dirs</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/359a0ff12022c96af72c10c83453dec516d63cda\"><code>359a0ff</code></a></td><td><code>update checksum and package version</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0d4fd2ea3e932f6434845d876f4650732b818e70\"><code>0d4fd2e</code></a></td><td><code>Integer and rational constructors support gmpy2 params</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7c66a7c71b07e754d16f174d9cd035b38cc35001\"><code>7c66a7c</code></a></td><td><code>remove OptionalExtension sage.libs.gmpy2</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d143dde32f1caa21b4d5c408dec6b9d2a930218a\"><code>d143dde</code></a></td><td><code>remove get_gmpy2_path()</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2c56a3f456a48680e31e44f78e93169fecc1dc96\"><code>2c56a3f</code></a></td><td><code>Add few doctests</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e5264fda96de5f512c6390ba331efe15bb9c240d\"><code>e5264fd</code></a></td><td><code>Use of MPZ_Check and MPQ_Check functions from gmpy2 C-API</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/504ab68789745112d5695646edb247225378455c\"><code>504ab68</code></a></td><td><code>Change way of creating a Rational from a mpz</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/072a15c0456d864dfacc21c068f7cc6b98432a9c\"><code>072a15c</code></a></td><td><code>add __mpz__() to Rational</code></td></tr></table>\n",
    "created_at": "2017-06-15T12:18:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342207",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:37"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8bbf2d3a475a9252833c2d8734d1c640a634b945"><code>8bbf2d3</code></a></td><td><code>update checksum, snapshot version update in setup.py</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/08c7a721506fc1c9edf01bd5c3a8670561c21bd8"><code>08c7a72</code></a></td><td><code>Add path of gmpy2 in include_dirs</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/359a0ff12022c96af72c10c83453dec516d63cda"><code>359a0ff</code></a></td><td><code>update checksum and package version</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0d4fd2ea3e932f6434845d876f4650732b818e70"><code>0d4fd2e</code></a></td><td><code>Integer and rational constructors support gmpy2 params</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7c66a7c71b07e754d16f174d9cd035b38cc35001"><code>7c66a7c</code></a></td><td><code>remove OptionalExtension sage.libs.gmpy2</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d143dde32f1caa21b4d5c408dec6b9d2a930218a"><code>d143dde</code></a></td><td><code>remove get_gmpy2_path()</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2c56a3f456a48680e31e44f78e93169fecc1dc96"><code>2c56a3f</code></a></td><td><code>Add few doctests</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e5264fda96de5f512c6390ba331efe15bb9c240d"><code>e5264fd</code></a></td><td><code>Use of MPZ_Check and MPQ_Check functions from gmpy2 C-API</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/504ab68789745112d5695646edb247225378455c"><code>504ab68</code></a></td><td><code>Change way of creating a Rational from a mpz</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/072a15c0456d864dfacc21c068f7cc6b98432a9c"><code>072a15c</code></a></td><td><code>add __mpz__() to Rational</code></td></tr></table>




---

archive/issue_comments_342208.json:
```json
{
    "body": "Changed commit from **[`53b8d50`](https://github.com/sagemath/sagetrac-mirror/commit/53b8d500d1cfa1d837cb02f3779be15f106e4cb2)** to **[`072a15c`](https://github.com/sagemath/sagetrac-mirror/commit/072a15c0456d864dfacc21c068f7cc6b98432a9c)**",
    "created_at": "2017-06-15T12:18:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342208",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`53b8d50`](https://github.com/sagemath/sagetrac-mirror/commit/53b8d500d1cfa1d837cb02f3779be15f106e4cb2)** to **[`072a15c`](https://github.com/sagemath/sagetrac-mirror/commit/072a15c0456d864dfacc21c068f7cc6b98432a9c)**



---

archive/issue_comments_342209.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nI thought that we agreed on [comment:32](#comment:32)...",
    "created_at": "2017-06-15T14:04:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342209",
    "user": "https://github.com/videlec"
}
```

<div id="comment:38" align="right">comment:38</div>

I thought that we agreed on [comment:32](#comment:32)...



---

archive/issue_comments_342210.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nA merge error",
    "created_at": "2017-06-15T14:06:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342210",
    "user": "https://github.com/vinklein"
}
```

<div id="comment:39" align="right">comment:39</div>

A merge error



---

archive/issue_comments_342211.json:
```json
{
    "body": "<div id=\"comment:40\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1e404b0b9ef9e2fc2cb6ed4c9b9ec0f44512465c\"><code>1e404b0</code></a></td><td><code>trac 29928 Change way of creating a Rational from a mpz</code></td></tr></table>\n",
    "created_at": "2017-06-15T14:32:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342211",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:40"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1e404b0b9ef9e2fc2cb6ed4c9b9ec0f44512465c"><code>1e404b0</code></a></td><td><code>trac 29928 Change way of creating a Rational from a mpz</code></td></tr></table>




---

archive/issue_comments_342212.json:
```json
{
    "body": "Changed commit from **[`072a15c`](https://github.com/sagemath/sagetrac-mirror/commit/072a15c0456d864dfacc21c068f7cc6b98432a9c)** to **[`1e404b0`](https://github.com/sagemath/sagetrac-mirror/commit/1e404b0b9ef9e2fc2cb6ed4c9b9ec0f44512465c)**",
    "created_at": "2017-06-15T14:32:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342212",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`072a15c`](https://github.com/sagemath/sagetrac-mirror/commit/072a15c0456d864dfacc21c068f7cc6b98432a9c)** to **[`1e404b0`](https://github.com/sagemath/sagetrac-mirror/commit/1e404b0b9ef9e2fc2cb6ed4c9b9ec0f44512465c)**



---

archive/issue_events_316953.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-06-22T11:19:01Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "title_is": "Conversion between gmpy2 and sage objects",
    "title_was": "Conversion between gmpy2 and sage integers",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22928#event-316953"
}
```



---

archive/issue_comments_342213.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,15 +1,15 @@\n-Conversion between gmpy2 and sage integers:\n-- Implement method `__mpz__` on sage integer: return an gmpy2 mpz \n-- Implement method `__mpq__` on sage rational: return an gmpy2 mpq\n--  Sage integer and rational constructors should work with gmpy2's mpz and mpq parameters.\n+The library `gmpy2` support conversions by the use of special methods. In order to allow conversion of Sage objects into gmpy2 objects, we implement the following\n+- a method `__mpz__` on Sage Integer\n+- a method `__mpq__` on Sage Rational\n+- a method `__mpfr__` on relevant Sage real numbers\n+   - `RealNumber` (`sage.rings.real_mpfr`)\n+   - `RealDoubleElement` (`sage.rings.real_double`)\n+- a method `__mpc__` on relevant Sage complex numbers\n+   - `ComplexDoubleElement` (`sage.rings.complex_double`)\n+   - `MPComplexNumber` (`sage.rings.complex_mpc`)\n+   - `ComplexNumber` (`sage.rings.complex_number`)\n+\n+Conversly, we make Sage integer, rational, real and complex constructors accept gmpy2 arguments.\n \n \n-Once gmpy2 is a standard package with the following features :\n-- [#137](https://github.com/aleaxit/gmpy/pull/137) direct constructors GMPy_MPZ_From_mpz, GMPy_MPQ_From_mpq, GMPy_MPQ_From_mpz\n-- [#137](https://github.com/aleaxit/gmpy/pull/137) a gmpy2.pxd file with relevant declarations (to be installed at the same place as gmpy2.h)\n-- [#136](https://github.com/aleaxit/gmpy/issues/136) robust header detection (ie what should the user do in her setup.py to find out where gmpy2.h/gmpy2.pxd are?)\n-see also: [#134](https://github.com/aleaxit/gmpy/pull/134)\n-\n-Then remove sage.libs.gmpy2 extension and replace conversion functions gmpy2_mpz_to_sage and gmpy2_mpq_to_sage by having sage integer and rational constructors working with gmpy2 number  \n-\n-Make gmpy2 a standard package (open a thread on sage-devel)\n+**All these features need `gmpy2` being a standard package.**\n``````\n",
    "created_at": "2017-06-22T11:19:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342213",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,15 +1,15 @@
-Conversion between gmpy2 and sage integers:
-- Implement method `__mpz__` on sage integer: return an gmpy2 mpz 
-- Implement method `__mpq__` on sage rational: return an gmpy2 mpq
--  Sage integer and rational constructors should work with gmpy2's mpz and mpq parameters.
+The library `gmpy2` support conversions by the use of special methods. In order to allow conversion of Sage objects into gmpy2 objects, we implement the following
+- a method `__mpz__` on Sage Integer
+- a method `__mpq__` on Sage Rational
+- a method `__mpfr__` on relevant Sage real numbers
+   - `RealNumber` (`sage.rings.real_mpfr`)
+   - `RealDoubleElement` (`sage.rings.real_double`)
+- a method `__mpc__` on relevant Sage complex numbers
+   - `ComplexDoubleElement` (`sage.rings.complex_double`)
+   - `MPComplexNumber` (`sage.rings.complex_mpc`)
+   - `ComplexNumber` (`sage.rings.complex_number`)
+
+Conversly, we make Sage integer, rational, real and complex constructors accept gmpy2 arguments.
 
 
-Once gmpy2 is a standard package with the following features :
-- [#137](https://github.com/aleaxit/gmpy/pull/137) direct constructors GMPy_MPZ_From_mpz, GMPy_MPQ_From_mpq, GMPy_MPQ_From_mpz
-- [#137](https://github.com/aleaxit/gmpy/pull/137) a gmpy2.pxd file with relevant declarations (to be installed at the same place as gmpy2.h)
-- [#136](https://github.com/aleaxit/gmpy/issues/136) robust header detection (ie what should the user do in her setup.py to find out where gmpy2.h/gmpy2.pxd are?)
-see also: [#134](https://github.com/aleaxit/gmpy/pull/134)
-
-Then remove sage.libs.gmpy2 extension and replace conversion functions gmpy2_mpz_to_sage and gmpy2_mpq_to_sage by having sage integer and rational constructors working with gmpy2 number  
-
-Make gmpy2 a standard package (open a thread on sage-devel)
+**All these features need `gmpy2` being a standard package.**
``````




---

archive/issue_comments_342214.json:
```json
{
    "body": "Changed commit from **[`1e404b0`](https://github.com/sagemath/sagetrac-mirror/commit/1e404b0b9ef9e2fc2cb6ed4c9b9ec0f44512465c)** to **[`09288c7`](https://github.com/sagemath/sagetrac-mirror/commit/09288c73a47d1ce44b5f9e27aab620b75b71c977)**",
    "created_at": "2017-06-22T12:26:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342214",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`1e404b0`](https://github.com/sagemath/sagetrac-mirror/commit/1e404b0b9ef9e2fc2cb6ed4c9b9ec0f44512465c)** to **[`09288c7`](https://github.com/sagemath/sagetrac-mirror/commit/09288c73a47d1ce44b5f9e27aab620b75b71c977)**



---

archive/issue_comments_342215.json:
```json
{
    "body": "<div id=\"comment:42\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/09288c73a47d1ce44b5f9e27aab620b75b71c977\"><code>09288c7</code></a></td><td><code>trac 22928 update gmpy2 snapshot version</code></td></tr></table>\n",
    "created_at": "2017-06-22T12:26:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342215",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:42"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/09288c73a47d1ce44b5f9e27aab620b75b71c977"><code>09288c7</code></a></td><td><code>trac 22928 update gmpy2 snapshot version</code></td></tr></table>




---

archive/issue_events_316954.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-06-22T16:51:19Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
    "label_color": "0000b0",
    "label_name": "c: packages: standard",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22928#event-316954"
}
```



---

archive/issue_events_316955.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-06-22T16:51:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20interfaces",
    "label_color": "0000ff",
    "label_name": "c: interfaces",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22928#event-316955"
}
```



---

archive/issue_comments_342216.json:
```json
{
    "body": "Changed dependencies from **#22927** to **#22927, #23309**",
    "created_at": "2017-06-22T16:53:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342216",
    "user": "https://github.com/videlec"
}
```

Changed dependencies from **#22927** to **#22927, #23309**



---

archive/issue_comments_342217.json:
```json
{
    "body": "<div id=\"comment:45\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3e5ded62f948b276cc5068c46ff9ec14f4e82b6c\"><code>3e5ded6</code></a></td><td><code>Add few doctests</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/758d7fd3bd4e164325f5fd5b1640dfa280e1b4ee\"><code>758d7fd</code></a></td><td><code>Use of MPZ_Check and MPQ_Check functions from gmpy2 C-API</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d96f7bb50cf157bff2915b0a2917c0ee841b19de\"><code>d96f7bb</code></a></td><td><code>Change way of creating a Rational from a mpz</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0b8c45edfc63d51624b33cdde181690e6650cc62\"><code>0b8c45e</code></a></td><td><code>add __mpz__() to Rational</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8f90a093d680773e34d19d05aa46ebb4808bdcc0\"><code>8f90a09</code></a></td><td><code>trac 29928 Change way of creating a Rational from a mpz</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6263747ede66ebcc873b24c7d3490e37ac507fe7\"><code>6263747</code></a></td><td><code>trac 22928 update gmpy2 snapshot version</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5b8b77b9ec03821aa6fd5e359f0ba2c0afc20e20\"><code>5b8b77b</code></a></td><td><code>trac 22928 RealNumber and RealDoubleElement and gmpy2</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6e548519a99282c8eeab996dfd5627fa7ea0c965\"><code>6e54851</code></a></td><td><code>trac 22928 add `__mpfr__` to RealNumber class</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7b75526a0442145cde2636787d7cdd66d91a4949\"><code>7b75526</code></a></td><td><code>trac 22928 merge trac 22927</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3e4c6f6267c3e405d6cd4612b616c7d7d14ff63d\"><code>3e4c6f6</code></a></td><td><code>trac 22928 add `__mpfr__` to RealDoubleElement class</code></td></tr></table>\n",
    "created_at": "2017-06-23T12:03:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342217",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:45"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3e5ded62f948b276cc5068c46ff9ec14f4e82b6c"><code>3e5ded6</code></a></td><td><code>Add few doctests</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/758d7fd3bd4e164325f5fd5b1640dfa280e1b4ee"><code>758d7fd</code></a></td><td><code>Use of MPZ_Check and MPQ_Check functions from gmpy2 C-API</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d96f7bb50cf157bff2915b0a2917c0ee841b19de"><code>d96f7bb</code></a></td><td><code>Change way of creating a Rational from a mpz</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0b8c45edfc63d51624b33cdde181690e6650cc62"><code>0b8c45e</code></a></td><td><code>add __mpz__() to Rational</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8f90a093d680773e34d19d05aa46ebb4808bdcc0"><code>8f90a09</code></a></td><td><code>trac 29928 Change way of creating a Rational from a mpz</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6263747ede66ebcc873b24c7d3490e37ac507fe7"><code>6263747</code></a></td><td><code>trac 22928 update gmpy2 snapshot version</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5b8b77b9ec03821aa6fd5e359f0ba2c0afc20e20"><code>5b8b77b</code></a></td><td><code>trac 22928 RealNumber and RealDoubleElement and gmpy2</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6e548519a99282c8eeab996dfd5627fa7ea0c965"><code>6e54851</code></a></td><td><code>trac 22928 add `__mpfr__` to RealNumber class</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7b75526a0442145cde2636787d7cdd66d91a4949"><code>7b75526</code></a></td><td><code>trac 22928 merge trac 22927</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3e4c6f6267c3e405d6cd4612b616c7d7d14ff63d"><code>3e4c6f6</code></a></td><td><code>trac 22928 add `__mpfr__` to RealDoubleElement class</code></td></tr></table>




---

archive/issue_comments_342218.json:
```json
{
    "body": "Changed commit from **[`09288c7`](https://github.com/sagemath/sagetrac-mirror/commit/09288c73a47d1ce44b5f9e27aab620b75b71c977)** to **[`3e4c6f6`](https://github.com/sagemath/sagetrac-mirror/commit/3e4c6f6267c3e405d6cd4612b616c7d7d14ff63d)**",
    "created_at": "2017-06-23T12:03:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342218",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`09288c7`](https://github.com/sagemath/sagetrac-mirror/commit/09288c73a47d1ce44b5f9e27aab620b75b71c977)** to **[`3e4c6f6`](https://github.com/sagemath/sagetrac-mirror/commit/3e4c6f6267c3e405d6cd4612b616c7d7d14ff63d)**



---

archive/issue_comments_342219.json:
```json
{
    "body": "Changed commit from **[`3e4c6f6`](https://github.com/sagemath/sagetrac-mirror/commit/3e4c6f6267c3e405d6cd4612b616c7d7d14ff63d)** to **[`043250a`](https://github.com/sagemath/sagetrac-mirror/commit/043250a6637cb989e53d0852d841367423dc3436)**",
    "created_at": "2017-06-23T13:08:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342219",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`3e4c6f6`](https://github.com/sagemath/sagetrac-mirror/commit/3e4c6f6267c3e405d6cd4612b616c7d7d14ff63d)** to **[`043250a`](https://github.com/sagemath/sagetrac-mirror/commit/043250a6637cb989e53d0852d841367423dc3436)**



---

archive/issue_comments_342220.json:
```json
{
    "body": "<div id=\"comment:46\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/601935b30c79a4050c22715585189757122d9823\"><code>601935b</code></a></td><td><code>Add few doctests</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6868a33e23476ab26d3dc7ae19127be934402f7c\"><code>6868a33</code></a></td><td><code>Use of MPZ_Check and MPQ_Check functions from gmpy2 C-API</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c91ada4c588fd775c8b420f5c4ad555ae00d1194\"><code>c91ada4</code></a></td><td><code>Change way of creating a Rational from a mpz</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2d68635f71204ed1c4b582111e628ef63c36ae21\"><code>2d68635</code></a></td><td><code>add __mpz__() to Rational</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/48d4ce2f07aa4380387d0949c26f2f7f82a2761d\"><code>48d4ce2</code></a></td><td><code>trac 29928 Change way of creating a Rational from a mpz</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dffb83e00bd2fc6cbf90ed408f52c6a8128d14c9\"><code>dffb83e</code></a></td><td><code>trac 22928 update gmpy2 snapshot version</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2fa80f573522eb0a9332e4f9ed8089efbbf577a8\"><code>2fa80f5</code></a></td><td><code>trac 22928 RealNumber and RealDoubleElement and gmpy2</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/32b4b866951688bbf3fb7107ba7da0d491af0175\"><code>32b4b86</code></a></td><td><code>trac 22928 add `__mpfr__` to RealNumber class</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/25533077d50b1a23052dd4075c436a64663299c1\"><code>2553307</code></a></td><td><code>trac 22928 merge trac 22927</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/043250a6637cb989e53d0852d841367423dc3436\"><code>043250a</code></a></td><td><code>trac 22928 add `__mpfr__` to RealDoubleElement class</code></td></tr></table>\n",
    "created_at": "2017-06-23T13:08:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342220",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:46"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/601935b30c79a4050c22715585189757122d9823"><code>601935b</code></a></td><td><code>Add few doctests</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6868a33e23476ab26d3dc7ae19127be934402f7c"><code>6868a33</code></a></td><td><code>Use of MPZ_Check and MPQ_Check functions from gmpy2 C-API</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c91ada4c588fd775c8b420f5c4ad555ae00d1194"><code>c91ada4</code></a></td><td><code>Change way of creating a Rational from a mpz</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2d68635f71204ed1c4b582111e628ef63c36ae21"><code>2d68635</code></a></td><td><code>add __mpz__() to Rational</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/48d4ce2f07aa4380387d0949c26f2f7f82a2761d"><code>48d4ce2</code></a></td><td><code>trac 29928 Change way of creating a Rational from a mpz</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dffb83e00bd2fc6cbf90ed408f52c6a8128d14c9"><code>dffb83e</code></a></td><td><code>trac 22928 update gmpy2 snapshot version</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2fa80f573522eb0a9332e4f9ed8089efbbf577a8"><code>2fa80f5</code></a></td><td><code>trac 22928 RealNumber and RealDoubleElement and gmpy2</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/32b4b866951688bbf3fb7107ba7da0d491af0175"><code>32b4b86</code></a></td><td><code>trac 22928 add `__mpfr__` to RealNumber class</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/25533077d50b1a23052dd4075c436a64663299c1"><code>2553307</code></a></td><td><code>trac 22928 merge trac 22927</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/043250a6637cb989e53d0852d841367423dc3436"><code>043250a</code></a></td><td><code>trac 22928 add `__mpfr__` to RealDoubleElement class</code></td></tr></table>




---

archive/issue_comments_342221.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">comment:47</div>\n\nrebase on 8.0.beta12",
    "created_at": "2017-06-23T13:10:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342221",
    "user": "https://github.com/vinklein"
}
```

<div id="comment:47" align="right">comment:47</div>

rebase on 8.0.beta12



---

archive/issue_comments_342222.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">comment:48</div>\n\nWith `RealNumber` you should check if precision is kept. Like with this number\n\n```\nsage: R = RealField(256)\nsage: R.pi()\n3.141592653589793238462643383279502884197169399375105820974944592307816406286\n```\nIs there a way to check the precision of a real number with gmpy2?",
    "created_at": "2017-06-23T13:11:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342222",
    "user": "https://github.com/videlec"
}
```

<div id="comment:48" align="right">comment:48</div>

With `RealNumber` you should check if precision is kept. Like with this number

```
sage: R = RealField(256)
sage: R.pi()
3.141592653589793238462643383279502884197169399375105820974944592307816406286
```
Is there a way to check the precision of a real number with gmpy2?



---

archive/issue_comments_342223.json:
```json
{
    "body": "<div id=\"comment:49\" align=\"right\">comment:49</div>\n\nYes you can do it with the mpfr's precision attribute.\n\n```\n\nsage: from gmpy2 import mpfr\nsage: R = RealField(256)\nsage: r = mpfr(R.pi())\nsage: r.precision\n256\n\n```\nI will add this as a doctest",
    "created_at": "2017-06-23T13:49:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342223",
    "user": "https://github.com/vinklein"
}
```

<div id="comment:49" align="right">comment:49</div>

Yes you can do it with the mpfr's precision attribute.

```

sage: from gmpy2 import mpfr
sage: R = RealField(256)
sage: r = mpfr(R.pi())
sage: r.precision
256

```
I will add this as a doctest



---

archive/issue_comments_342224.json:
```json
{
    "body": "<div id=\"comment:50\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3af335aa159ce276538f9d8347baa3a45d1af2bb\"><code>3af335a</code></a></td><td><code>trac 22928 add test for mpfr</code></td></tr></table>\n",
    "created_at": "2017-06-23T13:55:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342224",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:50"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3af335aa159ce276538f9d8347baa3a45d1af2bb"><code>3af335a</code></a></td><td><code>trac 22928 add test for mpfr</code></td></tr></table>




---

archive/issue_comments_342225.json:
```json
{
    "body": "Changed commit from **[`043250a`](https://github.com/sagemath/sagetrac-mirror/commit/043250a6637cb989e53d0852d841367423dc3436)** to **[`3af335a`](https://github.com/sagemath/sagetrac-mirror/commit/3af335aa159ce276538f9d8347baa3a45d1af2bb)**",
    "created_at": "2017-06-23T13:55:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342225",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`043250a`](https://github.com/sagemath/sagetrac-mirror/commit/043250a6637cb989e53d0852d841367423dc3436)** to **[`3af335a`](https://github.com/sagemath/sagetrac-mirror/commit/3af335aa159ce276538f9d8347baa3a45d1af2bb)**



---

archive/issue_comments_342226.json:
```json
{
    "body": "Changed commit from **[`3af335a`](https://github.com/sagemath/sagetrac-mirror/commit/3af335aa159ce276538f9d8347baa3a45d1af2bb)** to **[`f5a3799`](https://github.com/sagemath/sagetrac-mirror/commit/f5a37994b02d98e73cfad3322348b1aaa57c40de)**",
    "created_at": "2017-11-13T14:22:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342226",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`3af335a`](https://github.com/sagemath/sagetrac-mirror/commit/3af335aa159ce276538f9d8347baa3a45d1af2bb)** to **[`f5a3799`](https://github.com/sagemath/sagetrac-mirror/commit/f5a37994b02d98e73cfad3322348b1aaa57c40de)**



---

archive/issue_comments_342227.json:
```json
{
    "body": "<div id=\"comment:51\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f821d9e13aab9cc1f111b80fab60954ebad66e70\"><code>f821d9e</code></a></td><td><code>Use of MPZ_Check and MPQ_Check functions from gmpy2 C-API</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/24988eede2471afbcbc9e34e5a4a6386100474c0\"><code>24988ee</code></a></td><td><code>Change way of creating a Rational from a mpz</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f0e21145851e66f1198b6a8df52ce663c1ba5925\"><code>f0e2114</code></a></td><td><code>add __mpz__() to Rational</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2299a7901b8f80ebfb3c77763abb9f2f31382d42\"><code>2299a79</code></a></td><td><code>trac 29928 Change way of creating a Rational from a mpz</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d38e2dc10cbbf59adf30223fbae01c9c4486d026\"><code>d38e2dc</code></a></td><td><code>trac 22928 update gmpy2 snapshot version</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2183a91aa720c05c7d20b157c47bfbe406863bee\"><code>2183a91</code></a></td><td><code>trac 22928 RealNumber and RealDoubleElement and gmpy2</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c607d49f16f87a3911d9f285e5beeb8255b27010\"><code>c607d49</code></a></td><td><code>trac 22928 add `__mpfr__` to RealNumber class</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e3c99f1ae026c9603b8a9ce1366428e591f2161b\"><code>e3c99f1</code></a></td><td><code>trac 22928 merge trac 22927</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9b5df1b672fb9b7f765bbc467c8fc6409536868c\"><code>9b5df1b</code></a></td><td><code>trac 22928 add `__mpfr__` to RealDoubleElement class</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f5a37994b02d98e73cfad3322348b1aaa57c40de\"><code>f5a3799</code></a></td><td><code>trac 22928 add test for mpfr</code></td></tr></table>\n",
    "created_at": "2017-11-13T14:22:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342227",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:51"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f821d9e13aab9cc1f111b80fab60954ebad66e70"><code>f821d9e</code></a></td><td><code>Use of MPZ_Check and MPQ_Check functions from gmpy2 C-API</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/24988eede2471afbcbc9e34e5a4a6386100474c0"><code>24988ee</code></a></td><td><code>Change way of creating a Rational from a mpz</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f0e21145851e66f1198b6a8df52ce663c1ba5925"><code>f0e2114</code></a></td><td><code>add __mpz__() to Rational</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2299a7901b8f80ebfb3c77763abb9f2f31382d42"><code>2299a79</code></a></td><td><code>trac 29928 Change way of creating a Rational from a mpz</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d38e2dc10cbbf59adf30223fbae01c9c4486d026"><code>d38e2dc</code></a></td><td><code>trac 22928 update gmpy2 snapshot version</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2183a91aa720c05c7d20b157c47bfbe406863bee"><code>2183a91</code></a></td><td><code>trac 22928 RealNumber and RealDoubleElement and gmpy2</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c607d49f16f87a3911d9f285e5beeb8255b27010"><code>c607d49</code></a></td><td><code>trac 22928 add `__mpfr__` to RealNumber class</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e3c99f1ae026c9603b8a9ce1366428e591f2161b"><code>e3c99f1</code></a></td><td><code>trac 22928 merge trac 22927</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9b5df1b672fb9b7f765bbc467c8fc6409536868c"><code>9b5df1b</code></a></td><td><code>trac 22928 add `__mpfr__` to RealDoubleElement class</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f5a37994b02d98e73cfad3322348b1aaa57c40de"><code>f5a3799</code></a></td><td><code>trac 22928 add test for mpfr</code></td></tr></table>




---

archive/issue_comments_342228.json:
```json
{
    "body": "Replying to [ticket:22928 vklein]:\n> **All these features need `gmpy2` being a standard package.**\n\nI don't think that this is completely true. I understand why you think so, but it shouldn't be too hard to implement this as an optional interface.",
    "created_at": "2017-11-13T14:40:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342228",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [ticket:22928 vklein]:
> **All these features need `gmpy2` being a standard package.**

I don't think that this is completely true. I understand why you think so, but it shouldn't be too hard to implement this as an optional interface.



---

archive/issue_comments_342229.json:
```json
{
    "body": "<div id=\"comment:53\" align=\"right\">comment:53</div>\n\nAt the begining i ve tried to make it optional. I don't rememeber exactly why i have come to the conclusion that  it can't be optional.\nI will take a second look at it.",
    "created_at": "2017-11-13T15:02:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342229",
    "user": "https://github.com/vinklein"
}
```

<div id="comment:53" align="right">comment:53</div>

At the begining i ve tried to make it optional. I don't rememeber exactly why i have come to the conclusion that  it can't be optional.
I will take a second look at it.



---

archive/issue_comments_342230.json:
```json
{
    "body": "<div id=\"comment:54\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ba3bc1126aecdc5cf65f989f7a31b62bb31fcd72\"><code>ba3bc11</code></a></td><td><code>Use of MPZ_Check and MPQ_Check functions from gmpy2 C-API</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6a7f661aab6c79faca91d3c9422e1ce42e8acc6d\"><code>6a7f661</code></a></td><td><code>Change way of creating a Rational from a mpz</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e98845c0e63d21c00d49951486af2212b1eb858e\"><code>e98845c</code></a></td><td><code>add __mpz__() to Rational</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6161e79ab5141c83e456c7cc12bd2daedc700846\"><code>6161e79</code></a></td><td><code>trac 29928 Change way of creating a Rational from a mpz</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/aac3bf42ecebda4c23f9b539f1743e57ecebed32\"><code>aac3bf4</code></a></td><td><code>trac 22928 update gmpy2 snapshot version</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4a9e3b93f5e05e0d027c2306385195c3a84b32b2\"><code>4a9e3b9</code></a></td><td><code>trac 22928 RealNumber and RealDoubleElement and gmpy2</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4c2553050fb67fe0f088ad4fbe4d8b58ccb4dbd0\"><code>4c25530</code></a></td><td><code>trac 22928 add `__mpfr__` to RealNumber class</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1129eca628654f420c7ed0fce15962d2eea2818f\"><code>1129eca</code></a></td><td><code>trac 22928 merge trac 22927</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0ddcc8515822c3ed872c1c586741faad44703b36\"><code>0ddcc85</code></a></td><td><code>trac 22928 add `__mpfr__` to RealDoubleElement class</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/99b77348d7189300b0fa1e1d04cdb9cbcb4b0765\"><code>99b7734</code></a></td><td><code>trac 22928 add test for mpfr</code></td></tr></table>\n",
    "created_at": "2017-11-14T09:11:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342230",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:54"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ba3bc1126aecdc5cf65f989f7a31b62bb31fcd72"><code>ba3bc11</code></a></td><td><code>Use of MPZ_Check and MPQ_Check functions from gmpy2 C-API</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6a7f661aab6c79faca91d3c9422e1ce42e8acc6d"><code>6a7f661</code></a></td><td><code>Change way of creating a Rational from a mpz</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e98845c0e63d21c00d49951486af2212b1eb858e"><code>e98845c</code></a></td><td><code>add __mpz__() to Rational</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6161e79ab5141c83e456c7cc12bd2daedc700846"><code>6161e79</code></a></td><td><code>trac 29928 Change way of creating a Rational from a mpz</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/aac3bf42ecebda4c23f9b539f1743e57ecebed32"><code>aac3bf4</code></a></td><td><code>trac 22928 update gmpy2 snapshot version</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4a9e3b93f5e05e0d027c2306385195c3a84b32b2"><code>4a9e3b9</code></a></td><td><code>trac 22928 RealNumber and RealDoubleElement and gmpy2</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4c2553050fb67fe0f088ad4fbe4d8b58ccb4dbd0"><code>4c25530</code></a></td><td><code>trac 22928 add `__mpfr__` to RealNumber class</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1129eca628654f420c7ed0fce15962d2eea2818f"><code>1129eca</code></a></td><td><code>trac 22928 merge trac 22927</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0ddcc8515822c3ed872c1c586741faad44703b36"><code>0ddcc85</code></a></td><td><code>trac 22928 add `__mpfr__` to RealDoubleElement class</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/99b77348d7189300b0fa1e1d04cdb9cbcb4b0765"><code>99b7734</code></a></td><td><code>trac 22928 add test for mpfr</code></td></tr></table>




---

archive/issue_comments_342231.json:
```json
{
    "body": "Changed commit from **[`f5a3799`](https://github.com/sagemath/sagetrac-mirror/commit/f5a37994b02d98e73cfad3322348b1aaa57c40de)** to **[`99b7734`](https://github.com/sagemath/sagetrac-mirror/commit/99b77348d7189300b0fa1e1d04cdb9cbcb4b0765)**",
    "created_at": "2017-11-14T09:11:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342231",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`f5a3799`](https://github.com/sagemath/sagetrac-mirror/commit/f5a37994b02d98e73cfad3322348b1aaa57c40de)** to **[`99b7734`](https://github.com/sagemath/sagetrac-mirror/commit/99b77348d7189300b0fa1e1d04cdb9cbcb4b0765)**



---

archive/issue_comments_342232.json:
```json
{
    "body": "<div id=\"comment:55\" align=\"right\">comment:55</div>\n\nrebase on 8.1.rc0",
    "created_at": "2017-11-14T09:21:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342232",
    "user": "https://github.com/vinklein"
}
```

<div id="comment:55" align="right">comment:55</div>

rebase on 8.1.rc0



---

archive/issue_comments_342233.json:
```json
{
    "body": "<div id=\"comment:56\" align=\"right\">comment:56</div>\n\nThere is some very ugly Cython code in this branch. I guess this is mostly caused by upstream's ignorance on how to do Cython declarations correctly. I'll try to fix this.",
    "created_at": "2017-11-14T11:08:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342233",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:56" align="right">comment:56</div>

There is some very ugly Cython code in this branch. I guess this is mostly caused by upstream's ignorance on how to do Cython declarations correctly. I'll try to fix this.



---

archive/issue_comments_342234.json:
```json
{
    "body": "<div id=\"comment:57\" align=\"right\">comment:57</div>\n\nWorking on this...",
    "created_at": "2017-11-14T11:08:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342234",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:57" align="right">comment:57</div>

Working on this...



---

archive/issue_comments_342235.json:
```json
{
    "body": "<div id=\"comment:58\" align=\"right\">comment:58</div>\n\nIs there any reason why we need this many commits? Can I just squash all that to 1 commit?",
    "created_at": "2017-11-14T11:10:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342235",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:58" align="right">comment:58</div>

Is there any reason why we need this many commits? Can I just squash all that to 1 commit?



---

archive/issue_comments_342236.json:
```json
{
    "body": "<div id=\"comment:59\" align=\"right\">comment:59</div>\n\nJust historical reason.\nThe gmpy2's cython interface has evolved since this version. You can look if it covers what seems relevant to you [PR#155](https://github.com/aleaxit/gmpy/pull/155).\n\nThe plan of my last push was just to rebase this ticket before integrating the future stable version of gmpy2",
    "created_at": "2017-11-14T11:28:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342236",
    "user": "https://github.com/vinklein"
}
```

<div id="comment:59" align="right">comment:59</div>

Just historical reason.
The gmpy2's cython interface has evolved since this version. You can look if it covers what seems relevant to you [PR#155](https://github.com/aleaxit/gmpy/pull/155).

The plan of my last push was just to rebase this ticket before integrating the future stable version of gmpy2



---

archive/issue_comments_342237.json:
```json
{
    "body": "Changed branch from **[u/vklein/conversion_between_gmpy2_and_sage_integers](https://github.com/sagemath/sagetrac-mirror/tree/u/vklein/conversion_between_gmpy2_and_sage_integers)** to **[u/jdemeyer/conversion_between_gmpy2_and_sage_integers](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/conversion_between_gmpy2_and_sage_integers)**",
    "created_at": "2017-11-14T12:33:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342237",
    "user": "https://github.com/jdemeyer"
}
```

Changed branch from **[u/vklein/conversion_between_gmpy2_and_sage_integers](https://github.com/sagemath/sagetrac-mirror/tree/u/vklein/conversion_between_gmpy2_and_sage_integers)** to **[u/jdemeyer/conversion_between_gmpy2_and_sage_integers](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/conversion_between_gmpy2_and_sage_integers)**



---

archive/issue_comments_342238.json:
```json
{
    "body": "<div id=\"comment:61\" align=\"right\">comment:61</div>\n\nI made an upstream pull request https://github.com/aleaxit/gmpy/pull/169 to clean up some Cython declarations.\n\nThen, I cleaned up the branch on this ticket using that PR and I made this branch independent of the gmpy2 upgrade for easier development.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/60f61ff450e14b6b67720e47c8a5f5706546c7a4\"><code>60f61ff</code></a></td><td><code>Conversion between gmpy2 and Sage objects</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c08a7102060473a105ff4106ed75fc615c79c7f4\"><code>c08a710</code></a></td><td><code>Cleaner gmpy2 interface</code></td></tr></table>\n",
    "created_at": "2017-11-14T12:35:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342238",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:61" align="right">comment:61</div>

I made an upstream pull request https://github.com/aleaxit/gmpy/pull/169 to clean up some Cython declarations.

Then, I cleaned up the branch on this ticket using that PR and I made this branch independent of the gmpy2 upgrade for easier development.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/60f61ff450e14b6b67720e47c8a5f5706546c7a4"><code>60f61ff</code></a></td><td><code>Conversion between gmpy2 and Sage objects</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c08a7102060473a105ff4106ed75fc615c79c7f4"><code>c08a710</code></a></td><td><code>Cleaner gmpy2 interface</code></td></tr></table>




---

archive/issue_comments_342239.json:
```json
{
    "body": "Changed commit from **[`99b7734`](https://github.com/sagemath/sagetrac-mirror/commit/99b77348d7189300b0fa1e1d04cdb9cbcb4b0765)** to **[`c08a710`](https://github.com/sagemath/sagetrac-mirror/commit/c08a7102060473a105ff4106ed75fc615c79c7f4)**",
    "created_at": "2017-11-14T12:35:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342239",
    "user": "https://github.com/jdemeyer"
}
```

Changed commit from **[`99b7734`](https://github.com/sagemath/sagetrac-mirror/commit/99b77348d7189300b0fa1e1d04cdb9cbcb4b0765)** to **[`c08a710`](https://github.com/sagemath/sagetrac-mirror/commit/c08a7102060473a105ff4106ed75fc615c79c7f4)**



---

archive/issue_comments_342240.json:
```json
{
    "body": "<div id=\"comment:62\" align=\"right\">comment:62</div>\n\nThanks ! I will update the tarball of #22927, so people can test this ticket without doing their own (as current one doesn't contain the new cython interface).",
    "created_at": "2017-11-14T12:51:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342240",
    "user": "https://github.com/vinklein"
}
```

<div id="comment:62" align="right">comment:62</div>

Thanks ! I will update the tarball of #22927, so people can test this ticket without doing their own (as current one doesn't contain the new cython interface).



---

archive/issue_comments_342241.json:
```json
{
    "body": "<div id=\"comment:63\" align=\"right\">comment:63</div>\n\nNow working on making gmpy2 optional...",
    "created_at": "2017-11-14T13:07:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342241",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:63" align="right">comment:63</div>

Now working on making gmpy2 optional...



---

archive/issue_comments_342242.json:
```json
{
    "body": "Changed dependencies from **#22927, #23309** to **#22927**",
    "created_at": "2017-11-14T13:07:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342242",
    "user": "https://github.com/jdemeyer"
}
```

Changed dependencies from **#22927, #23309** to **#22927**



---

archive/issue_comments_342243.json:
```json
{
    "body": "Changed dependencies from **#22927** to **#22927, #24215**",
    "created_at": "2017-11-14T13:09:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342243",
    "user": "https://github.com/jdemeyer"
}
```

Changed dependencies from **#22927** to **#22927, #24215**



---

archive/issue_comments_342244.json:
```json
{
    "body": "<div id=\"comment:65\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/34ef6dc08de5f11a74e83c6707d6dd4f5e2563be\"><code>34ef6dc</code></a></td><td><code>Add HAVE_GMPY2 compile-time constant</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a4be146067cc8a12c8afe5a34a44f0d3ec63de7e\"><code>a4be146</code></a></td><td><code>Conversion between gmpy2 and Sage objects</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/480a79d37226e927b25508f706b1b67717e2e2ee\"><code>480a79d</code></a></td><td><code>Cleaner and optional gmpy2 interface</code></td></tr></table>\n",
    "created_at": "2017-11-14T15:32:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342244",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:65"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/34ef6dc08de5f11a74e83c6707d6dd4f5e2563be"><code>34ef6dc</code></a></td><td><code>Add HAVE_GMPY2 compile-time constant</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a4be146067cc8a12c8afe5a34a44f0d3ec63de7e"><code>a4be146</code></a></td><td><code>Conversion between gmpy2 and Sage objects</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/480a79d37226e927b25508f706b1b67717e2e2ee"><code>480a79d</code></a></td><td><code>Cleaner and optional gmpy2 interface</code></td></tr></table>




---

archive/issue_comments_342245.json:
```json
{
    "body": "Changed commit from **[`c08a710`](https://github.com/sagemath/sagetrac-mirror/commit/c08a7102060473a105ff4106ed75fc615c79c7f4)** to **[`480a79d`](https://github.com/sagemath/sagetrac-mirror/commit/480a79d37226e927b25508f706b1b67717e2e2ee)**",
    "created_at": "2017-11-14T15:32:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342245",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`c08a710`](https://github.com/sagemath/sagetrac-mirror/commit/c08a7102060473a105ff4106ed75fc615c79c7f4)** to **[`480a79d`](https://github.com/sagemath/sagetrac-mirror/commit/480a79d37226e927b25508f706b1b67717e2e2ee)**



---

archive/issue_comments_342246.json:
```json
{
    "body": "<div id=\"comment:66\" align=\"right\">comment:66</div>\n\nworking on complex types (`__mpc__` function and constructor)",
    "created_at": "2017-11-14T15:40:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342246",
    "user": "https://github.com/vinklein"
}
```

<div id="comment:66" align="right">comment:66</div>

working on complex types (`__mpc__` function and constructor)



---

archive/issue_comments_342247.json:
```json
{
    "body": "Changed branch from **[u/jdemeyer/conversion_between_gmpy2_and_sage_integers](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/conversion_between_gmpy2_and_sage_integers)** to **[u/vklein/conversion_between_gmpy2_and_sage_integers](https://github.com/sagemath/sagetrac-mirror/tree/u/vklein/conversion_between_gmpy2_and_sage_integers)**",
    "created_at": "2017-11-16T16:46:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342247",
    "user": "https://github.com/vinklein"
}
```

Changed branch from **[u/jdemeyer/conversion_between_gmpy2_and_sage_integers](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/conversion_between_gmpy2_and_sage_integers)** to **[u/vklein/conversion_between_gmpy2_and_sage_integers](https://github.com/sagemath/sagetrac-mirror/tree/u/vklein/conversion_between_gmpy2_and_sage_integers)**



---

archive/issue_comments_342248.json:
```json
{
    "body": "Changed commit from **[`480a79d`](https://github.com/sagemath/sagetrac-mirror/commit/480a79d37226e927b25508f706b1b67717e2e2ee)** to **[`0ecbffd`](https://github.com/sagemath/sagetrac-mirror/commit/0ecbffda255da8d6ab042eab194cd295b72e5d13)**",
    "created_at": "2017-11-16T18:39:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342248",
    "user": "https://github.com/jdemeyer"
}
```

Changed commit from **[`480a79d`](https://github.com/sagemath/sagetrac-mirror/commit/480a79d37226e927b25508f706b1b67717e2e2ee)** to **[`0ecbffd`](https://github.com/sagemath/sagetrac-mirror/commit/0ecbffda255da8d6ab042eab194cd295b72e5d13)**



---

archive/issue_comments_342249.json:
```json
{
    "body": "<div id=\"comment:68\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d6072ca9a9e1b9a7d402a214cb7d3deb2d6f3855\"><code>d6072ca</code></a></td><td><code>use a snapshot version of gmpy2</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ce7a0821fa8a5e58d725f2e98adc665a7f8ff061\"><code>ce7a082</code></a></td><td><code>update checksum, snapshot version update in setup.py</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2eca651b6215a1bb37bf6fbaf4251cc214531fd7\"><code>2eca651</code></a></td><td><code>New snapshot version, update checksum and package-version.txt</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bd257c15d700c2bc7e194ca74d2feb9f0996c003\"><code>bd257c1</code></a></td><td><code>Update checksum and snapshot version</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/32cc1ab32a0b364bc6e8be2c812349520364f60e\"><code>32cc1ab</code></a></td><td><code>trac 22927 update gmpy2 snapshot version</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/aab4169b8b6d841cfa88709e99afd16e720c32cf\"><code>aab4169</code></a></td><td><code>trac 22927 update gmpy2 package version</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0ba3ffb09762bbf7c08196702224bdd36fce2fdc\"><code>0ba3ffb</code></a></td><td><code>trac 22927: update package version to snapshot-14.11.17</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3bf081fbac5870ac850250fd960085e80320f926\"><code>3bf081f</code></a></td><td><code>Merge branch 'u/vklein/add_gmpy2_as_an_optional_package' of git://trac.sagemath.org/sage into t/22928/conversion_between_gmpy2_and_sage_integers</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0ecbffda255da8d6ab042eab194cd295b72e5d13\"><code>0ecbffd</code></a></td><td><code>trac 22928 : add `__mpc__` function to Sage complex numbers</code></td></tr></table>\n",
    "created_at": "2017-11-16T18:39:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342249",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:68"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d6072ca9a9e1b9a7d402a214cb7d3deb2d6f3855"><code>d6072ca</code></a></td><td><code>use a snapshot version of gmpy2</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ce7a0821fa8a5e58d725f2e98adc665a7f8ff061"><code>ce7a082</code></a></td><td><code>update checksum, snapshot version update in setup.py</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2eca651b6215a1bb37bf6fbaf4251cc214531fd7"><code>2eca651</code></a></td><td><code>New snapshot version, update checksum and package-version.txt</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bd257c15d700c2bc7e194ca74d2feb9f0996c003"><code>bd257c1</code></a></td><td><code>Update checksum and snapshot version</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/32cc1ab32a0b364bc6e8be2c812349520364f60e"><code>32cc1ab</code></a></td><td><code>trac 22927 update gmpy2 snapshot version</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/aab4169b8b6d841cfa88709e99afd16e720c32cf"><code>aab4169</code></a></td><td><code>trac 22927 update gmpy2 package version</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0ba3ffb09762bbf7c08196702224bdd36fce2fdc"><code>0ba3ffb</code></a></td><td><code>trac 22927: update package version to snapshot-14.11.17</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3bf081fbac5870ac850250fd960085e80320f926"><code>3bf081f</code></a></td><td><code>Merge branch 'u/vklein/add_gmpy2_as_an_optional_package' of git://trac.sagemath.org/sage into t/22928/conversion_between_gmpy2_and_sage_integers</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0ecbffda255da8d6ab042eab194cd295b72e5d13"><code>0ecbffd</code></a></td><td><code>trac 22928 : add `__mpc__` function to Sage complex numbers</code></td></tr></table>




---

archive/issue_comments_342250.json:
```json
{
    "body": "<div id=\"comment:69\" align=\"right\">comment:69</div>\n\nThe documentation\n\n```\nConvert Sage ``ComplexNumber`` to gmpy2 ``Complex``.\n```\nrefers to a type `Complex` that does not exist in gmpy2 and `ComplexNumber` should be one of `ComplexDoubleElement`, `MPComplexNumber` or `ComplexNumber` which are three distinct classes.",
    "created_at": "2017-11-16T18:50:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342250",
    "user": "https://github.com/videlec"
}
```

<div id="comment:69" align="right">comment:69</div>

The documentation

```
Convert Sage ``ComplexNumber`` to gmpy2 ``Complex``.
```
refers to a type `Complex` that does not exist in gmpy2 and `ComplexNumber` should be one of `ComplexDoubleElement`, `MPComplexNumber` or `ComplexNumber` which are three distinct classes.



---

archive/issue_events_316956.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-11-16T18:50:04Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "milestone_number": null,
    "milestone_title": "sage-8.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22928#event-316956"
}
```



---

archive/issue_events_316957.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-11-16T18:50:04Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "milestone_number": null,
    "milestone_title": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22928#event-316957"
}
```



---

archive/issue_comments_342251.json:
```json
{
    "body": "<div id=\"comment:70\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6d674fc2956a9674ccb7349b47c316193788ee84\"><code>6d674fc</code></a></td><td><code>trac 22928 : fix `__mpc__` documentation</code></td></tr></table>\n",
    "created_at": "2017-11-17T08:55:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342251",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:70"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6d674fc2956a9674ccb7349b47c316193788ee84"><code>6d674fc</code></a></td><td><code>trac 22928 : fix `__mpc__` documentation</code></td></tr></table>




---

archive/issue_comments_342252.json:
```json
{
    "body": "Changed commit from **[`0ecbffd`](https://github.com/sagemath/sagetrac-mirror/commit/0ecbffda255da8d6ab042eab194cd295b72e5d13)** to **[`6d674fc`](https://github.com/sagemath/sagetrac-mirror/commit/6d674fc2956a9674ccb7349b47c316193788ee84)**",
    "created_at": "2017-11-17T08:55:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342252",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`0ecbffd`](https://github.com/sagemath/sagetrac-mirror/commit/0ecbffda255da8d6ab042eab194cd295b72e5d13)** to **[`6d674fc`](https://github.com/sagemath/sagetrac-mirror/commit/6d674fc2956a9674ccb7349b47c316193788ee84)**



---

archive/issue_comments_342253.json:
```json
{
    "body": "Changed commit from **[`6d674fc`](https://github.com/sagemath/sagetrac-mirror/commit/6d674fc2956a9674ccb7349b47c316193788ee84)** to **[`e406a9e`](https://github.com/sagemath/sagetrac-mirror/commit/e406a9e61f43e832baecf6d2aa300f01362ca8d7)**",
    "created_at": "2017-11-24T16:53:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342253",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`6d674fc`](https://github.com/sagemath/sagetrac-mirror/commit/6d674fc2956a9674ccb7349b47c316193788ee84)** to **[`e406a9e`](https://github.com/sagemath/sagetrac-mirror/commit/e406a9e61f43e832baecf6d2aa300f01362ca8d7)**



---

archive/issue_comments_342254.json:
```json
{
    "body": "<div id=\"comment:71\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e0005636ed6db71bc8dca31418c9cb6519deb8f5\"><code>e000563</code></a></td><td><code>Trac #22927 gmpy2 update package version to 2.1.0a1</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/82d94629d82f440d0532c0dd24a68d9e95e4dded\"><code>82d9462</code></a></td><td><code>Add HAVE_GMPY2 compile-time constant</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2d01807fef602a1030b027109af86b2c6b281941\"><code>2d01807</code></a></td><td><code>Conversion between gmpy2 and Sage objects</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b9c7c43a1f2648fc4f198b977735fbea6098341c\"><code>b9c7c43</code></a></td><td><code>Cleaner and optional gmpy2 interface</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/476ddc2814953a705d118bdf550367b5fabbab61\"><code>476ddc2</code></a></td><td><code>trac 22928 : add `__mpc__` function to Sage complex numbers</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e406a9e61f43e832baecf6d2aa300f01362ca8d7\"><code>e406a9e</code></a></td><td><code>trac 22928 : fix `__mpc__` documentation</code></td></tr></table>\n",
    "created_at": "2017-11-24T16:53:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342254",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:71"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e0005636ed6db71bc8dca31418c9cb6519deb8f5"><code>e000563</code></a></td><td><code>Trac #22927 gmpy2 update package version to 2.1.0a1</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/82d94629d82f440d0532c0dd24a68d9e95e4dded"><code>82d9462</code></a></td><td><code>Add HAVE_GMPY2 compile-time constant</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2d01807fef602a1030b027109af86b2c6b281941"><code>2d01807</code></a></td><td><code>Conversion between gmpy2 and Sage objects</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b9c7c43a1f2648fc4f198b977735fbea6098341c"><code>b9c7c43</code></a></td><td><code>Cleaner and optional gmpy2 interface</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/476ddc2814953a705d118bdf550367b5fabbab61"><code>476ddc2</code></a></td><td><code>trac 22928 : add `__mpc__` function to Sage complex numbers</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e406a9e61f43e832baecf6d2aa300f01362ca8d7"><code>e406a9e</code></a></td><td><code>trac 22928 : fix `__mpc__` documentation</code></td></tr></table>




---

archive/issue_comments_342255.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -10,6 +10,3 @@\n    - `ComplexNumber` (`sage.rings.complex_number`)\n \n Conversly, we make Sage integer, rational, real and complex constructors accept gmpy2 arguments.\n-\n-\n-**All these features need `gmpy2` being a standard package.**\n``````\n",
    "created_at": "2017-11-24T16:55:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342255",
    "user": "https://github.com/vinklein"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -10,6 +10,3 @@
    - `ComplexNumber` (`sage.rings.complex_number`)
 
 Conversly, we make Sage integer, rational, real and complex constructors accept gmpy2 arguments.
-
-
-**All these features need `gmpy2` being a standard package.**
``````




---

archive/issue_comments_342256.json:
```json
{
    "body": "<div id=\"comment:72\" align=\"right\">comment:72</div>\n\nRebase on the last Trac #22927 HEAD",
    "created_at": "2017-11-24T16:55:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342256",
    "user": "https://github.com/vinklein"
}
```

<div id="comment:72" align="right">comment:72</div>

Rebase on the last Trac #22927 HEAD



---

archive/issue_events_316958.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2017-11-24T16:56:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22928#event-316958"
}
```



---

archive/issue_comments_342257.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,10 +1,10 @@\n-The library `gmpy2` support conversions by the use of special methods. In order to allow conversion of Sage objects into gmpy2 objects, we implement the following\n-- a method `__mpz__` on Sage Integer\n-- a method `__mpq__` on Sage Rational\n-- a method `__mpfr__` on relevant Sage real numbers\n+The library `gmpy2` supports conversions by the use of special methods. In order to allow conversion of Sage objects into gmpy2 objects, we implement the following methods\n+- `__mpz__` on Sage Integer\n+- `__mpq__` on Sage Rational\n+- `__mpfr__` on relevant Sage real numbers\n    - `RealNumber` (`sage.rings.real_mpfr`)\n    - `RealDoubleElement` (`sage.rings.real_double`)\n-- a method `__mpc__` on relevant Sage complex numbers\n+- `__mpc__` on relevant Sage complex numbers\n    - `ComplexDoubleElement` (`sage.rings.complex_double`)\n    - `MPComplexNumber` (`sage.rings.complex_mpc`)\n    - `ComplexNumber` (`sage.rings.complex_number`)\n``````\n",
    "created_at": "2017-11-24T16:58:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342257",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,10 +1,10 @@
-The library `gmpy2` support conversions by the use of special methods. In order to allow conversion of Sage objects into gmpy2 objects, we implement the following
-- a method `__mpz__` on Sage Integer
-- a method `__mpq__` on Sage Rational
-- a method `__mpfr__` on relevant Sage real numbers
+The library `gmpy2` supports conversions by the use of special methods. In order to allow conversion of Sage objects into gmpy2 objects, we implement the following methods
+- `__mpz__` on Sage Integer
+- `__mpq__` on Sage Rational
+- `__mpfr__` on relevant Sage real numbers
    - `RealNumber` (`sage.rings.real_mpfr`)
    - `RealDoubleElement` (`sage.rings.real_double`)
-- a method `__mpc__` on relevant Sage complex numbers
+- `__mpc__` on relevant Sage complex numbers
    - `ComplexDoubleElement` (`sage.rings.complex_double`)
    - `MPComplexNumber` (`sage.rings.complex_mpc`)
    - `ComplexNumber` (`sage.rings.complex_number`)
``````




---

archive/issue_events_316959.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-11-24T17:02:28Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22928#event-316959"
}
```



---

archive/issue_events_316960.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-11-24T17:02:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22928#event-316960"
}
```



---

archive/issue_comments_342258.json:
```json
{
    "body": "<div id=\"comment:75\" align=\"right\">comment:75</div>\n\nThis branch will not work. The commit in #24215 is `7f06e71` but you rebased it here. So there will be a conflict.",
    "created_at": "2017-11-24T17:02:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342258",
    "user": "https://github.com/videlec"
}
```

<div id="comment:75" align="right">comment:75</div>

This branch will not work. The commit in #24215 is `7f06e71` but you rebased it here. So there will be a conflict.



---

archive/issue_comments_342259.json:
```json
{
    "body": "Changed commit from **[`e406a9e`](https://github.com/sagemath/sagetrac-mirror/commit/e406a9e61f43e832baecf6d2aa300f01362ca8d7)** to **[`ddd29a8`](https://github.com/sagemath/sagetrac-mirror/commit/ddd29a839bd97eabf21deef796472384441e9755)**",
    "created_at": "2017-11-24T18:33:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342259",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`e406a9e`](https://github.com/sagemath/sagetrac-mirror/commit/e406a9e61f43e832baecf6d2aa300f01362ca8d7)** to **[`ddd29a8`](https://github.com/sagemath/sagetrac-mirror/commit/ddd29a839bd97eabf21deef796472384441e9755)**



---

archive/issue_comments_342260.json:
```json
{
    "body": "<div id=\"comment:76\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/34ef6dc08de5f11a74e83c6707d6dd4f5e2563be\"><code>34ef6dc</code></a></td><td><code>Add HAVE_GMPY2 compile-time constant</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/158d984a1263978ce941172c775238afbc32ad65\"><code>158d984</code></a></td><td><code>Force absolute import in have_module()</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7f06e71efb3fdc5f91fcf4b0b3ef761c72d9a8c2\"><code>7f06e71</code></a></td><td><code>Fix documentation</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9dceca04aa94beb3324addabddff7158f4c3c8fd\"><code>9dceca0</code></a></td><td><code>Merge branch 'u/jdemeyer/ticket/24215' of git://trac.sagemath.org/sage into 22928</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8bed52c842d0ea43a28f3459620b4c9880f96b27\"><code>8bed52c</code></a></td><td><code>Conversion between gmpy2 and Sage objects</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4f79ed76ccca8d601205980ac6ba66889e09f241\"><code>4f79ed7</code></a></td><td><code>Cleaner and optional gmpy2 interface</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/89385495576b895a5c6adde62416f165e6662cfb\"><code>8938549</code></a></td><td><code>trac 22928 : add `__mpc__` function to Sage complex numbers</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ddd29a839bd97eabf21deef796472384441e9755\"><code>ddd29a8</code></a></td><td><code>trac 22928 : fix `__mpc__` documentation</code></td></tr></table>\n",
    "created_at": "2017-11-24T18:33:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342260",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:76"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/34ef6dc08de5f11a74e83c6707d6dd4f5e2563be"><code>34ef6dc</code></a></td><td><code>Add HAVE_GMPY2 compile-time constant</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/158d984a1263978ce941172c775238afbc32ad65"><code>158d984</code></a></td><td><code>Force absolute import in have_module()</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7f06e71efb3fdc5f91fcf4b0b3ef761c72d9a8c2"><code>7f06e71</code></a></td><td><code>Fix documentation</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9dceca04aa94beb3324addabddff7158f4c3c8fd"><code>9dceca0</code></a></td><td><code>Merge branch 'u/jdemeyer/ticket/24215' of git://trac.sagemath.org/sage into 22928</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8bed52c842d0ea43a28f3459620b4c9880f96b27"><code>8bed52c</code></a></td><td><code>Conversion between gmpy2 and Sage objects</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4f79ed76ccca8d601205980ac6ba66889e09f241"><code>4f79ed7</code></a></td><td><code>Cleaner and optional gmpy2 interface</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/89385495576b895a5c6adde62416f165e6662cfb"><code>8938549</code></a></td><td><code>trac 22928 : add `__mpc__` function to Sage complex numbers</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ddd29a839bd97eabf21deef796472384441e9755"><code>ddd29a8</code></a></td><td><code>trac 22928 : fix `__mpc__` documentation</code></td></tr></table>




---

archive/issue_comments_342261.json:
```json
{
    "body": "<div id=\"comment:77\" align=\"right\">comment:77</div>\n\nrework done",
    "created_at": "2017-11-24T18:39:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342261",
    "user": "https://github.com/vinklein"
}
```

<div id="comment:77" align="right">comment:77</div>

rework done



---

archive/issue_events_316961.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2017-11-24T18:39:51Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22928#event-316961"
}
```



---

archive/issue_events_316962.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2017-11-24T18:39:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22928#event-316962"
}
```



---

archive/issue_events_316963.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-11-28T12:40:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22928#event-316963"
}
```



---

archive/issue_events_316964.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-11-28T12:40:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22928#event-316964"
}
```



---

archive/issue_comments_342262.json:
```json
{
    "body": "<div id=\"comment:78\" align=\"right\">comment:78</div>\n\n\n```\nsage: import gmpy2\nsage: gmpy2.mpz(1/2)\n--> SEGFAULT <--\n```",
    "created_at": "2017-11-28T12:40:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342262",
    "user": "https://github.com/videlec"
}
```

<div id="comment:78" align="right">comment:78</div>


```
sage: import gmpy2
sage: gmpy2.mpz(1/2)
--> SEGFAULT <--
```



---

archive/issue_events_316965.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-11-28T12:44:13Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22928#event-316965"
}
```



---

archive/issue_events_316966.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-11-28T12:44:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22928#event-316966"
}
```



---

archive/issue_comments_342263.json:
```json
{
    "body": "<div id=\"comment:79\" align=\"right\">comment:79</div>\n\nReplying to [@videlec](#comment:78):\n> \n> ```\n> sage: import gmpy2\n> sage: gmpy2.mpz(1/2)\n> --> SEGFAULT <--\n> ```\n\nThat is really a bug in `gmpy2`, not in Sage.",
    "created_at": "2017-11-28T12:44:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342263",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:79" align="right">comment:79</div>

Replying to [@videlec](#comment:78):
> 
> ```
> sage: import gmpy2
> sage: gmpy2.mpz(1/2)
> --> SEGFAULT <--
> ```

That is really a bug in `gmpy2`, not in Sage.



---

archive/issue_comments_342264.json:
```json
{
    "body": "<div id=\"comment:80\" align=\"right\">comment:80</div>\n\nIndeed https://github.com/aleaxit/gmpy/issues/173",
    "created_at": "2017-11-28T12:55:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342264",
    "user": "https://github.com/videlec"
}
```

<div id="comment:80" align="right">comment:80</div>

Indeed https://github.com/aleaxit/gmpy/issues/173



---

archive/issue_comments_342265.json:
```json
{
    "body": "<div id=\"comment:81\" align=\"right\">comment:81</div>\n\nI might review this, but only after the dependencies have been merged in a beta.",
    "created_at": "2017-11-28T13:39:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342265",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:81" align="right">comment:81</div>

I might review this, but only after the dependencies have been merged in a beta.



---

archive/issue_comments_342266.json:
```json
{
    "body": "Changed branch from **[u/vklein/conversion_between_gmpy2_and_sage_integers](https://github.com/sagemath/sagetrac-mirror/tree/u/vklein/conversion_between_gmpy2_and_sage_integers)** to **[u/jdemeyer/conversion_between_gmpy2_and_sage_integers](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/conversion_between_gmpy2_and_sage_integers)**",
    "created_at": "2017-12-14T12:06:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342266",
    "user": "https://github.com/jdemeyer"
}
```

Changed branch from **[u/vklein/conversion_between_gmpy2_and_sage_integers](https://github.com/sagemath/sagetrac-mirror/tree/u/vklein/conversion_between_gmpy2_and_sage_integers)** to **[u/jdemeyer/conversion_between_gmpy2_and_sage_integers](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/conversion_between_gmpy2_and_sage_integers)**



---

archive/issue_comments_342267.json:
```json
{
    "body": "Changed commit from **[`ddd29a8`](https://github.com/sagemath/sagetrac-mirror/commit/ddd29a839bd97eabf21deef796472384441e9755)** to **[`9528b59`](https://github.com/sagemath/sagetrac-mirror/commit/9528b59e0936668ff3c05ec9ced10c322c71e8ba)**",
    "created_at": "2017-12-14T12:06:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342267",
    "user": "https://github.com/jdemeyer"
}
```

Changed commit from **[`ddd29a8`](https://github.com/sagemath/sagetrac-mirror/commit/ddd29a839bd97eabf21deef796472384441e9755)** to **[`9528b59`](https://github.com/sagemath/sagetrac-mirror/commit/9528b59e0936668ff3c05ec9ced10c322c71e8ba)**



---

archive/issue_comments_342268.json:
```json
{
    "body": "Changed dependencies from **#22927, #24215** to none",
    "created_at": "2017-12-14T12:06:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342268",
    "user": "https://github.com/jdemeyer"
}
```

Changed dependencies from **#22927, #24215** to none



---

archive/issue_comments_342269.json:
```json
{
    "body": "<div id=\"comment:83\" align=\"right\">comment:83</div>\n\nRebased to 8.2.beta0\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0cf649fdb2d675ee8efcae9c9bfb974dd56db482\"><code>0cf649f</code></a></td><td><code>Conversion between gmpy2 and Sage objects</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bc582a81638c2498bc6e1cb47811cf7b71ee7c98\"><code>bc582a8</code></a></td><td><code>Cleaner and optional gmpy2 interface</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9528b59e0936668ff3c05ec9ced10c322c71e8ba\"><code>9528b59</code></a></td><td><code>trac 22928 : add `__mpc__` function to Sage complex numbers</code></td></tr></table>\n",
    "created_at": "2017-12-14T12:06:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342269",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:83" align="right">comment:83</div>

Rebased to 8.2.beta0

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0cf649fdb2d675ee8efcae9c9bfb974dd56db482"><code>0cf649f</code></a></td><td><code>Conversion between gmpy2 and Sage objects</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bc582a81638c2498bc6e1cb47811cf7b71ee7c98"><code>bc582a8</code></a></td><td><code>Cleaner and optional gmpy2 interface</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9528b59e0936668ff3c05ec9ced10c322c71e8ba"><code>9528b59</code></a></td><td><code>trac 22928 : add `__mpc__` function to Sage complex numbers</code></td></tr></table>




---

archive/issue_comments_342270.json:
```json
{
    "body": "<div id=\"comment:84\" align=\"right\">comment:84</div>\n\nThanks for the rebase.",
    "created_at": "2017-12-14T15:18:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342270",
    "user": "https://github.com/vinklein"
}
```

<div id="comment:84" align="right">comment:84</div>

Thanks for the rebase.



---

archive/issue_comments_342271.json:
```json
{
    "body": "Dependencies: **#24417**",
    "created_at": "2017-12-21T17:33:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342271",
    "user": "https://github.com/videlec"
}
```

Dependencies: **#24417**



---

archive/issue_comments_342272.json:
```json
{
    "body": "<div id=\"comment:86\" align=\"right\">comment:86</div>\n\nrebase on 24417 in progress.",
    "created_at": "2017-12-22T10:45:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342272",
    "user": "https://github.com/vinklein"
}
```

<div id="comment:86" align="right">comment:86</div>

rebase on 24417 in progress.



---

archive/issue_events_316967.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2017-12-22T10:45:17Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22928#event-316967"
}
```



---

archive/issue_events_316968.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2017-12-22T10:45:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22928#event-316968"
}
```



---

archive/issue_comments_342273.json:
```json
{
    "body": "Changed branch from **[u/jdemeyer/conversion_between_gmpy2_and_sage_integers](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/conversion_between_gmpy2_and_sage_integers)** to **[u/vklein/conversion_between_gmpy2_and_sage_integers](https://github.com/sagemath/sagetrac-mirror/tree/u/vklein/conversion_between_gmpy2_and_sage_integers)**",
    "created_at": "2017-12-22T17:05:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342273",
    "user": "https://github.com/vinklein"
}
```

Changed branch from **[u/jdemeyer/conversion_between_gmpy2_and_sage_integers](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/conversion_between_gmpy2_and_sage_integers)** to **[u/vklein/conversion_between_gmpy2_and_sage_integers](https://github.com/sagemath/sagetrac-mirror/tree/u/vklein/conversion_between_gmpy2_and_sage_integers)**



---

archive/issue_comments_342274.json:
```json
{
    "body": "<div id=\"comment:88\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/16cc1ad0729e26947786cab4c82040713c9324db\"><code>16cc1ad</code></a></td><td><code>24417: fix gmpy2 segfaults in conversions</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/aaf54d38979a447a7b0e41b352e93ef0159ef91f\"><code>aaf54d3</code></a></td><td><code>Conversion between gmpy2 and Sage objects</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4da4c9ba254c28d68aed23394d42c40cce583466\"><code>4da4c9b</code></a></td><td><code>Cleaner and optional gmpy2 interface</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/01978e3951497753e85d0c9a2180a54030cb4732\"><code>01978e3</code></a></td><td><code>trac 22928 : add `__mpc__` function to Sage complex numbers</code></td></tr></table>\n",
    "created_at": "2017-12-22T17:07:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342274",
    "user": "https://github.com/vinklein"
}
```

<div id="comment:88"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/16cc1ad0729e26947786cab4c82040713c9324db"><code>16cc1ad</code></a></td><td><code>24417: fix gmpy2 segfaults in conversions</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/aaf54d38979a447a7b0e41b352e93ef0159ef91f"><code>aaf54d3</code></a></td><td><code>Conversion between gmpy2 and Sage objects</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4da4c9ba254c28d68aed23394d42c40cce583466"><code>4da4c9b</code></a></td><td><code>Cleaner and optional gmpy2 interface</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/01978e3951497753e85d0c9a2180a54030cb4732"><code>01978e3</code></a></td><td><code>trac 22928 : add `__mpc__` function to Sage complex numbers</code></td></tr></table>




---

archive/issue_events_316969.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2017-12-22T17:07:29Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22928#event-316969"
}
```



---

archive/issue_events_316970.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2017-12-22T17:07:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22928#event-316970"
}
```



---

archive/issue_comments_342275.json:
```json
{
    "body": "Changed commit from **[`9528b59`](https://github.com/sagemath/sagetrac-mirror/commit/9528b59e0936668ff3c05ec9ced10c322c71e8ba)** to **[`01978e3`](https://github.com/sagemath/sagetrac-mirror/commit/01978e3951497753e85d0c9a2180a54030cb4732)**",
    "created_at": "2017-12-22T17:07:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342275",
    "user": "https://github.com/vinklein"
}
```

Changed commit from **[`9528b59`](https://github.com/sagemath/sagetrac-mirror/commit/9528b59e0936668ff3c05ec9ced10c322c71e8ba)** to **[`01978e3`](https://github.com/sagemath/sagetrac-mirror/commit/01978e3951497753e85d0c9a2180a54030cb4732)**



---

archive/issue_events_316971.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2018-01-02T20:24:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22928#event-316971"
}
```



---

archive/issue_events_316972.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2018-01-02T20:24:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22928#event-316972"
}
```



---

archive/issue_comments_342276.json:
```json
{
    "body": "<div id=\"comment:89\" align=\"right\">comment:89</div>\n\nSome trivial merge/rebase to be done on 8.2.beta2",
    "created_at": "2018-01-02T20:24:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342276",
    "user": "https://github.com/videlec"
}
```

<div id="comment:89" align="right">comment:89</div>

Some trivial merge/rebase to be done on 8.2.beta2



---

archive/issue_comments_342277.json:
```json
{
    "body": "<div id=\"comment:90\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ca21a733b0fc2c968c30acea1b0d3037084f81a1\"><code>ca21a73</code></a></td><td><code>Conversion between gmpy2 and Sage objects</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2c3c349a60fe6044d15b93eb0b677c95147f6e5d\"><code>2c3c349</code></a></td><td><code>Cleaner and optional gmpy2 interface</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b1481a2aed0ca67bf974ef85a772a97d587a7a2d\"><code>b1481a2</code></a></td><td><code>trac 22928 : add `__mpc__` function to Sage complex numbers</code></td></tr></table>\n",
    "created_at": "2018-01-14T17:18:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342277",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:90"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ca21a733b0fc2c968c30acea1b0d3037084f81a1"><code>ca21a73</code></a></td><td><code>Conversion between gmpy2 and Sage objects</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2c3c349a60fe6044d15b93eb0b677c95147f6e5d"><code>2c3c349</code></a></td><td><code>Cleaner and optional gmpy2 interface</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b1481a2aed0ca67bf974ef85a772a97d587a7a2d"><code>b1481a2</code></a></td><td><code>trac 22928 : add `__mpc__` function to Sage complex numbers</code></td></tr></table>




---

archive/issue_comments_342278.json:
```json
{
    "body": "Changed commit from **[`01978e3`](https://github.com/sagemath/sagetrac-mirror/commit/01978e3951497753e85d0c9a2180a54030cb4732)** to **[`b1481a2`](https://github.com/sagemath/sagetrac-mirror/commit/b1481a2aed0ca67bf974ef85a772a97d587a7a2d)**",
    "created_at": "2018-01-14T17:18:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342278",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`01978e3`](https://github.com/sagemath/sagetrac-mirror/commit/01978e3951497753e85d0c9a2180a54030cb4732)** to **[`b1481a2`](https://github.com/sagemath/sagetrac-mirror/commit/b1481a2aed0ca67bf974ef85a772a97d587a7a2d)**



---

archive/issue_events_316973.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2018-01-14T17:20:23Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22928#event-316973"
}
```



---

archive/issue_events_316974.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2018-01-14T17:20:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22928#event-316974"
}
```



---

archive/issue_comments_342279.json:
```json
{
    "body": "<div id=\"comment:91\" align=\"right\">comment:91</div>\n\nRebase on 8.2.beta2",
    "created_at": "2018-01-14T17:20:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342279",
    "user": "https://github.com/vinklein"
}
```

<div id="comment:91" align="right">comment:91</div>

Rebase on 8.2.beta2



---

archive/issue_events_316975.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2018-01-15T16:00:49Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22928#event-316975"
}
```



---

archive/issue_events_316976.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2018-01-15T16:00:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22928#event-316976"
}
```



---

archive/issue_comments_342280.json:
```json
{
    "body": "<div id=\"comment:92\" align=\"right\">comment:92</div>\n\nSage is crashing\n\n```\nImportError: /opt/sage/local/lib/python2.7/site-packages/sage/rings/complex_number.so: undefined symbol: mpc_set_fr_fr\n```\nThe reason is that you are importing `from sage.libs.mpc cimport *` in `complex_number.pyx` and that this header file does not have the proper distutils directive. Just apply the patch\n\n```diff\ndiff --git a/src/sage/libs/mpc.pxd b/src/sage/libs/mpc.pxd\nindex 0e12d31468..0067b8b126 100644\n--- a/src/sage/libs/mpc.pxd\n+++ b/src/sage/libs/mpc.pxd\n@@ -1,3 +1,5 @@\n+# distutils: libraries = gmp mpfr mpc\n+\n from sage.libs.gmp.types cimport *\n from sage.libs.mpfr.types cimport *\n```",
    "created_at": "2018-01-15T16:00:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342280",
    "user": "https://github.com/videlec"
}
```

<div id="comment:92" align="right">comment:92</div>

Sage is crashing

```
ImportError: /opt/sage/local/lib/python2.7/site-packages/sage/rings/complex_number.so: undefined symbol: mpc_set_fr_fr
```
The reason is that you are importing `from sage.libs.mpc cimport *` in `complex_number.pyx` and that this header file does not have the proper distutils directive. Just apply the patch

```diff
diff --git a/src/sage/libs/mpc.pxd b/src/sage/libs/mpc.pxd
index 0e12d31468..0067b8b126 100644
--- a/src/sage/libs/mpc.pxd
+++ b/src/sage/libs/mpc.pxd
@@ -1,3 +1,5 @@
+# distutils: libraries = gmp mpfr mpc
+
 from sage.libs.gmp.types cimport *
 from sage.libs.mpfr.types cimport *
```



---

archive/issue_comments_342281.json:
```json
{
    "body": "<div id=\"comment:93\" align=\"right\">comment:93</div>\n\nYou should test different precisions for each possible type (that is `RealField(prec)`, `ComplexField(prec)` and `MPComplexField(prec)`).",
    "created_at": "2018-01-15T16:04:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342281",
    "user": "https://github.com/videlec"
}
```

<div id="comment:93" align="right">comment:93</div>

You should test different precisions for each possible type (that is `RealField(prec)`, `ComplexField(prec)` and `MPComplexField(prec)`).



---

archive/issue_comments_342282.json:
```json
{
    "body": "<div id=\"comment:94\" align=\"right\">comment:94</div>\n\nThe following is not nice\n\n```\nsage: gmpy2.mpfr(gmpy2.mpq('1/3'), precision=123).precision\n123\nsage: RealNumber(gmpy2.mpfr(gmpy2.mpq('1/3'), precision=123))\n0.33333333333333333333333333333333333332\nsage: _.prec()    # why not 123?\n130\n```\nAnd this is even worse\n\n```\nsage: ComplexNumber(gmpy2.mpc(gmpy2.mpq('1/3'), precision=123r))\nTraceback (most recent call last):\n...\nTypeError: unable to coerce to a ComplexNumber: <type 'str'>\n```",
    "created_at": "2018-01-15T16:04:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342282",
    "user": "https://github.com/videlec"
}
```

<div id="comment:94" align="right">comment:94</div>

The following is not nice

```
sage: gmpy2.mpfr(gmpy2.mpq('1/3'), precision=123).precision
123
sage: RealNumber(gmpy2.mpfr(gmpy2.mpq('1/3'), precision=123))
0.33333333333333333333333333333333333332
sage: _.prec()    # why not 123?
130
```
And this is even worse

```
sage: ComplexNumber(gmpy2.mpc(gmpy2.mpq('1/3'), precision=123r))
Traceback (most recent call last):
...
TypeError: unable to coerce to a ComplexNumber: <type 'str'>
```



---

archive/issue_comments_342283.json:
```json
{
    "body": "<div id=\"comment:95\" align=\"right\">comment:95</div>\n\nFunny behavior of `gmpy2` precision with Sage integers\n\n```\nsage: gmpy2.mpfr('1.0', precision=40)\nmpfr('1.0',40)\nsage: gmpy2.mpc('1.0', precision=40)\nTraceback (most recent call last):\n...\nTypeError: precision for mpc() must be integer or tuple\n```\nIs that worth an issue?",
    "created_at": "2018-01-15T16:05:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342283",
    "user": "https://github.com/videlec"
}
```

<div id="comment:95" align="right">comment:95</div>

Funny behavior of `gmpy2` precision with Sage integers

```
sage: gmpy2.mpfr('1.0', precision=40)
mpfr('1.0',40)
sage: gmpy2.mpc('1.0', precision=40)
Traceback (most recent call last):
...
TypeError: precision for mpc() must be integer or tuple
```
Is that worth an issue?



---

archive/issue_comments_342284.json:
```json
{
    "body": "<div id=\"comment:96\" align=\"right\">comment:96</div>\n\n> \n> ```diff\n> diff --git a/src/sage/libs/mpc.pxd b/src/sage/libs/mpc.pxd\n> index 0e12d31468..0067b8b126 100644\n> --- a/src/sage/libs/mpc.pxd\n> +++ b/src/sage/libs/mpc.pxd\n> @@ -1,3 +1,5 @@\n> +# distutils: libraries = gmp mpfr mpc\n> +\n>  from sage.libs.gmp.types cimport *\n>  from sage.libs.mpfr.types cimport *\n> ```\n\nI have miss this one but encoutered it on 23024. It has been solved by updating module_list.py \nby adding mpc as a lib to sage.rings.complex_number Extension. \nWhat is the best way to fix it between these two ?",
    "created_at": "2018-01-15T16:13:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342284",
    "user": "https://github.com/vinklein"
}
```

<div id="comment:96" align="right">comment:96</div>

> 
> ```diff
> diff --git a/src/sage/libs/mpc.pxd b/src/sage/libs/mpc.pxd
> index 0e12d31468..0067b8b126 100644
> --- a/src/sage/libs/mpc.pxd
> +++ b/src/sage/libs/mpc.pxd
> @@ -1,3 +1,5 @@
> +# distutils: libraries = gmp mpfr mpc
> +
>  from sage.libs.gmp.types cimport *
>  from sage.libs.mpfr.types cimport *
> ```

I have miss this one but encoutered it on 23024. It has been solved by updating module_list.py 
by adding mpc as a lib to sage.rings.complex_number Extension. 
What is the best way to fix it between these two ?



---

archive/issue_comments_342285.json:
```json
{
    "body": "<div id=\"comment:97\" align=\"right\">comment:97</div>\n\nModifying `module_list.py` is not a good idea. If I write my own Cython file with\n\n```\nfrom sage.rings.complex_number cimport whatever\n```\nThen my program will not compile.\n\naddendum: will not compile if I do not explicitely state that my program needs to be linked against mpc... that would better to be automatic (especially in interactive use of Cython inside Sage)",
    "created_at": "2018-01-15T16:17:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342285",
    "user": "https://github.com/videlec"
}
```

<div id="comment:97" align="right">comment:97</div>

Modifying `module_list.py` is not a good idea. If I write my own Cython file with

```
from sage.rings.complex_number cimport whatever
```
Then my program will not compile.

addendum: will not compile if I do not explicitely state that my program needs to be linked against mpc... that would better to be automatic (especially in interactive use of Cython inside Sage)



---

archive/issue_comments_342286.json:
```json
{
    "body": "<div id=\"comment:98\" align=\"right\">comment:98</div>\n\nOk i see.\n\nReplying to [@videlec](#comment:95):\n> Funny behavior of `gmpy2` precision with Sage integers\n> \n> ```\n> sage: gmpy2.mpfr('1.0', precision=40)\n> mpfr('1.0',40)\n> sage: gmpy2.mpc('1.0', precision=40)\n> Traceback (most recent call last):\n> ...\n> TypeError: precision for mpc() must be integer or tuple\n> ```\n> Is that worth an issue?\n\nI think it is. I will look at it and open an issue if needed.",
    "created_at": "2018-01-15T16:27:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342286",
    "user": "https://github.com/vinklein"
}
```

<div id="comment:98" align="right">comment:98</div>

Ok i see.

Replying to [@videlec](#comment:95):
> Funny behavior of `gmpy2` precision with Sage integers
> 
> ```
> sage: gmpy2.mpfr('1.0', precision=40)
> mpfr('1.0',40)
> sage: gmpy2.mpc('1.0', precision=40)
> Traceback (most recent call last):
> ...
> TypeError: precision for mpc() must be integer or tuple
> ```
> Is that worth an issue?

I think it is. I will look at it and open an issue if needed.



---

archive/issue_comments_342287.json:
```json
{
    "body": "Changed dependencies from **#24417** to **#24549**",
    "created_at": "2018-01-16T14:51:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342287",
    "user": "https://github.com/jdemeyer"
}
```

Changed dependencies from **#24417** to **#24549**



---

archive/issue_comments_342288.json:
```json
{
    "body": "<div id=\"comment:99\" align=\"right\">comment:99</div>\n\nReplying to [@videlec](#comment:92):\n> \n> ```diff\n> diff --git a/src/sage/libs/mpc.pxd b/src/sage/libs/mpc.pxd\n> index 0e12d31468..0067b8b126 100644\n> --- a/src/sage/libs/mpc.pxd\n> +++ b/src/sage/libs/mpc.pxd\n> @@ -1,3 +1,5 @@\n> +# distutils: libraries = gmp mpfr mpc\n> +\n>  from sage.libs.gmp.types cimport *\n>  from sage.libs.mpfr.types cimport *\n> ```\n\nSee #24549 for that.",
    "created_at": "2018-01-16T14:51:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342288",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:99" align="right">comment:99</div>

Replying to [@videlec](#comment:92):
> 
> ```diff
> diff --git a/src/sage/libs/mpc.pxd b/src/sage/libs/mpc.pxd
> index 0e12d31468..0067b8b126 100644
> --- a/src/sage/libs/mpc.pxd
> +++ b/src/sage/libs/mpc.pxd
> @@ -1,3 +1,5 @@
> +# distutils: libraries = gmp mpfr mpc
> +
>  from sage.libs.gmp.types cimport *
>  from sage.libs.mpfr.types cimport *
> ```

See #24549 for that.



---

archive/issue_comments_342289.json:
```json
{
    "body": "<div id=\"comment:100\" align=\"right\">comment:100</div>\n\nReplying to [@videlec](#comment:94):\n> And this is even worse\n> \n> ```\n> sage: ComplexNumber(gmpy2.mpc(gmpy2.mpq('1/3'), precision=123r))\n> Traceback (most recent call last):\n> ...\n> TypeError: unable to coerce to a ComplexNumber: <type 'str'>\n> ```\n\nBut should we really use [ComplexNumber](../wiki/ComplexNumber) this way ?\\\\\nThis call the function create_ComplexNumber and his first parameter is supposed to be the real part only.\n\\\\\nIn your call the first parameter is the whole complex number.\n\\\\\nSecondly create_ComplexNumber always try to convert the parameters (real and imag) into string before calling the [ComplexNumber](../wiki/ComplexNumber) constructor. \\\\\nGiven that if you try to call ComplexNumber() with another complex type as parameter you will get the same result :\n\n```\nsage: cn = ComplexNumber(5,4)\nsage: ComplexNumber(cn)\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n...\nTypeError: unable to coerce to a ComplexNumber: <type 'str'>\n```",
    "created_at": "2018-01-16T15:47:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342289",
    "user": "https://github.com/vinklein"
}
```

<div id="comment:100" align="right">comment:100</div>

Replying to [@videlec](#comment:94):
> And this is even worse
> 
> ```
> sage: ComplexNumber(gmpy2.mpc(gmpy2.mpq('1/3'), precision=123r))
> Traceback (most recent call last):
> ...
> TypeError: unable to coerce to a ComplexNumber: <type 'str'>
> ```

But should we really use [ComplexNumber](../wiki/ComplexNumber) this way ?\\
This call the function create_ComplexNumber and his first parameter is supposed to be the real part only.
\\
In your call the first parameter is the whole complex number.
\\
Secondly create_ComplexNumber always try to convert the parameters (real and imag) into string before calling the [ComplexNumber](../wiki/ComplexNumber) constructor. \\
Given that if you try to call ComplexNumber() with another complex type as parameter you will get the same result :

```
sage: cn = ComplexNumber(5,4)
sage: ComplexNumber(cn)
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
...
TypeError: unable to coerce to a ComplexNumber: <type 'str'>
```



---

archive/issue_comments_342290.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nThe `ComplexNumber` function is wrong in several ways (see #13110). Just ignore it.",
    "created_at": "2018-01-17T12:35:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342290",
    "user": "https://github.com/videlec"
}
```

<div id="comment:1" align="right">comment:1</div>

The `ComplexNumber` function is wrong in several ways (see #13110). Just ignore it.



---

archive/issue_comments_342291.json:
```json
{
    "body": "<div id=\"comment:102\" align=\"right\">comment:102</div>\n\nReplying to [@videlec](#comment:94):\n> The following is not nice\n> \n> ```\n> sage: gmpy2.mpfr(gmpy2.mpq('1/3'), precision=123).precision\n> 123\n> sage: RealNumber(gmpy2.mpfr(gmpy2.mpq('1/3'), precision=123))\n> 0.33333333333333333333333333333333333332\n> sage: _.prec()    # why not 123?\n> 130\n> ```\n\nThat being said the gmpy2's precision is not currently transmitted with `RR` function.\n\n```\nsage: RR(gmpy2.mpfr(gmpy2.mpq('1/3'), precision=123))\n0.333333333333333\nsage: _.prec()\n53\n```\n\nI am on it.",
    "created_at": "2018-01-22T09:26:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342291",
    "user": "https://github.com/vinklein"
}
```

<div id="comment:102" align="right">comment:102</div>

Replying to [@videlec](#comment:94):
> The following is not nice
> 
> ```
> sage: gmpy2.mpfr(gmpy2.mpq('1/3'), precision=123).precision
> 123
> sage: RealNumber(gmpy2.mpfr(gmpy2.mpq('1/3'), precision=123))
> 0.33333333333333333333333333333333333332
> sage: _.prec()    # why not 123?
> 130
> ```

That being said the gmpy2's precision is not currently transmitted with `RR` function.

```
sage: RR(gmpy2.mpfr(gmpy2.mpq('1/3'), precision=123))
0.333333333333333
sage: _.prec()
53
```

I am on it.



---

archive/issue_comments_342292.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nThe only fix i see so far would be do a new `mpfr_init2` during `_set ` call. It's a little ugly :\n\n```\n#real_mpfr.pyx line 1467\n   elif HAVE_GMPY2 and type(x) is gmpy2.mpfr:\n       self._parent = self._parent.to_prec(x.precision)\n       mpfr_init2(self.value, x.precision)\n       mpfr_set(self.value, (<gmpy2.mpfr>x).f, parent.rnd)\n```\n\nOr we can assume the user shoud do that :\n\n```\nsage: R = RealField(128)\nsage: R(gmpy2.mpfr(gmpy2.mpq('1/3'), precision=128))\n0.33333333333333333333333333333333333333\nsage: _.prec()\n128\n```",
    "created_at": "2018-01-22T10:54:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342292",
    "user": "https://github.com/vinklein"
}
```

<div id="comment:3" align="right">comment:3</div>

The only fix i see so far would be do a new `mpfr_init2` during `_set ` call. It's a little ugly :

```
#real_mpfr.pyx line 1467
   elif HAVE_GMPY2 and type(x) is gmpy2.mpfr:
       self._parent = self._parent.to_prec(x.precision)
       mpfr_init2(self.value, x.precision)
       mpfr_set(self.value, (<gmpy2.mpfr>x).f, parent.rnd)
```

Or we can assume the user shoud do that :

```
sage: R = RealField(128)
sage: R(gmpy2.mpfr(gmpy2.mpq('1/3'), precision=128))
0.33333333333333333333333333333333333333
sage: _.prec()
128
```



---

archive/issue_comments_342293.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\n`RealNumber` should be ignored for the same reason (it is aimed to be used by the preparser). You can read #13110 that I already mentioned in [comment:101](#comment:101).",
    "created_at": "2018-01-22T14:28:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342293",
    "user": "https://github.com/videlec"
}
```

<div id="comment:4" align="right">comment:4</div>

`RealNumber` should be ignored for the same reason (it is aimed to be used by the preparser). You can read #13110 that I already mentioned in [comment:101](#comment:101).



---

archive/issue_comments_342294.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nSure ! My current question was more about what should we do for the `RR` function. Should we transmit the precision (and replacing the parent during `__c_init__` or during `_set`) or rely on a consistent usage of `RealField` ?",
    "created_at": "2018-01-22T14:35:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342294",
    "user": "https://github.com/vinklein"
}
```

<div id="comment:5" align="right">comment:5</div>

Sure ! My current question was more about what should we do for the `RR` function. Should we transmit the precision (and replacing the parent during `__c_init__` or during `_set`) or rely on a consistent usage of `RealField` ?



---

archive/issue_comments_342295.json:
```json
{
    "body": "<div id=\"comment:106\" align=\"right\">comment:106</div>\n\nReplying to [@vinklein](#comment:102):\n> Replying to [@videlec](#comment:94):\n> \n> ```\n> sage: RR(gmpy2.mpfr(gmpy2.mpq('1/3'), precision=123))\n> 0.333333333333333\n> sage: _.prec()\n> 53\n> ```\n\nThat's fine. `RR` is the field of floating-point numbers with 53 bits of precision (stupidly named).",
    "created_at": "2018-01-22T16:44:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342295",
    "user": "https://github.com/videlec"
}
```

<div id="comment:106" align="right">comment:106</div>

Replying to [@vinklein](#comment:102):
> Replying to [@videlec](#comment:94):
> 
> ```
> sage: RR(gmpy2.mpfr(gmpy2.mpq('1/3'), precision=123))
> 0.333333333333333
> sage: _.prec()
> 53
> ```

That's fine. `RR` is the field of floating-point numbers with 53 bits of precision (stupidly named).



---

archive/issue_comments_342296.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nThat is to say: `RR` is not a function. It is the object `RealField(53)`.\n\n```\nsage: RR is RealField(53)\nTrue\n```",
    "created_at": "2018-01-22T18:05:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342296",
    "user": "https://github.com/videlec"
}
```

<div id="comment:7" align="right">comment:7</div>

That is to say: `RR` is not a function. It is the object `RealField(53)`.

```
sage: RR is RealField(53)
True
```



---

archive/issue_comments_342297.json:
```json
{
    "body": "Changed commit from **[`b1481a2`](https://github.com/sagemath/sagetrac-mirror/commit/b1481a2aed0ca67bf974ef85a772a97d587a7a2d)** to **[`e9188ba`](https://github.com/sagemath/sagetrac-mirror/commit/e9188bae6e2e5407101d1ef46f3343b7250ae375)**",
    "created_at": "2018-01-23T10:51:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342297",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`b1481a2`](https://github.com/sagemath/sagetrac-mirror/commit/b1481a2aed0ca67bf974ef85a772a97d587a7a2d)** to **[`e9188ba`](https://github.com/sagemath/sagetrac-mirror/commit/e9188bae6e2e5407101d1ef46f3343b7250ae375)**



---

archive/issue_comments_342298.json:
```json
{
    "body": "<div id=\"comment:8\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b1047cce75651690fda2ee0a64d59b56110634b3\"><code>b1047cc</code></a></td><td><code>Clean up MPC declarations</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d9308b29558240d8100e8b7d72bfd00a1d83a589\"><code>d9308b2</code></a></td><td><code>Conversion between gmpy2 and Sage objects</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/074acd61e20ed39a1147edf2de8c6efb1cfc1c53\"><code>074acd6</code></a></td><td><code>Cleaner and optional gmpy2 interface</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2604a3745b9636c5de4bb9a84ee88055c1681c90\"><code>2604a37</code></a></td><td><code>trac 22928 : add `__mpc__` function to Sage complex numbers</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e9188bae6e2e5407101d1ef46f3343b7250ae375\"><code>e9188ba</code></a></td><td><code>Trac #22928: Test different precisions for each possible type</code></td></tr></table>\n",
    "created_at": "2018-01-23T10:51:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342298",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:8"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b1047cce75651690fda2ee0a64d59b56110634b3"><code>b1047cc</code></a></td><td><code>Clean up MPC declarations</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d9308b29558240d8100e8b7d72bfd00a1d83a589"><code>d9308b2</code></a></td><td><code>Conversion between gmpy2 and Sage objects</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/074acd61e20ed39a1147edf2de8c6efb1cfc1c53"><code>074acd6</code></a></td><td><code>Cleaner and optional gmpy2 interface</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2604a3745b9636c5de4bb9a84ee88055c1681c90"><code>2604a37</code></a></td><td><code>trac 22928 : add `__mpc__` function to Sage complex numbers</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e9188bae6e2e5407101d1ef46f3343b7250ae375"><code>e9188ba</code></a></td><td><code>Trac #22928: Test different precisions for each possible type</code></td></tr></table>




---

archive/issue_events_316977.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2018-01-23T10:54:51Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22928#event-316977"
}
```



---

archive/issue_events_316978.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2018-01-23T10:54:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22928#event-316978"
}
```



---

archive/issue_comments_342299.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nAdd some test with different precision [comment:93](https://github.com/sagemath/sage/issues/22928#comment:93).\\\\\nRebase on #24549.",
    "created_at": "2018-01-23T10:54:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342299",
    "user": "https://github.com/vinklein"
}
```

<div id="comment:9" align="right">comment:9</div>

Add some test with different precision [comment:93](https://github.com/sagemath/sage/issues/22928#comment:93).\\
Rebase on #24549.



---

archive/issue_comments_342300.json:
```json
{
    "body": "<div id=\"comment:0\" align=\"right\">comment:0</div>\n\nYou do not need to put `# optional - gmpy2` everywhere. Only where you explicitely need `gmpy2`.\n\nCould you also doctest the fact that the composition of conversions `Sage number -> gmpy2 number -> Sage number` is the identity when precisions are set appropriately (ie we get back an equal element)? For example\n\n```\nsage: MPCF = MPComplexField(63)\nsage: x = MPCF('15.64E+128', '15.64E+128')\nsage: y = mpc(x)         # optional - gmpy2\nsage: y.precision        # optional - gmpy2\n(63, 63)\nsage: MPCF(y) == x       # optional - gmpy2\nTrue\n```\nAnd also the other way around `gmpy2 number -> Sage number -> gmpy2 number`\n\n```\nsage: x = gmpy2.mpc('1.324+4e50j', precision=(70,70))  # optional - gmpy2\nsage: y = ComplexField(70)(x)                          # optional - gmpy2\nsage: gmpy2.mpc(y) == x                                # optional - gmpy2\nTrue\n```",
    "created_at": "2018-01-23T11:04:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342300",
    "user": "https://github.com/videlec"
}
```

<div id="comment:0" align="right">comment:0</div>

You do not need to put `# optional - gmpy2` everywhere. Only where you explicitely need `gmpy2`.

Could you also doctest the fact that the composition of conversions `Sage number -> gmpy2 number -> Sage number` is the identity when precisions are set appropriately (ie we get back an equal element)? For example

```
sage: MPCF = MPComplexField(63)
sage: x = MPCF('15.64E+128', '15.64E+128')
sage: y = mpc(x)         # optional - gmpy2
sage: y.precision        # optional - gmpy2
(63, 63)
sage: MPCF(y) == x       # optional - gmpy2
True
```
And also the other way around `gmpy2 number -> Sage number -> gmpy2 number`

```
sage: x = gmpy2.mpc('1.324+4e50j', precision=(70,70))  # optional - gmpy2
sage: y = ComplexField(70)(x)                          # optional - gmpy2
sage: gmpy2.mpc(y) == x                                # optional - gmpy2
True
```



---

archive/issue_events_316979.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2018-01-23T13:03:29Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22928#event-316979"
}
```



---

archive/issue_events_316980.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2018-01-23T13:03:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22928#event-316980"
}
```



---

archive/issue_comments_342301.json:
```json
{
    "body": "<div id=\"comment:111\" align=\"right\">comment:111</div>\n\nOk i will add this type of doctest.",
    "created_at": "2018-01-23T13:03:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342301",
    "user": "https://github.com/vinklein"
}
```

<div id="comment:111" align="right">comment:111</div>

Ok i will add this type of doctest.



---

archive/issue_comments_342302.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nThese tests works with `MPComplexField` and `RealField` but they didn't work with `ComplexField` in `gmpy2 number -> Sage number -> gmpy2 number` way :\n\n```\nsage: x = gmpy2.mpc('1.324+4e50j', precision=(70,70))\nsage: y = ComplexField(70)(x)\nsage: gmpy2.mpc(y) == x\nFalse\nsage: x\nmpc('1.3240000000000000000005+3.9999999999999999999976e+50j',(70,70))\nsage: gmpy2.mpc(y)\nmpc('1.3240000000000000657252+4.0000000000000003051908e+50j',(70,70))\n```\nIs this an issue or a normal rounding behaviour ?",
    "created_at": "2018-01-23T13:56:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342302",
    "user": "https://github.com/vinklein"
}
```

<div id="comment:2" align="right">comment:2</div>

These tests works with `MPComplexField` and `RealField` but they didn't work with `ComplexField` in `gmpy2 number -> Sage number -> gmpy2 number` way :

```
sage: x = gmpy2.mpc('1.324+4e50j', precision=(70,70))
sage: y = ComplexField(70)(x)
sage: gmpy2.mpc(y) == x
False
sage: x
mpc('1.3240000000000000000005+3.9999999999999999999976e+50j',(70,70))
sage: gmpy2.mpc(y)
mpc('1.3240000000000000657252+4.0000000000000003051908e+50j',(70,70))
```
Is this an issue or a normal rounding behaviour ?



---

archive/issue_comments_342303.json:
```json
{
    "body": "<div id=\"comment:113\" align=\"right\">comment:113</div>\n\nReplying to [@vinklein](#comment:112):\n> These tests works with `MPComplexField` and `RealField` but they didn't work with `ComplexField` in `gmpy2 number -> Sage number -> gmpy2 number` way :\n> \n> ```\n> sage: x = gmpy2.mpc('1.324+4e50j', precision=(70,70))\n> sage: y = ComplexField(70)(x)\n> sage: gmpy2.mpc(y) == x\n> False\n> ```\n> Is this an issue or a normal rounding behaviour ?\n\nTo me, this is an issue. The code in your example should just be copying `mpfr_t` values around.",
    "created_at": "2018-01-23T15:06:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342303",
    "user": "https://github.com/videlec"
}
```

<div id="comment:113" align="right">comment:113</div>

Replying to [@vinklein](#comment:112):
> These tests works with `MPComplexField` and `RealField` but they didn't work with `ComplexField` in `gmpy2 number -> Sage number -> gmpy2 number` way :
> 
> ```
> sage: x = gmpy2.mpc('1.324+4e50j', precision=(70,70))
> sage: y = ComplexField(70)(x)
> sage: gmpy2.mpc(y) == x
> False
> ```
> Is this an issue or a normal rounding behaviour ?

To me, this is an issue. The code in your example should just be copying `mpfr_t` values around.



---

archive/issue_comments_342304.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nAre you sure that `precision` means the same thing on both sides?",
    "created_at": "2018-01-23T15:07:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342304",
    "user": "https://github.com/videlec"
}
```

<div id="comment:4" align="right">comment:4</div>

Are you sure that `precision` means the same thing on both sides?



---

archive/issue_comments_342305.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nI think that the problem is that we just copy the values of real and imag part and both of them are `gmpy2.mpfr` with their own precision.\n\n```\nsage: x = gmpy2.mpc('1.324+4e50j', precision=(70,70))\nsage: x.precision\n(70, 70)\nsage: x.real.precision\n53\nsage: x.imag.precision\n53\nsage: x\nmpc('1.3240000000000000000005+3.9999999999999999999976e+50j',(70,70))\nsage: x.real, x.imag\n(mpfr('1.3240000000000001'), mpfr('4.0000000000000003e+50'))\n```\n\n`MPComplexField` works fine because it use mpc_set and not two mpfr_set.",
    "created_at": "2018-01-23T15:54:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342305",
    "user": "https://github.com/vinklein"
}
```

<div id="comment:5" align="right">comment:5</div>

I think that the problem is that we just copy the values of real and imag part and both of them are `gmpy2.mpfr` with their own precision.

```
sage: x = gmpy2.mpc('1.324+4e50j', precision=(70,70))
sage: x.precision
(70, 70)
sage: x.real.precision
53
sage: x.imag.precision
53
sage: x
mpc('1.3240000000000000000005+3.9999999999999999999976e+50j',(70,70))
sage: x.real, x.imag
(mpfr('1.3240000000000001'), mpfr('4.0000000000000003e+50'))
```

`MPComplexField` works fine because it use mpc_set and not two mpfr_set.



---

archive/issue_comments_342306.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nI don't know if it is a bug from `gmpy2` but having `x.real` to return a double precision and not the corresponding `gmpy2.mpfr` with the same precision as the real part is weird. Would be nice to see whether it is intended in `gmpy2`.\n\nFor this ticket you could just avoid using `.real` and `.imag` in the `ComplexNumber` code.",
    "created_at": "2018-01-23T15:59:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342306",
    "user": "https://github.com/videlec"
}
```

<div id="comment:6" align="right">comment:6</div>

I don't know if it is a bug from `gmpy2` but having `x.real` to return a double precision and not the corresponding `gmpy2.mpfr` with the same precision as the real part is weird. Would be nice to see whether it is intended in `gmpy2`.

For this ticket you could just avoid using `.real` and `.imag` in the `ComplexNumber` code.



---

archive/issue_comments_342307.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nSpecification are really cool!\n\n```\nimag\n    Returns the imaginary component.\nreal\n    Returns the real component.\n```\n(see https://github.com/aleaxit/gmpy/blob/master/docs/mpc.rst)",
    "created_at": "2018-01-23T16:01:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342307",
    "user": "https://github.com/videlec"
}
```

<div id="comment:7" align="right">comment:7</div>

Specification are really cool!

```
imag
    Returns the imaginary component.
real
    Returns the real component.
```
(see https://github.com/aleaxit/gmpy/blob/master/docs/mpc.rst)



---

archive/issue_comments_342308.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nYes very accurate !\n\nIt works fine without `.real` and `.imag`. Tests are running now.",
    "created_at": "2018-01-23T16:53:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342308",
    "user": "https://github.com/vinklein"
}
```

<div id="comment:8" align="right">comment:8</div>

Yes very accurate !

It works fine without `.real` and `.imag`. Tests are running now.



---

archive/issue_comments_342309.json:
```json
{
    "body": "Changed commit from **[`e9188ba`](https://github.com/sagemath/sagetrac-mirror/commit/e9188bae6e2e5407101d1ef46f3343b7250ae375)** to **[`5d044bf`](https://github.com/sagemath/sagetrac-mirror/commit/5d044bfb4c8ada79db6e8b0147a1f1120cf49a9d)**",
    "created_at": "2018-01-23T21:13:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342309",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`e9188ba`](https://github.com/sagemath/sagetrac-mirror/commit/e9188bae6e2e5407101d1ef46f3343b7250ae375)** to **[`5d044bf`](https://github.com/sagemath/sagetrac-mirror/commit/5d044bfb4c8ada79db6e8b0147a1f1120cf49a9d)**



---

archive/issue_comments_342310.json:
```json
{
    "body": "<div id=\"comment:9\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5d044bfb4c8ada79db6e8b0147a1f1120cf49a9d\"><code>5d044bf</code></a></td><td><code>Trac #22928: Add tests and fix a bug with precision</code></td></tr></table>\n",
    "created_at": "2018-01-23T21:13:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342310",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:9"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5d044bfb4c8ada79db6e8b0147a1f1120cf49a9d"><code>5d044bf</code></a></td><td><code>Trac #22928: Add tests and fix a bug with precision</code></td></tr></table>




---

archive/issue_events_316981.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2018-01-23T21:14:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22928#event-316981"
}
```



---

archive/issue_events_316982.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2018-01-23T21:14:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22928#event-316982"
}
```



---

archive/issue_comments_342311.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nDo you really need the cast `<mpc_t>`? This is already explicit in the `gmpy2` Cython header.",
    "created_at": "2018-01-24T08:04:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342311",
    "user": "https://github.com/videlec"
}
```

<div id="comment:1" align="right">comment:1</div>

Do you really need the cast `<mpc_t>`? This is already explicit in the `gmpy2` Cython header.



---

archive/issue_comments_342312.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nI think i do at least \n\n```\n mpfr_set(self.__im, (<gmpy2.mpc>real).c.im, rnd)\n                                                      ^\n------------------------------------------------------------\n\nsage/rings/complex_number.pyx:197:55: Cannot convert Python object to '__mpfr_struct *'\n```\n\nWhat syntax would you suggest ?",
    "created_at": "2018-01-24T08:16:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342312",
    "user": "https://github.com/vinklein"
}
```

<div id="comment:2" align="right">comment:2</div>

I think i do at least 

```
 mpfr_set(self.__im, (<gmpy2.mpc>real).c.im, rnd)
                                                      ^
------------------------------------------------------------

sage/rings/complex_number.pyx:197:55: Cannot convert Python object to '__mpfr_struct *'
```

What syntax would you suggest ?



---

archive/issue_comments_342313.json:
```json
{
    "body": "<div id=\"comment:123\" align=\"right\">comment:123</div>\n\nReplying to [@vinklein](#comment:122):\n> I think i do at least \n> \n> ```\n>  mpfr_set(self.__im, (<gmpy2.mpc>real).c.im, rnd)\n>                                                       ^\n> ------------------------------------------------------------\n> \n> sage/rings/complex_number.pyx:197:55: Cannot convert Python object to '__mpfr_struct *'\n> ```\n> \n> What syntax would you suggest ?\n\nThe one in your comment. There might be something wrong with the Cython headers. Maybe the following change in `gmpy2.pxd` might be enough \n\n```diff\ndiff --git a/src/gmpy2.pxd b/src/gmpy2.pxd\nindex 7cdcc72..d6cac1b 100644\n--- a/src/gmpy2.pxd\n+++ b/src/gmpy2.pxd\n@@ -45,7 +45,8 @@ cdef extern from \"mpfr.h\":\n cdef extern from \"mpc.h\":\n     # mpc complexes\n     ctypedef struct __mpc_struct:\n-        pass\n+        mpfr_t re\n+        mpfr_t im\n     ctypedef __mpc_struct mpc_t[1];\n     ctypedef __mpc_struct *mpc_ptr;\n     ctypedef const __mpc_struct *mpc_srcptr;\n```",
    "created_at": "2018-01-24T09:31:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342313",
    "user": "https://github.com/videlec"
}
```

<div id="comment:123" align="right">comment:123</div>

Replying to [@vinklein](#comment:122):
> I think i do at least 
> 
> ```
>  mpfr_set(self.__im, (<gmpy2.mpc>real).c.im, rnd)
>                                                       ^
> ------------------------------------------------------------
> 
> sage/rings/complex_number.pyx:197:55: Cannot convert Python object to '__mpfr_struct *'
> ```
> 
> What syntax would you suggest ?

The one in your comment. There might be something wrong with the Cython headers. Maybe the following change in `gmpy2.pxd` might be enough 

```diff
diff --git a/src/gmpy2.pxd b/src/gmpy2.pxd
index 7cdcc72..d6cac1b 100644
--- a/src/gmpy2.pxd
+++ b/src/gmpy2.pxd
@@ -45,7 +45,8 @@ cdef extern from "mpfr.h":
 cdef extern from "mpc.h":
     # mpc complexes
     ctypedef struct __mpc_struct:
-        pass
+        mpfr_t re
+        mpfr_t im
     ctypedef __mpc_struct mpc_t[1];
     ctypedef __mpc_struct *mpc_ptr;
     ctypedef const __mpc_struct *mpc_srcptr;
```



---

archive/issue_comments_342314.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nIt works with your solution. That being said i am not sure if avoiding a cast is worth patching `gmpy2`. \\\\\nI would rather keep the current syntax and do a proper pull request for `gmpy2`.",
    "created_at": "2018-01-24T09:57:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342314",
    "user": "https://github.com/vinklein"
}
```

<div id="comment:4" align="right">comment:4</div>

It works with your solution. That being said i am not sure if avoiding a cast is worth patching `gmpy2`. \\
I would rather keep the current syntax and do a proper pull request for `gmpy2`.



---

archive/issue_comments_342315.json:
```json
{
    "body": "<div id=\"comment:125\" align=\"right\">comment:125</div>\n\nReplying to [@vinklein](#comment:118):\n> Yes very accurate !\n> \n> It works fine without `.real` and `.imag`. Tests are running now.\n\nThis is also obviously an upstream bug.",
    "created_at": "2018-01-24T14:51:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342315",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:125" align="right">comment:125</div>

Replying to [@vinklein](#comment:118):
> Yes very accurate !
> 
> It works fine without `.real` and `.imag`. Tests are running now.

This is also obviously an upstream bug.



---

archive/issue_comments_342316.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nIn `complex_number.pyx` you are only using the `mpc_t` type, nothing else from MPC. So just use `from sage.libs.mpc.types cimport mpc_t`.",
    "created_at": "2018-01-24T15:19:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342316",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:6" align="right">comment:6</div>

In `complex_number.pyx` you are only using the `mpc_t` type, nothing else from MPC. So just use `from sage.libs.mpc.types cimport mpc_t`.



---

archive/issue_comments_342317.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nI think it would be good to at least *report* the bugs upstream to gmpy2.",
    "created_at": "2018-01-24T15:20:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342317",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:7" align="right">comment:7</div>

I think it would be good to at least *report* the bugs upstream to gmpy2.



---

archive/issue_events_316983.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-01-24T15:21:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22928#event-316983"
}
```



---

archive/issue_events_316984.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-01-24T15:21:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22928#event-316984"
}
```



---

archive/issue_comments_342318.json:
```json
{
    "body": "Reviewer: **Jeroen Demeyer**",
    "created_at": "2018-01-24T15:32:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342318",
    "user": "https://github.com/jdemeyer"
}
```

Reviewer: **Jeroen Demeyer**



---

archive/issue_comments_342319.json:
```json
{
    "body": "<div id=\"comment:130\" align=\"right\">comment:130</div>\n\nReplying to [@jdemeyer](#comment:127):\n> I think it would be good to at least *report* the bugs upstream to gmpy2.\n\nSure you're right. https://github.com/aleaxit/gmpy/issues/179",
    "created_at": "2018-01-24T18:48:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342319",
    "user": "https://github.com/vinklein"
}
```

<div id="comment:130" align="right">comment:130</div>

Replying to [@jdemeyer](#comment:127):
> I think it would be good to at least *report* the bugs upstream to gmpy2.

Sure you're right. https://github.com/aleaxit/gmpy/issues/179



---

archive/issue_comments_342320.json:
```json
{
    "body": "Changed commit from **[`5d044bf`](https://github.com/sagemath/sagetrac-mirror/commit/5d044bfb4c8ada79db6e8b0147a1f1120cf49a9d)** to **[`b6e2c05`](https://github.com/sagemath/sagetrac-mirror/commit/b6e2c05634879e77912848a89a45a145c1df526f)**",
    "created_at": "2018-01-24T18:56:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342320",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`5d044bf`](https://github.com/sagemath/sagetrac-mirror/commit/5d044bfb4c8ada79db6e8b0147a1f1120cf49a9d)** to **[`b6e2c05`](https://github.com/sagemath/sagetrac-mirror/commit/b6e2c05634879e77912848a89a45a145c1df526f)**



---

archive/issue_comments_342321.json:
```json
{
    "body": "<div id=\"comment:1\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b6e2c05634879e77912848a89a45a145c1df526f\"><code>b6e2c05</code></a></td><td><code>Trac #22928: replace cimport * by cimport mpc_t in</code></td></tr></table>\n",
    "created_at": "2018-01-24T18:56:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342321",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:1"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b6e2c05634879e77912848a89a45a145c1df526f"><code>b6e2c05</code></a></td><td><code>Trac #22928: replace cimport * by cimport mpc_t in</code></td></tr></table>




---

archive/issue_events_316985.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2018-01-24T18:59:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22928#event-316985"
}
```



---

archive/issue_events_316986.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2018-01-24T18:59:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22928#event-316986"
}
```



---

archive/issue_comments_342322.json:
```json
{
    "body": "<div id=\"comment:132\" align=\"right\">comment:132</div>\n\nReplying to [@jdemeyer](#comment:126):\n> In `complex_number.pyx` you are only using the `mpc_t` type, nothing else from MPC. So just use `from sage.libs.mpc.types cimport mpc_t`.\n\nDone",
    "created_at": "2018-01-24T18:59:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342322",
    "user": "https://github.com/vinklein"
}
```

<div id="comment:132" align="right">comment:132</div>

Replying to [@jdemeyer](#comment:126):
> In `complex_number.pyx` you are only using the `mpc_t` type, nothing else from MPC. So just use `from sage.libs.mpc.types cimport mpc_t`.

Done



---

archive/issue_events_316987.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-01-24T20:10:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22928#event-316987"
}
```



---

archive/issue_events_316988.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-01-24T20:10:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22928#event-316988"
}
```



---

archive/issue_comments_342323.json:
```json
{
    "body": "<div id=\"comment:133\" align=\"right\">comment:133</div>\n\nReplying to [@vinklein](#comment:132):\n> Replying to [@jdemeyer](#comment:126):\n> > In `complex_number.pyx` you are only using the `mpc_t` type, nothing else from MPC. So just use `from sage.libs.mpc.types cimport mpc_t`.\n\n> \n> Done\n\nNo. I wrote `from sage.libs.mpc.types cimport mpc_t` and I meant exactly what I wrote.",
    "created_at": "2018-01-24T20:10:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342323",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:133" align="right">comment:133</div>

Replying to [@vinklein](#comment:132):
> Replying to [@jdemeyer](#comment:126):
> > In `complex_number.pyx` you are only using the `mpc_t` type, nothing else from MPC. So just use `from sage.libs.mpc.types cimport mpc_t`.

> 
> Done

No. I wrote `from sage.libs.mpc.types cimport mpc_t` and I meant exactly what I wrote.



---

archive/issue_comments_342324.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nDoctests crash at runtime with the later syntax. \n\n```\nsage -t --long src/sage/rings/complex_number.pyx\nTraceback (most recent call last):\n  File \"/home/vklein/odk/sage/src/bin/sage-runtests\", line 123, in <module>\n    from sage.doctest.control import DocTestController\n  File \"/home/vklein/odk/sage/local/lib/python2.7/site-packages/sage/doctest/control.py\", line 33, in <module>\n    from .sources import FileDocTestSource, DictAsObject\n  File \"/home/vklein/odk/sage/local/lib/python2.7/site-packages/sage/doctest/sources.py\", line 32, in <module>\n    from .parsing import SageDocTestParser\n  File \"/home/vklein/odk/sage/local/lib/python2.7/site-packages/sage/doctest/parsing.py\", line 57, in <module>\n    from sage.all import RealIntervalField\n  File \"/home/vklein/odk/sage/local/lib/python2.7/site-packages/sage/all.py\", line 87, in <module>\n    from sage.misc.all       import *         # takes a while\n  File \"/home/vklein/odk/sage/local/lib/python2.7/site-packages/sage/misc/all.py\", line 84, in <module>\n    from .functional import (additive_order,\n  File \"/home/vklein/odk/sage/local/lib/python2.7/site-packages/sage/misc/functional.py\", line 27, in <module>\n    from sage.rings.complex_double import CDF\n  File \"sage/rings/integer.pxd\", line 7, in init sage.rings.complex_double\n  File \"sage/rings/rational.pxd\", line 8, in init sage.rings.integer\n  File \"sage/rings/rational.pyx\", line 94, in init sage.rings.rational\n  File \"sage/rings/real_mpfr.pyx\", line 1, in init sage.rings.real_mpfr\n  File \"sage/rings/complex_number.pxd\", line 6, in init sage.libs.mpmath.utils\nImportError: /home/vklein/odk/sage/local/lib/python2.7/site-packages/sage/rings/complex_number.so: undefined symbol: mpc_set_fr_fr\n```",
    "created_at": "2018-01-24T22:12:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342324",
    "user": "https://github.com/vinklein"
}
```

<div id="comment:4" align="right">comment:4</div>

Doctests crash at runtime with the later syntax. 

```
sage -t --long src/sage/rings/complex_number.pyx
Traceback (most recent call last):
  File "/home/vklein/odk/sage/src/bin/sage-runtests", line 123, in <module>
    from sage.doctest.control import DocTestController
  File "/home/vklein/odk/sage/local/lib/python2.7/site-packages/sage/doctest/control.py", line 33, in <module>
    from .sources import FileDocTestSource, DictAsObject
  File "/home/vklein/odk/sage/local/lib/python2.7/site-packages/sage/doctest/sources.py", line 32, in <module>
    from .parsing import SageDocTestParser
  File "/home/vklein/odk/sage/local/lib/python2.7/site-packages/sage/doctest/parsing.py", line 57, in <module>
    from sage.all import RealIntervalField
  File "/home/vklein/odk/sage/local/lib/python2.7/site-packages/sage/all.py", line 87, in <module>
    from sage.misc.all       import *         # takes a while
  File "/home/vklein/odk/sage/local/lib/python2.7/site-packages/sage/misc/all.py", line 84, in <module>
    from .functional import (additive_order,
  File "/home/vklein/odk/sage/local/lib/python2.7/site-packages/sage/misc/functional.py", line 27, in <module>
    from sage.rings.complex_double import CDF
  File "sage/rings/integer.pxd", line 7, in init sage.rings.complex_double
  File "sage/rings/rational.pxd", line 8, in init sage.rings.integer
  File "sage/rings/rational.pyx", line 94, in init sage.rings.rational
  File "sage/rings/real_mpfr.pyx", line 1, in init sage.rings.real_mpfr
  File "sage/rings/complex_number.pxd", line 6, in init sage.libs.mpmath.utils
ImportError: /home/vklein/odk/sage/local/lib/python2.7/site-packages/sage/rings/complex_number.so: undefined symbol: mpc_set_fr_fr
```



---

archive/issue_comments_342325.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nIndeed, `mpc/types.pxd` does not contain the distutils directive for libraries. Since `types.pxd` is included in all other files in `mpc/` it makes more sense to have the directive in this file rather than in `__init__.pxd`.",
    "created_at": "2018-01-25T07:11:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342325",
    "user": "https://github.com/videlec"
}
```

<div id="comment:5" align="right">comment:5</div>

Indeed, `mpc/types.pxd` does not contain the distutils directive for libraries. Since `types.pxd` is included in all other files in `mpc/` it makes more sense to have the directive in this file rather than in `__init__.pxd`.



---

archive/issue_comments_342326.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nBut who is calling `mpc_set_fr_fr` in that file?",
    "created_at": "2018-01-25T08:45:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342326",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:6" align="right">comment:6</div>

But who is calling `mpc_set_fr_fr` in that file?



---

archive/issue_comments_342327.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nI see. The `gmpy2` function `GMPy_MPC_From_mpfr` requires MPC.",
    "created_at": "2018-01-25T08:52:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342327",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:7" align="right">comment:7</div>

I see. The `gmpy2` function `GMPy_MPC_From_mpfr` requires MPC.



---

archive/issue_comments_342328.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nShould we add a distutils directive to the `gmpy2.pxd` header?",
    "created_at": "2018-01-25T09:07:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342328",
    "user": "https://github.com/videlec"
}
```

<div id="comment:8" align="right">comment:8</div>

Should we add a distutils directive to the `gmpy2.pxd` header?



---

archive/issue_comments_342329.json:
```json
{
    "body": "<div id=\"comment:139\" align=\"right\">comment:139</div>\n\nReplying to [@videlec](#comment:138):\n> Should we add a distutils directive to the `gmpy2.pxd` header?\n\nNo because not everybody using that header will need every library. It seems overkill to require gmp and mpfr and mpc if you only ever use the `mpz_t` type.\n\nI was thinking about something else: it is trivial to replace `mpc_set_fr_fr` by two `mpfr_set` calls. So maybe we could just do that. I'll try to create a PR for gmpy2.",
    "created_at": "2018-01-25T09:10:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342329",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:139" align="right">comment:139</div>

Replying to [@videlec](#comment:138):
> Should we add a distutils directive to the `gmpy2.pxd` header?

No because not everybody using that header will need every library. It seems overkill to require gmp and mpfr and mpc if you only ever use the `mpz_t` type.

I was thinking about something else: it is trivial to replace `mpc_set_fr_fr` by two `mpfr_set` calls. So maybe we could just do that. I'll try to create a PR for gmpy2.



---

archive/issue_comments_342330.json:
```json
{
    "body": "<div id=\"comment:140\" align=\"right\">comment:140</div>\n\nReplying to [@jdemeyer](#comment:139):\n> Replying to [@videlec](#comment:138):\n> > Should we add a distutils directive to the `gmpy2.pxd` header?\n\n> \n> No because not everybody using that header will need every library. It seems overkill to require gmp and mpfr and mpc if you only ever use the `mpz_t` type.\n> \n> I was thinking about something else: it is trivial to replace `mpc_set_fr_fr` by two `mpfr_set` calls. So maybe we could just do that. I'll try to create a PR for gmpy2.\n\nUsing `mpc_set_fr_fr` would impose to link against mpfr. A cleaner possibility is to split the `gmpy2` headers into 3 headers `gmpy2.gmp`, `gmpy2.mpfr` and `gmpy2.mpc`. Each of them with a proper distutils directive.",
    "created_at": "2018-01-25T09:29:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342330",
    "user": "https://github.com/videlec"
}
```

<div id="comment:140" align="right">comment:140</div>

Replying to [@jdemeyer](#comment:139):
> Replying to [@videlec](#comment:138):
> > Should we add a distutils directive to the `gmpy2.pxd` header?

> 
> No because not everybody using that header will need every library. It seems overkill to require gmp and mpfr and mpc if you only ever use the `mpz_t` type.
> 
> I was thinking about something else: it is trivial to replace `mpc_set_fr_fr` by two `mpfr_set` calls. So maybe we could just do that. I'll try to create a PR for gmpy2.

Using `mpc_set_fr_fr` would impose to link against mpfr. A cleaner possibility is to split the `gmpy2` headers into 3 headers `gmpy2.gmp`, `gmpy2.mpfr` and `gmpy2.mpc`. Each of them with a proper distutils directive.



---

archive/issue_comments_342331.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -10,3 +10,7 @@\n    - `ComplexNumber` (`sage.rings.complex_number`)\n \n Conversly, we make Sage integer, rational, real and complex constructors accept gmpy2 arguments.\n+\n+Upstream issues:\n+- https://github.com/aleaxit/gmpy/pull/179\n+- https://github.com/aleaxit/gmpy/pull/180\n``````\n",
    "created_at": "2018-01-25T09:34:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342331",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -10,3 +10,7 @@
    - `ComplexNumber` (`sage.rings.complex_number`)
 
 Conversly, we make Sage integer, rational, real and complex constructors accept gmpy2 arguments.
+
+Upstream issues:
+- https://github.com/aleaxit/gmpy/pull/179
+- https://github.com/aleaxit/gmpy/pull/180
``````




---

archive/issue_comments_342332.json:
```json
{
    "body": "<div id=\"comment:142\" align=\"right\">comment:142</div>\n\nReplying to [@videlec](#comment:140):\n> Using `mpc_set_fr_fr` would impose to link against mpfr.\n\nI guess you mean \"using `mpfr_set` would impose to link against mpfr\".\n\nBut that is in fact a very logical requirement, since the input type of `GMPy_MPC_From_mpfr` is `mpfr_t`. So you already need to have an `mpfr_t` in order to use that function, which makes it likely that you are using MPFR already.",
    "created_at": "2018-01-25T09:38:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342332",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:142" align="right">comment:142</div>

Replying to [@videlec](#comment:140):
> Using `mpc_set_fr_fr` would impose to link against mpfr.

I guess you mean "using `mpfr_set` would impose to link against mpfr".

But that is in fact a very logical requirement, since the input type of `GMPy_MPC_From_mpfr` is `mpfr_t`. So you already need to have an `mpfr_t` in order to use that function, which makes it likely that you are using MPFR already.



---

archive/issue_comments_342333.json:
```json
{
    "body": "<div id=\"comment:143\" align=\"right\">comment:143</div>\n\nReplying to [@jdemeyer](#comment:142):\n> Replying to [@videlec](#comment:140):\n> > Using `mpc_set_fr_fr` would impose to link against mpfr.\n\n> \n> I guess you mean \"using `mpfr_set` would impose to link against mpfr\".\n> \n> But that is in fact a very logical requirement, since the input type of `GMPy_MPC_From_mpfr` is `mpfr_t`. So you already need to have an `mpfr_t` in order to use that function, which makes it likely that you are using MPFR already.\n\nAnd using a `mpc` from `gmpy2` does not imply that you are using `mpc`!?",
    "created_at": "2018-01-25T09:41:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342333",
    "user": "https://github.com/videlec"
}
```

<div id="comment:143" align="right">comment:143</div>

Replying to [@jdemeyer](#comment:142):
> Replying to [@videlec](#comment:140):
> > Using `mpc_set_fr_fr` would impose to link against mpfr.

> 
> I guess you mean "using `mpfr_set` would impose to link against mpfr".
> 
> But that is in fact a very logical requirement, since the input type of `GMPy_MPC_From_mpfr` is `mpfr_t`. So you already need to have an `mpfr_t` in order to use that function, which makes it likely that you are using MPFR already.

And using a `mpc` from `gmpy2` does not imply that you are using `mpc`!?



---

archive/issue_comments_342334.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nWill it be so inconsistent to just stick with `from sage.libs.mpc cimport *` for this ticket? \\\\\nI don't see clearly how much impact it has on memory/performance.",
    "created_at": "2018-01-25T10:01:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342334",
    "user": "https://github.com/vinklein"
}
```

<div id="comment:4" align="right">comment:4</div>

Will it be so inconsistent to just stick with `from sage.libs.mpc cimport *` for this ticket? \\
I don't see clearly how much impact it has on memory/performance.



---

archive/issue_comments_342335.json:
```json
{
    "body": "<div id=\"comment:145\" align=\"right\">comment:145</div>\n\nReplying to [@videlec](#comment:143):\n> And using a `mpc` from `gmpy2` does not imply that you are using `mpc`!?\n\nSure, but in an indirect way, through the `gmpy2` package. My point is that you shouldn't require the MPC library in the Cython module which creates a `gmpy2.mpc` object.",
    "created_at": "2018-01-25T10:02:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342335",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:145" align="right">comment:145</div>

Replying to [@videlec](#comment:143):
> And using a `mpc` from `gmpy2` does not imply that you are using `mpc`!?

Sure, but in an indirect way, through the `gmpy2` package. My point is that you shouldn't require the MPC library in the Cython module which creates a `gmpy2.mpc` object.



---

archive/issue_comments_342336.json:
```json
{
    "body": "<div id=\"comment:146\" align=\"right\">comment:146</div>\n\nReplying to [@vinklein](#comment:144):\n> Will it be so inconsistent to just stick with `from sage.libs.mpc cimport *` for this ticket? \\\\\n> I don't see clearly how much impact it has on memory/performance.\n\nI agree... we can still fix this later. I'd like to wait a little bit for an answer from upstream though.",
    "created_at": "2018-01-25T10:03:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342336",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:146" align="right">comment:146</div>

Replying to [@vinklein](#comment:144):
> Will it be so inconsistent to just stick with `from sage.libs.mpc cimport *` for this ticket? \\
> I don't see clearly how much impact it has on memory/performance.

I agree... we can still fix this later. I'd like to wait a little bit for an answer from upstream though.



---

archive/issue_comments_342337.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nWith my patch to gmpy2, the following works:\n\n```diff\ndiff --git a/src/sage/rings/complex_number.pyx b/src/sage/rings/complex_number.pyx\nindex bf0e4a3..76782c3 100644\n--- a/src/sage/rings/complex_number.pyx\n+++ b/src/sage/rings/complex_number.pyx\n@@ -31,7 +31,7 @@ from __future__ import absolute_import, print_function\n import math\n import operator\n \n-from sage.libs.mpc cimport mpc_t\n+from sage.libs.mpc.types cimport mpc_t\n from sage.libs.mpfr cimport *\n from sage.structure.element cimport FieldElement, RingElement, Element, ModuleElement\n from sage.categories.map cimport Map\n@@ -193,8 +193,8 @@ cdef class ComplexNumber(sage.structure.element.FieldElement):\n             elif isinstance(real, complex):\n                 real, imag = real.real, real.imag\n             elif HAVE_GMPY2 and type(real) is gmpy2.mpc:\n-                mpfr_set(self.__re, (<mpc_t>(<gmpy2.mpc>real).c).re, rnd)\n-                mpfr_set(self.__im, (<mpc_t>(<gmpy2.mpc>real).c).im, rnd)\n+                mpfr_set(self.__re, (<gmpy2.mpc>real).c.re, rnd)\n+                mpfr_set(self.__im, (<gmpy2.mpc>real).c.im, rnd)\n                 return\n             else:\n                 imag = 0\n```",
    "created_at": "2018-01-25T10:04:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342337",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:7" align="right">comment:7</div>

With my patch to gmpy2, the following works:

```diff
diff --git a/src/sage/rings/complex_number.pyx b/src/sage/rings/complex_number.pyx
index bf0e4a3..76782c3 100644
--- a/src/sage/rings/complex_number.pyx
+++ b/src/sage/rings/complex_number.pyx
@@ -31,7 +31,7 @@ from __future__ import absolute_import, print_function
 import math
 import operator
 
-from sage.libs.mpc cimport mpc_t
+from sage.libs.mpc.types cimport mpc_t
 from sage.libs.mpfr cimport *
 from sage.structure.element cimport FieldElement, RingElement, Element, ModuleElement
 from sage.categories.map cimport Map
@@ -193,8 +193,8 @@ cdef class ComplexNumber(sage.structure.element.FieldElement):
             elif isinstance(real, complex):
                 real, imag = real.real, real.imag
             elif HAVE_GMPY2 and type(real) is gmpy2.mpc:
-                mpfr_set(self.__re, (<mpc_t>(<gmpy2.mpc>real).c).re, rnd)
-                mpfr_set(self.__im, (<mpc_t>(<gmpy2.mpc>real).c).im, rnd)
+                mpfr_set(self.__re, (<gmpy2.mpc>real).c.re, rnd)
+                mpfr_set(self.__im, (<gmpy2.mpc>real).c.im, rnd)
                 return
             else:
                 imag = 0
```



---

archive/issue_comments_342338.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nAnd i have fixed issue \u200b[gmpy2 issue #179](https://github.com/aleaxit/gmpy/pull/179) with this PR\nhttps://github.com/aleaxit/gmpy/pull/181.\n\nWhat should we do next ? :\n- Waiting for a gmpy2 release.\n- Doing sage patchs for gmpy2 (maybe after `gmpy2` PR's are reviewed and merged).\n- Or switch this ticket in need_review as it is.",
    "created_at": "2018-01-25T15:12:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342338",
    "user": "https://github.com/vinklein"
}
```

<div id="comment:8" align="right">comment:8</div>

And i have fixed issue [gmpy2 issue #179](https://github.com/aleaxit/gmpy/pull/179) with this PR
https://github.com/aleaxit/gmpy/pull/181.

What should we do next ? :
- Waiting for a gmpy2 release.
- Doing sage patchs for gmpy2 (maybe after `gmpy2` PR's are reviewed and merged).
- Or switch this ticket in need_review as it is.



---

archive/issue_comments_342339.json:
```json
{
    "body": "<div id=\"comment:149\" align=\"right\">comment:149</div>\n\nReplying to [@vinklein](#comment:148):\n> And i have fixed issue \u200b[gmpy2 issue #179](https://github.com/aleaxit/gmpy/pull/179) with this PR\n> https://github.com/aleaxit/gmpy/pull/181.\n> \n> What should we do next ? :\n> - Waiting for a gmpy2 release.\n> - Doing sage patchs for gmpy2 (maybe after `gmpy2` PR's are reviewed and merged).\n> - Or switch this ticket in need_review as it is.\n\nI would say\n- create a patch and add it to gmpy2\n- move the ticket in needs review\n- wait for the PR to be accepted before setting it to positive review\nThe rationale is that we are currently testing gmpy2 integration. At the time it stabilizes, we should ask for a new release and remove all of Sage patches.",
    "created_at": "2018-01-25T15:54:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342339",
    "user": "https://github.com/videlec"
}
```

<div id="comment:149" align="right">comment:149</div>

Replying to [@vinklein](#comment:148):
> And i have fixed issue [gmpy2 issue #179](https://github.com/aleaxit/gmpy/pull/179) with this PR
> https://github.com/aleaxit/gmpy/pull/181.
> 
> What should we do next ? :
> - Waiting for a gmpy2 release.
> - Doing sage patchs for gmpy2 (maybe after `gmpy2` PR's are reviewed and merged).
> - Or switch this ticket in need_review as it is.

I would say
- create a patch and add it to gmpy2
- move the ticket in needs review
- wait for the PR to be accepted before setting it to positive review
The rationale is that we are currently testing gmpy2 integration. At the time it stabilizes, we should ask for a new release and remove all of Sage patches.



---

archive/issue_comments_342340.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -12,5 +12,5 @@\n Conversly, we make Sage integer, rational, real and complex constructors accept gmpy2 arguments.\n \n Upstream issues:\n-- https://github.com/aleaxit/gmpy/pull/179\n - https://github.com/aleaxit/gmpy/pull/180\n+- https://github.com/aleaxit/gmpy/pull/181\n``````\n",
    "created_at": "2018-01-25T16:03:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342340",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -12,5 +12,5 @@
 Conversly, we make Sage integer, rational, real and complex constructors accept gmpy2 arguments.
 
 Upstream issues:
-- https://github.com/aleaxit/gmpy/pull/179
 - https://github.com/aleaxit/gmpy/pull/180
+- https://github.com/aleaxit/gmpy/pull/181
``````




---

archive/issue_comments_342341.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nFine for me!",
    "created_at": "2018-01-25T16:03:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342341",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:1" align="right">comment:1</div>

Fine for me!



---

archive/issue_comments_342342.json:
```json
{
    "body": "<div id=\"comment:2\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1c5685f5f11c87b28ec3ad9e76d2e3ae54eef4df\"><code>1c5685f</code></a></td><td><code>Trac #22928: Patchs gmpy2 and update complex_number</code></td></tr></table>\n",
    "created_at": "2018-01-26T10:31:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342342",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:2"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1c5685f5f11c87b28ec3ad9e76d2e3ae54eef4df"><code>1c5685f</code></a></td><td><code>Trac #22928: Patchs gmpy2 and update complex_number</code></td></tr></table>




---

archive/issue_comments_342343.json:
```json
{
    "body": "Changed commit from **[`b6e2c05`](https://github.com/sagemath/sagetrac-mirror/commit/b6e2c05634879e77912848a89a45a145c1df526f)** to **[`1c5685f`](https://github.com/sagemath/sagetrac-mirror/commit/1c5685f5f11c87b28ec3ad9e76d2e3ae54eef4df)**",
    "created_at": "2018-01-26T10:31:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342343",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`b6e2c05`](https://github.com/sagemath/sagetrac-mirror/commit/b6e2c05634879e77912848a89a45a145c1df526f)** to **[`1c5685f`](https://github.com/sagemath/sagetrac-mirror/commit/1c5685f5f11c87b28ec3ad9e76d2e3ae54eef4df)**



---

archive/issue_comments_342344.json:
```json
{
    "body": "Changed commit from **[`1c5685f`](https://github.com/sagemath/sagetrac-mirror/commit/1c5685f5f11c87b28ec3ad9e76d2e3ae54eef4df)** to **[`dcc7e95`](https://github.com/sagemath/sagetrac-mirror/commit/dcc7e9567a7df1f37aa795bb7f58ba184985745c)**",
    "created_at": "2018-01-26T10:44:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342344",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`1c5685f`](https://github.com/sagemath/sagetrac-mirror/commit/1c5685f5f11c87b28ec3ad9e76d2e3ae54eef4df)** to **[`dcc7e95`](https://github.com/sagemath/sagetrac-mirror/commit/dcc7e9567a7df1f37aa795bb7f58ba184985745c)**



---

archive/issue_comments_342345.json:
```json
{
    "body": "<div id=\"comment:3\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dcc7e9567a7df1f37aa795bb7f58ba184985745c\"><code>dcc7e95</code></a></td><td><code>Trac #22928: Patchs gmpy2 and update complex_number</code></td></tr></table>\n",
    "created_at": "2018-01-26T10:44:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342345",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:3"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dcc7e9567a7df1f37aa795bb7f58ba184985745c"><code>dcc7e95</code></a></td><td><code>Trac #22928: Patchs gmpy2 and update complex_number</code></td></tr></table>




---

archive/issue_events_316989.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2018-01-26T10:48:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22928#event-316989"
}
```



---

archive/issue_events_316990.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2018-01-26T10:48:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22928#event-316990"
}
```



---

archive/issue_comments_342346.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nPatch are done. The corresponding PRs are merged.",
    "created_at": "2018-01-26T10:48:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342346",
    "user": "https://github.com/vinklein"
}
```

<div id="comment:4" align="right">comment:4</div>

Patch are done. The corresponding PRs are merged.



---

archive/issue_events_316991.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-01-26T10:52:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22928#event-316991"
}
```



---

archive/issue_events_316992.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-01-26T10:52:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22928#event-316992"
}
```



---

archive/issue_comments_342347.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nYou need to bump the `gmpy2` version number for the patches to apply.",
    "created_at": "2018-01-26T10:52:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342347",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:5" align="right">comment:5</div>

You need to bump the `gmpy2` version number for the patches to apply.



---

archive/issue_comments_342348.json:
```json
{
    "body": "Changed commit from **[`dcc7e95`](https://github.com/sagemath/sagetrac-mirror/commit/dcc7e9567a7df1f37aa795bb7f58ba184985745c)** to **[`e3a3bf4`](https://github.com/sagemath/sagetrac-mirror/commit/e3a3bf49b965b6f81814efe36d9b0bbe49a43156)**",
    "created_at": "2018-01-26T10:58:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342348",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`dcc7e95`](https://github.com/sagemath/sagetrac-mirror/commit/dcc7e9567a7df1f37aa795bb7f58ba184985745c)** to **[`e3a3bf4`](https://github.com/sagemath/sagetrac-mirror/commit/e3a3bf49b965b6f81814efe36d9b0bbe49a43156)**



---

archive/issue_comments_342349.json:
```json
{
    "body": "<div id=\"comment:6\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e3a3bf49b965b6f81814efe36d9b0bbe49a43156\"><code>e3a3bf4</code></a></td><td><code>Trac #22928 : update version patch p0 to p1</code></td></tr></table>\n",
    "created_at": "2018-01-26T10:58:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342349",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:6"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e3a3bf49b965b6f81814efe36d9b0bbe49a43156"><code>e3a3bf4</code></a></td><td><code>Trac #22928 : update version patch p0 to p1</code></td></tr></table>




---

archive/issue_events_316993.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2018-01-26T10:59:04Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22928#event-316993"
}
```



---

archive/issue_events_316994.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2018-01-26T10:59:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22928#event-316994"
}
```



---

archive/issue_comments_342350.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nI see, thanks.",
    "created_at": "2018-01-26T10:59:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342350",
    "user": "https://github.com/vinklein"
}
```

<div id="comment:7" align="right">comment:7</div>

I see, thanks.



---

archive/issue_comments_342351.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nThe following line misses a `# optional - gmpy2`\n\n```\n            sage: x = mpfr(R.pi())\n```",
    "created_at": "2018-01-26T13:26:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342351",
    "user": "https://github.com/videlec"
}
```

<div id="comment:8" align="right">comment:8</div>

The following line misses a `# optional - gmpy2`

```
            sage: x = mpfr(R.pi())
```



---

archive/issue_comments_342352.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nYeah and two others after this one \n\n```\nsage: y = RealField(128)(x) \nsage: mpfr(y) == x\n```\n\nI will rerun tests without gmpy2 package installed",
    "created_at": "2018-01-26T13:32:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342352",
    "user": "https://github.com/vinklein"
}
```

<div id="comment:9" align="right">comment:9</div>

Yeah and two others after this one 

```
sage: y = RealField(128)(x) 
sage: mpfr(y) == x
```

I will rerun tests without gmpy2 package installed



---

archive/issue_events_316995.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2018-01-26T13:33:17Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22928#event-316995"
}
```



---

archive/issue_events_316996.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2018-01-26T13:33:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22928#event-316996"
}
```



---

archive/issue_comments_342353.json:
```json
{
    "body": "Changed commit from **[`e3a3bf4`](https://github.com/sagemath/sagetrac-mirror/commit/e3a3bf49b965b6f81814efe36d9b0bbe49a43156)** to **[`e9a6fda`](https://github.com/sagemath/sagetrac-mirror/commit/e9a6fdaf5e130e826929c4d9a6617a2128afe3d0)**",
    "created_at": "2018-01-26T16:16:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342353",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`e3a3bf4`](https://github.com/sagemath/sagetrac-mirror/commit/e3a3bf49b965b6f81814efe36d9b0bbe49a43156)** to **[`e9a6fda`](https://github.com/sagemath/sagetrac-mirror/commit/e9a6fdaf5e130e826929c4d9a6617a2128afe3d0)**



---

archive/issue_comments_342354.json:
```json
{
    "body": "<div id=\"comment:1\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e9a6fdaf5e130e826929c4d9a6617a2128afe3d0\"><code>e9a6fda</code></a></td><td><code>Trac #22928 : add some missings # optional - gmpy2</code></td></tr></table>\n",
    "created_at": "2018-01-26T16:16:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342354",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:1"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e9a6fdaf5e130e826929c4d9a6617a2128afe3d0"><code>e9a6fda</code></a></td><td><code>Trac #22928 : add some missings # optional - gmpy2</code></td></tr></table>




---

archive/issue_comments_342355.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nAll test without gmpy2 passed, tests with gmpy2 are runnings.",
    "created_at": "2018-01-26T16:20:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342355",
    "user": "https://github.com/vinklein"
}
```

<div id="comment:2" align="right">comment:2</div>

All test without gmpy2 passed, tests with gmpy2 are runnings.



---

archive/issue_comments_342356.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nneeds review? The branch is fine for me in the current state.",
    "created_at": "2018-01-26T16:31:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342356",
    "user": "https://github.com/videlec"
}
```

<div id="comment:3" align="right">comment:3</div>

needs review? The branch is fine for me in the current state.



---

archive/issue_comments_342357.json:
```json
{
    "body": "Changed reviewer from **Jeroen Demeyer** to **Jeroen Demeyer, Vincent Delecroix**",
    "created_at": "2018-01-26T16:31:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342357",
    "user": "https://github.com/videlec"
}
```

Changed reviewer from **Jeroen Demeyer** to **Jeroen Demeyer, Vincent Delecroix**



---

archive/issue_events_316997.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2018-01-26T16:33:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22928#event-316997"
}
```



---

archive/issue_events_316998.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2018-01-26T16:33:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22928#event-316998"
}
```



---

archive/issue_comments_342358.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nOkay then.",
    "created_at": "2018-01-26T16:33:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342358",
    "user": "https://github.com/vinklein"
}
```

<div id="comment:4" align="right">comment:4</div>

Okay then.



---

archive/issue_comments_342359.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nIn `real_double.pyx` you call `cimport gmpy2` but does not do `gmpy2.import_gmpy2()`.",
    "created_at": "2018-01-26T16:37:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342359",
    "user": "https://github.com/videlec"
}
```

<div id="comment:5" align="right">comment:5</div>

In `real_double.pyx` you call `cimport gmpy2` but does not do `gmpy2.import_gmpy2()`.



---

archive/issue_comments_342360.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nYes but `real_double.pyx` do `cimport sage.ring.integer` and the later call `gmpy2.import_gmpy2()`.",
    "created_at": "2018-01-26T20:40:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342360",
    "user": "https://github.com/vinklein"
}
```

<div id="comment:6" align="right">comment:6</div>

Yes but `real_double.pyx` do `cimport sage.ring.integer` and the later call `gmpy2.import_gmpy2()`.



---

archive/issue_comments_342361.json:
```json
{
    "body": "<div id=\"comment:167\" align=\"right\">comment:167</div>\n\nReplying to [@vinklein](#comment:166):\n> Yes but `real_double.pyx` do `cimport sage.ring.integer` and the later call `gmpy2.import_gmpy2()`. \n\nThis sentence makes me sad and worried at the same time. It shows that you absolutely do not understand what `import_gmpy2()` does.\n\nThe *real reason* that you don't need `import_gmpy2()` in that file is that you are simply not calling any gmpy2 functions in that Cython module.",
    "created_at": "2018-01-27T08:05:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342361",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:167" align="right">comment:167</div>

Replying to [@vinklein](#comment:166):
> Yes but `real_double.pyx` do `cimport sage.ring.integer` and the later call `gmpy2.import_gmpy2()`. 

This sentence makes me sad and worried at the same time. It shows that you absolutely do not understand what `import_gmpy2()` does.

The *real reason* that you don't need `import_gmpy2()` in that file is that you are simply not calling any gmpy2 functions in that Cython module.



---

archive/issue_comments_342362.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nIs it ok Jeroen?",
    "created_at": "2018-01-30T14:25:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342362",
    "user": "https://github.com/videlec"
}
```

<div id="comment:8" align="right">comment:8</div>

Is it ok Jeroen?



---

archive/issue_events_316999.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-01-30T14:30:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22928#event-316999"
}
```



---

archive/issue_events_317000.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-01-30T14:30:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22928#event-317000"
}
```



---

archive/issue_events_317001.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-02-02T12:06:15Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22928#event-317001"
}
```



---

archive/issue_events_317002.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "36849d6c3eb40900bc5ce8e256f69e4c81c8ec78",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2018-02-02T12:06:15Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22928#event-317002"
}
```



---

archive/issue_comments_342363.json:
```json
{
    "body": "Changed branch from **[u/vklein/conversion_between_gmpy2_and_sage_integers](https://github.com/sagemath/sagetrac-mirror/tree/u/vklein/conversion_between_gmpy2_and_sage_integers)** to **[`e9a6fda`](https://github.com/sagemath/sagetrac-mirror/commit/e9a6fdaf5e130e826929c4d9a6617a2128afe3d0)**",
    "created_at": "2018-02-02T12:06:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342363",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/vklein/conversion_between_gmpy2_and_sage_integers](https://github.com/sagemath/sagetrac-mirror/tree/u/vklein/conversion_between_gmpy2_and_sage_integers)** to **[`e9a6fda`](https://github.com/sagemath/sagetrac-mirror/commit/e9a6fdaf5e130e826929c4d9a6617a2128afe3d0)**



---

archive/issue_comments_342364.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nA small remark to say that some warnings associated to gmpy2 appear at each run of `sage -b` (without gmpy2):\n\n```\n[sagelib-8.2.rc3] sage/rings/complex_double.pyx: cannot find cimported module 'gmpy2'\n[sagelib-8.2.rc3] sage/rings/complex_number.pyx: cannot find cimported module 'gmpy2'\n[sagelib-8.2.rc3] sage/rings/integer.pyx: cannot find cimported module 'gmpy2'\n[sagelib-8.2.rc3] sage/rings/complex_mpc.pyx: cannot find cimported module 'gmpy2'\n[sagelib-8.2.rc3] sage/rings/rational.pyx: cannot find cimported module 'gmpy2'\n[sagelib-8.2.rc3] sage/rings/real_double.pyx: cannot find cimported module 'gmpy2'\n[sagelib-8.2.rc3] sage/rings/real_mpfr.pyx: cannot find cimported module 'gmpy2'\n```\n\nIs it possible to clean this?",
    "created_at": "2018-05-01T09:05:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342364",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:1" align="right">comment:1</div>

A small remark to say that some warnings associated to gmpy2 appear at each run of `sage -b` (without gmpy2):

```
[sagelib-8.2.rc3] sage/rings/complex_double.pyx: cannot find cimported module 'gmpy2'
[sagelib-8.2.rc3] sage/rings/complex_number.pyx: cannot find cimported module 'gmpy2'
[sagelib-8.2.rc3] sage/rings/integer.pyx: cannot find cimported module 'gmpy2'
[sagelib-8.2.rc3] sage/rings/complex_mpc.pyx: cannot find cimported module 'gmpy2'
[sagelib-8.2.rc3] sage/rings/rational.pyx: cannot find cimported module 'gmpy2'
[sagelib-8.2.rc3] sage/rings/real_double.pyx: cannot find cimported module 'gmpy2'
[sagelib-8.2.rc3] sage/rings/real_mpfr.pyx: cannot find cimported module 'gmpy2'
```

Is it possible to clean this?



---

archive/issue_comments_342365.json:
```json
{
    "body": "Changed commit from **[`e9a6fda`](https://github.com/sagemath/sagetrac-mirror/commit/e9a6fdaf5e130e826929c4d9a6617a2128afe3d0)** to none",
    "created_at": "2018-05-01T09:05:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342365",
    "user": "https://github.com/seblabbe"
}
```

Changed commit from **[`e9a6fda`](https://github.com/sagemath/sagetrac-mirror/commit/e9a6fdaf5e130e826929c4d9a6617a2128afe3d0)** to none



---

archive/issue_comments_342366.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nAccording to Jeroen it's harmless and will require a cython patch to fix it.",
    "created_at": "2018-05-01T09:25:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342366",
    "user": "https://github.com/vinklein"
}
```

<div id="comment:2" align="right">comment:2</div>

According to Jeroen it's harmless and will require a cython patch to fix it.



---

archive/issue_comments_342367.json:
```json
{
    "body": "<div id=\"comment:173\" align=\"right\">comment:173</div>\n\nReplying to [@seblabbe](#comment:171):\n> Is it possible to clean this?\n\nUnfortunately, it's not easy to properly fix. The basic problem is that the `cimport` is parsed very very early in the Cython build system, at a point where macros like `HAVE_GMPY2` are not considered yet.",
    "created_at": "2018-05-01T09:36:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22928#issuecomment-342367",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:173" align="right">comment:173</div>

Replying to [@seblabbe](#comment:171):
> Is it possible to clean this?

Unfortunately, it's not easy to properly fix. The basic problem is that the `cimport` is parsed very very early in the Cython build system, at a point where macros like `HAVE_GMPY2` are not considered yet.
