# Issue 22928: Conversion between gmpy2 and sage objects

archive/issues_022691.json:
```json
{
    "body": "The library `gmpy2` supports conversions by the use of special methods. In order to allow conversion of Sage objects into gmpy2 objects, we implement the following methods\n- `__mpz__` on Sage Integer\n- `__mpq__` on Sage Rational\n- `__mpfr__` on relevant Sage real numbers\n   - `RealNumber` (`sage.rings.real_mpfr`)\n   - `RealDoubleElement` (`sage.rings.real_double`)\n- `__mpc__` on relevant Sage complex numbers\n   - `ComplexDoubleElement` (`sage.rings.complex_double`)\n   - `MPComplexNumber` (`sage.rings.complex_mpc`)\n   - `ComplexNumber` (`sage.rings.complex_number`)\n\nConversly, we make Sage integer, rational, real and complex constructors accept gmpy2 arguments.\n\nUpstream issues:\n- https://github.com/aleaxit/gmpy/pull/180\n- https://github.com/aleaxit/gmpy/pull/181\n\n**Assignee:** @vinklein\n\n**CC:**  @videlec\n\n**Keywords:** thursdaysbdx\n\n**Branch:** [e9a6fdaf5e130e826929c4d9a6617a2128afe3d0](https://github.com/sagemath/sagetrac-mirror/commit/e9a6fdaf5e130e826929c4d9a6617a2128afe3d0)\n\n**Reviewer:** Jeroen Demeyer, Vincent Delecroix\n\n**Author:** Vincent Klein\n\n**Dependencies:** #24549\n\nIssue created by migration from https://trac.sagemath.org/ticket/22928\n\n",
    "closed_at": "2018-02-02T12:06:15Z",
    "created_at": "2017-05-02T09:03:14Z",
    "labels": [
        "component: interfaces",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.2",
    "title": "Conversion between gmpy2 and sage objects",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22928",
    "user": "https://github.com/vinklein"
}
```
The library `gmpy2` supports conversions by the use of special methods. In order to allow conversion of Sage objects into gmpy2 objects, we implement the following methods
- `__mpz__` on Sage Integer
- `__mpq__` on Sage Rational
- `__mpfr__` on relevant Sage real numbers
   - `RealNumber` (`sage.rings.real_mpfr`)
   - `RealDoubleElement` (`sage.rings.real_double`)
- `__mpc__` on relevant Sage complex numbers
   - `ComplexDoubleElement` (`sage.rings.complex_double`)
   - `MPComplexNumber` (`sage.rings.complex_mpc`)
   - `ComplexNumber` (`sage.rings.complex_number`)

Conversly, we make Sage integer, rational, real and complex constructors accept gmpy2 arguments.

Upstream issues:
- https://github.com/aleaxit/gmpy/pull/180
- https://github.com/aleaxit/gmpy/pull/181

**Assignee:** @vinklein

**CC:**  @videlec

**Keywords:** thursdaysbdx

**Branch:** [e9a6fdaf5e130e826929c4d9a6617a2128afe3d0](https://github.com/sagemath/sagetrac-mirror/commit/e9a6fdaf5e130e826929c4d9a6617a2128afe3d0)

**Reviewer:** Jeroen Demeyer, Vincent Delecroix

**Author:** Vincent Klein

**Dependencies:** #24549

Issue created by migration from https://trac.sagemath.org/ticket/22928





---

archive/issue_comments_346346.json:
```json
{
    "body": "**Dependencies:** #22927",
    "created_at": "2017-05-02T09:03:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346346",
    "user": "https://github.com/vinklein"
}
```

**Dependencies:** #22927



---

archive/issue_comments_346347.json:
```json
{
    "body": "**Assignee:** @vinklein",
    "created_at": "2017-05-02T15:05:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346347",
    "user": "https://github.com/vinklein"
}
```

**Assignee:** @vinklein



---

archive/issue_comments_346348.json:
```json
{
    "body": "**Changing keywords** from \"\" to \"jsb++\".",
    "created_at": "2017-05-11T15:26:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346348",
    "user": "https://github.com/videlec"
}
```

**Changing keywords** from "" to "jsb++".



---

archive/issue_comments_346349.json:
```json
{
    "body": "**Changing keywords** from \"jsb++\" to \"thursdaysbdx\".",
    "created_at": "2017-05-11T15:28:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346349",
    "user": "https://github.com/videlec"
}
```

**Changing keywords** from "jsb++" to "thursdaysbdx".



---

archive/issue_comments_346350.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,5 +1,5 @@\n Conversion between gmpy2 and sage integers:\n - Implement method `__mpz__` on sage integer: return an gmpy2 mpz \n - Implement method `__mpq__` on sage rational: return an gmpy2 mpq\n-- Implement constructor for sage integer and rational with respectively mpz and mpq parameters.\n+- Add conversion functions from gmpy2's mpz and mpq to sage integer and rational.\n - Provide coercion.\n``````\n",
    "created_at": "2017-05-11T16:16:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346350",
    "user": "https://github.com/vinklein"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,5 +1,5 @@
 Conversion between gmpy2 and sage integers:
 - Implement method `__mpz__` on sage integer: return an gmpy2 mpz 
 - Implement method `__mpq__` on sage rational: return an gmpy2 mpq
-- Implement constructor for sage integer and rational with respectively mpz and mpq parameters.
+- Add conversion functions from gmpy2's mpz and mpq to sage integer and rational.
 - Provide coercion.
``````




---

archive/issue_comments_346351.json:
```json
{
    "body": "**Branch:** [u/vklein/conversion_between_gmpy2_and_sage_integers](https://github.com/sagemath/sagetrac-mirror/tree/u/vklein/conversion_between_gmpy2_and_sage_integers)",
    "created_at": "2017-05-15T17:15:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346351",
    "user": "https://github.com/vinklein"
}
```

**Branch:** [u/vklein/conversion_between_gmpy2_and_sage_integers](https://github.com/sagemath/sagetrac-mirror/tree/u/vklein/conversion_between_gmpy2_and_sage_integers)



---

archive/issue_comments_346352.json:
```json
{
    "body": "<a id='comment:7'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/48daf5857197f66b880a563ce27c34cf21959c87\">48daf58</a></td><td><code>Add path of gmpy2 in include_dirs</code></td></tr></table>\n",
    "created_at": "2017-05-16T14:06:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346352",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/48daf5857197f66b880a563ce27c34cf21959c87">48daf58</a></td><td><code>Add path of gmpy2 in include_dirs</code></td></tr></table>




---

archive/issue_comments_346353.json:
```json
{
    "body": "**Commit:** [48daf5857197f66b880a563ce27c34cf21959c87](https://github.com/sagemath/sagetrac-mirror/commit/48daf5857197f66b880a563ce27c34cf21959c87)",
    "created_at": "2017-05-16T14:06:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346353",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Commit:** [48daf5857197f66b880a563ce27c34cf21959c87](https://github.com/sagemath/sagetrac-mirror/commit/48daf5857197f66b880a563ce27c34cf21959c87)



---

archive/issue_comments_346354.json:
```json
{
    "body": "<a id='comment:8'></a>\nLooks good. Some small remarks.\n\n1) For the error about missing `gmpy2` you can use `PackageNotFoundError` from `sage.misc.package`\n\n2) `add __mpz__() to class Rational` should be `add __mpq__() to class Rational`\n\n3) You have an indentation problem here\n\n``` \nCoercion for gmpy2 numbers    \n    sage: from gmpy2 import * # optional - gmpy2\n    sage: a, b = cm.canonical_coercion(mpz(5), 10) # optional - gmpy2\n    sage: a, b # optional - gmpy2\n```\nIt should be\n\n```\nCoercion for gmpy2 numbers::\n\n    sage: from gmpy2 import * # optional - gmpy2\n    sage: a, b = cm.canonical_coercion(mpz(5), 10) # optional - gmpy2\n    sage: a, b # optional - gmpy2\n```\n\n4) There should be tests for `a + b`, `a * b`, `a / b` when one of `a` or `b` is from Sage and the other from `gmpy2`\n\n5) Couldn't you share\n\n```\n#Handle gmpy2 objects\nelif is_gmpy2_type(type(x)):\n    return self.canonical_coercion(py_scalar_to_element(x), y)\nelif is_gmpy2_type(type(y)):\n    return self.canonical_coercion(x, py_scalar_to_element(y))\n```\n  with the associated code that deals with numpy types?",
    "created_at": "2017-05-17T17:22:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346354",
    "user": "https://github.com/videlec"
}
```

<a id='comment:8'></a>
Looks good. Some small remarks.

1) For the error about missing `gmpy2` you can use `PackageNotFoundError` from `sage.misc.package`

2) `add __mpz__() to class Rational` should be `add __mpq__() to class Rational`

3) You have an indentation problem here

``` 
Coercion for gmpy2 numbers    
    sage: from gmpy2 import * # optional - gmpy2
    sage: a, b = cm.canonical_coercion(mpz(5), 10) # optional - gmpy2
    sage: a, b # optional - gmpy2
```
It should be

```
Coercion for gmpy2 numbers::

    sage: from gmpy2 import * # optional - gmpy2
    sage: a, b = cm.canonical_coercion(mpz(5), 10) # optional - gmpy2
    sage: a, b # optional - gmpy2
```

4) There should be tests for `a + b`, `a * b`, `a / b` when one of `a` or `b` is from Sage and the other from `gmpy2`

5) Couldn't you share

```
#Handle gmpy2 objects
elif is_gmpy2_type(type(x)):
    return self.canonical_coercion(py_scalar_to_element(x), y)
elif is_gmpy2_type(type(y)):
    return self.canonical_coercion(x, py_scalar_to_element(y))
```
  with the associated code that deals with numpy types?



---

archive/issue_comments_346355.json:
```json
{
    "body": "**Changing commit** from \"[48daf5857197f66b880a563ce27c34cf21959c87](https://github.com/sagemath/sagetrac-mirror/commit/48daf5857197f66b880a563ce27c34cf21959c87)\" to \"[54c04ae7c0bf7d48ca89c1e21c4184133e4c6a9c](https://github.com/sagemath/sagetrac-mirror/commit/54c04ae7c0bf7d48ca89c1e21c4184133e4c6a9c)\".",
    "created_at": "2017-05-18T11:33:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346355",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[48daf5857197f66b880a563ce27c34cf21959c87](https://github.com/sagemath/sagetrac-mirror/commit/48daf5857197f66b880a563ce27c34cf21959c87)" to "[54c04ae7c0bf7d48ca89c1e21c4184133e4c6a9c](https://github.com/sagemath/sagetrac-mirror/commit/54c04ae7c0bf7d48ca89c1e21c4184133e4c6a9c)".



---

archive/issue_comments_346356.json:
```json
{
    "body": "<a id='comment:9'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/54c04ae7c0bf7d48ca89c1e21c4184133e4c6a9c\">54c04ae</a></td><td><code>Minor improvements</code></td></tr></table>\n",
    "created_at": "2017-05-18T11:33:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346356",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/54c04ae7c0bf7d48ca89c1e21c4184133e4c6a9c">54c04ae</a></td><td><code>Minor improvements</code></td></tr></table>




---

archive/issue_comments_346357.json:
```json
{
    "body": "<a id='comment:10'></a>\nReplying to [vdelecroix](#comment%3A8):\nDone with commit [54c04ae](https://github.com/sagemath/sagetrac-mirror/commit/54c04ae7c0bf7d48ca89c1e21c4184133e4c6a9c)",
    "created_at": "2017-05-18T13:27:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346357",
    "user": "https://github.com/vinklein"
}
```

<a id='comment:10'></a>
Replying to [vdelecroix](#comment%3A8):
Done with commit [54c04ae](https://github.com/sagemath/sagetrac-mirror/commit/54c04ae7c0bf7d48ca89c1e21c4184133e4c6a9c)



---

archive/issue_comments_346358.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -3,3 +3,12 @@\n - Implement method `__mpq__` on sage rational: return an gmpy2 mpq\n - Add conversion functions from gmpy2's mpz and mpq to sage integer and rational.\n - Provide coercion.\n+\n+Once gmpy2 is a standard package with the following features :\n+- direct constructors GMPy_MPZ_From_mpz, GMPy_MPQ_From_mpq, GMPy_MPQ_From_mpz\n+- a gmpy2.pxd file with relevant declarations (to be installed at the same place as gmpy2.h)\n+- #136 robust header detection (ie what should the user do in her setup.py to find out where gmpy2.h/gmpy2.pxd are?)\n+see : [#134](https://github.com/aleaxit/gmpy/pull/134), [https://github.com/aleaxit/gmpy/issues/136136](https://github.com/aleaxit/gmpy/issues/136136).\n+\n+Then remove sage.libs.gmpy2 extension and replace conversion functions gmpy2_mpz_to_sage and gmpy2_mpq_to_sage by having sage integer and rational constructors working with gmpy2 number  \n+\n``````\n",
    "created_at": "2017-05-18T13:52:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346358",
    "user": "https://github.com/vinklein"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -3,3 +3,12 @@
 - Implement method `__mpq__` on sage rational: return an gmpy2 mpq
 - Add conversion functions from gmpy2's mpz and mpq to sage integer and rational.
 - Provide coercion.
+
+Once gmpy2 is a standard package with the following features :
+- direct constructors GMPy_MPZ_From_mpz, GMPy_MPQ_From_mpq, GMPy_MPQ_From_mpz
+- a gmpy2.pxd file with relevant declarations (to be installed at the same place as gmpy2.h)
+- #136 robust header detection (ie what should the user do in her setup.py to find out where gmpy2.h/gmpy2.pxd are?)
+see : [#134](https://github.com/aleaxit/gmpy/pull/134), [https://github.com/aleaxit/gmpy/issues/136136](https://github.com/aleaxit/gmpy/issues/136136).
+
+Then remove sage.libs.gmpy2 extension and replace conversion functions gmpy2_mpz_to_sage and gmpy2_mpq_to_sage by having sage integer and rational constructors working with gmpy2 number  
+
``````




---

archive/issue_comments_346359.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -8,7 +8,7 @@\n - direct constructors GMPy_MPZ_From_mpz, GMPy_MPQ_From_mpq, GMPy_MPQ_From_mpz\n - a gmpy2.pxd file with relevant declarations (to be installed at the same place as gmpy2.h)\n - #136 robust header detection (ie what should the user do in her setup.py to find out where gmpy2.h/gmpy2.pxd are?)\n-see : [#134](https://github.com/aleaxit/gmpy/pull/134), [https://github.com/aleaxit/gmpy/issues/136136](https://github.com/aleaxit/gmpy/issues/136136).\n+see : [#134](https://github.com/aleaxit/gmpy/pull/134), [136](https://github.com/aleaxit/gmpy/issues/136).\n \n Then remove sage.libs.gmpy2 extension and replace conversion functions gmpy2_mpz_to_sage and gmpy2_mpq_to_sage by having sage integer and rational constructors working with gmpy2 number  \n \n``````\n",
    "created_at": "2017-05-18T13:53:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346359",
    "user": "https://github.com/vinklein"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -8,7 +8,7 @@
 - direct constructors GMPy_MPZ_From_mpz, GMPy_MPQ_From_mpq, GMPy_MPQ_From_mpz
 - a gmpy2.pxd file with relevant declarations (to be installed at the same place as gmpy2.h)
 - #136 robust header detection (ie what should the user do in her setup.py to find out where gmpy2.h/gmpy2.pxd are?)
-see : [#134](https://github.com/aleaxit/gmpy/pull/134), [https://github.com/aleaxit/gmpy/issues/136136](https://github.com/aleaxit/gmpy/issues/136136).
+see : [#134](https://github.com/aleaxit/gmpy/pull/134), [136](https://github.com/aleaxit/gmpy/issues/136).
 
 Then remove sage.libs.gmpy2 extension and replace conversion functions gmpy2_mpz_to_sage and gmpy2_mpq_to_sage by having sage integer and rational constructors working with gmpy2 number  
 
``````




---

archive/issue_comments_346360.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -8,7 +8,7 @@\n - direct constructors GMPy_MPZ_From_mpz, GMPy_MPQ_From_mpq, GMPy_MPQ_From_mpz\n - a gmpy2.pxd file with relevant declarations (to be installed at the same place as gmpy2.h)\n - #136 robust header detection (ie what should the user do in her setup.py to find out where gmpy2.h/gmpy2.pxd are?)\n-see : [#134](https://github.com/aleaxit/gmpy/pull/134), [136](https://github.com/aleaxit/gmpy/issues/136).\n+see : [#134](https://github.com/aleaxit/gmpy/pull/134), [#136](https://github.com/aleaxit/gmpy/issues/136).\n \n Then remove sage.libs.gmpy2 extension and replace conversion functions gmpy2_mpz_to_sage and gmpy2_mpq_to_sage by having sage integer and rational constructors working with gmpy2 number  \n \n``````\n",
    "created_at": "2017-05-18T13:57:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346360",
    "user": "https://github.com/vinklein"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -8,7 +8,7 @@
 - direct constructors GMPy_MPZ_From_mpz, GMPy_MPQ_From_mpq, GMPy_MPQ_From_mpz
 - a gmpy2.pxd file with relevant declarations (to be installed at the same place as gmpy2.h)
 - #136 robust header detection (ie what should the user do in her setup.py to find out where gmpy2.h/gmpy2.pxd are?)
-see : [#134](https://github.com/aleaxit/gmpy/pull/134), [136](https://github.com/aleaxit/gmpy/issues/136).
+see : [#134](https://github.com/aleaxit/gmpy/pull/134), [#136](https://github.com/aleaxit/gmpy/issues/136).
 
 Then remove sage.libs.gmpy2 extension and replace conversion functions gmpy2_mpz_to_sage and gmpy2_mpq_to_sage by having sage integer and rational constructors working with gmpy2 number  
 
``````




---

archive/issue_comments_346361.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -6,9 +6,9 @@\n \n Once gmpy2 is a standard package with the following features :\n - direct constructors GMPy_MPZ_From_mpz, GMPy_MPQ_From_mpq, GMPy_MPQ_From_mpz\n-- a gmpy2.pxd file with relevant declarations (to be installed at the same place as gmpy2.h)\n+- #137 a gmpy2.pxd file with relevant declarations (to be installed at the same place as gmpy2.h)\n - #136 robust header detection (ie what should the user do in her setup.py to find out where gmpy2.h/gmpy2.pxd are?)\n-see : [#134](https://github.com/aleaxit/gmpy/pull/134), [#136](https://github.com/aleaxit/gmpy/issues/136).\n+see : [#134](https://github.com/aleaxit/gmpy/pull/134), [#136](https://github.com/aleaxit/gmpy/issues/136), [#137](https://github.com/aleaxit/gmpy/pull/137).\n \n Then remove sage.libs.gmpy2 extension and replace conversion functions gmpy2_mpz_to_sage and gmpy2_mpq_to_sage by having sage integer and rational constructors working with gmpy2 number  \n \n``````\n",
    "created_at": "2017-05-18T14:18:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346361",
    "user": "https://github.com/videlec"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -6,9 +6,9 @@
 
 Once gmpy2 is a standard package with the following features :
 - direct constructors GMPy_MPZ_From_mpz, GMPy_MPQ_From_mpq, GMPy_MPQ_From_mpz
-- a gmpy2.pxd file with relevant declarations (to be installed at the same place as gmpy2.h)
+- #137 a gmpy2.pxd file with relevant declarations (to be installed at the same place as gmpy2.h)
 - #136 robust header detection (ie what should the user do in her setup.py to find out where gmpy2.h/gmpy2.pxd are?)
-see : [#134](https://github.com/aleaxit/gmpy/pull/134), [#136](https://github.com/aleaxit/gmpy/issues/136).
+see : [#134](https://github.com/aleaxit/gmpy/pull/134), [#136](https://github.com/aleaxit/gmpy/issues/136), [#137](https://github.com/aleaxit/gmpy/pull/137).
 
 Then remove sage.libs.gmpy2 extension and replace conversion functions gmpy2_mpz_to_sage and gmpy2_mpq_to_sage by having sage integer and rational constructors working with gmpy2 number  
 
``````




---

archive/issue_comments_346362.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -6,8 +6,8 @@\n \n Once gmpy2 is a standard package with the following features :\n - direct constructors GMPy_MPZ_From_mpz, GMPy_MPQ_From_mpq, GMPy_MPQ_From_mpz\n-- #137 a gmpy2.pxd file with relevant declarations (to be installed at the same place as gmpy2.h)\n-- #136 robust header detection (ie what should the user do in her setup.py to find out where gmpy2.h/gmpy2.pxd are?)\n+- [#137](https://github.com/aleaxit/gmpy/pull/137) a gmpy2.pxd file with relevant declarations (to be installed at the same place as gmpy2.h)\n+- [#136](https://github.com/aleaxit/gmpy/issues/136) robust header detection (ie what should the user do in her setup.py to find out where gmpy2.h/gmpy2.pxd are?)\n see : [#134](https://github.com/aleaxit/gmpy/pull/134), [#136](https://github.com/aleaxit/gmpy/issues/136), [#137](https://github.com/aleaxit/gmpy/pull/137).\n \n Then remove sage.libs.gmpy2 extension and replace conversion functions gmpy2_mpz_to_sage and gmpy2_mpq_to_sage by having sage integer and rational constructors working with gmpy2 number  \n``````\n",
    "created_at": "2017-05-18T15:50:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346362",
    "user": "https://github.com/videlec"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -6,8 +6,8 @@
 
 Once gmpy2 is a standard package with the following features :
 - direct constructors GMPy_MPZ_From_mpz, GMPy_MPQ_From_mpq, GMPy_MPQ_From_mpz
-- #137 a gmpy2.pxd file with relevant declarations (to be installed at the same place as gmpy2.h)
-- #136 robust header detection (ie what should the user do in her setup.py to find out where gmpy2.h/gmpy2.pxd are?)
+- [#137](https://github.com/aleaxit/gmpy/pull/137) a gmpy2.pxd file with relevant declarations (to be installed at the same place as gmpy2.h)
+- [#136](https://github.com/aleaxit/gmpy/issues/136) robust header detection (ie what should the user do in her setup.py to find out where gmpy2.h/gmpy2.pxd are?)
 see : [#134](https://github.com/aleaxit/gmpy/pull/134), [#136](https://github.com/aleaxit/gmpy/issues/136), [#137](https://github.com/aleaxit/gmpy/pull/137).
 
 Then remove sage.libs.gmpy2 extension and replace conversion functions gmpy2_mpz_to_sage and gmpy2_mpq_to_sage by having sage integer and rational constructors working with gmpy2 number  
``````




---

archive/issue_comments_346363.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -5,10 +5,10 @@\n - Provide coercion.\n \n Once gmpy2 is a standard package with the following features :\n-- direct constructors GMPy_MPZ_From_mpz, GMPy_MPQ_From_mpq, GMPy_MPQ_From_mpz\n+- [#137](https://github.com/aleaxit/gmpy/pull/137) direct constructors GMPy_MPZ_From_mpz, GMPy_MPQ_From_mpq, GMPy_MPQ_From_mpz\n - [#137](https://github.com/aleaxit/gmpy/pull/137) a gmpy2.pxd file with relevant declarations (to be installed at the same place as gmpy2.h)\n - [#136](https://github.com/aleaxit/gmpy/issues/136) robust header detection (ie what should the user do in her setup.py to find out where gmpy2.h/gmpy2.pxd are?)\n-see : [#134](https://github.com/aleaxit/gmpy/pull/134), [#136](https://github.com/aleaxit/gmpy/issues/136), [#137](https://github.com/aleaxit/gmpy/pull/137).\n+see also: [#134](https://github.com/aleaxit/gmpy/pull/134)\n \n Then remove sage.libs.gmpy2 extension and replace conversion functions gmpy2_mpz_to_sage and gmpy2_mpq_to_sage by having sage integer and rational constructors working with gmpy2 number  \n \n``````\n",
    "created_at": "2017-05-18T15:51:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346363",
    "user": "https://github.com/videlec"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -5,10 +5,10 @@
 - Provide coercion.
 
 Once gmpy2 is a standard package with the following features :
-- direct constructors GMPy_MPZ_From_mpz, GMPy_MPQ_From_mpq, GMPy_MPQ_From_mpz
+- [#137](https://github.com/aleaxit/gmpy/pull/137) direct constructors GMPy_MPZ_From_mpz, GMPy_MPQ_From_mpq, GMPy_MPQ_From_mpz
 - [#137](https://github.com/aleaxit/gmpy/pull/137) a gmpy2.pxd file with relevant declarations (to be installed at the same place as gmpy2.h)
 - [#136](https://github.com/aleaxit/gmpy/issues/136) robust header detection (ie what should the user do in her setup.py to find out where gmpy2.h/gmpy2.pxd are?)
-see : [#134](https://github.com/aleaxit/gmpy/pull/134), [#136](https://github.com/aleaxit/gmpy/issues/136), [#137](https://github.com/aleaxit/gmpy/pull/137).
+see also: [#134](https://github.com/aleaxit/gmpy/pull/134)
 
 Then remove sage.libs.gmpy2 extension and replace conversion functions gmpy2_mpz_to_sage and gmpy2_mpq_to_sage by having sage integer and rational constructors working with gmpy2 number  
 
``````




---

archive/issue_comments_346364.json:
```json
{
    "body": "<a id='comment:17'></a>\nWith [PR #137 from gmpy2](https://github.com/aleaxit/gmpy/pull/137)\n\n- you can get rid of the function `get_gmpy2_path()` and most of the declarations in `sage/libs/gmpy2.pxd`.\n\n- you can add tests for conversions using the methods `__mpz__` and `__mpq__`\n\n```\nsage: import gmpy2\nsage: gmpy2.mpz(23)\n```\n  and\n\n```\nsage: import gmpy2\nsage: gmpy2.mpq(12/14)    \n```",
    "created_at": "2017-05-18T15:59:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346364",
    "user": "https://github.com/videlec"
}
```

<a id='comment:17'></a>
With [PR #137 from gmpy2](https://github.com/aleaxit/gmpy/pull/137)

- you can get rid of the function `get_gmpy2_path()` and most of the declarations in `sage/libs/gmpy2.pxd`.

- you can add tests for conversions using the methods `__mpz__` and `__mpq__`

```
sage: import gmpy2
sage: gmpy2.mpz(23)
```
  and

```
sage: import gmpy2
sage: gmpy2.mpq(12/14)    
```



---

archive/issue_comments_346365.json:
```json
{
    "body": "<a id='comment:18'></a>\nIs the coercion really needed? I mean, we cannot add coercion in Sage for every single external package. Is it really important that we can add a Sage polynomial to a gmpy2 integer for example?",
    "created_at": "2017-05-18T16:00:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346365",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:18'></a>
Is the coercion really needed? I mean, we cannot add coercion in Sage for every single external package. Is it really important that we can add a Sage polynomial to a gmpy2 integer for example?



---

archive/issue_comments_346366.json:
```json
{
    "body": "<a id='comment:19'></a>\nReplying to [jdemeyer](#comment%3A18):\n> Is the coercion really needed? I mean, we cannot add coercion in Sage for every single external package. Is it really important that we can add a Sage polynomial to a gmpy2 integer for example?\n\n\nNot sure. Why do we provide coercion for `numpy`? It is convenient to have `Integer('2') + gmpy2.mpz('3')` working.",
    "created_at": "2017-05-18T16:07:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346366",
    "user": "https://github.com/videlec"
}
```

<a id='comment:19'></a>
Replying to [jdemeyer](#comment%3A18):
> Is the coercion really needed? I mean, we cannot add coercion in Sage for every single external package. Is it really important that we can add a Sage polynomial to a gmpy2 integer for example?


Not sure. Why do we provide coercion for `numpy`? It is convenient to have `Integer('2') + gmpy2.mpz('3')` working.



---

archive/issue_comments_346367.json:
```json
{
    "body": "<a id='comment:20'></a>\nReplying to [vdelecroix](#comment%3A19):\n> It is convenient to have `Integer('2') + gmpy2.mpz('3')` working.\n\n\nEven if you agree with this, one needs to wonder whether the result should be a Sage integer or a gmpy2 integer (that's why I mentioned polynomials in [comment:18])",
    "created_at": "2017-05-18T17:23:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346367",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:20'></a>
Replying to [vdelecroix](#comment%3A19):
> It is convenient to have `Integer('2') + gmpy2.mpz('3')` working.


Even if you agree with this, one needs to wonder whether the result should be a Sage integer or a gmpy2 integer (that's why I mentioned polynomials in [comment:18])



---

archive/issue_comments_346368.json:
```json
{
    "body": "<a id='comment:21'></a>\nThe coercion aspect has been moved into another ticket #23052.",
    "created_at": "2017-05-22T10:21:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346368",
    "user": "https://github.com/vinklein"
}
```

<a id='comment:21'></a>
The coercion aspect has been moved into another ticket #23052.



---

archive/issue_comments_346369.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,8 +1,8 @@\n Conversion between gmpy2 and sage integers:\n - Implement method `__mpz__` on sage integer: return an gmpy2 mpz \n - Implement method `__mpq__` on sage rational: return an gmpy2 mpq\n-- Add conversion functions from gmpy2's mpz and mpq to sage integer and rational.\n-- Provide coercion.\n+-  Sage integer and rational constructors should work with gmpy2's mpz and mpq parameters.\n+\n \n Once gmpy2 is a standard package with the following features :\n - [#137](https://github.com/aleaxit/gmpy/pull/137) direct constructors GMPy_MPZ_From_mpz, GMPy_MPQ_From_mpq, GMPy_MPQ_From_mpz\n``````\n",
    "created_at": "2017-05-22T10:21:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346369",
    "user": "https://github.com/vinklein"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,8 +1,8 @@
 Conversion between gmpy2 and sage integers:
 - Implement method `__mpz__` on sage integer: return an gmpy2 mpz 
 - Implement method `__mpq__` on sage rational: return an gmpy2 mpq
-- Add conversion functions from gmpy2's mpz and mpq to sage integer and rational.
-- Provide coercion.
+-  Sage integer and rational constructors should work with gmpy2's mpz and mpq parameters.
+
 
 Once gmpy2 is a standard package with the following features :
 - [#137](https://github.com/aleaxit/gmpy/pull/137) direct constructors GMPy_MPZ_From_mpz, GMPy_MPQ_From_mpq, GMPy_MPQ_From_mpz
``````




---

archive/issue_comments_346370.json:
```json
{
    "body": "<a id='comment:22'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/87578d9b02c6f2b88b0cd55d1d27a574316439e7\">87578d9</a></td><td><code>Add path of gmpy2 in include_dirs</code></td></tr></table>\n",
    "created_at": "2017-05-22T12:43:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346370",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:22'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/87578d9b02c6f2b88b0cd55d1d27a574316439e7">87578d9</a></td><td><code>Add path of gmpy2 in include_dirs</code></td></tr></table>




---

archive/issue_comments_346371.json:
```json
{
    "body": "**Changing commit** from \"[54c04ae7c0bf7d48ca89c1e21c4184133e4c6a9c](https://github.com/sagemath/sagetrac-mirror/commit/54c04ae7c0bf7d48ca89c1e21c4184133e4c6a9c)\" to \"[87578d9b02c6f2b88b0cd55d1d27a574316439e7](https://github.com/sagemath/sagetrac-mirror/commit/87578d9b02c6f2b88b0cd55d1d27a574316439e7)\".",
    "created_at": "2017-05-22T12:43:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346371",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[54c04ae7c0bf7d48ca89c1e21c4184133e4c6a9c](https://github.com/sagemath/sagetrac-mirror/commit/54c04ae7c0bf7d48ca89c1e21c4184133e4c6a9c)" to "[87578d9b02c6f2b88b0cd55d1d27a574316439e7](https://github.com/sagemath/sagetrac-mirror/commit/87578d9b02c6f2b88b0cd55d1d27a574316439e7)".



---

archive/issue_comments_346372.json:
```json
{
    "body": "<a id='comment:23'></a>\nDidn't we patch Cython in #22728 precisely to avoid needed to mess with include paths?",
    "created_at": "2017-05-22T16:03:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346372",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:23'></a>
Didn't we patch Cython in #22728 precisely to avoid needed to mess with include paths?



---

archive/issue_comments_346373.json:
```json
{
    "body": "<a id='comment:24'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8cbbe31d808f8eeaa7f1ca970b415863ce63a7e6\">8cbbe31</a></td><td><code>update checksum and package version</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ea8aeabc90ff7479e805ca5aa6657bd5c7cf2597\">ea8aeab</a></td><td><code>Integer and rational constructors support gmpy2 params</code></td></tr></table>\n",
    "created_at": "2017-05-22T23:37:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346373",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:24'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8cbbe31d808f8eeaa7f1ca970b415863ce63a7e6">8cbbe31</a></td><td><code>update checksum and package version</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ea8aeabc90ff7479e805ca5aa6657bd5c7cf2597">ea8aeab</a></td><td><code>Integer and rational constructors support gmpy2 params</code></td></tr></table>




---

archive/issue_comments_346374.json:
```json
{
    "body": "**Changing commit** from \"[87578d9b02c6f2b88b0cd55d1d27a574316439e7](https://github.com/sagemath/sagetrac-mirror/commit/87578d9b02c6f2b88b0cd55d1d27a574316439e7)\" to \"[ea8aeabc90ff7479e805ca5aa6657bd5c7cf2597](https://github.com/sagemath/sagetrac-mirror/commit/ea8aeabc90ff7479e805ca5aa6657bd5c7cf2597)\".",
    "created_at": "2017-05-22T23:37:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346374",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[87578d9b02c6f2b88b0cd55d1d27a574316439e7](https://github.com/sagemath/sagetrac-mirror/commit/87578d9b02c6f2b88b0cd55d1d27a574316439e7)" to "[ea8aeabc90ff7479e805ca5aa6657bd5c7cf2597](https://github.com/sagemath/sagetrac-mirror/commit/ea8aeabc90ff7479e805ca5aa6657bd5c7cf2597)".



---

archive/issue_comments_346375.json:
```json
{
    "body": "**Changing commit** from \"[ea8aeabc90ff7479e805ca5aa6657bd5c7cf2597](https://github.com/sagemath/sagetrac-mirror/commit/ea8aeabc90ff7479e805ca5aa6657bd5c7cf2597)\" to \"[c28a1eee830fa3937e58f3657814f7c0aaa187dc](https://github.com/sagemath/sagetrac-mirror/commit/c28a1eee830fa3937e58f3657814f7c0aaa187dc)\".",
    "created_at": "2017-05-22T23:40:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346375",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[ea8aeabc90ff7479e805ca5aa6657bd5c7cf2597](https://github.com/sagemath/sagetrac-mirror/commit/ea8aeabc90ff7479e805ca5aa6657bd5c7cf2597)" to "[c28a1eee830fa3937e58f3657814f7c0aaa187dc](https://github.com/sagemath/sagetrac-mirror/commit/c28a1eee830fa3937e58f3657814f7c0aaa187dc)".



---

archive/issue_comments_346376.json:
```json
{
    "body": "<a id='comment:25'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c28a1eee830fa3937e58f3657814f7c0aaa187dc\">c28a1ee</a></td><td><code>remove OptionalExtension sage.libs.gmpy2</code></td></tr></table>\n",
    "created_at": "2017-05-22T23:40:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346376",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:25'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c28a1eee830fa3937e58f3657814f7c0aaa187dc">c28a1ee</a></td><td><code>remove OptionalExtension sage.libs.gmpy2</code></td></tr></table>




---

archive/issue_events_208131.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-05-23T06:48:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "label": "component: packages: optional",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22928#event-208131"
}
```



---

archive/issue_events_208132.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-05-23T06:48:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "label": "component: packages: standard",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22928#event-208132"
}
```



---

archive/issue_comments_346377.json:
```json
{
    "body": "<a id='comment:27'></a>\n- Is there a need of `get_gmpy2_path`?\n- I think we should avoid the import `gmpy2` completely and that `is_gmpy2_type` can be much faster. I made [issue #139](https://github.com/aleaxit/gmpy/issues/139)\n- Also test\n\n```\nsage: Integer(mpz(3))\nsage: Rational(mpq(2, 3))\nsage: Rational(mpz(5))\n```",
    "created_at": "2017-05-23T07:03:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346377",
    "user": "https://github.com/videlec"
}
```

<a id='comment:27'></a>
- Is there a need of `get_gmpy2_path`?
- I think we should avoid the import `gmpy2` completely and that `is_gmpy2_type` can be much faster. I made [issue #139](https://github.com/aleaxit/gmpy/issues/139)
- Also test

```
sage: Integer(mpz(3))
sage: Rational(mpq(2, 3))
sage: Rational(mpz(5))
```



---

archive/issue_comments_346378.json:
```json
{
    "body": "**Changing commit** from \"[c28a1eee830fa3937e58f3657814f7c0aaa187dc](https://github.com/sagemath/sagetrac-mirror/commit/c28a1eee830fa3937e58f3657814f7c0aaa187dc)\" to \"[7edcfe46cb8d4abdb922f98d39604475a1350c78](https://github.com/sagemath/sagetrac-mirror/commit/7edcfe46cb8d4abdb922f98d39604475a1350c78)\".",
    "created_at": "2017-05-23T14:25:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346378",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[c28a1eee830fa3937e58f3657814f7c0aaa187dc](https://github.com/sagemath/sagetrac-mirror/commit/c28a1eee830fa3937e58f3657814f7c0aaa187dc)" to "[7edcfe46cb8d4abdb922f98d39604475a1350c78](https://github.com/sagemath/sagetrac-mirror/commit/7edcfe46cb8d4abdb922f98d39604475a1350c78)".



---

archive/issue_comments_346379.json:
```json
{
    "body": "<a id='comment:28'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/db380861ff50d4396e402712ecb7d303eab085bb\">db38086</a></td><td><code>remove get_gmpy2_path()</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7edcfe46cb8d4abdb922f98d39604475a1350c78\">7edcfe4</a></td><td><code>Add few doctests</code></td></tr></table>\n",
    "created_at": "2017-05-23T14:25:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346379",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:28'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/db380861ff50d4396e402712ecb7d303eab085bb">db38086</a></td><td><code>remove get_gmpy2_path()</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7edcfe46cb8d4abdb922f98d39604475a1350c78">7edcfe4</a></td><td><code>Add few doctests</code></td></tr></table>




---

archive/issue_comments_346380.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -12,3 +12,4 @@\n \n Then remove sage.libs.gmpy2 extension and replace conversion functions gmpy2_mpz_to_sage and gmpy2_mpq_to_sage by having sage integer and rational constructors working with gmpy2 number  \n \n+Make gmpy2 an standard package (open a thread on sage-devel)\n``````\n",
    "created_at": "2017-05-23T15:41:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346380",
    "user": "https://github.com/vinklein"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -12,3 +12,4 @@
 
 Then remove sage.libs.gmpy2 extension and replace conversion functions gmpy2_mpz_to_sage and gmpy2_mpq_to_sage by having sage integer and rational constructors working with gmpy2 number  
 
+Make gmpy2 an standard package (open a thread on sage-devel)
``````




---

archive/issue_comments_346381.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -12,4 +12,4 @@\n \n Then remove sage.libs.gmpy2 extension and replace conversion functions gmpy2_mpz_to_sage and gmpy2_mpq_to_sage by having sage integer and rational constructors working with gmpy2 number  \n \n-Make gmpy2 an standard package (open a thread on sage-devel)\n+Make gmpy2 a standard package (open a thread on sage-devel)\n``````\n",
    "created_at": "2017-05-23T15:41:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346381",
    "user": "https://github.com/vinklein"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -12,4 +12,4 @@
 
 Then remove sage.libs.gmpy2 extension and replace conversion functions gmpy2_mpz_to_sage and gmpy2_mpq_to_sage by having sage integer and rational constructors working with gmpy2 number  
 
-Make gmpy2 an standard package (open a thread on sage-devel)
+Make gmpy2 a standard package (open a thread on sage-devel)
``````




---

archive/issue_comments_346382.json:
```json
{
    "body": "**Changing commit** from \"[7edcfe46cb8d4abdb922f98d39604475a1350c78](https://github.com/sagemath/sagetrac-mirror/commit/7edcfe46cb8d4abdb922f98d39604475a1350c78)\" to \"[6bf31bab5e23764516042ad45047ef633886e01d](https://github.com/sagemath/sagetrac-mirror/commit/6bf31bab5e23764516042ad45047ef633886e01d)\".",
    "created_at": "2017-05-24T15:08:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346382",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[7edcfe46cb8d4abdb922f98d39604475a1350c78](https://github.com/sagemath/sagetrac-mirror/commit/7edcfe46cb8d4abdb922f98d39604475a1350c78)" to "[6bf31bab5e23764516042ad45047ef633886e01d](https://github.com/sagemath/sagetrac-mirror/commit/6bf31bab5e23764516042ad45047ef633886e01d)".



---

archive/issue_comments_346383.json:
```json
{
    "body": "<a id='comment:31'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6bf31bab5e23764516042ad45047ef633886e01d\">6bf31ba</a></td><td><code>Use of MPZ_Check and MPQ_Check functions from gmpy2 C-API</code></td></tr></table>\n",
    "created_at": "2017-05-24T15:08:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346383",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:31'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6bf31bab5e23764516042ad45047ef633886e01d">6bf31ba</a></td><td><code>Use of MPZ_Check and MPQ_Check functions from gmpy2 C-API</code></td></tr></table>




---

archive/issue_comments_346384.json:
```json
{
    "body": "<a id='comment:32'></a>\nIn case a `mpz` is used to construct a `Rational` I would modify \n\n```\nself.__set_value(integer.Integer(x), base)\n```\nto\n\n```\nmpq_set_z(self.value, MPZ(<MPZ_Object *> x))\n```",
    "created_at": "2017-05-24T15:59:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346384",
    "user": "https://github.com/videlec"
}
```

<a id='comment:32'></a>
In case a `mpz` is used to construct a `Rational` I would modify 

```
self.__set_value(integer.Integer(x), base)
```
to

```
mpq_set_z(self.value, MPZ(<MPZ_Object *> x))
```



---

archive/issue_comments_346385.json:
```json
{
    "body": "<a id='comment:33'></a>\nIt may be faster but you lose a standard processing for all integer types.\nFor example if \n\n```\nelif isinstance(x, integer.Integer):\n            set_from_Integer(self, x)\n``` \nevolve in some way you must copy the modification for the MPZ_Object case.",
    "created_at": "2017-05-24T16:15:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346385",
    "user": "https://github.com/vinklein"
}
```

<a id='comment:33'></a>
It may be faster but you lose a standard processing for all integer types.
For example if 

```
elif isinstance(x, integer.Integer):
            set_from_Integer(self, x)
``` 
evolve in some way you must copy the modification for the MPZ_Object case.



---

archive/issue_comments_346386.json:
```json
{
    "body": "<a id='comment:34'></a>\nReplying to [vklein](#comment%3A33):\n> It may be faster but you lose a standard processing for all integer types.\n> For example if \n> \n> ```\n> elif isinstance(x, integer.Integer):\n>             set_from_Integer(self, x)\n> ``` \n> evolve in some way you must copy the modification for the MPZ_Object case. \n\n\nIt is not only faster, it is much easier to read.\n\nThe concerned code is the following\n\n```\nelif MPQ_Check(<PyObject *> x):\n    mpq_set(self.value, MPQ(<MPQ_Object *> x))\nelif MPZ_Check(<PyObject *> x):\n    self.__set_value(integer.Integer(x), base)\n```\nI don't see the logic in converting `x` to a Sage Integer and then calling `__set_value` instead of using the straightforward `mpq_set_z(...)`.\n\nBTW, I don't understand your comment. What should be an evolution of `set_from_Integer`? An integer is a rational with denominator 1. This will not change in any near future.",
    "created_at": "2017-06-01T19:54:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346386",
    "user": "https://github.com/videlec"
}
```

<a id='comment:34'></a>
Replying to [vklein](#comment%3A33):
> It may be faster but you lose a standard processing for all integer types.
> For example if 
> 
> ```
> elif isinstance(x, integer.Integer):
>             set_from_Integer(self, x)
> ``` 
> evolve in some way you must copy the modification for the MPZ_Object case. 


It is not only faster, it is much easier to read.

The concerned code is the following

```
elif MPQ_Check(<PyObject *> x):
    mpq_set(self.value, MPQ(<MPQ_Object *> x))
elif MPZ_Check(<PyObject *> x):
    self.__set_value(integer.Integer(x), base)
```
I don't see the logic in converting `x` to a Sage Integer and then calling `__set_value` instead of using the straightforward `mpq_set_z(...)`.

BTW, I don't understand your comment. What should be an evolution of `set_from_Integer`? An integer is a rational with denominator 1. This will not change in any near future.



---

archive/issue_comments_346387.json:
```json
{
    "body": "<a id='comment:35'></a>\nReplying to [vdelecroix](#comment%3A34):\n> ...\n> It is not only faster, it is much easier to read.\n> \n\nNot sure if there is a clear difference in readability between the two options, \nby the way there are many recursive call in this function.\n\nAnother reason for the present choice was to be consistent with numpy.integer processing.\nWhen modifying an existing code i tend to stick to the preceding coding style,\n(And having a standard processing for all int type is an understandable design choice).\nOn the other hand in numpy.integer case doing a recursive call seems to be most concise way to do it, \nwich as you demonstrated is not the case for gmpy2 mpz.\n\nThat being said i got your point and prefer your solution.",
    "created_at": "2017-06-01T21:43:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346387",
    "user": "https://github.com/vinklein"
}
```

<a id='comment:35'></a>
Replying to [vdelecroix](#comment%3A34):
> ...
> It is not only faster, it is much easier to read.
> 

Not sure if there is a clear difference in readability between the two options, 
by the way there are many recursive call in this function.

Another reason for the present choice was to be consistent with numpy.integer processing.
When modifying an existing code i tend to stick to the preceding coding style,
(And having a standard processing for all int type is an understandable design choice).
On the other hand in numpy.integer case doing a recursive call seems to be most concise way to do it, 
wich as you demonstrated is not the case for gmpy2 mpz.

That being said i got your point and prefer your solution.



---

archive/issue_comments_346388.json:
```json
{
    "body": "**Changing commit** from \"[6bf31bab5e23764516042ad45047ef633886e01d](https://github.com/sagemath/sagetrac-mirror/commit/6bf31bab5e23764516042ad45047ef633886e01d)\" to \"[53b8d500d1cfa1d837cb02f3779be15f106e4cb2](https://github.com/sagemath/sagetrac-mirror/commit/53b8d500d1cfa1d837cb02f3779be15f106e4cb2)\".",
    "created_at": "2017-06-07T16:25:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346388",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[6bf31bab5e23764516042ad45047ef633886e01d](https://github.com/sagemath/sagetrac-mirror/commit/6bf31bab5e23764516042ad45047ef633886e01d)" to "[53b8d500d1cfa1d837cb02f3779be15f106e4cb2](https://github.com/sagemath/sagetrac-mirror/commit/53b8d500d1cfa1d837cb02f3779be15f106e4cb2)".



---

archive/issue_comments_346389.json:
```json
{
    "body": "<a id='comment:36'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/53b8d500d1cfa1d837cb02f3779be15f106e4cb2\">53b8d50</a></td><td><code>Change way of creating a Rational from a mpz</code></td></tr></table>\n",
    "created_at": "2017-06-07T16:25:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346389",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:36'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/53b8d500d1cfa1d837cb02f3779be15f106e4cb2">53b8d50</a></td><td><code>Change way of creating a Rational from a mpz</code></td></tr></table>




---

archive/issue_comments_346390.json:
```json
{
    "body": "<a id='comment:37'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **Last 10 new commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8bbf2d3a475a9252833c2d8734d1c640a634b945\">8bbf2d3</a></td><td><code>update checksum, snapshot version update in setup.py</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/08c7a721506fc1c9edf01bd5c3a8670561c21bd8\">08c7a72</a></td><td><code>Add path of gmpy2 in include_dirs</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/359a0ff12022c96af72c10c83453dec516d63cda\">359a0ff</a></td><td><code>update checksum and package version</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0d4fd2ea3e932f6434845d876f4650732b818e70\">0d4fd2e</a></td><td><code>Integer and rational constructors support gmpy2 params</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7c66a7c71b07e754d16f174d9cd035b38cc35001\">7c66a7c</a></td><td><code>remove OptionalExtension sage.libs.gmpy2</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d143dde32f1caa21b4d5c408dec6b9d2a930218a\">d143dde</a></td><td><code>remove get_gmpy2_path()</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2c56a3f456a48680e31e44f78e93169fecc1dc96\">2c56a3f</a></td><td><code>Add few doctests</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e5264fda96de5f512c6390ba331efe15bb9c240d\">e5264fd</a></td><td><code>Use of MPZ_Check and MPQ_Check functions from gmpy2 C-API</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/504ab68789745112d5695646edb247225378455c\">504ab68</a></td><td><code>Change way of creating a Rational from a mpz</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/072a15c0456d864dfacc21c068f7cc6b98432a9c\">072a15c</a></td><td><code>add __mpz__() to Rational</code></td></tr></table>\n",
    "created_at": "2017-06-15T12:18:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346390",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:37'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **Last 10 new commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8bbf2d3a475a9252833c2d8734d1c640a634b945">8bbf2d3</a></td><td><code>update checksum, snapshot version update in setup.py</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/08c7a721506fc1c9edf01bd5c3a8670561c21bd8">08c7a72</a></td><td><code>Add path of gmpy2 in include_dirs</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/359a0ff12022c96af72c10c83453dec516d63cda">359a0ff</a></td><td><code>update checksum and package version</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0d4fd2ea3e932f6434845d876f4650732b818e70">0d4fd2e</a></td><td><code>Integer and rational constructors support gmpy2 params</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7c66a7c71b07e754d16f174d9cd035b38cc35001">7c66a7c</a></td><td><code>remove OptionalExtension sage.libs.gmpy2</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d143dde32f1caa21b4d5c408dec6b9d2a930218a">d143dde</a></td><td><code>remove get_gmpy2_path()</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2c56a3f456a48680e31e44f78e93169fecc1dc96">2c56a3f</a></td><td><code>Add few doctests</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e5264fda96de5f512c6390ba331efe15bb9c240d">e5264fd</a></td><td><code>Use of MPZ_Check and MPQ_Check functions from gmpy2 C-API</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/504ab68789745112d5695646edb247225378455c">504ab68</a></td><td><code>Change way of creating a Rational from a mpz</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/072a15c0456d864dfacc21c068f7cc6b98432a9c">072a15c</a></td><td><code>add __mpz__() to Rational</code></td></tr></table>




---

archive/issue_comments_346391.json:
```json
{
    "body": "**Changing commit** from \"[53b8d500d1cfa1d837cb02f3779be15f106e4cb2](https://github.com/sagemath/sagetrac-mirror/commit/53b8d500d1cfa1d837cb02f3779be15f106e4cb2)\" to \"[072a15c0456d864dfacc21c068f7cc6b98432a9c](https://github.com/sagemath/sagetrac-mirror/commit/072a15c0456d864dfacc21c068f7cc6b98432a9c)\".",
    "created_at": "2017-06-15T12:18:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346391",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[53b8d500d1cfa1d837cb02f3779be15f106e4cb2](https://github.com/sagemath/sagetrac-mirror/commit/53b8d500d1cfa1d837cb02f3779be15f106e4cb2)" to "[072a15c0456d864dfacc21c068f7cc6b98432a9c](https://github.com/sagemath/sagetrac-mirror/commit/072a15c0456d864dfacc21c068f7cc6b98432a9c)".



---

archive/issue_comments_346392.json:
```json
{
    "body": "<a id='comment:38'></a>\nI thought that we agreed on [comment:32](#comment%3A32)...",
    "created_at": "2017-06-15T14:04:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346392",
    "user": "https://github.com/videlec"
}
```

<a id='comment:38'></a>
I thought that we agreed on [comment:32](#comment%3A32)...



---

archive/issue_comments_346393.json:
```json
{
    "body": "<a id='comment:39'></a>\nA merge error",
    "created_at": "2017-06-15T14:06:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346393",
    "user": "https://github.com/vinklein"
}
```

<a id='comment:39'></a>
A merge error



---

archive/issue_comments_346394.json:
```json
{
    "body": "<a id='comment:40'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1e404b0b9ef9e2fc2cb6ed4c9b9ec0f44512465c\">1e404b0</a></td><td><code>trac 29928 Change way of creating a Rational from a mpz</code></td></tr></table>\n",
    "created_at": "2017-06-15T14:32:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346394",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:40'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1e404b0b9ef9e2fc2cb6ed4c9b9ec0f44512465c">1e404b0</a></td><td><code>trac 29928 Change way of creating a Rational from a mpz</code></td></tr></table>




---

archive/issue_comments_346395.json:
```json
{
    "body": "**Changing commit** from \"[072a15c0456d864dfacc21c068f7cc6b98432a9c](https://github.com/sagemath/sagetrac-mirror/commit/072a15c0456d864dfacc21c068f7cc6b98432a9c)\" to \"[1e404b0b9ef9e2fc2cb6ed4c9b9ec0f44512465c](https://github.com/sagemath/sagetrac-mirror/commit/1e404b0b9ef9e2fc2cb6ed4c9b9ec0f44512465c)\".",
    "created_at": "2017-06-15T14:32:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346395",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[072a15c0456d864dfacc21c068f7cc6b98432a9c](https://github.com/sagemath/sagetrac-mirror/commit/072a15c0456d864dfacc21c068f7cc6b98432a9c)" to "[1e404b0b9ef9e2fc2cb6ed4c9b9ec0f44512465c](https://github.com/sagemath/sagetrac-mirror/commit/1e404b0b9ef9e2fc2cb6ed4c9b9ec0f44512465c)".



---

archive/issue_events_208133.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-06-22T11:19:01Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "rename": {
        "from": "Conversion between gmpy2 and sage integers",
        "to": "Conversion between gmpy2 and sage objects"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22928#event-208133"
}
```



---

archive/issue_comments_346396.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,15 +1,15 @@\n-Conversion between gmpy2 and sage integers:\n-- Implement method `__mpz__` on sage integer: return an gmpy2 mpz \n-- Implement method `__mpq__` on sage rational: return an gmpy2 mpq\n--  Sage integer and rational constructors should work with gmpy2's mpz and mpq parameters.\n+The library `gmpy2` support conversions by the use of special methods. In order to allow conversion of Sage objects into gmpy2 objects, we implement the following\n+- a method `__mpz__` on Sage Integer\n+- a method `__mpq__` on Sage Rational\n+- a method `__mpfr__` on relevant Sage real numbers\n+   - `RealNumber` (`sage.rings.real_mpfr`)\n+   - `RealDoubleElement` (`sage.rings.real_double`)\n+- a method `__mpc__` on relevant Sage complex numbers\n+   - `ComplexDoubleElement` (`sage.rings.complex_double`)\n+   - `MPComplexNumber` (`sage.rings.complex_mpc`)\n+   - `ComplexNumber` (`sage.rings.complex_number`)\n+\n+Conversly, we make Sage integer, rational, real and complex constructors accept gmpy2 arguments.\n \n \n-Once gmpy2 is a standard package with the following features :\n-- [#137](https://github.com/aleaxit/gmpy/pull/137) direct constructors GMPy_MPZ_From_mpz, GMPy_MPQ_From_mpq, GMPy_MPQ_From_mpz\n-- [#137](https://github.com/aleaxit/gmpy/pull/137) a gmpy2.pxd file with relevant declarations (to be installed at the same place as gmpy2.h)\n-- [#136](https://github.com/aleaxit/gmpy/issues/136) robust header detection (ie what should the user do in her setup.py to find out where gmpy2.h/gmpy2.pxd are?)\n-see also: [#134](https://github.com/aleaxit/gmpy/pull/134)\n-\n-Then remove sage.libs.gmpy2 extension and replace conversion functions gmpy2_mpz_to_sage and gmpy2_mpq_to_sage by having sage integer and rational constructors working with gmpy2 number  \n-\n-Make gmpy2 a standard package (open a thread on sage-devel)\n+**All these features need `gmpy2` being a standard package.**\n``````\n",
    "created_at": "2017-06-22T11:19:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346396",
    "user": "https://github.com/videlec"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,15 +1,15 @@
-Conversion between gmpy2 and sage integers:
-- Implement method `__mpz__` on sage integer: return an gmpy2 mpz 
-- Implement method `__mpq__` on sage rational: return an gmpy2 mpq
--  Sage integer and rational constructors should work with gmpy2's mpz and mpq parameters.
+The library `gmpy2` support conversions by the use of special methods. In order to allow conversion of Sage objects into gmpy2 objects, we implement the following
+- a method `__mpz__` on Sage Integer
+- a method `__mpq__` on Sage Rational
+- a method `__mpfr__` on relevant Sage real numbers
+   - `RealNumber` (`sage.rings.real_mpfr`)
+   - `RealDoubleElement` (`sage.rings.real_double`)
+- a method `__mpc__` on relevant Sage complex numbers
+   - `ComplexDoubleElement` (`sage.rings.complex_double`)
+   - `MPComplexNumber` (`sage.rings.complex_mpc`)
+   - `ComplexNumber` (`sage.rings.complex_number`)
+
+Conversly, we make Sage integer, rational, real and complex constructors accept gmpy2 arguments.
 
 
-Once gmpy2 is a standard package with the following features :
-- [#137](https://github.com/aleaxit/gmpy/pull/137) direct constructors GMPy_MPZ_From_mpz, GMPy_MPQ_From_mpq, GMPy_MPQ_From_mpz
-- [#137](https://github.com/aleaxit/gmpy/pull/137) a gmpy2.pxd file with relevant declarations (to be installed at the same place as gmpy2.h)
-- [#136](https://github.com/aleaxit/gmpy/issues/136) robust header detection (ie what should the user do in her setup.py to find out where gmpy2.h/gmpy2.pxd are?)
-see also: [#134](https://github.com/aleaxit/gmpy/pull/134)
-
-Then remove sage.libs.gmpy2 extension and replace conversion functions gmpy2_mpz_to_sage and gmpy2_mpq_to_sage by having sage integer and rational constructors working with gmpy2 number  
-
-Make gmpy2 a standard package (open a thread on sage-devel)
+**All these features need `gmpy2` being a standard package.**
``````




---

archive/issue_comments_346397.json:
```json
{
    "body": "**Changing commit** from \"[1e404b0b9ef9e2fc2cb6ed4c9b9ec0f44512465c](https://github.com/sagemath/sagetrac-mirror/commit/1e404b0b9ef9e2fc2cb6ed4c9b9ec0f44512465c)\" to \"[09288c73a47d1ce44b5f9e27aab620b75b71c977](https://github.com/sagemath/sagetrac-mirror/commit/09288c73a47d1ce44b5f9e27aab620b75b71c977)\".",
    "created_at": "2017-06-22T12:26:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346397",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[1e404b0b9ef9e2fc2cb6ed4c9b9ec0f44512465c](https://github.com/sagemath/sagetrac-mirror/commit/1e404b0b9ef9e2fc2cb6ed4c9b9ec0f44512465c)" to "[09288c73a47d1ce44b5f9e27aab620b75b71c977](https://github.com/sagemath/sagetrac-mirror/commit/09288c73a47d1ce44b5f9e27aab620b75b71c977)".



---

archive/issue_comments_346398.json:
```json
{
    "body": "<a id='comment:42'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/09288c73a47d1ce44b5f9e27aab620b75b71c977\">09288c7</a></td><td><code>trac 22928 update gmpy2 snapshot version</code></td></tr></table>\n",
    "created_at": "2017-06-22T12:26:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346398",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:42'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/09288c73a47d1ce44b5f9e27aab620b75b71c977">09288c7</a></td><td><code>trac 22928 update gmpy2 snapshot version</code></td></tr></table>




---

archive/issue_events_208134.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-06-22T16:51:19Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "label": "component: packages: standard",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22928#event-208134"
}
```



---

archive/issue_events_208135.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-06-22T16:51:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "label": "component: interfaces",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22928#event-208135"
}
```



---

archive/issue_comments_346399.json:
```json
{
    "body": "**Changing dependencies** from \"#22927\" to \"#22927, #23309\".",
    "created_at": "2017-06-22T16:53:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346399",
    "user": "https://github.com/videlec"
}
```

**Changing dependencies** from "#22927" to "#22927, #23309".



---

archive/issue_comments_346400.json:
```json
{
    "body": "<a id='comment:45'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **Last 10 new commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3e5ded62f948b276cc5068c46ff9ec14f4e82b6c\">3e5ded6</a></td><td><code>Add few doctests</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/758d7fd3bd4e164325f5fd5b1640dfa280e1b4ee\">758d7fd</a></td><td><code>Use of MPZ_Check and MPQ_Check functions from gmpy2 C-API</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d96f7bb50cf157bff2915b0a2917c0ee841b19de\">d96f7bb</a></td><td><code>Change way of creating a Rational from a mpz</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0b8c45edfc63d51624b33cdde181690e6650cc62\">0b8c45e</a></td><td><code>add __mpz__() to Rational</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8f90a093d680773e34d19d05aa46ebb4808bdcc0\">8f90a09</a></td><td><code>trac 29928 Change way of creating a Rational from a mpz</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6263747ede66ebcc873b24c7d3490e37ac507fe7\">6263747</a></td><td><code>trac 22928 update gmpy2 snapshot version</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5b8b77b9ec03821aa6fd5e359f0ba2c0afc20e20\">5b8b77b</a></td><td><code>trac 22928 RealNumber and RealDoubleElement and gmpy2</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6e548519a99282c8eeab996dfd5627fa7ea0c965\">6e54851</a></td><td><code>trac 22928 add `__mpfr__` to RealNumber class</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7b75526a0442145cde2636787d7cdd66d91a4949\">7b75526</a></td><td><code>trac 22928 merge trac 22927</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3e4c6f6267c3e405d6cd4612b616c7d7d14ff63d\">3e4c6f6</a></td><td><code>trac 22928 add `__mpfr__` to RealDoubleElement class</code></td></tr></table>\n",
    "created_at": "2017-06-23T12:03:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346400",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:45'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **Last 10 new commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3e5ded62f948b276cc5068c46ff9ec14f4e82b6c">3e5ded6</a></td><td><code>Add few doctests</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/758d7fd3bd4e164325f5fd5b1640dfa280e1b4ee">758d7fd</a></td><td><code>Use of MPZ_Check and MPQ_Check functions from gmpy2 C-API</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d96f7bb50cf157bff2915b0a2917c0ee841b19de">d96f7bb</a></td><td><code>Change way of creating a Rational from a mpz</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0b8c45edfc63d51624b33cdde181690e6650cc62">0b8c45e</a></td><td><code>add __mpz__() to Rational</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8f90a093d680773e34d19d05aa46ebb4808bdcc0">8f90a09</a></td><td><code>trac 29928 Change way of creating a Rational from a mpz</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6263747ede66ebcc873b24c7d3490e37ac507fe7">6263747</a></td><td><code>trac 22928 update gmpy2 snapshot version</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5b8b77b9ec03821aa6fd5e359f0ba2c0afc20e20">5b8b77b</a></td><td><code>trac 22928 RealNumber and RealDoubleElement and gmpy2</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6e548519a99282c8eeab996dfd5627fa7ea0c965">6e54851</a></td><td><code>trac 22928 add `__mpfr__` to RealNumber class</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7b75526a0442145cde2636787d7cdd66d91a4949">7b75526</a></td><td><code>trac 22928 merge trac 22927</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3e4c6f6267c3e405d6cd4612b616c7d7d14ff63d">3e4c6f6</a></td><td><code>trac 22928 add `__mpfr__` to RealDoubleElement class</code></td></tr></table>




---

archive/issue_comments_346401.json:
```json
{
    "body": "**Changing commit** from \"[09288c73a47d1ce44b5f9e27aab620b75b71c977](https://github.com/sagemath/sagetrac-mirror/commit/09288c73a47d1ce44b5f9e27aab620b75b71c977)\" to \"[3e4c6f6267c3e405d6cd4612b616c7d7d14ff63d](https://github.com/sagemath/sagetrac-mirror/commit/3e4c6f6267c3e405d6cd4612b616c7d7d14ff63d)\".",
    "created_at": "2017-06-23T12:03:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346401",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[09288c73a47d1ce44b5f9e27aab620b75b71c977](https://github.com/sagemath/sagetrac-mirror/commit/09288c73a47d1ce44b5f9e27aab620b75b71c977)" to "[3e4c6f6267c3e405d6cd4612b616c7d7d14ff63d](https://github.com/sagemath/sagetrac-mirror/commit/3e4c6f6267c3e405d6cd4612b616c7d7d14ff63d)".



---

archive/issue_comments_346402.json:
```json
{
    "body": "**Changing commit** from \"[3e4c6f6267c3e405d6cd4612b616c7d7d14ff63d](https://github.com/sagemath/sagetrac-mirror/commit/3e4c6f6267c3e405d6cd4612b616c7d7d14ff63d)\" to \"[043250a6637cb989e53d0852d841367423dc3436](https://github.com/sagemath/sagetrac-mirror/commit/043250a6637cb989e53d0852d841367423dc3436)\".",
    "created_at": "2017-06-23T13:08:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346402",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[3e4c6f6267c3e405d6cd4612b616c7d7d14ff63d](https://github.com/sagemath/sagetrac-mirror/commit/3e4c6f6267c3e405d6cd4612b616c7d7d14ff63d)" to "[043250a6637cb989e53d0852d841367423dc3436](https://github.com/sagemath/sagetrac-mirror/commit/043250a6637cb989e53d0852d841367423dc3436)".



---

archive/issue_comments_346403.json:
```json
{
    "body": "<a id='comment:46'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **Last 10 new commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/601935b30c79a4050c22715585189757122d9823\">601935b</a></td><td><code>Add few doctests</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6868a33e23476ab26d3dc7ae19127be934402f7c\">6868a33</a></td><td><code>Use of MPZ_Check and MPQ_Check functions from gmpy2 C-API</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c91ada4c588fd775c8b420f5c4ad555ae00d1194\">c91ada4</a></td><td><code>Change way of creating a Rational from a mpz</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2d68635f71204ed1c4b582111e628ef63c36ae21\">2d68635</a></td><td><code>add __mpz__() to Rational</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/48d4ce2f07aa4380387d0949c26f2f7f82a2761d\">48d4ce2</a></td><td><code>trac 29928 Change way of creating a Rational from a mpz</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dffb83e00bd2fc6cbf90ed408f52c6a8128d14c9\">dffb83e</a></td><td><code>trac 22928 update gmpy2 snapshot version</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2fa80f573522eb0a9332e4f9ed8089efbbf577a8\">2fa80f5</a></td><td><code>trac 22928 RealNumber and RealDoubleElement and gmpy2</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/32b4b866951688bbf3fb7107ba7da0d491af0175\">32b4b86</a></td><td><code>trac 22928 add `__mpfr__` to RealNumber class</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/25533077d50b1a23052dd4075c436a64663299c1\">2553307</a></td><td><code>trac 22928 merge trac 22927</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/043250a6637cb989e53d0852d841367423dc3436\">043250a</a></td><td><code>trac 22928 add `__mpfr__` to RealDoubleElement class</code></td></tr></table>\n",
    "created_at": "2017-06-23T13:08:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346403",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:46'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **Last 10 new commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/601935b30c79a4050c22715585189757122d9823">601935b</a></td><td><code>Add few doctests</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6868a33e23476ab26d3dc7ae19127be934402f7c">6868a33</a></td><td><code>Use of MPZ_Check and MPQ_Check functions from gmpy2 C-API</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c91ada4c588fd775c8b420f5c4ad555ae00d1194">c91ada4</a></td><td><code>Change way of creating a Rational from a mpz</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2d68635f71204ed1c4b582111e628ef63c36ae21">2d68635</a></td><td><code>add __mpz__() to Rational</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/48d4ce2f07aa4380387d0949c26f2f7f82a2761d">48d4ce2</a></td><td><code>trac 29928 Change way of creating a Rational from a mpz</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dffb83e00bd2fc6cbf90ed408f52c6a8128d14c9">dffb83e</a></td><td><code>trac 22928 update gmpy2 snapshot version</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2fa80f573522eb0a9332e4f9ed8089efbbf577a8">2fa80f5</a></td><td><code>trac 22928 RealNumber and RealDoubleElement and gmpy2</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/32b4b866951688bbf3fb7107ba7da0d491af0175">32b4b86</a></td><td><code>trac 22928 add `__mpfr__` to RealNumber class</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/25533077d50b1a23052dd4075c436a64663299c1">2553307</a></td><td><code>trac 22928 merge trac 22927</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/043250a6637cb989e53d0852d841367423dc3436">043250a</a></td><td><code>trac 22928 add `__mpfr__` to RealDoubleElement class</code></td></tr></table>




---

archive/issue_comments_346404.json:
```json
{
    "body": "<a id='comment:47'></a>\nrebase on 8.0.beta12",
    "created_at": "2017-06-23T13:10:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346404",
    "user": "https://github.com/vinklein"
}
```

<a id='comment:47'></a>
rebase on 8.0.beta12



---

archive/issue_comments_346405.json:
```json
{
    "body": "<a id='comment:48'></a>\nWith `RealNumber` you should check if precision is kept. Like with this number\n\n```\nsage: R = RealField(256)\nsage: R.pi()\n3.141592653589793238462643383279502884197169399375105820974944592307816406286\n```\nIs there a way to check the precision of a real number with gmpy2?",
    "created_at": "2017-06-23T13:11:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346405",
    "user": "https://github.com/videlec"
}
```

<a id='comment:48'></a>
With `RealNumber` you should check if precision is kept. Like with this number

```
sage: R = RealField(256)
sage: R.pi()
3.141592653589793238462643383279502884197169399375105820974944592307816406286
```
Is there a way to check the precision of a real number with gmpy2?



---

archive/issue_comments_346406.json:
```json
{
    "body": "<a id='comment:49'></a>\nYes you can do it with the mpfr's precision attribute.\n\n```\n\nsage: from gmpy2 import mpfr\nsage: R = RealField(256)\nsage: r = mpfr(R.pi())\nsage: r.precision\n256\n\n```\nI will add this as a doctest",
    "created_at": "2017-06-23T13:49:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346406",
    "user": "https://github.com/vinklein"
}
```

<a id='comment:49'></a>
Yes you can do it with the mpfr's precision attribute.

```

sage: from gmpy2 import mpfr
sage: R = RealField(256)
sage: r = mpfr(R.pi())
sage: r.precision
256

```
I will add this as a doctest



---

archive/issue_comments_346407.json:
```json
{
    "body": "<a id='comment:50'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3af335aa159ce276538f9d8347baa3a45d1af2bb\">3af335a</a></td><td><code>trac 22928 add test for mpfr</code></td></tr></table>\n",
    "created_at": "2017-06-23T13:55:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346407",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:50'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3af335aa159ce276538f9d8347baa3a45d1af2bb">3af335a</a></td><td><code>trac 22928 add test for mpfr</code></td></tr></table>




---

archive/issue_comments_346408.json:
```json
{
    "body": "**Changing commit** from \"[043250a6637cb989e53d0852d841367423dc3436](https://github.com/sagemath/sagetrac-mirror/commit/043250a6637cb989e53d0852d841367423dc3436)\" to \"[3af335aa159ce276538f9d8347baa3a45d1af2bb](https://github.com/sagemath/sagetrac-mirror/commit/3af335aa159ce276538f9d8347baa3a45d1af2bb)\".",
    "created_at": "2017-06-23T13:55:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346408",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[043250a6637cb989e53d0852d841367423dc3436](https://github.com/sagemath/sagetrac-mirror/commit/043250a6637cb989e53d0852d841367423dc3436)" to "[3af335aa159ce276538f9d8347baa3a45d1af2bb](https://github.com/sagemath/sagetrac-mirror/commit/3af335aa159ce276538f9d8347baa3a45d1af2bb)".



---

archive/issue_comments_346409.json:
```json
{
    "body": "**Changing commit** from \"[3af335aa159ce276538f9d8347baa3a45d1af2bb](https://github.com/sagemath/sagetrac-mirror/commit/3af335aa159ce276538f9d8347baa3a45d1af2bb)\" to \"[f5a37994b02d98e73cfad3322348b1aaa57c40de](https://github.com/sagemath/sagetrac-mirror/commit/f5a37994b02d98e73cfad3322348b1aaa57c40de)\".",
    "created_at": "2017-11-13T14:22:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346409",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[3af335aa159ce276538f9d8347baa3a45d1af2bb](https://github.com/sagemath/sagetrac-mirror/commit/3af335aa159ce276538f9d8347baa3a45d1af2bb)" to "[f5a37994b02d98e73cfad3322348b1aaa57c40de](https://github.com/sagemath/sagetrac-mirror/commit/f5a37994b02d98e73cfad3322348b1aaa57c40de)".



---

archive/issue_comments_346410.json:
```json
{
    "body": "<a id='comment:51'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **Last 10 new commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f821d9e13aab9cc1f111b80fab60954ebad66e70\">f821d9e</a></td><td><code>Use of MPZ_Check and MPQ_Check functions from gmpy2 C-API</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/24988eede2471afbcbc9e34e5a4a6386100474c0\">24988ee</a></td><td><code>Change way of creating a Rational from a mpz</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f0e21145851e66f1198b6a8df52ce663c1ba5925\">f0e2114</a></td><td><code>add __mpz__() to Rational</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2299a7901b8f80ebfb3c77763abb9f2f31382d42\">2299a79</a></td><td><code>trac 29928 Change way of creating a Rational from a mpz</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d38e2dc10cbbf59adf30223fbae01c9c4486d026\">d38e2dc</a></td><td><code>trac 22928 update gmpy2 snapshot version</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2183a91aa720c05c7d20b157c47bfbe406863bee\">2183a91</a></td><td><code>trac 22928 RealNumber and RealDoubleElement and gmpy2</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c607d49f16f87a3911d9f285e5beeb8255b27010\">c607d49</a></td><td><code>trac 22928 add `__mpfr__` to RealNumber class</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e3c99f1ae026c9603b8a9ce1366428e591f2161b\">e3c99f1</a></td><td><code>trac 22928 merge trac 22927</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9b5df1b672fb9b7f765bbc467c8fc6409536868c\">9b5df1b</a></td><td><code>trac 22928 add `__mpfr__` to RealDoubleElement class</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f5a37994b02d98e73cfad3322348b1aaa57c40de\">f5a3799</a></td><td><code>trac 22928 add test for mpfr</code></td></tr></table>\n",
    "created_at": "2017-11-13T14:22:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346410",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:51'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **Last 10 new commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f821d9e13aab9cc1f111b80fab60954ebad66e70">f821d9e</a></td><td><code>Use of MPZ_Check and MPQ_Check functions from gmpy2 C-API</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/24988eede2471afbcbc9e34e5a4a6386100474c0">24988ee</a></td><td><code>Change way of creating a Rational from a mpz</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f0e21145851e66f1198b6a8df52ce663c1ba5925">f0e2114</a></td><td><code>add __mpz__() to Rational</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2299a7901b8f80ebfb3c77763abb9f2f31382d42">2299a79</a></td><td><code>trac 29928 Change way of creating a Rational from a mpz</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d38e2dc10cbbf59adf30223fbae01c9c4486d026">d38e2dc</a></td><td><code>trac 22928 update gmpy2 snapshot version</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2183a91aa720c05c7d20b157c47bfbe406863bee">2183a91</a></td><td><code>trac 22928 RealNumber and RealDoubleElement and gmpy2</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c607d49f16f87a3911d9f285e5beeb8255b27010">c607d49</a></td><td><code>trac 22928 add `__mpfr__` to RealNumber class</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e3c99f1ae026c9603b8a9ce1366428e591f2161b">e3c99f1</a></td><td><code>trac 22928 merge trac 22927</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9b5df1b672fb9b7f765bbc467c8fc6409536868c">9b5df1b</a></td><td><code>trac 22928 add `__mpfr__` to RealDoubleElement class</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f5a37994b02d98e73cfad3322348b1aaa57c40de">f5a3799</a></td><td><code>trac 22928 add test for mpfr</code></td></tr></table>




---

archive/issue_comments_346411.json:
```json
{
    "body": "Replying to [ticket:22928 vklein]:\n> **All these features need `gmpy2` being a standard package.**\n\n\nI don't think that this is completely true. I understand why you think so, but it shouldn't be too hard to implement this as an optional interface.",
    "created_at": "2017-11-13T14:40:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346411",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [ticket:22928 vklein]:
> **All these features need `gmpy2` being a standard package.**


I don't think that this is completely true. I understand why you think so, but it shouldn't be too hard to implement this as an optional interface.



---

archive/issue_comments_346412.json:
```json
{
    "body": "<a id='comment:53'></a>\nAt the begining i ve tried to make it optional. I don't rememeber exactly why i have come to the conclusion that  it can't be optional.\nI will take a second look at it.",
    "created_at": "2017-11-13T15:02:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346412",
    "user": "https://github.com/vinklein"
}
```

<a id='comment:53'></a>
At the begining i ve tried to make it optional. I don't rememeber exactly why i have come to the conclusion that  it can't be optional.
I will take a second look at it.



---

archive/issue_comments_346413.json:
```json
{
    "body": "<a id='comment:54'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **Last 10 new commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ba3bc1126aecdc5cf65f989f7a31b62bb31fcd72\">ba3bc11</a></td><td><code>Use of MPZ_Check and MPQ_Check functions from gmpy2 C-API</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6a7f661aab6c79faca91d3c9422e1ce42e8acc6d\">6a7f661</a></td><td><code>Change way of creating a Rational from a mpz</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e98845c0e63d21c00d49951486af2212b1eb858e\">e98845c</a></td><td><code>add __mpz__() to Rational</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6161e79ab5141c83e456c7cc12bd2daedc700846\">6161e79</a></td><td><code>trac 29928 Change way of creating a Rational from a mpz</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/aac3bf42ecebda4c23f9b539f1743e57ecebed32\">aac3bf4</a></td><td><code>trac 22928 update gmpy2 snapshot version</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4a9e3b93f5e05e0d027c2306385195c3a84b32b2\">4a9e3b9</a></td><td><code>trac 22928 RealNumber and RealDoubleElement and gmpy2</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4c2553050fb67fe0f088ad4fbe4d8b58ccb4dbd0\">4c25530</a></td><td><code>trac 22928 add `__mpfr__` to RealNumber class</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1129eca628654f420c7ed0fce15962d2eea2818f\">1129eca</a></td><td><code>trac 22928 merge trac 22927</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0ddcc8515822c3ed872c1c586741faad44703b36\">0ddcc85</a></td><td><code>trac 22928 add `__mpfr__` to RealDoubleElement class</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/99b77348d7189300b0fa1e1d04cdb9cbcb4b0765\">99b7734</a></td><td><code>trac 22928 add test for mpfr</code></td></tr></table>\n",
    "created_at": "2017-11-14T09:11:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346413",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:54'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **Last 10 new commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ba3bc1126aecdc5cf65f989f7a31b62bb31fcd72">ba3bc11</a></td><td><code>Use of MPZ_Check and MPQ_Check functions from gmpy2 C-API</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6a7f661aab6c79faca91d3c9422e1ce42e8acc6d">6a7f661</a></td><td><code>Change way of creating a Rational from a mpz</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e98845c0e63d21c00d49951486af2212b1eb858e">e98845c</a></td><td><code>add __mpz__() to Rational</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6161e79ab5141c83e456c7cc12bd2daedc700846">6161e79</a></td><td><code>trac 29928 Change way of creating a Rational from a mpz</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/aac3bf42ecebda4c23f9b539f1743e57ecebed32">aac3bf4</a></td><td><code>trac 22928 update gmpy2 snapshot version</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4a9e3b93f5e05e0d027c2306385195c3a84b32b2">4a9e3b9</a></td><td><code>trac 22928 RealNumber and RealDoubleElement and gmpy2</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4c2553050fb67fe0f088ad4fbe4d8b58ccb4dbd0">4c25530</a></td><td><code>trac 22928 add `__mpfr__` to RealNumber class</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1129eca628654f420c7ed0fce15962d2eea2818f">1129eca</a></td><td><code>trac 22928 merge trac 22927</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0ddcc8515822c3ed872c1c586741faad44703b36">0ddcc85</a></td><td><code>trac 22928 add `__mpfr__` to RealDoubleElement class</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/99b77348d7189300b0fa1e1d04cdb9cbcb4b0765">99b7734</a></td><td><code>trac 22928 add test for mpfr</code></td></tr></table>




---

archive/issue_comments_346414.json:
```json
{
    "body": "**Changing commit** from \"[f5a37994b02d98e73cfad3322348b1aaa57c40de](https://github.com/sagemath/sagetrac-mirror/commit/f5a37994b02d98e73cfad3322348b1aaa57c40de)\" to \"[99b77348d7189300b0fa1e1d04cdb9cbcb4b0765](https://github.com/sagemath/sagetrac-mirror/commit/99b77348d7189300b0fa1e1d04cdb9cbcb4b0765)\".",
    "created_at": "2017-11-14T09:11:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346414",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[f5a37994b02d98e73cfad3322348b1aaa57c40de](https://github.com/sagemath/sagetrac-mirror/commit/f5a37994b02d98e73cfad3322348b1aaa57c40de)" to "[99b77348d7189300b0fa1e1d04cdb9cbcb4b0765](https://github.com/sagemath/sagetrac-mirror/commit/99b77348d7189300b0fa1e1d04cdb9cbcb4b0765)".



---

archive/issue_comments_346415.json:
```json
{
    "body": "<a id='comment:55'></a>\nrebase on 8.1.rc0",
    "created_at": "2017-11-14T09:21:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346415",
    "user": "https://github.com/vinklein"
}
```

<a id='comment:55'></a>
rebase on 8.1.rc0



---

archive/issue_comments_346416.json:
```json
{
    "body": "<a id='comment:56'></a>\nThere is some very ugly Cython code in this branch. I guess this is mostly caused by upstream's ignorance on how to do Cython declarations correctly. I'll try to fix this.",
    "created_at": "2017-11-14T11:08:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346416",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:56'></a>
There is some very ugly Cython code in this branch. I guess this is mostly caused by upstream's ignorance on how to do Cython declarations correctly. I'll try to fix this.



---

archive/issue_comments_346417.json:
```json
{
    "body": "<a id='comment:57'></a>\nWorking on this...",
    "created_at": "2017-11-14T11:08:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346417",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:57'></a>
Working on this...



---

archive/issue_comments_346418.json:
```json
{
    "body": "<a id='comment:58'></a>\nIs there any reason why we need this many commits? Can I just squash all that to 1 commit?",
    "created_at": "2017-11-14T11:10:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346418",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:58'></a>
Is there any reason why we need this many commits? Can I just squash all that to 1 commit?



---

archive/issue_comments_346419.json:
```json
{
    "body": "<a id='comment:59'></a>\nJust historical reason.\nThe gmpy2's cython interface has evolved since this version. You can look if it covers what seems relevant to you [PR#155](https://github.com/aleaxit/gmpy/pull/155).\n\nThe plan of my last push was just to rebase this ticket before integrating the future stable version of gmpy2",
    "created_at": "2017-11-14T11:28:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346419",
    "user": "https://github.com/vinklein"
}
```

<a id='comment:59'></a>
Just historical reason.
The gmpy2's cython interface has evolved since this version. You can look if it covers what seems relevant to you [PR#155](https://github.com/aleaxit/gmpy/pull/155).

The plan of my last push was just to rebase this ticket before integrating the future stable version of gmpy2



---

archive/issue_comments_346420.json:
```json
{
    "body": "**Changing branch** from \"[u/vklein/conversion_between_gmpy2_and_sage_integers](https://github.com/sagemath/sagetrac-mirror/tree/u/vklein/conversion_between_gmpy2_and_sage_integers)\" to \"[u/jdemeyer/conversion_between_gmpy2_and_sage_integers](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/conversion_between_gmpy2_and_sage_integers)\".",
    "created_at": "2017-11-14T12:33:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346420",
    "user": "https://github.com/jdemeyer"
}
```

**Changing branch** from "[u/vklein/conversion_between_gmpy2_and_sage_integers](https://github.com/sagemath/sagetrac-mirror/tree/u/vklein/conversion_between_gmpy2_and_sage_integers)" to "[u/jdemeyer/conversion_between_gmpy2_and_sage_integers](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/conversion_between_gmpy2_and_sage_integers)".



---

archive/issue_comments_346421.json:
```json
{
    "body": "<a id='comment:61'></a>\nI made an upstream pull request https://github.com/aleaxit/gmpy/pull/169 to clean up some Cython declarations.\n\nThen, I cleaned up the branch on this ticket using that PR and I made this branch independent of the gmpy2 upgrade for easier development.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/60f61ff450e14b6b67720e47c8a5f5706546c7a4\">60f61ff</a></td><td><code>Conversion between gmpy2 and Sage objects</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c08a7102060473a105ff4106ed75fc615c79c7f4\">c08a710</a></td><td><code>Cleaner gmpy2 interface</code></td></tr></table>\n",
    "created_at": "2017-11-14T12:35:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346421",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:61'></a>
I made an upstream pull request https://github.com/aleaxit/gmpy/pull/169 to clean up some Cython declarations.

Then, I cleaned up the branch on this ticket using that PR and I made this branch independent of the gmpy2 upgrade for easier development.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/60f61ff450e14b6b67720e47c8a5f5706546c7a4">60f61ff</a></td><td><code>Conversion between gmpy2 and Sage objects</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c08a7102060473a105ff4106ed75fc615c79c7f4">c08a710</a></td><td><code>Cleaner gmpy2 interface</code></td></tr></table>




---

archive/issue_comments_346422.json:
```json
{
    "body": "**Changing commit** from \"[99b77348d7189300b0fa1e1d04cdb9cbcb4b0765](https://github.com/sagemath/sagetrac-mirror/commit/99b77348d7189300b0fa1e1d04cdb9cbcb4b0765)\" to \"[c08a7102060473a105ff4106ed75fc615c79c7f4](https://github.com/sagemath/sagetrac-mirror/commit/c08a7102060473a105ff4106ed75fc615c79c7f4)\".",
    "created_at": "2017-11-14T12:35:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346422",
    "user": "https://github.com/jdemeyer"
}
```

**Changing commit** from "[99b77348d7189300b0fa1e1d04cdb9cbcb4b0765](https://github.com/sagemath/sagetrac-mirror/commit/99b77348d7189300b0fa1e1d04cdb9cbcb4b0765)" to "[c08a7102060473a105ff4106ed75fc615c79c7f4](https://github.com/sagemath/sagetrac-mirror/commit/c08a7102060473a105ff4106ed75fc615c79c7f4)".



---

archive/issue_comments_346423.json:
```json
{
    "body": "<a id='comment:62'></a>\nThanks ! I will update the tarball of #22927, so people can test this ticket without doing their own (as current one doesn't contain the new cython interface).",
    "created_at": "2017-11-14T12:51:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346423",
    "user": "https://github.com/vinklein"
}
```

<a id='comment:62'></a>
Thanks ! I will update the tarball of #22927, so people can test this ticket without doing their own (as current one doesn't contain the new cython interface).



---

archive/issue_comments_346424.json:
```json
{
    "body": "<a id='comment:63'></a>\nNow working on making gmpy2 optional...",
    "created_at": "2017-11-14T13:07:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346424",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:63'></a>
Now working on making gmpy2 optional...



---

archive/issue_comments_346425.json:
```json
{
    "body": "**Changing dependencies** from \"#22927, #23309\" to \"#22927\".",
    "created_at": "2017-11-14T13:07:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346425",
    "user": "https://github.com/jdemeyer"
}
```

**Changing dependencies** from "#22927, #23309" to "#22927".



---

archive/issue_comments_346426.json:
```json
{
    "body": "**Changing dependencies** from \"#22927\" to \"#22927, #24215\".",
    "created_at": "2017-11-14T13:09:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346426",
    "user": "https://github.com/jdemeyer"
}
```

**Changing dependencies** from "#22927" to "#22927, #24215".



---

archive/issue_comments_346427.json:
```json
{
    "body": "<a id='comment:65'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/34ef6dc08de5f11a74e83c6707d6dd4f5e2563be\">34ef6dc</a></td><td><code>Add HAVE_GMPY2 compile-time constant</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a4be146067cc8a12c8afe5a34a44f0d3ec63de7e\">a4be146</a></td><td><code>Conversion between gmpy2 and Sage objects</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/480a79d37226e927b25508f706b1b67717e2e2ee\">480a79d</a></td><td><code>Cleaner and optional gmpy2 interface</code></td></tr></table>\n",
    "created_at": "2017-11-14T15:32:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346427",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:65'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/34ef6dc08de5f11a74e83c6707d6dd4f5e2563be">34ef6dc</a></td><td><code>Add HAVE_GMPY2 compile-time constant</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a4be146067cc8a12c8afe5a34a44f0d3ec63de7e">a4be146</a></td><td><code>Conversion between gmpy2 and Sage objects</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/480a79d37226e927b25508f706b1b67717e2e2ee">480a79d</a></td><td><code>Cleaner and optional gmpy2 interface</code></td></tr></table>




---

archive/issue_comments_346428.json:
```json
{
    "body": "**Changing commit** from \"[c08a7102060473a105ff4106ed75fc615c79c7f4](https://github.com/sagemath/sagetrac-mirror/commit/c08a7102060473a105ff4106ed75fc615c79c7f4)\" to \"[480a79d37226e927b25508f706b1b67717e2e2ee](https://github.com/sagemath/sagetrac-mirror/commit/480a79d37226e927b25508f706b1b67717e2e2ee)\".",
    "created_at": "2017-11-14T15:32:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346428",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[c08a7102060473a105ff4106ed75fc615c79c7f4](https://github.com/sagemath/sagetrac-mirror/commit/c08a7102060473a105ff4106ed75fc615c79c7f4)" to "[480a79d37226e927b25508f706b1b67717e2e2ee](https://github.com/sagemath/sagetrac-mirror/commit/480a79d37226e927b25508f706b1b67717e2e2ee)".



---

archive/issue_comments_346429.json:
```json
{
    "body": "<a id='comment:66'></a>\nworking on complex types (`__mpc__` function and constructor)",
    "created_at": "2017-11-14T15:40:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346429",
    "user": "https://github.com/vinklein"
}
```

<a id='comment:66'></a>
working on complex types (`__mpc__` function and constructor)



---

archive/issue_comments_346430.json:
```json
{
    "body": "**Changing branch** from \"[u/jdemeyer/conversion_between_gmpy2_and_sage_integers](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/conversion_between_gmpy2_and_sage_integers)\" to \"[u/vklein/conversion_between_gmpy2_and_sage_integers](https://github.com/sagemath/sagetrac-mirror/tree/u/vklein/conversion_between_gmpy2_and_sage_integers)\".",
    "created_at": "2017-11-16T16:46:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346430",
    "user": "https://github.com/vinklein"
}
```

**Changing branch** from "[u/jdemeyer/conversion_between_gmpy2_and_sage_integers](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/conversion_between_gmpy2_and_sage_integers)" to "[u/vklein/conversion_between_gmpy2_and_sage_integers](https://github.com/sagemath/sagetrac-mirror/tree/u/vklein/conversion_between_gmpy2_and_sage_integers)".



---

archive/issue_comments_346431.json:
```json
{
    "body": "**Changing commit** from \"[480a79d37226e927b25508f706b1b67717e2e2ee](https://github.com/sagemath/sagetrac-mirror/commit/480a79d37226e927b25508f706b1b67717e2e2ee)\" to \"[0ecbffda255da8d6ab042eab194cd295b72e5d13](https://github.com/sagemath/sagetrac-mirror/commit/0ecbffda255da8d6ab042eab194cd295b72e5d13)\".",
    "created_at": "2017-11-16T18:39:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346431",
    "user": "https://github.com/jdemeyer"
}
```

**Changing commit** from "[480a79d37226e927b25508f706b1b67717e2e2ee](https://github.com/sagemath/sagetrac-mirror/commit/480a79d37226e927b25508f706b1b67717e2e2ee)" to "[0ecbffda255da8d6ab042eab194cd295b72e5d13](https://github.com/sagemath/sagetrac-mirror/commit/0ecbffda255da8d6ab042eab194cd295b72e5d13)".



---

archive/issue_comments_346432.json:
```json
{
    "body": "<a id='comment:68'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d6072ca9a9e1b9a7d402a214cb7d3deb2d6f3855\">d6072ca</a></td><td><code>use a snapshot version of gmpy2</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ce7a0821fa8a5e58d725f2e98adc665a7f8ff061\">ce7a082</a></td><td><code>update checksum, snapshot version update in setup.py</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2eca651b6215a1bb37bf6fbaf4251cc214531fd7\">2eca651</a></td><td><code>New snapshot version, update checksum and package-version.txt</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bd257c15d700c2bc7e194ca74d2feb9f0996c003\">bd257c1</a></td><td><code>Update checksum and snapshot version</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/32cc1ab32a0b364bc6e8be2c812349520364f60e\">32cc1ab</a></td><td><code>trac 22927 update gmpy2 snapshot version</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/aab4169b8b6d841cfa88709e99afd16e720c32cf\">aab4169</a></td><td><code>trac 22927 update gmpy2 package version</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0ba3ffb09762bbf7c08196702224bdd36fce2fdc\">0ba3ffb</a></td><td><code>trac 22927: update package version to snapshot-14.11.17</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3bf081fbac5870ac850250fd960085e80320f926\">3bf081f</a></td><td><code>Merge branch 'u/vklein/add_gmpy2_as_an_optional_package' of git://trac.sagemath.org/sage into t/22928/conversion_between_gmpy2_and_sage_integers</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0ecbffda255da8d6ab042eab194cd295b72e5d13\">0ecbffd</a></td><td><code>trac 22928 : add `__mpc__` function to Sage complex numbers</code></td></tr></table>\n",
    "created_at": "2017-11-16T18:39:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346432",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:68'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d6072ca9a9e1b9a7d402a214cb7d3deb2d6f3855">d6072ca</a></td><td><code>use a snapshot version of gmpy2</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ce7a0821fa8a5e58d725f2e98adc665a7f8ff061">ce7a082</a></td><td><code>update checksum, snapshot version update in setup.py</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2eca651b6215a1bb37bf6fbaf4251cc214531fd7">2eca651</a></td><td><code>New snapshot version, update checksum and package-version.txt</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bd257c15d700c2bc7e194ca74d2feb9f0996c003">bd257c1</a></td><td><code>Update checksum and snapshot version</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/32cc1ab32a0b364bc6e8be2c812349520364f60e">32cc1ab</a></td><td><code>trac 22927 update gmpy2 snapshot version</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/aab4169b8b6d841cfa88709e99afd16e720c32cf">aab4169</a></td><td><code>trac 22927 update gmpy2 package version</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0ba3ffb09762bbf7c08196702224bdd36fce2fdc">0ba3ffb</a></td><td><code>trac 22927: update package version to snapshot-14.11.17</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3bf081fbac5870ac850250fd960085e80320f926">3bf081f</a></td><td><code>Merge branch 'u/vklein/add_gmpy2_as_an_optional_package' of git://trac.sagemath.org/sage into t/22928/conversion_between_gmpy2_and_sage_integers</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0ecbffda255da8d6ab042eab194cd295b72e5d13">0ecbffd</a></td><td><code>trac 22928 : add `__mpc__` function to Sage complex numbers</code></td></tr></table>




---

archive/issue_comments_346433.json:
```json
{
    "body": "<a id='comment:69'></a>\nThe documentation\n\n```\nConvert Sage ``ComplexNumber`` to gmpy2 ``Complex``.\n```\nrefers to a type `Complex` that does not exist in gmpy2 and `ComplexNumber` should be one of `ComplexDoubleElement`, `MPComplexNumber` or `ComplexNumber` which are three distinct classes.",
    "created_at": "2017-11-16T18:50:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346433",
    "user": "https://github.com/videlec"
}
```

<a id='comment:69'></a>
The documentation

```
Convert Sage ``ComplexNumber`` to gmpy2 ``Complex``.
```
refers to a type `Complex` that does not exist in gmpy2 and `ComplexNumber` should be one of `ComplexDoubleElement`, `MPComplexNumber` or `ComplexNumber` which are three distinct classes.



---

archive/issue_events_208136.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-11-16T18:50:04Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "milestone": "sage-8.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22928#event-208136"
}
```



---

archive/issue_events_208137.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-11-16T18:50:04Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "milestone": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22928#event-208137"
}
```



---

archive/issue_comments_346434.json:
```json
{
    "body": "<a id='comment:70'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6d674fc2956a9674ccb7349b47c316193788ee84\">6d674fc</a></td><td><code>trac 22928 : fix `__mpc__` documentation</code></td></tr></table>\n",
    "created_at": "2017-11-17T08:55:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346434",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:70'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6d674fc2956a9674ccb7349b47c316193788ee84">6d674fc</a></td><td><code>trac 22928 : fix `__mpc__` documentation</code></td></tr></table>




---

archive/issue_comments_346435.json:
```json
{
    "body": "**Changing commit** from \"[0ecbffda255da8d6ab042eab194cd295b72e5d13](https://github.com/sagemath/sagetrac-mirror/commit/0ecbffda255da8d6ab042eab194cd295b72e5d13)\" to \"[6d674fc2956a9674ccb7349b47c316193788ee84](https://github.com/sagemath/sagetrac-mirror/commit/6d674fc2956a9674ccb7349b47c316193788ee84)\".",
    "created_at": "2017-11-17T08:55:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346435",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[0ecbffda255da8d6ab042eab194cd295b72e5d13](https://github.com/sagemath/sagetrac-mirror/commit/0ecbffda255da8d6ab042eab194cd295b72e5d13)" to "[6d674fc2956a9674ccb7349b47c316193788ee84](https://github.com/sagemath/sagetrac-mirror/commit/6d674fc2956a9674ccb7349b47c316193788ee84)".



---

archive/issue_comments_346436.json:
```json
{
    "body": "**Changing commit** from \"[6d674fc2956a9674ccb7349b47c316193788ee84](https://github.com/sagemath/sagetrac-mirror/commit/6d674fc2956a9674ccb7349b47c316193788ee84)\" to \"[e406a9e61f43e832baecf6d2aa300f01362ca8d7](https://github.com/sagemath/sagetrac-mirror/commit/e406a9e61f43e832baecf6d2aa300f01362ca8d7)\".",
    "created_at": "2017-11-24T16:53:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346436",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[6d674fc2956a9674ccb7349b47c316193788ee84](https://github.com/sagemath/sagetrac-mirror/commit/6d674fc2956a9674ccb7349b47c316193788ee84)" to "[e406a9e61f43e832baecf6d2aa300f01362ca8d7](https://github.com/sagemath/sagetrac-mirror/commit/e406a9e61f43e832baecf6d2aa300f01362ca8d7)".



---

archive/issue_comments_346437.json:
```json
{
    "body": "<a id='comment:71'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e0005636ed6db71bc8dca31418c9cb6519deb8f5\">e000563</a></td><td><code>Trac #22927 gmpy2 update package version to 2.1.0a1</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/82d94629d82f440d0532c0dd24a68d9e95e4dded\">82d9462</a></td><td><code>Add HAVE_GMPY2 compile-time constant</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2d01807fef602a1030b027109af86b2c6b281941\">2d01807</a></td><td><code>Conversion between gmpy2 and Sage objects</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b9c7c43a1f2648fc4f198b977735fbea6098341c\">b9c7c43</a></td><td><code>Cleaner and optional gmpy2 interface</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/476ddc2814953a705d118bdf550367b5fabbab61\">476ddc2</a></td><td><code>trac 22928 : add `__mpc__` function to Sage complex numbers</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e406a9e61f43e832baecf6d2aa300f01362ca8d7\">e406a9e</a></td><td><code>trac 22928 : fix `__mpc__` documentation</code></td></tr></table>\n",
    "created_at": "2017-11-24T16:53:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346437",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:71'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e0005636ed6db71bc8dca31418c9cb6519deb8f5">e000563</a></td><td><code>Trac #22927 gmpy2 update package version to 2.1.0a1</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/82d94629d82f440d0532c0dd24a68d9e95e4dded">82d9462</a></td><td><code>Add HAVE_GMPY2 compile-time constant</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2d01807fef602a1030b027109af86b2c6b281941">2d01807</a></td><td><code>Conversion between gmpy2 and Sage objects</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b9c7c43a1f2648fc4f198b977735fbea6098341c">b9c7c43</a></td><td><code>Cleaner and optional gmpy2 interface</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/476ddc2814953a705d118bdf550367b5fabbab61">476ddc2</a></td><td><code>trac 22928 : add `__mpc__` function to Sage complex numbers</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e406a9e61f43e832baecf6d2aa300f01362ca8d7">e406a9e</a></td><td><code>trac 22928 : fix `__mpc__` documentation</code></td></tr></table>




---

archive/issue_comments_346438.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -10,6 +10,3 @@\n    - `ComplexNumber` (`sage.rings.complex_number`)\n \n Conversly, we make Sage integer, rational, real and complex constructors accept gmpy2 arguments.\n-\n-\n-**All these features need `gmpy2` being a standard package.**\n``````\n",
    "created_at": "2017-11-24T16:55:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346438",
    "user": "https://github.com/vinklein"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -10,6 +10,3 @@
    - `ComplexNumber` (`sage.rings.complex_number`)
 
 Conversly, we make Sage integer, rational, real and complex constructors accept gmpy2 arguments.
-
-
-**All these features need `gmpy2` being a standard package.**
``````




---

archive/issue_comments_346439.json:
```json
{
    "body": "<a id='comment:72'></a>\nRebase on the last Trac #22927 HEAD",
    "created_at": "2017-11-24T16:55:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346439",
    "user": "https://github.com/vinklein"
}
```

<a id='comment:72'></a>
Rebase on the last Trac #22927 HEAD



---

archive/issue_events_208138.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2017-11-24T16:56:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22928#event-208138"
}
```



---

archive/issue_comments_346440.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,10 +1,10 @@\n-The library `gmpy2` support conversions by the use of special methods. In order to allow conversion of Sage objects into gmpy2 objects, we implement the following\n-- a method `__mpz__` on Sage Integer\n-- a method `__mpq__` on Sage Rational\n-- a method `__mpfr__` on relevant Sage real numbers\n+The library `gmpy2` supports conversions by the use of special methods. In order to allow conversion of Sage objects into gmpy2 objects, we implement the following methods\n+- `__mpz__` on Sage Integer\n+- `__mpq__` on Sage Rational\n+- `__mpfr__` on relevant Sage real numbers\n    - `RealNumber` (`sage.rings.real_mpfr`)\n    - `RealDoubleElement` (`sage.rings.real_double`)\n-- a method `__mpc__` on relevant Sage complex numbers\n+- `__mpc__` on relevant Sage complex numbers\n    - `ComplexDoubleElement` (`sage.rings.complex_double`)\n    - `MPComplexNumber` (`sage.rings.complex_mpc`)\n    - `ComplexNumber` (`sage.rings.complex_number`)\n``````\n",
    "created_at": "2017-11-24T16:58:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346440",
    "user": "https://github.com/videlec"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,10 +1,10 @@
-The library `gmpy2` support conversions by the use of special methods. In order to allow conversion of Sage objects into gmpy2 objects, we implement the following
-- a method `__mpz__` on Sage Integer
-- a method `__mpq__` on Sage Rational
-- a method `__mpfr__` on relevant Sage real numbers
+The library `gmpy2` supports conversions by the use of special methods. In order to allow conversion of Sage objects into gmpy2 objects, we implement the following methods
+- `__mpz__` on Sage Integer
+- `__mpq__` on Sage Rational
+- `__mpfr__` on relevant Sage real numbers
    - `RealNumber` (`sage.rings.real_mpfr`)
    - `RealDoubleElement` (`sage.rings.real_double`)
-- a method `__mpc__` on relevant Sage complex numbers
+- `__mpc__` on relevant Sage complex numbers
    - `ComplexDoubleElement` (`sage.rings.complex_double`)
    - `MPComplexNumber` (`sage.rings.complex_mpc`)
    - `ComplexNumber` (`sage.rings.complex_number`)
``````




---

archive/issue_events_208139.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-11-24T17:02:28Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22928#event-208139"
}
```



---

archive/issue_events_208140.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-11-24T17:02:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22928#event-208140"
}
```



---

archive/issue_comments_346441.json:
```json
{
    "body": "<a id='comment:75'></a>\nThis branch will not work. The commit in #24215 is `7f06e71` but you rebased it here. So there will be a conflict.",
    "created_at": "2017-11-24T17:02:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346441",
    "user": "https://github.com/videlec"
}
```

<a id='comment:75'></a>
This branch will not work. The commit in #24215 is `7f06e71` but you rebased it here. So there will be a conflict.



---

archive/issue_comments_346442.json:
```json
{
    "body": "**Changing commit** from \"[e406a9e61f43e832baecf6d2aa300f01362ca8d7](https://github.com/sagemath/sagetrac-mirror/commit/e406a9e61f43e832baecf6d2aa300f01362ca8d7)\" to \"[ddd29a839bd97eabf21deef796472384441e9755](https://github.com/sagemath/sagetrac-mirror/commit/ddd29a839bd97eabf21deef796472384441e9755)\".",
    "created_at": "2017-11-24T18:33:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346442",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[e406a9e61f43e832baecf6d2aa300f01362ca8d7](https://github.com/sagemath/sagetrac-mirror/commit/e406a9e61f43e832baecf6d2aa300f01362ca8d7)" to "[ddd29a839bd97eabf21deef796472384441e9755](https://github.com/sagemath/sagetrac-mirror/commit/ddd29a839bd97eabf21deef796472384441e9755)".



---

archive/issue_comments_346443.json:
```json
{
    "body": "<a id='comment:76'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/34ef6dc08de5f11a74e83c6707d6dd4f5e2563be\">34ef6dc</a></td><td><code>Add HAVE_GMPY2 compile-time constant</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/158d984a1263978ce941172c775238afbc32ad65\">158d984</a></td><td><code>Force absolute import in have_module()</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7f06e71efb3fdc5f91fcf4b0b3ef761c72d9a8c2\">7f06e71</a></td><td><code>Fix documentation</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9dceca04aa94beb3324addabddff7158f4c3c8fd\">9dceca0</a></td><td><code>Merge branch 'u/jdemeyer/ticket/24215' of git://trac.sagemath.org/sage into 22928</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8bed52c842d0ea43a28f3459620b4c9880f96b27\">8bed52c</a></td><td><code>Conversion between gmpy2 and Sage objects</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4f79ed76ccca8d601205980ac6ba66889e09f241\">4f79ed7</a></td><td><code>Cleaner and optional gmpy2 interface</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/89385495576b895a5c6adde62416f165e6662cfb\">8938549</a></td><td><code>trac 22928 : add `__mpc__` function to Sage complex numbers</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ddd29a839bd97eabf21deef796472384441e9755\">ddd29a8</a></td><td><code>trac 22928 : fix `__mpc__` documentation</code></td></tr></table>\n",
    "created_at": "2017-11-24T18:33:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346443",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:76'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/34ef6dc08de5f11a74e83c6707d6dd4f5e2563be">34ef6dc</a></td><td><code>Add HAVE_GMPY2 compile-time constant</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/158d984a1263978ce941172c775238afbc32ad65">158d984</a></td><td><code>Force absolute import in have_module()</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7f06e71efb3fdc5f91fcf4b0b3ef761c72d9a8c2">7f06e71</a></td><td><code>Fix documentation</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9dceca04aa94beb3324addabddff7158f4c3c8fd">9dceca0</a></td><td><code>Merge branch 'u/jdemeyer/ticket/24215' of git://trac.sagemath.org/sage into 22928</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8bed52c842d0ea43a28f3459620b4c9880f96b27">8bed52c</a></td><td><code>Conversion between gmpy2 and Sage objects</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4f79ed76ccca8d601205980ac6ba66889e09f241">4f79ed7</a></td><td><code>Cleaner and optional gmpy2 interface</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/89385495576b895a5c6adde62416f165e6662cfb">8938549</a></td><td><code>trac 22928 : add `__mpc__` function to Sage complex numbers</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ddd29a839bd97eabf21deef796472384441e9755">ddd29a8</a></td><td><code>trac 22928 : fix `__mpc__` documentation</code></td></tr></table>




---

archive/issue_comments_346444.json:
```json
{
    "body": "<a id='comment:77'></a>\nrework done",
    "created_at": "2017-11-24T18:39:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346444",
    "user": "https://github.com/vinklein"
}
```

<a id='comment:77'></a>
rework done



---

archive/issue_events_208141.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2017-11-24T18:39:51Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22928#event-208141"
}
```



---

archive/issue_events_208142.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2017-11-24T18:39:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22928#event-208142"
}
```



---

archive/issue_events_208143.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-11-28T12:40:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22928#event-208143"
}
```



---

archive/issue_events_208144.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-11-28T12:40:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22928#event-208144"
}
```



---

archive/issue_comments_346445.json:
```json
{
    "body": "<a id='comment:78'></a>\n\n```\nsage: import gmpy2\nsage: gmpy2.mpz(1/2)\n--> SEGFAULT <--\n```",
    "created_at": "2017-11-28T12:40:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346445",
    "user": "https://github.com/videlec"
}
```

<a id='comment:78'></a>

```
sage: import gmpy2
sage: gmpy2.mpz(1/2)
--> SEGFAULT <--
```



---

archive/issue_events_208145.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-11-28T12:44:13Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22928#event-208145"
}
```



---

archive/issue_events_208146.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-11-28T12:44:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22928#event-208146"
}
```



---

archive/issue_comments_346446.json:
```json
{
    "body": "<a id='comment:79'></a>\nReplying to [vdelecroix](#comment%3A78):\n> \n> ```\n> sage: import gmpy2\n> sage: gmpy2.mpz(1/2)\n> --> SEGFAULT <--\n> ```\n\n\nThat is really a bug in `gmpy2`, not in Sage.",
    "created_at": "2017-11-28T12:44:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346446",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:79'></a>
Replying to [vdelecroix](#comment%3A78):
> 
> ```
> sage: import gmpy2
> sage: gmpy2.mpz(1/2)
> --> SEGFAULT <--
> ```


That is really a bug in `gmpy2`, not in Sage.



---

archive/issue_comments_346447.json:
```json
{
    "body": "<a id='comment:80'></a>\nIndeed https://github.com/aleaxit/gmpy/issues/173",
    "created_at": "2017-11-28T12:55:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346447",
    "user": "https://github.com/videlec"
}
```

<a id='comment:80'></a>
Indeed https://github.com/aleaxit/gmpy/issues/173



---

archive/issue_comments_346448.json:
```json
{
    "body": "<a id='comment:81'></a>\nI might review this, but only after the dependencies have been merged in a beta.",
    "created_at": "2017-11-28T13:39:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346448",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:81'></a>
I might review this, but only after the dependencies have been merged in a beta.



---

archive/issue_comments_346449.json:
```json
{
    "body": "**Changing branch** from \"[u/vklein/conversion_between_gmpy2_and_sage_integers](https://github.com/sagemath/sagetrac-mirror/tree/u/vklein/conversion_between_gmpy2_and_sage_integers)\" to \"[u/jdemeyer/conversion_between_gmpy2_and_sage_integers](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/conversion_between_gmpy2_and_sage_integers)\".",
    "created_at": "2017-12-14T12:06:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346449",
    "user": "https://github.com/jdemeyer"
}
```

**Changing branch** from "[u/vklein/conversion_between_gmpy2_and_sage_integers](https://github.com/sagemath/sagetrac-mirror/tree/u/vklein/conversion_between_gmpy2_and_sage_integers)" to "[u/jdemeyer/conversion_between_gmpy2_and_sage_integers](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/conversion_between_gmpy2_and_sage_integers)".



---

archive/issue_comments_346450.json:
```json
{
    "body": "**Changing commit** from \"[ddd29a839bd97eabf21deef796472384441e9755](https://github.com/sagemath/sagetrac-mirror/commit/ddd29a839bd97eabf21deef796472384441e9755)\" to \"[9528b59e0936668ff3c05ec9ced10c322c71e8ba](https://github.com/sagemath/sagetrac-mirror/commit/9528b59e0936668ff3c05ec9ced10c322c71e8ba)\".",
    "created_at": "2017-12-14T12:06:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346450",
    "user": "https://github.com/jdemeyer"
}
```

**Changing commit** from "[ddd29a839bd97eabf21deef796472384441e9755](https://github.com/sagemath/sagetrac-mirror/commit/ddd29a839bd97eabf21deef796472384441e9755)" to "[9528b59e0936668ff3c05ec9ced10c322c71e8ba](https://github.com/sagemath/sagetrac-mirror/commit/9528b59e0936668ff3c05ec9ced10c322c71e8ba)".



---

archive/issue_comments_346451.json:
```json
{
    "body": "**Changing dependencies** from \"#22927, #24215\" to \"\".",
    "created_at": "2017-12-14T12:06:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346451",
    "user": "https://github.com/jdemeyer"
}
```

**Changing dependencies** from "#22927, #24215" to "".



---

archive/issue_comments_346452.json:
```json
{
    "body": "<a id='comment:83'></a>\nRebased to 8.2.beta0\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0cf649fdb2d675ee8efcae9c9bfb974dd56db482\">0cf649f</a></td><td><code>Conversion between gmpy2 and Sage objects</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bc582a81638c2498bc6e1cb47811cf7b71ee7c98\">bc582a8</a></td><td><code>Cleaner and optional gmpy2 interface</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9528b59e0936668ff3c05ec9ced10c322c71e8ba\">9528b59</a></td><td><code>trac 22928 : add `__mpc__` function to Sage complex numbers</code></td></tr></table>\n",
    "created_at": "2017-12-14T12:06:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346452",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:83'></a>
Rebased to 8.2.beta0

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0cf649fdb2d675ee8efcae9c9bfb974dd56db482">0cf649f</a></td><td><code>Conversion between gmpy2 and Sage objects</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bc582a81638c2498bc6e1cb47811cf7b71ee7c98">bc582a8</a></td><td><code>Cleaner and optional gmpy2 interface</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9528b59e0936668ff3c05ec9ced10c322c71e8ba">9528b59</a></td><td><code>trac 22928 : add `__mpc__` function to Sage complex numbers</code></td></tr></table>




---

archive/issue_comments_346453.json:
```json
{
    "body": "<a id='comment:84'></a>\nThanks for the rebase.",
    "created_at": "2017-12-14T15:18:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346453",
    "user": "https://github.com/vinklein"
}
```

<a id='comment:84'></a>
Thanks for the rebase.



---

archive/issue_comments_346454.json:
```json
{
    "body": "**Dependencies:** #24417",
    "created_at": "2017-12-21T17:33:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346454",
    "user": "https://github.com/videlec"
}
```

**Dependencies:** #24417



---

archive/issue_comments_346455.json:
```json
{
    "body": "<a id='comment:86'></a>\nrebase on 24417 in progress.",
    "created_at": "2017-12-22T10:45:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346455",
    "user": "https://github.com/vinklein"
}
```

<a id='comment:86'></a>
rebase on 24417 in progress.



---

archive/issue_events_208147.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2017-12-22T10:45:17Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22928#event-208147"
}
```



---

archive/issue_events_208148.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2017-12-22T10:45:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22928#event-208148"
}
```



---

archive/issue_comments_346456.json:
```json
{
    "body": "**Changing branch** from \"[u/jdemeyer/conversion_between_gmpy2_and_sage_integers](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/conversion_between_gmpy2_and_sage_integers)\" to \"[u/vklein/conversion_between_gmpy2_and_sage_integers](https://github.com/sagemath/sagetrac-mirror/tree/u/vklein/conversion_between_gmpy2_and_sage_integers)\".",
    "created_at": "2017-12-22T17:05:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346456",
    "user": "https://github.com/vinklein"
}
```

**Changing branch** from "[u/jdemeyer/conversion_between_gmpy2_and_sage_integers](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/conversion_between_gmpy2_and_sage_integers)" to "[u/vklein/conversion_between_gmpy2_and_sage_integers](https://github.com/sagemath/sagetrac-mirror/tree/u/vklein/conversion_between_gmpy2_and_sage_integers)".



---

archive/issue_comments_346457.json:
```json
{
    "body": "<a id='comment:88'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/16cc1ad0729e26947786cab4c82040713c9324db\">16cc1ad</a></td><td><code>24417: fix gmpy2 segfaults in conversions</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/aaf54d38979a447a7b0e41b352e93ef0159ef91f\">aaf54d3</a></td><td><code>Conversion between gmpy2 and Sage objects</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4da4c9ba254c28d68aed23394d42c40cce583466\">4da4c9b</a></td><td><code>Cleaner and optional gmpy2 interface</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/01978e3951497753e85d0c9a2180a54030cb4732\">01978e3</a></td><td><code>trac 22928 : add `__mpc__` function to Sage complex numbers</code></td></tr></table>\n",
    "created_at": "2017-12-22T17:07:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346457",
    "user": "https://github.com/vinklein"
}
```

<a id='comment:88'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/16cc1ad0729e26947786cab4c82040713c9324db">16cc1ad</a></td><td><code>24417: fix gmpy2 segfaults in conversions</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/aaf54d38979a447a7b0e41b352e93ef0159ef91f">aaf54d3</a></td><td><code>Conversion between gmpy2 and Sage objects</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4da4c9ba254c28d68aed23394d42c40cce583466">4da4c9b</a></td><td><code>Cleaner and optional gmpy2 interface</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/01978e3951497753e85d0c9a2180a54030cb4732">01978e3</a></td><td><code>trac 22928 : add `__mpc__` function to Sage complex numbers</code></td></tr></table>




---

archive/issue_events_208149.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2017-12-22T17:07:29Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22928#event-208149"
}
```



---

archive/issue_events_208150.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2017-12-22T17:07:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22928#event-208150"
}
```



---

archive/issue_comments_346458.json:
```json
{
    "body": "**Changing commit** from \"[9528b59e0936668ff3c05ec9ced10c322c71e8ba](https://github.com/sagemath/sagetrac-mirror/commit/9528b59e0936668ff3c05ec9ced10c322c71e8ba)\" to \"[01978e3951497753e85d0c9a2180a54030cb4732](https://github.com/sagemath/sagetrac-mirror/commit/01978e3951497753e85d0c9a2180a54030cb4732)\".",
    "created_at": "2017-12-22T17:07:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346458",
    "user": "https://github.com/vinklein"
}
```

**Changing commit** from "[9528b59e0936668ff3c05ec9ced10c322c71e8ba](https://github.com/sagemath/sagetrac-mirror/commit/9528b59e0936668ff3c05ec9ced10c322c71e8ba)" to "[01978e3951497753e85d0c9a2180a54030cb4732](https://github.com/sagemath/sagetrac-mirror/commit/01978e3951497753e85d0c9a2180a54030cb4732)".



---

archive/issue_events_208151.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2018-01-02T20:24:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22928#event-208151"
}
```



---

archive/issue_events_208152.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2018-01-02T20:24:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22928#event-208152"
}
```



---

archive/issue_comments_346459.json:
```json
{
    "body": "<a id='comment:89'></a>\nSome trivial merge/rebase to be done on 8.2.beta2",
    "created_at": "2018-01-02T20:24:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346459",
    "user": "https://github.com/videlec"
}
```

<a id='comment:89'></a>
Some trivial merge/rebase to be done on 8.2.beta2



---

archive/issue_comments_346460.json:
```json
{
    "body": "<a id='comment:90'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ca21a733b0fc2c968c30acea1b0d3037084f81a1\">ca21a73</a></td><td><code>Conversion between gmpy2 and Sage objects</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2c3c349a60fe6044d15b93eb0b677c95147f6e5d\">2c3c349</a></td><td><code>Cleaner and optional gmpy2 interface</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b1481a2aed0ca67bf974ef85a772a97d587a7a2d\">b1481a2</a></td><td><code>trac 22928 : add `__mpc__` function to Sage complex numbers</code></td></tr></table>\n",
    "created_at": "2018-01-14T17:18:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346460",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:90'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ca21a733b0fc2c968c30acea1b0d3037084f81a1">ca21a73</a></td><td><code>Conversion between gmpy2 and Sage objects</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2c3c349a60fe6044d15b93eb0b677c95147f6e5d">2c3c349</a></td><td><code>Cleaner and optional gmpy2 interface</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b1481a2aed0ca67bf974ef85a772a97d587a7a2d">b1481a2</a></td><td><code>trac 22928 : add `__mpc__` function to Sage complex numbers</code></td></tr></table>




---

archive/issue_comments_346461.json:
```json
{
    "body": "**Changing commit** from \"[01978e3951497753e85d0c9a2180a54030cb4732](https://github.com/sagemath/sagetrac-mirror/commit/01978e3951497753e85d0c9a2180a54030cb4732)\" to \"[b1481a2aed0ca67bf974ef85a772a97d587a7a2d](https://github.com/sagemath/sagetrac-mirror/commit/b1481a2aed0ca67bf974ef85a772a97d587a7a2d)\".",
    "created_at": "2018-01-14T17:18:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346461",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[01978e3951497753e85d0c9a2180a54030cb4732](https://github.com/sagemath/sagetrac-mirror/commit/01978e3951497753e85d0c9a2180a54030cb4732)" to "[b1481a2aed0ca67bf974ef85a772a97d587a7a2d](https://github.com/sagemath/sagetrac-mirror/commit/b1481a2aed0ca67bf974ef85a772a97d587a7a2d)".



---

archive/issue_events_208153.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2018-01-14T17:20:23Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22928#event-208153"
}
```



---

archive/issue_events_208154.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2018-01-14T17:20:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22928#event-208154"
}
```



---

archive/issue_comments_346462.json:
```json
{
    "body": "<a id='comment:91'></a>\nRebase on 8.2.beta2",
    "created_at": "2018-01-14T17:20:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346462",
    "user": "https://github.com/vinklein"
}
```

<a id='comment:91'></a>
Rebase on 8.2.beta2



---

archive/issue_events_208155.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2018-01-15T16:00:49Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22928#event-208155"
}
```



---

archive/issue_events_208156.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2018-01-15T16:00:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22928#event-208156"
}
```



---

archive/issue_comments_346463.json:
```json
{
    "body": "<a id='comment:92'></a>\nSage is crashing\n\n```\nImportError: /opt/sage/local/lib/python2.7/site-packages/sage/rings/complex_number.so: undefined symbol: mpc_set_fr_fr\n```\nThe reason is that you are importing `from sage.libs.mpc cimport *` in `complex_number.pyx` and that this header file does not have the proper distutils directive. Just apply the patch\n\n```diff\ndiff --git a/src/sage/libs/mpc.pxd b/src/sage/libs/mpc.pxd\nindex 0e12d31468..0067b8b126 100644\n--- a/src/sage/libs/mpc.pxd\n+++ b/src/sage/libs/mpc.pxd\n@@ -1,3 +1,5 @@\n+# distutils: libraries = gmp mpfr mpc\n+\n from sage.libs.gmp.types cimport *\n from sage.libs.mpfr.types cimport *\n```",
    "created_at": "2018-01-15T16:00:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346463",
    "user": "https://github.com/videlec"
}
```

<a id='comment:92'></a>
Sage is crashing

```
ImportError: /opt/sage/local/lib/python2.7/site-packages/sage/rings/complex_number.so: undefined symbol: mpc_set_fr_fr
```
The reason is that you are importing `from sage.libs.mpc cimport *` in `complex_number.pyx` and that this header file does not have the proper distutils directive. Just apply the patch

```diff
diff --git a/src/sage/libs/mpc.pxd b/src/sage/libs/mpc.pxd
index 0e12d31468..0067b8b126 100644
--- a/src/sage/libs/mpc.pxd
+++ b/src/sage/libs/mpc.pxd
@@ -1,3 +1,5 @@
+# distutils: libraries = gmp mpfr mpc
+
 from sage.libs.gmp.types cimport *
 from sage.libs.mpfr.types cimport *
```



---

archive/issue_comments_346464.json:
```json
{
    "body": "<a id='comment:93'></a>\nYou should test different precisions for each possible type (that is `RealField(prec)`, `ComplexField(prec)` and `MPComplexField(prec)`).",
    "created_at": "2018-01-15T16:04:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346464",
    "user": "https://github.com/videlec"
}
```

<a id='comment:93'></a>
You should test different precisions for each possible type (that is `RealField(prec)`, `ComplexField(prec)` and `MPComplexField(prec)`).



---

archive/issue_comments_346465.json:
```json
{
    "body": "<a id='comment:94'></a>\nThe following is not nice\n\n```\nsage: gmpy2.mpfr(gmpy2.mpq('1/3'), precision=123).precision\n123\nsage: RealNumber(gmpy2.mpfr(gmpy2.mpq('1/3'), precision=123))\n0.33333333333333333333333333333333333332\nsage: _.prec()    # why not 123?\n130\n```\nAnd this is even worse\n\n```\nsage: ComplexNumber(gmpy2.mpc(gmpy2.mpq('1/3'), precision=123r))\nTraceback (most recent call last):\n...\nTypeError: unable to coerce to a ComplexNumber: <type 'str'>\n```",
    "created_at": "2018-01-15T16:04:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346465",
    "user": "https://github.com/videlec"
}
```

<a id='comment:94'></a>
The following is not nice

```
sage: gmpy2.mpfr(gmpy2.mpq('1/3'), precision=123).precision
123
sage: RealNumber(gmpy2.mpfr(gmpy2.mpq('1/3'), precision=123))
0.33333333333333333333333333333333333332
sage: _.prec()    # why not 123?
130
```
And this is even worse

```
sage: ComplexNumber(gmpy2.mpc(gmpy2.mpq('1/3'), precision=123r))
Traceback (most recent call last):
...
TypeError: unable to coerce to a ComplexNumber: <type 'str'>
```



---

archive/issue_comments_346466.json:
```json
{
    "body": "<a id='comment:95'></a>\nFunny behavior of `gmpy2` precision with Sage integers\n\n```\nsage: gmpy2.mpfr('1.0', precision=40)\nmpfr('1.0',40)\nsage: gmpy2.mpc('1.0', precision=40)\nTraceback (most recent call last):\n...\nTypeError: precision for mpc() must be integer or tuple\n```\nIs that worth an issue?",
    "created_at": "2018-01-15T16:05:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346466",
    "user": "https://github.com/videlec"
}
```

<a id='comment:95'></a>
Funny behavior of `gmpy2` precision with Sage integers

```
sage: gmpy2.mpfr('1.0', precision=40)
mpfr('1.0',40)
sage: gmpy2.mpc('1.0', precision=40)
Traceback (most recent call last):
...
TypeError: precision for mpc() must be integer or tuple
```
Is that worth an issue?



---

archive/issue_comments_346467.json:
```json
{
    "body": "<a id='comment:96'></a>\n> \n> ```diff\n> diff --git a/src/sage/libs/mpc.pxd b/src/sage/libs/mpc.pxd\n> index 0e12d31468..0067b8b126 100644\n> --- a/src/sage/libs/mpc.pxd\n> +++ b/src/sage/libs/mpc.pxd\n> @@ -1,3 +1,5 @@\n> +# distutils: libraries = gmp mpfr mpc\n> +\n>  from sage.libs.gmp.types cimport *\n>  from sage.libs.mpfr.types cimport *\n> ```\n\nI have miss this one but encoutered it on 23024. It has been solved by updating module_list.py \nby adding mpc as a lib to sage.rings.complex_number Extension. \nWhat is the best way to fix it between these two ?",
    "created_at": "2018-01-15T16:13:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346467",
    "user": "https://github.com/vinklein"
}
```

<a id='comment:96'></a>
> 
> ```diff
> diff --git a/src/sage/libs/mpc.pxd b/src/sage/libs/mpc.pxd
> index 0e12d31468..0067b8b126 100644
> --- a/src/sage/libs/mpc.pxd
> +++ b/src/sage/libs/mpc.pxd
> @@ -1,3 +1,5 @@
> +# distutils: libraries = gmp mpfr mpc
> +
>  from sage.libs.gmp.types cimport *
>  from sage.libs.mpfr.types cimport *
> ```

I have miss this one but encoutered it on 23024. It has been solved by updating module_list.py 
by adding mpc as a lib to sage.rings.complex_number Extension. 
What is the best way to fix it between these two ?



---

archive/issue_comments_346468.json:
```json
{
    "body": "<a id='comment:97'></a>\nModifying `module_list.py` is not a good idea. If I write my own Cython file with\n\n```\nfrom sage.rings.complex_number cimport whatever\n```\nThen my program will not compile.\n\naddendum: will not compile if I do not explicitely state that my program needs to be linked against mpc... that would better to be automatic (especially in interactive use of Cython inside Sage)",
    "created_at": "2018-01-15T16:17:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346468",
    "user": "https://github.com/videlec"
}
```

<a id='comment:97'></a>
Modifying `module_list.py` is not a good idea. If I write my own Cython file with

```
from sage.rings.complex_number cimport whatever
```
Then my program will not compile.

addendum: will not compile if I do not explicitely state that my program needs to be linked against mpc... that would better to be automatic (especially in interactive use of Cython inside Sage)



---

archive/issue_comments_346469.json:
```json
{
    "body": "<a id='comment:98'></a>\nOk i see.\n\nReplying to [vdelecroix](#comment%3A95):\n> Funny behavior of `gmpy2` precision with Sage integers\n> \n> ```\n> sage: gmpy2.mpfr('1.0', precision=40)\n> mpfr('1.0',40)\n> sage: gmpy2.mpc('1.0', precision=40)\n> Traceback (most recent call last):\n> ...\n> TypeError: precision for mpc() must be integer or tuple\n> ```\n> Is that worth an issue?\n\nI think it is. I will look at it and open an issue if needed.",
    "created_at": "2018-01-15T16:27:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346469",
    "user": "https://github.com/vinklein"
}
```

<a id='comment:98'></a>
Ok i see.

Replying to [vdelecroix](#comment%3A95):
> Funny behavior of `gmpy2` precision with Sage integers
> 
> ```
> sage: gmpy2.mpfr('1.0', precision=40)
> mpfr('1.0',40)
> sage: gmpy2.mpc('1.0', precision=40)
> Traceback (most recent call last):
> ...
> TypeError: precision for mpc() must be integer or tuple
> ```
> Is that worth an issue?

I think it is. I will look at it and open an issue if needed.



---

archive/issue_comments_346470.json:
```json
{
    "body": "**Changing dependencies** from \"#24417\" to \"#24549\".",
    "created_at": "2018-01-16T14:51:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346470",
    "user": "https://github.com/jdemeyer"
}
```

**Changing dependencies** from "#24417" to "#24549".



---

archive/issue_comments_346471.json:
```json
{
    "body": "<a id='comment:99'></a>\nReplying to [vdelecroix](#comment%3A92):\n> \n> ```diff\n> diff --git a/src/sage/libs/mpc.pxd b/src/sage/libs/mpc.pxd\n> index 0e12d31468..0067b8b126 100644\n> --- a/src/sage/libs/mpc.pxd\n> +++ b/src/sage/libs/mpc.pxd\n> @@ -1,3 +1,5 @@\n> +# distutils: libraries = gmp mpfr mpc\n> +\n>  from sage.libs.gmp.types cimport *\n>  from sage.libs.mpfr.types cimport *\n> ```\n\n\nSee #24549 for that.",
    "created_at": "2018-01-16T14:51:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346471",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:99'></a>
Replying to [vdelecroix](#comment%3A92):
> 
> ```diff
> diff --git a/src/sage/libs/mpc.pxd b/src/sage/libs/mpc.pxd
> index 0e12d31468..0067b8b126 100644
> --- a/src/sage/libs/mpc.pxd
> +++ b/src/sage/libs/mpc.pxd
> @@ -1,3 +1,5 @@
> +# distutils: libraries = gmp mpfr mpc
> +
>  from sage.libs.gmp.types cimport *
>  from sage.libs.mpfr.types cimport *
> ```


See #24549 for that.



---

archive/issue_comments_346472.json:
```json
{
    "body": "<a id='comment:100'></a>\nReplying to [vdelecroix](#comment%3A94):\n> And this is even worse\n> \n> ```\n> sage: ComplexNumber(gmpy2.mpc(gmpy2.mpq('1/3'), precision=123r))\n> Traceback (most recent call last):\n> ...\n> TypeError: unable to coerce to a ComplexNumber: <type 'str'>\n> ```\n\n\nBut should we really use [ComplexNumber](ComplexNumber) this way ?\\\\\nThis call the function create_ComplexNumber and his first parameter is supposed to be the real part only.\n\\\\\nIn your call the first parameter is the whole complex number.\n\\\\\nSecondly create_ComplexNumber always try to convert the parameters (real and imag) into string before calling the [ComplexNumber](ComplexNumber) constructor. \\\\\nGiven that if you try to call ComplexNumber() with another complex type as parameter you will get the same result :\n\n```\nsage: cn = ComplexNumber(5,4)\nsage: ComplexNumber(cn)\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n...\nTypeError: unable to coerce to a ComplexNumber: <type 'str'>\n```",
    "created_at": "2018-01-16T15:47:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346472",
    "user": "https://github.com/vinklein"
}
```

<a id='comment:100'></a>
Replying to [vdelecroix](#comment%3A94):
> And this is even worse
> 
> ```
> sage: ComplexNumber(gmpy2.mpc(gmpy2.mpq('1/3'), precision=123r))
> Traceback (most recent call last):
> ...
> TypeError: unable to coerce to a ComplexNumber: <type 'str'>
> ```


But should we really use [ComplexNumber](ComplexNumber) this way ?\\
This call the function create_ComplexNumber and his first parameter is supposed to be the real part only.
\\
In your call the first parameter is the whole complex number.
\\
Secondly create_ComplexNumber always try to convert the parameters (real and imag) into string before calling the [ComplexNumber](ComplexNumber) constructor. \\
Given that if you try to call ComplexNumber() with another complex type as parameter you will get the same result :

```
sage: cn = ComplexNumber(5,4)
sage: ComplexNumber(cn)
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
...
TypeError: unable to coerce to a ComplexNumber: <type 'str'>
```



---

archive/issue_comments_346473.json:
```json
{
    "body": "<a id='comment:1'></a>\nThe `ComplexNumber` function is wrong in several ways (see #13110). Just ignore it.",
    "created_at": "2018-01-17T12:35:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346473",
    "user": "https://github.com/videlec"
}
```

<a id='comment:1'></a>
The `ComplexNumber` function is wrong in several ways (see #13110). Just ignore it.



---

archive/issue_comments_346474.json:
```json
{
    "body": "<a id='comment:102'></a>\nReplying to [vdelecroix](#comment%3A94):\n> The following is not nice\n> \n> ```\n> sage: gmpy2.mpfr(gmpy2.mpq('1/3'), precision=123).precision\n> 123\n> sage: RealNumber(gmpy2.mpfr(gmpy2.mpq('1/3'), precision=123))\n> 0.33333333333333333333333333333333333332\n> sage: _.prec()    # why not 123?\n> 130\n> ```\n\n\nThat being said the gmpy2's precision is not currently transmitted with `RR` function.\n\n```\nsage: RR(gmpy2.mpfr(gmpy2.mpq('1/3'), precision=123))\n0.333333333333333\nsage: _.prec()\n53\n```\n\nI am on it.",
    "created_at": "2018-01-22T09:26:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346474",
    "user": "https://github.com/vinklein"
}
```

<a id='comment:102'></a>
Replying to [vdelecroix](#comment%3A94):
> The following is not nice
> 
> ```
> sage: gmpy2.mpfr(gmpy2.mpq('1/3'), precision=123).precision
> 123
> sage: RealNumber(gmpy2.mpfr(gmpy2.mpq('1/3'), precision=123))
> 0.33333333333333333333333333333333333332
> sage: _.prec()    # why not 123?
> 130
> ```


That being said the gmpy2's precision is not currently transmitted with `RR` function.

```
sage: RR(gmpy2.mpfr(gmpy2.mpq('1/3'), precision=123))
0.333333333333333
sage: _.prec()
53
```

I am on it.



---

archive/issue_comments_346475.json:
```json
{
    "body": "<a id='comment:3'></a>\nThe only fix i see so far would be do a new `mpfr_init2` during `_set ` call. It's a little ugly :\n\n```\n#real_mpfr.pyx line 1467\n   elif HAVE_GMPY2 and type(x) is gmpy2.mpfr:\n       self._parent = self._parent.to_prec(x.precision)\n       mpfr_init2(self.value, x.precision)\n       mpfr_set(self.value, (<gmpy2.mpfr>x).f, parent.rnd)\n```\n\nOr we can assume the user shoud do that :\n\n```\nsage: R = RealField(128)\nsage: R(gmpy2.mpfr(gmpy2.mpq('1/3'), precision=128))\n0.33333333333333333333333333333333333333\nsage: _.prec()\n128\n```",
    "created_at": "2018-01-22T10:54:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346475",
    "user": "https://github.com/vinklein"
}
```

<a id='comment:3'></a>
The only fix i see so far would be do a new `mpfr_init2` during `_set ` call. It's a little ugly :

```
#real_mpfr.pyx line 1467
   elif HAVE_GMPY2 and type(x) is gmpy2.mpfr:
       self._parent = self._parent.to_prec(x.precision)
       mpfr_init2(self.value, x.precision)
       mpfr_set(self.value, (<gmpy2.mpfr>x).f, parent.rnd)
```

Or we can assume the user shoud do that :

```
sage: R = RealField(128)
sage: R(gmpy2.mpfr(gmpy2.mpq('1/3'), precision=128))
0.33333333333333333333333333333333333333
sage: _.prec()
128
```



---

archive/issue_comments_346476.json:
```json
{
    "body": "<a id='comment:4'></a>\n`RealNumber` should be ignored for the same reason (it is aimed to be used by the preparser). You can read #13110 that I already mentioned in [comment:101](#comment%3A101).",
    "created_at": "2018-01-22T14:28:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346476",
    "user": "https://github.com/videlec"
}
```

<a id='comment:4'></a>
`RealNumber` should be ignored for the same reason (it is aimed to be used by the preparser). You can read #13110 that I already mentioned in [comment:101](#comment%3A101).



---

archive/issue_comments_346477.json:
```json
{
    "body": "<a id='comment:5'></a>\nSure ! My current question was more about what should we do for the `RR` function. Should we transmit the precision (and replacing the parent during `__c_init__` or during `_set`) or rely on a consistent usage of `RealField` ?",
    "created_at": "2018-01-22T14:35:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346477",
    "user": "https://github.com/vinklein"
}
```

<a id='comment:5'></a>
Sure ! My current question was more about what should we do for the `RR` function. Should we transmit the precision (and replacing the parent during `__c_init__` or during `_set`) or rely on a consistent usage of `RealField` ?



---

archive/issue_comments_346478.json:
```json
{
    "body": "<a id='comment:106'></a>\nReplying to [vklein](#comment%3A102):\n> Replying to [vdelecroix](#comment%3A94):\n> \n> ```\n> sage: RR(gmpy2.mpfr(gmpy2.mpq('1/3'), precision=123))\n> 0.333333333333333\n> sage: _.prec()\n> 53\n> ```\n\n\nThat's fine. `RR` is the field of floating-point numbers with 53 bits of precision (stupidly named).",
    "created_at": "2018-01-22T16:44:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346478",
    "user": "https://github.com/videlec"
}
```

<a id='comment:106'></a>
Replying to [vklein](#comment%3A102):
> Replying to [vdelecroix](#comment%3A94):
> 
> ```
> sage: RR(gmpy2.mpfr(gmpy2.mpq('1/3'), precision=123))
> 0.333333333333333
> sage: _.prec()
> 53
> ```


That's fine. `RR` is the field of floating-point numbers with 53 bits of precision (stupidly named).



---

archive/issue_comments_346479.json:
```json
{
    "body": "<a id='comment:7'></a>\nThat is to say: `RR` is not a function. It is the object `RealField(53)`.\n\n```\nsage: RR is RealField(53)\nTrue\n```",
    "created_at": "2018-01-22T18:05:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346479",
    "user": "https://github.com/videlec"
}
```

<a id='comment:7'></a>
That is to say: `RR` is not a function. It is the object `RealField(53)`.

```
sage: RR is RealField(53)
True
```



---

archive/issue_comments_346480.json:
```json
{
    "body": "**Changing commit** from \"[b1481a2aed0ca67bf974ef85a772a97d587a7a2d](https://github.com/sagemath/sagetrac-mirror/commit/b1481a2aed0ca67bf974ef85a772a97d587a7a2d)\" to \"[e9188bae6e2e5407101d1ef46f3343b7250ae375](https://github.com/sagemath/sagetrac-mirror/commit/e9188bae6e2e5407101d1ef46f3343b7250ae375)\".",
    "created_at": "2018-01-23T10:51:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346480",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[b1481a2aed0ca67bf974ef85a772a97d587a7a2d](https://github.com/sagemath/sagetrac-mirror/commit/b1481a2aed0ca67bf974ef85a772a97d587a7a2d)" to "[e9188bae6e2e5407101d1ef46f3343b7250ae375](https://github.com/sagemath/sagetrac-mirror/commit/e9188bae6e2e5407101d1ef46f3343b7250ae375)".



---

archive/issue_comments_346481.json:
```json
{
    "body": "<a id='comment:8'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b1047cce75651690fda2ee0a64d59b56110634b3\">b1047cc</a></td><td><code>Clean up MPC declarations</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d9308b29558240d8100e8b7d72bfd00a1d83a589\">d9308b2</a></td><td><code>Conversion between gmpy2 and Sage objects</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/074acd61e20ed39a1147edf2de8c6efb1cfc1c53\">074acd6</a></td><td><code>Cleaner and optional gmpy2 interface</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2604a3745b9636c5de4bb9a84ee88055c1681c90\">2604a37</a></td><td><code>trac 22928 : add `__mpc__` function to Sage complex numbers</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e9188bae6e2e5407101d1ef46f3343b7250ae375\">e9188ba</a></td><td><code>Trac #22928: Test different precisions for each possible type</code></td></tr></table>\n",
    "created_at": "2018-01-23T10:51:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346481",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b1047cce75651690fda2ee0a64d59b56110634b3">b1047cc</a></td><td><code>Clean up MPC declarations</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d9308b29558240d8100e8b7d72bfd00a1d83a589">d9308b2</a></td><td><code>Conversion between gmpy2 and Sage objects</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/074acd61e20ed39a1147edf2de8c6efb1cfc1c53">074acd6</a></td><td><code>Cleaner and optional gmpy2 interface</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2604a3745b9636c5de4bb9a84ee88055c1681c90">2604a37</a></td><td><code>trac 22928 : add `__mpc__` function to Sage complex numbers</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e9188bae6e2e5407101d1ef46f3343b7250ae375">e9188ba</a></td><td><code>Trac #22928: Test different precisions for each possible type</code></td></tr></table>




---

archive/issue_events_208157.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2018-01-23T10:54:51Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22928#event-208157"
}
```



---

archive/issue_events_208158.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2018-01-23T10:54:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22928#event-208158"
}
```



---

archive/issue_comments_346482.json:
```json
{
    "body": "<a id='comment:9'></a>\nAdd some test with different precision [ticket:22928#comment:93 [comment:93](#comment%3A93)].\\\\\nRebase on #24549.",
    "created_at": "2018-01-23T10:54:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346482",
    "user": "https://github.com/vinklein"
}
```

<a id='comment:9'></a>
Add some test with different precision [ticket:22928#comment:93 [comment:93](#comment%3A93)].\\
Rebase on #24549.



---

archive/issue_comments_346483.json:
```json
{
    "body": "<a id='comment:0'></a>\nYou do not need to put `# optional - gmpy2` everywhere. Only where you explicitely need `gmpy2`.\n\nCould you also doctest the fact that the composition of conversions `Sage number -> gmpy2 number -> Sage number` is the identity when precisions are set appropriately (ie we get back an equal element)? For example\n\n```\nsage: MPCF = MPComplexField(63)\nsage: x = MPCF('15.64E+128', '15.64E+128')\nsage: y = mpc(x)         # optional - gmpy2\nsage: y.precision        # optional - gmpy2\n(63, 63)\nsage: MPCF(y) == x       # optional - gmpy2\nTrue\n```\nAnd also the other way around `gmpy2 number -> Sage number -> gmpy2 number`\n\n```\nsage: x = gmpy2.mpc('1.324+4e50j', precision=(70,70))  # optional - gmpy2\nsage: y = ComplexField(70)(x)                          # optional - gmpy2\nsage: gmpy2.mpc(y) == x                                # optional - gmpy2\nTrue\n```",
    "created_at": "2018-01-23T11:04:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346483",
    "user": "https://github.com/videlec"
}
```

<a id='comment:0'></a>
You do not need to put `# optional - gmpy2` everywhere. Only where you explicitely need `gmpy2`.

Could you also doctest the fact that the composition of conversions `Sage number -> gmpy2 number -> Sage number` is the identity when precisions are set appropriately (ie we get back an equal element)? For example

```
sage: MPCF = MPComplexField(63)
sage: x = MPCF('15.64E+128', '15.64E+128')
sage: y = mpc(x)         # optional - gmpy2
sage: y.precision        # optional - gmpy2
(63, 63)
sage: MPCF(y) == x       # optional - gmpy2
True
```
And also the other way around `gmpy2 number -> Sage number -> gmpy2 number`

```
sage: x = gmpy2.mpc('1.324+4e50j', precision=(70,70))  # optional - gmpy2
sage: y = ComplexField(70)(x)                          # optional - gmpy2
sage: gmpy2.mpc(y) == x                                # optional - gmpy2
True
```



---

archive/issue_events_208159.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2018-01-23T13:03:29Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22928#event-208159"
}
```



---

archive/issue_events_208160.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2018-01-23T13:03:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22928#event-208160"
}
```



---

archive/issue_comments_346484.json:
```json
{
    "body": "<a id='comment:111'></a>\nOk i will add this type of doctest.",
    "created_at": "2018-01-23T13:03:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346484",
    "user": "https://github.com/vinklein"
}
```

<a id='comment:111'></a>
Ok i will add this type of doctest.



---

archive/issue_comments_346485.json:
```json
{
    "body": "<a id='comment:2'></a>\nThese tests works with `MPComplexField` and `RealField` but they didn't work with `ComplexField` in `gmpy2 number -> Sage number -> gmpy2 number` way :\n\n```\nsage: x = gmpy2.mpc('1.324+4e50j', precision=(70,70))\nsage: y = ComplexField(70)(x)\nsage: gmpy2.mpc(y) == x\nFalse\nsage: x\nmpc('1.3240000000000000000005+3.9999999999999999999976e+50j',(70,70))\nsage: gmpy2.mpc(y)\nmpc('1.3240000000000000657252+4.0000000000000003051908e+50j',(70,70))\n```\nIs this an issue or a normal rounding behaviour ?",
    "created_at": "2018-01-23T13:56:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346485",
    "user": "https://github.com/vinklein"
}
```

<a id='comment:2'></a>
These tests works with `MPComplexField` and `RealField` but they didn't work with `ComplexField` in `gmpy2 number -> Sage number -> gmpy2 number` way :

```
sage: x = gmpy2.mpc('1.324+4e50j', precision=(70,70))
sage: y = ComplexField(70)(x)
sage: gmpy2.mpc(y) == x
False
sage: x
mpc('1.3240000000000000000005+3.9999999999999999999976e+50j',(70,70))
sage: gmpy2.mpc(y)
mpc('1.3240000000000000657252+4.0000000000000003051908e+50j',(70,70))
```
Is this an issue or a normal rounding behaviour ?



---

archive/issue_comments_346486.json:
```json
{
    "body": "<a id='comment:113'></a>\nReplying to [vklein](#comment%3A112):\n> These tests works with `MPComplexField` and `RealField` but they didn't work with `ComplexField` in `gmpy2 number -> Sage number -> gmpy2 number` way :\n> \n> ```\n> sage: x = gmpy2.mpc('1.324+4e50j', precision=(70,70))\n> sage: y = ComplexField(70)(x)\n> sage: gmpy2.mpc(y) == x\n> False\n> ```\n> Is this an issue or a normal rounding behaviour ?\n\n\nTo me, this is an issue. The code in your example should just be copying `mpfr_t` values around.",
    "created_at": "2018-01-23T15:06:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346486",
    "user": "https://github.com/videlec"
}
```

<a id='comment:113'></a>
Replying to [vklein](#comment%3A112):
> These tests works with `MPComplexField` and `RealField` but they didn't work with `ComplexField` in `gmpy2 number -> Sage number -> gmpy2 number` way :
> 
> ```
> sage: x = gmpy2.mpc('1.324+4e50j', precision=(70,70))
> sage: y = ComplexField(70)(x)
> sage: gmpy2.mpc(y) == x
> False
> ```
> Is this an issue or a normal rounding behaviour ?


To me, this is an issue. The code in your example should just be copying `mpfr_t` values around.



---

archive/issue_comments_346487.json:
```json
{
    "body": "<a id='comment:4'></a>\nAre you sure that `precision` means the same thing on both sides?",
    "created_at": "2018-01-23T15:07:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346487",
    "user": "https://github.com/videlec"
}
```

<a id='comment:4'></a>
Are you sure that `precision` means the same thing on both sides?



---

archive/issue_comments_346488.json:
```json
{
    "body": "<a id='comment:5'></a>\nI think that the problem is that we just copy the values of real and imag part and both of them are `gmpy2.mpfr` with their own precision.\n\n```\nsage: x = gmpy2.mpc('1.324+4e50j', precision=(70,70))\nsage: x.precision\n(70, 70)\nsage: x.real.precision\n53\nsage: x.imag.precision\n53\nsage: x\nmpc('1.3240000000000000000005+3.9999999999999999999976e+50j',(70,70))\nsage: x.real, x.imag\n(mpfr('1.3240000000000001'), mpfr('4.0000000000000003e+50'))\n```\n\n`MPComplexField` works fine because it use mpc_set and not two mpfr_set.",
    "created_at": "2018-01-23T15:54:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346488",
    "user": "https://github.com/vinklein"
}
```

<a id='comment:5'></a>
I think that the problem is that we just copy the values of real and imag part and both of them are `gmpy2.mpfr` with their own precision.

```
sage: x = gmpy2.mpc('1.324+4e50j', precision=(70,70))
sage: x.precision
(70, 70)
sage: x.real.precision
53
sage: x.imag.precision
53
sage: x
mpc('1.3240000000000000000005+3.9999999999999999999976e+50j',(70,70))
sage: x.real, x.imag
(mpfr('1.3240000000000001'), mpfr('4.0000000000000003e+50'))
```

`MPComplexField` works fine because it use mpc_set and not two mpfr_set.



---

archive/issue_comments_346489.json:
```json
{
    "body": "<a id='comment:6'></a>\nI don't know if it is a bug from `gmpy2` but having `x.real` to return a double precision and not the corresponding `gmpy2.mpfr` with the same precision as the real part is weird. Would be nice to see whether it is intended in `gmpy2`.\n\nFor this ticket you could just avoid using `.real` and `.imag` in the `ComplexNumber` code.",
    "created_at": "2018-01-23T15:59:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346489",
    "user": "https://github.com/videlec"
}
```

<a id='comment:6'></a>
I don't know if it is a bug from `gmpy2` but having `x.real` to return a double precision and not the corresponding `gmpy2.mpfr` with the same precision as the real part is weird. Would be nice to see whether it is intended in `gmpy2`.

For this ticket you could just avoid using `.real` and `.imag` in the `ComplexNumber` code.



---

archive/issue_comments_346490.json:
```json
{
    "body": "<a id='comment:7'></a>\nSpecification are really cool!\n\n```\nimag\n    Returns the imaginary component.\nreal\n    Returns the real component.\n```\n(see https://github.com/aleaxit/gmpy/blob/master/docs/mpc.rst)",
    "created_at": "2018-01-23T16:01:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346490",
    "user": "https://github.com/videlec"
}
```

<a id='comment:7'></a>
Specification are really cool!

```
imag
    Returns the imaginary component.
real
    Returns the real component.
```
(see https://github.com/aleaxit/gmpy/blob/master/docs/mpc.rst)



---

archive/issue_comments_346491.json:
```json
{
    "body": "<a id='comment:8'></a>\nYes very accurate !\n\nIt works fine without `.real` and `.imag`. Tests are running now.",
    "created_at": "2018-01-23T16:53:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346491",
    "user": "https://github.com/vinklein"
}
```

<a id='comment:8'></a>
Yes very accurate !

It works fine without `.real` and `.imag`. Tests are running now.



---

archive/issue_comments_346492.json:
```json
{
    "body": "**Changing commit** from \"[e9188bae6e2e5407101d1ef46f3343b7250ae375](https://github.com/sagemath/sagetrac-mirror/commit/e9188bae6e2e5407101d1ef46f3343b7250ae375)\" to \"[5d044bfb4c8ada79db6e8b0147a1f1120cf49a9d](https://github.com/sagemath/sagetrac-mirror/commit/5d044bfb4c8ada79db6e8b0147a1f1120cf49a9d)\".",
    "created_at": "2018-01-23T21:13:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346492",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[e9188bae6e2e5407101d1ef46f3343b7250ae375](https://github.com/sagemath/sagetrac-mirror/commit/e9188bae6e2e5407101d1ef46f3343b7250ae375)" to "[5d044bfb4c8ada79db6e8b0147a1f1120cf49a9d](https://github.com/sagemath/sagetrac-mirror/commit/5d044bfb4c8ada79db6e8b0147a1f1120cf49a9d)".



---

archive/issue_comments_346493.json:
```json
{
    "body": "<a id='comment:9'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5d044bfb4c8ada79db6e8b0147a1f1120cf49a9d\">5d044bf</a></td><td><code>Trac #22928: Add tests and fix a bug with precision</code></td></tr></table>\n",
    "created_at": "2018-01-23T21:13:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346493",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5d044bfb4c8ada79db6e8b0147a1f1120cf49a9d">5d044bf</a></td><td><code>Trac #22928: Add tests and fix a bug with precision</code></td></tr></table>




---

archive/issue_events_208161.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2018-01-23T21:14:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22928#event-208161"
}
```



---

archive/issue_events_208162.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2018-01-23T21:14:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22928#event-208162"
}
```



---

archive/issue_comments_346494.json:
```json
{
    "body": "<a id='comment:1'></a>\nDo you really need the cast `<mpc_t>`? This is already explicit in the `gmpy2` Cython header.",
    "created_at": "2018-01-24T08:04:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346494",
    "user": "https://github.com/videlec"
}
```

<a id='comment:1'></a>
Do you really need the cast `<mpc_t>`? This is already explicit in the `gmpy2` Cython header.



---

archive/issue_comments_346495.json:
```json
{
    "body": "<a id='comment:2'></a>\nI think i do at least \n\n```\n mpfr_set(self.__im, (<gmpy2.mpc>real).c.im, rnd)\n                                                      ^\n------------------------------------------------------------\n\nsage/rings/complex_number.pyx:197:55: Cannot convert Python object to '__mpfr_struct *'\n```\n\nWhat syntax would you suggest ?",
    "created_at": "2018-01-24T08:16:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346495",
    "user": "https://github.com/vinklein"
}
```

<a id='comment:2'></a>
I think i do at least 

```
 mpfr_set(self.__im, (<gmpy2.mpc>real).c.im, rnd)
                                                      ^
------------------------------------------------------------

sage/rings/complex_number.pyx:197:55: Cannot convert Python object to '__mpfr_struct *'
```

What syntax would you suggest ?



---

archive/issue_comments_346496.json:
```json
{
    "body": "<a id='comment:123'></a>\nReplying to [vklein](#comment%3A122):\n> I think i do at least \n> \n> ```\n>  mpfr_set(self.__im, (<gmpy2.mpc>real).c.im, rnd)\n>                                                       ^\n> ------------------------------------------------------------\n> \n> sage/rings/complex_number.pyx:197:55: Cannot convert Python object to '__mpfr_struct *'\n> ```\n> \n> What syntax would you suggest ?\n\n\nThe one in your comment. There might be something wrong with the Cython headers. Maybe the following change in `gmpy2.pxd` might be enough \n\n```diff\ndiff --git a/src/gmpy2.pxd b/src/gmpy2.pxd\nindex 7cdcc72..d6cac1b 100644\n--- a/src/gmpy2.pxd\n+++ b/src/gmpy2.pxd\n@@ -45,7 +45,8 @@ cdef extern from \"mpfr.h\":\n cdef extern from \"mpc.h\":\n     # mpc complexes\n     ctypedef struct __mpc_struct:\n-        pass\n+        mpfr_t re\n+        mpfr_t im\n     ctypedef __mpc_struct mpc_t[1];\n     ctypedef __mpc_struct *mpc_ptr;\n     ctypedef const __mpc_struct *mpc_srcptr;\n```",
    "created_at": "2018-01-24T09:31:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346496",
    "user": "https://github.com/videlec"
}
```

<a id='comment:123'></a>
Replying to [vklein](#comment%3A122):
> I think i do at least 
> 
> ```
>  mpfr_set(self.__im, (<gmpy2.mpc>real).c.im, rnd)
>                                                       ^
> ------------------------------------------------------------
> 
> sage/rings/complex_number.pyx:197:55: Cannot convert Python object to '__mpfr_struct *'
> ```
> 
> What syntax would you suggest ?


The one in your comment. There might be something wrong with the Cython headers. Maybe the following change in `gmpy2.pxd` might be enough 

```diff
diff --git a/src/gmpy2.pxd b/src/gmpy2.pxd
index 7cdcc72..d6cac1b 100644
--- a/src/gmpy2.pxd
+++ b/src/gmpy2.pxd
@@ -45,7 +45,8 @@ cdef extern from "mpfr.h":
 cdef extern from "mpc.h":
     # mpc complexes
     ctypedef struct __mpc_struct:
-        pass
+        mpfr_t re
+        mpfr_t im
     ctypedef __mpc_struct mpc_t[1];
     ctypedef __mpc_struct *mpc_ptr;
     ctypedef const __mpc_struct *mpc_srcptr;
```



---

archive/issue_comments_346497.json:
```json
{
    "body": "<a id='comment:4'></a>\nIt works with your solution. That being said i am not sure if avoiding a cast is worth patching `gmpy2`. \\\\\nI would rather keep the current syntax and do a proper pull request for `gmpy2`.",
    "created_at": "2018-01-24T09:57:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346497",
    "user": "https://github.com/vinklein"
}
```

<a id='comment:4'></a>
It works with your solution. That being said i am not sure if avoiding a cast is worth patching `gmpy2`. \\
I would rather keep the current syntax and do a proper pull request for `gmpy2`.



---

archive/issue_comments_346498.json:
```json
{
    "body": "<a id='comment:125'></a>\nReplying to [vklein](#comment%3A118):\n> Yes very accurate !\n> \n> It works fine without `.real` and `.imag`. Tests are running now.\n\n\nThis is also obviously an upstream bug.",
    "created_at": "2018-01-24T14:51:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346498",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:125'></a>
Replying to [vklein](#comment%3A118):
> Yes very accurate !
> 
> It works fine without `.real` and `.imag`. Tests are running now.


This is also obviously an upstream bug.



---

archive/issue_comments_346499.json:
```json
{
    "body": "<a id='comment:6'></a>\nIn `complex_number.pyx` you are only using the `mpc_t` type, nothing else from MPC. So just use `from sage.libs.mpc.types cimport mpc_t`.",
    "created_at": "2018-01-24T15:19:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346499",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:6'></a>
In `complex_number.pyx` you are only using the `mpc_t` type, nothing else from MPC. So just use `from sage.libs.mpc.types cimport mpc_t`.



---

archive/issue_comments_346500.json:
```json
{
    "body": "<a id='comment:7'></a>\nI think it would be good to at least *report* the bugs upstream to gmpy2.",
    "created_at": "2018-01-24T15:20:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346500",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:7'></a>
I think it would be good to at least *report* the bugs upstream to gmpy2.



---

archive/issue_events_208163.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-01-24T15:21:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22928#event-208163"
}
```



---

archive/issue_events_208164.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-01-24T15:21:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22928#event-208164"
}
```



---

archive/issue_comments_346501.json:
```json
{
    "body": "**Reviewer:** Jeroen Demeyer",
    "created_at": "2018-01-24T15:32:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346501",
    "user": "https://github.com/jdemeyer"
}
```

**Reviewer:** Jeroen Demeyer



---

archive/issue_comments_346502.json:
```json
{
    "body": "<a id='comment:130'></a>\nReplying to [jdemeyer](#comment%3A127):\n> I think it would be good to at least *report* the bugs upstream to gmpy2.\n\n\nSure you're right. https://github.com/aleaxit/gmpy/issues/179",
    "created_at": "2018-01-24T18:48:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346502",
    "user": "https://github.com/vinklein"
}
```

<a id='comment:130'></a>
Replying to [jdemeyer](#comment%3A127):
> I think it would be good to at least *report* the bugs upstream to gmpy2.


Sure you're right. https://github.com/aleaxit/gmpy/issues/179



---

archive/issue_comments_346503.json:
```json
{
    "body": "**Changing commit** from \"[5d044bfb4c8ada79db6e8b0147a1f1120cf49a9d](https://github.com/sagemath/sagetrac-mirror/commit/5d044bfb4c8ada79db6e8b0147a1f1120cf49a9d)\" to \"[b6e2c05634879e77912848a89a45a145c1df526f](https://github.com/sagemath/sagetrac-mirror/commit/b6e2c05634879e77912848a89a45a145c1df526f)\".",
    "created_at": "2018-01-24T18:56:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346503",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[5d044bfb4c8ada79db6e8b0147a1f1120cf49a9d](https://github.com/sagemath/sagetrac-mirror/commit/5d044bfb4c8ada79db6e8b0147a1f1120cf49a9d)" to "[b6e2c05634879e77912848a89a45a145c1df526f](https://github.com/sagemath/sagetrac-mirror/commit/b6e2c05634879e77912848a89a45a145c1df526f)".



---

archive/issue_comments_346504.json:
```json
{
    "body": "<a id='comment:1'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b6e2c05634879e77912848a89a45a145c1df526f\">b6e2c05</a></td><td><code>Trac #22928: replace cimport * by cimport mpc_t in</code></td></tr></table>\n",
    "created_at": "2018-01-24T18:56:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346504",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:1'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b6e2c05634879e77912848a89a45a145c1df526f">b6e2c05</a></td><td><code>Trac #22928: replace cimport * by cimport mpc_t in</code></td></tr></table>




---

archive/issue_events_208165.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2018-01-24T18:59:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22928#event-208165"
}
```



---

archive/issue_events_208166.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2018-01-24T18:59:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22928#event-208166"
}
```



---

archive/issue_comments_346505.json:
```json
{
    "body": "<a id='comment:132'></a>\nReplying to [jdemeyer](#comment%3A126):\n> In `complex_number.pyx` you are only using the `mpc_t` type, nothing else from MPC. So just use `from sage.libs.mpc.types cimport mpc_t`.\n\n\nDone",
    "created_at": "2018-01-24T18:59:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346505",
    "user": "https://github.com/vinklein"
}
```

<a id='comment:132'></a>
Replying to [jdemeyer](#comment%3A126):
> In `complex_number.pyx` you are only using the `mpc_t` type, nothing else from MPC. So just use `from sage.libs.mpc.types cimport mpc_t`.


Done



---

archive/issue_events_208167.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-01-24T20:10:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22928#event-208167"
}
```



---

archive/issue_events_208168.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-01-24T20:10:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22928#event-208168"
}
```



---

archive/issue_comments_346506.json:
```json
{
    "body": "<a id='comment:133'></a>\nReplying to [vklein](#comment%3A132):\n> Replying to [jdemeyer](#comment%3A126):\n> > In `complex_number.pyx` you are only using the `mpc_t` type, nothing else from MPC. So just use `from sage.libs.mpc.types cimport mpc_t`.\n\n> \n> Done\n\n\nNo. I wrote `from sage.libs.mpc.types cimport mpc_t` and I meant exactly what I wrote.",
    "created_at": "2018-01-24T20:10:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346506",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:133'></a>
Replying to [vklein](#comment%3A132):
> Replying to [jdemeyer](#comment%3A126):
> > In `complex_number.pyx` you are only using the `mpc_t` type, nothing else from MPC. So just use `from sage.libs.mpc.types cimport mpc_t`.

> 
> Done


No. I wrote `from sage.libs.mpc.types cimport mpc_t` and I meant exactly what I wrote.



---

archive/issue_comments_346507.json:
```json
{
    "body": "<a id='comment:4'></a>\nDoctests crash at runtime with the later syntax. \n\n```\nsage -t --long src/sage/rings/complex_number.pyx\nTraceback (most recent call last):\n  File \"/home/vklein/odk/sage/src/bin/sage-runtests\", line 123, in <module>\n    from sage.doctest.control import DocTestController\n  File \"/home/vklein/odk/sage/local/lib/python2.7/site-packages/sage/doctest/control.py\", line 33, in <module>\n    from .sources import FileDocTestSource, DictAsObject\n  File \"/home/vklein/odk/sage/local/lib/python2.7/site-packages/sage/doctest/sources.py\", line 32, in <module>\n    from .parsing import SageDocTestParser\n  File \"/home/vklein/odk/sage/local/lib/python2.7/site-packages/sage/doctest/parsing.py\", line 57, in <module>\n    from sage.all import RealIntervalField\n  File \"/home/vklein/odk/sage/local/lib/python2.7/site-packages/sage/all.py\", line 87, in <module>\n    from sage.misc.all       import *         # takes a while\n  File \"/home/vklein/odk/sage/local/lib/python2.7/site-packages/sage/misc/all.py\", line 84, in <module>\n    from .functional import (additive_order,\n  File \"/home/vklein/odk/sage/local/lib/python2.7/site-packages/sage/misc/functional.py\", line 27, in <module>\n    from sage.rings.complex_double import CDF\n  File \"sage/rings/integer.pxd\", line 7, in init sage.rings.complex_double\n  File \"sage/rings/rational.pxd\", line 8, in init sage.rings.integer\n  File \"sage/rings/rational.pyx\", line 94, in init sage.rings.rational\n  File \"sage/rings/real_mpfr.pyx\", line 1, in init sage.rings.real_mpfr\n  File \"sage/rings/complex_number.pxd\", line 6, in init sage.libs.mpmath.utils\nImportError: /home/vklein/odk/sage/local/lib/python2.7/site-packages/sage/rings/complex_number.so: undefined symbol: mpc_set_fr_fr\n```",
    "created_at": "2018-01-24T22:12:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346507",
    "user": "https://github.com/vinklein"
}
```

<a id='comment:4'></a>
Doctests crash at runtime with the later syntax. 

```
sage -t --long src/sage/rings/complex_number.pyx
Traceback (most recent call last):
  File "/home/vklein/odk/sage/src/bin/sage-runtests", line 123, in <module>
    from sage.doctest.control import DocTestController
  File "/home/vklein/odk/sage/local/lib/python2.7/site-packages/sage/doctest/control.py", line 33, in <module>
    from .sources import FileDocTestSource, DictAsObject
  File "/home/vklein/odk/sage/local/lib/python2.7/site-packages/sage/doctest/sources.py", line 32, in <module>
    from .parsing import SageDocTestParser
  File "/home/vklein/odk/sage/local/lib/python2.7/site-packages/sage/doctest/parsing.py", line 57, in <module>
    from sage.all import RealIntervalField
  File "/home/vklein/odk/sage/local/lib/python2.7/site-packages/sage/all.py", line 87, in <module>
    from sage.misc.all       import *         # takes a while
  File "/home/vklein/odk/sage/local/lib/python2.7/site-packages/sage/misc/all.py", line 84, in <module>
    from .functional import (additive_order,
  File "/home/vklein/odk/sage/local/lib/python2.7/site-packages/sage/misc/functional.py", line 27, in <module>
    from sage.rings.complex_double import CDF
  File "sage/rings/integer.pxd", line 7, in init sage.rings.complex_double
  File "sage/rings/rational.pxd", line 8, in init sage.rings.integer
  File "sage/rings/rational.pyx", line 94, in init sage.rings.rational
  File "sage/rings/real_mpfr.pyx", line 1, in init sage.rings.real_mpfr
  File "sage/rings/complex_number.pxd", line 6, in init sage.libs.mpmath.utils
ImportError: /home/vklein/odk/sage/local/lib/python2.7/site-packages/sage/rings/complex_number.so: undefined symbol: mpc_set_fr_fr
```



---

archive/issue_comments_346508.json:
```json
{
    "body": "<a id='comment:5'></a>\nIndeed, `mpc/types.pxd` does not contain the distutils directive for libraries. Since `types.pxd` is included in all other files in `mpc/` it makes more sense to have the directive in this file rather than in `__init__.pxd`.",
    "created_at": "2018-01-25T07:11:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346508",
    "user": "https://github.com/videlec"
}
```

<a id='comment:5'></a>
Indeed, `mpc/types.pxd` does not contain the distutils directive for libraries. Since `types.pxd` is included in all other files in `mpc/` it makes more sense to have the directive in this file rather than in `__init__.pxd`.



---

archive/issue_comments_346509.json:
```json
{
    "body": "<a id='comment:6'></a>\nBut who is calling `mpc_set_fr_fr` in that file?",
    "created_at": "2018-01-25T08:45:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346509",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:6'></a>
But who is calling `mpc_set_fr_fr` in that file?



---

archive/issue_comments_346510.json:
```json
{
    "body": "<a id='comment:7'></a>\nI see. The `gmpy2` function `GMPy_MPC_From_mpfr` requires MPC.",
    "created_at": "2018-01-25T08:52:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346510",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:7'></a>
I see. The `gmpy2` function `GMPy_MPC_From_mpfr` requires MPC.



---

archive/issue_comments_346511.json:
```json
{
    "body": "<a id='comment:8'></a>\nShould we add a distutils directive to the `gmpy2.pxd` header?",
    "created_at": "2018-01-25T09:07:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346511",
    "user": "https://github.com/videlec"
}
```

<a id='comment:8'></a>
Should we add a distutils directive to the `gmpy2.pxd` header?



---

archive/issue_comments_346512.json:
```json
{
    "body": "<a id='comment:139'></a>\nReplying to [vdelecroix](#comment%3A138):\n> Should we add a distutils directive to the `gmpy2.pxd` header?\n\n\nNo because not everybody using that header will need every library. It seems overkill to require gmp and mpfr and mpc if you only ever use the `mpz_t` type.\n\nI was thinking about something else: it is trivial to replace `mpc_set_fr_fr` by two `mpfr_set` calls. So maybe we could just do that. I'll try to create a PR for gmpy2.",
    "created_at": "2018-01-25T09:10:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346512",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:139'></a>
Replying to [vdelecroix](#comment%3A138):
> Should we add a distutils directive to the `gmpy2.pxd` header?


No because not everybody using that header will need every library. It seems overkill to require gmp and mpfr and mpc if you only ever use the `mpz_t` type.

I was thinking about something else: it is trivial to replace `mpc_set_fr_fr` by two `mpfr_set` calls. So maybe we could just do that. I'll try to create a PR for gmpy2.



---

archive/issue_comments_346513.json:
```json
{
    "body": "<a id='comment:140'></a>\nReplying to [jdemeyer](#comment%3A139):\n> Replying to [vdelecroix](#comment%3A138):\n> > Should we add a distutils directive to the `gmpy2.pxd` header?\n\n> \n> No because not everybody using that header will need every library. It seems overkill to require gmp and mpfr and mpc if you only ever use the `mpz_t` type.\n> \n> I was thinking about something else: it is trivial to replace `mpc_set_fr_fr` by two `mpfr_set` calls. So maybe we could just do that. I'll try to create a PR for gmpy2.\n\n\nUsing `mpc_set_fr_fr` would impose to link against mpfr. A cleaner possibility is to split the `gmpy2` headers into 3 headers `gmpy2.gmp`, `gmpy2.mpfr` and `gmpy2.mpc`. Each of them with a proper distutils directive.",
    "created_at": "2018-01-25T09:29:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346513",
    "user": "https://github.com/videlec"
}
```

<a id='comment:140'></a>
Replying to [jdemeyer](#comment%3A139):
> Replying to [vdelecroix](#comment%3A138):
> > Should we add a distutils directive to the `gmpy2.pxd` header?

> 
> No because not everybody using that header will need every library. It seems overkill to require gmp and mpfr and mpc if you only ever use the `mpz_t` type.
> 
> I was thinking about something else: it is trivial to replace `mpc_set_fr_fr` by two `mpfr_set` calls. So maybe we could just do that. I'll try to create a PR for gmpy2.


Using `mpc_set_fr_fr` would impose to link against mpfr. A cleaner possibility is to split the `gmpy2` headers into 3 headers `gmpy2.gmp`, `gmpy2.mpfr` and `gmpy2.mpc`. Each of them with a proper distutils directive.



---

archive/issue_comments_346514.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -10,3 +10,7 @@\n    - `ComplexNumber` (`sage.rings.complex_number`)\n \n Conversly, we make Sage integer, rational, real and complex constructors accept gmpy2 arguments.\n+\n+Upstream issues:\n+- https://github.com/aleaxit/gmpy/pull/179\n+- https://github.com/aleaxit/gmpy/pull/180\n``````\n",
    "created_at": "2018-01-25T09:34:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346514",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -10,3 +10,7 @@
    - `ComplexNumber` (`sage.rings.complex_number`)
 
 Conversly, we make Sage integer, rational, real and complex constructors accept gmpy2 arguments.
+
+Upstream issues:
+- https://github.com/aleaxit/gmpy/pull/179
+- https://github.com/aleaxit/gmpy/pull/180
``````




---

archive/issue_comments_346515.json:
```json
{
    "body": "<a id='comment:142'></a>\nReplying to [vdelecroix](#comment%3A140):\n> Using `mpc_set_fr_fr` would impose to link against mpfr.\n\n\nI guess you mean \"using `mpfr_set` would impose to link against mpfr\".\n\nBut that is in fact a very logical requirement, since the input type of `GMPy_MPC_From_mpfr` is `mpfr_t`. So you already need to have an `mpfr_t` in order to use that function, which makes it likely that you are using MPFR already.",
    "created_at": "2018-01-25T09:38:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346515",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:142'></a>
Replying to [vdelecroix](#comment%3A140):
> Using `mpc_set_fr_fr` would impose to link against mpfr.


I guess you mean "using `mpfr_set` would impose to link against mpfr".

But that is in fact a very logical requirement, since the input type of `GMPy_MPC_From_mpfr` is `mpfr_t`. So you already need to have an `mpfr_t` in order to use that function, which makes it likely that you are using MPFR already.



---

archive/issue_comments_346516.json:
```json
{
    "body": "<a id='comment:143'></a>\nReplying to [jdemeyer](#comment%3A142):\n> Replying to [vdelecroix](#comment%3A140):\n> > Using `mpc_set_fr_fr` would impose to link against mpfr.\n\n> \n> I guess you mean \"using `mpfr_set` would impose to link against mpfr\".\n> \n> But that is in fact a very logical requirement, since the input type of `GMPy_MPC_From_mpfr` is `mpfr_t`. So you already need to have an `mpfr_t` in order to use that function, which makes it likely that you are using MPFR already.\n\n\nAnd using a `mpc` from `gmpy2` does not imply that you are using `mpc`!?",
    "created_at": "2018-01-25T09:41:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346516",
    "user": "https://github.com/videlec"
}
```

<a id='comment:143'></a>
Replying to [jdemeyer](#comment%3A142):
> Replying to [vdelecroix](#comment%3A140):
> > Using `mpc_set_fr_fr` would impose to link against mpfr.

> 
> I guess you mean "using `mpfr_set` would impose to link against mpfr".
> 
> But that is in fact a very logical requirement, since the input type of `GMPy_MPC_From_mpfr` is `mpfr_t`. So you already need to have an `mpfr_t` in order to use that function, which makes it likely that you are using MPFR already.


And using a `mpc` from `gmpy2` does not imply that you are using `mpc`!?



---

archive/issue_comments_346517.json:
```json
{
    "body": "<a id='comment:4'></a>\nWill it be so inconsistent to just stick with `from sage.libs.mpc cimport *` for this ticket? \\\\\nI don't see clearly how much impact it has on memory/performance.",
    "created_at": "2018-01-25T10:01:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346517",
    "user": "https://github.com/vinklein"
}
```

<a id='comment:4'></a>
Will it be so inconsistent to just stick with `from sage.libs.mpc cimport *` for this ticket? \\
I don't see clearly how much impact it has on memory/performance.



---

archive/issue_comments_346518.json:
```json
{
    "body": "<a id='comment:145'></a>\nReplying to [vdelecroix](#comment%3A143):\n> And using a `mpc` from `gmpy2` does not imply that you are using `mpc`!?\n\n\nSure, but in an indirect way, through the `gmpy2` package. My point is that you shouldn't require the MPC library in the Cython module which creates a `gmpy2.mpc` object.",
    "created_at": "2018-01-25T10:02:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346518",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:145'></a>
Replying to [vdelecroix](#comment%3A143):
> And using a `mpc` from `gmpy2` does not imply that you are using `mpc`!?


Sure, but in an indirect way, through the `gmpy2` package. My point is that you shouldn't require the MPC library in the Cython module which creates a `gmpy2.mpc` object.



---

archive/issue_comments_346519.json:
```json
{
    "body": "<a id='comment:146'></a>\nReplying to [vklein](#comment%3A144):\n> Will it be so inconsistent to just stick with `from sage.libs.mpc cimport *` for this ticket? \\\\\n> I don't see clearly how much impact it has on memory/performance.\n\n\nI agree... we can still fix this later. I'd like to wait a little bit for an answer from upstream though.",
    "created_at": "2018-01-25T10:03:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346519",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:146'></a>
Replying to [vklein](#comment%3A144):
> Will it be so inconsistent to just stick with `from sage.libs.mpc cimport *` for this ticket? \\
> I don't see clearly how much impact it has on memory/performance.


I agree... we can still fix this later. I'd like to wait a little bit for an answer from upstream though.



---

archive/issue_comments_346520.json:
```json
{
    "body": "<a id='comment:7'></a>\nWith my patch to gmpy2, the following works:\n\n```diff\ndiff --git a/src/sage/rings/complex_number.pyx b/src/sage/rings/complex_number.pyx\nindex bf0e4a3..76782c3 100644\n--- a/src/sage/rings/complex_number.pyx\n+++ b/src/sage/rings/complex_number.pyx\n@@ -31,7 +31,7 @@ from __future__ import absolute_import, print_function\n import math\n import operator\n \n-from sage.libs.mpc cimport mpc_t\n+from sage.libs.mpc.types cimport mpc_t\n from sage.libs.mpfr cimport *\n from sage.structure.element cimport FieldElement, RingElement, Element, ModuleElement\n from sage.categories.map cimport Map\n@@ -193,8 +193,8 @@ cdef class ComplexNumber(sage.structure.element.FieldElement):\n             elif isinstance(real, complex):\n                 real, imag = real.real, real.imag\n             elif HAVE_GMPY2 and type(real) is gmpy2.mpc:\n-                mpfr_set(self.__re, (<mpc_t>(<gmpy2.mpc>real).c).re, rnd)\n-                mpfr_set(self.__im, (<mpc_t>(<gmpy2.mpc>real).c).im, rnd)\n+                mpfr_set(self.__re, (<gmpy2.mpc>real).c.re, rnd)\n+                mpfr_set(self.__im, (<gmpy2.mpc>real).c.im, rnd)\n                 return\n             else:\n                 imag = 0\n```",
    "created_at": "2018-01-25T10:04:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346520",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:7'></a>
With my patch to gmpy2, the following works:

```diff
diff --git a/src/sage/rings/complex_number.pyx b/src/sage/rings/complex_number.pyx
index bf0e4a3..76782c3 100644
--- a/src/sage/rings/complex_number.pyx
+++ b/src/sage/rings/complex_number.pyx
@@ -31,7 +31,7 @@ from __future__ import absolute_import, print_function
 import math
 import operator
 
-from sage.libs.mpc cimport mpc_t
+from sage.libs.mpc.types cimport mpc_t
 from sage.libs.mpfr cimport *
 from sage.structure.element cimport FieldElement, RingElement, Element, ModuleElement
 from sage.categories.map cimport Map
@@ -193,8 +193,8 @@ cdef class ComplexNumber(sage.structure.element.FieldElement):
             elif isinstance(real, complex):
                 real, imag = real.real, real.imag
             elif HAVE_GMPY2 and type(real) is gmpy2.mpc:
-                mpfr_set(self.__re, (<mpc_t>(<gmpy2.mpc>real).c).re, rnd)
-                mpfr_set(self.__im, (<mpc_t>(<gmpy2.mpc>real).c).im, rnd)
+                mpfr_set(self.__re, (<gmpy2.mpc>real).c.re, rnd)
+                mpfr_set(self.__im, (<gmpy2.mpc>real).c.im, rnd)
                 return
             else:
                 imag = 0
```



---

archive/issue_comments_346521.json:
```json
{
    "body": "<a id='comment:8'></a>\nAnd i have fixed issue \u200b[gmpy2 issue #179](https://github.com/aleaxit/gmpy/pull/179) with this PR\nhttps://github.com/aleaxit/gmpy/pull/181.\n\nWhat should we do next ? :\n- Waiting for a gmpy2 release.\n- Doing sage patchs for gmpy2 (maybe after `gmpy2` PR's are reviewed and merged).\n- Or switch this ticket in need_review as it is.",
    "created_at": "2018-01-25T15:12:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346521",
    "user": "https://github.com/vinklein"
}
```

<a id='comment:8'></a>
And i have fixed issue ​[gmpy2 issue #179](https://github.com/aleaxit/gmpy/pull/179) with this PR
https://github.com/aleaxit/gmpy/pull/181.

What should we do next ? :
- Waiting for a gmpy2 release.
- Doing sage patchs for gmpy2 (maybe after `gmpy2` PR's are reviewed and merged).
- Or switch this ticket in need_review as it is.



---

archive/issue_comments_346522.json:
```json
{
    "body": "<a id='comment:149'></a>\nReplying to [vklein](#comment%3A148):\n> And i have fixed issue \u200b[gmpy2 issue #179](https://github.com/aleaxit/gmpy/pull/179) with this PR\n> https://github.com/aleaxit/gmpy/pull/181.\n> \n> What should we do next ? :\n> - Waiting for a gmpy2 release.\n> - Doing sage patchs for gmpy2 (maybe after `gmpy2` PR's are reviewed and merged).\n> - Or switch this ticket in need_review as it is.\n\n\nI would say\n- create a patch and add it to gmpy2\n- move the ticket in needs review\n- wait for the PR to be accepted before setting it to positive review\nThe rationale is that we are currently testing gmpy2 integration. At the time it stabilizes, we should ask for a new release and remove all of Sage patches.",
    "created_at": "2018-01-25T15:54:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346522",
    "user": "https://github.com/videlec"
}
```

<a id='comment:149'></a>
Replying to [vklein](#comment%3A148):
> And i have fixed issue ​[gmpy2 issue #179](https://github.com/aleaxit/gmpy/pull/179) with this PR
> https://github.com/aleaxit/gmpy/pull/181.
> 
> What should we do next ? :
> - Waiting for a gmpy2 release.
> - Doing sage patchs for gmpy2 (maybe after `gmpy2` PR's are reviewed and merged).
> - Or switch this ticket in need_review as it is.


I would say
- create a patch and add it to gmpy2
- move the ticket in needs review
- wait for the PR to be accepted before setting it to positive review
The rationale is that we are currently testing gmpy2 integration. At the time it stabilizes, we should ask for a new release and remove all of Sage patches.



---

archive/issue_comments_346523.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -12,5 +12,5 @@\n Conversly, we make Sage integer, rational, real and complex constructors accept gmpy2 arguments.\n \n Upstream issues:\n-- https://github.com/aleaxit/gmpy/pull/179\n - https://github.com/aleaxit/gmpy/pull/180\n+- https://github.com/aleaxit/gmpy/pull/181\n``````\n",
    "created_at": "2018-01-25T16:03:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346523",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -12,5 +12,5 @@
 Conversly, we make Sage integer, rational, real and complex constructors accept gmpy2 arguments.
 
 Upstream issues:
-- https://github.com/aleaxit/gmpy/pull/179
 - https://github.com/aleaxit/gmpy/pull/180
+- https://github.com/aleaxit/gmpy/pull/181
``````




---

archive/issue_comments_346524.json:
```json
{
    "body": "<a id='comment:1'></a>\nFine for me!",
    "created_at": "2018-01-25T16:03:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346524",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:1'></a>
Fine for me!



---

archive/issue_comments_346525.json:
```json
{
    "body": "<a id='comment:2'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1c5685f5f11c87b28ec3ad9e76d2e3ae54eef4df\">1c5685f</a></td><td><code>Trac #22928: Patchs gmpy2 and update complex_number</code></td></tr></table>\n",
    "created_at": "2018-01-26T10:31:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346525",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1c5685f5f11c87b28ec3ad9e76d2e3ae54eef4df">1c5685f</a></td><td><code>Trac #22928: Patchs gmpy2 and update complex_number</code></td></tr></table>




---

archive/issue_comments_346526.json:
```json
{
    "body": "**Changing commit** from \"[b6e2c05634879e77912848a89a45a145c1df526f](https://github.com/sagemath/sagetrac-mirror/commit/b6e2c05634879e77912848a89a45a145c1df526f)\" to \"[1c5685f5f11c87b28ec3ad9e76d2e3ae54eef4df](https://github.com/sagemath/sagetrac-mirror/commit/1c5685f5f11c87b28ec3ad9e76d2e3ae54eef4df)\".",
    "created_at": "2018-01-26T10:31:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346526",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[b6e2c05634879e77912848a89a45a145c1df526f](https://github.com/sagemath/sagetrac-mirror/commit/b6e2c05634879e77912848a89a45a145c1df526f)" to "[1c5685f5f11c87b28ec3ad9e76d2e3ae54eef4df](https://github.com/sagemath/sagetrac-mirror/commit/1c5685f5f11c87b28ec3ad9e76d2e3ae54eef4df)".



---

archive/issue_comments_346527.json:
```json
{
    "body": "**Changing commit** from \"[1c5685f5f11c87b28ec3ad9e76d2e3ae54eef4df](https://github.com/sagemath/sagetrac-mirror/commit/1c5685f5f11c87b28ec3ad9e76d2e3ae54eef4df)\" to \"[dcc7e9567a7df1f37aa795bb7f58ba184985745c](https://github.com/sagemath/sagetrac-mirror/commit/dcc7e9567a7df1f37aa795bb7f58ba184985745c)\".",
    "created_at": "2018-01-26T10:44:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346527",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[1c5685f5f11c87b28ec3ad9e76d2e3ae54eef4df](https://github.com/sagemath/sagetrac-mirror/commit/1c5685f5f11c87b28ec3ad9e76d2e3ae54eef4df)" to "[dcc7e9567a7df1f37aa795bb7f58ba184985745c](https://github.com/sagemath/sagetrac-mirror/commit/dcc7e9567a7df1f37aa795bb7f58ba184985745c)".



---

archive/issue_comments_346528.json:
```json
{
    "body": "<a id='comment:3'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dcc7e9567a7df1f37aa795bb7f58ba184985745c\">dcc7e95</a></td><td><code>Trac #22928: Patchs gmpy2 and update complex_number</code></td></tr></table>\n",
    "created_at": "2018-01-26T10:44:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346528",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dcc7e9567a7df1f37aa795bb7f58ba184985745c">dcc7e95</a></td><td><code>Trac #22928: Patchs gmpy2 and update complex_number</code></td></tr></table>




---

archive/issue_events_208169.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2018-01-26T10:48:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22928#event-208169"
}
```



---

archive/issue_events_208170.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2018-01-26T10:48:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22928#event-208170"
}
```



---

archive/issue_comments_346529.json:
```json
{
    "body": "<a id='comment:4'></a>\nPatch are done. The corresponding PRs are merged.",
    "created_at": "2018-01-26T10:48:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346529",
    "user": "https://github.com/vinklein"
}
```

<a id='comment:4'></a>
Patch are done. The corresponding PRs are merged.



---

archive/issue_events_208171.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-01-26T10:52:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22928#event-208171"
}
```



---

archive/issue_events_208172.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-01-26T10:52:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22928#event-208172"
}
```



---

archive/issue_comments_346530.json:
```json
{
    "body": "<a id='comment:5'></a>\nYou need to bump the `gmpy2` version number for the patches to apply.",
    "created_at": "2018-01-26T10:52:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346530",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:5'></a>
You need to bump the `gmpy2` version number for the patches to apply.



---

archive/issue_comments_346531.json:
```json
{
    "body": "**Changing commit** from \"[dcc7e9567a7df1f37aa795bb7f58ba184985745c](https://github.com/sagemath/sagetrac-mirror/commit/dcc7e9567a7df1f37aa795bb7f58ba184985745c)\" to \"[e3a3bf49b965b6f81814efe36d9b0bbe49a43156](https://github.com/sagemath/sagetrac-mirror/commit/e3a3bf49b965b6f81814efe36d9b0bbe49a43156)\".",
    "created_at": "2018-01-26T10:58:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346531",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[dcc7e9567a7df1f37aa795bb7f58ba184985745c](https://github.com/sagemath/sagetrac-mirror/commit/dcc7e9567a7df1f37aa795bb7f58ba184985745c)" to "[e3a3bf49b965b6f81814efe36d9b0bbe49a43156](https://github.com/sagemath/sagetrac-mirror/commit/e3a3bf49b965b6f81814efe36d9b0bbe49a43156)".



---

archive/issue_comments_346532.json:
```json
{
    "body": "<a id='comment:6'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e3a3bf49b965b6f81814efe36d9b0bbe49a43156\">e3a3bf4</a></td><td><code>Trac #22928 : update version patch p0 to p1</code></td></tr></table>\n",
    "created_at": "2018-01-26T10:58:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346532",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e3a3bf49b965b6f81814efe36d9b0bbe49a43156">e3a3bf4</a></td><td><code>Trac #22928 : update version patch p0 to p1</code></td></tr></table>




---

archive/issue_events_208173.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2018-01-26T10:59:04Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22928#event-208173"
}
```



---

archive/issue_events_208174.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2018-01-26T10:59:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22928#event-208174"
}
```



---

archive/issue_comments_346533.json:
```json
{
    "body": "<a id='comment:7'></a>\nI see, thanks.",
    "created_at": "2018-01-26T10:59:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346533",
    "user": "https://github.com/vinklein"
}
```

<a id='comment:7'></a>
I see, thanks.



---

archive/issue_comments_346534.json:
```json
{
    "body": "<a id='comment:8'></a>\nThe following line misses a `# optional - gmpy2`\n\n```\n            sage: x = mpfr(R.pi())\n```",
    "created_at": "2018-01-26T13:26:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346534",
    "user": "https://github.com/videlec"
}
```

<a id='comment:8'></a>
The following line misses a `# optional - gmpy2`

```
            sage: x = mpfr(R.pi())
```



---

archive/issue_comments_346535.json:
```json
{
    "body": "<a id='comment:9'></a>\nYeah and two others after this one \n\n```\nsage: y = RealField(128)(x) \nsage: mpfr(y) == x\n```\n\nI will rerun tests without gmpy2 package installed",
    "created_at": "2018-01-26T13:32:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346535",
    "user": "https://github.com/vinklein"
}
```

<a id='comment:9'></a>
Yeah and two others after this one 

```
sage: y = RealField(128)(x) 
sage: mpfr(y) == x
```

I will rerun tests without gmpy2 package installed



---

archive/issue_events_208175.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2018-01-26T13:33:17Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22928#event-208175"
}
```



---

archive/issue_events_208176.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2018-01-26T13:33:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22928#event-208176"
}
```



---

archive/issue_comments_346536.json:
```json
{
    "body": "**Changing commit** from \"[e3a3bf49b965b6f81814efe36d9b0bbe49a43156](https://github.com/sagemath/sagetrac-mirror/commit/e3a3bf49b965b6f81814efe36d9b0bbe49a43156)\" to \"[e9a6fdaf5e130e826929c4d9a6617a2128afe3d0](https://github.com/sagemath/sagetrac-mirror/commit/e9a6fdaf5e130e826929c4d9a6617a2128afe3d0)\".",
    "created_at": "2018-01-26T16:16:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346536",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[e3a3bf49b965b6f81814efe36d9b0bbe49a43156](https://github.com/sagemath/sagetrac-mirror/commit/e3a3bf49b965b6f81814efe36d9b0bbe49a43156)" to "[e9a6fdaf5e130e826929c4d9a6617a2128afe3d0](https://github.com/sagemath/sagetrac-mirror/commit/e9a6fdaf5e130e826929c4d9a6617a2128afe3d0)".



---

archive/issue_comments_346537.json:
```json
{
    "body": "<a id='comment:1'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e9a6fdaf5e130e826929c4d9a6617a2128afe3d0\">e9a6fda</a></td><td><code>Trac #22928 : add some missings # optional - gmpy2</code></td></tr></table>\n",
    "created_at": "2018-01-26T16:16:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346537",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:1'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e9a6fdaf5e130e826929c4d9a6617a2128afe3d0">e9a6fda</a></td><td><code>Trac #22928 : add some missings # optional - gmpy2</code></td></tr></table>




---

archive/issue_comments_346538.json:
```json
{
    "body": "<a id='comment:2'></a>\nAll test without gmpy2 passed, tests with gmpy2 are runnings.",
    "created_at": "2018-01-26T16:20:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346538",
    "user": "https://github.com/vinklein"
}
```

<a id='comment:2'></a>
All test without gmpy2 passed, tests with gmpy2 are runnings.



---

archive/issue_comments_346539.json:
```json
{
    "body": "<a id='comment:3'></a>\nneeds review? The branch is fine for me in the current state.",
    "created_at": "2018-01-26T16:31:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346539",
    "user": "https://github.com/videlec"
}
```

<a id='comment:3'></a>
needs review? The branch is fine for me in the current state.



---

archive/issue_comments_346540.json:
```json
{
    "body": "**Changing reviewer** from \"Jeroen Demeyer\" to \"Jeroen Demeyer, Vincent Delecroix\".",
    "created_at": "2018-01-26T16:31:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346540",
    "user": "https://github.com/videlec"
}
```

**Changing reviewer** from "Jeroen Demeyer" to "Jeroen Demeyer, Vincent Delecroix".



---

archive/issue_events_208177.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2018-01-26T16:33:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22928#event-208177"
}
```



---

archive/issue_events_208178.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2018-01-26T16:33:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22928#event-208178"
}
```



---

archive/issue_comments_346541.json:
```json
{
    "body": "<a id='comment:4'></a>\nOkay then.",
    "created_at": "2018-01-26T16:33:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346541",
    "user": "https://github.com/vinklein"
}
```

<a id='comment:4'></a>
Okay then.



---

archive/issue_comments_346542.json:
```json
{
    "body": "<a id='comment:5'></a>\nIn `real_double.pyx` you call `cimport gmpy2` but does not do `gmpy2.import_gmpy2()`.",
    "created_at": "2018-01-26T16:37:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346542",
    "user": "https://github.com/videlec"
}
```

<a id='comment:5'></a>
In `real_double.pyx` you call `cimport gmpy2` but does not do `gmpy2.import_gmpy2()`.



---

archive/issue_comments_346543.json:
```json
{
    "body": "<a id='comment:6'></a>\nYes but `real_double.pyx` do `cimport sage.ring.integer` and the later call `gmpy2.import_gmpy2()`.",
    "created_at": "2018-01-26T20:40:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346543",
    "user": "https://github.com/vinklein"
}
```

<a id='comment:6'></a>
Yes but `real_double.pyx` do `cimport sage.ring.integer` and the later call `gmpy2.import_gmpy2()`.



---

archive/issue_comments_346544.json:
```json
{
    "body": "<a id='comment:167'></a>\nReplying to [vklein](#comment%3A166):\n> Yes but `real_double.pyx` do `cimport sage.ring.integer` and the later call `gmpy2.import_gmpy2()`. \n\n\nThis sentence makes me sad and worried at the same time. It shows that you absolutely do not understand what `import_gmpy2()` does.\n\nThe *real reason* that you don't need `import_gmpy2()` in that file is that you are simply not calling any gmpy2 functions in that Cython module.",
    "created_at": "2018-01-27T08:05:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346544",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:167'></a>
Replying to [vklein](#comment%3A166):
> Yes but `real_double.pyx` do `cimport sage.ring.integer` and the later call `gmpy2.import_gmpy2()`. 


This sentence makes me sad and worried at the same time. It shows that you absolutely do not understand what `import_gmpy2()` does.

The *real reason* that you don't need `import_gmpy2()` in that file is that you are simply not calling any gmpy2 functions in that Cython module.



---

archive/issue_comments_346545.json:
```json
{
    "body": "<a id='comment:8'></a>\nIs it ok Jeroen?",
    "created_at": "2018-01-30T14:25:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346545",
    "user": "https://github.com/videlec"
}
```

<a id='comment:8'></a>
Is it ok Jeroen?



---

archive/issue_events_208179.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-01-30T14:30:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22928#event-208179"
}
```



---

archive/issue_events_208180.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-01-30T14:30:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22928#event-208180"
}
```



---

archive/issue_events_208181.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-02-02T12:06:15Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22928#event-208181"
}
```



---

archive/issue_events_208182.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-02-02T12:06:15Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22928#event-208182"
}
```



---

archive/issue_comments_346546.json:
```json
{
    "body": "**Changing branch** from \"[u/vklein/conversion_between_gmpy2_and_sage_integers](https://github.com/sagemath/sagetrac-mirror/tree/u/vklein/conversion_between_gmpy2_and_sage_integers)\" to \"[e9a6fdaf5e130e826929c4d9a6617a2128afe3d0](https://github.com/sagemath/sagetrac-mirror/commit/e9a6fdaf5e130e826929c4d9a6617a2128afe3d0)\".",
    "created_at": "2018-02-02T12:06:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346546",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/vklein/conversion_between_gmpy2_and_sage_integers](https://github.com/sagemath/sagetrac-mirror/tree/u/vklein/conversion_between_gmpy2_and_sage_integers)" to "[e9a6fdaf5e130e826929c4d9a6617a2128afe3d0](https://github.com/sagemath/sagetrac-mirror/commit/e9a6fdaf5e130e826929c4d9a6617a2128afe3d0)".



---

archive/issue_comments_346547.json:
```json
{
    "body": "<a id='comment:1'></a>\nA small remark to say that some warnings associated to gmpy2 appear at each run of `sage -b` (without gmpy2):\n\n```\n[sagelib-8.2.rc3] sage/rings/complex_double.pyx: cannot find cimported module 'gmpy2'\n[sagelib-8.2.rc3] sage/rings/complex_number.pyx: cannot find cimported module 'gmpy2'\n[sagelib-8.2.rc3] sage/rings/integer.pyx: cannot find cimported module 'gmpy2'\n[sagelib-8.2.rc3] sage/rings/complex_mpc.pyx: cannot find cimported module 'gmpy2'\n[sagelib-8.2.rc3] sage/rings/rational.pyx: cannot find cimported module 'gmpy2'\n[sagelib-8.2.rc3] sage/rings/real_double.pyx: cannot find cimported module 'gmpy2'\n[sagelib-8.2.rc3] sage/rings/real_mpfr.pyx: cannot find cimported module 'gmpy2'\n```\n\nIs it possible to clean this?",
    "created_at": "2018-05-01T09:05:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346547",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:1'></a>
A small remark to say that some warnings associated to gmpy2 appear at each run of `sage -b` (without gmpy2):

```
[sagelib-8.2.rc3] sage/rings/complex_double.pyx: cannot find cimported module 'gmpy2'
[sagelib-8.2.rc3] sage/rings/complex_number.pyx: cannot find cimported module 'gmpy2'
[sagelib-8.2.rc3] sage/rings/integer.pyx: cannot find cimported module 'gmpy2'
[sagelib-8.2.rc3] sage/rings/complex_mpc.pyx: cannot find cimported module 'gmpy2'
[sagelib-8.2.rc3] sage/rings/rational.pyx: cannot find cimported module 'gmpy2'
[sagelib-8.2.rc3] sage/rings/real_double.pyx: cannot find cimported module 'gmpy2'
[sagelib-8.2.rc3] sage/rings/real_mpfr.pyx: cannot find cimported module 'gmpy2'
```

Is it possible to clean this?



---

archive/issue_comments_346548.json:
```json
{
    "body": "**Changing commit** from \"[e9a6fdaf5e130e826929c4d9a6617a2128afe3d0](https://github.com/sagemath/sagetrac-mirror/commit/e9a6fdaf5e130e826929c4d9a6617a2128afe3d0)\" to \"\".",
    "created_at": "2018-05-01T09:05:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346548",
    "user": "https://github.com/seblabbe"
}
```

**Changing commit** from "[e9a6fdaf5e130e826929c4d9a6617a2128afe3d0](https://github.com/sagemath/sagetrac-mirror/commit/e9a6fdaf5e130e826929c4d9a6617a2128afe3d0)" to "".



---

archive/issue_comments_346549.json:
```json
{
    "body": "<a id='comment:2'></a>\nAccording to Jeroen it's harmless and will require a cython patch to fix it.",
    "created_at": "2018-05-01T09:25:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346549",
    "user": "https://github.com/vinklein"
}
```

<a id='comment:2'></a>
According to Jeroen it's harmless and will require a cython patch to fix it.



---

archive/issue_comments_346550.json:
```json
{
    "body": "<a id='comment:173'></a>\nReplying to [slabbe](#comment%3A171):\n> Is it possible to clean this?\n\n\nUnfortunately, it's not easy to properly fix. The basic problem is that the `cimport` is parsed very very early in the Cython build system, at a point where macros like `HAVE_GMPY2` are not considered yet.",
    "created_at": "2018-05-01T09:36:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22928#issuecomment-346550",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:173'></a>
Replying to [slabbe](#comment%3A171):
> Is it possible to clean this?


Unfortunately, it's not easy to properly fix. The basic problem is that the `cimport` is parsed very very early in the Cython build system, at a point where macros like `HAVE_GMPY2` are not considered yet.
