# Issue 22170: plot3d : the option "mesh=True" does not work in Jupyter

archive/issues_021933.json:
```json
{
    "body": "This test from documentation : \n\n```\nsage: var('x,y')\nsage: plot3d(sin(x-y)*y*cos(x),(x,-3,3),(y,-3,3), mesh=True)\n---------------------------------------------------------------------------\nAssertionError                            Traceback (most recent call last)\n<ipython-input-1-0959b0ae2ee0> in <module>()\n      1 var('x,y')\n----> 2 plot3d(sin(x-y)*y*cos(x),(x,-Integer(3),Integer(3)),(y,-Integer(3),Integer(3)), mesh=True)\n\n/usr/local/src/sage-config/local/lib/python2.7/site-packages/IPython/core/displayhook.pyc in __call__(self, result)\n    244             self.start_displayhook()\n    245             self.write_output_prompt()\n--> 246             format_dict, md_dict = self.compute_format_data(result)\n    247             self.update_user_ns(result)\n    248             self.fill_exec_result(result)\n\n/usr/local/src/sage-config/local/lib/python2.7/site-packages/IPython/core/displayhook.pyc in compute_format_data(self, result)\n    148 \n    149         \"\"\"\n--> 150         return self.shell.display_formatter.format(result)\n    151 \n    152     # This can be set to True by the write_output_prompt method in a subclass\n\n/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/repl/display/formatter.pyc in format(self, obj, include, exclude)\n    200         \"\"\"\n    201         # First, use Sage rich output if there is any\n--> 202         sage_format, sage_metadata = self.dm.displayhook(obj)\n    203         assert PLAIN_TEXT in sage_format, 'plain text is always present'\n    204         if not set(sage_format.keys()).issubset(self.default_mime()):\n\n/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/repl/rich_output/display_manager.pyc in displayhook(self, obj)\n    806         self._backend.set_underscore_variable(obj)\n    807         plain_text, rich_output = self._rich_output_formatter(obj, dict())\n--> 808         return self._backend.displayhook(plain_text, rich_output)\n    809 \n    810     def display_immediately(self, obj, **rich_repr_kwds):\n\n/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/repl/rich_output/backend_ipython.pyc in displayhook(self, plain_text, rich_output)\n    560             from sage.repl.display.jsmol_iframe import JSMolHtml\n    561             jsmol = JSMolHtml(rich_output, height=500)\n--> 562             return ({u'text/html':  jsmol.iframe(),\n    563                      u'text/plain': plain_text.text.get_unicode(),\n    564             }, {})            \n\n/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/repl/display/jsmol_iframe.pyc in iframe(self)\n    259             </iframe>\n    260         \"\"\"\n--> 261         escaped_inner_html = self.inner_html().replace('\"', '&quot;')\n    262         iframe = IFRAME_TEMPLATE.format(\n    263             script=self.js_script(),\n\n/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/repl/display/jsmol_iframe.pyc in inner_html(self)\n    235         \"\"\"\n    236         return INNER_HTML_TEMPLATE.format(\n--> 237             script=self.js_script(),\n    238             width=self._width,\n    239             height=self._height,\n\n/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/repl/display/jsmol_iframe.pyc in js_script(self)\n    193         \"\"\"\n    194         script = [r\"[\"]\n--> 195         for line in self.script().splitlines():\n    196             script += [r\"  '{0}',\".format(line)]\n    197         script += [r\"].join('\\n');\"]\n\n/usr/local/src/sage-config/src/sage/misc/cachefunc.pyx in sage.misc.cachefunc.CachedMethodCallerNoArgs.__call__ (build/cythonized/sage/misc/cachefunc.c:13441)()\n   2375         if self.cache is None:\n   2376             f = self.f\n-> 2377             self.cache = f(self._instance)\n   2378         return self.cache\n   2379 \n\n/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/repl/display/jsmol_iframe.pyc in script(self)\n    156                     command, obj, meshfile = line.split(' ', 3)\n    157                     assert command == 'pmesh'\n--> 158                     assert meshfile.startswith('\"') and meshfile.endswith('\"\\n')\n    159                     meshfile = meshfile[1:-2]    # strip quotes\n    160                     script += [\n\nAssertionError:\n```\n\nworks on terminal, `*.sagews` in the cloud, local sage notebooks but... not in Jupyter notebook (both local and cloud-based).\n\nCC:  jhonrubia6 @fchapoton @egourgoulhon @paulmasson @kcrisman\n\nKeywords: plot3d, jupyter, mesh, days82\n\nBranch/Commit: 37171e816fbebd13b64c4644e15966bb9c13ebef\n\nReviewer: Eric Gourgoulhon\n\nAuthor: Fr\u00e9d\u00e9ric Chapoton\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/22170\n\n",
    "closed_at": "2018-01-27T16:00:03Z",
    "created_at": "2017-01-11T11:33:43Z",
    "labels": [
        "component: graphics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.2",
    "title": "plot3d : the option \"mesh=True\" does not work in Jupyter",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22170",
    "user": "https://trac.sagemath.org/admin/accounts/users/ams"
}
```
This test from documentation : 

```
sage: var('x,y')
sage: plot3d(sin(x-y)*y*cos(x),(x,-3,3),(y,-3,3), mesh=True)
---------------------------------------------------------------------------
AssertionError                            Traceback (most recent call last)
<ipython-input-1-0959b0ae2ee0> in <module>()
      1 var('x,y')
----> 2 plot3d(sin(x-y)*y*cos(x),(x,-Integer(3),Integer(3)),(y,-Integer(3),Integer(3)), mesh=True)

/usr/local/src/sage-config/local/lib/python2.7/site-packages/IPython/core/displayhook.pyc in __call__(self, result)
    244             self.start_displayhook()
    245             self.write_output_prompt()
--> 246             format_dict, md_dict = self.compute_format_data(result)
    247             self.update_user_ns(result)
    248             self.fill_exec_result(result)

/usr/local/src/sage-config/local/lib/python2.7/site-packages/IPython/core/displayhook.pyc in compute_format_data(self, result)
    148 
    149         """
--> 150         return self.shell.display_formatter.format(result)
    151 
    152     # This can be set to True by the write_output_prompt method in a subclass

/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/repl/display/formatter.pyc in format(self, obj, include, exclude)
    200         """
    201         # First, use Sage rich output if there is any
--> 202         sage_format, sage_metadata = self.dm.displayhook(obj)
    203         assert PLAIN_TEXT in sage_format, 'plain text is always present'
    204         if not set(sage_format.keys()).issubset(self.default_mime()):

/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/repl/rich_output/display_manager.pyc in displayhook(self, obj)
    806         self._backend.set_underscore_variable(obj)
    807         plain_text, rich_output = self._rich_output_formatter(obj, dict())
--> 808         return self._backend.displayhook(plain_text, rich_output)
    809 
    810     def display_immediately(self, obj, **rich_repr_kwds):

/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/repl/rich_output/backend_ipython.pyc in displayhook(self, plain_text, rich_output)
    560             from sage.repl.display.jsmol_iframe import JSMolHtml
    561             jsmol = JSMolHtml(rich_output, height=500)
--> 562             return ({u'text/html':  jsmol.iframe(),
    563                      u'text/plain': plain_text.text.get_unicode(),
    564             }, {})            

/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/repl/display/jsmol_iframe.pyc in iframe(self)
    259             </iframe>
    260         """
--> 261         escaped_inner_html = self.inner_html().replace('"', '&quot;')
    262         iframe = IFRAME_TEMPLATE.format(
    263             script=self.js_script(),

/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/repl/display/jsmol_iframe.pyc in inner_html(self)
    235         """
    236         return INNER_HTML_TEMPLATE.format(
--> 237             script=self.js_script(),
    238             width=self._width,
    239             height=self._height,

/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/repl/display/jsmol_iframe.pyc in js_script(self)
    193         """
    194         script = [r"["]
--> 195         for line in self.script().splitlines():
    196             script += [r"  '{0}',".format(line)]
    197         script += [r"].join('\n');"]

/usr/local/src/sage-config/src/sage/misc/cachefunc.pyx in sage.misc.cachefunc.CachedMethodCallerNoArgs.__call__ (build/cythonized/sage/misc/cachefunc.c:13441)()
   2375         if self.cache is None:
   2376             f = self.f
-> 2377             self.cache = f(self._instance)
   2378         return self.cache
   2379 

/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/repl/display/jsmol_iframe.pyc in script(self)
    156                     command, obj, meshfile = line.split(' ', 3)
    157                     assert command == 'pmesh'
--> 158                     assert meshfile.startswith('"') and meshfile.endswith('"\n')
    159                     meshfile = meshfile[1:-2]    # strip quotes
    160                     script += [

AssertionError:
```

works on terminal, `*.sagews` in the cloud, local sage notebooks but... not in Jupyter notebook (both local and cloud-based).

CC:  jhonrubia6 @fchapoton @egourgoulhon @paulmasson @kcrisman

Keywords: plot3d, jupyter, mesh, days82

Branch/Commit: 37171e816fbebd13b64c4644e15966bb9c13ebef

Reviewer: Eric Gourgoulhon

Author: Frédéric Chapoton

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/22170





---

archive/issue_comments_304318.json:
```json
{
    "body": "<a id='comment:1'></a>Full text o",
    "created_at": "2017-01-11T11:35:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22170#issuecomment-304318",
    "user": "https://trac.sagemath.org/admin/accounts/users/ams"
}
```

<a id='comment:1'></a>Full text o



---

archive/issue_comments_304319.json:
```json
{
    "body": "<a id='comment:2'></a>no idea for this, sorry",
    "created_at": "2017-01-11T12:25:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22170#issuecomment-304319",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:2'></a>no idea for this, sorry



---

archive/issue_comments_304320.json:
```json
{
    "body": "<a id='comment:3'></a>no idea either (never worked on jupyter), sorry",
    "created_at": "2017-01-11T14:26:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22170#issuecomment-304320",
    "user": "https://trac.sagemath.org/admin/accounts/users/jhonrubia6"
}
```

<a id='comment:3'></a>no idea either (never worked on jupyter), sorry



---

archive/issue_comments_304321.json:
```json
{
    "body": "<a id='comment:5'></a>This is happening because `mesh=True` adds a line to the Jmol data file starting with `pmesh` that does not have a quote-enclosed filename at the end of the line, hence the `AssertionError`. The `script` method in `repl/display/jsmol_iframe.py` needs to be modified.",
    "created_at": "2017-01-12T20:23:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22170#issuecomment-304321",
    "user": "https://github.com/paulmasson"
}
```

<a id='comment:5'></a>This is happening because `mesh=True` adds a line to the Jmol data file starting with `pmesh` that does not have a quote-enclosed filename at the end of the line, hence the `AssertionError`. The `script` method in `repl/display/jsmol_iframe.py` needs to be modified.



---

archive/issue_comments_304322.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-01-24T12:35:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22170#issuecomment-304322",
    "user": "https://github.com/fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_events_058288.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-01-24T12:35:16Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/22170",
    "milestone": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22170#event-58288"
}
```



---

archive/issue_comments_304323.json:
```json
{
    "body": "<a id='comment:6'></a>I have fixed that, please double check. \n\n---\nNew commits:",
    "created_at": "2018-01-24T12:35:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22170#issuecomment-304323",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:6'></a>I have fixed that, please double check. 

---
New commits:



---

archive/issue_comments_304324.json:
```json
{
    "body": "<a id='comment:9'></a>Thanks for the fix!\nI confirm it works.\n\nSide note: with `viewer='threejs'`, the mesh is not displayed, but this is another issue, not related to this ticket.",
    "created_at": "2018-01-26T17:28:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22170#issuecomment-304324",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:9'></a>Thanks for the fix!
I confirm it works.

Side note: with `viewer='threejs'`, the mesh is not displayed, but this is another issue, not related to this ticket.



---

archive/issue_comments_304325.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-01-26T17:28:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22170#issuecomment-304325",
    "user": "https://github.com/egourgoulhon"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_304326.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-01-27T16:00:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22170#issuecomment-304326",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_058289.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-01-27T16:00:03Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/22170",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22170#event-58289"
}
```
