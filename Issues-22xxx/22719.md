# Issue 22719: integral points for elliptic curves broken

archive/issues_022482.json:
```json
{
    "body": "\n```\nsage: E = EllipticCurve(\"141d1\")\nsage: E.integral_points()\n```\n\ngoes boom with\n` --> 198         raise RuntimeError('Bad arguments to ratpoints')`\n\n\nCC:  @JohnCremona\n\nKeywords: integral points, ratpoints\n\nBranch/Commit: 5abadc71a145e3afce1a718da18452a3b611baa5\n\nReviewer: David Roe\n\nAuthor: John Cremona\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/22719\n\n",
    "closed_at": "2017-12-11T01:03:55Z",
    "created_at": "2017-03-30T15:26:05Z",
    "labels": [
        "component: elliptic curves",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.2",
    "title": "integral points for elliptic curves broken",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22719",
    "user": "https://github.com/categorie"
}
```

```
sage: E = EllipticCurve("141d1")
sage: E.integral_points()
```

goes boom with
` --> 198         raise RuntimeError('Bad arguments to ratpoints')`


CC:  @JohnCremona

Keywords: integral points, ratpoints

Branch/Commit: 5abadc71a145e3afce1a718da18452a3b611baa5

Reviewer: David Roe

Author: John Cremona

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/22719





---

archive/issue_comments_423539.json:
```json
{
    "body": "<a id='comment:1'></a>\nI am not sure this has not been noted before in some form, but I could not find anything about it.\nIt is the optimal curve of lowest conductor for which this appears.",
    "created_at": "2017-03-30T15:27:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22719#issuecomment-423539",
    "user": "https://github.com/categorie"
}
```

<a id='comment:1'></a>
I am not sure this has not been noted before in some form, but I could not find anything about it.
It is the optimal curve of lowest conductor for which this appears.



---

archive/issue_comments_423540.json:
```json
{
    "body": "<a id='comment:2'></a>\nThanks for spotting this.  Since this was implemented I have checed many thousands of curves to compare with Magma, so this must be something new.  In particular ratpoints has changed.\n\nThere's another ticket which has been around for ages in which I am fixing other integral points bugs.  What joy.",
    "created_at": "2017-03-30T15:33:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22719#issuecomment-423540",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:2'></a>
Thanks for spotting this.  Since this was implemented I have checed many thousands of curves to compare with Magma, so this must be something new.  In particular ratpoints has changed.

There's another ticket which has been around for ages in which I am fixing other integral points bugs.  What joy.



---

archive/issue_comments_423541.json:
```json
{
    "body": "<a id='comment:3'></a>\nI just found this and took a look.  It's easy to fix (though I don't know what has changed): in line 5770 of ell_rational_field.py ratpoints() does not like being given H=0 which it is in this case.  I fixed this example by replacing the line above, defining H by\n\n```\nH = max(xmin.abs(), xmax.abs(), 1)\n```\nI am running some tests.",
    "created_at": "2017-11-07T19:48:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22719#issuecomment-423541",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:3'></a>
I just found this and took a look.  It's easy to fix (though I don't know what has changed): in line 5770 of ell_rational_field.py ratpoints() does not like being given H=0 which it is in this case.  I fixed this example by replacing the line above, defining H by

```
H = max(xmin.abs(), xmax.abs(), 1)
```
I am running some tests.



---

archive/issue_comments_423542.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-11-07T20:00:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22719#issuecomment-423542",
    "user": "https://github.com/JohnCremona"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_423543.json:
```json
{
    "body": "Changing author from \"\" to \"John Cremona\"",
    "created_at": "2017-11-07T20:00:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22719#issuecomment-423543",
    "user": "https://github.com/JohnCremona"
}
```

Changing author from "" to "John Cremona"



---

archive/issue_comments_423544.json:
```json
{
    "body": "Changing commit from \"\" to \"5abadc71a145e3afce1a718da18452a3b611baa5\"",
    "created_at": "2017-11-07T20:00:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22719#issuecomment-423544",
    "user": "https://github.com/JohnCremona"
}
```

Changing commit from "" to "5abadc71a145e3afce1a718da18452a3b611baa5"



---

archive/issue_comments_423545.json:
```json
{
    "body": "Changing branch from \"\" to \"u/cremona/22719\"",
    "created_at": "2017-11-07T20:00:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22719#issuecomment-423545",
    "user": "https://github.com/JohnCremona"
}
```

Changing branch from "" to "u/cremona/22719"



---

archive/issue_comments_423546.json:
```json
{
    "body": "<a id='comment:4'></a>\nNew commits:\n|                                                                                                                                          |                                                        |\n|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------|\n|[5abadc7](https://git.sagemath.org/sage.git/commit?id=5abadc71a145e3afce1a718da18452a3b611baa5)|`#22719: fix bug in ratpoints call from integral_points`|",
    "created_at": "2017-11-07T20:00:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22719#issuecomment-423546",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:4'></a>
New commits:
|                                                                                                                                          |                                                        |
|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------|
|[5abadc7](https://git.sagemath.org/sage.git/commit?id=5abadc71a145e3afce1a718da18452a3b611baa5)|`#22719: fix bug in ratpoints call from integral_points`|



---

archive/issue_comments_423547.json:
```json
{
    "body": "<a id='comment:5'></a>\nI checked all curves of conductor <1000.  Doing more checking now -- note that it's a lot quicker to run E.integral_points() on curves when you have the optional database_cremona_ellcurve installed since it does not have to find the Mordell-Weil group of each.",
    "created_at": "2017-11-07T20:01:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22719#issuecomment-423547",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:5'></a>
I checked all curves of conductor <1000.  Doing more checking now -- note that it's a lot quicker to run E.integral_points() on curves when you have the optional database_cremona_ellcurve installed since it does not have to find the Mordell-Weil group of each.



---

archive/issue_comments_423548.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-11-08T22:55:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22719#issuecomment-423548",
    "user": "https://github.com/roed314"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_423549.json:
```json
{
    "body": "Changing reviewer from \"\" to \"David Roe\"",
    "created_at": "2017-11-08T22:55:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22719#issuecomment-423549",
    "user": "https://github.com/roed314"
}
```

Changing reviewer from "" to "David Roe"



---

archive/issue_comments_423550.json:
```json
{
    "body": "<a id='comment:6'></a>\nLooks good.",
    "created_at": "2017-11-08T22:55:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22719#issuecomment-423550",
    "user": "https://github.com/roed314"
}
```

<a id='comment:6'></a>
Looks good.



---

archive/issue_comments_423551.json:
```json
{
    "body": "<a id='comment:7'></a>\nOh, someone beat me to it :)\nI did random checks with thousands of curves and it always gives an answer now.",
    "created_at": "2017-11-09T09:10:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22719#issuecomment-423551",
    "user": "https://github.com/categorie"
}
```

<a id='comment:7'></a>
Oh, someone beat me to it :)
I did random checks with thousands of curves and it always gives an answer now.



---

archive/issue_comments_423552.json:
```json
{
    "body": "<a id='comment:8'></a>\nThanks both -- I meant to post again to say that I ran all curves up to conductor 10^5 with no problems.",
    "created_at": "2017-11-09T09:18:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22719#issuecomment-423552",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:8'></a>
Thanks both -- I meant to post again to say that I ran all curves up to conductor 10^5 with no problems.



---

archive/issue_events_059186.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-11-30T14:49:36Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/22719",
    "milestone": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22719#event-59186"
}
```



---

archive/issue_comments_423553.json:
```json
{
    "body": "Changing branch from \"u/cremona/22719\" to \"5abadc71a145e3afce1a718da18452a3b611baa5\"",
    "created_at": "2017-12-11T01:03:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22719#issuecomment-423553",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/cremona/22719" to "5abadc71a145e3afce1a718da18452a3b611baa5"



---

archive/issue_events_059187.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-12-11T01:03:55Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/22719",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22719#event-59187"
}
```



---

archive/issue_comments_423554.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-12-11T01:03:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22719#issuecomment-423554",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
