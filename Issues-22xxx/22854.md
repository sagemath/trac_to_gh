# Issue 22854: Extend bruhat graphs

archive/issues_022617.json:
```json
{
    "body": "Right now we can only get the Bruhat graph of Weyl groups even though we can do the same thing for Coxeter Groups. I plan on moving bruhat_graph from the WeylGroups class in combinat/root_system to the category of Coxeter groups. This will keep WeylGroup having the method, but expand it to Coxter groups.\n\nAdditionally, it would be natural to not require two elements to find a the graph between them. So instead, if the group is finite, we'll allow the calling of bruhat_graph() which will bring back the entire graph.\n\nCC:  @nthiery @tscrim @fchapoton\n\nKeywords: sagedays86\n\nReviewer: Travis Scrimshaw, Fr\u00e9d\u00e9ric Chapoton\n\nAuthor: Aram Dermenjian\n\nBranch: 33265f88aa753bbf0666ed50d82b4896ec842514\n\nCommit: 33265f88aa753bbf0666ed50d82b4896ec842514\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/22854\n\n",
    "closed_at": "2017-05-31T22:25:39Z",
    "created_at": "2017-04-21T18:32:13Z",
    "labels": [
        "component: combinatorics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.0",
    "title": "Extend bruhat graphs",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22854",
    "user": "https://github.com/thecaligarmo"
}
```
Right now we can only get the Bruhat graph of Weyl groups even though we can do the same thing for Coxeter Groups. I plan on moving bruhat_graph from the WeylGroups class in combinat/root_system to the category of Coxeter groups. This will keep WeylGroup having the method, but expand it to Coxter groups.

Additionally, it would be natural to not require two elements to find a the graph between them. So instead, if the group is finite, we'll allow the calling of bruhat_graph() which will bring back the entire graph.

CC:  @nthiery @tscrim @fchapoton

Keywords: sagedays86

Reviewer: Travis Scrimshaw, Frédéric Chapoton

Author: Aram Dermenjian

Branch: 33265f88aa753bbf0666ed50d82b4896ec842514

Commit: 33265f88aa753bbf0666ed50d82b4896ec842514

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/22854





---

archive/issue_comments_315218.json:
```json
{
    "body": "Changing keywords from \"\" to \"sagedays86\".",
    "created_at": "2017-04-21T18:51:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22854#issuecomment-315218",
    "user": "https://github.com/thecaligarmo"
}
```

Changing keywords from "" to "sagedays86".



---

archive/issue_comments_315219.json:
```json
{
    "body": "<a id='comment:4'></a>This should be ready for review.\n\n---\nNew commits:",
    "created_at": "2017-04-21T18:58:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22854#issuecomment-315219",
    "user": "https://github.com/thecaligarmo"
}
```

<a id='comment:4'></a>This should be ready for review.

---
New commits:



---

archive/issue_comments_315220.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-04-21T18:58:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22854#issuecomment-315220",
    "user": "https://github.com/thecaligarmo"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_315221.json:
```json
{
    "body": "<a id='comment:7'></a>Some comments:\n\n-I think the extra doctests should not be in the block below saying `:trac:`17744``, but above it.\n- Instead of this complicated check for the long element and you already test `self.is_finite()`, so just do the default being the long element there. This is better locality of code.\n- A better error message would be `infinite groups must specify a maximal element`.\n- `reflection_length` needs a doctest.\n- Even though it is slight code duplication, it would be faster (and probably cleaner) to use code similar to `bruhat_interval`. While this could be done on a separate ticket, I think it would be better to do this here and now.",
    "created_at": "2017-04-22T02:24:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22854#issuecomment-315221",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:7'></a>Some comments:

-I think the extra doctests should not be in the block below saying `:trac:`17744``, but above it.
- Instead of this complicated check for the long element and you already test `self.is_finite()`, so just do the default being the long element there. This is better locality of code.
- A better error message would be `infinite groups must specify a maximal element`.
- `reflection_length` needs a doctest.
- Even though it is slight code duplication, it would be faster (and probably cleaner) to use code similar to `bruhat_interval`. While this could be done on a separate ticket, I think it would be better to do this here and now.



---

archive/issue_comments_315222.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-04-22T13:06:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22854#issuecomment-315222",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_315223.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-04-22T13:07:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22854#issuecomment-315223",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_315224.json:
```json
{
    "body": "<a id='comment:10'></a>So all the above corrections have been made.\n\nI didn't understand what you meant by replicating bruhat_interval in your last comment. Do you mean using a similar while loop in bruhat_group to find all potential additional chains? The issue here is that if the group is infinite we can't go through \"all\" the reflections to test things out. Hence why this method was used (and I kept it over from the current version). Unless you mean something different?\n\n---\nNew commits:",
    "created_at": "2017-04-22T13:09:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22854#issuecomment-315224",
    "user": "https://github.com/thecaligarmo"
}
```

<a id='comment:10'></a>So all the above corrections have been made.

I didn't understand what you meant by replicating bruhat_interval in your last comment. Do you mean using a similar while loop in bruhat_group to find all potential additional chains? The issue here is that if the group is infinite we can't go through "all" the reflections to test things out. Hence why this method was used (and I kept it over from the current version). Unless you mean something different?

---
New commits:



---

archive/issue_comments_315225.json:
```json
{
    "body": "<a id='comment:11'></a>Actually, looking into this a bit more, I think we should have `bruhat_graph` be constructed from the transitive closure of the digraph of the Bruhat cover relations. This way we would not have to look at what is a reflection and what is not.\n\nSo what I would do is start with a hidden method `_bruhat_covers_digraph`, which builds the digraph of cover relations by using code from `bruhat_interval`. Then `bruhat_graph` would return `self._bruhat_covers_digraph(x,y).transitive_closure()`. Furthermore, `bruhat_poset` could be lifted and generalized to return `Poset(self._bruhat_covers_digraph(x,y), cover_relations=True, facade=facade)`.\n\nI can do this is if you want me to.",
    "created_at": "2017-04-22T14:04:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22854#issuecomment-315225",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:11'></a>Actually, looking into this a bit more, I think we should have `bruhat_graph` be constructed from the transitive closure of the digraph of the Bruhat cover relations. This way we would not have to look at what is a reflection and what is not.

So what I would do is start with a hidden method `_bruhat_covers_digraph`, which builds the digraph of cover relations by using code from `bruhat_interval`. Then `bruhat_graph` would return `self._bruhat_covers_digraph(x,y).transitive_closure()`. Furthermore, `bruhat_poset` could be lifted and generalized to return `Poset(self._bruhat_covers_digraph(x,y), cover_relations=True, facade=facade)`.

I can do this is if you want me to.



---

archive/issue_comments_315226.json:
```json
{
    "body": "<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-05-10T20:55:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22854#issuecomment-315226",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_315227.json:
```json
{
    "body": "<a id='comment:13'></a>So one reason transitive closure isn't a good idea is because I'd like to keep track of the reflection used to make that transition (as added in my latest commit). Also, I'm not exactly sure how the transitive closure would work in this case. Do you want to do a run with the poset and if it works as expected I can merge the two with Bruhat graph? (Or you can add it into Bruhat graph directly if you'd prefer)",
    "created_at": "2017-05-10T20:59:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22854#issuecomment-315227",
    "user": "https://github.com/thecaligarmo"
}
```

<a id='comment:13'></a>So one reason transitive closure isn't a good idea is because I'd like to keep track of the reflection used to make that transition (as added in my latest commit). Also, I'm not exactly sure how the transitive closure would work in this case. Do you want to do a run with the poset and if it works as expected I can merge the two with Bruhat graph? (Or you can add it into Bruhat graph directly if you'd prefer)



---

archive/issue_comments_315228.json:
```json
{
    "body": "<a id='comment:14'></a>Actually, the transitive closure is too permissive as you can get differences that are products of reflections, which of course, are not always reflections. However, I was able to get a massive speed boost by sorting the `bruhat_interval` by length so we only have to do approx `n^2 / 2` checks and not have to do the length checks each time.\n\nI also added a `bruhat_interval_poset`, which goes slightly beyond the scope of the ticket but is in the spirit of it, instead of lifting up `bruhat_poset` to keep that reserved for the entire Bruhat order poset.\n\n---\nNew commits:",
    "created_at": "2017-05-17T23:03:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22854#issuecomment-315228",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:14'></a>Actually, the transitive closure is too permissive as you can get differences that are products of reflections, which of course, are not always reflections. However, I was able to get a massive speed boost by sorting the `bruhat_interval` by length so we only have to do approx `n^2 / 2` checks and not have to do the length checks each time.

I also added a `bruhat_interval_poset`, which goes slightly beyond the scope of the ticket but is in the spirit of it, instead of lifting up `bruhat_poset` to keep that reserved for the entire Bruhat order poset.

---
New commits:



---

archive/issue_comments_315229.json:
```json
{
    "body": "<a id='comment:15'></a>ping - Patchbot is (essentially) green.",
    "created_at": "2017-05-29T21:05:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22854#issuecomment-315229",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:15'></a>ping - Patchbot is (essentially) green.



---

archive/issue_comments_315230.json:
```json
{
    "body": "<a id='comment:16'></a>ok, let it be (though I do not like that \"reflection length\" is not just an alias).",
    "created_at": "2017-05-30T07:37:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22854#issuecomment-315230",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:16'></a>ok, let it be (though I do not like that "reflection length" is not just an alias).



---

archive/issue_comments_315231.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-05-30T07:37:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22854#issuecomment-315231",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_315232.json:
```json
{
    "body": "<a id='comment:17'></a>Looks good on my end too. I can always quickly alter reflection length to be an alias instead of a direct call if you'd prefer Chapoton. (I hadn't realised aliasing was possible) Just let me know and I'll quickly do it tonight.",
    "created_at": "2017-05-30T11:21:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22854#issuecomment-315232",
    "user": "https://github.com/thecaligarmo"
}
```

<a id='comment:17'></a>Looks good on my end too. I can always quickly alter reflection length to be an alias instead of a direct call if you'd prefer Chapoton. (I hadn't realised aliasing was possible) Just let me know and I'll quickly do it tonight.



---

archive/issue_comments_315233.json:
```json
{
    "body": "<a id='comment:18'></a>No, let us keep things as they are, no need to re-open the ticket for that.",
    "created_at": "2017-05-30T11:35:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22854#issuecomment-315233",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:18'></a>No, let us keep things as they are, no need to re-open the ticket for that.



---

archive/issue_events_059375.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-05-31T22:25:39Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/22854",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22854#event-59375"
}
```



---

archive/issue_comments_315234.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-05-31T22:25:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22854#issuecomment-315234",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
