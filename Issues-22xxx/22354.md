# Issue 22354: Install both python 2 & 3 by default

archive/issues_022117.json:
```json
{
    "body": "As long as we don't change the python symlink this has very little potential for errors. But it'll allow us to add 2/3 regression tests, e.g. check that all sources can be compiled by python3 (though not on this ticket).\n\nReviewer: John Palmieri\n\nAuthor: Volker Braun\n\nBranch: c133592a8d511178c556f0015544e4a4256e831a\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/22354\n\n",
    "closed_at": "2017-02-21T14:34:58Z",
    "created_at": "2017-02-11T11:16:30Z",
    "labels": [
        "component: python3"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.6",
    "title": "Install both python 2 & 3 by default",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22354",
    "user": "https://github.com/vbraun"
}
```
As long as we don't change the python symlink this has very little potential for errors. But it'll allow us to add 2/3 regression tests, e.g. check that all sources can be compiled by python3 (though not on this ticket).

Reviewer: John Palmieri

Author: Volker Braun

Branch: c133592a8d511178c556f0015544e4a4256e831a

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/22354





---

archive/issue_comments_414538.json:
```json
{
    "body": "Changing branch from \"\" to \"u/vbraun/install_both_python_2_and_3_by_default\"",
    "created_at": "2017-02-11T14:13:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22354",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22354#issuecomment-414538",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "" to "u/vbraun/install_both_python_2_and_3_by_default"



---

archive/issue_comments_414539.json:
```json
{
    "body": "<a id='comment:2'></a>\nNew commits:\n|                                                                                                                                          |                             |\n|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------|\n|[80e64a2](https://git.sagemath.org/sage.git/commit?id=80e64a238d51dca84e5a9ccd5db7868732bf7af8)|`Always build Python 2 and 3`|",
    "created_at": "2017-02-11T14:17:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22354",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22354#issuecomment-414539",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:2'></a>
New commits:
|                                                                                                                                          |                             |
|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------|
|[80e64a2](https://git.sagemath.org/sage.git/commit?id=80e64a238d51dca84e5a9ccd5db7868732bf7af8)|`Always build Python 2 and 3`|



---

archive/issue_comments_414540.json:
```json
{
    "body": "Changing author from \"\" to \"Volker Braun\"",
    "created_at": "2017-02-11T14:17:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22354",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22354#issuecomment-414540",
    "user": "https://github.com/vbraun"
}
```

Changing author from "" to "Volker Braun"



---

archive/issue_comments_414541.json:
```json
{
    "body": "Changing commit from \"\" to \"80e64a238d51dca84e5a9ccd5db7868732bf7af8\"",
    "created_at": "2017-02-11T14:17:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22354",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22354#issuecomment-414541",
    "user": "https://github.com/vbraun"
}
```

Changing commit from "" to "80e64a238d51dca84e5a9ccd5db7868732bf7af8"



---

archive/issue_comments_414542.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-02-11T14:17:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22354",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22354#issuecomment-414542",
    "user": "https://github.com/vbraun"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_414543.json:
```json
{
    "body": "<a id='comment:3'></a>\nI guess Python 3 doesn't take that long to build, but most users won't ever use it, so why make it standard? Why not make it optional instead (including the other changes here so that installing Python 3 won't break Sage)?\n\nThe variable `SAGE_PYTHON3` needs to be documented. It should have been documented before, but it was only used in the top level `configure` file. In this ticket it is starting to be used more widely, so documentation is more important.",
    "created_at": "2017-02-14T19:44:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22354",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22354#issuecomment-414543",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:3'></a>
I guess Python 3 doesn't take that long to build, but most users won't ever use it, so why make it standard? Why not make it optional instead (including the other changes here so that installing Python 3 won't break Sage)?

The variable `SAGE_PYTHON3` needs to be documented. It should have been documented before, but it was only used in the top level `configure` file. In this ticket it is starting to be used more widely, so documentation is more important.



---

archive/issue_comments_414544.json:
```json
{
    "body": "<a id='comment:4'></a>\nHopefully most users WILL use Python 3 in the future ;-)\n\nThe advantage of having it by default is that we can use it for regression testing so that the part that already works with Python 3 will keep working during the transition period: #22357",
    "created_at": "2017-02-14T20:06:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22354",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22354#issuecomment-414544",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:4'></a>
Hopefully most users WILL use Python 3 in the future ;-)

The advantage of having it by default is that we can use it for regression testing so that the part that already works with Python 3 will keep working during the transition period: #22357



---

archive/issue_comments_414545.json:
```json
{
    "body": "<a id='comment:5'></a>\nSome time ago, at least one person did not want that SAGE_PYTHON3 get documented : #20912.",
    "created_at": "2017-02-14T20:11:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22354",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22354#issuecomment-414545",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:5'></a>
Some time ago, at least one person did not want that SAGE_PYTHON3 get documented : #20912.



---

archive/issue_comments_414546.json:
```json
{
    "body": "<a id='comment:6'></a>\nFor the documentation, how about something like this:\n\n```diff\ndiff --git a/src/doc/en/installation/source.rst b/src/doc/en/installation/source.rst\nindex 1539260..d265cab 100644\n--- a/src/doc/en/installation/source.rst\n+++ b/src/doc/en/installation/source.rst\n@@ -1121,6 +1121,19 @@ Here are some of the more commonly used variables affecting the build process:\n   supports :envvar:`SAGE_SUDO`, into a root-owned installation\n   hierarchy (:envvar:`SAGE_LOCAL`).\n \n+- :envvar:`SAGE_PYTHON3` - set this to ``yes`` to build Sage using\n+  Python 3 rather than Python 2.\n+\n+  .. WARNING::\n+\n+     This will probably break your Sage installation!\n+\n+  .. WARNING::\n+\n+     This environment variable may not be supported in future versions\n+     of Sage; it may be replaced by (for example) ``configure``\n+     options.\n+\n Variables to set if you're trying to build Sage with an unusual setup, e.g.,\n an unsupported machine or an unusual compiler:\n \n```",
    "created_at": "2017-02-14T20:25:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22354",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22354#issuecomment-414546",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:6'></a>
For the documentation, how about something like this:

```diff
diff --git a/src/doc/en/installation/source.rst b/src/doc/en/installation/source.rst
index 1539260..d265cab 100644
--- a/src/doc/en/installation/source.rst
+++ b/src/doc/en/installation/source.rst
@@ -1121,6 +1121,19 @@ Here are some of the more commonly used variables affecting the build process:
   supports :envvar:`SAGE_SUDO`, into a root-owned installation
   hierarchy (:envvar:`SAGE_LOCAL`).
 
+- :envvar:`SAGE_PYTHON3` - set this to ``yes`` to build Sage using
+  Python 3 rather than Python 2.
+
+  .. WARNING::
+
+     This will probably break your Sage installation!
+
+  .. WARNING::
+
+     This environment variable may not be supported in future versions
+     of Sage; it may be replaced by (for example) ``configure``
+     options.
+
 Variables to set if you're trying to build Sage with an unusual setup, e.g.,
 an unsupported machine or an unusual compiler:
 
```



---

archive/issue_comments_414547.json:
```json
{
    "body": "<a id='comment:7'></a>\nFine with me; I'd be less hesitant in saying that it will definitely be removed in 2020 together with python 2 ;-)",
    "created_at": "2017-02-15T07:54:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22354",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22354#issuecomment-414547",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:7'></a>
Fine with me; I'd be less hesitant in saying that it will definitely be removed in 2020 together with python 2 ;-)



---

archive/issue_comments_414548.json:
```json
{
    "body": "Changing branch from \"u/vbraun/install_both_python_2_and_3_by_default\" to \"u/jhpalmieri/install_both_python_2_and_3_by_default\"",
    "created_at": "2017-02-15T18:24:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22354",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22354#issuecomment-414548",
    "user": "https://github.com/jhpalmieri"
}
```

Changing branch from "u/vbraun/install_both_python_2_and_3_by_default" to "u/jhpalmieri/install_both_python_2_and_3_by_default"



---

archive/issue_comments_414549.json:
```json
{
    "body": "<a id='comment:9'></a>\nOkay, I've added the documentation to the branch. I'm okay with the rest of it.\n\n---\nNew commits:\n|                                                                                                                                          |                       |\n|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------|\n|[c133592](https://git.sagemath.org/sage.git/commit?id=c133592a8d511178c556f0015544e4a4256e831a)|`document SAGE_PYTHON3`|",
    "created_at": "2017-02-15T18:38:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22354",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22354#issuecomment-414549",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:9'></a>
Okay, I've added the documentation to the branch. I'm okay with the rest of it.

---
New commits:
|                                                                                                                                          |                       |
|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------|
|[c133592](https://git.sagemath.org/sage.git/commit?id=c133592a8d511178c556f0015544e4a4256e831a)|`document SAGE_PYTHON3`|



---

archive/issue_comments_414550.json:
```json
{
    "body": "Changing commit from \"80e64a238d51dca84e5a9ccd5db7868732bf7af8\" to \"c133592a8d511178c556f0015544e4a4256e831a\"",
    "created_at": "2017-02-15T18:38:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22354",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22354#issuecomment-414550",
    "user": "https://github.com/jhpalmieri"
}
```

Changing commit from "80e64a238d51dca84e5a9ccd5db7868732bf7af8" to "c133592a8d511178c556f0015544e4a4256e831a"



---

archive/issue_comments_414551.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-02-17T20:04:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22354",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22354#issuecomment-414551",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_414552.json:
```json
{
    "body": "Changing reviewer from \"\" to \"John Palmieri\"",
    "created_at": "2017-02-17T20:04:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22354",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22354#issuecomment-414552",
    "user": "https://github.com/vbraun"
}
```

Changing reviewer from "" to "John Palmieri"



---

archive/issue_comments_414553.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-02-21T14:34:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22354",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22354#issuecomment-414553",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_414554.json:
```json
{
    "body": "Changing branch from \"u/jhpalmieri/install_both_python_2_and_3_by_default\" to \"c133592a8d511178c556f0015544e4a4256e831a\"",
    "created_at": "2017-02-21T14:34:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22354",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22354#issuecomment-414554",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/jhpalmieri/install_both_python_2_and_3_by_default" to "c133592a8d511178c556f0015544e4a4256e831a"



---

archive/issue_events_058575.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-02-21T14:34:58Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/22354",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22354#event-58575"
}
```



---

archive/issue_comments_414555.json:
```json
{
    "body": "<a id='comment:13'></a>\nThis broke building with `SAGE_PYTHON3=yes`: #22638.",
    "created_at": "2017-03-18T14:35:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22354",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22354#issuecomment-414555",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:13'></a>
This broke building with `SAGE_PYTHON3=yes`: #22638.



---

archive/issue_comments_414556.json:
```json
{
    "body": "Changing commit from \"c133592a8d511178c556f0015544e4a4256e831a\" to \"\"",
    "created_at": "2017-03-18T14:35:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22354",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22354#issuecomment-414556",
    "user": "https://github.com/jdemeyer"
}
```

Changing commit from "c133592a8d511178c556f0015544e4a4256e831a" to ""



---

archive/issue_comments_414557.json:
```json
{
    "body": "<a id='comment:14'></a>\nSee #22756 for a followup: Python3 seems to be broken on OS X.",
    "created_at": "2017-04-04T21:39:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22354",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22354#issuecomment-414557",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:14'></a>
See #22756 for a followup: Python3 seems to be broken on OS X.



---

archive/issue_comments_414558.json:
```json
{
    "body": "<a id='comment:15'></a>\nSee #22770 for an easy to review followup to this ticket: this ticket introduced an error in the functools32 spkg-install script, fixed at #22770.",
    "created_at": "2017-04-06T16:58:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22354",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22354#issuecomment-414558",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:15'></a>
See #22770 for an easy to review followup to this ticket: this ticket introduced an error in the functools32 spkg-install script, fixed at #22770.
