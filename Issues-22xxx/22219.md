# Issue 22219: Upgrade to pynac-0.7.4

archive/issues_021982.json:
```json
{
    "body": "From pynac-0.7.4 Changelog:\n* improve domain logic (#18883, #22026)\n* improve derivatives of `conjugate`, `real`, `imag`, `abs` (#22209)\n* precision was lost with some useries\n* replace crationality with exactness when deciding when to evalf (fixes #22142)\n* fix giac support\n* expose `to_gamma()` and `gamma_normalize()` to Sage (#22174)\n* improve gamma normalization in Gosper summation\n* performance improvements\n* fix inconsistent handling of exact function arguments (#22142)\n\nWith this ticket we also finally turn on Giac support in Pynac (used for GCD) again (#21885).\n\nhttps://github.com/pynac/pynac/releases/download/pynac-0.7.4/pynac-0.7.4.tar.bz2\n\nReviewer: Volker Braun\n\nAuthor: Ralf Stephan\n\nBranch: 57c7bcef7b1d94ef86c4278b0cf11c13dbfb854d\n\nCommit: 57c7bcef7b1d94ef86c4278b0cf11c13dbfb854d\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/22219\n\n",
    "closed_at": "2017-02-06T23:11:38Z",
    "created_at": "2017-01-20T16:10:00Z",
    "labels": [
        "component: packages: standard"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.6",
    "title": "Upgrade to pynac-0.7.4",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22219",
    "user": "https://github.com/rwst"
}
```
From pynac-0.7.4 Changelog:
* improve domain logic (#18883, #22026)
* improve derivatives of `conjugate`, `real`, `imag`, `abs` (#22209)
* precision was lost with some useries
* replace crationality with exactness when deciding when to evalf (fixes #22142)
* fix giac support
* expose `to_gamma()` and `gamma_normalize()` to Sage (#22174)
* improve gamma normalization in Gosper summation
* performance improvements
* fix inconsistent handling of exact function arguments (#22142)

With this ticket we also finally turn on Giac support in Pynac (used for GCD) again (#21885).

https://github.com/pynac/pynac/releases/download/pynac-0.7.4/pynac-0.7.4.tar.bz2

Reviewer: Volker Braun

Author: Ralf Stephan

Branch: 57c7bcef7b1d94ef86c4278b0cf11c13dbfb854d

Commit: 57c7bcef7b1d94ef86c4278b0cf11c13dbfb854d

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/22219





---

archive/issue_comments_305227.json:
```json
{
    "body": "<a id='comment:2'></a>New commits:",
    "created_at": "2017-01-20T16:24:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22219#issuecomment-305227",
    "user": "https://github.com/rwst"
}
```

<a id='comment:2'></a>New commits:



---

archive/issue_comments_305228.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-01-20T16:24:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22219#issuecomment-305228",
    "user": "https://github.com/rwst"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_305229.json:
```json
{
    "body": "<a id='comment:3'></a>I get a bunch of errors when running tests on a POWER7:\n\n```\nsage: y = var('y')\nsage: g = x + y/(x + 2); g\nx + y/(x + 2)\nsage: g\nx + y/(x + 2)\nsage: g.numerator()\n---------------------------------------------------------------------------\nRuntimeError                              Traceback (most recent call last)\n<ipython-input-4-7f8c42e112c2> in <module>()\n----> 1 g.numerator()\n\n/home/jpflori/sage.git/src/sage/symbolic/expression.pyx in sage.symbolic.expression.Expression.numerator (/home/jpflori/sage.git/src/build/cythonized/sage/symbolic/expression.cpp:45767)()\n   8608         cdef GEx oper, power\n   8609         if normalize:\n-> 8610             return new_Expression_from_GEx(self._parent, self._gobj.numer())\n   8611         elif is_a_mul(self._gobj):\n   8612             for i from 0 <= i < self._gobj.nops():\n\nRuntimeError: Exponent overflow Error: Bad Argument Value\n```",
    "created_at": "2017-01-31T12:15:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22219#issuecomment-305229",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:3'></a>I get a bunch of errors when running tests on a POWER7:

```
sage: y = var('y')
sage: g = x + y/(x + 2); g
x + y/(x + 2)
sage: g
x + y/(x + 2)
sage: g.numerator()
---------------------------------------------------------------------------
RuntimeError                              Traceback (most recent call last)
<ipython-input-4-7f8c42e112c2> in <module>()
----> 1 g.numerator()

/home/jpflori/sage.git/src/sage/symbolic/expression.pyx in sage.symbolic.expression.Expression.numerator (/home/jpflori/sage.git/src/build/cythonized/sage/symbolic/expression.cpp:45767)()
   8608         cdef GEx oper, power
   8609         if normalize:
-> 8610             return new_Expression_from_GEx(self._parent, self._gobj.numer())
   8611         elif is_a_mul(self._gobj):
   8612             for i from 0 <= i < self._gobj.nops():

RuntimeError: Exponent overflow Error: Bad Argument Value
```



---

archive/issue_comments_305230.json:
```json
{
    "body": "<a id='comment:4'></a>Could you please do the following: start `sage -gdb`, hit Ctrl-Z to get the gdb prompt, input `catch throw` then give `c<Enter>` until you get back to the Sage prompt. Now on error you should be thrown directly down to gdb. Now I would be interested in a backtrace that you can get with `bt`. I don't need the full list, please give me just the C++ part, i.e. everything until you see the `Py...` functions.",
    "created_at": "2017-01-31T13:55:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22219#issuecomment-305230",
    "user": "https://github.com/rwst"
}
```

<a id='comment:4'></a>Could you please do the following: start `sage -gdb`, hit Ctrl-Z to get the gdb prompt, input `catch throw` then give `c<Enter>` until you get back to the Sage prompt. Now on error you should be thrown directly down to gdb. Now I would be interested in a backtrace that you can get with `bt`. I don't need the full list, please give me just the C++ part, i.e. everything until you see the `Py...` functions.



---

archive/issue_comments_305231.json:
```json
{
    "body": "<a id='comment:5'></a>Here you go:\n\n```\n#0  0x00003fffac10ae54 in .__cxa_throw () from /lib64/libstdc++.so.6\n#1  0x00003ffb20b99b38 in giac::undeferr (\n    s=\"Exponent overflow Error: Bad Argument Value\") at gen.cc:445\n#2  0x00003ffb20b99f84 in giac::gensizeerr (s=...) at gen.cc:485\n#3  0x00003ffb20c0110c in giac::pow (base=..., exponent=<optimized out>)\n    at gen.cc:7096\n#4  0x00003ffb20472644 in giac::giac_gcd_modular_algo1 (p=..., q=..., d=...)\n    at modpoly.cc:7309\n#5  0x00003ffb2047af4c in giac::gcd_modular_algo1 (p=..., q=..., d=..., \n    compute_cof=<optimized out>) at modpoly.cc:7675\n#6  0x00003ffb201decc4 in giac::gcd_modular_algo (p=..., q=..., d=..., \n    compute_cof=<optimized out>) at gausspol.cc:3513\n#7  0x00003ffb2047bc38 in giac::gcd_modular (p_orig=..., q_orig=..., pgcd=..., \n    pcofactor=..., qcofactor=..., compute_cofactors=<optimized out>)\n    at modpoly.cc:2878\n#8  0x00003ffb201bcb28 in giac::gcdheu (p_orig=..., \n    p_deg=std::vector of length 1, capacity 1 = {...}, q_orig=..., \n    q_deg=std::vector of length 1, capacity 1 = {...}, p_simp=..., \n    np_simp=..., q_simp=..., nq_simp=..., d=..., d_content=..., \n    skip_test=skip_test@entry=false, \n    compute_cofactors=compute_cofactors@entry=false) at gausspol.cc:3920\n#9  0x00003ffb201c256c in giac::gcd (p=..., q=..., d=...) at gausspol.cc:4675\n#10 0x00003ffb201c1eec in giac::gcd (p=..., q=..., d=...) at gausspol.cc:4657\n#11 0x00003ffb201c2c9c in giac::gcd (p=..., q=...) at gausspol.cc:4693\n#12 0x00003ffb201c7988 in giac::has_constant_variables_gcd (p=..., q=..., \n    d=...) at gausspol.cc:3756\n#13 0x00003ffb201c2418 in giac::gcd (p=..., q=..., d=...) at gausspol.cc:4669\n#14 0x00003ffb210d1b0c in GiNaC::gcdpoly (a=..., b=..., ca=0x3fffffff9b18, \n    cb=0x3fffffff9b10, check_args=<optimized out>) at mpoly-giac.cpp:392\n#15 0x00003ffb21100a28 in GiNaC::frac_cancel (n=..., d=...) at normal.cpp:405\n#16 0x00003ffb211016f0 in GiNaC::add::normal (this=<optimized out>, repl=..., \n    rev_lookup=..., level=<optimized out>, options=<optimized out>)\n    at normal.cpp:491\n#17 0x00003ffb210f9cec in GiNaC::ex::numer (this=<optimized out>)\n    at normal.cpp:646\n...\n```",
    "created_at": "2017-01-31T14:16:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22219#issuecomment-305231",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:5'></a>Here you go:

```
#0  0x00003fffac10ae54 in .__cxa_throw () from /lib64/libstdc++.so.6
#1  0x00003ffb20b99b38 in giac::undeferr (
    s="Exponent overflow Error: Bad Argument Value") at gen.cc:445
#2  0x00003ffb20b99f84 in giac::gensizeerr (s=...) at gen.cc:485
#3  0x00003ffb20c0110c in giac::pow (base=..., exponent=<optimized out>)
    at gen.cc:7096
#4  0x00003ffb20472644 in giac::giac_gcd_modular_algo1 (p=..., q=..., d=...)
    at modpoly.cc:7309
#5  0x00003ffb2047af4c in giac::gcd_modular_algo1 (p=..., q=..., d=..., 
    compute_cof=<optimized out>) at modpoly.cc:7675
#6  0x00003ffb201decc4 in giac::gcd_modular_algo (p=..., q=..., d=..., 
    compute_cof=<optimized out>) at gausspol.cc:3513
#7  0x00003ffb2047bc38 in giac::gcd_modular (p_orig=..., q_orig=..., pgcd=..., 
    pcofactor=..., qcofactor=..., compute_cofactors=<optimized out>)
    at modpoly.cc:2878
#8  0x00003ffb201bcb28 in giac::gcdheu (p_orig=..., 
    p_deg=std::vector of length 1, capacity 1 = {...}, q_orig=..., 
    q_deg=std::vector of length 1, capacity 1 = {...}, p_simp=..., 
    np_simp=..., q_simp=..., nq_simp=..., d=..., d_content=..., 
    skip_test=skip_test@entry=false, 
    compute_cofactors=compute_cofactors@entry=false) at gausspol.cc:3920
#9  0x00003ffb201c256c in giac::gcd (p=..., q=..., d=...) at gausspol.cc:4675
#10 0x00003ffb201c1eec in giac::gcd (p=..., q=..., d=...) at gausspol.cc:4657
#11 0x00003ffb201c2c9c in giac::gcd (p=..., q=...) at gausspol.cc:4693
#12 0x00003ffb201c7988 in giac::has_constant_variables_gcd (p=..., q=..., 
    d=...) at gausspol.cc:3756
#13 0x00003ffb201c2418 in giac::gcd (p=..., q=..., d=...) at gausspol.cc:4669
#14 0x00003ffb210d1b0c in GiNaC::gcdpoly (a=..., b=..., ca=0x3fffffff9b18, 
    cb=0x3fffffff9b10, check_args=<optimized out>) at mpoly-giac.cpp:392
#15 0x00003ffb21100a28 in GiNaC::frac_cancel (n=..., d=...) at normal.cpp:405
#16 0x00003ffb211016f0 in GiNaC::add::normal (this=<optimized out>, repl=..., 
    rev_lookup=..., level=<optimized out>, options=<optimized out>)
    at normal.cpp:491
#17 0x00003ffb210f9cec in GiNaC::ex::numer (this=<optimized out>)
    at normal.cpp:646
...
```



---

archive/issue_comments_305232.json:
```json
{
    "body": "<a id='comment:6'></a>Which looks very giac related.\nI think I got other giac errors (without going through pynac), I'll have to check.",
    "created_at": "2017-01-31T14:18:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22219#issuecomment-305232",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:6'></a>Which looks very giac related.
I think I got other giac errors (without going through pynac), I'll have to check.



---

archive/issue_comments_305233.json:
```json
{
    "body": "<a id='comment:7'></a>It might be http://xcas.e.ujf-grenoble.fr/XCAS/viewtopic.php?f=19&t=1723 so completely pynac unrelated.",
    "created_at": "2017-01-31T14:24:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22219#issuecomment-305233",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:7'></a>It might be http://xcas.e.ujf-grenoble.fr/XCAS/viewtopic.php?f=19&t=1723 so completely pynac unrelated.



---

archive/issue_comments_305234.json:
```json
{
    "body": "<a id='comment:8'></a>And I guess it also means the dependencies file should mention giac.",
    "created_at": "2017-01-31T14:36:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22219#issuecomment-305234",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:8'></a>And I guess it also means the dependencies file should mention giac.



---

archive/issue_comments_305235.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-01-31T15:48:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22219#issuecomment-305235",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_305236.json:
```json
{
    "body": "<a id='comment:10'></a>Replying to [comment:8 jpflori]:\n> And I guess it also means the dependencies file should mention giac.\n\n\nYes, I always forget that.",
    "created_at": "2017-01-31T15:49:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22219#issuecomment-305236",
    "user": "https://github.com/rwst"
}
```

<a id='comment:10'></a>Replying to [comment:8 jpflori]:
> And I guess it also means the dependencies file should mention giac.


Yes, I always forget that.



---

archive/issue_comments_305237.json:
```json
{
    "body": "<a id='comment:12'></a>FYI, Everything seem to work fine on Linux Mint 17.3.",
    "created_at": "2017-02-04T14:32:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22219#issuecomment-305237",
    "user": "https://github.com/dkrenn"
}
```

<a id='comment:12'></a>FYI, Everything seem to work fine on Linux Mint 17.3.



---

archive/issue_comments_305238.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-02-05T14:09:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22219#issuecomment-305238",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_305239.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-02-06T23:11:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22219#issuecomment-305239",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_058396.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-02-06T23:11:38Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/22219",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22219#event-58396"
}
```
