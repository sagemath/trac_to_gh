# Issue 22860: ticket #22840 causes breakage with some linkers when the order is important.

archive/issues_022623.json:
```json
{
    "body": "After #22840 was merged and released as part of 8.0.beta3 users of ubuntu 16.04.4 started to complain that `lcalc` couldn't be built\n\n```\ng++ -O3   -ffast-math -fPIC   -I../include -L/home/travis/sage-build/local/lib -Wl,-rpath,/home/travis/sage-build/local/lib  -L/home/travis/sage-build/local/lib -lpari -lgmp -L/home/travis/sage-build/local/lib -lpari -lgmp Lglobals.o Lgamma.o Lriemannsiegel.o Lriemannsiegel_blfi.o Ldokchitser.o Lcommandline_globals.o Lcommandline_misc.o Lcommandline_numbertheory.o Lcommandline_values_zeros.o Lcommandline_elliptic.o Lcommandline_twist.o Lcommandline.o cmdline.o -o lcalc \nLcommandline_elliptic.o: In function `cxcompotor.constprop.52':\nLcommandline_elliptic.cc:(.text+0x44): undefined reference to `pari_err'\nLcommandline_elliptic.cc:(.text+0x63): undefined reference to `avma'\nLcommandline_elliptic.cc:(.text+0x6a): undefined reference to `pari_mainstack'\nLcommandline_elliptic.cc:(.text+0xa3): undefined reference to `affir'\nLcommandline_elliptic.cc:(.text+0xc3): undefined reference to `avma'\n...\n...\nLcommandline_elliptic.cc:(.text+0x1289): undefined reference to `new_chunk_resize'\nLcommandline.o: In function `main':\nLcommandline.cc:(.text.startup+0x8d5): undefined reference to `pari_init'\nLcommandline.cc:(.text.startup+0x14ba): undefined reference to `paristack_setsize'\ncollect2: error: ld returned 1 exit status\n```\nThis is a perfect example were the libraries need to be after the objects needed them in some linkers.\n\n**CC:**  @dimpase @jm58660 @tscrim @strogdon\n\n**Branch:** [5f52680da6b7a705bccc40dd83cffeac1789abcd](https://github.com/sagemath/sagetrac-mirror/commit/5f52680da6b7a705bccc40dd83cffeac1789abcd)\n\n**Reviewer:** Travis Scrimshaw, Dima Pasechnik, Steven Trogdon\n\n**Author:** Fran\u00e7ois Bissey\n\nIssue created by migration from https://trac.sagemath.org/ticket/22860\n\n",
    "closed_at": "2017-04-27T20:11:58Z",
    "created_at": "2017-04-24T04:01:20Z",
    "labels": [
        "component: packages: standard",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.0",
    "title": "ticket #22840 causes breakage with some linkers when the order is important.",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22860",
    "user": "https://github.com/kiwifb"
}
```
After #22840 was merged and released as part of 8.0.beta3 users of ubuntu 16.04.4 started to complain that `lcalc` couldn't be built

```
g++ -O3   -ffast-math -fPIC   -I../include -L/home/travis/sage-build/local/lib -Wl,-rpath,/home/travis/sage-build/local/lib  -L/home/travis/sage-build/local/lib -lpari -lgmp -L/home/travis/sage-build/local/lib -lpari -lgmp Lglobals.o Lgamma.o Lriemannsiegel.o Lriemannsiegel_blfi.o Ldokchitser.o Lcommandline_globals.o Lcommandline_misc.o Lcommandline_numbertheory.o Lcommandline_values_zeros.o Lcommandline_elliptic.o Lcommandline_twist.o Lcommandline.o cmdline.o -o lcalc 
Lcommandline_elliptic.o: In function `cxcompotor.constprop.52':
Lcommandline_elliptic.cc:(.text+0x44): undefined reference to `pari_err'
Lcommandline_elliptic.cc:(.text+0x63): undefined reference to `avma'
Lcommandline_elliptic.cc:(.text+0x6a): undefined reference to `pari_mainstack'
Lcommandline_elliptic.cc:(.text+0xa3): undefined reference to `affir'
Lcommandline_elliptic.cc:(.text+0xc3): undefined reference to `avma'
...
...
Lcommandline_elliptic.cc:(.text+0x1289): undefined reference to `new_chunk_resize'
Lcommandline.o: In function `main':
Lcommandline.cc:(.text.startup+0x8d5): undefined reference to `pari_init'
Lcommandline.cc:(.text.startup+0x14ba): undefined reference to `paristack_setsize'
collect2: error: ld returned 1 exit status
```
This is a perfect example were the libraries need to be after the objects needed them in some linkers.

**CC:**  @dimpase @jm58660 @tscrim @strogdon

**Branch:** [5f52680da6b7a705bccc40dd83cffeac1789abcd](https://github.com/sagemath/sagetrac-mirror/commit/5f52680da6b7a705bccc40dd83cffeac1789abcd)

**Reviewer:** Travis Scrimshaw, Dima Pasechnik, Steven Trogdon

**Author:** François Bissey

Issue created by migration from https://trac.sagemath.org/ticket/22860





---

archive/issue_comments_408260.json:
```json
{
    "body": "<a id='comment:1'></a>\nDima, I will move LDFLAGS after the objects file in those makefiles. If this isn't working for you we'll have to do some split between flags proper and `LIBS`.",
    "created_at": "2017-04-24T04:02:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22860#issuecomment-408260",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:1'></a>
Dima, I will move LDFLAGS after the objects file in those makefiles. If this isn't working for you we'll have to do some split between flags proper and `LIBS`.



---

archive/issue_comments_408261.json:
```json
{
    "body": "<a id='comment:2'></a>\nI think only `lcalc` has an issue but looking closer I think LDFLAGS should be separated from \"`PARI_LIBS`\". Can you tell me what's in your LDFLAGS on freeBSD?",
    "created_at": "2017-04-24T04:43:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22860#issuecomment-408261",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:2'></a>
I think only `lcalc` has an issue but looking closer I think LDFLAGS should be separated from "`PARI_LIBS`". Can you tell me what's in your LDFLAGS on freeBSD?



---

archive/issue_comments_408262.json:
```json
{
    "body": "<a id='comment:3'></a>\nCc'ing myself. Got same error on two different Ubuntu 16.04 LTS machines.",
    "created_at": "2017-04-24T06:17:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22860#issuecomment-408262",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:3'></a>
Cc'ing myself. Got same error on two different Ubuntu 16.04 LTS machines.



---

archive/issue_comments_408263.json:
```json
{
    "body": "**Changing status** from new to needs_info.",
    "created_at": "2017-04-24T07:25:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22860#issuecomment-408263",
    "user": "https://github.com/kiwifb"
}
```

**Changing status** from new to needs_info.



---

archive/issue_comments_408264.json:
```json
{
    "body": "**Commit:** [cf3deccd71c5150b8d618cd1cbd244d5dd62c82e](https://github.com/sagemath/sagetrac-mirror/commit/cf3deccd71c5150b8d618cd1cbd244d5dd62c82e)",
    "created_at": "2017-04-24T07:25:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22860#issuecomment-408264",
    "user": "https://github.com/kiwifb"
}
```

**Commit:** [cf3deccd71c5150b8d618cd1cbd244d5dd62c82e](https://github.com/sagemath/sagetrac-mirror/commit/cf3deccd71c5150b8d618cd1cbd244d5dd62c82e)



---

archive/issue_comments_408265.json:
```json
{
    "body": "**Author:** Fran\u00e7ois Bissey",
    "created_at": "2017-04-24T07:25:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22860#issuecomment-408265",
    "user": "https://github.com/kiwifb"
}
```

**Author:** François Bissey



---

archive/issue_comments_408266.json:
```json
{
    "body": "<a id='comment:5'></a>\nOK here is a quick branch to test and give feedback on. But I am waiting for comments from Dima on freeBSD before putting to review #22840 was motivated by linking issues on freeBSD and I don't want to go backwards on that.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cf3deccd71c5150b8d618cd1cbd244d5dd62c82e\">cf3decc</a></td><td><code>New makefile.patch. Separate pari libraries from LDFLAGS and few cosmetics.</code></td></tr></table>\n",
    "created_at": "2017-04-24T07:25:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22860#issuecomment-408266",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:5'></a>
OK here is a quick branch to test and give feedback on. But I am waiting for comments from Dima on freeBSD before putting to review #22840 was motivated by linking issues on freeBSD and I don't want to go backwards on that.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cf3deccd71c5150b8d618cd1cbd244d5dd62c82e">cf3decc</a></td><td><code>New makefile.patch. Separate pari libraries from LDFLAGS and few cosmetics.</code></td></tr></table>




---

archive/issue_comments_408267.json:
```json
{
    "body": "**Branch:** [u/fbissey/lcalc_linking](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/lcalc_linking)",
    "created_at": "2017-04-24T07:25:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22860#issuecomment-408267",
    "user": "https://github.com/kiwifb"
}
```

**Branch:** [u/fbissey/lcalc_linking](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/lcalc_linking)



---

archive/issue_comments_408268.json:
```json
{
    "body": "<a id='comment:6'></a>\nOn FreeBSD I have\n`LDFLAGS=-L/usr/home/dima/Sage/sage/local/lib -Wl,--add-needed -lm`\n\nAnd this is the (working) command in question:\n\n```\nclang++-devel -fPIC -pipe -O3   -ffast-math -fPIC   -I../include -L/usr/home/dima/Sage/sage/local/lib -Wl,-rpath,/usr/home/dima/Sage/\nsage/local/lib -L/usr/home/dima/Sage/sage/local/lib -Wl,--add-needed -lm -L/usr/home/dima/Sage/sage/local/lib -lpari -lgmp -L/usr/hom\ne/dima/Sage/sage/local/lib -lpari -lgmp Lglobals.o Lgamma.o Lriemannsiegel.o Lriemannsiegel_blfi.o Ldokchitser.o Lcommandline_globals\n.o Lcommandline_misc.o Lcommandline_numbertheory.o Lcommandline_values_zeros.o Lcommandline_elliptic.o Lcommandline_twist.o Lcommandl\nine.o cmdline.o -o lcalc \n```",
    "created_at": "2017-04-24T07:44:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22860#issuecomment-408268",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:6'></a>
On FreeBSD I have
`LDFLAGS=-L/usr/home/dima/Sage/sage/local/lib -Wl,--add-needed -lm`

And this is the (working) command in question:

```
clang++-devel -fPIC -pipe -O3   -ffast-math -fPIC   -I../include -L/usr/home/dima/Sage/sage/local/lib -Wl,-rpath,/usr/home/dima/Sage/
sage/local/lib -L/usr/home/dima/Sage/sage/local/lib -Wl,--add-needed -lm -L/usr/home/dima/Sage/sage/local/lib -lpari -lgmp -L/usr/hom
e/dima/Sage/sage/local/lib -lpari -lgmp Lglobals.o Lgamma.o Lriemannsiegel.o Lriemannsiegel_blfi.o Ldokchitser.o Lcommandline_globals
.o Lcommandline_misc.o Lcommandline_numbertheory.o Lcommandline_values_zeros.o Lcommandline_elliptic.o Lcommandline_twist.o Lcommandl
ine.o cmdline.o -o lcalc 
```



---

archive/issue_comments_408269.json:
```json
{
    "body": "<a id='comment:7'></a>\nStrangely, patchbots (one of then Ubuntu 16.04) had no problem with #22840.",
    "created_at": "2017-04-24T07:46:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22860#issuecomment-408269",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:7'></a>
Strangely, patchbots (one of then Ubuntu 16.04) had no problem with #22840.



---

archive/issue_comments_408270.json:
```json
{
    "body": "<a id='comment:8'></a>\nOK, `-Wl,--add-needed` probably shield you from a lot of stuff. In any case it should work with this branch. You guys can start trashing it, it was a quicky so there may be a mistake or two lurking.",
    "created_at": "2017-04-24T08:19:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22860#issuecomment-408270",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:8'></a>
OK, `-Wl,--add-needed` probably shield you from a lot of stuff. In any case it should work with this branch. You guys can start trashing it, it was a quicky so there may be a mistake or two lurking.



---

archive/issue_comments_408271.json:
```json
{
    "body": "**Changing status** from needs_info to needs_review.",
    "created_at": "2017-04-24T08:19:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22860#issuecomment-408271",
    "user": "https://github.com/kiwifb"
}
```

**Changing status** from needs_info to needs_review.



---

archive/issue_comments_408272.json:
```json
{
    "body": "<a id='comment:9'></a>\n`--add-needed` is necessary for the extra `libm` we install on FreeBSD, and which is linked to the \"real\" `libm`.\n\nBy the way, \n\n```\n-+\t$(MAKE) libLfunction$(LIBEXT)\n-+\t$(MAKE) lcalc$(EXEEXT)\n++\t$(MAKE) libLfunction.so\n++\t$(MAKE) lcalc\n```\nlooks too optimistic for OSX, don't we get `.dynlib` rather than `.so`, and too optimistic for Cygwin, where we get `.exe` for executables.",
    "created_at": "2017-04-24T08:27:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22860#issuecomment-408272",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:9'></a>
`--add-needed` is necessary for the extra `libm` we install on FreeBSD, and which is linked to the "real" `libm`.

By the way, 

```
-+	$(MAKE) libLfunction$(LIBEXT)
-+	$(MAKE) lcalc$(EXEEXT)
++	$(MAKE) libLfunction.so
++	$(MAKE) lcalc
```
looks too optimistic for OSX, don't we get `.dynlib` rather than `.so`, and too optimistic for Cygwin, where we get `.exe` for executables.



---

archive/issue_comments_408273.json:
```json
{
    "body": "<a id='comment:10'></a>\nThanks, I missed these. I should have had a look at a diff of the patch. Correcting shortly.",
    "created_at": "2017-04-24T08:53:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22860#issuecomment-408273",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:10'></a>
Thanks, I missed these. I should have had a look at a diff of the patch. Correcting shortly.



---

archive/issue_comments_408274.json:
```json
{
    "body": "<a id='comment:11'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/958610e2f5bbe29e18b3621d679ab6ded30400bf\">958610e</a></td><td><code>Re-add proper extensions in makefile patch</code></td></tr></table>\n",
    "created_at": "2017-04-24T09:05:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22860#issuecomment-408274",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/958610e2f5bbe29e18b3621d679ab6ded30400bf">958610e</a></td><td><code>Re-add proper extensions in makefile patch</code></td></tr></table>




---

archive/issue_comments_408275.json:
```json
{
    "body": "**Changing commit** from \"[cf3deccd71c5150b8d618cd1cbd244d5dd62c82e](https://github.com/sagemath/sagetrac-mirror/commit/cf3deccd71c5150b8d618cd1cbd244d5dd62c82e)\" to \"[958610e2f5bbe29e18b3621d679ab6ded30400bf](https://github.com/sagemath/sagetrac-mirror/commit/958610e2f5bbe29e18b3621d679ab6ded30400bf)\".",
    "created_at": "2017-04-24T09:05:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22860#issuecomment-408275",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[cf3deccd71c5150b8d618cd1cbd244d5dd62c82e](https://github.com/sagemath/sagetrac-mirror/commit/cf3deccd71c5150b8d618cd1cbd244d5dd62c82e)" to "[958610e2f5bbe29e18b3621d679ab6ded30400bf](https://github.com/sagemath/sagetrac-mirror/commit/958610e2f5bbe29e18b3621d679ab6ded30400bf)".



---

archive/issue_comments_408276.json:
```json
{
    "body": "<a id='comment:12'></a>\nOK, so for the review I am expecting testing from Dima on freeBSD, someone on ubuntu 16.04.4 and Steve Trogdon on Gentoo with `--as-needed` in LDFLAGS.",
    "created_at": "2017-04-24T09:08:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22860#issuecomment-408276",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:12'></a>
OK, so for the review I am expecting testing from Dima on freeBSD, someone on ubuntu 16.04.4 and Steve Trogdon on Gentoo with `--as-needed` in LDFLAGS.



---

archive/issue_comments_408277.json:
```json
{
    "body": "<a id='comment:13'></a>\n\n```\n-+\trm -f *.o lcalc libLfunction$(LIBEXT) example_programs/example\n++\trm -f *.o lcalc$(EXEEXT) libLfunction$(LIBEXT) example_programs/example\n```\nshould be `example_programs/example$(EXEEXT)` at the 2nd line",
    "created_at": "2017-04-24T09:18:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22860#issuecomment-408277",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:13'></a>

```
-+	rm -f *.o lcalc libLfunction$(LIBEXT) example_programs/example
++	rm -f *.o lcalc$(EXEEXT) libLfunction$(LIBEXT) example_programs/example
```
should be `example_programs/example$(EXEEXT)` at the 2nd line



---

archive/issue_comments_408278.json:
```json
{
    "body": "<a id='comment:14'></a>\nReplying to [dimpase](#comment%3A13):\n> \n> ```\n> -+\trm -f *.o lcalc libLfunction$(LIBEXT) example_programs/example\n> ++\trm -f *.o lcalc$(EXEEXT) libLfunction$(LIBEXT) example_programs/example\n> ```\n> should be `example_programs/example$(EXEEXT)` at the 2nd line\n\n\nIf you look at the original Makefile.patch you will note that `$(EXEEXT)` has never been appended to `example` neither here or the earlier rule to build it. Neither did you in your patch revision. Nothing in spkg-install or spkg-build will ever call that target, it has only been amended for some measure of consistency but someone (probably working on cygwin) didn't see the point in adding that bit.",
    "created_at": "2017-04-24T09:26:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22860#issuecomment-408278",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:14'></a>
Replying to [dimpase](#comment%3A13):
> 
> ```
> -+	rm -f *.o lcalc libLfunction$(LIBEXT) example_programs/example
> ++	rm -f *.o lcalc$(EXEEXT) libLfunction$(LIBEXT) example_programs/example
> ```
> should be `example_programs/example$(EXEEXT)` at the 2nd line


If you look at the original Makefile.patch you will note that `$(EXEEXT)` has never been appended to `example` neither here or the earlier rule to build it. Neither did you in your patch revision. Nothing in spkg-install or spkg-build will ever call that target, it has only been amended for some measure of consistency but someone (probably working on cygwin) didn't see the point in adding that bit.



---

archive/issue_comments_408279.json:
```json
{
    "body": "<a id='comment:15'></a>\nReplying to [fbissey](#comment%3A14):\n> Replying to [dimpase](#comment%3A13):\n> > \n> > ```\n> > -+\trm -f *.o lcalc libLfunction$(LIBEXT) example_programs/example\n> > ++\trm -f *.o lcalc$(EXEEXT) libLfunction$(LIBEXT) example_programs/example\n> > ```\n> > should be `example_programs/example$(EXEEXT)` at the 2nd line\n\n> \n> If you look at the original Makefile.patch you will note that `$(EXEEXT)` has never been appended to `example` neither here or the earlier rule to build it. Neither did you in your patch revision. Nothing in spkg-install or spkg-build will ever call that target, it has only been amended for some measure of consistency but someone (probably working on cygwin) didn't see the point in adding that bit.\n\n\nI think on Windows you'd get `.exe` appended to an executable even if `-o ...` does not mention it. And then you need to remove the file with the `.exe` extension.",
    "created_at": "2017-04-24T09:35:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22860#issuecomment-408279",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:15'></a>
Replying to [fbissey](#comment%3A14):
> Replying to [dimpase](#comment%3A13):
> > 
> > ```
> > -+	rm -f *.o lcalc libLfunction$(LIBEXT) example_programs/example
> > ++	rm -f *.o lcalc$(EXEEXT) libLfunction$(LIBEXT) example_programs/example
> > ```
> > should be `example_programs/example$(EXEEXT)` at the 2nd line

> 
> If you look at the original Makefile.patch you will note that `$(EXEEXT)` has never been appended to `example` neither here or the earlier rule to build it. Neither did you in your patch revision. Nothing in spkg-install or spkg-build will ever call that target, it has only been amended for some measure of consistency but someone (probably working on cygwin) didn't see the point in adding that bit.


I think on Windows you'd get `.exe` appended to an executable even if `-o ...` does not mention it. And then you need to remove the file with the `.exe` extension.



---

archive/issue_comments_408280.json:
```json
{
    "body": "<a id='comment:16'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/70a427e9a92320cb83dbe769f776e34c27be0686\">70a427e</a></td><td><code>make example target consistent</code></td></tr></table>\n",
    "created_at": "2017-04-24T10:10:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22860#issuecomment-408280",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:16'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/70a427e9a92320cb83dbe769f776e34c27be0686">70a427e</a></td><td><code>make example target consistent</code></td></tr></table>




---

archive/issue_comments_408281.json:
```json
{
    "body": "**Changing commit** from \"[958610e2f5bbe29e18b3621d679ab6ded30400bf](https://github.com/sagemath/sagetrac-mirror/commit/958610e2f5bbe29e18b3621d679ab6ded30400bf)\" to \"[70a427e9a92320cb83dbe769f776e34c27be0686](https://github.com/sagemath/sagetrac-mirror/commit/70a427e9a92320cb83dbe769f776e34c27be0686)\".",
    "created_at": "2017-04-24T10:10:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22860#issuecomment-408281",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[958610e2f5bbe29e18b3621d679ab6ded30400bf](https://github.com/sagemath/sagetrac-mirror/commit/958610e2f5bbe29e18b3621d679ab6ded30400bf)" to "[70a427e9a92320cb83dbe769f776e34c27be0686](https://github.com/sagemath/sagetrac-mirror/commit/70a427e9a92320cb83dbe769f776e34c27be0686)".



---

archive/issue_comments_408282.json:
```json
{
    "body": "<a id='comment:17'></a>\nOK things are more consistent now.",
    "created_at": "2017-04-24T10:11:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22860#issuecomment-408282",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:17'></a>
OK things are more consistent now.



---

archive/issue_comments_408283.json:
```json
{
    "body": "<a id='comment:18'></a>\nReplying to [fbissey](#comment%3A12):\n> OK, so for the review I am expecting testing from Dima on freeBSD, someone on ubuntu 16.04.4 \n\nI confirm that pulling the ticket branch in Sage 8.0.beta3 sources (from a fresh git clone) yields a successful built on Ubuntu 16.04 (it failed otherwise).",
    "created_at": "2017-04-24T11:20:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22860#issuecomment-408283",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:18'></a>
Replying to [fbissey](#comment%3A12):
> OK, so for the review I am expecting testing from Dima on freeBSD, someone on ubuntu 16.04.4 

I confirm that pulling the ticket branch in Sage 8.0.beta3 sources (from a fresh git clone) yields a successful built on Ubuntu 16.04 (it failed otherwise).



---

archive/issue_comments_408284.json:
```json
{
    "body": "<a id='comment:19'></a>\nOK, this works on FreeBSD.",
    "created_at": "2017-04-24T13:08:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22860#issuecomment-408284",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:19'></a>
OK, this works on FreeBSD.



---

archive/issue_comments_408285.json:
```json
{
    "body": "<a id='comment:20'></a>\nWorked for me on linux. I'm going to try on Cygwin in a minute.",
    "created_at": "2017-04-24T13:30:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22860#issuecomment-408285",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:20'></a>
Worked for me on linux. I'm going to try on Cygwin in a minute.



---

archive/issue_comments_408286.json:
```json
{
    "body": "**Reviewer:** Travis Scrimshaw, Dima Pasechnik",
    "created_at": "2017-04-24T13:30:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22860#issuecomment-408286",
    "user": "https://github.com/tscrim"
}
```

**Reviewer:** Travis Scrimshaw, Dima Pasechnik



---

archive/issue_comments_408287.json:
```json
{
    "body": "<a id='comment:21'></a>\nBuilds here on Gentoo with `LDFLAGS=-Wl,-O1 -Wl,--as-needed` with a slightly different ordering of linked libs\n\n```\ng++ -O3   -ffast-math -fPIC   -I../include -L/64bitdev/storage/sage-git_develop/sage/local/lib -Wl,-rpath,/64bitdev/storage/sage-git_develop/sage/local/lib -Wl,-O1 -Wl,--as-needed Lglobals.o Lgamma.o Lriemannsiegel.o Lriemannsiegel_blfi.o Ldokchitser.o Lcommandline_globals.o Lcommandline_misc.o Lcommandline_numbertheory.o Lcommandline_values_zeros.o Lcommandline_elliptic.o Lcommandline_twist.o Lcommandline.o cmdline.o -o lcalc -L/64bitdev/storage/sage-git_develop/sage/local/lib -lpari -lgmp -lm\n```",
    "created_at": "2017-04-24T14:39:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22860#issuecomment-408287",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:21'></a>
Builds here on Gentoo with `LDFLAGS=-Wl,-O1 -Wl,--as-needed` with a slightly different ordering of linked libs

```
g++ -O3   -ffast-math -fPIC   -I../include -L/64bitdev/storage/sage-git_develop/sage/local/lib -Wl,-rpath,/64bitdev/storage/sage-git_develop/sage/local/lib -Wl,-O1 -Wl,--as-needed Lglobals.o Lgamma.o Lriemannsiegel.o Lriemannsiegel_blfi.o Ldokchitser.o Lcommandline_globals.o Lcommandline_misc.o Lcommandline_numbertheory.o Lcommandline_values_zeros.o Lcommandline_elliptic.o Lcommandline_twist.o Lcommandline.o cmdline.o -o lcalc -L/64bitdev/storage/sage-git_develop/sage/local/lib -lpari -lgmp -lm
```



---

archive/issue_comments_408288.json:
```json
{
    "body": "<a id='comment:22'></a>\nReplying to [strogdon](#comment%3A21):\n> Builds here on Gentoo with `LDFLAGS=-Wl,-O1 -Wl,--as-needed` with a slightly different ordering of linked libs\n> \n> ```\n> g++ -O3   -ffast-math -fPIC   -I../include -L/64bitdev/storage/sage-git_develop/sage/local/lib -Wl,-rpath,/64bitdev/storage/sage-git_develop/sage/local/lib -Wl,-O1 -Wl,--as-needed Lglobals.o Lgamma.o Lriemannsiegel.o Lriemannsiegel_blfi.o Ldokchitser.o Lcommandline_globals.o Lcommandline_misc.o Lcommandline_numbertheory.o Lcommandline_values_zeros.o Lcommandline_elliptic.o Lcommandline_twist.o Lcommandline.o cmdline.o -o lcalc -L/64bitdev/storage/sage-git_develop/sage/local/lib -lpari -lgmp -lm\n> ```\n\nI'm curious about the `-L/64bitdev/storage/sage-git_develop/sage/local/lib -lpari -lgmp -lm` that appears above. In particular the `-lm` that wasn't present when it failed. I have no `libm.so` under `64bitdev/storage/sage-git_develop/sage/local/lib`. I don't think it's needed. But why does it appear?",
    "created_at": "2017-04-24T16:30:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22860#issuecomment-408288",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:22'></a>
Replying to [strogdon](#comment%3A21):
> Builds here on Gentoo with `LDFLAGS=-Wl,-O1 -Wl,--as-needed` with a slightly different ordering of linked libs
> 
> ```
> g++ -O3   -ffast-math -fPIC   -I../include -L/64bitdev/storage/sage-git_develop/sage/local/lib -Wl,-rpath,/64bitdev/storage/sage-git_develop/sage/local/lib -Wl,-O1 -Wl,--as-needed Lglobals.o Lgamma.o Lriemannsiegel.o Lriemannsiegel_blfi.o Ldokchitser.o Lcommandline_globals.o Lcommandline_misc.o Lcommandline_numbertheory.o Lcommandline_values_zeros.o Lcommandline_elliptic.o Lcommandline_twist.o Lcommandline.o cmdline.o -o lcalc -L/64bitdev/storage/sage-git_develop/sage/local/lib -lpari -lgmp -lm
> ```

I'm curious about the `-L/64bitdev/storage/sage-git_develop/sage/local/lib -lpari -lgmp -lm` that appears above. In particular the `-lm` that wasn't present when it failed. I have no `libm.so` under `64bitdev/storage/sage-git_develop/sage/local/lib`. I don't think it's needed. But why does it appear?



---

archive/issue_comments_408289.json:
```json
{
    "body": "<a id='comment:23'></a>\nI see, the `-lm` is now in the Makefile. Is it needed?",
    "created_at": "2017-04-24T16:48:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22860#issuecomment-408289",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:23'></a>
I see, the `-lm` is now in the Makefile. Is it needed?



---

archive/issue_comments_408290.json:
```json
{
    "body": "<a id='comment:24'></a>\nThis built for me without problems on Cygwin.",
    "created_at": "2017-04-24T16:54:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22860#issuecomment-408290",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:24'></a>
This built for me without problems on Cygwin.



---

archive/issue_comments_408291.json:
```json
{
    "body": "<a id='comment:25'></a>\nReplying to [strogdon](#comment%3A23):\n> I see, the `-lm` is now in the Makefile. Is it needed?\n\n\nPossibly not, I am just not taking chances in case someone has a system with somewhat broken dynamic libraries. Both pari and gmp use libm.",
    "created_at": "2017-04-24T18:36:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22860#issuecomment-408291",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:25'></a>
Replying to [strogdon](#comment%3A23):
> I see, the `-lm` is now in the Makefile. Is it needed?


Possibly not, I am just not taking chances in case someone has a system with somewhat broken dynamic libraries. Both pari and gmp use libm.



---

archive/issue_comments_408292.json:
```json
{
    "body": "<a id='comment:26'></a>\nI think that's enough reviews :)",
    "created_at": "2017-04-24T22:06:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22860#issuecomment-408292",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:26'></a>
I think that's enough reviews :)



---

archive/issue_comments_408293.json:
```json
{
    "body": "**Changing reviewer** from \"Travis Scrimshaw, Dima Pasechnik\" to \"Travis Scrimshaw, Dima Pasechnik, Steve Trogdon\".",
    "created_at": "2017-04-24T22:06:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22860#issuecomment-408293",
    "user": "https://github.com/kiwifb"
}
```

**Changing reviewer** from "Travis Scrimshaw, Dima Pasechnik" to "Travis Scrimshaw, Dima Pasechnik, Steve Trogdon".



---

archive/issue_comments_408294.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2017-04-24T22:06:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22860#issuecomment-408294",
    "user": "https://github.com/kiwifb"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_408295.json:
```json
{
    "body": "**Changing status** from positive_review to needs_work.",
    "created_at": "2017-04-25T04:33:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22860#issuecomment-408295",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from positive_review to needs_work.



---

archive/issue_comments_408296.json:
```json
{
    "body": "<a id='comment:27'></a>\nDon't forget to bump the patchlevel (you can set this back to positive_review after you did that).",
    "created_at": "2017-04-25T04:33:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22860#issuecomment-408296",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:27'></a>
Don't forget to bump the patchlevel (you can set this back to positive_review after you did that).



---

archive/issue_comments_408297.json:
```json
{
    "body": "**Changing commit** from \"[70a427e9a92320cb83dbe769f776e34c27be0686](https://github.com/sagemath/sagetrac-mirror/commit/70a427e9a92320cb83dbe769f776e34c27be0686)\" to \"[5f52680da6b7a705bccc40dd83cffeac1789abcd](https://github.com/sagemath/sagetrac-mirror/commit/5f52680da6b7a705bccc40dd83cffeac1789abcd)\".",
    "created_at": "2017-04-25T05:35:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22860#issuecomment-408297",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[70a427e9a92320cb83dbe769f776e34c27be0686](https://github.com/sagemath/sagetrac-mirror/commit/70a427e9a92320cb83dbe769f776e34c27be0686)" to "[5f52680da6b7a705bccc40dd83cffeac1789abcd](https://github.com/sagemath/sagetrac-mirror/commit/5f52680da6b7a705bccc40dd83cffeac1789abcd)".



---

archive/issue_comments_408298.json:
```json
{
    "body": "<a id='comment:28'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5f52680da6b7a705bccc40dd83cffeac1789abcd\">5f52680</a></td><td><code>version bumping to make Jeroen happy</code></td></tr></table>\n",
    "created_at": "2017-04-25T05:35:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22860#issuecomment-408298",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:28'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5f52680da6b7a705bccc40dd83cffeac1789abcd">5f52680</a></td><td><code>version bumping to make Jeroen happy</code></td></tr></table>




---

archive/issue_comments_408299.json:
```json
{
    "body": "**Changing status** from needs_work to positive_review.",
    "created_at": "2017-04-25T05:35:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22860#issuecomment-408299",
    "user": "https://github.com/kiwifb"
}
```

**Changing status** from needs_work to positive_review.



---

archive/issue_comments_408300.json:
```json
{
    "body": "<a id='comment:30'></a>\nIs there still an upstream for lcalc where to forward our patches?",
    "created_at": "2017-04-25T11:44:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22860#issuecomment-408300",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:30'></a>
Is there still an upstream for lcalc where to forward our patches?



---

archive/issue_comments_408301.json:
```json
{
    "body": "**Changing branch** from \"[u/fbissey/lcalc_linking](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/lcalc_linking)\" to \"[5f52680da6b7a705bccc40dd83cffeac1789abcd](https://github.com/sagemath/sagetrac-mirror/commit/5f52680da6b7a705bccc40dd83cffeac1789abcd)\".",
    "created_at": "2017-04-27T20:11:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22860#issuecomment-408301",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/fbissey/lcalc_linking](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/lcalc_linking)" to "[5f52680da6b7a705bccc40dd83cffeac1789abcd](https://github.com/sagemath/sagetrac-mirror/commit/5f52680da6b7a705bccc40dd83cffeac1789abcd)".



---

archive/issue_events_067835.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-04-27T20:11:58Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/22860",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22860#event-67835"
}
```



---

archive/issue_comments_408302.json:
```json
{
    "body": "**Changing reviewer** from \"Travis Scrimshaw, Dima Pasechnik, Steve Trogdon\" to \"Travis Scrimshaw, Dima Pasechnik, Steven Trogdon\".",
    "created_at": "2017-10-24T15:06:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22860#issuecomment-408302",
    "user": "https://github.com/jdemeyer"
}
```

**Changing reviewer** from "Travis Scrimshaw, Dima Pasechnik, Steve Trogdon" to "Travis Scrimshaw, Dima Pasechnik, Steven Trogdon".



---

archive/issue_comments_408303.json:
```json
{
    "body": "**Changing commit** from \"[5f52680da6b7a705bccc40dd83cffeac1789abcd](https://github.com/sagemath/sagetrac-mirror/commit/5f52680da6b7a705bccc40dd83cffeac1789abcd)\" to \"\".",
    "created_at": "2017-10-24T15:06:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22860#issuecomment-408303",
    "user": "https://github.com/jdemeyer"
}
```

**Changing commit** from "[5f52680da6b7a705bccc40dd83cffeac1789abcd](https://github.com/sagemath/sagetrac-mirror/commit/5f52680da6b7a705bccc40dd83cffeac1789abcd)" to "".
