# Issue 22408: Make threejs / three.js the default 3d viewer instead of jmol

archive/issues_022171.json:
```json
{
    "body": "Now that #22389 *(Make Three.js work offline)* and #22261 *(Three.js: Default lighting)*\nhave been merged, it is time to make threejs the default 3d viewer, in replacement of jmol.\n\nA discussion about this started in #22389. In addition, one may note the following:\n\n**pros**: \n\n- three.js offers functionality absent in Jmol, notably axis labels\n- three.js works better with Jupyter than Jmol, see e.g. [this report](https://groups.google.com/d/msg/sage-support/KvNuD2DfRz0/VM1BPPDPCAAJ))\n- Jmol is a nightmare for packagers (for Debian, Windows, ...), see e.g. [this discussion on debian-science-sagemath](https://alioth-lists.debian.net/pipermail/debian-science-sagemath/2018-July/001228.html); in particular jsmol, which is invoked in Jupyter notebooks, is not packaged for Debian (see[comment:49](#comment%3A49))\n- Jmol, as currently shipped with Sage, is broken with recent version of Java runtime environment, e.g. on Debian Buster and Ubuntu 18.04, see this [ask.sagemath question](https://ask.sagemath.org/question/47837/jmol-stuck-at-initializing-3d-display/)\n\n**cons**:\n\n- some features are still missing in three.js, like \n  - converting the view to a png image in *non-interactive* mode (e.g. when generating the reference manual, cf.[comment:66](#comment%3A66)); NB: thanks to #27910 (merged in Sage 8.8.rc0), the png conversion is now possible in *interactive* mode; see [this discussion](https://trac.sagemath.org/ticket/27910#comment:6)\n  - ~~mesh plots~~ ==> fixed by #28343 (merged in Sage 8.9.beta8)\n  - ~~vector field plots~~ ==> fixed by #27932 (merged in Sage 8.9.beta0)\n- three.js has some issues:\n  - ~~faces of polytopes look rounded~~ ==> fixed by #27836 (merged in Sage 8.8.beta7)\n  - some opacity issues: cf.[comment:75](#comment%3A75) and below\n\nAssignee: @embray\n\nCC:  @paulmasson @novoselt tmonteil @kcrisman @slel @williamstein @embray @infinity0 @kiwifb @egourgoulhon @strogdon @timokau @jplab\n\nKeywords: 3D, plot3d, threejs, three.js, jmol\n\nReviewer: Dima Pasechnik\n\nAuthor: Paul Masson, Eric Gourgoulhon\n\nBranch: fcac479a1d7d364973ecd571b949aecc1e9e06e7\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/22408\n\n",
    "closed_at": "2019-10-03T17:58:33Z",
    "created_at": "2017-02-21T21:13:19Z",
    "labels": [
        "component: graphics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.0",
    "title": "Make threejs / three.js the default 3d viewer instead of jmol",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22408",
    "user": "https://github.com/egourgoulhon"
}
```
Now that #22389 *(Make Three.js work offline)* and #22261 *(Three.js: Default lighting)*
have been merged, it is time to make threejs the default 3d viewer, in replacement of jmol.

A discussion about this started in #22389. In addition, one may note the following:

**pros**: 

- three.js offers functionality absent in Jmol, notably axis labels
- three.js works better with Jupyter than Jmol, see e.g. [this report](https://groups.google.com/d/msg/sage-support/KvNuD2DfRz0/VM1BPPDPCAAJ))
- Jmol is a nightmare for packagers (for Debian, Windows, ...), see e.g. [this discussion on debian-science-sagemath](https://alioth-lists.debian.net/pipermail/debian-science-sagemath/2018-July/001228.html); in particular jsmol, which is invoked in Jupyter notebooks, is not packaged for Debian (see[comment:49](#comment%3A49))
- Jmol, as currently shipped with Sage, is broken with recent version of Java runtime environment, e.g. on Debian Buster and Ubuntu 18.04, see this [ask.sagemath question](https://ask.sagemath.org/question/47837/jmol-stuck-at-initializing-3d-display/)

**cons**:

- some features are still missing in three.js, like 
  - converting the view to a png image in *non-interactive* mode (e.g. when generating the reference manual, cf.[comment:66](#comment%3A66)); NB: thanks to #27910 (merged in Sage 8.8.rc0), the png conversion is now possible in *interactive* mode; see [this discussion](https://trac.sagemath.org/ticket/27910#comment:6)
  - ~~mesh plots~~ ==> fixed by #28343 (merged in Sage 8.9.beta8)
  - ~~vector field plots~~ ==> fixed by #27932 (merged in Sage 8.9.beta0)
- three.js has some issues:
  - ~~faces of polytopes look rounded~~ ==> fixed by #27836 (merged in Sage 8.8.beta7)
  - some opacity issues: cf.[comment:75](#comment%3A75) and below

Assignee: @embray

CC:  @paulmasson @novoselt tmonteil @kcrisman @slel @williamstein @embray @infinity0 @kiwifb @egourgoulhon @strogdon @timokau @jplab

Keywords: 3D, plot3d, threejs, three.js, jmol

Reviewer: Dima Pasechnik

Author: Paul Masson, Eric Gourgoulhon

Branch: fcac479a1d7d364973ecd571b949aecc1e9e06e7

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/22408





---

archive/issue_comments_410085.json:
```json
{
    "body": "Changing branch from \"\" to \"u/paulmasson/22408\"",
    "created_at": "2017-02-27T03:54:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410085",
    "user": "https://github.com/paulmasson"
}
```

Changing branch from "" to "u/paulmasson/22408"



---

archive/issue_comments_410086.json:
```json
{
    "body": "Changing commit from \"\" to \"93b0b0e293645b46f409c3514df70d337b16a88e\"",
    "created_at": "2017-02-27T03:57:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410086",
    "user": "https://github.com/paulmasson"
}
```

Changing commit from "" to "93b0b0e293645b46f409c3514df70d337b16a88e"



---

archive/issue_comments_410087.json:
```json
{
    "body": "<a id='comment:2'></a>\nFor future reference, this simple alteration is all that is needed to change the default, but no rush about it. After #22389 the viewer does not work locally in notebooks: must fix!\n\n---\nNew commits:\n|                                                                                                                                          |                |\n|------------------------------------------------------------------------------------------------------------------------------------------|----------------|\n|[93b0b0e](https://github.com/sagemath/sagetrac-mirror/commit/93b0b0e293645b46f409c3514df70d337b16a88e)|`Change default`|",
    "created_at": "2017-02-27T03:57:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410087",
    "user": "https://github.com/paulmasson"
}
```

<a id='comment:2'></a>
For future reference, this simple alteration is all that is needed to change the default, but no rush about it. After #22389 the viewer does not work locally in notebooks: must fix!

---
New commits:
|                                                                                                                                          |                |
|------------------------------------------------------------------------------------------------------------------------------------------|----------------|
|[93b0b0e](https://github.com/sagemath/sagetrac-mirror/commit/93b0b0e293645b46f409c3514df70d337b16a88e)|`Change default`|



---

archive/issue_comments_410088.json:
```json
{
    "body": "<a id='comment:3'></a>\nWhat do you mean it does not work locally anymore??? It did for me...\n\nAs for the default change, I move that this happens in 8.0 together with the change in default notebook (perhaps add this as a dependence?). Users will be so shocked, that they won't even notice ;-)",
    "created_at": "2017-02-27T15:12:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410088",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:3'></a>
What do you mean it does not work locally anymore??? It did for me...

As for the default change, I move that this happens in 8.0 together with the change in default notebook (perhaps add this as a dependence?). Users will be so shocked, that they won't even notice ;-)



---

archive/issue_comments_410089.json:
```json
{
    "body": "<a id='comment:4'></a>\nReplying to [novoselt](#comment%3A3):\n> \n> As for the default change, I move that this happens in 8.0 together with the change in default notebook (perhaps add this as a dependence?). \n\n\n+1",
    "created_at": "2017-02-27T19:19:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410089",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:4'></a>
Replying to [novoselt](#comment%3A3):
> 
> As for the default change, I move that this happens in 8.0 together with the change in default notebook (perhaps add this as a dependence?). 


+1



---

archive/issue_events_074495.json:
```json
{
    "actor": "https://github.com/egourgoulhon",
    "created_at": "2017-02-27T19:19:23Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "milestone": "sage-8.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22408#event-74495"
}
```



---

archive/issue_comments_410090.json:
```json
{
    "body": "<a id='comment:5'></a>\nReplying to [novoselt](#comment%3A3):\n> What do you mean it does not work locally anymore??? It did for me...\n\n\nIt does not for me in Sage 7.6.beta5, as reported in \nhttps://groups.google.com/d/msg/sage-release/jftcaPjaniM/KMiw3ZOXDAAJ\n\nPaul, is it the issue that you mentioned in[comment:2](#comment%3A2) ?",
    "created_at": "2017-03-01T20:21:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410090",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:5'></a>
Replying to [novoselt](#comment%3A3):
> What do you mean it does not work locally anymore??? It did for me...


It does not for me in Sage 7.6.beta5, as reported in 
https://groups.google.com/d/msg/sage-release/jftcaPjaniM/KMiw3ZOXDAAJ

Paul, is it the issue that you mentioned in[comment:2](#comment%3A2) ?



---

archive/issue_comments_410091.json:
```json
{
    "body": "<a id='comment:6'></a>\nReplying to [egourgoulhon](#comment%3A5):\n> Replying to [novoselt](#comment%3A3):\n> > What do you mean it does not work locally anymore??? It did for me...\n\n> \n> It does not for me in Sage 7.6.beta5, as reported in \n> https://groups.google.com/d/msg/sage-release/jftcaPjaniM/KMiw3ZOXDAAJ\n> \n> Paul, is it the issue that you mentioned in[comment:2](#comment%3A2) ?\nYup. I tested #22389 at the command line and neglected to test it in the notebooks. When a browser window is opened from the command line, it has access to the local file system to find the JavaScript files. The notebooks by contrast are sitting on a local web server that does not have the same access to the file system, so the JavaScript cannot be loaded.\n\nThe fix is to use the current display manager to determine if the rendered file will be viewed from a local web server or not and modify the script tags accordingly. Then I need to figure out how to add the local Three.js as notebook extensions as was done for JSmol.",
    "created_at": "2017-03-01T22:30:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410091",
    "user": "https://github.com/paulmasson"
}
```

<a id='comment:6'></a>
Replying to [egourgoulhon](#comment%3A5):
> Replying to [novoselt](#comment%3A3):
> > What do you mean it does not work locally anymore??? It did for me...

> 
> It does not for me in Sage 7.6.beta5, as reported in 
> https://groups.google.com/d/msg/sage-release/jftcaPjaniM/KMiw3ZOXDAAJ
> 
> Paul, is it the issue that you mentioned in[comment:2](#comment%3A2) ?
Yup. I tested #22389 at the command line and neglected to test it in the notebooks. When a browser window is opened from the command line, it has access to the local file system to find the JavaScript files. The notebooks by contrast are sitting on a local web server that does not have the same access to the file system, so the JavaScript cannot be loaded.

The fix is to use the current display manager to determine if the rendered file will be viewed from a local web server or not and modify the script tags accordingly. Then I need to figure out how to add the local Three.js as notebook extensions as was done for JSmol.



---

archive/issue_comments_410092.json:
```json
{
    "body": "<a id='comment:7'></a>\nReplying to [paulmasson](#comment%3A6):\n> Yup. I tested #22389 at the command line and neglected to test it in the notebooks. When a browser window is opened from the command line, it has access to the local file system to find the JavaScript files. The notebooks by contrast are sitting on a local web server that does not have the same access to the file system, so the JavaScript cannot be loaded.\n> \n> The fix is to use the current display manager to determine if the rendered file will be viewed from a local web server or not and modify the script tags accordingly. Then I need to figure out how to add the local Three.js as notebook extensions as was done for JSmol.\n\n\nThanks for these explanations.",
    "created_at": "2017-03-02T09:02:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410092",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:7'></a>
Replying to [paulmasson](#comment%3A6):
> Yup. I tested #22389 at the command line and neglected to test it in the notebooks. When a browser window is opened from the command line, it has access to the local file system to find the JavaScript files. The notebooks by contrast are sitting on a local web server that does not have the same access to the file system, so the JavaScript cannot be loaded.
> 
> The fix is to use the current display manager to determine if the rendered file will be viewed from a local web server or not and modify the script tags accordingly. Then I need to figure out how to add the local Three.js as notebook extensions as was done for JSmol.


Thanks for these explanations.



---

archive/issue_comments_410093.json:
```json
{
    "body": "<a id='comment:8'></a>\nAfter applying this patch I get many errors in the dochtml build:\n\n```\nTraceback (most recent call last):\n  File \"/usr/lib/python2.7/dist-packages/matplotlib/sphinxext/plot_directive.py\", line 520, in run_code\n    six.exec_(code, ns)\n  File \"/usr/lib/python2.7/dist-packages/six.py\", line 699, in exec_\n    exec(\"\"\"exec _code_ in _globs_, _locs_\"\"\")\n  File \"<string>\", line 1, in <module>\n  File \"<string>\", line 3, in <module>\n  File \"<string>\", line 8, in sphinx_plot\n  File \"sage/plot/plot3d/base.pyx\", line 1631, in sage.plot.plot3d.base.Graphics3d.save (/build/sagemath-7JFEEo/sagemath-7.5.1/sage/src/build/cythonized/sage/plot/plot3d/base.c:21954)\n    self.save_image(filename, **kwds)\n  File \"sage/plot/plot3d/base.pyx\", line 1560, in sage.plot.plot3d.base.Graphics3d.save_image (/build/sagemath-7JFEEo/sagemath-7.5.1/sage/src/build/cythonized/sage/plot/plot3d/base.c:21425)\n    self._save_image_png(filename, **kwds)\n  File \"sage/plot/plot3d/base.pyx\", line 1527, in sage.plot.plot3d.base.Graphics3d._save_image_png (/build/sagemath-7JFEEo/sagemath-7.5.1/sage/src/build/cythonized/sage/plot/plot3d/base.c:21074)\n    raise ValueError('cannot use viewer={0} to render image'.format(viewer))\nValueError: cannot use viewer=threejs to render image\n/build/sagemath-7JFEEo/sagemath-7.5.1/sage/src/doc/en/reference/manifolds/sage/manifolds/chart.rst:1987: WARNING: Exception occurred in plotting chart-11\n from /build/sagemath-7JFEEo/sagemath-7.5.1/sage/src/doc/en/reference/manifolds/sage/manifolds/chart.rst:\n```\n\nLooking at the source code, it does seem indeed that `Graphics3d._save_image_png` does not support threejs output. Either the docbuild needs to use jmol by default, or threejs could be made to save png output.\n\n(In Debian we explicitly fail the build if the dochtml.log contains \"Error\". We have to do this because the builder doesn't fail by itself. At this point I'm not sure if this is a Sage bug that also needs to be filed separately, because we patch the Sage dochtml build quite heavily to avoid segfaults and OOM, and I'm unsure if this interferes with any fail-on-error semantics that should be in there.)",
    "created_at": "2017-03-12T10:59:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410093",
    "user": "https://github.com/infinity0"
}
```

<a id='comment:8'></a>
After applying this patch I get many errors in the dochtml build:

```
Traceback (most recent call last):
  File "/usr/lib/python2.7/dist-packages/matplotlib/sphinxext/plot_directive.py", line 520, in run_code
    six.exec_(code, ns)
  File "/usr/lib/python2.7/dist-packages/six.py", line 699, in exec_
    exec("""exec _code_ in _globs_, _locs_""")
  File "<string>", line 1, in <module>
  File "<string>", line 3, in <module>
  File "<string>", line 8, in sphinx_plot
  File "sage/plot/plot3d/base.pyx", line 1631, in sage.plot.plot3d.base.Graphics3d.save (/build/sagemath-7JFEEo/sagemath-7.5.1/sage/src/build/cythonized/sage/plot/plot3d/base.c:21954)
    self.save_image(filename, **kwds)
  File "sage/plot/plot3d/base.pyx", line 1560, in sage.plot.plot3d.base.Graphics3d.save_image (/build/sagemath-7JFEEo/sagemath-7.5.1/sage/src/build/cythonized/sage/plot/plot3d/base.c:21425)
    self._save_image_png(filename, **kwds)
  File "sage/plot/plot3d/base.pyx", line 1527, in sage.plot.plot3d.base.Graphics3d._save_image_png (/build/sagemath-7JFEEo/sagemath-7.5.1/sage/src/build/cythonized/sage/plot/plot3d/base.c:21074)
    raise ValueError('cannot use viewer={0} to render image'.format(viewer))
ValueError: cannot use viewer=threejs to render image
/build/sagemath-7JFEEo/sagemath-7.5.1/sage/src/doc/en/reference/manifolds/sage/manifolds/chart.rst:1987: WARNING: Exception occurred in plotting chart-11
 from /build/sagemath-7JFEEo/sagemath-7.5.1/sage/src/doc/en/reference/manifolds/sage/manifolds/chart.rst:
```

Looking at the source code, it does seem indeed that `Graphics3d._save_image_png` does not support threejs output. Either the docbuild needs to use jmol by default, or threejs could be made to save png output.

(In Debian we explicitly fail the build if the dochtml.log contains "Error". We have to do this because the builder doesn't fail by itself. At this point I'm not sure if this is a Sage bug that also needs to be filed separately, because we patch the Sage dochtml build quite heavily to avoid segfaults and OOM, and I'm unsure if this interferes with any fail-on-error semantics that should be in there.)



---

archive/issue_comments_410094.json:
```json
{
    "body": "<a id='comment:9'></a>\nReplying to [infinity0](#comment%3A8):\n> \n> Looking at the source code, it does seem indeed that `Graphics3d._save_image_png` does not support threejs output. \n\n\nIndeed, this is listed in the 'cons' section of the ticket description.",
    "created_at": "2017-03-12T11:39:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410094",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:9'></a>
Replying to [infinity0](#comment%3A8):
> 
> Looking at the source code, it does seem indeed that `Graphics3d._save_image_png` does not support threejs output. 


Indeed, this is listed in the 'cons' section of the ticket description.



---

archive/issue_comments_410095.json:
```json
{
    "body": "<a id='comment:10'></a>\nPerhaps a corner case and perhaps not important but if I from a local machine (A) ssh (ssh -Y) to remote machine (B) where Sage is installed and then try to display graphics stuff (`show(sphere(), viewer='threejs'`) on the display for local machine (A); say from `sagenb`, then the `threejs` viewer fails. In the JS console I see\n\n```\nTHREE.WebGLRenderer 80\nTHREE.WebGLRenderer: Error creating WebGL context.\n```\nand nothing is displayed. Nothing is similarly displayed from the command line or `jupyter` notebook. The `jmol` viewer does work. Of course, one could always install Sage on the local machine (A) and get things to work.",
    "created_at": "2017-04-17T19:35:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410095",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:10'></a>
Perhaps a corner case and perhaps not important but if I from a local machine (A) ssh (ssh -Y) to remote machine (B) where Sage is installed and then try to display graphics stuff (`show(sphere(), viewer='threejs'`) on the display for local machine (A); say from `sagenb`, then the `threejs` viewer fails. In the JS console I see

```
THREE.WebGLRenderer 80
THREE.WebGLRenderer: Error creating WebGL context.
```
and nothing is displayed. Nothing is similarly displayed from the command line or `jupyter` notebook. The `jmol` viewer does work. Of course, one could always install Sage on the local machine (A) and get things to work.



---

archive/issue_comments_410096.json:
```json
{
    "body": "<a id='comment:11'></a>\nPaul, may I ask about any possible update on this, in particular regarding the cons listed in the ticket description? It would be so nice to have Three.js as the default viewer instead of Jmol!",
    "created_at": "2017-11-28T09:57:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410096",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:11'></a>
Paul, may I ask about any possible update on this, in particular regarding the cons listed in the ticket description? It would be so nice to have Three.js as the default viewer instead of Jmol!



---

archive/issue_comments_410097.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -9,7 +9,10 @@\n \n **cons**:\n \n-- some features are still missing in three.js, like mesh plots or converting the view to a png image for printing  \n+- some features are still missing in three.js, like \n+  - converting the view to a png image for printing  \n+  - mesh plots \n+  - vector field plots \n \n \n \n``````\n",
    "created_at": "2017-11-28T12:44:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410097",
    "user": "https://github.com/egourgoulhon"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -9,7 +9,10 @@
 
 **cons**:
 
-- some features are still missing in three.js, like mesh plots or converting the view to a png image for printing  
+- some features are still missing in three.js, like 
+  - converting the view to a png image for printing  
+  - mesh plots 
+  - vector field plots 
 
 
 
``````




---

archive/issue_comments_410098.json:
```json
{
    "body": "<a id='comment:13'></a>\nEric, my main interest in adding Three.js to SageMath was so that I could see it in action in SageMathCell, which for a time I used on my website. There was unfortunately a rather unpleasant [conversation](https://groups.google.com/forum/#!topic/sage-cell/djsckrCzg1w) earlier this year, the upshot of which was that I was only welcome to use SageMathCell if I did so precisely like everyone else. Not my style.\n\nMy response was to write a small [library](https://github.com/paulmasson/mathcell) to replicate SageMath interacts in pure JavaScript for embedding in web pages, which is what I now use exclusively on my website. The only other part of SageMath I really used was mpmath for its special functions, so I am developing a second [library](https://github.com/paulmasson/math) to provide special functions in pure JavaScript as I need them.\n\nSince I am no longer using SageMath, I have little inclination to work any further on the Three.js backend. That is not to say I never will again, but it is not a priority for me at this time. And if I choose to contribute further I would focus on features useful to the browser experience, not those oriented towards printing, so Three.js is unlikely to replace Jmol if there is no one else interested in developing those features.",
    "created_at": "2017-11-30T01:07:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410098",
    "user": "https://github.com/paulmasson"
}
```

<a id='comment:13'></a>
Eric, my main interest in adding Three.js to SageMath was so that I could see it in action in SageMathCell, which for a time I used on my website. There was unfortunately a rather unpleasant [conversation](https://groups.google.com/forum/#!topic/sage-cell/djsckrCzg1w) earlier this year, the upshot of which was that I was only welcome to use SageMathCell if I did so precisely like everyone else. Not my style.

My response was to write a small [library](https://github.com/paulmasson/mathcell) to replicate SageMath interacts in pure JavaScript for embedding in web pages, which is what I now use exclusively on my website. The only other part of SageMath I really used was mpmath for its special functions, so I am developing a second [library](https://github.com/paulmasson/math) to provide special functions in pure JavaScript as I need them.

Since I am no longer using SageMath, I have little inclination to work any further on the Three.js backend. That is not to say I never will again, but it is not a priority for me at this time. And if I choose to contribute further I would focus on features useful to the browser experience, not those oriented towards printing, so Three.js is unlikely to replace Jmol if there is no one else interested in developing those features.



---

archive/issue_comments_410099.json:
```json
{
    "body": "<a id='comment:14'></a>\nThanks for this reply, it is very informative about the current status.\n\n> Eric, my main interest in adding Three.js to SageMath was so that I could see it in action in SageMathCell, which for a time I used on my website. There was unfortunately a rather unpleasant [conversation](https://groups.google.com/forum/#!topic/sage-cell/djsckrCzg1w) earlier this year, the upshot of which was that I was only welcome to use SageMathCell if I did so precisely like everyone else. Not my style.\n\n\nFor context, the issue was that running a bunch of cells automatically uses nontrivial amounts of computer resources, which costs money.\n\n> My response was to write a small [library](https://github.com/paulmasson/mathcell) to replicate SageMath interacts in pure JavaScript for embedding in web pages, which is what I now use exclusively on my website. \n\n\nThat is a great idea - is it completely new code, or based on the Sagecell, or something else?  If you don't need the heavy lifting of everything in Sage, this probably does make sense for you, and hopefully others can use it as well.\n\n> The only other part of SageMath I really used was mpmath for its special functions, so I am developing a second [library](https://github.com/paulmasson/math) to provide special functions in pure JavaScript as I need them.\n\n\nIs there no other math library in JS?  Seems like a lot of work to do correctly.\n\n> so Three.js is unlikely to replace Jmol if there is no one else interested in developing those features.\n\n\nThanks for the update, that is very helpful to assess the feasibility of this.  Maybe it might end up as a summer student project sometime; if so, would you be willing to provide some feedback?",
    "created_at": "2017-11-30T01:53:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410099",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:14'></a>
Thanks for this reply, it is very informative about the current status.

> Eric, my main interest in adding Three.js to SageMath was so that I could see it in action in SageMathCell, which for a time I used on my website. There was unfortunately a rather unpleasant [conversation](https://groups.google.com/forum/#!topic/sage-cell/djsckrCzg1w) earlier this year, the upshot of which was that I was only welcome to use SageMathCell if I did so precisely like everyone else. Not my style.


For context, the issue was that running a bunch of cells automatically uses nontrivial amounts of computer resources, which costs money.

> My response was to write a small [library](https://github.com/paulmasson/mathcell) to replicate SageMath interacts in pure JavaScript for embedding in web pages, which is what I now use exclusively on my website. 


That is a great idea - is it completely new code, or based on the Sagecell, or something else?  If you don't need the heavy lifting of everything in Sage, this probably does make sense for you, and hopefully others can use it as well.

> The only other part of SageMath I really used was mpmath for its special functions, so I am developing a second [library](https://github.com/paulmasson/math) to provide special functions in pure JavaScript as I need them.


Is there no other math library in JS?  Seems like a lot of work to do correctly.

> so Three.js is unlikely to replace Jmol if there is no one else interested in developing those features.


Thanks for the update, that is very helpful to assess the feasibility of this.  Maybe it might end up as a summer student project sometime; if so, would you be willing to provide some feedback?



---

archive/issue_comments_410100.json:
```json
{
    "body": "<a id='comment:15'></a>\nReplying to [paulmasson](#comment%3A13):\n\nThanks your detailed answer. \n\n> \n> Since I am no longer using SageMath, I have little inclination to work any further on the Three.js backend. That is not to say I never will again, but it is not a priority for me at this time. \n\n\nI really hope you'll be back in the near future. IMHO, you did such a great job in introducing Three.js in Sage and it would a pity if we remain with such a low quality (or at least unfitted for mathematical graphics) tool as Jmol. \n\n\n>And if I choose to contribute further I would focus on features useful to the browser experience, not those oriented towards printing, so Three.js is unlikely to replace Jmol if there is no one else interested in developing those features.\n\n\nYes I understand this. Printing output is a minor feature as compared with interactive display in the browser, but it seems required in at least two cases:\n\n- to illustrate the documentation, like in http://doc.sagemath.org/html/en/reference/plot3d/sage/plot/plot3d/plot3d.html (although maybe we could investigate if sphinx could deal with Three.js/WebGL)\n- to produce static figures for publications.",
    "created_at": "2017-11-30T16:24:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410100",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:15'></a>
Replying to [paulmasson](#comment%3A13):

Thanks your detailed answer. 

> 
> Since I am no longer using SageMath, I have little inclination to work any further on the Three.js backend. That is not to say I never will again, but it is not a priority for me at this time. 


I really hope you'll be back in the near future. IMHO, you did such a great job in introducing Three.js in Sage and it would a pity if we remain with such a low quality (or at least unfitted for mathematical graphics) tool as Jmol. 


>And if I choose to contribute further I would focus on features useful to the browser experience, not those oriented towards printing, so Three.js is unlikely to replace Jmol if there is no one else interested in developing those features.


Yes I understand this. Printing output is a minor feature as compared with interactive display in the browser, but it seems required in at least two cases:

- to illustrate the documentation, like in http://doc.sagemath.org/html/en/reference/plot3d/sage/plot/plot3d/plot3d.html (although maybe we could investigate if sphinx could deal with Three.js/WebGL)
- to produce static figures for publications.



---

archive/issue_comments_410101.json:
```json
{
    "body": "<a id='comment:16'></a>\nReplying to [kcrisman](#comment%3A14):\n> > My response was to write a small [library](https://github.com/paulmasson/mathcell) to replicate SageMath interacts in pure JavaScript for embedding in web pages, which is what I now use exclusively on my website. \n\n> \n> That is a great idea - is it completely new code, or based on the Sagecell, or something else?  If you don't need the heavy lifting of everything in Sage, this probably does make sense for you, and hopefully others can use it as well.\n\n\nIt is completely my own new open-source code, including an improved version of the Three.js template I wrote for here. It does require some knowledge of JavaScript to use, so it is perhaps not as simple as embedding a SageMathCell. It is really intended to replace the defunct Mathemtatica CDF plugin. Anyone who can write a Mathematica `Manipulate` will understand how to use my code. And because it works entirely in the browser, there are no server-side delivery lags or hosting issues.\n\n> > The only other part of SageMath I really used was mpmath for its special functions, so I am developing a second [library](https://github.com/paulmasson/math) to provide special functions in pure JavaScript as I need them.\n\n> \n> Is there no other math library in JS?  Seems like a lot of work to do correctly.\n> \n\nThere is one library with complex-valued special functions called [Jmat](https://github.com/lvandeve/jmat), but it has an explicit caveat as to the accuracy of the code. It is also undocumented and not actively developed. The only other library I know that comes close is a [transpilation](https://github.com/scijs/gsl-sf) of the GNU scientific library, but that does not support complex numbers and transpiling produces bloated code. One would expect [Math.js](https://github.com/josdejong/mathjs) to include special functions, but it only has the gamma and error functions, which are the simplest to implement.",
    "created_at": "2017-12-01T22:24:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410101",
    "user": "https://github.com/paulmasson"
}
```

<a id='comment:16'></a>
Replying to [kcrisman](#comment%3A14):
> > My response was to write a small [library](https://github.com/paulmasson/mathcell) to replicate SageMath interacts in pure JavaScript for embedding in web pages, which is what I now use exclusively on my website. 

> 
> That is a great idea - is it completely new code, or based on the Sagecell, or something else?  If you don't need the heavy lifting of everything in Sage, this probably does make sense for you, and hopefully others can use it as well.


It is completely my own new open-source code, including an improved version of the Three.js template I wrote for here. It does require some knowledge of JavaScript to use, so it is perhaps not as simple as embedding a SageMathCell. It is really intended to replace the defunct Mathemtatica CDF plugin. Anyone who can write a Mathematica `Manipulate` will understand how to use my code. And because it works entirely in the browser, there are no server-side delivery lags or hosting issues.

> > The only other part of SageMath I really used was mpmath for its special functions, so I am developing a second [library](https://github.com/paulmasson/math) to provide special functions in pure JavaScript as I need them.

> 
> Is there no other math library in JS?  Seems like a lot of work to do correctly.
> 

There is one library with complex-valued special functions called [Jmat](https://github.com/lvandeve/jmat), but it has an explicit caveat as to the accuracy of the code. It is also undocumented and not actively developed. The only other library I know that comes close is a [transpilation](https://github.com/scijs/gsl-sf) of the GNU scientific library, but that does not support complex numbers and transpiling produces bloated code. One would expect [Math.js](https://github.com/josdejong/mathjs) to include special functions, but it only has the gamma and error functions, which are the simplest to implement.



---

archive/issue_comments_410102.json:
```json
{
    "body": "<a id='comment:17'></a>\nNote that `giac` (which is a standard package of Sage), was compiled into javascript with emscripten compiler, there might be interesting features to use from there.",
    "created_at": "2017-12-01T22:53:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410102",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:17'></a>
Note that `giac` (which is a standard package of Sage), was compiled into javascript with emscripten compiler, there might be interesting features to use from there.



---

archive/issue_comments_410103.json:
```json
{
    "body": "<a id='comment:18'></a>\nSee this ask.sagemath question posted today for some example of limitation of Jmol:\n\nhttps://ask.sagemath.org/question/39903/right-click-options-not-showing-up-for-jsmol/",
    "created_at": "2017-12-02T13:47:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410103",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:18'></a>
See this ask.sagemath question posted today for some example of limitation of Jmol:

https://ask.sagemath.org/question/39903/right-click-options-not-showing-up-for-jsmol/



---

archive/issue_comments_410104.json:
```json
{
    "body": "<a id='comment:19'></a>\nWe don't have emscripten in Debian because it uses a fork of LLVM, so until this situation is resolved we wouldn't be able to take advantage of a giac-emscripten viewer. Similarly JSMol isn't available in Debian because its JS tooling can't be packaged.\n\nNeither giac nor jmol have very good code anyways, so I'd recommend against using them independently of the above packaging issues.",
    "created_at": "2017-12-03T14:29:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410104",
    "user": "https://github.com/infinity0"
}
```

<a id='comment:19'></a>
We don't have emscripten in Debian because it uses a fork of LLVM, so until this situation is resolved we wouldn't be able to take advantage of a giac-emscripten viewer. Similarly JSMol isn't available in Debian because its JS tooling can't be packaged.

Neither giac nor jmol have very good code anyways, so I'd recommend against using them independently of the above packaging issues.



---

archive/issue_comments_410105.json:
```json
{
    "body": "<a id='comment:20'></a>\nI have made a binary package for jmol/jsmol in sage-on-gentoo. I am fed up with jmol and just want it to go, to be honest.",
    "created_at": "2017-12-03T21:45:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410105",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:20'></a>
I have made a binary package for jmol/jsmol in sage-on-gentoo. I am fed up with jmol and just want it to go, to be honest.



---

archive/issue_events_074496.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2018-06-05T19:39:49Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "milestone": "sage-8.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22408#event-74496"
}
```



---

archive/issue_events_074497.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2018-06-05T19:39:49Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "milestone": "sage-8.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22408#event-74497"
}
```



---

archive/issue_comments_410106.json:
```json
{
    "body": "<a id='comment:21'></a>\nThere is a corresponding CoCalc issue:\n\n- CoCalc issue 1963: make viewer='threejs' be the default for 3d plots in jupyter notebooks with sage\n\n  https://github.com/sagemathinc/cocalc/issues/1963",
    "created_at": "2018-06-05T19:39:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410106",
    "user": "https://github.com/slel"
}
```

<a id='comment:21'></a>
There is a corresponding CoCalc issue:

- CoCalc issue 1963: make viewer='threejs' be the default for 3d plots in jupyter notebooks with sage

  https://github.com/sagemathinc/cocalc/issues/1963



---

archive/issue_comments_410107.json:
```json
{
    "body": "Changing keywords from \"\" to \"3D, plot3d, threejs, three.js\".",
    "created_at": "2018-07-11T08:11:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410107",
    "user": "https://github.com/slel"
}
```

Changing keywords from "" to "3D, plot3d, threejs, three.js".



---

archive/issue_comments_410108.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,5 @@\n-After #22389 *(Make Three.js work offline)* and #22261 *(Three.js: Default lighting)* have been merged, it may be time to make three.js the default 3d viewer, in replacement of jmol.\n+After #22389 *(Make Three.js work offline)* and #22261 *(Three.js: Default lighting)*\n+have been merged, it is time to make three.js the default 3d viewer, in replacement of jmol.\n \n A discussion about this started in #22389. In addition, one may note the following:\n \n@@ -6,6 +7,7 @@\n \n - three.js has already capabilities beyond what jmol can offer, notably the axes labels, which are absent in jmol\n - some bugs (crashes) in jmol rendering within the Jupyter notebook are not present with three.js (see e.g. [this report](https://groups.google.com/d/msg/sage-support/KvNuD2DfRz0/VM1BPPDPCAAJ))\n+- Jmol is a nightmare for packagers (for Debian, Windows, ...)\n \n **cons**:\n \n@@ -15,4 +17,3 @@\n   - vector field plots \n \n \n-\n``````\n",
    "created_at": "2018-07-11T08:11:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410108",
    "user": "https://github.com/slel"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,5 @@
-After #22389 *(Make Three.js work offline)* and #22261 *(Three.js: Default lighting)* have been merged, it may be time to make three.js the default 3d viewer, in replacement of jmol.
+After #22389 *(Make Three.js work offline)* and #22261 *(Three.js: Default lighting)*
+have been merged, it is time to make three.js the default 3d viewer, in replacement of jmol.
 
 A discussion about this started in #22389. In addition, one may note the following:
 
@@ -6,6 +7,7 @@
 
 - three.js has already capabilities beyond what jmol can offer, notably the axes labels, which are absent in jmol
 - some bugs (crashes) in jmol rendering within the Jupyter notebook are not present with three.js (see e.g. [this report](https://groups.google.com/d/msg/sage-support/KvNuD2DfRz0/VM1BPPDPCAAJ))
+- Jmol is a nightmare for packagers (for Debian, Windows, ...)
 
 **cons**:
 
@@ -15,4 +17,3 @@
   - vector field plots 
 
 
-
``````




---

archive/issue_comments_410109.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,13 +1,13 @@\n-After #22389 *(Make Three.js work offline)* and #22261 *(Three.js: Default lighting)*\n-have been merged, it is time to make three.js the default 3d viewer, in replacement of jmol.\n+Now that #22389 *(Make Three.js work offline)* and #22261 *(Three.js: Default lighting)*\n+have been merged, it is time to make threejs the default 3d viewer, in replacement of jmol.\n \n A discussion about this started in #22389. In addition, one may note the following:\n \n **pros**: \n \n-- three.js has already capabilities beyond what jmol can offer, notably the axes labels, which are absent in jmol\n-- some bugs (crashes) in jmol rendering within the Jupyter notebook are not present with three.js (see e.g. [this report](https://groups.google.com/d/msg/sage-support/KvNuD2DfRz0/VM1BPPDPCAAJ))\n-- Jmol is a nightmare for packagers (for Debian, Windows, ...)\n+- three.js offers functionality absent in Jmol, notably axis labels\n+- three.js works better with Jupyter than Jmol, see e.g. [this report](https://groups.google.com/d/msg/sage-support/KvNuD2DfRz0/VM1BPPDPCAAJ))\n+- Jmol is a nightmare for packagers (for Debian, Windows, ...), see e.g. [this discussion on debian-science-sagemath](https://alioth-lists.debian.net/pipermail/debian-science-sagemath/2018-July/001228.html)\n \n **cons**:\n \n@@ -16,4 +16,3 @@\n   - mesh plots \n   - vector field plots \n \n-\n``````\n",
    "created_at": "2018-07-11T08:24:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410109",
    "user": "https://github.com/slel"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,13 +1,13 @@
-After #22389 *(Make Three.js work offline)* and #22261 *(Three.js: Default lighting)*
-have been merged, it is time to make three.js the default 3d viewer, in replacement of jmol.
+Now that #22389 *(Make Three.js work offline)* and #22261 *(Three.js: Default lighting)*
+have been merged, it is time to make threejs the default 3d viewer, in replacement of jmol.
 
 A discussion about this started in #22389. In addition, one may note the following:
 
 **pros**: 
 
-- three.js has already capabilities beyond what jmol can offer, notably the axes labels, which are absent in jmol
-- some bugs (crashes) in jmol rendering within the Jupyter notebook are not present with three.js (see e.g. [this report](https://groups.google.com/d/msg/sage-support/KvNuD2DfRz0/VM1BPPDPCAAJ))
-- Jmol is a nightmare for packagers (for Debian, Windows, ...)
+- three.js offers functionality absent in Jmol, notably axis labels
+- three.js works better with Jupyter than Jmol, see e.g. [this report](https://groups.google.com/d/msg/sage-support/KvNuD2DfRz0/VM1BPPDPCAAJ))
+- Jmol is a nightmare for packagers (for Debian, Windows, ...), see e.g. [this discussion on debian-science-sagemath](https://alioth-lists.debian.net/pipermail/debian-science-sagemath/2018-July/001228.html)
 
 **cons**:
 
@@ -16,4 +16,3 @@
   - mesh plots 
   - vector field plots 
 
-
``````




---

archive/issue_events_074498.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "rename": {
        "from": "Make three.js the default 3d viewer",
        "to": "Make threejs / three.js the default 3d viewer instead of jmol"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22408#event-74498"
}
```



---

archive/issue_comments_410110.json:
```json
{
    "body": "Changing keywords from \"3D, plot3d, threejs, three.js\" to \"3D, plot3d, threejs, three.js, jmol\".",
    "created_at": "2018-07-11T08:30:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410110",
    "user": "https://github.com/slel"
}
```

Changing keywords from "3D, plot3d, threejs, three.js" to "3D, plot3d, threejs, three.js, jmol".



---

archive/issue_events_074499.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2018-08-03T19:20:18Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "milestone": "sage-8.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22408#event-74499"
}
```



---

archive/issue_events_074500.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2018-08-03T19:20:18Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "milestone": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22408#event-74500"
}
```



---

archive/issue_comments_410111.json:
```json
{
    "body": "<a id='comment:26'></a>\nupdate milestone 8.3 -> 8.4",
    "created_at": "2018-08-03T19:20:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410111",
    "user": "https://github.com/videlec"
}
```

<a id='comment:26'></a>
update milestone 8.3 -> 8.4



---

archive/issue_comments_410112.json:
```json
{
    "body": "<a id='comment:27'></a>\nSince the OP of this ticket appears to have flamed out I'll take this over.  It appears there are a few other code updates necessary to use threejs in a few areas.",
    "created_at": "2018-08-28T13:44:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410112",
    "user": "https://github.com/embray"
}
```

<a id='comment:27'></a>
Since the OP of this ticket appears to have flamed out I'll take this over.  It appears there are a few other code updates necessary to use threejs in a few areas.



---

archive/issue_comments_410113.json:
```json
{
    "body": "Set assignee to @embray.",
    "created_at": "2018-08-28T13:44:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410113",
    "user": "https://github.com/embray"
}
```

Set assignee to @embray.



---

archive/issue_comments_410114.json:
```json
{
    "body": "<a id='comment:28'></a>\nFor 3D graphics in the static documentation I don't know why we don't just use something like matplotlib.  It outputs very nice 3D graphics these days.  I can write the necessary adapters...",
    "created_at": "2018-08-28T13:46:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410114",
    "user": "https://github.com/embray"
}
```

<a id='comment:28'></a>
For 3D graphics in the static documentation I don't know why we don't just use something like matplotlib.  It outputs very nice 3D graphics these days.  I can write the necessary adapters...



---

archive/issue_comments_410115.json:
```json
{
    "body": "<a id='comment:29'></a>\nReplying to [embray](#comment%3A27):\n> Since the OP of this ticket appears to have flamed out I'll take this over. \n\n\nThis is very good! Many thanks!",
    "created_at": "2018-08-28T15:05:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410115",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:29'></a>
Replying to [embray](#comment%3A27):
> Since the OP of this ticket appears to have flamed out I'll take this over. 


This is very good! Many thanks!



---

archive/issue_comments_410116.json:
```json
{
    "body": "<a id='comment:30'></a>\nReplying to [embray](#comment%3A28):\n> For 3D graphics in the static documentation I don't know why we don't just use something like matplotlib.  It outputs very nice 3D graphics these days. \n\n\nIndeed.\n\n> I can write the necessary adapters...\n\n\nThis would be nice! Moreover, why not using them not only for the documentation, but for any static display (as we already have with tachyon), by offering a new option: `viewer='matplotlib'` ?\n\nBesides, one may note that 3D plots in the documentation do not have to be static: an example of (interactive) three.js rendering is at http://doc.sagemath.org/html/en/reference/plot3d/threejs.html\nSo, as soon as threejs becomes the default, we could use those (except probably for pdf documentation).",
    "created_at": "2018-08-28T15:15:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410116",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:30'></a>
Replying to [embray](#comment%3A28):
> For 3D graphics in the static documentation I don't know why we don't just use something like matplotlib.  It outputs very nice 3D graphics these days. 


Indeed.

> I can write the necessary adapters...


This would be nice! Moreover, why not using them not only for the documentation, but for any static display (as we already have with tachyon), by offering a new option: `viewer='matplotlib'` ?

Besides, one may note that 3D plots in the documentation do not have to be static: an example of (interactive) three.js rendering is at http://doc.sagemath.org/html/en/reference/plot3d/threejs.html
So, as soon as threejs becomes the default, we could use those (except probably for pdf documentation).



---

archive/issue_comments_410117.json:
```json
{
    "body": "<a id='comment:31'></a>\nReplying to [egourgoulhon](#comment%3A29):\n> Replying to [embray](#comment%3A27):\n> > Since the OP of this ticket appears to have flamed out I'll take this over. \n\n> \n> This is very good! Many thanks!\n> \n\n\nI might be able to help a little (I'll keep an eye on this), since I wrote a similar threejs renderer for Sage worksheets, so I have some three.js experience.   Also, users of Jupyter notebooks in CoCalc frequently complain when they use Jmol, due to the slow load time or lack of Java support in their browser, so switching to threejs in Jupyter would make CoCalcers happier.",
    "created_at": "2018-08-28T15:22:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410117",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:31'></a>
Replying to [egourgoulhon](#comment%3A29):
> Replying to [embray](#comment%3A27):
> > Since the OP of this ticket appears to have flamed out I'll take this over. 

> 
> This is very good! Many thanks!
> 


I might be able to help a little (I'll keep an eye on this), since I wrote a similar threejs renderer for Sage worksheets, so I have some three.js experience.   Also, users of Jupyter notebooks in CoCalc frequently complain when they use Jmol, due to the slow load time or lack of Java support in their browser, so switching to threejs in Jupyter would make CoCalcers happier.



---

archive/issue_comments_410118.json:
```json
{
    "body": "<a id='comment:32'></a>\nReplying to [was](#comment%3A31):\n[...]\n>   Also, users of Jupyter notebooks in CoCalc frequently complain when they use Jmol, due to the slow load time or lack of Java support in their browser, so switching to threejs in Jupyter would make CoCalcers happier.\n\n\nAt least with Sage's Jupyter notebook they only need javascript support, because jSmol is used.",
    "created_at": "2018-08-29T06:42:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410118",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:32'></a>
Replying to [was](#comment%3A31):
[...]
>   Also, users of Jupyter notebooks in CoCalc frequently complain when they use Jmol, due to the slow load time or lack of Java support in their browser, so switching to threejs in Jupyter would make CoCalcers happier.


At least with Sage's Jupyter notebook they only need javascript support, because jSmol is used.



---

archive/issue_comments_410119.json:
```json
{
    "body": "<a id='comment:33'></a>\nImho, the switch to threejs still requires quite a lot of work to render objects properly, i tried with polytopes, see:\n\n```\nd = dodecahedron()\nd.show(viewer='threejs')\n```\n\nThe polytope looks rounded.",
    "created_at": "2018-08-29T06:48:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410119",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:33'></a>
Imho, the switch to threejs still requires quite a lot of work to render objects properly, i tried with polytopes, see:

```
d = dodecahedron()
d.show(viewer='threejs')
```

The polytope looks rounded.



---

archive/issue_comments_410120.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -15,4 +15,9 @@\n   - converting the view to a png image for printing  \n   - mesh plots \n   - vector field plots \n+  - faces of polytopes look rounded, see\n \n+```\n+d = dodecahedron()\n+d.show(viewer='threejs')\n+```\n``````\n",
    "created_at": "2018-08-29T08:31:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410120",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -15,4 +15,9 @@
   - converting the view to a png image for printing  
   - mesh plots 
   - vector field plots 
+  - faces of polytopes look rounded, see
 
+```
+d = dodecahedron()
+d.show(viewer='threejs')
+```
``````




---

archive/issue_comments_410121.json:
```json
{
    "body": "Attachment [2018-08-29.png](tarball://root/attachments/some-uuid/ticket22408/2018-08-29.png) by @embray created at 2018-08-29 11:16:12",
    "created_at": "2018-08-29T11:16:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410121",
    "user": "https://github.com/embray"
}
```

Attachment [2018-08-29.png](tarball://root/attachments/some-uuid/ticket22408/2018-08-29.png) by @embray created at 2018-08-29 11:16:12



---

archive/issue_comments_410122.json:
```json
{
    "body": "<a id='comment:35'></a>\nThat might be browser or system related or something.  It looks fine to me:\n![](2018-08-29.png)\nI tried it on Chrome, Firefox, and Edge--all fine.",
    "created_at": "2018-08-29T11:21:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410122",
    "user": "https://github.com/embray"
}
```

<a id='comment:35'></a>
That might be browser or system related or something.  It looks fine to me:
![](2018-08-29.png)
I tried it on Chrome, Firefox, and Edge--all fine.



---

archive/issue_comments_410123.json:
```json
{
    "body": "<a id='comment:36'></a>\n> some features are still missing in three.js\n\n\nFor what it is worth, I think the version in Sage worksheets in CoCalc has all of these things that are missing...  https://github.com/sagemathinc/cocalc/blob/master/src/smc-webapp/sagews/3d.coffee\n\nTo try it, open a cocalc Sage worksheet, then show 3d plots, but don't do (viewer='threejs'), since that will actually break it in Sage worksheets. E.g., just do\n\n```\ndodecahedron(mesh=2, color='green', opacity=.7)\n```\n\nWhen the mouse moves outside any plot it is replaced by a static png image.  This is absolutely CRITICAL since otherwise if there are more than about 10 plots on the page, things break in subtle ways (at least that was the case when I developed this).  If Jupyter Sage doesn't do this, then that's a problem.\n\nTo see that printing works, click any of the print buttons in the top right.  It even should work with print to pdf, which grabs those png's mentioned above, sends them to the backend project, and embeds them in the latex document...",
    "created_at": "2018-08-29T14:50:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410123",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:36'></a>
> some features are still missing in three.js


For what it is worth, I think the version in Sage worksheets in CoCalc has all of these things that are missing...  https://github.com/sagemathinc/cocalc/blob/master/src/smc-webapp/sagews/3d.coffee

To try it, open a cocalc Sage worksheet, then show 3d plots, but don't do (viewer='threejs'), since that will actually break it in Sage worksheets. E.g., just do

```
dodecahedron(mesh=2, color='green', opacity=.7)
```

When the mouse moves outside any plot it is replaced by a static png image.  This is absolutely CRITICAL since otherwise if there are more than about 10 plots on the page, things break in subtle ways (at least that was the case when I developed this).  If Jupyter Sage doesn't do this, then that's a problem.

To see that printing works, click any of the print buttons in the top right.  It even should work with print to pdf, which grabs those png's mentioned above, sends them to the backend project, and embeds them in the latex document...



---

archive/issue_comments_410124.json:
```json
{
    "body": "<a id='comment:37'></a>\nAlso possibly relevant: when we were writing this 3d rendering for cocalc, at some point Andrew Ohana (a student of mine at the time) put a fork of the code on github as a standalone project: https://github.com/ohanar/math3d.js",
    "created_at": "2018-08-29T14:52:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410124",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:37'></a>
Also possibly relevant: when we were writing this 3d rendering for cocalc, at some point Andrew Ohana (a student of mine at the time) put a fork of the code on github as a standalone project: https://github.com/ohanar/math3d.js



---

archive/issue_comments_410125.json:
```json
{
    "body": "<a id='comment:38'></a>\nAttachment [dodecahedron_threejs.png](tarball://root/attachments/some-uuid/ticket22408/dodecahedron_threejs.png) by @egourgoulhon created at 2018-08-29 15:43:00\n\nReplying to [embray](#comment%3A35):\n> That might be browser or system related or something.  It looks fine to me:\n> I tried it on Chrome, Firefox, and Edge--all fine.\n\n\nOn my side, I confirm the issue reported in[comment:33](#comment%3A33):\n![](dodecahedron_threejs.png)\nThis is with Sage 8.4.beta2 + Firefox running on Ubuntu 18.04.1.",
    "created_at": "2018-08-29T15:43:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410125",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:38'></a>
Attachment [dodecahedron_threejs.png](tarball://root/attachments/some-uuid/ticket22408/dodecahedron_threejs.png) by @egourgoulhon created at 2018-08-29 15:43:00

Replying to [embray](#comment%3A35):
> That might be browser or system related or something.  It looks fine to me:
> I tried it on Chrome, Firefox, and Edge--all fine.


On my side, I confirm the issue reported in[comment:33](#comment%3A33):
![](dodecahedron_threejs.png)
This is with Sage 8.4.beta2 + Firefox running on Ubuntu 18.04.1.



---

archive/issue_comments_410126.json:
```json
{
    "body": "<a id='comment:40'></a>\nThen maybe this is a bug with WebGL on Linux, or at least a difference in defaults w.r.t. shading and norms interpolation.   Do you know if your Firefox is using ANGLE? There's a setting under `about:config` for `webgl.disable-angle`.",
    "created_at": "2018-08-29T16:09:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410126",
    "user": "https://github.com/embray"
}
```

<a id='comment:40'></a>
Then maybe this is a bug with WebGL on Linux, or at least a difference in defaults w.r.t. shading and norms interpolation.   Do you know if your Firefox is using ANGLE? There's a setting under `about:config` for `webgl.disable-angle`.



---

archive/issue_comments_410127.json:
```json
{
    "body": "<a id='comment:41'></a>\nScratch that, I'm getting the same thing now too.  Previously I was running Sage 8.3.  So actually maybe something changed between Sage versions.\n\nUpdate: Okay, really weird.  I recently uninstalled and reinstalled Sage 8.3 on Windows (since I was testing a new version of the installer) and *now* my 8.3 has the same problem, whereas previously it did not.  How strange.\n\nI wish I still had my previous example open but it appears not.",
    "created_at": "2018-08-29T16:18:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410127",
    "user": "https://github.com/embray"
}
```

<a id='comment:41'></a>
Scratch that, I'm getting the same thing now too.  Previously I was running Sage 8.3.  So actually maybe something changed between Sage versions.

Update: Okay, really weird.  I recently uninstalled and reinstalled Sage 8.3 on Windows (since I was testing a new version of the installer) and *now* my 8.3 has the same problem, whereas previously it did not.  How strange.

I wish I still had my previous example open but it appears not.



---

archive/issue_comments_410128.json:
```json
{
    "body": "<a id='comment:42'></a>\nAdding `shading: THREE.FlatShading` to the polyhedron's material fixes it.  I am still mystified as to why this worked for me earlier and then didn't.",
    "created_at": "2018-08-29T17:11:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410128",
    "user": "https://github.com/embray"
}
```

<a id='comment:42'></a>
Adding `shading: THREE.FlatShading` to the polyhedron's material fixes it.  I am still mystified as to why this worked for me earlier and then didn't.



---

archive/issue_comments_410129.json:
```json
{
    "body": "<a id='comment:43'></a>\nReplying to [embray](#comment%3A42):\n> Adding `shading: THREE.FlatShading` to the polyhedron's material fixes it.  I am still mystified as to why this worked for me earlier and then didn't.\n\n\nGiven a moving target called \"modern web browser\", this is not surprising.",
    "created_at": "2018-09-16T09:03:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410129",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:43'></a>
Replying to [embray](#comment%3A42):
> Adding `shading: THREE.FlatShading` to the polyhedron's material fixes it.  I am still mystified as to why this worked for me earlier and then didn't.


Given a moving target called "modern web browser", this is not surprising.



---

archive/issue_comments_410130.json:
```json
{
    "body": "<a id='comment:44'></a>\nIt's entirely possible there was something messed up with my browser's GPU interface that for a moment it wasn't computing vertex normals, which would result in exactly this sort of flat shading??\n\nAnyways, it's an easy patch to make.  I've been meaning to get around to it soon.  Once that's fixed is there any other reason not to make threejs the default 3D viewer?",
    "created_at": "2018-09-17T11:32:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410130",
    "user": "https://github.com/embray"
}
```

<a id='comment:44'></a>
It's entirely possible there was something messed up with my browser's GPU interface that for a moment it wasn't computing vertex normals, which would result in exactly this sort of flat shading??

Anyways, it's an easy patch to make.  I've been meaning to get around to it soon.  Once that's fixed is there any other reason not to make threejs the default 3D viewer?



---

archive/issue_comments_410131.json:
```json
{
    "body": "<a id='comment:45'></a>\nReplying to [embray](#comment%3A44):\n> Anyways, it's an easy patch to make.  I've been meaning to get around to it soon. \n\n\nVery good!\n\n> Once that's fixed is there any other reason not to make threejs the default 3D viewer?\n\n\nSee the first three items in the \"cons\" list in the ticket description.",
    "created_at": "2018-09-17T13:58:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410131",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:45'></a>
Replying to [embray](#comment%3A44):
> Anyways, it's an easy patch to make.  I've been meaning to get around to it soon. 


Very good!

> Once that's fixed is there any other reason not to make threejs the default 3D viewer?


See the first three items in the "cons" list in the ticket description.



---

archive/issue_comments_410132.json:
```json
{
    "body": "<a id='comment:46'></a>\nReplying to [egourgoulhon](#comment%3A45):\n> \n> See the first three items in the \"cons\" list in the ticket description.\n\n\nThe first of them means that \n\n```\nsage: g = sphere()\nsage: g.save(\"sphere.png\")\n```\nproduces a png file depicting the Jmol initial view, while we have at the moment\n\n```\nsage: g = sphere(viewer='threejs')\nsage: g  # OK: opens a threejs window in the browser\nLaunched html viewer for Graphics3d Object\nsage: g.save(\"sphere.png\")\n...\nValueError: cannot use viewer=threejs to render image\n```",
    "created_at": "2018-09-17T14:12:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410132",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:46'></a>
Replying to [egourgoulhon](#comment%3A45):
> 
> See the first three items in the "cons" list in the ticket description.


The first of them means that 

```
sage: g = sphere()
sage: g.save("sphere.png")
```
produces a png file depicting the Jmol initial view, while we have at the moment

```
sage: g = sphere(viewer='threejs')
sage: g  # OK: opens a threejs window in the browser
Launched html viewer for Graphics3d Object
sage: g.save("sphere.png")
...
ValueError: cannot use viewer=threejs to render image
```



---

archive/issue_events_074501.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-10-28T11:40:56Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "milestone": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22408#event-74501"
}
```



---

archive/issue_events_074502.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-10-28T11:40:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "milestone": "sage-8.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22408#event-74502"
}
```



---

archive/issue_comments_410133.json:
```json
{
    "body": "<a id='comment:48'></a>\nRetargeting some of my tickets.",
    "created_at": "2018-12-28T14:09:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410133",
    "user": "https://github.com/embray"
}
```

<a id='comment:48'></a>
Retargeting some of my tickets.



---

archive/issue_events_074503.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-12-28T14:09:23Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "milestone": "sage-8.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22408#event-74503"
}
```



---

archive/issue_events_074504.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-12-28T14:09:23Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "milestone": "sage-8.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22408#event-74504"
}
```



---

archive/issue_comments_410134.json:
```json
{
    "body": "<a id='comment:49'></a>\nIn Debian we don't have jsmol so attempting 3D plotting in the notebooks just gives a message saying that one should use viewer='threejs'. Setting the default 3D viewer to threejs leads to a failing docbuild because of the missing png capability of threejs. Is there some workaround we could apply to fix 3D plotting in the notebooks in Debian? For example to use jmol on the command line and threejs in the notebooks by default?",
    "created_at": "2019-01-26T17:06:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410134",
    "user": "https://github.com/tobihan"
}
```

<a id='comment:49'></a>
In Debian we don't have jsmol so attempting 3D plotting in the notebooks just gives a message saying that one should use viewer='threejs'. Setting the default 3D viewer to threejs leads to a failing docbuild because of the missing png capability of threejs. Is there some workaround we could apply to fix 3D plotting in the notebooks in Debian? For example to use jmol on the command line and threejs in the notebooks by default?



---

archive/issue_comments_410135.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -7,14 +7,14 @@\n \n - three.js offers functionality absent in Jmol, notably axis labels\n - three.js works better with Jupyter than Jmol, see e.g. [this report](https://groups.google.com/d/msg/sage-support/KvNuD2DfRz0/VM1BPPDPCAAJ))\n-- Jmol is a nightmare for packagers (for Debian, Windows, ...), see e.g. [this discussion on debian-science-sagemath](https://alioth-lists.debian.net/pipermail/debian-science-sagemath/2018-July/001228.html)\n+- Jmol is a nightmare for packagers (for Debian, Windows, ...), see e.g. [this discussion on debian-science-sagemath](https://alioth-lists.debian.net/pipermail/debian-science-sagemath/2018-July/001228.html); in particular jsmol, which is invoked in Jupyter notebooks, is not packaged for Debian (see[comment:49](#comment%3A49))\n \n **cons**:\n \n - some features are still missing in three.js, like \n   - converting the view to a png image for printing  \n   - mesh plots \n-  - vector field plots \n+  - vector field plots (via the functions `plot_vector_field` and `plot_vector_field3d` only; three.js works fine with the [plot() method of vector fields on manifolds](http://doc.sagemath.org/html/en/reference/manifolds/sage/manifolds/differentiable/vectorfield.html#sage.manifolds.differentiable.vectorfield.VectorField.plot), the latter being based on individual arrow plots)\n   - faces of polytopes look rounded, see\n \n ```\n``````\n",
    "created_at": "2019-02-01T09:48:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410135",
    "user": "https://github.com/egourgoulhon"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -7,14 +7,14 @@
 
 - three.js offers functionality absent in Jmol, notably axis labels
 - three.js works better with Jupyter than Jmol, see e.g. [this report](https://groups.google.com/d/msg/sage-support/KvNuD2DfRz0/VM1BPPDPCAAJ))
-- Jmol is a nightmare for packagers (for Debian, Windows, ...), see e.g. [this discussion on debian-science-sagemath](https://alioth-lists.debian.net/pipermail/debian-science-sagemath/2018-July/001228.html)
+- Jmol is a nightmare for packagers (for Debian, Windows, ...), see e.g. [this discussion on debian-science-sagemath](https://alioth-lists.debian.net/pipermail/debian-science-sagemath/2018-July/001228.html); in particular jsmol, which is invoked in Jupyter notebooks, is not packaged for Debian (see[comment:49](#comment%3A49))
 
 **cons**:
 
 - some features are still missing in three.js, like 
   - converting the view to a png image for printing  
   - mesh plots 
-  - vector field plots 
+  - vector field plots (via the functions `plot_vector_field` and `plot_vector_field3d` only; three.js works fine with the [plot() method of vector fields on manifolds](http://doc.sagemath.org/html/en/reference/manifolds/sage/manifolds/differentiable/vectorfield.html#sage.manifolds.differentiable.vectorfield.VectorField.plot), the latter being based on individual arrow plots)
   - faces of polytopes look rounded, see
 
 ```
``````




---

archive/issue_comments_410136.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -14,7 +14,7 @@\n - some features are still missing in three.js, like \n   - converting the view to a png image for printing  \n   - mesh plots \n-  - vector field plots (via the functions `plot_vector_field` and `plot_vector_field3d` only; three.js works fine with the [plot() method of vector fields on manifolds](http://doc.sagemath.org/html/en/reference/manifolds/sage/manifolds/differentiable/vectorfield.html#sage.manifolds.differentiable.vectorfield.VectorField.plot), the latter being based on individual arrow plots)\n+  - vector field plots (via the function `plot_vector_field3d` only; three.js works fine with the [plot() method of vector fields on manifolds](http://doc.sagemath.org/html/en/reference/manifolds/sage/manifolds/differentiable/vectorfield.html#sage.manifolds.differentiable.vectorfield.VectorField.plot), the latter being based on individual arrow plots)\n   - faces of polytopes look rounded, see\n \n ```\n``````\n",
    "created_at": "2019-02-02T14:22:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410136",
    "user": "https://github.com/egourgoulhon"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -14,7 +14,7 @@
 - some features are still missing in three.js, like 
   - converting the view to a png image for printing  
   - mesh plots 
-  - vector field plots (via the functions `plot_vector_field` and `plot_vector_field3d` only; three.js works fine with the [plot() method of vector fields on manifolds](http://doc.sagemath.org/html/en/reference/manifolds/sage/manifolds/differentiable/vectorfield.html#sage.manifolds.differentiable.vectorfield.VectorField.plot), the latter being based on individual arrow plots)
+  - vector field plots (via the function `plot_vector_field3d` only; three.js works fine with the [plot() method of vector fields on manifolds](http://doc.sagemath.org/html/en/reference/manifolds/sage/manifolds/differentiable/vectorfield.html#sage.manifolds.differentiable.vectorfield.VectorField.plot), the latter being based on individual arrow plots)
   - faces of polytopes look rounded, see
 
 ```
``````




---

archive/issue_comments_410137.json:
```json
{
    "body": "<a id='comment:52'></a>\nThis is to point out that, in the current implementation, it is necessary to add the option `online=True` to `viewer='threejs'` to have three.js rendering in Jupyter notebooks on CoCalc, mybinder.org and nbviewer.jupyter.org. See the related [discussion on sage-devel](https://groups.google.com/forum/#!topic/sage-devel/QC5-9rexyJo).",
    "created_at": "2019-02-15T08:29:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410137",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:52'></a>
This is to point out that, in the current implementation, it is necessary to add the option `online=True` to `viewer='threejs'` to have three.js rendering in Jupyter notebooks on CoCalc, mybinder.org and nbviewer.jupyter.org. See the related [discussion on sage-devel](https://groups.google.com/forum/#!topic/sage-devel/QC5-9rexyJo).



---

archive/issue_comments_410138.json:
```json
{
    "body": "<a id='comment:53'></a>\nI know that with the Jupyter kernel it is possible for the kernel to serve files at a specific URL, though I don't know exactly how the mechanism works.  We do this, for example, to serve the Sage HTML docs via the Jupyter kernel.  We should do the same for any JavaScript files required for threejs, or any other widgets.  That, I think, would solve the \"online=True\" debate.  (In other words, properly implemented, it would mean we can use online=False, but the relative paths for the scripts would still be correct, even when run from binder, etc.)",
    "created_at": "2019-02-21T10:59:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410138",
    "user": "https://github.com/embray"
}
```

<a id='comment:53'></a>
I know that with the Jupyter kernel it is possible for the kernel to serve files at a specific URL, though I don't know exactly how the mechanism works.  We do this, for example, to serve the Sage HTML docs via the Jupyter kernel.  We should do the same for any JavaScript files required for threejs, or any other widgets.  That, I think, would solve the "online=True" debate.  (In other words, properly implemented, it would mean we can use online=False, but the relative paths for the scripts would still be correct, even when run from binder, etc.)



---

archive/issue_comments_410139.json:
```json
{
    "body": "<a id='comment:54'></a>\nRemoving most of the rest of my open tickets out of the 8.7 milestone, which should be closed.",
    "created_at": "2019-03-25T10:44:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410139",
    "user": "https://github.com/embray"
}
```

<a id='comment:54'></a>
Removing most of the rest of my open tickets out of the 8.7 milestone, which should be closed.



---

archive/issue_events_074505.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-03-25T10:44:36Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "milestone": "sage-8.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22408#event-74505"
}
```



---

archive/issue_events_074506.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-03-25T10:44:36Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "milestone": "sage-pending",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22408#event-74506"
}
```



---

archive/issue_comments_410140.json:
```json
{
    "body": "<a id='comment:55'></a>\nPlease see #27592 for a bit of preliminary cleanup of the threejs rendering I would like to do.\n\nI am still trying to find a solution for the issue mentioned in this ticket of rendering polyhedrons.  As I mentioned in[comment:42](#comment%3A42) the solution from the ThreeJS perspective is easy.  But it's not clear to me how to pass something like a 'shading' option around Sage's plot3d framework in a generic manner that makes sense, or how this problem is handled by the other 3D renderers.  If anyone with more experience with this codebase has any ideas I'd appreciate to hear them.\n\n(I know there is a `Texture` object, but I'm not really sure how it's used.  It doesn't have threejs support yet either, apparently, though I could probably add that.)",
    "created_at": "2019-04-02T11:53:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410140",
    "user": "https://github.com/embray"
}
```

<a id='comment:55'></a>
Please see #27592 for a bit of preliminary cleanup of the threejs rendering I would like to do.

I am still trying to find a solution for the issue mentioned in this ticket of rendering polyhedrons.  As I mentioned in[comment:42](#comment%3A42) the solution from the ThreeJS perspective is easy.  But it's not clear to me how to pass something like a 'shading' option around Sage's plot3d framework in a generic manner that makes sense, or how this problem is handled by the other 3D renderers.  If anyone with more experience with this codebase has any ideas I'd appreciate to hear them.

(I know there is a `Texture` object, but I'm not really sure how it's used.  It doesn't have threejs support yet either, apparently, though I could probably add that.)



---

archive/issue_comments_410141.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -12,12 +12,12 @@\n **cons**:\n \n - some features are still missing in three.js, like \n-  - converting the view to a png image for printing  \n+  - converting the view to a png image for printing (Update: this is now #27910)\n   - mesh plots \n   - vector field plots (via the function `plot_vector_field3d` only; three.js works fine with the [plot() method of vector fields on manifolds](http://doc.sagemath.org/html/en/reference/manifolds/sage/manifolds/differentiable/vectorfield.html#sage.manifolds.differentiable.vectorfield.VectorField.plot), the latter being based on individual arrow plots)\n-  - faces of polytopes look rounded, see\n+  - ~~faces of polytopes look rounded, see~~\n \n ```\n-d = dodecahedron()\n-d.show(viewer='threejs')\n+dodecahedron(viewer='threejs')\n ```\n+    ==> fixed by #27836 (merged in Sage 8.8.beta7)\n``````\n",
    "created_at": "2019-06-01T16:39:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410141",
    "user": "https://github.com/egourgoulhon"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -12,12 +12,12 @@
 **cons**:
 
 - some features are still missing in three.js, like 
-  - converting the view to a png image for printing  
+  - converting the view to a png image for printing (Update: this is now #27910)
   - mesh plots 
   - vector field plots (via the function `plot_vector_field3d` only; three.js works fine with the [plot() method of vector fields on manifolds](http://doc.sagemath.org/html/en/reference/manifolds/sage/manifolds/differentiable/vectorfield.html#sage.manifolds.differentiable.vectorfield.VectorField.plot), the latter being based on individual arrow plots)
-  - faces of polytopes look rounded, see
+  - ~~faces of polytopes look rounded, see~~
 
 ```
-d = dodecahedron()
-d.show(viewer='threejs')
+dodecahedron(viewer='threejs')
 ```
+    ==> fixed by #27836 (merged in Sage 8.8.beta7)
``````




---

archive/issue_comments_410142.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -12,9 +12,9 @@\n **cons**:\n \n - some features are still missing in three.js, like \n-  - converting the view to a png image for printing (Update: this is now #27910)\n+  - converting the view to a png image for printing; NB: thanks to #27910 (merged in Sage 8.8.rc0), the png conversion is now possible in interactive mode; see [this discussion](https://trac.sagemath.org/ticket/27910#comment:6)\n   - mesh plots \n-  - vector field plots (via the function `plot_vector_field3d` only; three.js works fine with the [plot() method of vector fields on manifolds](http://doc.sagemath.org/html/en/reference/manifolds/sage/manifolds/differentiable/vectorfield.html#sage.manifolds.differentiable.vectorfield.VectorField.plot), the latter being based on individual arrow plots)\n+  - vector field plots (via the function `plot_vector_field3d` only; three.js works fine with the [plot() method of vector fields on manifolds](http://doc.sagemath.org/html/en/reference/manifolds/sage/manifolds/differentiable/vectorfield.html#sage.manifolds.differentiable.vectorfield.VectorField.plot), the latter being based on individual arrow plots) (Update: this is now #27932)\n   - ~~faces of polytopes look rounded, see~~\n \n ```\n``````\n",
    "created_at": "2019-06-14T15:14:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410142",
    "user": "https://github.com/egourgoulhon"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -12,9 +12,9 @@
 **cons**:
 
 - some features are still missing in three.js, like 
-  - converting the view to a png image for printing (Update: this is now #27910)
+  - converting the view to a png image for printing; NB: thanks to #27910 (merged in Sage 8.8.rc0), the png conversion is now possible in interactive mode; see [this discussion](https://trac.sagemath.org/ticket/27910#comment:6)
   - mesh plots 
-  - vector field plots (via the function `plot_vector_field3d` only; three.js works fine with the [plot() method of vector fields on manifolds](http://doc.sagemath.org/html/en/reference/manifolds/sage/manifolds/differentiable/vectorfield.html#sage.manifolds.differentiable.vectorfield.VectorField.plot), the latter being based on individual arrow plots)
+  - vector field plots (via the function `plot_vector_field3d` only; three.js works fine with the [plot() method of vector fields on manifolds](http://doc.sagemath.org/html/en/reference/manifolds/sage/manifolds/differentiable/vectorfield.html#sage.manifolds.differentiable.vectorfield.VectorField.plot), the latter being based on individual arrow plots) (Update: this is now #27932)
   - ~~faces of polytopes look rounded, see~~
 
 ```
``````




---

archive/issue_comments_410143.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -14,10 +14,5 @@\n - some features are still missing in three.js, like \n   - converting the view to a png image for printing; NB: thanks to #27910 (merged in Sage 8.8.rc0), the png conversion is now possible in interactive mode; see [this discussion](https://trac.sagemath.org/ticket/27910#comment:6)\n   - mesh plots \n-  - vector field plots (via the function `plot_vector_field3d` only; three.js works fine with the [plot() method of vector fields on manifolds](http://doc.sagemath.org/html/en/reference/manifolds/sage/manifolds/differentiable/vectorfield.html#sage.manifolds.differentiable.vectorfield.VectorField.plot), the latter being based on individual arrow plots) (Update: this is now #27932)\n-  - ~~faces of polytopes look rounded, see~~\n-\n-```\n-dodecahedron(viewer='threejs')\n-```\n-    ==> fixed by #27836 (merged in Sage 8.8.beta7)\n+  - ~~vector field plots~~ ==> fixed by #27932 (merged in Sage 8.9.beta0)\n+  - ~~faces of polytopes look rounded~~ ==> fixed by #27836 (merged in Sage 8.8.beta7)\n``````\n",
    "created_at": "2019-08-05T15:26:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410143",
    "user": "https://github.com/egourgoulhon"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -14,10 +14,5 @@
 - some features are still missing in three.js, like 
   - converting the view to a png image for printing; NB: thanks to #27910 (merged in Sage 8.8.rc0), the png conversion is now possible in interactive mode; see [this discussion](https://trac.sagemath.org/ticket/27910#comment:6)
   - mesh plots 
-  - vector field plots (via the function `plot_vector_field3d` only; three.js works fine with the [plot() method of vector fields on manifolds](http://doc.sagemath.org/html/en/reference/manifolds/sage/manifolds/differentiable/vectorfield.html#sage.manifolds.differentiable.vectorfield.VectorField.plot), the latter being based on individual arrow plots) (Update: this is now #27932)
-  - ~~faces of polytopes look rounded, see~~
-
-```
-dodecahedron(viewer='threejs')
-```
-    ==> fixed by #27836 (merged in Sage 8.8.beta7)
+  - ~~vector field plots~~ ==> fixed by #27932 (merged in Sage 8.9.beta0)
+  - ~~faces of polytopes look rounded~~ ==> fixed by #27836 (merged in Sage 8.8.beta7)
``````




---

archive/issue_comments_410144.json:
```json
{
    "body": "<a id='comment:59'></a>\nReplying to [embray](#comment%3A55):\n> Please see #27592 for a bit of preliminary cleanup of the threejs rendering I would like to do.\n> \n> I am still trying to find a solution for the issue mentioned in this ticket of rendering polyhedrons.  As I mentioned in[comment:42](#comment%3A42) the solution from the ThreeJS perspective is easy.  But it's not clear to me how to pass something like a 'shading' option around Sage's plot3d framework in a generic manner that makes sense, or how this problem is handled by the other 3D renderers.  If anyone with more experience with this codebase has any ideas I'd appreciate to hear them.\n> \n> (I know there is a `Texture` object, but I'm not really sure how it's used.  It doesn't have threejs support yet either, apparently, though I could probably add that.)\n\n\nOh, I hadn't seen that ticket before, but this was fixed already by #27836.  Nice!",
    "created_at": "2019-08-12T11:27:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410144",
    "user": "https://github.com/embray"
}
```

<a id='comment:59'></a>
Replying to [embray](#comment%3A55):
> Please see #27592 for a bit of preliminary cleanup of the threejs rendering I would like to do.
> 
> I am still trying to find a solution for the issue mentioned in this ticket of rendering polyhedrons.  As I mentioned in[comment:42](#comment%3A42) the solution from the ThreeJS perspective is easy.  But it's not clear to me how to pass something like a 'shading' option around Sage's plot3d framework in a generic manner that makes sense, or how this problem is handled by the other 3D renderers.  If anyone with more experience with this codebase has any ideas I'd appreciate to hear them.
> 
> (I know there is a `Texture` object, but I'm not really sure how it's used.  It doesn't have threejs support yet either, apparently, though I could probably add that.)


Oh, I hadn't seen that ticket before, but this was fixed already by #27836.  Nice!



---

archive/issue_comments_410145.json:
```json
{
    "body": "<a id='comment:60'></a>\nDo we know of any other major blockers to throwing the switch on this?",
    "created_at": "2019-08-12T12:16:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410145",
    "user": "https://github.com/embray"
}
```

<a id='comment:60'></a>
Do we know of any other major blockers to throwing the switch on this?



---

archive/issue_comments_410146.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -13,6 +13,6 @@\n \n - some features are still missing in three.js, like \n   - converting the view to a png image for printing; NB: thanks to #27910 (merged in Sage 8.8.rc0), the png conversion is now possible in interactive mode; see [this discussion](https://trac.sagemath.org/ticket/27910#comment:6)\n-  - mesh plots \n+  - mesh plots: implementation in progress: see #28343\n   - ~~vector field plots~~ ==> fixed by #27932 (merged in Sage 8.9.beta0)\n   - ~~faces of polytopes look rounded~~ ==> fixed by #27836 (merged in Sage 8.8.beta7)\n``````\n",
    "created_at": "2019-08-12T13:20:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410146",
    "user": "https://github.com/egourgoulhon"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -13,6 +13,6 @@
 
 - some features are still missing in three.js, like 
   - converting the view to a png image for printing; NB: thanks to #27910 (merged in Sage 8.8.rc0), the png conversion is now possible in interactive mode; see [this discussion](https://trac.sagemath.org/ticket/27910#comment:6)
-  - mesh plots 
+  - mesh plots: implementation in progress: see #28343
   - ~~vector field plots~~ ==> fixed by #27932 (merged in Sage 8.9.beta0)
   - ~~faces of polytopes look rounded~~ ==> fixed by #27836 (merged in Sage 8.8.beta7)
``````




---

archive/issue_comments_410147.json:
```json
{
    "body": "<a id='comment:62'></a>\nReplying to [embray](#comment%3A60):\n> Do we know of any other major blockers to throwing the switch on this?\n\n\nNot from my side, all the more that the last remaining \"con\", namely mesh plots, is being handled in #28343.",
    "created_at": "2019-08-12T13:23:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410147",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:62'></a>
Replying to [embray](#comment%3A60):
> Do we know of any other major blockers to throwing the switch on this?


Not from my side, all the more that the last remaining "con", namely mesh plots, is being handled in #28343.



---

archive/issue_comments_410148.json:
```json
{
    "body": "<a id='comment:63'></a>\nReplying to [egourgoulhon](#comment%3A30):\n> Replying to [embray](#comment%3A28):\n> > For 3D graphics in the static documentation I don't know why we don't just use something like matplotlib.  It outputs very nice 3D graphics these days. \n\n> \n> Indeed.\n> \n> > I can write the necessary adapters...\n\n> \n> This would be nice! Moreover, why not using them not only for the documentation, but for any static display (as we already have with tachyon), by offering a new option: `viewer='matplotlib'` ?\n> \n\n3D plots in the documentation remain to be addressed. This new viewer sounds like a great idea.",
    "created_at": "2019-08-12T19:09:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410148",
    "user": "https://github.com/paulmasson"
}
```

<a id='comment:63'></a>
Replying to [egourgoulhon](#comment%3A30):
> Replying to [embray](#comment%3A28):
> > For 3D graphics in the static documentation I don't know why we don't just use something like matplotlib.  It outputs very nice 3D graphics these days. 

> 
> Indeed.
> 
> > I can write the necessary adapters...

> 
> This would be nice! Moreover, why not using them not only for the documentation, but for any static display (as we already have with tachyon), by offering a new option: `viewer='matplotlib'` ?
> 

3D plots in the documentation remain to be addressed. This new viewer sounds like a great idea.



---

archive/issue_comments_410149.json:
```json
{
    "body": "<a id='comment:64'></a>\nI might be missing your point, but I don't think changing the *default* viewer to threejs is really related to how plots in the documentation are generated.  It would still be nice to improve them, but that's a separate issue.",
    "created_at": "2019-08-13T07:55:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410149",
    "user": "https://github.com/embray"
}
```

<a id='comment:64'></a>
I might be missing your point, but I don't think changing the *default* viewer to threejs is really related to how plots in the documentation are generated.  It would still be nice to improve them, but that's a separate issue.



---

archive/issue_comments_410150.json:
```json
{
    "body": "<a id='comment:65'></a>\nReplying to [embray](#comment%3A64):\n> I might be missing your point, but I don't think changing the *default* viewer to threejs is really related to how plots in the documentation are generated.  It would still be nice to improve them, but that's a separate issue.\n\n`docbuild` currently uses the default viewer. There are multiple comments on this ticket indicating errors when Three.js is set to the default.",
    "created_at": "2019-08-13T18:48:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410150",
    "user": "https://github.com/paulmasson"
}
```

<a id='comment:65'></a>
Replying to [embray](#comment%3A64):
> I might be missing your point, but I don't think changing the *default* viewer to threejs is really related to how plots in the documentation are generated.  It would still be nice to improve them, but that's a separate issue.

`docbuild` currently uses the default viewer. There are multiple comments on this ticket indicating errors when Three.js is set to the default.



---

archive/issue_comments_410151.json:
```json
{
    "body": "<a id='comment:66'></a>\nReplying to [paulmasson](#comment%3A65):\n> Replying to [embray](#comment%3A64):\n> > I might be missing your point, but I don't think changing the *default* viewer to threejs is really related to how plots in the documentation are generated.  It would still be nice to improve them, but that's a separate issue.\n\n> `docbuild` currently uses the default viewer. There are multiple comments on this ticket indicating errors when Three.js is set to the default. \n\nIt would suffice to make the following change to the code of `sphinx_plot`, in line 75 of `src/sage/docs/conf.py`:\n\n```diff\n-     graphics.save(fn)\n+     graphics.save(fn, viewer='jmol')\n```\nto have all the documentation generated with Jmol, as it is currently. Of course the drawback is that the figures in the documentation will have an aspect different from what the user will get with threejs as the default. But maybe this is something we can live on at the moment...",
    "created_at": "2019-08-13T20:30:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410151",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:66'></a>
Replying to [paulmasson](#comment%3A65):
> Replying to [embray](#comment%3A64):
> > I might be missing your point, but I don't think changing the *default* viewer to threejs is really related to how plots in the documentation are generated.  It would still be nice to improve them, but that's a separate issue.

> `docbuild` currently uses the default viewer. There are multiple comments on this ticket indicating errors when Three.js is set to the default. 

It would suffice to make the following change to the code of `sphinx_plot`, in line 75 of `src/sage/docs/conf.py`:

```diff
-     graphics.save(fn)
+     graphics.save(fn, viewer='jmol')
```
to have all the documentation generated with Jmol, as it is currently. Of course the drawback is that the figures in the documentation will have an aspect different from what the user will get with threejs as the default. But maybe this is something we can live on at the moment...



---

archive/issue_comments_410152.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -13,6 +13,6 @@\n \n - some features are still missing in three.js, like \n   - converting the view to a png image for printing; NB: thanks to #27910 (merged in Sage 8.8.rc0), the png conversion is now possible in interactive mode; see [this discussion](https://trac.sagemath.org/ticket/27910#comment:6)\n-  - mesh plots: implementation in progress: see #28343\n+  - ~~mesh plots~~ ==> fixed by #28343 (merged in Sage 8.9.beta8)\n   - ~~vector field plots~~ ==> fixed by #27932 (merged in Sage 8.9.beta0)\n   - ~~faces of polytopes look rounded~~ ==> fixed by #27836 (merged in Sage 8.8.beta7)\n``````\n",
    "created_at": "2019-08-30T10:05:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410152",
    "user": "https://github.com/egourgoulhon"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -13,6 +13,6 @@
 
 - some features are still missing in three.js, like 
   - converting the view to a png image for printing; NB: thanks to #27910 (merged in Sage 8.8.rc0), the png conversion is now possible in interactive mode; see [this discussion](https://trac.sagemath.org/ticket/27910#comment:6)
-  - mesh plots: implementation in progress: see #28343
+  - ~~mesh plots~~ ==> fixed by #28343 (merged in Sage 8.9.beta8)
   - ~~vector field plots~~ ==> fixed by #27932 (merged in Sage 8.9.beta0)
   - ~~faces of polytopes look rounded~~ ==> fixed by #27836 (merged in Sage 8.8.beta7)
``````




---

archive/issue_comments_410153.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -8,6 +8,7 @@\n - three.js offers functionality absent in Jmol, notably axis labels\n - three.js works better with Jupyter than Jmol, see e.g. [this report](https://groups.google.com/d/msg/sage-support/KvNuD2DfRz0/VM1BPPDPCAAJ))\n - Jmol is a nightmare for packagers (for Debian, Windows, ...), see e.g. [this discussion on debian-science-sagemath](https://alioth-lists.debian.net/pipermail/debian-science-sagemath/2018-July/001228.html); in particular jsmol, which is invoked in Jupyter notebooks, is not packaged for Debian (see[comment:49](#comment%3A49))\n+- Jmol, as currently shipped with Sage, is broken with recent version of Java runtime environment, e.g. on Debian Buster and Ubuntu 18.04, see this [ask.sagemath question](https://ask.sagemath.org/question/47837/jmol-stuck-at-initializing-3d-display/)\n \n **cons**:\n \n``````\n",
    "created_at": "2019-09-12T21:42:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410153",
    "user": "https://github.com/egourgoulhon"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -8,6 +8,7 @@
 - three.js offers functionality absent in Jmol, notably axis labels
 - three.js works better with Jupyter than Jmol, see e.g. [this report](https://groups.google.com/d/msg/sage-support/KvNuD2DfRz0/VM1BPPDPCAAJ))
 - Jmol is a nightmare for packagers (for Debian, Windows, ...), see e.g. [this discussion on debian-science-sagemath](https://alioth-lists.debian.net/pipermail/debian-science-sagemath/2018-July/001228.html); in particular jsmol, which is invoked in Jupyter notebooks, is not packaged for Debian (see[comment:49](#comment%3A49))
+- Jmol, as currently shipped with Sage, is broken with recent version of Java runtime environment, e.g. on Debian Buster and Ubuntu 18.04, see this [ask.sagemath question](https://ask.sagemath.org/question/47837/jmol-stuck-at-initializing-3d-display/)
 
 **cons**:
 
``````




---

archive/issue_comments_410154.json:
```json
{
    "body": "<a id='comment:69'></a>\nIn answer to comments to y answer to [this ask.sagemath question](https://ask.sagemath.org/question/47837/jmol-stuck-at-initializing-3d-display/?answer=47844#post-id-47844): `threejs` still has problems handling transparencies and hidden-facets problems:\n\nTest case: try to plot a plane and a paraboloid:\n\n```\nsage: P1=plot3d(lambda x,y:x^2+y^2,(-2,2),(-2,2), color=\"blue\", opacity=0.5)\nsage: P2=plot3d(lambda x,y:1,(-2,2),(-2,2), color=\"yellow\", opacity=0.5)\nsage: show(P1+P2, viewer=\"threejs\")\nLaunched html viewer for Graphics3d Object\n```\n\nNow, in the browser window, try to change your point of view to look at the object from a little above the `z==1` plane: the \"lower\" part of the paraboloid diseappears if no point of it can be \"viewed directly\". It should be seen \"through the plane\" (in a greenish shade...).\n\nThere are also points of view where the \"directly visible\" part of the paraboloid is visible but the part \"hidden\" by the plane is not see \"through the plane\" as it should.\n\nLast, \"rotating\" the object exhibits moir\u00e9 effects at some points of the movement.",
    "created_at": "2019-09-13T19:29:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410154",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<a id='comment:69'></a>
In answer to comments to y answer to [this ask.sagemath question](https://ask.sagemath.org/question/47837/jmol-stuck-at-initializing-3d-display/?answer=47844#post-id-47844): `threejs` still has problems handling transparencies and hidden-facets problems:

Test case: try to plot a plane and a paraboloid:

```
sage: P1=plot3d(lambda x,y:x^2+y^2,(-2,2),(-2,2), color="blue", opacity=0.5)
sage: P2=plot3d(lambda x,y:1,(-2,2),(-2,2), color="yellow", opacity=0.5)
sage: show(P1+P2, viewer="threejs")
Launched html viewer for Graphics3d Object
```

Now, in the browser window, try to change your point of view to look at the object from a little above the `z==1` plane: the "lower" part of the paraboloid diseappears if no point of it can be "viewed directly". It should be seen "through the plane" (in a greenish shade...).

There are also points of view where the "directly visible" part of the paraboloid is visible but the part "hidden" by the plane is not see "through the plane" as it should.

Last, "rotating" the object exhibits moir effects at some points of the movement.



---

archive/issue_comments_410155.json:
```json
{
    "body": "<a id='comment:70'></a>\n... sorry to interrupt the discussion.\n\nI am very much looking forward to the improvements of this ticket!\n\nI have one small issue concerning polytopes (which is a feature that apparently a lot of people use, I receive a lot of feedback):\n\nhttp://doc.sagemath.org/html/en/thematic_tutorials/geometry/polytope_tikz.html\n\nI would be happy to migrate this tutorial to the then default viewer (especially for people where jmol would not work). Since I do not know `threejs` that much I was wondering if there is an equivalent way to figure out the \"angle of view data\" used in the tutorial. Namely:\n\nIn jmol's console, if one clicks \"State\", one gets a list of three numbers next to `moveto` followed by an angle of rotation between 0 and 360. These 4 numbers essentially describe the 3D-2D projection.\n\nIs there a (fairly) easy way to get this in `threejs`?",
    "created_at": "2019-09-14T06:12:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410155",
    "user": "https://github.com/jplab"
}
```

<a id='comment:70'></a>
... sorry to interrupt the discussion.

I am very much looking forward to the improvements of this ticket!

I have one small issue concerning polytopes (which is a feature that apparently a lot of people use, I receive a lot of feedback):

http://doc.sagemath.org/html/en/thematic_tutorials/geometry/polytope_tikz.html

I would be happy to migrate this tutorial to the then default viewer (especially for people where jmol would not work). Since I do not know `threejs` that much I was wondering if there is an equivalent way to figure out the "angle of view data" used in the tutorial. Namely:

In jmol's console, if one clicks "State", one gets a list of three numbers next to `moveto` followed by an angle of rotation between 0 and 360. These 4 numbers essentially describe the 3D-2D projection.

Is there a (fairly) easy way to get this in `threejs`?



---

archive/issue_comments_410156.json:
```json
{
    "body": "<a id='comment:72'></a>\nReplying to [charpent](#comment%3A69):\n> In answer to comments to y answer to [this ask.sagemath question](https://ask.sagemath.org/question/47837/jmol-stuck-at-initializing-3d-display/?answer=47844#post-id-47844): `threejs` still has problems handling transparencies and hidden-facets problems:\n\nTransparency in Three.js is rendered based on the centers of meshes. When two transparent meshes intersect they will be treated as if located entirely at each respective center, so that the problems described will not go away any time soon. One approach would be to use the WebGL 2 renderer of Three.js, as it has additional features not available in WebGL, but unfortunately this API is not universally [supported](https://caniuse.com/#search=webgl%202) mostly due to Apple.\n\nThe question is whether transparency is more important than packaging issues. Besides,  Jmol will remain available as a viewer option.",
    "created_at": "2019-09-17T01:19:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410156",
    "user": "https://github.com/paulmasson"
}
```

<a id='comment:72'></a>
Replying to [charpent](#comment%3A69):
> In answer to comments to y answer to [this ask.sagemath question](https://ask.sagemath.org/question/47837/jmol-stuck-at-initializing-3d-display/?answer=47844#post-id-47844): `threejs` still has problems handling transparencies and hidden-facets problems:

Transparency in Three.js is rendered based on the centers of meshes. When two transparent meshes intersect they will be treated as if located entirely at each respective center, so that the problems described will not go away any time soon. One approach would be to use the WebGL 2 renderer of Three.js, as it has additional features not available in WebGL, but unfortunately this API is not universally [supported](https://caniuse.com/#search=webgl%202) mostly due to Apple.

The question is whether transparency is more important than packaging issues. Besides,  Jmol will remain available as a viewer option.



---

archive/issue_comments_410157.json:
```json
{
    "body": "<a id='comment:73'></a>\nReplying to [jipilab](#comment%3A70):\n\n> \n> In jmol's console, if one clicks \"State\", one gets a list of three numbers next to `moveto` followed by an angle of rotation between 0 and 360. These 4 numbers essentially describe the 3D-2D projection.\n> \n> Is there a (fairly) easy way to get this in `threejs`?\n\nThe underlying information is available from the position of the camera relative to the midpoint of the scene. The question is how to make it easily accessible, since the Three.js `OrbitControls` use the mouse right click to pan the scene. Open possibility would be to add an additional icon like I did for downloading an image of the scene.",
    "created_at": "2019-09-17T01:21:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410157",
    "user": "https://github.com/paulmasson"
}
```

<a id='comment:73'></a>
Replying to [jipilab](#comment%3A70):

> 
> In jmol's console, if one clicks "State", one gets a list of three numbers next to `moveto` followed by an angle of rotation between 0 and 360. These 4 numbers essentially describe the 3D-2D projection.
> 
> Is there a (fairly) easy way to get this in `threejs`?

The underlying information is available from the position of the camera relative to the midpoint of the scene. The question is how to make it easily accessible, since the Three.js `OrbitControls` use the mouse right click to pan the scene. Open possibility would be to add an additional icon like I did for downloading an image of the scene.



---

archive/issue_comments_410158.json:
```json
{
    "body": "<a id='comment:74'></a>\nI don't think we need to worry too much about a particular browser not supporting a feature (WebGL 2) - as long as there is a browser for the OS in question that does support the feature.",
    "created_at": "2019-09-17T08:19:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410158",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:74'></a>
I don't think we need to worry too much about a particular browser not supporting a feature (WebGL 2) - as long as there is a browser for the OS in question that does support the feature.



---

archive/issue_comments_410159.json:
```json
{
    "body": "<a id='comment:75'></a>\nReplying to [paulmasson](#comment%3A72):\n> Replying to [charpent](#comment%3A69):\n> > In answer to comments to y answer to [this ask.sagemath question](https://ask.sagemath.org/question/47837/jmol-stuck-at-initializing-3d-display/?answer=47844#post-id-47844): `threejs` still has problems handling transparencies and hidden-facets problems:\n\n> Transparency in Three.js is rendered based on the centers of meshes. When two transparent meshes intersect they will be treated as if located entirely at each respective center, so that the problems described will not go away any time soon. One approach would be to use the WebGL 2 renderer of Three.js, as it has additional features not available in WebGL, but unfortunately this API is not universally [supported](https://caniuse.com/#search=webgl%202) mostly due to Apple.\n\n`dimpase`'s answer is relevant...\n\n> The question is whether transparency is more important than packaging issues. Besides,  Jmol will remain available as a viewer option.\n\n\nAnother (admittedly caricatural) example where the \"transparency problem\" clobbers the mathematical usefulness of the plot :\n\n```\nsage: P1=implicit_plot3d(E1.lhs().subs([a==2]),(x, -2, 2), (y, -2, 2), (z, -2, 2)\n....: , color=\"blue\", opacity=0.5)\nsage: P2=implicit_plot3d(E2.lhs().subs([b==1]),(x, -2, 2), (y, -2, 2), (z, -2, 2)\n....: , color=\"yellow\", opacity=0.5)\nsage: (P1.P2).show(viewer=\"threejs\")\n```\n\nThe part of the yellow cone inner to the sphere isn't visualized at all...",
    "created_at": "2019-09-17T20:25:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410159",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<a id='comment:75'></a>
Replying to [paulmasson](#comment%3A72):
> Replying to [charpent](#comment%3A69):
> > In answer to comments to y answer to [this ask.sagemath question](https://ask.sagemath.org/question/47837/jmol-stuck-at-initializing-3d-display/?answer=47844#post-id-47844): `threejs` still has problems handling transparencies and hidden-facets problems:

> Transparency in Three.js is rendered based on the centers of meshes. When two transparent meshes intersect they will be treated as if located entirely at each respective center, so that the problems described will not go away any time soon. One approach would be to use the WebGL 2 renderer of Three.js, as it has additional features not available in WebGL, but unfortunately this API is not universally [supported](https://caniuse.com/#search=webgl%202) mostly due to Apple.

`dimpase`'s answer is relevant...

> The question is whether transparency is more important than packaging issues. Besides,  Jmol will remain available as a viewer option.


Another (admittedly caricatural) example where the "transparency problem" clobbers the mathematical usefulness of the plot :

```
sage: P1=implicit_plot3d(E1.lhs().subs([a==2]),(x, -2, 2), (y, -2, 2), (z, -2, 2)
....: , color="blue", opacity=0.5)
sage: P2=implicit_plot3d(E2.lhs().subs([b==1]),(x, -2, 2), (y, -2, 2), (z, -2, 2)
....: , color="yellow", opacity=0.5)
sage: (P1.P2).show(viewer="threejs")
```

The part of the yellow cone inner to the sphere isn't visualized at all...



---

archive/issue_comments_410160.json:
```json
{
    "body": "<a id='comment:76'></a>\nReplying to [dimpase](#comment%3A74):\n> I don't think we need to worry too much about a particular browser not supporting a feature (WebGL 2) - as long as there is a browser for the OS in question that does support the feature.\n\nI disagree very strongly on this point: if the viewer produces wildly different results in different browsers it will produce nothing but endless questions. That is the entire reason for the existence of libraries like jQuery to ensure conformity across browsers.",
    "created_at": "2019-09-18T00:02:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410160",
    "user": "https://github.com/paulmasson"
}
```

<a id='comment:76'></a>
Replying to [dimpase](#comment%3A74):
> I don't think we need to worry too much about a particular browser not supporting a feature (WebGL 2) - as long as there is a browser for the OS in question that does support the feature.

I disagree very strongly on this point: if the viewer produces wildly different results in different browsers it will produce nothing but endless questions. That is the entire reason for the existence of libraries like jQuery to ensure conformity across browsers.



---

archive/issue_comments_410161.json:
```json
{
    "body": "<a id='comment:77'></a>\nReplying to [charpent](#comment%3A75):\n> Another (admittedly caricatural) example where the \"transparency problem\" clobbers the mathematical usefulness of the plot :\n> \n> \n> ```\n> sage: P1=implicit_plot3d(E1.lhs().subs([a==2]),(x, -2, 2), (y, -2, 2), (z, -2, 2)\n> ....: , color=\"blue\", opacity=0.5)\n> sage: P2=implicit_plot3d(E2.lhs().subs([b==1]),(x, -2, 2), (y, -2, 2), (z, -2, 2)\n> ....: , color=\"yellow\", opacity=0.5)\n> sage: (P1.P2).show(viewer=\"threejs\")\n> ```\n> \n> The part of the yellow cone inner to the sphere isn't visualized at all...\n> \n\nThis example is incomplete. What are E1 and E2?",
    "created_at": "2019-09-18T00:06:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410161",
    "user": "https://github.com/paulmasson"
}
```

<a id='comment:77'></a>
Replying to [charpent](#comment%3A75):
> Another (admittedly caricatural) example where the "transparency problem" clobbers the mathematical usefulness of the plot :
> 
> 
> ```
> sage: P1=implicit_plot3d(E1.lhs().subs([a==2]),(x, -2, 2), (y, -2, 2), (z, -2, 2)
> ....: , color="blue", opacity=0.5)
> sage: P2=implicit_plot3d(E2.lhs().subs([b==1]),(x, -2, 2), (y, -2, 2), (z, -2, 2)
> ....: , color="yellow", opacity=0.5)
> sage: (P1.P2).show(viewer="threejs")
> ```
> 
> The part of the yellow cone inner to the sphere isn't visualized at all...
> 

This example is incomplete. What are E1 and E2?



---

archive/issue_comments_410162.json:
```json
{
    "body": "<a id='comment:78'></a>\nReplying to [paulmasson](#comment%3A77):\n\n[ Snip... ]\n\n> This example is incomplete. What are E1 and E2?\n\n\nWups ! Compleed (and checked):\n\n```\nvar(\"x, y, z, a, b\")\nE1 = x^2 + y^2 + z^2 - a^2 == 0\nE2 = x^2 + y^2 - b^2*z^2 == 0\nP1=implicit_plot3d(E1.lhs().subs([a==2]),(x, -2, 2), (y, -2, 2), (z, -2, 2),\n                   color=\"blue\", opacity=0.5)\nP2=implicit_plot3d(E2.lhs().subs([b==1]),(x, -2, 2), (y, -2, 2), (z, -2, 2),\n                   color=\"yellow\", opacity=0.5)\n(P1+P2).show(viewer=\"threejs\")\n```",
    "created_at": "2019-09-18T03:36:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410162",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<a id='comment:78'></a>
Replying to [paulmasson](#comment%3A77):

[ Snip... ]

> This example is incomplete. What are E1 and E2?


Wups ! Compleed (and checked):

```
var("x, y, z, a, b")
E1 = x^2 + y^2 + z^2 - a^2 == 0
E2 = x^2 + y^2 - b^2*z^2 == 0
P1=implicit_plot3d(E1.lhs().subs([a==2]),(x, -2, 2), (y, -2, 2), (z, -2, 2),
                   color="blue", opacity=0.5)
P2=implicit_plot3d(E2.lhs().subs([b==1]),(x, -2, 2), (y, -2, 2), (z, -2, 2),
                   color="yellow", opacity=0.5)
(P1+P2).show(viewer="threejs")
```



---

archive/issue_comments_410163.json:
```json
{
    "body": "<a id='comment:79'></a>\nReplying to [paulmasson](#comment%3A76):\n> Replying to [dimpase](#comment%3A74):\n> > I don't think we need to worry too much about a particular browser not supporting a feature (WebGL 2) - as long as there is a browser for the OS in question that does support the feature.\n\n> I disagree very strongly on this point: if the viewer produces wildly different results in different browsers it will produce nothing but endless questions. That is the entire reason for the existence of libraries like jQuery to ensure conformity across browsers.\n\nYou either mean to say that WebGL 2 is dead and noone is using it, or you say it is technically impossible to print an error message on Safari as soon as WebGL 2 is used there...\n\n\nI gather that Apple is unwilling to support WeGL 2. So what? Jupyter and SageNB never worked well in IE, and?\n\nEDIT: jmol is just not working on some platforms (e.g. on Windows or in a VM, on various HPC clusters, etc), full stop. We are constantly helping users to work around this limitation. If something is not working in Safari, oh well, we can live with it, document, print warnings, and move on.",
    "created_at": "2019-09-18T06:26:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410163",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:79'></a>
Replying to [paulmasson](#comment%3A76):
> Replying to [dimpase](#comment%3A74):
> > I don't think we need to worry too much about a particular browser not supporting a feature (WebGL 2) - as long as there is a browser for the OS in question that does support the feature.

> I disagree very strongly on this point: if the viewer produces wildly different results in different browsers it will produce nothing but endless questions. That is the entire reason for the existence of libraries like jQuery to ensure conformity across browsers.

You either mean to say that WebGL 2 is dead and noone is using it, or you say it is technically impossible to print an error message on Safari as soon as WebGL 2 is used there...


I gather that Apple is unwilling to support WeGL 2. So what? Jupyter and SageNB never worked well in IE, and?

EDIT: jmol is just not working on some platforms (e.g. on Windows or in a VM, on various HPC clusters, etc), full stop. We are constantly helping users to work around this limitation. If something is not working in Safari, oh well, we can live with it, document, print warnings, and move on.



---

archive/issue_comments_410164.json:
```json
{
    "body": "<a id='comment:80'></a>\nReplying to [charpent](#comment%3A75):\n> \n> The part of the yellow cone inner to the sphere isn't visualized at all...\n> \n\nIMHO, these opacity issues are very minor ones: in the two provided examples, it suffices to adjust the opacity parameter of the background object to fix them, e.g. `opacity=1` in `P1` of[comment:75](#comment%3A75) and `opacity=1` in `P2` of[comment:78](#comment%3A78).",
    "created_at": "2019-09-18T08:34:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410164",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:80'></a>
Replying to [charpent](#comment%3A75):
> 
> The part of the yellow cone inner to the sphere isn't visualized at all...
> 

IMHO, these opacity issues are very minor ones: in the two provided examples, it suffices to adjust the opacity parameter of the background object to fix them, e.g. `opacity=1` in `P1` of[comment:75](#comment%3A75) and `opacity=1` in `P2` of[comment:78](#comment%3A78).



---

archive/issue_comments_410165.json:
```json
{
    "body": "<a id='comment:81'></a>\nReplying to [egourgoulhon](#comment%3A80):\n> Replying to [charpent](#comment%3A75):\n> > \n> > The part of the yellow cone inner to the sphere isn't visualized at all...\n> > \n\n> IMHO, these opacity issues are very minor ones: in the two provided examples, it suffices to adjust the opacity parameter of the background object to fix them, e.g. `opacity=1` in `P1` of[comment:75](#comment%3A75) and `opacity=1` in `P2` of[comment:78](#comment%3A78). \n\nEasy fix, indeed. But the (mathematical) point is that neither as \"background\". Not a problem here, more of a problem for visualizing, say, self-intersecting surfaces...",
    "created_at": "2019-09-18T08:45:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410165",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<a id='comment:81'></a>
Replying to [egourgoulhon](#comment%3A80):
> Replying to [charpent](#comment%3A75):
> > 
> > The part of the yellow cone inner to the sphere isn't visualized at all...
> > 

> IMHO, these opacity issues are very minor ones: in the two provided examples, it suffices to adjust the opacity parameter of the background object to fix them, e.g. `opacity=1` in `P1` of[comment:75](#comment%3A75) and `opacity=1` in `P2` of[comment:78](#comment%3A78). 

Easy fix, indeed. But the (mathematical) point is that neither as "background". Not a problem here, more of a problem for visualizing, say, self-intersecting surfaces...



---

archive/issue_comments_410166.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -13,7 +13,9 @@\n **cons**:\n \n - some features are still missing in three.js, like \n-  - converting the view to a png image for printing; NB: thanks to #27910 (merged in Sage 8.8.rc0), the png conversion is now possible in interactive mode; see [this discussion](https://trac.sagemath.org/ticket/27910#comment:6)\n+  - converting the view to a png image in *non-interactive* mode (e.g. when generating the reference manual, cf.[comment:66](#comment%3A66)); NB: thanks to #27910 (merged in Sage 8.8.rc0), the png conversion is now possible in *interactive* mode; see [this discussion](https://trac.sagemath.org/ticket/27910#comment:6)\n   - ~~mesh plots~~ ==> fixed by #28343 (merged in Sage 8.9.beta8)\n   - ~~vector field plots~~ ==> fixed by #27932 (merged in Sage 8.9.beta0)\n+- three.js has some issues:\n   - ~~faces of polytopes look rounded~~ ==> fixed by #27836 (merged in Sage 8.8.beta7)\n+  - some opacity issues: cf.[comment:75](#comment%3A75) and below\n``````\n",
    "created_at": "2019-09-18T09:08:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410166",
    "user": "https://github.com/egourgoulhon"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -13,7 +13,9 @@
 **cons**:
 
 - some features are still missing in three.js, like 
-  - converting the view to a png image for printing; NB: thanks to #27910 (merged in Sage 8.8.rc0), the png conversion is now possible in interactive mode; see [this discussion](https://trac.sagemath.org/ticket/27910#comment:6)
+  - converting the view to a png image in *non-interactive* mode (e.g. when generating the reference manual, cf.[comment:66](#comment%3A66)); NB: thanks to #27910 (merged in Sage 8.8.rc0), the png conversion is now possible in *interactive* mode; see [this discussion](https://trac.sagemath.org/ticket/27910#comment:6)
   - ~~mesh plots~~ ==> fixed by #28343 (merged in Sage 8.9.beta8)
   - ~~vector field plots~~ ==> fixed by #27932 (merged in Sage 8.9.beta0)
+- three.js has some issues:
   - ~~faces of polytopes look rounded~~ ==> fixed by #27836 (merged in Sage 8.8.beta7)
+  - some opacity issues: cf.[comment:75](#comment%3A75) and below
``````




---

archive/issue_comments_410167.json:
```json
{
    "body": "<a id='comment:83'></a>\nI've updated the pros/cons section of the ticket description. I guess the question is not \"is three.js perfect, so that it can become the default viewer?\", but rather \"is the ratio gain (pros) to loss (cons) high enough to make it the default viewer?\". IMHO the answer is yes, given that jmol will remain available (when it works...) as an optional viewer. Probably there should be a poll on sage-devel. Before launching such a poll, I would like to test the workaround proposed in[comment:66](#comment%3A66) for generating the doc. Do you have any other suggestion to deal with this last point?",
    "created_at": "2019-09-18T09:26:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410167",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:83'></a>
I've updated the pros/cons section of the ticket description. I guess the question is not "is three.js perfect, so that it can become the default viewer?", but rather "is the ratio gain (pros) to loss (cons) high enough to make it the default viewer?". IMHO the answer is yes, given that jmol will remain available (when it works...) as an optional viewer. Probably there should be a poll on sage-devel. Before launching such a poll, I would like to test the workaround proposed in[comment:66](#comment%3A66) for generating the doc. Do you have any other suggestion to deal with this last point?



---

archive/issue_comments_410168.json:
```json
{
    "body": "<a id='comment:84'></a>\nReplying to [paulmasson](#comment%3A72):\n> The question is whether transparency is more important than packaging issues. Besides,  Jmol will remain available as a viewer option.\n\n\n!^ This.  Different viewers will all have different issues, and fixing every known bug with ThreeJS (which is a problem beyond Sage since it involves browsers, WebGL libraries, operating systems, etc.) is not a viable blocker to making this change or it will never happen.\n\nThe ThreeJS viewer works for the most common cases, and most importantly for cases that are likely to arise in tutorials for new users, etc.  For more niche applications, other viewers will still be available as alternatives until/unless the issue can be resolved with ThreeJS.",
    "created_at": "2019-09-18T09:31:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410168",
    "user": "https://github.com/embray"
}
```

<a id='comment:84'></a>
Replying to [paulmasson](#comment%3A72):
> The question is whether transparency is more important than packaging issues. Besides,  Jmol will remain available as a viewer option.


!^ This.  Different viewers will all have different issues, and fixing every known bug with ThreeJS (which is a problem beyond Sage since it involves browsers, WebGL libraries, operating systems, etc.) is not a viable blocker to making this change or it will never happen.

The ThreeJS viewer works for the most common cases, and most importantly for cases that are likely to arise in tutorials for new users, etc.  For more niche applications, other viewers will still be available as alternatives until/unless the issue can be resolved with ThreeJS.



---

archive/issue_comments_410169.json:
```json
{
    "body": "<a id='comment:85'></a>\nReplying to [embray](#comment%3A84):\n> Replying to [paulmasson](#comment%3A72):\n> > The question is whether transparency is more important than packaging issues. Besides,  Jmol will remain available as a viewer option.\n\n> \n> !^ This.  Different viewers will all have different issues, and fixing every known bug with ThreeJS (which is a problem beyond Sage since it involves browsers, WebGL libraries, operating systems, etc.) is not a viable blocker to making this change or it will never happen.\n> \n> The ThreeJS viewer works for the most common cases, and most importantly for cases that are likely to arise in tutorials for new users, etc.  For more niche applications, other viewers will still be available as alternatives until/unless the issue can be resolved with ThreeJS.\n\n\nI mostly agree with you both : in their current respective states, `threejs` is probably a more useful //default// than `jmol` (unless sudden progress on #25026 and related tickets miraculously happens...) . However :\n\n> Probably there should be a poll on sage-devel.\n\n\nSeconded. Since it probably is already too late for 8.9 (which is at the \"rc\" stage), and since a doc-building test must be undertaken, this pool could proceed as soon as this tests well.\n\nOther valuable suggestions have been made, such as the addition of some widget allowing to get the current view parameters, etc. (and I may have a couple, if I can take the time to *think about them...). Unless they are trivial, they probably would deserve ticket(s) of their own, less urgent than the proposed change of default.",
    "created_at": "2019-09-18T09:47:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410169",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<a id='comment:85'></a>
Replying to [embray](#comment%3A84):
> Replying to [paulmasson](#comment%3A72):
> > The question is whether transparency is more important than packaging issues. Besides,  Jmol will remain available as a viewer option.

> 
> !^ This.  Different viewers will all have different issues, and fixing every known bug with ThreeJS (which is a problem beyond Sage since it involves browsers, WebGL libraries, operating systems, etc.) is not a viable blocker to making this change or it will never happen.
> 
> The ThreeJS viewer works for the most common cases, and most importantly for cases that are likely to arise in tutorials for new users, etc.  For more niche applications, other viewers will still be available as alternatives until/unless the issue can be resolved with ThreeJS.


I mostly agree with you both : in their current respective states, `threejs` is probably a more useful //default// than `jmol` (unless sudden progress on #25026 and related tickets miraculously happens...) . However :

> Probably there should be a poll on sage-devel.


Seconded. Since it probably is already too late for 8.9 (which is at the "rc" stage), and since a doc-building test must be undertaken, this pool could proceed as soon as this tests well.

Other valuable suggestions have been made, such as the addition of some widget allowing to get the current view parameters, etc. (and I may have a couple, if I can take the time to *think about them...). Unless they are trivial, they probably would deserve ticket(s) of their own, less urgent than the proposed change of default.



---

archive/issue_comments_410170.json:
```json
{
    "body": "<a id='comment:86'></a>\nReplying to [charpent](#comment%3A85):\n> I mostly agree with you both : in their current respective states, `threejs` is probably a more useful //default// than `jmol` (unless sudden progress on #25026 and related tickets miraculously happens...) . However :\n\n\nLet the miracle happen, #25026 needs review !\n\nI personally need that for SDL since next version is going to migrate to Debian buster.",
    "created_at": "2019-09-18T14:13:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410170",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:86'></a>
Replying to [charpent](#comment%3A85):
> I mostly agree with you both : in their current respective states, `threejs` is probably a more useful //default// than `jmol` (unless sudden progress on #25026 and related tickets miraculously happens...) . However :


Let the miracle happen, #25026 needs review !

I personally need that for SDL since next version is going to migrate to Debian buster.



---

archive/issue_comments_410171.json:
```json
{
    "body": "Changing author from \"\" to \"Paul Masson, Eric Gourgoulhon\"",
    "created_at": "2019-09-19T15:01:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410171",
    "user": "https://github.com/egourgoulhon"
}
```

Changing author from "" to "Paul Masson, Eric Gourgoulhon"



---

archive/issue_comments_410172.json:
```json
{
    "body": "Changing commit from \"93b0b0e293645b46f409c3514df70d337b16a88e\" to \"fcac479a1d7d364973ecd571b949aecc1e9e06e7\"",
    "created_at": "2019-09-19T15:01:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410172",
    "user": "https://github.com/egourgoulhon"
}
```

Changing commit from "93b0b0e293645b46f409c3514df70d337b16a88e" to "fcac479a1d7d364973ecd571b949aecc1e9e06e7"



---

archive/issue_comments_410173.json:
```json
{
    "body": "Changing branch from \"u/paulmasson/22408\" to \"public/graphics/22408\"",
    "created_at": "2019-09-19T15:01:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410173",
    "user": "https://github.com/egourgoulhon"
}
```

Changing branch from "u/paulmasson/22408" to "public/graphics/22408"



---

archive/issue_comments_410174.json:
```json
{
    "body": "<a id='comment:87'></a>\nHere is a first version of the complete code for making threejs the default viewer. With respect to the code in previous branch (which was only changing the `'viewer'` value in the dict `SHOW_DEFAULTS`), this code makes `viewer=None` equivalent to `viewer='threejs'` and updates the documentation to reflect the change of the default viewer. \n\nNB: for generating the reference manual, instead of the solution proposed in[comment:66](#comment%3A66), I've made the method `Graphics3d._save_image_png` fall back on jmol if the viewer is threejs.  \n\nI've checked that both the html and pdf documentation are generated without any error (with png figures produced by jmol though...) and I am setting the ticket to 'needs review' to draw the attention of the patchbots.\n\n---\nNew commits:\n|                                                                                                                                          |                                                                                     |\n|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------|\n|[ca4852b](https://github.com/sagemath/sagetrac-mirror/commit/ca4852bfaeb4464d88cc22897cf0b44f3d5147b3)|`Merge branch 'u/paulmasson/22408' of git://trac.sagemath.org/sage into Sage 8.9.rc0`|\n|[fcac479](https://github.com/sagemath/sagetrac-mirror/commit/fcac479a1d7d364973ecd571b949aecc1e9e06e7)|`Make threejs the default 3d viewer`|",
    "created_at": "2019-09-19T15:01:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410174",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:87'></a>
Here is a first version of the complete code for making threejs the default viewer. With respect to the code in previous branch (which was only changing the `'viewer'` value in the dict `SHOW_DEFAULTS`), this code makes `viewer=None` equivalent to `viewer='threejs'` and updates the documentation to reflect the change of the default viewer. 

NB: for generating the reference manual, instead of the solution proposed in[comment:66](#comment%3A66), I've made the method `Graphics3d._save_image_png` fall back on jmol if the viewer is threejs.  

I've checked that both the html and pdf documentation are generated without any error (with png figures produced by jmol though...) and I am setting the ticket to 'needs review' to draw the attention of the patchbots.

---
New commits:
|                                                                                                                                          |                                                                                     |
|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------|
|[ca4852b](https://github.com/sagemath/sagetrac-mirror/commit/ca4852bfaeb4464d88cc22897cf0b44f3d5147b3)|`Merge branch 'u/paulmasson/22408' of git://trac.sagemath.org/sage into Sage 8.9.rc0`|
|[fcac479](https://github.com/sagemath/sagetrac-mirror/commit/fcac479a1d7d364973ecd571b949aecc1e9e06e7)|`Make threejs the default 3d viewer`|



---

archive/issue_comments_410175.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-09-19T15:01:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410175",
    "user": "https://github.com/egourgoulhon"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_410176.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-09-20T01:06:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410176",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_410177.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Dima Pasechnik\"",
    "created_at": "2019-09-20T01:06:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410177",
    "user": "https://github.com/dimpase"
}
```

Changing reviewer from "" to "Dima Pasechnik"



---

archive/issue_comments_410178.json:
```json
{
    "body": "<a id='comment:88'></a>\nlooks good to me, especially it's nice that it works in Jupyter notebooks and in sagenb. \n(on various Lines and on OSX 10.13.6)",
    "created_at": "2019-09-20T01:06:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410178",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:88'></a>
looks good to me, especially it's nice that it works in Jupyter notebooks and in sagenb. 
(on various Lines and on OSX 10.13.6)



---

archive/issue_events_074507.json:
```json
{
    "actor": "https://github.com/egourgoulhon",
    "created_at": "2019-09-23T08:24:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "milestone": "sage-pending",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22408#event-74507"
}
```



---

archive/issue_events_074508.json:
```json
{
    "actor": "https://github.com/egourgoulhon",
    "created_at": "2019-09-23T08:24:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "milestone": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22408#event-74508"
}
```



---

archive/issue_comments_410179.json:
```json
{
    "body": "<a id='comment:89'></a>\nI am setting the ticket back to 'needs_review' and the milestone to sage-8.9 to draw the attention of the patchbots (apparently having 'sage-pending' prevented the patchbots to run on this ticket). \n\nPS: I am also opening a poll on sage-devel.",
    "created_at": "2019-09-23T08:24:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410179",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:89'></a>
I am setting the ticket back to 'needs_review' and the milestone to sage-8.9 to draw the attention of the patchbots (apparently having 'sage-pending' prevented the patchbots to run on this ticket). 

PS: I am also opening a poll on sage-devel.



---

archive/issue_comments_410180.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2019-09-23T08:24:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410180",
    "user": "https://github.com/egourgoulhon"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_410181.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-09-23T08:53:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410181",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_410182.json:
```json
{
    "body": "<a id='comment:91'></a>\nReplying to [egourgoulhon](#comment%3A89):\n> PS: I am also opening a poll on sage-devel. \n\n\nThis is https://groups.google.com/forum/#!topic/sage-devel/DmBa1bjUJ-I",
    "created_at": "2019-09-23T11:53:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410182",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:91'></a>
Replying to [egourgoulhon](#comment%3A89):
> PS: I am also opening a poll on sage-devel. 


This is https://groups.google.com/forum/#!topic/sage-devel/DmBa1bjUJ-I



---

archive/issue_events_074509.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-09-30T08:12:27Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "milestone": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22408#event-74509"
}
```



---

archive/issue_events_074510.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-09-30T08:12:27Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "milestone": "sage-9.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22408#event-74510"
}
```



---

archive/issue_comments_410183.json:
```json
{
    "body": "<a id='comment:92'></a>\nmoving milestone to 9.0 (after release of 8.9)",
    "created_at": "2019-09-30T08:12:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410183",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:92'></a>
moving milestone to 9.0 (after release of 8.9)



---

archive/issue_comments_410184.json:
```json
{
    "body": "Changing branch from \"public/graphics/22408\" to \"fcac479a1d7d364973ecd571b949aecc1e9e06e7\"",
    "created_at": "2019-10-03T17:58:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410184",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "public/graphics/22408" to "fcac479a1d7d364973ecd571b949aecc1e9e06e7"



---

archive/issue_comments_410185.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-10-03T17:58:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410185",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_074511.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-10-03T17:58:33Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22408#event-74511"
}
```



---

archive/issue_comments_410186.json:
```json
{
    "body": "<a id='comment:94'></a>\nThis seems to have broken the doc building on some python3 sage:\n\nsee https://patchbot.sagemath.org/log/0/Ubuntu/16.04/x86_64/4.4.0-161-generic/atlas/2019-10-10%2016:18:22?plugin=docbuild",
    "created_at": "2019-10-10T19:15:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410186",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:94'></a>
This seems to have broken the doc building on some python3 sage:

see https://patchbot.sagemath.org/log/0/Ubuntu/16.04/x86_64/4.4.0-161-generic/atlas/2019-10-10%2016:18:22?plugin=docbuild



---

archive/issue_comments_410187.json:
```json
{
    "body": "Changing commit from \"fcac479a1d7d364973ecd571b949aecc1e9e06e7\" to \"\"",
    "created_at": "2019-10-10T19:15:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410187",
    "user": "https://github.com/fchapoton"
}
```

Changing commit from "fcac479a1d7d364973ecd571b949aecc1e9e06e7" to ""



---

archive/issue_comments_410188.json:
```json
{
    "body": "<a id='comment:95'></a>\nThere is also an issue when the browser does not support OpenGL, there should be some fallback in such cases: see #28589.",
    "created_at": "2019-10-10T19:55:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410188",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:95'></a>
There is also an issue when the browser does not support OpenGL, there should be some fallback in such cases: see #28589.



---

archive/issue_comments_410189.json:
```json
{
    "body": "<a id='comment:96'></a>\nRe the messages like\n\n```\nRuntimeError: Jmol failed to create file '/home/u1/chapoton/.sage/temp/atlas/38849/dir_j7p5z38w/preview.png', see '/home/u1/chapoton/.sage/temp/atlas/38849/tmp_9z6qo292.txt'\n```\nWhat did the txt files say?",
    "created_at": "2019-10-10T22:14:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410189",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:96'></a>
Re the messages like

```
RuntimeError: Jmol failed to create file '/home/u1/chapoton/.sage/temp/atlas/38849/dir_j7p5z38w/preview.png', see '/home/u1/chapoton/.sage/temp/atlas/38849/tmp_9z6qo292.txt'
```
What did the txt files say?



---

archive/issue_comments_410190.json:
```json
{
    "body": "<a id='comment:97'></a>\nReplying to [jhpalmieri](#comment%3A96):\n> Re the messages like\n> \n> ```\n> RuntimeError: Jmol failed to create file '/home/u1/chapoton/.sage/temp/atlas/38849/dir_j7p5z38w/preview.png', see '/home/u1/chapoton/.sage/temp/atlas/38849/tmp_9z6qo292.txt'\n> ```\n> What did the txt files say?\n\n\nMy random guess of the day is that it is caused by https://groups.google.com/d/topic/sage-devel/snx2Rr5W6xc/discussion",
    "created_at": "2019-10-10T23:42:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410190",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:97'></a>
Replying to [jhpalmieri](#comment%3A96):
> Re the messages like
> 
> ```
> RuntimeError: Jmol failed to create file '/home/u1/chapoton/.sage/temp/atlas/38849/dir_j7p5z38w/preview.png', see '/home/u1/chapoton/.sage/temp/atlas/38849/tmp_9z6qo292.txt'
> ```
> What did the txt files say?


My random guess of the day is that it is caused by https://groups.google.com/d/topic/sage-devel/snx2Rr5W6xc/discussion



---

archive/issue_comments_410191.json:
```json
{
    "body": "<a id='comment:98'></a>\nThen it's due to #25026, I think. Would this be the right fix?\n\n```diff\ndiff --git a/build/pkgs/jmol/spkg-install b/build/pkgs/jmol/spkg-install\nindex 27798e6232..65dfa6df44 100644\n--- a/build/pkgs/jmol/spkg-install\n+++ b/build/pkgs/jmol/spkg-install\n@@ -6,6 +6,7 @@ rm -f \"${SAGE_LOCAL}/bin/jmol\"\n # jsmol goes in a dedicated directory\n sdh_install src/jsmol \"${SAGE_SHARE}/\"\n rm -rf src/jsmol\n+chmod a+rx src\n \n sdh_install -T src \"${SAGE_SHARE}/jmol\"\n sdh_install jmol \"${SAGE_LOCAL}/bin/\"\n```",
    "created_at": "2019-10-11T00:31:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410191",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:98'></a>
Then it's due to #25026, I think. Would this be the right fix?

```diff
diff --git a/build/pkgs/jmol/spkg-install b/build/pkgs/jmol/spkg-install
index 27798e6232..65dfa6df44 100644
--- a/build/pkgs/jmol/spkg-install
+++ b/build/pkgs/jmol/spkg-install
@@ -6,6 +6,7 @@ rm -f "${SAGE_LOCAL}/bin/jmol"
 # jsmol goes in a dedicated directory
 sdh_install src/jsmol "${SAGE_SHARE}/"
 rm -rf src/jsmol
+chmod a+rx src
 
 sdh_install -T src "${SAGE_SHARE}/jmol"
 sdh_install jmol "${SAGE_LOCAL}/bin/"
```



---

archive/issue_comments_410192.json:
```json
{
    "body": "<a id='comment:99'></a>\nIs there a trac ticket open for the jmol permissions issue?",
    "created_at": "2019-10-11T00:32:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410192",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:99'></a>
Is there a trac ticket open for the jmol permissions issue?



---

archive/issue_comments_410193.json:
```json
{
    "body": "<a id='comment:0'></a>\nI don't think so, at least I didn't open one.",
    "created_at": "2019-10-11T04:14:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410193",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:0'></a>
I don't think so, at least I didn't open one.



---

archive/issue_comments_410194.json:
```json
{
    "body": "<a id='comment:101'></a>\nReplying to [novoselt](#comment%3A100):\n> I don't think so, at least I didn't open one.\n\n\n#28596. In my opinion, you should have opened a ticket the same time you reported the problem on sage-devel: sage-devel threads can get lost pretty easily.",
    "created_at": "2019-10-12T17:15:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410194",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:101'></a>
Replying to [novoselt](#comment%3A100):
> I don't think so, at least I didn't open one.


#28596. In my opinion, you should have opened a ticket the same time you reported the problem on sage-devel: sage-devel threads can get lost pretty easily.



---

archive/issue_comments_410195.json:
```json
{
    "body": "<a id='comment:102'></a>\nReplying to [chapoton](#comment%3A94):\n> This seems to have broken the doc building on some python3 sage:\n> \n> see https://patchbot.sagemath.org/log/0/Ubuntu/16.04/x86_64/4.4.0-161-generic/atlas/2019-10-10%2016:18:22?plugin=docbuild\n\n\nCould you try #28596 to see if Andrey's guess is right? With that branch, do `sage -f jmol` and see if it fixes your problems.",
    "created_at": "2019-10-12T17:36:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22408#issuecomment-410195",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:102'></a>
Replying to [chapoton](#comment%3A94):
> This seems to have broken the doc building on some python3 sage:
> 
> see https://patchbot.sagemath.org/log/0/Ubuntu/16.04/x86_64/4.4.0-161-generic/atlas/2019-10-10%2016:18:22?plugin=docbuild


Could you try #28596 to see if Andrey's guess is right? With that branch, do `sage -f jmol` and see if it fixes your problems.
