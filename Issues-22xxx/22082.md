# Issue 22082: Automatic variable names for finite fields are not normalized

archive/issues_021845.json:
```json
{
    "body": "There is a problem with the normalization of names of variables which are given automatically for finite fields.\n\n```\nsage: K = GF(4)\nsage: K._factory_data\n(<class 'sage.rings.finite_rings.finite_field_constructor.FiniteFieldFactory'>,\n (7, 5, 'beta6'),\n (4, 'z2', x^2 + x + 1, 'givaro', \"{'prefix': 'z'}\", 2, 2, True), {'prefix': 'z'})\n     ^^^^\n```\n\nHere the name of the variable(s) is not normalized and should be `('z2',)`. Compare with:\n\n```\nsage: L = GF(4, name='z2')\nsage: L._factory_data\n(<class 'sage.rings.finite_rings.finite_field_constructor.FiniteFieldFactory'>,\n (7, 5, 'beta6'),\n (4, ('z2',), x^2 + x + 1, 'givaro', '{}', 2, 2, True),\n {})\n```\n\nBy the way, should `K == L`. Currently, it is false.\n\nCC:  jpflori erousseau\n\nKeywords: name normalization, finite fields, sd86.5\n\nAuthor: Xavier Caruso\n\nBranch: u/caruso/normalize_name_conway\n\nStatus: needs_work\n\nCommit: c7870d3c8c5e1822176e73d708640fa0b86b6029\n\nIssue created by migration from https://trac.sagemath.org/ticket/22082\n\n",
    "created_at": "2016-12-20T21:27:55Z",
    "labels": [
        "component: finite rings",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.5",
    "title": "Automatic variable names for finite fields are not normalized",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22082",
    "user": "https://github.com/xcaruso"
}
```
There is a problem with the normalization of names of variables which are given automatically for finite fields.

```
sage: K = GF(4)
sage: K._factory_data
(<class 'sage.rings.finite_rings.finite_field_constructor.FiniteFieldFactory'>,
 (7, 5, 'beta6'),
 (4, 'z2', x^2 + x + 1, 'givaro', "{'prefix': 'z'}", 2, 2, True), {'prefix': 'z'})
     ^^^^
```

Here the name of the variable(s) is not normalized and should be `('z2',)`. Compare with:

```
sage: L = GF(4, name='z2')
sage: L._factory_data
(<class 'sage.rings.finite_rings.finite_field_constructor.FiniteFieldFactory'>,
 (7, 5, 'beta6'),
 (4, ('z2',), x^2 + x + 1, 'givaro', '{}', 2, 2, True),
 {})
```

By the way, should `K == L`. Currently, it is false.

CC:  jpflori erousseau

Keywords: name normalization, finite fields, sd86.5

Author: Xavier Caruso

Branch: u/caruso/normalize_name_conway

Status: needs_work

Commit: c7870d3c8c5e1822176e73d708640fa0b86b6029

Issue created by migration from https://trac.sagemath.org/ticket/22082





---

archive/issue_comments_408678.json:
```json
{
    "body": "Changing branch from \"\" to \"u/caruso/normalize_name_conway\"",
    "created_at": "2016-12-20T21:29:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22082#issuecomment-408678",
    "user": "https://github.com/xcaruso"
}
```

Changing branch from "" to "u/caruso/normalize_name_conway"



---

archive/issue_comments_408679.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to defect.",
    "created_at": "2016-12-20T21:29:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22082#issuecomment-408679",
    "user": "https://github.com/xcaruso"
}
```

Changing type from PLEASE CHANGE to defect.



---

archive/issue_comments_408680.json:
```json
{
    "body": "<a id='comment:2'></a>New commits:",
    "created_at": "2016-12-20T21:29:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22082#issuecomment-408680",
    "user": "https://github.com/xcaruso"
}
```

<a id='comment:2'></a>New commits:



---

archive/issue_comments_408681.json:
```json
{
    "body": "Changing commit from \"\" to \"82bf26cb4d5f330dc47a03d912cf38a78993e748\"",
    "created_at": "2016-12-20T21:29:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22082#issuecomment-408681",
    "user": "https://github.com/xcaruso"
}
```

Changing commit from "" to "82bf26cb4d5f330dc47a03d912cf38a78993e748"



---

archive/issue_comments_408682.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-12-20T21:29:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22082#issuecomment-408682",
    "user": "https://github.com/xcaruso"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_408683.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -20,9 +20,7 @@\n  {})\n ```\n \n-By the way, should `K == L`. Currently, it is false.\n-\n-Keywords: name normalization, finite fields\n+By the way, should `K == L`? Currently, it is false.\n \n Author: Xavier Caruso\n \n``````\n",
    "created_at": "2016-12-20T21:33:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22082#issuecomment-408683",
    "user": "https://github.com/xcaruso"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -20,9 +20,7 @@
  {})
 ```
 
-By the way, should `K == L`. Currently, it is false.
-
-Keywords: name normalization, finite fields
+By the way, should `K == L`? Currently, it is false.
 
 Author: Xavier Caruso
 
``````




---

archive/issue_comments_408684.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,26 @@\n+There is a problem with the normalization of names of variables which are given automatically for finite fields.\n \n+```\n+sage: K = GF(4)\n+sage: K._factory_data\n+(<class 'sage.rings.finite_rings.finite_field_constructor.FiniteFieldFactory'>,\n+ (7, 5, 'beta6'),\n+ (4, 'z2', x^2 + x + 1, 'givaro', \"{'prefix': 'z'}\", 2, 2, True), {'prefix': 'z'})\n+     ^^^^\n+```\n+\n+Here the name of the variable(s) is not normalized and should be `('z2',)`. Compare with:\n+\n+```\n+sage: L = GF(4, name='z2')\n+sage: L._factory_data\n+(<class 'sage.rings.finite_rings.finite_field_constructor.FiniteFieldFactory'>,\n+ (7, 5, 'beta6'),\n+ (4, ('z2',), x^2 + x + 1, 'givaro', '{}', 2, 2, True),\n+ {})\n+```\n+\n+By the way, should `K == L`. Currently, it is false.\n \n Author: Xavier Caruso\n \n``````\n",
    "created_at": "2016-12-20T21:36:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22082#issuecomment-408684",
    "user": "https://github.com/saraedum"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,26 @@
+There is a problem with the normalization of names of variables which are given automatically for finite fields.
 
+```
+sage: K = GF(4)
+sage: K._factory_data
+(<class 'sage.rings.finite_rings.finite_field_constructor.FiniteFieldFactory'>,
+ (7, 5, 'beta6'),
+ (4, 'z2', x^2 + x + 1, 'givaro', "{'prefix': 'z'}", 2, 2, True), {'prefix': 'z'})
+     ^^^^
+```
+
+Here the name of the variable(s) is not normalized and should be `('z2',)`. Compare with:
+
+```
+sage: L = GF(4, name='z2')
+sage: L._factory_data
+(<class 'sage.rings.finite_rings.finite_field_constructor.FiniteFieldFactory'>,
+ (7, 5, 'beta6'),
+ (4, ('z2',), x^2 + x + 1, 'givaro', '{}', 2, 2, True),
+ {})
+```
+
+By the way, should `K == L`. Currently, it is false.
 
 Author: Xavier Caruso
 
``````




---

archive/issue_comments_408685.json:
```json
{
    "body": "<a id='comment:4'></a>I think it's our policy that changes should come with a doctest. I think `K == L` and `K._factory_data` would be nice doctests.",
    "created_at": "2016-12-20T21:36:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22082#issuecomment-408685",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:4'></a>I think it's our policy that changes should come with a doctest. I think `K == L` and `K._factory_data` would be nice doctests.



---

archive/issue_comments_408686.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-12-20T21:36:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22082#issuecomment-408686",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_408687.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-12-20T21:56:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22082#issuecomment-408687",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_408688.json:
```json
{
    "body": "Changing commit from \"82bf26cb4d5f330dc47a03d912cf38a78993e748\" to \"25f1b168b56b35e7b66b7e3629640a0e8a19b7da\"",
    "created_at": "2016-12-20T21:56:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22082#issuecomment-408688",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "82bf26cb4d5f330dc47a03d912cf38a78993e748" to "25f1b168b56b35e7b66b7e3629640a0e8a19b7da"



---

archive/issue_comments_408689.json:
```json
{
    "body": "Changing commit from \"25f1b168b56b35e7b66b7e3629640a0e8a19b7da\" to \"b2dba6414e7ef7f691b43cb4f90f24f643623c52\"",
    "created_at": "2016-12-20T23:36:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22082#issuecomment-408689",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "25f1b168b56b35e7b66b7e3629640a0e8a19b7da" to "b2dba6414e7ef7f691b43cb4f90f24f643623c52"



---

archive/issue_comments_408690.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-12-20T23:36:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22082#issuecomment-408690",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_408691.json:
```json
{
    "body": "<a id='comment:7'></a>I have two comments:\n\n1) The following should definitely NOT return True:\n\n```\nsage: GF(17^180) == GF(17^180, 'z180')\nFalse\n```\nThe first syntax (which was enabled \"on popular request\", but is too seductive in my opinion) creates the finite field as a subfield of an algebraic closure, which is expensive because it has to create a system of compatible (pseudo-Conway) polynomials.  Compare the following timings:\n\n```\nsage: %time GF(17^180, 'z180')\nCPU times: user 64 ms, sys: 8 ms, total: 72 ms\nWall time: 71 ms\nFinite Field in a of size 17^180\nsage: %time GF(17^180)\nCPU times: user 8.62 s, sys: 36 ms, total: 8.66 s\nWall time: 8.66 s\nFinite Field in z180 of size 17^180\n```\n\n2) The `prefix` parameter was introduced to store the name used for (subfields of) an algebraic closure.  I don't think it should be added to every finite field regardless of whether it is embedded in an algebraic closure.\n\nI propose to limit this ticket to just normalising the variable (with a doctest showing the correct factory data), nothing else.",
    "created_at": "2016-12-21T09:36:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22082#issuecomment-408691",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:7'></a>I have two comments:

1) The following should definitely NOT return True:

```
sage: GF(17^180) == GF(17^180, 'z180')
False
```
The first syntax (which was enabled "on popular request", but is too seductive in my opinion) creates the finite field as a subfield of an algebraic closure, which is expensive because it has to create a system of compatible (pseudo-Conway) polynomials.  Compare the following timings:

```
sage: %time GF(17^180, 'z180')
CPU times: user 64 ms, sys: 8 ms, total: 72 ms
Wall time: 71 ms
Finite Field in a of size 17^180
sage: %time GF(17^180)
CPU times: user 8.62 s, sys: 36 ms, total: 8.66 s
Wall time: 8.66 s
Finite Field in z180 of size 17^180
```

2) The `prefix` parameter was introduced to store the name used for (subfields of) an algebraic closure.  I don't think it should be added to every finite field regardless of whether it is embedded in an algebraic closure.

I propose to limit this ticket to just normalising the variable (with a doctest showing the correct factory data), nothing else.



---

archive/issue_comments_408692.json:
```json
{
    "body": "<a id='comment:9'></a>Hello,\n\nShould we go back to commit [82bf26c](https://git.sagemath.org/sage.git/commit?id=82bf26cb4d5f330dc47a03d912cf38a78993e748/) with a doctest testing `._factory_data` then ?\n\nEdouard",
    "created_at": "2017-06-05T23:22:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22082#issuecomment-408692",
    "user": "https://trac.sagemath.org/admin/accounts/users/erousseau"
}
```

<a id='comment:9'></a>Hello,

Should we go back to commit [82bf26c](https://git.sagemath.org/sage.git/commit?id=82bf26cb4d5f330dc47a03d912cf38a78993e748/) with a doctest testing `._factory_data` then ?

Edouard



---

archive/issue_comments_408693.json:
```json
{
    "body": "<a id='comment:11'></a>erousseau, if you have a proposal for a fix, I think that you can just go ahead and push it to this ticket. The old implementation is not lost, so we could always go back if we wanted to.",
    "created_at": "2017-06-06T21:59:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22082#issuecomment-408693",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:11'></a>erousseau, if you have a proposal for a fix, I think that you can just go ahead and push it to this ticket. The old implementation is not lost, so we could always go back if we wanted to.



---

archive/issue_comments_408694.json:
```json
{
    "body": "Changing keywords from \"name normalization, finite fields\" to \"name normalization, finite fields, sd86.5\".",
    "created_at": "2017-06-06T21:59:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22082#issuecomment-408694",
    "user": "https://github.com/saraedum"
}
```

Changing keywords from "name normalization, finite fields" to "name normalization, finite fields, sd86.5".



---

archive/issue_comments_408695.json:
```json
{
    "body": "Changing commit from \"b2dba6414e7ef7f691b43cb4f90f24f643623c52\" to \"c7870d3c8c5e1822176e73d708640fa0b86b6029\"",
    "created_at": "2017-06-08T19:57:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22082#issuecomment-408695",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "b2dba6414e7ef7f691b43cb4f90f24f643623c52" to "c7870d3c8c5e1822176e73d708640fa0b86b6029"



---

archive/issue_comments_408696.json:
```json
{
    "body": "<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-06-08T19:57:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22082#issuecomment-408696",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_408697.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-06-08T19:59:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22082#issuecomment-408697",
    "user": "https://github.com/xcaruso"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_408698.json:
```json
{
    "body": "<a id='comment:14'></a>Fine, I agree for limiting this ticket to name normalization.",
    "created_at": "2017-06-08T19:59:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22082#issuecomment-408698",
    "user": "https://github.com/xcaruso"
}
```

<a id='comment:14'></a>Fine, I agree for limiting this ticket to name normalization.



---

archive/issue_comments_408699.json:
```json
{
    "body": "<a id='comment:15'></a>`(7, 5, 'beta6')` should be replaced by `...`.",
    "created_at": "2017-06-09T00:35:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22082#issuecomment-408699",
    "user": "https://github.com/roed314"
}
```

<a id='comment:15'></a>`(7, 5, 'beta6')` should be replaced by `...`.



---

archive/issue_comments_408700.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-06-09T00:35:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22082#issuecomment-408700",
    "user": "https://github.com/roed314"
}
```

Changing status from needs_review to needs_work.
