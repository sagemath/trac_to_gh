# Issue 22611: Replace _sage_doc_ by a __doc__ descriptor

archive/issues_022374.json:
```json
{
    "body": "Currently, the method `_sage_doc_` is used to implement custom documentation for instances of a class. Such a use case makes sense, but it should be implemented as the `__doc__` attribute instead of the Sage-specific `_sage_doc_`.\n\nI tried various ways of implementing this and I found several Cython bugs along the way. The current solution is not the cleanest, but it works in all cases (Cython and Python, extension types and normal classes).\n\nIn the cases where `_sage_doc_` was implemented for a base class, this patch requires adding `@instancedoc` to every subclass. This is because Python never inherits the `__doc__` attribute. There is a way around this using a metaclass, but I avoided that because metaclasses have their own problems (see #21681).\n\n**CC:**  @hivert @nthiery\n\n**Keywords:** days85\n\n**Branch/Commit:** [5fe7cb01a8cd117ac6754c8301fb5ddf94d82813](https://github.com/sagemath/sagetrac-mirror/commit/5fe7cb01a8cd117ac6754c8301fb5ddf94d82813)\n\n**Reviewer:** Erik Bray\n\n**Author:** Jeroen Demeyer\n\nIssue created by migration from https://trac.sagemath.org/ticket/22611\n\n",
    "closed_at": "2017-03-29T16:51:16Z",
    "created_at": "2017-03-15T20:20:27Z",
    "labels": [
        "component: documentation",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.6",
    "title": "Replace _sage_doc_ by a __doc__ descriptor",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22611",
    "user": "https://github.com/jdemeyer"
}
```
Currently, the method `_sage_doc_` is used to implement custom documentation for instances of a class. Such a use case makes sense, but it should be implemented as the `__doc__` attribute instead of the Sage-specific `_sage_doc_`.

I tried various ways of implementing this and I found several Cython bugs along the way. The current solution is not the cleanest, but it works in all cases (Cython and Python, extension types and normal classes).

In the cases where `_sage_doc_` was implemented for a base class, this patch requires adding `@instancedoc` to every subclass. This is because Python never inherits the `__doc__` attribute. There is a way around this using a metaclass, but I avoided that because metaclasses have their own problems (see #21681).

**CC:**  @hivert @nthiery

**Keywords:** days85

**Branch/Commit:** [5fe7cb01a8cd117ac6754c8301fb5ddf94d82813](https://github.com/sagemath/sagetrac-mirror/commit/5fe7cb01a8cd117ac6754c8301fb5ddf94d82813)

**Reviewer:** Erik Bray

**Author:** Jeroen Demeyer

Issue created by migration from https://trac.sagemath.org/ticket/22611





---

archive/issue_comments_339370.json:
```json
{
    "body": "**Changing keywords** from \"\" to \"days85\".",
    "created_at": "2017-03-17T09:06:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22611#issuecomment-339370",
    "user": "https://github.com/jdemeyer"
}
```

**Changing keywords** from "" to "days85".



---

archive/issue_comments_339371.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,3 +1,5 @@\n The method `_sage_doc_` is used to have custom documentation for instances of a class. Such a use case makes sense, but it should be implemented as the `__doc__` attribute instead of the Sage-specific `_sage_doc_`.\n \n This is easy for Python classes, but it might be problematic for `cdef class`es.\n+\n+Unfortunately, this hits some Cython bugs involving `@`decorators.\n``````\n",
    "created_at": "2017-03-17T09:06:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22611#issuecomment-339371",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,3 +1,5 @@
 The method `_sage_doc_` is used to have custom documentation for instances of a class. Such a use case makes sense, but it should be implemented as the `__doc__` attribute instead of the Sage-specific `_sage_doc_`.
 
 This is easy for Python classes, but it might be problematic for `cdef class`es.
+
+Unfortunately, this hits some Cython bugs involving `@`decorators.
``````




---

archive/issue_comments_339372.json:
```json
{
    "body": "**Branch:** [u/jdemeyer/ticket/22611](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/22611)",
    "created_at": "2017-03-17T21:45:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22611#issuecomment-339372",
    "user": "https://github.com/jdemeyer"
}
```

**Branch:** [u/jdemeyer/ticket/22611](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/22611)



---

archive/issue_comments_339373.json:
```json
{
    "body": "**Commit:** [326465738e5a563ebffc86196f400829650cee63](https://github.com/sagemath/sagetrac-mirror/commit/326465738e5a563ebffc86196f400829650cee63)",
    "created_at": "2017-03-17T21:46:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22611#issuecomment-339373",
    "user": "https://github.com/jdemeyer"
}
```

**Commit:** [326465738e5a563ebffc86196f400829650cee63](https://github.com/sagemath/sagetrac-mirror/commit/326465738e5a563ebffc86196f400829650cee63)



---

archive/issue_events_205571.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-03-17T21:46:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22611",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22611#event-205571"
}
```



---

archive/issue_comments_339374.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,5 +1,3 @@\n The method `_sage_doc_` is used to have custom documentation for instances of a class. Such a use case makes sense, but it should be implemented as the `__doc__` attribute instead of the Sage-specific `_sage_doc_`.\n \n-This is easy for Python classes, but it might be problematic for `cdef class`es.\n-\n-Unfortunately, this hits some Cython bugs involving `@`decorators.\n+I tried various ways of implementing this and I was various Cython bugs along the way. The current solution is not the cleanest, but it works in all cases.\n``````\n",
    "created_at": "2017-03-17T21:46:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22611#issuecomment-339374",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,5 +1,3 @@
 The method `_sage_doc_` is used to have custom documentation for instances of a class. Such a use case makes sense, but it should be implemented as the `__doc__` attribute instead of the Sage-specific `_sage_doc_`.
 
-This is easy for Python classes, but it might be problematic for `cdef class`es.
-
-Unfortunately, this hits some Cython bugs involving `@`decorators.
+I tried various ways of implementing this and I was various Cython bugs along the way. The current solution is not the cleanest, but it works in all cases.
``````




---

archive/issue_comments_339375.json:
```json
{
    "body": "<a id='comment:3'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/326465738e5a563ebffc86196f400829650cee63\">3264657</a></td><td><code>Replace `_sage_doc_` by a `__doc__` descriptor</code></td></tr></table>\n",
    "created_at": "2017-03-17T21:46:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22611#issuecomment-339375",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:3'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/326465738e5a563ebffc86196f400829650cee63">3264657</a></td><td><code>Replace `_sage_doc_` by a `__doc__` descriptor</code></td></tr></table>




---

archive/issue_comments_339376.json:
```json
{
    "body": "<a id='comment:4'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fa42d8eb1966a7e1ade67bb40b42a80bb04059b1\">fa42d8e</a></td><td><code>Replace `_sage_doc_` by a `__doc__` descriptor</code></td></tr></table>\n",
    "created_at": "2017-03-17T23:08:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22611#issuecomment-339376",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fa42d8eb1966a7e1ade67bb40b42a80bb04059b1">fa42d8e</a></td><td><code>Replace `_sage_doc_` by a `__doc__` descriptor</code></td></tr></table>




---

archive/issue_comments_339377.json:
```json
{
    "body": "**Changing commit** from \"[326465738e5a563ebffc86196f400829650cee63](https://github.com/sagemath/sagetrac-mirror/commit/326465738e5a563ebffc86196f400829650cee63)\" to \"[fa42d8eb1966a7e1ade67bb40b42a80bb04059b1](https://github.com/sagemath/sagetrac-mirror/commit/fa42d8eb1966a7e1ade67bb40b42a80bb04059b1)\".",
    "created_at": "2017-03-17T23:08:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22611#issuecomment-339377",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[326465738e5a563ebffc86196f400829650cee63](https://github.com/sagemath/sagetrac-mirror/commit/326465738e5a563ebffc86196f400829650cee63)" to "[fa42d8eb1966a7e1ade67bb40b42a80bb04059b1](https://github.com/sagemath/sagetrac-mirror/commit/fa42d8eb1966a7e1ade67bb40b42a80bb04059b1)".



---

archive/issue_comments_339378.json:
```json
{
    "body": "<a id='comment:5'></a>\nThere was an issue building the docs due to `src/sage/parallel/decorate.py`. I did not understand the problem but I fixed it anyway with\n\n```diff\ndiff --git a/src/sage/parallel/decorate.py b/src/sage/parallel/decorate.py\nindex ebc06e2..3305724 100644\n--- a/src/sage/parallel/decorate.py\n+++ b/src/sage/parallel/decorate.py\n@@ -284,8 +287,7 @@ for a in args[0]))\n             sage: sage_getdoc(p(f))\n             'Test docstring\\n'\n         \"\"\"\n-        from sage.misc.sageinspect import sage_getdoc\n-        return sage_getdoc(self.func)\n+        return self.func.__doc__\n \n \n def parallel(p_iter='fork', ncpus=None, **kwds):\n```",
    "created_at": "2017-03-18T06:35:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22611#issuecomment-339378",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:5'></a>
There was an issue building the docs due to `src/sage/parallel/decorate.py`. I did not understand the problem but I fixed it anyway with

```diff
diff --git a/src/sage/parallel/decorate.py b/src/sage/parallel/decorate.py
index ebc06e2..3305724 100644
--- a/src/sage/parallel/decorate.py
+++ b/src/sage/parallel/decorate.py
@@ -284,8 +287,7 @@ for a in args[0]))
             sage: sage_getdoc(p(f))
             'Test docstring\n'
         """
-        from sage.misc.sageinspect import sage_getdoc
-        return sage_getdoc(self.func)
+        return self.func.__doc__
 
 
 def parallel(p_iter='fork', ncpus=None, **kwds):
```



---

archive/issue_comments_339379.json:
```json
{
    "body": "<a id='comment:6'></a>\nIn ticket description: `and I was various Cython bugs along the way`!?",
    "created_at": "2017-03-18T09:46:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22611#issuecomment-339379",
    "user": "https://github.com/videlec"
}
```

<a id='comment:6'></a>
In ticket description: `and I was various Cython bugs along the way`!?



---

archive/issue_comments_339380.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n-The method `_sage_doc_` is used to have custom documentation for instances of a class. Such a use case makes sense, but it should be implemented as the `__doc__` attribute instead of the Sage-specific `_sage_doc_`.\n+Currently, the method `_sage_doc_` is used to implement custom documentation for instances of a class. Such a use case makes sense, but it should be implemented as the `__doc__` attribute instead of the Sage-specific `_sage_doc_`.\n \n-I tried various ways of implementing this and I was various Cython bugs along the way. The current solution is not the cleanest, but it works in all cases.\n+I tried various ways of implementing this and I found several Cython bugs along the way. The current solution is not the cleanest, but it works in all cases (Cython and Python, extension types and normal classes).\n``````\n",
    "created_at": "2017-03-18T09:52:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22611#issuecomment-339380",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
-The method `_sage_doc_` is used to have custom documentation for instances of a class. Such a use case makes sense, but it should be implemented as the `__doc__` attribute instead of the Sage-specific `_sage_doc_`.
+Currently, the method `_sage_doc_` is used to implement custom documentation for instances of a class. Such a use case makes sense, but it should be implemented as the `__doc__` attribute instead of the Sage-specific `_sage_doc_`.
 
-I tried various ways of implementing this and I was various Cython bugs along the way. The current solution is not the cleanest, but it works in all cases.
+I tried various ways of implementing this and I found several Cython bugs along the way. The current solution is not the cleanest, but it works in all cases (Cython and Python, extension types and normal classes).
``````




---

archive/issue_comments_339381.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,3 +1,5 @@\n Currently, the method `_sage_doc_` is used to implement custom documentation for instances of a class. Such a use case makes sense, but it should be implemented as the `__doc__` attribute instead of the Sage-specific `_sage_doc_`.\n \n I tried various ways of implementing this and I found several Cython bugs along the way. The current solution is not the cleanest, but it works in all cases (Cython and Python, extension types and normal classes).\n+\n+In the cases where `_sage_doc_` was implemented for a base class, this patch requires adding `@InstanceDoc` to every subclass. This is because Python never inherits the `__doc__` attribute. There is a way around this using a metaclass, but I avoided that because metaclasses have their own problems (see #21681).\n``````\n",
    "created_at": "2017-03-20T13:20:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22611#issuecomment-339381",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,3 +1,5 @@
 Currently, the method `_sage_doc_` is used to implement custom documentation for instances of a class. Such a use case makes sense, but it should be implemented as the `__doc__` attribute instead of the Sage-specific `_sage_doc_`.
 
 I tried various ways of implementing this and I found several Cython bugs along the way. The current solution is not the cleanest, but it works in all cases (Cython and Python, extension types and normal classes).
+
+In the cases where `_sage_doc_` was implemented for a base class, this patch requires adding `@InstanceDoc` to every subclass. This is because Python never inherits the `__doc__` attribute. There is a way around this using a metaclass, but I avoided that because metaclasses have their own problems (see #21681).
``````




---

archive/issue_comments_339382.json:
```json
{
    "body": "**Changing commit** from \"[fa42d8eb1966a7e1ade67bb40b42a80bb04059b1](https://github.com/sagemath/sagetrac-mirror/commit/fa42d8eb1966a7e1ade67bb40b42a80bb04059b1)\" to \"[5eabe46ca0f929e8e09f0b90e295a0300afe3750](https://github.com/sagemath/sagetrac-mirror/commit/5eabe46ca0f929e8e09f0b90e295a0300afe3750)\".",
    "created_at": "2017-03-21T09:52:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22611#issuecomment-339382",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[fa42d8eb1966a7e1ade67bb40b42a80bb04059b1](https://github.com/sagemath/sagetrac-mirror/commit/fa42d8eb1966a7e1ade67bb40b42a80bb04059b1)" to "[5eabe46ca0f929e8e09f0b90e295a0300afe3750](https://github.com/sagemath/sagetrac-mirror/commit/5eabe46ca0f929e8e09f0b90e295a0300afe3750)".



---

archive/issue_comments_339383.json:
```json
{
    "body": "<a id='comment:9'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5eabe46ca0f929e8e09f0b90e295a0300afe3750\">5eabe46</a></td><td><code>Make coverage script happy</code></td></tr></table>\n",
    "created_at": "2017-03-21T09:52:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22611#issuecomment-339383",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5eabe46ca0f929e8e09f0b90e295a0300afe3750">5eabe46</a></td><td><code>Make coverage script happy</code></td></tr></table>




---

archive/issue_comments_339384.json:
```json
{
    "body": "<a id='comment:10'></a>\nThis is just a stupid comment, but I'm curious about the naming--why `@InstanceDoc` and not `@instance_doc`?  For whatever reason it's more common to name decorators with underscores instead of camel case (so much so that people will even go against the camel case convention for classes in cases where a decorator is implemented as a class).\n\nThen again, maybe the existing naming nicely calls attention to the fact that this is intended as a class decorator.",
    "created_at": "2017-03-22T13:27:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22611#issuecomment-339384",
    "user": "https://github.com/embray"
}
```

<a id='comment:10'></a>
This is just a stupid comment, but I'm curious about the naming--why `@InstanceDoc` and not `@instance_doc`?  For whatever reason it's more common to name decorators with underscores instead of camel case (so much so that people will even go against the camel case convention for classes in cases where a decorator is implemented as a class).

Then again, maybe the existing naming nicely calls attention to the fact that this is intended as a class decorator.



---

archive/issue_comments_339385.json:
```json
{
    "body": "<a id='comment:11'></a>\nWhat happens if `_instancedoc_` is not defined?  Will Cython make sure an `AttributeError` is raised in this case?\n\nI think at the very least there should be a clear error message that `_instancedoc_` must be defined (including on base classes that may not have a sensible `_instancedoc_`, in which case it might be good if the descriptor also handled `NotImplemented` errors).",
    "created_at": "2017-03-22T13:36:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22611#issuecomment-339385",
    "user": "https://github.com/embray"
}
```

<a id='comment:11'></a>
What happens if `_instancedoc_` is not defined?  Will Cython make sure an `AttributeError` is raised in this case?

I think at the very least there should be a clear error message that `_instancedoc_` must be defined (including on base classes that may not have a sensible `_instancedoc_`, in which case it might be good if the descriptor also handled `NotImplemented` errors).



---

archive/issue_comments_339386.json:
```json
{
    "body": "**Reviewer:** Erik Bray",
    "created_at": "2017-03-22T13:48:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22611#issuecomment-339386",
    "user": "https://github.com/embray"
}
```

**Reviewer:** Erik Bray



---

archive/issue_comments_339387.json:
```json
{
    "body": "<a id='comment:12'></a>\nLGTM otherwise. Clever way to abuse the Python internals a bit, though I can't see anything inherently wrong with it, since tp_doc is suppose to be able to be NULL.",
    "created_at": "2017-03-22T13:48:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22611#issuecomment-339387",
    "user": "https://github.com/embray"
}
```

<a id='comment:12'></a>
LGTM otherwise. Clever way to abuse the Python internals a bit, though I can't see anything inherently wrong with it, since tp_doc is suppose to be able to be NULL.



---

archive/issue_comments_339388.json:
```json
{
    "body": "<a id='comment:13'></a>\nReplying to [embray](#comment%3A12):\n> LGTM otherwise. Clever way to abuse the Python internals a bit\n\n\nLike I say on the ticket description, this is the only way to make it work for all classes. Any pure Python implementation wouldn't work for extension types.",
    "created_at": "2017-03-22T15:11:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22611#issuecomment-339388",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:13'></a>
Replying to [embray](#comment%3A12):
> LGTM otherwise. Clever way to abuse the Python internals a bit


Like I say on the ticket description, this is the only way to make it work for all classes. Any pure Python implementation wouldn't work for extension types.



---

archive/issue_events_205572.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-03-22T15:12:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22611",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22611#event-205572"
}
```



---

archive/issue_events_205573.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-03-22T15:12:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22611",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22611#event-205573"
}
```



---

archive/issue_comments_339389.json:
```json
{
    "body": "<a id='comment:14'></a>\nReplying to [embray](#comment%3A11):\n> What happens if `_instancedoc_` is not defined?  Will Cython make sure an `AttributeError` is raised in this case?\n\n\nYes, `AttributeError` works the same way in Cython.",
    "created_at": "2017-03-22T15:12:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22611#issuecomment-339389",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:14'></a>
Replying to [embray](#comment%3A11):
> What happens if `_instancedoc_` is not defined?  Will Cython make sure an `AttributeError` is raised in this case?


Yes, `AttributeError` works the same way in Cython.



---

archive/issue_comments_339390.json:
```json
{
    "body": "<a id='comment:15'></a>\nReplying to [embray](#comment%3A11):\n> What happens if `_instancedoc_` is not defined?  Will Cython make sure an `AttributeError` is raised in this case?\n> \n> I think at the very least there should be a clear error message that `_instancedoc_` must be defined\n\n\nYou mean an error which is not just `AttributeError: 'foo' object has no attribute '_instancedoc_'`?",
    "created_at": "2017-03-22T15:15:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22611#issuecomment-339390",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:15'></a>
Replying to [embray](#comment%3A11):
> What happens if `_instancedoc_` is not defined?  Will Cython make sure an `AttributeError` is raised in this case?
> 
> I think at the very least there should be a clear error message that `_instancedoc_` must be defined


You mean an error which is not just `AttributeError: 'foo' object has no attribute '_instancedoc_'`?



---

archive/issue_comments_339391.json:
```json
{
    "body": "<a id='comment:16'></a>\nRight.  For example, in classes with the `ABCMeta` metaclass, if there are any unimplemented `abstractproperty` or `abstractmethod`, trying to instantiate the class results in:\n\n```\nTypeError: Can't instantiate abstract class A with abstract methods foo\n```\n\nThis is a slightly different case of course, since it's an error that would occur at class definition time.  I was just using this as an example of a clearer error message.",
    "created_at": "2017-03-22T16:04:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22611#issuecomment-339391",
    "user": "https://github.com/embray"
}
```

<a id='comment:16'></a>
Right.  For example, in classes with the `ABCMeta` metaclass, if there are any unimplemented `abstractproperty` or `abstractmethod`, trying to instantiate the class results in:

```
TypeError: Can't instantiate abstract class A with abstract methods foo
```

This is a slightly different case of course, since it's an error that would occur at class definition time.  I was just using this as an example of a clearer error message.



---

archive/issue_comments_339392.json:
```json
{
    "body": "<a id='comment:17'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f92c25856bd33edfe0b157f9504c2d5a73d4caac\">f92c258</a></td><td><code>Doctest an example where `_instancedoc_` is not defined</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/676a80428a980b326a936a42759ff3ba88398f27\">676a804</a></td><td><code>Rename InstanceDoc -> instancedoc</code></td></tr></table>\n",
    "created_at": "2017-03-22T16:12:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22611#issuecomment-339392",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:17'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f92c25856bd33edfe0b157f9504c2d5a73d4caac">f92c258</a></td><td><code>Doctest an example where `_instancedoc_` is not defined</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/676a80428a980b326a936a42759ff3ba88398f27">676a804</a></td><td><code>Rename InstanceDoc -> instancedoc</code></td></tr></table>




---

archive/issue_comments_339393.json:
```json
{
    "body": "**Changing commit** from \"[5eabe46ca0f929e8e09f0b90e295a0300afe3750](https://github.com/sagemath/sagetrac-mirror/commit/5eabe46ca0f929e8e09f0b90e295a0300afe3750)\" to \"[676a80428a980b326a936a42759ff3ba88398f27](https://github.com/sagemath/sagetrac-mirror/commit/676a80428a980b326a936a42759ff3ba88398f27)\".",
    "created_at": "2017-03-22T16:12:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22611#issuecomment-339393",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[5eabe46ca0f929e8e09f0b90e295a0300afe3750](https://github.com/sagemath/sagetrac-mirror/commit/5eabe46ca0f929e8e09f0b90e295a0300afe3750)" to "[676a80428a980b326a936a42759ff3ba88398f27](https://github.com/sagemath/sagetrac-mirror/commit/676a80428a980b326a936a42759ff3ba88398f27)".



---

archive/issue_comments_339394.json:
```json
{
    "body": "<a id='comment:18'></a>\nI replaced `InstanceDoc` with `instancedoc` (I didn't use `instance_doc` just because the method name `_instancedoc_` doesn't have an underscore either. And anyway, Python uses `staticmethod` and not `static_method`.)",
    "created_at": "2017-03-22T16:14:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22611#issuecomment-339394",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:18'></a>
I replaced `InstanceDoc` with `instancedoc` (I didn't use `instance_doc` just because the method name `_instancedoc_` doesn't have an underscore either. And anyway, Python uses `staticmethod` and not `static_method`.)



---

archive/issue_comments_339395.json:
```json
{
    "body": "<a id='comment:19'></a>\nI still don't think the `AttributeError` is very useful, especially considering that you're getting an exception from a builtin module and can't see in the traceback what's actually causing it.  Of course, if one is implementing a class using `@instancedoc` this should be expected, but it still might seem mysterious, I think, compared to a slightly customized message (it could still be an `AttributeError`, though `TypeError` is used more commonly for cases where an expected interface is not found--e.g. `len()` on an object with no `__len__`.).",
    "created_at": "2017-03-22T16:21:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22611#issuecomment-339395",
    "user": "https://github.com/embray"
}
```

<a id='comment:19'></a>
I still don't think the `AttributeError` is very useful, especially considering that you're getting an exception from a builtin module and can't see in the traceback what's actually causing it.  Of course, if one is implementing a class using `@instancedoc` this should be expected, but it still might seem mysterious, I think, compared to a slightly customized message (it could still be an `AttributeError`, though `TypeError` is used more commonly for cases where an expected interface is not found--e.g. `len()` on an object with no `__len__`.).



---

archive/issue_comments_339396.json:
```json
{
    "body": "<a id='comment:20'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5fe7cb01a8cd117ac6754c8301fb5ddf94d82813\">5fe7cb0</a></td><td><code>Change exception message for missing _instancedoc_</code></td></tr></table>\n",
    "created_at": "2017-03-23T10:17:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22611#issuecomment-339396",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:20'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5fe7cb01a8cd117ac6754c8301fb5ddf94d82813">5fe7cb0</a></td><td><code>Change exception message for missing _instancedoc_</code></td></tr></table>




---

archive/issue_comments_339397.json:
```json
{
    "body": "**Changing commit** from \"[676a80428a980b326a936a42759ff3ba88398f27](https://github.com/sagemath/sagetrac-mirror/commit/676a80428a980b326a936a42759ff3ba88398f27)\" to \"[5fe7cb01a8cd117ac6754c8301fb5ddf94d82813](https://github.com/sagemath/sagetrac-mirror/commit/5fe7cb01a8cd117ac6754c8301fb5ddf94d82813)\".",
    "created_at": "2017-03-23T10:17:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22611#issuecomment-339397",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[676a80428a980b326a936a42759ff3ba88398f27](https://github.com/sagemath/sagetrac-mirror/commit/676a80428a980b326a936a42759ff3ba88398f27)" to "[5fe7cb01a8cd117ac6754c8301fb5ddf94d82813](https://github.com/sagemath/sagetrac-mirror/commit/5fe7cb01a8cd117ac6754c8301fb5ddf94d82813)".



---

archive/issue_comments_339398.json:
```json
{
    "body": "<a id='comment:21'></a>\nHere you go...",
    "created_at": "2017-03-23T10:21:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22611#issuecomment-339398",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:21'></a>
Here you go...



---

archive/issue_events_205574.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-03-23T10:21:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22611",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22611#event-205574"
}
```



---

archive/issue_events_205575.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-03-23T10:21:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22611",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22611#event-205575"
}
```



---

archive/issue_comments_339399.json:
```json
{
    "body": "<a id='comment:22'></a>\nGreat, I think that's a lot nicer!  Thanks for this--honestly this is so useful I think some form of this should be implemented in Python.  I might suggest that, actually, since I see the question of per-instance docstrings come up from time to time, with no good solution.  If some kind of `__instancedoc__` special method were built into Python it would obviate the need for the special descriptor or the decorator.",
    "created_at": "2017-03-23T11:05:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22611#issuecomment-339399",
    "user": "https://github.com/embray"
}
```

<a id='comment:22'></a>
Great, I think that's a lot nicer!  Thanks for this--honestly this is so useful I think some form of this should be implemented in Python.  I might suggest that, actually, since I see the question of per-instance docstrings come up from time to time, with no good solution.  If some kind of `__instancedoc__` special method were built into Python it would obviate the need for the special descriptor or the decorator.



---

archive/issue_events_205576.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-03-23T11:05:51Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22611",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22611#event-205576"
}
```



---

archive/issue_events_205577.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-03-23T11:05:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22611",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22611#event-205577"
}
```



---

archive/issue_comments_339400.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -2,4 +2,4 @@\n \n I tried various ways of implementing this and I found several Cython bugs along the way. The current solution is not the cleanest, but it works in all cases (Cython and Python, extension types and normal classes).\n \n-In the cases where `_sage_doc_` was implemented for a base class, this patch requires adding `@InstanceDoc` to every subclass. This is because Python never inherits the `__doc__` attribute. There is a way around this using a metaclass, but I avoided that because metaclasses have their own problems (see #21681).\n+In the cases where `_sage_doc_` was implemented for a base class, this patch requires adding `@instancedoc` to every subclass. This is because Python never inherits the `__doc__` attribute. There is a way around this using a metaclass, but I avoided that because metaclasses have their own problems (see #21681).\n``````\n",
    "created_at": "2017-03-23T20:36:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22611#issuecomment-339400",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -2,4 +2,4 @@
 
 I tried various ways of implementing this and I found several Cython bugs along the way. The current solution is not the cleanest, but it works in all cases (Cython and Python, extension types and normal classes).
 
-In the cases where `_sage_doc_` was implemented for a base class, this patch requires adding `@InstanceDoc` to every subclass. This is because Python never inherits the `__doc__` attribute. There is a way around this using a metaclass, but I avoided that because metaclasses have their own problems (see #21681).
+In the cases where `_sage_doc_` was implemented for a base class, this patch requires adding `@instancedoc` to every subclass. This is because Python never inherits the `__doc__` attribute. There is a way around this using a metaclass, but I avoided that because metaclasses have their own problems (see #21681).
``````




---

archive/issue_comments_339401.json:
```json
{
    "body": "<a id='comment:24'></a>\nThanks!",
    "created_at": "2017-03-23T20:36:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22611#issuecomment-339401",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:24'></a>
Thanks!



---

archive/issue_comments_339402.json:
```json
{
    "body": "**Changing branch** from \"[u/jdemeyer/ticket/22611](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/22611)\" to \"[5fe7cb01a8cd117ac6754c8301fb5ddf94d82813](https://github.com/sagemath/sagetrac-mirror/commit/5fe7cb01a8cd117ac6754c8301fb5ddf94d82813)\".",
    "created_at": "2017-03-29T16:51:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22611#issuecomment-339402",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/jdemeyer/ticket/22611](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/22611)" to "[5fe7cb01a8cd117ac6754c8301fb5ddf94d82813](https://github.com/sagemath/sagetrac-mirror/commit/5fe7cb01a8cd117ac6754c8301fb5ddf94d82813)".



---

archive/issue_events_205578.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-03-29T16:51:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22611",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22611#event-205578"
}
```



---

archive/issue_events_205579.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-03-29T16:51:16Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/22611",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22611#event-205579"
}
```
