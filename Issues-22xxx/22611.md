# Issue 22611: Replace _sage_doc_ by a __doc__ descriptor

archive/issues_022374.json:
```json
{
    "assignees": [],
    "body": "<div id=\"comment:0\"></div>\n\nCurrently, the method `_sage_doc_` is used to implement custom documentation for instances of a class. Such a use case makes sense, but it should be implemented as the `__doc__` attribute instead of the Sage-specific `_sage_doc_`.\n\nI tried various ways of implementing this and I found several Cython bugs along the way. The current solution is not the cleanest, but it works in all cases (Cython and Python, extension types and normal classes).\n\nIn the cases where `_sage_doc_` was implemented for a base class, this patch requires adding `@instancedoc` to every subclass. This is because Python never inherits the `__doc__` attribute. There is a way around this using a metaclass, but I avoided that because metaclasses have their own problems (see #21681).\n\nCC:  @hivert @nthiery\n\nComponent: **documentation**\n\nKeywords: **days85**\n\nAuthor: **Jeroen Demeyer**\n\nBranch/Commit: **[`5fe7cb0`](https://github.com/sagemath/sagetrac-mirror/commit/5fe7cb01a8cd117ac6754c8301fb5ddf94d82813)**\n\nReviewer: **Erik Bray**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/22611_\n\n",
    "closed_at": "2017-03-29T16:51:16Z",
    "created_at": "2017-03-15T20:20:27Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20documentation",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-7.6",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Replace _sage_doc_ by a __doc__ descriptor",
    "type": "issue",
    "updated_at": "2017-03-29T16:51:16Z",
    "url": "https://github.com/sagemath/sage/issues/22611",
    "user": "https://github.com/jdemeyer"
}
```
<div id="comment:0"></div>

Currently, the method `_sage_doc_` is used to implement custom documentation for instances of a class. Such a use case makes sense, but it should be implemented as the `__doc__` attribute instead of the Sage-specific `_sage_doc_`.

I tried various ways of implementing this and I found several Cython bugs along the way. The current solution is not the cleanest, but it works in all cases (Cython and Python, extension types and normal classes).

In the cases where `_sage_doc_` was implemented for a base class, this patch requires adding `@instancedoc` to every subclass. This is because Python never inherits the `__doc__` attribute. There is a way around this using a metaclass, but I avoided that because metaclasses have their own problems (see #21681).

CC:  @hivert @nthiery

Component: **documentation**

Keywords: **days85**

Author: **Jeroen Demeyer**

Branch/Commit: **[`5fe7cb0`](https://github.com/sagemath/sagetrac-mirror/commit/5fe7cb01a8cd117ac6754c8301fb5ddf94d82813)**

Reviewer: **Erik Bray**

_Issue created by migration from https://trac.sagemath.org/ticket/22611_





---

archive/issue_events_313069.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-03-15T20:20:27Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/22611",
    "milestone_number": null,
    "milestone_title": "sage-7.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22611#event-313069"
}
```



---

archive/issue_events_313070.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-03-15T20:20:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22611",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20documentation",
    "label_color": "0075ca",
    "label_name": "c: documentation",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22611#event-313070"
}
```



---

archive/issue_events_313071.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-03-15T20:20:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22611",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22611#event-313071"
}
```



---

archive/issue_events_313072.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-03-15T20:20:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22611",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22611#event-313072"
}
```



---

archive/issue_comments_335201.json:
```json
{
    "body": "Changed keywords from none to **days85**",
    "created_at": "2017-03-17T09:06:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22611#issuecomment-335201",
    "user": "https://github.com/jdemeyer"
}
```

Changed keywords from none to **days85**



---

archive/issue_comments_335202.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,5 @@\n The method `_sage_doc_` is used to have custom documentation for instances of a class. Such a use case makes sense, but it should be implemented as the `__doc__` attribute instead of the Sage-specific `_sage_doc_`.\n \n This is easy for Python classes, but it might be problematic for `cdef class`es.\n+\n+Unfortunately, this hits some Cython bugs involving `@`decorators.\n``````\n",
    "created_at": "2017-03-17T09:06:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22611#issuecomment-335202",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,5 @@
 The method `_sage_doc_` is used to have custom documentation for instances of a class. Such a use case makes sense, but it should be implemented as the `__doc__` attribute instead of the Sage-specific `_sage_doc_`.
 
 This is easy for Python classes, but it might be problematic for `cdef class`es.
+
+Unfortunately, this hits some Cython bugs involving `@`decorators.
``````




---

archive/issue_comments_335203.json:
```json
{
    "body": "Branch: **[u/jdemeyer/ticket/22611](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/22611)**",
    "created_at": "2017-03-17T21:45:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22611#issuecomment-335203",
    "user": "https://github.com/jdemeyer"
}
```

Branch: **[u/jdemeyer/ticket/22611](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/22611)**



---

archive/issue_comments_335204.json:
```json
{
    "body": "Commit: **[`3264657`](https://github.com/sagemath/sagetrac-mirror/commit/326465738e5a563ebffc86196f400829650cee63)**",
    "created_at": "2017-03-17T21:46:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22611#issuecomment-335204",
    "user": "https://github.com/jdemeyer"
}
```

Commit: **[`3264657`](https://github.com/sagemath/sagetrac-mirror/commit/326465738e5a563ebffc86196f400829650cee63)**



---

archive/issue_events_313073.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-03-17T21:46:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22611",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22611#event-313073"
}
```



---

archive/issue_comments_335205.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,5 +1,3 @@\n The method `_sage_doc_` is used to have custom documentation for instances of a class. Such a use case makes sense, but it should be implemented as the `__doc__` attribute instead of the Sage-specific `_sage_doc_`.\n \n-This is easy for Python classes, but it might be problematic for `cdef class`es.\n-\n-Unfortunately, this hits some Cython bugs involving `@`decorators.\n+I tried various ways of implementing this and I was various Cython bugs along the way. The current solution is not the cleanest, but it works in all cases.\n``````\n",
    "created_at": "2017-03-17T21:46:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22611#issuecomment-335205",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,5 +1,3 @@
 The method `_sage_doc_` is used to have custom documentation for instances of a class. Such a use case makes sense, but it should be implemented as the `__doc__` attribute instead of the Sage-specific `_sage_doc_`.
 
-This is easy for Python classes, but it might be problematic for `cdef class`es.
-
-Unfortunately, this hits some Cython bugs involving `@`decorators.
+I tried various ways of implementing this and I was various Cython bugs along the way. The current solution is not the cleanest, but it works in all cases.
``````




---

archive/issue_comments_335206.json:
```json
{
    "body": "<div id=\"comment:3\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/326465738e5a563ebffc86196f400829650cee63\"><code>3264657</code></a></td><td><code>Replace `_sage_doc_` by a `__doc__` descriptor</code></td></tr></table>\n",
    "created_at": "2017-03-17T21:46:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22611#issuecomment-335206",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:3"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/326465738e5a563ebffc86196f400829650cee63"><code>3264657</code></a></td><td><code>Replace `_sage_doc_` by a `__doc__` descriptor</code></td></tr></table>




---

archive/issue_comments_335207.json:
```json
{
    "body": "<div id=\"comment:4\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fa42d8eb1966a7e1ade67bb40b42a80bb04059b1\"><code>fa42d8e</code></a></td><td><code>Replace `_sage_doc_` by a `__doc__` descriptor</code></td></tr></table>\n",
    "created_at": "2017-03-17T23:08:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22611#issuecomment-335207",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:4"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fa42d8eb1966a7e1ade67bb40b42a80bb04059b1"><code>fa42d8e</code></a></td><td><code>Replace `_sage_doc_` by a `__doc__` descriptor</code></td></tr></table>




---

archive/issue_comments_335208.json:
```json
{
    "body": "Changed commit from **[`3264657`](https://github.com/sagemath/sagetrac-mirror/commit/326465738e5a563ebffc86196f400829650cee63)** to **[`fa42d8e`](https://github.com/sagemath/sagetrac-mirror/commit/fa42d8eb1966a7e1ade67bb40b42a80bb04059b1)**",
    "created_at": "2017-03-17T23:08:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22611#issuecomment-335208",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`3264657`](https://github.com/sagemath/sagetrac-mirror/commit/326465738e5a563ebffc86196f400829650cee63)** to **[`fa42d8e`](https://github.com/sagemath/sagetrac-mirror/commit/fa42d8eb1966a7e1ade67bb40b42a80bb04059b1)**



---

archive/issue_comments_335209.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nThere was an issue building the docs due to `src/sage/parallel/decorate.py`. I did not understand the problem but I fixed it anyway with\n\n```diff\ndiff --git a/src/sage/parallel/decorate.py b/src/sage/parallel/decorate.py\nindex ebc06e2..3305724 100644\n--- a/src/sage/parallel/decorate.py\n+++ b/src/sage/parallel/decorate.py\n@@ -284,8 +287,7 @@ for a in args[0]))\n             sage: sage_getdoc(p(f))\n             'Test docstring\\n'\n         \"\"\"\n-        from sage.misc.sageinspect import sage_getdoc\n-        return sage_getdoc(self.func)\n+        return self.func.__doc__\n \n \n def parallel(p_iter='fork', ncpus=None, **kwds):\n```",
    "created_at": "2017-03-18T06:35:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22611#issuecomment-335209",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:5" align="right">comment:5</div>

There was an issue building the docs due to `src/sage/parallel/decorate.py`. I did not understand the problem but I fixed it anyway with

```diff
diff --git a/src/sage/parallel/decorate.py b/src/sage/parallel/decorate.py
index ebc06e2..3305724 100644
--- a/src/sage/parallel/decorate.py
+++ b/src/sage/parallel/decorate.py
@@ -284,8 +287,7 @@ for a in args[0]))
             sage: sage_getdoc(p(f))
             'Test docstring\n'
         """
-        from sage.misc.sageinspect import sage_getdoc
-        return sage_getdoc(self.func)
+        return self.func.__doc__
 
 
 def parallel(p_iter='fork', ncpus=None, **kwds):
```



---

archive/issue_comments_335210.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nIn ticket description: `and I was various Cython bugs along the way`!?",
    "created_at": "2017-03-18T09:46:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22611#issuecomment-335210",
    "user": "https://github.com/videlec"
}
```

<div id="comment:6" align="right">comment:6</div>

In ticket description: `and I was various Cython bugs along the way`!?



---

archive/issue_comments_335211.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n-The method `_sage_doc_` is used to have custom documentation for instances of a class. Such a use case makes sense, but it should be implemented as the `__doc__` attribute instead of the Sage-specific `_sage_doc_`.\n+Currently, the method `_sage_doc_` is used to implement custom documentation for instances of a class. Such a use case makes sense, but it should be implemented as the `__doc__` attribute instead of the Sage-specific `_sage_doc_`.\n \n-I tried various ways of implementing this and I was various Cython bugs along the way. The current solution is not the cleanest, but it works in all cases.\n+I tried various ways of implementing this and I found several Cython bugs along the way. The current solution is not the cleanest, but it works in all cases (Cython and Python, extension types and normal classes).\n``````\n",
    "created_at": "2017-03-18T09:52:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22611#issuecomment-335211",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
-The method `_sage_doc_` is used to have custom documentation for instances of a class. Such a use case makes sense, but it should be implemented as the `__doc__` attribute instead of the Sage-specific `_sage_doc_`.
+Currently, the method `_sage_doc_` is used to implement custom documentation for instances of a class. Such a use case makes sense, but it should be implemented as the `__doc__` attribute instead of the Sage-specific `_sage_doc_`.
 
-I tried various ways of implementing this and I was various Cython bugs along the way. The current solution is not the cleanest, but it works in all cases.
+I tried various ways of implementing this and I found several Cython bugs along the way. The current solution is not the cleanest, but it works in all cases (Cython and Python, extension types and normal classes).
``````




---

archive/issue_comments_335212.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,5 @@\n Currently, the method `_sage_doc_` is used to implement custom documentation for instances of a class. Such a use case makes sense, but it should be implemented as the `__doc__` attribute instead of the Sage-specific `_sage_doc_`.\n \n I tried various ways of implementing this and I found several Cython bugs along the way. The current solution is not the cleanest, but it works in all cases (Cython and Python, extension types and normal classes).\n+\n+In the cases where `_sage_doc_` was implemented for a base class, this patch requires adding `@InstanceDoc` to every subclass. This is because Python never inherits the `__doc__` attribute. There is a way around this using a metaclass, but I avoided that because metaclasses have their own problems (see #21681).\n``````\n",
    "created_at": "2017-03-20T13:20:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22611#issuecomment-335212",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,5 @@
 Currently, the method `_sage_doc_` is used to implement custom documentation for instances of a class. Such a use case makes sense, but it should be implemented as the `__doc__` attribute instead of the Sage-specific `_sage_doc_`.
 
 I tried various ways of implementing this and I found several Cython bugs along the way. The current solution is not the cleanest, but it works in all cases (Cython and Python, extension types and normal classes).
+
+In the cases where `_sage_doc_` was implemented for a base class, this patch requires adding `@InstanceDoc` to every subclass. This is because Python never inherits the `__doc__` attribute. There is a way around this using a metaclass, but I avoided that because metaclasses have their own problems (see #21681).
``````




---

archive/issue_comments_335213.json:
```json
{
    "body": "Changed commit from **[`fa42d8e`](https://github.com/sagemath/sagetrac-mirror/commit/fa42d8eb1966a7e1ade67bb40b42a80bb04059b1)** to **[`5eabe46`](https://github.com/sagemath/sagetrac-mirror/commit/5eabe46ca0f929e8e09f0b90e295a0300afe3750)**",
    "created_at": "2017-03-21T09:52:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22611#issuecomment-335213",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`fa42d8e`](https://github.com/sagemath/sagetrac-mirror/commit/fa42d8eb1966a7e1ade67bb40b42a80bb04059b1)** to **[`5eabe46`](https://github.com/sagemath/sagetrac-mirror/commit/5eabe46ca0f929e8e09f0b90e295a0300afe3750)**



---

archive/issue_comments_335214.json:
```json
{
    "body": "<div id=\"comment:9\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5eabe46ca0f929e8e09f0b90e295a0300afe3750\"><code>5eabe46</code></a></td><td><code>Make coverage script happy</code></td></tr></table>\n",
    "created_at": "2017-03-21T09:52:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22611#issuecomment-335214",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:9"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5eabe46ca0f929e8e09f0b90e295a0300afe3750"><code>5eabe46</code></a></td><td><code>Make coverage script happy</code></td></tr></table>




---

archive/issue_comments_335215.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nThis is just a stupid comment, but I'm curious about the naming--why `@InstanceDoc` and not `@instance_doc`?  For whatever reason it's more common to name decorators with underscores instead of camel case (so much so that people will even go against the camel case convention for classes in cases where a decorator is implemented as a class).\n\nThen again, maybe the existing naming nicely calls attention to the fact that this is intended as a class decorator.",
    "created_at": "2017-03-22T13:27:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22611#issuecomment-335215",
    "user": "https://github.com/embray"
}
```

<div id="comment:10" align="right">comment:10</div>

This is just a stupid comment, but I'm curious about the naming--why `@InstanceDoc` and not `@instance_doc`?  For whatever reason it's more common to name decorators with underscores instead of camel case (so much so that people will even go against the camel case convention for classes in cases where a decorator is implemented as a class).

Then again, maybe the existing naming nicely calls attention to the fact that this is intended as a class decorator.



---

archive/issue_comments_335216.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nWhat happens if `_instancedoc_` is not defined?  Will Cython make sure an `AttributeError` is raised in this case?\n\nI think at the very least there should be a clear error message that `_instancedoc_` must be defined (including on base classes that may not have a sensible `_instancedoc_`, in which case it might be good if the descriptor also handled `NotImplemented` errors).",
    "created_at": "2017-03-22T13:36:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22611#issuecomment-335216",
    "user": "https://github.com/embray"
}
```

<div id="comment:11" align="right">comment:11</div>

What happens if `_instancedoc_` is not defined?  Will Cython make sure an `AttributeError` is raised in this case?

I think at the very least there should be a clear error message that `_instancedoc_` must be defined (including on base classes that may not have a sensible `_instancedoc_`, in which case it might be good if the descriptor also handled `NotImplemented` errors).



---

archive/issue_comments_335217.json:
```json
{
    "body": "Reviewer: **Erik Bray**",
    "created_at": "2017-03-22T13:48:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22611#issuecomment-335217",
    "user": "https://github.com/embray"
}
```

Reviewer: **Erik Bray**



---

archive/issue_comments_335218.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nLGTM otherwise. Clever way to abuse the Python internals a bit, though I can't see anything inherently wrong with it, since tp_doc is suppose to be able to be NULL.",
    "created_at": "2017-03-22T13:48:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22611#issuecomment-335218",
    "user": "https://github.com/embray"
}
```

<div id="comment:12" align="right">comment:12</div>

LGTM otherwise. Clever way to abuse the Python internals a bit, though I can't see anything inherently wrong with it, since tp_doc is suppose to be able to be NULL.



---

archive/issue_comments_335219.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nReplying to [@embray](#comment%3A12):\n> LGTM otherwise. Clever way to abuse the Python internals a bit\n\nLike I say on the ticket description, this is the only way to make it work for all classes. Any pure Python implementation wouldn't work for extension types.",
    "created_at": "2017-03-22T15:11:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22611#issuecomment-335219",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:13" align="right">comment:13</div>

Replying to [@embray](#comment%3A12):
> LGTM otherwise. Clever way to abuse the Python internals a bit

Like I say on the ticket description, this is the only way to make it work for all classes. Any pure Python implementation wouldn't work for extension types.



---

archive/issue_events_313074.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-03-22T15:12:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22611",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22611#event-313074"
}
```



---

archive/issue_events_313075.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-03-22T15:12:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22611",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22611#event-313075"
}
```



---

archive/issue_comments_335220.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReplying to [@embray](#comment%3A11):\n> What happens if `_instancedoc_` is not defined?  Will Cython make sure an `AttributeError` is raised in this case?\n\nYes, `AttributeError` works the same way in Cython.",
    "created_at": "2017-03-22T15:12:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22611#issuecomment-335220",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:14" align="right">comment:14</div>

Replying to [@embray](#comment%3A11):
> What happens if `_instancedoc_` is not defined?  Will Cython make sure an `AttributeError` is raised in this case?

Yes, `AttributeError` works the same way in Cython.



---

archive/issue_comments_335221.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nReplying to [@embray](#comment%3A11):\n> What happens if `_instancedoc_` is not defined?  Will Cython make sure an `AttributeError` is raised in this case?\n> \n> I think at the very least there should be a clear error message that `_instancedoc_` must be defined\n\nYou mean an error which is not just `AttributeError: 'foo' object has no attribute '_instancedoc_'`?",
    "created_at": "2017-03-22T15:15:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22611#issuecomment-335221",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:15" align="right">comment:15</div>

Replying to [@embray](#comment%3A11):
> What happens if `_instancedoc_` is not defined?  Will Cython make sure an `AttributeError` is raised in this case?
> 
> I think at the very least there should be a clear error message that `_instancedoc_` must be defined

You mean an error which is not just `AttributeError: 'foo' object has no attribute '_instancedoc_'`?



---

archive/issue_comments_335222.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nRight.  For example, in classes with the `ABCMeta` metaclass, if there are any unimplemented `abstractproperty` or `abstractmethod`, trying to instantiate the class results in:\n\n```\nTypeError: Can't instantiate abstract class A with abstract methods foo\n```\n\nThis is a slightly different case of course, since it's an error that would occur at class definition time.  I was just using this as an example of a clearer error message.",
    "created_at": "2017-03-22T16:04:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22611#issuecomment-335222",
    "user": "https://github.com/embray"
}
```

<div id="comment:16" align="right">comment:16</div>

Right.  For example, in classes with the `ABCMeta` metaclass, if there are any unimplemented `abstractproperty` or `abstractmethod`, trying to instantiate the class results in:

```
TypeError: Can't instantiate abstract class A with abstract methods foo
```

This is a slightly different case of course, since it's an error that would occur at class definition time.  I was just using this as an example of a clearer error message.



---

archive/issue_comments_335223.json:
```json
{
    "body": "<div id=\"comment:17\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f92c25856bd33edfe0b157f9504c2d5a73d4caac\"><code>f92c258</code></a></td><td><code>Doctest an example where `_instancedoc_` is not defined</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/676a80428a980b326a936a42759ff3ba88398f27\"><code>676a804</code></a></td><td><code>Rename InstanceDoc -> instancedoc</code></td></tr></table>\n",
    "created_at": "2017-03-22T16:12:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22611#issuecomment-335223",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:17"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f92c25856bd33edfe0b157f9504c2d5a73d4caac"><code>f92c258</code></a></td><td><code>Doctest an example where `_instancedoc_` is not defined</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/676a80428a980b326a936a42759ff3ba88398f27"><code>676a804</code></a></td><td><code>Rename InstanceDoc -> instancedoc</code></td></tr></table>




---

archive/issue_comments_335224.json:
```json
{
    "body": "Changed commit from **[`5eabe46`](https://github.com/sagemath/sagetrac-mirror/commit/5eabe46ca0f929e8e09f0b90e295a0300afe3750)** to **[`676a804`](https://github.com/sagemath/sagetrac-mirror/commit/676a80428a980b326a936a42759ff3ba88398f27)**",
    "created_at": "2017-03-22T16:12:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22611#issuecomment-335224",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`5eabe46`](https://github.com/sagemath/sagetrac-mirror/commit/5eabe46ca0f929e8e09f0b90e295a0300afe3750)** to **[`676a804`](https://github.com/sagemath/sagetrac-mirror/commit/676a80428a980b326a936a42759ff3ba88398f27)**



---

archive/issue_comments_335225.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nI replaced `InstanceDoc` with `instancedoc` (I didn't use `instance_doc` just because the method name `_instancedoc_` doesn't have an underscore either. And anyway, Python uses `staticmethod` and not `static_method`.)",
    "created_at": "2017-03-22T16:14:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22611#issuecomment-335225",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:18" align="right">comment:18</div>

I replaced `InstanceDoc` with `instancedoc` (I didn't use `instance_doc` just because the method name `_instancedoc_` doesn't have an underscore either. And anyway, Python uses `staticmethod` and not `static_method`.)



---

archive/issue_comments_335226.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nI still don't think the `AttributeError` is very useful, especially considering that you're getting an exception from a builtin module and can't see in the traceback what's actually causing it.  Of course, if one is implementing a class using `@instancedoc` this should be expected, but it still might seem mysterious, I think, compared to a slightly customized message (it could still be an `AttributeError`, though `TypeError` is used more commonly for cases where an expected interface is not found--e.g. `len()` on an object with no `__len__`.).",
    "created_at": "2017-03-22T16:21:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22611#issuecomment-335226",
    "user": "https://github.com/embray"
}
```

<div id="comment:19" align="right">comment:19</div>

I still don't think the `AttributeError` is very useful, especially considering that you're getting an exception from a builtin module and can't see in the traceback what's actually causing it.  Of course, if one is implementing a class using `@instancedoc` this should be expected, but it still might seem mysterious, I think, compared to a slightly customized message (it could still be an `AttributeError`, though `TypeError` is used more commonly for cases where an expected interface is not found--e.g. `len()` on an object with no `__len__`.).



---

archive/issue_comments_335227.json:
```json
{
    "body": "<div id=\"comment:20\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5fe7cb01a8cd117ac6754c8301fb5ddf94d82813\"><code>5fe7cb0</code></a></td><td><code>Change exception message for missing _instancedoc_</code></td></tr></table>\n",
    "created_at": "2017-03-23T10:17:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22611#issuecomment-335227",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:20"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5fe7cb01a8cd117ac6754c8301fb5ddf94d82813"><code>5fe7cb0</code></a></td><td><code>Change exception message for missing _instancedoc_</code></td></tr></table>




---

archive/issue_comments_335228.json:
```json
{
    "body": "Changed commit from **[`676a804`](https://github.com/sagemath/sagetrac-mirror/commit/676a80428a980b326a936a42759ff3ba88398f27)** to **[`5fe7cb0`](https://github.com/sagemath/sagetrac-mirror/commit/5fe7cb01a8cd117ac6754c8301fb5ddf94d82813)**",
    "created_at": "2017-03-23T10:17:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22611#issuecomment-335228",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`676a804`](https://github.com/sagemath/sagetrac-mirror/commit/676a80428a980b326a936a42759ff3ba88398f27)** to **[`5fe7cb0`](https://github.com/sagemath/sagetrac-mirror/commit/5fe7cb01a8cd117ac6754c8301fb5ddf94d82813)**



---

archive/issue_comments_335229.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nHere you go...",
    "created_at": "2017-03-23T10:21:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22611#issuecomment-335229",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:21" align="right">comment:21</div>

Here you go...



---

archive/issue_events_313076.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-03-23T10:21:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22611",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22611#event-313076"
}
```



---

archive/issue_events_313077.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-03-23T10:21:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22611",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22611#event-313077"
}
```



---

archive/issue_comments_335230.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nGreat, I think that's a lot nicer!  Thanks for this--honestly this is so useful I think some form of this should be implemented in Python.  I might suggest that, actually, since I see the question of per-instance docstrings come up from time to time, with no good solution.  If some kind of `__instancedoc__` special method were built into Python it would obviate the need for the special descriptor or the decorator.",
    "created_at": "2017-03-23T11:05:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22611#issuecomment-335230",
    "user": "https://github.com/embray"
}
```

<div id="comment:22" align="right">comment:22</div>

Great, I think that's a lot nicer!  Thanks for this--honestly this is so useful I think some form of this should be implemented in Python.  I might suggest that, actually, since I see the question of per-instance docstrings come up from time to time, with no good solution.  If some kind of `__instancedoc__` special method were built into Python it would obviate the need for the special descriptor or the decorator.



---

archive/issue_events_313078.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-03-23T11:05:51Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22611",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22611#event-313078"
}
```



---

archive/issue_events_313079.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-03-23T11:05:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22611",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22611#event-313079"
}
```



---

archive/issue_comments_335231.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,4 +2,4 @@\n \n I tried various ways of implementing this and I found several Cython bugs along the way. The current solution is not the cleanest, but it works in all cases (Cython and Python, extension types and normal classes).\n \n-In the cases where `_sage_doc_` was implemented for a base class, this patch requires adding `@InstanceDoc` to every subclass. This is because Python never inherits the `__doc__` attribute. There is a way around this using a metaclass, but I avoided that because metaclasses have their own problems (see #21681).\n+In the cases where `_sage_doc_` was implemented for a base class, this patch requires adding `@instancedoc` to every subclass. This is because Python never inherits the `__doc__` attribute. There is a way around this using a metaclass, but I avoided that because metaclasses have their own problems (see #21681).\n``````\n",
    "created_at": "2017-03-23T20:36:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22611#issuecomment-335231",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,4 +2,4 @@
 
 I tried various ways of implementing this and I found several Cython bugs along the way. The current solution is not the cleanest, but it works in all cases (Cython and Python, extension types and normal classes).
 
-In the cases where `_sage_doc_` was implemented for a base class, this patch requires adding `@InstanceDoc` to every subclass. This is because Python never inherits the `__doc__` attribute. There is a way around this using a metaclass, but I avoided that because metaclasses have their own problems (see #21681).
+In the cases where `_sage_doc_` was implemented for a base class, this patch requires adding `@instancedoc` to every subclass. This is because Python never inherits the `__doc__` attribute. There is a way around this using a metaclass, but I avoided that because metaclasses have their own problems (see #21681).
``````




---

archive/issue_comments_335232.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nThanks!",
    "created_at": "2017-03-23T20:36:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22611#issuecomment-335232",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:24" align="right">comment:24</div>

Thanks!



---

archive/issue_comments_335233.json:
```json
{
    "body": "Changed branch from **[u/jdemeyer/ticket/22611](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/22611)** to **[`5fe7cb0`](https://github.com/sagemath/sagetrac-mirror/commit/5fe7cb01a8cd117ac6754c8301fb5ddf94d82813)**",
    "created_at": "2017-03-29T16:51:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22611",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22611#issuecomment-335233",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/jdemeyer/ticket/22611](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/22611)** to **[`5fe7cb0`](https://github.com/sagemath/sagetrac-mirror/commit/5fe7cb01a8cd117ac6754c8301fb5ddf94d82813)**



---

archive/issue_events_313080.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-03-29T16:51:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22611",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22611#event-313080"
}
```



---

archive/issue_events_313081.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "8e22bbf0171c3e502a11c2e162140b219b5bce67",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2017-03-29T16:51:16Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/22611",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22611#event-313081"
}
```
