# Issue 22029: Element richcmp: never use id()

archive/issues_021792.json:
```json
{
    "body": "As discussed in the sage-devel thread starting with `<o21nte$6jp$1`@`blaine.gmane.org>` (https://groups.google.com/d/msg/sage-devel/YVFdxPH6avk/4OZUmzLHBgAJ),\n`coercion_model.richcmp()` should not fall back on comparing by type/id.\n\nThis branch implements comparisons for `Element` the same way as in Python 3: a `TypeError` is raised for uncomparable objects (instead of comparing by `id`).\n\nDependencies: #22297, #22344, #22346, #22369, #22370, #22371, #22372, #22373, #22376, #22382, #24968, #26917, #26931, #26933, #26934, #26935, #26936, #26937, #26938, #26947, #27003, #27009, #27010, #27026, #27027, #27029, #27123, #27241\n\nCC:  @fchapoton\n\nKeywords: python3, richcmp\n\nBranch/Commit: e311ab134f9d0c16dbbb800d35ba2c4325b4beb2\n\nReviewer: Julian R\u00fcth, Marc Mezzarobba\n\nAuthor: Marc Mezzarobba, Jeroen Demeyer\n\nDependencies: #27241\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/22029\n\n",
    "closed_at": "2019-02-11T23:06:53Z",
    "created_at": "2016-12-06T13:31:57Z",
    "labels": [
        "component: coercion"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.7",
    "title": "Element richcmp: never use id()",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22029",
    "user": "https://github.com/mezzarobba"
}
```
As discussed in the sage-devel thread starting with `<o21nte$6jp$1`@`blaine.gmane.org>` (https://groups.google.com/d/msg/sage-devel/YVFdxPH6avk/4OZUmzLHBgAJ),
`coercion_model.richcmp()` should not fall back on comparing by type/id.

This branch implements comparisons for `Element` the same way as in Python 3: a `TypeError` is raised for uncomparable objects (instead of comparing by `id`).

Dependencies: #22297, #22344, #22346, #22369, #22370, #22371, #22372, #22373, #22376, #22382, #24968, #26917, #26931, #26933, #26934, #26935, #26936, #26937, #26938, #26947, #27003, #27009, #27010, #27026, #27027, #27029, #27123, #27241

CC:  @fchapoton

Keywords: python3, richcmp

Branch/Commit: e311ab134f9d0c16dbbb800d35ba2c4325b4beb2

Reviewer: Julian RÃ¼th, Marc Mezzarobba

Author: Marc Mezzarobba, Jeroen Demeyer

Dependencies: #27241

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/22029





---

archive/issue_comments_321733.json:
```json
{
    "body": "<a id='comment:1'></a>Do you plan to work on this? If yes, fill in your name as reviewer. If no, let me know.",
    "created_at": "2016-12-06T15:12:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321733",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:1'></a>Do you plan to work on this? If yes, fill in your name as reviewer. If no, let me know.



---

archive/issue_comments_321734.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-As discussed in the sage-devel thread starting with `<o21nte$6jp$1`@`blaine.gmane.org>`, `Element.__richcmp__()` should not fall back on comparing by type/id.\n+As discussed in the sage-devel thread starting with `<o21nte$6jp$1`@`blaine.gmane.org>`, `coercion_model.richcmp()` should not fall back on comparing by type/id.\n \n Comment: 1\n \n```\n",
    "created_at": "2016-12-06T15:14:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321734",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,4 @@
-As discussed in the sage-devel thread starting with `<o21nte$6jp$1`@`blaine.gmane.org>`, `Element.__richcmp__()` should not fall back on comparing by type/id.
+As discussed in the sage-devel thread starting with `<o21nte$6jp$1`@`blaine.gmane.org>`, `coercion_model.richcmp()` should not fall back on comparing by type/id.
 
 Comment: 1
 
```




---

archive/issue_comments_321735.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-\n+`coercion_model.richcmp()` should not fall back on comparing by type/id.\n \n Comment: 1\n \n```\n",
    "created_at": "2016-12-06T15:16:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321735",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,4 @@
-
+`coercion_model.richcmp()` should not fall back on comparing by type/id.
 
 Comment: 1
 
```




---

archive/issue_comments_321736.json:
```json
{
    "body": "<a id='comment:4'></a>Replying to [comment:1 jdemeyer]:\n> Do you plan to work on this? If yes, fill in your name as reviewer.\n\n\nas author? owner?\n\n> If no, let me know.\n\n\nI've started doing experiments, but I'll most likely need help from people who understand the parts of Sage that rely on the current behavior. At the very least I'll try to push a first draft in the next few days.",
    "created_at": "2016-12-06T15:35:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321736",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:4'></a>Replying to [comment:1 jdemeyer]:
> Do you plan to work on this? If yes, fill in your name as reviewer.


as author? owner?

> If no, let me know.


I've started doing experiments, but I'll most likely need help from people who understand the parts of Sage that rely on the current behavior. At the very least I'll try to push a first draft in the next few days.



---

archive/issue_comments_321737.json:
```json
{
    "body": "<a id='comment:5'></a>My main concern right now is that `sage.graphs` heavily relies on sorting lists of vertices, while various other parts of Sage create graphs with vertices that mix Elements with other Python objects.\n\nAn option might be to try again with `key=id` when `sort()` fails, but (with no global understanding of the code, at least) there's a major risk of getting inconsistent orders with different subsets of vertices.\n\nAnother idea would be to do introduce utilities like\n\n```\n# universal_cmp.pyx\ncpdef lt(x, y):\n    try:\n        return x < y\n    except TypeError:\n        if type(x) is type(y):\n            return id(x) < id(y)\n        else:\n            return type(x) < type(y)\n...\n\ncdef class key(object):\n    def __init__(self):\n        self.value = value\n    def __lt__(self, other):\n        return lt(self.value, other.value)\n    ...\n```\nand then use `universal_cmp.lt()` and `sort(key=universal_cmp.key)`, but this won't work either when one of the types involved only has a partial order, since this order will not be consistent with `id`.\n\nYet another variant would be to pass a comparison function (or, equivalently but probably better in view of the transition to python3, a `key` as above) that wraps `cmp()` and catches `TypeError`s. Not really ideal either, but at least it wouldn't introduce any regression(?), so perhaps that would be enough for this ticket...\n\nAny advice?",
    "created_at": "2016-12-06T15:44:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321737",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:5'></a>My main concern right now is that `sage.graphs` heavily relies on sorting lists of vertices, while various other parts of Sage create graphs with vertices that mix Elements with other Python objects.

An option might be to try again with `key=id` when `sort()` fails, but (with no global understanding of the code, at least) there's a major risk of getting inconsistent orders with different subsets of vertices.

Another idea would be to do introduce utilities like

```
# universal_cmp.pyx
cpdef lt(x, y):
    try:
        return x < y
    except TypeError:
        if type(x) is type(y):
            return id(x) < id(y)
        else:
            return type(x) < type(y)
...

cdef class key(object):
    def __init__(self):
        self.value = value
    def __lt__(self, other):
        return lt(self.value, other.value)
    ...
```
and then use `universal_cmp.lt()` and `sort(key=universal_cmp.key)`, but this won't work either when one of the types involved only has a partial order, since this order will not be consistent with `id`.

Yet another variant would be to pass a comparison function (or, equivalently but probably better in view of the transition to python3, a `key` as above) that wraps `cmp()` and catches `TypeError`s. Not really ideal either, but at least it wouldn't introduce any regression(?), so perhaps that would be enough for this ticket...

Any advice?



---

archive/issue_comments_321738.json:
```json
{
    "body": "<a id='comment:6'></a>Replying to [comment:4 mmezzarobba]:\n> Replying to [comment:1 jdemeyer]:\n> > Do you plan to work on this? If yes, fill in your name as reviewer.\n\n> \n> as author? owner?\n\n\nSorry, I meant as author.",
    "created_at": "2016-12-06T17:42:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321738",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:6'></a>Replying to [comment:4 mmezzarobba]:
> Replying to [comment:1 jdemeyer]:
> > Do you plan to work on this? If yes, fill in your name as reviewer.

> 
> as author? owner?


Sorry, I meant as author.



---

archive/issue_comments_321739.json:
```json
{
    "body": "<a id='comment:7'></a>By the way, why did you remove the reference to the sage-devel thread?",
    "created_at": "2016-12-06T17:44:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321739",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:7'></a>By the way, why did you remove the reference to the sage-devel thread?



---

archive/issue_comments_321740.json:
```json
{
    "body": "<a id='comment:8'></a>Replying to [comment:7 mmezzarobba]:\n> By the way, why did you remove the reference to the sage-devel thread?\n\n\nBecause I didn't understand how to interpret it. A hyperlink would be better.",
    "created_at": "2016-12-06T17:47:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321740",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'></a>Replying to [comment:7 mmezzarobba]:
> By the way, why did you remove the reference to the sage-devel thread?


Because I didn't understand how to interpret it. A hyperlink would be better.



---

archive/issue_comments_321741.json:
```json
{
    "body": "<a id='comment:9'></a>Replying to [comment:5 mmezzarobba]:\n> My main concern right now is that `sage.graphs` heavily relies on sorting lists of vertices\n\n\nWhy does it rely on sorting vertices?",
    "created_at": "2016-12-06T17:50:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321741",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:9'></a>Replying to [comment:5 mmezzarobba]:
> My main concern right now is that `sage.graphs` heavily relies on sorting lists of vertices


Why does it rely on sorting vertices?



---

archive/issue_comments_321742.json:
```json
{
    "body": "<a id='comment:10'></a>Replying to [comment:8 jdemeyer]:\n> Replying to [comment:7 mmezzarobba]:\n> > By the way, why did you remove the reference to the sage-devel thread?\n\n> \n> Because I didn't understand how to interpret it. A hyperlink would be better.\n\n\nI personally prefer Message-Ids, as they don't depend on a particular archive...",
    "created_at": "2016-12-06T17:52:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321742",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:10'></a>Replying to [comment:8 jdemeyer]:
> Replying to [comment:7 mmezzarobba]:
> > By the way, why did you remove the reference to the sage-devel thread?

> 
> Because I didn't understand how to interpret it. A hyperlink would be better.


I personally prefer Message-Ids, as they don't depend on a particular archive...



---

archive/issue_comments_321743.json:
```json
{
    "body": "<a id='comment:11'></a>Replying to [comment:9 jdemeyer]:\n> Replying to [comment:5 mmezzarobba]:\n> > My main concern right now is that `sage.graphs` heavily relies on sorting lists of vertices\n\n> \n> Why does it rely on sorting vertices?\n\n\nIn `sparse_graph` and `generic_graph`, mostly. Some of the occurrences look like they are there for algorithmic purposes, others to make the output more readable, some both at the same time... I didn't look closely enough to say more.",
    "created_at": "2016-12-06T17:56:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321743",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:11'></a>Replying to [comment:9 jdemeyer]:
> Replying to [comment:5 mmezzarobba]:
> > My main concern right now is that `sage.graphs` heavily relies on sorting lists of vertices

> 
> Why does it rely on sorting vertices?


In `sparse_graph` and `generic_graph`, mostly. Some of the occurrences look like they are there for algorithmic purposes, others to make the output more readable, some both at the same time... I didn't look closely enough to say more.



---

archive/issue_comments_321744.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,5 @@\n-\n+As discussed in the sage-devel thread starting with `<o21nte$6jp$1`@`blaine.gmane.org>` (https://groups.google.com/d/msg/sage-devel/YVFdxPH6avk/4OZUmzLHBgAJ),\n+`coercion_model.richcmp()` should not fall back on comparing by type/id.\n \n Comment: 1\n \n```\n",
    "created_at": "2016-12-06T18:01:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321744",
    "user": "https://github.com/mezzarobba"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,5 @@
-
+As discussed in the sage-devel thread starting with `<o21nte$6jp$1`@`blaine.gmane.org>` (https://groups.google.com/d/msg/sage-devel/YVFdxPH6avk/4OZUmzLHBgAJ),
+`coercion_model.richcmp()` should not fall back on comparing by type/id.
 
 Comment: 1
 
```




---

archive/issue_comments_321745.json:
```json
{
    "body": "<a id='comment:13'></a>Replying to [comment:11 mmezzarobba]:\n> In `sparse_graph` and `generic_graph`, mostly. Some of the occurrences look like they are there for algorithmic purposes, others to make the output more readable, some both at the same time... I didn't look closely enough to say more.\n\n\nIt's also important to note the difference between old-style `cmp()` and new-style rich comparisons. Ideally, this branch would only affect the latter.",
    "created_at": "2016-12-06T18:01:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321745",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:13'></a>Replying to [comment:11 mmezzarobba]:
> In `sparse_graph` and `generic_graph`, mostly. Some of the occurrences look like they are there for algorithmic purposes, others to make the output more readable, some both at the same time... I didn't look closely enough to say more.


It's also important to note the difference between old-style `cmp()` and new-style rich comparisons. Ideally, this branch would only affect the latter.



---

archive/issue_comments_321746.json:
```json
{
    "body": "<a id='comment:14'></a>Replying to [comment:13 jdemeyer]:\n> It's also important to note the difference between old-style `cmp()` and new-style rich comparisons. Ideally, this branch would only affect the latter.\n\n\nI'm not sure I follow you: `cmp()` can end up calling `Element.__richcmp__()`, and that's perhaps the main reason why getting rid of the comparison by id there is not trivial.",
    "created_at": "2016-12-06T18:20:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321746",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:14'></a>Replying to [comment:13 jdemeyer]:
> It's also important to note the difference between old-style `cmp()` and new-style rich comparisons. Ideally, this branch would only affect the latter.


I'm not sure I follow you: `cmp()` can end up calling `Element.__richcmp__()`, and that's perhaps the main reason why getting rid of the comparison by id there is not trivial.



---

archive/issue_comments_321747.json:
```json
{
    "body": "<a id='comment:15'></a>Replying to [comment:5 mmezzarobba]:\n> My main concern right now is that `sage.graphs` heavily relies on sorting lists of vertices, while various other parts of Sage create graphs with vertices that mix Elements with other Python objects.\n> \n> An option might be to try again with `key=id` when `sort()` fails, but (with no global understanding of the code, at least) there's a major risk of getting inconsistent orders with different subsets of vertices.\n\n\nIf you have no information on the objects you're sorting, I don't think there is anything that can save you. If your objects are guaranteed to be hashable you could try sorting on the hash, but that will leave your results undefined when hashes clash. In any case, if you rely on \"first try what the object implements and then use a fallback if that fails\", you're doomed.\n\nIn fact, if you allow your vertices to be labelled with arbitrary objects, you're already losing transitivity of equality in sage, via the standard\n\n```\nsage: a=GF(3)(1); b =31; c=GF(5)(1)\nsage: a==b,b==c,a==c\n(True, True, False)\n```\nIt seems that labels get mangled anyway, though, so I think them not being sorted properly is only a minor concern by comparison (sorry):\n\n```\nsage: a=GF(3)(1); b =31; c=GF(5)(1)\nsage: L=[[a,b,c],[a,c,b],[b,a,c],[b,c,a],[c,a,b],[c,b,a]]\nsage: for l in L:\n....:     G=Graph()\n....:     for i in l:\n....:         G.add_vertex(i)\n....:     print [parent(j) for j in G.vertices()]\n....:     \n[<type 'int'>, Integer Ring]\n[<type 'int'>, Integer Ring]\n[<type 'int'>, Integer Ring]\n[<type 'int'>, Integer Ring]\n[<type 'int'>, Integer Ring]\n[<type 'int'>, Integer Ring]\n```\nIt seems to me the only sane approaches are to not rely on sorting (in python it seems being hashable is more ubiquitous than being sortable, so fast lookup is likely better accomplished via hash functions), or to declare that the labels are sortable (making failure a user error).\n\nThis stuff causes real problems: since the old python interface for `__cmp__` methods required one to provide non-errors for \"<\" and \">\" testing if one wants to implement \"==\", sage is riddled with apparent implementations of orderings that are in actuality inconsistent. This has cause problems in at least one case, where labels in published tables of elliptic curves were based on non-sensical but assumed-consistent ordering of number field elements:\n\n[https://groups.google.com/forum/#!topic/sage-nt/aP5LP09sADY](https://groups.google.com/forum/#!topic/sage-nt/aP5LP09sADY)\n\nThis has convinced me that the only sane approach is to deprecate \"cmp\" style interfaces as quickly as possible and instead rely on \"richcmp\", with errors for ordering if not obviously correct.",
    "created_at": "2016-12-06T18:50:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321747",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:15'></a>Replying to [comment:5 mmezzarobba]:
> My main concern right now is that `sage.graphs` heavily relies on sorting lists of vertices, while various other parts of Sage create graphs with vertices that mix Elements with other Python objects.
> 
> An option might be to try again with `key=id` when `sort()` fails, but (with no global understanding of the code, at least) there's a major risk of getting inconsistent orders with different subsets of vertices.


If you have no information on the objects you're sorting, I don't think there is anything that can save you. If your objects are guaranteed to be hashable you could try sorting on the hash, but that will leave your results undefined when hashes clash. In any case, if you rely on "first try what the object implements and then use a fallback if that fails", you're doomed.

In fact, if you allow your vertices to be labelled with arbitrary objects, you're already losing transitivity of equality in sage, via the standard

```
sage: a=GF(3)(1); b =31; c=GF(5)(1)
sage: a==b,b==c,a==c
(True, True, False)
```
It seems that labels get mangled anyway, though, so I think them not being sorted properly is only a minor concern by comparison (sorry):

```
sage: a=GF(3)(1); b =31; c=GF(5)(1)
sage: L=[[a,b,c],[a,c,b],[b,a,c],[b,c,a],[c,a,b],[c,b,a]]
sage: for l in L:
....:     G=Graph()
....:     for i in l:
....:         G.add_vertex(i)
....:     print [parent(j) for j in G.vertices()]
....:     
[<type 'int'>, Integer Ring]
[<type 'int'>, Integer Ring]
[<type 'int'>, Integer Ring]
[<type 'int'>, Integer Ring]
[<type 'int'>, Integer Ring]
[<type 'int'>, Integer Ring]
```
It seems to me the only sane approaches are to not rely on sorting (in python it seems being hashable is more ubiquitous than being sortable, so fast lookup is likely better accomplished via hash functions), or to declare that the labels are sortable (making failure a user error).

This stuff causes real problems: since the old python interface for `__cmp__` methods required one to provide non-errors for "<" and ">" testing if one wants to implement "==", sage is riddled with apparent implementations of orderings that are in actuality inconsistent. This has cause problems in at least one case, where labels in published tables of elliptic curves were based on non-sensical but assumed-consistent ordering of number field elements:

[https://groups.google.com/forum/#!topic/sage-nt/aP5LP09sADY](https://groups.google.com/forum/#!topic/sage-nt/aP5LP09sADY)

This has convinced me that the only sane approach is to deprecate "cmp" style interfaces as quickly as possible and instead rely on "richcmp", with errors for ordering if not obviously correct.



---

archive/issue_comments_321748.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-12-14T10:55:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321748",
    "user": "https://github.com/mezzarobba"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_321749.json:
```json
{
    "body": "<a id='comment:16'></a>Here is a first attempt. All (standard, long) tests should pass unless I made a last-minute mistake. See the commit messages for some comments. I'm not 100% happy with the changes, but I don't think I can do much better in a reasonable amount of time, feel free to commit improvements to the existing branch!\n\n---\nLast 10 new commits:",
    "created_at": "2016-12-14T10:55:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321749",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:16'></a>Here is a first attempt. All (standard, long) tests should pass unless I made a last-minute mistake. See the commit messages for some comments. I'm not 100% happy with the changes, but I don't think I can do much better in a reasonable amount of time, feel free to commit improvements to the existing branch!

---
Last 10 new commits:



---

archive/issue_comments_321750.json:
```json
{
    "body": "<a id='comment:17'></a>I am a strong -1 on the removal of the `!=` tests and the changes of `foo != bar` to (the fugly) `not (foo == bar)`.\n\nThe failures you have in `rigged_configurations.py` is because you moved the definition of `case_S`. You have also made the cases in the code more difficult to follow. Please revert those changes.",
    "created_at": "2016-12-14T15:38:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321750",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:17'></a>I am a strong -1 on the removal of the `!=` tests and the changes of `foo != bar` to (the fugly) `not (foo == bar)`.

The failures you have in `rigged_configurations.py` is because you moved the definition of `case_S`. You have also made the cases in the code more difficult to follow. Please revert those changes.



---

archive/issue_comments_321751.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-12-14T15:38:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321751",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_321752.json:
```json
{
    "body": "<a id='comment:18'></a>This is bad:\n\n```\n        # (Note that, when y is not a Sage Element, we may have ended up here\n        # from a call to cmp(). In this case, and in this case only, it may be\n        # better to emulate what Python does and compare by type/id. But we\n        # have no way(?) to distinguish this situation from the \"normal\" case\n        # of a comparison operator.)\n```",
    "created_at": "2016-12-14T15:43:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321752",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:18'></a>This is bad:

```
        # (Note that, when y is not a Sage Element, we may have ended up here
        # from a call to cmp(). In this case, and in this case only, it may be
        # better to emulate what Python does and compare by type/id. But we
        # have no way(?) to distinguish this situation from the "normal" case
        # of a comparison operator.)
```



---

archive/issue_comments_321753.json:
```json
{
    "body": "<a id='comment:19'></a>Replying to [comment:17 tscrim]:\n> I am a strong -1 on the removal of the `!=` tests and the changes of `foo != bar` to (the fugly) `not (foo == bar)`.\n\n\nUgly, I agree, but safer in generic code (because of cases where equality is not decidable, like expressions, or where not enough information is available, like with intervals)... And code that might end up comparing objects of different type is generic code.\n\n> The failures you have in `rigged_configurations.py` is because you moved the definition of `case_S`. You have also made the cases in the code more difficult to follow. Please revert those changes.\n\n\nI might do it, but I'd like first to understand in detail the alternative you are suggesting, and to see some evidence of a consensus that it is a better option.\n\nIn any case, please feel free to commit improvements yourself, and I'll do my best to review them.",
    "created_at": "2016-12-14T17:05:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321753",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:19'></a>Replying to [comment:17 tscrim]:
> I am a strong -1 on the removal of the `!=` tests and the changes of `foo != bar` to (the fugly) `not (foo == bar)`.


Ugly, I agree, but safer in generic code (because of cases where equality is not decidable, like expressions, or where not enough information is available, like with intervals)... And code that might end up comparing objects of different type is generic code.

> The failures you have in `rigged_configurations.py` is because you moved the definition of `case_S`. You have also made the cases in the code more difficult to follow. Please revert those changes.


I might do it, but I'd like first to understand in detail the alternative you are suggesting, and to see some evidence of a consensus that it is a better option.

In any case, please feel free to commit improvements yourself, and I'll do my best to review them.



---

archive/issue_comments_321754.json:
```json
{
    "body": "<a id='comment:20'></a>Replying to [comment:18 jdemeyer]:\n> This is bad:\n> \n> ```\n>         # (Note that, when y is not a Sage Element, we may have ended up here\n>         # from a call to cmp(). In this case, and in this case only, it may be\n>         # better to emulate what Python does and compare by type/id. But we\n>         # have no way(?) to distinguish this situation from the \"normal\" case\n>         # of a comparison operator.)\n> ```\n\n\nWhat do you mean? If I understand right, this is an issue that will solve itself if sage ever switches to Python3...",
    "created_at": "2016-12-14T17:06:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321754",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:20'></a>Replying to [comment:18 jdemeyer]:
> This is bad:
> 
> ```
>         # (Note that, when y is not a Sage Element, we may have ended up here
>         # from a call to cmp(). In this case, and in this case only, it may be
>         # better to emulate what Python does and compare by type/id. But we
>         # have no way(?) to distinguish this situation from the "normal" case
>         # of a comparison operator.)
> ```


What do you mean? If I understand right, this is an issue that will solve itself if sage ever switches to Python3...



---

archive/issue_comments_321755.json:
```json
{
    "body": "<a id='comment:21'></a>Replying to [comment:20 mmezzarobba]:\n> If I understand right, this is an issue that will solve itself if sage ever switches to Python3...\n\n\nGiven that we currently still have Python 2, that's irrelevant.",
    "created_at": "2016-12-15T08:09:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321755",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:21'></a>Replying to [comment:20 mmezzarobba]:
> If I understand right, this is an issue that will solve itself if sage ever switches to Python3...


Given that we currently still have Python 2, that's irrelevant.



---

archive/issue_comments_321756.json:
```json
{
    "body": "<a id='comment:22'></a>Replying to [comment:21 jdemeyer]:\n> Replying to [comment:20 mmezzarobba]:\n> > If I understand right, this is an issue that will solve itself if sage ever switches to Python3...\n\n> \n> Given that we currently still have Python 2, that's irrelevant.\n\n\nSorry, I fear I still don't understand your comment. The problem with `cmp()` was the main thing I asked about in the sage-devel post that led to this ticket, and you basically replied that it was okay from your point of view to remove the fallback code from `richcmp`. Now it looks to me like you are saying the contrary.",
    "created_at": "2016-12-15T08:21:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321756",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:22'></a>Replying to [comment:21 jdemeyer]:
> Replying to [comment:20 mmezzarobba]:
> > If I understand right, this is an issue that will solve itself if sage ever switches to Python3...

> 
> Given that we currently still have Python 2, that's irrelevant.


Sorry, I fear I still don't understand your comment. The problem with `cmp()` was the main thing I asked about in the sage-devel post that led to this ticket, and you basically replied that it was okay from your point of view to remove the fallback code from `richcmp`. Now it looks to me like you are saying the contrary.



---

archive/issue_comments_321757.json:
```json
{
    "body": "<a id='comment:23'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-12-15T09:32:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321757",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:23'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_321758.json:
```json
{
    "body": "<a id='comment:24'></a>Replying to [comment:17 tscrim]:\n> The failures you have in `rigged_configurations.py` is because you moved the definition of `case_S`. You have also made the cases in the code more difficult to follow.\n\n\nFixed, sorry for the stupid mistake. That's all I did for now. It wouldn't be hard to revert the other changes related to `!=`, but I'm waiting for answers to the follow-up question I just asked on sage-devel.",
    "created_at": "2016-12-15T09:39:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321758",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:24'></a>Replying to [comment:17 tscrim]:
> The failures you have in `rigged_configurations.py` is because you moved the definition of `case_S`. You have also made the cases in the code more difficult to follow.


Fixed, sorry for the stupid mistake. That's all I did for now. It wouldn't be hard to revert the other changes related to `!=`, but I'm waiting for answers to the follow-up question I just asked on sage-devel.



---

archive/issue_comments_321759.json:
```json
{
    "body": "<a id='comment:25'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-12-15T13:59:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321759",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:25'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_321760.json:
```json
{
    "body": "<a id='comment:26'></a>Another take, now returning `NotImplemented` more often. Due to Jeroen's doubts, I left out the idea of treating `SageObject`s in a special way. I do however handle types such as `int` and `float` like `Element`, since this is what the coercion framework usually does.\n\nThis should make it possible to revert some of my other changes. I haven't done it yet.",
    "created_at": "2016-12-15T14:04:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321760",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:26'></a>Another take, now returning `NotImplemented` more often. Due to Jeroen's doubts, I left out the idea of treating `SageObject`s in a special way. I do however handle types such as `int` and `float` like `Element`, since this is what the coercion framework usually does.

This should make it possible to revert some of my other changes. I haven't done it yet.



---

archive/issue_comments_321761.json:
```json
{
    "body": "<a id='comment:27'></a>Replying to [comment:26 mmezzarobba]:\n> I do however handle types such as `int` and `float` like `Element`\n> since this is what the coercion framework usually does.\n\n\nYes, the coercion framework *tries* to coerce those types to a Sage `Element`. However, it doesn't do anything special in the case that such a coercion fails. So I don't see why you should treat the failed-coercion-with-`int`-or-`float` case differently. Just return `NotImplemented` in that case.",
    "created_at": "2016-12-16T06:26:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321761",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:27'></a>Replying to [comment:26 mmezzarobba]:
> I do however handle types such as `int` and `float` like `Element`
> since this is what the coercion framework usually does.


Yes, the coercion framework *tries* to coerce those types to a Sage `Element`. However, it doesn't do anything special in the case that such a coercion fails. So I don't see why you should treat the failed-coercion-with-`int`-or-`float` case differently. Just return `NotImplemented` in that case.



---

archive/issue_comments_321762.json:
```json
{
    "body": "<a id='comment:28'></a>Replying to [comment:27 jdemeyer]:\n> Yes, the coercion framework *tries* to coerce those types to a Sage `Element`. However, it doesn't do anything special in the case that such a coercion fails.\n\n\nBut the net effect is that arithmetic that mixes `Element`s and objects of these types will succeed or fail (with an error coming from the coercion framework) depending whether there is a common parent or not.\n\n> So I don't see why you should treat the failed-coercion-with-`int`-or-`float` case differently. Just return `NotImplemented` in that case.\n\n\nDo you really want things like\n\n```\nsage: GF(2)(1) > float(0.)\nTrue\nsage: RBF(0) < float(-1.)\nTrue\nsage: SymmetricGroup(2)(()) != int(1)\nTrue\n```\neven though it takes exactly one LOC to prevent them and analogous code with Sage `Element`s raises an error (so that, in particular, the behavior will be different for preparsed and pure Python code)?",
    "created_at": "2016-12-16T09:12:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321762",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:28'></a>Replying to [comment:27 jdemeyer]:
> Yes, the coercion framework *tries* to coerce those types to a Sage `Element`. However, it doesn't do anything special in the case that such a coercion fails.


But the net effect is that arithmetic that mixes `Element`s and objects of these types will succeed or fail (with an error coming from the coercion framework) depending whether there is a common parent or not.

> So I don't see why you should treat the failed-coercion-with-`int`-or-`float` case differently. Just return `NotImplemented` in that case.


Do you really want things like

```
sage: GF(2)(1) > float(0.)
True
sage: RBF(0) < float(-1.)
True
sage: SymmetricGroup(2)(()) != int(1)
True
```
even though it takes exactly one LOC to prevent them and analogous code with Sage `Element`s raises an error (so that, in particular, the behavior will be different for preparsed and pure Python code)?



---

archive/issue_comments_321763.json:
```json
{
    "body": "<a id='comment:29'></a>Replying to [comment:28 mmezzarobba]:\n> Do you really want things like\n> \n> ```\n> sage: GF(2)(1) > float(0.)\n> True\n> sage: RBF(0) < float(-1.)\n> True\n> sage: SymmetricGroup(2)(()) != int(1)\n> True\n> ```\n\n\nIn Python 2? Yes, I want that.\n\nIn Python 3? No, I do not want that.",
    "created_at": "2016-12-16T09:33:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321763",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:29'></a>Replying to [comment:28 mmezzarobba]:
> Do you really want things like
> 
> ```
> sage: GF(2)(1) > float(0.)
> True
> sage: RBF(0) < float(-1.)
> True
> sage: SymmetricGroup(2)(()) != int(1)
> True
> ```


In Python 2? Yes, I want that.

In Python 3? No, I do not want that.



---

archive/issue_comments_321764.json:
```json
{
    "body": "<a id='comment:30'></a>In other words: just follow the common Python convention which specifies that a rich comparison (not `__cmp__`) should return `NotImplemented` when it cannot decide a comparison.\n\nThe fact that we directly raise a `TypeError` for Sage Elements is merely a shortcut to get the correct behaviour and to get a nicer error message referring to the parents.",
    "created_at": "2016-12-16T09:35:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321764",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:30'></a>In other words: just follow the common Python convention which specifies that a rich comparison (not `__cmp__`) should return `NotImplemented` when it cannot decide a comparison.

The fact that we directly raise a `TypeError` for Sage Elements is merely a shortcut to get the correct behaviour and to get a nicer error message referring to the parents.



---

archive/issue_comments_321765.json:
```json
{
    "body": "<a id='comment:31'></a>Replying to [comment:30 jdemeyer]:\n> In other words: just follow the common Python convention which specifies that a rich comparison (not `__cmp__`) should return `NotImplemented` when it cannot decide a comparison.\n\n\nI tend to see the situation we are talking about not as one where it can't decide, but as one where it can decide that the comparison doesn't make sense. And not to find \u201cjust follow the Python[2] convention\u201d such a strong argument when Sage already breaks it in much worse ways...",
    "created_at": "2016-12-16T09:44:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321765",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:31'></a>Replying to [comment:30 jdemeyer]:
> In other words: just follow the common Python convention which specifies that a rich comparison (not `__cmp__`) should return `NotImplemented` when it cannot decide a comparison.


I tend to see the situation we are talking about not as one where it can't decide, but as one where it can decide that the comparison doesn't make sense. And not to find âjust follow the Python[2] conventionâ such a strong argument when Sage already breaks it in much worse ways...



---

archive/issue_comments_321766.json:
```json
{
    "body": "<a id='comment:32'></a>Replying to [comment:31 mmezzarobba]:\n> And not to find \u201cjust follow the Python[2] convention\u201d such a strong argument when Sage already breaks it in much worse ways...\n\n\nHow is it relevant whether or not Sage breaks certain Python conventions in much worse ways?\n\nIf Python specifies how to do arithmetic/comparisons, why not follow that?",
    "created_at": "2016-12-16T09:50:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321766",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:32'></a>Replying to [comment:31 mmezzarobba]:
> And not to find âjust follow the Python[2] conventionâ such a strong argument when Sage already breaks it in much worse ways...


How is it relevant whether or not Sage breaks certain Python conventions in much worse ways?

If Python specifies how to do arithmetic/comparisons, why not follow that?



---

archive/issue_comments_321767.json:
```json
{
    "body": "<a id='comment:33'></a>Replying to [comment:32 jdemeyer]:\n> How is it relevant whether or not Sage breaks certain Python conventions in much worse ways?\n\n\nWhen you start deviating from the general conventions, \u201cyour\u201d objects already don't interact with the rest of the system as other developers will expect, and your job IMHO is to minimize the damage.\n\nNow, there is no doubt that you have orders of magnitude more experience of Sage development than I'll likely ever do, so I guess I'll follow your advice even without understanding it if that's really the only way. But I'd really prefer (in general: I'm bringing this up because it is not the first time I have trouble understanding your comments) if you could explain **why** you think a certain technical choice is better instead of just stating that it is.",
    "created_at": "2016-12-16T11:28:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321767",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:33'></a>Replying to [comment:32 jdemeyer]:
> How is it relevant whether or not Sage breaks certain Python conventions in much worse ways?


When you start deviating from the general conventions, âyourâ objects already don't interact with the rest of the system as other developers will expect, and your job IMHO is to minimize the damage.

Now, there is no doubt that you have orders of magnitude more experience of Sage development than I'll likely ever do, so I guess I'll follow your advice even without understanding it if that's really the only way. But I'd really prefer (in general: I'm bringing this up because it is not the first time I have trouble understanding your comments) if you could explain **why** you think a certain technical choice is better instead of just stating that it is.



---

archive/issue_comments_321768.json:
```json
{
    "body": "<a id='comment:34'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2016-12-16T11:47:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321768",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:34'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_321769.json:
```json
{
    "body": "<a id='comment:35'></a>New version of the complete patch series. Tested without the last commit, not fully with it.\n\nI probably won't have much time to work on this in the coming 6-8 weeks, please feel free to take over if you have improvements to make.",
    "created_at": "2016-12-16T11:51:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321769",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:35'></a>New version of the complete patch series. Tested without the last commit, not fully with it.

I probably won't have much time to work on this in the coming 6-8 weeks, please feel free to take over if you have improvements to make.



---

archive/issue_comments_321770.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-12-16T11:51:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321770",
    "user": "https://github.com/mezzarobba"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_321771.json:
```json
{
    "body": "<a id='comment:36'></a>The \u201cknown bug\u201d is now #22071.",
    "created_at": "2016-12-16T16:32:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321771",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:36'></a>The âknown bugâ is now #22071.



---

archive/issue_comments_321772.json:
```json
{
    "body": "<a id='comment:37'></a>Replying to [comment:17 tscrim]:\n> I am a strong -1 on the removal of the `!=` tests and the changes of `foo != bar` to (the fugly) `not (foo == bar)`.\n\n\nDoes the new version (that returns `NotImplemented` in more cases, so ill-typed comparisons by `!=` will typically succeed when the other member is not an `Element`) address your concerns?",
    "created_at": "2016-12-16T16:40:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321772",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:37'></a>Replying to [comment:17 tscrim]:
> I am a strong -1 on the removal of the `!=` tests and the changes of `foo != bar` to (the fugly) `not (foo == bar)`.


Does the new version (that returns `NotImplemented` in more cases, so ill-typed comparisons by `!=` will typically succeed when the other member is not an `Element`) address your concerns?



---

archive/issue_comments_321773.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-12-18T12:49:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321773",
    "user": "https://github.com/mezzarobba"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_321774.json:
```json
{
    "body": "<a id='comment:39'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-12-18T13:02:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321774",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:39'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_321775.json:
```json
{
    "body": "<a id='comment:40'></a>Replying to [comment:35 mmezzarobba]:\n> New version of the complete patch series. Tested without the last commit, not fully with it.\n\n\nTurns out there where [test failures](https://patchbot.sagemath.org/log/22029/debian/8.6/x86_64/3.16.0-4-amd64/multscher/2016-12-18%2006:58:35?short) with that commit. Since it is still not clear to me that it is really what we want, I undid it for now.",
    "created_at": "2016-12-18T13:09:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321775",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:40'></a>Replying to [comment:35 mmezzarobba]:
> New version of the complete patch series. Tested without the last commit, not fully with it.


Turns out there where [test failures](https://patchbot.sagemath.org/log/22029/debian/8.6/x86_64/3.16.0-4-amd64/multscher/2016-12-18%2006:58:35?short) with that commit. Since it is still not clear to me that it is really what we want, I undid it for now.



---

archive/issue_comments_321776.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-12-18T13:09:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321776",
    "user": "https://github.com/mezzarobba"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_321777.json:
```json
{
    "body": "Changing keywords from \"\" to \"cmp\".",
    "created_at": "2017-01-22T17:32:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321777",
    "user": "https://github.com/fchapoton"
}
```

Changing keywords from "" to "cmp".



---

archive/issue_comments_321778.json:
```json
{
    "body": "<a id='comment:43'></a>I also have trouble seeing why what jdemeyer proposes would be better. For me the proposed changes look fine.",
    "created_at": "2017-01-24T21:31:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321778",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:43'></a>I also have trouble seeing why what jdemeyer proposes would be better. For me the proposed changes look fine.



---

archive/issue_comments_321779.json:
```json
{
    "body": "<a id='comment:44'></a>It is plausible that the ad-hoc comparison functions for graph vertices can be simplified (or even removed) thanks to the fact that the general comparison function now returns `NotImplemented` for non-`Elements`. I haven't had time to check yet.\n\nAlso, there are apparently test failures with sage-2.6...\n\nI'll try to work on these issues in 1-2 weeks unless someone beats me to it.",
    "created_at": "2017-01-25T08:41:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321779",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:44'></a>It is plausible that the ad-hoc comparison functions for graph vertices can be simplified (or even removed) thanks to the fact that the general comparison function now returns `NotImplemented` for non-`Elements`. I haven't had time to check yet.

Also, there are apparently test failures with sage-2.6...

I'll try to work on these issues in 1-2 weeks unless someone beats me to it.



---

archive/issue_comments_321780.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-01-25T08:41:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321780",
    "user": "https://github.com/mezzarobba"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_321781.json:
```json
{
    "body": "<a id='comment:45'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-02-01T20:39:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321781",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:45'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_321782.json:
```json
{
    "body": "<a id='comment:46'></a>I just rebased on 7.6.b2 (easily fixed conflict with #22266)",
    "created_at": "2017-02-01T20:40:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321782",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:46'></a>I just rebased on 7.6.b2 (easily fixed conflict with #22266)



---

archive/issue_comments_321783.json:
```json
{
    "body": "<a id='comment:47'></a>Let me try to \"reboot\" this ticket with a different approach: when coercion fails, assume that elements are different (so `==` and `!=` would not give an error).",
    "created_at": "2017-02-10T13:56:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321783",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:47'></a>Let me try to "reboot" this ticket with a different approach: when coercion fails, assume that elements are different (so `==` and `!=` would not give an error).



---

archive/issue_comments_321784.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,7 @@\n+As discussed in the sage-devel thread starting with `<o21nte$6jp$1`@`blaine.gmane.org>` (https://groups.google.com/d/msg/sage-devel/YVFdxPH6avk/4OZUmzLHBgAJ),\n+`coercion_model.richcmp()` should not fall back on comparing by type/id.\n \n+See also #22344.\n \n Comment: 1\n \n```\n",
    "created_at": "2017-02-10T14:38:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321784",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,7 @@
+As discussed in the sage-devel thread starting with `<o21nte$6jp$1`@`blaine.gmane.org>` (https://groups.google.com/d/msg/sage-devel/YVFdxPH6avk/4OZUmzLHBgAJ),
+`coercion_model.richcmp()` should not fall back on comparing by type/id.
 
+See also #22344.
 
 Comment: 1
 
```




---

archive/issue_comments_321785.json:
```json
{
    "body": "<a id='comment:50'></a>The good pieces of the current branch should be split up into different tickets. It is doing way too much for one ticket.",
    "created_at": "2017-02-10T14:43:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321785",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:50'></a>The good pieces of the current branch should be split up into different tickets. It is doing way too much for one ticket.



---

archive/issue_comments_321786.json:
```json
{
    "body": "<a id='comment:51'></a>I might tackle `Parent` (#22344) first. It is a similar but hopefully easier ticket.",
    "created_at": "2017-02-10T14:45:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321786",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:51'></a>I might tackle `Parent` (#22344) first. It is a similar but hopefully easier ticket.



---

archive/issue_comments_321787.json:
```json
{
    "body": "<a id='comment:53'></a>I hope to have time tomorrow to clean up the branch a little. Then you can do whatever you want with it. But I still think that raising an error when coercion fails *and both objects to be compared are Elements* is a better tradeoff.",
    "created_at": "2017-02-10T14:55:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321787",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:53'></a>I hope to have time tomorrow to clean up the branch a little. Then you can do whatever you want with it. But I still think that raising an error when coercion fails *and both objects to be compared are Elements* is a better tradeoff.



---

archive/issue_comments_321788.json:
```json
{
    "body": "<a id='comment:55'></a>Replying to [comment:53 mmezzarobba]:\n> I hope to have time tomorrow to clean up the branch a little. Then you can do whatever you want with it. But I still think that raising an error when coercion fails *and both objects to be compared are Elements* is a better tradeoff.\n\n\nI (also) think in that case we are safe to conclude that `==` and `!=` should be `False` and `True`, respectively. The coercion framework does not allow us to create a new coercion path after that point IIRC. For `<` and `>`, raising an error is consistent with Python (specifically a `TypeError`).",
    "created_at": "2017-02-10T15:13:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321788",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:55'></a>Replying to [comment:53 mmezzarobba]:
> I hope to have time tomorrow to clean up the branch a little. Then you can do whatever you want with it. But I still think that raising an error when coercion fails *and both objects to be compared are Elements* is a better tradeoff.


I (also) think in that case we are safe to conclude that `==` and `!=` should be `False` and `True`, respectively. The coercion framework does not allow us to create a new coercion path after that point IIRC. For `<` and `>`, raising an error is consistent with Python (specifically a `TypeError`).



---

archive/issue_comments_321789.json:
```json
{
    "body": "<a id='comment:59'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-02-10T16:14:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321789",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:59'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_321790.json:
```json
{
    "body": "<a id='comment:60'></a>Replying to [comment:53 mmezzarobba]:\n> I hope to have time tomorrow to clean up the branch a little.\n\n\nIt's not really about cleaning the branch, it's about identifying pieces which make sense to be a new ticket.",
    "created_at": "2017-02-11T08:58:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321790",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:60'></a>Replying to [comment:53 mmezzarobba]:
> I hope to have time tomorrow to clean up the branch a little.


It's not really about cleaning the branch, it's about identifying pieces which make sense to be a new ticket.



---

archive/issue_comments_321791.json:
```json
{
    "body": "<a id='comment:61'></a>Here is a version that does not require #22349 (nor other intrusive changes to `graphs/`) nor #22346 and passes all (short) tests but one even if we make `a != b` fail when there is no coercion. Which is what the branch currently does, but that shouldn't be hard to change. (Jeroen, I didn't update the dependency list because I don't really known what you have in mind with this ticket; the true dependencies with the current branch are the one that are obvious from the commits.)\n\nPretty much everything is improvable, especially the \u201cmain\u201d commit, but I don't think I have left anything too dirty.\n\nThe one test that fails is:\n\n```\nFile \"src/sage/combinat/integer_vector_weighted.py\", line 272, in sage.combinat.integer_vector_weighted.WeightedIntegerVectors_all.__init__\nFailed example:\n    TestSuite(C).run()\nExpected nothing\nGot:\n    Failure in _test_elements_neq:\n    Traceback (most recent call last):\n      File \"/home/marc/co/sage/local/lib/python2.7/site-packages/sage/misc/sage_unittest.py\", line 293, in run\n        test_method(tester = tester)\n      File \"/home/marc/co/sage/local/lib/python2.7/site-packages/sage/categories/sets_cat.py\", line 1330, in _test_elements_neq\n        tester.assertNotEqual(x == y, x != y,\n      File \"sage/structure/element.pyx\", line 1125, in sage.structure.element.Element.__richcmp__ (/home/marc/co/sage/src/build/cythonized/sage/structure/element.c:10379)\n        return coercion_model.richcmp(self, other, op)\n      File \"sage/structure/coerce.pyx\", line 1907, in sage.structure.coerce.CoercionModel_cache_maps.richcmp (/home/marc/co/sage/src/build/cythonized/sage/structure/coerce.c:20514)\n        raise bin_op_exception(_operator_to_string(op), x, y)\n    TypeError: unsupported operand parent(s) for !=: 'Integer vectors of 0 weighted by [2, 1, 3]' and 'Integer vectors of 1 weighted by [2, 1, 3]'\n    ------------------------------------------------------------\n    The following tests failed: _test_elements_neq\n```\n\nReplying to [comment:60 jdemeyer]:\n> It's not really about cleaning the branch, it's about identifying pieces which make sense to be a new ticket.\n\n\nI'm not sure I understand the difference. Anyway, all commits except for the last two are intended to be independent. I didn't test them individually, though, and some probably shouldn't be merged separately without adding a test or two. Please feel free to move anything you want to separate tickets.",
    "created_at": "2017-02-11T12:43:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321791",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:61'></a>Here is a version that does not require #22349 (nor other intrusive changes to `graphs/`) nor #22346 and passes all (short) tests but one even if we make `a != b` fail when there is no coercion. Which is what the branch currently does, but that shouldn't be hard to change. (Jeroen, I didn't update the dependency list because I don't really known what you have in mind with this ticket; the true dependencies with the current branch are the one that are obvious from the commits.)

Pretty much everything is improvable, especially the âmainâ commit, but I don't think I have left anything too dirty.

The one test that fails is:

```
File "src/sage/combinat/integer_vector_weighted.py", line 272, in sage.combinat.integer_vector_weighted.WeightedIntegerVectors_all.__init__
Failed example:
    TestSuite(C).run()
Expected nothing
Got:
    Failure in _test_elements_neq:
    Traceback (most recent call last):
      File "/home/marc/co/sage/local/lib/python2.7/site-packages/sage/misc/sage_unittest.py", line 293, in run
        test_method(tester = tester)
      File "/home/marc/co/sage/local/lib/python2.7/site-packages/sage/categories/sets_cat.py", line 1330, in _test_elements_neq
        tester.assertNotEqual(x == y, x != y,
      File "sage/structure/element.pyx", line 1125, in sage.structure.element.Element.__richcmp__ (/home/marc/co/sage/src/build/cythonized/sage/structure/element.c:10379)
        return coercion_model.richcmp(self, other, op)
      File "sage/structure/coerce.pyx", line 1907, in sage.structure.coerce.CoercionModel_cache_maps.richcmp (/home/marc/co/sage/src/build/cythonized/sage/structure/coerce.c:20514)
        raise bin_op_exception(_operator_to_string(op), x, y)
    TypeError: unsupported operand parent(s) for !=: 'Integer vectors of 0 weighted by [2, 1, 3]' and 'Integer vectors of 1 weighted by [2, 1, 3]'
    ------------------------------------------------------------
    The following tests failed: _test_elements_neq
```

Replying to [comment:60 jdemeyer]:
> It's not really about cleaning the branch, it's about identifying pieces which make sense to be a new ticket.


I'm not sure I understand the difference. Anyway, all commits except for the last two are intended to be independent. I didn't test them individually, though, and some probably shouldn't be merged separately without adding a test or two. Please feel free to move anything you want to separate tickets.



---

archive/issue_comments_321792.json:
```json
{
    "body": "<a id='comment:62'></a>Last 10 new commits:",
    "created_at": "2017-02-12T07:17:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321792",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:62'></a>Last 10 new commits:



---

archive/issue_comments_321793.json:
```json
{
    "body": "<a id='comment:63'></a>Apparently the failure in `integer_vector_weighted` is due to the fact that `DisjointUnionEnumeratedSets(facade=True)` are parents that can construct elements whose parents differ from the parent that constructed them:\n\n```\nsage: V = WeightedIntegerVectors([2,1,3])\nsage: V.an_element().parent() is V\nFalse\n```\nI don't know what to do to fix the issue. Should there be a coercion from `WeightedIntegerVectors(n, w)` to `WeightedIntegerVectors_all(w)`? (It may not be easy to set up one, since as far as I understand it is currently not possible to create elements with `elt.parent() == WeightedIntegerVectors_all(w)` using normal mechanisms, one would have to construct them manually.) Should `DisjointUnionEnumeratedSets` override the test suite? Should `WeightedIntegerVectors` use `facade=False`?...",
    "created_at": "2017-02-12T08:47:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321793",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:63'></a>Apparently the failure in `integer_vector_weighted` is due to the fact that `DisjointUnionEnumeratedSets(facade=True)` are parents that can construct elements whose parents differ from the parent that constructed them:

```
sage: V = WeightedIntegerVectors([2,1,3])
sage: V.an_element().parent() is V
False
```
I don't know what to do to fix the issue. Should there be a coercion from `WeightedIntegerVectors(n, w)` to `WeightedIntegerVectors_all(w)`? (It may not be easy to set up one, since as far as I understand it is currently not possible to create elements with `elt.parent() == WeightedIntegerVectors_all(w)` using normal mechanisms, one would have to construct them manually.) Should `DisjointUnionEnumeratedSets` override the test suite? Should `WeightedIntegerVectors` use `facade=False`?...



---

archive/issue_comments_321794.json:
```json
{
    "body": "<a id='comment:64'></a>For example, the following patch seems to solve the issue, but it is a bit too complicated and fragile to my taste. Do you think it is worth spending time adding docstrings?\n\n```\n #!diff\n--- a/src/sage/combinat/integer_vector_weighted.py\n+++ b/src/sage/combinat/integer_vector_weighted.py\n@@ -16,8 +16,11 @@ AUTHORS:\n #*****************************************************************************\n from __future__ import print_function, absolute_import\n \n+from sage.structure.coerce_maps import CallableConvertMap\n from sage.structure.unique_representation import UniqueRepresentation\n from sage.structure.parent import Parent\n+from sage.categories.pushout import ConstructionFunctor, IdentityConstructionFunctor\n+from sage.categories.enumerated_sets import EnumeratedSets\n from sage.categories.finite_enumerated_sets import FiniteEnumeratedSets\n from sage.categories.infinite_enumerated_sets import InfiniteEnumeratedSets\n from sage.categories.sets_with_grading import SetsWithGrading\n@@ -28,6 +31,20 @@ from sage.combinat.integer_vector import IntegerVector\n from sage.combinat.words.word import Word\n from sage.combinat.permutation import Permutation\n \n+class WeightedIntegerVectorFunctor(ConstructionFunctor):\n+    rank = 11\n+    coercion_reversed = True\n+    def __init__(self, n):\n+        self.n = n\n+        ConstructionFunctor.__init__(self, EnumeratedSets(), EnumeratedSets())\n+    def _apply_functor(self, all_vectors):\n+        return WeightedIntegerVectors(self.n, all_vectors._weights)\n+    def __eq__(self, other):\n+        return (isinstance(other, WeightedIntegerVectorFunctor)\n+                and other.n == self.n)\n+    def merge(self, other):\n+        if isinstance(other, WeightedIntegerVectorFunctor):\n+            return IdentityConstructionFunctor()\n \n class WeightedIntegerVectors(Parent, UniqueRepresentation):\n     r\"\"\"\n@@ -111,9 +128,16 @@ class WeightedIntegerVectors(Parent, UniqueRepresentation):\n         self._n = n\n         self._weights = weight\n         Parent.__init__(self, category=FiniteEnumeratedSets())\n+        all_vectors = WeightedIntegerVectors_all(self._weights)\n+        emb = CallableConvertMap(self, all_vectors, IntegerVector)\n+        self._populate_coercion_lists_(embedding=emb)\n \n     Element = IntegerVector\n \n+    def construction(self):\n+        return (WeightedIntegerVectorFunctor(self._n),\n+                WeightedIntegerVectors_all(self._weights))\n+\n     def _element_constructor_(self, lst):\n         \"\"\"\n         Construct an element of ``self`` from ``lst``.\n```",
    "created_at": "2017-02-12T09:41:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321794",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:64'></a>For example, the following patch seems to solve the issue, but it is a bit too complicated and fragile to my taste. Do you think it is worth spending time adding docstrings?

```
 #!diff
--- a/src/sage/combinat/integer_vector_weighted.py
+++ b/src/sage/combinat/integer_vector_weighted.py
@@ -16,8 +16,11 @@ AUTHORS:
 #*****************************************************************************
 from __future__ import print_function, absolute_import
 
+from sage.structure.coerce_maps import CallableConvertMap
 from sage.structure.unique_representation import UniqueRepresentation
 from sage.structure.parent import Parent
+from sage.categories.pushout import ConstructionFunctor, IdentityConstructionFunctor
+from sage.categories.enumerated_sets import EnumeratedSets
 from sage.categories.finite_enumerated_sets import FiniteEnumeratedSets
 from sage.categories.infinite_enumerated_sets import InfiniteEnumeratedSets
 from sage.categories.sets_with_grading import SetsWithGrading
@@ -28,6 +31,20 @@ from sage.combinat.integer_vector import IntegerVector
 from sage.combinat.words.word import Word
 from sage.combinat.permutation import Permutation
 
+class WeightedIntegerVectorFunctor(ConstructionFunctor):
+    rank = 11
+    coercion_reversed = True
+    def __init__(self, n):
+        self.n = n
+        ConstructionFunctor.__init__(self, EnumeratedSets(), EnumeratedSets())
+    def _apply_functor(self, all_vectors):
+        return WeightedIntegerVectors(self.n, all_vectors._weights)
+    def __eq__(self, other):
+        return (isinstance(other, WeightedIntegerVectorFunctor)
+                and other.n == self.n)
+    def merge(self, other):
+        if isinstance(other, WeightedIntegerVectorFunctor):
+            return IdentityConstructionFunctor()
 
 class WeightedIntegerVectors(Parent, UniqueRepresentation):
     r"""
@@ -111,9 +128,16 @@ class WeightedIntegerVectors(Parent, UniqueRepresentation):
         self._n = n
         self._weights = weight
         Parent.__init__(self, category=FiniteEnumeratedSets())
+        all_vectors = WeightedIntegerVectors_all(self._weights)
+        emb = CallableConvertMap(self, all_vectors, IntegerVector)
+        self._populate_coercion_lists_(embedding=emb)
 
     Element = IntegerVector
 
+    def construction(self):
+        return (WeightedIntegerVectorFunctor(self._n),
+                WeightedIntegerVectors_all(self._weights))
+
     def _element_constructor_(self, lst):
         """
         Construct an element of ``self`` from ``lst``.
```



---

archive/issue_comments_321795.json:
```json
{
    "body": "<a id='comment:65'></a>Replying to [comment:61 mmezzarobba]:\n> Please feel free to move anything you want to separate tickets.\n\n\nOK, I just created #22367, #22368, #22369, #22370, #22371, #22372, #22373, #22374, #22375, #22376. Please set the tickets that you want reviewed to needs_review.",
    "created_at": "2017-02-12T18:11:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321795",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:65'></a>Replying to [comment:61 mmezzarobba]:
> Please feel free to move anything you want to separate tickets.


OK, I just created #22367, #22368, #22369, #22370, #22371, #22372, #22373, #22374, #22375, #22376. Please set the tickets that you want reviewed to needs_review.



---

archive/issue_comments_321796.json:
```json
{
    "body": "<a id='comment:66'></a>I would say this is a bigger underlying problem with `DisjointUnionEnumeratedSets`. This comes from its doc:\n\n```\nsage: class MyUnion(DisjointUnionEnumeratedSets):\n....:   def __init__(self):\n....:       DisjointUnionEnumeratedSets.__init__(self,\n....:            Family([1,2], Permutations))\nsage: pp = MyUnion()\nsage: pp.list()\n[[1], [1, 2], [2, 1]]\n```\nWe have\n\n```\nsage: pp.list()[0].parent()\nStandard permutations of 1\n```\nI suspect the biggest problem comes from the fact it does pass the facade option to the category framework. I think your solution is too specific and somewhat over-engineered. While I think there should be an easy mechanism for allowing coercions when we have a non-facade parent, that seems to be tangent to the problem at hand.\n\nThe fact that this is causing a problem with a `!=` test is worrisome to me too that there is something subtle not caught by your branch. In particular, you can have `!=` that results in an error, which I strongly believe should never happen.\n\nI also disagree with the change in `!=` test; we should at least make the `DummyParent` compare by id so the test remains valid.",
    "created_at": "2017-02-12T18:39:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321796",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:66'></a>I would say this is a bigger underlying problem with `DisjointUnionEnumeratedSets`. This comes from its doc:

```
sage: class MyUnion(DisjointUnionEnumeratedSets):
....:   def __init__(self):
....:       DisjointUnionEnumeratedSets.__init__(self,
....:            Family([1,2], Permutations))
sage: pp = MyUnion()
sage: pp.list()
[[1], [1, 2], [2, 1]]
```
We have

```
sage: pp.list()[0].parent()
Standard permutations of 1
```
I suspect the biggest problem comes from the fact it does pass the facade option to the category framework. I think your solution is too specific and somewhat over-engineered. While I think there should be an easy mechanism for allowing coercions when we have a non-facade parent, that seems to be tangent to the problem at hand.

The fact that this is causing a problem with a `!=` test is worrisome to me too that there is something subtle not caught by your branch. In particular, you can have `!=` that results in an error, which I strongly believe should never happen.

I also disagree with the change in `!=` test; we should at least make the `DummyParent` compare by id so the test remains valid.



---

archive/issue_comments_321797.json:
```json
{
    "body": "<a id='comment:67'></a>Thanks for your commments.\n\nReplying to [comment:66 tscrim]:\n> I suspect the biggest problem comes from the fact it does pass the facade option to the category framework. I think your solution is too specific and somewhat over-engineered.\n\n\nI agree `:-)`. But I don't know what else to do.\n\n> The fact that this is causing a problem with a `!=` test is worrisome to me too that there is something subtle not caught by your branch. In particular, you can have `!=` that results in an error, which I strongly believe should never happen.\n\n\nYes, I know we disagree about that. I kept this behavior for now to see how much trouble it would cause, but I can live with a variant that never fails...\n\n> I also disagree with the change in `!=` test; we should at least make the `DummyParent` compare by id so the test remains valid.\n\n\nI don't see which change you are talking about, sorry.",
    "created_at": "2017-02-12T20:16:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321797",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:67'></a>Thanks for your commments.

Replying to [comment:66 tscrim]:
> I suspect the biggest problem comes from the fact it does pass the facade option to the category framework. I think your solution is too specific and somewhat over-engineered.


I agree `:-)`. But I don't know what else to do.

> The fact that this is causing a problem with a `!=` test is worrisome to me too that there is something subtle not caught by your branch. In particular, you can have `!=` that results in an error, which I strongly believe should never happen.


Yes, I know we disagree about that. I kept this behavior for now to see how much trouble it would cause, but I can live with a variant that never fails...

> I also disagree with the change in `!=` test; we should at least make the `DummyParent` compare by id so the test remains valid.


I don't see which change you are talking about, sorry.



---

archive/issue_comments_321798.json:
```json
{
    "body": "<a id='comment:68'></a>Replying to [comment:65 jdemeyer]:\n> Please set the tickets that you want reviewed to needs_review.\n\n\nDone, thanks.",
    "created_at": "2017-02-12T20:16:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321798",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:68'></a>Replying to [comment:65 jdemeyer]:
> Please set the tickets that you want reviewed to needs_review.


Done, thanks.



---

archive/issue_comments_321799.json:
```json
{
    "body": "<a id='comment:69'></a>Replying to [comment:66 tscrim]:\n> I suspect the biggest problem comes from the fact it does pass the facade option to the category framework. I think your solution is too specific and somewhat over-engineered. While I think there should be an easy mechanism for allowing coercions when we have a non-facade parent, that seems to be tangent to the problem at hand.\n> \n> The fact that this is causing a problem with a `!=` test is worrisome to me too that there is something subtle not caught by your branch. In particular, you can have `!=` that results in an error, which I strongly believe should never happen.\n\n\nI forgot to ask: are weighted integer vectors intended to be comparable by `<` etc.? If not, i.e. if the only issue is comparison by `!=`, and if we agree that `!=` should never fail, then we can indeed ignore the problem for this ticket.",
    "created_at": "2017-02-12T20:24:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321799",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:69'></a>Replying to [comment:66 tscrim]:
> I suspect the biggest problem comes from the fact it does pass the facade option to the category framework. I think your solution is too specific and somewhat over-engineered. While I think there should be an easy mechanism for allowing coercions when we have a non-facade parent, that seems to be tangent to the problem at hand.
> 
> The fact that this is causing a problem with a `!=` test is worrisome to me too that there is something subtle not caught by your branch. In particular, you can have `!=` that results in an error, which I strongly believe should never happen.


I forgot to ask: are weighted integer vectors intended to be comparable by `<` etc.? If not, i.e. if the only issue is comparison by `!=`, and if we agree that `!=` should never fail, then we can indeed ignore the problem for this ticket.



---

archive/issue_comments_321800.json:
```json
{
    "body": "<a id='comment:70'></a>Replying to [comment:67 mmezzarobba]:\n> Thanks for your commments.\n> \n> Replying to [comment:66 tscrim]:\n> > I suspect the biggest problem comes from the fact it does pass the facade option to the category framework. I think your solution is too specific and somewhat over-engineered.\n\n> \n> I agree `:-)`. But I don't know what else to do.\n\n\nI have an idea. I should be able to fix it tomorrow (which I will do on a separate ticket).\n\n> > The fact that this is causing a problem with a `!=` test is worrisome to me too that there is something subtle not caught by your branch. In particular, you can have `!=` that results in an error, which I strongly believe should never happen.\n\n> \n> Yes, I know we disagree about that. I kept this behavior for now to see how much trouble it would cause, but I can live with a variant that never fails...\n\n\nOkay, I wasn't sure about on a quick skim-over what behavior you were trying to support.\n\n> > I also disagree with the change in `!=` test; we should at least make the `DummyParent` compare by id so the test remains valid.\n\n> \n> I don't see which change you are talking about, sorry.\n\n\n```diff\ndiff --git a/src/sage/structure/element_wrapper.pyx b/src/sage/structure/element_wrapper.pyx\nindex c24a33c..801f524 100644\n--- a/src/sage/structure/element_wrapper.pyx\n+++ b/src/sage/structure/element_wrapper.pyx\n@@ -327,7 +327,10 @@ cdef class ElementWrapper(Element):\n             sage: l11 != l12\n             True\n             sage: l11 != l21\n-            True\n+            Traceback (most recent call last):\n+            ...\n+            TypeError: unsupported operand parent(s) for !=: 'A parent' and\n+            'Another parent'\n \n         Testing less than::\n \n```\nI believe this fails because the `DummyParent` doesn't have comparisons.\n\nReplying to [comment:69 mmezzarobba]:\n> I forgot to ask: are weighted integer vectors intended to be comparable by < etc.? If not, i.e. if the only issue is comparison by !=, and if we agree that != should never fail, then we can indeed ignore the problem for this ticket. \n\n\nIt should be lex ordering, which should be inherited from `ClonableArray`.",
    "created_at": "2017-02-13T03:51:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321800",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:70'></a>Replying to [comment:67 mmezzarobba]:
> Thanks for your commments.
> 
> Replying to [comment:66 tscrim]:
> > I suspect the biggest problem comes from the fact it does pass the facade option to the category framework. I think your solution is too specific and somewhat over-engineered.

> 
> I agree `:-)`. But I don't know what else to do.


I have an idea. I should be able to fix it tomorrow (which I will do on a separate ticket).

> > The fact that this is causing a problem with a `!=` test is worrisome to me too that there is something subtle not caught by your branch. In particular, you can have `!=` that results in an error, which I strongly believe should never happen.

> 
> Yes, I know we disagree about that. I kept this behavior for now to see how much trouble it would cause, but I can live with a variant that never fails...


Okay, I wasn't sure about on a quick skim-over what behavior you were trying to support.

> > I also disagree with the change in `!=` test; we should at least make the `DummyParent` compare by id so the test remains valid.

> 
> I don't see which change you are talking about, sorry.


```diff
diff --git a/src/sage/structure/element_wrapper.pyx b/src/sage/structure/element_wrapper.pyx
index c24a33c..801f524 100644
--- a/src/sage/structure/element_wrapper.pyx
+++ b/src/sage/structure/element_wrapper.pyx
@@ -327,7 +327,10 @@ cdef class ElementWrapper(Element):
             sage: l11 != l12
             True
             sage: l11 != l21
-            True
+            Traceback (most recent call last):
+            ...
+            TypeError: unsupported operand parent(s) for !=: 'A parent' and
+            'Another parent'
 
         Testing less than::
 
```
I believe this fails because the `DummyParent` doesn't have comparisons.

Replying to [comment:69 mmezzarobba]:
> I forgot to ask: are weighted integer vectors intended to be comparable by < etc.? If not, i.e. if the only issue is comparison by !=, and if we agree that != should never fail, then we can indeed ignore the problem for this ticket. 


It should be lex ordering, which should be inherited from `ClonableArray`.



---

archive/issue_comments_321801.json:
```json
{
    "body": "<a id='comment:71'></a>Replying to [comment:68 mmezzarobba]:\n> Replying to [comment:65 jdemeyer]:\n> > Please set the tickets that you want reviewed to needs_review.\n\n> \n> Done, thanks.\n\n\nCould you also remove those commits from the branch on this ticket?",
    "created_at": "2017-02-13T07:08:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321801",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:71'></a>Replying to [comment:68 mmezzarobba]:
> Replying to [comment:65 jdemeyer]:
> > Please set the tickets that you want reviewed to needs_review.

> 
> Done, thanks.


Could you also remove those commits from the branch on this ticket?



---

archive/issue_comments_321802.json:
```json
{
    "body": "<a id='comment:72'></a>The fundamental difference between my branch and your branch is that my branch does *not* fall back to `__cmp__` if rich comparison fails. Given that `__cmp__` will go away anyway in Python 3, I strongly disagree with relying on `__cmp__` for rich comparisons. That will make it even harder to get rid of Python 2 `__cmp__` comparisons.",
    "created_at": "2017-02-13T09:18:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321802",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:72'></a>The fundamental difference between my branch and your branch is that my branch does *not* fall back to `__cmp__` if rich comparison fails. Given that `__cmp__` will go away anyway in Python 3, I strongly disagree with relying on `__cmp__` for rich comparisons. That will make it even harder to get rid of Python 2 `__cmp__` comparisons.



---

archive/issue_comments_321803.json:
```json
{
    "body": "<a id='comment:73'></a>Not sure what are real dependencies and what not, so I'm just listing all potentially relevant tickets in the ticket description.",
    "created_at": "2017-02-13T09:50:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321803",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:73'></a>Not sure what are real dependencies and what not, so I'm just listing all potentially relevant tickets in the ticket description.



---

archive/issue_comments_321804.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,7 @@\n+As discussed in the sage-devel thread starting with `<o21nte$6jp$1`@`blaine.gmane.org>` (https://groups.google.com/d/msg/sage-devel/YVFdxPH6avk/4OZUmzLHBgAJ),\n+`coercion_model.richcmp()` should not fall back on comparing by type/id.\n \n+See also #22344, #22346, #22349, #22369, #22370, #22371, #22372, #22373, #22374, #22375, #22376.\n \n Comment: 1\n \n```\n",
    "created_at": "2017-02-13T09:50:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321804",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,7 @@
+As discussed in the sage-devel thread starting with `<o21nte$6jp$1`@`blaine.gmane.org>` (https://groups.google.com/d/msg/sage-devel/YVFdxPH6avk/4OZUmzLHBgAJ),
+`coercion_model.richcmp()` should not fall back on comparing by type/id.
 
+See also #22344, #22346, #22349, #22369, #22370, #22371, #22372, #22373, #22374, #22375, #22376.
 
 Comment: 1
 
```




---

archive/issue_comments_321805.json:
```json
{
    "body": "<a id='comment:74'></a>Replying to [comment:72 jdemeyer]:\n> The fundamental difference between my branch and your branch is that my branch does *not* fall back to `__cmp__` if rich comparison fails. Given that `__cmp__` will go away anyway in Python 3, I strongly disagree with relying on `__cmp__` for rich comparisons. That will make it even harder to get rid of Python 2 `__cmp__` comparisons.\n\n\nI fear I don't understand what you mean. If you're talking about the fact that my version of richcmp can return `NotImplemented` in some cases, that's something I added following your suggestion on sage-devel...",
    "created_at": "2017-02-14T18:54:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321805",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:74'></a>Replying to [comment:72 jdemeyer]:
> The fundamental difference between my branch and your branch is that my branch does *not* fall back to `__cmp__` if rich comparison fails. Given that `__cmp__` will go away anyway in Python 3, I strongly disagree with relying on `__cmp__` for rich comparisons. That will make it even harder to get rid of Python 2 `__cmp__` comparisons.


I fear I don't understand what you mean. If you're talking about the fact that my version of richcmp can return `NotImplemented` in some cases, that's something I added following your suggestion on sage-devel...



---

archive/issue_comments_321806.json:
```json
{
    "body": "<a id='comment:75'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2017-02-14T19:12:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321806",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:75'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_321807.json:
```json
{
    "body": "<a id='comment:76'></a>Replying to [comment:74 mmezzarobba]:\n> If you're talking about the fact that my version of richcmp can return `NotImplemented` in some cases\n\n\nYes, I am talking about that. When Python sees `NotImplemented`, it will call `__cmp__`.\n\n> that's something I added following your suggestion on sage-devel...\n\n\nWell, I don't remember what you refer to, but that was not such a good suggestion then...",
    "created_at": "2017-02-14T20:26:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321807",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:76'></a>Replying to [comment:74 mmezzarobba]:
> If you're talking about the fact that my version of richcmp can return `NotImplemented` in some cases


Yes, I am talking about that. When Python sees `NotImplemented`, it will call `__cmp__`.

> that's something I added following your suggestion on sage-devel...


Well, I don't remember what you refer to, but that was not such a good suggestion then...



---

archive/issue_comments_321808.json:
```json
{
    "body": "<a id='comment:77'></a>The `DisjointUnionEnumeratedSets` issue is now #22382.",
    "created_at": "2017-02-14T23:11:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321808",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:77'></a>The `DisjointUnionEnumeratedSets` issue is now #22382.



---

archive/issue_comments_321809.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,7 @@\n+As discussed in the sage-devel thread starting with `<o21nte$6jp$1`@`blaine.gmane.org>` (https://groups.google.com/d/msg/sage-devel/YVFdxPH6avk/4OZUmzLHBgAJ),\n+`coercion_model.richcmp()` should not fall back on comparing by type/id.\n \n+See also #22344, #22346, #22349, #22369, #22370, #22371, #22372, #22373, #22374, #22375, #22376, #22382.\n \n Comment: 1\n \n```\n",
    "created_at": "2017-02-14T23:11:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321809",
    "user": "https://github.com/tscrim"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,7 @@
+As discussed in the sage-devel thread starting with `<o21nte$6jp$1`@`blaine.gmane.org>` (https://groups.google.com/d/msg/sage-devel/YVFdxPH6avk/4OZUmzLHBgAJ),
+`coercion_model.richcmp()` should not fall back on comparing by type/id.
 
+See also #22344, #22346, #22349, #22369, #22370, #22371, #22372, #22373, #22374, #22375, #22376, #22382.
 
 Comment: 1
 
```




---

archive/issue_comments_321810.json:
```json
{
    "body": "<a id='comment:78'></a>Replying to [comment:76 jdemeyer]:\n> > that's something I added following your suggestion on sage-devel...\n\n> \n> Well, I don't remember what you refer to, but that was not such a good suggestion then...\n\n\n`<585262E2.3060709`@`cage.ugent.be>` / https://groups.google.com/d/msg/sage-devel/YVFdxPH6avk/4OZUmzLHBgAJ",
    "created_at": "2017-02-15T07:23:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321810",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:78'></a>Replying to [comment:76 jdemeyer]:
> > that's something I added following your suggestion on sage-devel...

> 
> Well, I don't remember what you refer to, but that was not such a good suggestion then...


`<585262E2.3060709`@`cage.ugent.be>` / https://groups.google.com/d/msg/sage-devel/YVFdxPH6avk/4OZUmzLHBgAJ



---

archive/issue_comments_321811.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,7 @@\n+As discussed in the sage-devel thread starting with `<o21nte$6jp$1`@`blaine.gmane.org>` (https://groups.google.com/d/msg/sage-devel/YVFdxPH6avk/4OZUmzLHBgAJ),\n+`coercion_model.richcmp()` should not fall back on comparing by type/id.\n \n+See also #22297, #22344, #22346, #22349, #22369, #22370, #22371, #22372, #22373, #22374, #22375, #22376, #22382.\n \n Comment: 1\n \n```\n",
    "created_at": "2017-02-15T08:21:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321811",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,7 @@
+As discussed in the sage-devel thread starting with `<o21nte$6jp$1`@`blaine.gmane.org>` (https://groups.google.com/d/msg/sage-devel/YVFdxPH6avk/4OZUmzLHBgAJ),
+`coercion_model.richcmp()` should not fall back on comparing by type/id.
 
+See also #22297, #22344, #22346, #22349, #22369, #22370, #22371, #22372, #22373, #22374, #22375, #22376, #22382.
 
 Comment: 1
 
```




---

archive/issue_comments_321812.json:
```json
{
    "body": "<a id='comment:80'></a>Replying to [comment:78 mmezzarobba]:\n> `<585262E2.3060709`@`cage.ugent.be>` / https://groups.google.com/d/msg/sage-devel/YVFdxPH6avk/4OZUmzLHBgAJ\n\n\nRight. What I said there makes sense in principle in a world where only Python 2 exists.\n\nI did not think of the Python 3 porting in that thread. Given that we are moving to Python 3, we might as well start implementing Python 3 semantics for comparisons, which means raising an error when a comparison makes no sense.",
    "created_at": "2017-02-15T08:27:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321812",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:80'></a>Replying to [comment:78 mmezzarobba]:
> `<585262E2.3060709`@`cage.ugent.be>` / https://groups.google.com/d/msg/sage-devel/YVFdxPH6avk/4OZUmzLHBgAJ


Right. What I said there makes sense in principle in a world where only Python 2 exists.

I did not think of the Python 3 porting in that thread. Given that we are moving to Python 3, we might as well start implementing Python 3 semantics for comparisons, which means raising an error when a comparison makes no sense.



---

archive/issue_comments_321813.json:
```json
{
    "body": "<a id='comment:81'></a>To add to my last comment: we certainly should not make changes which will make the Python 3 porting *even harder*. I am afraid that your branch does that, since you rely more on the implementation of old-style Python 2 comparisons.",
    "created_at": "2017-02-15T10:03:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321813",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:81'></a>To add to my last comment: we certainly should not make changes which will make the Python 3 porting *even harder*. I am afraid that your branch does that, since you rely more on the implementation of old-style Python 2 comparisons.



---

archive/issue_comments_321814.json:
```json
{
    "body": "<a id='comment:82'></a>Replying to [comment:81 jdemeyer]:\n> I am afraid that your branch does that, since you rely more on the implementation of old-style Python 2 comparisons.\n\n\nPerhaps indeed, I'm not sure. Note that my version only returns `NotImplemented` when comparing an `Element` with something else. This by itself is correct (and perhaps desirable) in Python3 too, isn't it? The only thing that will change if what Python will do as a result.\n\nI have no clear opinion regarding whether it is better to return `NotImplemented` or to fail, and I trust you to know the details of Python3 comparison semantics better than me. The only thing I really care about is that nonsensical comparisons between Elements raise an exception.\n\nHowever, I expect that raising an exception will break more existing code. Based on what I recall of the first version of my branch, the typical situation where falling back to the default Python2 comparison can help is with graphs or other combinatorial objects with labels that want to compare Elements with strings or with tuples. So, more than making Python3 porting harder, I think my version delays some of the issues with existing code to the actual porting.\n\nI'm not going to try going back to a version that doesn't use `NotImplemented` in the next few days. But if you have one that works well, I could try to find time to review it some time next week.",
    "created_at": "2017-02-15T19:02:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321814",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:82'></a>Replying to [comment:81 jdemeyer]:
> I am afraid that your branch does that, since you rely more on the implementation of old-style Python 2 comparisons.


Perhaps indeed, I'm not sure. Note that my version only returns `NotImplemented` when comparing an `Element` with something else. This by itself is correct (and perhaps desirable) in Python3 too, isn't it? The only thing that will change if what Python will do as a result.

I have no clear opinion regarding whether it is better to return `NotImplemented` or to fail, and I trust you to know the details of Python3 comparison semantics better than me. The only thing I really care about is that nonsensical comparisons between Elements raise an exception.

However, I expect that raising an exception will break more existing code. Based on what I recall of the first version of my branch, the typical situation where falling back to the default Python2 comparison can help is with graphs or other combinatorial objects with labels that want to compare Elements with strings or with tuples. So, more than making Python3 porting harder, I think my version delays some of the issues with existing code to the actual porting.

I'm not going to try going back to a version that doesn't use `NotImplemented` in the next few days. But if you have one that works well, I could try to find time to review it some time next week.



---

archive/issue_comments_321815.json:
```json
{
    "body": "<a id='comment:83'></a>Replying to [comment:82 mmezzarobba]:\n> Note that my version only returns `NotImplemented` when comparing an `Element` with something else. This by itself is correct (and perhaps desirable) in Python3 too, isn't it?\n\n\nYes, `return NotImplemented` is the right do to in Python 2. It is also the right thing to do in Python 3. So you would think that it's always right, but it's not.\n\nThe problem is that the implications of this `return NotImplemented` are very different in Python 2 and Python 3. Python 2 will happily compare the objects anyway while Python 3 will raise an exception.\n\nGiven that we are planning to port to Python 3, it makes sense to adopt the Python 3 conventions already using Python 2. That is: raise an error for undefined comparisons.",
    "created_at": "2017-02-15T21:49:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321815",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:83'></a>Replying to [comment:82 mmezzarobba]:
> Note that my version only returns `NotImplemented` when comparing an `Element` with something else. This by itself is correct (and perhaps desirable) in Python3 too, isn't it?


Yes, `return NotImplemented` is the right do to in Python 2. It is also the right thing to do in Python 3. So you would think that it's always right, but it's not.

The problem is that the implications of this `return NotImplemented` are very different in Python 2 and Python 3. Python 2 will happily compare the objects anyway while Python 3 will raise an exception.

Given that we are planning to port to Python 3, it makes sense to adopt the Python 3 conventions already using Python 2. That is: raise an error for undefined comparisons.



---

archive/issue_comments_321816.json:
```json
{
    "body": "<a id='comment:84'></a>Replying to [comment:82 mmezzarobba]:\n> The only thing I really care about is that nonsensical comparisons between Elements raise an exception.\n\n\nThen why don't you implement **exactly** that, without making changes to comparisons with non-Elements? That sounds like a good idea to me.",
    "created_at": "2017-02-15T21:52:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321816",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:84'></a>Replying to [comment:82 mmezzarobba]:
> The only thing I really care about is that nonsensical comparisons between Elements raise an exception.


Then why don't you implement **exactly** that, without making changes to comparisons with non-Elements? That sounds like a good idea to me.



---

archive/issue_comments_321817.json:
```json
{
    "body": "<a id='comment:85'></a>Replying to [comment:84 jdemeyer]:\n> Then why don't you implement **exactly** that, without making changes to comparisons with non-Elements? That sounds like a good idea to me.\n\n\nBecause I don't think that's the best option, even if I care less about the other cases.",
    "created_at": "2017-02-15T21:59:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321817",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:85'></a>Replying to [comment:84 jdemeyer]:
> Then why don't you implement **exactly** that, without making changes to comparisons with non-Elements? That sounds like a good idea to me.


Because I don't think that's the best option, even if I care less about the other cases.



---

archive/issue_comments_321818.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,7 @@\n+As discussed in the sage-devel thread starting with `<o21nte$6jp$1`@`blaine.gmane.org>` (https://groups.google.com/d/msg/sage-devel/YVFdxPH6avk/4OZUmzLHBgAJ),\n+`coercion_model.richcmp()` should not fall back on comparing by type/id.\n \n+See also #22297, #22344, #22346, #22349, #22369, #22370, #22371, #22372, #22373, #22374, #22375, #22376, #22382, #24968.\n \n Comment: 1\n \n```\n",
    "created_at": "2018-03-15T07:00:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321818",
    "user": "https://github.com/mezzarobba"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,7 @@
+As discussed in the sage-devel thread starting with `<o21nte$6jp$1`@`blaine.gmane.org>` (https://groups.google.com/d/msg/sage-devel/YVFdxPH6avk/4OZUmzLHBgAJ),
+`coercion_model.richcmp()` should not fall back on comparing by type/id.
 
+See also #22297, #22344, #22346, #22349, #22369, #22370, #22371, #22372, #22373, #22374, #22375, #22376, #22382, #24968.
 
 Comment: 1
 
```




---

archive/issue_comments_321819.json:
```json
{
    "body": "Changing keywords from \"cmp\" to \"richcmp\".",
    "created_at": "2018-03-29T12:53:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321819",
    "user": "https://github.com/jdemeyer"
}
```

Changing keywords from "cmp" to "richcmp".



---

archive/issue_comments_321820.json:
```json
{
    "body": "<a id='comment:89'></a>Please don't do that, it gives the totally wrong impression that this ticket needs work because there are merge conflicts.",
    "created_at": "2018-03-30T10:25:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321820",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:89'></a>Please don't do that, it gives the totally wrong impression that this ticket needs work because there are merge conflicts.



---

archive/issue_comments_321821.json:
```json
{
    "body": "<a id='comment:90'></a>It would be nice if you could just add to that list instead of just removing my items. Merge conflicts make it hard to see what the proposed changes are doing without being able to click on the branch link, so I think that's an issue that needs work.\n\nSo, what are the proposed changes about? Last time I had a look at them I was not unhappy about them but you seemed to disagree. It might not be perfect but don't the proposed changes improve the situation at least?",
    "created_at": "2018-03-30T13:05:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321821",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:90'></a>It would be nice if you could just add to that list instead of just removing my items. Merge conflicts make it hard to see what the proposed changes are doing without being able to click on the branch link, so I think that's an issue that needs work.

So, what are the proposed changes about? Last time I had a look at them I was not unhappy about them but you seemed to disagree. It might not be perfect but don't the proposed changes improve the situation at least?



---

archive/issue_comments_321822.json:
```json
{
    "body": "Changing status from needs_work to needs_info.",
    "created_at": "2018-03-30T13:05:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321822",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_work to needs_info.



---

archive/issue_comments_321823.json:
```json
{
    "body": "<a id='comment:91'></a>It's too long ago. I don't remember.\n\nRegardless, I feel that we should first focus on the \"see also\" tickets. In particular, #22349 looks like a major problem.",
    "created_at": "2018-03-30T13:22:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321823",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:91'></a>It's too long ago. I don't remember.

Regardless, I feel that we should first focus on the "see also" tickets. In particular, #22349 looks like a major problem.



---

archive/issue_comments_321824.json:
```json
{
    "body": "Changing keywords from \"richcmp\" to \"python3, richcmp\".",
    "created_at": "2018-07-11T15:22:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321824",
    "user": "https://github.com/fchapoton"
}
```

Changing keywords from "richcmp" to "python3, richcmp".



---

archive/issue_comments_321825.json:
```json
{
    "body": "<a id='comment:95'></a>I'm restoring my branch to see how much progress we made. Setting to needs_review only for patchbot testing, it's not actually ready.\n\n---\nNew commits:",
    "created_at": "2018-12-19T15:13:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321825",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:95'></a>I'm restoring my branch to see how much progress we made. Setting to needs_review only for patchbot testing, it's not actually ready.

---
New commits:



---

archive/issue_comments_321826.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2018-12-19T15:13:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321826",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_321827.json:
```json
{
    "body": "<a id='comment:96'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-12-19T15:14:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321827",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:96'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_321828.json:
```json
{
    "body": "<a id='comment:97'></a>Oops, that libffi commit shouldn't be there.",
    "created_at": "2018-12-19T15:14:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321828",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:97'></a>Oops, that libffi commit shouldn't be there.



---

archive/issue_comments_321829.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,9 @@\n+As discussed in the sage-devel thread starting with `<o21nte$6jp$1`@`blaine.gmane.org>` (https://groups.google.com/d/msg/sage-devel/YVFdxPH6avk/4OZUmzLHBgAJ),\n+`coercion_model.richcmp()` should not fall back on comparing by type/id.\n \n+This branch implements comparisons for `Element` the same way as in Python 3: a `TypeError` is raised for uncomparable objects (instead of comparing by `id`).\n+\n+See also #22297, #22344, #22346, #22349, #22369, #22370, #22371, #22372, #22373, #22374, #22375, #22376, #22382, #24968.\n \n Comment: 1\n \n```\n",
    "created_at": "2018-12-19T15:47:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321829",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,9 @@
+As discussed in the sage-devel thread starting with `<o21nte$6jp$1`@`blaine.gmane.org>` (https://groups.google.com/d/msg/sage-devel/YVFdxPH6avk/4OZUmzLHBgAJ),
+`coercion_model.richcmp()` should not fall back on comparing by type/id.
 
+This branch implements comparisons for `Element` the same way as in Python 3: a `TypeError` is raised for uncomparable objects (instead of comparing by `id`).
+
+See also #22297, #22344, #22346, #22349, #22369, #22370, #22371, #22372, #22373, #22374, #22375, #22376, #22382, #24968.
 
 Comment: 1
 
```




---

archive/issue_comments_321830.json:
```json
{
    "body": "<a id='comment:99'></a>Not that many failed tests:\n\n```\n----------------------------------------------------------------------\nsage -t --long --warn-long 54.8 src/sage/schemes/elliptic_curves/height.py  # 1 doctest failed\nsage -t --long --warn-long 54.8 src/sage/graphs/generic_graph.py  # 9 doctests failed\nsage -t --long --warn-long 54.8 src/sage/symbolic/expression.pyx  # 2 doctests failed\nsage -t --long --warn-long 54.8 src/sage/homology/examples.py  # 1 doctest failed\nsage -t --long --warn-long 54.8 src/sage/combinat/tutorial.py  # 4 doctests failed\nsage -t --long --warn-long 54.8 src/sage/graphs/graph.py  # 2 doctests failed\nsage -t --long --warn-long 54.8 src/sage/homology/simplicial_complex.py  # 12 doctests failed\nsage -t --long --warn-long 54.8 src/sage/combinat/multiset_partition_into_sets_ordered.py  # 3 doctests failed\nsage -t --long --warn-long 54.8 src/sage/rings/valuation/valuation.py  # 6 doctests failed\nsage -t --long --warn-long 54.8 src/sage/combinat/finite_state_machine.py  # 4 doctests failed\nsage -t --long --warn-long 54.8 src/sage/graphs/digraph_generators.py  # 4 doctests failed\nsage -t --long --warn-long 54.8 src/sage/combinat/words/morphism.py  # 5 doctests failed\nsage -t --long --warn-long 54.8 src/sage/combinat/words/finite_word.py  # 3 doctests failed\nsage -t --long --warn-long 54.8 src/sage/combinat/words/word_generators.py  # 1 doctest failed\nsage -t --long --warn-long 54.8 src/sage/categories/algebra_functor.py  # 1 doctest failed\nsage -t --long --warn-long 54.8 src/sage/combinat/posets/lattices.py  # 5 doctests failed\nsage -t --long --warn-long 54.8 src/sage/structure/formal_sum.py  # 3 doctests failed\nsage -t --long --warn-long 54.8 src/sage/combinat/designs/incidence_structures.py  # 15 doctests failed\nsage -t --long --warn-long 54.8 src/sage/combinat/set_partition.py  # 3 doctests failed\nsage -t --long --warn-long 54.8 src/sage/misc/misc.py  # 3 doctests failed\nsage -t --long --warn-long 54.8 src/sage/structure/coerce.pyx  # 1 doctest failed\nsage -t --long --warn-long 54.8 src/sage/graphs/schnyder.py  # 4 doctests failed\n----------------------------------------------------------------------\n```\n\nPerhaps we should look at those failures and triage them into various tickets.",
    "created_at": "2018-12-21T12:06:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321830",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:99'></a>Not that many failed tests:

```
----------------------------------------------------------------------
sage -t --long --warn-long 54.8 src/sage/schemes/elliptic_curves/height.py  # 1 doctest failed
sage -t --long --warn-long 54.8 src/sage/graphs/generic_graph.py  # 9 doctests failed
sage -t --long --warn-long 54.8 src/sage/symbolic/expression.pyx  # 2 doctests failed
sage -t --long --warn-long 54.8 src/sage/homology/examples.py  # 1 doctest failed
sage -t --long --warn-long 54.8 src/sage/combinat/tutorial.py  # 4 doctests failed
sage -t --long --warn-long 54.8 src/sage/graphs/graph.py  # 2 doctests failed
sage -t --long --warn-long 54.8 src/sage/homology/simplicial_complex.py  # 12 doctests failed
sage -t --long --warn-long 54.8 src/sage/combinat/multiset_partition_into_sets_ordered.py  # 3 doctests failed
sage -t --long --warn-long 54.8 src/sage/rings/valuation/valuation.py  # 6 doctests failed
sage -t --long --warn-long 54.8 src/sage/combinat/finite_state_machine.py  # 4 doctests failed
sage -t --long --warn-long 54.8 src/sage/graphs/digraph_generators.py  # 4 doctests failed
sage -t --long --warn-long 54.8 src/sage/combinat/words/morphism.py  # 5 doctests failed
sage -t --long --warn-long 54.8 src/sage/combinat/words/finite_word.py  # 3 doctests failed
sage -t --long --warn-long 54.8 src/sage/combinat/words/word_generators.py  # 1 doctest failed
sage -t --long --warn-long 54.8 src/sage/categories/algebra_functor.py  # 1 doctest failed
sage -t --long --warn-long 54.8 src/sage/combinat/posets/lattices.py  # 5 doctests failed
sage -t --long --warn-long 54.8 src/sage/structure/formal_sum.py  # 3 doctests failed
sage -t --long --warn-long 54.8 src/sage/combinat/designs/incidence_structures.py  # 15 doctests failed
sage -t --long --warn-long 54.8 src/sage/combinat/set_partition.py  # 3 doctests failed
sage -t --long --warn-long 54.8 src/sage/misc/misc.py  # 3 doctests failed
sage -t --long --warn-long 54.8 src/sage/structure/coerce.pyx  # 1 doctest failed
sage -t --long --warn-long 54.8 src/sage/graphs/schnyder.py  # 4 doctests failed
----------------------------------------------------------------------
```

Perhaps we should look at those failures and triage them into various tickets.



---

archive/issue_comments_321831.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,9 @@\n+As discussed in the sage-devel thread starting with `<o21nte$6jp$1`@`blaine.gmane.org>` (https://groups.google.com/d/msg/sage-devel/YVFdxPH6avk/4OZUmzLHBgAJ),\n+`coercion_model.richcmp()` should not fall back on comparing by type/id.\n \n+This branch implements comparisons for `Element` the same way as in Python 3: a `TypeError` is raised for uncomparable objects (instead of comparing by `id`).\n+\n+See also #22297, #22344, #22346, #22349, #22369, #22370, #22371, #22372, #22373, #22374, #22375, #22376, #22382, #24968, #26931.\n \n Comment: 1\n \n```\n",
    "created_at": "2018-12-21T12:52:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321831",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,9 @@
+As discussed in the sage-devel thread starting with `<o21nte$6jp$1`@`blaine.gmane.org>` (https://groups.google.com/d/msg/sage-devel/YVFdxPH6avk/4OZUmzLHBgAJ),
+`coercion_model.richcmp()` should not fall back on comparing by type/id.
 
+This branch implements comparisons for `Element` the same way as in Python 3: a `TypeError` is raised for uncomparable objects (instead of comparing by `id`).
+
+See also #22297, #22344, #22346, #22349, #22369, #22370, #22371, #22372, #22373, #22374, #22375, #22376, #22382, #24968, #26931.
 
 Comment: 1
 
```




---

archive/issue_comments_321832.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,9 @@\n+As discussed in the sage-devel thread starting with `<o21nte$6jp$1`@`blaine.gmane.org>` (https://groups.google.com/d/msg/sage-devel/YVFdxPH6avk/4OZUmzLHBgAJ),\n+`coercion_model.richcmp()` should not fall back on comparing by type/id.\n \n+This branch implements comparisons for `Element` the same way as in Python 3: a `TypeError` is raised for uncomparable objects (instead of comparing by `id`).\n+\n+See also #22297, #22344, #22346, #22349, #22369, #22370, #22371, #22372, #22373, #22374, #22375, #22376, #22382, #24968, #26931, [Pynac #338](https://github.com/pynac/pynac/issues/338).\n \n Comment: 1\n \n```\n",
    "created_at": "2018-12-21T14:49:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321832",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,9 @@
+As discussed in the sage-devel thread starting with `<o21nte$6jp$1`@`blaine.gmane.org>` (https://groups.google.com/d/msg/sage-devel/YVFdxPH6avk/4OZUmzLHBgAJ),
+`coercion_model.richcmp()` should not fall back on comparing by type/id.
 
+This branch implements comparisons for `Element` the same way as in Python 3: a `TypeError` is raised for uncomparable objects (instead of comparing by `id`).
+
+See also #22297, #22344, #22346, #22349, #22369, #22370, #22371, #22372, #22373, #22374, #22375, #22376, #22382, #24968, #26931, [Pynac #338](https://github.com/pynac/pynac/issues/338).
 
 Comment: 1
 
```




---

archive/issue_comments_321833.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,9 @@\n+As discussed in the sage-devel thread starting with `<o21nte$6jp$1`@`blaine.gmane.org>` (https://groups.google.com/d/msg/sage-devel/YVFdxPH6avk/4OZUmzLHBgAJ),\n+`coercion_model.richcmp()` should not fall back on comparing by type/id.\n \n+This branch implements comparisons for `Element` the same way as in Python 3: a `TypeError` is raised for uncomparable objects (instead of comparing by `id`).\n+\n+See also #22297, #22344, #22346, #22349, #22369, #22370, #22371, #22372, #22373, #22374, #22375, #22376, #22382, #24968, #26931, #26933, [Pynac #338](https://github.com/pynac/pynac/issues/338).\n \n Comment: 1\n \n```\n",
    "created_at": "2018-12-21T14:56:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321833",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,9 @@
+As discussed in the sage-devel thread starting with `<o21nte$6jp$1`@`blaine.gmane.org>` (https://groups.google.com/d/msg/sage-devel/YVFdxPH6avk/4OZUmzLHBgAJ),
+`coercion_model.richcmp()` should not fall back on comparing by type/id.
 
+This branch implements comparisons for `Element` the same way as in Python 3: a `TypeError` is raised for uncomparable objects (instead of comparing by `id`).
+
+See also #22297, #22344, #22346, #22349, #22369, #22370, #22371, #22372, #22373, #22374, #22375, #22376, #22382, #24968, #26931, #26933, [Pynac #338](https://github.com/pynac/pynac/issues/338).
 
 Comment: 1
 
```




---

archive/issue_comments_321834.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,9 @@\n+As discussed in the sage-devel thread starting with `<o21nte$6jp$1`@`blaine.gmane.org>` (https://groups.google.com/d/msg/sage-devel/YVFdxPH6avk/4OZUmzLHBgAJ),\n+`coercion_model.richcmp()` should not fall back on comparing by type/id.\n \n+This branch implements comparisons for `Element` the same way as in Python 3: a `TypeError` is raised for uncomparable objects (instead of comparing by `id`).\n+\n+See also #22297, #22344, #22346, #22349, #22369, #22370, #22371, #22372, #22373, #22374, #22375, #22376, #22382, #24968, #26931, #26933, #26934, [Pynac #338](https://github.com/pynac/pynac/issues/338).\n \n Comment: 1\n \n```\n",
    "created_at": "2018-12-21T15:19:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321834",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,9 @@
+As discussed in the sage-devel thread starting with `<o21nte$6jp$1`@`blaine.gmane.org>` (https://groups.google.com/d/msg/sage-devel/YVFdxPH6avk/4OZUmzLHBgAJ),
+`coercion_model.richcmp()` should not fall back on comparing by type/id.
 
+This branch implements comparisons for `Element` the same way as in Python 3: a `TypeError` is raised for uncomparable objects (instead of comparing by `id`).
+
+See also #22297, #22344, #22346, #22349, #22369, #22370, #22371, #22372, #22373, #22374, #22375, #22376, #22382, #24968, #26931, #26933, #26934, [Pynac #338](https://github.com/pynac/pynac/issues/338).
 
 Comment: 1
 
```




---

archive/issue_comments_321835.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,9 @@\n+As discussed in the sage-devel thread starting with `<o21nte$6jp$1`@`blaine.gmane.org>` (https://groups.google.com/d/msg/sage-devel/YVFdxPH6avk/4OZUmzLHBgAJ),\n+`coercion_model.richcmp()` should not fall back on comparing by type/id.\n \n+This branch implements comparisons for `Element` the same way as in Python 3: a `TypeError` is raised for uncomparable objects (instead of comparing by `id`).\n+\n+See also #22297, #22344, #22346, #22349, #22369, #22370, #22371, #22372, #22373, #22374, #22375, #22376, #22382, #24968, #26931, #26933, #26934, #26935, [Pynac #338](https://github.com/pynac/pynac/issues/338).\n \n Comment: 1\n \n```\n",
    "created_at": "2018-12-21T15:30:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321835",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,9 @@
+As discussed in the sage-devel thread starting with `<o21nte$6jp$1`@`blaine.gmane.org>` (https://groups.google.com/d/msg/sage-devel/YVFdxPH6avk/4OZUmzLHBgAJ),
+`coercion_model.richcmp()` should not fall back on comparing by type/id.
 
+This branch implements comparisons for `Element` the same way as in Python 3: a `TypeError` is raised for uncomparable objects (instead of comparing by `id`).
+
+See also #22297, #22344, #22346, #22349, #22369, #22370, #22371, #22372, #22373, #22374, #22375, #22376, #22382, #24968, #26931, #26933, #26934, #26935, [Pynac #338](https://github.com/pynac/pynac/issues/338).
 
 Comment: 1
 
```




---

archive/issue_comments_321836.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,9 @@\n+As discussed in the sage-devel thread starting with `<o21nte$6jp$1`@`blaine.gmane.org>` (https://groups.google.com/d/msg/sage-devel/YVFdxPH6avk/4OZUmzLHBgAJ),\n+`coercion_model.richcmp()` should not fall back on comparing by type/id.\n \n+This branch implements comparisons for `Element` the same way as in Python 3: a `TypeError` is raised for uncomparable objects (instead of comparing by `id`).\n+\n+See also #22297, #22344, #22346, #22349, #22369, #22370, #22371, #22372, #22373, #22374, #22375, #22376, #22382, #24968, #26931, #26933, #26934, #26935, #26936, [Pynac #338](https://github.com/pynac/pynac/issues/338).\n \n Comment: 1\n \n```\n",
    "created_at": "2018-12-21T15:33:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321836",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,9 @@
+As discussed in the sage-devel thread starting with `<o21nte$6jp$1`@`blaine.gmane.org>` (https://groups.google.com/d/msg/sage-devel/YVFdxPH6avk/4OZUmzLHBgAJ),
+`coercion_model.richcmp()` should not fall back on comparing by type/id.
 
+This branch implements comparisons for `Element` the same way as in Python 3: a `TypeError` is raised for uncomparable objects (instead of comparing by `id`).
+
+See also #22297, #22344, #22346, #22349, #22369, #22370, #22371, #22372, #22373, #22374, #22375, #22376, #22382, #24968, #26931, #26933, #26934, #26935, #26936, [Pynac #338](https://github.com/pynac/pynac/issues/338).
 
 Comment: 1
 
```




---

archive/issue_comments_321837.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,9 @@\n+As discussed in the sage-devel thread starting with `<o21nte$6jp$1`@`blaine.gmane.org>` (https://groups.google.com/d/msg/sage-devel/YVFdxPH6avk/4OZUmzLHBgAJ),\n+`coercion_model.richcmp()` should not fall back on comparing by type/id.\n \n+This branch implements comparisons for `Element` the same way as in Python 3: a `TypeError` is raised for uncomparable objects (instead of comparing by `id`).\n+\n+See also #22297, #22344, #22346, #22349, #22369, #22370, #22371, #22372, #22373, #22374, #22375, #22376, #22382, #24968, #26931, #26933, #26934, #26935, #26936, #26937, [Pynac #338](https://github.com/pynac/pynac/issues/338).\n \n Comment: 1\n \n```\n",
    "created_at": "2018-12-21T15:38:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321837",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,9 @@
+As discussed in the sage-devel thread starting with `<o21nte$6jp$1`@`blaine.gmane.org>` (https://groups.google.com/d/msg/sage-devel/YVFdxPH6avk/4OZUmzLHBgAJ),
+`coercion_model.richcmp()` should not fall back on comparing by type/id.
 
+This branch implements comparisons for `Element` the same way as in Python 3: a `TypeError` is raised for uncomparable objects (instead of comparing by `id`).
+
+See also #22297, #22344, #22346, #22349, #22369, #22370, #22371, #22372, #22373, #22374, #22375, #22376, #22382, #24968, #26931, #26933, #26934, #26935, #26936, #26937, [Pynac #338](https://github.com/pynac/pynac/issues/338).
 
 Comment: 1
 
```




---

archive/issue_comments_321838.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,9 @@\n+As discussed in the sage-devel thread starting with `<o21nte$6jp$1`@`blaine.gmane.org>` (https://groups.google.com/d/msg/sage-devel/YVFdxPH6avk/4OZUmzLHBgAJ),\n+`coercion_model.richcmp()` should not fall back on comparing by type/id.\n \n+This branch implements comparisons for `Element` the same way as in Python 3: a `TypeError` is raised for uncomparable objects (instead of comparing by `id`).\n+\n+See also #22297, #22344, #22346, #22349, #22369, #22370, #22371, #22372, #22373, #22374, #22375, #22376, #22382, #24968, #26931, #26933, #26934, #26935, #26936, #26937, #26938, [Pynac #338](https://github.com/pynac/pynac/issues/338).\n \n Comment: 1\n \n```\n",
    "created_at": "2018-12-21T15:45:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321838",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,9 @@
+As discussed in the sage-devel thread starting with `<o21nte$6jp$1`@`blaine.gmane.org>` (https://groups.google.com/d/msg/sage-devel/YVFdxPH6avk/4OZUmzLHBgAJ),
+`coercion_model.richcmp()` should not fall back on comparing by type/id.
 
+This branch implements comparisons for `Element` the same way as in Python 3: a `TypeError` is raised for uncomparable objects (instead of comparing by `id`).
+
+See also #22297, #22344, #22346, #22349, #22369, #22370, #22371, #22372, #22373, #22374, #22375, #22376, #22382, #24968, #26931, #26933, #26934, #26935, #26936, #26937, #26938, [Pynac #338](https://github.com/pynac/pynac/issues/338).
 
 Comment: 1
 
```




---

archive/issue_comments_321839.json:
```json
{
    "body": "<a id='comment:9'></a>I identified quite a few additional issues. I'm not saying that I found all issues (I skimmed semi-quickly over the patchbot report) but surely the majority.\n\nThe most serious one is still the graph sorting, which counts for a substantial amount of doctest failures.",
    "created_at": "2018-12-21T15:46:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321839",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:9'></a>I identified quite a few additional issues. I'm not saying that I found all issues (I skimmed semi-quickly over the patchbot report) but surely the majority.

The most serious one is still the graph sorting, which counts for a substantial amount of doctest failures.



---

archive/issue_comments_321840.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,9 @@\n+As discussed in the sage-devel thread starting with `<o21nte$6jp$1`@`blaine.gmane.org>` (https://groups.google.com/d/msg/sage-devel/YVFdxPH6avk/4OZUmzLHBgAJ),\n+`coercion_model.richcmp()` should not fall back on comparing by type/id.\n \n+This branch implements comparisons for `Element` the same way as in Python 3: a `TypeError` is raised for uncomparable objects (instead of comparing by `id`).\n+\n+See also #22297, #22344, #22346, #22349, #22369, #22370, #22371, #22372, #22373, #22375, #22376, #22382, #24968, #26931, #26933, #26934, #26935, #26936, #26937, #26938, [Pynac #338](https://github.com/pynac/pynac/issues/338).\n \n Comment: 1\n \n```\n",
    "created_at": "2018-12-23T09:51:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321840",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,9 @@
+As discussed in the sage-devel thread starting with `<o21nte$6jp$1`@`blaine.gmane.org>` (https://groups.google.com/d/msg/sage-devel/YVFdxPH6avk/4OZUmzLHBgAJ),
+`coercion_model.richcmp()` should not fall back on comparing by type/id.
 
+This branch implements comparisons for `Element` the same way as in Python 3: a `TypeError` is raised for uncomparable objects (instead of comparing by `id`).
+
+See also #22297, #22344, #22346, #22349, #22369, #22370, #22371, #22372, #22373, #22375, #22376, #22382, #24968, #26931, #26933, #26934, #26935, #26936, #26937, #26938, [Pynac #338](https://github.com/pynac/pynac/issues/338).
 
 Comment: 1
 
```




---

archive/issue_comments_321841.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,9 @@\n+As discussed in the sage-devel thread starting with `<o21nte$6jp$1`@`blaine.gmane.org>` (https://groups.google.com/d/msg/sage-devel/YVFdxPH6avk/4OZUmzLHBgAJ),\n+`coercion_model.richcmp()` should not fall back on comparing by type/id.\n \n+This branch implements comparisons for `Element` the same way as in Python 3: a `TypeError` is raised for uncomparable objects (instead of comparing by `id`).\n+\n+See also #22297, #22344, #22346, #22349, #22369, #22370, #22371, #22372, #22373, #22376, #22382, #24968, #26931, #26933, #26934, #26935, #26936, #26937, #26938, [Pynac #338](https://github.com/pynac/pynac/issues/338).\n \n Comment: 1\n \n```\n",
    "created_at": "2018-12-23T09:52:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321841",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,9 @@
+As discussed in the sage-devel thread starting with `<o21nte$6jp$1`@`blaine.gmane.org>` (https://groups.google.com/d/msg/sage-devel/YVFdxPH6avk/4OZUmzLHBgAJ),
+`coercion_model.richcmp()` should not fall back on comparing by type/id.
 
+This branch implements comparisons for `Element` the same way as in Python 3: a `TypeError` is raised for uncomparable objects (instead of comparing by `id`).
+
+See also #22297, #22344, #22346, #22349, #22369, #22370, #22371, #22372, #22373, #22376, #22382, #24968, #26931, #26933, #26934, #26935, #26936, #26937, #26938, [Pynac #338](https://github.com/pynac/pynac/issues/338).
 
 Comment: 1
 
```




---

archive/issue_comments_321842.json:
```json
{
    "body": "<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2018-12-23T11:35:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321842",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_321843.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,9 @@\n+As discussed in the sage-devel thread starting with `<o21nte$6jp$1`@`blaine.gmane.org>` (https://groups.google.com/d/msg/sage-devel/YVFdxPH6avk/4OZUmzLHBgAJ),\n+`coercion_model.richcmp()` should not fall back on comparing by type/id.\n \n+This branch implements comparisons for `Element` the same way as in Python 3: a `TypeError` is raised for uncomparable objects (instead of comparing by `id`).\n+\n+See also #22297, #22344, #22346, #22349, #22369, #22370, #22371, #22372, #22373, #22376, #22382, #24968, #26931, #26933, #26934, #26935, #26936, #26937, #26938, #26947, [Pynac #338](https://github.com/pynac/pynac/issues/338).\n \n Comment: 1\n \n```\n",
    "created_at": "2018-12-23T14:53:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321843",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,9 @@
+As discussed in the sage-devel thread starting with `<o21nte$6jp$1`@`blaine.gmane.org>` (https://groups.google.com/d/msg/sage-devel/YVFdxPH6avk/4OZUmzLHBgAJ),
+`coercion_model.richcmp()` should not fall back on comparing by type/id.
 
+This branch implements comparisons for `Element` the same way as in Python 3: a `TypeError` is raised for uncomparable objects (instead of comparing by `id`).
+
+See also #22297, #22344, #22346, #22349, #22369, #22370, #22371, #22372, #22373, #22376, #22382, #24968, #26931, #26933, #26934, #26935, #26936, #26937, #26938, #26947, [Pynac #338](https://github.com/pynac/pynac/issues/338).
 
 Comment: 1
 
```




---

archive/issue_comments_321844.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,9 @@\n+As discussed in the sage-devel thread starting with `<o21nte$6jp$1`@`blaine.gmane.org>` (https://groups.google.com/d/msg/sage-devel/YVFdxPH6avk/4OZUmzLHBgAJ),\n+`coercion_model.richcmp()` should not fall back on comparing by type/id.\n \n+This branch implements comparisons for `Element` the same way as in Python 3: a `TypeError` is raised for uncomparable objects (instead of comparing by `id`).\n+\n+See also #22297, #22344, #22346, #22349, #22369, #22370, #22371, #22372, #22373, #22376, #22382, #24968, #26931, #26933, #26934, #26935, #26936, #26937, #26938, #26947, #26948, [Pynac #338](https://github.com/pynac/pynac/issues/338).\n \n Comment: 1\n \n```\n",
    "created_at": "2018-12-23T14:57:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321844",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,9 @@
+As discussed in the sage-devel thread starting with `<o21nte$6jp$1`@`blaine.gmane.org>` (https://groups.google.com/d/msg/sage-devel/YVFdxPH6avk/4OZUmzLHBgAJ),
+`coercion_model.richcmp()` should not fall back on comparing by type/id.
 
+This branch implements comparisons for `Element` the same way as in Python 3: a `TypeError` is raised for uncomparable objects (instead of comparing by `id`).
+
+See also #22297, #22344, #22346, #22349, #22369, #22370, #22371, #22372, #22373, #22376, #22382, #24968, #26931, #26933, #26934, #26935, #26936, #26937, #26938, #26947, #26948, [Pynac #338](https://github.com/pynac/pynac/issues/338).
 
 Comment: 1
 
```




---

archive/issue_comments_321845.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,9 @@\n+As discussed in the sage-devel thread starting with `<o21nte$6jp$1`@`blaine.gmane.org>` (https://groups.google.com/d/msg/sage-devel/YVFdxPH6avk/4OZUmzLHBgAJ),\n+`coercion_model.richcmp()` should not fall back on comparing by type/id.\n \n+This branch implements comparisons for `Element` the same way as in Python 3: a `TypeError` is raised for uncomparable objects (instead of comparing by `id`).\n+\n+See also #22297, #22344, #22346, #22349, #22369, #22370, #22371, #22372, #22373, #22376, #22382, #24968, #26917, #26931, #26933, #26934, #26935, #26936, #26937, #26938, #26947, [Pynac #338](https://github.com/pynac/pynac/issues/338).\n \n Comment: 1\n \n```\n",
    "created_at": "2018-12-23T15:12:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321845",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,9 @@
+As discussed in the sage-devel thread starting with `<o21nte$6jp$1`@`blaine.gmane.org>` (https://groups.google.com/d/msg/sage-devel/YVFdxPH6avk/4OZUmzLHBgAJ),
+`coercion_model.richcmp()` should not fall back on comparing by type/id.
 
+This branch implements comparisons for `Element` the same way as in Python 3: a `TypeError` is raised for uncomparable objects (instead of comparing by `id`).
+
+See also #22297, #22344, #22346, #22349, #22369, #22370, #22371, #22372, #22373, #22376, #22382, #24968, #26917, #26931, #26933, #26934, #26935, #26936, #26937, #26938, #26947, [Pynac #338](https://github.com/pynac/pynac/issues/338).
 
 Comment: 1
 
```




---

archive/issue_comments_321846.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-12-29T12:20:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321846",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_321847.json:
```json
{
    "body": "<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-01-02T14:56:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321847",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_321848.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,9 @@\n+As discussed in the sage-devel thread starting with `<o21nte$6jp$1`@`blaine.gmane.org>` (https://groups.google.com/d/msg/sage-devel/YVFdxPH6avk/4OZUmzLHBgAJ),\n+`coercion_model.richcmp()` should not fall back on comparing by type/id.\n \n+This branch implements comparisons for `Element` the same way as in Python 3: a `TypeError` is raised for uncomparable objects (instead of comparing by `id`).\n+\n+See also #22297, #22344, #22346, #22349, #22369, #22370, #22371, #22372, #22373, #22376, #22382, #24968, #26917, #26931, #26933, #26934, #26935, #26936, #26937, #26938, #26947, #27003, [Pynac #338](https://github.com/pynac/pynac/issues/338).\n \n Comment: 1\n \n```\n",
    "created_at": "2019-01-02T18:42:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321848",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,9 @@
+As discussed in the sage-devel thread starting with `<o21nte$6jp$1`@`blaine.gmane.org>` (https://groups.google.com/d/msg/sage-devel/YVFdxPH6avk/4OZUmzLHBgAJ),
+`coercion_model.richcmp()` should not fall back on comparing by type/id.
 
+This branch implements comparisons for `Element` the same way as in Python 3: a `TypeError` is raised for uncomparable objects (instead of comparing by `id`).
+
+See also #22297, #22344, #22346, #22349, #22369, #22370, #22371, #22372, #22373, #22376, #22382, #24968, #26917, #26931, #26933, #26934, #26935, #26936, #26937, #26938, #26947, #27003, [Pynac #338](https://github.com/pynac/pynac/issues/338).
 
 Comment: 1
 
```




---

archive/issue_comments_321849.json:
```json
{
    "body": "<a id='comment:9'></a>I looked at the patchbot failures again and I have now identified all issues.",
    "created_at": "2019-01-02T20:44:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321849",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:9'></a>I looked at the patchbot failures again and I have now identified all issues.



---

archive/issue_comments_321850.json:
```json
{
    "body": "<a id='comment:0'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2019-01-04T10:41:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321850",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:0'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_321851.json:
```json
{
    "body": "<a id='comment:1'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-01-04T10:49:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321851",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:1'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_321852.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,9 @@\n+As discussed in the sage-devel thread starting with `<o21nte$6jp$1`@`blaine.gmane.org>` (https://groups.google.com/d/msg/sage-devel/YVFdxPH6avk/4OZUmzLHBgAJ),\n+`coercion_model.richcmp()` should not fall back on comparing by type/id.\n \n+This branch implements comparisons for `Element` the same way as in Python 3: a `TypeError` is raised for uncomparable objects (instead of comparing by `id`).\n+\n+See also #22297, #22344, #22346, #22349, #22369, #22370, #22371, #22372, #22373, #22376, #22382, #24968, #26917, #26931, #26933, #26934, #26935, #26936, #26937, #26938, #26947, #27003, #27026, [Pynac #338](https://github.com/pynac/pynac/issues/338).\n \n Comment: 1\n \n```\n",
    "created_at": "2019-01-07T08:54:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321852",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,9 @@
+As discussed in the sage-devel thread starting with `<o21nte$6jp$1`@`blaine.gmane.org>` (https://groups.google.com/d/msg/sage-devel/YVFdxPH6avk/4OZUmzLHBgAJ),
+`coercion_model.richcmp()` should not fall back on comparing by type/id.
 
+This branch implements comparisons for `Element` the same way as in Python 3: a `TypeError` is raised for uncomparable objects (instead of comparing by `id`).
+
+See also #22297, #22344, #22346, #22349, #22369, #22370, #22371, #22372, #22373, #22376, #22382, #24968, #26917, #26931, #26933, #26934, #26935, #26936, #26937, #26938, #26947, #27003, #27026, [Pynac #338](https://github.com/pynac/pynac/issues/338).
 
 Comment: 1
 
```




---

archive/issue_comments_321853.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,9 @@\n+As discussed in the sage-devel thread starting with `<o21nte$6jp$1`@`blaine.gmane.org>` (https://groups.google.com/d/msg/sage-devel/YVFdxPH6avk/4OZUmzLHBgAJ),\n+`coercion_model.richcmp()` should not fall back on comparing by type/id.\n \n+This branch implements comparisons for `Element` the same way as in Python 3: a `TypeError` is raised for uncomparable objects (instead of comparing by `id`).\n+\n+See also #22297, #22344, #22346, #22349, #22369, #22370, #22371, #22372, #22373, #22376, #22382, #24968, #26917, #26931, #26933, #26934, #26935, #26936, #26937, #26938, #26947, #27003, #27010, #27026, #27027, [Pynac #338](https://github.com/pynac/pynac/issues/338).\n \n Comment: 1\n \n```\n",
    "created_at": "2019-01-07T09:20:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321853",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,9 @@
+As discussed in the sage-devel thread starting with `<o21nte$6jp$1`@`blaine.gmane.org>` (https://groups.google.com/d/msg/sage-devel/YVFdxPH6avk/4OZUmzLHBgAJ),
+`coercion_model.richcmp()` should not fall back on comparing by type/id.
 
+This branch implements comparisons for `Element` the same way as in Python 3: a `TypeError` is raised for uncomparable objects (instead of comparing by `id`).
+
+See also #22297, #22344, #22346, #22349, #22369, #22370, #22371, #22372, #22373, #22376, #22382, #24968, #26917, #26931, #26933, #26934, #26935, #26936, #26937, #26938, #26947, #27003, #27010, #27026, #27027, [Pynac #338](https://github.com/pynac/pynac/issues/338).
 
 Comment: 1
 
```




---

archive/issue_comments_321854.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-01-07T14:23:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321854",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_321855.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,9 @@\n+As discussed in the sage-devel thread starting with `<o21nte$6jp$1`@`blaine.gmane.org>` (https://groups.google.com/d/msg/sage-devel/YVFdxPH6avk/4OZUmzLHBgAJ),\n+`coercion_model.richcmp()` should not fall back on comparing by type/id.\n \n+This branch implements comparisons for `Element` the same way as in Python 3: a `TypeError` is raised for uncomparable objects (instead of comparing by `id`).\n+\n+See also #22297, #22344, #22346, #22349, #22369, #22370, #22371, #22372, #22373, #22376, #22382, #24968, #26917, #26931, #26933, #26934, #26935, #26936, #26937, #26938, #26947, #27003, #27009, #27010, #27026, #27027, [Pynac #338](https://github.com/pynac/pynac/issues/338).\n \n Comment: 1\n \n```\n",
    "created_at": "2019-01-07T15:45:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321855",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,9 @@
+As discussed in the sage-devel thread starting with `<o21nte$6jp$1`@`blaine.gmane.org>` (https://groups.google.com/d/msg/sage-devel/YVFdxPH6avk/4OZUmzLHBgAJ),
+`coercion_model.richcmp()` should not fall back on comparing by type/id.
 
+This branch implements comparisons for `Element` the same way as in Python 3: a `TypeError` is raised for uncomparable objects (instead of comparing by `id`).
+
+See also #22297, #22344, #22346, #22349, #22369, #22370, #22371, #22372, #22373, #22376, #22382, #24968, #26917, #26931, #26933, #26934, #26935, #26936, #26937, #26938, #26947, #27003, #27009, #27010, #27026, #27027, [Pynac #338](https://github.com/pynac/pynac/issues/338).
 
 Comment: 1
 
```




---

archive/issue_comments_321856.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-01-07T15:47:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321856",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_321857.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,9 @@\n+As discussed in the sage-devel thread starting with `<o21nte$6jp$1`@`blaine.gmane.org>` (https://groups.google.com/d/msg/sage-devel/YVFdxPH6avk/4OZUmzLHBgAJ),\n+`coercion_model.richcmp()` should not fall back on comparing by type/id.\n \n+This branch implements comparisons for `Element` the same way as in Python 3: a `TypeError` is raised for uncomparable objects (instead of comparing by `id`).\n+\n+See also #22297, #22344, #22346, #22349, #22369, #22370, #22371, #22372, #22373, #22376, #22382, #24968, #26917, #26931, #26933, #26934, #26935, #26936, #26937, #26938, #26947, #27003, #27009, #27010, #27026, #27027, #27029, [Pynac #338](https://github.com/pynac/pynac/issues/338).\n \n Comment: 1\n \n```\n",
    "created_at": "2019-01-07T15:53:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321857",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,9 @@
+As discussed in the sage-devel thread starting with `<o21nte$6jp$1`@`blaine.gmane.org>` (https://groups.google.com/d/msg/sage-devel/YVFdxPH6avk/4OZUmzLHBgAJ),
+`coercion_model.richcmp()` should not fall back on comparing by type/id.
 
+This branch implements comparisons for `Element` the same way as in Python 3: a `TypeError` is raised for uncomparable objects (instead of comparing by `id`).
+
+See also #22297, #22344, #22346, #22349, #22369, #22370, #22371, #22372, #22373, #22376, #22382, #24968, #26917, #26931, #26933, #26934, #26935, #26936, #26937, #26938, #26947, #27003, #27009, #27010, #27026, #27027, #27029, [Pynac #338](https://github.com/pynac/pynac/issues/338).
 
 Comment: 1
 
```




---

archive/issue_comments_321858.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-01-07T16:00:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321858",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_321859.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-01-08T11:20:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321859",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_321860.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,9 @@\n+As discussed in the sage-devel thread starting with `<o21nte$6jp$1`@`blaine.gmane.org>` (https://groups.google.com/d/msg/sage-devel/YVFdxPH6avk/4OZUmzLHBgAJ),\n+`coercion_model.richcmp()` should not fall back on comparing by type/id.\n \n+This branch implements comparisons for `Element` the same way as in Python 3: a `TypeError` is raised for uncomparable objects (instead of comparing by `id`).\n+\n+See also #22297, #22344, #22346, #22349, #22369, #22370, #22371, #22372, #22373, #22376, #22382, #24968, #26917, #26931, #26933, #26934, #26935, #26936, #26937, #26938, #26947, #27003, #27009, #27010, #27026, #27027, #27029, [Pynac #339](https://github.com/pynac/pynac/issues/339).\n \n Comment: 1\n \n```\n",
    "created_at": "2019-01-08T12:07:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321860",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,9 @@
+As discussed in the sage-devel thread starting with `<o21nte$6jp$1`@`blaine.gmane.org>` (https://groups.google.com/d/msg/sage-devel/YVFdxPH6avk/4OZUmzLHBgAJ),
+`coercion_model.richcmp()` should not fall back on comparing by type/id.
 
+This branch implements comparisons for `Element` the same way as in Python 3: a `TypeError` is raised for uncomparable objects (instead of comparing by `id`).
+
+See also #22297, #22344, #22346, #22349, #22369, #22370, #22371, #22372, #22373, #22376, #22382, #24968, #26917, #26931, #26933, #26934, #26935, #26936, #26937, #26938, #26947, #27003, #27009, #27010, #27026, #27027, #27029, [Pynac #339](https://github.com/pynac/pynac/issues/339).
 
 Comment: 1
 
```




---

archive/issue_comments_321861.json:
```json
{
    "body": "<a id='comment:1'></a>I consider this ticket to be essentially finished. We need to wait a bit until all dependencies have been merged and a new Pynac release has been made.",
    "created_at": "2019-01-08T15:49:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321861",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:1'></a>I consider this ticket to be essentially finished. We need to wait a bit until all dependencies have been merged and a new Pynac release has been made.



---

archive/issue_comments_321862.json:
```json
{
    "body": "<a id='comment:132'></a>Replying to [comment:131 jdemeyer]:\n> I consider this ticket to be essentially finished. We need to wait a bit until all dependencies have been merged and a new Pynac release has been made.\n\n\nThis is great! Thank you for working on it.",
    "created_at": "2019-01-08T16:00:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321862",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:132'></a>Replying to [comment:131 jdemeyer]:
> I consider this ticket to be essentially finished. We need to wait a bit until all dependencies have been merged and a new Pynac release has been made.


This is great! Thank you for working on it.



---

archive/issue_comments_321863.json:
```json
{
    "body": "<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-01-23T21:27:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321863",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_321864.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-01-23T21:29:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321864",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_321865.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-01-23T21:30:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321865",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_321866.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-01-25T09:26:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321866",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_321867.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,9 @@\n+As discussed in the sage-devel thread starting with `<o21nte$6jp$1`@`blaine.gmane.org>` (https://groups.google.com/d/msg/sage-devel/YVFdxPH6avk/4OZUmzLHBgAJ),\n+`coercion_model.richcmp()` should not fall back on comparing by type/id.\n \n+This branch implements comparisons for `Element` the same way as in Python 3: a `TypeError` is raised for uncomparable objects (instead of comparing by `id`).\n+\n+Dependencies: #22297, #22344, #22346, #22369, #22370, #22371, #22372, #22373, #22376, #22382, #24968, #26917, #26931, #26933, #26934, #26935, #26936, #26937, #26938, #26947, #27003, #27009, #27010, #27026, #27027, #27029, [Pynac #339](https://github.com/pynac/pynac/issues/339).\n \n Comment: 1\n \n```\n",
    "created_at": "2019-01-25T09:29:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321867",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,9 @@
+As discussed in the sage-devel thread starting with `<o21nte$6jp$1`@`blaine.gmane.org>` (https://groups.google.com/d/msg/sage-devel/YVFdxPH6avk/4OZUmzLHBgAJ),
+`coercion_model.richcmp()` should not fall back on comparing by type/id.
 
+This branch implements comparisons for `Element` the same way as in Python 3: a `TypeError` is raised for uncomparable objects (instead of comparing by `id`).
+
+Dependencies: #22297, #22344, #22346, #22369, #22370, #22371, #22372, #22373, #22376, #22382, #24968, #26917, #26931, #26933, #26934, #26935, #26936, #26937, #26938, #26947, #27003, #27009, #27010, #27026, #27027, #27029, [Pynac #339](https://github.com/pynac/pynac/issues/339).
 
 Comment: 1
 
```




---

archive/issue_comments_321868.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-01-25T10:51:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321868",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_321869.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,9 @@\n+As discussed in the sage-devel thread starting with `<o21nte$6jp$1`@`blaine.gmane.org>` (https://groups.google.com/d/msg/sage-devel/YVFdxPH6avk/4OZUmzLHBgAJ),\n+`coercion_model.richcmp()` should not fall back on comparing by type/id.\n \n+This branch implements comparisons for `Element` the same way as in Python 3: a `TypeError` is raised for uncomparable objects (instead of comparing by `id`).\n+\n+Dependencies: #22297, #22344, #22346, #22369, #22370, #22371, #22372, #22373, #22376, #22382, #24968, #26917, #26931, #26933, #26934, #26935, #26936, #26937, #26938, #26947, #27003, #27009, #27010, #27026, #27027, #27029, #27123, [Pynac #339](https://github.com/pynac/pynac/issues/339).\n \n Comment: 1\n \n```\n",
    "created_at": "2019-01-25T14:56:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321869",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,9 @@
+As discussed in the sage-devel thread starting with `<o21nte$6jp$1`@`blaine.gmane.org>` (https://groups.google.com/d/msg/sage-devel/YVFdxPH6avk/4OZUmzLHBgAJ),
+`coercion_model.richcmp()` should not fall back on comparing by type/id.
 
+This branch implements comparisons for `Element` the same way as in Python 3: a `TypeError` is raised for uncomparable objects (instead of comparing by `id`).
+
+Dependencies: #22297, #22344, #22346, #22369, #22370, #22371, #22372, #22373, #22376, #22382, #24968, #26917, #26931, #26933, #26934, #26935, #26936, #26937, #26938, #26947, #27003, #27009, #27010, #27026, #27027, #27029, #27123, [Pynac #339](https://github.com/pynac/pynac/issues/339).
 
 Comment: 1
 
```




---

archive/issue_events_057994.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2019-01-25T14:56:30Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "milestone": "sage-8.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22029#event-57994"
}
```



---

archive/issue_comments_321870.json:
```json
{
    "body": "<a id='comment:0'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-02-03T11:24:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321870",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:0'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_321871.json:
```json
{
    "body": "<a id='comment:1'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-02-03T11:34:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321871",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:1'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_321872.json:
```json
{
    "body": "<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-02-05T08:14:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321872",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_321873.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,9 @@\n+As discussed in the sage-devel thread starting with `<o21nte$6jp$1`@`blaine.gmane.org>` (https://groups.google.com/d/msg/sage-devel/YVFdxPH6avk/4OZUmzLHBgAJ),\n+`coercion_model.richcmp()` should not fall back on comparing by type/id.\n \n+This branch implements comparisons for `Element` the same way as in Python 3: a `TypeError` is raised for uncomparable objects (instead of comparing by `id`).\n+\n+Dependencies: #22297, #22344, #22346, #22369, #22370, #22371, #22372, #22373, #22376, #22382, #24968, #26917, #26931, #26933, #26934, #26935, #26936, #26937, #26938, #26947, #27003, #27009, #27010, #27026, #27027, #27029, #27123, #27221\n \n Comment: 1\n \n```\n",
    "created_at": "2019-02-05T08:15:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321873",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,9 @@
+As discussed in the sage-devel thread starting with `<o21nte$6jp$1`@`blaine.gmane.org>` (https://groups.google.com/d/msg/sage-devel/YVFdxPH6avk/4OZUmzLHBgAJ),
+`coercion_model.richcmp()` should not fall back on comparing by type/id.
 
+This branch implements comparisons for `Element` the same way as in Python 3: a `TypeError` is raised for uncomparable objects (instead of comparing by `id`).
+
+Dependencies: #22297, #22344, #22346, #22369, #22370, #22371, #22372, #22373, #22376, #22382, #24968, #26917, #26931, #26933, #26934, #26935, #26936, #26937, #26938, #26947, #27003, #27009, #27010, #27026, #27027, #27029, #27123, #27221
 
 Comment: 1
 
```




---

archive/issue_comments_321874.json:
```json
{
    "body": "<a id='comment:4'></a>Green bot!",
    "created_at": "2019-02-09T08:05:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321874",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:4'></a>Green bot!



---

archive/issue_comments_321875.json:
```json
{
    "body": "<a id='comment:145'></a>Replying to [comment:144 jdemeyer]:\n> Green bot!\n\n\nGreat! Here is a version based on 8.7.beta3 with #27241.",
    "created_at": "2019-02-09T08:43:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321875",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:145'></a>Replying to [comment:144 jdemeyer]:
> Green bot!


Great! Here is a version based on 8.7.beta3 with #27241.



---

archive/issue_comments_321876.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,9 @@\n+As discussed in the sage-devel thread starting with `<o21nte$6jp$1`@`blaine.gmane.org>` (https://groups.google.com/d/msg/sage-devel/YVFdxPH6avk/4OZUmzLHBgAJ),\n+`coercion_model.richcmp()` should not fall back on comparing by type/id.\n \n+This branch implements comparisons for `Element` the same way as in Python 3: a `TypeError` is raised for uncomparable objects (instead of comparing by `id`).\n+\n+Dependencies: #22297, #22344, #22346, #22369, #22370, #22371, #22372, #22373, #22376, #22382, #24968, #26917, #26931, #26933, #26934, #26935, #26936, #26937, #26938, #26947, #27003, #27009, #27010, #27026, #27027, #27029, #27123, #27241\n \n Comment: 1\n \n```\n",
    "created_at": "2019-02-09T08:43:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321876",
    "user": "https://github.com/mezzarobba"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,9 @@
+As discussed in the sage-devel thread starting with `<o21nte$6jp$1`@`blaine.gmane.org>` (https://groups.google.com/d/msg/sage-devel/YVFdxPH6avk/4OZUmzLHBgAJ),
+`coercion_model.richcmp()` should not fall back on comparing by type/id.
 
+This branch implements comparisons for `Element` the same way as in Python 3: a `TypeError` is raised for uncomparable objects (instead of comparing by `id`).
+
+Dependencies: #22297, #22344, #22346, #22369, #22370, #22371, #22372, #22373, #22376, #22382, #24968, #26917, #26931, #26933, #26934, #26935, #26936, #26937, #26938, #26947, #27003, #27009, #27010, #27026, #27027, #27029, #27123, #27241
 
 Comment: 1
 
```




---

archive/issue_comments_321877.json:
```json
{
    "body": "<a id='comment:6'></a>New commits:",
    "created_at": "2019-02-09T08:44:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321877",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:6'></a>New commits:



---

archive/issue_comments_321878.json:
```json
{
    "body": "<a id='comment:7'></a>As for the actual content: I'm happy with this version, and I'm ready to give it positive review once the patchbot comes back green with the new pynac release. I'm still not 100% convinced that the way you are handling non-Elements and coercion failures is optimal, but even if not, it shouldn't be too hard to change later if this turns out to be an issue.",
    "created_at": "2019-02-09T08:56:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321878",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:7'></a>As for the actual content: I'm happy with this version, and I'm ready to give it positive review once the patchbot comes back green with the new pynac release. I'm still not 100% convinced that the way you are handling non-Elements and coercion failures is optimal, but even if not, it shouldn't be too hard to change later if this turns out to be an issue.



---

archive/issue_comments_321879.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-02-09T10:31:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321879",
    "user": "https://github.com/mezzarobba"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_321880.json:
```json
{
    "body": "<a id='comment:8'></a>The tests pass on my box.",
    "created_at": "2019-02-09T10:31:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321880",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:8'></a>The tests pass on my box.



---

archive/issue_comments_321881.json:
```json
{
    "body": "<a id='comment:149'></a>Replying to [comment:147 mmezzarobba]:\n> I'm still not 100% convinced that the way you are handling non-Elements and coercion failures is optimal\n\n\nWhat do you mean exactly? I'm open to suggestions for improvement.\n\nWhat I want is that comparisons involving the coercion model behave just like comparisons in Python 3 should behave. This means: if the objects cannot be compared, raise an error instead of returning some arbitrary value.",
    "created_at": "2019-02-10T13:10:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321881",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:149'></a>Replying to [comment:147 mmezzarobba]:
> I'm still not 100% convinced that the way you are handling non-Elements and coercion failures is optimal


What do you mean exactly? I'm open to suggestions for improvement.

What I want is that comparisons involving the coercion model behave just like comparisons in Python 3 should behave. This means: if the objects cannot be compared, raise an error instead of returning some arbitrary value.



---

archive/issue_comments_321882.json:
```json
{
    "body": "<a id='comment:150'></a>Replying to [comment:149 jdemeyer]:\n> Replying to [comment:147 mmezzarobba]:\n> > I'm still not 100% convinced that the way you are handling non-Elements and coercion failures is optimal\n\n> \n> What do you mean exactly? I'm open to suggestions for improvement.\n\n\nWe had this discussion two years ago when I started this ticket, and frankly I don't remember all the details. But I think it revolved around the following points:\n\n* Regarding coercion failures, it *might* be better to raise an error (however inconvenient that would be!)\n  * instead of returning `False` when two `Element`s with no common parent are compared using\u00a0`==`,\n  * and, perhaps more importantly, instead of returning `True` when they are compared with `!=`\u2014the additional point to consider in this case being that returning `True` would be \u201cwrong\u201d if we haven't proved that the elements are different, while many boolean predicates in Sage return `False` when they can not decide.\n\n* Regarding non-`Element`s:\n  * The coercion framework treats some specific types essentially like `Element`. We need to be consistent with that, but still allow users to define new types that implement their own comparison logic with Sage elements.\n  * `richcmp()` currently does that by calling `tp_richcompare()` on the non-`Element`, instead of returning `NotImplemented`. I'm not 100% comfortable with this choice. I assume that the goal to get the same behavior under Python 2 and 3, but I'm a bit confused here, because (unless I misunderstood you) you argued against that choice two years ago.",
    "created_at": "2019-02-10T14:29:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321882",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:150'></a>Replying to [comment:149 jdemeyer]:
> Replying to [comment:147 mmezzarobba]:
> > I'm still not 100% convinced that the way you are handling non-Elements and coercion failures is optimal

> 
> What do you mean exactly? I'm open to suggestions for improvement.


We had this discussion two years ago when I started this ticket, and frankly I don't remember all the details. But I think it revolved around the following points:

* Regarding coercion failures, it *might* be better to raise an error (however inconvenient that would be!)
  * instead of returning `False` when two `Element`s with no common parent are compared usingÂ `==`,
  * and, perhaps more importantly, instead of returning `True` when they are compared with `!=`âthe additional point to consider in this case being that returning `True` would be âwrongâ if we haven't proved that the elements are different, while many boolean predicates in Sage return `False` when they can not decide.

* Regarding non-`Element`s:
  * The coercion framework treats some specific types essentially like `Element`. We need to be consistent with that, but still allow users to define new types that implement their own comparison logic with Sage elements.
  * `richcmp()` currently does that by calling `tp_richcompare()` on the non-`Element`, instead of returning `NotImplemented`. I'm not 100% comfortable with this choice. I assume that the goal to get the same behavior under Python 2 and 3, but I'm a bit confused here, because (unless I misunderstood you) you argued against that choice two years ago.



---

archive/issue_comments_321883.json:
```json
{
    "body": "<a id='comment:151'></a>Replying to [comment:150 mmezzarobba]:\n> * Regarding coercion failures, it *might* be better to raise an error (however inconvenient that would be!)\n>   * instead of returning `False` when two `Element`s with no common parent are compared using\u00a0`==`\n\n\nI would argue that, when there is no common parent, elements clearly cannot be equal. This is also consistent with Python 3 where uncomparable objects can still be compared by `==` and `!=`:\n\n```\nPython 3.6.3 (default, Mar 13 2018, 19:00:30) \n[GCC 6.4.0] on linux\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n>>> 1 == \"x\"\nFalse\n```\n\n>   * and, perhaps more importantly, instead of returning `True` when they are compared with `!=`\u2014the additional point to consider in this case being that returning `True` would be \u201cwrong\u201d if we haven't proved that the elements are different\n\n\nAgain, if those elements don't coerce to a common parent, they cannot be equal.\n\n> * Regarding non-`Element`s:\n>   * The coercion framework treats some specific types essentially like `Element`. We need to be consistent with that\n\n\nAs far as I know, we are consistent.\n\n> but still allow users to define new types that implement their own comparison logic with Sage elements.\n> * `richcmp()` currently does that by calling `tp_richcompare()` on the non-`Element`, instead of returning `NotImplemented`.\n\n\nExactly.\n\n> I'm not 100% comfortable with this choice. I assume that the goal to get the same behavior under Python 2 and 3\n\n\nExactly. Returning `NotImplemented` causes different behavior on Python 2 and Python 3.\n\n> I'm a bit confused here, because (unless I misunderstood you) you argued against that choice two years ago.\n\n\nI don't remember precisely. Anyway, I changed my mind and I'm convinced now that raising an error is the right thing to do.",
    "created_at": "2019-02-10T20:21:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321883",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:151'></a>Replying to [comment:150 mmezzarobba]:
> * Regarding coercion failures, it *might* be better to raise an error (however inconvenient that would be!)
>   * instead of returning `False` when two `Element`s with no common parent are compared usingÂ `==`


I would argue that, when there is no common parent, elements clearly cannot be equal. This is also consistent with Python 3 where uncomparable objects can still be compared by `==` and `!=`:

```
Python 3.6.3 (default, Mar 13 2018, 19:00:30) 
[GCC 6.4.0] on linux
Type "help", "copyright", "credits" or "license" for more information.
>>> 1 == "x"
False
```

>   * and, perhaps more importantly, instead of returning `True` when they are compared with `!=`âthe additional point to consider in this case being that returning `True` would be âwrongâ if we haven't proved that the elements are different


Again, if those elements don't coerce to a common parent, they cannot be equal.

> * Regarding non-`Element`s:
>   * The coercion framework treats some specific types essentially like `Element`. We need to be consistent with that


As far as I know, we are consistent.

> but still allow users to define new types that implement their own comparison logic with Sage elements.
> * `richcmp()` currently does that by calling `tp_richcompare()` on the non-`Element`, instead of returning `NotImplemented`.


Exactly.

> I'm not 100% comfortable with this choice. I assume that the goal to get the same behavior under Python 2 and 3


Exactly. Returning `NotImplemented` causes different behavior on Python 2 and Python 3.

> I'm a bit confused here, because (unless I misunderstood you) you argued against that choice two years ago.


I don't remember precisely. Anyway, I changed my mind and I'm convinced now that raising an error is the right thing to do.



---

archive/issue_comments_321884.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-02-11T23:06:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22029#issuecomment-321884",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_057995.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-02-11T23:06:53Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/22029",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22029#event-57995"
}
```
