# Issue 22608: Remove PYTHONPATH environment variable from sage

archive/issues_022371.json:
```json
{
    "body": "Following sage-devel PYTHONPATH breaks Python3[https://groups.google.com/forum/#!topic/sage-devel/ITtF1vWIxIk](https://groups.google.com/forum/#!topic/sage-devel/ITtF1vWIxIk)\n\nHaving PYTHONPATH sets as an environment variable is reported to be incompatible with the installation of both Python2 and Python3 and with the use of gdb to debug.\n\nWe should remove the setting of the PYTHONPATH environment variable\n\n**Assignee:** @vinklein\n\n**CC:**  @videlec @embray\n\n**Keywords:** PYTHONPATH\n\n**Branch:** [3b9cad2e2459aafd6adbab55b2028efbebda8e7a](https://github.com/sagemath/sagetrac-mirror/commit/3b9cad2e2459aafd6adbab55b2028efbebda8e7a)\n\n**Reviewer:** Vincent Delecroix\n\n**Author:** Vincent Klein, Volker Braun\n\nIssue created by migration from https://trac.sagemath.org/ticket/22608\n\n",
    "closed_at": "2017-04-05T19:37:46Z",
    "created_at": "2017-03-15T17:58:05Z",
    "labels": [
        "component: misc",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.0",
    "title": "Remove PYTHONPATH environment variable from sage",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/22608",
    "user": "https://github.com/vinklein"
}
```
Following sage-devel PYTHONPATH breaks Python3[https://groups.google.com/forum/#!topic/sage-devel/ITtF1vWIxIk](https://groups.google.com/forum/#!topic/sage-devel/ITtF1vWIxIk)

Having PYTHONPATH sets as an environment variable is reported to be incompatible with the installation of both Python2 and Python3 and with the use of gdb to debug.

We should remove the setting of the PYTHONPATH environment variable

**Assignee:** @vinklein

**CC:**  @videlec @embray

**Keywords:** PYTHONPATH

**Branch:** [3b9cad2e2459aafd6adbab55b2028efbebda8e7a](https://github.com/sagemath/sagetrac-mirror/commit/3b9cad2e2459aafd6adbab55b2028efbebda8e7a)

**Reviewer:** Vincent Delecroix

**Author:** Vincent Klein, Volker Braun

Issue created by migration from https://trac.sagemath.org/ticket/22608





---

archive/issue_comments_337712.json:
```json
{
    "body": "**Assignee:** @vinklein",
    "created_at": "2017-03-15T18:58:16Z",
    "issue": "https://github.com/sagemath/sage/issues/22608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22608#issuecomment-337712",
    "user": "https://github.com/vinklein"
}
```

**Assignee:** @vinklein



---

archive/issue_comments_337713.json:
```json
{
    "body": "**Changing author** from \"vklein\" to \"Vincent Klein\".",
    "created_at": "2017-03-15T19:03:49Z",
    "issue": "https://github.com/sagemath/sage/issues/22608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22608#issuecomment-337713",
    "user": "https://github.com/vinklein"
}
```

**Changing author** from "vklein" to "Vincent Klein".



---

archive/issue_comments_337714.json:
```json
{
    "body": "**Branch:** [u/vklein/remove_pythonpath_environment_variable_from_sage](https://github.com/sagemath/sagetrac-mirror/tree/u/vklein/remove_pythonpath_environment_variable_from_sage)",
    "created_at": "2017-03-16T22:19:11Z",
    "issue": "https://github.com/sagemath/sage/issues/22608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22608#issuecomment-337714",
    "user": "https://github.com/vinklein"
}
```

**Branch:** [u/vklein/remove_pythonpath_environment_variable_from_sage](https://github.com/sagemath/sagetrac-mirror/tree/u/vklein/remove_pythonpath_environment_variable_from_sage)



---

archive/issue_events_201758.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2017-03-16T22:39:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22608",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22608#event-201758"
}
```



---

archive/issue_comments_337715.json:
```json
{
    "body": "<a id='comment:5'></a>\nNote to reviewer : the doctest in all.py has been modified. I choose to modify allowed.append(os.path.join(\"lib\", \"python\", \"multiprocessing\")) into allowed.append(os.path.join(\"multiprocessing\")) rather than allowed.append(os.path.join(\"lib\", \"python2.7\", \"multiprocessing\")) in order to stay compatible with future python version. \n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/22e470c2d6941875908f35ff3657843f1fe83f21\">22e470c</a></td><td><code>Remove PYTHONPATH env variable and adapt doctest in all.py</code></td></tr></table>\n",
    "created_at": "2017-03-16T22:39:48Z",
    "issue": "https://github.com/sagemath/sage/issues/22608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22608#issuecomment-337715",
    "user": "https://github.com/vinklein"
}
```

<a id='comment:5'></a>
Note to reviewer : the doctest in all.py has been modified. I choose to modify allowed.append(os.path.join("lib", "python", "multiprocessing")) into allowed.append(os.path.join("multiprocessing")) rather than allowed.append(os.path.join("lib", "python2.7", "multiprocessing")) in order to stay compatible with future python version. 

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/22e470c2d6941875908f35ff3657843f1fe83f21">22e470c</a></td><td><code>Remove PYTHONPATH env variable and adapt doctest in all.py</code></td></tr></table>




---

archive/issue_comments_337716.json:
```json
{
    "body": "**Commit:** [22e470c2d6941875908f35ff3657843f1fe83f21](https://github.com/sagemath/sagetrac-mirror/commit/22e470c2d6941875908f35ff3657843f1fe83f21)",
    "created_at": "2017-03-16T22:39:48Z",
    "issue": "https://github.com/sagemath/sage/issues/22608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22608#issuecomment-337716",
    "user": "https://github.com/vinklein"
}
```

**Commit:** [22e470c2d6941875908f35ff3657843f1fe83f21](https://github.com/sagemath/sagetrac-mirror/commit/22e470c2d6941875908f35ff3657843f1fe83f21)



---

archive/issue_comments_337717.json:
```json
{
    "body": "<a id='comment:6'></a>\nI don't fully understand the impact of this patch or why sage-env was setting `PYTHONPATH` in the first place, so I'm not sure I'm the best to give a review.  But I definitely support this.",
    "created_at": "2017-03-16T23:23:00Z",
    "issue": "https://github.com/sagemath/sage/issues/22608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22608#issuecomment-337717",
    "user": "https://github.com/embray"
}
```

<a id='comment:6'></a>
I don't fully understand the impact of this patch or why sage-env was setting `PYTHONPATH` in the first place, so I'm not sure I'm the best to give a review.  But I definitely support this.



---

archive/issue_comments_337718.json:
```json
{
    "body": "<a id='comment:7'></a>\nI don't understand your changes to `all.py`:\n\n1) What is the reason of this modification? Were the tests failing without it? If not, I would prefer to not touch anything there. You said to \"stay compatible with future Python version\" but did you actually checked this?\n\n2) The aim of `os.path.join` is precisely to *join* several directories and files into a path like\n\n```python\n>>> import os\n>>> os.path.join('my', 'path', 'to', 'my_file.py')\n'my/path/to/my_file.py'\n```\n   if the path would only be one string there is no need to use join\n\n3) If you start touching this, why not modifying at the same time\n\n```\nwallowed = [os.path.join(\"lib\",\"python\",\"threading.py\")]\n```",
    "created_at": "2017-03-17T07:49:35Z",
    "issue": "https://github.com/sagemath/sage/issues/22608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22608#issuecomment-337718",
    "user": "https://github.com/videlec"
}
```

<a id='comment:7'></a>
I don't understand your changes to `all.py`:

1) What is the reason of this modification? Were the tests failing without it? If not, I would prefer to not touch anything there. You said to "stay compatible with future Python version" but did you actually checked this?

2) The aim of `os.path.join` is precisely to *join* several directories and files into a path like

```python
>>> import os
>>> os.path.join('my', 'path', 'to', 'my_file.py')
'my/path/to/my_file.py'
```
   if the path would only be one string there is no need to use join

3) If you start touching this, why not modifying at the same time

```
wallowed = [os.path.join("lib","python","threading.py")]
```



---

archive/issue_events_201759.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-03-17T07:49:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22608",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22608#event-201759"
}
```



---

archive/issue_events_201760.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-03-17T07:49:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22608",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22608#event-201760"
}
```



---

archive/issue_comments_337719.json:
```json
{
    "body": "<a id='comment:8'></a>\n1) Yes the all.py doctest fail without the modification. If PYTHONPATH is set you get the frames\n\\\\\n<sage_path>/local/lib/python/multiprocessing/process.py\\\\\n\n<sage_path>/local/lib/python/multiprocessing/forking.py\\\\\n\n<sage_path>/local/lib/python/multiprocessing/process.py.\\\\\n\nIf PYTHONPATH is not set you get \\\\\n\n<sage_path>/local/lib/python2.7/multiprocessing/process.py\\\\\n\n<sage_path>/local/lib/python2.7/multiprocessing/forking.py\\\\\n\n<sage_path>/local/lib/python2.7/multiprocessing/process.py instead and the old doctest failed.\n\n2) Ok.\n\n3) Basically because i didn't get a matching frame during my tests but that's the case for several other item's of the allowed list. Should we rewrite this doctest with this ticket ?",
    "created_at": "2017-03-17T09:21:02Z",
    "issue": "https://github.com/sagemath/sage/issues/22608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22608#issuecomment-337719",
    "user": "https://github.com/vinklein"
}
```

<a id='comment:8'></a>
1) Yes the all.py doctest fail without the modification. If PYTHONPATH is set you get the frames
\\
<sage_path>/local/lib/python/multiprocessing/process.py\\

<sage_path>/local/lib/python/multiprocessing/forking.py\\

<sage_path>/local/lib/python/multiprocessing/process.py.\\

If PYTHONPATH is not set you get \\

<sage_path>/local/lib/python2.7/multiprocessing/process.py\\

<sage_path>/local/lib/python2.7/multiprocessing/forking.py\\

<sage_path>/local/lib/python2.7/multiprocessing/process.py instead and the old doctest failed.

2) Ok.

3) Basically because i didn't get a matching frame during my tests but that's the case for several other item's of the allowed list. Should we rewrite this doctest with this ticket ?



---

archive/issue_comments_337720.json:
```json
{
    "body": "**Changing commit** from \"[22e470c2d6941875908f35ff3657843f1fe83f21](https://github.com/sagemath/sagetrac-mirror/commit/22e470c2d6941875908f35ff3657843f1fe83f21)\" to \"[0834fa019fe89bca422760a565b467070b406b3a](https://github.com/sagemath/sagetrac-mirror/commit/0834fa019fe89bca422760a565b467070b406b3a)\".",
    "created_at": "2017-03-17T10:47:02Z",
    "issue": "https://github.com/sagemath/sage/issues/22608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22608#issuecomment-337720",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[22e470c2d6941875908f35ff3657843f1fe83f21](https://github.com/sagemath/sagetrac-mirror/commit/22e470c2d6941875908f35ff3657843f1fe83f21)" to "[0834fa019fe89bca422760a565b467070b406b3a](https://github.com/sagemath/sagetrac-mirror/commit/0834fa019fe89bca422760a565b467070b406b3a)".



---

archive/issue_comments_337721.json:
```json
{
    "body": "<a id='comment:9'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0834fa019fe89bca422760a565b467070b406b3a\">0834fa0</a></td><td><code>#all.py allowed.append(os.path.join(\"multiprocessing\")) => allowed.append(\"multiprocessing\")</code></td></tr></table>\n",
    "created_at": "2017-03-17T10:47:02Z",
    "issue": "https://github.com/sagemath/sage/issues/22608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22608#issuecomment-337721",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0834fa019fe89bca422760a565b467070b406b3a">0834fa0</a></td><td><code>#all.py allowed.append(os.path.join("multiprocessing")) => allowed.append("multiprocessing")</code></td></tr></table>




---

archive/issue_comments_337722.json:
```json
{
    "body": "<a id='comment:10'></a>\nReplying to [vklein](#comment%3A8):\n> 1) Yes the all.py doctest fail without the modification. If PYTHONPATH is set you get the frames\n> \n> [...]\n\n\nThen you would better say it in the ticket description!\n\n> 2) Ok.\n> \n> 3) Basically because i didn't get a matching frame during my tests but that's the case for several other item's of the allowed list. Should we rewrite this doctest with this ticket ?\n\n\nDefinitely!",
    "created_at": "2017-03-17T11:50:13Z",
    "issue": "https://github.com/sagemath/sage/issues/22608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22608#issuecomment-337722",
    "user": "https://github.com/videlec"
}
```

<a id='comment:10'></a>
Replying to [vklein](#comment%3A8):
> 1) Yes the all.py doctest fail without the modification. If PYTHONPATH is set you get the frames
> 
> [...]


Then you would better say it in the ticket description!

> 2) Ok.
> 
> 3) Basically because i didn't get a matching frame during my tests but that's the case for several other item's of the allowed list. Should we rewrite this doctest with this ticket ?


Definitely!



---

archive/issue_comments_337723.json:
```json
{
    "body": "<a id='comment:11'></a>\nThere are a handful of other hardcoded local/lib/python/ paths instead of local/lib/pythonx.y/ in the Sage sources; They don't hurt us yet but will sooner or later. Its always good to get rid of it and make no assumptions about where a particular python module resides.",
    "created_at": "2017-03-18T15:42:58Z",
    "issue": "https://github.com/sagemath/sage/issues/22608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22608#issuecomment-337723",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:11'></a>
There are a handful of other hardcoded local/lib/python/ paths instead of local/lib/pythonx.y/ in the Sage sources; They don't hurt us yet but will sooner or later. Its always good to get rid of it and make no assumptions about where a particular python module resides.



---

archive/issue_comments_337724.json:
```json
{
    "body": "**Changing branch** from \"[u/vklein/remove_pythonpath_environment_variable_from_sage](https://github.com/sagemath/sagetrac-mirror/tree/u/vklein/remove_pythonpath_environment_variable_from_sage)\" to \"[u/vbraun/remove_pythonpath_environment_variable_from_sage](https://github.com/sagemath/sagetrac-mirror/tree/u/vbraun/remove_pythonpath_environment_variable_from_sage)\".",
    "created_at": "2017-03-18T17:18:37Z",
    "issue": "https://github.com/sagemath/sage/issues/22608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22608#issuecomment-337724",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/vklein/remove_pythonpath_environment_variable_from_sage](https://github.com/sagemath/sagetrac-mirror/tree/u/vklein/remove_pythonpath_environment_variable_from_sage)" to "[u/vbraun/remove_pythonpath_environment_variable_from_sage](https://github.com/sagemath/sagetrac-mirror/tree/u/vbraun/remove_pythonpath_environment_variable_from_sage)".



---

archive/issue_events_201761.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-03-18T17:19:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22608",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22608#event-201761"
}
```



---

archive/issue_events_201762.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-03-18T17:19:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22608",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22608#event-201762"
}
```



---

archive/issue_comments_337725.json:
```json
{
    "body": "<a id='comment:13'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b2d0636df6f7466c12159e235a95f8e6a1f9aa58\">b2d0636</a></td><td><code>Better check for the startup stack frames</code></td></tr></table>\n",
    "created_at": "2017-03-18T17:19:16Z",
    "issue": "https://github.com/sagemath/sage/issues/22608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22608#issuecomment-337725",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:13'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b2d0636df6f7466c12159e235a95f8e6a1f9aa58">b2d0636</a></td><td><code>Better check for the startup stack frames</code></td></tr></table>




---

archive/issue_comments_337726.json:
```json
{
    "body": "**Changing commit** from \"[0834fa019fe89bca422760a565b467070b406b3a](https://github.com/sagemath/sagetrac-mirror/commit/0834fa019fe89bca422760a565b467070b406b3a)\" to \"[b2d0636df6f7466c12159e235a95f8e6a1f9aa58](https://github.com/sagemath/sagetrac-mirror/commit/b2d0636df6f7466c12159e235a95f8e6a1f9aa58)\".",
    "created_at": "2017-03-18T17:19:16Z",
    "issue": "https://github.com/sagemath/sage/issues/22608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22608#issuecomment-337726",
    "user": "https://github.com/vbraun"
}
```

**Changing commit** from "[0834fa019fe89bca422760a565b467070b406b3a](https://github.com/sagemath/sagetrac-mirror/commit/0834fa019fe89bca422760a565b467070b406b3a)" to "[b2d0636df6f7466c12159e235a95f8e6a1f9aa58](https://github.com/sagemath/sagetrac-mirror/commit/b2d0636df6f7466c12159e235a95f8e6a1f9aa58)".



---

archive/issue_comments_337727.json:
```json
{
    "body": "<a id='comment:14'></a>\nI don't like the ellipsis there. It does not catch the fact that only `generating_series` is there. Only that it is first. For example the following is a perfectly valid doctest\n\n```\n    sage: print \"<mod1 hello>, <mod2 hello>, <mod3 hello>\"\n    <mod1 ...>\n```\nYou should also check the length of `[inspect.getmodule(f) for f in frames if is_not_allowed(f)]`.\n\nBTW, do you know why is this module listed there!?",
    "created_at": "2017-03-18T21:53:56Z",
    "issue": "https://github.com/sagemath/sage/issues/22608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22608#issuecomment-337727",
    "user": "https://github.com/videlec"
}
```

<a id='comment:14'></a>
I don't like the ellipsis there. It does not catch the fact that only `generating_series` is there. Only that it is first. For example the following is a perfectly valid doctest

```
    sage: print "<mod1 hello>, <mod2 hello>, <mod3 hello>"
    <mod1 ...>
```
You should also check the length of `[inspect.getmodule(f) for f in frames if is_not_allowed(f)]`.

BTW, do you know why is this module listed there!?



---

archive/issue_comments_337728.json:
```json
{
    "body": "**Changing commit** from \"[b2d0636df6f7466c12159e235a95f8e6a1f9aa58](https://github.com/sagemath/sagetrac-mirror/commit/b2d0636df6f7466c12159e235a95f8e6a1f9aa58)\" to \"[ec259b66d9f6ac91b6190c7640ea347d96630410](https://github.com/sagemath/sagetrac-mirror/commit/ec259b66d9f6ac91b6190c7640ea347d96630410)\".",
    "created_at": "2017-03-18T22:33:32Z",
    "issue": "https://github.com/sagemath/sage/issues/22608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22608#issuecomment-337728",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[b2d0636df6f7466c12159e235a95f8e6a1f9aa58](https://github.com/sagemath/sagetrac-mirror/commit/b2d0636df6f7466c12159e235a95f8e6a1f9aa58)" to "[ec259b66d9f6ac91b6190c7640ea347d96630410](https://github.com/sagemath/sagetrac-mirror/commit/ec259b66d9f6ac91b6190c7640ea347d96630410)".



---

archive/issue_comments_337729.json:
```json
{
    "body": "<a id='comment:15'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ec259b66d9f6ac91b6190c7640ea347d96630410\">ec259b6</a></td><td><code>Get rid of ellipsis in test</code></td></tr></table>\n",
    "created_at": "2017-03-18T22:33:32Z",
    "issue": "https://github.com/sagemath/sage/issues/22608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22608#issuecomment-337729",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ec259b66d9f6ac91b6190c7640ea347d96630410">ec259b6</a></td><td><code>Get rid of ellipsis in test</code></td></tr></table>




---

archive/issue_comments_337730.json:
```json
{
    "body": "<a id='comment:16'></a>\nI don't know why generating_series is there, clearly it shouldn't. But thats not the point of this ticket.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ec259b66d9f6ac91b6190c7640ea347d96630410\">ec259b6</a></td><td><code>Get rid of ellipsis in test</code></td></tr></table>\n",
    "created_at": "2017-03-18T22:34:09Z",
    "issue": "https://github.com/sagemath/sage/issues/22608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22608#issuecomment-337730",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:16'></a>
I don't know why generating_series is there, clearly it shouldn't. But thats not the point of this ticket.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ec259b66d9f6ac91b6190c7640ea347d96630410">ec259b6</a></td><td><code>Get rid of ellipsis in test</code></td></tr></table>




---

archive/issue_comments_337731.json:
```json
{
    "body": "<a id='comment:17'></a>\nI opened #22647 to track the bad apple...",
    "created_at": "2017-03-19T08:34:12Z",
    "issue": "https://github.com/sagemath/sage/issues/22608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22608#issuecomment-337731",
    "user": "https://github.com/videlec"
}
```

<a id='comment:17'></a>
I opened #22647 to track the bad apple...



---

archive/issue_comments_337732.json:
```json
{
    "body": "<a id='comment:18'></a>\nCode looks good to me, but I feel very weakly qualified, and have no time to test.",
    "created_at": "2017-03-21T20:56:42Z",
    "issue": "https://github.com/sagemath/sage/issues/22608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22608#issuecomment-337732",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:18'></a>
Code looks good to me, but I feel very weakly qualified, and have no time to test.



---

archive/issue_events_201763.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-03-27T16:20:23Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22608",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22608#event-201763"
}
```



---

archive/issue_events_201764.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-03-27T16:20:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22608",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22608#event-201764"
}
```



---

archive/issue_comments_337733.json:
```json
{
    "body": "**Reviewer:** Vincent Delecroix",
    "created_at": "2017-03-27T16:20:23Z",
    "issue": "https://github.com/sagemath/sage/issues/22608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22608#issuecomment-337733",
    "user": "https://github.com/videlec"
}
```

**Reviewer:** Vincent Delecroix



---

archive/issue_events_201765.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-03-27T16:20:23Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/22608",
    "milestone": "sage-7.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22608#event-201765"
}
```



---

archive/issue_events_201766.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-03-27T16:20:23Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/22608",
    "milestone": "sage-8.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22608#event-201766"
}
```



---

archive/issue_comments_337734.json:
```json
{
    "body": "**Changing author** from \"Vincent Klein\" to \"Vincent Klein, Volker Braun\".",
    "created_at": "2017-03-27T16:20:23Z",
    "issue": "https://github.com/sagemath/sage/issues/22608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22608#issuecomment-337734",
    "user": "https://github.com/videlec"
}
```

**Changing author** from "Vincent Klein" to "Vincent Klein, Volker Braun".



---

archive/issue_comments_337735.json:
```json
{
    "body": "<a id='comment:20'></a>\nBreaks on OSX:\n\n```\nmake -j8 base\nmake[2]: warning: -jN forced in submake: disabling jobserver mode.\nsage-logger -p 'sage-spkg patch-2.7.5' '/Users/buildslave-sage/slave/sage_git/build/logs/pkgs/patch-2.7.5.log'\n[patch-2.7.5] Found local metadata for patch-2.7.5\n[patch-2.7.5] ImportError: No module named site\n[patch-2.7.5] ************************************************************************\n[patch-2.7.5] Error downloading patch-2.7.5.tar.gz\n[patch-2.7.5] ************************************************************************\n[patch-2.7.5] Please email sage-devel (http://groups.google.com/group/sage-devel)\n[patch-2.7.5] explaining the problem and including the log file\n[patch-2.7.5]   /Users/buildslave-sage/slave/sage_git/build/logs/pkgs/patch-2.7.5.log\n[patch-2.7.5] Describe your computer, operating system, etc.\n[patch-2.7.5] ************************************************************************\n```\nShorter test\n\n```\n./sage -p patch\nFound local metadata for patch-2.7.5\nImportError: No module named site\n************************************************************************\nError downloading patch-2.7.5.tar.gz\n************************************************************************\n```",
    "created_at": "2017-04-02T12:12:49Z",
    "issue": "https://github.com/sagemath/sage/issues/22608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22608#issuecomment-337735",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:20'></a>
Breaks on OSX:

```
make -j8 base
make[2]: warning: -jN forced in submake: disabling jobserver mode.
sage-logger -p 'sage-spkg patch-2.7.5' '/Users/buildslave-sage/slave/sage_git/build/logs/pkgs/patch-2.7.5.log'
[patch-2.7.5] Found local metadata for patch-2.7.5
[patch-2.7.5] ImportError: No module named site
[patch-2.7.5] ************************************************************************
[patch-2.7.5] Error downloading patch-2.7.5.tar.gz
[patch-2.7.5] ************************************************************************
[patch-2.7.5] Please email sage-devel (http://groups.google.com/group/sage-devel)
[patch-2.7.5] explaining the problem and including the log file
[patch-2.7.5]   /Users/buildslave-sage/slave/sage_git/build/logs/pkgs/patch-2.7.5.log
[patch-2.7.5] Describe your computer, operating system, etc.
[patch-2.7.5] ************************************************************************
```
Shorter test

```
./sage -p patch
Found local metadata for patch-2.7.5
ImportError: No module named site
************************************************************************
Error downloading patch-2.7.5.tar.gz
************************************************************************
```



---

archive/issue_events_201767.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-04-02T12:12:49Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22608",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22608#event-201767"
}
```



---

archive/issue_events_201768.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-04-02T12:12:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22608",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22608#event-201768"
}
```



---

archive/issue_comments_337736.json:
```json
{
    "body": "<a id='comment:21'></a>\nIn fact its nothing to do with OSX, this kills our ability to call the system python as soon as SAGE_LOCAL is created (which is way sooner in the build process than when we install our own python):\n\n```\nif [ -d \"$SAGE_LOCAL\" ]; then\n    PYTHONHOME=\"$SAGE_LOCAL\"\n    export PYTHONHOME\nfi\n```\nresulting in \n\n```\n$ PYTHONHOME=/foo/bar python\nImportError: No module named site\n```\nIMHO we should just unset PYTHONHOME/PYTHONPATH if they are set (and print a warning that this can't work); Then python will just default to whichever directory is compiled in. The whole PYTHONHOME/PYTHONPATH thing is probably a holdover from the past where we did not clean up paths compiled into binaries.",
    "created_at": "2017-04-02T12:47:43Z",
    "issue": "https://github.com/sagemath/sage/issues/22608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22608#issuecomment-337736",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:21'></a>
In fact its nothing to do with OSX, this kills our ability to call the system python as soon as SAGE_LOCAL is created (which is way sooner in the build process than when we install our own python):

```
if [ -d "$SAGE_LOCAL" ]; then
    PYTHONHOME="$SAGE_LOCAL"
    export PYTHONHOME
fi
```
resulting in 

```
$ PYTHONHOME=/foo/bar python
ImportError: No module named site
```
IMHO we should just unset PYTHONHOME/PYTHONPATH if they are set (and print a warning that this can't work); Then python will just default to whichever directory is compiled in. The whole PYTHONHOME/PYTHONPATH thing is probably a holdover from the past where we did not clean up paths compiled into binaries.



---

archive/issue_comments_337737.json:
```json
{
    "body": "<a id='comment:22'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3b9cad2e2459aafd6adbab55b2028efbebda8e7a\">3b9cad2</a></td><td><code>Remove PYTHONHOME, too</code></td></tr></table>\n",
    "created_at": "2017-04-02T13:11:35Z",
    "issue": "https://github.com/sagemath/sage/issues/22608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22608#issuecomment-337737",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:22'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3b9cad2e2459aafd6adbab55b2028efbebda8e7a">3b9cad2</a></td><td><code>Remove PYTHONHOME, too</code></td></tr></table>




---

archive/issue_comments_337738.json:
```json
{
    "body": "**Changing commit** from \"[ec259b66d9f6ac91b6190c7640ea347d96630410](https://github.com/sagemath/sagetrac-mirror/commit/ec259b66d9f6ac91b6190c7640ea347d96630410)\" to \"[3b9cad2e2459aafd6adbab55b2028efbebda8e7a](https://github.com/sagemath/sagetrac-mirror/commit/3b9cad2e2459aafd6adbab55b2028efbebda8e7a)\".",
    "created_at": "2017-04-02T13:11:35Z",
    "issue": "https://github.com/sagemath/sage/issues/22608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22608#issuecomment-337738",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[ec259b66d9f6ac91b6190c7640ea347d96630410](https://github.com/sagemath/sagetrac-mirror/commit/ec259b66d9f6ac91b6190c7640ea347d96630410)" to "[3b9cad2e2459aafd6adbab55b2028efbebda8e7a](https://github.com/sagemath/sagetrac-mirror/commit/3b9cad2e2459aafd6adbab55b2028efbebda8e7a)".



---

archive/issue_events_201769.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-04-02T13:12:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22608",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22608#event-201769"
}
```



---

archive/issue_events_201770.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-04-02T13:12:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22608",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22608#event-201770"
}
```



---

archive/issue_events_201771.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-04-03T07:03:07Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22608",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22608#event-201771"
}
```



---

archive/issue_events_201772.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-04-03T07:03:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22608",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22608#event-201772"
}
```



---

archive/issue_comments_337739.json:
```json
{
    "body": "<a id='comment:24'></a>\nFine be me.",
    "created_at": "2017-04-03T07:03:07Z",
    "issue": "https://github.com/sagemath/sage/issues/22608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22608#issuecomment-337739",
    "user": "https://github.com/embray"
}
```

<a id='comment:24'></a>
Fine be me.



---

archive/issue_events_201773.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-04-05T19:37:46Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22608",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22608#event-201773"
}
```



---

archive/issue_events_201774.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "6281da03a276c1a4826be5f11e89b8c0a7d568fd",
    "created_at": "2017-04-05T19:37:46Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/22608",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22608#event-201774"
}
```



---

archive/issue_comments_337740.json:
```json
{
    "body": "**Changing branch** from \"[u/vbraun/remove_pythonpath_environment_variable_from_sage](https://github.com/sagemath/sagetrac-mirror/tree/u/vbraun/remove_pythonpath_environment_variable_from_sage)\" to \"[3b9cad2e2459aafd6adbab55b2028efbebda8e7a](https://github.com/sagemath/sagetrac-mirror/commit/3b9cad2e2459aafd6adbab55b2028efbebda8e7a)\".",
    "created_at": "2017-04-05T19:37:46Z",
    "issue": "https://github.com/sagemath/sage/issues/22608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22608#issuecomment-337740",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/vbraun/remove_pythonpath_environment_variable_from_sage](https://github.com/sagemath/sagetrac-mirror/tree/u/vbraun/remove_pythonpath_environment_variable_from_sage)" to "[3b9cad2e2459aafd6adbab55b2028efbebda8e7a](https://github.com/sagemath/sagetrac-mirror/commit/3b9cad2e2459aafd6adbab55b2028efbebda8e7a)".



---

archive/issue_comments_337741.json:
```json
{
    "body": "**Changing commit** from \"[3b9cad2e2459aafd6adbab55b2028efbebda8e7a](https://github.com/sagemath/sagetrac-mirror/commit/3b9cad2e2459aafd6adbab55b2028efbebda8e7a)\" to \"\".",
    "created_at": "2017-08-11T19:30:55Z",
    "issue": "https://github.com/sagemath/sage/issues/22608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22608#issuecomment-337741",
    "user": "https://github.com/koffie"
}
```

**Changing commit** from "[3b9cad2e2459aafd6adbab55b2028efbebda8e7a](https://github.com/sagemath/sagetrac-mirror/commit/3b9cad2e2459aafd6adbab55b2028efbebda8e7a)" to "".



---

archive/issue_comments_337742.json:
```json
{
    "body": "<a id='comment:26'></a>\nAfter this ticket the use of `$SAGE_PATH` broke which is still documented so I created the follow up ticket #23614",
    "created_at": "2017-08-11T19:30:55Z",
    "issue": "https://github.com/sagemath/sage/issues/22608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22608#issuecomment-337742",
    "user": "https://github.com/koffie"
}
```

<a id='comment:26'></a>
After this ticket the use of `$SAGE_PATH` broke which is still documented so I created the follow up ticket #23614
