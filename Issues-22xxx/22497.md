# Issue 22497: generic latte_int interface to count

archive/issues_022260.json:
```json
{
    "body": "We provide a file `sage/interfaces/latte.py` that provides a uniform function `count` to query the LattE program `count` (`integrate` will be dealt with in another ticket). It is used in this ticket to refactor `ehrhart_polynomial` and `integral_points_count`.\n\nPrerequisite for #18232.\n\nCC:  @mkoeppe tmonteil\n\nKeywords: days84\n\nReviewer: Matthias Koeppe\n\nAuthor: Vincent Delecroix\n\nBranch: d5ff154e0bb10e333a3a9c39d3cd20ed9b7b69c2\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/22497\n\n",
    "closed_at": "2017-03-05T15:13:32Z",
    "created_at": "2017-03-02T17:18:18Z",
    "labels": [
        "component: geometry"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.6",
    "title": "generic latte_int interface to count",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22497",
    "user": "https://github.com/videlec"
}
```
We provide a file `sage/interfaces/latte.py` that provides a uniform function `count` to query the LattE program `count` (`integrate` will be dealt with in another ticket). It is used in this ticket to refactor `ehrhart_polynomial` and `integral_points_count`.

Prerequisite for #18232.

CC:  @mkoeppe tmonteil

Keywords: days84

Reviewer: Matthias Koeppe

Author: Vincent Delecroix

Branch: d5ff154e0bb10e333a3a9c39d3cd20ed9b7b69c2

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/22497





---

archive/issue_comments_412262.json:
```json
{
    "body": "Changing keywords from \"\" to \"days84\".",
    "created_at": "2017-03-02T17:19:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22497#issuecomment-412262",
    "user": "https://github.com/videlec"
}
```

Changing keywords from "" to "days84".



---

archive/issue_comments_412263.json:
```json
{
    "body": "<a id='comment:2'></a>\nWhy not putting this in the `interfaces` section ?",
    "created_at": "2017-03-02T17:32:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22497#issuecomment-412263",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:2'></a>
Why not putting this in the `interfaces` section ?



---

archive/issue_comments_412264.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n-We provide a file `sage/geometry/polyhedron/latte.py` that provides a uniform function `latte_count` to query the LattE program `count` (`integrate` will be dealt with in another ticket). It is used in this ticket to refactor `ehrhart_polynomial` and `integral_points_count`.\n+We provide a file `sage/interfaces/latte.py` that provides a uniform function `count` to query the LattE program `count` (`integrate` will be dealt with in another ticket). It is used in this ticket to refactor `ehrhart_polynomial` and `integral_points_count`.\n \n Prerequisite for #18232.\n``````\n",
    "created_at": "2017-03-02T23:02:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22497#issuecomment-412264",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
-We provide a file `sage/geometry/polyhedron/latte.py` that provides a uniform function `latte_count` to query the LattE program `count` (`integrate` will be dealt with in another ticket). It is used in this ticket to refactor `ehrhart_polynomial` and `integral_points_count`.
+We provide a file `sage/interfaces/latte.py` that provides a uniform function `count` to query the LattE program `count` (`integrate` will be dealt with in another ticket). It is used in this ticket to refactor `ehrhart_polynomial` and `integral_points_count`.
 
 Prerequisite for #18232.
``````




---

archive/issue_comments_412265.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-03-02T23:02:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22497#issuecomment-412265",
    "user": "https://github.com/videlec"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_412266.json:
```json
{
    "body": "Changing commit from \"\" to \"be2de2152162d886860df5fc5bfbddb15231e23e\"",
    "created_at": "2017-03-02T23:02:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22497#issuecomment-412266",
    "user": "https://github.com/videlec"
}
```

Changing commit from "" to "be2de2152162d886860df5fc5bfbddb15231e23e"



---

archive/issue_comments_412267.json:
```json
{
    "body": "<a id='comment:4'></a>\nNew commits:\n|                                                                                                                                          |                                                                 |\n|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------|\n|[be2de21](https://github.com/sagemath/sagetrac-mirror/commit/be2de2152162d886860df5fc5bfbddb15231e23e)|`22497: generic interface to LattE integrale count22497: generic`|",
    "created_at": "2017-03-02T23:02:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22497#issuecomment-412267",
    "user": "https://github.com/videlec"
}
```

<a id='comment:4'></a>
New commits:
|                                                                                                                                          |                                                                 |
|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------|
|[be2de21](https://github.com/sagemath/sagetrac-mirror/commit/be2de2152162d886860df5fc5bfbddb15231e23e)|`22497: generic interface to LattE integrale count22497: generic`|



---

archive/issue_comments_412268.json:
```json
{
    "body": "Changing branch from \"\" to \"u/vdelecroix/22497\"",
    "created_at": "2017-03-02T23:02:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22497#issuecomment-412268",
    "user": "https://github.com/videlec"
}
```

Changing branch from "" to "u/vdelecroix/22497"



---

archive/issue_comments_412269.json:
```json
{
    "body": "Changing commit from \"be2de2152162d886860df5fc5bfbddb15231e23e\" to \"cf9f0de7527fa26b9c9d86d8a208c9e99d3071bc\"",
    "created_at": "2017-03-02T23:02:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22497#issuecomment-412269",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "be2de2152162d886860df5fc5bfbddb15231e23e" to "cf9f0de7527fa26b9c9d86d8a208c9e99d3071bc"



---

archive/issue_comments_412270.json:
```json
{
    "body": "<a id='comment:5'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                           |                                                   |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------|\n|[cf9f0de](https://github.com/sagemath/sagetrac-mirror/commit/cf9f0de7527fa26b9c9d86d8a208c9e99d3071bc)|`22497: generic interface to LattE integrale count`|",
    "created_at": "2017-03-02T23:02:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22497#issuecomment-412270",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                           |                                                   |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------|
|[cf9f0de](https://github.com/sagemath/sagetrac-mirror/commit/cf9f0de7527fa26b9c9d86d8a208c9e99d3071bc)|`22497: generic interface to LattE integrale count`|



---

archive/issue_comments_412271.json:
```json
{
    "body": "Changing commit from \"cf9f0de7527fa26b9c9d86d8a208c9e99d3071bc\" to \"9a0d0a278adb1d7dd3e3128945b9a42d490fc408\"",
    "created_at": "2017-03-02T23:04:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22497#issuecomment-412271",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "cf9f0de7527fa26b9c9d86d8a208c9e99d3071bc" to "9a0d0a278adb1d7dd3e3128945b9a42d490fc408"



---

archive/issue_comments_412272.json:
```json
{
    "body": "<a id='comment:6'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                           |                                                   |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------|\n|[9a0d0a2](https://github.com/sagemath/sagetrac-mirror/commit/9a0d0a278adb1d7dd3e3128945b9a42d490fc408)|`22497: generic interface to LattE integrale count`|",
    "created_at": "2017-03-02T23:04:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22497#issuecomment-412272",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                           |                                                   |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------|
|[9a0d0a2](https://github.com/sagemath/sagetrac-mirror/commit/9a0d0a278adb1d7dd3e3128945b9a42d490fc408)|`22497: generic interface to LattE integrale count`|



---

archive/issue_comments_412273.json:
```json
{
    "body": "<a id='comment:7'></a>\nKeyword arguments should be provided (perhaps via decorator) for the benefit of tab completion.",
    "created_at": "2017-03-03T16:38:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22497#issuecomment-412273",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:7'></a>
Keyword arguments should be provided (perhaps via decorator) for the benefit of tab completion.



---

archive/issue_comments_412274.json:
```json
{
    "body": "<a id='comment:8'></a>\nReplying to [mkoeppe](#comment%3A7):\n> Keyword arguments should be provided (perhaps via decorator) for the benefit of tab completion.\n\n\nThis would be nice to have but not implemented. Did you have something in mind? The implementation I have in mind is a kind of challenge since you have to play with the bytecode of the function...",
    "created_at": "2017-03-04T09:05:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22497#issuecomment-412274",
    "user": "https://github.com/videlec"
}
```

<a id='comment:8'></a>
Replying to [mkoeppe](#comment%3A7):
> Keyword arguments should be provided (perhaps via decorator) for the benefit of tab completion.


This would be nice to have but not implemented. Did you have something in mind? The implementation I have in mind is a kind of challenge since you have to play with the bytecode of the function...



---

archive/issue_comments_412275.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Matthias Koeppe\"",
    "created_at": "2017-03-04T09:13:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22497#issuecomment-412275",
    "user": "https://github.com/mkoeppe"
}
```

Changing reviewer from "" to "Matthias Koeppe"



---

archive/issue_comments_412276.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-03-04T09:13:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22497#issuecomment-412276",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_412277.json:
```json
{
    "body": "<a id='comment:9'></a>\nOK, separate ticket then",
    "created_at": "2017-03-04T09:13:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22497#issuecomment-412277",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:9'></a>
OK, separate ticket then



---

archive/issue_comments_412278.json:
```json
{
    "body": "<a id='comment:10'></a>\nI have one failure when `latte_int` is not installed\n\n```\nsage -t --long /usr/lib64/python2.7/site-packages/sage/interfaces/latte.py\n**********************************************************************\nFile \"/usr/lib64/python2.7/site-packages/sage/interfaces/latte.py\", line 51, in sage.interfaces.latte.count\nFailed example:\n    count(P.cdd_Hrepresentation(), cdd=True, ehrhart_polynomial=True)\nException raised:\n    Traceback (most recent call last):\n      File \"/usr/lib64/python2.7/site-packages/sage/doctest/forker.py\", line 501, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/usr/lib64/python2.7/site-packages/sage/doctest/forker.py\", line 864, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.interfaces.latte.count[2]>\", line 1, in <module>\n        count(P.cdd_Hrepresentation(), cdd=True, ehrhart_polynomial=True)\n      File \"/usr/lib64/python2.7/site-packages/sage/interfaces/latte.py\", line 149, in count\n        raise RuntimeError(\"LattE integrale program failed (exit code {})\".format(ret_code) + err.strip())\n    RuntimeError: LattE integrale program failed (exit code 2):\n    usage: count <expected line count>\n**********************************************************************\n1 item had failures:\n```\nI see this test is not marked `optional`, is it normal?",
    "created_at": "2017-03-04T20:09:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22497#issuecomment-412278",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:10'></a>
I have one failure when `latte_int` is not installed

```
sage -t --long /usr/lib64/python2.7/site-packages/sage/interfaces/latte.py
**********************************************************************
File "/usr/lib64/python2.7/site-packages/sage/interfaces/latte.py", line 51, in sage.interfaces.latte.count
Failed example:
    count(P.cdd_Hrepresentation(), cdd=True, ehrhart_polynomial=True)
Exception raised:
    Traceback (most recent call last):
      File "/usr/lib64/python2.7/site-packages/sage/doctest/forker.py", line 501, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/lib64/python2.7/site-packages/sage/doctest/forker.py", line 864, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.interfaces.latte.count[2]>", line 1, in <module>
        count(P.cdd_Hrepresentation(), cdd=True, ehrhart_polynomial=True)
      File "/usr/lib64/python2.7/site-packages/sage/interfaces/latte.py", line 149, in count
        raise RuntimeError("LattE integrale program failed (exit code {})".format(ret_code) + err.strip())
    RuntimeError: LattE integrale program failed (exit code 2):
    usage: count <expected line count>
**********************************************************************
1 item had failures:
```
I see this test is not marked `optional`, is it normal?



---

archive/issue_comments_412279.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-03-04T21:30:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22497#issuecomment-412279",
    "user": "https://github.com/videlec"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_412280.json:
```json
{
    "body": "<a id='comment:11'></a>\nit is not. Thanks for testing.",
    "created_at": "2017-03-04T21:30:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22497#issuecomment-412280",
    "user": "https://github.com/videlec"
}
```

<a id='comment:11'></a>
it is not. Thanks for testing.



---

archive/issue_comments_412281.json:
```json
{
    "body": "Changing commit from \"9a0d0a278adb1d7dd3e3128945b9a42d490fc408\" to \"d5ff154e0bb10e333a3a9c39d3cd20ed9b7b69c2\"",
    "created_at": "2017-03-04T21:48:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22497#issuecomment-412281",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "9a0d0a278adb1d7dd3e3128945b9a42d490fc408" to "d5ff154e0bb10e333a3a9c39d3cd20ed9b7b69c2"



---

archive/issue_comments_412282.json:
```json
{
    "body": "<a id='comment:12'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                           |                                                   |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------|\n|[d5ff154](https://github.com/sagemath/sagetrac-mirror/commit/d5ff154e0bb10e333a3a9c39d3cd20ed9b7b69c2)|`22497: generic interface to LattE integrale count`|",
    "created_at": "2017-03-04T21:48:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22497#issuecomment-412282",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                           |                                                   |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------|
|[d5ff154](https://github.com/sagemath/sagetrac-mirror/commit/d5ff154e0bb10e333a3a9c39d3cd20ed9b7b69c2)|`22497: generic interface to LattE integrale count`|



---

archive/issue_comments_412283.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2017-03-04T21:53:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22497#issuecomment-412283",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_412284.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-03-05T15:13:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22497#issuecomment-412284",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_412285.json:
```json
{
    "body": "Changing branch from \"u/vdelecroix/22497\" to \"d5ff154e0bb10e333a3a9c39d3cd20ed9b7b69c2\"",
    "created_at": "2017-03-05T15:13:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22497#issuecomment-412285",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/vdelecroix/22497" to "d5ff154e0bb10e333a3a9c39d3cd20ed9b7b69c2"



---

archive/issue_events_074682.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-03-05T15:13:32Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/22497",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22497#event-74682"
}
```



---

archive/issue_comments_412286.json:
```json
{
    "body": "Changing commit from \"d5ff154e0bb10e333a3a9c39d3cd20ed9b7b69c2\" to \"\"",
    "created_at": "2017-03-17T09:00:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22497#issuecomment-412286",
    "user": "https://github.com/seblabbe"
}
```

Changing commit from "d5ff154e0bb10e333a3a9c39d3cd20ed9b7b69c2" to ""



---

archive/issue_comments_412287.json:
```json
{
    "body": "<a id='comment:15'></a>\nWhen looking at this branch, I could not understand how the problem solved in #21491 was not reappearing. I tested 7.6.rc0 and everything was fine so I could not understand. I just realized the existence of #22577 which is a follow up of this ticket. So now I understand everything, and everything is great, thank you!",
    "created_at": "2017-03-17T09:00:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22497#issuecomment-412287",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:15'></a>
When looking at this branch, I could not understand how the problem solved in #21491 was not reappearing. I tested 7.6.rc0 and everything was fine so I could not understand. I just realized the existence of #22577 which is a follow up of this ticket. So now I understand everything, and everything is great, thank you!
