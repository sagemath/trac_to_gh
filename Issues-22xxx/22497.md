# Issue 22497: generic latte_int interface to count

archive/issues_022260.json:
```json
{
    "body": "We provide a file `sage/interfaces/latte.py` that provides a uniform function `count` to query the LattE program `count` (`integrate` will be dealt with in another ticket). It is used in this ticket to refactor `ehrhart_polynomial` and `integral_points_count`.\n\nPrerequisite for #18232.\n\nCC:  @mkoeppe tmonteil\n\nKeywords: days84\n\nReviewer: Matthias Koeppe\n\nAuthor: Vincent Delecroix\n\nBranch: d5ff154e0bb10e333a3a9c39d3cd20ed9b7b69c2\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/22497\n\n",
    "closed_at": "2017-03-05T15:13:32Z",
    "created_at": "2017-03-02T17:18:18Z",
    "labels": [
        "component: geometry"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.6",
    "title": "generic latte_int interface to count",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22497",
    "user": "https://github.com/videlec"
}
```
We provide a file `sage/interfaces/latte.py` that provides a uniform function `count` to query the LattE program `count` (`integrate` will be dealt with in another ticket). It is used in this ticket to refactor `ehrhart_polynomial` and `integral_points_count`.

Prerequisite for #18232.

CC:  @mkoeppe tmonteil

Keywords: days84

Reviewer: Matthias Koeppe

Author: Vincent Delecroix

Branch: d5ff154e0bb10e333a3a9c39d3cd20ed9b7b69c2

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/22497





---

archive/issue_comments_308961.json:
```json
{
    "body": "Changing keywords from \"\" to \"days84\".",
    "created_at": "2017-03-02T17:19:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22497#issuecomment-308961",
    "user": "https://github.com/videlec"
}
```

Changing keywords from "" to "days84".



---

archive/issue_comments_308962.json:
```json
{
    "body": "<a id='comment:2'></a>Why not putting this in the `interfaces` section ?",
    "created_at": "2017-03-02T17:32:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22497#issuecomment-308962",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:2'></a>Why not putting this in the `interfaces` section ?



---

archive/issue_comments_308963.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-03-02T23:02:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22497#issuecomment-308963",
    "user": "https://github.com/videlec"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_308964.json:
```json
{
    "body": "<a id='comment:4'></a>New commits:",
    "created_at": "2017-03-02T23:02:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22497#issuecomment-308964",
    "user": "https://github.com/videlec"
}
```

<a id='comment:4'></a>New commits:



---

archive/issue_comments_308965.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-03-02T23:02:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22497#issuecomment-308965",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_308966.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-03-02T23:04:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22497#issuecomment-308966",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_308967.json:
```json
{
    "body": "<a id='comment:7'></a>Keyword arguments should be provided (perhaps via decorator) for the benefit of tab completion.",
    "created_at": "2017-03-03T16:38:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22497#issuecomment-308967",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:7'></a>Keyword arguments should be provided (perhaps via decorator) for the benefit of tab completion.



---

archive/issue_comments_308968.json:
```json
{
    "body": "<a id='comment:8'></a>Replying to [comment:7 mkoeppe]:\n> Keyword arguments should be provided (perhaps via decorator) for the benefit of tab completion.\n\n\nThis would be nice to have but not implemented. Did you have something in mind? The implementation I have in mind is a kind of challenge since you have to play with the bytecode of the function...",
    "created_at": "2017-03-04T09:05:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22497#issuecomment-308968",
    "user": "https://github.com/videlec"
}
```

<a id='comment:8'></a>Replying to [comment:7 mkoeppe]:
> Keyword arguments should be provided (perhaps via decorator) for the benefit of tab completion.


This would be nice to have but not implemented. Did you have something in mind? The implementation I have in mind is a kind of challenge since you have to play with the bytecode of the function...



---

archive/issue_comments_308969.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-03-04T09:13:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22497#issuecomment-308969",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_308970.json:
```json
{
    "body": "<a id='comment:9'></a>OK, separate ticket then",
    "created_at": "2017-03-04T09:13:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22497#issuecomment-308970",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:9'></a>OK, separate ticket then



---

archive/issue_comments_308971.json:
```json
{
    "body": "<a id='comment:10'></a>I have one failure when `latte_int` is not installed\n\n```\nsage -t --long /usr/lib64/python2.7/site-packages/sage/interfaces/latte.py\n**********************************************************************\nFile \"/usr/lib64/python2.7/site-packages/sage/interfaces/latte.py\", line 51, in sage.interfaces.latte.count\nFailed example:\n    count(P.cdd_Hrepresentation(), cdd=True, ehrhart_polynomial=True)\nException raised:\n    Traceback (most recent call last):\n      File \"/usr/lib64/python2.7/site-packages/sage/doctest/forker.py\", line 501, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/usr/lib64/python2.7/site-packages/sage/doctest/forker.py\", line 864, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.interfaces.latte.count[2]>\", line 1, in <module>\n        count(P.cdd_Hrepresentation(), cdd=True, ehrhart_polynomial=True)\n      File \"/usr/lib64/python2.7/site-packages/sage/interfaces/latte.py\", line 149, in count\n        raise RuntimeError(\"LattE integrale program failed (exit code {})\".format(ret_code) + err.strip())\n    RuntimeError: LattE integrale program failed (exit code 2):\n    usage: count <expected line count>\n**********************************************************************\n1 item had failures:\n```\nI see this test is not marked `optional`, is it normal?",
    "created_at": "2017-03-04T20:09:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22497#issuecomment-308971",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:10'></a>I have one failure when `latte_int` is not installed

```
sage -t --long /usr/lib64/python2.7/site-packages/sage/interfaces/latte.py
**********************************************************************
File "/usr/lib64/python2.7/site-packages/sage/interfaces/latte.py", line 51, in sage.interfaces.latte.count
Failed example:
    count(P.cdd_Hrepresentation(), cdd=True, ehrhart_polynomial=True)
Exception raised:
    Traceback (most recent call last):
      File "/usr/lib64/python2.7/site-packages/sage/doctest/forker.py", line 501, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/lib64/python2.7/site-packages/sage/doctest/forker.py", line 864, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.interfaces.latte.count[2]>", line 1, in <module>
        count(P.cdd_Hrepresentation(), cdd=True, ehrhart_polynomial=True)
      File "/usr/lib64/python2.7/site-packages/sage/interfaces/latte.py", line 149, in count
        raise RuntimeError("LattE integrale program failed (exit code {})".format(ret_code) + err.strip())
    RuntimeError: LattE integrale program failed (exit code 2):
    usage: count <expected line count>
**********************************************************************
1 item had failures:
```
I see this test is not marked `optional`, is it normal?



---

archive/issue_comments_308972.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-03-04T21:30:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22497#issuecomment-308972",
    "user": "https://github.com/videlec"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_308973.json:
```json
{
    "body": "<a id='comment:11'></a>it is not. Thanks for testing.",
    "created_at": "2017-03-04T21:30:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22497#issuecomment-308973",
    "user": "https://github.com/videlec"
}
```

<a id='comment:11'></a>it is not. Thanks for testing.



---

archive/issue_comments_308974.json:
```json
{
    "body": "<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-03-04T21:48:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22497#issuecomment-308974",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_308975.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2017-03-04T21:53:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22497#issuecomment-308975",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_308976.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-03-05T15:13:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22497#issuecomment-308976",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_058801.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-03-05T15:13:32Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/22497",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22497#event-58801"
}
```



---

archive/issue_comments_308977.json:
```json
{
    "body": "<a id='comment:15'></a>When looking at this branch, I could not understand how the problem solved in #21491 was not reappearing. I tested 7.6.rc0 and everything was fine so I could not understand. I just realized the existence of #22577 which is a follow up of this ticket. So now I understand everything, and everything is great, thank you!",
    "created_at": "2017-03-17T09:00:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22497#issuecomment-308977",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:15'></a>When looking at this branch, I could not understand how the problem solved in #21491 was not reappearing. I tested 7.6.rc0 and everything was fine so I could not understand. I just realized the existence of #22577 which is a follow up of this ticket. So now I understand everything, and everything is great, thank you!
