# Issue 22756: Python3 is broken on OS X

archive/issues_022519.json:
```json
{
    "assignees": [],
    "body": "On OS X, Python3 sometimes fails to build correctly. To fix this:\n\n- make `xz` a dependency: not necessary for Python 3 to build, but this way it builds the `_lzma` module.\n\n- use `clang` to compile Python 3, as we do for Python 2. Without this, the `_scproxy` module fails to build.\n\n- patch `Include/pyport.h` as we do for Python 2 -- see #22147, and also https://trac.macports.org/ticket/44288 and \u200bhttp://bugs.python.org/issue10910.\n\n- do not create a symlink `SAGE_LOCAL/lib/python` -- see #22764. If this symlink is in place and if Python 2 is built before Python 3, then Python 3 picks up that link in its load path, and so it tries to read a lot of Python 2 packages, which is bad.\n\n- see also #22781 which tracks a few other issues related to Python 3, OS X, and Sage packages.\n\n\n\nDepends on #22764\n\nBranch/Commit: **[6762fe4](https://github.com/sagemath/sagetrac-mirror/commit/6762fe4bced21a095fc20942e12500a5654b4e34)**\n\nReviewer: **Fran\u00e7ois Bissey**\n\nAuthor: **John Palmieri**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/22756_\n\n",
    "closed_at": "2017-04-28T23:54:50Z",
    "created_at": "2017-04-04T21:39:20Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20python3",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.0",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Python3 is broken on OS X",
    "type": "issue",
    "updated_at": "2017-04-28T23:54:50Z",
    "url": "https://github.com/sagemath/sage/issues/22756",
    "user": "https://github.com/jhpalmieri"
}
```
On OS X, Python3 sometimes fails to build correctly. To fix this:

- make `xz` a dependency: not necessary for Python 3 to build, but this way it builds the `_lzma` module.

- use `clang` to compile Python 3, as we do for Python 2. Without this, the `_scproxy` module fails to build.

- patch `Include/pyport.h` as we do for Python 2 -- see #22147, and also https://trac.macports.org/ticket/44288 and ​http://bugs.python.org/issue10910.

- do not create a symlink `SAGE_LOCAL/lib/python` -- see #22764. If this symlink is in place and if Python 2 is built before Python 3, then Python 3 picks up that link in its load path, and so it tries to read a lot of Python 2 packages, which is bad.

- see also #22781 which tracks a few other issues related to Python 3, OS X, and Sage packages.



Depends on #22764

Branch/Commit: **[6762fe4](https://github.com/sagemath/sagetrac-mirror/commit/6762fe4bced21a095fc20942e12500a5654b4e34)**

Reviewer: **François Bissey**

Author: **John Palmieri**

_Issue created by migration from https://trac.sagemath.org/ticket/22756_





---

archive/issue_events_299675.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2017-04-04T21:39:20Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/22756",
    "milestone_number": null,
    "milestone_title": "sage-8.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22756#event-299675"
}
```



---

archive/issue_events_299676.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2017-04-04T21:39:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22756",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20packages%3A%20standard",
    "label_color": "000080",
    "label_name": "component: packages: standard",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22756#event-299676"
}
```



---

archive/issue_events_299677.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2017-04-04T21:39:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22756",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22756#event-299677"
}
```



---

archive/issue_events_299678.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2017-04-04T21:39:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22756",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22756#event-299678"
}
```



---

archive/issue_comments_341385.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,15 @@\n-On OS X:\n+On OS X, Python3 sometimes fails to build correctly. I think it depends on whether Python2 is built first or not. Even if it seems to build correctly, then the `_scproxy` module is broken.\n+\n+Examples (all start with `make distclean`):\n+\n+- `./sage -i python3`. Then `python3` works, but the `_scproxy` and `_lzma` modules fail to build. The error for `_lzma` is\n+\n+```\n+/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.0.beta0/local/var/tmp/sage/build/python3-3.5.1/src/Modules/_lzmamodule.c:19:18: fatal error: lzma.h: No such file or directory\n+```\n+ We can fix this by making `xz` a dependency. Is it important? `xz` doesn't take long to build and doesn't have any dependencies of its own, so why not?\n+\n+- `./sage -i python2; ./sage -i python3`: then Python3 fails with the error \n \n ```\n $ sage --sh\n@@ -13,3 +24,8 @@\n Abort trap: 6\n ```\n \n+- if we build Python3 with `clang`, the way we do with Python2, then as long as we haven't build Python2 first, it works and `_scproxy` builds properly. `_lzma` doesn't, but we can fix that.\n+\n+- if we build Python3 with `clang` but we build Python2 first, then we get the same error as above.\n+\n+So I propose that we build Python3 with `clang` and we make `xz` a dependency. I don't know why the Python2 and Python3 builds interfere with each other. We could make `python3` a dependency of `python2`, to force `python3` to be built first, but that feels like treating the symptom, not the problem.\n``````\n",
    "created_at": "2017-04-05T02:56:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22756#issuecomment-341385",
    "user": "https://github.com/jhpalmieri"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,15 @@
-On OS X:
+On OS X, Python3 sometimes fails to build correctly. I think it depends on whether Python2 is built first or not. Even if it seems to build correctly, then the `_scproxy` module is broken.
+
+Examples (all start with `make distclean`):
+
+- `./sage -i python3`. Then `python3` works, but the `_scproxy` and `_lzma` modules fail to build. The error for `_lzma` is
+
+```
+/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.0.beta0/local/var/tmp/sage/build/python3-3.5.1/src/Modules/_lzmamodule.c:19:18: fatal error: lzma.h: No such file or directory
+```
+ We can fix this by making `xz` a dependency. Is it important? `xz` doesn't take long to build and doesn't have any dependencies of its own, so why not?
+
+- `./sage -i python2; ./sage -i python3`: then Python3 fails with the error 
 
 ```
 $ sage --sh
@@ -13,3 +24,8 @@
 Abort trap: 6
 ```
 
+- if we build Python3 with `clang`, the way we do with Python2, then as long as we haven't build Python2 first, it works and `_scproxy` builds properly. `_lzma` doesn't, but we can fix that.
+
+- if we build Python3 with `clang` but we build Python2 first, then we get the same error as above.
+
+So I propose that we build Python3 with `clang` and we make `xz` a dependency. I don't know why the Python2 and Python3 builds interfere with each other. We could make `python3` a dependency of `python2`, to force `python3` to be built first, but that feels like treating the symptom, not the problem.
``````




---

archive/issue_comments_341386.json:
```json
{
    "body": "Branch: **[u/jhpalmieri/python3_osx](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/python3_osx)**",
    "created_at": "2017-04-05T03:03:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22756#issuecomment-341386",
    "user": "https://github.com/jhpalmieri"
}
```

Branch: **[u/jhpalmieri/python3_osx](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/python3_osx)**



---

archive/issue_comments_341387.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">Comment 3</div>\n\nHere is a start, but it doesn't fix the problem with Python 2 breaking Python 3, since I don't know what's going on. I bumped the version number to force a rebuild, since anyone using OS X is likely to currently have a broken Python 3 build.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c050438fa802d56738cc7084254579c5610b7358\">c050438</a></td><td><code>trac 22756: fix python3 build on OS X:</code></td></tr></table>\n",
    "created_at": "2017-04-05T03:04:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22756#issuecomment-341387",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:3" align="right">Comment 3</div>

Here is a start, but it doesn't fix the problem with Python 2 breaking Python 3, since I don't know what's going on. I bumped the version number to force a rebuild, since anyone using OS X is likely to currently have a broken Python 3 build.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c050438fa802d56738cc7084254579c5610b7358">c050438</a></td><td><code>trac 22756: fix python3 build on OS X:</code></td></tr></table>




---

archive/issue_comments_341388.json:
```json
{
    "body": "Commit: **[c050438](https://github.com/sagemath/sagetrac-mirror/commit/c050438fa802d56738cc7084254579c5610b7358)**",
    "created_at": "2017-04-05T03:04:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22756#issuecomment-341388",
    "user": "https://github.com/jhpalmieri"
}
```

Commit: **[c050438](https://github.com/sagemath/sagetrac-mirror/commit/c050438fa802d56738cc7084254579c5610b7358)**



---

archive/issue_comments_341389.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">Comment 4</div>\n\nBy the way, some of the changes were just to decrease differences between the `spkg-install` scripts for `python2` and `python3`. There is two parts in the `python2` script which is not in `python3`:\n\n```\n# Use EXTRA_CFLAGS for user-defined CFLAGS since Python puts its own\n# default flags like -O3 after CFLAGS but before EXTRA_CFLAGS.\n# We also disable warnings about unused variables/functions which are\n# common in Cython-generated code.\nexport EXTRA_CFLAGS=\"`testcflags.sh -Wno-unused` $CFLAGS\"\nunset CFLAGS\n```\nand the lines surrounding\n\n```\n    cp -rp \"${xcode}\"/Toolchains/XcodeDefault.xctoolchain/usr/lib/swift-migrator/sdk/MacOSX.sdk/usr/include/openssl \"$CUR\"/include\n```\nThis second one is broken even for `python2`, so no need to do it for `python3`. I don't know about the first chunk.",
    "created_at": "2017-04-05T03:08:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22756#issuecomment-341389",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:4" align="right">Comment 4</div>

By the way, some of the changes were just to decrease differences between the `spkg-install` scripts for `python2` and `python3`. There is two parts in the `python2` script which is not in `python3`:

```
# Use EXTRA_CFLAGS for user-defined CFLAGS since Python puts its own
# default flags like -O3 after CFLAGS but before EXTRA_CFLAGS.
# We also disable warnings about unused variables/functions which are
# common in Cython-generated code.
export EXTRA_CFLAGS="`testcflags.sh -Wno-unused` $CFLAGS"
unset CFLAGS
```
and the lines surrounding

```
    cp -rp "${xcode}"/Toolchains/XcodeDefault.xctoolchain/usr/lib/swift-migrator/sdk/MacOSX.sdk/usr/include/openssl "$CUR"/include
```
This second one is broken even for `python2`, so no need to do it for `python3`. I don't know about the first chunk.



---

archive/issue_comments_341390.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">Comment 5</div>\n\nThe error with `python3` seems to be that the first python to build gets the link python to python$version. So the problem is that `python2.7/encodings/__init__.py` is not compatible with python3. Not sure what's happening to python2 when python3 is build first. It is a bit strange that it uses the link rather than the fully versioned directory. And obviously it doesn't happen on linux, or does it?",
    "created_at": "2017-04-05T04:46:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22756#issuecomment-341390",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:5" align="right">Comment 5</div>

The error with `python3` seems to be that the first python to build gets the link python to python$version. So the problem is that `python2.7/encodings/__init__.py` is not compatible with python3. Not sure what's happening to python2 when python3 is build first. It is a bit strange that it uses the link rather than the fully versioned directory. And obviously it doesn't happen on linux, or does it?



---

archive/issue_comments_341391.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">Comment 6</div>\n\nYou're right. If I build `python3` first, then its `sys.path` does not contain `local/lib/python`, but if I build it after `python2`, then the `python3` `sys.path` does contain this. Why? And why isn't this a problem on linux?",
    "created_at": "2017-04-05T05:18:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22756#issuecomment-341391",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:6" align="right">Comment 6</div>

You're right. If I build `python3` first, then its `sys.path` does not contain `local/lib/python`, but if I build it after `python2`, then the `python3` `sys.path` does contain this. Why? And why isn't this a problem on linux?



---

archive/issue_comments_341392.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">Comment 7</div>\n\nDo we need the symlink (in `local/lib`) `python2.7 -> python`, or can we get by with two directories `python2.7` and `python3.5`, no symlinks? It seems odd that we have to create it manually. If Python really needed it, it would create it on its own, wouldn't it?\n\nWell, I'll try building without and see what happens.",
    "created_at": "2017-04-05T05:24:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22756#issuecomment-341392",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:7" align="right">Comment 7</div>

Do we need the symlink (in `local/lib`) `python2.7 -> python`, or can we get by with two directories `python2.7` and `python3.5`, no symlinks? It seems odd that we have to create it manually. If Python really needed it, it would create it on its own, wouldn't it?

Well, I'll try building without and see what happens.



---

archive/issue_comments_341393.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,7 +2,7 @@\n \n Examples (all start with `make distclean`):\n \n-- `./sage -i python3`. Then `python3` works, but the `_scproxy` and `_lzma` modules fail to build. The error for `_lzma` is\n+- `./sage -i python3`. Then `python3` works, but the `_scproxy` (on OS X 10.12) and `_lzma` modules fail to build. We've seen the `_scproxy` error before: the solution is to compile with clang, at least on recent versions of OS X. The error for `_lzma` is\n \n ```\n /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.0.beta0/local/var/tmp/sage/build/python3-3.5.1/src/Modules/_lzmamodule.c:19:18: fatal error: lzma.h: No such file or directory\n@@ -28,4 +28,4 @@\n \n - if we build Python3 with `clang` but we build Python2 first, then we get the same error as above.\n \n-So I propose that we build Python3 with `clang` and we make `xz` a dependency. I don't know why the Python2 and Python3 builds interfere with each other. We could make `python3` a dependency of `python2`, to force `python3` to be built first, but that feels like treating the symptom, not the problem.\n+So I propose that we build Python3 with `clang` as we already do with Python2, and we make `xz` a dependency. I don't know why the Python2 and Python3 builds interfere with each other. We could make `python3` a dependency of `python2`, to force `python3` to be built first, but that feels like treating the symptom, not the problem.\n``````\n",
    "created_at": "2017-04-05T21:43:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22756#issuecomment-341393",
    "user": "https://github.com/jhpalmieri"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,7 +2,7 @@
 
 Examples (all start with `make distclean`):
 
-- `./sage -i python3`. Then `python3` works, but the `_scproxy` and `_lzma` modules fail to build. The error for `_lzma` is
+- `./sage -i python3`. Then `python3` works, but the `_scproxy` (on OS X 10.12) and `_lzma` modules fail to build. We've seen the `_scproxy` error before: the solution is to compile with clang, at least on recent versions of OS X. The error for `_lzma` is
 
 ```
 /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.0.beta0/local/var/tmp/sage/build/python3-3.5.1/src/Modules/_lzmamodule.c:19:18: fatal error: lzma.h: No such file or directory
@@ -28,4 +28,4 @@
 
 - if we build Python3 with `clang` but we build Python2 first, then we get the same error as above.
 
-So I propose that we build Python3 with `clang` and we make `xz` a dependency. I don't know why the Python2 and Python3 builds interfere with each other. We could make `python3` a dependency of `python2`, to force `python3` to be built first, but that feels like treating the symptom, not the problem.
+So I propose that we build Python3 with `clang` as we already do with Python2, and we make `xz` a dependency. I don't know why the Python2 and Python3 builds interfere with each other. We could make `python3` a dependency of `python2`, to force `python3` to be built first, but that feels like treating the symptom, not the problem.
``````




---

archive/issue_comments_341394.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -24,7 +24,7 @@\n Abort trap: 6\n ```\n \n-- if we build Python3 with `clang`, the way we do with Python2, then as long as we haven't build Python2 first, it works and `_scproxy` builds properly. `_lzma` doesn't, but we can fix that.\n+- if we build Python3 with `clang`, the way we do with Python2, then as long as we haven't built Python2 first, it works and `_scproxy` builds properly. `_lzma` doesn't, but we can fix that.\n \n - if we build Python3 with `clang` but we build Python2 first, then we get the same error as above.\n \n``````\n",
    "created_at": "2017-04-05T21:44:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22756#issuecomment-341394",
    "user": "https://github.com/jhpalmieri"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -24,7 +24,7 @@
 Abort trap: 6
 ```
 
-- if we build Python3 with `clang`, the way we do with Python2, then as long as we haven't build Python2 first, it works and `_scproxy` builds properly. `_lzma` doesn't, but we can fix that.
+- if we build Python3 with `clang`, the way we do with Python2, then as long as we haven't built Python2 first, it works and `_scproxy` builds properly. `_lzma` doesn't, but we can fix that.
 
 - if we build Python3 with `clang` but we build Python2 first, then we get the same error as above.
 
``````




---

archive/issue_comments_341395.json:
```json
{
    "body": "Dependencies: **#22764**",
    "created_at": "2017-04-05T21:55:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22756#issuecomment-341395",
    "user": "https://github.com/jhpalmieri"
}
```

Dependencies: **#22764**



---

archive/issue_comments_341396.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -28,4 +28,4 @@\n \n - if we build Python3 with `clang` but we build Python2 first, then we get the same error as above.\n \n-So I propose that we build Python3 with `clang` as we already do with Python2, and we make `xz` a dependency. I don't know why the Python2 and Python3 builds interfere with each other. We could make `python3` a dependency of `python2`, to force `python3` to be built first, but that feels like treating the symptom, not the problem.\n+So I propose that we build Python3 with `clang` as we already do with Python2, and we make `xz` a dependency. To fix the interference between the two Python builds, we should remove the symbolic link `SAGE_LOCAL/lib/python`. See #22764.\n``````\n",
    "created_at": "2017-04-05T21:55:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22756#issuecomment-341396",
    "user": "https://github.com/jhpalmieri"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -28,4 +28,4 @@
 
 - if we build Python3 with `clang` but we build Python2 first, then we get the same error as above.
 
-So I propose that we build Python3 with `clang` as we already do with Python2, and we make `xz` a dependency. I don't know why the Python2 and Python3 builds interfere with each other. We could make `python3` a dependency of `python2`, to force `python3` to be built first, but that feels like treating the symptom, not the problem.
+So I propose that we build Python3 with `clang` as we already do with Python2, and we make `xz` a dependency. To fix the interference between the two Python builds, we should remove the symbolic link `SAGE_LOCAL/lib/python`. See #22764.
``````




---

archive/issue_comments_341397.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">Comment 10</div>\n\nRemoving the symlink works for me. See #22764. I've made that a dependency.",
    "created_at": "2017-04-05T21:55:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22756#issuecomment-341397",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:10" align="right">Comment 10</div>

Removing the symlink works for me. See #22764. I've made that a dependency.



---

archive/issue_events_299679.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2017-04-05T21:55:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22756",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22756#event-299679"
}
```



---

archive/issue_comments_341398.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">Comment 11</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e55ac1b02d1c6ca1724fc15d254cf546b956e76b\">e55ac1b</a></td><td><code>trac 22756: fix merge error with #22764.</code></td></tr></table>\n",
    "created_at": "2017-04-05T22:15:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22756#issuecomment-341398",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:11" align="right">Comment 11</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e55ac1b02d1c6ca1724fc15d254cf546b956e76b">e55ac1b</a></td><td><code>trac 22756: fix merge error with #22764.</code></td></tr></table>




---

archive/issue_comments_341399.json:
```json
{
    "body": "Changed commit from **[c050438](https://github.com/sagemath/sagetrac-mirror/commit/c050438fa802d56738cc7084254579c5610b7358)** to **[e55ac1b](https://github.com/sagemath/sagetrac-mirror/commit/e55ac1b02d1c6ca1724fc15d254cf546b956e76b)**",
    "created_at": "2017-04-05T22:15:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22756#issuecomment-341399",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[c050438](https://github.com/sagemath/sagetrac-mirror/commit/c050438fa802d56738cc7084254579c5610b7358)** to **[e55ac1b](https://github.com/sagemath/sagetrac-mirror/commit/e55ac1b02d1c6ca1724fc15d254cf546b956e76b)**



---

archive/issue_comments_341400.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">Comment 12</div>\n\nI am OK with this but I definitely want to wait for feedback on #22764.",
    "created_at": "2017-04-05T22:18:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22756#issuecomment-341400",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:12" align="right">Comment 12</div>

I am OK with this but I definitely want to wait for feedback on #22764.



---

archive/issue_comments_341401.json:
```json
{
    "body": "Changed commit from **[e55ac1b](https://github.com/sagemath/sagetrac-mirror/commit/e55ac1b02d1c6ca1724fc15d254cf546b956e76b)** to **[7699f3f](https://github.com/sagemath/sagetrac-mirror/commit/7699f3f2b6ac938b12c42644cbc2047a369a2743)**",
    "created_at": "2017-04-06T01:35:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22756#issuecomment-341401",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[e55ac1b](https://github.com/sagemath/sagetrac-mirror/commit/e55ac1b02d1c6ca1724fc15d254cf546b956e76b)** to **[7699f3f](https://github.com/sagemath/sagetrac-mirror/commit/7699f3f2b6ac938b12c42644cbc2047a369a2743)**



---

archive/issue_comments_341402.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">Comment 13</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7699f3f2b6ac938b12c42644cbc2047a369a2743\">7699f3f</a></td><td><code>trac 22756: check name of _scproxy .so file correctly for Python 3.</code></td></tr></table>\n",
    "created_at": "2017-04-06T01:35:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22756#issuecomment-341402",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:13" align="right">Comment 13</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7699f3f2b6ac938b12c42644cbc2047a369a2743">7699f3f</a></td><td><code>trac 22756: check name of _scproxy .so file correctly for Python 3.</code></td></tr></table>




---

archive/issue_comments_341403.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">Comment 14</div>\n\nWith the branch here, I am having problems building `matplotlib` and `fpylll`. For `fpylll`, the log file consists entirely of\n\n```\nTraceback (most recent call last):\n  File \"setup.py\", line 131, in <module>\n    long_description=open('README.rst').read(),\n  File \"/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.0.beta0/local/lib/python3.5/encodings/ascii.py\", line 26, in decode\n    return codecs.ascii_decode(input, self.errors)[0]\nUnicodeDecodeError: 'ascii' codec can't decode byte 0xe2 in position 2249: ordinal not in range(128)\nError: could not determine package name\n```\nThe `matplotlib` log starts with\n\n```\nNOTE: Set SAGE_MATPLOTLIB_GUI to anything but 'no' to try to build the Matplotlib GUI.\nNot building any matplotlib graphical backends.\nTraceback (most recent call last):\n  File \"make-setup-config.py\", line 34, in <module>\n    config.write(configfile)\n  File \"/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.0.beta0/local/lib/python3.5/configparser.py\", line 916, in write\n    self._sections[section].items(), d)\n  File \"/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.0.beta0/local/lib/python3.5/configparser.py\", line 920, in _write_section\n    fp.write(\"[{}]\\n\".format(section_name))\nTypeError: a bytes-like object is required, not 'str'\nWarning: This package has a badly-behaved setup.py which outputs\nmore than the package name for 'setup.py --name'; using the last\nline as the package name: matplotlib\nInstalling package matplotlib using pip\nWaiting for shared lock to run pip install --ignore-installed --verbose --no-deps --no-index --isolated . ... ok\nIgnoring indexes: https://pypi.python.org/simple\nProcessing /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.0.beta0/local/var/tmp/sage/build/matplotlib-1.5.1.p0/src\n  Running setup.py (path:/var/folders/cp/n8wtqs490tq5psknff1hv9qr0000gn/T/pip-9u0y0hgx-build/setup.py) egg_info for package from file:///Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.0.beta0/local/var/tmp/sage/build/matplotlib-1.5.1.p0/src\n    Running command python setup.py egg_info\n```\nand then proceeds to try to build. Then later it has this:\n\n```\n    gcc -Wno-unused-result -Wsign-compare -Wunreachable-code -DNDEBUG -g -fwrapv -O3 -Wall -DPY_ARRAY_UNIQUE_SYMBOL=MPL_matplotlib_backends__macosx_ARRAY_API -DNPY_NO_DEPRECATED_API=NPY_1_7_API_VERSION -I/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.0.beta0/local/lib/python3.5/site-packages/numpy/core/include -I/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.0.beta0/local/lib/python3.5/site-packages/numpy/core/include -I/usr/local/include -I/usr/include -I/usr/X11/include -I/opt/X11/include -I. -Iextern/agg24-svn/include -I/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.0.beta0/local/include/python3.5m -c src/_macosx.m -o build/temp.macosx-10.9-x86_64-3.5/src/_macosx.o\n    gcc: error: src/_macosx.m: Objective-C compiler not installed on this system\n    error: command 'gcc' failed with exit status 1\n```\nI don't know if these are tied to the branch here or not, since I haven't been able to build python3 without the changes here.",
    "created_at": "2017-04-06T23:51:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22756#issuecomment-341403",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:14" align="right">Comment 14</div>

With the branch here, I am having problems building `matplotlib` and `fpylll`. For `fpylll`, the log file consists entirely of

```
Traceback (most recent call last):
  File "setup.py", line 131, in <module>
    long_description=open('README.rst').read(),
  File "/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.0.beta0/local/lib/python3.5/encodings/ascii.py", line 26, in decode
    return codecs.ascii_decode(input, self.errors)[0]
UnicodeDecodeError: 'ascii' codec can't decode byte 0xe2 in position 2249: ordinal not in range(128)
Error: could not determine package name
```
The `matplotlib` log starts with

```
NOTE: Set SAGE_MATPLOTLIB_GUI to anything but 'no' to try to build the Matplotlib GUI.
Not building any matplotlib graphical backends.
Traceback (most recent call last):
  File "make-setup-config.py", line 34, in <module>
    config.write(configfile)
  File "/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.0.beta0/local/lib/python3.5/configparser.py", line 916, in write
    self._sections[section].items(), d)
  File "/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.0.beta0/local/lib/python3.5/configparser.py", line 920, in _write_section
    fp.write("[{}]\n".format(section_name))
TypeError: a bytes-like object is required, not 'str'
Warning: This package has a badly-behaved setup.py which outputs
more than the package name for 'setup.py --name'; using the last
line as the package name: matplotlib
Installing package matplotlib using pip
Waiting for shared lock to run pip install --ignore-installed --verbose --no-deps --no-index --isolated . ... ok
Ignoring indexes: https://pypi.python.org/simple
Processing /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.0.beta0/local/var/tmp/sage/build/matplotlib-1.5.1.p0/src
  Running setup.py (path:/var/folders/cp/n8wtqs490tq5psknff1hv9qr0000gn/T/pip-9u0y0hgx-build/setup.py) egg_info for package from file:///Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.0.beta0/local/var/tmp/sage/build/matplotlib-1.5.1.p0/src
    Running command python setup.py egg_info
```
and then proceeds to try to build. Then later it has this:

```
    gcc -Wno-unused-result -Wsign-compare -Wunreachable-code -DNDEBUG -g -fwrapv -O3 -Wall -DPY_ARRAY_UNIQUE_SYMBOL=MPL_matplotlib_backends__macosx_ARRAY_API -DNPY_NO_DEPRECATED_API=NPY_1_7_API_VERSION -I/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.0.beta0/local/lib/python3.5/site-packages/numpy/core/include -I/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.0.beta0/local/lib/python3.5/site-packages/numpy/core/include -I/usr/local/include -I/usr/include -I/usr/X11/include -I/opt/X11/include -I. -Iextern/agg24-svn/include -I/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.0.beta0/local/include/python3.5m -c src/_macosx.m -o build/temp.macosx-10.9-x86_64-3.5/src/_macosx.o
    gcc: error: src/_macosx.m: Objective-C compiler not installed on this system
    error: command 'gcc' failed with exit status 1
```
I don't know if these are tied to the branch here or not, since I haven't been able to build python3 without the changes here.



---

archive/issue_comments_341404.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">Comment 15</div>\n\nHum... for matplotlib, that particular file is an objective-C module. We would have to build gcc with support for it or use native clang. fpylll should build with python3, although I am still at 3.4 in gentoo but I believe upstream tests 3.5. It feels like there is something missing in the python install regarding unicode support. Would have to check python's log.",
    "created_at": "2017-04-07T00:12:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22756#issuecomment-341404",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:15" align="right">Comment 15</div>

Hum... for matplotlib, that particular file is an objective-C module. We would have to build gcc with support for it or use native clang. fpylll should build with python3, although I am still at 3.4 in gentoo but I believe upstream tests 3.5. It feels like there is something missing in the python install regarding unicode support. Would have to check python's log.



---

archive/issue_comments_341405.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">Comment 16</div>\n\nI should have said: the problems with `matplotlib` and `fpylll` were when building Sage with `SAGE_PYTHON3=yes`. I think that may have been clear, but just in case.",
    "created_at": "2017-04-07T00:38:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22756#issuecomment-341405",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:16" align="right">Comment 16</div>

I should have said: the problems with `matplotlib` and `fpylll` were when building Sage with `SAGE_PYTHON3=yes`. I think that may have been clear, but just in case.



---

archive/issue_comments_341406.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">Comment 17</div>\n\nWas clear to me. My comments still stand.",
    "created_at": "2017-04-07T00:40:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22756#issuecomment-341406",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:17" align="right">Comment 17</div>

Was clear to me. My comments still stand.



---

archive/issue_comments_341407.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">Comment 18</div>\n\nBuilding `matplotlib` with `clang` works, by the way. It still has the `TypeError` at the beginning, which does seem like some kind of unicode thing.",
    "created_at": "2017-04-07T00:41:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22756#issuecomment-341407",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:18" align="right">Comment 18</div>

Building `matplotlib` with `clang` works, by the way. It still has the `TypeError` at the beginning, which does seem like some kind of unicode thing.



---

archive/issue_comments_341408.json:
```json
{
    "body": "Attachment: **[python3-3.5.1.p0.log](https://github.com/sagemath/sage/files/ticket22756/python3-3.5.1.p0.log)**",
    "created_at": "2017-04-07T01:05:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22756#issuecomment-341408",
    "user": "https://github.com/jhpalmieri"
}
```

Attachment: **[python3-3.5.1.p0.log](https://github.com/sagemath/sage/files/ticket22756/python3-3.5.1.p0.log)**



---

archive/issue_comments_341409.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">Comment 19</div>\n\nPython 3 log attached. I noticed at the beginning:\n\n```\nconfigure: WARNING: unrecognized options: --enable-unicode, --disable-toolbox-glue\n```\nWe should probably remove those options, either here or on another ticket.",
    "created_at": "2017-04-07T01:06:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22756#issuecomment-341409",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:19" align="right">Comment 19</div>

Python 3 log attached. I noticed at the beginning:

```
configure: WARNING: unrecognized options: --enable-unicode, --disable-toolbox-glue
```
We should probably remove those options, either here or on another ticket.



---

archive/issue_comments_341410.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">Comment 20</div>\n\nMay as well clean up here. I'll look at the log, I cannot find what is causing trouble with fpylll - unless it is in the weird link to the sagecell server.",
    "created_at": "2017-04-07T01:10:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22756#issuecomment-341410",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:20" align="right">Comment 20</div>

May as well clean up here. I'll look at the log, I cannot find what is causing trouble with fpylll - unless it is in the weird link to the sagecell server.



---

archive/issue_comments_341411.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">Comment 21</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dcc3fb4ec40f97748d525d2e1917c747151339f8\">dcc3fb4</a></td><td><code>trac 22756: remove two invalid configure options for Python 3</code></td></tr></table>\n",
    "created_at": "2017-04-07T01:42:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22756#issuecomment-341411",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:21" align="right">Comment 21</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dcc3fb4ec40f97748d525d2e1917c747151339f8">dcc3fb4</a></td><td><code>trac 22756: remove two invalid configure options for Python 3</code></td></tr></table>




---

archive/issue_comments_341412.json:
```json
{
    "body": "Changed commit from **[7699f3f](https://github.com/sagemath/sagetrac-mirror/commit/7699f3f2b6ac938b12c42644cbc2047a369a2743)** to **[dcc3fb4](https://github.com/sagemath/sagetrac-mirror/commit/dcc3fb4ec40f97748d525d2e1917c747151339f8)**",
    "created_at": "2017-04-07T01:42:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22756#issuecomment-341412",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[7699f3f](https://github.com/sagemath/sagetrac-mirror/commit/7699f3f2b6ac938b12c42644cbc2047a369a2743)** to **[dcc3fb4](https://github.com/sagemath/sagetrac-mirror/commit/dcc3fb4ec40f97748d525d2e1917c747151339f8)**



---

archive/issue_comments_341413.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">Comment 22</div>\n\n`fpylll` is a similar problem to https://github.com/theskumar/python-dotenv/issues/45. It could be linked to locale settings if I believe the last comment.\nAccording to file, the file is ASCII, but python thinks it has utf8 in it. \n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dcc3fb4ec40f97748d525d2e1917c747151339f8\">dcc3fb4</a></td><td><code>trac 22756: remove two invalid configure options for Python 3</code></td></tr></table>\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dcc3fb4ec40f97748d525d2e1917c747151339f8\">dcc3fb4</a></td><td><code>trac 22756: remove two invalid configure options for Python 3</code></td></tr></table>\n",
    "created_at": "2017-04-07T01:45:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22756#issuecomment-341413",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:22" align="right">Comment 22</div>

`fpylll` is a similar problem to https://github.com/theskumar/python-dotenv/issues/45. It could be linked to locale settings if I believe the last comment.
According to file, the file is ASCII, but python thinks it has utf8 in it. 

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dcc3fb4ec40f97748d525d2e1917c747151339f8">dcc3fb4</a></td><td><code>trac 22756: remove two invalid configure options for Python 3</code></td></tr></table>

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dcc3fb4ec40f97748d525d2e1917c747151339f8">dcc3fb4</a></td><td><code>trac 22756: remove two invalid configure options for Python 3</code></td></tr></table>




---

archive/issue_comments_341414.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">Comment 23</div>\n\nIf I do `./sage --sh` and then run `python3`, I don't get any errors if I execute the command `open('README.rst').read()` on the `README.rst` file from `fpylll`.\n\nEdit: also no errors if I execute `open('README.rst', encoding='ascii').read()`, `open('README.rst', encoding='utf8').read()`, `open('README.rst', encoding='latin1').read()`",
    "created_at": "2017-04-07T03:49:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22756#issuecomment-341414",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:23" align="right">Comment 23</div>

If I do `./sage --sh` and then run `python3`, I don't get any errors if I execute the command `open('README.rst').read()` on the `README.rst` file from `fpylll`.

Edit: also no errors if I execute `open('README.rst', encoding='ascii').read()`, `open('README.rst', encoding='utf8').read()`, `open('README.rst', encoding='latin1').read()`



---

archive/issue_comments_341415.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">Comment 24</div>\n\nOh, wait: the encoding for the file `README.rst` from fpyll version 0.2.3dev is utf8, and that's the one that is causing problems. So it's a bug in fpyll. I think it's been fixed upstream: the version in 0.2.4dev is ascii.\n\nEdit: and 0.2.4dev is the one in Sage 8.0.beta1.",
    "created_at": "2017-04-07T03:55:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22756#issuecomment-341415",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:24" align="right">Comment 24</div>

Oh, wait: the encoding for the file `README.rst` from fpyll version 0.2.3dev is utf8, and that's the one that is causing problems. So it's a bug in fpyll. I think it's been fixed upstream: the version in 0.2.4dev is ascii.

Edit: and 0.2.4dev is the one in Sage 8.0.beta1.



---

archive/issue_comments_341416.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">Comment 25</div>\n\nWith the change\n\n```diff\ndiff --git a/build/pkgs/matplotlib/make-setup-config.py b/build/pkgs/matplotlib/make-setup-config.py\nindex ad5a0c19ab..9a86586f9b 100644\n--- a/build/pkgs/matplotlib/make-setup-config.py\n+++ b/build/pkgs/matplotlib/make-setup-config.py\n@@ -30,5 +30,5 @@ config.add_section('gui_support')\n for backend in ('gtk', 'gtkagg', 'tkagg', 'wxagg', 'macosx', 'windowing'):\n     config.set('gui_support', backend,  graphical_backend)\n \n-with open('src/setup.cfg', 'wb') as configfile:\n+with open('src/setup.cfg', 'w') as configfile:\n     config.write(configfile)\n```\nI don't get the error at the start of the `matplotlib` log. I don't know what the 'b' is doing there in the first place, since `src/setup.cfg` looks like an ascii file.",
    "created_at": "2017-04-07T05:34:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22756#issuecomment-341416",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:25" align="right">Comment 25</div>

With the change

```diff
diff --git a/build/pkgs/matplotlib/make-setup-config.py b/build/pkgs/matplotlib/make-setup-config.py
index ad5a0c19ab..9a86586f9b 100644
--- a/build/pkgs/matplotlib/make-setup-config.py
+++ b/build/pkgs/matplotlib/make-setup-config.py
@@ -30,5 +30,5 @@ config.add_section('gui_support')
 for backend in ('gtk', 'gtkagg', 'tkagg', 'wxagg', 'macosx', 'windowing'):
     config.set('gui_support', backend,  graphical_backend)
 
-with open('src/setup.cfg', 'wb') as configfile:
+with open('src/setup.cfg', 'w') as configfile:
     config.write(configfile)
```
I don't get the error at the start of the `matplotlib` log. I don't know what the 'b' is doing there in the first place, since `src/setup.cfg` looks like an ascii file.



---

archive/issue_comments_341417.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">Comment 26</div>\n\nSee #22772 for the `matplotlib` fix (eliminating the 'b').",
    "created_at": "2017-04-07T05:44:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22756#issuecomment-341417",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:26" align="right">Comment 26</div>

See #22772 for the `matplotlib` fix (eliminating the 'b').



---

archive/issue_comments_341418.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">Comment 27</div>\n\nBy the way, the proposed change at #22772 means that we don't need to use `clang` to compile. Without this change, a configuration file is not written properly, and I think that led to the compilation problem. If you've tried building using python 3 on linux, I wonder if the matplotlib log shows a similar error there.",
    "created_at": "2017-04-07T05:49:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22756#issuecomment-341418",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:27" align="right">Comment 27</div>

By the way, the proposed change at #22772 means that we don't need to use `clang` to compile. Without this change, a configuration file is not written properly, and I think that led to the compilation problem. If you've tried building using python 3 on linux, I wonder if the matplotlib log shows a similar error there.



---

archive/issue_comments_341419.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">Comment 28</div>\n\nI was already thinking about fpylll 0.2.4, for curiosity I should check if I have logs for 0.2.3 exhibiting any weird behavior. Unltimately I believe our continued use of gcc on OS X is a band aid, but that's another story.",
    "created_at": "2017-04-07T09:50:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22756#issuecomment-341419",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:28" align="right">Comment 28</div>

I was already thinking about fpylll 0.2.4, for curiosity I should check if I have logs for 0.2.3 exhibiting any weird behavior. Unltimately I believe our continued use of gcc on OS X is a band aid, but that's another story.



---

archive/issue_comments_341420.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">Comment 29</div>\n\nNext I'm having trouble building `pynac`. Log file attached.",
    "created_at": "2017-04-07T14:35:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22756#issuecomment-341420",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:29" align="right">Comment 29</div>

Next I'm having trouble building `pynac`. Log file attached.



---

archive/issue_comments_341421.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">Comment 30</div>\n\nAttachment: **[pynac-0.7.5.log](https://github.com/sagemath/sage/files/ticket22756/pynac-0.7.5.log)**\n\nThe mountain of messages about assembly is coming from using gcc instead of clang. May disappear by upgrading gcc (I don't know for sure).\n\nI have seen that before\n\n```\nIn file included from /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.0.beta1/local/include/c++/5.4.0/bits/basic_ios.h:37:0,\n                 from /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.0.beta1/local/include/c++/5.4.0/ios:44,\n                 from /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.0.beta1/local/include/c++/5.4.0/ostream:38,\n                 from /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.0.beta1/local/include/c++/5.4.0/iostream:39,\n                 from class_info.h:31,\n                 from registrar.h:30,\n                 from basic.h:40,\n                 from numeric.h:49,\n                 from inifcns.h:26,\n                 from function_info.cpp:8:\n/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.0.beta1/local/include/c++/5.4.0/bits/locale_facets.h:247:53: error: macro \"toupper\" passed 2 arguments, but takes just 1\n       toupper(char_type *__lo, const char_type* __hi) const\n                                                     ^\n/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.0.beta1/local/include/c++/5.4.0/bits/locale_facets.h:276:53: error: macro \"tolower\" passed 2 arguments, but takes just 1\n       tolower(char_type* __lo, const char_type* __hi) const\n                                                     ^\n/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.0.beta1/local/include/c++/5.4.0/bits/locale_facets.h:819:53: error: macro \"toupper\" passed 2 arguments, but takes just 1\n       toupper(char_type *__lo, const char_type* __hi) const\n                                                     ^\n/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.0.beta1/local/include/c++/5.4.0/bits/locale_facets.h:852:53: error: macro \"tolower\" passed 2 arguments, but takes just 1\n       tolower(char_type* __lo, const char_type* __hi) const\n                                                     ^\n```\nMay take some time to track it back.\n\n```\n/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.0.beta1/local/include/python3.5m/pyport.h:704:29: error: 'btowc' is not a type\n #define tolower(c) towlower(btowc(c))\n                             ^\n```\nyes pyport.h, I fixed that in 2.7, and the fix was added in 2.7.13 upstream. May be we need to update to python-3.5.3. see #22147.",
    "created_at": "2017-04-07T20:08:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22756#issuecomment-341421",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:30" align="right">Comment 30</div>

Attachment: **[pynac-0.7.5.log](https://github.com/sagemath/sage/files/ticket22756/pynac-0.7.5.log)**

The mountain of messages about assembly is coming from using gcc instead of clang. May disappear by upgrading gcc (I don't know for sure).

I have seen that before

```
In file included from /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.0.beta1/local/include/c++/5.4.0/bits/basic_ios.h:37:0,
                 from /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.0.beta1/local/include/c++/5.4.0/ios:44,
                 from /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.0.beta1/local/include/c++/5.4.0/ostream:38,
                 from /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.0.beta1/local/include/c++/5.4.0/iostream:39,
                 from class_info.h:31,
                 from registrar.h:30,
                 from basic.h:40,
                 from numeric.h:49,
                 from inifcns.h:26,
                 from function_info.cpp:8:
/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.0.beta1/local/include/c++/5.4.0/bits/locale_facets.h:247:53: error: macro "toupper" passed 2 arguments, but takes just 1
       toupper(char_type *__lo, const char_type* __hi) const
                                                     ^
/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.0.beta1/local/include/c++/5.4.0/bits/locale_facets.h:276:53: error: macro "tolower" passed 2 arguments, but takes just 1
       tolower(char_type* __lo, const char_type* __hi) const
                                                     ^
/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.0.beta1/local/include/c++/5.4.0/bits/locale_facets.h:819:53: error: macro "toupper" passed 2 arguments, but takes just 1
       toupper(char_type *__lo, const char_type* __hi) const
                                                     ^
/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.0.beta1/local/include/c++/5.4.0/bits/locale_facets.h:852:53: error: macro "tolower" passed 2 arguments, but takes just 1
       tolower(char_type* __lo, const char_type* __hi) const
                                                     ^
```
May take some time to track it back.

```
/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.0.beta1/local/include/python3.5m/pyport.h:704:29: error: 'btowc' is not a type
 #define tolower(c) towlower(btowc(c))
                             ^
```
yes pyport.h, I fixed that in 2.7, and the fix was added in 2.7.13 upstream. May be we need to update to python-3.5.3. see #22147.



---

archive/issue_comments_341422.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">Comment 31</div>\n\nI see. As far as I can tell, your fix is not in Python 3.5. I'll try the patch and see what happens.",
    "created_at": "2017-04-07T20:29:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22756#issuecomment-341422",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:31" align="right">Comment 31</div>

I see. As far as I can tell, your fix is not in Python 3.5. I'll try the patch and see what happens.



---

archive/issue_comments_341423.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">Comment 32</div>\n\nThat patch fixes it. I'll add it to this branch.",
    "created_at": "2017-04-07T22:44:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22756#issuecomment-341423",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:32" align="right">Comment 32</div>

That patch fixes it. I'll add it to this branch.



---

archive/issue_comments_341424.json:
```json
{
    "body": "Changed commit from **[dcc3fb4](https://github.com/sagemath/sagetrac-mirror/commit/dcc3fb4ec40f97748d525d2e1917c747151339f8)** to **[678fb20](https://github.com/sagemath/sagetrac-mirror/commit/678fb206f5fb7731651c80263c61ac4872915396)**",
    "created_at": "2017-04-07T22:45:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22756#issuecomment-341424",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[dcc3fb4](https://github.com/sagemath/sagetrac-mirror/commit/dcc3fb4ec40f97748d525d2e1917c747151339f8)** to **[678fb20](https://github.com/sagemath/sagetrac-mirror/commit/678fb206f5fb7731651c80263c61ac4872915396)**



---

archive/issue_comments_341425.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">Comment 33</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/678fb206f5fb7731651c80263c61ac4872915396\">678fb20</a></td><td><code>trac 22756: port a fix for pyports.h from</code></td></tr></table>\n",
    "created_at": "2017-04-07T22:45:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22756#issuecomment-341425",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:33" align="right">Comment 33</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/678fb206f5fb7731651c80263c61ac4872915396">678fb20</a></td><td><code>trac 22756: port a fix for pyports.h from</code></td></tr></table>




---

archive/issue_comments_341426.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,31 +1,11 @@\n-On OS X, Python3 sometimes fails to build correctly. I think it depends on whether Python2 is built first or not. Even if it seems to build correctly, then the `_scproxy` module is broken.\n+On OS X, Python3 sometimes fails to build correctly. To fix this:\n \n-Examples (all start with `make distclean`):\n+- make `xz` a dependency: not necessary for Python 3 to build, but this way it builds the `_lzma` module.\n \n-- `./sage -i python3`. Then `python3` works, but the `_scproxy` (on OS X 10.12) and `_lzma` modules fail to build. We've seen the `_scproxy` error before: the solution is to compile with clang, at least on recent versions of OS X. The error for `_lzma` is\n+- use `clang` to compile Python 3, as we do for Python 2. Without this, the `_scproxy` module fails to build.\n \n-```\n-/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.0.beta0/local/var/tmp/sage/build/python3-3.5.1/src/Modules/_lzmamodule.c:19:18: fatal error: lzma.h: No such file or directory\n-```\n- We can fix this by making `xz` a dependency. Is it important? `xz` doesn't take long to build and doesn't have any dependencies of its own, so why not?\n+- do not create a symlink `SAGE_LOCAL/lib/python` -- see #22764. If this symlink is in place and if Python 2 is built before Python 3, then Python 3 picks up that link in its load path, and so it tries to read a lot of Python 2 packages, which is bad.\n \n-- `./sage -i python2; ./sage -i python3`: then Python3 fails with the error \n+- see also #22781 which tracks a few other issues related to Python 3, OS X, and Sage packages.\n \n-```\n-$ sage --sh\n-$ python3\n-Fatal Python error: Py_Initialize: unable to load the file system codec\n-  File \"/Users/jpalmier/Desktop/Sage_stuff/git/sage/local/lib/python/encodings/__init__.py\", line 123\n-    raise CodecRegistryError,\\\n-                            ^\n-SyntaxError: invalid syntax\n \n-Current thread 0x00007fff76225000 (most recent call first):\n-Abort trap: 6\n-```\n-\n-- if we build Python3 with `clang`, the way we do with Python2, then as long as we haven't built Python2 first, it works and `_scproxy` builds properly. `_lzma` doesn't, but we can fix that.\n-\n-- if we build Python3 with `clang` but we build Python2 first, then we get the same error as above.\n-\n-So I propose that we build Python3 with `clang` as we already do with Python2, and we make `xz` a dependency. To fix the interference between the two Python builds, we should remove the symbolic link `SAGE_LOCAL/lib/python`. See #22764.\n``````\n",
    "created_at": "2017-04-07T22:49:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22756#issuecomment-341426",
    "user": "https://github.com/jhpalmieri"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,31 +1,11 @@
-On OS X, Python3 sometimes fails to build correctly. I think it depends on whether Python2 is built first or not. Even if it seems to build correctly, then the `_scproxy` module is broken.
+On OS X, Python3 sometimes fails to build correctly. To fix this:
 
-Examples (all start with `make distclean`):
+- make `xz` a dependency: not necessary for Python 3 to build, but this way it builds the `_lzma` module.
 
-- `./sage -i python3`. Then `python3` works, but the `_scproxy` (on OS X 10.12) and `_lzma` modules fail to build. We've seen the `_scproxy` error before: the solution is to compile with clang, at least on recent versions of OS X. The error for `_lzma` is
+- use `clang` to compile Python 3, as we do for Python 2. Without this, the `_scproxy` module fails to build.
 
-```
-/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.0.beta0/local/var/tmp/sage/build/python3-3.5.1/src/Modules/_lzmamodule.c:19:18: fatal error: lzma.h: No such file or directory
-```
- We can fix this by making `xz` a dependency. Is it important? `xz` doesn't take long to build and doesn't have any dependencies of its own, so why not?
+- do not create a symlink `SAGE_LOCAL/lib/python` -- see #22764. If this symlink is in place and if Python 2 is built before Python 3, then Python 3 picks up that link in its load path, and so it tries to read a lot of Python 2 packages, which is bad.
 
-- `./sage -i python2; ./sage -i python3`: then Python3 fails with the error 
+- see also #22781 which tracks a few other issues related to Python 3, OS X, and Sage packages.
 
-```
-$ sage --sh
-$ python3
-Fatal Python error: Py_Initialize: unable to load the file system codec
-  File "/Users/jpalmier/Desktop/Sage_stuff/git/sage/local/lib/python/encodings/__init__.py", line 123
-    raise CodecRegistryError,\
-                            ^
-SyntaxError: invalid syntax
 
-Current thread 0x00007fff76225000 (most recent call first):
-Abort trap: 6
-```
-
-- if we build Python3 with `clang`, the way we do with Python2, then as long as we haven't built Python2 first, it works and `_scproxy` builds properly. `_lzma` doesn't, but we can fix that.
-
-- if we build Python3 with `clang` but we build Python2 first, then we get the same error as above.
-
-So I propose that we build Python3 with `clang` as we already do with Python2, and we make `xz` a dependency. To fix the interference between the two Python builds, we should remove the symbolic link `SAGE_LOCAL/lib/python`. See #22764.
``````




---

archive/issue_comments_341427.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -4,6 +4,8 @@\n \n - use `clang` to compile Python 3, as we do for Python 2. Without this, the `_scproxy` module fails to build.\n \n+- patch `Include/pyport.h` as we do for Python 2 -- see #22147, and also https://trac.macports.org/ticket/44288 and \u200bhttp://bugs.python.org/issue10910.\n+\n - do not create a symlink `SAGE_LOCAL/lib/python` -- see #22764. If this symlink is in place and if Python 2 is built before Python 3, then Python 3 picks up that link in its load path, and so it tries to read a lot of Python 2 packages, which is bad.\n \n - see also #22781 which tracks a few other issues related to Python 3, OS X, and Sage packages.\n``````\n",
    "created_at": "2017-04-07T22:52:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22756#issuecomment-341427",
    "user": "https://github.com/jhpalmieri"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -4,6 +4,8 @@
 
 - use `clang` to compile Python 3, as we do for Python 2. Without this, the `_scproxy` module fails to build.
 
+- patch `Include/pyport.h` as we do for Python 2 -- see #22147, and also https://trac.macports.org/ticket/44288 and ​http://bugs.python.org/issue10910.
+
 - do not create a symlink `SAGE_LOCAL/lib/python` -- see #22764. If this symlink is in place and if Python 2 is built before Python 3, then Python 3 picks up that link in its load path, and so it tries to read a lot of Python 2 packages, which is bad.
 
 - see also #22781 which tracks a few other issues related to Python 3, OS X, and Sage packages.
``````




---

archive/issue_comments_341428.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">Comment 35</div>\n\nWith these changes (and the changes listed at #22781), I can build almost all of Sage on OS X with `SAGE_PYTHON3=yes`. It breaks on the Sage library in an expected place (the use of `cmp` in `sage/rings/real_lazy.pyx` -- see #22257).\n\nEdit: oh, except for SageNB, the build of which is disabled for Python 3 in #22787.",
    "created_at": "2017-04-07T22:52:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22756#issuecomment-341428",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:35" align="right">Comment 35</div>

With these changes (and the changes listed at #22781), I can build almost all of Sage on OS X with `SAGE_PYTHON3=yes`. It breaks on the Sage library in an expected place (the use of `cmp` in `sage/rings/real_lazy.pyx` -- see #22257).

Edit: oh, except for SageNB, the build of which is disabled for Python 3 in #22787.



---

archive/issue_comments_341429.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">Comment 36</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6762fe4bced21a095fc20942e12500a5654b4e34\">6762fe4</a></td><td><code>trac 22756: rebase better on top of 22764</code></td></tr></table>\n",
    "created_at": "2017-04-08T16:08:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22756#issuecomment-341429",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:36" align="right">Comment 36</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6762fe4bced21a095fc20942e12500a5654b4e34">6762fe4</a></td><td><code>trac 22756: rebase better on top of 22764</code></td></tr></table>




---

archive/issue_comments_341430.json:
```json
{
    "body": "Changed commit from **[678fb20](https://github.com/sagemath/sagetrac-mirror/commit/678fb206f5fb7731651c80263c61ac4872915396)** to **[6762fe4](https://github.com/sagemath/sagetrac-mirror/commit/6762fe4bced21a095fc20942e12500a5654b4e34)**",
    "created_at": "2017-04-08T16:08:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22756#issuecomment-341430",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[678fb20](https://github.com/sagemath/sagetrac-mirror/commit/678fb206f5fb7731651c80263c61ac4872915396)** to **[6762fe4](https://github.com/sagemath/sagetrac-mirror/commit/6762fe4bced21a095fc20942e12500a5654b4e34)**



---

archive/issue_comments_341431.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">Comment 37</div>\n\nI think we may be in a state where we will be able to remove all the OS X work around of setting `CC=clang` by sage-8.0 and just default to build everything with `clang`. So in that regards we may want to start mopping up. Thoughts?",
    "created_at": "2017-04-13T01:36:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22756#issuecomment-341431",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:37" align="right">Comment 37</div>

I think we may be in a state where we will be able to remove all the OS X work around of setting `CC=clang` by sage-8.0 and just default to build everything with `clang`. So in that regards we may want to start mopping up. Thoughts?



---

archive/issue_comments_341432.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">Comment 38</div>\n\nReplying to [@kiwifb](#comment%3A37):\n> I think we may be in a state where we will be able to remove all the OS X work around of setting `CC=clang` by sage-8.0 and just default to build everything with `clang`. So in that regards we may want to start mopping up. Thoughts?\n\nI would prefer to put the mopping up on another ticket, once #12426 is ready to go, and merge this one soon (if possible), so that Python 3 can be built on OS X. Many of the changes here have to happen whether we default to `clang` or not.",
    "created_at": "2017-04-13T18:27:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22756#issuecomment-341432",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:38" align="right">Comment 38</div>

Replying to [@kiwifb](#comment%3A37):
> I think we may be in a state where we will be able to remove all the OS X work around of setting `CC=clang` by sage-8.0 and just default to build everything with `clang`. So in that regards we may want to start mopping up. Thoughts?

I would prefer to put the mopping up on another ticket, once #12426 is ready to go, and merge this one soon (if possible), so that Python 3 can be built on OS X. Many of the changes here have to happen whether we default to `clang` or not.



---

archive/issue_comments_341433.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">Comment 39</div>\n\nAlso, I am happy to review or work on any mopping up tickets.",
    "created_at": "2017-04-13T18:28:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22756#issuecomment-341433",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:39" align="right">Comment 39</div>

Also, I am happy to review or work on any mopping up tickets.



---

archive/issue_events_299680.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-04-16T10:35:33Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22756",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20packages%3A%20standard",
    "label_color": "000080",
    "label_name": "component: packages: standard",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22756#event-299680"
}
```



---

archive/issue_events_299681.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-04-16T10:35:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22756",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20python3",
    "label_color": "000080",
    "label_name": "component: python3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22756#event-299681"
}
```



---

archive/issue_comments_341434.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">Comment 41</div>\n\nping?",
    "created_at": "2017-04-24T20:39:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22756#issuecomment-341434",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:41" align="right">Comment 41</div>

ping?



---

archive/issue_comments_341435.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">Comment 42</div>\n\nSure, I think it can go in that state. Then I can some more stuff to both python2 and 3 later. Hope I can get around to it.",
    "created_at": "2017-04-24T22:00:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22756#issuecomment-341435",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:42" align="right">Comment 42</div>

Sure, I think it can go in that state. Then I can some more stuff to both python2 and 3 later. Hope I can get around to it.



---

archive/issue_events_299682.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2017-04-24T22:00:14Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22756",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22756#event-299682"
}
```



---

archive/issue_events_299683.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2017-04-24T22:00:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22756",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22756#event-299683"
}
```



---

archive/issue_comments_341436.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">Comment 43</div>\n\nThank you!\n\nRegarding clang and Python on OS X: I installed gcc 5.4.0 on a machine the other day, and then with #12426, `IS_CLANG` was set to 'no'. So if we remove parts of Python's spkg-install telling it to build with clang on OS X, Python might break. So although it would be nice to mop up, we have to be careful. (I'll try to test whether Python breaks if I use my own `gcc` to build it instead of Sage's gcc, which we know doesn't work, or clang, which does.)",
    "created_at": "2017-04-24T22:22:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22756#issuecomment-341436",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:43" align="right">Comment 43</div>

Thank you!

Regarding clang and Python on OS X: I installed gcc 5.4.0 on a machine the other day, and then with #12426, `IS_CLANG` was set to 'no'. So if we remove parts of Python's spkg-install telling it to build with clang on OS X, Python might break. So although it would be nice to mop up, we have to be careful. (I'll try to test whether Python breaks if I use my own `gcc` to build it instead of Sage's gcc, which we know doesn't work, or clang, which does.)



---

archive/issue_comments_341437.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">Comment 44</div>\n\nReplying to [@jhpalmieri](#comment%3A43):\n> Thank you!\n> \n> Regarding clang and Python on OS X: I installed gcc 5.4.0 on a machine the other day, and then with #12426, `IS_CLANG` was set to 'no'. So if we remove parts of Python's spkg-install telling it to build with clang on OS X, Python might break. So although it would be nice to mop up, we have to be careful. (I'll try to test whether Python breaks if I use my own `gcc` to build it instead of Sage's gcc, which we know doesn't work, or clang, which does.)\n\nInteresting experience. #12426 can still be tweaked, but yes we may want to prevent users to shoot themselves too much in the foot. `python` is somewhat ok because it is C and not C++ you can compile it with clang and mostly use it with gcc. Anything that would require clang++ would be in a load of troubles.\n\nWhile I don't want to impose things too strongly, I am very much of a mind to put my foot down on the compiler to be used on OS X.",
    "created_at": "2017-04-24T22:30:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22756#issuecomment-341437",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:44" align="right">Comment 44</div>

Replying to [@jhpalmieri](#comment%3A43):
> Thank you!
> 
> Regarding clang and Python on OS X: I installed gcc 5.4.0 on a machine the other day, and then with #12426, `IS_CLANG` was set to 'no'. So if we remove parts of Python's spkg-install telling it to build with clang on OS X, Python might break. So although it would be nice to mop up, we have to be careful. (I'll try to test whether Python breaks if I use my own `gcc` to build it instead of Sage's gcc, which we know doesn't work, or clang, which does.)

Interesting experience. #12426 can still be tweaked, but yes we may want to prevent users to shoot themselves too much in the foot. `python` is somewhat ok because it is C and not C++ you can compile it with clang and mostly use it with gcc. Anything that would require clang++ would be in a load of troubles.

While I don't want to impose things too strongly, I am very much of a mind to put my foot down on the compiler to be used on OS X.



---

archive/issue_events_299684.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-04-24T22:30:14Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22756",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22756#event-299684"
}
```



---

archive/issue_events_299685.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-04-24T22:30:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22756",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22756#event-299685"
}
```



---

archive/issue_comments_341438.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">Comment 45</div>\n\nReviewer name...",
    "created_at": "2017-04-24T22:30:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22756#issuecomment-341438",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:45" align="right">Comment 45</div>

Reviewer name...



---

archive/issue_events_299686.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2017-04-24T22:32:49Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22756",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22756#event-299686"
}
```



---

archive/issue_events_299687.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2017-04-24T22:32:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22756",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22756#event-299687"
}
```



---

archive/issue_comments_341439.json:
```json
{
    "body": "Reviewer: **Fran\u00e7ois Bissey**",
    "created_at": "2017-04-24T22:32:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22756#issuecomment-341439",
    "user": "https://github.com/kiwifb"
}
```

Reviewer: **François Bissey**



---

archive/issue_comments_341440.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">Comment 46</div>\n\nSorry, I really should know better.",
    "created_at": "2017-04-24T22:32:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22756#issuecomment-341440",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:46" align="right">Comment 46</div>

Sorry, I really should know better.



---

archive/issue_comments_341441.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">Comment 47</div>\n\nReplying to [@kiwifb](#comment%3A44):\n> Interesting experience. #12426 can still be tweaked, but yes we may want to prevent users to shoot themselves too much in the foot. `python` is somewhat ok because it is C and not C++ you can compile it with clang and mostly use it with gcc. Anything that would require clang++ would be in a load of troubles.\n> \n> While I don't want to impose things too strongly, I am very much of a mind to put my foot down on the compiler to be used on OS X.\n\nRight now we build `python2`, `python3` (as of this ticket), `curl`, `psutil`, and `R` using clang rather than gcc, because of troubles with gcc. I'm going to disable the clang build for each of these to see what happens with my own gcc-5.4.0. I'll follow up with the results on #12426.",
    "created_at": "2017-04-24T22:43:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22756#issuecomment-341441",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:47" align="right">Comment 47</div>

Replying to [@kiwifb](#comment%3A44):
> Interesting experience. #12426 can still be tweaked, but yes we may want to prevent users to shoot themselves too much in the foot. `python` is somewhat ok because it is C and not C++ you can compile it with clang and mostly use it with gcc. Anything that would require clang++ would be in a load of troubles.
> 
> While I don't want to impose things too strongly, I am very much of a mind to put my foot down on the compiler to be used on OS X.

Right now we build `python2`, `python3` (as of this ticket), `curl`, `psutil`, and `R` using clang rather than gcc, because of troubles with gcc. I'm going to disable the clang build for each of these to see what happens with my own gcc-5.4.0. I'll follow up with the results on #12426.



---

archive/issue_comments_341442.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">Comment 48</div>\n\nBy the way, thank you for your help with this ticket. Many parts of the branch came from your suggestions.",
    "created_at": "2017-04-24T22:44:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22756#issuecomment-341442",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:48" align="right">Comment 48</div>

By the way, thank you for your help with this ticket. Many parts of the branch came from your suggestions.



---

archive/issue_comments_341443.json:
```json
{
    "body": "<div id=\"comment:49\" align=\"right\">Comment 49</div>\n\nAuthor name...",
    "created_at": "2017-04-25T17:41:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22756#issuecomment-341443",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:49" align="right">Comment 49</div>

Author name...



---

archive/issue_events_299688.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-04-25T17:41:14Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22756",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22756#event-299688"
}
```



---

archive/issue_events_299689.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-04-25T17:41:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22756",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22756#event-299689"
}
```



---

archive/issue_comments_341444.json:
```json
{
    "body": "<div id=\"comment:50\" align=\"right\">Comment 50</div>\n\nReplying to [@kiwifb](#comment%3A46):\n> Sorry, I really should know better.\n\nMe too.",
    "created_at": "2017-04-25T18:21:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22756#issuecomment-341444",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:50" align="right">Comment 50</div>

Replying to [@kiwifb](#comment%3A46):
> Sorry, I really should know better.

Me too.



---

archive/issue_events_299690.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2017-04-25T18:21:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22756",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22756#event-299690"
}
```



---

archive/issue_events_299691.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2017-04-25T18:21:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22756",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22756#event-299691"
}
```



---

archive/issue_comments_341445.json:
```json
{
    "body": "Author: **John Palmieri**",
    "created_at": "2017-04-25T18:21:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22756#issuecomment-341445",
    "user": "https://github.com/jhpalmieri"
}
```

Author: **John Palmieri**



---

archive/issue_events_299692.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-04-28T23:54:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22756",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22756#event-299692"
}
```



---

archive/issue_events_299693.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "0605d2664b89b82472c2fb60e494744a56891989",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2017-04-28T23:54:50Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/22756",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22756#event-299693"
}
```



---

archive/issue_comments_341446.json:
```json
{
    "body": "Changed branch from **[u/jhpalmieri/python3_osx](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/python3_osx)** to **[6762fe4](https://github.com/sagemath/sagetrac-mirror/commit/6762fe4bced21a095fc20942e12500a5654b4e34)**",
    "created_at": "2017-04-28T23:54:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22756#issuecomment-341446",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/jhpalmieri/python3_osx](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/python3_osx)** to **[6762fe4](https://github.com/sagemath/sagetrac-mirror/commit/6762fe4bced21a095fc20942e12500a5654b4e34)**
