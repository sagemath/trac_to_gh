# Issue 22875: py3: operator has no longer div and idiv methods

archive/issues_022638.json:
```json
{
    "body": "related to #15995\n\nthis means that we need to change the coercion framework, and in particular\n\n* src/sage/structure/coerce.pyx\n* src/sage/structure/element.pyx\n\nCC:  @jdemeyer @tscrim @jhpalmieri @embray\n\nBranch/Commit: 9f1c2e61dd6a748483aeed2e79f9853a4a951641\n\nReviewer: Fr\u00e9d\u00e9ric Chapoton, Jeroen Demeyer\n\nAuthor: Fr\u00e9d\u00e9ric Chapoton, Jeroen Demeyer\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/22875\n\n",
    "closed_at": "2017-09-10T22:05:39Z",
    "created_at": "2017-04-26T11:42:12Z",
    "labels": [
        "component: python3"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.1",
    "title": "py3: operator has no longer div and idiv methods",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22875",
    "user": "https://github.com/fchapoton"
}
```
related to #15995

this means that we need to change the coercion framework, and in particular

* src/sage/structure/coerce.pyx
* src/sage/structure/element.pyx

CC:  @jdemeyer @tscrim @jhpalmieri @embray

Branch/Commit: 9f1c2e61dd6a748483aeed2e79f9853a4a951641

Reviewer: Frédéric Chapoton, Jeroen Demeyer

Author: Frédéric Chapoton, Jeroen Demeyer

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/22875





---

archive/issue_comments_421767.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,5 +2,5 @@\n \n this means that we need to change the coercion framework, and in particular\n \n-src/sage/structure/coerce.pyx\n-src/sage/structure/element.pyx\n+* src/sage/structure/coerce.pyx\n+* src/sage/structure/element.pyx\n``````\n",
    "created_at": "2017-04-26T11:42:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22875",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22875#issuecomment-421767",
    "user": "https://github.com/fchapoton"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,5 +2,5 @@
 
 this means that we need to change the coercion framework, and in particular
 
-src/sage/structure/coerce.pyx
-src/sage/structure/element.pyx
+* src/sage/structure/coerce.pyx
+* src/sage/structure/element.pyx
``````




---

archive/issue_comments_421768.json:
```json
{
    "body": "Changing commit from \"\" to \"9d29550f832cc01a294bf8797e3299fe308779cf\"",
    "created_at": "2017-05-27T12:38:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22875",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22875#issuecomment-421768",
    "user": "https://github.com/fchapoton"
}
```

Changing commit from "" to "9d29550f832cc01a294bf8797e3299fe308779cf"



---

archive/issue_comments_421769.json:
```json
{
    "body": "Changing branch from \"\" to \"u/chapoton/22875\"",
    "created_at": "2017-05-27T12:38:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22875",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22875#issuecomment-421769",
    "user": "https://github.com/fchapoton"
}
```

Changing branch from "" to "u/chapoton/22875"



---

archive/issue_comments_421770.json:
```json
{
    "body": "<a id='comment:2'></a>\nNew commits:\n|                                                                                                                                          |                                   |\n|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------|\n|[9d29550](https://github.com/sagemath/sagetrac-mirror/commit/9d29550f832cc01a294bf8797e3299fe308779cf)|`py3: changing from div to truediv`|",
    "created_at": "2017-05-27T12:38:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22875",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22875#issuecomment-421770",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:2'></a>
New commits:
|                                                                                                                                          |                                   |
|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------|
|[9d29550](https://github.com/sagemath/sagetrac-mirror/commit/9d29550f832cc01a294bf8797e3299fe308779cf)|`py3: changing from div to truediv`|



---

archive/issue_comments_421771.json:
```json
{
    "body": "Changing author from \"\" to \"Fr\u00e9d\u00e9ric Chapoton\"",
    "created_at": "2017-05-27T12:38:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22875",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22875#issuecomment-421771",
    "user": "https://github.com/fchapoton"
}
```

Changing author from "" to "Frédéric Chapoton"



---

archive/issue_comments_421772.json:
```json
{
    "body": "Replying to [ticket:22875 chapoton]:\n> this means that we need to change the coercion framework\n\n\nYou don't have to. You could keep using `operator.div` in Python 2. I would prefer the code to be something like\n\n```\ntry:\n    from operator import div, idiv\nexcept ImportError:\n    pass\n```\n\nPlease revert the change to lazy import, it conflicts with #22755.",
    "created_at": "2017-05-27T13:04:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22875",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22875#issuecomment-421772",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [ticket:22875 chapoton]:
> this means that we need to change the coercion framework


You don't have to. You could keep using `operator.div` in Python 2. I would prefer the code to be something like

```
try:
    from operator import div, idiv
except ImportError:
    pass
```

Please revert the change to lazy import, it conflicts with #22755.



---

archive/issue_comments_421773.json:
```json
{
    "body": "Changing commit from \"9d29550f832cc01a294bf8797e3299fe308779cf\" to \"dbc88e59c0e1953b64f3d3588656457fb85e7d12\"",
    "created_at": "2017-05-27T15:43:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22875",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22875#issuecomment-421773",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "9d29550f832cc01a294bf8797e3299fe308779cf" to "dbc88e59c0e1953b64f3d3588656457fb85e7d12"



---

archive/issue_comments_421774.json:
```json
{
    "body": "<a id='comment:4'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                              |\n|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------|\n|[dbc88e5](https://github.com/sagemath/sagetrac-mirror/commit/dbc88e59c0e1953b64f3d3588656457fb85e7d12)|`trac 22875 unchange lazy_import, change one block to TESTS::`|",
    "created_at": "2017-05-27T15:43:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22875",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22875#issuecomment-421774",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                              |
|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------|
|[dbc88e5](https://github.com/sagemath/sagetrac-mirror/commit/dbc88e59c0e1953b64f3d3588656457fb85e7d12)|`trac 22875 unchange lazy_import, change one block to TESTS::`|



---

archive/issue_comments_421775.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#22755\"",
    "created_at": "2017-05-27T15:45:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22875",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22875#issuecomment-421775",
    "user": "https://github.com/fchapoton"
}
```

Changing dependencies from "" to "#22755"



---

archive/issue_comments_421776.json:
```json
{
    "body": "Changing commit from \"dbc88e59c0e1953b64f3d3588656457fb85e7d12\" to \"e637cede497bd78ce206610fa6abd8c5035dbb95\"",
    "created_at": "2017-05-27T17:48:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22875",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22875#issuecomment-421776",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "dbc88e59c0e1953b64f3d3588656457fb85e7d12" to "e637cede497bd78ce206610fa6abd8c5035dbb95"



---

archive/issue_comments_421777.json:
```json
{
    "body": "<a id='comment:6'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                           |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------|\n|[e637ced](https://github.com/sagemath/sagetrac-mirror/commit/e637cede497bd78ce206610fa6abd8c5035dbb95)|`remove imports and traces of div and idiv`|",
    "created_at": "2017-05-27T17:48:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22875",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22875#issuecomment-421777",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                           |
|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------|
|[e637ced](https://github.com/sagemath/sagetrac-mirror/commit/e637cede497bd78ce206610fa6abd8c5035dbb95)|`remove imports and traces of div and idiv`|



---

archive/issue_comments_421778.json:
```json
{
    "body": "Changing status from new to needs_info.",
    "created_at": "2017-06-16T10:03:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22875",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22875#issuecomment-421778",
    "user": "https://github.com/fchapoton"
}
```

Changing status from new to needs_info.



---

archive/issue_comments_421779.json:
```json
{
    "body": "<a id='comment:7'></a>\nmaybe this does not really depend on #22755 ?",
    "created_at": "2017-06-16T10:03:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22875",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22875#issuecomment-421779",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:7'></a>
maybe this does not really depend on #22755 ?



---

archive/issue_comments_421780.json:
```json
{
    "body": "Changing dependencies from \"#22755\" to \"\"",
    "created_at": "2017-06-16T10:44:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22875",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22875#issuecomment-421780",
    "user": "https://github.com/jdemeyer"
}
```

Changing dependencies from "#22755" to ""



---

archive/issue_comments_421781.json:
```json
{
    "body": "<a id='comment:8'></a>\nReplying to [chapoton](#comment%3A7):\n> maybe this does not really depend on #22755 ?\n\n\nNo, it doesn't.",
    "created_at": "2017-06-16T10:44:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22875",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22875#issuecomment-421781",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'></a>
Replying to [chapoton](#comment%3A7):
> maybe this does not really depend on #22755 ?


No, it doesn't.



---

archive/issue_comments_421782.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2017-06-16T11:04:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22875",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22875#issuecomment-421782",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_421783.json:
```json
{
    "body": "<a id='comment:9'></a>\nthanks. So let me put this into \"needs_review\" and hope that a patchbot will run on it.",
    "created_at": "2017-06-16T11:04:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22875",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22875#issuecomment-421783",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:9'></a>
thanks. So let me put this into "needs_review" and hope that a patchbot will run on it.



---

archive/issue_comments_421784.json:
```json
{
    "body": "<a id='comment:10'></a>\nwell, patchbot is morally green. Please review",
    "created_at": "2017-06-16T17:29:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22875",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22875#issuecomment-421784",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:10'></a>
well, patchbot is morally green. Please review



---

archive/issue_comments_421785.json:
```json
{
    "body": "<a id='comment:11'></a>\nI'm confused by the Python 2-to-3 conversion here. When I look at documentation for the  [Python 2 `operator` module](https://docs.python.org/2/library/operator.html), I see for `operator.truediv`:\n\n```\nReturn a / b when __future__.division is in effect. This is also known as \u201ctrue\u201d division.\n```\nDoes this mean that we need `from __future__ import division` everywhere, or is the single import in sage.all enough?\n\nRegarding the change\n\n```diff\n         cdef long j\n         cdef long prec\n \n-        if op not in (operator.add, operator.sub, operator.mul, operator.div):\n+        if op not in (operator.add, operator.sub, operator.mul, operator.truediv):\n             raise ValueError(\"op must be operator.OP where OP=add, sub, mul or div\")\n \n         if not isinstance(p2, Polynomial):\n```\nin sage/rings/polynomial/polynomial_element.pyx, the docstring needs to be changed, too:\n\n```\n        - ``op`` -- ``operator.OP`` where ``OP=add`` or ``sub`` or ``mul`` or\n          ``div``.\n```\nAlso the string in the error message: \"op must be ... or *truediv*\".",
    "created_at": "2017-06-16T23:15:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22875",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22875#issuecomment-421785",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:11'></a>
I'm confused by the Python 2-to-3 conversion here. When I look at documentation for the  [Python 2 `operator` module](https://docs.python.org/2/library/operator.html), I see for `operator.truediv`:

```
Return a / b when __future__.division is in effect. This is also known as “true” division.
```
Does this mean that we need `from __future__ import division` everywhere, or is the single import in sage.all enough?

Regarding the change

```diff
         cdef long j
         cdef long prec
 
-        if op not in (operator.add, operator.sub, operator.mul, operator.div):
+        if op not in (operator.add, operator.sub, operator.mul, operator.truediv):
             raise ValueError("op must be operator.OP where OP=add, sub, mul or div")
 
         if not isinstance(p2, Polynomial):
```
in sage/rings/polynomial/polynomial_element.pyx, the docstring needs to be changed, too:

```
        - ``op`` -- ``operator.OP`` where ``OP=add`` or ``sub`` or ``mul`` or
          ``div``.
```
Also the string in the error message: "op must be ... or *truediv*".



---

archive/issue_comments_421786.json:
```json
{
    "body": "Changing commit from \"e637cede497bd78ce206610fa6abd8c5035dbb95\" to \"bf738fef2c0158699d81c55debfbfbdcfc4237c2\"",
    "created_at": "2017-06-17T07:03:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22875",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22875#issuecomment-421786",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "e637cede497bd78ce206610fa6abd8c5035dbb95" to "bf738fef2c0158699d81c55debfbfbdcfc4237c2"



---

archive/issue_comments_421787.json:
```json
{
    "body": "<a id='comment:12'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                            |\n|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------|\n|[b2805ff](https://github.com/sagemath/sagetrac-mirror/commit/b2805ffe0a705fa7185ece0c1101fe99abacb8e5)|`Merge branch 'u/chapoton/22875' in 8.0.b10`|\n|[bf738fe](https://github.com/sagemath/sagetrac-mirror/commit/bf738fef2c0158699d81c55debfbfbdcfc4237c2)|`trac 2275 truediv in doc`|",
    "created_at": "2017-06-17T07:03:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22875",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22875#issuecomment-421787",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                            |
|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------|
|[b2805ff](https://github.com/sagemath/sagetrac-mirror/commit/b2805ffe0a705fa7185ece0c1101fe99abacb8e5)|`Merge branch 'u/chapoton/22875' in 8.0.b10`|
|[bf738fe](https://github.com/sagemath/sagetrac-mirror/commit/bf738fef2c0158699d81c55debfbfbdcfc4237c2)|`trac 2275 truediv in doc`|



---

archive/issue_comments_421788.json:
```json
{
    "body": "<a id='comment:13'></a>\n* in python3, div does no longer exist\n\n* in python2, the behaviour of truediv is the same as in python3\n\n* the future import transforms the behaviour of div and / in python2 to become the same as truediv\n\nThe strategy here is very simple : get rid of any use of div everywhere, and use truediv instead. This works smoothly, as the bot has been green already.\n\nThis does not fix completely the division issue, as we may have later to add the future import in some files that use /. This has already been partially done.",
    "created_at": "2017-06-17T07:09:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22875",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22875#issuecomment-421788",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:13'></a>
* in python3, div does no longer exist

* in python2, the behaviour of truediv is the same as in python3

* the future import transforms the behaviour of div and / in python2 to become the same as truediv

The strategy here is very simple : get rid of any use of div everywhere, and use truediv instead. This works smoothly, as the bot has been green already.

This does not fix completely the division issue, as we may have later to add the future import in some files that use /. This has already been partially done.



---

archive/issue_comments_421789.json:
```json
{
    "body": "<a id='comment:14'></a>\ngreen bot !",
    "created_at": "2017-06-17T20:43:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22875",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22875#issuecomment-421789",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:14'></a>
green bot !



---

archive/issue_comments_421790.json:
```json
{
    "body": "<a id='comment:15'></a>\nReplying to [jhpalmieri](#comment%3A11):\n> I'm confused by the Python 2-to-3 conversion here. When I look at documentation for the  [Python 2 `operator` module](https://docs.python.org/2/library/operator.html), I see for `operator.truediv`:\n> \n> ```\n> Return a / b when __future__.division is in effect. This is also known as \u201ctrue\u201d division.\n> ```\n\n\nYou need to interpret it \"Return `a/b` as if `__future__.division` is in effect\" (I agree that the documentation is a bit confusing). It does true division regardless of any future imports. Analogously, `operator.div` does old-style division regardless of any futute imports.",
    "created_at": "2017-06-19T08:05:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22875",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22875#issuecomment-421790",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:15'></a>
Replying to [jhpalmieri](#comment%3A11):
> I'm confused by the Python 2-to-3 conversion here. When I look at documentation for the  [Python 2 `operator` module](https://docs.python.org/2/library/operator.html), I see for `operator.truediv`:
> 
> ```
> Return a / b when __future__.division is in effect. This is also known as “true” division.
> ```


You need to interpret it "Return `a/b` as if `__future__.division` is in effect" (I agree that the documentation is a bit confusing). It does true division regardless of any future imports. Analogously, `operator.div` does old-style division regardless of any futute imports.



---

archive/issue_comments_421791.json:
```json
{
    "body": "<a id='comment:16'></a>\n1. `src/sage/ext/fast_callable.pyx`: I guess you should support both `div` and `truediv` (instead of only `truediv`).\n\n2. `src/sage/interfaces/maxima_lib.py`: same as 1\n\n3. `src/sage/rings/integer.pyx`: it is wrong to call `operator.truediv` from `__div__`. Either call `div` from `__div__` or `truediv` from `__truediv__`.\n\n4. `src/sage/rings/polynomial/polynomial_element.pyx`: `composed_op`: same as 1\n\n5. `src/sage/rings/qqbar.py`: add `from __future__ import division` such that the semantics remain compatible.\n\n6. `src/sage/rings/rational.pyx`: same as 3\n\n7. `src/sage/rings/real_lazy.pyx`: same as 5\n\n8. `src/sage/structure/coerce.pyx`: keep the doctests involving `operator.div` on Python 2. We still want that to work on Python 2.\n\n9. `src/sage/structure/coerce_actions.pyx`: same as 8\n\n10. `src/sage/structure/element.pyx`: this is really wrong: `from operator import truediv as div`. \"truediv\" and \"div\" are distinct operators which should be handled separately.\n\nI don't really understand the symbolic stuff, so I cannot really check it well. On the other hard, there is probably no reason for symbolics to treat \"div\" differently from \"truediv\".",
    "created_at": "2017-06-19T08:30:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22875",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22875#issuecomment-421791",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:16'></a>
1. `src/sage/ext/fast_callable.pyx`: I guess you should support both `div` and `truediv` (instead of only `truediv`).

2. `src/sage/interfaces/maxima_lib.py`: same as 1

3. `src/sage/rings/integer.pyx`: it is wrong to call `operator.truediv` from `__div__`. Either call `div` from `__div__` or `truediv` from `__truediv__`.

4. `src/sage/rings/polynomial/polynomial_element.pyx`: `composed_op`: same as 1

5. `src/sage/rings/qqbar.py`: add `from __future__ import division` such that the semantics remain compatible.

6. `src/sage/rings/rational.pyx`: same as 3

7. `src/sage/rings/real_lazy.pyx`: same as 5

8. `src/sage/structure/coerce.pyx`: keep the doctests involving `operator.div` on Python 2. We still want that to work on Python 2.

9. `src/sage/structure/coerce_actions.pyx`: same as 8

10. `src/sage/structure/element.pyx`: this is really wrong: `from operator import truediv as div`. "truediv" and "div" are distinct operators which should be handled separately.

I don't really understand the symbolic stuff, so I cannot really check it well. On the other hard, there is probably no reason for symbolics to treat "div" differently from "truediv".



---

archive/issue_comments_421792.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-06-19T08:30:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22875",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22875#issuecomment-421792",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_421793.json:
```json
{
    "body": "<a id='comment:17'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                           |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------|\n|[a3833a6](https://github.com/sagemath/sagetrac-mirror/commit/a3833a62e16b00f7c81a814fb1f576d441cd0f0f)|`Merge branch 'u/chapoton/22875' in 8.1.b2`|",
    "created_at": "2017-08-19T12:43:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22875",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22875#issuecomment-421793",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:17'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                           |
|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------|
|[a3833a6](https://github.com/sagemath/sagetrac-mirror/commit/a3833a62e16b00f7c81a814fb1f576d441cd0f0f)|`Merge branch 'u/chapoton/22875' in 8.1.b2`|



---

archive/issue_comments_421794.json:
```json
{
    "body": "Changing commit from \"bf738fef2c0158699d81c55debfbfbdcfc4237c2\" to \"a3833a62e16b00f7c81a814fb1f576d441cd0f0f\"",
    "created_at": "2017-08-19T12:43:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22875",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22875#issuecomment-421794",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "bf738fef2c0158699d81c55debfbfbdcfc4237c2" to "a3833a62e16b00f7c81a814fb1f576d441cd0f0f"



---

archive/issue_comments_421795.json:
```json
{
    "body": "<a id='comment:18'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                     |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------|\n|[275e7a3](https://github.com/sagemath/sagetrac-mirror/commit/275e7a3d2e069b156b104a138a26449063398088)|`trac 22875 adding future division import in 2 files`|",
    "created_at": "2017-08-21T07:51:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22875",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22875#issuecomment-421795",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:18'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                     |
|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------|
|[275e7a3](https://github.com/sagemath/sagetrac-mirror/commit/275e7a3d2e069b156b104a138a26449063398088)|`trac 22875 adding future division import in 2 files`|



---

archive/issue_comments_421796.json:
```json
{
    "body": "Changing commit from \"a3833a62e16b00f7c81a814fb1f576d441cd0f0f\" to \"275e7a3d2e069b156b104a138a26449063398088\"",
    "created_at": "2017-08-21T07:51:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22875",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22875#issuecomment-421796",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "a3833a62e16b00f7c81a814fb1f576d441cd0f0f" to "275e7a3d2e069b156b104a138a26449063398088"



---

archive/issue_comments_421797.json:
```json
{
    "body": "<a id='comment:19'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                           |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------|\n|[bd248d3](https://github.com/sagemath/sagetrac-mirror/commit/bd248d362b834a9d07f8d8bdd664ebe9f2f0ff5b)|`Merge branch 'u/chapoton/22875' in 8.1.b3`|\n|[ccbbd22](https://github.com/sagemath/sagetrac-mirror/commit/ccbbd22d1a75ef5458d982913521e53a61ff9ef9)|`change in fast_callable.pyx`|",
    "created_at": "2017-08-22T09:58:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22875",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22875#issuecomment-421797",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:19'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                           |
|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------|
|[bd248d3](https://github.com/sagemath/sagetrac-mirror/commit/bd248d362b834a9d07f8d8bdd664ebe9f2f0ff5b)|`Merge branch 'u/chapoton/22875' in 8.1.b3`|
|[ccbbd22](https://github.com/sagemath/sagetrac-mirror/commit/ccbbd22d1a75ef5458d982913521e53a61ff9ef9)|`change in fast_callable.pyx`|



---

archive/issue_comments_421798.json:
```json
{
    "body": "Changing commit from \"275e7a3d2e069b156b104a138a26449063398088\" to \"ccbbd22d1a75ef5458d982913521e53a61ff9ef9\"",
    "created_at": "2017-08-22T09:58:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22875",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22875#issuecomment-421798",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "275e7a3d2e069b156b104a138a26449063398088" to "ccbbd22d1a75ef5458d982913521e53a61ff9ef9"



---

archive/issue_comments_421799.json:
```json
{
    "body": "<a id='comment:20'></a>\nWorking on getting a working `import sage.all` on Python 3 and this is one of the fixes needed (among others).  I can work on the needed updates if you want.",
    "created_at": "2017-09-05T14:16:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22875",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22875#issuecomment-421799",
    "user": "https://github.com/embray"
}
```

<a id='comment:20'></a>
Working on getting a working `import sage.all` on Python 3 and this is one of the fixes needed (among others).  I can work on the needed updates if you want.



---

archive/issue_comments_421800.json:
```json
{
    "body": "<a id='comment:21'></a>\nCool ! This is what I was trying to do, see the branch\n\npublic/python3-experiment-v1\n\nfor nearly the latest stage that I reached.",
    "created_at": "2017-09-05T14:20:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22875",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22875#issuecomment-421800",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:21'></a>
Cool ! This is what I was trying to do, see the branch

public/python3-experiment-v1

for nearly the latest stage that I reached.



---

archive/issue_comments_421801.json:
```json
{
    "body": "<a id='comment:22'></a>\nI'll push a reviewer commit, which is easier than telling you what to fix.",
    "created_at": "2017-09-05T14:42:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22875",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22875#issuecomment-421801",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:22'></a>
I'll push a reviewer commit, which is easier than telling you what to fix.



---

archive/issue_comments_421802.json:
```json
{
    "body": "<a id='comment:23'></a>\nReplying to [chapoton](#comment%3A21):\n> Cool ! This is what I was trying to do, see the branch\n> \n> public/python3-experiment-v1\n> \n> for nearly the latest stage that I reached.\n\n\nAh, I wasn't sure what your latest branch was.  I was confused because there weren't tickets for some things yet, but I was pretty sure you had something closer to working somewhere...",
    "created_at": "2017-09-05T15:01:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22875",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22875#issuecomment-421802",
    "user": "https://github.com/embray"
}
```

<a id='comment:23'></a>
Replying to [chapoton](#comment%3A21):
> Cool ! This is what I was trying to do, see the branch
> 
> public/python3-experiment-v1
> 
> for nearly the latest stage that I reached.


Ah, I wasn't sure what your latest branch was.  I was confused because there weren't tickets for some things yet, but I was pretty sure you had something closer to working somewhere...



---

archive/issue_comments_421803.json:
```json
{
    "body": "<a id='comment:24'></a>\nI went slightly further, in particular by adding `__hash__` in one Complex Field class somewhere. I do have a branch, I think.",
    "created_at": "2017-09-05T15:20:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22875",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22875#issuecomment-421803",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:24'></a>
I went slightly further, in particular by adding `__hash__` in one Complex Field class somewhere. I do have a branch, I think.



---

archive/issue_comments_421804.json:
```json
{
    "body": "Changing branch from \"u/chapoton/22875\" to \"u/jdemeyer/22875\"",
    "created_at": "2017-09-05T15:28:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22875",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22875#issuecomment-421804",
    "user": "https://github.com/jdemeyer"
}
```

Changing branch from "u/chapoton/22875" to "u/jdemeyer/22875"



---

archive/issue_comments_421805.json:
```json
{
    "body": "Changing author from \"Fr\u00e9d\u00e9ric Chapoton\" to \"Fr\u00e9d\u00e9ric Chapoton, Jeroen Demeyer\"",
    "created_at": "2017-09-05T15:31:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22875",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22875#issuecomment-421805",
    "user": "https://github.com/jdemeyer"
}
```

Changing author from "Frédéric Chapoton" to "Frédéric Chapoton, Jeroen Demeyer"



---

archive/issue_comments_421806.json:
```json
{
    "body": "<a id='comment:26'></a>\nThese are my proposed fixes. Essentially, all fixes are to keep support for Python 2 division where applicable. I reintroduced some instances of `operator.div`, but all those are guarded in a `try`/`except` or are in `__div__` which exists only in Python 2.\n\nFor me, this ticket can get positive review if you agree with my commit.\n\n---\nNew commits:\n|                                                                                                                                          |                                                      |\n|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------|\n|[6f86324](https://github.com/sagemath/sagetrac-mirror/commit/6f8632478b2d68509dc37d6bfc92c5d2461b1c81)|`Keep support for old-style division where applicable`|",
    "created_at": "2017-09-05T15:31:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22875",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22875#issuecomment-421806",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:26'></a>
These are my proposed fixes. Essentially, all fixes are to keep support for Python 2 division where applicable. I reintroduced some instances of `operator.div`, but all those are guarded in a `try`/`except` or are in `__div__` which exists only in Python 2.

For me, this ticket can get positive review if you agree with my commit.

---
New commits:
|                                                                                                                                          |                                                      |
|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------|
|[6f86324](https://github.com/sagemath/sagetrac-mirror/commit/6f8632478b2d68509dc37d6bfc92c5d2461b1c81)|`Keep support for old-style division where applicable`|



---

archive/issue_comments_421807.json:
```json
{
    "body": "Changing commit from \"ccbbd22d1a75ef5458d982913521e53a61ff9ef9\" to \"6f8632478b2d68509dc37d6bfc92c5d2461b1c81\"",
    "created_at": "2017-09-05T15:31:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22875",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22875#issuecomment-421807",
    "user": "https://github.com/jdemeyer"
}
```

Changing commit from "ccbbd22d1a75ef5458d982913521e53a61ff9ef9" to "6f8632478b2d68509dc37d6bfc92c5d2461b1c81"



---

archive/issue_comments_421808.json:
```json
{
    "body": "<a id='comment:27'></a>\none failing doctest ('div' gets duplicated in this list, somehow)",
    "created_at": "2017-09-06T05:51:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22875",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22875#issuecomment-421808",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:27'></a>
one failing doctest ('div' gets duplicated in this list, somehow)



---

archive/issue_comments_421809.json:
```json
{
    "body": "Changing commit from \"6f8632478b2d68509dc37d6bfc92c5d2461b1c81\" to \"9f1c2e61dd6a748483aeed2e79f9853a4a951641\"",
    "created_at": "2017-09-06T07:55:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22875",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22875#issuecomment-421809",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "6f8632478b2d68509dc37d6bfc92c5d2461b1c81" to "9f1c2e61dd6a748483aeed2e79f9853a4a951641"



---

archive/issue_comments_421810.json:
```json
{
    "body": "<a id='comment:28'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                    |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------|\n|[9f1c2e6](https://github.com/sagemath/sagetrac-mirror/commit/9f1c2e61dd6a748483aeed2e79f9853a4a951641)|`builtin_functions now contains two 'div' functions`|",
    "created_at": "2017-09-06T07:55:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22875",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22875#issuecomment-421810",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:28'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                    |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------|
|[9f1c2e6](https://github.com/sagemath/sagetrac-mirror/commit/9f1c2e61dd6a748483aeed2e79f9853a4a951641)|`builtin_functions now contains two 'div' functions`|



---

archive/issue_comments_421811.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-09-06T07:55:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22875",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22875#issuecomment-421811",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_421812.json:
```json
{
    "body": "<a id='comment:29'></a>\nFixed.",
    "created_at": "2017-09-06T07:55:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22875",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22875#issuecomment-421812",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:29'></a>
Fixed.



---

archive/issue_comments_421813.json:
```json
{
    "body": "<a id='comment:30'></a>\nLooks good to me. I am ready to set to positive. Thanks a lot for finishing the job !\n\nBut maybe one should have more patchbot reports, including some with more optional packages installed, just to be sure that nothing serious breaks ?",
    "created_at": "2017-09-06T11:21:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22875",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22875#issuecomment-421813",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:30'></a>
Looks good to me. I am ready to set to positive. Thanks a lot for finishing the job !

But maybe one should have more patchbot reports, including some with more optional packages installed, just to be sure that nothing serious breaks ?



---

archive/issue_events_075394.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-09-07T18:06:34Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/22875",
    "milestone": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22875#event-75394"
}
```



---

archive/issue_comments_421814.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Fr\u00e9d\u00e9ric Chapoton, Jeroen Demeyer\"",
    "created_at": "2017-09-07T18:06:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22875",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22875#issuecomment-421814",
    "user": "https://github.com/fchapoton"
}
```

Changing reviewer from "" to "Frédéric Chapoton, Jeroen Demeyer"



---

archive/issue_comments_421815.json:
```json
{
    "body": "<a id='comment:31'></a>\nok, there are two green bots. I am setting to positive.",
    "created_at": "2017-09-07T18:06:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22875",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22875#issuecomment-421815",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:31'></a>
ok, there are two green bots. I am setting to positive.



---

archive/issue_comments_421816.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-09-07T18:06:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22875",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22875#issuecomment-421816",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_421817.json:
```json
{
    "body": "Changing branch from \"u/jdemeyer/22875\" to \"9f1c2e61dd6a748483aeed2e79f9853a4a951641\"",
    "created_at": "2017-09-10T22:05:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22875",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22875#issuecomment-421817",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/jdemeyer/22875" to "9f1c2e61dd6a748483aeed2e79f9853a4a951641"



---

archive/issue_comments_421818.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-09-10T22:05:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22875",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22875#issuecomment-421818",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_075395.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-09-10T22:05:39Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/22875",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22875#event-75395"
}
```
