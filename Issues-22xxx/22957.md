# Issue 22957: Faster implementation for has_perfect_matching

archive/issues_022720.json:
```json
{
    "assignees": [],
    "body": "This ticket is a quick follow-up of #22898.\n\nThe implementation of `has_perfect_matching` in #22898 is very inneficient, since it relies on a brute force search of all possible matchings until it finds one (can take an exponential time).\n\nTry with, e.g.:\n\n```\nsage: R = graphs.RandomBipartite(1000, 1000, 1/100)\nsage: R.has_perfect_matching()\n```\n\nEdmonds algorithm finds a maximal matching in polynomial time, then it suffices to check whether it has |V|/2 edges. LP solvers are pretty fast too.\n\n\n\nCC:  @dcoudert @dkrenn @mkoeppe\n\nComponent: **graph theory**\n\nAuthor: **Thierry Monteil**\n\nBranch/Commit: **[`3bde431`](https://github.com/sagemath/sagetrac-mirror/commit/3bde4310febdd6bd3bb0b1d65b9056e40d14a306)**\n\nReviewer: **David Coudert, Daniel Krenn**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/22957_\n\n",
    "closed_at": "2017-05-16T22:21:58Z",
    "created_at": "2017-05-07T16:43:54Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20graph%20theory",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.0",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Faster implementation for has_perfect_matching",
    "type": "issue",
    "updated_at": "2017-05-16T22:21:58Z",
    "url": "https://github.com/sagemath/sage/issues/22957",
    "user": "https://github.com/sagetrac-tmonteil"
}
```
This ticket is a quick follow-up of #22898.

The implementation of `has_perfect_matching` in #22898 is very inneficient, since it relies on a brute force search of all possible matchings until it finds one (can take an exponential time).

Try with, e.g.:

```
sage: R = graphs.RandomBipartite(1000, 1000, 1/100)
sage: R.has_perfect_matching()
```

Edmonds algorithm finds a maximal matching in polynomial time, then it suffices to check whether it has |V|/2 edges. LP solvers are pretty fast too.



CC:  @dcoudert @dkrenn @mkoeppe

Component: **graph theory**

Author: **Thierry Monteil**

Branch/Commit: **[`3bde431`](https://github.com/sagemath/sagetrac-mirror/commit/3bde4310febdd6bd3bb0b1d65b9056e40d14a306)**

Reviewer: **David Coudert, Daniel Krenn**

_Issue created by migration from https://trac.sagemath.org/ticket/22957_





---

archive/issue_events_317355.json:
```json
{
    "actor": "https://github.com/sagetrac-tmonteil",
    "created_at": "2017-05-07T16:43:54Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/22957",
    "milestone_number": null,
    "milestone_title": "sage-8.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22957#event-317355"
}
```



---

archive/issue_events_317356.json:
```json
{
    "actor": "https://github.com/sagetrac-tmonteil",
    "created_at": "2017-05-07T16:43:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22957",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20graph%20theory",
    "label_color": "0000ff",
    "label_name": "c: graph theory",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22957#event-317356"
}
```



---

archive/issue_events_317357.json:
```json
{
    "actor": "https://github.com/sagetrac-tmonteil",
    "created_at": "2017-05-07T16:43:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22957",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22957#event-317357"
}
```



---

archive/issue_events_317358.json:
```json
{
    "actor": "https://github.com/sagetrac-tmonteil",
    "created_at": "2017-05-07T16:43:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22957",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22957#event-317358"
}
```



---

archive/issue_comments_342888.json:
```json
{
    "body": "Branch: **[u/tmonteil/faster_implementation_for_has_perfect_matching](https://github.com/sagemath/sagetrac-mirror/tree/u/tmonteil/faster_implementation_for_has_perfect_matching)**",
    "created_at": "2017-05-07T17:19:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22957",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22957#issuecomment-342888",
    "user": "https://github.com/sagetrac-tmonteil"
}
```

Branch: **[u/tmonteil/faster_implementation_for_has_perfect_matching](https://github.com/sagemath/sagetrac-mirror/tree/u/tmonteil/faster_implementation_for_has_perfect_matching)**



---

archive/issue_comments_342889.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nNote that for the LP formulation, there is a simpler (perhaps faster) formulation for perfect matching which does not rely on maximal matching. However, this ticket is basically a quick fix for #22898 which hangs too often.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e3ee8828ba86c70eacc30cae7ae2895f34bc3990\"><code>e3ee882</code></a></td><td><code>#22957 : faster implementation for has_perfect_matching.</code></td></tr></table>\n",
    "created_at": "2017-05-07T17:32:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22957",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22957#issuecomment-342889",
    "user": "https://github.com/sagetrac-tmonteil"
}
```

<div id="comment:2" align="right">comment:2</div>

Note that for the LP formulation, there is a simpler (perhaps faster) formulation for perfect matching which does not rely on maximal matching. However, this ticket is basically a quick fix for #22898 which hangs too often.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e3ee8828ba86c70eacc30cae7ae2895f34bc3990"><code>e3ee882</code></a></td><td><code>#22957 : faster implementation for has_perfect_matching.</code></td></tr></table>




---

archive/issue_comments_342890.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -9,6 +9,6 @@\n sage: R.has_perfect_matching()\n ```\n \n-Edmonds algorithm finds a maximal matching in polynomial time, then it suffices to check whether it has n/2 edges.\n+Edmonds algorithm finds a maximal matching in polynomial time, then it suffices to check whether it has |V|/2 edges. LP solvers are pretty fast too.\n \n \n``````\n",
    "created_at": "2017-05-07T17:32:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22957",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22957#issuecomment-342890",
    "user": "https://github.com/sagetrac-tmonteil"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -9,6 +9,6 @@
 sage: R.has_perfect_matching()
 ```
 
-Edmonds algorithm finds a maximal matching in polynomial time, then it suffices to check whether it has n/2 edges.
+Edmonds algorithm finds a maximal matching in polynomial time, then it suffices to check whether it has |V|/2 edges. LP solvers are pretty fast too.
 
 
``````




---

archive/issue_events_317359.json:
```json
{
    "actor": "https://github.com/sagetrac-tmonteil",
    "created_at": "2017-05-07T17:32:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22957",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22957#event-317359"
}
```



---

archive/issue_comments_342891.json:
```json
{
    "body": "Commit: **[`e3ee882`](https://github.com/sagemath/sagetrac-mirror/commit/e3ee8828ba86c70eacc30cae7ae2895f34bc3990)**",
    "created_at": "2017-05-07T17:32:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22957",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22957#issuecomment-342891",
    "user": "https://github.com/sagetrac-tmonteil"
}
```

Commit: **[`e3ee882`](https://github.com/sagemath/sagetrac-mirror/commit/e3ee8828ba86c70eacc30cae7ae2895f34bc3990)**



---

archive/issue_comments_342892.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nPasses all tests and is effectively much faster. Good to go.\n\nWhich LP formulation have you in mind ?",
    "created_at": "2017-05-07T18:43:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22957",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22957#issuecomment-342892",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:3" align="right">comment:3</div>

Passes all tests and is effectively much faster. Good to go.

Which LP formulation have you in mind ?



---

archive/issue_events_317360.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2017-05-07T18:43:01Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22957",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22957#event-317360"
}
```



---

archive/issue_events_317361.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2017-05-07T18:43:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22957",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22957#event-317361"
}
```



---

archive/issue_comments_342893.json:
```json
{
    "body": "Reviewer: **David Coudert**",
    "created_at": "2017-05-07T18:43:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22957",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22957#issuecomment-342893",
    "user": "https://github.com/dcoudert"
}
```

Reviewer: **David Coudert**



---

archive/issue_comments_342894.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nReplying to [@dcoudert](#comment%3A3):\n> Passes all tests and is effectively much faster. Good to go.\n> \n> Which LP formulation have you in mind ?\n\nThe straightforward one : put binary variables on the edges, and for each vertex, the sum of the edges incident to it is 1, no objective. I just implemented it, and it is significantly faster than the one using the `matching` method, let me add it to avoid a new ticket.",
    "created_at": "2017-05-07T20:10:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22957",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22957#issuecomment-342894",
    "user": "https://github.com/sagetrac-tmonteil"
}
```

<div id="comment:4" align="right">comment:4</div>

Replying to [@dcoudert](#comment%3A3):
> Passes all tests and is effectively much faster. Good to go.
> 
> Which LP formulation have you in mind ?

The straightforward one : put binary variables on the edges, and for each vertex, the sum of the edges incident to it is 1, no objective. I just implemented it, and it is significantly faster than the one using the `matching` method, let me add it to avoid a new ticket.



---

archive/issue_events_317362.json:
```json
{
    "actor": "https://github.com/sagetrac-tmonteil",
    "created_at": "2017-05-07T20:10:07Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22957",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22957#event-317362"
}
```



---

archive/issue_events_317363.json:
```json
{
    "actor": "https://github.com/sagetrac-tmonteil",
    "created_at": "2017-05-07T20:10:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22957",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22957#event-317363"
}
```



---

archive/issue_comments_342895.json:
```json
{
    "body": "<div id=\"comment:5\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/841850bf34d64cf6721ce25a27f7c51aaa2864db\"><code>841850b</code></a></td><td><code>#22957 : ad-hoc faster LP formulation for has_perfect_matching.</code></td></tr></table>\n",
    "created_at": "2017-05-07T20:11:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22957",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22957#issuecomment-342895",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:5"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/841850bf34d64cf6721ce25a27f7c51aaa2864db"><code>841850b</code></a></td><td><code>#22957 : ad-hoc faster LP formulation for has_perfect_matching.</code></td></tr></table>




---

archive/issue_comments_342896.json:
```json
{
    "body": "Changed commit from **[`e3ee882`](https://github.com/sagemath/sagetrac-mirror/commit/e3ee8828ba86c70eacc30cae7ae2895f34bc3990)** to **[`841850b`](https://github.com/sagemath/sagetrac-mirror/commit/841850bf34d64cf6721ce25a27f7c51aaa2864db)**",
    "created_at": "2017-05-07T20:11:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22957",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22957#issuecomment-342896",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`e3ee882`](https://github.com/sagemath/sagetrac-mirror/commit/e3ee8828ba86c70eacc30cae7ae2895f34bc3990)** to **[`841850b`](https://github.com/sagemath/sagetrac-mirror/commit/841850bf34d64cf6721ce25a27f7c51aaa2864db)**



---

archive/issue_events_317364.json:
```json
{
    "actor": "https://github.com/sagetrac-tmonteil",
    "created_at": "2017-05-07T20:18:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22957",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22957#event-317364"
}
```



---

archive/issue_events_317365.json:
```json
{
    "actor": "https://github.com/sagetrac-tmonteil",
    "created_at": "2017-05-07T20:18:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22957",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22957#event-317365"
}
```



---

archive/issue_events_317366.json:
```json
{
    "actor": "https://github.com/sagetrac-tmonteil",
    "created_at": "2017-05-07T20:27:38Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22957",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22957#event-317366"
}
```



---

archive/issue_events_317367.json:
```json
{
    "actor": "https://github.com/sagetrac-tmonteil",
    "created_at": "2017-05-07T20:27:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22957",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22957#event-317367"
}
```



---

archive/issue_comments_342897.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nOK, sorry again, actually, both formulations have good and bad instances, so let me allow both (but it requires some documentation to explain).",
    "created_at": "2017-05-07T20:27:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22957",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22957#issuecomment-342897",
    "user": "https://github.com/sagetrac-tmonteil"
}
```

<div id="comment:7" align="right">comment:7</div>

OK, sorry again, actually, both formulations have good and bad instances, so let me allow both (but it requires some documentation to explain).



---

archive/issue_comments_342898.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nThe proposed LP is roughly the same (no weight, no minimization, just feasibility), but its focused so interesting.\n\nCplex is usually very fast to say that the problem is unfeasible, but Cplex remains a mystery and it's not easy to say which instance is the best.\n\n```\nsage: G = graphs.CycleGraph(500)\nsage: %time L = G.matching(algorithm='LP')\nCPU times: user 30.7 ms, sys: 2.33 ms, total: 33 ms\nWall time: 28.1 ms\nsage: %time G.has_perfect_matching(algorithm='LP')\nCPU times: user 33.5 ms, sys: 2.18 ms, total: 35.7 ms\nWall time: 34.7 ms\nTrue\nsage: G = graphs.CycleGraph(501)\nsage: %time L = G.matching(algorithm='LP')\nCPU times: user 31.2 ms, sys: 2.35 ms, total: 33.6 ms\nWall time: 28.3 ms\nsage: %time G.has_perfect_matching(algorithm='LP')\nCPU times: user 34.6 ms, sys: 2.33 ms, total: 36.9 ms\nWall time: 35.8 ms\nFalse\nsage: G = graphs.RandomGNP(1000, .1)\nsage: %time L = G.matching(algorithm='LP')\nCPU times: user 4.02 s, sys: 440 ms, total: 4.46 s\nWall time: 3.02 s\nsage: %time G.has_perfect_matching(algorithm='LP')\nCPU times: user 1.95 s, sys: 97.5 ms, total: 2.05 s\nWall time: 2.02 s\nTrue\n```",
    "created_at": "2017-05-07T20:33:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22957",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22957#issuecomment-342898",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:8" align="right">comment:8</div>

The proposed LP is roughly the same (no weight, no minimization, just feasibility), but its focused so interesting.

Cplex is usually very fast to say that the problem is unfeasible, but Cplex remains a mystery and it's not easy to say which instance is the best.

```
sage: G = graphs.CycleGraph(500)
sage: %time L = G.matching(algorithm='LP')
CPU times: user 30.7 ms, sys: 2.33 ms, total: 33 ms
Wall time: 28.1 ms
sage: %time G.has_perfect_matching(algorithm='LP')
CPU times: user 33.5 ms, sys: 2.18 ms, total: 35.7 ms
Wall time: 34.7 ms
True
sage: G = graphs.CycleGraph(501)
sage: %time L = G.matching(algorithm='LP')
CPU times: user 31.2 ms, sys: 2.35 ms, total: 33.6 ms
Wall time: 28.3 ms
sage: %time G.has_perfect_matching(algorithm='LP')
CPU times: user 34.6 ms, sys: 2.33 ms, total: 36.9 ms
Wall time: 35.8 ms
False
sage: G = graphs.RandomGNP(1000, .1)
sage: %time L = G.matching(algorithm='LP')
CPU times: user 4.02 s, sys: 440 ms, total: 4.46 s
Wall time: 3.02 s
sage: %time G.has_perfect_matching(algorithm='LP')
CPU times: user 1.95 s, sys: 97.5 ms, total: 2.05 s
Wall time: 2.02 s
True
```



---

archive/issue_comments_342899.json:
```json
{
    "body": "Changed commit from **[`841850b`](https://github.com/sagemath/sagetrac-mirror/commit/841850bf34d64cf6721ce25a27f7c51aaa2864db)** to **[`27f66e6`](https://github.com/sagemath/sagetrac-mirror/commit/27f66e6b85f7cc5159be1524aa21064ef9fccddb)**",
    "created_at": "2017-05-07T21:43:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22957",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22957#issuecomment-342899",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`841850b`](https://github.com/sagemath/sagetrac-mirror/commit/841850bf34d64cf6721ce25a27f7c51aaa2864db)** to **[`27f66e6`](https://github.com/sagemath/sagetrac-mirror/commit/27f66e6b85f7cc5159be1524aa21064ef9fccddb)**



---

archive/issue_comments_342900.json:
```json
{
    "body": "<div id=\"comment:9\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/27f66e6b85f7cc5159be1524aa21064ef9fccddb\"><code>27f66e6</code></a></td><td><code>#22957 : allow both LP formulations for has_perfect_matching.</code></td></tr></table>\n",
    "created_at": "2017-05-07T21:43:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22957",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22957#issuecomment-342900",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:9"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/27f66e6b85f7cc5159be1524aa21064ef9fccddb"><code>27f66e6</code></a></td><td><code>#22957 : allow both LP formulations for has_perfect_matching.</code></td></tr></table>




---

archive/issue_events_317368.json:
```json
{
    "actor": "https://github.com/sagetrac-tmonteil",
    "created_at": "2017-05-07T21:54:28Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22957",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22957#event-317368"
}
```



---

archive/issue_events_317369.json:
```json
{
    "actor": "https://github.com/sagetrac-tmonteil",
    "created_at": "2017-05-07T21:54:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22957",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22957#event-317369"
}
```



---

archive/issue_comments_342901.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nThe LP formulations look similar, but the polytopes are very different (in particular, the LP_matching one is kind of \"relaxed\" and always has integer points). I am not specialist at all, but there might be some theoretical results on which shapes are better handled by which solver strategies (perhaps Matthias can tell more about this).\n\nHere, the best strategy seems to depend on the solver (i do not have Cplex installed):\n\n```\nsage: G = graphs.RandomBipartite(1000, 1000, 1/100)\nsage: %time G.has_perfect_matching(algorithm='LP_matching', solver='Glpk')\nCPU times: user 2.54 s, sys: 16 ms, total: 2.56 s\nWall time: 2.51 s\nTrue\nsage: %time G.has_perfect_matching(algorithm='LP', solver='Glpk')\nCPU times: user 2 s, sys: 8 ms, total: 2.01 s\nWall time: 1.97 s\nTrue\n\nsage: %time G.has_perfect_matching(algorithm='LP', solver='Coin')\nCPU times: user 5.27 s, sys: 48 ms, total: 5.32 s\nWall time: 5.26 s\nTrue\nsage: %time G.has_perfect_matching(algorithm='LP_matching', solver='Coin')\nCPU times: user 7.59 s, sys: 48 ms, total: 7.64 s\nWall time: 7.56 s\nTrue\n```",
    "created_at": "2017-05-07T21:54:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22957",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22957#issuecomment-342901",
    "user": "https://github.com/sagetrac-tmonteil"
}
```

<div id="comment:10" align="right">comment:10</div>

The LP formulations look similar, but the polytopes are very different (in particular, the LP_matching one is kind of "relaxed" and always has integer points). I am not specialist at all, but there might be some theoretical results on which shapes are better handled by which solver strategies (perhaps Matthias can tell more about this).

Here, the best strategy seems to depend on the solver (i do not have Cplex installed):

```
sage: G = graphs.RandomBipartite(1000, 1000, 1/100)
sage: %time G.has_perfect_matching(algorithm='LP_matching', solver='Glpk')
CPU times: user 2.54 s, sys: 16 ms, total: 2.56 s
Wall time: 2.51 s
True
sage: %time G.has_perfect_matching(algorithm='LP', solver='Glpk')
CPU times: user 2 s, sys: 8 ms, total: 2.01 s
Wall time: 1.97 s
True

sage: %time G.has_perfect_matching(algorithm='LP', solver='Coin')
CPU times: user 5.27 s, sys: 48 ms, total: 5.32 s
Wall time: 5.26 s
True
sage: %time G.has_perfect_matching(algorithm='LP_matching', solver='Coin')
CPU times: user 7.59 s, sys: 48 ms, total: 7.64 s
Wall time: 7.56 s
True
```



---

archive/issue_comments_342902.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nSome corrections:\n1. add test for trivial case: `if self.order() % 2: return False`\n2. don't use `p.add_constraint(sum([b[e] for e in edges]) == 1)` but `p.add_constraint(p.sum(b[e] for e in edges) == 1)`, so `p.sum` instead of `sum` and no `[..]`\n3. after `sage: all(G.has_perfect_matching(algorithm=algo) for algo in ['Edmonds', 'LP_matching', 'LP'])` you must add `True`\n\nConcerning the default method, it seems that the \"LP\" method is in average slightly faster.\n\n```\ndef pm_time(n, p, nbr):\n    algorithms = [\"Edmonds\", \"LP_matching\", \"LP\"]\n    time = {algo:list() for algo in algorithms}\n    for i in range(nbr):\n        G = graphs.RandomGNP(n, p)\n        for algo in algorithms:\n            t = walltime()\n            _ = G.has_perfect_matching(algorithm=algo)\n            time[algo].append(walltime() -t)\n    return {algo:mean(time[algo]) for algo in algorithms}\n```\n\n```\nsage: for n in [10, 20, 50, 100, 200]:\n....:     for p in [0.01, 0.05, 0.1]:\n....:         print(\"{}\\t{}\\t{}\".format(n,round(p,2),pm_time(n, p, 100)))\n....:         \n10\t0.01\t{'LP_matching': 0.00059, 'LP': 0.00011, 'Edmonds': 8e-05}\n10\t0.05\t{'LP_matching': 0.00101, 'LP': 0.00019, 'Edmonds': 0.00021}\n10\t0.1\t{'LP_matching': 0.00114, 'LP': 0.00024, 'Edmonds': 0.00021}\n20\t0.01\t{'LP_matching': 0.00105, 'LP': 0.00011, 'Edmonds': 0.00014}\n20\t0.05\t{'LP_matching': 0.00149, 'LP': 0.00027, 'Edmonds': 0.00035}\n20\t0.1\t{'LP_matching': 0.00266, 'LP': 0.00066, 'Edmonds': 0.00062}\n50\t0.01\t{'LP_matching': 0.0018, 'LP': 0.00016, 'Edmonds': 0.00051}\n50\t0.05\t{'LP_matching': 0.0063, 'LP': 0.00107, 'Edmonds': 0.00216}\n50\t0.1\t{'LP_matching': 0.01115, 'LP': 0.0056, 'Edmonds': 0.00676}\n100\t0.01\t{'LP_matching': 0.00357, 'LP': 0.00028, 'Edmonds': 0.00254}\n100\t0.05\t{'LP_matching': 0.01831, 'LP': 0.00717, 'Edmonds': 0.03603}\n100\t0.1\t{'LP_matching': 0.03172, 'LP': 0.0172, 'Edmonds': 0.01836}\n200\t0.01\t{'LP_matching': 0.01729, 'LP': 0.00065, 'Edmonds': 0.01549}\n200\t0.05\t{'LP_matching': 0.05328, 'LP': 0.03297, 'Edmonds': 0.06735}\n200\t0.1\t{'LP_matching': 0.07782, 'LP': 0.05421, 'Edmonds': 0.06175}\n```",
    "created_at": "2017-05-08T10:19:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22957",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22957#issuecomment-342902",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:11" align="right">comment:11</div>

Some corrections:
1. add test for trivial case: `if self.order() % 2: return False`
2. don't use `p.add_constraint(sum([b[e] for e in edges]) == 1)` but `p.add_constraint(p.sum(b[e] for e in edges) == 1)`, so `p.sum` instead of `sum` and no `[..]`
3. after `sage: all(G.has_perfect_matching(algorithm=algo) for algo in ['Edmonds', 'LP_matching', 'LP'])` you must add `True`

Concerning the default method, it seems that the "LP" method is in average slightly faster.

```
def pm_time(n, p, nbr):
    algorithms = ["Edmonds", "LP_matching", "LP"]
    time = {algo:list() for algo in algorithms}
    for i in range(nbr):
        G = graphs.RandomGNP(n, p)
        for algo in algorithms:
            t = walltime()
            _ = G.has_perfect_matching(algorithm=algo)
            time[algo].append(walltime() -t)
    return {algo:mean(time[algo]) for algo in algorithms}
```

```
sage: for n in [10, 20, 50, 100, 200]:
....:     for p in [0.01, 0.05, 0.1]:
....:         print("{}\t{}\t{}".format(n,round(p,2),pm_time(n, p, 100)))
....:         
10	0.01	{'LP_matching': 0.00059, 'LP': 0.00011, 'Edmonds': 8e-05}
10	0.05	{'LP_matching': 0.00101, 'LP': 0.00019, 'Edmonds': 0.00021}
10	0.1	{'LP_matching': 0.00114, 'LP': 0.00024, 'Edmonds': 0.00021}
20	0.01	{'LP_matching': 0.00105, 'LP': 0.00011, 'Edmonds': 0.00014}
20	0.05	{'LP_matching': 0.00149, 'LP': 0.00027, 'Edmonds': 0.00035}
20	0.1	{'LP_matching': 0.00266, 'LP': 0.00066, 'Edmonds': 0.00062}
50	0.01	{'LP_matching': 0.0018, 'LP': 0.00016, 'Edmonds': 0.00051}
50	0.05	{'LP_matching': 0.0063, 'LP': 0.00107, 'Edmonds': 0.00216}
50	0.1	{'LP_matching': 0.01115, 'LP': 0.0056, 'Edmonds': 0.00676}
100	0.01	{'LP_matching': 0.00357, 'LP': 0.00028, 'Edmonds': 0.00254}
100	0.05	{'LP_matching': 0.01831, 'LP': 0.00717, 'Edmonds': 0.03603}
100	0.1	{'LP_matching': 0.03172, 'LP': 0.0172, 'Edmonds': 0.01836}
200	0.01	{'LP_matching': 0.01729, 'LP': 0.00065, 'Edmonds': 0.01549}
200	0.05	{'LP_matching': 0.05328, 'LP': 0.03297, 'Edmonds': 0.06735}
200	0.1	{'LP_matching': 0.07782, 'LP': 0.05421, 'Edmonds': 0.06175}
```



---

archive/issue_events_317370.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2017-05-08T10:19:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22957",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22957#event-317370"
}
```



---

archive/issue_events_317371.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2017-05-08T10:19:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22957",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22957#event-317371"
}
```



---

archive/issue_comments_342903.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nYou can also try the following to handle non connected graphs.\n\n```\ndef has_perfect_matching(G, solver=None, verbose=False):\n    \"\"\"\n    \"\"\"\n    if G.order() % 2:\n        return False\n\n    from sage.numerical.mip import MixedIntegerLinearProgram, MIPSolverException\n    L = G.connected_components()\n    if any(len(cc) % 2 for cc in L):\n        return False\n    for cc in L:\n        p = MixedIntegerLinearProgram(solver=solver)\n        b = p.new_variable(binary=True)\n        for v in cc:\n            p.add_constraint(p.sum(b[e] for e in G.edges_incident(v, labels=False, sort=False)) == 1)\n        try:\n            p.solve(log=verbose)\n            continue\n        except MIPSolverException:\n            return False\n    return True\n```",
    "created_at": "2017-05-08T12:26:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22957",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22957#issuecomment-342903",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:12" align="right">comment:12</div>

You can also try the following to handle non connected graphs.

```
def has_perfect_matching(G, solver=None, verbose=False):
    """
    """
    if G.order() % 2:
        return False

    from sage.numerical.mip import MixedIntegerLinearProgram, MIPSolverException
    L = G.connected_components()
    if any(len(cc) % 2 for cc in L):
        return False
    for cc in L:
        p = MixedIntegerLinearProgram(solver=solver)
        b = p.new_variable(binary=True)
        for v in cc:
            p.add_constraint(p.sum(b[e] for e in G.edges_incident(v, labels=False, sort=False)) == 1)
        try:
            p.solve(log=verbose)
            continue
        except MIPSolverException:
            return False
    return True
```



---

archive/issue_comments_342904.json:
```json
{
    "body": "Changed commit from **[`27f66e6`](https://github.com/sagemath/sagetrac-mirror/commit/27f66e6b85f7cc5159be1524aa21064ef9fccddb)** to **[`5bd034d`](https://github.com/sagemath/sagetrac-mirror/commit/5bd034d5d2e25d35cc3896a7e51e0d0e6ab47a9a)**",
    "created_at": "2017-05-13T09:26:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22957",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22957#issuecomment-342904",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`27f66e6`](https://github.com/sagemath/sagetrac-mirror/commit/27f66e6b85f7cc5159be1524aa21064ef9fccddb)** to **[`5bd034d`](https://github.com/sagemath/sagetrac-mirror/commit/5bd034d5d2e25d35cc3896a7e51e0d0e6ab47a9a)**



---

archive/issue_comments_342905.json:
```json
{
    "body": "<div id=\"comment:13\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5bd034d5d2e25d35cc3896a7e51e0d0e6ab47a9a\"><code>5bd034d</code></a></td><td><code>#22957 : apply suggestions of comment 11.</code></td></tr></table>\n",
    "created_at": "2017-05-13T09:26:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22957",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22957#issuecomment-342905",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:13"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5bd034d5d2e25d35cc3896a7e51e0d0e6ab47a9a"><code>5bd034d</code></a></td><td><code>#22957 : apply suggestions of comment 11.</code></td></tr></table>




---

archive/issue_comments_342906.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nusing `p.sum` is better than `sum` when adding constraints.",
    "created_at": "2017-05-13T09:31:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22957",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22957#issuecomment-342906",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:14" align="right">comment:14</div>

using `p.sum` is better than `sum` when adding constraints.



---

archive/issue_comments_342907.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nReplying to [@dcoudert](#comment%3A11):\n> Some corrections:\n> 1. add test for trivial case: `if self.order() % 2: return False`\n> 2. don't use `p.add_constraint(sum([b[e] for e in edges]) == 1)` but `p.add_constraint(p.sum(b[e] for e in edges) == 1)`, so `p.sum` instead of `sum` and no `[..]`\n> 3. after `sage: all(G.has_perfect_matching(algorithm=algo) for algo in ['Edmonds', 'LP_matching', 'LP'])` you must add `True`\n\nThanks for the corrections. Regarding the second one, i removed the `[..]`, so that this is more readeable than both other possibilities. I do not see the benefit in calling `p.sum` instead `sum` since MILP can handle that.\n\n> Concerning the default method, it seems that the \"LP\" method is in average slightly faster.\n\nWell, this is with the commercial software CPLEX, which we can not assume to be installed on the user's machine. With `cbc` (which is not installed by default), Edomonds is faster for the dense graphs:\n\n```\n10\t0.01\t{'LP_matching': 0.002830798625946045, 'LP': 0.0004676508903503418, 'Edmonds': 0.005202703475952149}\n10\t0.05\t{'LP_matching': 0.002872939109802246, 'LP': 0.0006479811668395996, 'Edmonds': 0.00037740230560302736}\n10\t0.1\t{'LP_matching': 0.0034116864204406737, 'LP': 0.0009398722648620606, 'Edmonds': 0.0005422520637512207}\n20\t0.01\t{'LP_matching': 0.0041153025627136235, 'LP': 0.00047693490982055666, 'Edmonds': 0.000349271297454834}\n20\t0.05\t{'LP_matching': 0.00487368106842041, 'LP': 0.0009178662300109863, 'Edmonds': 0.0009983134269714354}\n20\t0.1\t{'LP_matching': 0.0056728792190551755, 'LP': 0.0020548200607299807, 'Edmonds': 0.0017203617095947266}\n50\t0.01\t{'LP_matching': 0.0073078107833862305, 'LP': 0.0007153725624084472, 'Edmonds': 0.0014888262748718262}\n50\t0.05\t{'LP_matching': 0.01255603551864624, 'LP': 0.004998214244842529, 'Edmonds': 0.0067977094650268554}\n50\t0.1\t{'LP_matching': 0.027002482414245604, 'LP': 0.023311057090759278, 'Edmonds': 0.02096151351928711}\n100\t0.01\t{'LP_matching': 0.014859480857849121, 'LP': 0.0009170055389404296, 'Edmonds': 0.008162569999694825}\n100\t0.05\t{'LP_matching': 0.10298776865005493, 'LP': 0.038913648128509525, 'Edmonds': 0.07995342016220093}\n100\t0.1\t{'LP_matching': 0.11406001806259156, 'LP': 0.15457019090652466, 'Edmonds': 0.05536278963088989}\n200\t0.01\t{'LP_matching': 0.040724358558654784, 'LP': 0.002662522792816162, 'Edmonds': 0.050573115348815915}\n200\t0.05\t{'LP_matching': 0.35171021938323976, 'LP': 0.2127785062789917, 'Edmonds': 0.16411977291107177}\n200\t0.1\t{'LP_matching': 0.7039063048362731, 'LP': 0.39927724838256834, 'Edmonds': 0.1540844440460205}\n```",
    "created_at": "2017-05-13T09:34:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22957",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22957#issuecomment-342907",
    "user": "https://github.com/sagetrac-tmonteil"
}
```

<div id="comment:15" align="right">comment:15</div>

Replying to [@dcoudert](#comment%3A11):
> Some corrections:
> 1. add test for trivial case: `if self.order() % 2: return False`
> 2. don't use `p.add_constraint(sum([b[e] for e in edges]) == 1)` but `p.add_constraint(p.sum(b[e] for e in edges) == 1)`, so `p.sum` instead of `sum` and no `[..]`
> 3. after `sage: all(G.has_perfect_matching(algorithm=algo) for algo in ['Edmonds', 'LP_matching', 'LP'])` you must add `True`

Thanks for the corrections. Regarding the second one, i removed the `[..]`, so that this is more readeable than both other possibilities. I do not see the benefit in calling `p.sum` instead `sum` since MILP can handle that.

> Concerning the default method, it seems that the "LP" method is in average slightly faster.

Well, this is with the commercial software CPLEX, which we can not assume to be installed on the user's machine. With `cbc` (which is not installed by default), Edomonds is faster for the dense graphs:

```
10	0.01	{'LP_matching': 0.002830798625946045, 'LP': 0.0004676508903503418, 'Edmonds': 0.005202703475952149}
10	0.05	{'LP_matching': 0.002872939109802246, 'LP': 0.0006479811668395996, 'Edmonds': 0.00037740230560302736}
10	0.1	{'LP_matching': 0.0034116864204406737, 'LP': 0.0009398722648620606, 'Edmonds': 0.0005422520637512207}
20	0.01	{'LP_matching': 0.0041153025627136235, 'LP': 0.00047693490982055666, 'Edmonds': 0.000349271297454834}
20	0.05	{'LP_matching': 0.00487368106842041, 'LP': 0.0009178662300109863, 'Edmonds': 0.0009983134269714354}
20	0.1	{'LP_matching': 0.0056728792190551755, 'LP': 0.0020548200607299807, 'Edmonds': 0.0017203617095947266}
50	0.01	{'LP_matching': 0.0073078107833862305, 'LP': 0.0007153725624084472, 'Edmonds': 0.0014888262748718262}
50	0.05	{'LP_matching': 0.01255603551864624, 'LP': 0.004998214244842529, 'Edmonds': 0.0067977094650268554}
50	0.1	{'LP_matching': 0.027002482414245604, 'LP': 0.023311057090759278, 'Edmonds': 0.02096151351928711}
100	0.01	{'LP_matching': 0.014859480857849121, 'LP': 0.0009170055389404296, 'Edmonds': 0.008162569999694825}
100	0.05	{'LP_matching': 0.10298776865005493, 'LP': 0.038913648128509525, 'Edmonds': 0.07995342016220093}
100	0.1	{'LP_matching': 0.11406001806259156, 'LP': 0.15457019090652466, 'Edmonds': 0.05536278963088989}
200	0.01	{'LP_matching': 0.040724358558654784, 'LP': 0.002662522792816162, 'Edmonds': 0.050573115348815915}
200	0.05	{'LP_matching': 0.35171021938323976, 'LP': 0.2127785062789917, 'Edmonds': 0.16411977291107177}
200	0.1	{'LP_matching': 0.7039063048362731, 'LP': 0.39927724838256834, 'Edmonds': 0.1540844440460205}
```



---

archive/issue_comments_342908.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nReplying to [@dcoudert](#comment%3A14):\n> using `p.sum` is better than `sum` when adding constraints.\n\nWhy ?",
    "created_at": "2017-05-13T09:34:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22957",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22957#issuecomment-342908",
    "user": "https://github.com/sagetrac-tmonteil"
}
```

<div id="comment:16" align="right">comment:16</div>

Replying to [@dcoudert](#comment%3A14):
> using `p.sum` is better than `sum` when adding constraints.

Why ?



---

archive/issue_comments_342909.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nReplying to [@sagetrac-tmonteil](#comment%3A16):\n> Replying to [@dcoudert](#comment%3A14):\n> > using `p.sum` is better than `sum` when adding constraints.\n\n> \n> Why ?\n\nOK i did some timings.",
    "created_at": "2017-05-13T09:43:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22957",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22957#issuecomment-342909",
    "user": "https://github.com/sagetrac-tmonteil"
}
```

<div id="comment:17" align="right">comment:17</div>

Replying to [@sagetrac-tmonteil](#comment%3A16):
> Replying to [@dcoudert](#comment%3A14):
> > using `p.sum` is better than `sum` when adding constraints.

> 
> Why ?

OK i did some timings.



---

archive/issue_comments_342910.json:
```json
{
    "body": "Changed commit from **[`5bd034d`](https://github.com/sagemath/sagetrac-mirror/commit/5bd034d5d2e25d35cc3896a7e51e0d0e6ab47a9a)** to **[`0fc1039`](https://github.com/sagemath/sagetrac-mirror/commit/0fc10392efa9bcf1213cf1da6078c930e930a675)**",
    "created_at": "2017-05-13T09:43:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22957",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22957#issuecomment-342910",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`5bd034d`](https://github.com/sagemath/sagetrac-mirror/commit/5bd034d5d2e25d35cc3896a7e51e0d0e6ab47a9a)** to **[`0fc1039`](https://github.com/sagemath/sagetrac-mirror/commit/0fc10392efa9bcf1213cf1da6078c930e930a675)**



---

archive/issue_comments_342911.json:
```json
{
    "body": "<div id=\"comment:18\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0fc10392efa9bcf1213cf1da6078c930e930a675\"><code>0fc1039</code></a></td><td><code>#22957 : use p.sum which is faster than sum.</code></td></tr></table>\n",
    "created_at": "2017-05-13T09:43:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22957",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22957#issuecomment-342911",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:18"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0fc10392efa9bcf1213cf1da6078c930e930a675"><code>0fc1039</code></a></td><td><code>#22957 : use p.sum which is faster than sum.</code></td></tr></table>




---

archive/issue_comments_342912.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nThis is actually discussed in #9061 and #13646 (at least).",
    "created_at": "2017-05-13T09:45:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22957",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22957#issuecomment-342912",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:19" align="right">comment:19</div>

This is actually discussed in #9061 and #13646 (at least).



---

archive/issue_comments_342913.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nPasses all tests on top of 8.0.beta6. For me this is good to go.",
    "created_at": "2017-05-13T09:48:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22957",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22957#issuecomment-342913",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:20" align="right">comment:20</div>

Passes all tests on top of 8.0.beta6. For me this is good to go.



---

archive/issue_events_317372.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2017-05-13T09:48:40Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22957",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22957#event-317372"
}
```



---

archive/issue_events_317373.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2017-05-13T09:48:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22957",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22957#event-317373"
}
```



---

archive/issue_comments_342914.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nOK great, thanks for the review.\n\nRegarding connected components, i guess this should be timed first, since i am pretty sure that Edmonds takes care of that already, and for the LP, the polytope will be a product of polytopes, and i guess that the solvers take advantage of that too. Let us see in a further iteration.",
    "created_at": "2017-05-13T09:53:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22957",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22957#issuecomment-342914",
    "user": "https://github.com/sagetrac-tmonteil"
}
```

<div id="comment:21" align="right">comment:21</div>

OK great, thanks for the review.

Regarding connected components, i guess this should be timed first, since i am pretty sure that Edmonds takes care of that already, and for the LP, the polytope will be a product of polytopes, and i guess that the solvers take advantage of that too. Let us see in a further iteration.



---

archive/issue_comments_342915.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nI fully agree. My timing were not convincing, so it's not crucial to care about connected components so far.\n\nConcerning your timing with `Coin`, be aware that although the solver is generally faster than `GLPK`, the time needed to write the LP is way longer with `Coin` than with `GLPK` or `Cplex`. I don't know why. It is also quite long with `Gurobi`.",
    "created_at": "2017-05-13T10:01:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22957",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22957#issuecomment-342915",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:22" align="right">comment:22</div>

I fully agree. My timing were not convincing, so it's not crucial to care about connected components so far.

Concerning your timing with `Coin`, be aware that although the solver is generally faster than `GLPK`, the time needed to write the LP is way longer with `Coin` than with `GLPK` or `Cplex`. I don't know why. It is also quite long with `Gurobi`.



---

archive/issue_comments_342916.json:
```json
{
    "body": "Changed branch from **[u/tmonteil/faster_implementation_for_has_perfect_matching](https://github.com/sagemath/sagetrac-mirror/tree/u/tmonteil/faster_implementation_for_has_perfect_matching)** to **[u/dkrenn/faster_implementation_for_has_perfect_matching](https://github.com/sagemath/sagetrac-mirror/tree/u/dkrenn/faster_implementation_for_has_perfect_matching)**",
    "created_at": "2017-05-14T12:48:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22957",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22957#issuecomment-342916",
    "user": "https://github.com/dkrenn"
}
```

Changed branch from **[u/tmonteil/faster_implementation_for_has_perfect_matching](https://github.com/sagemath/sagetrac-mirror/tree/u/tmonteil/faster_implementation_for_has_perfect_matching)** to **[u/dkrenn/faster_implementation_for_has_perfect_matching](https://github.com/sagemath/sagetrac-mirror/tree/u/dkrenn/faster_implementation_for_has_perfect_matching)**



---

archive/issue_comments_342917.json:
```json
{
    "body": "Changed reviewer from **David Coudert** to **David Coudert, Daniel Krenn**",
    "created_at": "2017-05-14T12:52:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22957",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22957#issuecomment-342917",
    "user": "https://github.com/dkrenn"
}
```

Changed reviewer from **David Coudert** to **David Coudert, Daniel Krenn**



---

archive/issue_events_317374.json:
```json
{
    "actor": "https://github.com/dkrenn",
    "created_at": "2017-05-14T12:52:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22957",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22957#event-317374"
}
```



---

archive/issue_events_317375.json:
```json
{
    "actor": "https://github.com/dkrenn",
    "created_at": "2017-05-14T12:52:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22957",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22957#event-317375"
}
```



---

archive/issue_comments_342918.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nI've added a small PEP8 reviewer patch, please cross-review the changes.\nIn particular, I've rewritten the lambda expression to a function (PEP8) and have also rewritten the if-statement; if you're unhappy with the if-rewriting, then feel free to change it back.\n\nApart from PEP8, this patch looks good and clearly is a positive review from my side. Thank you for your work.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4c30fb1dafd693fdb259cf06cc7324d637347bfb\"><code>4c30fb1</code></a></td><td><code>Trac #22957: blanks, lambda (PEP8)</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3bde4310febdd6bd3bb0b1d65b9056e40d14a306\"><code>3bde431</code></a></td><td><code>Trac #22957: more blanks</code></td></tr></table>\n",
    "created_at": "2017-05-14T12:52:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22957",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22957#issuecomment-342918",
    "user": "https://github.com/dkrenn"
}
```

<div id="comment:24" align="right">comment:24</div>

I've added a small PEP8 reviewer patch, please cross-review the changes.
In particular, I've rewritten the lambda expression to a function (PEP8) and have also rewritten the if-statement; if you're unhappy with the if-rewriting, then feel free to change it back.

Apart from PEP8, this patch looks good and clearly is a positive review from my side. Thank you for your work.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4c30fb1dafd693fdb259cf06cc7324d637347bfb"><code>4c30fb1</code></a></td><td><code>Trac #22957: blanks, lambda (PEP8)</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3bde4310febdd6bd3bb0b1d65b9056e40d14a306"><code>3bde431</code></a></td><td><code>Trac #22957: more blanks</code></td></tr></table>




---

archive/issue_comments_342919.json:
```json
{
    "body": "Changed commit from **[`0fc1039`](https://github.com/sagemath/sagetrac-mirror/commit/0fc10392efa9bcf1213cf1da6078c930e930a675)** to **[`3bde431`](https://github.com/sagemath/sagetrac-mirror/commit/3bde4310febdd6bd3bb0b1d65b9056e40d14a306)**",
    "created_at": "2017-05-14T12:52:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22957",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22957#issuecomment-342919",
    "user": "https://github.com/dkrenn"
}
```

Changed commit from **[`0fc1039`](https://github.com/sagemath/sagetrac-mirror/commit/0fc10392efa9bcf1213cf1da6078c930e930a675)** to **[`3bde431`](https://github.com/sagemath/sagetrac-mirror/commit/3bde4310febdd6bd3bb0b1d65b9056e40d14a306)**



---

archive/issue_events_317376.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2017-05-14T13:19:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22957",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22957#event-317376"
}
```



---

archive/issue_events_317377.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2017-05-14T13:19:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22957",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22957#event-317377"
}
```



---

archive/issue_comments_342920.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nPasses all tests and doc build properly.",
    "created_at": "2017-05-14T13:19:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22957",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22957#issuecomment-342920",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:25" align="right">comment:25</div>

Passes all tests and doc build properly.



---

archive/issue_events_317378.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-05-16T22:21:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22957",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22957#event-317378"
}
```



---

archive/issue_events_317379.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "8d9cb2892170f945c95e25f391bf0362b7365b30",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2017-05-16T22:21:58Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/22957",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22957#event-317379"
}
```



---

archive/issue_comments_342921.json:
```json
{
    "body": "Changed branch from **[u/dkrenn/faster_implementation_for_has_perfect_matching](https://github.com/sagemath/sagetrac-mirror/tree/u/dkrenn/faster_implementation_for_has_perfect_matching)** to **[`3bde431`](https://github.com/sagemath/sagetrac-mirror/commit/3bde4310febdd6bd3bb0b1d65b9056e40d14a306)**",
    "created_at": "2017-05-16T22:21:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22957",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22957#issuecomment-342921",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/dkrenn/faster_implementation_for_has_perfect_matching](https://github.com/sagemath/sagetrac-mirror/tree/u/dkrenn/faster_implementation_for_has_perfect_matching)** to **[`3bde431`](https://github.com/sagemath/sagetrac-mirror/commit/3bde4310febdd6bd3bb0b1d65b9056e40d14a306)**
