# Issue 22588: Let "make doc" really always work

archive/issues_022351.json:
```json
{
    "assignees": [],
    "body": "If we change git branches, `make doc` often fails. It turns out that the cache mechanism in sage doc builder caused these failures. The patch implements a robust logic to auto-update module docs using the information from the Sphinx environment rather than from the cache.\n\n**Keywords:** days85\n\n**Branch:** [8227d6bf837095bf4299197d0def98a97e77937d](https://github.com/sagemath/sagetrac-mirror/commit/8227d6bf837095bf4299197d0def98a97e77937d)\n\n**Reviewer:** Florent Hivert, Erik Bray, John Palmieri\n\n**Author:** Kwankyu Lee\n\nIssue created by migration from https://trac.sagemath.org/ticket/22588\n\n",
    "closed_at": "2017-08-11T18:18:09Z",
    "created_at": "2017-03-13T00:24:58Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20build",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.0",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Let \"make doc\" really always work",
    "type": "issue",
    "updated_at": "2017-10-08T00:42:20Z",
    "url": "https://github.com/sagemath/sage/issues/22588",
    "user": "https://github.com/kwankyu"
}
```
If we change git branches, `make doc` often fails. It turns out that the cache mechanism in sage doc builder caused these failures. The patch implements a robust logic to auto-update module docs using the information from the Sphinx environment rather than from the cache.

**Keywords:** days85

**Branch:** [8227d6bf837095bf4299197d0def98a97e77937d](https://github.com/sagemath/sagetrac-mirror/commit/8227d6bf837095bf4299197d0def98a97e77937d)

**Reviewer:** Florent Hivert, Erik Bray, John Palmieri

**Author:** Kwankyu Lee

Issue created by migration from https://trac.sagemath.org/ticket/22588





---

archive/issue_events_273856.json:
```json
{
    "actor": "https://github.com/kwankyu",
    "created_at": "2017-03-13T00:24:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "milestone_number": null,
    "milestone_title": "sage-8.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22588#event-273856"
}
```



---

archive/issue_events_273857.json:
```json
{
    "actor": "https://github.com/kwankyu",
    "created_at": "2017-03-13T00:24:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20documentation",
    "label_color": "08517b",
    "label_name": "component: documentation",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22588#event-273857"
}
```



---

archive/issue_events_273858.json:
```json
{
    "actor": "https://github.com/kwankyu",
    "created_at": "2017-03-13T00:24:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "008080",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22588#event-273858"
}
```



---

archive/issue_comments_337394.json:
```json
{
    "body": "**Branch:** [u/klee/22588](https://github.com/sagemath/sagetrac-mirror/tree/u/klee/22588)",
    "created_at": "2017-03-13T00:35:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-337394",
    "user": "https://github.com/kwankyu"
}
```

**Branch:** [u/klee/22588](https://github.com/sagemath/sagetrac-mirror/tree/u/klee/22588)



---

archive/issue_comments_337395.json:
```json
{
    "body": "**Author:** Kwankyu Lee",
    "created_at": "2017-03-13T00:35:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-337395",
    "user": "https://github.com/kwankyu"
}
```

**Author:** Kwankyu Lee



---

archive/issue_comments_337396.json:
```json
{
    "body": "<a id='comment:2'>**Comment 2:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7e6d6c6111fb01967347bc886cea43b0e4657fd7\">7e6d6c6</a></td><td><code>Fix doc builder logic</code></td></tr></table>\n",
    "created_at": "2017-03-13T00:35:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-337396",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:2'>**Comment 2:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7e6d6c6111fb01967347bc886cea43b0e4657fd7">7e6d6c6</a></td><td><code>Fix doc builder logic</code></td></tr></table>




---

archive/issue_comments_337397.json:
```json
{
    "body": "**Commit:** [7e6d6c6111fb01967347bc886cea43b0e4657fd7](https://github.com/sagemath/sagetrac-mirror/commit/7e6d6c6111fb01967347bc886cea43b0e4657fd7)",
    "created_at": "2017-03-13T00:35:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-337397",
    "user": "https://github.com/sagetrac-git"
}
```

**Commit:** [7e6d6c6111fb01967347bc886cea43b0e4657fd7](https://github.com/sagemath/sagetrac-mirror/commit/7e6d6c6111fb01967347bc886cea43b0e4657fd7)



---

archive/issue_comments_337398.json:
```json
{
    "body": "<a id='comment:3'>**Comment 3:**</a>\nHi,\n\nThanks for this suggestion ! I've a few question for your patch.\n\n- Usually caching is here for performance reason. Did you test that there isn't a huge speed loss ?\n\n- Can you explain a little in the description of this patch how your new robust logic works ?\n\n- Finally, from a first glance, It seems that you don't handle the 'underscore' option anymore, do you ?\n\nCheers,\n\nFlorent",
    "created_at": "2017-03-13T15:40:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-337398",
    "user": "https://github.com/hivert"
}
```

<a id='comment:3'>**Comment 3:**</a>
Hi,

Thanks for this suggestion ! I've a few question for your patch.

- Usually caching is here for performance reason. Did you test that there isn't a huge speed loss ?

- Can you explain a little in the description of this patch how your new robust logic works ?

- Finally, from a first glance, It seems that you don't handle the 'underscore' option anymore, do you ?

Cheers,

Florent



---

archive/issue_comments_337399.json:
```json
{
    "body": "<a id='comment:4'>**Comment 4:**</a>\nI got\n\n```\n[...]\ncd ../.. && sage-logger -p './sage --docbuild --no-pdf-links all html ' logs/dochtml.log\n[dochtml] \n[dochtml] Building reference manual, first pass.\n[dochtml] \n[dochtml] Error building the documentation.\n[dochtml] Traceback (most recent call last):\n[dochtml]   File \"/home/data/Sage-Install/sage-7.5.1/local/lib/python/runpy.py\", line 174, in _run_module_as_main\n[dochtml]     \"__main__\", fname, loader, pkg_name)\n[dochtml]   File \"/home/data/Sage-Install/sage-7.5.1/local/lib/python/runpy.py\", line 72, in _run_code\n[dochtml]     exec code in run_globals\n[dochtml]   File \"/home/data/Sage-Install/sage-7.5.1/local/lib/python2.7/site-packages/sage_setup/docbuild/__main__.py\", line 2, in <module>\n[dochtml]     main()\n[dochtml]   File \"/home/data/Sage-Install/sage-7.5.1/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py\", line 1618, in main\n[dochtml]     builder()\n[dochtml]   File \"/home/data/Sage-Install/sage-7.5.1/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py\", line 316, in _wrapper\n[dochtml]     getattr(get_builder(document), 'inventory')(*args, **kwds)\n[dochtml]   File \"/home/data/Sage-Install/sage-7.5.1/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py\", line 510, in _wrapper\n[dochtml]     build_many(build_ref_doc, L)\n[dochtml]   File \"/home/data/Sage-Install/sage-7.5.1/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py\", line 252, in build_many\n[dochtml]     ret = x.get(99999)\n[dochtml]   File \"/home/data/Sage-Install/sage-7.5.1/local/lib/python/multiprocessing/pool.py\", line 567, in get\n[dochtml]     raise self._value\n[dochtml] AttributeError: 'NoneType' object has no attribute 'all_docs'\n[...]\n```\nHere is how to reproduce the problem: I went to `7.6.beta6` and compiled the doc normally. Then I switched to `22588` and issued a `make doc-clean` and `make doc`. \n\nAlso the git managed file `src/doc/en/reference/misc/sagetex.rst` was deleted.",
    "created_at": "2017-03-13T16:16:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-337399",
    "user": "https://github.com/hivert"
}
```

<a id='comment:4'>**Comment 4:**</a>
I got

```
[...]
cd ../.. && sage-logger -p './sage --docbuild --no-pdf-links all html ' logs/dochtml.log
[dochtml] 
[dochtml] Building reference manual, first pass.
[dochtml] 
[dochtml] Error building the documentation.
[dochtml] Traceback (most recent call last):
[dochtml]   File "/home/data/Sage-Install/sage-7.5.1/local/lib/python/runpy.py", line 174, in _run_module_as_main
[dochtml]     "__main__", fname, loader, pkg_name)
[dochtml]   File "/home/data/Sage-Install/sage-7.5.1/local/lib/python/runpy.py", line 72, in _run_code
[dochtml]     exec code in run_globals
[dochtml]   File "/home/data/Sage-Install/sage-7.5.1/local/lib/python2.7/site-packages/sage_setup/docbuild/__main__.py", line 2, in <module>
[dochtml]     main()
[dochtml]   File "/home/data/Sage-Install/sage-7.5.1/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py", line 1618, in main
[dochtml]     builder()
[dochtml]   File "/home/data/Sage-Install/sage-7.5.1/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py", line 316, in _wrapper
[dochtml]     getattr(get_builder(document), 'inventory')(*args, **kwds)
[dochtml]   File "/home/data/Sage-Install/sage-7.5.1/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py", line 510, in _wrapper
[dochtml]     build_many(build_ref_doc, L)
[dochtml]   File "/home/data/Sage-Install/sage-7.5.1/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py", line 252, in build_many
[dochtml]     ret = x.get(99999)
[dochtml]   File "/home/data/Sage-Install/sage-7.5.1/local/lib/python/multiprocessing/pool.py", line 567, in get
[dochtml]     raise self._value
[dochtml] AttributeError: 'NoneType' object has no attribute 'all_docs'
[...]
```
Here is how to reproduce the problem: I went to `7.6.beta6` and compiled the doc normally. Then I switched to `22588` and issued a `make doc-clean` and `make doc`. 

Also the git managed file `src/doc/en/reference/misc/sagetex.rst` was deleted.



---

archive/issue_comments_337400.json:
```json
{
    "body": "**Changing keywords** from \"\" to \"days85\".",
    "created_at": "2017-03-13T16:41:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-337400",
    "user": "https://github.com/jdemeyer"
}
```

**Changing keywords** from "" to "days85".



---

archive/issue_comments_337401.json:
```json
{
    "body": "**Changing commit** from \"[7e6d6c6111fb01967347bc886cea43b0e4657fd7](https://github.com/sagemath/sagetrac-mirror/commit/7e6d6c6111fb01967347bc886cea43b0e4657fd7)\" to \"[839c5f23b9831f219ab35ba9a82652cfe6e5469b](https://github.com/sagemath/sagetrac-mirror/commit/839c5f23b9831f219ab35ba9a82652cfe6e5469b)\".",
    "created_at": "2017-03-13T16:55:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-337401",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[7e6d6c6111fb01967347bc886cea43b0e4657fd7](https://github.com/sagemath/sagetrac-mirror/commit/7e6d6c6111fb01967347bc886cea43b0e4657fd7)" to "[839c5f23b9831f219ab35ba9a82652cfe6e5469b](https://github.com/sagemath/sagetrac-mirror/commit/839c5f23b9831f219ab35ba9a82652cfe6e5469b)".



---

archive/issue_comments_337402.json:
```json
{
    "body": "<a id='comment:6'>**Comment 6:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/839c5f23b9831f219ab35ba9a82652cfe6e5469b\">839c5f2</a></td><td><code>Quickfix for a bug in new code</code></td></tr></table>\n",
    "created_at": "2017-03-13T16:55:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-337402",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:6'>**Comment 6:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/839c5f23b9831f219ab35ba9a82652cfe6e5469b">839c5f2</a></td><td><code>Quickfix for a bug in new code</code></td></tr></table>




---

archive/issue_comments_337403.json:
```json
{
    "body": "<a id='comment:7'>**Comment 7:**</a>\nTry the quickfix to fix the problem. Meanwhile I will think to reply to your questions.",
    "created_at": "2017-03-13T17:00:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-337403",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:7'>**Comment 7:**</a>
Try the quickfix to fix the problem. Meanwhile I will think to reply to your questions.



---

archive/issue_comments_337404.json:
```json
{
    "body": "**Changing commit** from \"[839c5f23b9831f219ab35ba9a82652cfe6e5469b](https://github.com/sagemath/sagetrac-mirror/commit/839c5f23b9831f219ab35ba9a82652cfe6e5469b)\" to \"[45d53c410b089d58d758c1bc7c9b3bb3c7a4d6b9](https://github.com/sagemath/sagetrac-mirror/commit/45d53c410b089d58d758c1bc7c9b3bb3c7a4d6b9)\".",
    "created_at": "2017-03-13T17:20:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-337404",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[839c5f23b9831f219ab35ba9a82652cfe6e5469b](https://github.com/sagemath/sagetrac-mirror/commit/839c5f23b9831f219ab35ba9a82652cfe6e5469b)" to "[45d53c410b089d58d758c1bc7c9b3bb3c7a4d6b9](https://github.com/sagemath/sagetrac-mirror/commit/45d53c410b089d58d758c1bc7c9b3bb3c7a4d6b9)".



---

archive/issue_comments_337405.json:
```json
{
    "body": "<a id='comment:8'>**Comment 8:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/45d53c410b089d58d758c1bc7c9b3bb3c7a4d6b9\">45d53c4</a></td><td><code>Quickfix for the second bug in new code</code></td></tr></table>\n",
    "created_at": "2017-03-13T17:20:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-337405",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:8'>**Comment 8:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/45d53c410b089d58d758c1bc7c9b3bb3c7a4d6b9">45d53c4</a></td><td><code>Quickfix for the second bug in new code</code></td></tr></table>




---

archive/issue_comments_337406.json:
```json
{
    "body": "<a id='comment:9'>**Comment 9:**</a>\nYes, the new code is to blame for the phenomenon that the innocent \"sagetex.rst\" disappears! Hope that the two quickfixes work.",
    "created_at": "2017-03-13T17:23:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-337406",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:9'>**Comment 9:**</a>
Yes, the new code is to blame for the phenomenon that the innocent "sagetex.rst" disappears! Hope that the two quickfixes work.



---

archive/issue_comments_337407.json:
```json
{
    "body": "<a id='comment:10'>**Comment 10:**</a>\nNow the code with the quickfixes works fine for me. How about you?\n\nI will try to answer your questions as far as I understand the old and the new code :-) First I describe the use of cache in the old code:\n\nThe cache stores the list of the modules for which rst files were auto-generated in the previous run of the doc builder. In a new run, the list of the modules for which rst files should be auto-generated is computed and compared with the list in the cache. The rst files of newly added modules are auto-generated. Then the cache is updated.  \n\nIn the new code:\n\nIn a new run, the list of the modules for which rst files should be auto-generated is computed, and the modules are put into \"new\", \"updated\", \"removed\", \"old\" bins, comparing with the list of rst files which were auto-generated in the previous run of the doc builder (this formation is in the Sphinx environment). For modules in \"new\" and \"updated\" bins, new rst files are auto-generated. The modules in \"removed\" are removed. The modules in \"old\"  are just kept.\n\nReplying to [@hivert](#comment%3A3):\n> Usually caching is here for performance reason. Did you test that there isn't a huge speed loss ?\n\nThe merit of caching here is that supposedly we do not need to look into the \"sage/...\" folder to get the list of modules for which rst files were auto-generated. The new code gets the information from the Sphinx environment (`.all_docs`). There is no loss in speed.\n\n> Can you explain a little in the description of this patch how your new robust logic works ?\n\nThe information about the files in \"sage/...\" from the Sphinx environment is *independent* from git branch changing, unlike the cache. The dependence of the cache on git branch was the cause of the failures. \n\n> Finally, from a first glance, It seems that you don't handle the 'underscore' option anymore, do you?\n\nThe (new/old) code is not responsible for handling the 'underscore' option. Is it?\n\nThanks for asking.",
    "created_at": "2017-03-13T19:14:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-337407",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:10'>**Comment 10:**</a>
Now the code with the quickfixes works fine for me. How about you?

I will try to answer your questions as far as I understand the old and the new code :-) First I describe the use of cache in the old code:

The cache stores the list of the modules for which rst files were auto-generated in the previous run of the doc builder. In a new run, the list of the modules for which rst files should be auto-generated is computed and compared with the list in the cache. The rst files of newly added modules are auto-generated. Then the cache is updated.  

In the new code:

In a new run, the list of the modules for which rst files should be auto-generated is computed, and the modules are put into "new", "updated", "removed", "old" bins, comparing with the list of rst files which were auto-generated in the previous run of the doc builder (this formation is in the Sphinx environment). For modules in "new" and "updated" bins, new rst files are auto-generated. The modules in "removed" are removed. The modules in "old"  are just kept.

Replying to [@hivert](#comment%3A3):
> Usually caching is here for performance reason. Did you test that there isn't a huge speed loss ?

The merit of caching here is that supposedly we do not need to look into the "sage/..." folder to get the list of modules for which rst files were auto-generated. The new code gets the information from the Sphinx environment (`.all_docs`). There is no loss in speed.

> Can you explain a little in the description of this patch how your new robust logic works ?

The information about the files in "sage/..." from the Sphinx environment is *independent* from git branch changing, unlike the cache. The dependence of the cache on git branch was the cause of the failures. 

> Finally, from a first glance, It seems that you don't handle the 'underscore' option anymore, do you?

The (new/old) code is not responsible for handling the 'underscore' option. Is it?

Thanks for asking.



---

archive/issue_comments_337408.json:
```json
{
    "body": "<a id='comment:11'>**Comment 11:**</a>\nReplying to [@kwankyu](#comment%3A10):\n> Now the code with the quickfixes works fine for me. How about you?\n> \n> I will try to answer your questions as far as I understand the old and the new code :-) First I describe the use of cache in the old code:\n\nThanks for clarifying all of these\n\n> The (new/old) code is not responsible for handling the 'underscore' option. Is it?\n\nI'm pretty sure the old code is:\n\n```\nif (inherit_prev is None or inherit_prev != options.inherited or\n            underscore_prev is None or underscore_prev != options.underscore):\n```\nThey are two options that force us to regenerate all the stub:\n\n- `inherit` -- whether we show inherited funs and attrs in the doc\n- `underscore` -- whether we show private (starting with __) funs and attrs\n\nIf any of those two option are changed, then every stub must be regenerated, because these option are included in the stub file as in\n\n```\n.. automodule:: sage.sets.integer_range\n   :members:\n   :undoc-members:\n   :show-inheritance:\n```\nThis needs to be taken care of in your logic.",
    "created_at": "2017-03-14T12:47:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-337408",
    "user": "https://github.com/hivert"
}
```

<a id='comment:11'>**Comment 11:**</a>
Replying to [@kwankyu](#comment%3A10):
> Now the code with the quickfixes works fine for me. How about you?
> 
> I will try to answer your questions as far as I understand the old and the new code :-) First I describe the use of cache in the old code:

Thanks for clarifying all of these

> The (new/old) code is not responsible for handling the 'underscore' option. Is it?

I'm pretty sure the old code is:

```
if (inherit_prev is None or inherit_prev != options.inherited or
            underscore_prev is None or underscore_prev != options.underscore):
```
They are two options that force us to regenerate all the stub:

- `inherit` -- whether we show inherited funs and attrs in the doc
- `underscore` -- whether we show private (starting with __) funs and attrs

If any of those two option are changed, then every stub must be regenerated, because these option are included in the stub file as in

```
.. automodule:: sage.sets.integer_range
   :members:
   :undoc-members:
   :show-inheritance:
```
This needs to be taken care of in your logic.



---

archive/issue_comments_337409.json:
```json
{
    "body": "<a id='comment:12'>**Comment 12:**</a>\nYou are right. It seems that putting the options back in work forces us to resurrect the cache file. Then the role of the cache file is just to keep the previous settings of the options. I think I can do this. Do you have any other idea? \n\nOne alternative approach could be to resurrect the cache file in full force as it was and make its pickle *not* git-tracted... I am not sure if this is really possible and sound... What do you think?",
    "created_at": "2017-03-14T13:35:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-337409",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:12'>**Comment 12:**</a>
You are right. It seems that putting the options back in work forces us to resurrect the cache file. Then the role of the cache file is just to keep the previous settings of the options. I think I can do this. Do you have any other idea? 

One alternative approach could be to resurrect the cache file in full force as it was and make its pickle *not* git-tracted... I am not sure if this is really possible and sound... What do you think?



---

archive/issue_comments_337410.json:
```json
{
    "body": "<a id='comment:13'>**Comment 13:**</a>\nI somehow presumed that the pickle of the cache is git branch dependent or git-tracted, and that caused failures. It is not true: the pickle is not git-tracted! Now I think problems were that the cache lacked the modification time info (so it could not be used to detect updated module) and that the old code did not remove rst files for removed modules.\n\nI am now experimenting with the options. I resurrected the cache and use it to store the previously used options. I will push the commits after I am confirmed that it works well...",
    "created_at": "2017-03-14T20:21:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-337410",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:13'>**Comment 13:**</a>
I somehow presumed that the pickle of the cache is git branch dependent or git-tracted, and that caused failures. It is not true: the pickle is not git-tracted! Now I think problems were that the cache lacked the modification time info (so it could not be used to detect updated module) and that the old code did not remove rst files for removed modules.

I am now experimenting with the options. I resurrected the cache and use it to store the previously used options. I will push the commits after I am confirmed that it works well...



---

archive/issue_comments_337411.json:
```json
{
    "body": "<a id='comment:14'>**Comment 14:**</a>\nWith the underscore option, it ends with an error (independent from the present patch). With the inherited option, it takes forever (understandably...). So I stopped this experiment. Anyway I can confirm that the options take effect :-)",
    "created_at": "2017-03-14T20:41:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-337411",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:14'>**Comment 14:**</a>
With the underscore option, it ends with an error (independent from the present patch). With the inherited option, it takes forever (understandably...). So I stopped this experiment. Anyway I can confirm that the options take effect :-)



---

archive/issue_comments_337412.json:
```json
{
    "body": "<a id='comment:15'>**Comment 15:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e9d311ee22ba7730e6c03ca7169888de2891a242\">e9d311e</a></td><td><code>Merge branch 'develop' into trac22588_sphinx</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/70b80c9c98013cb466083818bfc131cd5f51047d\">70b80c9</a></td><td><code>Make options work again</code></td></tr></table>\n",
    "created_at": "2017-03-14T21:20:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-337412",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:15'>**Comment 15:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e9d311ee22ba7730e6c03ca7169888de2891a242">e9d311e</a></td><td><code>Merge branch 'develop' into trac22588_sphinx</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/70b80c9c98013cb466083818bfc131cd5f51047d">70b80c9</a></td><td><code>Make options work again</code></td></tr></table>




---

archive/issue_comments_337413.json:
```json
{
    "body": "**Changing commit** from \"[45d53c410b089d58d758c1bc7c9b3bb3c7a4d6b9](https://github.com/sagemath/sagetrac-mirror/commit/45d53c410b089d58d758c1bc7c9b3bb3c7a4d6b9)\" to \"[70b80c9c98013cb466083818bfc131cd5f51047d](https://github.com/sagemath/sagetrac-mirror/commit/70b80c9c98013cb466083818bfc131cd5f51047d)\".",
    "created_at": "2017-03-14T21:20:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-337413",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[45d53c410b089d58d758c1bc7c9b3bb3c7a4d6b9](https://github.com/sagemath/sagetrac-mirror/commit/45d53c410b089d58d758c1bc7c9b3bb3c7a4d6b9)" to "[70b80c9c98013cb466083818bfc131cd5f51047d](https://github.com/sagemath/sagetrac-mirror/commit/70b80c9c98013cb466083818bfc131cd5f51047d)".



---

archive/issue_comments_337414.json:
```json
{
    "body": "<a id='comment:16'>**Comment 16:**</a>\nThis is extremely minor, but as far as I can tell, the preferred capitalization is \"reST\", not \"ReST\". The official documentation only uses \"reStructuredText\", not the abbreviation, but the lowercase \"r\" suggests \"reST\", and that's what others use (see http://www.sphinx-doc.org/en/stable/rest.html, for example).",
    "created_at": "2017-03-14T21:34:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-337414",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:16'>**Comment 16:**</a>
This is extremely minor, but as far as I can tell, the preferred capitalization is "reST", not "ReST". The official documentation only uses "reStructuredText", not the abbreviation, but the lowercase "r" suggests "reST", and that's what others use (see http://www.sphinx-doc.org/en/stable/rest.html, for example).



---

archive/issue_comments_337415.json:
```json
{
    "body": "<a id='comment:17'>**Comment 17:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0adc50e2b26b40d68c53b8cb8878c684bbc917db\">0adc50e</a></td><td><code>Correct ReST to reST</code></td></tr></table>\n",
    "created_at": "2017-03-15T01:54:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-337415",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:17'>**Comment 17:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0adc50e2b26b40d68c53b8cb8878c684bbc917db">0adc50e</a></td><td><code>Correct ReST to reST</code></td></tr></table>




---

archive/issue_comments_337416.json:
```json
{
    "body": "**Changing commit** from \"[70b80c9c98013cb466083818bfc131cd5f51047d](https://github.com/sagemath/sagetrac-mirror/commit/70b80c9c98013cb466083818bfc131cd5f51047d)\" to \"[0adc50e2b26b40d68c53b8cb8878c684bbc917db](https://github.com/sagemath/sagetrac-mirror/commit/0adc50e2b26b40d68c53b8cb8878c684bbc917db)\".",
    "created_at": "2017-03-15T01:54:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-337416",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[70b80c9c98013cb466083818bfc131cd5f51047d](https://github.com/sagemath/sagetrac-mirror/commit/70b80c9c98013cb466083818bfc131cd5f51047d)" to "[0adc50e2b26b40d68c53b8cb8878c684bbc917db](https://github.com/sagemath/sagetrac-mirror/commit/0adc50e2b26b40d68c53b8cb8878c684bbc917db)".



---

archive/issue_events_273859.json:
```json
{
    "actor": "https://github.com/kwankyu",
    "created_at": "2017-03-15T08:46:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22588#event-273859"
}
```



---

archive/issue_events_273860.json:
```json
{
    "actor": "https://github.com/kwankyu",
    "created_at": "2017-03-15T08:46:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20documentation",
    "label_color": "08517b",
    "label_name": "component: documentation",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22588#event-273860"
}
```



---

archive/issue_events_273861.json:
```json
{
    "actor": "https://github.com/kwankyu",
    "created_at": "2017-03-15T08:46:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20build",
    "label_color": "08517b",
    "label_name": "component: build",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22588#event-273861"
}
```



---

archive/issue_comments_337417.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-If we change git branches, make (doc) often fails. It turns out that the caching mechanism in sage doc builder is unreliable and is the root cause of these failures. The patch removes the caching mechanism and implements a more robust logic to auto-update module docs.  \n+If we change git branches, \"make (doc)\" often fails. It turns out that the cache mechanism in sage doc builder caused these failures. The patch implements a robust logic to auto-update module docs using the information from the Sphinx environment rather than from the cache.\n``````\n",
    "created_at": "2017-03-15T09:00:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-337417",
    "user": "https://github.com/kwankyu"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1 @@
-If we change git branches, make (doc) often fails. It turns out that the caching mechanism in sage doc builder is unreliable and is the root cause of these failures. The patch removes the caching mechanism and implements a more robust logic to auto-update module docs.  
+If we change git branches, "make (doc)" often fails. It turns out that the cache mechanism in sage doc builder caused these failures. The patch implements a robust logic to auto-update module docs using the information from the Sphinx environment rather than from the cache.
``````




---

archive/issue_events_273862.json:
```json
{
    "actor": "https://github.com/kwankyu",
    "created_at": "2017-03-15T09:00:37Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "rename": {
        "from": "Let make (doc) really always work",
        "to": "Let \"make (doc)\" really always work"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22588#event-273862"
}
```



---

archive/issue_events_273863.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-03-15T09:08:08Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "rename": {
        "from": "Let \"make (doc)\" really always work",
        "to": "Let \"make doc\" really always work"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22588#event-273863"
}
```



---

archive/issue_comments_337418.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-If we change git branches, \"make (doc)\" often fails. It turns out that the cache mechanism in sage doc builder caused these failures. The patch implements a robust logic to auto-update module docs using the information from the Sphinx environment rather than from the cache.\n+If we change git branches, `make doc` often fails. It turns out that the cache mechanism in sage doc builder caused these failures. The patch implements a robust logic to auto-update module docs using the information from the Sphinx environment rather than from the cache.\n``````\n",
    "created_at": "2017-03-15T09:08:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-337418",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1 @@
-If we change git branches, "make (doc)" often fails. It turns out that the cache mechanism in sage doc builder caused these failures. The patch implements a robust logic to auto-update module docs using the information from the Sphinx environment rather than from the cache.
+If we change git branches, `make doc` often fails. It turns out that the cache mechanism in sage doc builder caused these failures. The patch implements a robust logic to auto-update module docs using the information from the Sphinx environment rather than from the cache.
``````




---

archive/issue_comments_337419.json:
```json
{
    "body": "<a id='comment:21'>**Comment 21:**</a>\nOne annoying problem I noticed is that we now have these warning as a side effect of `__import__(module)`: \n\n```\n[dochtml] /Users/Kwankyu/GitHub/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py:909: DeprecationWarning: the module sage.rings.commutative_ring is deprecated and will be removed\n[dochtml] See http://trac.sagemath.org/20011 for details.\n[dochtml]   __import__(module)\n```\n\nCould we just ignore these or can you provide how to fix this?\n\nAs I understand, the Sphinx autodoc extension also import a module to do its work. So importing a module is not a problem. Sphinx seems not to spit out the warning messages...",
    "created_at": "2017-03-15T09:43:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-337419",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:21'>**Comment 21:**</a>
One annoying problem I noticed is that we now have these warning as a side effect of `__import__(module)`: 

```
[dochtml] /Users/Kwankyu/GitHub/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py:909: DeprecationWarning: the module sage.rings.commutative_ring is deprecated and will be removed
[dochtml] See http://trac.sagemath.org/20011 for details.
[dochtml]   __import__(module)
```

Could we just ignore these or can you provide how to fix this?

As I understand, the Sphinx autodoc extension also import a module to do its work. So importing a module is not a problem. Sphinx seems not to spit out the warning messages...



---

archive/issue_comments_337420.json:
```json
{
    "body": "**Changing commit** from \"[0adc50e2b26b40d68c53b8cb8878c684bbc917db](https://github.com/sagemath/sagetrac-mirror/commit/0adc50e2b26b40d68c53b8cb8878c684bbc917db)\" to \"[15e9ec01ac175b589e6bdb52629ce6bbf797269b](https://github.com/sagemath/sagetrac-mirror/commit/15e9ec01ac175b589e6bdb52629ce6bbf797269b)\".",
    "created_at": "2017-03-15T10:27:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-337420",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[0adc50e2b26b40d68c53b8cb8878c684bbc917db](https://github.com/sagemath/sagetrac-mirror/commit/0adc50e2b26b40d68c53b8cb8878c684bbc917db)" to "[15e9ec01ac175b589e6bdb52629ce6bbf797269b](https://github.com/sagemath/sagetrac-mirror/commit/15e9ec01ac175b589e6bdb52629ce6bbf797269b)".



---

archive/issue_comments_337421.json:
```json
{
    "body": "<a id='comment:22'>**Comment 22:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8fd3b684c270b941e87246c3174953d8d95fddb7\">8fd3b68</a></td><td><code>Minor fixes in docstrings</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/15e9ec01ac175b589e6bdb52629ce6bbf797269b\">15e9ec0</a></td><td><code>Suppress deprecation warnings</code></td></tr></table>\n",
    "created_at": "2017-03-15T10:27:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-337421",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:22'>**Comment 22:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8fd3b684c270b941e87246c3174953d8d95fddb7">8fd3b68</a></td><td><code>Minor fixes in docstrings</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/15e9ec01ac175b589e6bdb52629ce6bbf797269b">15e9ec0</a></td><td><code>Suppress deprecation warnings</code></td></tr></table>




---

archive/issue_comments_337422.json:
```json
{
    "body": "<a id='comment:23'>**Comment 23:**</a>\nI decided to suppress the deprecation warnings. It works well.",
    "created_at": "2017-03-15T10:33:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-337422",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:23'>**Comment 23:**</a>
I decided to suppress the deprecation warnings. It works well.



---

archive/issue_comments_337423.json:
```json
{
    "body": "<a id='comment:24'>**Comment 24:**</a>\nI'm not sure it's a good idea to suppress deprecation warnings. The underlying issues should be fixed, instead. (There are deprecation warnings already. Does your branch create new ones?)",
    "created_at": "2017-03-15T21:03:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-337423",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:24'>**Comment 24:**</a>
I'm not sure it's a good idea to suppress deprecation warnings. The underlying issues should be fixed, instead. (There are deprecation warnings already. Does your branch create new ones?)



---

archive/issue_events_273864.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-03-15T22:30:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22588#event-273864"
}
```



---

archive/issue_events_273865.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-03-15T22:30:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22588#event-273865"
}
```



---

archive/issue_comments_337424.json:
```json
{
    "body": "<a id='comment:25'>**Comment 25:**</a>\nPlease do not make useless changes like\n\n```diff\n def format_annotation(annotation):\n-    \"\"\"Return formatted representation of a type annotation.\n+    \"\"\"\n+    Return formatted representation of a type annotation.\n```\n\nThat will only introduce merge conflicts.",
    "created_at": "2017-03-15T22:30:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-337424",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:25'>**Comment 25:**</a>
Please do not make useless changes like

```diff
 def format_annotation(annotation):
-    """Return formatted representation of a type annotation.
+    """
+    Return formatted representation of a type annotation.
```

That will only introduce merge conflicts.



---

archive/issue_comments_337425.json:
```json
{
    "body": "**Changing commit** from \"[15e9ec01ac175b589e6bdb52629ce6bbf797269b](https://github.com/sagemath/sagetrac-mirror/commit/15e9ec01ac175b589e6bdb52629ce6bbf797269b)\" to \"[1e39367abfd82bc4e41669a80acb8a5d3bfdce21](https://github.com/sagemath/sagetrac-mirror/commit/1e39367abfd82bc4e41669a80acb8a5d3bfdce21)\".",
    "created_at": "2017-03-16T00:35:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-337425",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[15e9ec01ac175b589e6bdb52629ce6bbf797269b](https://github.com/sagemath/sagetrac-mirror/commit/15e9ec01ac175b589e6bdb52629ce6bbf797269b)" to "[1e39367abfd82bc4e41669a80acb8a5d3bfdce21](https://github.com/sagemath/sagetrac-mirror/commit/1e39367abfd82bc4e41669a80acb8a5d3bfdce21)".



---

archive/issue_comments_337426.json:
```json
{
    "body": "<a id='comment:26'>**Comment 26:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bbc8e0d6f461f753c224d808898d2ca2afaa7cd1\">bbc8e0d</a></td><td><code>Revert \"Minor fixes in docstrings\"</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1e39367abfd82bc4e41669a80acb8a5d3bfdce21\">1e39367</a></td><td><code>Just one minor fix in a log statement</code></td></tr></table>\n",
    "created_at": "2017-03-16T00:35:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-337426",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:26'>**Comment 26:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bbc8e0d6f461f753c224d808898d2ca2afaa7cd1">bbc8e0d</a></td><td><code>Revert "Minor fixes in docstrings"</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1e39367abfd82bc4e41669a80acb8a5d3bfdce21">1e39367</a></td><td><code>Just one minor fix in a log statement</code></td></tr></table>




---

archive/issue_comments_337427.json:
```json
{
    "body": "<a id='comment:27'>**Comment 27:**</a>\nReplying to [@jhpalmieri](#comment%3A24):\n> I'm not sure it's a good idea to suppress deprecation warnings. The underlying issues should be fixed, instead. (There are deprecation warnings already. Does your branch create new ones?)\n\nYou are right. Deprecation warnings were already there. My branch did not create new ones.\n\nI think this is a good case where suppressing deprecation warnings is good and harmless. Those warnings are targeted for *users* of deprecated classes and methods. In our case, there is no real use of the deprecated. And the user who is building the reference manual would just wonder why he or she gets those warnings and has nothing to do to avoid them.",
    "created_at": "2017-03-16T01:08:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-337427",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:27'>**Comment 27:**</a>
Replying to [@jhpalmieri](#comment%3A24):
> I'm not sure it's a good idea to suppress deprecation warnings. The underlying issues should be fixed, instead. (There are deprecation warnings already. Does your branch create new ones?)

You are right. Deprecation warnings were already there. My branch did not create new ones.

I think this is a good case where suppressing deprecation warnings is good and harmless. Those warnings are targeted for *users* of deprecated classes and methods. In our case, there is no real use of the deprecated. And the user who is building the reference manual would just wonder why he or she gets those warnings and has nothing to do to avoid them.



---

archive/issue_comments_337428.json:
```json
{
    "body": "<a id='comment:28'>**Comment 28:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fb9c5a814ec67b27a1fb481c5400bb3f1140e2d5\">fb9c5a8</a></td><td><code>Change module to module_name for consistency</code></td></tr></table>\n",
    "created_at": "2017-03-16T01:16:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-337428",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:28'>**Comment 28:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fb9c5a814ec67b27a1fb481c5400bb3f1140e2d5">fb9c5a8</a></td><td><code>Change module to module_name for consistency</code></td></tr></table>




---

archive/issue_comments_337429.json:
```json
{
    "body": "**Changing commit** from \"[1e39367abfd82bc4e41669a80acb8a5d3bfdce21](https://github.com/sagemath/sagetrac-mirror/commit/1e39367abfd82bc4e41669a80acb8a5d3bfdce21)\" to \"[fb9c5a814ec67b27a1fb481c5400bb3f1140e2d5](https://github.com/sagemath/sagetrac-mirror/commit/fb9c5a814ec67b27a1fb481c5400bb3f1140e2d5)\".",
    "created_at": "2017-03-16T01:16:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-337429",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[1e39367abfd82bc4e41669a80acb8a5d3bfdce21](https://github.com/sagemath/sagetrac-mirror/commit/1e39367abfd82bc4e41669a80acb8a5d3bfdce21)" to "[fb9c5a814ec67b27a1fb481c5400bb3f1140e2d5](https://github.com/sagemath/sagetrac-mirror/commit/fb9c5a814ec67b27a1fb481c5400bb3f1140e2d5)".



---

archive/issue_events_273866.json:
```json
{
    "actor": "https://github.com/kwankyu",
    "created_at": "2017-03-16T01:19:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22588#event-273866"
}
```



---

archive/issue_events_273867.json:
```json
{
    "actor": "https://github.com/kwankyu",
    "created_at": "2017-03-16T01:19:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22588#event-273867"
}
```



---

archive/issue_comments_337430.json:
```json
{
    "body": "**Changing commit** from \"[fb9c5a814ec67b27a1fb481c5400bb3f1140e2d5](https://github.com/sagemath/sagetrac-mirror/commit/fb9c5a814ec67b27a1fb481c5400bb3f1140e2d5)\" to \"[c52696ec0b7245d664897a687f87399dd0262ee4](https://github.com/sagemath/sagetrac-mirror/commit/c52696ec0b7245d664897a687f87399dd0262ee4)\".",
    "created_at": "2017-03-29T10:39:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-337430",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[fb9c5a814ec67b27a1fb481c5400bb3f1140e2d5](https://github.com/sagemath/sagetrac-mirror/commit/fb9c5a814ec67b27a1fb481c5400bb3f1140e2d5)" to "[c52696ec0b7245d664897a687f87399dd0262ee4](https://github.com/sagemath/sagetrac-mirror/commit/c52696ec0b7245d664897a687f87399dd0262ee4)".



---

archive/issue_comments_337431.json:
```json
{
    "body": "<a id='comment:30'>**Comment 30:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c52696ec0b7245d664897a687f87399dd0262ee4\">c52696e</a></td><td><code>Merge branch 'sage 7.6'</code></td></tr></table>\n",
    "created_at": "2017-03-29T10:39:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-337431",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:30'>**Comment 30:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c52696ec0b7245d664897a687f87399dd0262ee4">c52696e</a></td><td><code>Merge branch 'sage 7.6'</code></td></tr></table>




---

archive/issue_comments_337432.json:
```json
{
    "body": "<a id='comment:31'>**Comment 31:**</a>\nIt is a pain to see document building fail with the branch changed. This patch should be merged as soon as possible. Please review if you agree.",
    "created_at": "2017-03-29T10:44:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-337432",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:31'>**Comment 31:**</a>
It is a pain to see document building fail with the branch changed. This patch should be merged as soon as possible. Please review if you agree.



---

archive/issue_comments_337433.json:
```json
{
    "body": "<a id='comment:32'>**Comment 32:**</a>\nFlorent, can you review this?",
    "created_at": "2017-04-04T19:14:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-337433",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:32'>**Comment 32:**</a>
Florent, can you review this?



---

archive/issue_comments_337434.json:
```json
{
    "body": "**Reviewer:** Florent Hivert, Erik Bray",
    "created_at": "2017-04-05T09:18:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-337434",
    "user": "https://github.com/embray"
}
```

**Reviewer:** Florent Hivert, Erik Bray



---

archive/issue_comments_337435.json:
```json
{
    "body": "<a id='comment:33'>**Comment 33:**</a>\nThanks for trying to fix this--it's been a huge source of irritation for me as well.  \n\nFlorent is the expert on this code so he should have final say (but I'm not sure where he is--I haven't seen him in the office this week).  But the logic here makes sense to me.  I just have a few questions:\n\nIn the old `get_newly_included_modules(self, save=False)` method (which is now obsolete--it is not used anywhere and could be removed?) there is a `save` argument.  Your new `get_new_and_updated_modules()` method also has the `save` argument but it isn't used anywhere (nor would it be).\n\nAlso I think it's a little confusing that what is now being called the \"cache\" is just storing the options that were used in the last docbuild run, and nothing else AFAICT (since as you point out the same information can be found in the Sphinx environment).",
    "created_at": "2017-04-05T09:18:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-337435",
    "user": "https://github.com/embray"
}
```

<a id='comment:33'>**Comment 33:**</a>
Thanks for trying to fix this--it's been a huge source of irritation for me as well.  

Florent is the expert on this code so he should have final say (but I'm not sure where he is--I haven't seen him in the office this week).  But the logic here makes sense to me.  I just have a few questions:

In the old `get_newly_included_modules(self, save=False)` method (which is now obsolete--it is not used anywhere and could be removed?) there is a `save` argument.  Your new `get_new_and_updated_modules()` method also has the `save` argument but it isn't used anywhere (nor would it be).

Also I think it's a little confusing that what is now being called the "cache" is just storing the options that were used in the last docbuild run, and nothing else AFAICT (since as you point out the same information can be found in the Sphinx environment).



---

archive/issue_comments_337436.json:
```json
{
    "body": "<a id='comment:34'>**Comment 34:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8b0f3ae1c60bb97a94cc8dd0538b2bd4db7c0703\">8b0f3ae</a></td><td><code>Remove unused method and argument</code></td></tr></table>\n",
    "created_at": "2017-04-05T10:23:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-337436",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:34'>**Comment 34:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8b0f3ae1c60bb97a94cc8dd0538b2bd4db7c0703">8b0f3ae</a></td><td><code>Remove unused method and argument</code></td></tr></table>




---

archive/issue_comments_337437.json:
```json
{
    "body": "**Changing commit** from \"[c52696ec0b7245d664897a687f87399dd0262ee4](https://github.com/sagemath/sagetrac-mirror/commit/c52696ec0b7245d664897a687f87399dd0262ee4)\" to \"[8b0f3ae1c60bb97a94cc8dd0538b2bd4db7c0703](https://github.com/sagemath/sagetrac-mirror/commit/8b0f3ae1c60bb97a94cc8dd0538b2bd4db7c0703)\".",
    "created_at": "2017-04-05T10:23:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-337437",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[c52696ec0b7245d664897a687f87399dd0262ee4](https://github.com/sagemath/sagetrac-mirror/commit/c52696ec0b7245d664897a687f87399dd0262ee4)" to "[8b0f3ae1c60bb97a94cc8dd0538b2bd4db7c0703](https://github.com/sagemath/sagetrac-mirror/commit/8b0f3ae1c60bb97a94cc8dd0538b2bd4db7c0703)".



---

archive/issue_comments_337438.json:
```json
{
    "body": "<a id='comment:35'>**Comment 35:**</a>\nReplying to [@embray](#comment%3A33):\n> In the old `get_newly_included_modules(self, save=False)` method (which is now obsolete--it is not used anywhere and could be removed?) there is a `save` argument.  Your new `get_new_and_updated_modules()` method also has the `save` argument but it isn't used anywhere (nor would it be).\n\nI agree. Removed them just now.\n\n> Also I think it's a little confusing that what is now being called the \"cache\" is just storing the options that were used in the last docbuild run, and nothing else AFAICT (since as you point out the same information can be found in the Sphinx environment).\n\nYou are right. I wanted to get rid of the cache file. But unfortunately, as Florent noted, it turned out that we need to save the last options used somewhere, to decide whether to rebuild all modules or not given the new options. So the main role of the cache changed (and I started to call the cache \"reference cache\" -- a cache for building the reference)",
    "created_at": "2017-04-05T10:33:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-337438",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:35'>**Comment 35:**</a>
Replying to [@embray](#comment%3A33):
> In the old `get_newly_included_modules(self, save=False)` method (which is now obsolete--it is not used anywhere and could be removed?) there is a `save` argument.  Your new `get_new_and_updated_modules()` method also has the `save` argument but it isn't used anywhere (nor would it be).

I agree. Removed them just now.

> Also I think it's a little confusing that what is now being called the "cache" is just storing the options that were used in the last docbuild run, and nothing else AFAICT (since as you point out the same information can be found in the Sphinx environment).

You are right. I wanted to get rid of the cache file. But unfortunately, as Florent noted, it turned out that we need to save the last options used somewhere, to decide whether to rebuild all modules or not given the new options. So the main role of the cache changed (and I started to call the cache "reference cache" -- a cache for building the reference)



---

archive/issue_comments_337439.json:
```json
{
    "body": "<a id='comment:36'>**Comment 36:**</a>\nReplying to [@embray](#comment%3A33):\n\n> Florent is the expert on this code so he should have final say (but I'm not sure where he is--I haven't seen him in the office this week).  But the logic here makes sense to me.  \n\nHi Embray ! I've been sick and unable to work for one week. That's why you haven't seen me. I'm currently catching up and then I'll review this ticket.",
    "created_at": "2017-04-05T19:15:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-337439",
    "user": "https://github.com/hivert"
}
```

<a id='comment:36'>**Comment 36:**</a>
Replying to [@embray](#comment%3A33):

> Florent is the expert on this code so he should have final say (but I'm not sure where he is--I haven't seen him in the office this week).  But the logic here makes sense to me.  

Hi Embray ! I've been sick and unable to work for one week. That's why you haven't seen me. I'm currently catching up and then I'll review this ticket.



---

archive/issue_comments_337440.json:
```json
{
    "body": "<a id='comment:37'>**Comment 37:**</a>\nI wonder which is the case: this patch is not so useful to developers as I believe or they are too busy to spare some time for this ticket...",
    "created_at": "2017-05-11T21:52:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-337440",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:37'>**Comment 37:**</a>
I wonder which is the case: this patch is not so useful to developers as I believe or they are too busy to spare some time for this ticket...



---

archive/issue_comments_337441.json:
```json
{
    "body": "<a id='comment:38'>**Comment 38:**</a>\nI think it's definitely useful--people are just busy.",
    "created_at": "2017-05-12T09:47:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-337441",
    "user": "https://github.com/embray"
}
```

<a id='comment:38'>**Comment 38:**</a>
I think it's definitely useful--people are just busy.



---

archive/issue_comments_337442.json:
```json
{
    "body": "<a id='comment:39'>**Comment 39:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f9df7cf58c39e2c2b45e41237f3107c3aebab4d2\">f9df7cf</a></td><td><code>Merge branch 'develop' into sphinx_trac22588</code></td></tr></table>\n",
    "created_at": "2017-06-04T10:52:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-337442",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:39'>**Comment 39:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f9df7cf58c39e2c2b45e41237f3107c3aebab4d2">f9df7cf</a></td><td><code>Merge branch 'develop' into sphinx_trac22588</code></td></tr></table>




---

archive/issue_comments_337443.json:
```json
{
    "body": "**Changing commit** from \"[8b0f3ae1c60bb97a94cc8dd0538b2bd4db7c0703](https://github.com/sagemath/sagetrac-mirror/commit/8b0f3ae1c60bb97a94cc8dd0538b2bd4db7c0703)\" to \"[f9df7cf58c39e2c2b45e41237f3107c3aebab4d2](https://github.com/sagemath/sagetrac-mirror/commit/f9df7cf58c39e2c2b45e41237f3107c3aebab4d2)\".",
    "created_at": "2017-06-04T10:52:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-337443",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[8b0f3ae1c60bb97a94cc8dd0538b2bd4db7c0703](https://github.com/sagemath/sagetrac-mirror/commit/8b0f3ae1c60bb97a94cc8dd0538b2bd4db7c0703)" to "[f9df7cf58c39e2c2b45e41237f3107c3aebab4d2](https://github.com/sagemath/sagetrac-mirror/commit/f9df7cf58c39e2c2b45e41237f3107c3aebab4d2)".



---

archive/issue_events_273868.json:
```json
{
    "actor": "https://github.com/kwankyu",
    "created_at": "2017-06-04T10:53:15Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "milestone_number": null,
    "milestone_title": "sage-7.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22588#event-273868"
}
```



---

archive/issue_events_273869.json:
```json
{
    "actor": "https://github.com/kwankyu",
    "created_at": "2017-06-04T10:53:15Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "milestone_number": null,
    "milestone_title": "sage-8.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22588#event-273869"
}
```



---

archive/issue_comments_337444.json:
```json
{
    "body": "<a id='comment:41'>**Comment 41:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8227d6bf837095bf4299197d0def98a97e77937d\">8227d6b</a></td><td><code>Merge branch 'develop' into sphinx_trac22588</code></td></tr></table>\n",
    "created_at": "2017-06-11T21:27:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-337444",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:41'>**Comment 41:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8227d6bf837095bf4299197d0def98a97e77937d">8227d6b</a></td><td><code>Merge branch 'develop' into sphinx_trac22588</code></td></tr></table>




---

archive/issue_comments_337445.json:
```json
{
    "body": "**Changing commit** from \"[f9df7cf58c39e2c2b45e41237f3107c3aebab4d2](https://github.com/sagemath/sagetrac-mirror/commit/f9df7cf58c39e2c2b45e41237f3107c3aebab4d2)\" to \"[8227d6bf837095bf4299197d0def98a97e77937d](https://github.com/sagemath/sagetrac-mirror/commit/8227d6bf837095bf4299197d0def98a97e77937d)\".",
    "created_at": "2017-06-11T21:27:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-337445",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[f9df7cf58c39e2c2b45e41237f3107c3aebab4d2](https://github.com/sagemath/sagetrac-mirror/commit/f9df7cf58c39e2c2b45e41237f3107c3aebab4d2)" to "[8227d6bf837095bf4299197d0def98a97e77937d](https://github.com/sagemath/sagetrac-mirror/commit/8227d6bf837095bf4299197d0def98a97e77937d)".



---

archive/issue_comments_337446.json:
```json
{
    "body": "<a id='comment:42'>**Comment 42:**</a>\nFlorent, I beg your review.",
    "created_at": "2017-06-11T21:30:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-337446",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:42'>**Comment 42:**</a>
Florent, I beg your review.



---

archive/issue_comments_337447.json:
```json
{
    "body": "<a id='comment:43'>**Comment 43:**</a>\nI'm not quite competent to review this but it would be really useful ... ping!",
    "created_at": "2017-07-05T15:26:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-337447",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:43'>**Comment 43:**</a>
I'm not quite competent to review this but it would be really useful ... ping!



---

archive/issue_comments_337448.json:
```json
{
    "body": "<a id='comment:44'>**Comment 44:**</a>\nReplying to [@kcrisman](#comment%3A43):\n> I'm not quite competent to review this but it would be really useful ... ping!\n\nYes! I repeatedly rely on this patch when I work with my branch, since without it \"make\" often fails while building docs. I just wonder how other developers live with the limped doc builder. I hoped this had been merged to Sage 8.0...",
    "created_at": "2017-07-05T15:41:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-337448",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:44'>**Comment 44:**</a>
Replying to [@kcrisman](#comment%3A43):
> I'm not quite competent to review this but it would be really useful ... ping!

Yes! I repeatedly rely on this patch when I work with my branch, since without it "make" often fails while building docs. I just wonder how other developers live with the limped doc builder. I hoped this had been merged to Sage 8.0...



---

archive/issue_comments_337449.json:
```json
{
    "body": "<a id='comment:45'>**Comment 45:**</a>\nI wonder if it would also enable speeding up patchbot builds, if we don't have to do a full `make doc-clean` on every build...",
    "created_at": "2017-07-05T16:18:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-337449",
    "user": "https://github.com/embray"
}
```

<a id='comment:45'>**Comment 45:**</a>
I wonder if it would also enable speeding up patchbot builds, if we don't have to do a full `make doc-clean` on every build...



---

archive/issue_comments_337450.json:
```json
{
    "body": "<a id='comment:46'>**Comment 46:**</a>\nReplying to [@embray](#comment%3A45):\n> I wonder if it would also enable speeding up patchbot builds, if we don't have to do a full `make doc-clean` on every build...\n\nIn theory, yes.  If we are 100% sure that the doc builder is totally reliable and robust against changing branches after this ticket is merged, then we may make it an option to do `make doc-clean` in the patchbot.\n\nOn the other hand, I once observed that some hyperlinks don't work properly in the docs built without `make doc-clean`.",
    "created_at": "2017-07-05T16:54:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-337450",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:46'>**Comment 46:**</a>
Replying to [@embray](#comment%3A45):
> I wonder if it would also enable speeding up patchbot builds, if we don't have to do a full `make doc-clean` on every build...

In theory, yes.  If we are 100% sure that the doc builder is totally reliable and robust against changing branches after this ticket is merged, then we may make it an option to do `make doc-clean` in the patchbot.

On the other hand, I once observed that some hyperlinks don't work properly in the docs built without `make doc-clean`.



---

archive/issue_comments_337451.json:
```json
{
    "body": "<a id='comment:47'>**Comment 47:**</a>\nI think, for the patchbot's purposes, it's fine if the docs don't build 100% correctly as long as they *can* be built without errors from Sphinx, or problems that impact the doctests.\n\nIf nothing else, once this (or a fix like it) is merged it would be worth updating the patchbot to make the doc-clean an option, as you suggest, and experiment with running without it for a while.",
    "created_at": "2017-07-06T08:45:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-337451",
    "user": "https://github.com/embray"
}
```

<a id='comment:47'>**Comment 47:**</a>
I think, for the patchbot's purposes, it's fine if the docs don't build 100% correctly as long as they *can* be built without errors from Sphinx, or problems that impact the doctests.

If nothing else, once this (or a fix like it) is merged it would be worth updating the patchbot to make the doc-clean an option, as you suggest, and experiment with running without it for a while.



---

archive/issue_comments_337452.json:
```json
{
    "body": "<a id='comment:48'>**Comment 48:**</a>\nI would like to give this a positive review, but here is an issue: I tested this by deleting a file \u2013\u00a0I happened to choose `homology/koszul_complex.py`, along with its link in the reference manual. When I rebuilt the docs with the `develop` branch, it crashed because of the missing file, but with this branch, the docs built. That's great. What's not as great is that with this branch, the other pages in the `homology` part of the reference manual were not changed to reflect the missing page, so for example, `cell_complex.html` was not rewritten and so still has the line\n\n```\n    <link rel=\"next\" title=\"Koszul Complexes\" href=\"koszul_complex.html\" />\n```\n(This means that at the top of that page, it says \"Next page: Koszul complexes\".) Fortunately (?), the page `koszul_complex.html` was not deleted, so the link still works.\n\nNote also that there are still references to `koszul_complex.html` in the search indices.\n\nThe problem with docbuilding before this branch is that the auto-generated `koszul_complex.rst` would remain, while this branch does a good job of cleaning it up. What about these other references to `koszul_complex.html`? Deal with here or on another ticket, or ignore altogether?",
    "created_at": "2017-08-04T17:05:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-337452",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:48'>**Comment 48:**</a>
I would like to give this a positive review, but here is an issue: I tested this by deleting a file – I happened to choose `homology/koszul_complex.py`, along with its link in the reference manual. When I rebuilt the docs with the `develop` branch, it crashed because of the missing file, but with this branch, the docs built. That's great. What's not as great is that with this branch, the other pages in the `homology` part of the reference manual were not changed to reflect the missing page, so for example, `cell_complex.html` was not rewritten and so still has the line

```
    <link rel="next" title="Koszul Complexes" href="koszul_complex.html" />
```
(This means that at the top of that page, it says "Next page: Koszul complexes".) Fortunately (?), the page `koszul_complex.html` was not deleted, so the link still works.

Note also that there are still references to `koszul_complex.html` in the search indices.

The problem with docbuilding before this branch is that the auto-generated `koszul_complex.rst` would remain, while this branch does a good job of cleaning it up. What about these other references to `koszul_complex.html`? Deal with here or on another ticket, or ignore altogether?



---

archive/issue_comments_337453.json:
```json
{
    "body": "<a id='comment:49'>**Comment 49:**</a>\nA similar problem happens when you add a file: suppose you are adding a file \"B.py\" whose html file is supposed to go between \"A.html\" and \"C.html\" (that is, in \"A.html\", the next topic should point to \"B.html\"). If the docs have already been built, with A.html pointing to C.html, then you add B.html, the links in A.html and C.html will not change: they will point to each other as previous and next topics.\n\nWith the \"develop\" branch, docbuilding fails completely so you have to delete the built docs, so you never see this problem. With the branch from this ticket, you see it. Essentially the same question as in my previous comment: is the rest of this enough of an improvement that we can put off this problem to another ticket?",
    "created_at": "2017-08-04T18:10:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-337453",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:49'>**Comment 49:**</a>
A similar problem happens when you add a file: suppose you are adding a file "B.py" whose html file is supposed to go between "A.html" and "C.html" (that is, in "A.html", the next topic should point to "B.html"). If the docs have already been built, with A.html pointing to C.html, then you add B.html, the links in A.html and C.html will not change: they will point to each other as previous and next topics.

With the "develop" branch, docbuilding fails completely so you have to delete the built docs, so you never see this problem. With the branch from this ticket, you see it. Essentially the same question as in my previous comment: is the rest of this enough of an improvement that we can put off this problem to another ticket?



---

archive/issue_comments_337454.json:
```json
{
    "body": "<a id='comment:50'>**Comment 50:**</a>\nReplying to [@jhpalmieri](#comment%3A48):\n> The problem with docbuilding before this branch is that the auto-generated `koszul_complex.rst` would remain, while this branch does a good job of cleaning it up. What about these other references to `koszul_complex.html`? Deal with here or on another ticket, or ignore altogether?\n\nThis branch is about auto-generating .rst files correctly. So the problem of wrong cross-references could be dealt with separately in another ticket.\n\nThe problem of wrong cross-references seems related with how intersphinx extension works. I guess that the intersphinx inventory files should be updated somehow when the auto-generated .rst files are updated. I am not Sphinx expert though, and it would take me some time to figure out what is wrong and to find a proper fix.",
    "created_at": "2017-08-05T14:22:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-337454",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:50'>**Comment 50:**</a>
Replying to [@jhpalmieri](#comment%3A48):
> The problem with docbuilding before this branch is that the auto-generated `koszul_complex.rst` would remain, while this branch does a good job of cleaning it up. What about these other references to `koszul_complex.html`? Deal with here or on another ticket, or ignore altogether?

This branch is about auto-generating .rst files correctly. So the problem of wrong cross-references could be dealt with separately in another ticket.

The problem of wrong cross-references seems related with how intersphinx extension works. I guess that the intersphinx inventory files should be updated somehow when the auto-generated .rst files are updated. I am not Sphinx expert though, and it would take me some time to figure out what is wrong and to find a proper fix.



---

archive/issue_comments_337455.json:
```json
{
    "body": "<a id='comment:51'>**Comment 51:**</a>\nI agree--the way I feel about this ticket is that it's not fixing every possible issue with incremental doc builds between branch changes, of which there are many.  More importantly, it's just making it so that the doc build succeeds without crashing.  It's not *generally* too important for the docs themselves to be exactly correct in this case--for perfectly correct docs they should be built from scratch.  Rather, this avoids having to rebuild the docs from scratch every time a branch is switched (this is especially nice for the patchbot).\n\nI wouldn't say this would never lead to confusion--people might want to read the development docs, especially if they're working on the docs themselves.  But this isn't a showstopper.  The current situation, however, is very annoying :)",
    "created_at": "2017-08-07T09:38:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-337455",
    "user": "https://github.com/embray"
}
```

<a id='comment:51'>**Comment 51:**</a>
I agree--the way I feel about this ticket is that it's not fixing every possible issue with incremental doc builds between branch changes, of which there are many.  More importantly, it's just making it so that the doc build succeeds without crashing.  It's not *generally* too important for the docs themselves to be exactly correct in this case--for perfectly correct docs they should be built from scratch.  Rather, this avoids having to rebuild the docs from scratch every time a branch is switched (this is especially nice for the patchbot).

I wouldn't say this would never lead to confusion--people might want to read the development docs, especially if they're working on the docs themselves.  But this isn't a showstopper.  The current situation, however, is very annoying :)



---

archive/issue_comments_337456.json:
```json
{
    "body": "**Changing reviewer** from \"Florent Hivert, Erik Bray\" to \"Florent Hivert, Erik Bray, John Palmieri\".",
    "created_at": "2017-08-07T15:17:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-337456",
    "user": "https://github.com/jhpalmieri"
}
```

**Changing reviewer** from "Florent Hivert, Erik Bray" to "Florent Hivert, Erik Bray, John Palmieri".



---

archive/issue_comments_337457.json:
```json
{
    "body": "<a id='comment:52'>**Comment 52:**</a>\nOkay, then let's merge this and see how it goes.",
    "created_at": "2017-08-07T15:17:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-337457",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:52'>**Comment 52:**</a>
Okay, then let's merge this and see how it goes.



---

archive/issue_events_273870.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2017-08-07T15:17:03Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22588#event-273870"
}
```



---

archive/issue_events_273871.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2017-08-07T15:17:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22588#event-273871"
}
```



---

archive/issue_comments_337458.json:
```json
{
    "body": "<a id='comment:53'>**Comment 53:**</a>\nHere is the ticket for the problem of wrong cross references\n\nhttps://trac.sagemath.org/ticket/23602",
    "created_at": "2017-08-09T01:34:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-337458",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:53'>**Comment 53:**</a>
Here is the ticket for the problem of wrong cross references

https://trac.sagemath.org/ticket/23602



---

archive/issue_comments_337459.json:
```json
{
    "body": "**Changing branch** from \"[u/klee/22588](https://github.com/sagemath/sagetrac-mirror/tree/u/klee/22588)\" to \"[8227d6bf837095bf4299197d0def98a97e77937d](https://github.com/sagemath/sagetrac-mirror/commit/8227d6bf837095bf4299197d0def98a97e77937d)\".",
    "created_at": "2017-08-11T18:18:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-337459",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/klee/22588](https://github.com/sagemath/sagetrac-mirror/tree/u/klee/22588)" to "[8227d6bf837095bf4299197d0def98a97e77937d](https://github.com/sagemath/sagetrac-mirror/commit/8227d6bf837095bf4299197d0def98a97e77937d)".



---

archive/issue_events_273872.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-08-11T18:18:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22588#event-273872"
}
```



---

archive/issue_events_273873.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "527e4d33e799465a2153f9eb58b359dc486d0a74",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2017-08-11T18:18:09Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22588#event-273873"
}
```



---

archive/issue_comments_337460.json:
```json
{
    "body": "**Changing commit** from \"[8227d6bf837095bf4299197d0def98a97e77937d](https://github.com/sagemath/sagetrac-mirror/commit/8227d6bf837095bf4299197d0def98a97e77937d)\" to \"\".",
    "created_at": "2017-08-18T18:27:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-337460",
    "user": "https://github.com/kcrisman"
}
```

**Changing commit** from "[8227d6bf837095bf4299197d0def98a97e77937d](https://github.com/sagemath/sagetrac-mirror/commit/8227d6bf837095bf4299197d0def98a97e77937d)" to "".



---

archive/issue_comments_337461.json:
```json
{
    "body": "<a id='comment:55'>**Comment 55:**</a>\nNice work!",
    "created_at": "2017-08-18T18:27:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-337461",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:55'>**Comment 55:**</a>
Nice work!



---

archive/issue_comments_337462.json:
```json
{
    "body": "<a id='comment:56'>**Comment 56:**</a>\nThere is an important regression: #23975",
    "created_at": "2017-10-07T14:49:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-337462",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:56'>**Comment 56:**</a>
There is an important regression: #23975



---

archive/issue_comments_337463.json:
```json
{
    "body": "<a id='comment:57'>**Comment 57:**</a>\nReplying to [@jdemeyer](#comment%3A56):\n> There is an important regression: #23975\n\nI looked at #23975. As far as I understand, an issue was raised about sage-location and fixed by a patch there. Is the regression still present? What is the regression? Is there something to be done here? Help me catch up.",
    "created_at": "2017-10-08T00:42:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-337463",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:57'>**Comment 57:**</a>
Replying to [@jdemeyer](#comment%3A56):
> There is an important regression: #23975

I looked at #23975. As far as I understand, an issue was raised about sage-location and fixed by a patch there. Is the regression still present? What is the regression? Is there something to be done here? Help me catch up.
