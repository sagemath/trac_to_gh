# Issue 22588: Let "make doc" really always work

archive/issues_022351.json:
```json
{
    "assignees": [],
    "body": "If we change git branches, `make doc` often fails. It turns out that the cache mechanism in sage doc builder caused these failures. The patch implements a robust logic to auto-update module docs using the information from the Sphinx environment rather than from the cache.\n\nKeywords: **days85**\n\nBranch: **[`8227d6b`](https://github.com/sagemath/sagetrac-mirror/commit/8227d6bf837095bf4299197d0def98a97e77937d)**\n\nReviewer: **Florent Hivert, Erik Bray, John Palmieri**\n\nAuthor: **Kwankyu Lee**\n\nComponent: **build**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/22588_\n\n",
    "closed_at": "2017-08-11T18:18:09Z",
    "created_at": "2017-03-13T00:24:58Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20build",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.0",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Let \"make doc\" really always work",
    "type": "issue",
    "updated_at": "2017-10-08T00:42:20Z",
    "url": "https://github.com/sagemath/sage/issues/22588",
    "user": "https://github.com/kwankyu"
}
```
If we change git branches, `make doc` often fails. It turns out that the cache mechanism in sage doc builder caused these failures. The patch implements a robust logic to auto-update module docs using the information from the Sphinx environment rather than from the cache.

Keywords: **days85**

Branch: **[`8227d6b`](https://github.com/sagemath/sagetrac-mirror/commit/8227d6bf837095bf4299197d0def98a97e77937d)**

Reviewer: **Florent Hivert, Erik Bray, John Palmieri**

Author: **Kwankyu Lee**

Component: **build**

_Issue created by migration from https://trac.sagemath.org/ticket/22588_





---

archive/issue_events_317078.json:
```json
{
    "actor": "https://github.com/kwankyu",
    "created_at": "2017-03-13T00:24:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "milestone_number": null,
    "milestone_title": "sage-7.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22588#event-317078"
}
```



---

archive/issue_events_317079.json:
```json
{
    "actor": "https://github.com/kwankyu",
    "created_at": "2017-03-13T00:24:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20documentation",
    "label_color": "0075ca",
    "label_name": "c: documentation",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22588#event-317079"
}
```



---

archive/issue_events_317080.json:
```json
{
    "actor": "https://github.com/kwankyu",
    "created_at": "2017-03-13T00:24:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22588#event-317080"
}
```



---

archive/issue_events_317081.json:
```json
{
    "actor": "https://github.com/kwankyu",
    "created_at": "2017-03-13T00:24:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22588#event-317081"
}
```



---

archive/issue_comments_334813.json:
```json
{
    "body": "Branch: **[u/klee/22588](https://github.com/sagemath/sagetrac-mirror/tree/u/klee/22588)**",
    "created_at": "2017-03-13T00:35:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-334813",
    "user": "https://github.com/kwankyu"
}
```

Branch: **[u/klee/22588](https://github.com/sagemath/sagetrac-mirror/tree/u/klee/22588)**



---

archive/issue_comments_334814.json:
```json
{
    "body": "Author: **Kwankyu Lee**",
    "created_at": "2017-03-13T00:35:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-334814",
    "user": "https://github.com/kwankyu"
}
```

Author: **Kwankyu Lee**



---

archive/issue_comments_334815.json:
```json
{
    "body": "<div id=\"comment:2\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7e6d6c6111fb01967347bc886cea43b0e4657fd7\"><code>7e6d6c6</code></a></td><td><code>Fix doc builder logic</code></td></tr></table>\n",
    "created_at": "2017-03-13T00:35:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-334815",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:2"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7e6d6c6111fb01967347bc886cea43b0e4657fd7"><code>7e6d6c6</code></a></td><td><code>Fix doc builder logic</code></td></tr></table>




---

archive/issue_comments_334816.json:
```json
{
    "body": "Commit: **[`7e6d6c6`](https://github.com/sagemath/sagetrac-mirror/commit/7e6d6c6111fb01967347bc886cea43b0e4657fd7)**",
    "created_at": "2017-03-13T00:35:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-334816",
    "user": "https://github.com/sagetrac-git"
}
```

Commit: **[`7e6d6c6`](https://github.com/sagemath/sagetrac-mirror/commit/7e6d6c6111fb01967347bc886cea43b0e4657fd7)**



---

archive/issue_comments_334817.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nHi,\n\nThanks for this suggestion ! I've a few question for your patch.\n\n- Usually caching is here for performance reason. Did you test that there isn't a huge speed loss ?\n\n- Can you explain a little in the description of this patch how your new robust logic works ?\n\n- Finally, from a first glance, It seems that you don't handle the 'underscore' option anymore, do you ?\n\nCheers,\n\nFlorent",
    "created_at": "2017-03-13T15:40:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-334817",
    "user": "https://github.com/hivert"
}
```

<div id="comment:3" align="right">comment:3</div>

Hi,

Thanks for this suggestion ! I've a few question for your patch.

- Usually caching is here for performance reason. Did you test that there isn't a huge speed loss ?

- Can you explain a little in the description of this patch how your new robust logic works ?

- Finally, from a first glance, It seems that you don't handle the 'underscore' option anymore, do you ?

Cheers,

Florent



---

archive/issue_comments_334818.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nI got\n\n```\n[...]\ncd ../.. && sage-logger -p './sage --docbuild --no-pdf-links all html ' logs/dochtml.log\n[dochtml] \n[dochtml] Building reference manual, first pass.\n[dochtml] \n[dochtml] Error building the documentation.\n[dochtml] Traceback (most recent call last):\n[dochtml]   File \"/home/data/Sage-Install/sage-7.5.1/local/lib/python/runpy.py\", line 174, in _run_module_as_main\n[dochtml]     \"__main__\", fname, loader, pkg_name)\n[dochtml]   File \"/home/data/Sage-Install/sage-7.5.1/local/lib/python/runpy.py\", line 72, in _run_code\n[dochtml]     exec code in run_globals\n[dochtml]   File \"/home/data/Sage-Install/sage-7.5.1/local/lib/python2.7/site-packages/sage_setup/docbuild/__main__.py\", line 2, in <module>\n[dochtml]     main()\n[dochtml]   File \"/home/data/Sage-Install/sage-7.5.1/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py\", line 1618, in main\n[dochtml]     builder()\n[dochtml]   File \"/home/data/Sage-Install/sage-7.5.1/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py\", line 316, in _wrapper\n[dochtml]     getattr(get_builder(document), 'inventory')(*args, **kwds)\n[dochtml]   File \"/home/data/Sage-Install/sage-7.5.1/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py\", line 510, in _wrapper\n[dochtml]     build_many(build_ref_doc, L)\n[dochtml]   File \"/home/data/Sage-Install/sage-7.5.1/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py\", line 252, in build_many\n[dochtml]     ret = x.get(99999)\n[dochtml]   File \"/home/data/Sage-Install/sage-7.5.1/local/lib/python/multiprocessing/pool.py\", line 567, in get\n[dochtml]     raise self._value\n[dochtml] AttributeError: 'NoneType' object has no attribute 'all_docs'\n[...]\n```\nHere is how to reproduce the problem: I went to `7.6.beta6` and compiled the doc normally. Then I switched to `22588` and issued a `make doc-clean` and `make doc`. \n\nAlso the git managed file `src/doc/en/reference/misc/sagetex.rst` was deleted.",
    "created_at": "2017-03-13T16:16:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-334818",
    "user": "https://github.com/hivert"
}
```

<div id="comment:4" align="right">comment:4</div>

I got

```
[...]
cd ../.. && sage-logger -p './sage --docbuild --no-pdf-links all html ' logs/dochtml.log
[dochtml] 
[dochtml] Building reference manual, first pass.
[dochtml] 
[dochtml] Error building the documentation.
[dochtml] Traceback (most recent call last):
[dochtml]   File "/home/data/Sage-Install/sage-7.5.1/local/lib/python/runpy.py", line 174, in _run_module_as_main
[dochtml]     "__main__", fname, loader, pkg_name)
[dochtml]   File "/home/data/Sage-Install/sage-7.5.1/local/lib/python/runpy.py", line 72, in _run_code
[dochtml]     exec code in run_globals
[dochtml]   File "/home/data/Sage-Install/sage-7.5.1/local/lib/python2.7/site-packages/sage_setup/docbuild/__main__.py", line 2, in <module>
[dochtml]     main()
[dochtml]   File "/home/data/Sage-Install/sage-7.5.1/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py", line 1618, in main
[dochtml]     builder()
[dochtml]   File "/home/data/Sage-Install/sage-7.5.1/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py", line 316, in _wrapper
[dochtml]     getattr(get_builder(document), 'inventory')(*args, **kwds)
[dochtml]   File "/home/data/Sage-Install/sage-7.5.1/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py", line 510, in _wrapper
[dochtml]     build_many(build_ref_doc, L)
[dochtml]   File "/home/data/Sage-Install/sage-7.5.1/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py", line 252, in build_many
[dochtml]     ret = x.get(99999)
[dochtml]   File "/home/data/Sage-Install/sage-7.5.1/local/lib/python/multiprocessing/pool.py", line 567, in get
[dochtml]     raise self._value
[dochtml] AttributeError: 'NoneType' object has no attribute 'all_docs'
[...]
```
Here is how to reproduce the problem: I went to `7.6.beta6` and compiled the doc normally. Then I switched to `22588` and issued a `make doc-clean` and `make doc`. 

Also the git managed file `src/doc/en/reference/misc/sagetex.rst` was deleted.



---

archive/issue_comments_334819.json:
```json
{
    "body": "Changed keywords from none to **days85**",
    "created_at": "2017-03-13T16:41:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-334819",
    "user": "https://github.com/jdemeyer"
}
```

Changed keywords from none to **days85**



---

archive/issue_comments_334820.json:
```json
{
    "body": "Changed commit from **[`7e6d6c6`](https://github.com/sagemath/sagetrac-mirror/commit/7e6d6c6111fb01967347bc886cea43b0e4657fd7)** to **[`839c5f2`](https://github.com/sagemath/sagetrac-mirror/commit/839c5f23b9831f219ab35ba9a82652cfe6e5469b)**",
    "created_at": "2017-03-13T16:55:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-334820",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`7e6d6c6`](https://github.com/sagemath/sagetrac-mirror/commit/7e6d6c6111fb01967347bc886cea43b0e4657fd7)** to **[`839c5f2`](https://github.com/sagemath/sagetrac-mirror/commit/839c5f23b9831f219ab35ba9a82652cfe6e5469b)**



---

archive/issue_comments_334821.json:
```json
{
    "body": "<div id=\"comment:6\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/839c5f23b9831f219ab35ba9a82652cfe6e5469b\"><code>839c5f2</code></a></td><td><code>Quickfix for a bug in new code</code></td></tr></table>\n",
    "created_at": "2017-03-13T16:55:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-334821",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:6"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/839c5f23b9831f219ab35ba9a82652cfe6e5469b"><code>839c5f2</code></a></td><td><code>Quickfix for a bug in new code</code></td></tr></table>




---

archive/issue_comments_334822.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nTry the quickfix to fix the problem. Meanwhile I will think to reply to your questions.",
    "created_at": "2017-03-13T17:00:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-334822",
    "user": "https://github.com/kwankyu"
}
```

<div id="comment:7" align="right">comment:7</div>

Try the quickfix to fix the problem. Meanwhile I will think to reply to your questions.



---

archive/issue_comments_334823.json:
```json
{
    "body": "Changed commit from **[`839c5f2`](https://github.com/sagemath/sagetrac-mirror/commit/839c5f23b9831f219ab35ba9a82652cfe6e5469b)** to **[`45d53c4`](https://github.com/sagemath/sagetrac-mirror/commit/45d53c410b089d58d758c1bc7c9b3bb3c7a4d6b9)**",
    "created_at": "2017-03-13T17:20:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-334823",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`839c5f2`](https://github.com/sagemath/sagetrac-mirror/commit/839c5f23b9831f219ab35ba9a82652cfe6e5469b)** to **[`45d53c4`](https://github.com/sagemath/sagetrac-mirror/commit/45d53c410b089d58d758c1bc7c9b3bb3c7a4d6b9)**



---

archive/issue_comments_334824.json:
```json
{
    "body": "<div id=\"comment:8\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/45d53c410b089d58d758c1bc7c9b3bb3c7a4d6b9\"><code>45d53c4</code></a></td><td><code>Quickfix for the second bug in new code</code></td></tr></table>\n",
    "created_at": "2017-03-13T17:20:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-334824",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:8"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/45d53c410b089d58d758c1bc7c9b3bb3c7a4d6b9"><code>45d53c4</code></a></td><td><code>Quickfix for the second bug in new code</code></td></tr></table>




---

archive/issue_comments_334825.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nYes, the new code is to blame for the phenomenon that the innocent \"sagetex.rst\" disappears! Hope that the two quickfixes work.",
    "created_at": "2017-03-13T17:23:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-334825",
    "user": "https://github.com/kwankyu"
}
```

<div id="comment:9" align="right">comment:9</div>

Yes, the new code is to blame for the phenomenon that the innocent "sagetex.rst" disappears! Hope that the two quickfixes work.



---

archive/issue_comments_334826.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nNow the code with the quickfixes works fine for me. How about you?\n\nI will try to answer your questions as far as I understand the old and the new code :-) First I describe the use of cache in the old code:\n\nThe cache stores the list of the modules for which rst files were auto-generated in the previous run of the doc builder. In a new run, the list of the modules for which rst files should be auto-generated is computed and compared with the list in the cache. The rst files of newly added modules are auto-generated. Then the cache is updated.  \n\nIn the new code:\n\nIn a new run, the list of the modules for which rst files should be auto-generated is computed, and the modules are put into \"new\", \"updated\", \"removed\", \"old\" bins, comparing with the list of rst files which were auto-generated in the previous run of the doc builder (this formation is in the Sphinx environment). For modules in \"new\" and \"updated\" bins, new rst files are auto-generated. The modules in \"removed\" are removed. The modules in \"old\"  are just kept.\n\nReplying to [@hivert](#comment:3):\n> Usually caching is here for performance reason. Did you test that there isn't a huge speed loss ?\n\nThe merit of caching here is that supposedly we do not need to look into the \"sage/...\" folder to get the list of modules for which rst files were auto-generated. The new code gets the information from the Sphinx environment (`.all_docs`). There is no loss in speed.\n\n> Can you explain a little in the description of this patch how your new robust logic works ?\n\nThe information about the files in \"sage/...\" from the Sphinx environment is *independent* from git branch changing, unlike the cache. The dependence of the cache on git branch was the cause of the failures. \n\n> Finally, from a first glance, It seems that you don't handle the 'underscore' option anymore, do you?\n\nThe (new/old) code is not responsible for handling the 'underscore' option. Is it?\n\nThanks for asking.",
    "created_at": "2017-03-13T19:14:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-334826",
    "user": "https://github.com/kwankyu"
}
```

<div id="comment:10" align="right">comment:10</div>

Now the code with the quickfixes works fine for me. How about you?

I will try to answer your questions as far as I understand the old and the new code :-) First I describe the use of cache in the old code:

The cache stores the list of the modules for which rst files were auto-generated in the previous run of the doc builder. In a new run, the list of the modules for which rst files should be auto-generated is computed and compared with the list in the cache. The rst files of newly added modules are auto-generated. Then the cache is updated.  

In the new code:

In a new run, the list of the modules for which rst files should be auto-generated is computed, and the modules are put into "new", "updated", "removed", "old" bins, comparing with the list of rst files which were auto-generated in the previous run of the doc builder (this formation is in the Sphinx environment). For modules in "new" and "updated" bins, new rst files are auto-generated. The modules in "removed" are removed. The modules in "old"  are just kept.

Replying to [@hivert](#comment:3):
> Usually caching is here for performance reason. Did you test that there isn't a huge speed loss ?

The merit of caching here is that supposedly we do not need to look into the "sage/..." folder to get the list of modules for which rst files were auto-generated. The new code gets the information from the Sphinx environment (`.all_docs`). There is no loss in speed.

> Can you explain a little in the description of this patch how your new robust logic works ?

The information about the files in "sage/..." from the Sphinx environment is *independent* from git branch changing, unlike the cache. The dependence of the cache on git branch was the cause of the failures. 

> Finally, from a first glance, It seems that you don't handle the 'underscore' option anymore, do you?

The (new/old) code is not responsible for handling the 'underscore' option. Is it?

Thanks for asking.



---

archive/issue_comments_334827.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nReplying to [@kwankyu](#comment:10):\n> Now the code with the quickfixes works fine for me. How about you?\n> \n> I will try to answer your questions as far as I understand the old and the new code :-) First I describe the use of cache in the old code:\n\nThanks for clarifying all of these\n\n> The (new/old) code is not responsible for handling the 'underscore' option. Is it?\n\nI'm pretty sure the old code is:\n\n```\nif (inherit_prev is None or inherit_prev != options.inherited or\n            underscore_prev is None or underscore_prev != options.underscore):\n```\nThey are two options that force us to regenerate all the stub:\n\n- `inherit` -- whether we show inherited funs and attrs in the doc\n- `underscore` -- whether we show private (starting with __) funs and attrs\n\nIf any of those two option are changed, then every stub must be regenerated, because these option are included in the stub file as in\n\n```\n.. automodule:: sage.sets.integer_range\n   :members:\n   :undoc-members:\n   :show-inheritance:\n```\nThis needs to be taken care of in your logic.",
    "created_at": "2017-03-14T12:47:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-334827",
    "user": "https://github.com/hivert"
}
```

<div id="comment:11" align="right">comment:11</div>

Replying to [@kwankyu](#comment:10):
> Now the code with the quickfixes works fine for me. How about you?
> 
> I will try to answer your questions as far as I understand the old and the new code :-) First I describe the use of cache in the old code:

Thanks for clarifying all of these

> The (new/old) code is not responsible for handling the 'underscore' option. Is it?

I'm pretty sure the old code is:

```
if (inherit_prev is None or inherit_prev != options.inherited or
            underscore_prev is None or underscore_prev != options.underscore):
```
They are two options that force us to regenerate all the stub:

- `inherit` -- whether we show inherited funs and attrs in the doc
- `underscore` -- whether we show private (starting with __) funs and attrs

If any of those two option are changed, then every stub must be regenerated, because these option are included in the stub file as in

```
.. automodule:: sage.sets.integer_range
   :members:
   :undoc-members:
   :show-inheritance:
```
This needs to be taken care of in your logic.



---

archive/issue_comments_334828.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nYou are right. It seems that putting the options back in work forces us to resurrect the cache file. Then the role of the cache file is just to keep the previous settings of the options. I think I can do this. Do you have any other idea? \n\nOne alternative approach could be to resurrect the cache file in full force as it was and make its pickle *not* git-tracted... I am not sure if this is really possible and sound... What do you think?",
    "created_at": "2017-03-14T13:35:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-334828",
    "user": "https://github.com/kwankyu"
}
```

<div id="comment:12" align="right">comment:12</div>

You are right. It seems that putting the options back in work forces us to resurrect the cache file. Then the role of the cache file is just to keep the previous settings of the options. I think I can do this. Do you have any other idea? 

One alternative approach could be to resurrect the cache file in full force as it was and make its pickle *not* git-tracted... I am not sure if this is really possible and sound... What do you think?



---

archive/issue_comments_334829.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nI somehow presumed that the pickle of the cache is git branch dependent or git-tracted, and that caused failures. It is not true: the pickle is not git-tracted! Now I think problems were that the cache lacked the modification time info (so it could not be used to detect updated module) and that the old code did not remove rst files for removed modules.\n\nI am now experimenting with the options. I resurrected the cache and use it to store the previously used options. I will push the commits after I am confirmed that it works well...",
    "created_at": "2017-03-14T20:21:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-334829",
    "user": "https://github.com/kwankyu"
}
```

<div id="comment:13" align="right">comment:13</div>

I somehow presumed that the pickle of the cache is git branch dependent or git-tracted, and that caused failures. It is not true: the pickle is not git-tracted! Now I think problems were that the cache lacked the modification time info (so it could not be used to detect updated module) and that the old code did not remove rst files for removed modules.

I am now experimenting with the options. I resurrected the cache and use it to store the previously used options. I will push the commits after I am confirmed that it works well...



---

archive/issue_comments_334830.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nWith the underscore option, it ends with an error (independent from the present patch). With the inherited option, it takes forever (understandably...). So I stopped this experiment. Anyway I can confirm that the options take effect :-)",
    "created_at": "2017-03-14T20:41:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-334830",
    "user": "https://github.com/kwankyu"
}
```

<div id="comment:14" align="right">comment:14</div>

With the underscore option, it ends with an error (independent from the present patch). With the inherited option, it takes forever (understandably...). So I stopped this experiment. Anyway I can confirm that the options take effect :-)



---

archive/issue_comments_334831.json:
```json
{
    "body": "<div id=\"comment:15\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e9d311ee22ba7730e6c03ca7169888de2891a242\"><code>e9d311e</code></a></td><td><code>Merge branch 'develop' into trac22588_sphinx</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/70b80c9c98013cb466083818bfc131cd5f51047d\"><code>70b80c9</code></a></td><td><code>Make options work again</code></td></tr></table>\n",
    "created_at": "2017-03-14T21:20:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-334831",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:15"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e9d311ee22ba7730e6c03ca7169888de2891a242"><code>e9d311e</code></a></td><td><code>Merge branch 'develop' into trac22588_sphinx</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/70b80c9c98013cb466083818bfc131cd5f51047d"><code>70b80c9</code></a></td><td><code>Make options work again</code></td></tr></table>




---

archive/issue_comments_334832.json:
```json
{
    "body": "Changed commit from **[`45d53c4`](https://github.com/sagemath/sagetrac-mirror/commit/45d53c410b089d58d758c1bc7c9b3bb3c7a4d6b9)** to **[`70b80c9`](https://github.com/sagemath/sagetrac-mirror/commit/70b80c9c98013cb466083818bfc131cd5f51047d)**",
    "created_at": "2017-03-14T21:20:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-334832",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`45d53c4`](https://github.com/sagemath/sagetrac-mirror/commit/45d53c410b089d58d758c1bc7c9b3bb3c7a4d6b9)** to **[`70b80c9`](https://github.com/sagemath/sagetrac-mirror/commit/70b80c9c98013cb466083818bfc131cd5f51047d)**



---

archive/issue_comments_334833.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nThis is extremely minor, but as far as I can tell, the preferred capitalization is \"reST\", not \"ReST\". The official documentation only uses \"reStructuredText\", not the abbreviation, but the lowercase \"r\" suggests \"reST\", and that's what others use (see http://www.sphinx-doc.org/en/stable/rest.html, for example).",
    "created_at": "2017-03-14T21:34:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-334833",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:16" align="right">comment:16</div>

This is extremely minor, but as far as I can tell, the preferred capitalization is "reST", not "ReST". The official documentation only uses "reStructuredText", not the abbreviation, but the lowercase "r" suggests "reST", and that's what others use (see http://www.sphinx-doc.org/en/stable/rest.html, for example).



---

archive/issue_comments_334834.json:
```json
{
    "body": "<div id=\"comment:17\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0adc50e2b26b40d68c53b8cb8878c684bbc917db\"><code>0adc50e</code></a></td><td><code>Correct ReST to reST</code></td></tr></table>\n",
    "created_at": "2017-03-15T01:54:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-334834",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:17"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0adc50e2b26b40d68c53b8cb8878c684bbc917db"><code>0adc50e</code></a></td><td><code>Correct ReST to reST</code></td></tr></table>




---

archive/issue_comments_334835.json:
```json
{
    "body": "Changed commit from **[`70b80c9`](https://github.com/sagemath/sagetrac-mirror/commit/70b80c9c98013cb466083818bfc131cd5f51047d)** to **[`0adc50e`](https://github.com/sagemath/sagetrac-mirror/commit/0adc50e2b26b40d68c53b8cb8878c684bbc917db)**",
    "created_at": "2017-03-15T01:54:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-334835",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`70b80c9`](https://github.com/sagemath/sagetrac-mirror/commit/70b80c9c98013cb466083818bfc131cd5f51047d)** to **[`0adc50e`](https://github.com/sagemath/sagetrac-mirror/commit/0adc50e2b26b40d68c53b8cb8878c684bbc917db)**



---

archive/issue_events_317082.json:
```json
{
    "actor": "https://github.com/kwankyu",
    "created_at": "2017-03-15T08:46:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22588#event-317082"
}
```



---

archive/issue_events_317083.json:
```json
{
    "actor": "https://github.com/kwankyu",
    "created_at": "2017-03-15T08:46:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20documentation",
    "label_color": "0075ca",
    "label_name": "c: documentation",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22588#event-317083"
}
```



---

archive/issue_events_317084.json:
```json
{
    "actor": "https://github.com/kwankyu",
    "created_at": "2017-03-15T08:46:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20build",
    "label_color": "000080",
    "label_name": "c: build",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22588#event-317084"
}
```



---

archive/issue_comments_334836.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-If we change git branches, make (doc) often fails. It turns out that the caching mechanism in sage doc builder is unreliable and is the root cause of these failures. The patch removes the caching mechanism and implements a more robust logic to auto-update module docs.  \n+If we change git branches, \"make (doc)\" often fails. It turns out that the cache mechanism in sage doc builder caused these failures. The patch implements a robust logic to auto-update module docs using the information from the Sphinx environment rather than from the cache.\n``````\n",
    "created_at": "2017-03-15T09:00:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-334836",
    "user": "https://github.com/kwankyu"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-If we change git branches, make (doc) often fails. It turns out that the caching mechanism in sage doc builder is unreliable and is the root cause of these failures. The patch removes the caching mechanism and implements a more robust logic to auto-update module docs.  
+If we change git branches, "make (doc)" often fails. It turns out that the cache mechanism in sage doc builder caused these failures. The patch implements a robust logic to auto-update module docs using the information from the Sphinx environment rather than from the cache.
``````




---

archive/issue_events_317085.json:
```json
{
    "actor": "https://github.com/kwankyu",
    "created_at": "2017-03-15T09:00:37Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "title_is": "Let \"make (doc)\" really always work",
    "title_was": "Let make (doc) really always work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22588#event-317085"
}
```



---

archive/issue_events_317086.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-03-15T09:08:08Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "title_is": "Let \"make doc\" really always work",
    "title_was": "Let \"make (doc)\" really always work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22588#event-317086"
}
```



---

archive/issue_comments_334837.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-If we change git branches, \"make (doc)\" often fails. It turns out that the cache mechanism in sage doc builder caused these failures. The patch implements a robust logic to auto-update module docs using the information from the Sphinx environment rather than from the cache.\n+If we change git branches, `make doc` often fails. It turns out that the cache mechanism in sage doc builder caused these failures. The patch implements a robust logic to auto-update module docs using the information from the Sphinx environment rather than from the cache.\n``````\n",
    "created_at": "2017-03-15T09:08:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-334837",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-If we change git branches, "make (doc)" often fails. It turns out that the cache mechanism in sage doc builder caused these failures. The patch implements a robust logic to auto-update module docs using the information from the Sphinx environment rather than from the cache.
+If we change git branches, `make doc` often fails. It turns out that the cache mechanism in sage doc builder caused these failures. The patch implements a robust logic to auto-update module docs using the information from the Sphinx environment rather than from the cache.
``````




---

archive/issue_comments_334838.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nOne annoying problem I noticed is that we now have these warning as a side effect of `__import__(module)`: \n\n```\n[dochtml] /Users/Kwankyu/GitHub/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py:909: DeprecationWarning: the module sage.rings.commutative_ring is deprecated and will be removed\n[dochtml] See http://trac.sagemath.org/20011 for details.\n[dochtml]   __import__(module)\n```\n\nCould we just ignore these or can you provide how to fix this?\n\nAs I understand, the Sphinx autodoc extension also import a module to do its work. So importing a module is not a problem. Sphinx seems not to spit out the warning messages...",
    "created_at": "2017-03-15T09:43:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-334838",
    "user": "https://github.com/kwankyu"
}
```

<div id="comment:21" align="right">comment:21</div>

One annoying problem I noticed is that we now have these warning as a side effect of `__import__(module)`: 

```
[dochtml] /Users/Kwankyu/GitHub/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py:909: DeprecationWarning: the module sage.rings.commutative_ring is deprecated and will be removed
[dochtml] See http://trac.sagemath.org/20011 for details.
[dochtml]   __import__(module)
```

Could we just ignore these or can you provide how to fix this?

As I understand, the Sphinx autodoc extension also import a module to do its work. So importing a module is not a problem. Sphinx seems not to spit out the warning messages...



---

archive/issue_comments_334839.json:
```json
{
    "body": "Changed commit from **[`0adc50e`](https://github.com/sagemath/sagetrac-mirror/commit/0adc50e2b26b40d68c53b8cb8878c684bbc917db)** to **[`15e9ec0`](https://github.com/sagemath/sagetrac-mirror/commit/15e9ec01ac175b589e6bdb52629ce6bbf797269b)**",
    "created_at": "2017-03-15T10:27:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-334839",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`0adc50e`](https://github.com/sagemath/sagetrac-mirror/commit/0adc50e2b26b40d68c53b8cb8878c684bbc917db)** to **[`15e9ec0`](https://github.com/sagemath/sagetrac-mirror/commit/15e9ec01ac175b589e6bdb52629ce6bbf797269b)**



---

archive/issue_comments_334840.json:
```json
{
    "body": "<div id=\"comment:22\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8fd3b684c270b941e87246c3174953d8d95fddb7\"><code>8fd3b68</code></a></td><td><code>Minor fixes in docstrings</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/15e9ec01ac175b589e6bdb52629ce6bbf797269b\"><code>15e9ec0</code></a></td><td><code>Suppress deprecation warnings</code></td></tr></table>\n",
    "created_at": "2017-03-15T10:27:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-334840",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:22"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8fd3b684c270b941e87246c3174953d8d95fddb7"><code>8fd3b68</code></a></td><td><code>Minor fixes in docstrings</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/15e9ec01ac175b589e6bdb52629ce6bbf797269b"><code>15e9ec0</code></a></td><td><code>Suppress deprecation warnings</code></td></tr></table>




---

archive/issue_comments_334841.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nI decided to suppress the deprecation warnings. It works well.",
    "created_at": "2017-03-15T10:33:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-334841",
    "user": "https://github.com/kwankyu"
}
```

<div id="comment:23" align="right">comment:23</div>

I decided to suppress the deprecation warnings. It works well.



---

archive/issue_comments_334842.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nI'm not sure it's a good idea to suppress deprecation warnings. The underlying issues should be fixed, instead. (There are deprecation warnings already. Does your branch create new ones?)",
    "created_at": "2017-03-15T21:03:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-334842",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:24" align="right">comment:24</div>

I'm not sure it's a good idea to suppress deprecation warnings. The underlying issues should be fixed, instead. (There are deprecation warnings already. Does your branch create new ones?)



---

archive/issue_events_317087.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-03-15T22:30:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22588#event-317087"
}
```



---

archive/issue_events_317088.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-03-15T22:30:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22588#event-317088"
}
```



---

archive/issue_comments_334843.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nPlease do not make useless changes like\n\n```diff\n def format_annotation(annotation):\n-    \"\"\"Return formatted representation of a type annotation.\n+    \"\"\"\n+    Return formatted representation of a type annotation.\n```\n\nThat will only introduce merge conflicts.",
    "created_at": "2017-03-15T22:30:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-334843",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:25" align="right">comment:25</div>

Please do not make useless changes like

```diff
 def format_annotation(annotation):
-    """Return formatted representation of a type annotation.
+    """
+    Return formatted representation of a type annotation.
```

That will only introduce merge conflicts.



---

archive/issue_comments_334844.json:
```json
{
    "body": "Changed commit from **[`15e9ec0`](https://github.com/sagemath/sagetrac-mirror/commit/15e9ec01ac175b589e6bdb52629ce6bbf797269b)** to **[`1e39367`](https://github.com/sagemath/sagetrac-mirror/commit/1e39367abfd82bc4e41669a80acb8a5d3bfdce21)**",
    "created_at": "2017-03-16T00:35:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-334844",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`15e9ec0`](https://github.com/sagemath/sagetrac-mirror/commit/15e9ec01ac175b589e6bdb52629ce6bbf797269b)** to **[`1e39367`](https://github.com/sagemath/sagetrac-mirror/commit/1e39367abfd82bc4e41669a80acb8a5d3bfdce21)**



---

archive/issue_comments_334845.json:
```json
{
    "body": "<div id=\"comment:26\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bbc8e0d6f461f753c224d808898d2ca2afaa7cd1\"><code>bbc8e0d</code></a></td><td><code>Revert \"Minor fixes in docstrings\"</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1e39367abfd82bc4e41669a80acb8a5d3bfdce21\"><code>1e39367</code></a></td><td><code>Just one minor fix in a log statement</code></td></tr></table>\n",
    "created_at": "2017-03-16T00:35:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-334845",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:26"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bbc8e0d6f461f753c224d808898d2ca2afaa7cd1"><code>bbc8e0d</code></a></td><td><code>Revert "Minor fixes in docstrings"</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1e39367abfd82bc4e41669a80acb8a5d3bfdce21"><code>1e39367</code></a></td><td><code>Just one minor fix in a log statement</code></td></tr></table>




---

archive/issue_comments_334846.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nReplying to [@jhpalmieri](#comment:24):\n> I'm not sure it's a good idea to suppress deprecation warnings. The underlying issues should be fixed, instead. (There are deprecation warnings already. Does your branch create new ones?)\n\nYou are right. Deprecation warnings were already there. My branch did not create new ones.\n\nI think this is a good case where suppressing deprecation warnings is good and harmless. Those warnings are targeted for *users* of deprecated classes and methods. In our case, there is no real use of the deprecated. And the user who is building the reference manual would just wonder why he or she gets those warnings and has nothing to do to avoid them.",
    "created_at": "2017-03-16T01:08:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-334846",
    "user": "https://github.com/kwankyu"
}
```

<div id="comment:27" align="right">comment:27</div>

Replying to [@jhpalmieri](#comment:24):
> I'm not sure it's a good idea to suppress deprecation warnings. The underlying issues should be fixed, instead. (There are deprecation warnings already. Does your branch create new ones?)

You are right. Deprecation warnings were already there. My branch did not create new ones.

I think this is a good case where suppressing deprecation warnings is good and harmless. Those warnings are targeted for *users* of deprecated classes and methods. In our case, there is no real use of the deprecated. And the user who is building the reference manual would just wonder why he or she gets those warnings and has nothing to do to avoid them.



---

archive/issue_comments_334847.json:
```json
{
    "body": "<div id=\"comment:28\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fb9c5a814ec67b27a1fb481c5400bb3f1140e2d5\"><code>fb9c5a8</code></a></td><td><code>Change module to module_name for consistency</code></td></tr></table>\n",
    "created_at": "2017-03-16T01:16:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-334847",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:28"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fb9c5a814ec67b27a1fb481c5400bb3f1140e2d5"><code>fb9c5a8</code></a></td><td><code>Change module to module_name for consistency</code></td></tr></table>




---

archive/issue_comments_334848.json:
```json
{
    "body": "Changed commit from **[`1e39367`](https://github.com/sagemath/sagetrac-mirror/commit/1e39367abfd82bc4e41669a80acb8a5d3bfdce21)** to **[`fb9c5a8`](https://github.com/sagemath/sagetrac-mirror/commit/fb9c5a814ec67b27a1fb481c5400bb3f1140e2d5)**",
    "created_at": "2017-03-16T01:16:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-334848",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`1e39367`](https://github.com/sagemath/sagetrac-mirror/commit/1e39367abfd82bc4e41669a80acb8a5d3bfdce21)** to **[`fb9c5a8`](https://github.com/sagemath/sagetrac-mirror/commit/fb9c5a814ec67b27a1fb481c5400bb3f1140e2d5)**



---

archive/issue_events_317089.json:
```json
{
    "actor": "https://github.com/kwankyu",
    "created_at": "2017-03-16T01:19:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22588#event-317089"
}
```



---

archive/issue_events_317090.json:
```json
{
    "actor": "https://github.com/kwankyu",
    "created_at": "2017-03-16T01:19:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22588#event-317090"
}
```



---

archive/issue_comments_334849.json:
```json
{
    "body": "Changed commit from **[`fb9c5a8`](https://github.com/sagemath/sagetrac-mirror/commit/fb9c5a814ec67b27a1fb481c5400bb3f1140e2d5)** to **[`c52696e`](https://github.com/sagemath/sagetrac-mirror/commit/c52696ec0b7245d664897a687f87399dd0262ee4)**",
    "created_at": "2017-03-29T10:39:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-334849",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`fb9c5a8`](https://github.com/sagemath/sagetrac-mirror/commit/fb9c5a814ec67b27a1fb481c5400bb3f1140e2d5)** to **[`c52696e`](https://github.com/sagemath/sagetrac-mirror/commit/c52696ec0b7245d664897a687f87399dd0262ee4)**



---

archive/issue_comments_334850.json:
```json
{
    "body": "<div id=\"comment:30\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c52696ec0b7245d664897a687f87399dd0262ee4\"><code>c52696e</code></a></td><td><code>Merge branch 'sage 7.6'</code></td></tr></table>\n",
    "created_at": "2017-03-29T10:39:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-334850",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:30"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c52696ec0b7245d664897a687f87399dd0262ee4"><code>c52696e</code></a></td><td><code>Merge branch 'sage 7.6'</code></td></tr></table>




---

archive/issue_comments_334851.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nIt is a pain to see document building fail with the branch changed. This patch should be merged as soon as possible. Please review if you agree.",
    "created_at": "2017-03-29T10:44:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-334851",
    "user": "https://github.com/kwankyu"
}
```

<div id="comment:31" align="right">comment:31</div>

It is a pain to see document building fail with the branch changed. This patch should be merged as soon as possible. Please review if you agree.



---

archive/issue_comments_334852.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nFlorent, can you review this?",
    "created_at": "2017-04-04T19:14:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-334852",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:32" align="right">comment:32</div>

Florent, can you review this?



---

archive/issue_comments_334853.json:
```json
{
    "body": "Reviewer: **Florent Hivert, Erik Bray**",
    "created_at": "2017-04-05T09:18:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-334853",
    "user": "https://github.com/embray"
}
```

Reviewer: **Florent Hivert, Erik Bray**



---

archive/issue_comments_334854.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nThanks for trying to fix this--it's been a huge source of irritation for me as well.  \n\nFlorent is the expert on this code so he should have final say (but I'm not sure where he is--I haven't seen him in the office this week).  But the logic here makes sense to me.  I just have a few questions:\n\nIn the old `get_newly_included_modules(self, save=False)` method (which is now obsolete--it is not used anywhere and could be removed?) there is a `save` argument.  Your new `get_new_and_updated_modules()` method also has the `save` argument but it isn't used anywhere (nor would it be).\n\nAlso I think it's a little confusing that what is now being called the \"cache\" is just storing the options that were used in the last docbuild run, and nothing else AFAICT (since as you point out the same information can be found in the Sphinx environment).",
    "created_at": "2017-04-05T09:18:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-334854",
    "user": "https://github.com/embray"
}
```

<div id="comment:33" align="right">comment:33</div>

Thanks for trying to fix this--it's been a huge source of irritation for me as well.  

Florent is the expert on this code so he should have final say (but I'm not sure where he is--I haven't seen him in the office this week).  But the logic here makes sense to me.  I just have a few questions:

In the old `get_newly_included_modules(self, save=False)` method (which is now obsolete--it is not used anywhere and could be removed?) there is a `save` argument.  Your new `get_new_and_updated_modules()` method also has the `save` argument but it isn't used anywhere (nor would it be).

Also I think it's a little confusing that what is now being called the "cache" is just storing the options that were used in the last docbuild run, and nothing else AFAICT (since as you point out the same information can be found in the Sphinx environment).



---

archive/issue_comments_334855.json:
```json
{
    "body": "<div id=\"comment:34\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8b0f3ae1c60bb97a94cc8dd0538b2bd4db7c0703\"><code>8b0f3ae</code></a></td><td><code>Remove unused method and argument</code></td></tr></table>\n",
    "created_at": "2017-04-05T10:23:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-334855",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:34"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8b0f3ae1c60bb97a94cc8dd0538b2bd4db7c0703"><code>8b0f3ae</code></a></td><td><code>Remove unused method and argument</code></td></tr></table>




---

archive/issue_comments_334856.json:
```json
{
    "body": "Changed commit from **[`c52696e`](https://github.com/sagemath/sagetrac-mirror/commit/c52696ec0b7245d664897a687f87399dd0262ee4)** to **[`8b0f3ae`](https://github.com/sagemath/sagetrac-mirror/commit/8b0f3ae1c60bb97a94cc8dd0538b2bd4db7c0703)**",
    "created_at": "2017-04-05T10:23:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-334856",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`c52696e`](https://github.com/sagemath/sagetrac-mirror/commit/c52696ec0b7245d664897a687f87399dd0262ee4)** to **[`8b0f3ae`](https://github.com/sagemath/sagetrac-mirror/commit/8b0f3ae1c60bb97a94cc8dd0538b2bd4db7c0703)**



---

archive/issue_comments_334857.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nReplying to [@embray](#comment:33):\n> In the old `get_newly_included_modules(self, save=False)` method (which is now obsolete--it is not used anywhere and could be removed?) there is a `save` argument.  Your new `get_new_and_updated_modules()` method also has the `save` argument but it isn't used anywhere (nor would it be).\n\nI agree. Removed them just now.\n\n> Also I think it's a little confusing that what is now being called the \"cache\" is just storing the options that were used in the last docbuild run, and nothing else AFAICT (since as you point out the same information can be found in the Sphinx environment).\n\nYou are right. I wanted to get rid of the cache file. But unfortunately, as Florent noted, it turned out that we need to save the last options used somewhere, to decide whether to rebuild all modules or not given the new options. So the main role of the cache changed (and I started to call the cache \"reference cache\" -- a cache for building the reference)",
    "created_at": "2017-04-05T10:33:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-334857",
    "user": "https://github.com/kwankyu"
}
```

<div id="comment:35" align="right">comment:35</div>

Replying to [@embray](#comment:33):
> In the old `get_newly_included_modules(self, save=False)` method (which is now obsolete--it is not used anywhere and could be removed?) there is a `save` argument.  Your new `get_new_and_updated_modules()` method also has the `save` argument but it isn't used anywhere (nor would it be).

I agree. Removed them just now.

> Also I think it's a little confusing that what is now being called the "cache" is just storing the options that were used in the last docbuild run, and nothing else AFAICT (since as you point out the same information can be found in the Sphinx environment).

You are right. I wanted to get rid of the cache file. But unfortunately, as Florent noted, it turned out that we need to save the last options used somewhere, to decide whether to rebuild all modules or not given the new options. So the main role of the cache changed (and I started to call the cache "reference cache" -- a cache for building the reference)



---

archive/issue_comments_334858.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nReplying to [@embray](#comment:33):\n\n> Florent is the expert on this code so he should have final say (but I'm not sure where he is--I haven't seen him in the office this week).  But the logic here makes sense to me.  \n\nHi Embray ! I've been sick and unable to work for one week. That's why you haven't seen me. I'm currently catching up and then I'll review this ticket.",
    "created_at": "2017-04-05T19:15:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-334858",
    "user": "https://github.com/hivert"
}
```

<div id="comment:36" align="right">comment:36</div>

Replying to [@embray](#comment:33):

> Florent is the expert on this code so he should have final say (but I'm not sure where he is--I haven't seen him in the office this week).  But the logic here makes sense to me.  

Hi Embray ! I've been sick and unable to work for one week. That's why you haven't seen me. I'm currently catching up and then I'll review this ticket.



---

archive/issue_comments_334859.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nI wonder which is the case: this patch is not so useful to developers as I believe or they are too busy to spare some time for this ticket...",
    "created_at": "2017-05-11T21:52:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-334859",
    "user": "https://github.com/kwankyu"
}
```

<div id="comment:37" align="right">comment:37</div>

I wonder which is the case: this patch is not so useful to developers as I believe or they are too busy to spare some time for this ticket...



---

archive/issue_comments_334860.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nI think it's definitely useful--people are just busy.",
    "created_at": "2017-05-12T09:47:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-334860",
    "user": "https://github.com/embray"
}
```

<div id="comment:38" align="right">comment:38</div>

I think it's definitely useful--people are just busy.



---

archive/issue_comments_334861.json:
```json
{
    "body": "<div id=\"comment:39\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f9df7cf58c39e2c2b45e41237f3107c3aebab4d2\"><code>f9df7cf</code></a></td><td><code>Merge branch 'develop' into sphinx_trac22588</code></td></tr></table>\n",
    "created_at": "2017-06-04T10:52:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-334861",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:39"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f9df7cf58c39e2c2b45e41237f3107c3aebab4d2"><code>f9df7cf</code></a></td><td><code>Merge branch 'develop' into sphinx_trac22588</code></td></tr></table>




---

archive/issue_comments_334862.json:
```json
{
    "body": "Changed commit from **[`8b0f3ae`](https://github.com/sagemath/sagetrac-mirror/commit/8b0f3ae1c60bb97a94cc8dd0538b2bd4db7c0703)** to **[`f9df7cf`](https://github.com/sagemath/sagetrac-mirror/commit/f9df7cf58c39e2c2b45e41237f3107c3aebab4d2)**",
    "created_at": "2017-06-04T10:52:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-334862",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`8b0f3ae`](https://github.com/sagemath/sagetrac-mirror/commit/8b0f3ae1c60bb97a94cc8dd0538b2bd4db7c0703)** to **[`f9df7cf`](https://github.com/sagemath/sagetrac-mirror/commit/f9df7cf58c39e2c2b45e41237f3107c3aebab4d2)**



---

archive/issue_events_317091.json:
```json
{
    "actor": "https://github.com/kwankyu",
    "created_at": "2017-06-04T10:53:15Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "milestone_number": null,
    "milestone_title": "sage-7.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22588#event-317091"
}
```



---

archive/issue_events_317092.json:
```json
{
    "actor": "https://github.com/kwankyu",
    "created_at": "2017-06-04T10:53:15Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "milestone_number": null,
    "milestone_title": "sage-8.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22588#event-317092"
}
```



---

archive/issue_comments_334863.json:
```json
{
    "body": "<div id=\"comment:41\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8227d6bf837095bf4299197d0def98a97e77937d\"><code>8227d6b</code></a></td><td><code>Merge branch 'develop' into sphinx_trac22588</code></td></tr></table>\n",
    "created_at": "2017-06-11T21:27:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-334863",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:41"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8227d6bf837095bf4299197d0def98a97e77937d"><code>8227d6b</code></a></td><td><code>Merge branch 'develop' into sphinx_trac22588</code></td></tr></table>




---

archive/issue_comments_334864.json:
```json
{
    "body": "Changed commit from **[`f9df7cf`](https://github.com/sagemath/sagetrac-mirror/commit/f9df7cf58c39e2c2b45e41237f3107c3aebab4d2)** to **[`8227d6b`](https://github.com/sagemath/sagetrac-mirror/commit/8227d6bf837095bf4299197d0def98a97e77937d)**",
    "created_at": "2017-06-11T21:27:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-334864",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`f9df7cf`](https://github.com/sagemath/sagetrac-mirror/commit/f9df7cf58c39e2c2b45e41237f3107c3aebab4d2)** to **[`8227d6b`](https://github.com/sagemath/sagetrac-mirror/commit/8227d6bf837095bf4299197d0def98a97e77937d)**



---

archive/issue_comments_334865.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nFlorent, I beg your review.",
    "created_at": "2017-06-11T21:30:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-334865",
    "user": "https://github.com/kwankyu"
}
```

<div id="comment:42" align="right">comment:42</div>

Florent, I beg your review.



---

archive/issue_comments_334866.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nI'm not quite competent to review this but it would be really useful ... ping!",
    "created_at": "2017-07-05T15:26:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-334866",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:43" align="right">comment:43</div>

I'm not quite competent to review this but it would be really useful ... ping!



---

archive/issue_comments_334867.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\nReplying to [@kcrisman](#comment:43):\n> I'm not quite competent to review this but it would be really useful ... ping!\n\nYes! I repeatedly rely on this patch when I work with my branch, since without it \"make\" often fails while building docs. I just wonder how other developers live with the limped doc builder. I hoped this had been merged to Sage 8.0...",
    "created_at": "2017-07-05T15:41:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-334867",
    "user": "https://github.com/kwankyu"
}
```

<div id="comment:44" align="right">comment:44</div>

Replying to [@kcrisman](#comment:43):
> I'm not quite competent to review this but it would be really useful ... ping!

Yes! I repeatedly rely on this patch when I work with my branch, since without it "make" often fails while building docs. I just wonder how other developers live with the limped doc builder. I hoped this had been merged to Sage 8.0...



---

archive/issue_comments_334868.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\nI wonder if it would also enable speeding up patchbot builds, if we don't have to do a full `make doc-clean` on every build...",
    "created_at": "2017-07-05T16:18:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-334868",
    "user": "https://github.com/embray"
}
```

<div id="comment:45" align="right">comment:45</div>

I wonder if it would also enable speeding up patchbot builds, if we don't have to do a full `make doc-clean` on every build...



---

archive/issue_comments_334869.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">comment:46</div>\n\nReplying to [@embray](#comment:45):\n> I wonder if it would also enable speeding up patchbot builds, if we don't have to do a full `make doc-clean` on every build...\n\nIn theory, yes.  If we are 100% sure that the doc builder is totally reliable and robust against changing branches after this ticket is merged, then we may make it an option to do `make doc-clean` in the patchbot.\n\nOn the other hand, I once observed that some hyperlinks don't work properly in the docs built without `make doc-clean`.",
    "created_at": "2017-07-05T16:54:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-334869",
    "user": "https://github.com/kwankyu"
}
```

<div id="comment:46" align="right">comment:46</div>

Replying to [@embray](#comment:45):
> I wonder if it would also enable speeding up patchbot builds, if we don't have to do a full `make doc-clean` on every build...

In theory, yes.  If we are 100% sure that the doc builder is totally reliable and robust against changing branches after this ticket is merged, then we may make it an option to do `make doc-clean` in the patchbot.

On the other hand, I once observed that some hyperlinks don't work properly in the docs built without `make doc-clean`.



---

archive/issue_comments_334870.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">comment:47</div>\n\nI think, for the patchbot's purposes, it's fine if the docs don't build 100% correctly as long as they *can* be built without errors from Sphinx, or problems that impact the doctests.\n\nIf nothing else, once this (or a fix like it) is merged it would be worth updating the patchbot to make the doc-clean an option, as you suggest, and experiment with running without it for a while.",
    "created_at": "2017-07-06T08:45:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-334870",
    "user": "https://github.com/embray"
}
```

<div id="comment:47" align="right">comment:47</div>

I think, for the patchbot's purposes, it's fine if the docs don't build 100% correctly as long as they *can* be built without errors from Sphinx, or problems that impact the doctests.

If nothing else, once this (or a fix like it) is merged it would be worth updating the patchbot to make the doc-clean an option, as you suggest, and experiment with running without it for a while.



---

archive/issue_comments_334871.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">comment:48</div>\n\nI would like to give this a positive review, but here is an issue: I tested this by deleting a file \u2013\u00a0I happened to choose `homology/koszul_complex.py`, along with its link in the reference manual. When I rebuilt the docs with the `develop` branch, it crashed because of the missing file, but with this branch, the docs built. That's great. What's not as great is that with this branch, the other pages in the `homology` part of the reference manual were not changed to reflect the missing page, so for example, `cell_complex.html` was not rewritten and so still has the line\n\n```\n    <link rel=\"next\" title=\"Koszul Complexes\" href=\"koszul_complex.html\" />\n```\n(This means that at the top of that page, it says \"Next page: Koszul complexes\".) Fortunately (?), the page `koszul_complex.html` was not deleted, so the link still works.\n\nNote also that there are still references to `koszul_complex.html` in the search indices.\n\nThe problem with docbuilding before this branch is that the auto-generated `koszul_complex.rst` would remain, while this branch does a good job of cleaning it up. What about these other references to `koszul_complex.html`? Deal with here or on another ticket, or ignore altogether?",
    "created_at": "2017-08-04T17:05:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-334871",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:48" align="right">comment:48</div>

I would like to give this a positive review, but here is an issue: I tested this by deleting a file – I happened to choose `homology/koszul_complex.py`, along with its link in the reference manual. When I rebuilt the docs with the `develop` branch, it crashed because of the missing file, but with this branch, the docs built. That's great. What's not as great is that with this branch, the other pages in the `homology` part of the reference manual were not changed to reflect the missing page, so for example, `cell_complex.html` was not rewritten and so still has the line

```
    <link rel="next" title="Koszul Complexes" href="koszul_complex.html" />
```
(This means that at the top of that page, it says "Next page: Koszul complexes".) Fortunately (?), the page `koszul_complex.html` was not deleted, so the link still works.

Note also that there are still references to `koszul_complex.html` in the search indices.

The problem with docbuilding before this branch is that the auto-generated `koszul_complex.rst` would remain, while this branch does a good job of cleaning it up. What about these other references to `koszul_complex.html`? Deal with here or on another ticket, or ignore altogether?



---

archive/issue_comments_334872.json:
```json
{
    "body": "<div id=\"comment:49\" align=\"right\">comment:49</div>\n\nA similar problem happens when you add a file: suppose you are adding a file \"B.py\" whose html file is supposed to go between \"A.html\" and \"C.html\" (that is, in \"A.html\", the next topic should point to \"B.html\"). If the docs have already been built, with A.html pointing to C.html, then you add B.html, the links in A.html and C.html will not change: they will point to each other as previous and next topics.\n\nWith the \"develop\" branch, docbuilding fails completely so you have to delete the built docs, so you never see this problem. With the branch from this ticket, you see it. Essentially the same question as in my previous comment: is the rest of this enough of an improvement that we can put off this problem to another ticket?",
    "created_at": "2017-08-04T18:10:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-334872",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:49" align="right">comment:49</div>

A similar problem happens when you add a file: suppose you are adding a file "B.py" whose html file is supposed to go between "A.html" and "C.html" (that is, in "A.html", the next topic should point to "B.html"). If the docs have already been built, with A.html pointing to C.html, then you add B.html, the links in A.html and C.html will not change: they will point to each other as previous and next topics.

With the "develop" branch, docbuilding fails completely so you have to delete the built docs, so you never see this problem. With the branch from this ticket, you see it. Essentially the same question as in my previous comment: is the rest of this enough of an improvement that we can put off this problem to another ticket?



---

archive/issue_comments_334873.json:
```json
{
    "body": "<div id=\"comment:50\" align=\"right\">comment:50</div>\n\nReplying to [@jhpalmieri](#comment:48):\n> The problem with docbuilding before this branch is that the auto-generated `koszul_complex.rst` would remain, while this branch does a good job of cleaning it up. What about these other references to `koszul_complex.html`? Deal with here or on another ticket, or ignore altogether?\n\nThis branch is about auto-generating .rst files correctly. So the problem of wrong cross-references could be dealt with separately in another ticket.\n\nThe problem of wrong cross-references seems related with how intersphinx extension works. I guess that the intersphinx inventory files should be updated somehow when the auto-generated .rst files are updated. I am not Sphinx expert though, and it would take me some time to figure out what is wrong and to find a proper fix.",
    "created_at": "2017-08-05T14:22:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-334873",
    "user": "https://github.com/kwankyu"
}
```

<div id="comment:50" align="right">comment:50</div>

Replying to [@jhpalmieri](#comment:48):
> The problem with docbuilding before this branch is that the auto-generated `koszul_complex.rst` would remain, while this branch does a good job of cleaning it up. What about these other references to `koszul_complex.html`? Deal with here or on another ticket, or ignore altogether?

This branch is about auto-generating .rst files correctly. So the problem of wrong cross-references could be dealt with separately in another ticket.

The problem of wrong cross-references seems related with how intersphinx extension works. I guess that the intersphinx inventory files should be updated somehow when the auto-generated .rst files are updated. I am not Sphinx expert though, and it would take me some time to figure out what is wrong and to find a proper fix.



---

archive/issue_comments_334874.json:
```json
{
    "body": "<div id=\"comment:51\" align=\"right\">comment:51</div>\n\nI agree--the way I feel about this ticket is that it's not fixing every possible issue with incremental doc builds between branch changes, of which there are many.  More importantly, it's just making it so that the doc build succeeds without crashing.  It's not *generally* too important for the docs themselves to be exactly correct in this case--for perfectly correct docs they should be built from scratch.  Rather, this avoids having to rebuild the docs from scratch every time a branch is switched (this is especially nice for the patchbot).\n\nI wouldn't say this would never lead to confusion--people might want to read the development docs, especially if they're working on the docs themselves.  But this isn't a showstopper.  The current situation, however, is very annoying :)",
    "created_at": "2017-08-07T09:38:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-334874",
    "user": "https://github.com/embray"
}
```

<div id="comment:51" align="right">comment:51</div>

I agree--the way I feel about this ticket is that it's not fixing every possible issue with incremental doc builds between branch changes, of which there are many.  More importantly, it's just making it so that the doc build succeeds without crashing.  It's not *generally* too important for the docs themselves to be exactly correct in this case--for perfectly correct docs they should be built from scratch.  Rather, this avoids having to rebuild the docs from scratch every time a branch is switched (this is especially nice for the patchbot).

I wouldn't say this would never lead to confusion--people might want to read the development docs, especially if they're working on the docs themselves.  But this isn't a showstopper.  The current situation, however, is very annoying :)



---

archive/issue_comments_334875.json:
```json
{
    "body": "Changed reviewer from **Florent Hivert, Erik Bray** to **Florent Hivert, Erik Bray, John Palmieri**",
    "created_at": "2017-08-07T15:17:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-334875",
    "user": "https://github.com/jhpalmieri"
}
```

Changed reviewer from **Florent Hivert, Erik Bray** to **Florent Hivert, Erik Bray, John Palmieri**



---

archive/issue_comments_334876.json:
```json
{
    "body": "<div id=\"comment:52\" align=\"right\">comment:52</div>\n\nOkay, then let's merge this and see how it goes.",
    "created_at": "2017-08-07T15:17:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-334876",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:52" align="right">comment:52</div>

Okay, then let's merge this and see how it goes.



---

archive/issue_events_317093.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2017-08-07T15:17:03Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22588#event-317093"
}
```



---

archive/issue_events_317094.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2017-08-07T15:17:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22588#event-317094"
}
```



---

archive/issue_comments_334877.json:
```json
{
    "body": "<div id=\"comment:53\" align=\"right\">comment:53</div>\n\nHere is the ticket for the problem of wrong cross references\n\nhttps://trac.sagemath.org/ticket/23602",
    "created_at": "2017-08-09T01:34:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-334877",
    "user": "https://github.com/kwankyu"
}
```

<div id="comment:53" align="right">comment:53</div>

Here is the ticket for the problem of wrong cross references

https://trac.sagemath.org/ticket/23602



---

archive/issue_comments_334878.json:
```json
{
    "body": "Changed branch from **[u/klee/22588](https://github.com/sagemath/sagetrac-mirror/tree/u/klee/22588)** to **[`8227d6b`](https://github.com/sagemath/sagetrac-mirror/commit/8227d6bf837095bf4299197d0def98a97e77937d)**",
    "created_at": "2017-08-11T18:18:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-334878",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/klee/22588](https://github.com/sagemath/sagetrac-mirror/tree/u/klee/22588)** to **[`8227d6b`](https://github.com/sagemath/sagetrac-mirror/commit/8227d6bf837095bf4299197d0def98a97e77937d)**



---

archive/issue_events_317095.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-08-11T18:18:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22588#event-317095"
}
```



---

archive/issue_events_317096.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "527e4d33e799465a2153f9eb58b359dc486d0a74",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2017-08-11T18:18:09Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22588#event-317096"
}
```



---

archive/issue_comments_334879.json:
```json
{
    "body": "Changed commit from **[`8227d6b`](https://github.com/sagemath/sagetrac-mirror/commit/8227d6bf837095bf4299197d0def98a97e77937d)** to none",
    "created_at": "2017-08-18T18:27:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-334879",
    "user": "https://github.com/kcrisman"
}
```

Changed commit from **[`8227d6b`](https://github.com/sagemath/sagetrac-mirror/commit/8227d6bf837095bf4299197d0def98a97e77937d)** to none



---

archive/issue_comments_334880.json:
```json
{
    "body": "<div id=\"comment:55\" align=\"right\">comment:55</div>\n\nNice work!",
    "created_at": "2017-08-18T18:27:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-334880",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:55" align="right">comment:55</div>

Nice work!



---

archive/issue_comments_334881.json:
```json
{
    "body": "<div id=\"comment:56\" align=\"right\">comment:56</div>\n\nThere is an important regression: #23975",
    "created_at": "2017-10-07T14:49:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-334881",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:56" align="right">comment:56</div>

There is an important regression: #23975



---

archive/issue_comments_334882.json:
```json
{
    "body": "<div id=\"comment:57\" align=\"right\">comment:57</div>\n\nReplying to [@jdemeyer](#comment:56):\n> There is an important regression: #23975\n\nI looked at #23975. As far as I understand, an issue was raised about sage-location and fixed by a patch there. Is the regression still present? What is the regression? Is there something to be done here? Help me catch up.",
    "created_at": "2017-10-08T00:42:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22588#issuecomment-334882",
    "user": "https://github.com/kwankyu"
}
```

<div id="comment:57" align="right">comment:57</div>

Replying to [@jdemeyer](#comment:56):
> There is an important regression: #23975

I looked at #23975. As far as I understand, an issue was raised about sage-location and fixed by a patch there. Is the regression still present? What is the regression? Is there something to be done here? Help me catch up.
