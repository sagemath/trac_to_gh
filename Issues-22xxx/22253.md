# Issue 22253: Incorrect json representation for graphics

archive/issues_022016.json:
```json
{
    "body": "see https://groups.google.com/forum/#!topic/sage-devel/Wjo7NkmvCks\n\n\nThe problem lies in the file `src/sage/plot/plot3d/index_face_set.pyx`, where the json is generated. There are two problems with the generated json:\n\n1. The quote signs used in the file are `'` and not `\"` as per [Json spec](http://www.ecma-international.org/publications/files/ECMA-ST/ECMA-404.pdf).\n2. Every dictionary key is unquoted, which is incorrect. Thus, a point \n    \n        {x:0,y:0,z:0}\n        \n    should really be\n\n        {\"x\":0,\"y\":0,\"z\":0}\n        \n    as per Json spec.\n\nCC:  @novoselt @egourgoulhon\n\nBranch/Commit: fbd8b10344636dc09211356be7daaf2f1ff25f38\n\nReviewer: Paul Masson\n\nAuthor: Fr\u00e9d\u00e9ric Chapoton\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/22253\n\n",
    "closed_at": "2017-02-24T14:49:04Z",
    "created_at": "2017-01-25T10:14:08Z",
    "labels": [
        "component: graphics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.6",
    "title": "Incorrect json representation for graphics",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22253",
    "user": "https://github.com/fchapoton"
}
```
see https://groups.google.com/forum/#!topic/sage-devel/Wjo7NkmvCks


The problem lies in the file `src/sage/plot/plot3d/index_face_set.pyx`, where the json is generated. There are two problems with the generated json:

1. The quote signs used in the file are `'` and not `"` as per [Json spec](http://www.ecma-international.org/publications/files/ECMA-ST/ECMA-404.pdf).
2. Every dictionary key is unquoted, which is incorrect. Thus, a point 
    
        {x:0,y:0,z:0}
        
    should really be

        {"x":0,"y":0,"z":0}
        
    as per Json spec.

CC:  @novoselt @egourgoulhon

Branch/Commit: fbd8b10344636dc09211356be7daaf2f1ff25f38

Reviewer: Paul Masson

Author: Frédéric Chapoton

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/22253





---

archive/issue_comments_412523.json:
```json
{
    "body": "Changing commit from \"\" to \"9a7269f0aa771d5a755384d65c4eee55adb90b0d\"",
    "created_at": "2017-01-25T10:22:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22253#issuecomment-412523",
    "user": "https://github.com/fchapoton"
}
```

Changing commit from "" to "9a7269f0aa771d5a755384d65c4eee55adb90b0d"



---

archive/issue_comments_412524.json:
```json
{
    "body": "Changing branch from \"\" to \"u/chapoton/22253\"",
    "created_at": "2017-01-25T10:22:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22253#issuecomment-412524",
    "user": "https://github.com/fchapoton"
}
```

Changing branch from "" to "u/chapoton/22253"



---

archive/issue_comments_412525.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,15 @@\n see https://groups.google.com/forum/#!topic/sage-devel/Wjo7NkmvCks\n+\n+\n+The problem lies in the file `src/sage/plot/plot3d/index_face_set.pyx`, where the json is generated. There are two problems with the generated json:\n+\n+1. The quote signs used in the file are `'` and not `\"` as per [Json spec](http://www.ecma-international.org/publications/files/ECMA-ST/ECMA-404.pdf).\n+2. Every dictionary key is unquoted, which is incorrect. Thus, a point \n+    \n+        {x:0,y:0,z:0}\n+        \n+    should really be\n+\n+        {\"x\":0,\"y\":0,\"z\":0}\n+        \n+    as per Json spec.\n``````\n",
    "created_at": "2017-01-25T10:22:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22253#issuecomment-412525",
    "user": "https://github.com/fchapoton"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,15 @@
 see https://groups.google.com/forum/#!topic/sage-devel/Wjo7NkmvCks
+
+
+The problem lies in the file `src/sage/plot/plot3d/index_face_set.pyx`, where the json is generated. There are two problems with the generated json:
+
+1. The quote signs used in the file are `'` and not `"` as per [Json spec](http://www.ecma-international.org/publications/files/ECMA-ST/ECMA-404.pdf).
+2. Every dictionary key is unquoted, which is incorrect. Thus, a point 
+    
+        {x:0,y:0,z:0}
+        
+    should really be
+
+        {"x":0,"y":0,"z":0}
+        
+    as per Json spec.
``````




---

archive/issue_comments_412526.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-01-25T10:22:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22253#issuecomment-412526",
    "user": "https://github.com/fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_412527.json:
```json
{
    "body": "Changing author from \"\" to \"Fr\u00e9d\u00e9ric Chapoton\"",
    "created_at": "2017-01-25T10:22:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22253#issuecomment-412527",
    "user": "https://github.com/fchapoton"
}
```

Changing author from "" to "Frédéric Chapoton"



---

archive/issue_comments_412528.json:
```json
{
    "body": "<a id='comment:1'></a>New commits:",
    "created_at": "2017-01-25T10:22:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22253#issuecomment-412528",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:1'></a>New commits:



---

archive/issue_comments_412529.json:
```json
{
    "body": "Changing commit from \"9a7269f0aa771d5a755384d65c4eee55adb90b0d\" to \"5f7e950acf177fb89023445f6e331861fd8dcfef\"",
    "created_at": "2017-01-25T10:27:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22253#issuecomment-412529",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "9a7269f0aa771d5a755384d65c4eee55adb90b0d" to "5f7e950acf177fb89023445f6e331861fd8dcfef"



---

archive/issue_comments_412530.json:
```json
{
    "body": "<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-01-25T10:27:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22253#issuecomment-412530",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_412531.json:
```json
{
    "body": "<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-01-25T11:02:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22253#issuecomment-412531",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_412532.json:
```json
{
    "body": "Changing commit from \"5f7e950acf177fb89023445f6e331861fd8dcfef\" to \"11e4447438ab44199fc3b0d36e95416a8e4459c4\"",
    "created_at": "2017-01-25T11:02:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22253#issuecomment-412532",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "5f7e950acf177fb89023445f6e331861fd8dcfef" to "11e4447438ab44199fc3b0d36e95416a8e4459c4"



---

archive/issue_comments_412533.json:
```json
{
    "body": "<a id='comment:4'></a>Seems ok with the canvas3d viewer (in sagenb):\n\n```\nsage: u,v = var('u,v')\nsage: def cf(u,v): return sin(u+v/2)**2\nsage: P = parametric_plot3d((cos(u), sin(u)+cos(v), sin(v)),\n....: (u,0,2*pi), (v,-pi,pi), color=(cf,colormaps.PiYG), plot_points=[60,60])\nsage: P.show(viewer='canvas3d')\n```\nNeeds to be tested in other kinds of notebooks.\n\nOk also in jupyter notebook. Remains to check in cloud (not that easy).",
    "created_at": "2017-01-25T12:28:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22253#issuecomment-412533",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:4'></a>Seems ok with the canvas3d viewer (in sagenb):

```
sage: u,v = var('u,v')
sage: def cf(u,v): return sin(u+v/2)**2
sage: P = parametric_plot3d((cos(u), sin(u)+cos(v), sin(v)),
....: (u,0,2*pi), (v,-pi,pi), color=(cf,colormaps.PiYG), plot_points=[60,60])
sage: P.show(viewer='canvas3d')
```
Needs to be tested in other kinds of notebooks.

Ok also in jupyter notebook. Remains to check in cloud (not that easy).



---

archive/issue_comments_412534.json:
```json
{
    "body": "<a id='comment:5'></a>All doctests pass in sage/plot/plot3d. Works with the new native Three.js viewer.\n\nI would like to point out that this modification will bloat Three.js files without any change to the rendering, since JavaScript doesn't care whether array keys are quoted or not. Presumably that was part of the motivation for using formally incorrect JSON to begin with, so I didn't change it when writing the Three.js viewer.",
    "created_at": "2017-01-25T23:55:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22253#issuecomment-412534",
    "user": "https://github.com/paulmasson"
}
```

<a id='comment:5'></a>All doctests pass in sage/plot/plot3d. Works with the new native Three.js viewer.

I would like to point out that this modification will bloat Three.js files without any change to the rendering, since JavaScript doesn't care whether array keys are quoted or not. Presumably that was part of the motivation for using formally incorrect JSON to begin with, so I didn't change it when writing the Three.js viewer.



---

archive/issue_comments_412535.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Paul Masson\"",
    "created_at": "2017-01-25T23:55:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22253#issuecomment-412535",
    "user": "https://github.com/paulmasson"
}
```

Changing reviewer from "" to "Paul Masson"



---

archive/issue_comments_412536.json:
```json
{
    "body": "Changing commit from \"11e4447438ab44199fc3b0d36e95416a8e4459c4\" to \"d04e1b5ea463681f2f1288e600de3022381f96f6\"",
    "created_at": "2017-01-27T12:33:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22253#issuecomment-412536",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "11e4447438ab44199fc3b0d36e95416a8e4459c4" to "d04e1b5ea463681f2f1288e600de3022381f96f6"



---

archive/issue_comments_412537.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-01-27T12:33:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22253#issuecomment-412537",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_412538.json:
```json
{
    "body": "<a id='comment:7'></a>one still needs to change\n\n```\nlocal/share/sage/ext/doctest/rich_output/example.canvas3d\n```\nbut this is not under git control ?",
    "created_at": "2017-01-27T12:35:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22253#issuecomment-412538",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:7'></a>one still needs to change

```
local/share/sage/ext/doctest/rich_output/example.canvas3d
```
but this is not under git control ?



---

archive/issue_comments_412539.json:
```json
{
    "body": "<a id='comment:8'></a>Attachment [example.canvas3d](tarball://root/attachments/some-uuid/ticket22253/example.canvas3d) by @fchapoton created at 2017-01-28 10:10:03\n\nI have attached the modified example file. What now ?",
    "created_at": "2017-01-28T10:10:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22253#issuecomment-412539",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:8'></a>Attachment [example.canvas3d](tarball://root/attachments/some-uuid/ticket22253/example.canvas3d) by @fchapoton created at 2017-01-28 10:10:03

I have attached the modified example file. What now ?



---

archive/issue_comments_412540.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-02-10T20:55:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22253#issuecomment-412540",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_412541.json:
```json
{
    "body": "Changing commit from \"d04e1b5ea463681f2f1288e600de3022381f96f6\" to \"969685a368ceabef622c888ace30f2131a666bb1\"",
    "created_at": "2017-02-10T20:55:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22253#issuecomment-412541",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "d04e1b5ea463681f2f1288e600de3022381f96f6" to "969685a368ceabef622c888ace30f2131a666bb1"



---

archive/issue_comments_412542.json:
```json
{
    "body": "<a id='comment:10'></a>This should be good now, but patchbots will not have a look. Please check and review.",
    "created_at": "2017-02-13T08:15:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22253#issuecomment-412542",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:10'></a>This should be good now, but patchbots will not have a look. Please check and review.



---

archive/issue_comments_412543.json:
```json
{
    "body": "<a id='comment:11'></a>Failing doctest from most recent alterations:\n\n```\nFile \"src/sage/repl/rich_output/output_graphics3d.py\", line 159, in sage.repl.rich_output.output_graphics3d.OutputSceneCanvas3d.example\nFailed example:\n    rich_output.canvas3d\nExpected:\n    buffer containing 649 bytes\nGot:\n    buffer containing 829 bytes\n```",
    "created_at": "2017-02-16T01:09:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22253#issuecomment-412543",
    "user": "https://github.com/paulmasson"
}
```

<a id='comment:11'></a>Failing doctest from most recent alterations:

```
File "src/sage/repl/rich_output/output_graphics3d.py", line 159, in sage.repl.rich_output.output_graphics3d.OutputSceneCanvas3d.example
Failed example:
    rich_output.canvas3d
Expected:
    buffer containing 649 bytes
Got:
    buffer containing 829 bytes
```



---

archive/issue_comments_412544.json:
```json
{
    "body": "<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-02-21T12:46:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22253#issuecomment-412544",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_412545.json:
```json
{
    "body": "Changing commit from \"969685a368ceabef622c888ace30f2131a666bb1\" to \"fbd8b10344636dc09211356be7daaf2f1ff25f38\"",
    "created_at": "2017-02-21T12:46:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22253#issuecomment-412545",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "969685a368ceabef622c888ace30f2131a666bb1" to "fbd8b10344636dc09211356be7daaf2f1ff25f38"



---

archive/issue_comments_412546.json:
```json
{
    "body": "<a id='comment:13'></a>done, should be good now.",
    "created_at": "2017-02-21T12:47:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22253#issuecomment-412546",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:13'></a>done, should be good now.



---

archive/issue_comments_412547.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-02-22T00:20:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22253#issuecomment-412547",
    "user": "https://github.com/paulmasson"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_412548.json:
```json
{
    "body": "Changing branch from \"u/chapoton/22253\" to \"fbd8b10344636dc09211356be7daaf2f1ff25f38\"",
    "created_at": "2017-02-24T14:49:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22253#issuecomment-412548",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/chapoton/22253" to "fbd8b10344636dc09211356be7daaf2f1ff25f38"



---

archive/issue_events_058430.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-02-24T14:49:04Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/22253",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22253#event-58430"
}
```



---

archive/issue_comments_412549.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-02-24T14:49:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22253#issuecomment-412549",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
