# Issue 22253: Incorrect json representation for graphics

archive/issues_022016.json:
```json
{
    "body": "see https://groups.google.com/forum/#!topic/sage-devel/Wjo7NkmvCks\n\n\nThe problem lies in the file `src/sage/plot/plot3d/index_face_set.pyx`, where the json is generated. There are two problems with the generated json:\n\n1. The quote signs used in the file are `'` and not `\"` as per [Json spec](http://www.ecma-international.org/publications/files/ECMA-ST/ECMA-404.pdf).\n2. Every dictionary key is unquoted, which is incorrect. Thus, a point \n    \n        {x:0,y:0,z:0}\n        \n    should really be\n\n        {\"x\":0,\"y\":0,\"z\":0}\n        \n    as per Json spec.\n\nCC:  @novoselt @egourgoulhon\n\nReviewer: Paul Masson\n\nAuthor: Fr\u00e9d\u00e9ric Chapoton\n\nBranch: fbd8b10344636dc09211356be7daaf2f1ff25f38\n\nCommit: fbd8b10344636dc09211356be7daaf2f1ff25f38\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/22253\n\n",
    "closed_at": "2017-02-24T14:49:04Z",
    "created_at": "2017-01-25T10:14:08Z",
    "labels": [
        "component: graphics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.6",
    "title": "Incorrect json representation for graphics",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22253",
    "user": "https://github.com/fchapoton"
}
```
see https://groups.google.com/forum/#!topic/sage-devel/Wjo7NkmvCks


The problem lies in the file `src/sage/plot/plot3d/index_face_set.pyx`, where the json is generated. There are two problems with the generated json:

1. The quote signs used in the file are `'` and not `"` as per [Json spec](http://www.ecma-international.org/publications/files/ECMA-ST/ECMA-404.pdf).
2. Every dictionary key is unquoted, which is incorrect. Thus, a point 
    
        {x:0,y:0,z:0}
        
    should really be

        {"x":0,"y":0,"z":0}
        
    as per Json spec.

CC:  @novoselt @egourgoulhon

Reviewer: Paul Masson

Author: Frédéric Chapoton

Branch: fbd8b10344636dc09211356be7daaf2f1ff25f38

Commit: fbd8b10344636dc09211356be7daaf2f1ff25f38

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/22253





---

archive/issue_comments_305586.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-01-25T10:22:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22253#issuecomment-305586",
    "user": "https://github.com/fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_305587.json:
```json
{
    "body": "<a id='comment:1'></a>New commits:",
    "created_at": "2017-01-25T10:22:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22253#issuecomment-305587",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:1'></a>New commits:



---

archive/issue_comments_305588.json:
```json
{
    "body": "<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-01-25T10:27:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22253#issuecomment-305588",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_305589.json:
```json
{
    "body": "<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-01-25T11:02:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22253#issuecomment-305589",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_305590.json:
```json
{
    "body": "<a id='comment:4'></a>Seems ok with the canvas3d viewer (in sagenb):\n\n```\nsage: u,v = var('u,v')\nsage: def cf(u,v): return sin(u+v/2)**2\nsage: P = parametric_plot3d((cos(u), sin(u)+cos(v), sin(v)),\n....: (u,0,2*pi), (v,-pi,pi), color=(cf,colormaps.PiYG), plot_points=[60,60])\nsage: P.show(viewer='canvas3d')\n```\nNeeds to be tested in other kinds of notebooks.\n\nOk also in jupyter notebook. Remains to check in cloud (not that easy).",
    "created_at": "2017-01-25T12:28:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22253#issuecomment-305590",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:4'></a>Seems ok with the canvas3d viewer (in sagenb):

```
sage: u,v = var('u,v')
sage: def cf(u,v): return sin(u+v/2)**2
sage: P = parametric_plot3d((cos(u), sin(u)+cos(v), sin(v)),
....: (u,0,2*pi), (v,-pi,pi), color=(cf,colormaps.PiYG), plot_points=[60,60])
sage: P.show(viewer='canvas3d')
```
Needs to be tested in other kinds of notebooks.

Ok also in jupyter notebook. Remains to check in cloud (not that easy).



---

archive/issue_comments_305591.json:
```json
{
    "body": "<a id='comment:5'></a>All doctests pass in sage/plot/plot3d. Works with the new native Three.js viewer.\n\nI would like to point out that this modification will bloat Three.js files without any change to the rendering, since JavaScript doesn't care whether array keys are quoted or not. Presumably that was part of the motivation for using formally incorrect JSON to begin with, so I didn't change it when writing the Three.js viewer.",
    "created_at": "2017-01-25T23:55:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22253#issuecomment-305591",
    "user": "https://github.com/paulmasson"
}
```

<a id='comment:5'></a>All doctests pass in sage/plot/plot3d. Works with the new native Three.js viewer.

I would like to point out that this modification will bloat Three.js files without any change to the rendering, since JavaScript doesn't care whether array keys are quoted or not. Presumably that was part of the motivation for using formally incorrect JSON to begin with, so I didn't change it when writing the Three.js viewer.



---

archive/issue_comments_305592.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-01-27T12:33:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22253#issuecomment-305592",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_305593.json:
```json
{
    "body": "<a id='comment:7'></a>one still needs to change\n\n```\nlocal/share/sage/ext/doctest/rich_output/example.canvas3d\n```\nbut this is not under git control ?",
    "created_at": "2017-01-27T12:35:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22253#issuecomment-305593",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:7'></a>one still needs to change

```
local/share/sage/ext/doctest/rich_output/example.canvas3d
```
but this is not under git control ?



---

archive/issue_comments_305594.json:
```json
{
    "body": "<a id='comment:8'></a>Attachment [example.canvas3d](tarball://root/attachments/some-uuid/ticket22253/example.canvas3d) by @fchapoton created at 2017-01-28 10:10:03\n\nI have attached the modified example file. What now ?",
    "created_at": "2017-01-28T10:10:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22253#issuecomment-305594",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:8'></a>Attachment [example.canvas3d](tarball://root/attachments/some-uuid/ticket22253/example.canvas3d) by @fchapoton created at 2017-01-28 10:10:03

I have attached the modified example file. What now ?



---

archive/issue_comments_305595.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-02-10T20:55:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22253#issuecomment-305595",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_305596.json:
```json
{
    "body": "<a id='comment:10'></a>This should be good now, but patchbots will not have a look. Please check and review.",
    "created_at": "2017-02-13T08:15:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22253#issuecomment-305596",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:10'></a>This should be good now, but patchbots will not have a look. Please check and review.



---

archive/issue_comments_305597.json:
```json
{
    "body": "<a id='comment:11'></a>Failing doctest from most recent alterations:\n\n```\nFile \"src/sage/repl/rich_output/output_graphics3d.py\", line 159, in sage.repl.rich_output.output_graphics3d.OutputSceneCanvas3d.example\nFailed example:\n    rich_output.canvas3d\nExpected:\n    buffer containing 649 bytes\nGot:\n    buffer containing 829 bytes\n```",
    "created_at": "2017-02-16T01:09:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22253#issuecomment-305597",
    "user": "https://github.com/paulmasson"
}
```

<a id='comment:11'></a>Failing doctest from most recent alterations:

```
File "src/sage/repl/rich_output/output_graphics3d.py", line 159, in sage.repl.rich_output.output_graphics3d.OutputSceneCanvas3d.example
Failed example:
    rich_output.canvas3d
Expected:
    buffer containing 649 bytes
Got:
    buffer containing 829 bytes
```



---

archive/issue_comments_305598.json:
```json
{
    "body": "<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-02-21T12:46:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22253#issuecomment-305598",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_305599.json:
```json
{
    "body": "<a id='comment:13'></a>done, should be good now.",
    "created_at": "2017-02-21T12:47:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22253#issuecomment-305599",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:13'></a>done, should be good now.



---

archive/issue_comments_305600.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-02-22T00:20:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22253#issuecomment-305600",
    "user": "https://github.com/paulmasson"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_058430.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-02-24T14:49:04Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/22253",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22253#event-58430"
}
```



---

archive/issue_comments_305601.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-02-24T14:49:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22253#issuecomment-305601",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
