# Issue 22878: Add gmp to libraries for libs/ecl and rings/bernmm

archive/issues_022641.json:
```json
{
    "body": "Needed to build on Cygwin. Likely now needed from changes from #22728.\n\n**CC:**  @embray jpflori gouezel @jdemeyer\n\n**Branch/Commit:** [9fb2e3f2b03353f25f6e11373fca080a7af12481](https://github.com/sagemath/sagetrac-mirror/commit/9fb2e3f2b03353f25f6e11373fca080a7af12481)\n\n**Reviewer:** Erik Bray\n\n**Author:** Travis Scrimshaw\n\nIssue created by migration from https://trac.sagemath.org/ticket/22878\n\n",
    "closed_at": "2017-04-28T23:54:34Z",
    "created_at": "2017-04-26T15:36:36Z",
    "labels": [
        "component: porting: cygwin",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.0",
    "title": "Add gmp to libraries for libs/ecl and rings/bernmm",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/22878",
    "user": "https://github.com/tscrim"
}
```
Needed to build on Cygwin. Likely now needed from changes from #22728.

**CC:**  @embray jpflori gouezel @jdemeyer

**Branch/Commit:** [9fb2e3f2b03353f25f6e11373fca080a7af12481](https://github.com/sagemath/sagetrac-mirror/commit/9fb2e3f2b03353f25f6e11373fca080a7af12481)

**Reviewer:** Erik Bray

**Author:** Travis Scrimshaw

Issue created by migration from https://trac.sagemath.org/ticket/22878





---

archive/issue_comments_343763.json:
```json
{
    "body": "**Commit:** [847581286860b2f7abbcc12ba8e305f963d7f60c](https://github.com/sagemath/sagetrac-mirror/commit/847581286860b2f7abbcc12ba8e305f963d7f60c)",
    "created_at": "2017-04-26T15:40:16Z",
    "issue": "https://github.com/sagemath/sage/issues/22878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22878#issuecomment-343763",
    "user": "https://github.com/tscrim"
}
```

**Commit:** [847581286860b2f7abbcc12ba8e305f963d7f60c](https://github.com/sagemath/sagetrac-mirror/commit/847581286860b2f7abbcc12ba8e305f963d7f60c)



---

archive/issue_comments_343764.json:
```json
{
    "body": "**Branch:** [u/tscrim/linking_gmp-22878](https://github.com/sagemath/sagetrac-mirror/tree/u/tscrim/linking_gmp-22878)",
    "created_at": "2017-04-26T15:40:16Z",
    "issue": "https://github.com/sagemath/sage/issues/22878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22878#issuecomment-343764",
    "user": "https://github.com/tscrim"
}
```

**Branch:** [u/tscrim/linking_gmp-22878](https://github.com/sagemath/sagetrac-mirror/tree/u/tscrim/linking_gmp-22878)



---

archive/issue_events_203938.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-04-26T15:40:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22878",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22878#event-203938"
}
```



---

archive/issue_comments_343765.json:
```json
{
    "body": "<a id='comment:1'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/847581286860b2f7abbcc12ba8e305f963d7f60c\">8475812</a></td><td><code>Adding more links to gmp for cgwin.</code></td></tr></table>\n",
    "created_at": "2017-04-26T15:40:16Z",
    "issue": "https://github.com/sagemath/sage/issues/22878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22878#issuecomment-343765",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:1'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/847581286860b2f7abbcc12ba8e305f963d7f60c">8475812</a></td><td><code>Adding more links to gmp for cgwin.</code></td></tr></table>




---

archive/issue_comments_343766.json:
```json
{
    "body": "<a id='comment:2'></a>\nWouldn't it be better to modify the corresponding pxd files?\n\nThen we could remove the libraries lines from module.py.",
    "created_at": "2017-04-26T15:46:29Z",
    "issue": "https://github.com/sagemath/sage/issues/22878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22878#issuecomment-343766",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:2'></a>
Wouldn't it be better to modify the corresponding pxd files?

Then we could remove the libraries lines from module.py.



---

archive/issue_comments_343767.json:
```json
{
    "body": "<a id='comment:3'></a>\nDo you mean adding `# distutils: libraries = gmp` (well, with what is needed) to the .pyx files?",
    "created_at": "2017-04-26T15:53:51Z",
    "issue": "https://github.com/sagemath/sage/issues/22878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22878#issuecomment-343767",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:3'></a>
Do you mean adding `# distutils: libraries = gmp` (well, with what is needed) to the .pyx files?



---

archive/issue_comments_343768.json:
```json
{
    "body": "<a id='comment:4'></a>\nAdding:\n`# distutils: libraries = ecl gmp` to ecl.pxd.\n\nFor fes.pyx, there is no pxd file so...",
    "created_at": "2017-04-26T15:56:55Z",
    "issue": "https://github.com/sagemath/sage/issues/22878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22878#issuecomment-343768",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:4'></a>
Adding:
`# distutils: libraries = ecl gmp` to ecl.pxd.

For fes.pyx, there is no pxd file so...



---

archive/issue_comments_343769.json:
```json
{
    "body": "<a id='comment:5'></a>\nBut it should also work in the pyx file.",
    "created_at": "2017-04-26T16:10:29Z",
    "issue": "https://github.com/sagemath/sage/issues/22878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22878#issuecomment-343769",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:5'></a>
But it should also work in the pyx file.



---

archive/issue_comments_343770.json:
```json
{
    "body": "<a id='comment:6'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9fb2e3f2b03353f25f6e11373fca080a7af12481\">9fb2e3f</a></td><td><code>Move libraries to ecl.pxd.</code></td></tr></table>\n",
    "created_at": "2017-04-26T16:14:31Z",
    "issue": "https://github.com/sagemath/sage/issues/22878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22878#issuecomment-343770",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9fb2e3f2b03353f25f6e11373fca080a7af12481">9fb2e3f</a></td><td><code>Move libraries to ecl.pxd.</code></td></tr></table>




---

archive/issue_comments_343771.json:
```json
{
    "body": "**Changing commit** from \"[847581286860b2f7abbcc12ba8e305f963d7f60c](https://github.com/sagemath/sagetrac-mirror/commit/847581286860b2f7abbcc12ba8e305f963d7f60c)\" to \"[9fb2e3f2b03353f25f6e11373fca080a7af12481](https://github.com/sagemath/sagetrac-mirror/commit/9fb2e3f2b03353f25f6e11373fca080a7af12481)\".",
    "created_at": "2017-04-26T16:14:31Z",
    "issue": "https://github.com/sagemath/sage/issues/22878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22878#issuecomment-343771",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[847581286860b2f7abbcc12ba8e305f963d7f60c](https://github.com/sagemath/sagetrac-mirror/commit/847581286860b2f7abbcc12ba8e305f963d7f60c)" to "[9fb2e3f2b03353f25f6e11373fca080a7af12481](https://github.com/sagemath/sagetrac-mirror/commit/9fb2e3f2b03353f25f6e11373fca080a7af12481)".



---

archive/issue_comments_343772.json:
```json
{
    "body": "<a id='comment:7'></a>\nIt's probably better to do it in the .pxd (I had only seen it done in .pyx before).",
    "created_at": "2017-04-26T16:15:22Z",
    "issue": "https://github.com/sagemath/sage/issues/22878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22878#issuecomment-343772",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:7'></a>
It's probably better to do it in the .pxd (I had only seen it done in .pyx before).



---

archive/issue_comments_343773.json:
```json
{
    "body": "<a id='comment:8'></a>\n`@`jeroen: what do you think?",
    "created_at": "2017-04-26T16:17:14Z",
    "issue": "https://github.com/sagemath/sage/issues/22878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22878#issuecomment-343773",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:8'></a>
`@`jeroen: what do you think?



---

archive/issue_comments_343774.json:
```json
{
    "body": "<a id='comment:9'></a>\nOops, don't know why I was speaking of fes.pyx...\n\nFor bernmm, I agree that module.py is the right place to do it.\nIn fact we should definitely split back bernmm into a separate package.",
    "created_at": "2017-04-26T16:18:19Z",
    "issue": "https://github.com/sagemath/sage/issues/22878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22878#issuecomment-343774",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:9'></a>
Oops, don't know why I was speaking of fes.pyx...

For bernmm, I agree that module.py is the right place to do it.
In fact we should definitely split back bernmm into a separate package.



---

archive/issue_comments_343775.json:
```json
{
    "body": "<a id='comment:10'></a>\nNo worries; probably because it is there in the neighboring diff.",
    "created_at": "2017-04-26T16:19:06Z",
    "issue": "https://github.com/sagemath/sage/issues/22878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22878#issuecomment-343775",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:10'></a>
No worries; probably because it is there in the neighboring diff.



---

archive/issue_events_203939.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-04-26T17:44:03Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22878",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22878#event-203939"
}
```



---

archive/issue_events_203940.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-04-26T17:44:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22878",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22878#event-203940"
}
```



---

archive/issue_comments_343776.json:
```json
{
    "body": "<a id='comment:11'></a>\nI tried reverting #22728 but that didn't seem fix the problem, so I guess that wasn't it after all, at least not on its own.  Somehow this broke just between 8.0.beta2 and 8.0.beta3 and I don't know why, which is disconcerting.  \n\nBut I think this is fine as a workaround, and is not the first time I've had to do this...",
    "created_at": "2017-04-26T17:44:03Z",
    "issue": "https://github.com/sagemath/sage/issues/22878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22878#issuecomment-343776",
    "user": "https://github.com/embray"
}
```

<a id='comment:11'></a>
I tried reverting #22728 but that didn't seem fix the problem, so I guess that wasn't it after all, at least not on its own.  Somehow this broke just between 8.0.beta2 and 8.0.beta3 and I don't know why, which is disconcerting.  

But I think this is fine as a workaround, and is not the first time I've had to do this...



---

archive/issue_comments_343777.json:
```json
{
    "body": "**Reviewer:** Erik Bray",
    "created_at": "2017-04-26T17:44:03Z",
    "issue": "https://github.com/sagemath/sage/issues/22878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22878#issuecomment-343777",
    "user": "https://github.com/embray"
}
```

**Reviewer:** Erik Bray



---

archive/issue_comments_343778.json:
```json
{
    "body": "<a id='comment:12'></a>\nIt could be also be related to #22805 or #22806. *shrugs* Well, if we fix all of the symptoms, then we've likely fixed the problem...",
    "created_at": "2017-04-26T17:47:59Z",
    "issue": "https://github.com/sagemath/sage/issues/22878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22878#issuecomment-343778",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:12'></a>
It could be also be related to #22805 or #22806. *shrugs* Well, if we fix all of the symptoms, then we've likely fixed the problem...



---

archive/issue_comments_343779.json:
```json
{
    "body": "<a id='comment:13'></a>\nReplying to [jpflori](#comment%3A8):\n> `@`jeroen: what do you think?\n\n\nI think it should be added in the place which causes the dependency. For example, ECL depends on GMP, so it makes sense that every module which uses `ecl.pxd` should link against `gmp`.\n\nI would *not* add to `module_list.py`. Ideally, `module_list.py` should not exist in the first place. It's much cleaner to add the `# distutils` declarations in the Cython source file.",
    "created_at": "2017-04-26T17:50:39Z",
    "issue": "https://github.com/sagemath/sage/issues/22878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22878#issuecomment-343779",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:13'></a>
Replying to [jpflori](#comment%3A8):
> `@`jeroen: what do you think?


I think it should be added in the place which causes the dependency. For example, ECL depends on GMP, so it makes sense that every module which uses `ecl.pxd` should link against `gmp`.

I would *not* add to `module_list.py`. Ideally, `module_list.py` should not exist in the first place. It's much cleaner to add the `# distutils` declarations in the Cython source file.



---

archive/issue_comments_343780.json:
```json
{
    "body": "<a id='comment:14'></a>\nYes, it must have been #22806.  That's fine.  And yes, it used a `# distutils` declaration in this case.",
    "created_at": "2017-04-26T17:56:09Z",
    "issue": "https://github.com/sagemath/sage/issues/22878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22878#issuecomment-343780",
    "user": "https://github.com/embray"
}
```

<a id='comment:14'></a>
Yes, it must have been #22806.  That's fine.  And yes, it used a `# distutils` declaration in this case.



---

archive/issue_events_203941.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-04-28T23:54:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22878",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22878#event-203941"
}
```



---

archive/issue_events_203942.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "b399883e4901bab691ac7a4e537bb03b46d35ab2",
    "created_at": "2017-04-28T23:54:34Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/22878",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22878#event-203942"
}
```



---

archive/issue_comments_343781.json:
```json
{
    "body": "**Changing branch** from \"[u/tscrim/linking_gmp-22878](https://github.com/sagemath/sagetrac-mirror/tree/u/tscrim/linking_gmp-22878)\" to \"[9fb2e3f2b03353f25f6e11373fca080a7af12481](https://github.com/sagemath/sagetrac-mirror/commit/9fb2e3f2b03353f25f6e11373fca080a7af12481)\".",
    "created_at": "2017-04-28T23:54:34Z",
    "issue": "https://github.com/sagemath/sage/issues/22878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22878#issuecomment-343781",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/tscrim/linking_gmp-22878](https://github.com/sagemath/sagetrac-mirror/tree/u/tscrim/linking_gmp-22878)" to "[9fb2e3f2b03353f25f6e11373fca080a7af12481](https://github.com/sagemath/sagetrac-mirror/commit/9fb2e3f2b03353f25f6e11373fca080a7af12481)".
