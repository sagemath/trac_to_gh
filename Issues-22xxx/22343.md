# Issue 22343: Elliptic curve isogenies over number fields I: speed up Larsen's algorithm for reducible primes

archive/issues_022106.json:
```json
{
    "body": "This ticket is part 1 of 2.  When running Larsen's algorithm over fields of degree 5 or more, E.reducible_primes() takes for ever for at least two reasons: (1) computation of the Galois closure; (2) arithmetic over that closure.  I have an improvement which avoids working in the closure at all, using instead some polynomial utilities based on resultants.\n\nOn this ticket I will add the polynomial utilities and the improved version of the function `_supersingular_reducible_primes`.\n\nOn a second ticket I will add an implementation of a different method, due to Bilieray, for finding the reducible primes.\n\nCC:  @adeines jpflori\n\nBranch/Commit: [e32de4750929ff2829af980d8b25fe6c88972070](https://github.com/sagemath/sagetrac-mirror/commit/e32de4750929ff2829af980d8b25fe6c88972070)\n\nReviewer: Fr\u00e9d\u00e9ric Chapoton\n\nAuthor: John Cremona\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/22343\n\n",
    "closed_at": "2017-04-11T22:22:48Z",
    "created_at": "2017-02-10T14:38:15Z",
    "labels": [
        "component: elliptic curves",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.0",
    "title": "Elliptic curve isogenies over number fields I: speed up Larsen's algorithm for reducible primes",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22343",
    "user": "https://github.com/JohnCremona"
}
```
This ticket is part 1 of 2.  When running Larsen's algorithm over fields of degree 5 or more, E.reducible_primes() takes for ever for at least two reasons: (1) computation of the Galois closure; (2) arithmetic over that closure.  I have an improvement which avoids working in the closure at all, using instead some polynomial utilities based on resultants.

On this ticket I will add the polynomial utilities and the improved version of the function `_supersingular_reducible_primes`.

On a second ticket I will add an implementation of a different method, due to Bilieray, for finding the reducible primes.

CC:  @adeines jpflori

Branch/Commit: [e32de4750929ff2829af980d8b25fe6c88972070](https://github.com/sagemath/sagetrac-mirror/commit/e32de4750929ff2829af980d8b25fe6c88972070)

Reviewer: Frédéric Chapoton

Author: John Cremona

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/22343





---

archive/issue_events_066563.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/22343",
    "rename": {
        "from": "Elliptic curve isogenies over number fields I: speed up Larsen's algorithm for redicible primes",
        "to": "Elliptic curve isogenies over number fields I: speed up Larsen's algorithm for reducible primes"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22343#event-66563"
}
```



---

archive/issue_comments_416940.json:
```json
{
    "body": "<a id='comment:3'></a>\nI have a branch now testing which should be ready for review soon.  It is much faster over degree 5 and 6 fields with large Galois closure (e.g. for an S5 quintic it goes from taking hours to just fast) but is possibly slower when the Galois group is small (e.g. when the base field is already Galois).  In addition, there is a step in the original implementation which I do not understand mathematically -- in the unusual case where anauxiliary imaginary quadratic field comes into play, I can see that it is a subfield of Kgal (the Galois closure) but not of K itself.  There is only one doctest for this case, when K=Kgal (=imagainary quadratic) anyway.  If there is ever an example where the quadratic is not a subfield of K, the code will break -- this is also true of the current code though.",
    "created_at": "2017-02-22T10:20:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22343#issuecomment-416940",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:3'></a>
I have a branch now testing which should be ready for review soon.  It is much faster over degree 5 and 6 fields with large Galois closure (e.g. for an S5 quintic it goes from taking hours to just fast) but is possibly slower when the Galois group is small (e.g. when the base field is already Galois).  In addition, there is a step in the original implementation which I do not understand mathematically -- in the unusual case where anauxiliary imaginary quadratic field comes into play, I can see that it is a subfield of Kgal (the Galois closure) but not of K itself.  There is only one doctest for this case, when K=Kgal (=imagainary quadratic) anyway.  If there is ever an example where the quadratic is not a subfield of K, the code will break -- this is also true of the current code though.



---

archive/issue_comments_416941.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-02-22T13:37:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22343#issuecomment-416941",
    "user": "https://github.com/JohnCremona"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_416942.json:
```json
{
    "body": "Changing branch from \"\" to \"u/cremona/22343\"",
    "created_at": "2017-02-22T13:37:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22343#issuecomment-416942",
    "user": "https://github.com/JohnCremona"
}
```

Changing branch from "" to "u/cremona/22343"



---

archive/issue_comments_416943.json:
```json
{
    "body": "<a id='comment:4'></a>\nNew commits:\n|                                                                                                                                          |                                                                      |\n|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------|\n|[7fbcc38](https://github.com/sagemath/sagetrac-mirror/commit/7fbcc38dd109416c645e1ed0fee63758c096c208)|`added a few new polynomial utility methods including symmetric power`|\n|[bf3ac90](https://github.com/sagemath/sagetrac-mirror/commit/bf3ac90966d76545148063063040fa5b8540c04d)|`renamed power_roots() method to adams_operator()`|\n|[904e6ff](https://github.com/sagemath/sagetrac-mirror/commit/904e6ff46367761f4a968c3ccd1f301a2ed3a6ae)|`#22343 changes to _semistable_reducible_primes() for elliptic curves over number fields`|",
    "created_at": "2017-02-22T13:37:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22343#issuecomment-416943",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:4'></a>
New commits:
|                                                                                                                                          |                                                                      |
|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------|
|[7fbcc38](https://github.com/sagemath/sagetrac-mirror/commit/7fbcc38dd109416c645e1ed0fee63758c096c208)|`added a few new polynomial utility methods including symmetric power`|
|[bf3ac90](https://github.com/sagemath/sagetrac-mirror/commit/bf3ac90966d76545148063063040fa5b8540c04d)|`renamed power_roots() method to adams_operator()`|
|[904e6ff](https://github.com/sagemath/sagetrac-mirror/commit/904e6ff46367761f4a968c3ccd1f301a2ed3a6ae)|`#22343 changes to _semistable_reducible_primes() for elliptic curves over number fields`|



---

archive/issue_comments_416944.json:
```json
{
    "body": "Changing commit from \"\" to \"904e6ff46367761f4a968c3ccd1f301a2ed3a6ae\"",
    "created_at": "2017-02-22T13:37:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22343#issuecomment-416944",
    "user": "https://github.com/JohnCremona"
}
```

Changing commit from "" to "904e6ff46367761f4a968c3ccd1f301a2ed3a6ae"



---

archive/issue_comments_416945.json:
```json
{
    "body": "<a id='comment:5'></a>\nThe first two commits add some methods for univariate polynomials, not specific to elliptic curves.  The third rewrites the code in the _semistable_reducible_primes() function.  My intention is to leave the algorithm essentially unchanged while making it possible to run over fields where the Galois closure is large -- in the new version it is not necessary to compute the Galois closure at all.\n\nIf it would be helpful, I could provide a longer explanation of what I changed and why this is equivalent to the old version, but the fact that no doctests needed changing is a good sign!  I could add an example over a degree 5 field with Galois group S5, which is now possible (and quite fast).",
    "created_at": "2017-02-22T13:41:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22343#issuecomment-416945",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:5'></a>
The first two commits add some methods for univariate polynomials, not specific to elliptic curves.  The third rewrites the code in the _semistable_reducible_primes() function.  My intention is to leave the algorithm essentially unchanged while making it possible to run over fields where the Galois closure is large -- in the new version it is not necessary to compute the Galois closure at all.

If it would be helpful, I could provide a longer explanation of what I changed and why this is equivalent to the old version, but the fact that no doctests needed changing is a good sign!  I could add an example over a degree 5 field with Galois group S5, which is now possible (and quite fast).



---

archive/issue_comments_416946.json:
```json
{
    "body": "<a id='comment:6'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                          |\n|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------|\n|[533dd93](https://github.com/sagemath/sagetrac-mirror/commit/533dd93f556d70b92118c1bc04aa2e48d7922805)|`#22343 new doctest added`|",
    "created_at": "2017-02-22T13:48:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22343#issuecomment-416946",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                          |
|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------|
|[533dd93](https://github.com/sagemath/sagetrac-mirror/commit/533dd93f556d70b92118c1bc04aa2e48d7922805)|`#22343 new doctest added`|



---

archive/issue_comments_416947.json:
```json
{
    "body": "Changing commit from \"904e6ff46367761f4a968c3ccd1f301a2ed3a6ae\" to \"533dd93f556d70b92118c1bc04aa2e48d7922805\"",
    "created_at": "2017-02-22T13:48:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22343#issuecomment-416947",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "904e6ff46367761f4a968c3ccd1f301a2ed3a6ae" to "533dd93f556d70b92118c1bc04aa2e48d7922805"



---

archive/issue_comments_416948.json:
```json
{
    "body": "<a id='comment:7'></a>\nReplying to [git](#comment%3A6):\n> Branch pushed to git repo; I updated commit sha1. New commits:\n> |                                                                                                                                           |                          |\n> |-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------|\n> |[533dd93](https://github.com/sagemath/sagetrac-mirror/commit/533dd93f556d70b92118c1bc04aa2e48d7922805)|`#22343 new doctest added`|\n\n\nThe new doctest runs in <1s (using %timeit) while using Sage 7.5 it is still running after [90 minutes] 54 hours...",
    "created_at": "2017-02-22T15:16:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22343#issuecomment-416948",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:7'></a>
Replying to [git](#comment%3A6):
> Branch pushed to git repo; I updated commit sha1. New commits:
> |                                                                                                                                           |                          |
> |-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------|
> |[533dd93](https://github.com/sagemath/sagetrac-mirror/commit/533dd93f556d70b92118c1bc04aa2e48d7922805)|`#22343 new doctest added`|


The new doctest runs in <1s (using %timeit) while using Sage 7.5 it is still running after [90 minutes] 54 hours...



---

archive/issue_comments_416949.json:
```json
{
    "body": "<a id='comment:8'></a>\n\n```\n+[dochtml] [polynomia] docstring of sage.rings.polynomial.polynomial_element.Polynomial.adams_operator:1: WARNING: Inline interpreted text or phrase reference start-string without end-string.\n+[dochtml] [polynomia] docstring of sage.rings.polynomial.polynomial_element.Polynomial.compose_power:14: WARNING: Inline interpreted text or phrase reference start-string without end-string.\n+[dochtml] [polynomia] docstring of sage.rings.polynomial.polynomial_element.Polynomial.symmetric_power:1: WARNING: Inline interpreted text or phrase reference start-string without end-string.\n+[dochtml] Error building the documentation.\n```\n\nThere is a `+        TESTS:` missing a double colon.",
    "created_at": "2017-02-24T21:02:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22343#issuecomment-416949",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:8'></a>

```
+[dochtml] [polynomia] docstring of sage.rings.polynomial.polynomial_element.Polynomial.adams_operator:1: WARNING: Inline interpreted text or phrase reference start-string without end-string.
+[dochtml] [polynomia] docstring of sage.rings.polynomial.polynomial_element.Polynomial.compose_power:14: WARNING: Inline interpreted text or phrase reference start-string without end-string.
+[dochtml] [polynomia] docstring of sage.rings.polynomial.polynomial_element.Polynomial.symmetric_power:1: WARNING: Inline interpreted text or phrase reference start-string without end-string.
+[dochtml] Error building the documentation.
```

There is a `+        TESTS:` missing a double colon.



---

archive/issue_comments_416950.json:
```json
{
    "body": "Changing commit from \"533dd93f556d70b92118c1bc04aa2e48d7922805\" to \"1817af4493beeb4e7af010950dd29d9f1cce7b36\"",
    "created_at": "2017-02-26T15:16:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22343#issuecomment-416950",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "533dd93f556d70b92118c1bc04aa2e48d7922805" to "1817af4493beeb4e7af010950dd29d9f1cce7b36"



---

archive/issue_comments_416951.json:
```json
{
    "body": "<a id='comment:9'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                        |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------|\n|[1817af4](https://github.com/sagemath/sagetrac-mirror/commit/1817af4493beeb4e7af010950dd29d9f1cce7b36)|`#22343 fix syntax errors in docstrings`|",
    "created_at": "2017-02-26T15:16:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22343#issuecomment-416951",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                        |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------|
|[1817af4](https://github.com/sagemath/sagetrac-mirror/commit/1817af4493beeb4e7af010950dd29d9f1cce7b36)|`#22343 fix syntax errors in docstrings`|



---

archive/issue_comments_416952.json:
```json
{
    "body": "<a id='comment:10'></a>\nThanks, I think that is fixed now.  I wish testing docstring syntax were easier.",
    "created_at": "2017-02-26T15:17:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22343#issuecomment-416952",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:10'></a>
Thanks, I think that is fixed now.  I wish testing docstring syntax were easier.



---

archive/issue_comments_416953.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Fr\u00e9d\u00e9ric Chapoton\"",
    "created_at": "2017-04-09T07:51:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22343#issuecomment-416953",
    "user": "https://github.com/fchapoton"
}
```

Changing reviewer from "" to "Frédéric Chapoton"



---

archive/issue_comments_416954.json:
```json
{
    "body": "<a id='comment:11'></a>\nI have made a cosmetic cleanup of your code and doc. In particular, note that\n\n* one should rather avoid using $\n* TESTS:: are not displayed in the doc\n\nIf you agree with my changes, you can set to positive review\n\n---\nNew commits:\n|                                                                                                                                          |                                          |\n|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------|\n|[96b9126](https://github.com/sagemath/sagetrac-mirror/commit/96b91265a4ec653cfa43f7feb53ad3bfd45034a6)|`Merge branch 'u/cremona/22343' in 8.0.b1`|\n|[e32de47](https://github.com/sagemath/sagetrac-mirror/commit/e32de4750929ff2829af980d8b25fe6c88972070)|`trac 22343 code and doc cosmetic cleanup`|",
    "created_at": "2017-04-09T07:51:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22343#issuecomment-416954",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:11'></a>
I have made a cosmetic cleanup of your code and doc. In particular, note that

* one should rather avoid using $
* TESTS:: are not displayed in the doc

If you agree with my changes, you can set to positive review

---
New commits:
|                                                                                                                                          |                                          |
|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------|
|[96b9126](https://github.com/sagemath/sagetrac-mirror/commit/96b91265a4ec653cfa43f7feb53ad3bfd45034a6)|`Merge branch 'u/cremona/22343' in 8.0.b1`|
|[e32de47](https://github.com/sagemath/sagetrac-mirror/commit/e32de4750929ff2829af980d8b25fe6c88972070)|`trac 22343 code and doc cosmetic cleanup`|



---

archive/issue_comments_416955.json:
```json
{
    "body": "Changing branch from \"u/cremona/22343\" to \"public/22343\"",
    "created_at": "2017-04-09T07:51:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22343#issuecomment-416955",
    "user": "https://github.com/fchapoton"
}
```

Changing branch from "u/cremona/22343" to "public/22343"



---

archive/issue_comments_416956.json:
```json
{
    "body": "Changing commit from \"1817af4493beeb4e7af010950dd29d9f1cce7b36\" to \"e32de4750929ff2829af980d8b25fe6c88972070\"",
    "created_at": "2017-04-09T07:51:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22343#issuecomment-416956",
    "user": "https://github.com/fchapoton"
}
```

Changing commit from "1817af4493beeb4e7af010950dd29d9f1cce7b36" to "e32de4750929ff2829af980d8b25fe6c88972070"



---

archive/issue_events_066564.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-04-09T07:53:12Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/22343",
    "milestone": "sage-8.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22343#event-66564"
}
```



---

archive/issue_comments_416957.json:
```json
{
    "body": "<a id='comment:13'></a>\nI do agree -- thanks.",
    "created_at": "2017-04-09T11:50:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22343#issuecomment-416957",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:13'></a>
I do agree -- thanks.



---

archive/issue_comments_416958.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-04-09T11:50:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22343#issuecomment-416958",
    "user": "https://github.com/JohnCremona"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_416959.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-04-11T22:22:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22343#issuecomment-416959",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_066565.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-04-11T22:22:48Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/22343",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22343#event-66565"
}
```



---

archive/issue_comments_416960.json:
```json
{
    "body": "Changing branch from \"public/22343\" to \"e32de4750929ff2829af980d8b25fe6c88972070\"",
    "created_at": "2017-04-11T22:22:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22343#issuecomment-416960",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "public/22343" to "e32de4750929ff2829af980d8b25fe6c88972070"
