# Issue 22549: py3: change semantics of equality for real and complex interval fields

archive/issues_022312.json:
```json
{
    "assignees": [],
    "body": "The change is **required** for the transition to Python3.\n\nBefore (now), == means that both interval-numbers are exact and equal.\n\nAfter, == means that both interval numbers have the same bounds.\n\nIn both cases, equality with an exact number holds only for another exact number.\n\n\nCC:  @tscrim @jdemeyer @a-andre @dkrenn @cheuberg @behackl\n\nBranch/Commit: **[u/chapoton/22549](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/22549) @ [`fd2e363`](https://github.com/sagemath/sagetrac-mirror/commit/fd2e363687a61efd7a53279c59c2327fb8991a3e)**\n\nReviewer: **Fr\u00e9d\u00e9ric Chapoton**\n\nComponent: **python3**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/22549_\n\n",
    "closed_at": "2017-07-13T07:54:31Z",
    "created_at": "2017-03-08T10:20:56Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20python3",
        "https://github.com/sagemath/sage/labels/enhancement",
        "https://github.com/sagemath/sage/labels/wontfix"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "py3: change semantics of equality for real and complex interval fields",
    "type": "issue",
    "updated_at": "2017-07-13T07:54:31Z",
    "url": "https://github.com/sagemath/sage/issues/22549",
    "user": "https://github.com/fchapoton"
}
```
The change is **required** for the transition to Python3.

Before (now), == means that both interval-numbers are exact and equal.

After, == means that both interval numbers have the same bounds.

In both cases, equality with an exact number holds only for another exact number.


CC:  @tscrim @jdemeyer @a-andre @dkrenn @cheuberg @behackl

Branch/Commit: **[u/chapoton/22549](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/22549) @ [`fd2e363`](https://github.com/sagemath/sagetrac-mirror/commit/fd2e363687a61efd7a53279c59c2327fb8991a3e)**

Reviewer: **Frédéric Chapoton**

Component: **python3**

_Issue created by migration from https://trac.sagemath.org/ticket/22549_





---

archive/issue_events_316536.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-03-08T10:20:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/22549",
    "milestone_number": null,
    "milestone_title": "sage-7.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22549#event-316536"
}
```



---

archive/issue_events_316537.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-03-08T10:20:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22549",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20python3",
    "label_color": "000080",
    "label_name": "c: python3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22549#event-316537"
}
```



---

archive/issue_events_316538.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-03-08T10:20:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22549",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22549#event-316538"
}
```



---

archive/issue_events_316539.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-03-08T10:20:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22549",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22549#event-316539"
}
```



---

archive/issue_comments_333947.json:
```json
{
    "body": "Branch: **[u/chapoton/22549](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/22549)**",
    "created_at": "2017-03-08T10:23:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22549#issuecomment-333947",
    "user": "https://github.com/fchapoton"
}
```

Branch: **[u/chapoton/22549](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/22549)**



---

archive/issue_comments_333948.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nWork in progress. In particular doc still needs to be adapted.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c156606639fd64f3ec26a131a0700e6b5a7758a5\"><code>c156606</code></a></td><td><code>change slighty semantics of equality in real mpfi</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6d2bf26b18212f171be543703f78a7215f55b17d\"><code>6d2bf26</code></a></td><td><code>cmp in real mpfi : doctests</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6a919fa0cb113b648fd79001cd4ef1afbf30a40b\"><code>6a919fa</code></a></td><td><code>py3 : removal of cmp() in real_lazy</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7f5c49a768aef4407032946687e5b3ebd3eca3a5\"><code>7f5c49a</code></a></td><td><code>Merge branch 'u/chapoton/22257' in real_mpfi branch</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fd2e363687a61efd7a53279c59c2327fb8991a3e\"><code>fd2e363</code></a></td><td><code>py3: change semantics of equality for real and cplx interval fields</code></td></tr></table>\n",
    "created_at": "2017-03-08T10:23:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22549#issuecomment-333948",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:1" align="right">comment:1</div>

Work in progress. In particular doc still needs to be adapted.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c156606639fd64f3ec26a131a0700e6b5a7758a5"><code>c156606</code></a></td><td><code>change slighty semantics of equality in real mpfi</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6d2bf26b18212f171be543703f78a7215f55b17d"><code>6d2bf26</code></a></td><td><code>cmp in real mpfi : doctests</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6a919fa0cb113b648fd79001cd4ef1afbf30a40b"><code>6a919fa</code></a></td><td><code>py3 : removal of cmp() in real_lazy</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7f5c49a768aef4407032946687e5b3ebd3eca3a5"><code>7f5c49a</code></a></td><td><code>Merge branch 'u/chapoton/22257' in real_mpfi branch</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fd2e363687a61efd7a53279c59c2327fb8991a3e"><code>fd2e363</code></a></td><td><code>py3: change semantics of equality for real and cplx interval fields</code></td></tr></table>




---

archive/issue_comments_333949.json:
```json
{
    "body": "Commit: **[`fd2e363`](https://github.com/sagemath/sagetrac-mirror/commit/fd2e363687a61efd7a53279c59c2327fb8991a3e)**",
    "created_at": "2017-03-08T10:23:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22549#issuecomment-333949",
    "user": "https://github.com/fchapoton"
}
```

Commit: **[`fd2e363`](https://github.com/sagemath/sagetrac-mirror/commit/fd2e363687a61efd7a53279c59c2327fb8991a3e)**



---

archive/issue_events_316540.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-03-08T10:27:32Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/22549",
    "title_is": "py3: change semantics of equality for real and complex interval fields",
    "title_was": "py3: change semantics of equality for real an complex interval fields",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22549#event-316540"
}
```



---

archive/issue_comments_333950.json:
```json
{
    "body": "Replying to [ticket:22549 chapoton]:\n> The change is **required** for the transition to Python3.\n\nPlease elaborate.",
    "created_at": "2017-03-08T11:30:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22549#issuecomment-333950",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [ticket:22549 chapoton]:
> The change is **required** for the transition to Python3.

Please elaborate.



---

archive/issue_comments_333951.json:
```json
{
    "body": "Replying to [ticket:22549 chapoton]:\n> The change is **required** for the transition to Python3.\n> \n> Before (now), == means that both interval-numbers are exact and equal.\n> \n> After, == means that both interval numbers have the same bounds.\n> \n> In both cases, equality with an exact number holds only for another exact number.\n\nWhy the change in the behavior of == **required** when switching to Python3?",
    "created_at": "2017-03-08T11:33:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22549#issuecomment-333951",
    "user": "https://github.com/dkrenn"
}
```

Replying to [ticket:22549 chapoton]:
> The change is **required** for the transition to Python3.
> 
> Before (now), == means that both interval-numbers are exact and equal.
> 
> After, == means that both interval numbers have the same bounds.
> 
> In both cases, equality with an exact number holds only for another exact number.

Why the change in the behavior of == **required** when switching to Python3?



---

archive/issue_comments_333952.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nFor these interval-numbers, we absolutely need to get rid of the incompatible double comparison (cmp on one hand (currently lexicographic), and rich comparison (<,>,==,!=,<=,=>, currently with the semantics \"all elements are related to all elements\") on the other hand).\n\nRight now \"cmp\" is used very deeply to make sure that objects have UniqueRepresentation or can be pickled correctly. In order for all this to work, we need to relax the richcmp behaviour of equality to match the current behaviour of equality with cmp.\n\nAn illustrating problem is the following : take an interval say (0.1,0.2). Pickle it. Load it again. According to the current rich comparison, it will not be equal to itself. This breaks **many** things.\n\nIf one of you think he can get quickly an alternative easy solution, I engage him or her to try. I can tell you that I did. IMHO, the current proposal is the least invasive solution.",
    "created_at": "2017-03-08T12:40:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22549#issuecomment-333952",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:5" align="right">comment:5</div>

For these interval-numbers, we absolutely need to get rid of the incompatible double comparison (cmp on one hand (currently lexicographic), and rich comparison (<,>,==,!=,<=,=>, currently with the semantics "all elements are related to all elements") on the other hand).

Right now "cmp" is used very deeply to make sure that objects have UniqueRepresentation or can be pickled correctly. In order for all this to work, we need to relax the richcmp behaviour of equality to match the current behaviour of equality with cmp.

An illustrating problem is the following : take an interval say (0.1,0.2). Pickle it. Load it again. According to the current rich comparison, it will not be equal to itself. This breaks **many** things.

If one of you think he can get quickly an alternative easy solution, I engage him or her to try. I can tell you that I did. IMHO, the current proposal is the least invasive solution.



---

archive/issue_comments_333953.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nReplying to [@fchapoton](#comment:5):\n> For these interval-numbers, we absolutely need to get rid of the incompatible double comparison (cmp on one hand (currently lexicographic), and rich comparison (<,>,==,!=,<=,=>, currently with the semantics \"all elements are related to all elements\") on the other hand).\n\nI agree. However, I would rather keep the current rich comparison and drop the old-style `cmp`.\n\n> Right now \"cmp\" is used very deeply to make sure that objects have UniqueRepresentation\n\n`UniqueRepresentation` deals with parents. Here we are talking about elements, so I don't see the issue.\n\n> or can be pickled correctly.\n\nHow does pickling involve `cmp()`?\n\n> An illustrating problem is the following : take an interval say (0.1,0.2). Pickle it. Load it again. According to the current rich comparison, it will not be equal to itself.\n\nFeature, not a bug.\n\n> This breaks **many** things.\n\nLike what?",
    "created_at": "2017-03-08T12:46:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22549#issuecomment-333953",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:6" align="right">comment:6</div>

Replying to [@fchapoton](#comment:5):
> For these interval-numbers, we absolutely need to get rid of the incompatible double comparison (cmp on one hand (currently lexicographic), and rich comparison (<,>,==,!=,<=,=>, currently with the semantics "all elements are related to all elements") on the other hand).

I agree. However, I would rather keep the current rich comparison and drop the old-style `cmp`.

> Right now "cmp" is used very deeply to make sure that objects have UniqueRepresentation

`UniqueRepresentation` deals with parents. Here we are talking about elements, so I don't see the issue.

> or can be pickled correctly.

How does pickling involve `cmp()`?

> An illustrating problem is the following : take an interval say (0.1,0.2). Pickle it. Load it again. According to the current rich comparison, it will not be equal to itself.

Feature, not a bug.

> This breaks **many** things.

Like what?



---

archive/issue_comments_333954.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nJust look at the patchbot reports of #22257",
    "created_at": "2017-03-08T12:48:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22549#issuecomment-333954",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:7" align="right">comment:7</div>

Just look at the patchbot reports of #22257



---

archive/issue_comments_333955.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nReplying to [@fchapoton](#comment:7):\n> Just look at the patchbot reports of #22257\n\nThat just shows that #22257 should be fixed. I don't see why it would require to change the semantics of `==` on intervals.",
    "created_at": "2017-03-08T12:53:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22549#issuecomment-333955",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:8" align="right">comment:8</div>

Replying to [@fchapoton](#comment:7):
> Just look at the patchbot reports of #22257

That just shows that #22257 should be fixed. I don't see why it would require to change the semantics of `==` on intervals.



---

archive/issue_comments_333956.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\n#22257 tells you what happens if you replace current cmp behaviour by current richcmp behaviour. If you think you can repair all the breaking doctests there by doing something else, please try. I have not found any other solution.\n\nThe solution proposed here almost passes all tests. The few failing doctests are mostly expected due to the change of behaviour, and do no harm. There is one more complex failure related to composite of number fields. I would like to have the opinion of a  number theorist on this one.",
    "created_at": "2017-03-08T12:58:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22549#issuecomment-333956",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:9" align="right">comment:9</div>

#22257 tells you what happens if you replace current cmp behaviour by current richcmp behaviour. If you think you can repair all the breaking doctests there by doing something else, please try. I have not found any other solution.

The solution proposed here almost passes all tests. The few failing doctests are mostly expected due to the change of behaviour, and do no harm. There is one more complex failure related to composite of number fields. I would like to have the opinion of a  number theorist on this one.



---

archive/issue_comments_333957.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nThis is really involved in unique representation and ComparisonById, because Number Fields (which are Parent) have embeddings (which are interval-numbers) that need to compare equal to themselves for the number fields to do the same.\n\nFor some triggered failures by using the current richcmp, see precisely this report:\n\nhttps://patchbot.sagemath.org/log/22257/Ubuntu/16.04/x86_64/4.4.0-53-generic/petitbonum/2017-01-29%2003:55:48?short",
    "created_at": "2017-03-08T13:08:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22549#issuecomment-333957",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:10" align="right">comment:10</div>

This is really involved in unique representation and ComparisonById, because Number Fields (which are Parent) have embeddings (which are interval-numbers) that need to compare equal to themselves for the number fields to do the same.

For some triggered failures by using the current richcmp, see precisely this report:

https://patchbot.sagemath.org/log/22257/Ubuntu/16.04/x86_64/4.4.0-53-generic/petitbonum/2017-01-29%2003:55:48?short



---

archive/issue_comments_333958.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nReplying to [@fchapoton](#comment:9):\n> The solution proposed here almost passes all tests. The few failing doctests are mostly expected due to the change of behaviour, and do no harm. There is one more complex failure related to composite of number fields. I would like to have the opinion of a  number theorist on this one.\n\nTons of external code might be broken by this change of behaviour. Changing the semantics of `==` at this point is completely inacceptable for me.",
    "created_at": "2017-03-08T13:09:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22549#issuecomment-333958",
    "user": "https://github.com/cheuberg"
}
```

<div id="comment:11" align="right">comment:11</div>

Replying to [@fchapoton](#comment:9):
> The solution proposed here almost passes all tests. The few failing doctests are mostly expected due to the change of behaviour, and do no harm. There is one more complex failure related to composite of number fields. I would like to have the opinion of a  number theorist on this one.

Tons of external code might be broken by this change of behaviour. Changing the semantics of `==` at this point is completely inacceptable for me.



---

archive/issue_comments_333959.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nReplying to [@fchapoton](#comment:9):\n> #22257 tells you what happens if you replace current cmp behaviour by current richcmp behaviour.\n\nHere is a constructive suggestion: essentially, what `cmp()` does on intervals is comparing the endpoints. So whenever you need to replace `cmp()` for intervals by rich comparison, use rich comparison on the endpoints. For example, you can replace\n\n```\ncmp(x, y) < 0\n```\nby\n\n```\nx.endpoints() < y.endpoints()\n```\n\nFor `x.endpoints() == y.endpoints()`, it makes sense to define a new method `equals()` on intervals which does this.",
    "created_at": "2017-03-08T13:09:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22549#issuecomment-333959",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:12" align="right">comment:12</div>

Replying to [@fchapoton](#comment:9):
> #22257 tells you what happens if you replace current cmp behaviour by current richcmp behaviour.

Here is a constructive suggestion: essentially, what `cmp()` does on intervals is comparing the endpoints. So whenever you need to replace `cmp()` for intervals by rich comparison, use rich comparison on the endpoints. For example, you can replace

```
cmp(x, y) < 0
```
by

```
x.endpoints() < y.endpoints()
```

For `x.endpoints() == y.endpoints()`, it makes sense to define a new method `equals()` on intervals which does this.



---

archive/issue_comments_333960.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nReplying to [@cheuberg](#comment:11):\n> Tons of external code might be broken by this change of behaviour. Changing the semantics of `==` at this point is completely inacceptable for me.\n\n+1",
    "created_at": "2017-03-08T13:10:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22549#issuecomment-333960",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:13" align="right">comment:13</div>

Replying to [@cheuberg](#comment:11):
> Tons of external code might be broken by this change of behaviour. Changing the semantics of `==` at this point is completely inacceptable for me.

+1



---

archive/issue_comments_333961.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReplying to [@fchapoton](#comment:10):\n> This is really involved in unique representation and ComparisonById, because Number Fields (which are Parent) have embeddings (which are interval-numbers) that need to compare equal to themselves for the number fields to do the same.\n\nCould we replace checking for equality to checking for non-inequality instead?",
    "created_at": "2017-03-08T13:12:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22549#issuecomment-333961",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:14" align="right">comment:14</div>

Replying to [@fchapoton](#comment:10):
> This is really involved in unique representation and ComparisonById, because Number Fields (which are Parent) have embeddings (which are interval-numbers) that need to compare equal to themselves for the number fields to do the same.

Could we replace checking for equality to checking for non-inequality instead?



---

archive/issue_comments_333962.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nYes, guys, I understand your issues. Nevertheless, I have worked hard on the question, and this really stands in our way to python3. I do not think that this proposal is such a big change of behaviour. Maybe most equality tests between elements of RIF should involve an exact element, no ?\n\nTransition to python3 is going to be painful, but you really appreciate that when spending a lot of time on this transition, as I did.",
    "created_at": "2017-03-08T13:15:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22549#issuecomment-333962",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:15" align="right">comment:15</div>

Yes, guys, I understand your issues. Nevertheless, I have worked hard on the question, and this really stands in our way to python3. I do not think that this proposal is such a big change of behaviour. Maybe most equality tests between elements of RIF should involve an exact element, no ?

Transition to python3 is going to be painful, but you really appreciate that when spending a lot of time on this transition, as I did.



---

archive/issue_comments_333963.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nIf I read the code correctly, the proposed behaviour is the same as the current behaviour for real and complex ball fields, so it should not be so bad.",
    "created_at": "2017-03-08T13:18:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22549#issuecomment-333963",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:16" align="right">comment:16</div>

If I read the code correctly, the proposed behaviour is the same as the current behaviour for real and complex ball fields, so it should not be so bad.



---

archive/issue_comments_333964.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nReplying to [@fchapoton](#comment:15):\n> Nevertheless, I have worked hard on the question, and this really stands in our way to python3.\n\nSo far, I totally agree.\n\n> I do not think that this proposal is such a big change of behaviour.\n\nI think it's a massive change of behaviour which really should not be done unless you have very good reasons (so far, I haven't seen such a reason).\n\n> Maybe most equality tests between elements of RIF should involve an exact element, no ?\n\nProbably yes.\n\n> Transition to python3 is going to be painful, but you really appreciate that when spending a lot of time on this transition, as I did.\n\nAgain, I totally agree. Still, the fact that it's painful does not mean that we should go ahead with what you propose here.",
    "created_at": "2017-03-08T13:25:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22549#issuecomment-333964",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:17" align="right">comment:17</div>

Replying to [@fchapoton](#comment:15):
> Nevertheless, I have worked hard on the question, and this really stands in our way to python3.

So far, I totally agree.

> I do not think that this proposal is such a big change of behaviour.

I think it's a massive change of behaviour which really should not be done unless you have very good reasons (so far, I haven't seen such a reason).

> Maybe most equality tests between elements of RIF should involve an exact element, no ?

Probably yes.

> Transition to python3 is going to be painful, but you really appreciate that when spending a lot of time on this transition, as I did.

Again, I totally agree. Still, the fact that it's painful does not mean that we should go ahead with what you propose here.



---

archive/issue_comments_333965.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nReplying to [@fchapoton](#comment:16):\n> the proposed behaviour is the same as the current behaviour for real and complex ball fields\n\nThis is simply not true:\n\n```\nsage: x = RIF.pi()\nsage: x == x\nFalse\nsage: RBF(x) == RBF(x)\nFalse\n```",
    "created_at": "2017-03-08T13:27:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22549#issuecomment-333965",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:18" align="right">comment:18</div>

Replying to [@fchapoton](#comment:16):
> the proposed behaviour is the same as the current behaviour for real and complex ball fields

This is simply not true:

```
sage: x = RIF.pi()
sage: x == x
False
sage: RBF(x) == RBF(x)
False
```



---

archive/issue_comments_333966.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nReplying to [@jdemeyer](#comment:12):\n> For `x.endpoints() == y.endpoints()`, it makes sense to define a new method `equals()` on intervals which does this.\n\nI'd suggest calling it `identical()`, for consistency with real and complex balls.",
    "created_at": "2017-03-08T13:28:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22549#issuecomment-333966",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:19" align="right">comment:19</div>

Replying to [@jdemeyer](#comment:12):
> For `x.endpoints() == y.endpoints()`, it makes sense to define a new method `equals()` on intervals which does this.

I'd suggest calling it `identical()`, for consistency with real and complex balls.



---

archive/issue_comments_333967.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nIndeed, I was wrong on that point. The doc of ball fields says\n\n```\nTwo elements are equal if and only if they are the same object\nor if both are exact and equal::\n```\nso that\n\n```\nsage: x=RBF(pi)\nsage: x==x\nTrue\n```\n\nReplying to [@jdemeyer](#comment:18):\n> Replying to [@fchapoton](#comment:16):\n> > the proposed behaviour is the same as the current behaviour for real and complex ball fields\n\n> \n> This is simply not true:\n> \n> ```\n> sage: x = RIF.pi()\n> sage: x == x\n> False\n> sage: RBF(x) == RBF(x)\n> False\n> ```",
    "created_at": "2017-03-08T13:35:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22549#issuecomment-333967",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:20" align="right">comment:20</div>

Indeed, I was wrong on that point. The doc of ball fields says

```
Two elements are equal if and only if they are the same object
or if both are exact and equal::
```
so that

```
sage: x=RBF(pi)
sage: x==x
True
```

Replying to [@jdemeyer](#comment:18):
> Replying to [@fchapoton](#comment:16):
> > the proposed behaviour is the same as the current behaviour for real and complex ball fields

> 
> This is simply not true:
> 
> ```
> sage: x = RIF.pi()
> sage: x == x
> False
> sage: RBF(x) == RBF(x)
> False
> ```



---

archive/issue_comments_333968.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nReplying to [@jdemeyer](#comment:13):\n> Replying to [@cheuberg](#comment:11):\n> > Tons of external code might be broken by this change of behaviour. Changing the semantics of `==` at this point is completely inacceptable for me.\n\n> \n> +1\n\n+1 as well",
    "created_at": "2017-03-08T13:59:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22549#issuecomment-333968",
    "user": "https://github.com/dkrenn"
}
```

<div id="comment:21" align="right">comment:21</div>

Replying to [@jdemeyer](#comment:13):
> Replying to [@cheuberg](#comment:11):
> > Tons of external code might be broken by this change of behaviour. Changing the semantics of `==` at this point is completely inacceptable for me.

> 
> +1

+1 as well



---

archive/issue_comments_333969.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nOk. It seems that the solution proposed here will not be accepted. I will now try to go back to #22257 and propose there another fix with no change to the == semantics.",
    "created_at": "2017-03-08T15:59:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22549#issuecomment-333969",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:23" align="right">comment:23</div>

Ok. It seems that the solution proposed here will not be accepted. I will now try to go back to #22257 and propose there another fix with no change to the == semantics.



---

archive/issue_comments_333970.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nI would say what needs to be fixed is what is stored as the caching key for number fields. In this case, it looks like the construction of said key, when given an element of RIF/RBF, should instead store the endpoints. The parent is reconstructible from that data and it doesn't involve the `x == x` being `False` issue.",
    "created_at": "2017-03-08T16:54:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22549#issuecomment-333970",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:24" align="right">comment:24</div>

I would say what needs to be fixed is what is stored as the caching key for number fields. In this case, it looks like the construction of said key, when given an element of RIF/RBF, should instead store the endpoints. The parent is reconstructible from that data and it doesn't involve the `x == x` being `False` issue.



---

archive/issue_comments_333971.json:
```json
{
    "body": "Changed author from **Fr\u00e9d\u00e9ric Chapoton** to none",
    "created_at": "2017-03-09T09:19:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22549#issuecomment-333971",
    "user": "https://github.com/jdemeyer"
}
```

Changed author from **Frédéric Chapoton** to none



---

archive/issue_comments_333972.json:
```json
{
    "body": "Reviewer: **Fr\u00e9d\u00e9ric Chapoton**",
    "created_at": "2017-03-09T09:19:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22549#issuecomment-333972",
    "user": "https://github.com/jdemeyer"
}
```

Reviewer: **Frédéric Chapoton**



---

archive/issue_events_316541.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-03-09T09:19:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22549",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22549#event-316541"
}
```



---

archive/issue_events_316542.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-03-09T09:19:43Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/22549",
    "milestone_number": null,
    "milestone_title": "sage-7.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22549#event-316542"
}
```



---

archive/issue_events_316543.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-03-09T09:19:43Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22549",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22549#event-316543"
}
```



---

archive/issue_events_316544.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-03-09T09:19:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22549",
    "label": "https://github.com/sagemath/sage/labels/invalid",
    "label_color": "c6c6c6",
    "label_name": "invalid",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22549#event-316544"
}
```



---

archive/issue_events_316545.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-03-09T09:19:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22549",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22549#event-316545"
}
```



---

archive/issue_events_316546.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-03-09T09:19:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22549",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22549#event-316546"
}
```



---

archive/issue_comments_333973.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nyes, I agree, you can close as wontfix",
    "created_at": "2017-03-09T09:24:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22549#issuecomment-333973",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:27" align="right">comment:27</div>

yes, I agree, you can close as wontfix



---

archive/issue_comments_333974.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nReplying to [@jdemeyer](#comment:12):\n> Here is a constructive suggestion: essentially, what `cmp()` does on intervals is comparing the endpoints.\n\nNote however that we have:\n\n```\nsage: cmp(RIF(1/3), RIF('nan'))\n0\n```\nIMO this is a bug or at least a misfeature of the current `_cmp_()`, but who knows what might rely on it... (I had code that did by accident.)",
    "created_at": "2017-03-12T11:13:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22549#issuecomment-333974",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:28" align="right">comment:28</div>

Replying to [@jdemeyer](#comment:12):
> Here is a constructive suggestion: essentially, what `cmp()` does on intervals is comparing the endpoints.

Note however that we have:

```
sage: cmp(RIF(1/3), RIF('nan'))
0
```
IMO this is a bug or at least a misfeature of the current `_cmp_()`, but who knows what might rely on it... (I had code that did by accident.)



---

archive/issue_events_316547.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-07-13T07:54:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22549",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22549#event-316547"
}
```



---

archive/issue_events_316548.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-07-13T07:54:31Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/22549",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22549#event-316548"
}
```



---

archive/issue_events_316549.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-07-13T07:54:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22549",
    "label": "https://github.com/sagemath/sage/labels/wontfix",
    "label_color": "c6c6c6",
    "label_name": "wontfix",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22549#event-316549"
}
```



---

archive/issue_comments_333975.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nClosing tickets in the sage-duplicate/invalid/wontfix module with positive_review (i.e. someone has confirmed they should be closed).",
    "created_at": "2017-07-13T07:54:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22549#issuecomment-333975",
    "user": "https://github.com/embray"
}
```

<div id="comment:29" align="right">comment:29</div>

Closing tickets in the sage-duplicate/invalid/wontfix module with positive_review (i.e. someone has confirmed they should be closed).
