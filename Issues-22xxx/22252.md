# Issue 22252: Upgrade to Sphinx 1.5.x

archive/issues_022015.json:
```json
{
    "body": "The newer version of Sphinx needs `requests`.\n\n**Tarballs**:\n* https://pypi.python.org/packages/a7/df/4487783152b14f2b7cd0b0c9afb119b262c584bf972b90ab544b61b74c62/Sphinx-1.5.3.tar.gz\n* https://pypi.python.org/packages/16/09/37b69de7c924d318e51ece1c4ceb679bf93be9d05973bb30c35babd596e2/requests-2.13.0.tar.gz\n\nWe add a patch to Sphinx to allow running without SSL: https://github.com/sphinx-doc/sphinx/pull/3554\n\nCC:  @kiwifb\n\nKeywords: days85\n\nBranch/Commit: f20f00a5ce6168f34f51845c0698e4419506ea12\n\nUpstream: Fixed upstream, but not in a stable release.\n\nReviewer: Fran\u00e7ois Bissey, John Palmieri\n\nAuthor: Jeroen Demeyer\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/22252\n\n",
    "closed_at": "2017-03-27T20:42:42Z",
    "created_at": "2017-01-25T09:22:43Z",
    "labels": [
        "component: packages: standard"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.6",
    "title": "Upgrade to Sphinx 1.5.x",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22252",
    "user": "https://github.com/jdemeyer"
}
```
The newer version of Sphinx needs `requests`.

**Tarballs**:
* https://pypi.python.org/packages/a7/df/4487783152b14f2b7cd0b0c9afb119b262c584bf972b90ab544b61b74c62/Sphinx-1.5.3.tar.gz
* https://pypi.python.org/packages/16/09/37b69de7c924d318e51ece1c4ceb679bf93be9d05973bb30c35babd596e2/requests-2.13.0.tar.gz

We add a patch to Sphinx to allow running without SSL: https://github.com/sphinx-doc/sphinx/pull/3554

CC:  @kiwifb

Keywords: days85

Branch/Commit: f20f00a5ce6168f34f51845c0698e4419506ea12

Upstream: Fixed upstream, but not in a stable release.

Reviewer: Fran√ßois Bissey, John Palmieri

Author: Jeroen Demeyer

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/22252





---

archive/issue_comments_305526.json:
```json
{
    "body": "<a id='comment:1'></a>Should we update docutils to 0.13 at the same time? sphinx 1.5.2 as all the fix to work with it as far as I know, can be in a separate ticket but it is better if they are done at the same time given the comments in https://github.com/cschwan/sage-on-gentoo/issues/451",
    "created_at": "2017-01-25T09:28:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22252#issuecomment-305526",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:1'></a>Should we update docutils to 0.13 at the same time? sphinx 1.5.2 as all the fix to work with it as far as I know, can be in a separate ticket but it is better if they are done at the same time given the comments in https://github.com/cschwan/sage-on-gentoo/issues/451



---

archive/issue_comments_305527.json:
```json
{
    "body": "<a id='comment:2'></a>I would say: let's do whatever is easiest. So the question is: is it easier to make Sage and Sphinx-1.5.2 work with docutils-0.12 or with docutils-0.13?",
    "created_at": "2017-01-25T09:41:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22252#issuecomment-305527",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:2'></a>I would say: let's do whatever is easiest. So the question is: is it easier to make Sage and Sphinx-1.5.2 work with docutils-0.12 or with docutils-0.13?



---

archive/issue_comments_305528.json:
```json
{
    "body": "<a id='comment:3'></a>Thinking more about it, sphinx 1.5.2 should work with both,  so we can do sphinx first then docutils afterwards.",
    "created_at": "2017-01-25T09:45:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22252#issuecomment-305528",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:3'></a>Thinking more about it, sphinx 1.5.2 should work with both,  so we can do sphinx first then docutils afterwards.



---

archive/issue_comments_305529.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-01-25T15:43:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22252#issuecomment-305529",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_305530.json:
```json
{
    "body": "<a id='comment:8'></a>The line\n\n```\n    import ssl\n```\nfrom `sphinx/util/requests.py` is going to cause problems on systems without SSL (like my Mac, until I ran `make openssl` and `sage -f python2`).",
    "created_at": "2017-03-02T00:01:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22252#issuecomment-305530",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:8'></a>The line

```
    import ssl
```
from `sphinx/util/requests.py` is going to cause problems on systems without SSL (like my Mac, until I ran `make openssl` and `sage -f python2`).



---

archive/issue_comments_305531.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-03-02T07:51:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22252#issuecomment-305531",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_305532.json:
```json
{
    "body": "<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-03-02T10:46:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22252#issuecomment-305532",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_305533.json:
```json
{
    "body": "<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-03-11T14:22:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22252#issuecomment-305533",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_305534.json:
```json
{
    "body": "Changing keywords from \"\" to \"days85\".",
    "created_at": "2017-03-13T15:33:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22252#issuecomment-305534",
    "user": "https://github.com/jdemeyer"
}
```

Changing keywords from "" to "days85".



---

archive/issue_comments_305535.json:
```json
{
    "body": "<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-03-13T16:14:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22252#issuecomment-305535",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_305536.json:
```json
{
    "body": "<a id='comment:14'></a>This last version actually manages to compile the documentation.",
    "created_at": "2017-03-13T16:40:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22252#issuecomment-305536",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:14'></a>This last version actually manages to compile the documentation.



---

archive/issue_comments_305537.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-03-13T21:49:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22252#issuecomment-305537",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_305538.json:
```json
{
    "body": "<a id='comment:16'></a>What about the issue in [comment:8]? Is ssl going to become a dependency for building the Sage docs?",
    "created_at": "2017-03-14T00:54:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22252#issuecomment-305538",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:16'></a>What about the issue in [comment:8]? Is ssl going to become a dependency for building the Sage docs?



---

archive/issue_comments_305539.json:
```json
{
    "body": "<a id='comment:17'></a>Modulo [comment:8] it works for me.",
    "created_at": "2017-03-14T09:34:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22252#issuecomment-305539",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:17'></a>Modulo [comment:8] it works for me.



---

archive/issue_comments_305540.json:
```json
{
    "body": "<a id='comment:18'></a>I think SSl is going to be a Sage dependency soon anyway so that we can upgrade `R`.",
    "created_at": "2017-03-14T10:11:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22252#issuecomment-305540",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:18'></a>I think SSl is going to be a Sage dependency soon anyway so that we can upgrade `R`.



---

archive/issue_comments_305541.json:
```json
{
    "body": "<a id='comment:19'></a>In fact, SSL is already a Sage dependency: #22189.",
    "created_at": "2017-03-14T10:55:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22252#issuecomment-305541",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:19'></a>In fact, SSL is already a Sage dependency: #22189.



---

archive/issue_comments_305542.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-03-14T10:57:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22252#issuecomment-305542",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_305543.json:
```json
{
    "body": "<a id='comment:20'></a>That's a broad interpretation but I am ready to give this a positive review anyway.",
    "created_at": "2017-03-14T10:57:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22252#issuecomment-305543",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:20'></a>That's a broad interpretation but I am ready to give this a positive review anyway.



---

archive/issue_comments_305544.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-03-14T11:06:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22252#issuecomment-305544",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_305545.json:
```json
{
    "body": "<a id='comment:22'></a>I'm not convinced by the openSSL story.",
    "created_at": "2017-03-14T11:06:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22252#issuecomment-305545",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:22'></a>I'm not convinced by the openSSL story.



---

archive/issue_comments_305546.json:
```json
{
    "body": "<a id='comment:23'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-03-14T18:00:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22252#issuecomment-305546",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:23'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_305547.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-03-14T18:08:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22252#issuecomment-305547",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_305548.json:
```json
{
    "body": "<a id='comment:25'></a>This builds (and the docs build) for me even when `import ssl` fails in Sage's Python.",
    "created_at": "2017-03-14T18:30:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22252#issuecomment-305548",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:25'></a>This builds (and the docs build) for me even when `import ssl` fails in Sage's Python.



---

archive/issue_comments_305549.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-03-14T18:30:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22252#issuecomment-305549",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_305550.json:
```json
{
    "body": "<a id='comment:26'></a>By the way, if I build the docs and then switch to this branch and build again, it fails, with the message\n\n```\nTypeError: ('__init__() takes exactly 4 arguments (1 given)', <class 'sphinx.environment.BuildEnvironment'>, ())\n```\nThis suggests that #19882 might still be useful.",
    "created_at": "2017-03-14T19:13:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22252#issuecomment-305550",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:26'></a>By the way, if I build the docs and then switch to this branch and build again, it fails, with the message

```
TypeError: ('__init__() takes exactly 4 arguments (1 given)', <class 'sphinx.environment.BuildEnvironment'>, ())
```
This suggests that #19882 might still be useful.



---

archive/issue_comments_305551.json:
```json
{
    "body": "<a id='comment:27'></a>It seems that you removed the patch giving extra memory to LaTeX to compile tp PDF file the huge Sage doc. We should keep this somewhere. I'm waiting for the patchbot which apparently check the compiling of the PDF doc.\n\nAs far as I understand the ssl workaround is sound. And I confirm that the `patch_domain_init` function in `src/sage_setup/docbuild/__init__.py` should indeed be removed. So this looks good to me except:\n\n- the huge tex problem above\n- the patch in `build/pkgs/sphinx/patches/environment.patch` which deals with changing some config value.",
    "created_at": "2017-03-15T16:26:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22252#issuecomment-305551",
    "user": "https://github.com/hivert"
}
```

<a id='comment:27'></a>It seems that you removed the patch giving extra memory to LaTeX to compile tp PDF file the huge Sage doc. We should keep this somewhere. I'm waiting for the patchbot which apparently check the compiling of the PDF doc.

As far as I understand the ssl workaround is sound. And I confirm that the `patch_domain_init` function in `src/sage_setup/docbuild/__init__.py` should indeed be removed. So this looks good to me except:

- the huge tex problem above
- the patch in `build/pkgs/sphinx/patches/environment.patch` which deals with changing some config value.



---

archive/issue_comments_305552.json:
```json
{
    "body": "<a id='comment:28'></a>I can't comment on the TeX memory problem because I can't get the PDF docs to build with this branch. The first one attempted is `reference/manifolds`, which very early produces an error\n\n```\n[docpdf] \n[docpdf] Package hyperref Message: Driver (autodetected): hpdftex.\n[docpdf] \n[docpdf] (/usr/local/texlive/2016/texmf-dist/tex/latex/hyperref/hpdftex.def\n[docpdf] (/usr/local/texlive/2016/texmf-dist/tex/latex/oberdiek/rerunfilecheck.sty))\n[docpdf] (/usr/local/texlive/2016/texmf-dist/tex/latex/oberdiek/hypcap.sty)\n[docpdf] (/usr/local/texlive/2016/texmf-dist/tex/latex/jknapltx/mathrsfs.sty)\n[docpdf] ! Undefined control sequence.\n[docpdf] l.48 \\ifPDFTeX\n[docpdf]\n```\nTrying again with the patch\n\n```diff\ndiff --git a/src/doc/common/conf.py b/src/doc/common/conf.py\nindex 564407b..7ec52df 100644\n--- a/src/doc/common/conf.py\n+++ b/src/doc/common/conf.py\n@@ -308,6 +308,7 @@ latex_elements['preamble'] = r\"\"\"\n \\usepackage{amssymb}\n \\usepackage{textcomp}\n \\usepackage{mathrsfs}\n+\\usepackage{iftex}\n \n % Only declare unicode characters when compiling with pdftex; E.g. japanese\n % tutorial does not use pdftex\n```",
    "created_at": "2017-03-15T21:28:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22252#issuecomment-305552",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:28'></a>I can't comment on the TeX memory problem because I can't get the PDF docs to build with this branch. The first one attempted is `reference/manifolds`, which very early produces an error

```
[docpdf] 
[docpdf] Package hyperref Message: Driver (autodetected): hpdftex.
[docpdf] 
[docpdf] (/usr/local/texlive/2016/texmf-dist/tex/latex/hyperref/hpdftex.def
[docpdf] (/usr/local/texlive/2016/texmf-dist/tex/latex/oberdiek/rerunfilecheck.sty))
[docpdf] (/usr/local/texlive/2016/texmf-dist/tex/latex/oberdiek/hypcap.sty)
[docpdf] (/usr/local/texlive/2016/texmf-dist/tex/latex/jknapltx/mathrsfs.sty)
[docpdf] ! Undefined control sequence.
[docpdf] l.48 \ifPDFTeX
[docpdf]
```
Trying again with the patch

```diff
diff --git a/src/doc/common/conf.py b/src/doc/common/conf.py
index 564407b..7ec52df 100644
--- a/src/doc/common/conf.py
+++ b/src/doc/common/conf.py
@@ -308,6 +308,7 @@ latex_elements['preamble'] = r"""
 \usepackage{amssymb}
 \usepackage{textcomp}
 \usepackage{mathrsfs}
+\usepackage{iftex}
 
 % Only declare unicode characters when compiling with pdftex; E.g. japanese
 % tutorial does not use pdftex
```



---

archive/issue_comments_305553.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-03-15T21:28:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22252#issuecomment-305553",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_305554.json:
```json
{
    "body": "<a id='comment:29'></a>Based on https://github.com/sphinx-doc/sphinx/issues/2727, for example, maybe we should consider using `latex_engine` to determine the preamble. Maybe for another ticket, if we can get the PDF docs to build without much hard work.",
    "created_at": "2017-03-15T21:37:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22252#issuecomment-305554",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:29'></a>Based on https://github.com/sphinx-doc/sphinx/issues/2727, for example, maybe we should consider using `latex_engine` to determine the preamble. Maybe for another ticket, if we can get the PDF docs to build without much hard work.



---

archive/issue_comments_305555.json:
```json
{
    "body": "<a id='comment:30'></a>Okay, the PDF docs build for me after adding `\\usepackage{iftex}` to the preamble, without any other changes to the current branch, and in particular without the \"huge tex\" changes from previous versions.",
    "created_at": "2017-03-15T22:10:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22252#issuecomment-305555",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:30'></a>Okay, the PDF docs build for me after adding `\usepackage{iftex}` to the preamble, without any other changes to the current branch, and in particular without the "huge tex" changes from previous versions.



---

archive/issue_comments_305556.json:
```json
{
    "body": "<a id='comment:32'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-03-16T19:06:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22252#issuecomment-305556",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:32'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_305557.json:
```json
{
    "body": "<a id='comment:33'></a>On my Gentoo system, I never managed to built the Japanese PDF documentation (any ideas, fbissey?) with or without this patch:\n\n```\n[docpdf] /bin/sh: extractbb: command not found\n```\n\nSo I can make changes to the `\\ifPDFTeX` thing but I'll have to do it \"in the dark\" without actually being able to check it.\n\nSo I would appreciate if somebody else could finish this ticket.",
    "created_at": "2017-03-17T11:48:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22252#issuecomment-305557",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:33'></a>On my Gentoo system, I never managed to built the Japanese PDF documentation (any ideas, fbissey?) with or without this patch:

```
[docpdf] /bin/sh: extractbb: command not found
```

So I can make changes to the `\ifPDFTeX` thing but I'll have to do it "in the dark" without actually being able to check it.

So I would appreciate if somebody else could finish this ticket.



---

archive/issue_comments_305558.json:
```json
{
    "body": "<a id='comment:34'></a>On my OS X machine, `extractbb` seems to be part of TeXLive 2016, and is just a symlink to `xdvipdfmx`:\n\n```\n$ ls -l /usr/local/texlive/2016/bin/universal-darwin/extractbb\nlrwxr-xr-x  1 palmieri  wheel  9 Sep  6  2016 /usr/local/texlive/2016/bin/universal-darwin/extractbb@ -> xdvipdfmx\n```\nMaybe if you install some package of TeX extras, it will be there?",
    "created_at": "2017-03-17T15:47:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22252#issuecomment-305558",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:34'></a>On my OS X machine, `extractbb` seems to be part of TeXLive 2016, and is just a symlink to `xdvipdfmx`:

```
$ ls -l /usr/local/texlive/2016/bin/universal-darwin/extractbb
lrwxr-xr-x  1 palmieri  wheel  9 Sep  6  2016 /usr/local/texlive/2016/bin/universal-darwin/extractbb@ -> xdvipdfmx
```
Maybe if you install some package of TeX extras, it will be there?



---

archive/issue_comments_305559.json:
```json
{
    "body": "<a id='comment:35'></a>In any case, everything works with the current branch on OS X if\n\n- I also apply the patch in [comment:28].\n- and I run `LC_ALL=C make doc-pdf`, as suggested by Volker [on sage-release](https://groups.google.com/d/msg/sage-release/ao350AQsx00/sF5FjiITAQAJ).",
    "created_at": "2017-03-17T15:52:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22252#issuecomment-305559",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:35'></a>In any case, everything works with the current branch on OS X if

- I also apply the patch in [comment:28].
- and I run `LC_ALL=C make doc-pdf`, as suggested by Volker [on sage-release](https://groups.google.com/d/msg/sage-release/ao350AQsx00/sF5FjiITAQAJ).



---

archive/issue_comments_305560.json:
```json
{
    "body": "<a id='comment:36'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-03-17T17:20:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22252#issuecomment-305560",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:36'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_305561.json:
```json
{
    "body": "<a id='comment:37'></a>I think the `LC_ALL` issue is orthogonal to this ticket, so I didn't do anything for that. I did apply the patch from [comment:28]",
    "created_at": "2017-03-17T17:33:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22252#issuecomment-305561",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:37'></a>I think the `LC_ALL` issue is orthogonal to this ticket, so I didn't do anything for that. I did apply the patch from [comment:28]



---

archive/issue_comments_305562.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-03-17T17:33:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22252#issuecomment-305562",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_305563.json:
```json
{
    "body": "<a id='comment:39'></a>Replying to [comment:37 jdemeyer]:\n> I think the `LC_ALL` issue is orthogonal to this ticket, so I didn't do anything for that.\n\n\nI agree.",
    "created_at": "2017-03-17T18:07:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22252#issuecomment-305563",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:39'></a>Replying to [comment:37 jdemeyer]:
> I think the `LC_ALL` issue is orthogonal to this ticket, so I didn't do anything for that.


I agree.



---

archive/issue_comments_305564.json:
```json
{
    "body": "<a id='comment:40'></a>I am happy with this, but it needs testing on platforms other than OS X.",
    "created_at": "2017-03-17T18:08:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22252#issuecomment-305564",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:40'></a>I am happy with this, but it needs testing on platforms other than OS X.



---

archive/issue_comments_305565.json:
```json
{
    "body": "<a id='comment:41'></a>Replying to [comment:33 jdemeyer]:\n> On my Gentoo system, I never managed to built the Japanese PDF documentation (any ideas, fbissey?) with or without this patch:\n> \n> ```\n> [docpdf] /bin/sh: extractbb: command not found\n> ```\n> \n> So I can make changes to the `\\ifPDFTeX` thing but I'll have to do it \"in the dark\" without actually being able to check it.\n> \n> So I would appreciate if somebody else could finish this ticket.\n\n\nI should check that I can build it now. I changed system so I am starting from a cleaner slate. I used to have problem with russian documentation because of tex fonts problems. According to my ebuild I need the following from tex\n\n```\nL10N=\"ca de en fr hu it ja pt ru tr\" USE=extra emerge -1Nv texlive\n```\n I usually do \n\n```\nVARTEX=$somelocations make doc-pdf\n```\nGentoo doesn't install \"unfolded\" russian (and japanese?) tex fonts. If you don't specify VARTEX, it may try to do it in a system location.",
    "created_at": "2017-03-17T19:17:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22252#issuecomment-305565",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:41'></a>Replying to [comment:33 jdemeyer]:
> On my Gentoo system, I never managed to built the Japanese PDF documentation (any ideas, fbissey?) with or without this patch:
> 
> ```
> [docpdf] /bin/sh: extractbb: command not found
> ```
> 
> So I can make changes to the `\ifPDFTeX` thing but I'll have to do it "in the dark" without actually being able to check it.
> 
> So I would appreciate if somebody else could finish this ticket.


I should check that I can build it now. I changed system so I am starting from a cleaner slate. I used to have problem with russian documentation because of tex fonts problems. According to my ebuild I need the following from tex

```
L10N="ca de en fr hu it ja pt ru tr" USE=extra emerge -1Nv texlive
```
 I usually do 

```
VARTEX=$somelocations make doc-pdf
```
Gentoo doesn't install "unfolded" russian (and japanese?) tex fonts. If you don't specify VARTEX, it may try to do it in a system location.



---

archive/issue_comments_305566.json:
```json
{
    "body": "<a id='comment:42'></a>Japanese pdf doc build OK here with this ticket as is (a vanilla build rather than a sage-on-gentoo one). Cannot quite read it but the \"a_tour_of_sage.pdf\" looks legit compared to the english one.",
    "created_at": "2017-03-18T04:16:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22252#issuecomment-305566",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:42'></a>Japanese pdf doc build OK here with this ticket as is (a vanilla build rather than a sage-on-gentoo one). Cannot quite read it but the "a_tour_of_sage.pdf" looks legit compared to the english one.



---

archive/issue_comments_305567.json:
```json
{
    "body": "<a id='comment:43'></a>I have Gentoo here and all pdfs build with this ticket. I have installed\n\n```\n[I] dev-texlive/texlive-langcjk\n[I] dev-texlive/texlive-langcyrillic\n[I] dev-texlive/texlive-langenglish\n[I] dev-texlive/texlive-langeuropean\n[I] dev-texlive/texlive-langfrench\n[I] dev-texlive/texlive-langgerman\n[I] dev-texlive/texlive-langitalian\n[I] dev-texlive/texlive-langjapanese\n[I] dev-texlive/texlive-langportuguese\n[I] dev-texlive/texlive-langspanish\n```\n\n`/usr/bin/extractbb` is pulled in by `app-text/texlive-core-2015-r1`. The only thing I had to do is uncomment\n\n```\n%f  cid-x.map\n```\n\nin `/etc/texmf/dvipdfmx.d/dvipdfmx.cfg` so certain fonts could be generated.\n\n\nReplying to [comment:33 jdemeyer]:\n> On my Gentoo system, I never managed to built the Japanese PDF documentation (any ideas, fbissey?) with or without this patch:\n> \n> ```\n> [docpdf] /bin/sh: extractbb: command not found\n> ```\n> \n> So I can make changes to the `\\ifPDFTeX` thing but I'll have to do it \"in the dark\" without actually being able to check it.\n> \n> So I would appreciate if somebody else could finish this ticket.",
    "created_at": "2017-03-18T04:33:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22252#issuecomment-305567",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:43'></a>I have Gentoo here and all pdfs build with this ticket. I have installed

```
[I] dev-texlive/texlive-langcjk
[I] dev-texlive/texlive-langcyrillic
[I] dev-texlive/texlive-langenglish
[I] dev-texlive/texlive-langeuropean
[I] dev-texlive/texlive-langfrench
[I] dev-texlive/texlive-langgerman
[I] dev-texlive/texlive-langitalian
[I] dev-texlive/texlive-langjapanese
[I] dev-texlive/texlive-langportuguese
[I] dev-texlive/texlive-langspanish
```

`/usr/bin/extractbb` is pulled in by `app-text/texlive-core-2015-r1`. The only thing I had to do is uncomment

```
%f  cid-x.map
```

in `/etc/texmf/dvipdfmx.d/dvipdfmx.cfg` so certain fonts could be generated.


Replying to [comment:33 jdemeyer]:
> On my Gentoo system, I never managed to built the Japanese PDF documentation (any ideas, fbissey?) with or without this patch:
> 
> ```
> [docpdf] /bin/sh: extractbb: command not found
> ```
> 
> So I can make changes to the `\ifPDFTeX` thing but I'll have to do it "in the dark" without actually being able to check it.
> 
> So I would appreciate if somebody else could finish this ticket.



---

archive/issue_comments_305568.json:
```json
{
    "body": "<a id='comment:44'></a>Replying to [comment:43 strogdon]:\n> `/usr/bin/extractbb` is pulled in by `app-text/texlive-core-2015-r1`. The only thing I had to do is uncomment\n> \n> \n> ```\n> %f  cid-x.map\n> ```\n> \n> in `/etc/texmf/dvipdfmx.d/dvipdfmx.cfg` so certain fonts could be generated.\n> \n\n\nCan you elaborate Steve? Do you mean that after doing that change the fonts are installed and you don't need to set VARTEX, or that I should check my build for missing fonts?",
    "created_at": "2017-03-18T04:37:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22252#issuecomment-305568",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:44'></a>Replying to [comment:43 strogdon]:
> `/usr/bin/extractbb` is pulled in by `app-text/texlive-core-2015-r1`. The only thing I had to do is uncomment
> 
> 
> ```
> %f  cid-x.map
> ```
> 
> in `/etc/texmf/dvipdfmx.d/dvipdfmx.cfg` so certain fonts could be generated.
> 


Can you elaborate Steve? Do you mean that after doing that change the fonts are installed and you don't need to set VARTEX, or that I should check my build for missing fonts?



---

archive/issue_comments_305569.json:
```json
{
    "body": "<a id='comment:45'></a>Replying to [comment:44 fbissey]:\n> Replying to [comment:43 strogdon]:\n> > `/usr/bin/extractbb` is pulled in by `app-text/texlive-core-2015-r1`. The only thing I had to do is uncomment\n> > \n> > \n> > ```\n> > %f  cid-x.map\n> > ```\n> > \n> > in `/etc/texmf/dvipdfmx.d/dvipdfmx.cfg` so certain fonts could be generated.\n> > \n\n> \n> Can you elaborate Steve? Do you mean that after doing that change the fonts are installed and you don't need to set VARTEX, or that I should check my build for missing fonts?\n\n\nThis was with vanilla and not s-o-g. I just did `make doc-pdf`. In doing that some japanese fonts could not be generated. I uncommented the `f cid-x.map` line although it could have been `f ckx.map` in order to get the build to complete.",
    "created_at": "2017-03-18T04:49:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22252#issuecomment-305569",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:45'></a>Replying to [comment:44 fbissey]:
> Replying to [comment:43 strogdon]:
> > `/usr/bin/extractbb` is pulled in by `app-text/texlive-core-2015-r1`. The only thing I had to do is uncomment
> > 
> > 
> > ```
> > %f  cid-x.map
> > ```
> > 
> > in `/etc/texmf/dvipdfmx.d/dvipdfmx.cfg` so certain fonts could be generated.
> > 

> 
> Can you elaborate Steve? Do you mean that after doing that change the fonts are installed and you don't need to set VARTEX, or that I should check my build for missing fonts?


This was with vanilla and not s-o-g. I just did `make doc-pdf`. In doing that some japanese fonts could not be generated. I uncommented the `f cid-x.map` line although it could have been `f ckx.map` in order to get the build to complete.



---

archive/issue_comments_305570.json:
```json
{
    "body": "<a id='comment:46'></a>Replying to [comment:45 strogdon]:\n> Replying to [comment:44 fbissey]:\n> > Replying to [comment:43 strogdon]:\n> > > `/usr/bin/extractbb` is pulled in by `app-text/texlive-core-2015-r1`. The only thing I had to do is uncomment\n> > > \n> > > \n> > > ```\n> > > %f  cid-x.map\n> > > ```\n> > > \n> > > in `/etc/texmf/dvipdfmx.d/dvipdfmx.cfg` so certain fonts could be generated.\n> > > \n\n> > \n> > Can you elaborate Steve? Do you mean that after doing that change the fonts are installed and you don't need to set VARTEX, or that I should check my build for missing fonts?\n\n> \n> This was with vanilla and not s-o-g. I just did `make doc-pdf`. In doing that some japanese fonts could not be generated. I uncommented the `f cid-x.map` line although it could have been `f ckx.map` in order to get the build to complete.\n\n\nIt was `%f  cid-x.map ` that I had to uncomment.",
    "created_at": "2017-03-18T04:55:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22252#issuecomment-305570",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:46'></a>Replying to [comment:45 strogdon]:
> Replying to [comment:44 fbissey]:
> > Replying to [comment:43 strogdon]:
> > > `/usr/bin/extractbb` is pulled in by `app-text/texlive-core-2015-r1`. The only thing I had to do is uncomment
> > > 
> > > 
> > > ```
> > > %f  cid-x.map
> > > ```
> > > 
> > > in `/etc/texmf/dvipdfmx.d/dvipdfmx.cfg` so certain fonts could be generated.
> > > 

> > 
> > Can you elaborate Steve? Do you mean that after doing that change the fonts are installed and you don't need to set VARTEX, or that I should check my build for missing fonts?

> 
> This was with vanilla and not s-o-g. I just did `make doc-pdf`. In doing that some japanese fonts could not be generated. I uncommented the `f cid-x.map` line although it could have been `f ckx.map` in order to get the build to complete.


It was `%f  cid-x.map ` that I had to uncomment.



---

archive/issue_comments_305571.json:
```json
{
    "body": "<a id='comment:47'></a>Still commented here, and yet I completed the build of the pdf documentation succesfully\n\n```\n%% Put additional fontmap files here (usually for Type0 fonts)\n%f  cid-x.map\n\n% the following file is generated by updmap(-sys) from the \n% KanjiMap entries in the updmap.cfg file.\nf kanjix.map\n% minimal example for Chinese and Korean users\n% improvements please to tex-live@tug.org\nf ckx.map\n```",
    "created_at": "2017-03-18T05:40:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22252#issuecomment-305571",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:47'></a>Still commented here, and yet I completed the build of the pdf documentation succesfully

```
%% Put additional fontmap files here (usually for Type0 fonts)
%f  cid-x.map

% the following file is generated by updmap(-sys) from the 
% KanjiMap entries in the updmap.cfg file.
f kanjix.map
% minimal example for Chinese and Korean users
% improvements please to tex-live@tug.org
f ckx.map
```



---

archive/issue_comments_305572.json:
```json
{
    "body": "<a id='comment:48'></a>Replying to [comment:47 fbissey]:\n> Still commented here, and yet I completed the build of the pdf documentation succesfully\n> \n> ```\n> %% Put additional fontmap files here (usually for Type0 fonts)\n> %f  cid-x.map\n> \n> % the following file is generated by updmap(-sys) from the \n> % KanjiMap entries in the updmap.cfg file.\n> f kanjix.map\n> % minimal example for Chinese and Korean users\n> % improvements please to tex-live@tug.org\n> f ckx.map\n> ```\n\nI don't think there is an issue. I'm redoing things. It will take a while. Things are quite slow.",
    "created_at": "2017-03-18T05:47:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22252#issuecomment-305572",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:48'></a>Replying to [comment:47 fbissey]:
> Still commented here, and yet I completed the build of the pdf documentation succesfully
> 
> ```
> %% Put additional fontmap files here (usually for Type0 fonts)
> %f  cid-x.map
> 
> % the following file is generated by updmap(-sys) from the 
> % KanjiMap entries in the updmap.cfg file.
> f kanjix.map
> % minimal example for Chinese and Korean users
> % improvements please to tex-live@tug.org
> f ckx.map
> ```

I don't think there is an issue. I'm redoing things. It will take a while. Things are quite slow.



---

archive/issue_comments_305573.json:
```json
{
    "body": "<a id='comment:49'></a>OK, with `f cid-x.map` commented out I get\n\n```\nmktexpk --mfmode / --bdpi 600 --mag 2+180/600 --dpi 1380 gbm\n```\nin `ja/tutorial/missfont.log` when building `ja/tutorial/tutorial-jp.pdf` and I see\n\n```\n[docpdf] > <./a2tag.png> <./1.pngtutorial-jp.dvi -> tutorial-jp.pdf\n[docpdf] > <./ab2tag.png>][1 [277\n[docpdf] kpathsea: Running mktexpk --mfmode / --bdpi 600 --mag 2+180/600 --dpi 1380 gbm\n\n...\n\n[docpdf] Underfull \\hbox (badness 10000) in paragraph at lines 22578--22581\n[docpdf] []\\T1/ptm/m/n/10 For de-tails, see \\T1/pcr/m/n/10 ModulesWithBasis.ParentMethod\n[docpdf] s.module_morphism() \\T1/ptm/m/n/10 (and also \\T1/pcr/m/n/10 sage.\n[docpdf] [327] [328] [329] [330] [331] [332] [333] [334] [335] [336] [337] [338]gsftopk: fatal: map file `psfonts.cmz' not found.\n[docpdf] \n[docpdf] Underfull \\hbox (badness 7888) in paragraph at lines 23459--23467\n[docpdf] []\\T1/ptm/m/n/10 Again I rec-om-mend this [][]$http : / / www . scipy . org / W\n[docpdf] iki / Documentation ? action = AttachFile & do = get & target = scipy _\n[docpdf] [339] [340] [341] [342] [343]mktexpk: don't know how to create bitmap font for gbm.\n[docpdf] mktexpk: perhaps gbm is missing from the map file.\n[docpdf] kpathsea: Appending font creation commands to missfont.log.\n[docpdf] \n[docpdf] dvipdfmx:warning: Could not locate a virtual/physical font for TFM \"gbm\".\n[docpdf] dvipdfmx:warning: >> There are no valid font mapping entry for this font.\n[docpdf] dvipdfmx:warning: >> Font file name \"gbm\" was assumed but failed to locate that font.\n[docpdf] dvipdfmx:fatal: Cannot proceed without .vf or \"physical\" font for PDF output...\n[docpdf] \n[docpdf] Output file removed.\n[docpdf] make[2]: *** [Makefile:35: all-pdf-ja] Error 1\n[docpdf] make[2]: Leaving directory '/64bitdev/storage/sage-git_develop/sage/local/share/doc/sage/latex/ja/tutorial'\n```\n\nThe same `missfont.log` file is in `ja/a_tour_of_sage`. If I uncomment `%f cid-x.map` then everything builds. I'm not sure what's up but I can make the pdfs to build. I guess it's possible that since I didn't do\n\n```\nL10N=\"ca de en fr hu it ja pt ru tr\" USE=extra emerge -1Nv texlive\n```\nI manually installed the packages - that that could be the difference? The only difference on my system is that `app-text/texlive-2015` would be rebuilt with `L10N=\"ca* de* en fr hu* it* ja* pt* ru* tr*`. But all the extra languages are installed.",
    "created_at": "2017-03-18T17:48:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22252#issuecomment-305573",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:49'></a>OK, with `f cid-x.map` commented out I get

```
mktexpk --mfmode / --bdpi 600 --mag 2+180/600 --dpi 1380 gbm
```
in `ja/tutorial/missfont.log` when building `ja/tutorial/tutorial-jp.pdf` and I see

```
[docpdf] > <./a2tag.png> <./1.pngtutorial-jp.dvi -> tutorial-jp.pdf
[docpdf] > <./ab2tag.png>][1 [277
[docpdf] kpathsea: Running mktexpk --mfmode / --bdpi 600 --mag 2+180/600 --dpi 1380 gbm

...

[docpdf] Underfull \hbox (badness 10000) in paragraph at lines 22578--22581
[docpdf] []\T1/ptm/m/n/10 For de-tails, see \T1/pcr/m/n/10 ModulesWithBasis.ParentMethod
[docpdf] s.module_morphism() \T1/ptm/m/n/10 (and also \T1/pcr/m/n/10 sage.
[docpdf] [327] [328] [329] [330] [331] [332] [333] [334] [335] [336] [337] [338]gsftopk: fatal: map file `psfonts.cmz' not found.
[docpdf] 
[docpdf] Underfull \hbox (badness 7888) in paragraph at lines 23459--23467
[docpdf] []\T1/ptm/m/n/10 Again I rec-om-mend this [][]$http : / / www . scipy . org / W
[docpdf] iki / Documentation ? action = AttachFile & do = get & target = scipy _
[docpdf] [339] [340] [341] [342] [343]mktexpk: don't know how to create bitmap font for gbm.
[docpdf] mktexpk: perhaps gbm is missing from the map file.
[docpdf] kpathsea: Appending font creation commands to missfont.log.
[docpdf] 
[docpdf] dvipdfmx:warning: Could not locate a virtual/physical font for TFM "gbm".
[docpdf] dvipdfmx:warning: >> There are no valid font mapping entry for this font.
[docpdf] dvipdfmx:warning: >> Font file name "gbm" was assumed but failed to locate that font.
[docpdf] dvipdfmx:fatal: Cannot proceed without .vf or "physical" font for PDF output...
[docpdf] 
[docpdf] Output file removed.
[docpdf] make[2]: *** [Makefile:35: all-pdf-ja] Error 1
[docpdf] make[2]: Leaving directory '/64bitdev/storage/sage-git_develop/sage/local/share/doc/sage/latex/ja/tutorial'
```

The same `missfont.log` file is in `ja/a_tour_of_sage`. If I uncomment `%f cid-x.map` then everything builds. I'm not sure what's up but I can make the pdfs to build. I guess it's possible that since I didn't do

```
L10N="ca de en fr hu it ja pt ru tr" USE=extra emerge -1Nv texlive
```
I manually installed the packages - that that could be the difference? The only difference on my system is that `app-text/texlive-2015` would be rebuilt with `L10N="ca* de* en fr hu* it* ja* pt* ru* tr*`. But all the extra languages are installed.



---

archive/issue_comments_305574.json:
```json
{
    "body": "<a id='comment:50'></a>Since I had to build anew I also needed USE=\"cjk xetex\", but you would have been prompted for those I am sure. On the other hand I found `/usr/share/texmf-dist/fonts/tfm/ptex/dvips/gbm.tfm` on my system and it belongs to \n\n```\n$ equery b /usr/share/texmf-dist/fonts/tfm/ptex/dvips/gbm.tfm\n * Searching for /usr/share/texmf-dist/fonts/tfm/ptex/dvips/gbm.tfm ... \ndev-texlive/texlive-langjapanese-2015 (/usr/share/texmf-dist/fonts/tfm/ptex/dvips/gbm.tfm)\n```\nCan you check that you have that?",
    "created_at": "2017-03-18T19:28:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22252#issuecomment-305574",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:50'></a>Since I had to build anew I also needed USE="cjk xetex", but you would have been prompted for those I am sure. On the other hand I found `/usr/share/texmf-dist/fonts/tfm/ptex/dvips/gbm.tfm` on my system and it belongs to 

```
$ equery b /usr/share/texmf-dist/fonts/tfm/ptex/dvips/gbm.tfm
 * Searching for /usr/share/texmf-dist/fonts/tfm/ptex/dvips/gbm.tfm ... 
dev-texlive/texlive-langjapanese-2015 (/usr/share/texmf-dist/fonts/tfm/ptex/dvips/gbm.tfm)
```
Can you check that you have that?



---

archive/issue_comments_305575.json:
```json
{
    "body": "<a id='comment:51'></a>On another note: \n\n```\n  611  rm build/pkgs/sphinx/patches/latex_memory.patch \n  612  ./sage -f sphinx\n  613  make doc-clean\n  614  MAKE=\"make -j8\" make doc-pdf\n```\nSo I removed the `latex_memory` patch from sphinx, rebuild and the pdf doc build fine. So, at least on my system, it is unnecessary.",
    "created_at": "2017-03-18T20:18:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22252#issuecomment-305575",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:51'></a>On another note: 

```
  611  rm build/pkgs/sphinx/patches/latex_memory.patch 
  612  ./sage -f sphinx
  613  make doc-clean
  614  MAKE="make -j8" make doc-pdf
```
So I removed the `latex_memory` patch from sphinx, rebuild and the pdf doc build fine. So, at least on my system, it is unnecessary.



---

archive/issue_comments_305576.json:
```json
{
    "body": "<a id='comment:52'></a>Replying to [comment:50 fbissey]:\n> Since I had to build anew I also needed USE=\"cjk xetex\", but you would have been prompted for those I am sure. On the other hand I found `/usr/share/texmf-dist/fonts/tfm/ptex/dvips/gbm.tfm` on my system and it belongs to \n> \n> ```\n> $ equery b /usr/share/texmf-dist/fonts/tfm/ptex/dvips/gbm.tfm\n>  * Searching for /usr/share/texmf-dist/fonts/tfm/ptex/dvips/gbm.tfm ... \n> dev-texlive/texlive-langjapanese-2015 (/usr/share/texmf-dist/fonts/tfm/ptex/dvips/gbm.tfm)\n> ```\n> Can you check that you have that?\n\nYes, this file is on my system.",
    "created_at": "2017-03-18T20:44:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22252#issuecomment-305576",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:52'></a>Replying to [comment:50 fbissey]:
> Since I had to build anew I also needed USE="cjk xetex", but you would have been prompted for those I am sure. On the other hand I found `/usr/share/texmf-dist/fonts/tfm/ptex/dvips/gbm.tfm` on my system and it belongs to 
> 
> ```
> $ equery b /usr/share/texmf-dist/fonts/tfm/ptex/dvips/gbm.tfm
>  * Searching for /usr/share/texmf-dist/fonts/tfm/ptex/dvips/gbm.tfm ... 
> dev-texlive/texlive-langjapanese-2015 (/usr/share/texmf-dist/fonts/tfm/ptex/dvips/gbm.tfm)
> ```
> Can you check that you have that?

Yes, this file is on my system.



---

archive/issue_comments_305577.json:
```json
{
    "body": "<a id='comment:53'></a>Hum... I don't any of the stuff you quote in my log. I am wondering if it is because I have fonts (truetype not tex) that have japanase character sets on my system.\n\n```\n[I] media-fonts/arphicfonts (0.2.20080216.1-r2@14/02/17): Chinese TrueType Arphic Fonts\n[I] media-fonts/bitstream-cyberbit (2.0@14/02/17): Cyberbit Unicode (including CJK) font\n[I] media-fonts/corefonts (1-r7@14/02/17): Microsoft's TrueType core fonts\n[I] media-fonts/croscorefonts (1.23.0@14/02/17): Open licensed fonts metrically compatible with MS corefonts\n[I] media-fonts/dejavu (2.35@30/12/16): DejaVu fonts, bitstream vera with ISO-8859-2 characters\n[I] media-fonts/droid (113-r4@14/02/17): Font family from Google's Android project\n[I] media-fonts/encodings (1.0.4@30/12/16): X.Org font encodings\n[I] media-fonts/font-adobe-100dpi (1.0.3@14/02/17): X.Org Adobe bitmap fonts\n[I] media-fonts/font-adobe-75dpi (1.0.3@14/02/17): X.Org Adobe bitmap fonts\n[I] media-fonts/font-adobe-utopia-100dpi (1.0.4@14/02/17): X.Org Adobe Utopia bitmap fonts\n[I] media-fonts/font-alias (1.0.3-r1@14/02/17): X.Org font aliases\n[I] media-fonts/font-bh-lucidatypewriter-100dpi (1.0.3@14/02/17): X.Org Bigelow & Holmes Lucida bitmap fonts\n[I] media-fonts/font-misc-misc (1.1.2@14/02/17): X.Org miscellaneous fonts\n[I] media-fonts/font-util (1.3.1@30/12/16): X.Org font utilities\n[I] media-fonts/hack (2.020@30/12/16): A typeface designed for source code\n[I] media-fonts/ipamonafont (1.0.8@14/02/17): Hacked version of IPA fonts, which is suitable for browsing 2ch\n[I] media-fonts/ja-ipafonts (003.02-r1@14/02/17): Japanese TrueType fonts developed by IPA (Information-technology Promotion Agency, Japan)\n[I] media-fonts/liberation-fonts (2.00.1-r1@30/12/16): A Helvetica/Times/Courier replacement TrueType font set, courtesy of Red Hat\n[I] media-fonts/libertine (5.3.0.20120702-r2@16/01/17): Fonts from the Linux Libertine Open Fonts Project\n[I] media-fonts/noto (20160305-r1@30/12/16): Google's font family that aims to support all the world's languages\n[I] media-fonts/stix-fonts (1.1.1@14/02/17): Comprehensive OpenType font set of mathematical symbols and alphabets\n[I] media-fonts/urw-fonts (2.4.9@30/12/16): free good quality fonts gpl'd by URW++\n[I] media-fonts/wqy-microhei (0.2.0_beta@14/02/17): A droid derived Sans-Serif style CJK font\n[I] media-fonts/wqy-zenhei (0.9.46@14/02/17): WenQuanYi Hei-Ti Style (sans-serif) Chinese outline font\n```",
    "created_at": "2017-03-18T21:17:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22252#issuecomment-305577",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:53'></a>Hum... I don't any of the stuff you quote in my log. I am wondering if it is because I have fonts (truetype not tex) that have japanase character sets on my system.

```
[I] media-fonts/arphicfonts (0.2.20080216.1-r2@14/02/17): Chinese TrueType Arphic Fonts
[I] media-fonts/bitstream-cyberbit (2.0@14/02/17): Cyberbit Unicode (including CJK) font
[I] media-fonts/corefonts (1-r7@14/02/17): Microsoft's TrueType core fonts
[I] media-fonts/croscorefonts (1.23.0@14/02/17): Open licensed fonts metrically compatible with MS corefonts
[I] media-fonts/dejavu (2.35@30/12/16): DejaVu fonts, bitstream vera with ISO-8859-2 characters
[I] media-fonts/droid (113-r4@14/02/17): Font family from Google's Android project
[I] media-fonts/encodings (1.0.4@30/12/16): X.Org font encodings
[I] media-fonts/font-adobe-100dpi (1.0.3@14/02/17): X.Org Adobe bitmap fonts
[I] media-fonts/font-adobe-75dpi (1.0.3@14/02/17): X.Org Adobe bitmap fonts
[I] media-fonts/font-adobe-utopia-100dpi (1.0.4@14/02/17): X.Org Adobe Utopia bitmap fonts
[I] media-fonts/font-alias (1.0.3-r1@14/02/17): X.Org font aliases
[I] media-fonts/font-bh-lucidatypewriter-100dpi (1.0.3@14/02/17): X.Org Bigelow & Holmes Lucida bitmap fonts
[I] media-fonts/font-misc-misc (1.1.2@14/02/17): X.Org miscellaneous fonts
[I] media-fonts/font-util (1.3.1@30/12/16): X.Org font utilities
[I] media-fonts/hack (2.020@30/12/16): A typeface designed for source code
[I] media-fonts/ipamonafont (1.0.8@14/02/17): Hacked version of IPA fonts, which is suitable for browsing 2ch
[I] media-fonts/ja-ipafonts (003.02-r1@14/02/17): Japanese TrueType fonts developed by IPA (Information-technology Promotion Agency, Japan)
[I] media-fonts/liberation-fonts (2.00.1-r1@30/12/16): A Helvetica/Times/Courier replacement TrueType font set, courtesy of Red Hat
[I] media-fonts/libertine (5.3.0.20120702-r2@16/01/17): Fonts from the Linux Libertine Open Fonts Project
[I] media-fonts/noto (20160305-r1@30/12/16): Google's font family that aims to support all the world's languages
[I] media-fonts/stix-fonts (1.1.1@14/02/17): Comprehensive OpenType font set of mathematical symbols and alphabets
[I] media-fonts/urw-fonts (2.4.9@30/12/16): free good quality fonts gpl'd by URW++
[I] media-fonts/wqy-microhei (0.2.0_beta@14/02/17): A droid derived Sans-Serif style CJK font
[I] media-fonts/wqy-zenhei (0.9.46@14/02/17): WenQuanYi Hei-Ti Style (sans-serif) Chinese outline font
```



---

archive/issue_comments_305578.json:
```json
{
    "body": "<a id='comment:54'></a>Replying to [comment:53 fbissey]:\n> Hum... I don't any of the stuff you quote in my log. I am wondering if it is because I have fonts (truetype not tex) that have japanase character sets on my system.\n  \nIt appears that, for whatever reason, I had a\n\n```\n~/.texlive/texmf-var/fonts/map/dvipdfmx/updmap/kanjix.map\n```\nfile that was getting in the way of the build. Moving the `texmf-var` folder out of the way and I appear to now have a sane build of the pdf docs.",
    "created_at": "2017-03-20T22:42:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22252#issuecomment-305578",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:54'></a>Replying to [comment:53 fbissey]:
> Hum... I don't any of the stuff you quote in my log. I am wondering if it is because I have fonts (truetype not tex) that have japanase character sets on my system.
  
It appears that, for whatever reason, I had a

```
~/.texlive/texmf-var/fonts/map/dvipdfmx/updmap/kanjix.map
```
file that was getting in the way of the build. Moving the `texmf-var` folder out of the way and I appear to now have a sane build of the pdf docs.



---

archive/issue_comments_305579.json:
```json
{
    "body": "<a id='comment:55'></a>Let me remind everybody that this ticket is about upgrading from Sphinx 1.4 to 1.5. Discussions about building docs in general can be good to have, but they do not belong on this ticket (unless there is a *regression*, i.e. something worked with Sphinx 1.4 but no longer works).",
    "created_at": "2017-03-21T08:47:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22252#issuecomment-305579",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:55'></a>Let me remind everybody that this ticket is about upgrading from Sphinx 1.4 to 1.5. Discussions about building docs in general can be good to have, but they do not belong on this ticket (unless there is a *regression*, i.e. something worked with Sphinx 1.4 but no longer works).



---

archive/issue_comments_305580.json:
```json
{
    "body": "<a id='comment:56'></a>Sorry for the noise Jeroen. We wanted to be sure we had the dependencies right.\n\nMy own experience here is that:\n1) doc, including pdf and japanese pdf, in particular, build fine\n2) it does so with or without `latex_memory.patch` so I guess we can drop it - unless someone has a different experience.\n\nI am happy for this ticket to be sent to the bots once the offending patch is removed - or someone shows it is needed in some cases.",
    "created_at": "2017-03-21T08:59:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22252#issuecomment-305580",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:56'></a>Sorry for the noise Jeroen. We wanted to be sure we had the dependencies right.

My own experience here is that:
1) doc, including pdf and japanese pdf, in particular, build fine
2) it does so with or without `latex_memory.patch` so I guess we can drop it - unless someone has a different experience.

I am happy for this ticket to be sent to the bots once the offending patch is removed - or someone shows it is needed in some cases.



---

archive/issue_comments_305581.json:
```json
{
    "body": "<a id='comment:57'></a>Replying to [comment:56 fbissey]:\n> it does so with or without `latex_memory.patch` so I guess we can drop it - unless someone has a different experience.\n\n\nCan we leave this to a follow-up ticket? The patch has been added in the past for a reason, so I'm not too keen to just drop it.",
    "created_at": "2017-03-21T09:09:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22252#issuecomment-305581",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:57'></a>Replying to [comment:56 fbissey]:
> it does so with or without `latex_memory.patch` so I guess we can drop it - unless someone has a different experience.


Can we leave this to a follow-up ticket? The patch has been added in the past for a reason, so I'm not too keen to just drop it.



---

archive/issue_comments_305582.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-03-21T09:13:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22252#issuecomment-305582",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_305583.json:
```json
{
    "body": "<a id='comment:58'></a>Replying to [comment:57 jdemeyer]:\n> Replying to [comment:56 fbissey]:\n> > it does so with or without `latex_memory.patch` so I guess we can drop it - unless someone has a different experience.\n\n> \n> Can we leave this to a follow-up ticket? The patch has been added in the past for a reason, so I'm not too keen to just drop it.\n\n\nI am happy with that, we may well discover that is needed on some platforms. Putting it in positive review.",
    "created_at": "2017-03-21T09:13:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22252#issuecomment-305583",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:58'></a>Replying to [comment:57 jdemeyer]:
> Replying to [comment:56 fbissey]:
> > it does so with or without `latex_memory.patch` so I guess we can drop it - unless someone has a different experience.

> 
> Can we leave this to a follow-up ticket? The patch has been added in the past for a reason, so I'm not too keen to just drop it.


I am happy with that, we may well discover that is needed on some platforms. Putting it in positive review.



---

archive/issue_comments_305584.json:
```json
{
    "body": "<a id='comment:59'></a>Replying to [comment:57 jdemeyer]:\n> Can we leave this to a follow-up ticket? The patch has been added in the past for a reason, so I'm not too keen to just drop it.\n\n\nSee #22660.",
    "created_at": "2017-03-21T09:15:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22252#issuecomment-305584",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:59'></a>Replying to [comment:57 jdemeyer]:
> Can we leave this to a follow-up ticket? The patch has been added in the past for a reason, so I'm not too keen to just drop it.


See #22660.



---

archive/issue_comments_305585.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-03-27T20:42:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22252#issuecomment-305585",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_058429.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-03-27T20:42:42Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/22252",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22252#event-58429"
}
```
