# Issue 22045: path_decomposition just returns vertex_separation output, it should derive the path decomposition instead

archive/issues_021808.json:
```json
{
    "assignees": [],
    "body": "Hi,\n\nI am new to contributing to sage, so please bear with me.\n\nCurrently **path_decomposition** for graphs (in sage/graphs/graph_decompositions/vertex_separation) is implemented as no more than a wrapper round the **vertex_separation** function. While there exists a\nclose relation between path decompositions and vertex separation it would be more\nnatural to have **path_decomposition** return the pathwidth and an actual path decomposition, versus the current behaviour of returning the vertex separation number and a linear ordering that achieves this vertex separation number.\n\nDue to Kinnersley [1], we know the vertex separation number is equal to the pathwidth and that there exists a simple mapping between a linear ordering for the vertex separation (number) of a graph and a path decomposition for the same graph. I already have an algorithm implementing this mapping on top of sage, \nbut I would like to see that the **path_decomposition** function in sage actually returns a path decomposition, along side the pathwidth.\nAlso, the current behaviour does not have much added\nvalue, if you wanted the pathwidth you could have just used the **vertex_separation** function.\n\nFinally as the algorithms to compute the vertex separation (number) and pathwidth run in exponential time the cost of doing the mapping (in O(|V|<sup>2</sup>|E|) time)\nis minor, and anybody wanting to forgo the cost of the mapping (because they are only interested in the pathwidth) could just call **vertex_separation** directly.\n\nI am currently compiling sage in the hope of creating a patch.\nPlease let me know if the ability to compute path decompositions would be considered a useful addition to sage.\n\nA question regarding stability in sage: would it be considered better to\nmodify the current **path_decomposition** function so as to return \nthe pathwidth and a path decomposition, or would the current behaviour be\nconsidered stable and hence there would need to be some separate function to derive the path decomposition?\n\n[1] **The vertex separation number of a graph equals its path-width**, Nancy G. Kinnersley, Information Processing Letters 42(6):345-350, 1992.\n\nKeywords: **vertexseparation, vertex_separation, pathdecomposition, path_decomposition, pathwidth**\n\nBranch/Commit: **[`39822e8`](https://github.com/sagemath/sagetrac-mirror/commit/39822e8772127bdd0b939d0bc5a01332977ae7f6)**\n\nReviewer: **Rolf Morel**\n\nAuthor: **David Coudert**\n\nComponent: **graph theory**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/22045_\n\n",
    "closed_at": "2017-01-23T22:52:16Z",
    "created_at": "2016-12-11T13:59:00Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20graph%20theory",
        "https://github.com/sagemath/sage/labels/p%3A%204%20%E2%80%93%20minor",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-7.5",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "path_decomposition just returns vertex_separation output, it should derive the path decomposition instead",
    "type": "issue",
    "updated_at": "2017-01-23T22:52:16Z",
    "url": "https://github.com/sagemath/sage/issues/22045",
    "user": "https://github.com/sagetrac-RMorel"
}
```
Hi,

I am new to contributing to sage, so please bear with me.

Currently **path_decomposition** for graphs (in sage/graphs/graph_decompositions/vertex_separation) is implemented as no more than a wrapper round the **vertex_separation** function. While there exists a
close relation between path decompositions and vertex separation it would be more
natural to have **path_decomposition** return the pathwidth and an actual path decomposition, versus the current behaviour of returning the vertex separation number and a linear ordering that achieves this vertex separation number.

Due to Kinnersley [1], we know the vertex separation number is equal to the pathwidth and that there exists a simple mapping between a linear ordering for the vertex separation (number) of a graph and a path decomposition for the same graph. I already have an algorithm implementing this mapping on top of sage, 
but I would like to see that the **path_decomposition** function in sage actually returns a path decomposition, along side the pathwidth.
Also, the current behaviour does not have much added
value, if you wanted the pathwidth you could have just used the **vertex_separation** function.

Finally as the algorithms to compute the vertex separation (number) and pathwidth run in exponential time the cost of doing the mapping (in O(|V|<sup>2</sup>|E|) time)
is minor, and anybody wanting to forgo the cost of the mapping (because they are only interested in the pathwidth) could just call **vertex_separation** directly.

I am currently compiling sage in the hope of creating a patch.
Please let me know if the ability to compute path decompositions would be considered a useful addition to sage.

A question regarding stability in sage: would it be considered better to
modify the current **path_decomposition** function so as to return 
the pathwidth and a path decomposition, or would the current behaviour be
considered stable and hence there would need to be some separate function to derive the path decomposition?

[1] **The vertex separation number of a graph equals its path-width**, Nancy G. Kinnersley, Information Processing Letters 42(6):345-350, 1992.

Keywords: **vertexseparation, vertex_separation, pathdecomposition, path_decomposition, pathwidth**

Branch/Commit: **[`39822e8`](https://github.com/sagemath/sagetrac-mirror/commit/39822e8772127bdd0b939d0bc5a01332977ae7f6)**

Reviewer: **Rolf Morel**

Author: **David Coudert**

Component: **graph theory**

_Issue created by migration from https://trac.sagemath.org/ticket/22045_





---

archive/issue_events_308725.json:
```json
{
    "actor": "https://github.com/sagetrac-RMorel",
    "created_at": "2016-12-11T13:59:00Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/22045",
    "milestone_number": null,
    "milestone_title": "sage-7.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22045#event-308725"
}
```



---

archive/issue_events_308726.json:
```json
{
    "actor": "https://github.com/sagetrac-RMorel",
    "created_at": "2016-12-11T13:59:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22045",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20graph%20theory",
    "label_color": "0000ff",
    "label_name": "c: graph theory",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22045#event-308726"
}
```



---

archive/issue_events_308727.json:
```json
{
    "actor": "https://github.com/sagetrac-RMorel",
    "created_at": "2016-12-11T13:59:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22045",
    "label": "https://github.com/sagemath/sage/labels/p%3A%204%20%E2%80%93%20minor",
    "label_color": "ffe799",
    "label_name": "p: 4 \u2013 minor",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22045#event-308727"
}
```



---

archive/issue_events_308728.json:
```json
{
    "actor": "https://github.com/sagetrac-RMorel",
    "created_at": "2016-12-11T13:59:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22045",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22045#event-308728"
}
```



---

archive/issue_comments_324930.json:
```json
{
    "body": "Changed keywords from **vertex separation, path decomposition, pathwitdh** to **\"vertex separation\", \"path decomposition\", pathwitdh**",
    "created_at": "2016-12-11T14:00:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22045#issuecomment-324930",
    "user": "https://github.com/sagetrac-RMorel"
}
```

Changed keywords from **vertex separation, path decomposition, pathwitdh** to **"vertex separation", "path decomposition", pathwitdh**



---

archive/issue_comments_324931.json:
```json
{
    "body": "Changed keywords from **\"vertex separation\", \"path decomposition\", pathwitdh** to **vertexseparation, vertex_separation, pathdecomposition, path_decomposition, pathwitdh**",
    "created_at": "2016-12-11T14:01:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22045#issuecomment-324931",
    "user": "https://github.com/sagetrac-RMorel"
}
```

Changed keywords from **"vertex separation", "path decomposition", pathwitdh** to **vertexseparation, vertex_separation, pathdecomposition, path_decomposition, pathwitdh**



---

archive/issue_comments_324932.json:
```json
{
    "body": "Changed keywords from **vertexseparation, vertex_separation, pathdecomposition, path_decomposition, pathwitdh** to **vertexseparation, vertex_separation, pathdecomposition, path_decomposition, pathwidth**",
    "created_at": "2016-12-11T14:09:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22045#issuecomment-324932",
    "user": "https://github.com/sagetrac-RMorel"
}
```

Changed keywords from **vertexseparation, vertex_separation, pathdecomposition, path_decomposition, pathwitdh** to **vertexseparation, vertex_separation, pathdecomposition, path_decomposition, pathwidth**



---

archive/issue_comments_324933.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nWelcome. I can certainly help here.\n\nWe could add a method `pathwidth` with similar behavior than `treewidth`. Then we can change the behavior of `path_decomposition` but we must add an appropriate warning message (decprecation?).\n\nWhat's your algorithm? the announced complexity seems excessive. I believe it can be done in `O(|V|*|E|)` or even `O(|E|)`.",
    "created_at": "2016-12-12T09:08:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22045#issuecomment-324933",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:4" align="right">comment:4</div>

Welcome. I can certainly help here.

We could add a method `pathwidth` with similar behavior than `treewidth`. Then we can change the behavior of `path_decomposition` but we must add an appropriate warning message (decprecation?).

What's your algorithm? the announced complexity seems excessive. I believe it can be done in `O(|V|*|E|)` or even `O(|E|)`.



---

archive/issue_comments_324934.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nYes, bringing `pathwidth` in line with the current `treewidth` API seems like an appropriate change as well.\n\nThe initial algorithm that I put together for decompositions is just a straightforward translation\nof the constructive proof for Theorem 3.1 in **The vertex separation number of a graph equals its path-width** by Kinnersley.\nHere is the function:\n\n```python\ndef decomposition1(g):\n    pw, l_ord = vertex_separation(g)\n    decomp = []\n    def l_cut(i):\n        for j in range(i + 1):\n            if any(n in l_ord[i+1:] for n in g.neighbors(l_ord[j])):\n                yield l_ord[j]\n    for i, i_node in enumerate(l_ord):\n        decomp.append([i_node] + list(l_cut(i-1)))\n    return pw, decomp\n```\n\nI had not considered efficiency much (yet) for the above algorithm, but due to your comment I came up with a `O(pw(G)*|V| + |E|)` algorithm. It builds on the previous algorithm. The first idea is to keep track of the maximum linear ordering index of a connected node per vertex, which makes it an \namortized `O(1)` lookup whether a vertex at index `j` connects to another vertex at some index `m` of the ordering with `m > i` for any position `i` within the ordering (which is essentially the check in `l_cut`).\n\nFor constructing a `bag_i` for a vertex at index `i` in the ordering we again consider all\nnodes before `i` in the ordering but now we exploit the property of path decompositions that\nif a bag shares vertices with a previous bag, then all intermediate bags must also contain those\nvertices. So in particular the previous bag must contain all nodes that are in `bag_i` (except for the node at `i`) and before `i` in the ordering. So it suffices to check if the vertices of the previous bag are (still) connected to vertices beyond `i` in the ordering.\n\n(Note that the current psuedo code assumes undirected edges.)\n\n```python\ndef decomposition2(g):\n    pw, l_ord = vertex_separation(g)\n    \n    decomp = []\n    l_ord_inv = {v : i for i, v in enumerate(l_ord)}\n    max_l_ord_idx_of_neighs = {}\n    for u, v, label in g.edges():\n        old_max_u = max_l_ord_idx_of_neighs.get(u, l_ord_inv[u])\n        max_u = max(l_ord_inv[v], old_max_u)\n        max_l_ord_idx_of_neighs[u] = max_u\n        old_max_v = max_l_ord_idx_of_neighs.get(v, l_ord_inv[v])\n        max_v = max(l_ord_inv[u], old_max_v)\n        max_l_ord_idx_of_neighs[v] = max_v\n    \n    for i in range(len(l_ord)):\n        bag_i = [l_ord[i]]\n        prev_bag = decomp[i-1] if i >= 1 else []\n        for vert_prev_bag in prev_bag:\n            if max_l_ord_idx_of_neighs[vert_prev_bag] >= i:\n                bag_i.append(vert_prev_bag)\n        decomp.append(bag_i)\n    return pw, decomp\n```\n\nThere might still be some clever tricks to get the runtime further down, but versus the runtime\nof `vertrex_separation` it does not seem worth the effort.\n\nNote that while these functions give correct path decompositions they produce `|V|` bags, while\nsometimes it is possible to do with less. A simple algorithm to produce less bags is to check for each bag (consecutively) if it is a proper subset of the next bag. Would this be a worthwhile addition?\n\nAnd finally, any pointers for contributing the code to `sage`?",
    "created_at": "2016-12-12T16:10:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22045#issuecomment-324934",
    "user": "https://github.com/sagetrac-RMorel"
}
```

<div id="comment:5" align="right">comment:5</div>

Yes, bringing `pathwidth` in line with the current `treewidth` API seems like an appropriate change as well.

The initial algorithm that I put together for decompositions is just a straightforward translation
of the constructive proof for Theorem 3.1 in **The vertex separation number of a graph equals its path-width** by Kinnersley.
Here is the function:

```python
def decomposition1(g):
    pw, l_ord = vertex_separation(g)
    decomp = []
    def l_cut(i):
        for j in range(i + 1):
            if any(n in l_ord[i+1:] for n in g.neighbors(l_ord[j])):
                yield l_ord[j]
    for i, i_node in enumerate(l_ord):
        decomp.append([i_node] + list(l_cut(i-1)))
    return pw, decomp
```

I had not considered efficiency much (yet) for the above algorithm, but due to your comment I came up with a `O(pw(G)*|V| + |E|)` algorithm. It builds on the previous algorithm. The first idea is to keep track of the maximum linear ordering index of a connected node per vertex, which makes it an 
amortized `O(1)` lookup whether a vertex at index `j` connects to another vertex at some index `m` of the ordering with `m > i` for any position `i` within the ordering (which is essentially the check in `l_cut`).

For constructing a `bag_i` for a vertex at index `i` in the ordering we again consider all
nodes before `i` in the ordering but now we exploit the property of path decompositions that
if a bag shares vertices with a previous bag, then all intermediate bags must also contain those
vertices. So in particular the previous bag must contain all nodes that are in `bag_i` (except for the node at `i`) and before `i` in the ordering. So it suffices to check if the vertices of the previous bag are (still) connected to vertices beyond `i` in the ordering.

(Note that the current psuedo code assumes undirected edges.)

```python
def decomposition2(g):
    pw, l_ord = vertex_separation(g)
    
    decomp = []
    l_ord_inv = {v : i for i, v in enumerate(l_ord)}
    max_l_ord_idx_of_neighs = {}
    for u, v, label in g.edges():
        old_max_u = max_l_ord_idx_of_neighs.get(u, l_ord_inv[u])
        max_u = max(l_ord_inv[v], old_max_u)
        max_l_ord_idx_of_neighs[u] = max_u
        old_max_v = max_l_ord_idx_of_neighs.get(v, l_ord_inv[v])
        max_v = max(l_ord_inv[u], old_max_v)
        max_l_ord_idx_of_neighs[v] = max_v
    
    for i in range(len(l_ord)):
        bag_i = [l_ord[i]]
        prev_bag = decomp[i-1] if i >= 1 else []
        for vert_prev_bag in prev_bag:
            if max_l_ord_idx_of_neighs[vert_prev_bag] >= i:
                bag_i.append(vert_prev_bag)
        decomp.append(bag_i)
    return pw, decomp
```

There might still be some clever tricks to get the runtime further down, but versus the runtime
of `vertrex_separation` it does not seem worth the effort.

Note that while these functions give correct path decompositions they produce `|V|` bags, while
sometimes it is possible to do with less. A simple algorithm to produce less bags is to check for each bag (consecutively) if it is a proper subset of the next bag. Would this be a worthwhile addition?

And finally, any pointers for contributing the code to `sage`?



---

archive/issue_comments_324935.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nThere is something wrong with both methods, although the principle is good.\n\n```\nsage: G = graphs.PathGraph(5)\nsage: decomposition1(G)\n(1, [[0], [1, 0], [2, 1], [4, 2], [3, 2, 4]])\nsage: decomposition2(G)\n(1, [[0], [1, 0], [2, 1], [4, 2], [3, 4, 2]])\n```\n\nI prefer the following method. \n\n```python\ndef linear_ordering_to_path_decomposition(G, L):\n    \"\"\"\n    \"\"\"\n    from sage.graphs.graph_decompositions.vertex_separation import is_valid_ordering\n    if not is_valid_ordering(G, L):\n        raise ValueError(\"The input linear vertex ordering L is not valid for G.\")\n\n    seen    = set()  # already treated vertices\n    covered = set()  # vertices in the neighborhood of seen but not in seen\n    bags    = list() # The bags of the path decomposition\n\n    # We build the bags of the path-decomposition, and avoid adding useless bags\n    for u in L:\n    \tseen.add(u)\n        covered.update(G.neighbors(u))\n        covered.difference_update(seen)\n        new_bag = covered.union([u])\n        if bags:\n            if new_bag.issubset(bags[-1]):\n                continue\n            if new_bag.issuperset(bags[-1]):\n                bags.pop()\n\n        bags.append(new_bag)\n\n    # We now build a graph whose vertices are bags\n    H = Graph()\n    H.add_path([sage.sets.set.Set(bag) for bag in bags])\n    print bags\n\n    return H\n```\n\nTo start contributing, you can check http://doc.sagemath.org/html/en/developer/index.html and http://doc.sagemath.org/html/en/developer/manual_git.html\n\nSo you create a new git branch on your local sage installation. You do your changes (preferably with clear commits) and when you are ready, you push your changes to the trac server.\n\nIf you prefer, you can start as a reviewer: I do the changes and I soon as it's on the server, you can review it. You then have to check the code, try to install/compile on your system, play with it, check if it gives good answer, etc.\n\nLet me know.",
    "created_at": "2016-12-12T17:48:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22045#issuecomment-324935",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:6" align="right">comment:6</div>

There is something wrong with both methods, although the principle is good.

```
sage: G = graphs.PathGraph(5)
sage: decomposition1(G)
(1, [[0], [1, 0], [2, 1], [4, 2], [3, 2, 4]])
sage: decomposition2(G)
(1, [[0], [1, 0], [2, 1], [4, 2], [3, 4, 2]])
```

I prefer the following method. 

```python
def linear_ordering_to_path_decomposition(G, L):
    """
    """
    from sage.graphs.graph_decompositions.vertex_separation import is_valid_ordering
    if not is_valid_ordering(G, L):
        raise ValueError("The input linear vertex ordering L is not valid for G.")

    seen    = set()  # already treated vertices
    covered = set()  # vertices in the neighborhood of seen but not in seen
    bags    = list() # The bags of the path decomposition

    # We build the bags of the path-decomposition, and avoid adding useless bags
    for u in L:
    	seen.add(u)
        covered.update(G.neighbors(u))
        covered.difference_update(seen)
        new_bag = covered.union([u])
        if bags:
            if new_bag.issubset(bags[-1]):
                continue
            if new_bag.issuperset(bags[-1]):
                bags.pop()

        bags.append(new_bag)

    # We now build a graph whose vertices are bags
    H = Graph()
    H.add_path([sage.sets.set.Set(bag) for bag in bags])
    print bags

    return H
```

To start contributing, you can check http://doc.sagemath.org/html/en/developer/index.html and http://doc.sagemath.org/html/en/developer/manual_git.html

So you create a new git branch on your local sage installation. You do your changes (preferably with clear commits) and when you are ready, you push your changes to the trac server.

If you prefer, you can start as a reviewer: I do the changes and I soon as it's on the server, you can review it. You then have to check the code, try to install/compile on your system, play with it, check if it gives good answer, etc.

Let me know.



---

archive/issue_comments_324936.json:
```json
{
    "body": "Commit: **[`39822e8`](https://github.com/sagemath/sagetrac-mirror/commit/39822e8772127bdd0b939d0bc5a01332977ae7f6)**",
    "created_at": "2016-12-13T09:30:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22045#issuecomment-324936",
    "user": "https://github.com/dcoudert"
}
```

Commit: **[`39822e8`](https://github.com/sagemath/sagetrac-mirror/commit/39822e8772127bdd0b939d0bc5a01332977ae7f6)**



---

archive/issue_events_308729.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2016-12-13T09:30:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22045",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22045#event-308729"
}
```



---

archive/issue_comments_324937.json:
```json
{
    "body": "Branch: **[u/dcoudert/pathwidth](https://github.com/sagemath/sagetrac-mirror/tree/u/dcoudert/pathwidth)**",
    "created_at": "2016-12-13T09:30:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22045#issuecomment-324937",
    "user": "https://github.com/dcoudert"
}
```

Branch: **[u/dcoudert/pathwidth](https://github.com/sagemath/sagetrac-mirror/tree/u/dcoudert/pathwidth)**



---

archive/issue_comments_324938.json:
```json
{
    "body": "Author: **David Coudert**",
    "created_at": "2016-12-13T09:30:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22045#issuecomment-324938",
    "user": "https://github.com/dcoudert"
}
```

Author: **David Coudert**



---

archive/issue_comments_324939.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nI have pushed a proposal for discussed issues: expose method pathwidth with similar behavior than treewidth. Let me know if something is missing.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/65cadd266a7f9b229255d1ad3ba70bc59541ae75\">65cadd2</a></td><td><code>trac #22045: add method to compute a path decomposition from an ordering</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a64a67cf59ffb43a194c33a70cf9140a8c7ad9bc\">a64a67c</a></td><td><code>trac #22045: add method to compute pathwidth</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/44cbb149b9f33a467a4d4b905028793705c3d768\">44cbb14</a></td><td><code>trac #22045: expose method pathwidth for graphs</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/39822e8772127bdd0b939d0bc5a01332977ae7f6\">39822e8</a></td><td><code>trac #22045: fix doc and examples</code></td></tr></table>\n",
    "created_at": "2016-12-13T09:30:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22045#issuecomment-324939",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:7" align="right">comment:7</div>

I have pushed a proposal for discussed issues: expose method pathwidth with similar behavior than treewidth. Let me know if something is missing.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/65cadd266a7f9b229255d1ad3ba70bc59541ae75">65cadd2</a></td><td><code>trac #22045: add method to compute a path decomposition from an ordering</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a64a67cf59ffb43a194c33a70cf9140a8c7ad9bc">a64a67c</a></td><td><code>trac #22045: add method to compute pathwidth</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/44cbb149b9f33a467a4d4b905028793705c3d768">44cbb14</a></td><td><code>trac #22045: expose method pathwidth for graphs</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/39822e8772127bdd0b939d0bc5a01332977ae7f6">39822e8</a></td><td><code>trac #22045: fix doc and examples</code></td></tr></table>




---

archive/issue_comments_324940.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nThe problem that you identified with the functions seems to originate from the `vertex_separation` function. While the vertex separation number is correct (for the path graphs) the linear ordering\nthat is returned does not seems like a proper witness/certificate to this vertex separation number.\n\n```\nsage: G = graphs.PathGraph(3)\nsage: G.edges()\n[(0, 1, None), (1, 2, None)]\nsage: vertex_separation_BAB(G)  # correct vertex separation number, incorrect ordering\n(1, [0, 2, 1])\nsage: vertex_separation_MILP(G) # correct vertex separation number, incorrect ordering\n(1, [0, 2, 1])\nsage: vertex_separation_exp(G)  # correct vertex separation number, and correct ordering\n(1, [0, 1, 2])\n```\n\nNote that for the Branch and Bound and MILP algorithms the ordering has node 2 in the middle, \nwhich means that both it and node 0 to the left of it have a neighbor to the right of node 2, namely node 1 (third in the ordering). So by the definition of vertex separation (of an ordering) the vertex separation for this ordering is 2. While the exponential algorithm gives the correct witness to\nthe vertex separation number being equal to 1.\n\nUnless there is some kind of misunderstanding, it seems like the `vertex_separation_BAB` and `vertex_separation_MILP` do not give correct output. In particular sometimes they do not give back the linear ordering that acts as a witness to the vertex separation number that was found.\n\nIt seems prudent to me to first clear this up before looking into incorporating new code for\npath decompositions. \n\nWould very much like to know what is going on here.",
    "created_at": "2016-12-13T15:46:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22045#issuecomment-324940",
    "user": "https://github.com/sagetrac-RMorel"
}
```

<div id="comment:8" align="right">comment:8</div>

The problem that you identified with the functions seems to originate from the `vertex_separation` function. While the vertex separation number is correct (for the path graphs) the linear ordering
that is returned does not seems like a proper witness/certificate to this vertex separation number.

```
sage: G = graphs.PathGraph(3)
sage: G.edges()
[(0, 1, None), (1, 2, None)]
sage: vertex_separation_BAB(G)  # correct vertex separation number, incorrect ordering
(1, [0, 2, 1])
sage: vertex_separation_MILP(G) # correct vertex separation number, incorrect ordering
(1, [0, 2, 1])
sage: vertex_separation_exp(G)  # correct vertex separation number, and correct ordering
(1, [0, 1, 2])
```

Note that for the Branch and Bound and MILP algorithms the ordering has node 2 in the middle, 
which means that both it and node 0 to the left of it have a neighbor to the right of node 2, namely node 1 (third in the ordering). So by the definition of vertex separation (of an ordering) the vertex separation for this ordering is 2. While the exponential algorithm gives the correct witness to
the vertex separation number being equal to 1.

Unless there is some kind of misunderstanding, it seems like the `vertex_separation_BAB` and `vertex_separation_MILP` do not give correct output. In particular sometimes they do not give back the linear ordering that acts as a witness to the vertex separation number that was found.

It seems prudent to me to first clear this up before looking into incorporating new code for
path decompositions. 

Would very much like to know what is going on here.



---

archive/issue_comments_324941.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nThe way to measure the width of an ordering used in this module is clearly presented at the beginning of the module's documentation. It is equivalent to [1], up to reversing the ordering. I have to say that it is more intuitive for me to count the number of neighbors on the right of the nodes on the left, than the number of nodes of the left that have a neighbor on the right. The simple method I wrote to go from an ordering to a decomposition is based on this.\n\nIf you want your methods to return correct results, just add `l_ord.reverse()` inside.\n\n\n\n[1] Hans L. Bodlaender, Fedor V. Fomin, Arie M. C. A. Koster, Dieter Kratsch, Dimitrios M. Thilikos: A Note on Exact Algorithms for Vertex Ordering Problems on Graphs. Theory Comput. Syst. 50(3): 420-432 (2012) http://dx.doi.org/10.1007/s00224-011-9312-0",
    "created_at": "2016-12-13T16:14:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22045#issuecomment-324941",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:9" align="right">comment:9</div>

The way to measure the width of an ordering used in this module is clearly presented at the beginning of the module's documentation. It is equivalent to [1], up to reversing the ordering. I have to say that it is more intuitive for me to count the number of neighbors on the right of the nodes on the left, than the number of nodes of the left that have a neighbor on the right. The simple method I wrote to go from an ordering to a decomposition is based on this.

If you want your methods to return correct results, just add `l_ord.reverse()` inside.



[1] Hans L. Bodlaender, Fedor V. Fomin, Arie M. C. A. Koster, Dieter Kratsch, Dimitrios M. Thilikos: A Note on Exact Algorithms for Vertex Ordering Problems on Graphs. Theory Comput. Syst. 50(3): 420-432 (2012) http://dx.doi.org/10.1007/s00224-011-9312-0



---

archive/issue_comments_324942.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nAny help reviewing this patch is more than welcome.",
    "created_at": "2017-01-09T15:01:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22045#issuecomment-324942",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:10" align="right">comment:10</div>

Any help reviewing this patch is more than welcome.



---

archive/issue_comments_324943.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nApologies for taking so long to get back to this. I looked at it some time ago and didn't understand your algorithm (with the notion of the ordering reversed). Decided to get back to it later and that got postponed.\n\nThank you for clearing up the matter of the orderings. The vertex separations I tried on a my limited number of test graphs happened to be okay even if they were reversed and with only knowledge of the other definition I didn't look in detail at the definition given at the top of the file.\n\nI verified the properties of a path decomposition with pathwidth equal to the vertex separation for your algorithm and they are indeed fine. I ran the `pathwidth` method on a couple of graphs and this seems to work fine as well.\n\nSo, looks good to me.",
    "created_at": "2017-01-09T18:31:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22045#issuecomment-324943",
    "user": "https://github.com/sagetrac-RMorel"
}
```

<div id="comment:11" align="right">comment:11</div>

Apologies for taking so long to get back to this. I looked at it some time ago and didn't understand your algorithm (with the notion of the ordering reversed). Decided to get back to it later and that got postponed.

Thank you for clearing up the matter of the orderings. The vertex separations I tried on a my limited number of test graphs happened to be okay even if they were reversed and with only knowledge of the other definition I didn't look in detail at the definition given at the top of the file.

I verified the properties of a path decomposition with pathwidth equal to the vertex separation for your algorithm and they are indeed fine. I ran the `pathwidth` method on a couple of graphs and this seems to work fine as well.

So, looks good to me.



---

archive/issue_comments_324944.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nHave you tried to run the doc tests using a command like `sage -btp src/sage/graphs/graph_decompositions/vertex_separation.pyx` ? same with `graph.py` since this patch exposes the method for `Graph`. You can also try to build the doc using e.g. `sage -docbuild reference/graphs html` and check if it looks good.\nIf everything is ok, then you can set the patch to positive review, or let me know if I should improve something.\n\nIt will now be easier to verify if a graph is asteroidal triple free graphs then we have  treewidth = pathwidth ;)\n\nBy the way, I could change ref CMN14 with the journal version, but it's not so important.",
    "created_at": "2017-01-09T19:38:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22045#issuecomment-324944",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:12" align="right">comment:12</div>

Have you tried to run the doc tests using a command like `sage -btp src/sage/graphs/graph_decompositions/vertex_separation.pyx` ? same with `graph.py` since this patch exposes the method for `Graph`. You can also try to build the doc using e.g. `sage -docbuild reference/graphs html` and check if it looks good.
If everything is ok, then you can set the patch to positive review, or let me know if I should improve something.

It will now be easier to verify if a graph is asteroidal triple free graphs then we have  treewidth = pathwidth ;)

By the way, I could change ref CMN14 with the journal version, but it's not so important.



---

archive/issue_events_308730.json:
```json
{
    "actor": "https://github.com/sagetrac-RMorel",
    "created_at": "2017-01-09T19:57:46Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22045",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22045#event-308730"
}
```



---

archive/issue_events_308731.json:
```json
{
    "actor": "https://github.com/sagetrac-RMorel",
    "created_at": "2017-01-09T19:57:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22045",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22045#event-308731"
}
```



---

archive/issue_comments_324945.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nRan the tests you suggested and checked the documentation. All the tests passed and the docs look fine. Everything seems okay from here.",
    "created_at": "2017-01-09T19:57:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22045#issuecomment-324945",
    "user": "https://github.com/sagetrac-RMorel"
}
```

<div id="comment:13" align="right">comment:13</div>

Ran the tests you suggested and checked the documentation. All the tests passed and the docs look fine. Everything seems okay from here.



---

archive/issue_comments_324946.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nYou will need to put your real name as the reviewer.",
    "created_at": "2017-01-10T08:00:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22045#issuecomment-324946",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:14" align="right">comment:14</div>

You will need to put your real name as the reviewer.



---

archive/issue_comments_324947.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nI put my real name in the 'Reviewers' field.",
    "created_at": "2017-01-10T08:38:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22045#issuecomment-324947",
    "user": "https://github.com/sagetrac-RMorel"
}
```

<div id="comment:15" align="right">comment:15</div>

I put my real name in the 'Reviewers' field.



---

archive/issue_comments_324948.json:
```json
{
    "body": "Reviewer: **Rolf Morel**",
    "created_at": "2017-01-10T08:38:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22045#issuecomment-324948",
    "user": "https://github.com/sagetrac-RMorel"
}
```

Reviewer: **Rolf Morel**



---

archive/issue_comments_324949.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nThanks for the review.",
    "created_at": "2017-01-10T08:42:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22045#issuecomment-324949",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:16" align="right">comment:16</div>

Thanks for the review.



---

archive/issue_comments_324950.json:
```json
{
    "body": "Changed branch from **[u/dcoudert/pathwidth](https://github.com/sagemath/sagetrac-mirror/tree/u/dcoudert/pathwidth)** to **[`39822e8`](https://github.com/sagemath/sagetrac-mirror/commit/39822e8772127bdd0b939d0bc5a01332977ae7f6)**",
    "created_at": "2017-01-23T22:52:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22045#issuecomment-324950",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/dcoudert/pathwidth](https://github.com/sagemath/sagetrac-mirror/tree/u/dcoudert/pathwidth)** to **[`39822e8`](https://github.com/sagemath/sagetrac-mirror/commit/39822e8772127bdd0b939d0bc5a01332977ae7f6)**



---

archive/issue_events_308732.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-01-23T22:52:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22045",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22045#event-308732"
}
```



---

archive/issue_events_308733.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "dd978867c20625cc6438e580f38fa79316736f99",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2017-01-23T22:52:16Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/22045",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22045#event-308733"
}
```
