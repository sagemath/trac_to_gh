# Issue 22670: Make Three.js work offline redux

archive/issues_022433.json:
```json
{
    "assignees": [],
    "body": "The Three.js scripts used by various backends for offline viewing should be generated by methods in the backends, not in `plot3d/base.pyx`.\n\nContinuation of discussion after #22488 was closed.\n\nCC:  @novoselt @egourgoulhon\n\nBranch: **[`668eeee`](https://github.com/sagemath/sagetrac-mirror/commit/668eeee7f0f03c5c2ccfb44f33925fabaf28a63c)**\n\nReviewer: **Andrey Novoseltsev, Paul Masson**\n\nAuthor: **Paul Masson, Andrey Novoseltsev**\n\nComponent: **graphics**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/22670_\n\n",
    "closed_at": "2017-04-07T22:24:02Z",
    "created_at": "2017-03-21T23:50:15Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20graphics",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.0",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Make Three.js work offline redux",
    "type": "issue",
    "updated_at": "2018-06-26T11:55:41Z",
    "url": "https://github.com/sagemath/sage/issues/22670",
    "user": "https://github.com/paulmasson"
}
```
The Three.js scripts used by various backends for offline viewing should be generated by methods in the backends, not in `plot3d/base.pyx`.

Continuation of discussion after #22488 was closed.

CC:  @novoselt @egourgoulhon

Branch: **[`668eeee`](https://github.com/sagemath/sagetrac-mirror/commit/668eeee7f0f03c5c2ccfb44f33925fabaf28a63c)**

Reviewer: **Andrey Novoseltsev, Paul Masson**

Author: **Paul Masson, Andrey Novoseltsev**

Component: **graphics**

_Issue created by migration from https://trac.sagemath.org/ticket/22670_





---

archive/issue_events_316610.json:
```json
{
    "actor": "https://github.com/paulmasson",
    "created_at": "2017-03-21T23:50:15Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/22670",
    "milestone_number": null,
    "milestone_title": "sage-8.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22670#event-316610"
}
```



---

archive/issue_events_316611.json:
```json
{
    "actor": "https://github.com/paulmasson",
    "created_at": "2017-03-21T23:50:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22670",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20graphics",
    "label_color": "0000ff",
    "label_name": "c: graphics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22670#event-316611"
}
```



---

archive/issue_events_316612.json:
```json
{
    "actor": "https://github.com/paulmasson",
    "created_at": "2017-03-21T23:50:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22670",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22670#event-316612"
}
```



---

archive/issue_events_316613.json:
```json
{
    "actor": "https://github.com/paulmasson",
    "created_at": "2017-03-22T00:05:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22670",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22670#event-316613"
}
```



---

archive/issue_comments_336998.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,3 @@\n+The Three.js scripts used by various backends for offline viewing should be generated by methods in the backends, not in `plot3d/base.pyx`.\n \n+Continuation of discussion after #22488 was closed.\n``````\n",
    "created_at": "2017-03-22T00:05:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22670#issuecomment-336998",
    "user": "https://github.com/paulmasson"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,3 @@
+The Three.js scripts used by various backends for offline viewing should be generated by methods in the backends, not in `plot3d/base.pyx`.
 
+Continuation of discussion after #22488 was closed.
``````




---

archive/issue_comments_336999.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nSome more thoughts: we should avoid code duplication as much as feasible here so that we don't have to chase all places where the version of the threejs is used when we want to change it. Perhaps something like this will work:\n- generic method returns CDN scripts with `online=True` and throws an exception with `online=False`, these scripts include the version number\n- backend-specific implementation provide appropriate paths to Sage package (which does not include the version number), and if they have to include a fall-back CDN section, they do it by invoking the parent method with `online=True` and embed that string in appropriate places\n\nThis way when upgrading threejs package one has also to bump version number in the generic method (and perhaps it should be mentioned in `SPKG.txt`), but backend ones will likely never require tweaking.",
    "created_at": "2017-03-22T02:37:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22670#issuecomment-336999",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:2" align="right">comment:2</div>

Some more thoughts: we should avoid code duplication as much as feasible here so that we don't have to chase all places where the version of the threejs is used when we want to change it. Perhaps something like this will work:
- generic method returns CDN scripts with `online=True` and throws an exception with `online=False`, these scripts include the version number
- backend-specific implementation provide appropriate paths to Sage package (which does not include the version number), and if they have to include a fall-back CDN section, they do it by invoking the parent method with `online=True` and embed that string in appropriate places

This way when upgrading threejs package one has also to bump version number in the generic method (and perhaps it should be mentioned in `SPKG.txt`), but backend ones will likely never require tweaking.



---

archive/issue_comments_337000.json:
```json
{
    "body": "Branch: **[u/paulmasson/22670](https://github.com/sagemath/sagetrac-mirror/tree/u/paulmasson/22670)**",
    "created_at": "2017-03-31T22:38:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22670#issuecomment-337000",
    "user": "https://github.com/paulmasson"
}
```

Branch: **[u/paulmasson/22670](https://github.com/sagemath/sagetrac-mirror/tree/u/paulmasson/22670)**



---

archive/issue_comments_337001.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nAndrey, please have a look at this. I'm using the internal `installed_packages` table to read the version number where needed, so we'll only have to change it once in the package itself during upgrades. I didn't include an error test to make sure the package is installed since it's now standard and should always be present. The IPython notebook can't call the parent method as you'd like because that fallback is in the JavaScript, so it needs to look up the version as well, but then there will be no tweaking for upgrades.\n\nThere is currently a failing doctest for something called \"BackendDoctest\". I'll fix that once I know we're on the right track.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1d27bd099b05d720531e0882d52c67ad198b6807\">1d27bd0</a></td><td><code>Add methods for offline scripts</code></td></tr></table>\n",
    "created_at": "2017-03-31T22:46:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22670#issuecomment-337001",
    "user": "https://github.com/paulmasson"
}
```

<div id="comment:4" align="right">comment:4</div>

Andrey, please have a look at this. I'm using the internal `installed_packages` table to read the version number where needed, so we'll only have to change it once in the package itself during upgrades. I didn't include an error test to make sure the package is installed since it's now standard and should always be present. The IPython notebook can't call the parent method as you'd like because that fallback is in the JavaScript, so it needs to look up the version as well, but then there will be no tweaking for upgrades.

There is currently a failing doctest for something called "BackendDoctest". I'll fix that once I know we're on the right track.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1d27bd099b05d720531e0882d52c67ad198b6807">1d27bd0</a></td><td><code>Add methods for offline scripts</code></td></tr></table>




---

archive/issue_events_316614.json:
```json
{
    "actor": "https://github.com/paulmasson",
    "created_at": "2017-03-31T22:46:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22670",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22670#event-316614"
}
```



---

archive/issue_comments_337002.json:
```json
{
    "body": "Commit: **[`1d27bd0`](https://github.com/sagemath/sagetrac-mirror/commit/1d27bd099b05d720531e0882d52c67ad198b6807)**",
    "created_at": "2017-03-31T22:46:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22670#issuecomment-337002",
    "user": "https://github.com/paulmasson"
}
```

Commit: **[`1d27bd0`](https://github.com/sagemath/sagetrac-mirror/commit/1d27bd099b05d720531e0882d52c67ad198b6807)**



---

archive/issue_comments_337003.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nAutomatic version matching is great, thanks for figuring it out!\n\nIt still seems to me that in `base.pyx` it would be better to have just\n\n```python\nscripts = backend.threejs_scripts(options['online'])\n```\nwith the base backend class handling `True` case and more specific classes worrying about `False`. That way `BackendIPythonNotebook` could call parent method for extra bits instead of repeating the logic. Also, everything would be more in one place rather than the same thing split between `plot` and `repl`. But overall this design is already a nice improvement over current version.",
    "created_at": "2017-04-01T03:49:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22670#issuecomment-337003",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:5" align="right">comment:5</div>

Automatic version matching is great, thanks for figuring it out!

It still seems to me that in `base.pyx` it would be better to have just

```python
scripts = backend.threejs_scripts(options['online'])
```
with the base backend class handling `True` case and more specific classes worrying about `False`. That way `BackendIPythonNotebook` could call parent method for extra bits instead of repeating the logic. Also, everything would be more in one place rather than the same thing split between `plot` and `repl`. But overall this design is already a nice improvement over current version.



---

archive/issue_comments_337004.json:
```json
{
    "body": "Reviewer: **Andrey Novoseltsev**",
    "created_at": "2017-04-01T03:49:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22670#issuecomment-337004",
    "user": "https://github.com/novoselt"
}
```

Reviewer: **Andrey Novoseltsev**



---

archive/issue_comments_337005.json:
```json
{
    "body": "<div id=\"comment:7\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5c1c232846797d6fcfae891eef85019e4f532a02\">5c1c232</a></td><td><code>Move all script generation to backend</code></td></tr></table>\n",
    "created_at": "2017-04-02T00:58:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22670#issuecomment-337005",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:7"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5c1c232846797d6fcfae891eef85019e4f532a02">5c1c232</a></td><td><code>Move all script generation to backend</code></td></tr></table>




---

archive/issue_comments_337006.json:
```json
{
    "body": "Changed commit from **[`1d27bd0`](https://github.com/sagemath/sagetrac-mirror/commit/1d27bd099b05d720531e0882d52c67ad198b6807)** to **[`5c1c232`](https://github.com/sagemath/sagetrac-mirror/commit/5c1c232846797d6fcfae891eef85019e4f532a02)**",
    "created_at": "2017-04-02T00:58:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22670#issuecomment-337006",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`1d27bd0`](https://github.com/sagemath/sagetrac-mirror/commit/1d27bd099b05d720531e0882d52c67ad198b6807)** to **[`5c1c232`](https://github.com/sagemath/sagetrac-mirror/commit/5c1c232846797d6fcfae891eef85019e4f532a02)**



---

archive/issue_comments_337007.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nHopefully this is closer to what you had in mind.\n\nI've included an error test in the base method, but this causes a doctest in `plot3d/base.pyx` to fail even with the keyword argument set explicitly. Do you know why the doctesting process ignores the keyword argument?\n\nA workaround is to have the base method return an empty string when `online=False` but that's hardly desirable.",
    "created_at": "2017-04-02T01:07:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22670#issuecomment-337007",
    "user": "https://github.com/paulmasson"
}
```

<div id="comment:8" align="right">comment:8</div>

Hopefully this is closer to what you had in mind.

I've included an error test in the base method, but this causes a doctest in `plot3d/base.pyx` to fail even with the keyword argument set explicitly. Do you know why the doctesting process ignores the keyword argument?

A workaround is to have the base method return an empty string when `online=False` but that's hardly desirable.



---

archive/issue_comments_337008.json:
```json
{
    "body": "Changed branch from **[u/paulmasson/22670](https://github.com/sagemath/sagetrac-mirror/tree/u/paulmasson/22670)** to **[u/novoselt/22670](https://github.com/sagemath/sagetrac-mirror/tree/u/novoselt/22670)**",
    "created_at": "2017-04-02T18:45:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22670#issuecomment-337008",
    "user": "https://github.com/novoselt"
}
```

Changed branch from **[u/paulmasson/22670](https://github.com/sagemath/sagetrac-mirror/tree/u/paulmasson/22670)** to **[u/novoselt/22670](https://github.com/sagemath/sagetrac-mirror/tree/u/novoselt/22670)**



---

archive/issue_events_316615.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2017-04-02T18:48:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22670",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22670#event-316615"
}
```



---

archive/issue_events_316616.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2017-04-02T18:48:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22670",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22670#event-316616"
}
```



---

archive/issue_comments_337009.json:
```json
{
    "body": "Changed commit from **[`5c1c232`](https://github.com/sagemath/sagetrac-mirror/commit/5c1c232846797d6fcfae891eef85019e4f532a02)** to **[`6a4bdec`](https://github.com/sagemath/sagetrac-mirror/commit/6a4bdecfd82edc43fb3f024963378f069990a33d)**",
    "created_at": "2017-04-02T18:48:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22670#issuecomment-337009",
    "user": "https://github.com/novoselt"
}
```

Changed commit from **[`5c1c232`](https://github.com/sagemath/sagetrac-mirror/commit/5c1c232846797d6fcfae891eef85019e4f532a02)** to **[`6a4bdec`](https://github.com/sagemath/sagetrac-mirror/commit/6a4bdecfd82edc43fb3f024963378f069990a33d)**



---

archive/issue_comments_337010.json:
```json
{
    "body": "Work Issues: **option handling**",
    "created_at": "2017-04-02T18:48:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22670#issuecomment-337010",
    "user": "https://github.com/novoselt"
}
```

Work Issues: **option handling**



---

archive/issue_comments_337011.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nTweaked a bit backend code.\n\nRegarding option ignoring - that's because you ignore them instead of doing `opts = self._process_viewing_options(kwds)` as other methods ;-) I'm looking at how things work and hope to post a solution shortly, will be useful for my understanding of option handling.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6a4bdecfd82edc43fb3f024963378f069990a33d\">6a4bdec</a></td><td><code>Use a single copy of CDN threejs scripts</code></td></tr></table>\n",
    "created_at": "2017-04-02T18:48:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22670#issuecomment-337011",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:10" align="right">comment:10</div>

Tweaked a bit backend code.

Regarding option ignoring - that's because you ignore them instead of doing `opts = self._process_viewing_options(kwds)` as other methods ;-) I'm looking at how things work and hope to post a solution shortly, will be useful for my understanding of option handling.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6a4bdecfd82edc43fb3f024963378f069990a33d">6a4bdec</a></td><td><code>Use a single copy of CDN threejs scripts</code></td></tr></table>




---

archive/issue_comments_337012.json:
```json
{
    "body": "<div id=\"comment:11\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b73ce25630b98d1b6128d940c2bf6f970ad4a334\">b73ce25</a></td><td><code>Pick up constructor options for threejs rendering</code></td></tr></table>\n",
    "created_at": "2017-04-02T19:33:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22670#issuecomment-337012",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:11"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b73ce25630b98d1b6128d940c2bf6f970ad4a334">b73ce25</a></td><td><code>Pick up constructor options for threejs rendering</code></td></tr></table>




---

archive/issue_comments_337013.json:
```json
{
    "body": "Changed commit from **[`6a4bdec`](https://github.com/sagemath/sagetrac-mirror/commit/6a4bdecfd82edc43fb3f024963378f069990a33d)** to **[`b73ce25`](https://github.com/sagemath/sagetrac-mirror/commit/b73ce25630b98d1b6128d940c2bf6f970ad4a334)**",
    "created_at": "2017-04-02T19:33:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22670#issuecomment-337013",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`6a4bdec`](https://github.com/sagemath/sagetrac-mirror/commit/6a4bdecfd82edc43fb3f024963378f069990a33d)** to **[`b73ce25`](https://github.com/sagemath/sagetrac-mirror/commit/b73ce25630b98d1b6128d940c2bf6f970ad4a334)**



---

archive/issue_comments_337014.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nImproved option handing, but now the error is\n\n```\nFailed example:\n    sphere(online=True)._rich_repr_threejs()\nException raised:\n    Traceback (most recent call last):\n      File \"/home/novoselt/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 498, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/novoselt/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 861, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.plot.plot3d.base.Graphics3d._rich_repr_threejs[0]>\", line 1, in <module>\n        sphere(online=True)._rich_repr_threejs()\n      File \"sage/plot/plot3d/base.pyx\", line 424, in sage.plot.plot3d.base.Graphics3d._rich_repr_threejs (build/cythonized/sage/plot/plot3d/base.c:10615)\n        html = html.replace('SAGE_OPTIONS', json.dumps(options))\n      File \"/home/novoselt/sage/local/lib/python/json/__init__.py\", line 244, in dumps\n        return _default_encoder.encode(obj)\n      File \"/home/novoselt/sage/local/lib/python/json/encoder.py\", line 207, in encode\n        chunks = self.iterencode(o, _one_shot=True)\n      File \"/home/novoselt/sage/local/lib/python/json/encoder.py\", line 270, in iterencode\n        return _iterencode(o, 0)\n      File \"/home/novoselt/sage/local/lib/python/json/encoder.py\", line 184, in default\n        raise TypeError(repr(o) + \" is not JSON serializable\")\n    TypeError: Texture(texture42, 6666ff) is not JSON serializable\n```\nwhich makes me wonder why these options are sent to the output at all?..",
    "created_at": "2017-04-02T19:35:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22670#issuecomment-337014",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:12" align="right">comment:12</div>

Improved option handing, but now the error is

```
Failed example:
    sphere(online=True)._rich_repr_threejs()
Exception raised:
    Traceback (most recent call last):
      File "/home/novoselt/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 498, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/novoselt/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 861, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.plot.plot3d.base.Graphics3d._rich_repr_threejs[0]>", line 1, in <module>
        sphere(online=True)._rich_repr_threejs()
      File "sage/plot/plot3d/base.pyx", line 424, in sage.plot.plot3d.base.Graphics3d._rich_repr_threejs (build/cythonized/sage/plot/plot3d/base.c:10615)
        html = html.replace('SAGE_OPTIONS', json.dumps(options))
      File "/home/novoselt/sage/local/lib/python/json/__init__.py", line 244, in dumps
        return _default_encoder.encode(obj)
      File "/home/novoselt/sage/local/lib/python/json/encoder.py", line 207, in encode
        chunks = self.iterencode(o, _one_shot=True)
      File "/home/novoselt/sage/local/lib/python/json/encoder.py", line 270, in iterencode
        return _iterencode(o, 0)
      File "/home/novoselt/sage/local/lib/python/json/encoder.py", line 184, in default
        raise TypeError(repr(o) + " is not JSON serializable")
    TypeError: Texture(texture42, 6666ff) is not JSON serializable
```
which makes me wonder why these options are sent to the output at all?..



---

archive/issue_comments_337015.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nOK, looking at the template I see how they are used, but I am not sure what's the correct way to proceed: fix representation of texture option, drop if from threejs output, or send only options which are known to be used in JavaScript?",
    "created_at": "2017-04-02T19:38:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22670#issuecomment-337015",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:13" align="right">comment:13</div>

OK, looking at the template I see how they are used, but I am not sure what's the correct way to proceed: fix representation of texture option, drop if from threejs output, or send only options which are known to be used in JavaScript?



---

archive/issue_comments_337016.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nI don't see how invoking `_process_viewing_options(kwds)` fixes anything: all it appears to do is add a bunch of options that won't be used in JavaScript, at least not yet. Where is `online` actually getting passed on to the doctest backend with your changes?\n\nAll the other changes look good. And FYI `decimals` is Three.js specific.",
    "created_at": "2017-04-02T20:36:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22670#issuecomment-337016",
    "user": "https://github.com/paulmasson"
}
```

<div id="comment:14" align="right">comment:14</div>

I don't see how invoking `_process_viewing_options(kwds)` fixes anything: all it appears to do is add a bunch of options that won't be used in JavaScript, at least not yet. Where is `online` actually getting passed on to the doctest backend with your changes?

All the other changes look good. And FYI `decimals` is Three.js specific.



---

archive/issue_comments_337017.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nFYI the `options` explicitly set by me are the only ones used in the template, which is why I just created my own dictionary.",
    "created_at": "2017-04-02T20:44:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22670#issuecomment-337017",
    "user": "https://github.com/paulmasson"
}
```

<div id="comment:15" align="right">comment:15</div>

FYI the `options` explicitly set by me are the only ones used in the template, which is why I just created my own dictionary.



---

archive/issue_comments_337018.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\n`online=True` passed to the constructor is saved in the object, `_process_viewing_options` assembles default options, options passed to constructor, and options passed directly in `kwds`, it also does some normalization of them, so I am pretty sure it is \"the right thing\" to call it here as well. I've tried to mark `decimals` as Three.js specific - they are set there to a default if not passed via other means and then another section is dealing with type conversion.",
    "created_at": "2017-04-02T20:45:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22670#issuecomment-337018",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:16" align="right">comment:16</div>

`online=True` passed to the constructor is saved in the object, `_process_viewing_options` assembles default options, options passed to constructor, and options passed directly in `kwds`, it also does some normalization of them, so I am pretty sure it is "the right thing" to call it here as well. I've tried to mark `decimals` as Three.js specific - they are set there to a default if not passed via other means and then another section is dealing with type conversion.



---

archive/issue_comments_337019.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nReplying to [@paulmasson](#comment:15):\n> FYI the `options` explicitly set by me are the only ones used in the template, which is why I just created my own dictionary.\n\nBut you are using some of the options that are \"standard\" like `axes` and the problem was that it was not possible to pass threejs-specific options via standard means. So I am still convinced that my changes are on the right track. And it seems to me now that the next step is to keep only whitelisted options in this dictionary before sending them to template.",
    "created_at": "2017-04-02T20:47:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22670#issuecomment-337019",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:17" align="right">comment:17</div>

Replying to [@paulmasson](#comment:15):
> FYI the `options` explicitly set by me are the only ones used in the template, which is why I just created my own dictionary.

But you are using some of the options that are "standard" like `axes` and the problem was that it was not possible to pass threejs-specific options via standard means. So I am still convinced that my changes are on the right track. And it seems to me now that the next step is to keep only whitelisted options in this dictionary before sending them to template.



---

archive/issue_comments_337020.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nReplying to [@novoselt](#comment:17):\n> Replying to [@paulmasson](#comment:15):\n> > FYI the `options` explicitly set by me are the only ones used in the template, which is why I just created my own dictionary.\n\n> \n> But you are using some of the options that are \"standard\" like `axes` and the problem was that it was not possible to pass threejs-specific options via standard means. So I am still convinced that my changes are on the right track. And it seems to me now that the next step is to keep only whitelisted options in this dictionary before sending them to template.\n\nIf it gets things to work then good, but I'm not yet seeing the standard means. Sorry about the `decimals` mix up: was editing my statement when you responded. And one correction: `online` isn't used in the template so doesn't need to be whitelisted.",
    "created_at": "2017-04-02T20:57:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22670#issuecomment-337020",
    "user": "https://github.com/paulmasson"
}
```

<div id="comment:18" align="right">comment:18</div>

Replying to [@novoselt](#comment:17):
> Replying to [@paulmasson](#comment:15):
> > FYI the `options` explicitly set by me are the only ones used in the template, which is why I just created my own dictionary.

> 
> But you are using some of the options that are "standard" like `axes` and the problem was that it was not possible to pass threejs-specific options via standard means. So I am still convinced that my changes are on the right track. And it seems to me now that the next step is to keep only whitelisted options in this dictionary before sending them to template.

If it gets things to work then good, but I'm not yet seeing the standard means. Sorry about the `decimals` mix up: was editing my statement when you responded. And one correction: `online` isn't used in the template so doesn't need to be whitelisted.



---

archive/issue_comments_337021.json:
```json
{
    "body": "<div id=\"comment:19\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f5144256fd873eb051f174e4b86daf7abef1d4a5\">f514425</a></td><td><code>Do not embedd all Sage options into a threejs scene</code></td></tr></table>\n",
    "created_at": "2017-04-02T21:41:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22670#issuecomment-337021",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:19"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f5144256fd873eb051f174e4b86daf7abef1d4a5">f514425</a></td><td><code>Do not embedd all Sage options into a threejs scene</code></td></tr></table>




---

archive/issue_comments_337022.json:
```json
{
    "body": "Changed commit from **[`b73ce25`](https://github.com/sagemath/sagetrac-mirror/commit/b73ce25630b98d1b6128d940c2bf6f970ad4a334)** to **[`f514425`](https://github.com/sagemath/sagetrac-mirror/commit/f5144256fd873eb051f174e4b86daf7abef1d4a5)**",
    "created_at": "2017-04-02T21:41:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22670#issuecomment-337022",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`b73ce25`](https://github.com/sagemath/sagetrac-mirror/commit/b73ce25630b98d1b6128d940c2bf6f970ad4a334)** to **[`f514425`](https://github.com/sagemath/sagetrac-mirror/commit/f5144256fd873eb051f174e4b86daf7abef1d4a5)**



---

archive/issue_comments_337023.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nBy \"standard means\" I meant that this is how other similar functions process options: of the main interest to us is that it picks up options passed to constructor, but there is some extra logic to e.g. handle `aspect_ratio`. After all, in the ideal world there would be no backend/viewer specific options, e.g. why can't other viewers support `axes_labels`?\n\nAnyway, the last commit lets tests pass, but let me fiddle a little more with backends.",
    "created_at": "2017-04-02T21:42:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22670#issuecomment-337023",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:20" align="right">comment:20</div>

By "standard means" I meant that this is how other similar functions process options: of the main interest to us is that it picks up options passed to constructor, but there is some extra logic to e.g. handle `aspect_ratio`. After all, in the ideal world there would be no backend/viewer specific options, e.g. why can't other viewers support `axes_labels`?

Anyway, the last commit lets tests pass, but let me fiddle a little more with backends.



---

archive/issue_comments_337024.json:
```json
{
    "body": "Changed commit from **[`f514425`](https://github.com/sagemath/sagetrac-mirror/commit/f5144256fd873eb051f174e4b86daf7abef1d4a5)** to **[`e81038e`](https://github.com/sagemath/sagetrac-mirror/commit/e81038e11c2a0d8fbf289d65cf31c64f71862677)**",
    "created_at": "2017-04-02T22:10:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22670#issuecomment-337024",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`f514425`](https://github.com/sagemath/sagetrac-mirror/commit/f5144256fd873eb051f174e4b86daf7abef1d4a5)** to **[`e81038e`](https://github.com/sagemath/sagetrac-mirror/commit/e81038e11c2a0d8fbf289d65cf31c64f71862677)**



---

archive/issue_comments_337025.json:
```json
{
    "body": "<div id=\"comment:21\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e81038e11c2a0d8fbf289d65cf31c64f71862677\">e81038e</a></td><td><code>Do not access display backend directly from plot 3d</code></td></tr></table>\n",
    "created_at": "2017-04-02T22:10:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22670#issuecomment-337025",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:21"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e81038e11c2a0d8fbf289d65cf31c64f71862677">e81038e</a></td><td><code>Do not access display backend directly from plot 3d</code></td></tr></table>




---

archive/issue_comments_337026.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nThe use of `installed_packages` looks nifty in theory. It automates things nicely. The only problem with it, is that it depends on you using sagemath's packaging system in full. sage-on-distro or if we switch (cross fingers) to a more effective packaging solution this will just be in the way.\n\nAs a sage-on-distro person I disapprove of anything using `sage.misc.package` at runtime.\n\nI don't have a better solution at this stage. Are different release on the CDN all that different? Do they have some backward or forward compatibility?\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e81038e11c2a0d8fbf289d65cf31c64f71862677\">e81038e</a></td><td><code>Do not access display backend directly from plot 3d</code></td></tr></table>\n",
    "created_at": "2017-04-02T22:12:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22670#issuecomment-337026",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:22" align="right">comment:22</div>

The use of `installed_packages` looks nifty in theory. It automates things nicely. The only problem with it, is that it depends on you using sagemath's packaging system in full. sage-on-distro or if we switch (cross fingers) to a more effective packaging solution this will just be in the way.

As a sage-on-distro person I disapprove of anything using `sage.misc.package` at runtime.

I don't have a better solution at this stage. Are different release on the CDN all that different? Do they have some backward or forward compatibility?

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e81038e11c2a0d8fbf289d65cf31c64f71862677">e81038e</a></td><td><code>Do not access display backend directly from plot 3d</code></td></tr></table>




---

archive/issue_events_316617.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2017-04-02T22:16:19Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22670",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22670#event-316617"
}
```



---

archive/issue_events_316618.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2017-04-02T22:16:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22670",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22670#event-316618"
}
```



---

archive/issue_comments_337027.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nOK, how about this one? It still bugged me that `_backend` of display manager was accessed directly, so I moved the CDN method to `DisplayManager` and made backends responsible for offline case only as in your original version. It is somewhat ugly that they call that CDN method when handling offline case, but it is kind of due to things not done completely properly. Why SageNB is using CDN for offline case? Doesn't it have access to Sage installation which includes three.js?",
    "created_at": "2017-04-02T22:16:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22670#issuecomment-337027",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:23" align="right">comment:23</div>

OK, how about this one? It still bugged me that `_backend` of display manager was accessed directly, so I moved the CDN method to `DisplayManager` and made backends responsible for offline case only as in your original version. It is somewhat ugly that they call that CDN method when handling offline case, but it is kind of due to things not done completely properly. Why SageNB is using CDN for offline case? Doesn't it have access to Sage installation which includes three.js?



---

archive/issue_comments_337028.json:
```json
{
    "body": "Changed work issues from **option handling** to none",
    "created_at": "2017-04-02T22:16:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22670#issuecomment-337028",
    "user": "https://github.com/novoselt"
}
```

Changed work issues from **option handling** to none



---

archive/issue_comments_337029.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nRegarding CDN releases - in principle the version matters, although the problems are presumably more frequent when using old instead of new. So we may try to omit the version and use the master branch of threejs.",
    "created_at": "2017-04-02T22:18:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22670#issuecomment-337029",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:24" align="right">comment:24</div>

Regarding CDN releases - in principle the version matters, although the problems are presumably more frequent when using old instead of new. So we may try to omit the version and use the master branch of threejs.



---

archive/issue_comments_337030.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nReplying to [@novoselt](#comment:24):\n> Regarding CDN releases - in principle the version matters, although the problems are presumably more frequent when using old instead of new. So we may try to omit the version and use the master branch of threejs.\n\nWith Three.js the version number can matter greatly, unfortunately. Mr. Doob has made radical changes in the past that render the code not backward compatible. That doesn't happen too often but it will be an ongoing concern.",
    "created_at": "2017-04-02T23:46:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22670#issuecomment-337030",
    "user": "https://github.com/paulmasson"
}
```

<div id="comment:25" align="right">comment:25</div>

Replying to [@novoselt](#comment:24):
> Regarding CDN releases - in principle the version matters, although the problems are presumably more frequent when using old instead of new. So we may try to omit the version and use the master branch of threejs.

With Three.js the version number can matter greatly, unfortunately. Mr. Doob has made radical changes in the past that render the code not backward compatible. That doesn't happen too often but it will be an ongoing concern.



---

archive/issue_comments_337031.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nOK, possible solutions:\n1. Have hard-coded version number and add some comment to SPKG.txt as I originally proposed.\n2. Pick up the version number from the library file itself, presumably this is possible.\n3. Put an extra file together with the library into `share/threejs`\n4. =2+3: Pick up the version number from the library file and then write it into some file for speed. Or just some variable to avoid disk operations and access issues...",
    "created_at": "2017-04-02T23:51:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22670#issuecomment-337031",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:26" align="right">comment:26</div>

OK, possible solutions:
1. Have hard-coded version number and add some comment to SPKG.txt as I originally proposed.
2. Pick up the version number from the library file itself, presumably this is possible.
3. Put an extra file together with the library into `share/threejs`
4. =2+3: Pick up the version number from the library file and then write it into some file for speed. Or just some variable to avoid disk operations and access issues...



---

archive/issue_comments_337032.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nOptions 2,3 and 4 rely on theejs to be installed locally, a distro may very decide to make that optional (if at all - properly packaging this kind of stuff is a pain) and to rely on online availability by default.\n\nAlternative to (1) declare a variable in `sage.env.py` it could be migrated to a separate file installed by the spkg once we work out #22652. That method would be ok to me as I can supply an arbitrary extra file for my distro.",
    "created_at": "2017-04-02T23:59:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22670#issuecomment-337032",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:27" align="right">comment:27</div>

Options 2,3 and 4 rely on theejs to be installed locally, a distro may very decide to make that optional (if at all - properly packaging this kind of stuff is a pain) and to rely on online availability by default.

Alternative to (1) declare a variable in `sage.env.py` it could be migrated to a separate file installed by the spkg once we work out #22652. That method would be ok to me as I can supply an arbitrary extra file for my distro.



---

archive/issue_comments_337033.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nReplying to [@novoselt](#comment:23):\n> It still bugged me that `_backend` of display manager was accessed directly\n\nWhy is this a bad thing to do?\n> It is somewhat ugly that they call that CDN method when handling offline case, but it is kind of due to things not done completely properly.\n\nOnly the IPython notebook does this, to provide a fallback requested by Eric. How would you do this more properly?\n>Why SageNB is using CDN for offline case? Doesn't it have access to Sage installation which includes three.js?\n\nThe server directory to Three.js files doesn't exist in the current version of the notebook. A [pull request](https://github.com/sagemath/sagenb/pull/424) was merged to provide that and the method will be altered when a newer version of the notebook is available.\n\nCouple minor things:\n\n1) In display manager documentation, \"Three.js\" should be capitalized and \"offline\" is one word.\n\n2) I may want to reuse the `options` dictionary for handling future features, like setting iframe size from `figsize`, so it shouldn't be completely overwritten. Please introduce a different name on the next commit.",
    "created_at": "2017-04-03T00:09:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22670#issuecomment-337033",
    "user": "https://github.com/paulmasson"
}
```

<div id="comment:28" align="right">comment:28</div>

Replying to [@novoselt](#comment:23):
> It still bugged me that `_backend` of display manager was accessed directly

Why is this a bad thing to do?
> It is somewhat ugly that they call that CDN method when handling offline case, but it is kind of due to things not done completely properly.

Only the IPython notebook does this, to provide a fallback requested by Eric. How would you do this more properly?
>Why SageNB is using CDN for offline case? Doesn't it have access to Sage installation which includes three.js?

The server directory to Three.js files doesn't exist in the current version of the notebook. A [pull request](https://github.com/sagemath/sagenb/pull/424) was merged to provide that and the method will be altered when a newer version of the notebook is available.

Couple minor things:

1) In display manager documentation, "Three.js" should be capitalized and "offline" is one word.

2) I may want to reuse the `options` dictionary for handling future features, like setting iframe size from `figsize`, so it shouldn't be completely overwritten. Please introduce a different name on the next commit.



---

archive/issue_comments_337034.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nAndrey, scenes render for all three backends and both on/offline, but you've introduced a problem with IPython offline. The closing script tags need to be written as `<\\/script>` with the forward slash escaped to prevent the remainer of that line of code, the `');`, from printing in the cell above the scene. Please do a string replace before returning.",
    "created_at": "2017-04-03T00:23:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22670#issuecomment-337034",
    "user": "https://github.com/paulmasson"
}
```

<div id="comment:29" align="right">comment:29</div>

Andrey, scenes render for all three backends and both on/offline, but you've introduced a problem with IPython offline. The closing script tags need to be written as `<\/script>` with the forward slash escaped to prevent the remainer of that line of code, the `');`, from printing in the cell above the scene. Please do a string replace before returning.



---

archive/issue_comments_337035.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nReplying to [@kiwifb](#comment:27):\n> Options 2,3 and 4 rely on theejs to be installed locally, a distro may very decide to make that optional (if at all - properly packaging this kind of stuff is a pain) and to rely on online availability by default.\n> \n> Alternative to (1) declare a variable in `sage.env.py` it could be migrated to a separate file installed by the spkg once we work out #22652. That method would be ok to me as I can supply an arbitrary extra file for my distro.\n\nOur three.js package contrains only two files that we use instead of the whole repository, so it does not seem a big deal to me to keep it installed as part of Sage. In any case I think that for now (i.e. this ticket) we should keep it as is and modify to something else once (and if) it becomes a problem.",
    "created_at": "2017-04-03T00:53:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22670#issuecomment-337035",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:30" align="right">comment:30</div>

Replying to [@kiwifb](#comment:27):
> Options 2,3 and 4 rely on theejs to be installed locally, a distro may very decide to make that optional (if at all - properly packaging this kind of stuff is a pain) and to rely on online availability by default.
> 
> Alternative to (1) declare a variable in `sage.env.py` it could be migrated to a separate file installed by the spkg once we work out #22652. That method would be ok to me as I can supply an arbitrary extra file for my distro.

Our three.js package contrains only two files that we use instead of the whole repository, so it does not seem a big deal to me to keep it installed as part of Sage. In any case I think that for now (i.e. this ticket) we should keep it as is and modify to something else once (and if) it becomes a problem.



---

archive/issue_comments_337036.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nFor sage on its own, in its corner playing all alone, by itself, there is no problem. There is never a problem, you are self contained. I don't suggest you change the status standard package for threejs either. I am encouraging you to think of a bigger picture regarding package management when you are not on your little island.\n\nIt will be a problem for anyone doing sage-on-distro/conda as soon as it is merged. I probably should publicise this ticket on the `sage-packaging` mailing list and see what everyone think of the threejs business as it is now, since the current situation is hardly ideal either.",
    "created_at": "2017-04-03T01:05:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22670#issuecomment-337036",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:31" align="right">comment:31</div>

For sage on its own, in its corner playing all alone, by itself, there is no problem. There is never a problem, you are self contained. I don't suggest you change the status standard package for threejs either. I am encouraging you to think of a bigger picture regarding package management when you are not on your little island.

It will be a problem for anyone doing sage-on-distro/conda as soon as it is merged. I probably should publicise this ticket on the `sage-packaging` mailing list and see what everyone think of the threejs business as it is now, since the current situation is hardly ideal either.



---

archive/issue_comments_337037.json:
```json
{
    "body": "<div id=\"comment:32\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8d1b1555d032b999e2f779bd481544e2ec03d483\">8d1b155</a></td><td><code>Little fixes to threejs scripts handling</code></td></tr></table>\n",
    "created_at": "2017-04-03T01:08:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22670#issuecomment-337037",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:32"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8d1b1555d032b999e2f779bd481544e2ec03d483">8d1b155</a></td><td><code>Little fixes to threejs scripts handling</code></td></tr></table>




---

archive/issue_comments_337038.json:
```json
{
    "body": "Changed commit from **[`e81038e`](https://github.com/sagemath/sagetrac-mirror/commit/e81038e11c2a0d8fbf289d65cf31c64f71862677)** to **[`8d1b155`](https://github.com/sagemath/sagetrac-mirror/commit/8d1b1555d032b999e2f779bd481544e2ec03d483)**",
    "created_at": "2017-04-03T01:08:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22670#issuecomment-337038",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`e81038e`](https://github.com/sagemath/sagetrac-mirror/commit/e81038e11c2a0d8fbf289d65cf31c64f71862677)** to **[`8d1b155`](https://github.com/sagemath/sagetrac-mirror/commit/8d1b1555d032b999e2f779bd481544e2ec03d483)**



---

archive/issue_comments_337039.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nReplying to [@paulmasson](#comment:28):\n> Replying to [@novoselt](#comment:23):\n> > It still bugged me that `_backend` of display manager was accessed directly\n\n> Why is this a bad thing to do?\n\nBecause backends are supposed to be isolated! It was really, really painful to have a lot of places spread over Sage that were doing different things depending on the way it was launched and I would prefer none of them coming back ;-)\n> > It is somewhat ugly that they call that CDN method when handling offline case, but it is kind of due to things not done completely properly.\n\n> Only the IPython notebook does this, to provide a fallback requested by Eric. How would you do this more properly?\n\nNo how, it is just a bit unfortunate that this problem arises in the first place.\n> >Why SageNB is using CDN for offline case? Doesn't it have access to Sage installation which includes three.js?\n\n> The server directory to Three.js files doesn't exist in the current version of the notebook. A [pull request](https://github.com/sagemath/sagenb/pull/424) was merged to provide that and the method will be altered when a newer version of the notebook is available.\n\nGreat!\n> \n> Couple minor things:\n> \n> 1) In display manager documentation, \"Three.js\" should be capitalized and \"offline\" is one word.\n> \n\nFixed.\n> 2) I may want to reuse the `options` dictionary for handling future features, like setting iframe size from `figsize`, so it shouldn't be completely overwritten. Please introduce a different name on the next commit.\n\nThat's why I put this code right next to template filling, but different name works just as well, done.",
    "created_at": "2017-04-03T01:09:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22670#issuecomment-337039",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:33" align="right">comment:33</div>

Replying to [@paulmasson](#comment:28):
> Replying to [@novoselt](#comment:23):
> > It still bugged me that `_backend` of display manager was accessed directly

> Why is this a bad thing to do?

Because backends are supposed to be isolated! It was really, really painful to have a lot of places spread over Sage that were doing different things depending on the way it was launched and I would prefer none of them coming back ;-)
> > It is somewhat ugly that they call that CDN method when handling offline case, but it is kind of due to things not done completely properly.

> Only the IPython notebook does this, to provide a fallback requested by Eric. How would you do this more properly?

No how, it is just a bit unfortunate that this problem arises in the first place.
> >Why SageNB is using CDN for offline case? Doesn't it have access to Sage installation which includes three.js?

> The server directory to Three.js files doesn't exist in the current version of the notebook. A [pull request](https://github.com/sagemath/sagenb/pull/424) was merged to provide that and the method will be altered when a newer version of the notebook is available.

Great!
> 
> Couple minor things:
> 
> 1) In display manager documentation, "Three.js" should be capitalized and "offline" is one word.
> 

Fixed.
> 2) I may want to reuse the `options` dictionary for handling future features, like setting iframe size from `figsize`, so it shouldn't be completely overwritten. Please introduce a different name on the next commit.

That's why I put this code right next to template filling, but different name works just as well, done.



---

archive/issue_comments_337040.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nReplying to [@kiwifb](#comment:31):\n> For sage on its own, in its corner playing all alone, by itself, there is no problem. There is never a problem, you are self contained. I don't suggest you change the status standard package for threejs either. I am encouraging you to think of a bigger picture regarding package management when you are not on your little island.\n> \n> It will be a problem for anyone doing sage-on-distro/conda as soon as it is merged. I probably should publicise this ticket on the `sage-packaging` mailing list and see what everyone think of the threejs business as it is now, since the current situation is hardly ideal either.\n\nI am not trying to stay put on my island and I am all for isolation etc. But if use of `sage.misc.package` is prohibited, then perhaps it should not be exposed and look like an accessible functionality. How should we know that you disapprove of it? Please improve the current non-ideal situation, but if depends on a new ticket I would like to merge this one for the moment since it does improve threejs situation and we hope to make it default viewer in 8.0.",
    "created_at": "2017-04-03T01:23:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22670#issuecomment-337040",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:34" align="right">comment:34</div>

Replying to [@kiwifb](#comment:31):
> For sage on its own, in its corner playing all alone, by itself, there is no problem. There is never a problem, you are self contained. I don't suggest you change the status standard package for threejs either. I am encouraging you to think of a bigger picture regarding package management when you are not on your little island.
> 
> It will be a problem for anyone doing sage-on-distro/conda as soon as it is merged. I probably should publicise this ticket on the `sage-packaging` mailing list and see what everyone think of the threejs business as it is now, since the current situation is hardly ideal either.

I am not trying to stay put on my island and I am all for isolation etc. But if use of `sage.misc.package` is prohibited, then perhaps it should not be exposed and look like an accessible functionality. How should we know that you disapprove of it? Please improve the current non-ideal situation, but if depends on a new ticket I would like to merge this one for the moment since it does improve threejs situation and we hope to make it default viewer in 8.0.



---

archive/issue_comments_337041.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nReplying to [@novoselt](#comment:34):\n> Replying to [@kiwifb](#comment:31):\n> > For sage on its own, in its corner playing all alone, by itself, there is no problem. There is never a problem, you are self contained. I don't suggest you change the status standard package for threejs either. I am encouraging you to think of a bigger picture regarding package management when you are not on your little island.\n> > \n> > It will be a problem for anyone doing sage-on-distro/conda as soon as it is merged. I probably should publicise this ticket on the `sage-packaging` mailing list and see what everyone think of the threejs business as it is now, since the current situation is hardly ideal either.\n\n> \n> I am not trying to stay put on my island and I am all for isolation etc. But if use of `sage.misc.package` is prohibited, then perhaps it should not be exposed and look like an accessible functionality. How should we know that you disapprove of it? Please improve the current non-ideal situation, but if depends on a new ticket I would like to merge this one for the moment since it does improve threejs situation and we hope to make it default viewer in 8.0.\n\n\nYes, you are right there should be a higher level policy on this. `sage.misc.package` is an artefact of sage being its own packaging system and it has unwelcome tentacles all over the place. I am trying to convince people not create any more tentacles - like I killed most uses of SAGE_ROOT before. I shall bring it on sage-devel.",
    "created_at": "2017-04-03T01:38:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22670#issuecomment-337041",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:35" align="right">comment:35</div>

Replying to [@novoselt](#comment:34):
> Replying to [@kiwifb](#comment:31):
> > For sage on its own, in its corner playing all alone, by itself, there is no problem. There is never a problem, you are self contained. I don't suggest you change the status standard package for threejs either. I am encouraging you to think of a bigger picture regarding package management when you are not on your little island.
> > 
> > It will be a problem for anyone doing sage-on-distro/conda as soon as it is merged. I probably should publicise this ticket on the `sage-packaging` mailing list and see what everyone think of the threejs business as it is now, since the current situation is hardly ideal either.

> 
> I am not trying to stay put on my island and I am all for isolation etc. But if use of `sage.misc.package` is prohibited, then perhaps it should not be exposed and look like an accessible functionality. How should we know that you disapprove of it? Please improve the current non-ideal situation, but if depends on a new ticket I would like to merge this one for the moment since it does improve threejs situation and we hope to make it default viewer in 8.0.


Yes, you are right there should be a higher level policy on this. `sage.misc.package` is an artefact of sage being its own packaging system and it has unwelcome tentacles all over the place. I am trying to convince people not create any more tentacles - like I killed most uses of SAGE_ROOT before. I shall bring it on sage-devel.



---

archive/issue_comments_337042.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nDocumentation won't build. Looks like some extra whitespace somewhere:\n\n```\n[repl     ] /Users/Masson/Downloads/GitHub/sage/local/lib/python2.7/site-packages/sage/repl/rich_output/backend_ipython.py:docstring of sage.repl.rich_output.backend_ipython.BackendIPythonNotebook.threejs_offline_scripts:13: WARNING: Block quote ends without a blank line; unexpected unindent.\n[repl     ] /Users/Masson/Downloads/GitHub/sage/local/lib/python2.7/site-packages/sage/repl/rich_output/display_manager.py:docstring of sage.repl.rich_output.display_manager.DisplayManager.threejs_scripts:22: WARNING: Block quote ends without a blank line; unexpected unindent.\nError building the documentation.\n```",
    "created_at": "2017-04-03T02:05:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22670#issuecomment-337042",
    "user": "https://github.com/paulmasson"
}
```

<div id="comment:36" align="right">comment:36</div>

Documentation won't build. Looks like some extra whitespace somewhere:

```
[repl     ] /Users/Masson/Downloads/GitHub/sage/local/lib/python2.7/site-packages/sage/repl/rich_output/backend_ipython.py:docstring of sage.repl.rich_output.backend_ipython.BackendIPythonNotebook.threejs_offline_scripts:13: WARNING: Block quote ends without a blank line; unexpected unindent.
[repl     ] /Users/Masson/Downloads/GitHub/sage/local/lib/python2.7/site-packages/sage/repl/rich_output/display_manager.py:docstring of sage.repl.rich_output.display_manager.DisplayManager.threejs_scripts:22: WARNING: Block quote ends without a blank line; unexpected unindent.
Error building the documentation.
```



---

archive/issue_comments_337043.json:
```json
{
    "body": "Changed branch from **[u/novoselt/22670](https://github.com/sagemath/sagetrac-mirror/tree/u/novoselt/22670)** to **[u/paulmasson/22670](https://github.com/sagemath/sagetrac-mirror/tree/u/paulmasson/22670)**",
    "created_at": "2017-04-03T21:16:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22670#issuecomment-337043",
    "user": "https://github.com/paulmasson"
}
```

Changed branch from **[u/novoselt/22670](https://github.com/sagemath/sagetrac-mirror/tree/u/novoselt/22670)** to **[u/paulmasson/22670](https://github.com/sagemath/sagetrac-mirror/tree/u/paulmasson/22670)**



---

archive/issue_comments_337044.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nFigured out it was the `\\n` in two doctests. Replaced with `...` and documentation now builds and doctests still pass.\n\nSetting to positive review unless someone else wants to test it further.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/668eeee7f0f03c5c2ccfb44f33925fabaf28a63c\">668eeee</a></td><td><code>Allow documentation to build</code></td></tr></table>\n",
    "created_at": "2017-04-03T21:20:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22670#issuecomment-337044",
    "user": "https://github.com/paulmasson"
}
```

<div id="comment:38" align="right">comment:38</div>

Figured out it was the `\n` in two doctests. Replaced with `...` and documentation now builds and doctests still pass.

Setting to positive review unless someone else wants to test it further.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/668eeee7f0f03c5c2ccfb44f33925fabaf28a63c">668eeee</a></td><td><code>Allow documentation to build</code></td></tr></table>




---

archive/issue_events_316619.json:
```json
{
    "actor": "https://github.com/paulmasson",
    "created_at": "2017-04-03T21:20:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22670",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22670#event-316619"
}
```



---

archive/issue_events_316620.json:
```json
{
    "actor": "https://github.com/paulmasson",
    "created_at": "2017-04-03T21:20:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22670",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22670#event-316620"
}
```



---

archive/issue_comments_337045.json:
```json
{
    "body": "Changed reviewer from **Andrey Novoseltsev** to **Andrey Novoseltsev, Paul Masson**",
    "created_at": "2017-04-03T21:20:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22670#issuecomment-337045",
    "user": "https://github.com/paulmasson"
}
```

Changed reviewer from **Andrey Novoseltsev** to **Andrey Novoseltsev, Paul Masson**



---

archive/issue_comments_337046.json:
```json
{
    "body": "Changed author from **Paul Masson** to **Paul Masson, Andrey Novoseltsev**",
    "created_at": "2017-04-03T21:20:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22670#issuecomment-337046",
    "user": "https://github.com/paulmasson"
}
```

Changed author from **Paul Masson** to **Paul Masson, Andrey Novoseltsev**



---

archive/issue_comments_337047.json:
```json
{
    "body": "Changed commit from **[`8d1b155`](https://github.com/sagemath/sagetrac-mirror/commit/8d1b1555d032b999e2f779bd481544e2ec03d483)** to **[`668eeee`](https://github.com/sagemath/sagetrac-mirror/commit/668eeee7f0f03c5c2ccfb44f33925fabaf28a63c)**",
    "created_at": "2017-04-03T21:20:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22670#issuecomment-337047",
    "user": "https://github.com/paulmasson"
}
```

Changed commit from **[`8d1b155`](https://github.com/sagemath/sagetrac-mirror/commit/8d1b1555d032b999e2f779bd481544e2ec03d483)** to **[`668eeee`](https://github.com/sagemath/sagetrac-mirror/commit/668eeee7f0f03c5c2ccfb44f33925fabaf28a63c)**



---

archive/issue_comments_337048.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nI suspect it might have been fixed if you made the string raw, i.e., use `r\"\"\"`.",
    "created_at": "2017-04-03T21:24:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22670#issuecomment-337048",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:39" align="right">comment:39</div>

I suspect it might have been fixed if you made the string raw, i.e., use `r"""`.



---

archive/issue_comments_337049.json:
```json
{
    "body": "Changed branch from **[u/paulmasson/22670](https://github.com/sagemath/sagetrac-mirror/tree/u/paulmasson/22670)** to **[`668eeee`](https://github.com/sagemath/sagetrac-mirror/commit/668eeee7f0f03c5c2ccfb44f33925fabaf28a63c)**",
    "created_at": "2017-04-07T22:24:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22670#issuecomment-337049",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/paulmasson/22670](https://github.com/sagemath/sagetrac-mirror/tree/u/paulmasson/22670)** to **[`668eeee`](https://github.com/sagemath/sagetrac-mirror/commit/668eeee7f0f03c5c2ccfb44f33925fabaf28a63c)**



---

archive/issue_events_316621.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-04-07T22:24:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22670",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22670#event-316621"
}
```



---

archive/issue_events_316622.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "e399a53823ea2903d86e315a523162d6af7c16dc",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2017-04-07T22:24:02Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/22670",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22670#event-316622"
}
```



---

archive/issue_comments_337050.json:
```json
{
    "body": "Changed commit from **[`668eeee`](https://github.com/sagemath/sagetrac-mirror/commit/668eeee7f0f03c5c2ccfb44f33925fabaf28a63c)** to none",
    "created_at": "2018-06-26T11:55:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22670#issuecomment-337050",
    "user": "https://github.com/jdemeyer"
}
```

Changed commit from **[`668eeee`](https://github.com/sagemath/sagetrac-mirror/commit/668eeee7f0f03c5c2ccfb44f33925fabaf28a63c)** to none



---

archive/issue_comments_337051.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nSee #25665 for a follow-up",
    "created_at": "2018-06-26T11:55:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22670#issuecomment-337051",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:41" align="right">comment:41</div>

See #25665 for a follow-up
