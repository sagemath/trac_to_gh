# Issue 22683: backend_polymake for Polyhedron

archive/issues_022446.json:
```json
{
    "body": "Building upon #22658 (Support interface coercion `polymake(X)` for `Polyhedron`), we provide a backend in `backend_polymake.py` that does all `Polyhedron` computations using polymake (in particular, the initial computation of the double description).\n\nFor quadratic field extensions of the rationals, this backend should be faster than the generic implementation in Python (unless the pexpect overhead dominates). \n\n\nCC:  simonking @jplab @videlec @tscrim @yuan-zhou\n\nBranch/Commit: 6d1774b1d460ab8927f127abf4abc36305baf674\n\nReviewer: Travis Scrimshaw\n\nAuthor: Matthias Koeppe\n\nDependencies: #22658\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/22683\n\n",
    "closed_at": "2017-04-05T19:37:55Z",
    "created_at": "2017-03-26T19:43:10Z",
    "labels": [
        "component: geometry"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.0",
    "title": "backend_polymake for Polyhedron",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22683",
    "user": "https://github.com/mkoeppe"
}
```
Building upon #22658 (Support interface coercion `polymake(X)` for `Polyhedron`), we provide a backend in `backend_polymake.py` that does all `Polyhedron` computations using polymake (in particular, the initial computation of the double description).

For quadratic field extensions of the rationals, this backend should be faster than the generic implementation in Python (unless the pexpect overhead dominates). 


CC:  simonking @jplab @videlec @tscrim @yuan-zhou

Branch/Commit: 6d1774b1d460ab8927f127abf4abc36305baf674

Reviewer: Travis Scrimshaw

Author: Matthias Koeppe

Dependencies: #22658

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/22683





---

archive/issue_comments_332931.json:
```json
{
    "body": "<a id='comment:2'></a>As preparation, I have implemented the `_sage_` method. \n\n---\nLast 10 new commits:",
    "created_at": "2017-03-26T22:31:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22683#issuecomment-332931",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'></a>As preparation, I have implemented the `_sage_` method. 

---
Last 10 new commits:



---

archive/issue_comments_332932.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-03-27T06:15:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22683#issuecomment-332932",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_332933.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-03-27T06:19:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22683#issuecomment-332933",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_332934.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-03-27T06:20:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22683#issuecomment-332934",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_332935.json:
```json
{
    "body": "<a id='comment:8'></a>Two things I see:\n\n- `def _polymake_` is missing doctests.\n- In `__iter__`, you should use ```self``` in the docstrings. You also don't need to have an `INPUT:` block since there essentially no input.\n\nOtherwise LGTM modulo the dependency.",
    "created_at": "2017-03-27T14:43:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22683#issuecomment-332935",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:8'></a>Two things I see:

- `def _polymake_` is missing doctests.
- In `__iter__`, you should use ```self``` in the docstrings. You also don't need to have an `INPUT:` block since there essentially no input.

Otherwise LGTM modulo the dependency.



---

archive/issue_comments_332936.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-03-27T23:34:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22683#issuecomment-332936",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_332937.json:
```json
{
    "body": "<a id='comment:10'></a>Thank you.",
    "created_at": "2017-03-28T02:36:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22683#issuecomment-332937",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:10'></a>Thank you.



---

archive/issue_comments_332938.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-03-28T02:36:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22683#issuecomment-332938",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_332939.json:
```json
{
    "body": "<a id='comment:11'></a>Thanks for reviewing!",
    "created_at": "2017-03-28T02:38:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22683#issuecomment-332939",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:11'></a>Thanks for reviewing!



---

archive/issue_comments_332940.json:
```json
{
    "body": "<a id='comment:12'></a>Not a problem; happy to help.",
    "created_at": "2017-03-28T02:40:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22683#issuecomment-332940",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:12'></a>Not a problem; happy to help.



---

archive/issue_comments_332941.json:
```json
{
    "body": "<a id='comment:13'></a>I suspect this will pass tests on the bots with stand-alone sage. It gives me trouble in sage-on-gentoo while building the documentation, I am not sure how other distros deal with the doc building. I have the following failure related to this ticket\n\n```\n[discrete_] /dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python2_7/doc/en/reference/discrete_geometry/sage/geometry/polyhedron/library.rst:11: WARNING: autodoc: failed to import module u'sage.geometry.polyhedron.library'; the following exception was raised:\n[discrete_] Traceback (most recent call last):\n[discrete_] File \"/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python2_7/sage_setup/docbuild/ext/sage_autodoc.py\", line 525, in import_object\n[discrete_] __import__(self.modname)\n[discrete_] File \"/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python2_7/build/lib/sage/geometry/polyhedron/library.py\", line 75, in <module>\n[discrete_] from sage.combinat.root_system.associahedron import Associahedron\n[discrete_] File \"/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python2_7/build/lib/sage/combinat/root_system/associahedron.py\", line 23, in <module>\n[discrete_] from sage.geometry.polyhedron.parent import Polyhedra_QQ_ppl\n[discrete_] File \"/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python2_7/build/lib/sage/geometry/polyhedron/parent.py\", line 825, in <module>\n[discrete_] from sage.geometry.polyhedron.backend_polymake import Polyhedron_polymake\n[discrete_] File \"/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python2_7/build/lib/sage/geometry/polyhedron/backend_polymake.py\", line 31, in <module>\n[discrete_] from sage.rings.integer import LCM_list\n[discrete_] ImportError: cannot import name LCM_list\n[discrete_] /dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python2_7/doc/en/reference/discrete_geometry/sage/geometry/polyhedron/parent.rst:11: WARNING: autodoc: failed to import module u'sage.geometry.polyhedron.parent'; the following exception was raised:\n[discrete_] Traceback (most recent call last):\n[discrete_] File \"/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python2_7/sage_setup/docbuild/ext/sage_autodoc.py\", line 525, in import_object\n[discrete_] __import__(self.modname)\n[discrete_] File \"/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python2_7/build/lib/sage/geometry/polyhedron/parent.py\", line 825, in <module>\n[discrete_] from sage.geometry.polyhedron.backend_polymake import Polyhedron_polymake\n[discrete_] File \"/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python2_7/build/lib/sage/geometry/polyhedron/backend_polymake.py\", line 31, in <module>\n[discrete_] from sage.rings.integer import LCM_list\n[discrete_] ImportError: cannot import name LCM_list\n```\nwhich itself comes from #22630. Volker is currently testing the ticket so don't touch it now. If it is accepted as is, could we have a follow up to import `LCM_list` directly from `sage.arith.functions`? Although if I have problems with `lazy_import`, I will be fighting symptoms rather than the disease by doing that.",
    "created_at": "2017-04-01T22:15:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22683#issuecomment-332941",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:13'></a>I suspect this will pass tests on the bots with stand-alone sage. It gives me trouble in sage-on-gentoo while building the documentation, I am not sure how other distros deal with the doc building. I have the following failure related to this ticket

```
[discrete_] /dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python2_7/doc/en/reference/discrete_geometry/sage/geometry/polyhedron/library.rst:11: WARNING: autodoc: failed to import module u'sage.geometry.polyhedron.library'; the following exception was raised:
[discrete_] Traceback (most recent call last):
[discrete_] File "/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python2_7/sage_setup/docbuild/ext/sage_autodoc.py", line 525, in import_object
[discrete_] __import__(self.modname)
[discrete_] File "/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python2_7/build/lib/sage/geometry/polyhedron/library.py", line 75, in <module>
[discrete_] from sage.combinat.root_system.associahedron import Associahedron
[discrete_] File "/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python2_7/build/lib/sage/combinat/root_system/associahedron.py", line 23, in <module>
[discrete_] from sage.geometry.polyhedron.parent import Polyhedra_QQ_ppl
[discrete_] File "/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python2_7/build/lib/sage/geometry/polyhedron/parent.py", line 825, in <module>
[discrete_] from sage.geometry.polyhedron.backend_polymake import Polyhedron_polymake
[discrete_] File "/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python2_7/build/lib/sage/geometry/polyhedron/backend_polymake.py", line 31, in <module>
[discrete_] from sage.rings.integer import LCM_list
[discrete_] ImportError: cannot import name LCM_list
[discrete_] /dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python2_7/doc/en/reference/discrete_geometry/sage/geometry/polyhedron/parent.rst:11: WARNING: autodoc: failed to import module u'sage.geometry.polyhedron.parent'; the following exception was raised:
[discrete_] Traceback (most recent call last):
[discrete_] File "/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python2_7/sage_setup/docbuild/ext/sage_autodoc.py", line 525, in import_object
[discrete_] __import__(self.modname)
[discrete_] File "/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python2_7/build/lib/sage/geometry/polyhedron/parent.py", line 825, in <module>
[discrete_] from sage.geometry.polyhedron.backend_polymake import Polyhedron_polymake
[discrete_] File "/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python2_7/build/lib/sage/geometry/polyhedron/backend_polymake.py", line 31, in <module>
[discrete_] from sage.rings.integer import LCM_list
[discrete_] ImportError: cannot import name LCM_list
```
which itself comes from #22630. Volker is currently testing the ticket so don't touch it now. If it is accepted as is, could we have a follow up to import `LCM_list` directly from `sage.arith.functions`? Although if I have problems with `lazy_import`, I will be fighting symptoms rather than the disease by doing that.



---

archive/issue_comments_332942.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-04-02T00:01:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22683#issuecomment-332942",
    "user": "https://github.com/tscrim"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_332943.json:
```json
{
    "body": "<a id='comment:14'></a>`LCM_list` is never called in the code AFAICS. So it should just be as simple as removing the import so this doesn't have to be based on #22630. Which ticket do you mean by \"the ticket\"?",
    "created_at": "2017-04-02T00:01:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22683#issuecomment-332943",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:14'></a>`LCM_list` is never called in the code AFAICS. So it should just be as simple as removing the import so this doesn't have to be based on #22630. Which ticket do you mean by "the ticket"?



---

archive/issue_comments_332944.json:
```json
{
    "body": "<a id='comment:15'></a>Replying to [comment:14 tscrim]:\n> `LCM_list` is never called in the code AFAICS. So it should just be as simple as removing the import so this doesn't have to be based on #22630. Which ticket do you mean by \"the ticket\"?\n\n\nThis, here, ticket. I am signaling because I need to keep track of these things but I don't want to stop normal progress. Any issue I have, could be dealt with in a follow up ticket. Volker's already merged this ticket in his testing branch and if all goes well we shouldn't prevent the closing of this ticket because of sage-on-gentoo [OK, I would stop it if I thought you did something terrible].",
    "created_at": "2017-04-02T03:39:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22683#issuecomment-332944",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:15'></a>Replying to [comment:14 tscrim]:
> `LCM_list` is never called in the code AFAICS. So it should just be as simple as removing the import so this doesn't have to be based on #22630. Which ticket do you mean by "the ticket"?


This, here, ticket. I am signaling because I need to keep track of these things but I don't want to stop normal progress. Any issue I have, could be dealt with in a follow up ticket. Volker's already merged this ticket in his testing branch and if all goes well we shouldn't prevent the closing of this ticket because of sage-on-gentoo [OK, I would stop it if I thought you did something terrible].



---

archive/issue_comments_332945.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2017-04-02T03:39:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22683#issuecomment-332945",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_332946.json:
```json
{
    "body": "<a id='comment:16'></a>Follow-up ticket at #22740.",
    "created_at": "2017-04-02T04:02:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22683#issuecomment-332946",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:16'></a>Follow-up ticket at #22740.



---

archive/issue_comments_332947.json:
```json
{
    "body": "<a id='comment:17'></a>Documentation doesn't build",
    "created_at": "2017-04-02T14:22:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22683#issuecomment-332947",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:17'></a>Documentation doesn't build



---

archive/issue_comments_332948.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-04-02T14:22:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22683#issuecomment-332948",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_332949.json:
```json
{
    "body": "<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2017-04-02T19:01:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22683#issuecomment-332949",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_332950.json:
```json
{
    "body": "<a id='comment:19'></a>I've merged in #22740, which was intended to be a follow-up ticket, hoping that this will fix the doc build problems. \nAlso merged the updated branch prereq #22658 (which I'll mark as dup), which brings in 8.0.beta0. \nAnd added `backend_polymake` to the discrete geometry section of the manual. \nDocumentation builds for me on this branch.",
    "created_at": "2017-04-02T19:03:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22683#issuecomment-332950",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:19'></a>I've merged in #22740, which was intended to be a follow-up ticket, hoping that this will fix the doc build problems. 
Also merged the updated branch prereq #22658 (which I'll mark as dup), which brings in 8.0.beta0. 
And added `backend_polymake` to the discrete geometry section of the manual. 
Documentation builds for me on this branch.



---

archive/issue_comments_332951.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-04-02T19:03:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22683#issuecomment-332951",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_332952.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-04-02T19:10:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22683#issuecomment-332952",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_332953.json:
```json
{
    "body": "<a id='comment:20'></a>I would have been somewhat surprised if the doc did build on Volker's testing branch given comment:13. Changes LGTM.",
    "created_at": "2017-04-02T19:10:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22683#issuecomment-332953",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:20'></a>I would have been somewhat surprised if the doc did build on Volker's testing branch given comment:13. Changes LGTM.



---

archive/issue_comments_332954.json:
```json
{
    "body": "<a id='comment:21'></a>Well, I would have thought you build your branch and the documentation. So, to me it was probably a problem on my side.",
    "created_at": "2017-04-02T19:49:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22683#issuecomment-332954",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:21'></a>Well, I would have thought you build your branch and the documentation. So, to me it was probably a problem on my side.



---

archive/issue_comments_332955.json:
```json
{
    "body": "<a id='comment:22'></a>I didn't test it in conjunction with #22630 and didn't notice the conflict.",
    "created_at": "2017-04-02T19:59:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22683#issuecomment-332955",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:22'></a>I didn't test it in conjunction with #22630 and didn't notice the conflict.



---

archive/issue_events_059118.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-04-05T19:37:55Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/22683",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22683#event-59118"
}
```



---

archive/issue_comments_332956.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-04-05T19:37:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22683#issuecomment-332956",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
