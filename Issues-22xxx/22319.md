# Issue 22319: Implement __index__ for PARI Gen

archive/issues_022082.json:
```json
{
    "body": "Pari integers cannot be used to index lists:\n\n```\nsage: [1,2][pari(1)]\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-4-f2823fec0752> in <module>()\n----> 1 [Integer(1),Integer(2)][pari(Integer(1))]\n\nTypeError: list indices must be integers, not sage.libs.cypari2.gen.Gen\n```\n\nWith this ticket\n\n```\nsage: [1,2][pari(1)]\n2\n```\n\nIncidentally, this also fixes `pow`\n\n```\nsage: 1^pari(1)\n1\n```\n\n\nCC:  @jdemeyer @videlec\n\nKeywords: PARI, coercion, rd3\n\nBranch/Commit: 50593d693c55e77ecf18459d8fd3baec047307e5\n\nReviewer: Luca De Feo\n\nAuthor: Jeroen Demeyer\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/22319\n\n",
    "closed_at": "2017-02-12T22:09:06Z",
    "created_at": "2017-02-06T16:43:22Z",
    "labels": [
        "component: interfaces",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.6",
    "title": "Implement __index__ for PARI Gen",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22319",
    "user": "https://github.com/defeo"
}
```
Pari integers cannot be used to index lists:

```
sage: [1,2][pari(1)]
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-4-f2823fec0752> in <module>()
----> 1 [Integer(1),Integer(2)][pari(Integer(1))]

TypeError: list indices must be integers, not sage.libs.cypari2.gen.Gen
```

With this ticket

```
sage: [1,2][pari(1)]
2
```

Incidentally, this also fixes `pow`

```
sage: 1^pari(1)
1
```


CC:  @jdemeyer @videlec

Keywords: PARI, coercion, rd3

Branch/Commit: 50593d693c55e77ecf18459d8fd3baec047307e5

Reviewer: Luca De Feo

Author: Jeroen Demeyer

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/22319





---

archive/issue_comments_413800.json:
```json
{
    "body": "Changing author from \"\" to \"Jeroen Demeyer\"",
    "created_at": "2017-02-07T08:18:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22319",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22319#issuecomment-413800",
    "user": "https://github.com/jdemeyer"
}
```

Changing author from "" to "Jeroen Demeyer"



---

archive/issue_comments_413801.json:
```json
{
    "body": "Changing branch from \"\" to \"u/jdemeyer/implement___index___for_pari_gen\"",
    "created_at": "2017-02-07T10:56:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22319",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22319#issuecomment-413801",
    "user": "https://github.com/jdemeyer"
}
```

Changing branch from "" to "u/jdemeyer/implement___index___for_pari_gen"



---

archive/issue_comments_413802.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-02-07T10:56:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22319",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22319#issuecomment-413802",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_413803.json:
```json
{
    "body": "<a id='comment:4'></a>\nNew commits:\n|                                                                                                                                          |                                  |\n|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------|\n|[0348e00](https://git.sagemath.org/sage.git/commit?id=0348e00f854a147baa36af3172a57c36878db4c9)|`Implement __index__ for PARI Gen`|",
    "created_at": "2017-02-07T10:56:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22319",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22319#issuecomment-413803",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:4'></a>
New commits:
|                                                                                                                                          |                                  |
|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------|
|[0348e00](https://git.sagemath.org/sage.git/commit?id=0348e00f854a147baa36af3172a57c36878db4c9)|`Implement __index__ for PARI Gen`|



---

archive/issue_comments_413804.json:
```json
{
    "body": "Changing commit from \"\" to \"0348e00f854a147baa36af3172a57c36878db4c9\"",
    "created_at": "2017-02-07T10:56:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22319",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22319#issuecomment-413804",
    "user": "https://github.com/jdemeyer"
}
```

Changing commit from "" to "0348e00f854a147baa36af3172a57c36878db4c9"



---

archive/issue_comments_413805.json:
```json
{
    "body": "<a id='comment:5'></a>\nThis only solves part of the issue:\n\n```\nsage: 2^1.5\n2.82842712474619\nsage: 2^pari(1.5)\n---------------------------------------------------------------------------\nPariError                                 Traceback (most recent call last)\n...\nPariError: incorrect type in coercion to integer (t_REAL)\n```",
    "created_at": "2017-02-07T12:02:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22319",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22319#issuecomment-413805",
    "user": "https://github.com/defeo"
}
```

<a id='comment:5'></a>
This only solves part of the issue:

```
sage: 2^1.5
2.82842712474619
sage: 2^pari(1.5)
---------------------------------------------------------------------------
PariError                                 Traceback (most recent call last)
...
PariError: incorrect type in coercion to integer (t_REAL)
```



---

archive/issue_comments_413806.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-02-07T12:02:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22319",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22319#issuecomment-413806",
    "user": "https://github.com/defeo"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_413807.json:
```json
{
    "body": "<a id='comment:6'></a>\nFeel free to create a new ticket for other related issues.",
    "created_at": "2017-02-07T13:07:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22319",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22319#issuecomment-413807",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:6'></a>
Feel free to create a new ticket for other related issues.



---

archive/issue_comments_413808.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-02-07T13:07:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22319",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22319#issuecomment-413808",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_413809.json:
```json
{
    "body": "<a id='comment:7'></a>\nAlthough the exception type could be improved...",
    "created_at": "2017-02-07T13:10:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22319",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22319#issuecomment-413809",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:7'></a>
Although the exception type could be improved...



---

archive/issue_comments_413810.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-02-07T13:10:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22319",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22319#issuecomment-413810",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_413811.json:
```json
{
    "body": "Changing commit from \"0348e00f854a147baa36af3172a57c36878db4c9\" to \"50593d693c55e77ecf18459d8fd3baec047307e5\"",
    "created_at": "2017-02-07T13:27:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22319",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22319#issuecomment-413811",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "0348e00f854a147baa36af3172a57c36878db4c9" to "50593d693c55e77ecf18459d8fd3baec047307e5"



---

archive/issue_comments_413812.json:
```json
{
    "body": "<a id='comment:8'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                          |\n|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------|\n|[50593d6](https://git.sagemath.org/sage.git/commit/?id=50593d693c55e77ecf18459d8fd3baec047307e5)|`Minor fixes to __index__`|",
    "created_at": "2017-02-07T13:27:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22319",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22319#issuecomment-413812",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                          |
|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------|
|[50593d6](https://git.sagemath.org/sage.git/commit/?id=50593d693c55e77ecf18459d8fd3baec047307e5)|`Minor fixes to __index__`|



---

archive/issue_comments_413813.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-02-07T13:27:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22319",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22319#issuecomment-413813",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_413814.json:
```json
{
    "body": "<a id='comment:10'></a>\nI call this \"ticket hijacking\" :p",
    "created_at": "2017-02-07T13:41:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22319",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22319#issuecomment-413814",
    "user": "https://github.com/defeo"
}
```

<a id='comment:10'></a>
I call this "ticket hijacking" :p



---

archive/issue_comments_413815.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Luca De Feo\"",
    "created_at": "2017-02-07T13:41:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22319",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22319#issuecomment-413815",
    "user": "https://github.com/defeo"
}
```

Changing reviewer from "" to "Luca De Feo"



---

archive/issue_comments_413816.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-02-07T13:41:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22319",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22319#issuecomment-413816",
    "user": "https://github.com/defeo"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_413817.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,19 +1,26 @@\n-the `Integer.__pow__(self, n, modulus)` assumes that `n` is either an integer, or a Sage `Element`. This breaks with the latest changes to the PARI interface:\n+Pari integers cannot be used to index lists:\n+\n+```\n+sage: [1,2][pari(1)]\n+---------------------------------------------------------------------------\n+TypeError                                 Traceback (most recent call last)\n+<ipython-input-4-f2823fec0752> in <module>()\n+----> 1 [Integer(1),Integer(2)][pari(Integer(1))]\n+\n+TypeError: list indices must be integers, not sage.libs.cypari2.gen.Gen\n+```\n+\n+With this ticket\n+\n+```\n+sage: [1,2][pari(1)]\n+2\n+```\n+\n+Incidentally, this also fixes `pow`\n \n ```\n sage: 1^pari(1)\n----------------------------------------------------------------------------\n-TypeError                                 Traceback (most recent call last)\n-<ipython-input-43-2db1cdbea357> in <module>()\n-----> 1 Integer(1)**pari(Integer(1))\n-\n-/data/dfl/sage/src/sage/rings/integer.pyx in sage.rings.integer.Integer.__pow__ (/data/dfl/sage/src/build/cythonized/sage/rings/integer.c:13907)()\n-   2029             nn = pyobject_to_long(n)\n-   2030         except TypeError:\n--> 2031             s = parent_c(n)(self)\n-   2032             return s**n\n-   2033         except OverflowError:\n-\n-TypeError: __init__() takes exactly 0 positional arguments (1 given)\n+1\n ```\n \n``````\n",
    "created_at": "2017-02-07T13:41:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22319",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22319#issuecomment-413817",
    "user": "https://github.com/defeo"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,19 +1,26 @@
-the `Integer.__pow__(self, n, modulus)` assumes that `n` is either an integer, or a Sage `Element`. This breaks with the latest changes to the PARI interface:
+Pari integers cannot be used to index lists:
+
+```
+sage: [1,2][pari(1)]
+---------------------------------------------------------------------------
+TypeError                                 Traceback (most recent call last)
+<ipython-input-4-f2823fec0752> in <module>()
+----> 1 [Integer(1),Integer(2)][pari(Integer(1))]
+
+TypeError: list indices must be integers, not sage.libs.cypari2.gen.Gen
+```
+
+With this ticket
+
+```
+sage: [1,2][pari(1)]
+2
+```
+
+Incidentally, this also fixes `pow`
 
 ```
 sage: 1^pari(1)
----------------------------------------------------------------------------
-TypeError                                 Traceback (most recent call last)
-<ipython-input-43-2db1cdbea357> in <module>()
-----> 1 Integer(1)**pari(Integer(1))
-
-/data/dfl/sage/src/sage/rings/integer.pyx in sage.rings.integer.Integer.__pow__ (/data/dfl/sage/src/build/cythonized/sage/rings/integer.c:13907)()
-   2029             nn = pyobject_to_long(n)
-   2030         except TypeError:
--> 2031             s = parent_c(n)(self)
-   2032             return s**n
-   2033         except OverflowError:
-
-TypeError: __init__() takes exactly 0 positional arguments (1 given)
+1
 ```
 
``````




---

archive/issue_comments_413818.json:
```json
{
    "body": "Changing keywords from \"PARI, coercion\" to \"PARI, coercion, rd3\".",
    "created_at": "2017-02-07T13:42:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22319",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22319#issuecomment-413818",
    "user": "https://github.com/defeo"
}
```

Changing keywords from "PARI, coercion" to "PARI, coercion, rd3".



---

archive/issue_comments_413819.json:
```json
{
    "body": "Changing branch from \"u/jdemeyer/implement___index___for_pari_gen\" to \"50593d693c55e77ecf18459d8fd3baec047307e5\"",
    "created_at": "2017-02-12T22:09:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22319",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22319#issuecomment-413819",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/jdemeyer/implement___index___for_pari_gen" to "50593d693c55e77ecf18459d8fd3baec047307e5"



---

archive/issue_comments_413820.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-02-12T22:09:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22319",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22319#issuecomment-413820",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_058511.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-02-12T22:09:06Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/22319",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22319#event-58511"
}
```
