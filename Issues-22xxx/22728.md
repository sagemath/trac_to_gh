# Issue 22728: Patch Cython to find includes better

archive/issues_022491.json:
```json
{
    "assignees": [],
    "body": "See https://github.com/cython/cython/pull/1654\n\n**Branch/Commit:** [ab97837ec3685789a54005fa725863a65866de24](https://github.com/sagemath/sagetrac-mirror/commit/ab97837ec3685789a54005fa725863a65866de24)\n\n**Upstream:** Reported upstream. Developers acknowledge bug.\n\n**Reviewer:** Erik Bray\n\n**Author:** Jeroen Demeyer\n\nIssue created by migration from https://trac.sagemath.org/ticket/22728\n\n",
    "closed_at": "2017-04-23T12:57:46Z",
    "created_at": "2017-03-31T10:24:03Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20packages%3A%20standard",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.0",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Patch Cython to find includes better",
    "type": "issue",
    "updated_at": "2017-04-23T12:57:46Z",
    "url": "https://github.com/sagemath/sage/issues/22728",
    "user": "https://github.com/jdemeyer"
}
```
See https://github.com/cython/cython/pull/1654

**Branch/Commit:** [ab97837ec3685789a54005fa725863a65866de24](https://github.com/sagemath/sagetrac-mirror/commit/ab97837ec3685789a54005fa725863a65866de24)

**Upstream:** Reported upstream. Developers acknowledge bug.

**Reviewer:** Erik Bray

**Author:** Jeroen Demeyer

Issue created by migration from https://trac.sagemath.org/ticket/22728





---

archive/issue_events_275337.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-03-31T10:24:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/22728",
    "milestone_number": null,
    "milestone_title": "sage-8.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22728#event-275337"
}
```



---

archive/issue_events_275338.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-03-31T10:24:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22728",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20packages%3A%20standard",
    "label_color": "08517b",
    "label_name": "component: packages: standard",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22728#event-275338"
}
```



---

archive/issue_events_275339.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-03-31T10:24:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22728",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "008080",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22728#event-275339"
}
```



---

archive/issue_comments_340635.json:
```json
{
    "body": "**Upstream:** Reported upstream. No feedback yet.",
    "created_at": "2017-03-31T15:14:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22728#issuecomment-340635",
    "user": "https://github.com/jdemeyer"
}
```

**Upstream:** Reported upstream. No feedback yet.



---

archive/issue_comments_340636.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-\n+See https://github.com/cython/cython/pull/1654\n``````\n",
    "created_at": "2017-03-31T15:14:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22728#issuecomment-340636",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1 @@
-
+See https://github.com/cython/cython/pull/1654
``````




---

archive/issue_comments_340637.json:
```json
{
    "body": "**Branch:** [u/jdemeyer/patch_cython_to_find_includes_better](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/patch_cython_to_find_includes_better)",
    "created_at": "2017-03-31T15:25:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22728#issuecomment-340637",
    "user": "https://github.com/jdemeyer"
}
```

**Branch:** [u/jdemeyer/patch_cython_to_find_includes_better](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/patch_cython_to_find_includes_better)



---

archive/issue_comments_340638.json:
```json
{
    "body": "<a id='comment:3'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ab97837ec3685789a54005fa725863a65866de24\">ab97837</a></td><td><code>Cython: automatically add include_dirs for externs</code></td></tr></table>\n",
    "created_at": "2017-03-31T18:29:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22728#issuecomment-340638",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:3'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ab97837ec3685789a54005fa725863a65866de24">ab97837</a></td><td><code>Cython: automatically add include_dirs for externs</code></td></tr></table>




---

archive/issue_events_275340.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-03-31T18:29:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22728",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22728#event-275340"
}
```



---

archive/issue_comments_340639.json:
```json
{
    "body": "**Commit:** [ab97837ec3685789a54005fa725863a65866de24](https://github.com/sagemath/sagetrac-mirror/commit/ab97837ec3685789a54005fa725863a65866de24)",
    "created_at": "2017-03-31T18:29:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22728#issuecomment-340639",
    "user": "https://github.com/jdemeyer"
}
```

**Commit:** [ab97837ec3685789a54005fa725863a65866de24](https://github.com/sagemath/sagetrac-mirror/commit/ab97837ec3685789a54005fa725863a65866de24)



---

archive/issue_comments_340640.json:
```json
{
    "body": "<a id='comment:4'></a>\nDo you know why nothing is happening on Cyhon side?",
    "created_at": "2017-04-11T09:17:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22728#issuecomment-340640",
    "user": "https://github.com/videlec"
}
```

<a id='comment:4'></a>
Do you know why nothing is happening on Cyhon side?



---

archive/issue_comments_340641.json:
```json
{
    "body": "<a id='comment:5'></a>\nReplying to [@videlec](#comment%3A4):\n> Do you know why nothing is happening on Cyhon side?\n\nNo.",
    "created_at": "2017-04-11T09:21:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22728#issuecomment-340641",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:5'></a>
Replying to [@videlec](#comment%3A4):
> Do you know why nothing is happening on Cyhon side?

No.



---

archive/issue_comments_340642.json:
```json
{
    "body": "<a id='comment:6'></a>\nReplying to [@jdemeyer](#comment%3A5):\n> Replying to [@videlec](#comment%3A4):\n> > Do you know why nothing is happening on Cyhon side?\n\n> \n> No.\n\nDo you think it is worth mentioning that it is a blocker for several projects on their mailing list?",
    "created_at": "2017-04-11T09:26:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22728#issuecomment-340642",
    "user": "https://github.com/videlec"
}
```

<a id='comment:6'></a>
Replying to [@jdemeyer](#comment%3A5):
> Replying to [@videlec](#comment%3A4):
> > Do you know why nothing is happening on Cyhon side?

> 
> No.

Do you think it is worth mentioning that it is a blocker for several projects on their mailing list?



---

archive/issue_comments_340643.json:
```json
{
    "body": "<a id='comment:7'></a>\nReplying to [@videlec](#comment%3A6):\n> Do you think it is worth mentioning that it is a blocker for several projects on their mailing list?\n\nDone: https://mail.python.org/pipermail/cython-devel/2017-April/004995.html",
    "created_at": "2017-04-11T12:01:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22728#issuecomment-340643",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:7'></a>
Replying to [@videlec](#comment%3A6):
> Do you think it is worth mentioning that it is a blocker for several projects on their mailing list?

Done: https://mail.python.org/pipermail/cython-devel/2017-April/004995.html



---

archive/issue_comments_340644.json:
```json
{
    "body": "<a id='comment:8'></a>\nOn the Cython mailing list, upstream answered\n\n> I'm in favor of the idea (basically attempting to resolve header files\n> relative to the cython file including them and transitively passing\n> these paths to modules cimporting them); haven't had time to look at\n> the code yet or think if there could be negative implications.\n\nSo we could consider just patching Cython in Sage in order to move forward with #20238.",
    "created_at": "2017-04-14T07:20:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22728#issuecomment-340644",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'></a>
On the Cython mailing list, upstream answered

> I'm in favor of the idea (basically attempting to resolve header files
> relative to the cython file including them and transitively passing
> these paths to modules cimporting them); haven't had time to look at
> the code yet or think if there could be negative implications.

So we could consider just patching Cython in Sage in order to move forward with #20238.



---

archive/issue_comments_340645.json:
```json
{
    "body": "<a id='comment:9'></a>\nReplying to [@jdemeyer](#comment%3A8):\n> On the Cython mailing list, upstream answered\n> \n> > I'm in favor of the idea (basically attempting to resolve header files\n> > relative to the cython file including them and transitively passing\n> > these paths to modules cimporting them); haven't had time to look at\n> > the code yet or think if there could be negative implications.\n\n> \n> So we could consider just patching Cython in Sage in order to move forward with #20238.\n\nIf you need the Sage patched version of Cython to install cypari it is not really independent of Sage...",
    "created_at": "2017-04-14T16:11:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22728#issuecomment-340645",
    "user": "https://github.com/videlec"
}
```

<a id='comment:9'></a>
Replying to [@jdemeyer](#comment%3A8):
> On the Cython mailing list, upstream answered
> 
> > I'm in favor of the idea (basically attempting to resolve header files
> > relative to the cython file including them and transitively passing
> > these paths to modules cimporting them); haven't had time to look at
> > the code yet or think if there could be negative implications.

> 
> So we could consider just patching Cython in Sage in order to move forward with #20238.

If you need the Sage patched version of Cython to install cypari it is not really independent of Sage...



---

archive/issue_comments_340646.json:
```json
{
    "body": "<a id='comment:10'></a>\nReplying to [@videlec](#comment%3A9):\n> If you need the Sage patched version of Cython to install cypari it is not really independent of Sage...\n\nTrue, but that's still better than just keeping #20238 blocked.",
    "created_at": "2017-04-14T16:53:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22728#issuecomment-340646",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:10'></a>
Replying to [@videlec](#comment%3A9):
> If you need the Sage patched version of Cython to install cypari it is not really independent of Sage...

True, but that's still better than just keeping #20238 blocked.



---

archive/issue_comments_340647.json:
```json
{
    "body": "**Reviewer:** Erik Bray",
    "created_at": "2017-04-17T20:21:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22728#issuecomment-340647",
    "user": "https://github.com/embray"
}
```

**Reviewer:** Erik Bray



---

archive/issue_comments_340648.json:
```json
{
    "body": "<a id='comment:11'></a>\nIIUC Cypari will still install/work without this patch *in principle*--this is just needed for some specific use cases in integration with Sage.  If it were really needed for cypari to work independently of Sage at the worst cypari could monkey-patch Cython.  But considering that this patch is, as far as I can tell, pretty non-controversial and obvious, and is likely to be accepted upstream, I see no problem adding it in Sage as well at least for the sake of progressing on #20238.",
    "created_at": "2017-04-17T20:21:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22728#issuecomment-340648",
    "user": "https://github.com/embray"
}
```

<a id='comment:11'></a>
IIUC Cypari will still install/work without this patch *in principle*--this is just needed for some specific use cases in integration with Sage.  If it were really needed for cypari to work independently of Sage at the worst cypari could monkey-patch Cython.  But considering that this patch is, as far as I can tell, pretty non-controversial and obvious, and is likely to be accepted upstream, I see no problem adding it in Sage as well at least for the sake of progressing on #20238.



---

archive/issue_events_275341.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-04-17T20:21:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22728",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22728#event-275341"
}
```



---

archive/issue_events_275342.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-04-17T20:21:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22728",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22728#event-275342"
}
```



---

archive/issue_comments_340649.json:
```json
{
    "body": "<a id='comment:12'></a>\nReplying to [@embray](#comment%3A11):\n> IIUC Cypari will still install/work without this patch *in principle*--this is just needed for some specific use cases in integration with Sage.\n\nTo be specific: that patch is needed whenever some package (Sage in this case) wants to use the *Cython* interface of `CyPari2`. So you are right that CyPari2 by itself does not need that patch.",
    "created_at": "2017-04-18T08:19:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22728#issuecomment-340649",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:12'></a>
Replying to [@embray](#comment%3A11):
> IIUC Cypari will still install/work without this patch *in principle*--this is just needed for some specific use cases in integration with Sage.

To be specific: that patch is needed whenever some package (Sage in this case) wants to use the *Cython* interface of `CyPari2`. So you are right that CyPari2 by itself does not need that patch.



---

archive/issue_comments_340650.json:
```json
{
    "body": "**Changing upstream** from \"Reported upstream. No feedback yet.\" to \"Reported upstream. Developers acknowledge bug.\".",
    "created_at": "2017-04-18T20:32:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22728#issuecomment-340650",
    "user": "https://github.com/jdemeyer"
}
```

**Changing upstream** from "Reported upstream. No feedback yet." to "Reported upstream. Developers acknowledge bug.".



---

archive/issue_comments_340651.json:
```json
{
    "body": "**Changing branch** from \"[u/jdemeyer/patch_cython_to_find_includes_better](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/patch_cython_to_find_includes_better)\" to \"[ab97837ec3685789a54005fa725863a65866de24](https://github.com/sagemath/sagetrac-mirror/commit/ab97837ec3685789a54005fa725863a65866de24)\".",
    "created_at": "2017-04-23T12:57:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22728#issuecomment-340651",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/jdemeyer/patch_cython_to_find_includes_better](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/patch_cython_to_find_includes_better)" to "[ab97837ec3685789a54005fa725863a65866de24](https://github.com/sagemath/sagetrac-mirror/commit/ab97837ec3685789a54005fa725863a65866de24)".



---

archive/issue_events_275343.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-04-23T12:57:46Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22728",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22728#event-275343"
}
```



---

archive/issue_events_275344.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "ac6028d12fa873ab7dd5bf532f65826d82add612",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2017-04-23T12:57:46Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/22728",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22728#event-275344"
}
```
