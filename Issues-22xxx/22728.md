# Issue 22728: Patch Cython to find includes better

archive/issues_022491.json:
```json
{
    "assignees": [],
    "body": "See https://github.com/cython/cython/pull/1654\n\nBranch/Commit: **[ab97837](https://github.com/sagemath/sagetrac-mirror/commit/ab97837ec3685789a54005fa725863a65866de24)**\n\nUpstream: **Reported upstream. Developers acknowledge bug.**\n\nReviewer: **Erik Bray**\n\nAuthor: **Jeroen Demeyer**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/22728_\n\n",
    "closed_at": "2017-04-23T12:57:46Z",
    "created_at": "2017-03-31T10:24:03Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20packages%3A%20standard",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.0",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Patch Cython to find includes better",
    "type": "issue",
    "updated_at": "2017-04-23T12:57:46Z",
    "url": "https://github.com/sagemath/sage/issues/22728",
    "user": "https://github.com/jdemeyer"
}
```
See https://github.com/cython/cython/pull/1654

Branch/Commit: **[ab97837](https://github.com/sagemath/sagetrac-mirror/commit/ab97837ec3685789a54005fa725863a65866de24)**

Upstream: **Reported upstream. Developers acknowledge bug.**

Reviewer: **Erik Bray**

Author: **Jeroen Demeyer**

_Issue created by migration from https://trac.sagemath.org/ticket/22728_





---

archive/issue_events_299322.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-03-31T10:24:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/22728",
    "milestone_number": null,
    "milestone_title": "sage-8.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22728#event-299322"
}
```



---

archive/issue_events_299323.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-03-31T10:24:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22728",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20packages%3A%20standard",
    "label_color": "000080",
    "label_name": "component: packages: standard",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22728#event-299323"
}
```



---

archive/issue_events_299324.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-03-31T10:24:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22728",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22728#event-299324"
}
```



---

archive/issue_events_299325.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-03-31T10:24:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22728",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22728#event-299325"
}
```



---

archive/issue_comments_340752.json:
```json
{
    "body": "Upstream: **Reported upstream. No feedback yet.**",
    "created_at": "2017-03-31T15:14:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22728#issuecomment-340752",
    "user": "https://github.com/jdemeyer"
}
```

Upstream: **Reported upstream. No feedback yet.**



---

archive/issue_comments_340753.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-\n+See https://github.com/cython/cython/pull/1654\n``````\n",
    "created_at": "2017-03-31T15:14:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22728#issuecomment-340753",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-
+See https://github.com/cython/cython/pull/1654
``````




---

archive/issue_comments_340754.json:
```json
{
    "body": "Branch: **[u/jdemeyer/patch_cython_to_find_includes_better](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/patch_cython_to_find_includes_better)**",
    "created_at": "2017-03-31T15:25:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22728#issuecomment-340754",
    "user": "https://github.com/jdemeyer"
}
```

Branch: **[u/jdemeyer/patch_cython_to_find_includes_better](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/patch_cython_to_find_includes_better)**



---

archive/issue_comments_340755.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ab97837ec3685789a54005fa725863a65866de24\">ab97837</a></td><td><code>Cython: automatically add include_dirs for externs</code></td></tr></table>\n",
    "created_at": "2017-03-31T18:29:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22728#issuecomment-340755",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:3'>Comment 3:</a>
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ab97837ec3685789a54005fa725863a65866de24">ab97837</a></td><td><code>Cython: automatically add include_dirs for externs</code></td></tr></table>




---

archive/issue_events_299326.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-03-31T18:29:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22728",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22728#event-299326"
}
```



---

archive/issue_comments_340756.json:
```json
{
    "body": "Commit: **[ab97837](https://github.com/sagemath/sagetrac-mirror/commit/ab97837ec3685789a54005fa725863a65866de24)**",
    "created_at": "2017-03-31T18:29:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22728#issuecomment-340756",
    "user": "https://github.com/jdemeyer"
}
```

Commit: **[ab97837](https://github.com/sagemath/sagetrac-mirror/commit/ab97837ec3685789a54005fa725863a65866de24)**



---

archive/issue_comments_340757.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nDo you know why nothing is happening on Cyhon side?",
    "created_at": "2017-04-11T09:17:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22728#issuecomment-340757",
    "user": "https://github.com/videlec"
}
```

<a id='comment:4'>Comment 4:</a>
Do you know why nothing is happening on Cyhon side?



---

archive/issue_comments_340758.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nReplying to [@videlec](#comment%3A4):\n> Do you know why nothing is happening on Cyhon side?\n\nNo.",
    "created_at": "2017-04-11T09:21:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22728#issuecomment-340758",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:5'>Comment 5:</a>
Replying to [@videlec](#comment%3A4):
> Do you know why nothing is happening on Cyhon side?

No.



---

archive/issue_comments_340759.json:
```json
{
    "body": "<a id='comment:6'>Comment 6:</a>\nReplying to [@jdemeyer](#comment%3A5):\n> Replying to [@videlec](#comment%3A4):\n> > Do you know why nothing is happening on Cyhon side?\n\n> \n> No.\n\nDo you think it is worth mentioning that it is a blocker for several projects on their mailing list?",
    "created_at": "2017-04-11T09:26:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22728#issuecomment-340759",
    "user": "https://github.com/videlec"
}
```

<a id='comment:6'>Comment 6:</a>
Replying to [@jdemeyer](#comment%3A5):
> Replying to [@videlec](#comment%3A4):
> > Do you know why nothing is happening on Cyhon side?

> 
> No.

Do you think it is worth mentioning that it is a blocker for several projects on their mailing list?



---

archive/issue_comments_340760.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nReplying to [@videlec](#comment%3A6):\n> Do you think it is worth mentioning that it is a blocker for several projects on their mailing list?\n\nDone: https://mail.python.org/pipermail/cython-devel/2017-April/004995.html",
    "created_at": "2017-04-11T12:01:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22728#issuecomment-340760",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:7'>Comment 7:</a>
Replying to [@videlec](#comment%3A6):
> Do you think it is worth mentioning that it is a blocker for several projects on their mailing list?

Done: https://mail.python.org/pipermail/cython-devel/2017-April/004995.html



---

archive/issue_comments_340761.json:
```json
{
    "body": "<a id='comment:8'>Comment 8:</a>\nOn the Cython mailing list, upstream answered\n\n> I'm in favor of the idea (basically attempting to resolve header files\n> relative to the cython file including them and transitively passing\n> these paths to modules cimporting them); haven't had time to look at\n> the code yet or think if there could be negative implications.\n\nSo we could consider just patching Cython in Sage in order to move forward with #20238.",
    "created_at": "2017-04-14T07:20:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22728#issuecomment-340761",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'>Comment 8:</a>
On the Cython mailing list, upstream answered

> I'm in favor of the idea (basically attempting to resolve header files
> relative to the cython file including them and transitively passing
> these paths to modules cimporting them); haven't had time to look at
> the code yet or think if there could be negative implications.

So we could consider just patching Cython in Sage in order to move forward with #20238.



---

archive/issue_comments_340762.json:
```json
{
    "body": "<a id='comment:9'>Comment 9:</a>\nReplying to [@jdemeyer](#comment%3A8):\n> On the Cython mailing list, upstream answered\n> \n> > I'm in favor of the idea (basically attempting to resolve header files\n> > relative to the cython file including them and transitively passing\n> > these paths to modules cimporting them); haven't had time to look at\n> > the code yet or think if there could be negative implications.\n\n> \n> So we could consider just patching Cython in Sage in order to move forward with #20238.\n\nIf you need the Sage patched version of Cython to install cypari it is not really independent of Sage...",
    "created_at": "2017-04-14T16:11:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22728#issuecomment-340762",
    "user": "https://github.com/videlec"
}
```

<a id='comment:9'>Comment 9:</a>
Replying to [@jdemeyer](#comment%3A8):
> On the Cython mailing list, upstream answered
> 
> > I'm in favor of the idea (basically attempting to resolve header files
> > relative to the cython file including them and transitively passing
> > these paths to modules cimporting them); haven't had time to look at
> > the code yet or think if there could be negative implications.

> 
> So we could consider just patching Cython in Sage in order to move forward with #20238.

If you need the Sage patched version of Cython to install cypari it is not really independent of Sage...



---

archive/issue_comments_340763.json:
```json
{
    "body": "<a id='comment:10'>Comment 10:</a>\nReplying to [@videlec](#comment%3A9):\n> If you need the Sage patched version of Cython to install cypari it is not really independent of Sage...\n\nTrue, but that's still better than just keeping #20238 blocked.",
    "created_at": "2017-04-14T16:53:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22728#issuecomment-340763",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:10'>Comment 10:</a>
Replying to [@videlec](#comment%3A9):
> If you need the Sage patched version of Cython to install cypari it is not really independent of Sage...

True, but that's still better than just keeping #20238 blocked.



---

archive/issue_comments_340764.json:
```json
{
    "body": "Reviewer: **Erik Bray**",
    "created_at": "2017-04-17T20:21:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22728#issuecomment-340764",
    "user": "https://github.com/embray"
}
```

Reviewer: **Erik Bray**



---

archive/issue_comments_340765.json:
```json
{
    "body": "<a id='comment:11'>Comment 11:</a>\nIIUC Cypari will still install/work without this patch *in principle*--this is just needed for some specific use cases in integration with Sage.  If it were really needed for cypari to work independently of Sage at the worst cypari could monkey-patch Cython.  But considering that this patch is, as far as I can tell, pretty non-controversial and obvious, and is likely to be accepted upstream, I see no problem adding it in Sage as well at least for the sake of progressing on #20238.",
    "created_at": "2017-04-17T20:21:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22728#issuecomment-340765",
    "user": "https://github.com/embray"
}
```

<a id='comment:11'>Comment 11:</a>
IIUC Cypari will still install/work without this patch *in principle*--this is just needed for some specific use cases in integration with Sage.  If it were really needed for cypari to work independently of Sage at the worst cypari could monkey-patch Cython.  But considering that this patch is, as far as I can tell, pretty non-controversial and obvious, and is likely to be accepted upstream, I see no problem adding it in Sage as well at least for the sake of progressing on #20238.



---

archive/issue_events_299327.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-04-17T20:21:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22728",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22728#event-299327"
}
```



---

archive/issue_events_299328.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-04-17T20:21:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22728",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22728#event-299328"
}
```



---

archive/issue_comments_340766.json:
```json
{
    "body": "<a id='comment:12'>Comment 12:</a>\nReplying to [@embray](#comment%3A11):\n> IIUC Cypari will still install/work without this patch *in principle*--this is just needed for some specific use cases in integration with Sage.\n\nTo be specific: that patch is needed whenever some package (Sage in this case) wants to use the *Cython* interface of `CyPari2`. So you are right that CyPari2 by itself does not need that patch.",
    "created_at": "2017-04-18T08:19:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22728#issuecomment-340766",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:12'>Comment 12:</a>
Replying to [@embray](#comment%3A11):
> IIUC Cypari will still install/work without this patch *in principle*--this is just needed for some specific use cases in integration with Sage.

To be specific: that patch is needed whenever some package (Sage in this case) wants to use the *Cython* interface of `CyPari2`. So you are right that CyPari2 by itself does not need that patch.



---

archive/issue_comments_340767.json:
```json
{
    "body": "Changed upstream from **Reported upstream. No feedback yet.** to **Reported upstream. Developers acknowledge bug.**",
    "created_at": "2017-04-18T20:32:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22728#issuecomment-340767",
    "user": "https://github.com/jdemeyer"
}
```

Changed upstream from **Reported upstream. No feedback yet.** to **Reported upstream. Developers acknowledge bug.**



---

archive/issue_comments_340768.json:
```json
{
    "body": "Changed branch from **[u/jdemeyer/patch_cython_to_find_includes_better](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/patch_cython_to_find_includes_better)** to **[ab97837](https://github.com/sagemath/sagetrac-mirror/commit/ab97837ec3685789a54005fa725863a65866de24)**",
    "created_at": "2017-04-23T12:57:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22728#issuecomment-340768",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/jdemeyer/patch_cython_to_find_includes_better](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/patch_cython_to_find_includes_better)** to **[ab97837](https://github.com/sagemath/sagetrac-mirror/commit/ab97837ec3685789a54005fa725863a65866de24)**



---

archive/issue_events_299329.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-04-23T12:57:46Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22728",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22728#event-299329"
}
```



---

archive/issue_events_299330.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "ac6028d12fa873ab7dd5bf532f65826d82add612",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2017-04-23T12:57:46Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/22728",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22728#event-299330"
}
```
