# Issue 22728: Patch Cython to find includes better

archive/issues_022491.json:
```json
{
    "assignees": [],
    "body": "See https://github.com/cython/cython/pull/1654\n\nBranch/Commit: **[`ab97837`](https://github.com/sagemath/sagetrac-mirror/commit/ab97837ec3685789a54005fa725863a65866de24)**\n\nUpstream: **Reported upstream. Developers acknowledge bug.**\n\nReviewer: **Erik Bray**\n\nAuthor: **Jeroen Demeyer**\n\nComponent: **packages: standard**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/22728_\n\n",
    "closed_at": "2017-04-23T12:57:46Z",
    "created_at": "2017-03-31T10:24:03Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.0",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Patch Cython to find includes better",
    "type": "issue",
    "updated_at": "2017-04-23T12:57:46Z",
    "url": "https://github.com/sagemath/sage/issues/22728",
    "user": "https://github.com/jdemeyer"
}
```
See https://github.com/cython/cython/pull/1654

Branch/Commit: **[`ab97837`](https://github.com/sagemath/sagetrac-mirror/commit/ab97837ec3685789a54005fa725863a65866de24)**

Upstream: **Reported upstream. Developers acknowledge bug.**

Reviewer: **Erik Bray**

Author: **Jeroen Demeyer**

Component: **packages: standard**

_Issue created by migration from https://trac.sagemath.org/ticket/22728_





---

archive/issue_events_318778.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-03-31T10:24:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/22728",
    "milestone_number": null,
    "milestone_title": "sage-8.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22728#event-318778"
}
```



---

archive/issue_events_318779.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-03-31T10:24:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22728",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
    "label_color": "000080",
    "label_name": "c: packages: standard",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22728#event-318779"
}
```



---

archive/issue_events_318780.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-03-31T10:24:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22728",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22728#event-318780"
}
```



---

archive/issue_events_318781.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-03-31T10:24:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22728",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22728#event-318781"
}
```



---

archive/issue_comments_338049.json:
```json
{
    "body": "Upstream: **Reported upstream. No feedback yet.**",
    "created_at": "2017-03-31T15:14:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22728#issuecomment-338049",
    "user": "https://github.com/jdemeyer"
}
```

Upstream: **Reported upstream. No feedback yet.**



---

archive/issue_comments_338050.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-\n+See https://github.com/cython/cython/pull/1654\n``````\n",
    "created_at": "2017-03-31T15:14:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22728#issuecomment-338050",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-
+See https://github.com/cython/cython/pull/1654
``````




---

archive/issue_comments_338051.json:
```json
{
    "body": "Branch: **[u/jdemeyer/patch_cython_to_find_includes_better](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/patch_cython_to_find_includes_better)**",
    "created_at": "2017-03-31T15:25:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22728#issuecomment-338051",
    "user": "https://github.com/jdemeyer"
}
```

Branch: **[u/jdemeyer/patch_cython_to_find_includes_better](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/patch_cython_to_find_includes_better)**



---

archive/issue_comments_338052.json:
```json
{
    "body": "<div id=\"comment:3\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ab97837ec3685789a54005fa725863a65866de24\"><code>ab97837</code></a></td><td><code>Cython: automatically add include_dirs for externs</code></td></tr></table>\n",
    "created_at": "2017-03-31T18:29:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22728#issuecomment-338052",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:3"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ab97837ec3685789a54005fa725863a65866de24"><code>ab97837</code></a></td><td><code>Cython: automatically add include_dirs for externs</code></td></tr></table>




---

archive/issue_events_318782.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-03-31T18:29:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22728",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22728#event-318782"
}
```



---

archive/issue_comments_338053.json:
```json
{
    "body": "Commit: **[`ab97837`](https://github.com/sagemath/sagetrac-mirror/commit/ab97837ec3685789a54005fa725863a65866de24)**",
    "created_at": "2017-03-31T18:29:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22728#issuecomment-338053",
    "user": "https://github.com/jdemeyer"
}
```

Commit: **[`ab97837`](https://github.com/sagemath/sagetrac-mirror/commit/ab97837ec3685789a54005fa725863a65866de24)**



---

archive/issue_comments_338054.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nDo you know why nothing is happening on Cyhon side?",
    "created_at": "2017-04-11T09:17:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22728#issuecomment-338054",
    "user": "https://github.com/videlec"
}
```

<div id="comment:4" align="right">comment:4</div>

Do you know why nothing is happening on Cyhon side?



---

archive/issue_comments_338055.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nReplying to [@videlec](#comment:4):\n> Do you know why nothing is happening on Cyhon side?\n\nNo.",
    "created_at": "2017-04-11T09:21:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22728#issuecomment-338055",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:5" align="right">comment:5</div>

Replying to [@videlec](#comment:4):
> Do you know why nothing is happening on Cyhon side?

No.



---

archive/issue_comments_338056.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nReplying to [@jdemeyer](#comment:5):\n> Replying to [@videlec](#comment:4):\n> > Do you know why nothing is happening on Cyhon side?\n\n> \n> No.\n\nDo you think it is worth mentioning that it is a blocker for several projects on their mailing list?",
    "created_at": "2017-04-11T09:26:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22728#issuecomment-338056",
    "user": "https://github.com/videlec"
}
```

<div id="comment:6" align="right">comment:6</div>

Replying to [@jdemeyer](#comment:5):
> Replying to [@videlec](#comment:4):
> > Do you know why nothing is happening on Cyhon side?

> 
> No.

Do you think it is worth mentioning that it is a blocker for several projects on their mailing list?



---

archive/issue_comments_338057.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nReplying to [@videlec](#comment:6):\n> Do you think it is worth mentioning that it is a blocker for several projects on their mailing list?\n\nDone: https://mail.python.org/pipermail/cython-devel/2017-April/004995.html",
    "created_at": "2017-04-11T12:01:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22728#issuecomment-338057",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:7" align="right">comment:7</div>

Replying to [@videlec](#comment:6):
> Do you think it is worth mentioning that it is a blocker for several projects on their mailing list?

Done: https://mail.python.org/pipermail/cython-devel/2017-April/004995.html



---

archive/issue_comments_338058.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nOn the Cython mailing list, upstream answered\n\n> I'm in favor of the idea (basically attempting to resolve header files\n> relative to the cython file including them and transitively passing\n> these paths to modules cimporting them); haven't had time to look at\n> the code yet or think if there could be negative implications.\n\nSo we could consider just patching Cython in Sage in order to move forward with #20238.",
    "created_at": "2017-04-14T07:20:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22728#issuecomment-338058",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:8" align="right">comment:8</div>

On the Cython mailing list, upstream answered

> I'm in favor of the idea (basically attempting to resolve header files
> relative to the cython file including them and transitively passing
> these paths to modules cimporting them); haven't had time to look at
> the code yet or think if there could be negative implications.

So we could consider just patching Cython in Sage in order to move forward with #20238.



---

archive/issue_comments_338059.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nReplying to [@jdemeyer](#comment:8):\n> On the Cython mailing list, upstream answered\n> \n> > I'm in favor of the idea (basically attempting to resolve header files\n> > relative to the cython file including them and transitively passing\n> > these paths to modules cimporting them); haven't had time to look at\n> > the code yet or think if there could be negative implications.\n\n> \n> So we could consider just patching Cython in Sage in order to move forward with #20238.\n\nIf you need the Sage patched version of Cython to install cypari it is not really independent of Sage...",
    "created_at": "2017-04-14T16:11:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22728#issuecomment-338059",
    "user": "https://github.com/videlec"
}
```

<div id="comment:9" align="right">comment:9</div>

Replying to [@jdemeyer](#comment:8):
> On the Cython mailing list, upstream answered
> 
> > I'm in favor of the idea (basically attempting to resolve header files
> > relative to the cython file including them and transitively passing
> > these paths to modules cimporting them); haven't had time to look at
> > the code yet or think if there could be negative implications.

> 
> So we could consider just patching Cython in Sage in order to move forward with #20238.

If you need the Sage patched version of Cython to install cypari it is not really independent of Sage...



---

archive/issue_comments_338060.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nReplying to [@videlec](#comment:9):\n> If you need the Sage patched version of Cython to install cypari it is not really independent of Sage...\n\nTrue, but that's still better than just keeping #20238 blocked.",
    "created_at": "2017-04-14T16:53:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22728#issuecomment-338060",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:10" align="right">comment:10</div>

Replying to [@videlec](#comment:9):
> If you need the Sage patched version of Cython to install cypari it is not really independent of Sage...

True, but that's still better than just keeping #20238 blocked.



---

archive/issue_comments_338061.json:
```json
{
    "body": "Reviewer: **Erik Bray**",
    "created_at": "2017-04-17T20:21:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22728#issuecomment-338061",
    "user": "https://github.com/embray"
}
```

Reviewer: **Erik Bray**



---

archive/issue_comments_338062.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nIIUC Cypari will still install/work without this patch *in principle*--this is just needed for some specific use cases in integration with Sage.  If it were really needed for cypari to work independently of Sage at the worst cypari could monkey-patch Cython.  But considering that this patch is, as far as I can tell, pretty non-controversial and obvious, and is likely to be accepted upstream, I see no problem adding it in Sage as well at least for the sake of progressing on #20238.",
    "created_at": "2017-04-17T20:21:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22728#issuecomment-338062",
    "user": "https://github.com/embray"
}
```

<div id="comment:11" align="right">comment:11</div>

IIUC Cypari will still install/work without this patch *in principle*--this is just needed for some specific use cases in integration with Sage.  If it were really needed for cypari to work independently of Sage at the worst cypari could monkey-patch Cython.  But considering that this patch is, as far as I can tell, pretty non-controversial and obvious, and is likely to be accepted upstream, I see no problem adding it in Sage as well at least for the sake of progressing on #20238.



---

archive/issue_events_318783.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-04-17T20:21:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22728",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22728#event-318783"
}
```



---

archive/issue_events_318784.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-04-17T20:21:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22728",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22728#event-318784"
}
```



---

archive/issue_comments_338063.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nReplying to [@embray](#comment:11):\n> IIUC Cypari will still install/work without this patch *in principle*--this is just needed for some specific use cases in integration with Sage.\n\nTo be specific: that patch is needed whenever some package (Sage in this case) wants to use the *Cython* interface of `CyPari2`. So you are right that CyPari2 by itself does not need that patch.",
    "created_at": "2017-04-18T08:19:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22728#issuecomment-338063",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:12" align="right">comment:12</div>

Replying to [@embray](#comment:11):
> IIUC Cypari will still install/work without this patch *in principle*--this is just needed for some specific use cases in integration with Sage.

To be specific: that patch is needed whenever some package (Sage in this case) wants to use the *Cython* interface of `CyPari2`. So you are right that CyPari2 by itself does not need that patch.



---

archive/issue_comments_338064.json:
```json
{
    "body": "Changed upstream from **Reported upstream. No feedback yet.** to **Reported upstream. Developers acknowledge bug.**",
    "created_at": "2017-04-18T20:32:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22728#issuecomment-338064",
    "user": "https://github.com/jdemeyer"
}
```

Changed upstream from **Reported upstream. No feedback yet.** to **Reported upstream. Developers acknowledge bug.**



---

archive/issue_comments_338065.json:
```json
{
    "body": "Changed branch from **[u/jdemeyer/patch_cython_to_find_includes_better](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/patch_cython_to_find_includes_better)** to **[`ab97837`](https://github.com/sagemath/sagetrac-mirror/commit/ab97837ec3685789a54005fa725863a65866de24)**",
    "created_at": "2017-04-23T12:57:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22728#issuecomment-338065",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/jdemeyer/patch_cython_to_find_includes_better](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/patch_cython_to_find_includes_better)** to **[`ab97837`](https://github.com/sagemath/sagetrac-mirror/commit/ab97837ec3685789a54005fa725863a65866de24)**



---

archive/issue_events_318785.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-04-23T12:57:46Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22728",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22728#event-318785"
}
```



---

archive/issue_events_318786.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "ac6028d12fa873ab7dd5bf532f65826d82add612",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2017-04-23T12:57:46Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/22728",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22728#event-318786"
}
```
