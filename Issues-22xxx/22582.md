# Issue 22582: Install pip into py2 + py3 and fix py3 dependencies build

archive/issues_022345.json:
```json
{
    "assignees": [],
    "body": "Install both pip2 and pip3, otherwise your python2 + python3 isn't that useful.\n\nThen, let sage-pip-install explicitly use pip2 or pip3.\n\nWith this ticket the SAGE_PYTHON3=yes build only fails in sagelib, but works for all dependencies.\n\nThis ticket also updates numpy to version 1.12.1.\n\nDepends on #22608\nDepends on #22764\nDepends on #22756\n\nCC:  @fchapoton @jdemeyer\n\nKeywords: **numpy, pip, python**\n\nBranch: **[`2179ac8`](https://github.com/sagemath/sagetrac-mirror/commit/2179ac895c8d8aa9611837a0f5384199e526bd3a)**\n\nReviewer: **Fr\u00e9d\u00e9ric Chapoton, John Palmieri**\n\nAuthor: **Volker Braun**\n\nComponent: **python3**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/22582_\n\n",
    "closed_at": "2017-04-29T23:30:10Z",
    "created_at": "2017-03-11T10:46:42Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20python3",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.0",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Install pip into py2 + py3 and fix py3 dependencies build",
    "type": "issue",
    "updated_at": "2019-12-06T11:59:24Z",
    "url": "https://github.com/sagemath/sage/issues/22582",
    "user": "https://github.com/vbraun"
}
```
Install both pip2 and pip3, otherwise your python2 + python3 isn't that useful.

Then, let sage-pip-install explicitly use pip2 or pip3.

With this ticket the SAGE_PYTHON3=yes build only fails in sagelib, but works for all dependencies.

This ticket also updates numpy to version 1.12.1.

Depends on #22608
Depends on #22764
Depends on #22756

CC:  @fchapoton @jdemeyer

Keywords: **numpy, pip, python**

Branch: **[`2179ac8`](https://github.com/sagemath/sagetrac-mirror/commit/2179ac895c8d8aa9611837a0f5384199e526bd3a)**

Reviewer: **Frédéric Chapoton, John Palmieri**

Author: **Volker Braun**

Component: **python3**

_Issue created by migration from https://trac.sagemath.org/ticket/22582_





---

archive/issue_events_317001.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-03-11T10:46:42Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "milestone_number": null,
    "milestone_title": "sage-7.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22582#event-317001"
}
```



---

archive/issue_events_317002.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-03-11T10:46:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20python3",
    "label_color": "000080",
    "label_name": "c: python3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22582#event-317002"
}
```



---

archive/issue_events_317003.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-03-11T10:46:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22582#event-317003"
}
```



---

archive/issue_events_317004.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-03-11T10:46:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22582#event-317004"
}
```



---

archive/issue_comments_334675.json:
```json
{
    "body": "Dependencies: **#22608**",
    "created_at": "2017-03-18T15:43:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334675",
    "user": "https://github.com/vbraun"
}
```

Dependencies: **#22608**



---

archive/issue_comments_334676.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,3 @@\n-Now that we build both python2 and python3 we should install sage dependencies in both.\n+Install both pip2 and pip3, otherwise your python2 + python3 isn't that useful.\n+\n+With this ticket the build fails in sagelib, but works for all dependencies.\n``````\n",
    "created_at": "2017-03-18T15:43:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334676",
    "user": "https://github.com/vbraun"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,3 @@
-Now that we build both python2 and python3 we should install sage dependencies in both.
+Install both pip2 and pip3, otherwise your python2 + python3 isn't that useful.
+
+With this ticket the build fails in sagelib, but works for all dependencies.
``````




---

archive/issue_events_317005.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-03-18T15:43:19Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "title_is": "Install pip into py2 + py3",
    "title_was": "Install python packages into py2 + py3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22582#event-317005"
}
```



---

archive/issue_comments_334677.json:
```json
{
    "body": "Branch: **[u/vbraun/install_python_packages_into_2_and_3](https://github.com/sagemath/sagetrac-mirror/tree/u/vbraun/install_python_packages_into_2_and_3)**",
    "created_at": "2017-03-18T15:45:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334677",
    "user": "https://github.com/vbraun"
}
```

Branch: **[u/vbraun/install_python_packages_into_2_and_3](https://github.com/sagemath/sagetrac-mirror/tree/u/vbraun/install_python_packages_into_2_and_3)**



---

archive/issue_events_317006.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-03-18T15:51:34Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "title_is": "Install pip into py2 + py3 and fix py3 dependencies build",
    "title_was": "Install pip into py2 + py3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22582#event-317006"
}
```



---

archive/issue_comments_334678.json:
```json
{
    "body": "Commit: **[`ed3f9c5`](https://github.com/sagemath/sagetrac-mirror/commit/ed3f9c55f335e9a3acef6c306f5d1f54016c4e36)**",
    "created_at": "2017-03-18T15:51:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334678",
    "user": "https://github.com/vbraun"
}
```

Commit: **[`ed3f9c5`](https://github.com/sagemath/sagetrac-mirror/commit/ed3f9c55f335e9a3acef6c306f5d1f54016c4e36)**



---

archive/issue_comments_334679.json:
```json
{
    "body": "Author: **Volker Braun**",
    "created_at": "2017-03-18T15:51:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334679",
    "user": "https://github.com/vbraun"
}
```

Author: **Volker Braun**



---

archive/issue_comments_334680.json:
```json
{
    "body": "<div id=\"comment:3\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ed3f9c55f335e9a3acef6c306f5d1f54016c4e36\"><code>ed3f9c5</code></a></td><td><code>Install both pip2 and pip3, otherwise your python2 + python3 isn't that useful.</code></td></tr></table>\n",
    "created_at": "2017-03-18T15:51:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334680",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:3"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ed3f9c55f335e9a3acef6c306f5d1f54016c4e36"><code>ed3f9c5</code></a></td><td><code>Install both pip2 and pip3, otherwise your python2 + python3 isn't that useful.</code></td></tr></table>




---

archive/issue_comments_334681.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,5 @@\n Install both pip2 and pip3, otherwise your python2 + python3 isn't that useful.\n \n-With this ticket the build fails in sagelib, but works for all dependencies.\n+Then, let sage-pip-install explicitly use pip2 or pip3.\n+\n+With this ticket the SAGE_PYTHON3=yes build only fails in sagelib, but works for all dependencies.\n``````\n",
    "created_at": "2017-03-18T15:51:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334681",
    "user": "https://github.com/vbraun"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,5 @@
 Install both pip2 and pip3, otherwise your python2 + python3 isn't that useful.
 
-With this ticket the build fails in sagelib, but works for all dependencies.
+Then, let sage-pip-install explicitly use pip2 or pip3.
+
+With this ticket the SAGE_PYTHON3=yes build only fails in sagelib, but works for all dependencies.
``````




---

archive/issue_events_317007.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-03-18T16:06:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22582#event-317007"
}
```



---

archive/issue_events_317008.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-03-28T16:06:17Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "milestone_number": null,
    "milestone_title": "sage-7.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22582#event-317008"
}
```



---

archive/issue_events_317009.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-03-28T16:06:17Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "milestone_number": null,
    "milestone_title": "sage-8.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22582#event-317009"
}
```



---

archive/issue_comments_334682.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\n\n```\n+    echo \"Skipping SageNB since it is not Python compatible\"\n```\nthis should say \"not Python3 compatible\"",
    "created_at": "2017-03-30T07:22:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334682",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:6" align="right">comment:6</div>


```
+    echo "Skipping SageNB since it is not Python compatible"
```
this should say "not Python3 compatible"



---

archive/issue_comments_334683.json:
```json
{
    "body": "Changed commit from **[`ed3f9c5`](https://github.com/sagemath/sagetrac-mirror/commit/ed3f9c55f335e9a3acef6c306f5d1f54016c4e36)** to **[`742d9da`](https://github.com/sagemath/sagetrac-mirror/commit/742d9da9a0747589f88255514503e44f7306f37c)**",
    "created_at": "2017-04-01T20:09:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334683",
    "user": "https://github.com/fchapoton"
}
```

Changed commit from **[`ed3f9c5`](https://github.com/sagemath/sagetrac-mirror/commit/ed3f9c55f335e9a3acef6c306f5d1f54016c4e36)** to **[`742d9da`](https://github.com/sagemath/sagetrac-mirror/commit/742d9da9a0747589f88255514503e44f7306f37c)**



---

archive/issue_comments_334684.json:
```json
{
    "body": "Changed branch from **[u/vbraun/install_python_packages_into_2_and_3](https://github.com/sagemath/sagetrac-mirror/tree/u/vbraun/install_python_packages_into_2_and_3)** to **[public/22582](https://github.com/sagemath/sagetrac-mirror/tree/public/22582)**",
    "created_at": "2017-04-01T20:09:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334684",
    "user": "https://github.com/fchapoton"
}
```

Changed branch from **[u/vbraun/install_python_packages_into_2_and_3](https://github.com/sagemath/sagetrac-mirror/tree/u/vbraun/install_python_packages_into_2_and_3)** to **[public/22582](https://github.com/sagemath/sagetrac-mirror/tree/public/22582)**



---

archive/issue_comments_334685.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nok, I did the small change I suggested\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/df2c804263af7a7b805560bbeedc873404348d29\"><code>df2c804</code></a></td><td><code>Merge branch 'u/vbraun/install_python_packages_into_2_and_3' in 8.0.b0</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/742d9da9a0747589f88255514503e44f7306f37c\"><code>742d9da</code></a></td><td><code>trac 22582 change error message for sagenb+python3</code></td></tr></table>\n",
    "created_at": "2017-04-01T20:09:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334685",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:7" align="right">comment:7</div>

ok, I did the small change I suggested

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/df2c804263af7a7b805560bbeedc873404348d29"><code>df2c804</code></a></td><td><code>Merge branch 'u/vbraun/install_python_packages_into_2_and_3' in 8.0.b0</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/742d9da9a0747589f88255514503e44f7306f37c"><code>742d9da</code></a></td><td><code>trac 22582 change error message for sagenb+python3</code></td></tr></table>




---

archive/issue_comments_334686.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nThanks, sounds good to me.",
    "created_at": "2017-04-01T20:47:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334686",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:8" align="right">comment:8</div>

Thanks, sounds good to me.



---

archive/issue_comments_334687.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nThis looks good to me. But I do not quite dare to set a positive review, because I have not  tested that it does not break anything. Should I nevertheless set to positive, assuming that the buildbots will reveal any problem ?",
    "created_at": "2017-04-01T21:02:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334687",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:9" align="right">comment:9</div>

This looks good to me. But I do not quite dare to set a positive review, because I have not  tested that it does not break anything. Should I nevertheless set to positive, assuming that the buildbots will reveal any problem ?



---

archive/issue_comments_334688.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nThat would be the idea...",
    "created_at": "2017-04-01T21:52:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334688",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:10" align="right">comment:10</div>

That would be the idea...



---

archive/issue_comments_334689.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nok, then let us try",
    "created_at": "2017-04-02T08:20:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334689",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:11" align="right">comment:11</div>

ok, then let us try



---

archive/issue_comments_334690.json:
```json
{
    "body": "Reviewer: **Fr\u00e9d\u00e9ric Chapoton**",
    "created_at": "2017-04-02T08:20:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334690",
    "user": "https://github.com/fchapoton"
}
```

Reviewer: **Frédéric Chapoton**



---

archive/issue_events_317010.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-04-02T08:20:10Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22582#event-317010"
}
```



---

archive/issue_events_317011.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-04-02T08:20:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22582#event-317011"
}
```



---

archive/issue_comments_334691.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nIf I combine this ticket and its dependency, with SAGE_PYTHON3=yes, I get a failure on building cysignals:\n\n```\n[cysignals-1.3.2] config.status: executing build/src/cysignals/__init__.pxd commands\n[cysignals-1.3.2] Traceback (most recent call last):\n[cysignals-1.3.2]   File \"setup.py\", line 7, in <module>\n[cysignals-1.3.2]     from Cython.Build.Dependencies import cythonize\n[cysignals-1.3.2] ImportError: No module named Cython.Build.Dependencies\n[cysignals-1.3.2] Error: could not determine package name\n[cysignals-1.3.2] Error installing cysignals ... exiting\n```",
    "created_at": "2017-04-02T15:28:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334691",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:12" align="right">comment:12</div>

If I combine this ticket and its dependency, with SAGE_PYTHON3=yes, I get a failure on building cysignals:

```
[cysignals-1.3.2] config.status: executing build/src/cysignals/__init__.pxd commands
[cysignals-1.3.2] Traceback (most recent call last):
[cysignals-1.3.2]   File "setup.py", line 7, in <module>
[cysignals-1.3.2]     from Cython.Build.Dependencies import cythonize
[cysignals-1.3.2] ImportError: No module named Cython.Build.Dependencies
[cysignals-1.3.2] Error: could not determine package name
[cysignals-1.3.2] Error installing cysignals ... exiting
```



---

archive/issue_comments_334692.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nThis is because of \n\n```\n$ python setup.py --name\nTraceback (most recent call last):\n  File \"setup.py\", line 7, in <module>\n    from Cython.Build.Dependencies import cythonize\n```\ninside sage-pip-install. Cython is only installed into python3",
    "created_at": "2017-04-02T18:31:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334692",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:14" align="right">comment:14</div>

This is because of 

```
$ python setup.py --name
Traceback (most recent call last):
  File "setup.py", line 7, in <module>
    from Cython.Build.Dependencies import cythonize
```
inside sage-pip-install. Cython is only installed into python3



---

archive/issue_events_317012.json:
```json
{
    "actor": "https://github.com/sagetrac-git",
    "created_at": "2017-04-02T19:50:15Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22582#event-317012"
}
```



---

archive/issue_events_317013.json:
```json
{
    "actor": "https://github.com/sagetrac-git",
    "created_at": "2017-04-02T19:50:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22582#event-317013"
}
```



---

archive/issue_comments_334693.json:
```json
{
    "body": "<div id=\"comment:15\"></div>\n\nBranch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c3850faf21b51f8e4d5ac6fe65676f246a55d852\"><code>c3850fa</code></a></td><td><code>Use the correct python in sage-pip-install</code></td></tr></table>\n",
    "created_at": "2017-04-02T19:50:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334693",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:15"></div>

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c3850faf21b51f8e4d5ac6fe65676f246a55d852"><code>c3850fa</code></a></td><td><code>Use the correct python in sage-pip-install</code></td></tr></table>




---

archive/issue_comments_334694.json:
```json
{
    "body": "Changed commit from **[`742d9da`](https://github.com/sagemath/sagetrac-mirror/commit/742d9da9a0747589f88255514503e44f7306f37c)** to **[`c3850fa`](https://github.com/sagemath/sagetrac-mirror/commit/c3850faf21b51f8e4d5ac6fe65676f246a55d852)**",
    "created_at": "2017-04-02T19:50:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334694",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`742d9da`](https://github.com/sagemath/sagetrac-mirror/commit/742d9da9a0747589f88255514503e44f7306f37c)** to **[`c3850fa`](https://github.com/sagemath/sagetrac-mirror/commit/c3850faf21b51f8e4d5ac6fe65676f246a55d852)**



---

archive/issue_comments_334695.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nIf I try the latest branches for this ticket and its dependency with SAGE_PYTHON3=yes, it fails now on numpy:\n\n```\n[numpy-1.11.1.p0] Traceback (most recent call last):\n[numpy-1.11.1.p0]   File \"/home/chapoton/sage3/local/var/tmp/sage/build/numpy-1.11.1.p0/lapack_conf.py\", line 3, in <module>\n[numpy-1.11.1.p0]     import pkgconfig, os\n[numpy-1.11.1.p0] ImportError: No module named pkgconfig\n```\nEDIT:\nThis is preceded by\n\n```\n[pkgconfig-1.2.2.p0] Successfully installed pkgconfig-1.2.2.p0\n```",
    "created_at": "2017-04-03T14:57:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334695",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:16" align="right">comment:16</div>

If I try the latest branches for this ticket and its dependency with SAGE_PYTHON3=yes, it fails now on numpy:

```
[numpy-1.11.1.p0] Traceback (most recent call last):
[numpy-1.11.1.p0]   File "/home/chapoton/sage3/local/var/tmp/sage/build/numpy-1.11.1.p0/lapack_conf.py", line 3, in <module>
[numpy-1.11.1.p0]     import pkgconfig, os
[numpy-1.11.1.p0] ImportError: No module named pkgconfig
```
EDIT:
This is preceded by

```
[pkgconfig-1.2.2.p0] Successfully installed pkgconfig-1.2.2.p0
```



---

archive/issue_comments_334696.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nWorks for me... complete logs?",
    "created_at": "2017-04-03T17:09:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334696",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:17" align="right">comment:17</div>

Works for me... complete logs?



---

archive/issue_comments_334697.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nExact same thing with \"make build\" and SAGE_PYTHON3=yes on another computer. I did not use \"make dist-clean\". Which logs do you wanna see? The numpy log:\n\n```\nFound local metadata for numpy-1.11.1.p0\nUsing cached file /home/chapoton/sage3/upstream/numpy-1.11.1.tar.gz\nnumpy-1.11.1.p0\n====================================================\nSetting up build directory for numpy-1.11.1.p0\nFinished extraction\nApplying patches from ../patches...\nApplying ../patches/numpy-1.10.1-asarray_conversion.patch\npatching file numpy/core/function_base.py\nApplying ../patches/numpy-1.10.2-no-hardcode-blas.patch\npatching file numpy/distutils/system_info.py\nHunk #1 succeeded at 1685 (offset -5 lines).\nHunk #2 succeeded at 1718 (offset -4 lines).\nApplying ../patches/numpy-1.11.1-newlib-xlocale.patch\npatching file numpy/core/setup_common.py\npatching file numpy/core/src/multiarray/numpyos.c\n****************************************************\nHost system:\nLinux icj-laptop 4.8.0-45-generic #48-Ubuntu SMP Fri Mar 24 11:46:39 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux\n****************************************************\nC compiler: gcc\nC compiler version:\nUsing built-in specs.\nCOLLECT_GCC=gcc\nCOLLECT_LTO_WRAPPER=/usr/lib/gcc/x86_64-linux-gnu/6/lto-wrapper\nTarget: x86_64-linux-gnu\nConfigured with: ../src/configure -v --with-pkgversion='Ubuntu 6.2.0-5ubuntu12' --with-bugurl=file:///usr/share/doc/gcc-6/README.Bugs --enable-languages=c,ada,c++,java,go,d,fortran,objc,obj-c++ --prefix=/usr --program-suffix=-6 --program-prefix=x86_64-linux-gnu- --enable-shared --enable-linker-build-id --libexecdir=/usr/lib --without-included-gettext --enable-threads=posix --libdir=/usr/lib --enable-nls --with-sysroot=/ --enable-clocale=gnu --enable-libstdcxx-debug --enable-libstdcxx-time=yes --with-default-libstdcxx-abi=new --enable-gnu-unique-object --disable-vtable-verify --enable-libmpx --enable-plugin --enable-default-pie --with-system-zlib --disable-browser-plugin --enable-java-awt=gtk --enable-gtk-cairo --with-java-home=/usr/lib/jvm/java-1.5.0-gcj-6-amd64/jre --enable-java-home --with-jvm-root-dir=/usr/lib/jvm/java-1.5.0-gcj-6-amd64 --with-jvm-jar-dir=/usr/lib/jvm-exports/java-1.5.0-gcj-6-amd64 --with-arch-directory=amd64 --with-ecj-jar=/usr/share/java/eclipse-ecj.jar --enable-objc-gc --enable-multiarch --disable-werror --with-arch-32=i686 --with-abi=m64 --with-multilib-list=m32,m64,mx32 --enable-multilib --with-tune=generic --enable-checking=release --build=x86_64-linux-gnu --host=x86_64-linux-gnu --target=x86_64-linux-gnu\nThread model: posix\ngcc version 6.2.0 20161005 (Ubuntu 6.2.0-5ubuntu12) \n****************************************************\nTraceback (most recent call last):\n  File \"/home/chapoton/sage3/local/var/tmp/sage/build/numpy-1.11.1.p0/lapack_conf.py\", line 3, in <module>\n    import pkgconfig, os\nImportError: No module named pkgconfig\n\nreal\t0m0.021s\nuser\t0m0.008s\nsys\t0m0.008s\n************************************************************************\nError installing package numpy-1.11.1.p0\n************************************************************************\n```",
    "created_at": "2017-04-03T20:41:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334697",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:18" align="right">comment:18</div>

Exact same thing with "make build" and SAGE_PYTHON3=yes on another computer. I did not use "make dist-clean". Which logs do you wanna see? The numpy log:

```
Found local metadata for numpy-1.11.1.p0
Using cached file /home/chapoton/sage3/upstream/numpy-1.11.1.tar.gz
numpy-1.11.1.p0
====================================================
Setting up build directory for numpy-1.11.1.p0
Finished extraction
Applying patches from ../patches...
Applying ../patches/numpy-1.10.1-asarray_conversion.patch
patching file numpy/core/function_base.py
Applying ../patches/numpy-1.10.2-no-hardcode-blas.patch
patching file numpy/distutils/system_info.py
Hunk #1 succeeded at 1685 (offset -5 lines).
Hunk #2 succeeded at 1718 (offset -4 lines).
Applying ../patches/numpy-1.11.1-newlib-xlocale.patch
patching file numpy/core/setup_common.py
patching file numpy/core/src/multiarray/numpyos.c
****************************************************
Host system:
Linux icj-laptop 4.8.0-45-generic #48-Ubuntu SMP Fri Mar 24 11:46:39 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux
****************************************************
C compiler: gcc
C compiler version:
Using built-in specs.
COLLECT_GCC=gcc
COLLECT_LTO_WRAPPER=/usr/lib/gcc/x86_64-linux-gnu/6/lto-wrapper
Target: x86_64-linux-gnu
Configured with: ../src/configure -v --with-pkgversion='Ubuntu 6.2.0-5ubuntu12' --with-bugurl=file:///usr/share/doc/gcc-6/README.Bugs --enable-languages=c,ada,c++,java,go,d,fortran,objc,obj-c++ --prefix=/usr --program-suffix=-6 --program-prefix=x86_64-linux-gnu- --enable-shared --enable-linker-build-id --libexecdir=/usr/lib --without-included-gettext --enable-threads=posix --libdir=/usr/lib --enable-nls --with-sysroot=/ --enable-clocale=gnu --enable-libstdcxx-debug --enable-libstdcxx-time=yes --with-default-libstdcxx-abi=new --enable-gnu-unique-object --disable-vtable-verify --enable-libmpx --enable-plugin --enable-default-pie --with-system-zlib --disable-browser-plugin --enable-java-awt=gtk --enable-gtk-cairo --with-java-home=/usr/lib/jvm/java-1.5.0-gcj-6-amd64/jre --enable-java-home --with-jvm-root-dir=/usr/lib/jvm/java-1.5.0-gcj-6-amd64 --with-jvm-jar-dir=/usr/lib/jvm-exports/java-1.5.0-gcj-6-amd64 --with-arch-directory=amd64 --with-ecj-jar=/usr/share/java/eclipse-ecj.jar --enable-objc-gc --enable-multiarch --disable-werror --with-arch-32=i686 --with-abi=m64 --with-multilib-list=m32,m64,mx32 --enable-multilib --with-tune=generic --enable-checking=release --build=x86_64-linux-gnu --host=x86_64-linux-gnu --target=x86_64-linux-gnu
Thread model: posix
gcc version 6.2.0 20161005 (Ubuntu 6.2.0-5ubuntu12) 
****************************************************
Traceback (most recent call last):
  File "/home/chapoton/sage3/local/var/tmp/sage/build/numpy-1.11.1.p0/lapack_conf.py", line 3, in <module>
    import pkgconfig, os
ImportError: No module named pkgconfig

real	0m0.021s
user	0m0.008s
sys	0m0.008s
************************************************************************
Error installing package numpy-1.11.1.p0
************************************************************************
```



---

archive/issue_comments_334698.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nsame thing after \"make distclean\"",
    "created_at": "2017-04-04T12:01:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334698",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:19" align="right">comment:19</div>

same thing after "make distclean"



---

archive/issue_comments_334699.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nin fact, this already happens with just #22608 applied..",
    "created_at": "2017-04-04T19:10:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334699",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:20" align="right">comment:20</div>

in fact, this already happens with just #22608 applied..



---

archive/issue_comments_334700.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nPython 3 comes with pip, why do you want to install it!?\n\n```\n$ sage -sh -c \"python3 -m pip\"\n```\nWhat should be done is a proper shortcut `pip3 -> python3 -m pip`.",
    "created_at": "2017-04-04T21:30:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334700",
    "user": "https://github.com/videlec"
}
```

<div id="comment:21" align="right">comment:21</div>

Python 3 comes with pip, why do you want to install it!?

```
$ sage -sh -c "python3 -m pip"
```
What should be done is a proper shortcut `pip3 -> python3 -m pip`.



---

archive/issue_comments_334701.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nI tried to test this on OS X and ran into the problem that Sage's Python3 build is broken on OS X. See #22756.",
    "created_at": "2017-04-04T21:40:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334701",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:22" align="right">comment:22</div>

I tried to test this on OS X and ran into the problem that Sage's Python3 build is broken on OS X. See #22756.



---

archive/issue_events_317014.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-04-07T08:37:29Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22582#event-317014"
}
```



---

archive/issue_events_317015.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-04-07T08:37:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22582#event-317015"
}
```



---

archive/issue_comments_334702.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nReplying to [@videlec](#comment:21):\n> Python 3 comes with pip, why do you want to install it!?\n> \n> ```\n> $ sage -sh -c \"python3 -m pip\"\n> ```\n> What should be done is a proper shortcut `pip3 -> python3 -m pip`.\n\nping?",
    "created_at": "2017-04-07T08:37:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334702",
    "user": "https://github.com/videlec"
}
```

<div id="comment:23" align="right">comment:23</div>

Replying to [@videlec](#comment:21):
> Python 3 comes with pip, why do you want to install it!?
> 
> ```
> $ sage -sh -c "python3 -m pip"
> ```
> What should be done is a proper shortcut `pip3 -> python3 -m pip`.

ping?



---

archive/issue_comments_334703.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nI think the patch to the `README.rst` file in `fpylll` is not necessary in Sage 8.0.beta1: fpylll version 0.2.4dev does not have those non-ascii characters. (Or at least python3 does not complain about 0.2.4dev the way it does for 0.2.3dev.)",
    "created_at": "2017-04-07T14:49:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334703",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:24" align="right">comment:24</div>

I think the patch to the `README.rst` file in `fpylll` is not necessary in Sage 8.0.beta1: fpylll version 0.2.4dev does not have those non-ascii characters. (Or at least python3 does not complain about 0.2.4dev the way it does for 0.2.3dev.)



---

archive/issue_comments_334704.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nReplying to [@videlec](#comment:21):\n> Python 3 comes with pip, why do you want to install it!?\n> \n> ```\n> $ sage -sh -c \"python3 -m pip\"\n> ```\n> What should be done is a proper shortcut `pip3 -> python3 -m pip`.\n\nIf I just install Sage's `python3` and its dependencies, then `python3 -m pip` tells me `No module named pip`, probably because I'm on OS X without `openssl`. That's an advantage to Sage's `pip`: it doesn't require Python's `ssl` module. So I say we should install it even with Python 3.",
    "created_at": "2017-04-07T16:04:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334704",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:25" align="right">comment:25</div>

Replying to [@videlec](#comment:21):
> Python 3 comes with pip, why do you want to install it!?
> 
> ```
> $ sage -sh -c "python3 -m pip"
> ```
> What should be done is a proper shortcut `pip3 -> python3 -m pip`.

If I just install Sage's `python3` and its dependencies, then `python3 -m pip` tells me `No module named pip`, probably because I'm on OS X without `openssl`. That's an advantage to Sage's `pip`: it doesn't require Python's `ssl` module. So I say we should install it even with Python 3.



---

archive/issue_comments_334705.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nReplying to [@fchapoton](#comment:16):\n> If I try the latest branches for this ticket and its dependency with SAGE_PYTHON3=yes, it fails now on numpy:\n> \n> ```\n> [numpy-1.11.1.p0] Traceback (most recent call last):\n> [numpy-1.11.1.p0]   File \"/home/chapoton/sage3/local/var/tmp/sage/build/numpy-1.11.1.p0/lapack_conf.py\", line 3, in <module>\n> [numpy-1.11.1.p0]     import pkgconfig, os\n> [numpy-1.11.1.p0] ImportError: No module named pkgconfig\n> ```\n> EDIT:\n> This is preceded by\n> \n> ```\n> [pkgconfig-1.2.2.p0] Successfully installed pkgconfig-1.2.2.p0\n> ```\n\nI see the same error. I think the problem is a race condition between `python2` and `python3`: whichever one is built second creates a symlink `local/bin/python`, and that version of python is used to execute the script `build/pkgs/numpy/lapack_conf.py`. In my case, the link points to `python2`, which is not the right one if you have `SAGE_PYTHON3=yes`.",
    "created_at": "2017-04-08T02:54:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334705",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:26" align="right">comment:26</div>

Replying to [@fchapoton](#comment:16):
> If I try the latest branches for this ticket and its dependency with SAGE_PYTHON3=yes, it fails now on numpy:
> 
> ```
> [numpy-1.11.1.p0] Traceback (most recent call last):
> [numpy-1.11.1.p0]   File "/home/chapoton/sage3/local/var/tmp/sage/build/numpy-1.11.1.p0/lapack_conf.py", line 3, in <module>
> [numpy-1.11.1.p0]     import pkgconfig, os
> [numpy-1.11.1.p0] ImportError: No module named pkgconfig
> ```
> EDIT:
> This is preceded by
> 
> ```
> [pkgconfig-1.2.2.p0] Successfully installed pkgconfig-1.2.2.p0
> ```

I see the same error. I think the problem is a race condition between `python2` and `python3`: whichever one is built second creates a symlink `local/bin/python`, and that version of python is used to execute the script `build/pkgs/numpy/lapack_conf.py`. In my case, the link points to `python2`, which is not the right one if you have `SAGE_PYTHON3=yes`.



---

archive/issue_comments_334706.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\npip2/3 has the right shebang pointing to the corresponding python\n\n```\n(sage-sh) vbraun@volker:git$ head -1 local/bin/pip?\n==> local/bin/pip2 <==\n#!/home/vbraun/Code/sage.git/local/bin/python2\n\n==> local/bin/pip3 <==\n#!/home/vbraun/Code/sage.git/local/bin/python3\n```\nSo it is already a shortcut for corresponding-python-version -m pip",
    "created_at": "2017-04-08T11:18:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334706",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:27" align="right">comment:27</div>

pip2/3 has the right shebang pointing to the corresponding python

```
(sage-sh) vbraun@volker:git$ head -1 local/bin/pip?
==> local/bin/pip2 <==
#!/home/vbraun/Code/sage.git/local/bin/python2

==> local/bin/pip3 <==
#!/home/vbraun/Code/sage.git/local/bin/python3
```
So it is already a shortcut for corresponding-python-version -m pip



---

archive/issue_comments_334707.json:
```json
{
    "body": "Changed commit from **[`c3850fa`](https://github.com/sagemath/sagetrac-mirror/commit/c3850faf21b51f8e4d5ac6fe65676f246a55d852)** to **[`b7a4acb`](https://github.com/sagemath/sagetrac-mirror/commit/b7a4acb53bba80f25560ee32612b20b7c25df19d)**",
    "created_at": "2017-04-08T14:38:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334707",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`c3850fa`](https://github.com/sagemath/sagetrac-mirror/commit/c3850faf21b51f8e4d5ac6fe65676f246a55d852)** to **[`b7a4acb`](https://github.com/sagemath/sagetrac-mirror/commit/b7a4acb53bba80f25560ee32612b20b7c25df19d)**



---

archive/issue_comments_334708.json:
```json
{
    "body": "<div id=\"comment:28\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1d05b19816f2e018730bb9b518cd5e157af4e2a0\"><code>1d05b19</code></a></td><td><code>Merge tag '8.0.beta1' into t/22582/install_python_packages_into_2_and_3</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9e4522c53e7361ace9bf22a9c3831715fea7fce7\"><code>9e4522c</code></a></td><td><code>Make numpy build with py3 (includes update to 1.12.1)</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/20340eac637bae0ef09a0536219ec0b3f6c3bb7d\"><code>20340ea</code></a></td><td><code>Remove the fpylll README patch</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b7a4acb53bba80f25560ee32612b20b7c25df19d\"><code>b7a4acb</code></a></td><td><code>Use correct python for creating the grammar pickle</code></td></tr></table>\n",
    "created_at": "2017-04-08T14:38:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334708",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:28"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1d05b19816f2e018730bb9b518cd5e157af4e2a0"><code>1d05b19</code></a></td><td><code>Merge tag '8.0.beta1' into t/22582/install_python_packages_into_2_and_3</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9e4522c53e7361ace9bf22a9c3831715fea7fce7"><code>9e4522c</code></a></td><td><code>Make numpy build with py3 (includes update to 1.12.1)</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/20340eac637bae0ef09a0536219ec0b3f6c3bb7d"><code>20340ea</code></a></td><td><code>Remove the fpylll README patch</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b7a4acb53bba80f25560ee32612b20b7c25df19d"><code>b7a4acb</code></a></td><td><code>Use correct python for creating the grammar pickle</code></td></tr></table>




---

archive/issue_comments_334709.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nFixed...",
    "created_at": "2017-04-08T14:39:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334709",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:29" align="right">comment:29</div>

Fixed...



---

archive/issue_events_317016.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-04-08T14:39:33Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22582#event-317016"
}
```



---

archive/issue_events_317017.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-04-08T14:39:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22582#event-317017"
}
```



---

archive/issue_comments_334710.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nThis doesn't fix the race condition, so sometimes `python` will point to `python2`, sometimes to `python3`. This will affect any packages that use `python setup.py` in their `spkg-install`, for example:\n\n```\n$ grep -R 'python setup' build/pkgs\n./gambit/spkg-install:python setup.py --no-user-cfg build install\n./numpy/spkg-install:sage-python setup.py \\\n./pillow/spkg-install:python setup.py \\\n./pycrypto/spkg-check:python setup.py test\n./python_igraph/spkg-check:python setup.py check\n./scons/spkg-install:python setup.py --no-user-cfg install\n```\nThere are going to be other potential issues. See for example zn_poly's spkg-install:\n\n```\n# use 2to3 if we are running on python3\nif python -c 'import sys; sys.exit(sys.version_info.major != 3)'; then\n    2to3 -n -w --no-diffs makemakefile.py\nfi\n```\nI think either we need to not create the symlink pointing to python3 in the python3 spkg-install and fix any resulting issues, or (my preference) we need to make sure the symlink points to the correct python by creating the appropriate symlink also in the *python2* spkg-install, in case it gets built second.\n\nEdit: run\n\n```\ngrep -R -w python build/pkgs --include spkg-install\n```\nto see instances of `python` in spkg-install scripts. There will be more instances in spkg-check or other scripts, like matplotlib's make-setup-config.py. Having the symlink always point to python2 will require fixing all of these, and it will also make Sage harder to maintain.",
    "created_at": "2017-04-08T15:38:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334710",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:30" align="right">comment:30</div>

This doesn't fix the race condition, so sometimes `python` will point to `python2`, sometimes to `python3`. This will affect any packages that use `python setup.py` in their `spkg-install`, for example:

```
$ grep -R 'python setup' build/pkgs
./gambit/spkg-install:python setup.py --no-user-cfg build install
./numpy/spkg-install:sage-python setup.py \
./pillow/spkg-install:python setup.py \
./pycrypto/spkg-check:python setup.py test
./python_igraph/spkg-check:python setup.py check
./scons/spkg-install:python setup.py --no-user-cfg install
```
There are going to be other potential issues. See for example zn_poly's spkg-install:

```
# use 2to3 if we are running on python3
if python -c 'import sys; sys.exit(sys.version_info.major != 3)'; then
    2to3 -n -w --no-diffs makemakefile.py
fi
```
I think either we need to not create the symlink pointing to python3 in the python3 spkg-install and fix any resulting issues, or (my preference) we need to make sure the symlink points to the correct python by creating the appropriate symlink also in the *python2* spkg-install, in case it gets built second.

Edit: run

```
grep -R -w python build/pkgs --include spkg-install
```
to see instances of `python` in spkg-install scripts. There will be more instances in spkg-check or other scripts, like matplotlib's make-setup-config.py. Having the symlink always point to python2 will require fixing all of these, and it will also make Sage harder to maintain.



---

archive/issue_comments_334711.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\n* Its easiest to just switch the python symlink at build time\nvs \n* pep 394 says: *The more general python command should be installed whenever any version of Python 2 is installed and should invoke the same version of Python as the python2 command*\n* switching the python symlink introduces state (so you can't build other packages with and without SAGE_PYTHON3)\n* distributions may or may not have python symlink to python2 \nI have a slight perference for the latter, tough I'm open for discussing this\n\nNot all of the occurences of python in build/ are issues; Ideally such scripts are version-independent and work with either the system python or Sage's python2/3. \n* matplotlib/make-setup-config.py needlessly depends on six and could easily be version-independent\n* Calls to \"python setup.py\" should be replaced with sage-pip-install anyways",
    "created_at": "2017-04-08T16:15:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334711",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:31" align="right">comment:31</div>

* Its easiest to just switch the python symlink at build time
vs 
* pep 394 says: *The more general python command should be installed whenever any version of Python 2 is installed and should invoke the same version of Python as the python2 command*
* switching the python symlink introduces state (so you can't build other packages with and without SAGE_PYTHON3)
* distributions may or may not have python symlink to python2 
I have a slight perference for the latter, tough I'm open for discussing this

Not all of the occurences of python in build/ are issues; Ideally such scripts are version-independent and work with either the system python or Sage's python2/3. 
* matplotlib/make-setup-config.py needlessly depends on six and could easily be version-independent
* Calls to "python setup.py" should be replaced with sage-pip-install anyways



---

archive/issue_comments_334712.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nShould `SAGE_PYTHON3` only have an effect at build time, or should it also control run time behavior? I guess it has to control run time behavior, at least as things are currently, many all of the relevant python packages get installed only to `local/lib/python$VERSION/site-packages/`. The symlink makes this easier (even trivial?) to implement.\n\nI am not quite persuaded by PEP 394, since we're not really installing Python for general use; we're installing it for use within a specific environment, the Sage build environment.\n\nAlso, I agree that cleaning up things like `python setup.py --> sage-pip-install` would be great. For what it's worth, note that running `matplotlib/make-setup-config.py` with python3 led to the discovery of a minor bug -- see #22772.",
    "created_at": "2017-04-08T16:34:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334712",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:32" align="right">comment:32</div>

Should `SAGE_PYTHON3` only have an effect at build time, or should it also control run time behavior? I guess it has to control run time behavior, at least as things are currently, many all of the relevant python packages get installed only to `local/lib/python$VERSION/site-packages/`. The symlink makes this easier (even trivial?) to implement.

I am not quite persuaded by PEP 394, since we're not really installing Python for general use; we're installing it for use within a specific environment, the Sage build environment.

Also, I agree that cleaning up things like `python setup.py --> sage-pip-install` would be great. For what it's worth, note that running `matplotlib/make-setup-config.py` with python3 led to the discovery of a minor bug -- see #22772.



---

archive/issue_comments_334713.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nJust to confirm that there are problems: I tested the current branch (+ #22756, #22765, #22772 so everything works on OS X), plus I added a dependency to make sure `python3` got built before `python2`. Then with `SAGE_PYTHON3=yes`, pillow gets installed in `python2.7/site-packages/`, not in `python3.5/site-packages/`.",
    "created_at": "2017-04-08T16:37:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334713",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:33" align="right">comment:33</div>

Just to confirm that there are problems: I tested the current branch (+ #22756, #22765, #22772 so everything works on OS X), plus I added a dependency to make sure `python3` got built before `python2`. Then with `SAGE_PYTHON3=yes`, pillow gets installed in `python2.7/site-packages/`, not in `python3.5/site-packages/`.



---

archive/issue_comments_334714.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nThe numpy builds also fails with the error `ImportError: No module named numpy`, I think because of this in spkg-install:\n\n```\n# Touch all includes such that dependency checking works properly:\n# the timestamp of the includes should be *now*, not the time when\n# the numpy package was created.\npython <<EOF\nimport os\nos.chdir(os.environ[\"SAGE_ROOT\"])  # Import numpy from safe location\nimport numpy\nos.chdir(numpy.get_include())\nos.system(\"touch numpy/*\")\nEOF\n```\nEasy enough to fix with your proposal: change `python` to `sage_python`.",
    "created_at": "2017-04-08T17:08:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334714",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:34" align="right">comment:34</div>

The numpy builds also fails with the error `ImportError: No module named numpy`, I think because of this in spkg-install:

```
# Touch all includes such that dependency checking works properly:
# the timestamp of the includes should be *now*, not the time when
# the numpy package was created.
python <<EOF
import os
os.chdir(os.environ["SAGE_ROOT"])  # Import numpy from safe location
import numpy
os.chdir(numpy.get_include())
os.system("touch numpy/*")
EOF
```
Easy enough to fix with your proposal: change `python` to `sage_python`.



---

archive/issue_comments_334715.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nIts a bit premature to worry about how to run sage-on-python3, but one possibility would be to have a specific sage3 command. Using an environment variable doesn't sound clean to me.",
    "created_at": "2017-04-08T17:09:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334715",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:35" align="right">comment:35</div>

Its a bit premature to worry about how to run sage-on-python3, but one possibility would be to have a specific sage3 command. Using an environment variable doesn't sound clean to me.



---

archive/issue_events_317018.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2017-04-08T18:03:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22582#event-317018"
}
```



---

archive/issue_events_317019.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2017-04-08T18:03:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22582#event-317019"
}
```



---

archive/issue_comments_334716.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nI'm not sure which approach is the best; I'd like to hear other views. In any case, this needs work.",
    "created_at": "2017-04-08T18:03:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334716",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:36" align="right">comment:36</div>

I'm not sure which approach is the best; I'd like to hear other views. In any case, this needs work.



---

archive/issue_comments_334717.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nReplying to [@vbraun](#comment:35):\n> Its a bit premature to worry about how to run sage-on-python3, but one possibility would be to have a specific sage3 command. Using an environment variable doesn't sound clean to me.\n\nWhy not try to plan ahead?\n\nAs things stand, to run sage-on-python3, you would have to build with `SAGE_PYTHON3=yes` first, in which case sage-on-python2 will not work. So the build-time and run-time choices of Python version have to match up. I guess we could build everything for both Python 2 and 3, but that seems like a waste of space.",
    "created_at": "2017-04-08T18:07:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334717",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:37" align="right">comment:37</div>

Replying to [@vbraun](#comment:35):
> Its a bit premature to worry about how to run sage-on-python3, but one possibility would be to have a specific sage3 command. Using an environment variable doesn't sound clean to me.

Why not try to plan ahead?

As things stand, to run sage-on-python3, you would have to build with `SAGE_PYTHON3=yes` first, in which case sage-on-python2 will not work. So the build-time and run-time choices of Python version have to match up. I guess we could build everything for both Python 2 and 3, but that seems like a waste of space.



---

archive/issue_comments_334718.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nI also think we should merge the functools change soon, so in case this ticket takes a while, see #22770. Same for the sagenb change: #22787. Both of those are obstacles to building with `SAGE_PYTHON3=yes` right now, and I think are independent of this ticket.\n\nIf this ticket gets positively reviewed and merged soon, we can ignore the others, but in case this takes a while, we can at least fix those changes.",
    "created_at": "2017-04-08T21:16:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334718",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:38" align="right">comment:38</div>

I also think we should merge the functools change soon, so in case this ticket takes a while, see #22770. Same for the sagenb change: #22787. Both of those are obstacles to building with `SAGE_PYTHON3=yes` right now, and I think are independent of this ticket.

If this ticket gets positively reviewed and merged soon, we can ignore the others, but in case this takes a while, we can at least fix those changes.



---

archive/issue_comments_334719.json:
```json
{
    "body": "Changed commit from **[`b7a4acb`](https://github.com/sagemath/sagetrac-mirror/commit/b7a4acb53bba80f25560ee32612b20b7c25df19d)** to **[`04fe607`](https://github.com/sagemath/sagetrac-mirror/commit/04fe607384755ba52a40a9328cb052053c992865)**",
    "created_at": "2017-04-08T22:15:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334719",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`b7a4acb`](https://github.com/sagemath/sagetrac-mirror/commit/b7a4acb53bba80f25560ee32612b20b7c25df19d)** to **[`04fe607`](https://github.com/sagemath/sagetrac-mirror/commit/04fe607384755ba52a40a9328cb052053c992865)**



---

archive/issue_comments_334720.json:
```json
{
    "body": "<div id=\"comment:39\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ce87def3f8bb4ebb670d879212208d0f9fbff107\"><code>ce87def</code></a></td><td><code>Make matplotlib/make-setup-config.py independent of six</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/97c3fd89df31512c9a176ca4757559077cb09e17\"><code>97c3fd8</code></a></td><td><code>Fix numpy spkg-install</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c6b7fae78adfce1cc370eec1c5be8f5563110e7a\"><code>c6b7fae</code></a></td><td><code>Fix python -> python2 symlink</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6078c6b6965449dabc82de4f3e872a23525fc8ef\"><code>6078c6b</code></a></td><td><code>Remove unneccesary python call from matplotlib spkg-install</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/04fe607384755ba52a40a9328cb052053c992865\"><code>04fe607</code></a></td><td><code>Use sage-python to install pillow</code></td></tr></table>\n",
    "created_at": "2017-04-08T22:15:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334720",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:39"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ce87def3f8bb4ebb670d879212208d0f9fbff107"><code>ce87def</code></a></td><td><code>Make matplotlib/make-setup-config.py independent of six</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/97c3fd89df31512c9a176ca4757559077cb09e17"><code>97c3fd8</code></a></td><td><code>Fix numpy spkg-install</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c6b7fae78adfce1cc370eec1c5be8f5563110e7a"><code>c6b7fae</code></a></td><td><code>Fix python -> python2 symlink</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6078c6b6965449dabc82de4f3e872a23525fc8ef"><code>6078c6b</code></a></td><td><code>Remove unneccesary python call from matplotlib spkg-install</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/04fe607384755ba52a40a9328cb052053c992865"><code>04fe607</code></a></td><td><code>Use sage-python to install pillow</code></td></tr></table>




---

archive/issue_events_317020.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-04-08T22:45:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22582#event-317020"
}
```



---

archive/issue_events_317021.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-04-08T22:45:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22582#event-317021"
}
```



---

archive/issue_comments_334721.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nThis now works for me (builds up to sagelib), with python -> python2 regardless of SAGE_PYTHON3, hopefully race-free. \n\nThe only thing that still ends up being installed with SAGE_PYTHON3=yes into lib/python2.7 is brial, which has a hardcoded python2.7 in its configure.ac",
    "created_at": "2017-04-08T22:45:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334721",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:40" align="right">comment:40</div>

This now works for me (builds up to sagelib), with python -> python2 regardless of SAGE_PYTHON3, hopefully race-free. 

The only thing that still ends up being installed with SAGE_PYTHON3=yes into lib/python2.7 is brial, which has a hardcoded python2.7 in its configure.ac



---

archive/issue_comments_334722.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nExcept that sagenb doesn't build on python2 since it trips over the /lib/python/ symlink missing",
    "created_at": "2017-04-09T09:15:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334722",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:41" align="right">comment:41</div>

Except that sagenb doesn't build on python2 since it trips over the /lib/python/ symlink missing



---

archive/issue_comments_334723.json:
```json
{
    "body": "Changed dependencies from **#22608** to **#22608, #22764**",
    "created_at": "2017-04-09T09:15:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334723",
    "user": "https://github.com/vbraun"
}
```

Changed dependencies from **#22608** to **#22608, #22764**



---

archive/issue_comments_334724.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nDoes anyone else have any opinions on whether `SAGE_PYTHON3=yes` should lead to the creation of a symlink `python -> python3`?",
    "created_at": "2017-04-12T20:09:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334724",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:42" align="right">comment:42</div>

Does anyone else have any opinions on whether `SAGE_PYTHON3=yes` should lead to the creation of a symlink `python -> python3`?



---

archive/issue_comments_334725.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nI have not followed in detail all the tickets around the one here. In my opinion, setting $SAGE_PYTHON3 to yes should do all what is needed at the build level so that, one day, when all our cython and python files compiles, sage will start with py3. I agree that the legacy sagenb can be desactivated when SAGE_PYTHON3 is yes.",
    "created_at": "2017-04-12T20:32:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334725",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:43" align="right">comment:43</div>

I have not followed in detail all the tickets around the one here. In my opinion, setting $SAGE_PYTHON3 to yes should do all what is needed at the build level so that, one day, when all our cython and python files compiles, sage will start with py3. I agree that the legacy sagenb can be desactivated when SAGE_PYTHON3 is yes.



---

archive/issue_comments_334726.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\nI have a separate question for Volker: was the name `build/bin/sage-python` chosen intentionally to shadow the already existing `local/bin/sage-python`? That could lead to unintended (or intended?) consequences. Maybe it would be clearer to call it something like `build/bin/sage-python2-or-3`.",
    "created_at": "2017-04-12T20:49:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334726",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:44" align="right">comment:44</div>

I have a separate question for Volker: was the name `build/bin/sage-python` chosen intentionally to shadow the already existing `local/bin/sage-python`? That could lead to unintended (or intended?) consequences. Maybe it would be clearer to call it something like `build/bin/sage-python2-or-3`.



---

archive/issue_comments_334727.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\nIMHO we shouldn't tie our python3 support to where the python symlink points to. Pep 394 is pretty clear what it should be now, and it implies that it'll change in the future. Meaning that distributions will change over time; If we want Sage to be package-able then its just an additional unnecessary hurdle. Instead, do what everybody else does and have a sage3 launch script (or symlink to sage and look at argv[0]).\n\nI didn't think about local/bin/sage-python, though I don't think there is a conflict. In fact, local/bin/sage-python seems to serve no useful purpose. Its only used from src/bin/sage-run to launch python from a shell script from python...",
    "created_at": "2017-04-12T20:58:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334727",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:45" align="right">comment:45</div>

IMHO we shouldn't tie our python3 support to where the python symlink points to. Pep 394 is pretty clear what it should be now, and it implies that it'll change in the future. Meaning that distributions will change over time; If we want Sage to be package-able then its just an additional unnecessary hurdle. Instead, do what everybody else does and have a sage3 launch script (or symlink to sage and look at argv[0]).

I didn't think about local/bin/sage-python, though I don't think there is a conflict. In fact, local/bin/sage-python seems to serve no useful purpose. Its only used from src/bin/sage-run to launch python from a shell script from python...



---

archive/issue_comments_334728.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">comment:46</div>\n\nI agree that `local/bin/sage-python` serves no useful purpose. There is a conflict, though, because `build/bin/sage-python` will get run instead -- at least in my version of Sage, `build/bin` comes earlier in `PATH` than `src/bin` or `local/bin` -- and so the effect will be different depending on the setting of `SAGE_PYTHON3`.",
    "created_at": "2017-04-12T21:15:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334728",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:46" align="right">comment:46</div>

I agree that `local/bin/sage-python` serves no useful purpose. There is a conflict, though, because `build/bin/sage-python` will get run instead -- at least in my version of Sage, `build/bin` comes earlier in `PATH` than `src/bin` or `local/bin` -- and so the effect will be different depending on the setting of `SAGE_PYTHON3`.



---

archive/issue_comments_334729.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">comment:47</div>\n\ndoes not apply",
    "created_at": "2017-04-16T07:04:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334729",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:47" align="right">comment:47</div>

does not apply



---

archive/issue_events_317022.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-04-16T07:04:25Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22582#event-317022"
}
```



---

archive/issue_events_317023.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-04-16T07:04:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22582#event-317023"
}
```



---

archive/issue_comments_334730.json:
```json
{
    "body": "<div id=\"comment:48\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/10374c1dbbe02f00fa0682b59f5a23550b0c56ec\"><code>10374c1</code></a></td><td><code>Merge tag '8.0.beta2' into t/22582/install_python_packages_into_2_and_3</code></td></tr></table>\n",
    "created_at": "2017-04-16T21:17:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334730",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:48"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/10374c1dbbe02f00fa0682b59f5a23550b0c56ec"><code>10374c1</code></a></td><td><code>Merge tag '8.0.beta2' into t/22582/install_python_packages_into_2_and_3</code></td></tr></table>




---

archive/issue_comments_334731.json:
```json
{
    "body": "Changed commit from **[`04fe607`](https://github.com/sagemath/sagetrac-mirror/commit/04fe607384755ba52a40a9328cb052053c992865)** to **[`10374c1`](https://github.com/sagemath/sagetrac-mirror/commit/10374c1dbbe02f00fa0682b59f5a23550b0c56ec)**",
    "created_at": "2017-04-16T21:17:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334731",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`04fe607`](https://github.com/sagemath/sagetrac-mirror/commit/04fe607384755ba52a40a9328cb052053c992865)** to **[`10374c1`](https://github.com/sagemath/sagetrac-mirror/commit/10374c1dbbe02f00fa0682b59f5a23550b0c56ec)**



---

archive/issue_comments_334732.json:
```json
{
    "body": "Changed commit from **[`10374c1`](https://github.com/sagemath/sagetrac-mirror/commit/10374c1dbbe02f00fa0682b59f5a23550b0c56ec)** to **[`bc4c2f5`](https://github.com/sagemath/sagetrac-mirror/commit/bc4c2f5b99bfd780c8d95b67dcc2638563a40683)**",
    "created_at": "2017-04-18T18:18:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334732",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`10374c1`](https://github.com/sagemath/sagetrac-mirror/commit/10374c1dbbe02f00fa0682b59f5a23550b0c56ec)** to **[`bc4c2f5`](https://github.com/sagemath/sagetrac-mirror/commit/bc4c2f5b99bfd780c8d95b67dcc2638563a40683)**



---

archive/issue_comments_334733.json:
```json
{
    "body": "<div id=\"comment:49\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0e90d5294f2dd1f95f2e96bf34830d1256a3f211\"><code>0e90d52</code></a></td><td><code>Trac 22764: remove the link SAGE_LOCAL/lib/python -> python2.7</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f33e86f76463c02dee30513fd5553ebbe5a228d5\"><code>f33e86f</code></a></td><td><code>trac 22764: replace a few instances of</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b02ecf34018f48b24012623c5388a34d589bb3d2\"><code>b02ecf3</code></a></td><td><code>trac 22764: in a few comments and print statements, fix a few</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/df6a763f1c6190cbcb33501fdf7b6f4e5ee46400\"><code>df6a763</code></a></td><td><code>trac 22764: rebase to Sage 8.0.beta1</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7cd0d62ad1fe72747813b665682fea591aaf2a80\"><code>7cd0d62</code></a></td><td><code>trac 22764: merge with 8.0.beta1</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ab49413b6ee1f7eebcc9044caf2c0abc45aad746\"><code>ab49413</code></a></td><td><code>trac 22764: change how check whether Sage is built.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4715169cfe365879fa69f1046516731a7f50aa82\"><code>4715169</code></a></td><td><code>merging with 8.0.beta2</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fb90d5e3667237f2d9fc7ba982b466bc52802b1d\"><code>fb90d5e</code></a></td><td><code>trac 22764: check whether Sage is built by looking for local/bin/sage</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dc46ea2dfa97be79d7ef8ddbe9130d4c717acc3d\"><code>dc46ea2</code></a></td><td><code>trac 22582: fix merge conflicts</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bc4c2f5b99bfd780c8d95b67dcc2638563a40683\"><code>bc4c2f5</code></a></td><td><code>trac 22582: rename build/bin/sage-python to sage-python23</code></td></tr></table>\n",
    "created_at": "2017-04-18T18:18:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334733",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:49"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0e90d5294f2dd1f95f2e96bf34830d1256a3f211"><code>0e90d52</code></a></td><td><code>Trac 22764: remove the link SAGE_LOCAL/lib/python -> python2.7</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f33e86f76463c02dee30513fd5553ebbe5a228d5"><code>f33e86f</code></a></td><td><code>trac 22764: replace a few instances of</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b02ecf34018f48b24012623c5388a34d589bb3d2"><code>b02ecf3</code></a></td><td><code>trac 22764: in a few comments and print statements, fix a few</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/df6a763f1c6190cbcb33501fdf7b6f4e5ee46400"><code>df6a763</code></a></td><td><code>trac 22764: rebase to Sage 8.0.beta1</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7cd0d62ad1fe72747813b665682fea591aaf2a80"><code>7cd0d62</code></a></td><td><code>trac 22764: merge with 8.0.beta1</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ab49413b6ee1f7eebcc9044caf2c0abc45aad746"><code>ab49413</code></a></td><td><code>trac 22764: change how check whether Sage is built.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4715169cfe365879fa69f1046516731a7f50aa82"><code>4715169</code></a></td><td><code>merging with 8.0.beta2</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fb90d5e3667237f2d9fc7ba982b466bc52802b1d"><code>fb90d5e</code></a></td><td><code>trac 22764: check whether Sage is built by looking for local/bin/sage</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dc46ea2dfa97be79d7ef8ddbe9130d4c717acc3d"><code>dc46ea2</code></a></td><td><code>trac 22582: fix merge conflicts</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bc4c2f5b99bfd780c8d95b67dcc2638563a40683"><code>bc4c2f5</code></a></td><td><code>trac 22582: rename build/bin/sage-python to sage-python23</code></td></tr></table>




---

archive/issue_comments_334734.json:
```json
{
    "body": "<div id=\"comment:50\" align=\"right\">comment:50</div>\n\nI fixed the merge problems. I also renamed `build/bin/sage-python` to `build/bin/sage-python23` to avoid shadowing `local/bin/sage-python` -- the script in `local/bin` should not depend on the value of `SAGE_PYTHON3`, the way the script in `build/bin` should.\n\nI am willing to give this a positive review, as long as this renaming is okay. A future ticket can deal with removing `local/bin/sage-python`.",
    "created_at": "2017-04-18T18:21:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334734",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:50" align="right">comment:50</div>

I fixed the merge problems. I also renamed `build/bin/sage-python` to `build/bin/sage-python23` to avoid shadowing `local/bin/sage-python` -- the script in `local/bin` should not depend on the value of `SAGE_PYTHON3`, the way the script in `build/bin` should.

I am willing to give this a positive review, as long as this renaming is okay. A future ticket can deal with removing `local/bin/sage-python`.



---

archive/issue_events_317024.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2017-04-18T18:21:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22582#event-317024"
}
```



---

archive/issue_events_317025.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2017-04-18T18:21:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22582#event-317025"
}
```



---

archive/issue_comments_334735.json:
```json
{
    "body": "Changed reviewer from **Fr\u00e9d\u00e9ric Chapoton** to **Fr\u00e9d\u00e9ric Chapoton, John Palmieri**",
    "created_at": "2017-04-18T18:21:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334735",
    "user": "https://github.com/jhpalmieri"
}
```

Changed reviewer from **Frédéric Chapoton** to **Frédéric Chapoton, John Palmieri**



---

archive/issue_comments_334736.json:
```json
{
    "body": "<div id=\"comment:51\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0d30e20416d5051fb31e3d4a032f5e28b09254ec\"><code>0d30e20</code></a></td><td><code>trac 22582: use sage-python23 to build the Sage library</code></td></tr></table>\n",
    "created_at": "2017-04-18T19:52:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334736",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:51"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0d30e20416d5051fb31e3d4a032f5e28b09254ec"><code>0d30e20</code></a></td><td><code>trac 22582: use sage-python23 to build the Sage library</code></td></tr></table>




---

archive/issue_comments_334737.json:
```json
{
    "body": "Changed commit from **[`bc4c2f5`](https://github.com/sagemath/sagetrac-mirror/commit/bc4c2f5b99bfd780c8d95b67dcc2638563a40683)** to **[`0d30e20`](https://github.com/sagemath/sagetrac-mirror/commit/0d30e20416d5051fb31e3d4a032f5e28b09254ec)**",
    "created_at": "2017-04-18T19:52:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334737",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`bc4c2f5`](https://github.com/sagemath/sagetrac-mirror/commit/bc4c2f5b99bfd780c8d95b67dcc2638563a40683)** to **[`0d30e20`](https://github.com/sagemath/sagetrac-mirror/commit/0d30e20416d5051fb31e3d4a032f5e28b09254ec)**



---

archive/issue_comments_334738.json:
```json
{
    "body": "<div id=\"comment:52\" align=\"right\">comment:52</div>\n\nOops, one more change: we need to build the Sage library with `sage-python23`, not with `python`.",
    "created_at": "2017-04-18T19:53:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334738",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:52" align="right">comment:52</div>

Oops, one more change: we need to build the Sage library with `sage-python23`, not with `python`.



---

archive/issue_comments_334739.json:
```json
{
    "body": "<div id=\"comment:53\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7e7b5bc30ed53e44e9a4bc8640637531044d0caa\"><code>7e7b5bc</code></a></td><td><code>trac 22582: build and test packages using sage-python23 instead of python</code></td></tr></table>\n",
    "created_at": "2017-04-18T20:24:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334739",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:53"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7e7b5bc30ed53e44e9a4bc8640637531044d0caa"><code>7e7b5bc</code></a></td><td><code>trac 22582: build and test packages using sage-python23 instead of python</code></td></tr></table>




---

archive/issue_comments_334740.json:
```json
{
    "body": "Changed commit from **[`0d30e20`](https://github.com/sagemath/sagetrac-mirror/commit/0d30e20416d5051fb31e3d4a032f5e28b09254ec)** to **[`7e7b5bc`](https://github.com/sagemath/sagetrac-mirror/commit/7e7b5bc30ed53e44e9a4bc8640637531044d0caa)**",
    "created_at": "2017-04-18T20:24:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334740",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`0d30e20`](https://github.com/sagemath/sagetrac-mirror/commit/0d30e20416d5051fb31e3d4a032f5e28b09254ec)** to **[`7e7b5bc`](https://github.com/sagemath/sagetrac-mirror/commit/7e7b5bc30ed53e44e9a4bc8640637531044d0caa)**



---

archive/issue_comments_334741.json:
```json
{
    "body": "<div id=\"comment:54\" align=\"right\">comment:54</div>\n\nSome more changes: some `spkg-check` scripts were using `python` and should use `sage-python23` instead: if we're building with it, we should test with it. Some optional packages also needed some modifications. I haven't tested these changes yet.\n\nA few questions:\n\n- when we build `git`, we pass the configure option `--with-python=\"$SAGE_LOCAL\"/bin/python`. Does this matter? Does anyone use Sage's git as opposed to the system git?\n\n- in the IPython `spkg-install` script, there is a test to see if `python` is version 3 or not:\n\n```\n# add symlink if we are running on python3\nif python -c 'import sys; sys.exit(sys.version_info.major != 3)'; then\n    cd \"$SAGE_LOCAL\"/bin\n    rm -f ipython\n    ln -s ipython3 ipython\nfi\n```\n Keep this as is, or test instead whether `SAGE_PYTHON3=yes`, or delete the whole block?",
    "created_at": "2017-04-18T20:26:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334741",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:54" align="right">comment:54</div>

Some more changes: some `spkg-check` scripts were using `python` and should use `sage-python23` instead: if we're building with it, we should test with it. Some optional packages also needed some modifications. I haven't tested these changes yet.

A few questions:

- when we build `git`, we pass the configure option `--with-python="$SAGE_LOCAL"/bin/python`. Does this matter? Does anyone use Sage's git as opposed to the system git?

- in the IPython `spkg-install` script, there is a test to see if `python` is version 3 or not:

```
# add symlink if we are running on python3
if python -c 'import sys; sys.exit(sys.version_info.major != 3)'; then
    cd "$SAGE_LOCAL"/bin
    rm -f ipython
    ln -s ipython3 ipython
fi
```
 Keep this as is, or test instead whether `SAGE_PYTHON3=yes`, or delete the whole block?



---

archive/issue_comments_334742.json:
```json
{
    "body": "<div id=\"comment:55\" align=\"right\">comment:55</div>\n\nI made another change in commit [dc46ea2](https://github.com/sagemath/sagetrac-mirror/commit/dc46ea2dfa97be79d7ef8ddbe9130d4c717acc3d): we do not need to create a symlink `local/bin/python` pointing to `python2`: the python2 installation takes care of that automatically. The python3 installation does not create such a link, so we actually don't need to build python2 before python3. So we should remove python2 from the list of dependencies for python3.",
    "created_at": "2017-04-18T20:52:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334742",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:55" align="right">comment:55</div>

I made another change in commit [dc46ea2](https://github.com/sagemath/sagetrac-mirror/commit/dc46ea2dfa97be79d7ef8ddbe9130d4c717acc3d): we do not need to create a symlink `local/bin/python` pointing to `python2`: the python2 installation takes care of that automatically. The python3 installation does not create such a link, so we actually don't need to build python2 before python3. So we should remove python2 from the list of dependencies for python3.



---

archive/issue_comments_334743.json:
```json
{
    "body": "Changed commit from **[`7e7b5bc`](https://github.com/sagemath/sagetrac-mirror/commit/7e7b5bc30ed53e44e9a4bc8640637531044d0caa)** to **[`b954864`](https://github.com/sagemath/sagetrac-mirror/commit/b954864b3d80c62af47e2a16793f20e264e412c6)**",
    "created_at": "2017-04-18T20:52:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334743",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`7e7b5bc`](https://github.com/sagemath/sagetrac-mirror/commit/7e7b5bc30ed53e44e9a4bc8640637531044d0caa)** to **[`b954864`](https://github.com/sagemath/sagetrac-mirror/commit/b954864b3d80c62af47e2a16793f20e264e412c6)**



---

archive/issue_comments_334744.json:
```json
{
    "body": "<div id=\"comment:56\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b954864b3d80c62af47e2a16793f20e264e412c6\"><code>b954864</code></a></td><td><code>trac 22582: no need to make python2 a dependency for python3</code></td></tr></table>\n",
    "created_at": "2017-04-18T20:52:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334744",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:56"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b954864b3d80c62af47e2a16793f20e264e412c6"><code>b954864</code></a></td><td><code>trac 22582: no need to make python2 a dependency for python3</code></td></tr></table>




---

archive/issue_comments_334745.json:
```json
{
    "body": "<div id=\"comment:57\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2dad104a528ce65c72a9736dbe04cc7bb2c86107\"><code>2dad104</code></a></td><td><code>trac 22582: a little documentation</code></td></tr></table>\n",
    "created_at": "2017-04-18T21:14:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334745",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:57"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2dad104a528ce65c72a9736dbe04cc7bb2c86107"><code>2dad104</code></a></td><td><code>trac 22582: a little documentation</code></td></tr></table>




---

archive/issue_comments_334746.json:
```json
{
    "body": "Changed commit from **[`b954864`](https://github.com/sagemath/sagetrac-mirror/commit/b954864b3d80c62af47e2a16793f20e264e412c6)** to **[`2dad104`](https://github.com/sagemath/sagetrac-mirror/commit/2dad104a528ce65c72a9736dbe04cc7bb2c86107)**",
    "created_at": "2017-04-18T21:14:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334746",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`b954864`](https://github.com/sagemath/sagetrac-mirror/commit/b954864b3d80c62af47e2a16793f20e264e412c6)** to **[`2dad104`](https://github.com/sagemath/sagetrac-mirror/commit/2dad104a528ce65c72a9736dbe04cc7bb2c86107)**



---

archive/issue_comments_334747.json:
```json
{
    "body": "<div id=\"comment:58\" align=\"right\">comment:58</div>\n\nReplying to [@vbraun](#comment:40):\n> The only thing that still ends up being installed with SAGE_PYTHON3=yes into lib/python2.7 is brial, which has a hardcoded python2.7 in its configure.ac\n\nShould we open up a ticket for this?",
    "created_at": "2017-04-18T21:20:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334747",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:58" align="right">comment:58</div>

Replying to [@vbraun](#comment:40):
> The only thing that still ends up being installed with SAGE_PYTHON3=yes into lib/python2.7 is brial, which has a hardcoded python2.7 in its configure.ac

Should we open up a ticket for this?



---

archive/issue_comments_334748.json:
```json
{
    "body": "<div id=\"comment:59\" align=\"right\">comment:59</div>\n\nReplying to [@jhpalmieri](#comment:58):\n> Replying to [@vbraun](#comment:40):\n> > The only thing that still ends up being installed with SAGE_PYTHON3=yes into lib/python2.7 is brial, which has a hardcoded python2.7 in its configure.ac\n\n> \n> Should we open up a ticket for this?\n\nWell, it seems that brial got installed in local/lib/python3.5/site-packages (during my latest build of sage with SAGE_PYTHON3=yes)",
    "created_at": "2017-04-19T14:31:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334748",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:59" align="right">comment:59</div>

Replying to [@jhpalmieri](#comment:58):
> Replying to [@vbraun](#comment:40):
> > The only thing that still ends up being installed with SAGE_PYTHON3=yes into lib/python2.7 is brial, which has a hardcoded python2.7 in its configure.ac

> 
> Should we open up a ticket for this?

Well, it seems that brial got installed in local/lib/python3.5/site-packages (during my latest build of sage with SAGE_PYTHON3=yes)



---

archive/issue_comments_334749.json:
```json
{
    "body": "<div id=\"comment:60\" align=\"right\">comment:60</div>\n\nReplying to [@fchapoton](#comment:59):\n> Replying to [@jhpalmieri](#comment:58):\n> > Replying to [@vbraun](#comment:40):\n> > > The only thing that still ends up being installed with SAGE_PYTHON3=yes into lib/python2.7 is brial, which has a hardcoded python2.7 in its configure.ac\n\n> > \n> > Should we open up a ticket for this?\n\n> \n> Well, it seems that brial got installed in local/lib/python3.5/site-packages (during my latest build of sage with SAGE_PYTHON3=yes)\n\nWith no symlink `local/lib/python` pointing to `local/lib/python3.5`? As Volker points out, brial's file `configure.ac` has the line\n\n```\nAM_PATH_PYTHON([2.7])\n```\nFor me, brial gets installed in `local/lib/python2.7/site-packages`, regardless of the variable `SAGE_PYTHON3`, if I'm building with this branch and the one from #22764.",
    "created_at": "2017-04-19T16:47:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334749",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:60" align="right">comment:60</div>

Replying to [@fchapoton](#comment:59):
> Replying to [@jhpalmieri](#comment:58):
> > Replying to [@vbraun](#comment:40):
> > > The only thing that still ends up being installed with SAGE_PYTHON3=yes into lib/python2.7 is brial, which has a hardcoded python2.7 in its configure.ac

> > 
> > Should we open up a ticket for this?

> 
> Well, it seems that brial got installed in local/lib/python3.5/site-packages (during my latest build of sage with SAGE_PYTHON3=yes)

With no symlink `local/lib/python` pointing to `local/lib/python3.5`? As Volker points out, brial's file `configure.ac` has the line

```
AM_PATH_PYTHON([2.7])
```
For me, brial gets installed in `local/lib/python2.7/site-packages`, regardless of the variable `SAGE_PYTHON3`, if I'm building with this branch and the one from #22764.



---

archive/issue_comments_334750.json:
```json
{
    "body": "<div id=\"comment:61\" align=\"right\">comment:61</div>\n\nI am building with #22764 and #22756 (and other changes, including #22305 and #22775)",
    "created_at": "2017-04-19T16:52:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334750",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:61" align="right">comment:61</div>

I am building with #22764 and #22756 (and other changes, including #22305 and #22775)



---

archive/issue_comments_334751.json:
```json
{
    "body": "<div id=\"comment:62\" align=\"right\">comment:62</div>\n\nI'm trying again...",
    "created_at": "2017-04-19T17:08:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334751",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:62" align="right">comment:62</div>

I'm trying again...



---

archive/issue_comments_334752.json:
```json
{
    "body": "<div id=\"comment:63\" align=\"right\">comment:63</div>\n\nI still only see `brial` installed in `local/lib/python2.7/...`. I wonder what's going on.",
    "created_at": "2017-04-19T22:42:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334752",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:63" align="right">comment:63</div>

I still only see `brial` installed in `local/lib/python2.7/...`. I wonder what's going on.



---

archive/issue_comments_334753.json:
```json
{
    "body": "<div id=\"comment:64\" align=\"right\">comment:64</div>\n\nAre you using a different version of brial?",
    "created_at": "2017-04-19T22:44:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334753",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:64" align="right">comment:64</div>

Are you using a different version of brial?



---

archive/issue_comments_334754.json:
```json
{
    "body": "<div id=\"comment:65\" align=\"right\">comment:65</div>\n\nJust to be clear, I am not using the present branch (#22582) in my build.",
    "created_at": "2017-04-20T07:41:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334754",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:65" align="right">comment:65</div>

Just to be clear, I am not using the present branch (#22582) in my build.



---

archive/issue_comments_334755.json:
```json
{
    "body": "<div id=\"comment:66\" align=\"right\">comment:66</div>\n\nMy guess is that without using this branch, you have a link `local/bin/python` pointing to `python3`, so that is what gets used when installing brial.",
    "created_at": "2017-04-20T20:00:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334755",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:66" align="right">comment:66</div>

My guess is that without using this branch, you have a link `local/bin/python` pointing to `python3`, so that is what gets used when installing brial.



---

archive/issue_comments_334756.json:
```json
{
    "body": "<div id=\"comment:67\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3f595041017ce89ae46f9b5793daf753dfb932ac\"><code>3f59504</code></a></td><td><code>trac 22582: compile brial using the appropriate version of Python.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5a645fdaebc03543cb05f7fcf72ebe8b2abbd6a2\"><code>5a645fd</code></a></td><td><code>Merge branch 'public/22582' of trac.sagemath.org:sage into t/22582/public/22582</code></td></tr></table>\n",
    "created_at": "2017-04-20T20:36:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334756",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:67"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3f595041017ce89ae46f9b5793daf753dfb932ac"><code>3f59504</code></a></td><td><code>trac 22582: compile brial using the appropriate version of Python.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5a645fdaebc03543cb05f7fcf72ebe8b2abbd6a2"><code>5a645fd</code></a></td><td><code>Merge branch 'public/22582' of trac.sagemath.org:sage into t/22582/public/22582</code></td></tr></table>




---

archive/issue_comments_334757.json:
```json
{
    "body": "Changed commit from **[`2dad104`](https://github.com/sagemath/sagetrac-mirror/commit/2dad104a528ce65c72a9736dbe04cc7bb2c86107)** to **[`5a645fd`](https://github.com/sagemath/sagetrac-mirror/commit/5a645fdaebc03543cb05f7fcf72ebe8b2abbd6a2)**",
    "created_at": "2017-04-20T20:36:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334757",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`2dad104`](https://github.com/sagemath/sagetrac-mirror/commit/2dad104a528ce65c72a9736dbe04cc7bb2c86107)** to **[`5a645fd`](https://github.com/sagemath/sagetrac-mirror/commit/5a645fdaebc03543cb05f7fcf72ebe8b2abbd6a2)**



---

archive/issue_comments_334758.json:
```json
{
    "body": "<div id=\"comment:68\" align=\"right\">comment:68</div>\n\nWith this change, brial is built with the appropriate version of Python, as determined by `SAGE_PYTHON3`. In particular, it gets installed into `local/lib/python3.5/site-packages` if `SAGE_PYTHON3=yes`.",
    "created_at": "2017-04-20T23:19:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334758",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:68" align="right">comment:68</div>

With this change, brial is built with the appropriate version of Python, as determined by `SAGE_PYTHON3`. In particular, it gets installed into `local/lib/python3.5/site-packages` if `SAGE_PYTHON3=yes`.



---

archive/issue_comments_334759.json:
```json
{
    "body": "<div id=\"comment:69\" align=\"right\">comment:69</div>\n\nBy the way, this issue with brial is an illustration of possible difficulties if we don't create a symlink `python -> python3` when `SAGE_PYTHON3=yes`. I am willing to keep the symlink `python -> python2`, but it may create build problems which may be hard to debug.",
    "created_at": "2017-04-21T18:41:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334759",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:69" align="right">comment:69</div>

By the way, this issue with brial is an illustration of possible difficulties if we don't create a symlink `python -> python3` when `SAGE_PYTHON3=yes`. I am willing to keep the symlink `python -> python2`, but it may create build problems which may be hard to debug.



---

archive/issue_comments_334760.json:
```json
{
    "body": "<div id=\"comment:70\" align=\"right\">comment:70</div>\n\nIMHO user issues will be even harder to debug if everybody has the python symlink pointing somewhere else, always depending on whether they originally (and potentially a long time ago) installed python with or without SAGE_PYTHON3. \n\nChanges LGTM...",
    "created_at": "2017-04-22T20:07:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334760",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:70" align="right">comment:70</div>

IMHO user issues will be even harder to debug if everybody has the python symlink pointing somewhere else, always depending on whether they originally (and potentially a long time ago) installed python with or without SAGE_PYTHON3. 

Changes LGTM...



---

archive/issue_comments_334761.json:
```json
{
    "body": "<div id=\"comment:71\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2179ac895c8d8aa9611837a0f5384199e526bd3a\"><code>2179ac8</code></a></td><td><code>Merge branch 8.0.beta3 into t/22582/public/22582</code></td></tr></table>\n",
    "created_at": "2017-04-24T20:45:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334761",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:71"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2179ac895c8d8aa9611837a0f5384199e526bd3a"><code>2179ac8</code></a></td><td><code>Merge branch 8.0.beta3 into t/22582/public/22582</code></td></tr></table>




---

archive/issue_comments_334762.json:
```json
{
    "body": "Changed commit from **[`5a645fd`](https://github.com/sagemath/sagetrac-mirror/commit/5a645fdaebc03543cb05f7fcf72ebe8b2abbd6a2)** to **[`2179ac8`](https://github.com/sagemath/sagetrac-mirror/commit/2179ac895c8d8aa9611837a0f5384199e526bd3a)**",
    "created_at": "2017-04-24T20:45:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334762",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`5a645fd`](https://github.com/sagemath/sagetrac-mirror/commit/5a645fdaebc03543cb05f7fcf72ebe8b2abbd6a2)** to **[`2179ac8`](https://github.com/sagemath/sagetrac-mirror/commit/2179ac895c8d8aa9611837a0f5384199e526bd3a)**



---

archive/issue_comments_334763.json:
```json
{
    "body": "<div id=\"comment:72\" align=\"right\">comment:72</div>\n\nRebased. Anyone object to a positive review?",
    "created_at": "2017-04-24T20:46:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334763",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:72" align="right">comment:72</div>

Rebased. Anyone object to a positive review?



---

archive/issue_events_317026.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2017-04-25T15:51:20Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22582#event-317026"
}
```



---

archive/issue_events_317027.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2017-04-25T15:51:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22582#event-317027"
}
```



---

archive/issue_comments_334764.json:
```json
{
    "body": "Changed dependencies from **#22608, #22764** to **#22608, #22764, #22756**",
    "created_at": "2017-04-25T18:07:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334764",
    "user": "https://github.com/vbraun"
}
```

Changed dependencies from **#22608, #22764** to **#22608, #22764, #22756**



---

archive/issue_comments_334765.json:
```json
{
    "body": "Changed branch from **[public/22582](https://github.com/sagemath/sagetrac-mirror/tree/public/22582)** to **[`2179ac8`](https://github.com/sagemath/sagetrac-mirror/commit/2179ac895c8d8aa9611837a0f5384199e526bd3a)**",
    "created_at": "2017-04-29T23:30:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334765",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[public/22582](https://github.com/sagemath/sagetrac-mirror/tree/public/22582)** to **[`2179ac8`](https://github.com/sagemath/sagetrac-mirror/commit/2179ac895c8d8aa9611837a0f5384199e526bd3a)**



---

archive/issue_events_317028.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-04-29T23:30:10Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22582#event-317028"
}
```



---

archive/issue_events_317029.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "43be68d8668ad40807a4edc9b2c8bb666e6777d4",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2017-04-29T23:30:10Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22582#event-317029"
}
```



---

archive/issue_comments_334766.json:
```json
{
    "body": "<div id=\"comment:76\" align=\"right\">comment:76</div>\n\nBeing just a bit more detailed in ticket description would have saved me the trouble of doing #22895... Oh well.",
    "created_at": "2017-04-30T10:18:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334766",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:76" align="right">comment:76</div>

Being just a bit more detailed in ticket description would have saved me the trouble of doing #22895... Oh well.



---

archive/issue_comments_334767.json:
```json
{
    "body": "Changed keywords from none to **numpy, pip, python**",
    "created_at": "2017-04-30T10:18:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334767",
    "user": "https://github.com/dimpase"
}
```

Changed keywords from none to **numpy, pip, python**



---

archive/issue_comments_334768.json:
```json
{
    "body": "Changed commit from **[`2179ac8`](https://github.com/sagemath/sagetrac-mirror/commit/2179ac895c8d8aa9611837a0f5384199e526bd3a)** to none",
    "created_at": "2017-04-30T10:18:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334768",
    "user": "https://github.com/dimpase"
}
```

Changed commit from **[`2179ac8`](https://github.com/sagemath/sagetrac-mirror/commit/2179ac895c8d8aa9611837a0f5384199e526bd3a)** to none



---

archive/issue_comments_334769.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -3,3 +3,5 @@\n Then, let sage-pip-install explicitly use pip2 or pip3.\n \n With this ticket the SAGE_PYTHON3=yes build only fails in sagelib, but works for all dependencies.\n+\n+This ticket also updates numpy to version 1.12.1.\n``````\n",
    "created_at": "2017-04-30T10:18:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334769",
    "user": "https://github.com/dimpase"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -3,3 +3,5 @@
 Then, let sage-pip-install explicitly use pip2 or pip3.
 
 With this ticket the SAGE_PYTHON3=yes build only fails in sagelib, but works for all dependencies.
+
+This ticket also updates numpy to version 1.12.1.
``````




---

archive/issue_comments_334770.json:
```json
{
    "body": "<div id=\"comment:77\" align=\"right\">comment:77</div>\n\nWhat is the numpy tarball to be used here? It's not mentioned anywhere on the ticket. https://pypi.python.org/pypi/numpy only provides a link to zip file (that's what I used on #22895).",
    "created_at": "2017-04-30T11:05:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334770",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:77" align="right">comment:77</div>

What is the numpy tarball to be used here? It's not mentioned anywhere on the ticket. https://pypi.python.org/pypi/numpy only provides a link to zip file (that's what I used on #22895).



---

archive/issue_comments_334771.json:
```json
{
    "body": "<div id=\"comment:78\" align=\"right\">comment:78</div>\n\nThe tarball for this ticket is on the mirrors. In general, tarballs for numpy can be found at https://github.com/numpy/numpy/releases",
    "created_at": "2017-05-01T07:57:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334771",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:78" align="right">comment:78</div>

The tarball for this ticket is on the mirrors. In general, tarballs for numpy can be found at https://github.com/numpy/numpy/releases



---

archive/issue_comments_334772.json:
```json
{
    "body": "<div id=\"comment:79\" align=\"right\">comment:79</div>\n\n(Google pointed me to this ticket, so I'm leaving this comment to help, in case someone encounters this.)\n\nI ran into the same problem while updating to 9.0beta8 (including the update to python3).\n\nForce installing python3 with\n\n```\nsage -f python3\n```\n(as pointed out above) solved it in my case. I did run `make dist-clean` and `./configure` in case anyone wonders.\n\nReplying to [@fchapoton](#comment:16):\n> If I try the latest branches for this ticket and its dependency with SAGE_PYTHON3=yes, it fails now on numpy:\n> \n> ```\n> [numpy-1.11.1.p0] Traceback (most recent call last):\n> [numpy-1.11.1.p0]   File \"/home/chapoton/sage3/local/var/tmp/sage/build/numpy-1.11.1.p0/lapack_conf.py\", line 3, in <module>\n> [numpy-1.11.1.p0]     import pkgconfig, os\n> [numpy-1.11.1.p0] ImportError: No module named pkgconfig\n> ```\n> EDIT:\n> This is preceded by\n> \n> ```\n> [pkgconfig-1.2.2.p0] Successfully installed pkgconfig-1.2.2.p0\n> ```",
    "created_at": "2019-12-06T11:59:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22582#issuecomment-334772",
    "user": "https://github.com/kliem"
}
```

<div id="comment:79" align="right">comment:79</div>

(Google pointed me to this ticket, so I'm leaving this comment to help, in case someone encounters this.)

I ran into the same problem while updating to 9.0beta8 (including the update to python3).

Force installing python3 with

```
sage -f python3
```
(as pointed out above) solved it in my case. I did run `make dist-clean` and `./configure` in case anyone wonders.

Replying to [@fchapoton](#comment:16):
> If I try the latest branches for this ticket and its dependency with SAGE_PYTHON3=yes, it fails now on numpy:
> 
> ```
> [numpy-1.11.1.p0] Traceback (most recent call last):
> [numpy-1.11.1.p0]   File "/home/chapoton/sage3/local/var/tmp/sage/build/numpy-1.11.1.p0/lapack_conf.py", line 3, in <module>
> [numpy-1.11.1.p0]     import pkgconfig, os
> [numpy-1.11.1.p0] ImportError: No module named pkgconfig
> ```
> EDIT:
> This is preceded by
> 
> ```
> [pkgconfig-1.2.2.p0] Successfully installed pkgconfig-1.2.2.p0
> ```
