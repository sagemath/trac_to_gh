# Issue 22120: powers of 1 in QQbar

archive/issues_021883.json:
```json
{
    "assignees": [],
    "body": "The following does not work at the moment:\n\n```\nQQbar(1)^QQbar(sqrt(2))\nQQ(1)^QQbar(sqrt(3))\nZZ(1)^QQbar(sqrt(5))\n```\n\n\nCC:  @cheuberg\n\nBranch: **[`064f552`](https://github.com/sagemath/sagetrac-mirror/commit/064f5525ddfddbdd61611e6d3b604cf41bc54424)**\n\nReviewer: **Clemens Heuberger**\n\nAuthor: **Daniel Krenn**\n\nComponent: **algebra**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/22120_\n\n",
    "closed_at": "2017-01-21T16:34:45Z",
    "created_at": "2017-01-02T17:09:56Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20algebra",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-7.5",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "powers of 1 in QQbar",
    "type": "issue",
    "updated_at": "2018-01-08T11:25:21Z",
    "url": "https://github.com/sagemath/sage/issues/22120",
    "user": "https://github.com/dkrenn"
}
```
The following does not work at the moment:

```
QQbar(1)^QQbar(sqrt(2))
QQ(1)^QQbar(sqrt(3))
ZZ(1)^QQbar(sqrt(5))
```


CC:  @cheuberg

Branch: **[`064f552`](https://github.com/sagemath/sagetrac-mirror/commit/064f5525ddfddbdd61611e6d3b604cf41bc54424)**

Reviewer: **Clemens Heuberger**

Author: **Daniel Krenn**

Component: **algebra**

_Issue created by migration from https://trac.sagemath.org/ticket/22120_





---

archive/issue_events_306991.json:
```json
{
    "actor": "https://github.com/dkrenn",
    "created_at": "2017-01-02T17:09:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/22120",
    "milestone_number": null,
    "milestone_title": "sage-7.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22120#event-306991"
}
```



---

archive/issue_events_306992.json:
```json
{
    "actor": "https://github.com/dkrenn",
    "created_at": "2017-01-02T17:09:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22120",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20algebra",
    "label_color": "0000ff",
    "label_name": "c: algebra",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22120#event-306992"
}
```



---

archive/issue_events_306993.json:
```json
{
    "actor": "https://github.com/dkrenn",
    "created_at": "2017-01-02T17:09:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22120",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22120#event-306993"
}
```



---

archive/issue_events_306994.json:
```json
{
    "actor": "https://github.com/dkrenn",
    "created_at": "2017-01-02T17:09:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22120",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22120#event-306994"
}
```



---

archive/issue_comments_326271.json:
```json
{
    "body": "Branch: **[u/dkrenn/one-qqbar](https://github.com/sagemath/sagetrac-mirror/tree/u/dkrenn/one-qqbar)**",
    "created_at": "2017-01-02T17:16:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22120",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22120#issuecomment-326271",
    "user": "https://github.com/dkrenn"
}
```

Branch: **[u/dkrenn/one-qqbar](https://github.com/sagemath/sagetrac-mirror/tree/u/dkrenn/one-qqbar)**



---

archive/issue_events_306995.json:
```json
{
    "actor": "https://github.com/dkrenn",
    "created_at": "2017-01-02T17:17:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22120",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22120#event-306995"
}
```



---

archive/issue_comments_326272.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nPatchbot...please test ;)\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7d584252abb3cb8814cb893dde1616b80aac6bfd\"><code>7d58425</code></a></td><td><code>Trac #22120: make 1^QQbar_element work</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/60abddb6180598f62bf2384b258e26e3d91707ba\"><code>60abddb</code></a></td><td><code>Trac #22120: additional doctest for asymptotic rings</code></td></tr></table>\n",
    "created_at": "2017-01-02T17:17:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22120",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22120#issuecomment-326272",
    "user": "https://github.com/dkrenn"
}
```

<div id="comment:2" align="right">comment:2</div>

Patchbot...please test ;)

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7d584252abb3cb8814cb893dde1616b80aac6bfd"><code>7d58425</code></a></td><td><code>Trac #22120: make 1^QQbar_element work</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/60abddb6180598f62bf2384b258e26e3d91707ba"><code>60abddb</code></a></td><td><code>Trac #22120: additional doctest for asymptotic rings</code></td></tr></table>




---

archive/issue_comments_326273.json:
```json
{
    "body": "Commit: **[`60abddb`](https://github.com/sagemath/sagetrac-mirror/commit/60abddb6180598f62bf2384b258e26e3d91707ba)**",
    "created_at": "2017-01-02T17:17:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22120",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22120#issuecomment-326273",
    "user": "https://github.com/dkrenn"
}
```

Commit: **[`60abddb`](https://github.com/sagemath/sagetrac-mirror/commit/60abddb6180598f62bf2384b258e26e3d91707ba)**



---

archive/issue_comments_326274.json:
```json
{
    "body": "Author: **Daniel Krenn**",
    "created_at": "2017-01-02T17:17:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22120",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22120#issuecomment-326274",
    "user": "https://github.com/dkrenn"
}
```

Author: **Daniel Krenn**



---

archive/issue_comments_326275.json:
```json
{
    "body": "Changed commit from **[`60abddb`](https://github.com/sagemath/sagetrac-mirror/commit/60abddb6180598f62bf2384b258e26e3d91707ba)** to **[`1eba0e2`](https://github.com/sagemath/sagetrac-mirror/commit/1eba0e200088b0422579caa740119125012282e6)**",
    "created_at": "2017-01-02T17:22:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22120",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22120#issuecomment-326275",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`60abddb`](https://github.com/sagemath/sagetrac-mirror/commit/60abddb6180598f62bf2384b258e26e3d91707ba)** to **[`1eba0e2`](https://github.com/sagemath/sagetrac-mirror/commit/1eba0e200088b0422579caa740119125012282e6)**



---

archive/issue_comments_326276.json:
```json
{
    "body": "<div id=\"comment:3\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b4013092749360e1d6253af036523bc8d1699aa2\"><code>b401309</code></a></td><td><code>Trac #22120: make 1^QQbar_element work</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1eba0e200088b0422579caa740119125012282e6\"><code>1eba0e2</code></a></td><td><code>Trac #22120: additional doctest for asymptotic rings</code></td></tr></table>\n",
    "created_at": "2017-01-02T17:22:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22120",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22120#issuecomment-326276",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:3"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b4013092749360e1d6253af036523bc8d1699aa2"><code>b401309</code></a></td><td><code>Trac #22120: make 1^QQbar_element work</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1eba0e200088b0422579caa740119125012282e6"><code>1eba0e2</code></a></td><td><code>Trac #22120: additional doctest for asymptotic rings</code></td></tr></table>




---

archive/issue_comments_326277.json:
```json
{
    "body": "Changed branch from **[u/dkrenn/one-qqbar](https://github.com/sagemath/sagetrac-mirror/tree/u/dkrenn/one-qqbar)** to **[u/cheuberg/one-qqbar](https://github.com/sagemath/sagetrac-mirror/tree/u/cheuberg/one-qqbar)**",
    "created_at": "2017-01-03T08:17:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22120",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22120#issuecomment-326277",
    "user": "https://github.com/cheuberg"
}
```

Changed branch from **[u/dkrenn/one-qqbar](https://github.com/sagemath/sagetrac-mirror/tree/u/dkrenn/one-qqbar)** to **[u/cheuberg/one-qqbar](https://github.com/sagemath/sagetrac-mirror/tree/u/cheuberg/one-qqbar)**



---

archive/issue_comments_326278.json:
```json
{
    "body": "Changed commit from **[`1eba0e2`](https://github.com/sagemath/sagetrac-mirror/commit/1eba0e200088b0422579caa740119125012282e6)** to **[`064f552`](https://github.com/sagemath/sagetrac-mirror/commit/064f5525ddfddbdd61611e6d3b604cf41bc54424)**",
    "created_at": "2017-01-03T08:25:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22120",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22120#issuecomment-326278",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`1eba0e2`](https://github.com/sagemath/sagetrac-mirror/commit/1eba0e200088b0422579caa740119125012282e6)** to **[`064f552`](https://github.com/sagemath/sagetrac-mirror/commit/064f5525ddfddbdd61611e6d3b604cf41bc54424)**



---

archive/issue_comments_326279.json:
```json
{
    "body": "<div id=\"comment:5\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/064f5525ddfddbdd61611e6d3b604cf41bc54424\"><code>064f552</code></a></td><td><code>Trac #22120: mention trac ticket in test</code></td></tr></table>\n",
    "created_at": "2017-01-03T08:25:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22120",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22120#issuecomment-326279",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:5"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/064f5525ddfddbdd61611e6d3b604cf41bc54424"><code>064f552</code></a></td><td><code>Trac #22120: mention trac ticket in test</code></td></tr></table>




---

archive/issue_comments_326280.json:
```json
{
    "body": "Reviewer: **Clemens Heuberger**",
    "created_at": "2017-01-03T08:27:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22120",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22120#issuecomment-326280",
    "user": "https://github.com/cheuberg"
}
```

Reviewer: **Clemens Heuberger**



---

archive/issue_comments_326281.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nLGTM. Please cross-review my changes and set to `positive_review` provided that a patchbot agrees.",
    "created_at": "2017-01-03T08:27:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22120",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22120#issuecomment-326281",
    "user": "https://github.com/cheuberg"
}
```

<div id="comment:6" align="right">comment:6</div>

LGTM. Please cross-review my changes and set to `positive_review` provided that a patchbot agrees.



---

archive/issue_comments_326282.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nReplying to [@cheuberg](#comment:6):\n> LGTM. Please cross-review my changes and set to `positive_review` provided that a patchbot agrees.\n\nThank you for your changes. Patchbot agrees as well.",
    "created_at": "2017-01-03T10:04:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22120",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22120#issuecomment-326282",
    "user": "https://github.com/dkrenn"
}
```

<div id="comment:7" align="right">comment:7</div>

Replying to [@cheuberg](#comment:6):
> LGTM. Please cross-review my changes and set to `positive_review` provided that a patchbot agrees.

Thank you for your changes. Patchbot agrees as well.



---

archive/issue_events_306996.json:
```json
{
    "actor": "https://github.com/dkrenn",
    "created_at": "2017-01-03T10:04:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22120",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22120#event-306996"
}
```



---

archive/issue_events_306997.json:
```json
{
    "actor": "https://github.com/dkrenn",
    "created_at": "2017-01-03T10:04:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22120",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22120#event-306997"
}
```



---

archive/issue_comments_326283.json:
```json
{
    "body": "Changed branch from **[u/cheuberg/one-qqbar](https://github.com/sagemath/sagetrac-mirror/tree/u/cheuberg/one-qqbar)** to **[`064f552`](https://github.com/sagemath/sagetrac-mirror/commit/064f5525ddfddbdd61611e6d3b604cf41bc54424)**",
    "created_at": "2017-01-21T16:34:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22120",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22120#issuecomment-326283",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/cheuberg/one-qqbar](https://github.com/sagemath/sagetrac-mirror/tree/u/cheuberg/one-qqbar)** to **[`064f552`](https://github.com/sagemath/sagetrac-mirror/commit/064f5525ddfddbdd61611e6d3b604cf41bc54424)**



---

archive/issue_events_306998.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-01-21T16:34:45Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22120",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22120#event-306998"
}
```



---

archive/issue_events_306999.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "1eb5896b709608b3109a9eee611938b04694bc20",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2017-01-21T16:34:45Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/22120",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22120#event-306999"
}
```



---

archive/issue_comments_326284.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nHello,\n\nWhat was the rationale for this ticket? I have two objections to it\n\n- In Sage we try to make any binary operation `op(x, y)` works independently of the values of `x` and `y` but only on their parents. This is the base of the whole coercion model. Having `pow(1, x)` works inconditionally is misleading (there are terrible counterexample to my assertion).\n\n- More importantly, the test `my_qqbar_number == QQbar.one()` can be **very** costly. You are possibly forcing an exactification in `QQbar` just to allow a very useless corner case. On sage-7.5.1 we had\n\n```\nsage: s = sum(AA(i)**(1/i) for i in range(1,20))\nsage: %timeit (s/s) ** 4\n10000 loops, best of 3: 55 \u00b5s per loop\n```\n  but with your patch\n\n```\nsage: s = sum(AA(i)**(1/i) for i in range(1,20))\nsage: (s/s) ** 4  # you can wait ...\n```\n\nLooking forward to your answer.\n\nVincent",
    "created_at": "2017-01-22T16:38:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22120",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22120#issuecomment-326284",
    "user": "https://github.com/videlec"
}
```

<div id="comment:9" align="right">comment:9</div>

Hello,

What was the rationale for this ticket? I have two objections to it

- In Sage we try to make any binary operation `op(x, y)` works independently of the values of `x` and `y` but only on their parents. This is the base of the whole coercion model. Having `pow(1, x)` works inconditionally is misleading (there are terrible counterexample to my assertion).

- More importantly, the test `my_qqbar_number == QQbar.one()` can be **very** costly. You are possibly forcing an exactification in `QQbar` just to allow a very useless corner case. On sage-7.5.1 we had

```
sage: s = sum(AA(i)**(1/i) for i in range(1,20))
sage: %timeit (s/s) ** 4
10000 loops, best of 3: 55 µs per loop
```
  but with your patch

```
sage: s = sum(AA(i)**(1/i) for i in range(1,20))
sage: (s/s) ** 4  # you can wait ...
```

Looking forward to your answer.

Vincent



---

archive/issue_comments_326285.json:
```json
{
    "body": "Changed commit from **[`064f552`](https://github.com/sagemath/sagetrac-mirror/commit/064f5525ddfddbdd61611e6d3b604cf41bc54424)** to none",
    "created_at": "2017-01-22T16:38:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22120",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22120#issuecomment-326285",
    "user": "https://github.com/videlec"
}
```

Changed commit from **[`064f552`](https://github.com/sagemath/sagetrac-mirror/commit/064f5525ddfddbdd61611e6d3b604cf41bc54424)** to none



---

archive/issue_comments_326286.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nHello Vincent,\n\nReplying to [@videlec](#comment:9):\n> What was the rationale for this ticket?\n\n`1^my_qqbar_number` is mathematically meaningful.\n\n> - In Sage we try to make any binary operation `op(x, y)` works independently of the values of `x` and `y` but only on their parents. This is the base of the whole coercion model. Having `pow(1, x)` works inconditionally is misleading (there are terrible counterexample to my assertion).\n\nI completely agree that the parent of the output should only be influenced by the parents of the inputs and not its particular values. And, after the patch of this ticket, pow of a QQbar element to a QQbar element is (still) always a QQbar element (unless it is not possible and an error is thrown).\n\nFWIW, as it is implemented now, `pow` and coercions unfortunately do not play well together (only basic stuff, like if there is a direct coercion (i.e. no new parent has to be found), works)\n\n> - More importantly, the test `my_qqbar_number == QQbar.one()` can be **very** costly. You are possibly forcing an exactification in `QQbar` just to allow a very useless corner case. On sage-7.5.1 we had\n> \n> ```\n> sage: s = sum(AA(i)**(1/i) for i in range(1,20))\n> sage: %timeit (s/s) ** 4\n> 10000 loops, best of 3: 55 \u00b5s per loop\n> ```\n>   but with your patch\n> \n> ```\n> sage: s = sum(AA(i)**(1/i) for i in range(1,20))\n> sage: (s/s) ** 4  # you can wait ...\n> ```\n\nOh, indeed, this is a problem and need to be changed.\n\n> just to allow a very useless corner case\n\nI disagree with your \"useless\". As mentioned, `1` to some QQbar element is mathematically meaningful, and some people care about being able to calculate things.\n\nWhat about checking if the element is \"trivially\" `1` (in the same spirit as the symbolic expression's `is_trivial_zero`)? Thus no exactification would be done, but `s=QQbar(1)` would still be recognized.",
    "created_at": "2017-01-23T19:11:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22120",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22120#issuecomment-326286",
    "user": "https://github.com/dkrenn"
}
```

<div id="comment:10" align="right">comment:10</div>

Hello Vincent,

Replying to [@videlec](#comment:9):
> What was the rationale for this ticket?

`1^my_qqbar_number` is mathematically meaningful.

> - In Sage we try to make any binary operation `op(x, y)` works independently of the values of `x` and `y` but only on their parents. This is the base of the whole coercion model. Having `pow(1, x)` works inconditionally is misleading (there are terrible counterexample to my assertion).

I completely agree that the parent of the output should only be influenced by the parents of the inputs and not its particular values. And, after the patch of this ticket, pow of a QQbar element to a QQbar element is (still) always a QQbar element (unless it is not possible and an error is thrown).

FWIW, as it is implemented now, `pow` and coercions unfortunately do not play well together (only basic stuff, like if there is a direct coercion (i.e. no new parent has to be found), works)

> - More importantly, the test `my_qqbar_number == QQbar.one()` can be **very** costly. You are possibly forcing an exactification in `QQbar` just to allow a very useless corner case. On sage-7.5.1 we had
> 
> ```
> sage: s = sum(AA(i)**(1/i) for i in range(1,20))
> sage: %timeit (s/s) ** 4
> 10000 loops, best of 3: 55 µs per loop
> ```
>   but with your patch
> 
> ```
> sage: s = sum(AA(i)**(1/i) for i in range(1,20))
> sage: (s/s) ** 4  # you can wait ...
> ```

Oh, indeed, this is a problem and need to be changed.

> just to allow a very useless corner case

I disagree with your "useless". As mentioned, `1` to some QQbar element is mathematically meaningful, and some people care about being able to calculate things.

What about checking if the element is "trivially" `1` (in the same spirit as the symbolic expression's `is_trivial_zero`)? Thus no exactification would be done, but `s=QQbar(1)` would still be recognized.



---

archive/issue_comments_326287.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nReplying to [@dkrenn](#comment:10):\n> Replying to [@videlec](#comment:9):\n> What about checking if the element is \"trivially\" `1` (in the same spirit as the symbolic expression's `is_trivial_zero`)? Thus no exactification would be done, but `s=QQbar(1)` would still be recognized.\n\nWould already be better...\n\n```\nfrom sage.rings.qqbar import ANRational\n\ndef is_trivially_one(x):\n    descr = x._descr\n    return isinstance(descr, ANRational) and descr._value.is_one()\n```",
    "created_at": "2017-01-24T08:47:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22120",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22120#issuecomment-326287",
    "user": "https://github.com/videlec"
}
```

<div id="comment:11" align="right">comment:11</div>

Replying to [@dkrenn](#comment:10):
> Replying to [@videlec](#comment:9):
> What about checking if the element is "trivially" `1` (in the same spirit as the symbolic expression's `is_trivial_zero`)? Thus no exactification would be done, but `s=QQbar(1)` would still be recognized.

Would already be better...

```
from sage.rings.qqbar import ANRational

def is_trivially_one(x):
    descr = x._descr
    return isinstance(descr, ANRational) and descr._value.is_one()
```



---

archive/issue_comments_326288.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nFollow-up ticket #22250 created.",
    "created_at": "2017-01-25T08:22:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22120",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22120#issuecomment-326288",
    "user": "https://github.com/dkrenn"
}
```

<div id="comment:12" align="right">comment:12</div>

Follow-up ticket #22250 created.



---

archive/issue_comments_326289.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nReplying to [@dkrenn](#comment:10):\n> On sage-7.5.1 we had\n> > \n> > ```\n> > sage: s = sum(AA(i)**(1/i) for i in range(1,20))\n> > sage: %timeit (s/s) ** 4\n> > 10000 loops, best of 3: 55 \u00b5s per loop\n> > ```\n\nI am not sure, what I am doing wrong, but on my 7.5 this already takes ages...",
    "created_at": "2017-01-25T08:26:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22120",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22120#issuecomment-326289",
    "user": "https://github.com/dkrenn"
}
```

<div id="comment:13" align="right">comment:13</div>

Replying to [@dkrenn](#comment:10):
> On sage-7.5.1 we had
> > 
> > ```
> > sage: s = sum(AA(i)**(1/i) for i in range(1,20))
> > sage: %timeit (s/s) ** 4
> > 10000 loops, best of 3: 55 µs per loop
> > ```

I am not sure, what I am doing wrong, but on my 7.5 this already takes ages...



---

archive/issue_comments_326290.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReplying to [@dkrenn](#comment:13):\n> Replying to [@dkrenn](#comment:10):\n> > On sage-7.5.1 we had\n> > > \n> > > ```\n> > > sage: s = sum(AA(i)**(1/i) for i in range(1,20))\n> > > sage: %timeit (s/s) ** 4\n> > > 10000 loops, best of 3: 55 \u00b5s per loop\n> > > ```\n\n> \n> I am not sure, what I am doing wrong, but on my 7.5 this already takes ages...\n\nWhich step?",
    "created_at": "2017-01-25T17:14:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22120",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22120#issuecomment-326290",
    "user": "https://github.com/videlec"
}
```

<div id="comment:14" align="right">comment:14</div>

Replying to [@dkrenn](#comment:13):
> Replying to [@dkrenn](#comment:10):
> > On sage-7.5.1 we had
> > > 
> > > ```
> > > sage: s = sum(AA(i)**(1/i) for i in range(1,20))
> > > sage: %timeit (s/s) ** 4
> > > 10000 loops, best of 3: 55 µs per loop
> > > ```

> 
> I am not sure, what I am doing wrong, but on my 7.5 this already takes ages...

Which step?



---

archive/issue_comments_326291.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nReplying to [@videlec](#comment:14):\n> Replying to [@dkrenn](#comment:13):\n> > Replying to [@dkrenn](#comment:10):\n> > > On sage-7.5.1 we had\n> > > > \n> > > > ```\n> > > > sage: s = sum(AA(i)**(1/i) for i in range(1,20))\n> > > > sage: %timeit (s/s) ** 4\n> > > > 10000 loops, best of 3: 55 \u00b5s per loop\n> > > > ```\n\n> > \n> > I am not sure, what I am doing wrong, but on my 7.5 this already takes ages...\n\n> \n> Which step?\n\nLet me reformulate:\n\n```\nsage: s = sum(AA(i)**(1/i) for i in range(1,20))\nsage: (s/s) ** 4\n```\ndoes not give a result within a couple of hours on a fresh 7.5. And I was wondering why?",
    "created_at": "2017-01-25T17:40:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22120",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22120#issuecomment-326291",
    "user": "https://github.com/dkrenn"
}
```

<div id="comment:15" align="right">comment:15</div>

Replying to [@videlec](#comment:14):
> Replying to [@dkrenn](#comment:13):
> > Replying to [@dkrenn](#comment:10):
> > > On sage-7.5.1 we had
> > > > 
> > > > ```
> > > > sage: s = sum(AA(i)**(1/i) for i in range(1,20))
> > > > sage: %timeit (s/s) ** 4
> > > > 10000 loops, best of 3: 55 µs per loop
> > > > ```

> > 
> > I am not sure, what I am doing wrong, but on my 7.5 this already takes ages...

> 
> Which step?

Let me reformulate:

```
sage: s = sum(AA(i)**(1/i) for i in range(1,20))
sage: (s/s) ** 4
```
does not give a result within a couple of hours on a fresh 7.5. And I was wondering why?



---

archive/issue_comments_326292.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nWhat about the traceback after Ctrl-C?\n\nrandom guess: it might be relative to `_repr_`. You can try `a = (s/s)**4` instead.",
    "created_at": "2017-01-26T12:52:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22120",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22120#issuecomment-326292",
    "user": "https://github.com/videlec"
}
```

<div id="comment:16" align="right">comment:16</div>

What about the traceback after Ctrl-C?

random guess: it might be relative to `_repr_`. You can try `a = (s/s)**4` instead.



---

archive/issue_comments_326293.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nReplying to [@videlec](#comment:16):\n> What about the traceback after Ctrl-C?\n\n```\nsage: s = sum(AA(i)**(1/i) for i in range(1,20))\nsage: a = (s/s)**4\n^C---------------------------------------------------------------------------\nKeyboardInterrupt                         Traceback (most recent call last)\n<ipython-input-2-00135d41d691> in <module>()\n----> 1 a = (s/s)**Integer(4)\n\n/local/dakrenn/sage/7.5/local/lib/python2.7/site-packages/sage/rings/qqbar.pyc in __pow__(self, e)\n   4465         d = e.denominator()\n   4466         if d == 1:\n-> 4467             return generic_power(self, n)\n   4468 \n   4469         # First, check for exact roots.\n\n/local/dakrenn/sage/7.5/src/sage/structure/element.pyx in sage.structure.element.generic_power (/local/dakrenn/sage/7.5/src/build/cythonized/sage/structure/element.c:27899)()\n   4111     \"\"\"\n   4112 \n-> 4113     return generic_power_c(a,n,one)\n   4114 \n   4115 cdef generic_power_c(a, nn, one):\n\n/local/dakrenn/sage/7.5/src/sage/structure/element.pyx in sage.structure.element.generic_power_c (/local/dakrenn/sage/7.5/src/build/cythonized/sage/structure/element.c:28765)()\n   4159     # check for idempotence, and store the result otherwise\n   4160     aa = a*a\n-> 4161     if aa == a:\n   4162         return a\n   4163 \n\n/local/dakrenn/sage/7.5/src/sage/structure/element.pyx in sage.structure.element.Element.__richcmp__ (/local/dakrenn/sage/7.5/src/build/cythonized/sage/structure/element.c:10359)()\n   1121             # an instance of Element. The explicit casts below make\n   1122             # Cython generate optimized code for this call.\n-> 1123             return (<Element>self)._richcmp_(other, op)\n   1124         else:\n   1125             return coercion_model.richcmp(self, other, op)\n\n/local/dakrenn/sage/7.5/src/sage/structure/element.pyx in sage.structure.element.Element._richcmp_ (/local/dakrenn/sage/7.5/src/build/cythonized/sage/structure/element.c:10558)()\n   1156         cdef int c\n   1157         try:\n-> 1158             c = left._cmp_(right)\n   1159         except NotImplementedError:\n   1160             # Check equality by id(), knowing that left is not right\n\n/local/dakrenn/sage/7.5/src/sage/structure/element.pyx in sage.structure.element.Element._cmp_ (/local/dakrenn/sage/7.5/src/build/cythonized/sage/structure/element.c:10947)()\n   1172         left_cmp = left.__cmp__\n   1173         if isinstance(left_cmp, MethodType):\n-> 1174             return left_cmp(right)\n   1175         msg = LazyFormat(\"comparison not implemented for %r\")%type(left)\n   1176         raise NotImplementedError(msg)\n\n/local/dakrenn/sage/7.5/local/lib/python2.7/site-packages/sage/rings/qqbar.pyc in __cmp__(self, other)\n   4405             return -other.sign()\n   4406         else:\n-> 4407             return self._sub_(other).sign()\n   4408 \n   4409     def __pow__(self, e):\n\n/local/dakrenn/sage/7.5/local/lib/python2.7/site-packages/sage/rings/qqbar.pyc in sign(self)\n   4734             # OK, we'll try adding precision one more time\n   4735             self._more_precision()\n-> 4736             return self.sign()\n   4737         else:\n   4738             # Sigh...\n\n/local/dakrenn/sage/7.5/local/lib/python2.7/site-packages/sage/rings/qqbar.pyc in sign(self)\n   4737         else:\n   4738             # Sigh...\n-> 4739             self.exactify()\n   4740             return self.sign()\n   4741 \n\n/local/dakrenn/sage/7.5/local/lib/python2.7/site-packages/sage/rings/qqbar.pyc in exactify(self)\n   3269         od = self._descr\n   3270         if isinstance(od, (ANRational, ANExtensionElement)): return\n-> 3271         self._set_descr(self._descr.exactify())\n   3272 \n   3273     def _set_descr(self, new_descr):\n\n/local/dakrenn/sage/7.5/local/lib/python2.7/site-packages/sage/rings/qqbar.pyc in exactify(self)\n   7074             left = self._left\n   7075             right = self._right\n-> 7076             left.exactify()\n   7077             right.exactify()\n   7078             gen = left._exact_field().union(right._exact_field())\n\n/local/dakrenn/sage/7.5/local/lib/python2.7/site-packages/sage/rings/qqbar.pyc in exactify(self)\n   3269         od = self._descr\n   3270         if isinstance(od, (ANRational, ANExtensionElement)): return\n-> 3271         self._set_descr(self._descr.exactify())\n   3272 \n   3273     def _set_descr(self, new_descr):\n\n/local/dakrenn/sage/7.5/local/lib/python2.7/site-packages/sage/rings/qqbar.pyc in exactify(self)\n   7074             left = self._left\n   7075             right = self._right\n-> 7076             left.exactify()\n   7077             right.exactify()\n   7078             gen = left._exact_field().union(right._exact_field())\n\n/local/dakrenn/sage/7.5/local/lib/python2.7/site-packages/sage/rings/qqbar.pyc in exactify(self)\n   3269         od = self._descr\n   3270         if isinstance(od, (ANRational, ANExtensionElement)): return\n-> 3271         self._set_descr(self._descr.exactify())\n   3272 \n   3273     def _set_descr(self, new_descr):\n\n/local/dakrenn/sage/7.5/local/lib/python2.7/site-packages/sage/rings/qqbar.pyc in exactify(self)\n   7074             left = self._left\n   7075             right = self._right\n-> 7076             left.exactify()\n   7077             right.exactify()\n   7078             gen = left._exact_field().union(right._exact_field())\n\n/local/dakrenn/sage/7.5/local/lib/python2.7/site-packages/sage/rings/qqbar.pyc in exactify(self)\n   3269         od = self._descr\n   3270         if isinstance(od, (ANRational, ANExtensionElement)): return\n-> 3271         self._set_descr(self._descr.exactify())\n   3272 \n   3273     def _set_descr(self, new_descr):\n\n/local/dakrenn/sage/7.5/local/lib/python2.7/site-packages/sage/rings/qqbar.pyc in exactify(self)\n   7074             left = self._left\n   7075             right = self._right\n-> 7076             left.exactify()\n   7077             right.exactify()\n   7078             gen = left._exact_field().union(right._exact_field())\n\n/local/dakrenn/sage/7.5/local/lib/python2.7/site-packages/sage/rings/qqbar.pyc in exactify(self)\n   3269         od = self._descr\n   3270         if isinstance(od, (ANRational, ANExtensionElement)): return\n-> 3271         self._set_descr(self._descr.exactify())\n   3272 \n   3273     def _set_descr(self, new_descr):\n\n/local/dakrenn/sage/7.5/local/lib/python2.7/site-packages/sage/rings/qqbar.pyc in exactify(self)\n   7074             left = self._left\n   7075             right = self._right\n-> 7076             left.exactify()\n   7077             right.exactify()\n   7078             gen = left._exact_field().union(right._exact_field())\n\n/local/dakrenn/sage/7.5/local/lib/python2.7/site-packages/sage/rings/qqbar.pyc in exactify(self)\n   3269         od = self._descr\n   3270         if isinstance(od, (ANRational, ANExtensionElement)): return\n-> 3271         self._set_descr(self._descr.exactify())\n   3272 \n   3273     def _set_descr(self, new_descr):\n\n/local/dakrenn/sage/7.5/local/lib/python2.7/site-packages/sage/rings/qqbar.pyc in exactify(self)\n   7074             left = self._left\n   7075             right = self._right\n-> 7076             left.exactify()\n   7077             right.exactify()\n   7078             gen = left._exact_field().union(right._exact_field())\n\n/local/dakrenn/sage/7.5/local/lib/python2.7/site-packages/sage/rings/qqbar.pyc in exactify(self)\n   3269         od = self._descr\n   3270         if isinstance(od, (ANRational, ANExtensionElement)): return\n-> 3271         self._set_descr(self._descr.exactify())\n   3272 \n   3273     def _set_descr(self, new_descr):\n\n/local/dakrenn/sage/7.5/local/lib/python2.7/site-packages/sage/rings/qqbar.pyc in exactify(self)\n   7074             left = self._left\n   7075             right = self._right\n-> 7076             left.exactify()\n   7077             right.exactify()\n   7078             gen = left._exact_field().union(right._exact_field())\n\n/local/dakrenn/sage/7.5/local/lib/python2.7/site-packages/sage/rings/qqbar.pyc in exactify(self)\n   3269         od = self._descr\n   3270         if isinstance(od, (ANRational, ANExtensionElement)): return\n-> 3271         self._set_descr(self._descr.exactify())\n   3272 \n   3273     def _set_descr(self, new_descr):\n\n/local/dakrenn/sage/7.5/local/lib/python2.7/site-packages/sage/rings/qqbar.pyc in exactify(self)\n   7074             left = self._left\n   7075             right = self._right\n-> 7076             left.exactify()\n   7077             right.exactify()\n   7078             gen = left._exact_field().union(right._exact_field())\n\n/local/dakrenn/sage/7.5/local/lib/python2.7/site-packages/sage/rings/qqbar.pyc in exactify(self)\n   3269         od = self._descr\n   3270         if isinstance(od, (ANRational, ANExtensionElement)): return\n-> 3271         self._set_descr(self._descr.exactify())\n   3272 \n   3273     def _set_descr(self, new_descr):\n\n/local/dakrenn/sage/7.5/local/lib/python2.7/site-packages/sage/rings/qqbar.pyc in exactify(self)\n   7074             left = self._left\n   7075             right = self._right\n-> 7076             left.exactify()\n   7077             right.exactify()\n   7078             gen = left._exact_field().union(right._exact_field())\n\n/local/dakrenn/sage/7.5/local/lib/python2.7/site-packages/sage/rings/qqbar.pyc in exactify(self)\n   3269         od = self._descr\n   3270         if isinstance(od, (ANRational, ANExtensionElement)): return\n-> 3271         self._set_descr(self._descr.exactify())\n   3272 \n   3273     def _set_descr(self, new_descr):\n\n/local/dakrenn/sage/7.5/local/lib/python2.7/site-packages/sage/rings/qqbar.pyc in exactify(self)\n   7074             left = self._left\n   7075             right = self._right\n-> 7076             left.exactify()\n   7077             right.exactify()\n   7078             gen = left._exact_field().union(right._exact_field())\n\n/local/dakrenn/sage/7.5/local/lib/python2.7/site-packages/sage/rings/qqbar.pyc in exactify(self)\n   3269         od = self._descr\n   3270         if isinstance(od, (ANRational, ANExtensionElement)): return\n-> 3271         self._set_descr(self._descr.exactify())\n   3272 \n   3273     def _set_descr(self, new_descr):\n\n/local/dakrenn/sage/7.5/local/lib/python2.7/site-packages/sage/rings/qqbar.pyc in exactify(self)\n   7074             left = self._left\n   7075             right = self._right\n-> 7076             left.exactify()\n   7077             right.exactify()\n   7078             gen = left._exact_field().union(right._exact_field())\n\n/local/dakrenn/sage/7.5/local/lib/python2.7/site-packages/sage/rings/qqbar.pyc in exactify(self)\n   3269         od = self._descr\n   3270         if isinstance(od, (ANRational, ANExtensionElement)): return\n-> 3271         self._set_descr(self._descr.exactify())\n   3272 \n   3273     def _set_descr(self, new_descr):\n\n/local/dakrenn/sage/7.5/local/lib/python2.7/site-packages/sage/rings/qqbar.pyc in exactify(self)\n   7074             left = self._left\n   7075             right = self._right\n-> 7076             left.exactify()\n   7077             right.exactify()\n   7078             gen = left._exact_field().union(right._exact_field())\n\n/local/dakrenn/sage/7.5/local/lib/python2.7/site-packages/sage/rings/qqbar.pyc in exactify(self)\n   3269         od = self._descr\n   3270         if isinstance(od, (ANRational, ANExtensionElement)): return\n-> 3271         self._set_descr(self._descr.exactify())\n   3272 \n   3273     def _set_descr(self, new_descr):\n\n/local/dakrenn/sage/7.5/local/lib/python2.7/site-packages/sage/rings/qqbar.pyc in exactify(self)\n   7074             left = self._left\n   7075             right = self._right\n-> 7076             left.exactify()\n   7077             right.exactify()\n   7078             gen = left._exact_field().union(right._exact_field())\n\n/local/dakrenn/sage/7.5/local/lib/python2.7/site-packages/sage/rings/qqbar.pyc in exactify(self)\n   3269         od = self._descr\n   3270         if isinstance(od, (ANRational, ANExtensionElement)): return\n-> 3271         self._set_descr(self._descr.exactify())\n   3272 \n   3273     def _set_descr(self, new_descr):\n\n/local/dakrenn/sage/7.5/local/lib/python2.7/site-packages/sage/rings/qqbar.pyc in exactify(self)\n   7074             left = self._left\n   7075             right = self._right\n-> 7076             left.exactify()\n   7077             right.exactify()\n   7078             gen = left._exact_field().union(right._exact_field())\n\n/local/dakrenn/sage/7.5/local/lib/python2.7/site-packages/sage/rings/qqbar.pyc in exactify(self)\n   3269         od = self._descr\n   3270         if isinstance(od, (ANRational, ANExtensionElement)): return\n-> 3271         self._set_descr(self._descr.exactify())\n   3272 \n   3273     def _set_descr(self, new_descr):\n\n/local/dakrenn/sage/7.5/local/lib/python2.7/site-packages/sage/rings/qqbar.pyc in exactify(self)\n   7074             left = self._left\n   7075             right = self._right\n-> 7076             left.exactify()\n   7077             right.exactify()\n   7078             gen = left._exact_field().union(right._exact_field())\n\n/local/dakrenn/sage/7.5/local/lib/python2.7/site-packages/sage/rings/qqbar.pyc in exactify(self)\n   3269         od = self._descr\n   3270         if isinstance(od, (ANRational, ANExtensionElement)): return\n-> 3271         self._set_descr(self._descr.exactify())\n   3272 \n   3273     def _set_descr(self, new_descr):\n\n/local/dakrenn/sage/7.5/local/lib/python2.7/site-packages/sage/rings/qqbar.pyc in exactify(self)\n   7074             left = self._left\n   7075             right = self._right\n-> 7076             left.exactify()\n   7077             right.exactify()\n   7078             gen = left._exact_field().union(right._exact_field())\n\n/local/dakrenn/sage/7.5/local/lib/python2.7/site-packages/sage/rings/qqbar.pyc in exactify(self)\n   3269         od = self._descr\n   3270         if isinstance(od, (ANRational, ANExtensionElement)): return\n-> 3271         self._set_descr(self._descr.exactify())\n   3272 \n   3273     def _set_descr(self, new_descr):\n\n/local/dakrenn/sage/7.5/local/lib/python2.7/site-packages/sage/rings/qqbar.pyc in exactify(self)\n   7076             left.exactify()\n   7077             right.exactify()\n-> 7078             gen = left._exact_field().union(right._exact_field())\n   7079             left_value = gen(left._exact_value())\n   7080             right_value = gen(right._exact_value())\n\n/local/dakrenn/sage/7.5/local/lib/python2.7/site-packages/sage/rings/qqbar.pyc in union(self, other)\n   2408         newpol_sage_y = QQy(newpol_sage)\n   2409 \n-> 2410         red_elt, red_back, red_pol = do_polred(newpol_sage_y)\n   2411 \n   2412         red_back_x = QQx(red_back)\n\n/local/dakrenn/sage/7.5/local/lib/python2.7/site-packages/sage/rings/qqbar.pyc in do_polred(poly)\n   1711         (1/4*x, 4*x, x^4 - 268435456*x^2 + 211973662764908353025)\n   1712     \"\"\"\n-> 1713     new_poly, elt_back = poly._pari_().polredbest(flag=1)\n   1714 \n   1715     parent = poly.parent()\n\n/local/dakrenn/sage/7.5/local/lib/python2.7/site-packages/sage/libs/cypari2/auto_gen.pxi in sage.libs.cypari2.gen.gen_auto.polredbest (/local/dakrenn/sage/7.5/src/build/cythonized/sage/libs/cypari2/gen.c:80864)()\n  15908         \"\"\"\n  15909         cdef GEN _T = T.g\n> 15910         sig_on()\n  15911         cdef GEN _ret = polredbest(_T, flag)\n  15912         return new_gen(_ret)\n\nsrc/cysignals/signals.pyx in cysignals.signals.sig_raise_exception (build/src/cysignals/signals.c:1303)()\n\nKeyboardInterrupt: \n```",
    "created_at": "2017-01-26T13:43:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22120",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22120#issuecomment-326293",
    "user": "https://github.com/dkrenn"
}
```

<div id="comment:17" align="right">comment:17</div>

Replying to [@videlec](#comment:16):
> What about the traceback after Ctrl-C?

```
sage: s = sum(AA(i)**(1/i) for i in range(1,20))
sage: a = (s/s)**4
^C---------------------------------------------------------------------------
KeyboardInterrupt                         Traceback (most recent call last)
<ipython-input-2-00135d41d691> in <module>()
----> 1 a = (s/s)**Integer(4)

/local/dakrenn/sage/7.5/local/lib/python2.7/site-packages/sage/rings/qqbar.pyc in __pow__(self, e)
   4465         d = e.denominator()
   4466         if d == 1:
-> 4467             return generic_power(self, n)
   4468 
   4469         # First, check for exact roots.

/local/dakrenn/sage/7.5/src/sage/structure/element.pyx in sage.structure.element.generic_power (/local/dakrenn/sage/7.5/src/build/cythonized/sage/structure/element.c:27899)()
   4111     """
   4112 
-> 4113     return generic_power_c(a,n,one)
   4114 
   4115 cdef generic_power_c(a, nn, one):

/local/dakrenn/sage/7.5/src/sage/structure/element.pyx in sage.structure.element.generic_power_c (/local/dakrenn/sage/7.5/src/build/cythonized/sage/structure/element.c:28765)()
   4159     # check for idempotence, and store the result otherwise
   4160     aa = a*a
-> 4161     if aa == a:
   4162         return a
   4163 

/local/dakrenn/sage/7.5/src/sage/structure/element.pyx in sage.structure.element.Element.__richcmp__ (/local/dakrenn/sage/7.5/src/build/cythonized/sage/structure/element.c:10359)()
   1121             # an instance of Element. The explicit casts below make
   1122             # Cython generate optimized code for this call.
-> 1123             return (<Element>self)._richcmp_(other, op)
   1124         else:
   1125             return coercion_model.richcmp(self, other, op)

/local/dakrenn/sage/7.5/src/sage/structure/element.pyx in sage.structure.element.Element._richcmp_ (/local/dakrenn/sage/7.5/src/build/cythonized/sage/structure/element.c:10558)()
   1156         cdef int c
   1157         try:
-> 1158             c = left._cmp_(right)
   1159         except NotImplementedError:
   1160             # Check equality by id(), knowing that left is not right

/local/dakrenn/sage/7.5/src/sage/structure/element.pyx in sage.structure.element.Element._cmp_ (/local/dakrenn/sage/7.5/src/build/cythonized/sage/structure/element.c:10947)()
   1172         left_cmp = left.__cmp__
   1173         if isinstance(left_cmp, MethodType):
-> 1174             return left_cmp(right)
   1175         msg = LazyFormat("comparison not implemented for %r")%type(left)
   1176         raise NotImplementedError(msg)

/local/dakrenn/sage/7.5/local/lib/python2.7/site-packages/sage/rings/qqbar.pyc in __cmp__(self, other)
   4405             return -other.sign()
   4406         else:
-> 4407             return self._sub_(other).sign()
   4408 
   4409     def __pow__(self, e):

/local/dakrenn/sage/7.5/local/lib/python2.7/site-packages/sage/rings/qqbar.pyc in sign(self)
   4734             # OK, we'll try adding precision one more time
   4735             self._more_precision()
-> 4736             return self.sign()
   4737         else:
   4738             # Sigh...

/local/dakrenn/sage/7.5/local/lib/python2.7/site-packages/sage/rings/qqbar.pyc in sign(self)
   4737         else:
   4738             # Sigh...
-> 4739             self.exactify()
   4740             return self.sign()
   4741 

/local/dakrenn/sage/7.5/local/lib/python2.7/site-packages/sage/rings/qqbar.pyc in exactify(self)
   3269         od = self._descr
   3270         if isinstance(od, (ANRational, ANExtensionElement)): return
-> 3271         self._set_descr(self._descr.exactify())
   3272 
   3273     def _set_descr(self, new_descr):

/local/dakrenn/sage/7.5/local/lib/python2.7/site-packages/sage/rings/qqbar.pyc in exactify(self)
   7074             left = self._left
   7075             right = self._right
-> 7076             left.exactify()
   7077             right.exactify()
   7078             gen = left._exact_field().union(right._exact_field())

/local/dakrenn/sage/7.5/local/lib/python2.7/site-packages/sage/rings/qqbar.pyc in exactify(self)
   3269         od = self._descr
   3270         if isinstance(od, (ANRational, ANExtensionElement)): return
-> 3271         self._set_descr(self._descr.exactify())
   3272 
   3273     def _set_descr(self, new_descr):

/local/dakrenn/sage/7.5/local/lib/python2.7/site-packages/sage/rings/qqbar.pyc in exactify(self)
   7074             left = self._left
   7075             right = self._right
-> 7076             left.exactify()
   7077             right.exactify()
   7078             gen = left._exact_field().union(right._exact_field())

/local/dakrenn/sage/7.5/local/lib/python2.7/site-packages/sage/rings/qqbar.pyc in exactify(self)
   3269         od = self._descr
   3270         if isinstance(od, (ANRational, ANExtensionElement)): return
-> 3271         self._set_descr(self._descr.exactify())
   3272 
   3273     def _set_descr(self, new_descr):

/local/dakrenn/sage/7.5/local/lib/python2.7/site-packages/sage/rings/qqbar.pyc in exactify(self)
   7074             left = self._left
   7075             right = self._right
-> 7076             left.exactify()
   7077             right.exactify()
   7078             gen = left._exact_field().union(right._exact_field())

/local/dakrenn/sage/7.5/local/lib/python2.7/site-packages/sage/rings/qqbar.pyc in exactify(self)
   3269         od = self._descr
   3270         if isinstance(od, (ANRational, ANExtensionElement)): return
-> 3271         self._set_descr(self._descr.exactify())
   3272 
   3273     def _set_descr(self, new_descr):

/local/dakrenn/sage/7.5/local/lib/python2.7/site-packages/sage/rings/qqbar.pyc in exactify(self)
   7074             left = self._left
   7075             right = self._right
-> 7076             left.exactify()
   7077             right.exactify()
   7078             gen = left._exact_field().union(right._exact_field())

/local/dakrenn/sage/7.5/local/lib/python2.7/site-packages/sage/rings/qqbar.pyc in exactify(self)
   3269         od = self._descr
   3270         if isinstance(od, (ANRational, ANExtensionElement)): return
-> 3271         self._set_descr(self._descr.exactify())
   3272 
   3273     def _set_descr(self, new_descr):

/local/dakrenn/sage/7.5/local/lib/python2.7/site-packages/sage/rings/qqbar.pyc in exactify(self)
   7074             left = self._left
   7075             right = self._right
-> 7076             left.exactify()
   7077             right.exactify()
   7078             gen = left._exact_field().union(right._exact_field())

/local/dakrenn/sage/7.5/local/lib/python2.7/site-packages/sage/rings/qqbar.pyc in exactify(self)
   3269         od = self._descr
   3270         if isinstance(od, (ANRational, ANExtensionElement)): return
-> 3271         self._set_descr(self._descr.exactify())
   3272 
   3273     def _set_descr(self, new_descr):

/local/dakrenn/sage/7.5/local/lib/python2.7/site-packages/sage/rings/qqbar.pyc in exactify(self)
   7074             left = self._left
   7075             right = self._right
-> 7076             left.exactify()
   7077             right.exactify()
   7078             gen = left._exact_field().union(right._exact_field())

/local/dakrenn/sage/7.5/local/lib/python2.7/site-packages/sage/rings/qqbar.pyc in exactify(self)
   3269         od = self._descr
   3270         if isinstance(od, (ANRational, ANExtensionElement)): return
-> 3271         self._set_descr(self._descr.exactify())
   3272 
   3273     def _set_descr(self, new_descr):

/local/dakrenn/sage/7.5/local/lib/python2.7/site-packages/sage/rings/qqbar.pyc in exactify(self)
   7074             left = self._left
   7075             right = self._right
-> 7076             left.exactify()
   7077             right.exactify()
   7078             gen = left._exact_field().union(right._exact_field())

/local/dakrenn/sage/7.5/local/lib/python2.7/site-packages/sage/rings/qqbar.pyc in exactify(self)
   3269         od = self._descr
   3270         if isinstance(od, (ANRational, ANExtensionElement)): return
-> 3271         self._set_descr(self._descr.exactify())
   3272 
   3273     def _set_descr(self, new_descr):

/local/dakrenn/sage/7.5/local/lib/python2.7/site-packages/sage/rings/qqbar.pyc in exactify(self)
   7074             left = self._left
   7075             right = self._right
-> 7076             left.exactify()
   7077             right.exactify()
   7078             gen = left._exact_field().union(right._exact_field())

/local/dakrenn/sage/7.5/local/lib/python2.7/site-packages/sage/rings/qqbar.pyc in exactify(self)
   3269         od = self._descr
   3270         if isinstance(od, (ANRational, ANExtensionElement)): return
-> 3271         self._set_descr(self._descr.exactify())
   3272 
   3273     def _set_descr(self, new_descr):

/local/dakrenn/sage/7.5/local/lib/python2.7/site-packages/sage/rings/qqbar.pyc in exactify(self)
   7074             left = self._left
   7075             right = self._right
-> 7076             left.exactify()
   7077             right.exactify()
   7078             gen = left._exact_field().union(right._exact_field())

/local/dakrenn/sage/7.5/local/lib/python2.7/site-packages/sage/rings/qqbar.pyc in exactify(self)
   3269         od = self._descr
   3270         if isinstance(od, (ANRational, ANExtensionElement)): return
-> 3271         self._set_descr(self._descr.exactify())
   3272 
   3273     def _set_descr(self, new_descr):

/local/dakrenn/sage/7.5/local/lib/python2.7/site-packages/sage/rings/qqbar.pyc in exactify(self)
   7074             left = self._left
   7075             right = self._right
-> 7076             left.exactify()
   7077             right.exactify()
   7078             gen = left._exact_field().union(right._exact_field())

/local/dakrenn/sage/7.5/local/lib/python2.7/site-packages/sage/rings/qqbar.pyc in exactify(self)
   3269         od = self._descr
   3270         if isinstance(od, (ANRational, ANExtensionElement)): return
-> 3271         self._set_descr(self._descr.exactify())
   3272 
   3273     def _set_descr(self, new_descr):

/local/dakrenn/sage/7.5/local/lib/python2.7/site-packages/sage/rings/qqbar.pyc in exactify(self)
   7074             left = self._left
   7075             right = self._right
-> 7076             left.exactify()
   7077             right.exactify()
   7078             gen = left._exact_field().union(right._exact_field())

/local/dakrenn/sage/7.5/local/lib/python2.7/site-packages/sage/rings/qqbar.pyc in exactify(self)
   3269         od = self._descr
   3270         if isinstance(od, (ANRational, ANExtensionElement)): return
-> 3271         self._set_descr(self._descr.exactify())
   3272 
   3273     def _set_descr(self, new_descr):

/local/dakrenn/sage/7.5/local/lib/python2.7/site-packages/sage/rings/qqbar.pyc in exactify(self)
   7074             left = self._left
   7075             right = self._right
-> 7076             left.exactify()
   7077             right.exactify()
   7078             gen = left._exact_field().union(right._exact_field())

/local/dakrenn/sage/7.5/local/lib/python2.7/site-packages/sage/rings/qqbar.pyc in exactify(self)
   3269         od = self._descr
   3270         if isinstance(od, (ANRational, ANExtensionElement)): return
-> 3271         self._set_descr(self._descr.exactify())
   3272 
   3273     def _set_descr(self, new_descr):

/local/dakrenn/sage/7.5/local/lib/python2.7/site-packages/sage/rings/qqbar.pyc in exactify(self)
   7074             left = self._left
   7075             right = self._right
-> 7076             left.exactify()
   7077             right.exactify()
   7078             gen = left._exact_field().union(right._exact_field())

/local/dakrenn/sage/7.5/local/lib/python2.7/site-packages/sage/rings/qqbar.pyc in exactify(self)
   3269         od = self._descr
   3270         if isinstance(od, (ANRational, ANExtensionElement)): return
-> 3271         self._set_descr(self._descr.exactify())
   3272 
   3273     def _set_descr(self, new_descr):

/local/dakrenn/sage/7.5/local/lib/python2.7/site-packages/sage/rings/qqbar.pyc in exactify(self)
   7074             left = self._left
   7075             right = self._right
-> 7076             left.exactify()
   7077             right.exactify()
   7078             gen = left._exact_field().union(right._exact_field())

/local/dakrenn/sage/7.5/local/lib/python2.7/site-packages/sage/rings/qqbar.pyc in exactify(self)
   3269         od = self._descr
   3270         if isinstance(od, (ANRational, ANExtensionElement)): return
-> 3271         self._set_descr(self._descr.exactify())
   3272 
   3273     def _set_descr(self, new_descr):

/local/dakrenn/sage/7.5/local/lib/python2.7/site-packages/sage/rings/qqbar.pyc in exactify(self)
   7074             left = self._left
   7075             right = self._right
-> 7076             left.exactify()
   7077             right.exactify()
   7078             gen = left._exact_field().union(right._exact_field())

/local/dakrenn/sage/7.5/local/lib/python2.7/site-packages/sage/rings/qqbar.pyc in exactify(self)
   3269         od = self._descr
   3270         if isinstance(od, (ANRational, ANExtensionElement)): return
-> 3271         self._set_descr(self._descr.exactify())
   3272 
   3273     def _set_descr(self, new_descr):

/local/dakrenn/sage/7.5/local/lib/python2.7/site-packages/sage/rings/qqbar.pyc in exactify(self)
   7074             left = self._left
   7075             right = self._right
-> 7076             left.exactify()
   7077             right.exactify()
   7078             gen = left._exact_field().union(right._exact_field())

/local/dakrenn/sage/7.5/local/lib/python2.7/site-packages/sage/rings/qqbar.pyc in exactify(self)
   3269         od = self._descr
   3270         if isinstance(od, (ANRational, ANExtensionElement)): return
-> 3271         self._set_descr(self._descr.exactify())
   3272 
   3273     def _set_descr(self, new_descr):

/local/dakrenn/sage/7.5/local/lib/python2.7/site-packages/sage/rings/qqbar.pyc in exactify(self)
   7076             left.exactify()
   7077             right.exactify()
-> 7078             gen = left._exact_field().union(right._exact_field())
   7079             left_value = gen(left._exact_value())
   7080             right_value = gen(right._exact_value())

/local/dakrenn/sage/7.5/local/lib/python2.7/site-packages/sage/rings/qqbar.pyc in union(self, other)
   2408         newpol_sage_y = QQy(newpol_sage)
   2409 
-> 2410         red_elt, red_back, red_pol = do_polred(newpol_sage_y)
   2411 
   2412         red_back_x = QQx(red_back)

/local/dakrenn/sage/7.5/local/lib/python2.7/site-packages/sage/rings/qqbar.pyc in do_polred(poly)
   1711         (1/4*x, 4*x, x^4 - 268435456*x^2 + 211973662764908353025)
   1712     """
-> 1713     new_poly, elt_back = poly._pari_().polredbest(flag=1)
   1714 
   1715     parent = poly.parent()

/local/dakrenn/sage/7.5/local/lib/python2.7/site-packages/sage/libs/cypari2/auto_gen.pxi in sage.libs.cypari2.gen.gen_auto.polredbest (/local/dakrenn/sage/7.5/src/build/cythonized/sage/libs/cypari2/gen.c:80864)()
  15908         """
  15909         cdef GEN _T = T.g
> 15910         sig_on()
  15911         cdef GEN _ret = polredbest(_T, flag)
  15912         return new_gen(_ret)

src/cysignals/signals.pyx in cysignals.signals.sig_raise_exception (build/src/cysignals/signals.c:1303)()

KeyboardInterrupt: 
```



---

archive/issue_comments_326294.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nReplying to [@videlec](#comment:16):\n> random guess: it might be relative to `_repr_`. You can try `a = (s/s)**4` instead.\n\nDoes not seem to change anything.",
    "created_at": "2017-01-26T13:43:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22120",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22120#issuecomment-326294",
    "user": "https://github.com/dkrenn"
}
```

<div id="comment:18" align="right">comment:18</div>

Replying to [@videlec](#comment:16):
> random guess: it might be relative to `_repr_`. You can try `a = (s/s)**4` instead.

Does not seem to change anything.



---

archive/issue_comments_326295.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nDear Vincent,\n\nReplying to [@dkrenn](#comment:15):\n> Let me reformulate:\n> \n> ```\n> sage: s = sum(AA(i)**(1/i) for i in range(1,20))\n> sage: (s/s) ** 4\n> ```\n> does not give a result within a couple of hours on a fresh 7.5. And I was wondering why?\n\nI've tried to investigate this now: On all systems and Sage-versions (with and without this patch) I've tested it, this takes ages. I have no idea how it could be that fast on your system. Can you maybe repeat the test or do you have any (other) guess what happens?\n\n(The problem is, that the generic pow tests for idempotence `a**2 == a`, which is not possible for our example above.)",
    "created_at": "2017-02-08T10:40:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22120",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22120#issuecomment-326295",
    "user": "https://github.com/dkrenn"
}
```

<div id="comment:19" align="right">comment:19</div>

Dear Vincent,

Replying to [@dkrenn](#comment:15):
> Let me reformulate:
> 
> ```
> sage: s = sum(AA(i)**(1/i) for i in range(1,20))
> sage: (s/s) ** 4
> ```
> does not give a result within a couple of hours on a fresh 7.5. And I was wondering why?

I've tried to investigate this now: On all systems and Sage-versions (with and without this patch) I've tested it, this takes ages. I have no idea how it could be that fast on your system. Can you maybe repeat the test or do you have any (other) guess what happens?

(The problem is, that the generic pow tests for idempotence `a**2 == a`, which is not possible for our example above.)



---

archive/issue_comments_326296.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nWhy special case powers of 1 in `QQbar`? This makes no sense since we don't support `QQbar^QQbar` powering in general. I'd prefer to revert this in #5574 unless somebody gives me a good reason for why this ticket sense.",
    "created_at": "2018-01-08T11:22:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22120",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22120#issuecomment-326296",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:20" align="right">comment:20</div>

Why special case powers of 1 in `QQbar`? This makes no sense since we don't support `QQbar^QQbar` powering in general. I'd prefer to revert this in #5574 unless somebody gives me a good reason for why this ticket sense.



---

archive/issue_comments_326297.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nActually, I created #24490 to revert this.",
    "created_at": "2018-01-08T11:25:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22120",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22120#issuecomment-326297",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:21" align="right">comment:21</div>

Actually, I created #24490 to revert this.
