# Issue 22998: Unable to parse hypergeometric result from mathematica_free

archive/issues_022761.json:
```json
{
    "body": "\n```\nsage: integrate(e^(-x^2)*log(x), x, algorithm='mathematica_free')\nTraceback (most recent call last):\n...\nValueError: Unable to parse: -(x*HypergeometricPFQ[{1/2,1/2},{3/2,3/2},-x^2])+(Sqrt[Pi]*Erf[x]*Log[x])/2\n```\n\nCC:  @rwst @kcrisman\n\nKeywords: integrate, hypergeometric\n\nBranch/Commit: 49bb25e9beb56bf1bb3669a2c406f99be1d3ff4b\n\nReviewer: Ralf Stephan\n\nAuthor: Marcelo Forets\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/22998\n\n",
    "closed_at": "2017-05-21T10:08:27Z",
    "created_at": "2017-05-14T09:59:48Z",
    "labels": [
        "component: calculus"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.0",
    "title": "Unable to parse hypergeometric result from mathematica_free",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22998",
    "user": "https://github.com/mforets"
}
```

```
sage: integrate(e^(-x^2)*log(x), x, algorithm='mathematica_free')
Traceback (most recent call last):
...
ValueError: Unable to parse: -(x*HypergeometricPFQ[{1/2,1/2},{3/2,3/2},-x^2])+(Sqrt[Pi]*Erf[x]*Log[x])/2
```

CC:  @rwst @kcrisman

Keywords: integrate, hypergeometric

Branch/Commit: 49bb25e9beb56bf1bb3669a2c406f99be1d3ff4b

Reviewer: Ralf Stephan

Author: Marcelo Forets

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/22998





---

archive/issue_comments_430663.json:
```json
{
    "body": "<a id='comment:1'></a>\nthe result i was expecting is the sage object:\n \n```\nresult = -(x*hypergeometric((1/2,1/2),(3/2,3/2),-x^2))+(sqrt(pi)*erf(x)*log(x))/2\n```\n\n\nmaybe one can substitute the line in `mma_free_integrator`:\n\n```\nans = SR(mexpr.lower().replace('[', '(').replace(']', ')'))\n```\n\nwith the some of the code at the mathematica interface in `_sage_` ?\n\n(we don't need Mathematica to be installed!)\n\nas you can see, there are two issues with the line above in this example. it transforms: \n\n```\n-(x*HypergeometricPFQ[{1/2,1/2},{3/2,3/2},-x^2])+(Sqrt[Pi]*Erf[x]*Log[x])/2\n```\n\ninto \n\n```\n'-(x*hypergeometricpfq({1/2,1/2},{3/2,3/2},-x^2))+(sqrt(pi)*erf(x)*log(x))/2'\n```\n\nthese are (i) curly braces, (ii) the special function is not transformed properly (no use of the conversions dictionary)",
    "created_at": "2017-05-14T10:41:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22998#issuecomment-430663",
    "user": "https://github.com/mforets"
}
```

<a id='comment:1'></a>
the result i was expecting is the sage object:
 
```
result = -(x*hypergeometric((1/2,1/2),(3/2,3/2),-x^2))+(sqrt(pi)*erf(x)*log(x))/2
```


maybe one can substitute the line in `mma_free_integrator`:

```
ans = SR(mexpr.lower().replace('[', '(').replace(']', ')'))
```

with the some of the code at the mathematica interface in `_sage_` ?

(we don't need Mathematica to be installed!)

as you can see, there are two issues with the line above in this example. it transforms: 

```
-(x*HypergeometricPFQ[{1/2,1/2},{3/2,3/2},-x^2])+(Sqrt[Pi]*Erf[x]*Log[x])/2
```

into 

```
'-(x*hypergeometricpfq({1/2,1/2},{3/2,3/2},-x^2))+(sqrt(pi)*erf(x)*log(x))/2'
```

these are (i) curly braces, (ii) the special function is not transformed properly (no use of the conversions dictionary)



---

archive/issue_comments_430664.json:
```json
{
    "body": "Changing branch from \"\" to \"u/mforets/22998\"",
    "created_at": "2017-05-14T15:10:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22998#issuecomment-430664",
    "user": "https://github.com/mforets"
}
```

Changing branch from "" to "u/mforets/22998"



---

archive/issue_comments_430665.json:
```json
{
    "body": "<a id='comment:2'></a>\nNew commits:\n|                                                                                                                                          |                                   |\n|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------|\n|[624f0e3](https://git.sagemath.org/sage.git/commit?id=624f0e3a8ba1887b33efa3db1273f84fb8dc5444)|`error func mathematica conversion`|\n|[83c1dfc](https://git.sagemath.org/sage.git/commit?id=83c1dfc948b2b70bbba60b9db5e48bf9b633461e)|`use mathematica symbols table`|",
    "created_at": "2017-05-14T15:10:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22998#issuecomment-430665",
    "user": "https://github.com/mforets"
}
```

<a id='comment:2'></a>
New commits:
|                                                                                                                                          |                                   |
|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------|
|[624f0e3](https://git.sagemath.org/sage.git/commit?id=624f0e3a8ba1887b33efa3db1273f84fb8dc5444)|`error func mathematica conversion`|
|[83c1dfc](https://git.sagemath.org/sage.git/commit?id=83c1dfc948b2b70bbba60b9db5e48bf9b633461e)|`use mathematica symbols table`|



---

archive/issue_comments_430666.json:
```json
{
    "body": "Changing commit from \"\" to \"83c1dfc948b2b70bbba60b9db5e48bf9b633461e\"",
    "created_at": "2017-05-14T15:10:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22998#issuecomment-430666",
    "user": "https://github.com/mforets"
}
```

Changing commit from "" to "83c1dfc948b2b70bbba60b9db5e48bf9b633461e"



---

archive/issue_comments_430667.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-05-14T15:10:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22998#issuecomment-430667",
    "user": "https://github.com/mforets"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_430668.json:
```json
{
    "body": "<a id='comment:3'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                               |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------|\n|[017571b](https://git.sagemath.org/sage.git/commit/?id=017571be17eb4fe067314629c65a5f2b20989761)|`add 2 mathematica conversions`|\n|[ccc99a1](https://git.sagemath.org/sage.git/commit/?id=ccc99a13ab67806d2d0f1fb7265bbf1cd1d76fff)|`tweak import as`|",
    "created_at": "2017-05-14T19:14:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22998#issuecomment-430668",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                               |
|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------|
|[017571b](https://git.sagemath.org/sage.git/commit/?id=017571be17eb4fe067314629c65a5f2b20989761)|`add 2 mathematica conversions`|
|[ccc99a1](https://git.sagemath.org/sage.git/commit/?id=ccc99a13ab67806d2d0f1fb7265bbf1cd1d76fff)|`tweak import as`|



---

archive/issue_comments_430669.json:
```json
{
    "body": "Changing commit from \"83c1dfc948b2b70bbba60b9db5e48bf9b633461e\" to \"ccc99a13ab67806d2d0f1fb7265bbf1cd1d76fff\"",
    "created_at": "2017-05-14T19:14:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22998#issuecomment-430669",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "83c1dfc948b2b70bbba60b9db5e48bf9b633461e" to "ccc99a13ab67806d2d0f1fb7265bbf1cd1d76fff"



---

archive/issue_comments_430670.json:
```json
{
    "body": "Changing commit from \"ccc99a13ab67806d2d0f1fb7265bbf1cd1d76fff\" to \"686f1cafe5918cad19db0afb6c9c8ae9a40ac4c8\"",
    "created_at": "2017-05-14T19:21:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22998#issuecomment-430670",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "ccc99a13ab67806d2d0f1fb7265bbf1cd1d76fff" to "686f1cafe5918cad19db0afb6c9c8ae9a40ac4c8"



---

archive/issue_comments_430671.json:
```json
{
    "body": "<a id='comment:4'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                            |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------|\n|[686f1ca](https://git.sagemath.org/sage.git/commit/?id=686f1cafe5918cad19db0afb6c9c8ae9a40ac4c8)|`fix extra space in message`|",
    "created_at": "2017-05-14T19:21:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22998#issuecomment-430671",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                            |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------|
|[686f1ca](https://git.sagemath.org/sage.git/commit/?id=686f1cafe5918cad19db0afb6c9c8ae9a40ac4c8)|`fix extra space in message`|



---

archive/issue_comments_430672.json:
```json
{
    "body": "<a id='comment:5'></a>\nnotice that this change has an (arguably) adverse effect in test at lines 492-495 of `symbolic/integration/integral.py`. \n\nindeed, instead of \n\n```\nsage: _ = var('x, y, z')\nsage: f = sin(x^2) + y^z\nsage: f.integrate(x, algorithm=\"mathematica_free\")   # optional - internet\nx*y^z + sqrt(1/2)*sqrt(pi)*fresnels(sqrt(2)*x/sqrt(pi))\n```\n\none has:\n\n```\nsage: _ = var('x, y, z')\nsage: f = sin(x^2) + y^z\nsage: f.integrate(x, algorithm=\"mathematica_free\")   # optional - internet\nTraceback (most recent call last):\nNotImplementedError: Don't know a Sage equivalent for Mathematica function 'FresnelS'.\n```\n\nthe new issue is because Fresnel integrals are not implemented in Sage (right?) -- in other words, one cannot do much with the former result. \n\nThat said, Sage could return a more verbose message like:\n\n```\n\"Don't know a Sage equivalent for Mathematica function '%s'.\n\nUnable to parse: %s\" % m.group() % mexpr\n```",
    "created_at": "2017-05-14T19:30:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22998#issuecomment-430672",
    "user": "https://github.com/mforets"
}
```

<a id='comment:5'></a>
notice that this change has an (arguably) adverse effect in test at lines 492-495 of `symbolic/integration/integral.py`. 

indeed, instead of 

```
sage: _ = var('x, y, z')
sage: f = sin(x^2) + y^z
sage: f.integrate(x, algorithm="mathematica_free")   # optional - internet
x*y^z + sqrt(1/2)*sqrt(pi)*fresnels(sqrt(2)*x/sqrt(pi))
```

one has:

```
sage: _ = var('x, y, z')
sage: f = sin(x^2) + y^z
sage: f.integrate(x, algorithm="mathematica_free")   # optional - internet
Traceback (most recent call last):
NotImplementedError: Don't know a Sage equivalent for Mathematica function 'FresnelS'.
```

the new issue is because Fresnel integrals are not implemented in Sage (right?) -- in other words, one cannot do much with the former result. 

That said, Sage could return a more verbose message like:

```
"Don't know a Sage equivalent for Mathematica function '%s'.

Unable to parse: %s" % m.group() % mexpr
```



---

archive/issue_comments_430673.json:
```json
{
    "body": "<a id='comment:6'></a>\nReplying to [mforets](#comment%3A5):\n> the new issue is because Fresnel integrals are not implemented in Sage (right?)\n\n\nRight. You can see all symbolic function tickets at https://trac.sagemath.org/wiki/symbolics/functions",
    "created_at": "2017-05-15T08:25:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22998#issuecomment-430673",
    "user": "https://github.com/rwst"
}
```

<a id='comment:6'></a>
Replying to [mforets](#comment%3A5):
> the new issue is because Fresnel integrals are not implemented in Sage (right?)


Right. You can see all symbolic function tickets at https://trac.sagemath.org/wiki/symbolics/functions



---

archive/issue_comments_430674.json:
```json
{
    "body": "<a id='comment:7'></a>\nthanks for pointing out that page. i've added an entry in [Tickets to make](https://trac.sagemath.org/wiki/symbolics/functions#Ticketstomake) for future reference.",
    "created_at": "2017-05-16T05:35:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22998#issuecomment-430674",
    "user": "https://github.com/mforets"
}
```

<a id='comment:7'></a>
thanks for pointing out that page. i've added an entry in [Tickets to make](https://trac.sagemath.org/wiki/symbolics/functions#Ticketstomake) for future reference.



---

archive/issue_comments_430675.json:
```json
{
    "body": "<a id='comment:8'></a>\nLooks good, and tests in relevant directories pass. Please fill in the Authors field.",
    "created_at": "2017-05-16T14:46:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22998#issuecomment-430675",
    "user": "https://github.com/rwst"
}
```

<a id='comment:8'></a>
Looks good, and tests in relevant directories pass. Please fill in the Authors field.



---

archive/issue_comments_430676.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Ralf Stephan\"",
    "created_at": "2017-05-16T14:46:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22998#issuecomment-430676",
    "user": "https://github.com/rwst"
}
```

Changing reviewer from "" to "Ralf Stephan"



---

archive/issue_comments_430677.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-05-16T14:46:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22998#issuecomment-430677",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_430678.json:
```json
{
    "body": "Changing author from \"\" to \"Marcelo Forets\"",
    "created_at": "2017-05-16T14:47:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22998#issuecomment-430678",
    "user": "https://github.com/mforets"
}
```

Changing author from "" to "Marcelo Forets"



---

archive/issue_comments_430679.json:
```json
{
    "body": "<a id='comment:9'></a>\nThanks :)",
    "created_at": "2017-05-16T14:47:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22998#issuecomment-430679",
    "user": "https://github.com/mforets"
}
```

<a id='comment:9'></a>
Thanks :)



---

archive/issue_comments_430680.json:
```json
{
    "body": "<a id='comment:10'></a>\ndo you want me to update (in a new ticket) the doctest from[comment:5](#comment%3A5)? the patchbots, do they test with `optional - internet`?",
    "created_at": "2017-05-16T16:48:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22998#issuecomment-430680",
    "user": "https://github.com/mforets"
}
```

<a id='comment:10'></a>
do you want me to update (in a new ticket) the doctest from[comment:5](#comment%3A5)? the patchbots, do they test with `optional - internet`?



---

archive/issue_comments_430681.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-05-19T22:13:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22998#issuecomment-430681",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_430682.json:
```json
{
    "body": "<a id='comment:11'></a>\nmerge conflict",
    "created_at": "2017-05-19T22:13:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22998#issuecomment-430682",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:11'></a>
merge conflict



---

archive/issue_comments_430683.json:
```json
{
    "body": "Changing branch from \"u/mforets/22998\" to \"u/rws/22998\"",
    "created_at": "2017-05-20T05:13:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22998#issuecomment-430683",
    "user": "https://github.com/rwst"
}
```

Changing branch from "u/mforets/22998" to "u/rws/22998"



---

archive/issue_comments_430684.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2017-05-20T05:13:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22998#issuecomment-430684",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_430685.json:
```json
{
    "body": "Changing commit from \"686f1cafe5918cad19db0afb6c9c8ae9a40ac4c8\" to \"49bb25e9beb56bf1bb3669a2c406f99be1d3ff4b\"",
    "created_at": "2017-05-20T05:13:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22998#issuecomment-430685",
    "user": "https://github.com/rwst"
}
```

Changing commit from "686f1cafe5918cad19db0afb6c9c8ae9a40ac4c8" to "49bb25e9beb56bf1bb3669a2c406f99be1d3ff4b"



---

archive/issue_comments_430686.json:
```json
{
    "body": "<a id='comment:13'></a>\nNew commits:\n|                                                                                                                                          |                                           |\n|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------|\n|[49bb25e](https://git.sagemath.org/sage.git/commit?id=49bb25e9beb56bf1bb3669a2c406f99be1d3ff4b)|`Merge branch 'develop' into t/22998/22998`|",
    "created_at": "2017-05-20T05:13:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22998#issuecomment-430686",
    "user": "https://github.com/rwst"
}
```

<a id='comment:13'></a>
New commits:
|                                                                                                                                          |                                           |
|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------|
|[49bb25e](https://git.sagemath.org/sage.git/commit?id=49bb25e9beb56bf1bb3669a2c406f99be1d3ff4b)|`Merge branch 'develop' into t/22998/22998`|



---

archive/issue_events_059586.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-05-21T10:08:27Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/22998",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22998#event-59586"
}
```



---

archive/issue_comments_430687.json:
```json
{
    "body": "Changing branch from \"u/rws/22998\" to \"49bb25e9beb56bf1bb3669a2c406f99be1d3ff4b\"",
    "created_at": "2017-05-21T10:08:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22998#issuecomment-430687",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/rws/22998" to "49bb25e9beb56bf1bb3669a2c406f99be1d3ff4b"



---

archive/issue_comments_430688.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-05-21T10:08:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22998#issuecomment-430688",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
