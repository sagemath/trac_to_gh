# Issue 22886: fix pxd header files

archive/issues_022649.json:
```json
{
    "assignees": [],
    "body": "If we try to compile some external Cython code that links against some Sage Cython code the compiler is not able to find some of the headers. Thanks to our patched version of Cython, tiny modifications of the include solve the issue.\n\nDepends on #23799\nDepends on #22461\n\nCC:  @jdemeyer\n\nBranch/Commit: **[6700ab3](https://github.com/sagemath/sagetrac-mirror/commit/6700ab33f3844190f9dcfc323492b65188796d85)**\n\nReviewer: **Jeroen Demeyer**\n\nAuthor: **Vincent Delecroix**\n\nComponent: **misc**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/22886_\n\n",
    "closed_at": "2017-10-05T06:54:15Z",
    "created_at": "2017-04-27T13:41:30Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.0",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "fix pxd header files",
    "type": "issue",
    "updated_at": "2017-10-05T06:54:15Z",
    "url": "https://github.com/sagemath/sage/issues/22886",
    "user": "https://github.com/videlec"
}
```
If we try to compile some external Cython code that links against some Sage Cython code the compiler is not able to find some of the headers. Thanks to our patched version of Cython, tiny modifications of the include solve the issue.

Depends on #23799
Depends on #22461

CC:  @jdemeyer

Branch/Commit: **[6700ab3](https://github.com/sagemath/sagetrac-mirror/commit/6700ab33f3844190f9dcfc323492b65188796d85)**

Reviewer: **Jeroen Demeyer**

Author: **Vincent Delecroix**

Component: **misc**

_Issue created by migration from https://trac.sagemath.org/ticket/22886_





---

archive/issue_events_319274.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-04-27T13:41:30Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/22886",
    "milestone_number": null,
    "milestone_title": "sage-8.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22886#event-319274"
}
```



---

archive/issue_events_319275.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-04-27T13:41:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22886",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22886#event-319275"
}
```



---

archive/issue_events_319276.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-04-27T13:41:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22886",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22886#event-319276"
}
```



---

archive/issue_comments_341385.json:
```json
{
    "body": "<div id=\"comment:1\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/41dc83f8bfd6abe1609140ba89031440cb4509a5\">41dc83f</a></td><td><code>fix headers</code></td></tr></table>\n",
    "created_at": "2017-04-27T13:42:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22886#issuecomment-341385",
    "user": "https://github.com/videlec"
}
```

<div id="comment:1"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/41dc83f8bfd6abe1609140ba89031440cb4509a5">41dc83f</a></td><td><code>fix headers</code></td></tr></table>




---

archive/issue_events_319277.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-04-27T13:42:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22886",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22886#event-319277"
}
```



---

archive/issue_comments_341386.json:
```json
{
    "body": "Commit: **[41dc83f](https://github.com/sagemath/sagetrac-mirror/commit/41dc83f8bfd6abe1609140ba89031440cb4509a5)**",
    "created_at": "2017-04-27T13:42:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22886#issuecomment-341386",
    "user": "https://github.com/videlec"
}
```

Commit: **[41dc83f](https://github.com/sagemath/sagetrac-mirror/commit/41dc83f8bfd6abe1609140ba89031440cb4509a5)**



---

archive/issue_comments_341387.json:
```json
{
    "body": "Branch: **[u/vdelecroix/22886](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/22886)**",
    "created_at": "2017-04-27T13:42:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22886#issuecomment-341387",
    "user": "https://github.com/videlec"
}
```

Branch: **[u/vdelecroix/22886](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/22886)**



---

archive/issue_comments_341388.json:
```json
{
    "body": "Changed commit from **[41dc83f](https://github.com/sagemath/sagetrac-mirror/commit/41dc83f8bfd6abe1609140ba89031440cb4509a5)** to **[cca8edf](https://github.com/sagemath/sagetrac-mirror/commit/cca8edfcb800a6535057c9547bb2b14b7ff6a8b5)**",
    "created_at": "2017-04-27T13:44:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22886#issuecomment-341388",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[41dc83f](https://github.com/sagemath/sagetrac-mirror/commit/41dc83f8bfd6abe1609140ba89031440cb4509a5)** to **[cca8edf](https://github.com/sagemath/sagetrac-mirror/commit/cca8edfcb800a6535057c9547bb2b14b7ff6a8b5)**



---

archive/issue_comments_341389.json:
```json
{
    "body": "<div id=\"comment:2\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cca8edfcb800a6535057c9547bb2b14b7ff6a8b5\">cca8edf</a></td><td><code>fix headers</code></td></tr></table>\n",
    "created_at": "2017-04-27T13:44:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22886#issuecomment-341389",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:2"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cca8edfcb800a6535057c9547bb2b14b7ff6a8b5">cca8edf</a></td><td><code>fix headers</code></td></tr></table>




---

archive/issue_comments_341390.json:
```json
{
    "body": "Changed branch from **[u/vdelecroix/22886](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/22886)** to **[u/jdemeyer/22886](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/22886)**",
    "created_at": "2017-04-28T09:56:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22886#issuecomment-341390",
    "user": "https://github.com/jdemeyer"
}
```

Changed branch from **[u/vdelecroix/22886](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/22886)** to **[u/jdemeyer/22886](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/22886)**



---

archive/issue_events_319278.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-04-28T11:19:26Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22886",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22886#event-319278"
}
```



---

archive/issue_events_319279.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-04-28T11:19:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22886",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22886#event-319279"
}
```



---

archive/issue_comments_341391.json:
```json
{
    "body": "Reviewer: **Jeroen Demeyer**",
    "created_at": "2017-04-28T11:19:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22886#issuecomment-341391",
    "user": "https://github.com/jdemeyer"
}
```

Reviewer: **Jeroen Demeyer**



---

archive/issue_comments_341392.json:
```json
{
    "body": "<div id=\"comment:4\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/48cd83bcd4fe14eafc0a208fff2566656b0a3a5b\">48cd83b</a></td><td><code>fix headers</code></td></tr></table>\n",
    "created_at": "2017-04-28T11:19:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22886#issuecomment-341392",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:4"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/48cd83bcd4fe14eafc0a208fff2566656b0a3a5b">48cd83b</a></td><td><code>fix headers</code></td></tr></table>




---

archive/issue_comments_341393.json:
```json
{
    "body": "Changed commit from **[cca8edf](https://github.com/sagemath/sagetrac-mirror/commit/cca8edfcb800a6535057c9547bb2b14b7ff6a8b5)** to **[48cd83b](https://github.com/sagemath/sagetrac-mirror/commit/48cd83bcd4fe14eafc0a208fff2566656b0a3a5b)**",
    "created_at": "2017-04-28T11:19:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22886#issuecomment-341393",
    "user": "https://github.com/jdemeyer"
}
```

Changed commit from **[cca8edf](https://github.com/sagemath/sagetrac-mirror/commit/cca8edfcb800a6535057c9547bb2b14b7ff6a8b5)** to **[48cd83b](https://github.com/sagemath/sagetrac-mirror/commit/48cd83bcd4fe14eafc0a208fff2566656b0a3a5b)**



---

archive/issue_events_319280.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-04-29T10:06:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22886",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22886#event-319280"
}
```



---

archive/issue_events_319281.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-04-29T10:06:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22886",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22886#event-319281"
}
```



---

archive/issue_comments_341394.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nOn OSX there is lots of breakage of the form:\n\n```\nsage -t --long src/sage/misc/inherit_comparison.pyx\n**********************************************************************\nFile \"src/sage/misc/inherit_comparison.pyx\", line 54, in sage.misc.inherit_comparison.InheritComparisonMetaclass\nFailed example:\n    cython('''\n    from sage.misc.inherit_comparison cimport InheritComparisonMetaclass\n    cdef class Base(object):\n        def __richcmp__(left, right, int op):\n            print(\"Calling Base.__richcmp__\")\n            return left is right\n    cdef class Derived(Base):\n        def __hash__(self):\n            return 1\n    cdef class DerivedWithRichcmp(Base):\n        def __getmetaclass__(_):\n            from sage.misc.inherit_comparison import InheritComparisonMetaclass\n            return InheritComparisonMetaclass\n        def __hash__(self):\n            return 1\n    ''')\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 509, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 872, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.misc.inherit_comparison.InheritComparisonMetaclass[0]>\", line 19, in <module>\n        ''')\n      File \"sage/misc/lazy_import.pyx\", line 389, in sage.misc.lazy_import.LazyImport.__call__ (/Users/buildslave-sage/slave/sage_git/build/src/build/cythonized/sage/misc/lazy_import.c:4016)\n        return self._get_object()(*args, **kwds)\n      File \"sage/misc/cython_c.pyx\", line 65, in sage.misc.cython_c.cython_compile (/Users/buildslave-sage/slave/sage_git/build/src/build/cythonized/sage/misc/cython_c.c:1192)\n        cython_import_all(tmpfile, get_globals(),\n      File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/misc/cython.py\", line 789, in cython_import_all\n        create_local_c_file=create_local_c_file)\n      File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/misc/cython.py\", line 766, in cython_import\n        **kwds)\n      File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/misc/cython.py\", line 554, in cython\n        raise RuntimeError(\"Error compiling {}:\\n{}\\n{}\".format(filename, log, err))\n    RuntimeError: Error compiling /Users/buildslave-sage/slave/sage_git/dot_sage/temp/osx/75462/tmp_S_2CnH.spyx:\n    running build\n    running build_ext\n    building '_Users_buildslave_sage_slave_sage_git_dot_sage_temp_osx_75462_tmp_S_2CnH_spyx_0' extension\n    creating build\n    creating build/temp.macosx-10.9-x86_64-2.7\n    gcc -fno-strict-aliasing -I/Users/buildslave-sage/slave/sage_git/build/local/var/tmp/sage/build/python2-2.7.13.p1/include -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -I/Users/buildslave-sage/slave/sage_git/build/local/include -I/Users/buildslave-sage/slave/sage_git/build/local/include/python2.7 -I/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/numpy/core/include -I/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages -I/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/ext -I/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/cysignals -I/Users/buildslave-sage/slave/sage_git/dot_sage/temp/osx/75462 -I/Users/buildslave-sage/slave/sage_git/build/local/include/python2.7 -c _Users_buildslave_sage_slave_sage_git_dot_sage_temp_osx_75462_tmp_S_2CnH_spyx_0.c -o build/temp.macosx-10.9-x86_64-2.7/_Users_buildslave_sage_slave_sage_git_dot_sage_temp_osx_75462_tmp_S_2CnH_spyx_0.o -w -O2\n    _Users_buildslave_sage_slave_sage_git_dot_sage_temp_osx_75462_tmp_S_2CnH_spyx_0.c:432:30: fatal error: cython_metaclass.h: No such file or directory\n    compilation terminated.\n    error: command 'gcc' failed with exit status 1\n```",
    "created_at": "2017-04-29T10:06:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22886#issuecomment-341394",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:5" align="right">comment:5</div>

On OSX there is lots of breakage of the form:

```
sage -t --long src/sage/misc/inherit_comparison.pyx
**********************************************************************
File "src/sage/misc/inherit_comparison.pyx", line 54, in sage.misc.inherit_comparison.InheritComparisonMetaclass
Failed example:
    cython('''
    from sage.misc.inherit_comparison cimport InheritComparisonMetaclass
    cdef class Base(object):
        def __richcmp__(left, right, int op):
            print("Calling Base.__richcmp__")
            return left is right
    cdef class Derived(Base):
        def __hash__(self):
            return 1
    cdef class DerivedWithRichcmp(Base):
        def __getmetaclass__(_):
            from sage.misc.inherit_comparison import InheritComparisonMetaclass
            return InheritComparisonMetaclass
        def __hash__(self):
            return 1
    ''')
Exception raised:
    Traceback (most recent call last):
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 509, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 872, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.misc.inherit_comparison.InheritComparisonMetaclass[0]>", line 19, in <module>
        ''')
      File "sage/misc/lazy_import.pyx", line 389, in sage.misc.lazy_import.LazyImport.__call__ (/Users/buildslave-sage/slave/sage_git/build/src/build/cythonized/sage/misc/lazy_import.c:4016)
        return self._get_object()(*args, **kwds)
      File "sage/misc/cython_c.pyx", line 65, in sage.misc.cython_c.cython_compile (/Users/buildslave-sage/slave/sage_git/build/src/build/cythonized/sage/misc/cython_c.c:1192)
        cython_import_all(tmpfile, get_globals(),
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/misc/cython.py", line 789, in cython_import_all
        create_local_c_file=create_local_c_file)
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/misc/cython.py", line 766, in cython_import
        **kwds)
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/misc/cython.py", line 554, in cython
        raise RuntimeError("Error compiling {}:\n{}\n{}".format(filename, log, err))
    RuntimeError: Error compiling /Users/buildslave-sage/slave/sage_git/dot_sage/temp/osx/75462/tmp_S_2CnH.spyx:
    running build
    running build_ext
    building '_Users_buildslave_sage_slave_sage_git_dot_sage_temp_osx_75462_tmp_S_2CnH_spyx_0' extension
    creating build
    creating build/temp.macosx-10.9-x86_64-2.7
    gcc -fno-strict-aliasing -I/Users/buildslave-sage/slave/sage_git/build/local/var/tmp/sage/build/python2-2.7.13.p1/include -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -I/Users/buildslave-sage/slave/sage_git/build/local/include -I/Users/buildslave-sage/slave/sage_git/build/local/include/python2.7 -I/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/numpy/core/include -I/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages -I/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/ext -I/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/cysignals -I/Users/buildslave-sage/slave/sage_git/dot_sage/temp/osx/75462 -I/Users/buildslave-sage/slave/sage_git/build/local/include/python2.7 -c _Users_buildslave_sage_slave_sage_git_dot_sage_temp_osx_75462_tmp_S_2CnH_spyx_0.c -o build/temp.macosx-10.9-x86_64-2.7/_Users_buildslave_sage_slave_sage_git_dot_sage_temp_osx_75462_tmp_S_2CnH_spyx_0.o -w -O2
    _Users_buildslave_sage_slave_sage_git_dot_sage_temp_osx_75462_tmp_S_2CnH_spyx_0.c:432:30: fatal error: cython_metaclass.h: No such file or directory
    compilation terminated.
    error: command 'gcc' failed with exit status 1
```



---

archive/issue_comments_341395.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nThe `gcc` command in your sample looks wrong. Are the errors only related to `cython_metaclass.h` or gcc just fails to find any of the header?",
    "created_at": "2017-04-29T10:11:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22886#issuecomment-341395",
    "user": "https://github.com/videlec"
}
```

<div id="comment:6" align="right">comment:6</div>

The `gcc` command in your sample looks wrong. Are the errors only related to `cython_metaclass.h` or gcc just fails to find any of the header?



---

archive/issue_comments_341396.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nI am seeing it too in sage-on-gentoo. The bulk seems to be `cython_metaclass.h` but it is not the only one\n\n```\nsage -t --long /usr/lib64/python2.7/site-packages/sage/libs/pynac/pynac.pxd\n**********************************************************************\nFile \"/usr/lib64/python2.7/site-packages/sage/libs/pynac/pynac.pxd\", line 10, in sage.libs.pynac.pynac\nFailed example:\n    cython(  # long time\n    '''\n    #clang c++\n    #clib pynac\n    #cargs --std=c++11\n    cimport sage.libs.pynac.pynac\n    ''')\nException raised:\n    Traceback (most recent call last):\n      File \"/usr/lib64/python2.7/site-packages/sage/doctest/forker.py\", line 512, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/usr/lib64/python2.7/site-packages/sage/doctest/forker.py\", line 875, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.libs.pynac.pynac[0]>\", line 7, in <module>\n        ''')\n      File \"sage/misc/lazy_import.pyx\", line 389, in sage.misc.lazy_import.LazyImport.__call__ (/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python2_7/build/cythonized/sage/misc/lazy_import.c:4016)\n        return self._get_object()(*args, **kwds)\n      File \"sage/misc/cython_c.pyx\", line 65, in sage.misc.cython_c.cython_compile (/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python2_7/build/cythonized/sage/misc/cython_c.c:1192)\n        cython_import_all(tmpfile, get_globals(),\n      File \"/usr/lib64/python2.7/site-packages/sage/misc/cython.py\", line 789, in cython_import_all\n        create_local_c_file=create_local_c_file)\n      File \"/usr/lib64/python2.7/site-packages/sage/misc/cython.py\", line 766, in cython_import\n        **kwds)\n      File \"/usr/lib64/python2.7/site-packages/sage/misc/cython.py\", line 554, in cython\n        raise RuntimeError(\"Error compiling {}:\\n{}\\n{}\".format(filename, log, err))\n    RuntimeError: Error compiling /home/fbissey/.sage/temp/moonloop/5134/tmp_2LMfAG.spyx:\n    running build\n    running build_ext\n    building '_home_fbissey__sage_temp_moonloop_5134_tmp_2LMfAG_spyx_0' extension\n    creating build\n    creating build/temp.linux-x86_64-2.7\n    x86_64-pc-linux-gnu-g++ -pthread -fPIC -I/usr/include -I/usr/include/python2.7 -I/usr/lib64/python2.7/site-packages/numpy/core/include -I/usr/lib64/python2.7/site-packages -I/usr/lib64/python2.7/site-packages/sage/ext -I/usr/lib64/python2.7/site-packages/cysignals -I/usr/lib64/python2.7/site-packages/cysignals -I/home/fbissey/.sage/temp/moonloop/5134 -I/usr/include/python2.7 -c _home_fbissey__sage_temp_moonloop_5134_tmp_2LMfAG_spyx_0.cpp -o build/temp.linux-x86_64-2.7/_home_fbissey__sage_temp_moonloop_5134_tmp_2LMfAG_spyx_0.o -w -O2 --std=c++11\n\n    _home_fbissey__sage_temp_moonloop_5134_tmp_2LMfAG_spyx_0.cpp:457:24: fatal error: pynac_wrap.h: No such file or directory\n    compilation terminated.\n    error: command 'x86_64-pc-linux-gnu-g++' failed with exit status 1\n```",
    "created_at": "2017-04-29T10:37:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22886#issuecomment-341396",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:7" align="right">comment:7</div>

I am seeing it too in sage-on-gentoo. The bulk seems to be `cython_metaclass.h` but it is not the only one

```
sage -t --long /usr/lib64/python2.7/site-packages/sage/libs/pynac/pynac.pxd
**********************************************************************
File "/usr/lib64/python2.7/site-packages/sage/libs/pynac/pynac.pxd", line 10, in sage.libs.pynac.pynac
Failed example:
    cython(  # long time
    '''
    #clang c++
    #clib pynac
    #cargs --std=c++11
    cimport sage.libs.pynac.pynac
    ''')
Exception raised:
    Traceback (most recent call last):
      File "/usr/lib64/python2.7/site-packages/sage/doctest/forker.py", line 512, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/lib64/python2.7/site-packages/sage/doctest/forker.py", line 875, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.libs.pynac.pynac[0]>", line 7, in <module>
        ''')
      File "sage/misc/lazy_import.pyx", line 389, in sage.misc.lazy_import.LazyImport.__call__ (/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python2_7/build/cythonized/sage/misc/lazy_import.c:4016)
        return self._get_object()(*args, **kwds)
      File "sage/misc/cython_c.pyx", line 65, in sage.misc.cython_c.cython_compile (/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python2_7/build/cythonized/sage/misc/cython_c.c:1192)
        cython_import_all(tmpfile, get_globals(),
      File "/usr/lib64/python2.7/site-packages/sage/misc/cython.py", line 789, in cython_import_all
        create_local_c_file=create_local_c_file)
      File "/usr/lib64/python2.7/site-packages/sage/misc/cython.py", line 766, in cython_import
        **kwds)
      File "/usr/lib64/python2.7/site-packages/sage/misc/cython.py", line 554, in cython
        raise RuntimeError("Error compiling {}:\n{}\n{}".format(filename, log, err))
    RuntimeError: Error compiling /home/fbissey/.sage/temp/moonloop/5134/tmp_2LMfAG.spyx:
    running build
    running build_ext
    building '_home_fbissey__sage_temp_moonloop_5134_tmp_2LMfAG_spyx_0' extension
    creating build
    creating build/temp.linux-x86_64-2.7
    x86_64-pc-linux-gnu-g++ -pthread -fPIC -I/usr/include -I/usr/include/python2.7 -I/usr/lib64/python2.7/site-packages/numpy/core/include -I/usr/lib64/python2.7/site-packages -I/usr/lib64/python2.7/site-packages/sage/ext -I/usr/lib64/python2.7/site-packages/cysignals -I/usr/lib64/python2.7/site-packages/cysignals -I/home/fbissey/.sage/temp/moonloop/5134 -I/usr/include/python2.7 -c _home_fbissey__sage_temp_moonloop_5134_tmp_2LMfAG_spyx_0.cpp -o build/temp.linux-x86_64-2.7/_home_fbissey__sage_temp_moonloop_5134_tmp_2LMfAG_spyx_0.o -w -O2 --std=c++11

    _home_fbissey__sage_temp_moonloop_5134_tmp_2LMfAG_spyx_0.cpp:457:24: fatal error: pynac_wrap.h: No such file or directory
    compilation terminated.
    error: command 'x86_64-pc-linux-gnu-g++' failed with exit status 1
```



---

archive/issue_comments_341397.json:
```json
{
    "body": "Dependencies: **#22461**",
    "created_at": "2017-04-29T10:40:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22886#issuecomment-341397",
    "user": "https://github.com/jdemeyer"
}
```

Dependencies: **#22461**



---

archive/issue_comments_341398.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nAh, I see. This is essentially yet another problem caused by #22461",
    "created_at": "2017-04-29T10:40:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22886#issuecomment-341398",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:8" align="right">comment:8</div>

Ah, I see. This is essentially yet another problem caused by #22461



---

archive/issue_comments_341399.json:
```json
{
    "body": "<div id=\"comment:9\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a62de8477a9905969211d52febba6fd2b94117a9\">a62de84</a></td><td><code>Move module_list aliases to env.py</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7a04c1cf037f6a1c398db2ba93b193f5c4313b33\">7a04c1c</a></td><td><code>Import pkgconfig only when needed</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f06d3b365a6927e4fd0b4d0d8bf67299ee13e2d1\">f06d3b3</a></td><td><code>Merge tag '8.1.beta5' into t/23799/ticket/23799</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4bd969374c03571089426628c100640739ee31bb\">4bd9693</a></td><td><code>Merge commit 'f06d3b365a6927e4fd0b4d0d8bf67299ee13e2d1' into t/22886/22886</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4766e9bceb6bbd4f867f1225e16d5fa81f8334e9\">4766e9b</a></td><td><code>Implement cython() using cythonize()</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cdbea87b23f5cca49c6a840e73e69d2ce6f06c29\">cdbea87</a></td><td><code>Merge commit '4766e9bceb6bbd4f867f1225e16d5fa81f8334e9' into t/22886/22886</code></td></tr></table>\n",
    "created_at": "2017-09-15T11:40:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22886#issuecomment-341399",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:9"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a62de8477a9905969211d52febba6fd2b94117a9">a62de84</a></td><td><code>Move module_list aliases to env.py</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7a04c1cf037f6a1c398db2ba93b193f5c4313b33">7a04c1c</a></td><td><code>Import pkgconfig only when needed</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f06d3b365a6927e4fd0b4d0d8bf67299ee13e2d1">f06d3b3</a></td><td><code>Merge tag '8.1.beta5' into t/23799/ticket/23799</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4bd969374c03571089426628c100640739ee31bb">4bd9693</a></td><td><code>Merge commit 'f06d3b365a6927e4fd0b4d0d8bf67299ee13e2d1' into t/22886/22886</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4766e9bceb6bbd4f867f1225e16d5fa81f8334e9">4766e9b</a></td><td><code>Implement cython() using cythonize()</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cdbea87b23f5cca49c6a840e73e69d2ce6f06c29">cdbea87</a></td><td><code>Merge commit '4766e9bceb6bbd4f867f1225e16d5fa81f8334e9' into t/22886/22886</code></td></tr></table>




---

archive/issue_comments_341400.json:
```json
{
    "body": "Changed commit from **[48cd83b](https://github.com/sagemath/sagetrac-mirror/commit/48cd83bcd4fe14eafc0a208fff2566656b0a3a5b)** to **[cdbea87](https://github.com/sagemath/sagetrac-mirror/commit/cdbea87b23f5cca49c6a840e73e69d2ce6f06c29)**",
    "created_at": "2017-09-15T11:40:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22886#issuecomment-341400",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[48cd83b](https://github.com/sagemath/sagetrac-mirror/commit/48cd83bcd4fe14eafc0a208fff2566656b0a3a5b)** to **[cdbea87](https://github.com/sagemath/sagetrac-mirror/commit/cdbea87b23f5cca49c6a840e73e69d2ce6f06c29)**



---

archive/issue_comments_341401.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nMerged in the dependencies.",
    "created_at": "2017-09-15T11:40:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22886#issuecomment-341401",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:10" align="right">comment:10</div>

Merged in the dependencies.



---

archive/issue_comments_341402.json:
```json
{
    "body": "<div id=\"comment:11\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6700ab33f3844190f9dcfc323492b65188796d85\">6700ab3</a></td><td><code>Fix cython_metaclass header</code></td></tr></table>\n",
    "created_at": "2017-09-15T11:46:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22886#issuecomment-341402",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:11"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6700ab33f3844190f9dcfc323492b65188796d85">6700ab3</a></td><td><code>Fix cython_metaclass header</code></td></tr></table>




---

archive/issue_comments_341403.json:
```json
{
    "body": "Changed commit from **[cdbea87](https://github.com/sagemath/sagetrac-mirror/commit/cdbea87b23f5cca49c6a840e73e69d2ce6f06c29)** to **[6700ab3](https://github.com/sagemath/sagetrac-mirror/commit/6700ab33f3844190f9dcfc323492b65188796d85)**",
    "created_at": "2017-09-15T11:46:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22886#issuecomment-341403",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[cdbea87](https://github.com/sagemath/sagetrac-mirror/commit/cdbea87b23f5cca49c6a840e73e69d2ce6f06c29)** to **[6700ab3](https://github.com/sagemath/sagetrac-mirror/commit/6700ab33f3844190f9dcfc323492b65188796d85)**



---

archive/issue_comments_341404.json:
```json
{
    "body": "Changed dependencies from **#22461** to **#23799, #22461**",
    "created_at": "2017-09-15T11:47:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22886#issuecomment-341404",
    "user": "https://github.com/jdemeyer"
}
```

Changed dependencies from **#22461** to **#23799, #22461**



---

archive/issue_events_319282.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-09-15T11:47:55Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22886",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22886#event-319282"
}
```



---

archive/issue_events_319283.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-09-15T11:47:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22886",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22886#event-319283"
}
```



---

archive/issue_comments_341405.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nGiven that I gave this ticket positive_review earlier, this should be set back to positive_review (modulo the dependencies of course) if tests pass.",
    "created_at": "2017-09-15T11:48:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22886#issuecomment-341405",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:13" align="right">comment:13</div>

Given that I gave this ticket positive_review earlier, this should be set back to positive_review (modulo the dependencies of course) if tests pass.



---

archive/issue_events_319284.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-09-15T12:15:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22886",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22886#event-319284"
}
```



---

archive/issue_events_319285.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-09-15T12:15:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22886",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22886#event-319285"
}
```



---

archive/issue_comments_341406.json:
```json
{
    "body": "Changed branch from **[u/jdemeyer/22886](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/22886)** to **[6700ab3](https://github.com/sagemath/sagetrac-mirror/commit/6700ab33f3844190f9dcfc323492b65188796d85)**",
    "created_at": "2017-10-05T06:54:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22886#issuecomment-341406",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/jdemeyer/22886](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/22886)** to **[6700ab3](https://github.com/sagemath/sagetrac-mirror/commit/6700ab33f3844190f9dcfc323492b65188796d85)**



---

archive/issue_events_319286.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-10-05T06:54:15Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22886",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22886#event-319286"
}
```



---

archive/issue_events_319287.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "b0c0f6749adaea5dce8210d4d09844cffc568f17",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2017-10-05T06:54:15Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/22886",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22886#event-319287"
}
```
