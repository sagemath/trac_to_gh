# Issue 22886: fix pxd header files

archive/issues_022649.json:
```json
{
    "body": "If we try to compile some external Cython code that links against some Sage Cython code the compiler is not able to find some of the headers. Thanks to our patched version of Cython, tiny modifications of the include solve the issue.\n\n**CC:**  @jdemeyer\n\n**Branch/Commit:** [6700ab33f3844190f9dcfc323492b65188796d85](https://github.com/sagemath/sagetrac-mirror/commit/6700ab33f3844190f9dcfc323492b65188796d85)\n\n**Reviewer:** Jeroen Demeyer\n\n**Author:** Vincent Delecroix\n\n**Dependencies:** #23799, #22461\n\n**Resolution:** fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/22886\n\n",
    "closed_at": "2017-10-05T06:54:15Z",
    "created_at": "2017-04-27T13:41:30Z",
    "labels": [
        "component: misc"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.0",
    "title": "fix pxd header files",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22886",
    "user": "https://github.com/videlec"
}
```
If we try to compile some external Cython code that links against some Sage Cython code the compiler is not able to find some of the headers. Thanks to our patched version of Cython, tiny modifications of the include solve the issue.

**CC:**  @jdemeyer

**Branch/Commit:** [6700ab33f3844190f9dcfc323492b65188796d85](https://github.com/sagemath/sagetrac-mirror/commit/6700ab33f3844190f9dcfc323492b65188796d85)

**Reviewer:** Jeroen Demeyer

**Author:** Vincent Delecroix

**Dependencies:** #23799, #22461

**Resolution:** fixed

Issue created by migration from https://trac.sagemath.org/ticket/22886





---

archive/issue_comments_430071.json:
```json
{
    "body": "<a id='comment:1'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/41dc83f8bfd6abe1609140ba89031440cb4509a5\">41dc83f</a></td><td><code>fix headers</code></td></tr></table>\n",
    "created_at": "2017-04-27T13:42:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22886#issuecomment-430071",
    "user": "https://github.com/videlec"
}
```

<a id='comment:1'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/41dc83f8bfd6abe1609140ba89031440cb4509a5">41dc83f</a></td><td><code>fix headers</code></td></tr></table>




---

archive/issue_comments_430072.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2017-04-27T13:42:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22886#issuecomment-430072",
    "user": "https://github.com/videlec"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_430073.json:
```json
{
    "body": "**Commit:** [41dc83f8bfd6abe1609140ba89031440cb4509a5](https://github.com/sagemath/sagetrac-mirror/commit/41dc83f8bfd6abe1609140ba89031440cb4509a5)",
    "created_at": "2017-04-27T13:42:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22886#issuecomment-430073",
    "user": "https://github.com/videlec"
}
```

**Commit:** [41dc83f8bfd6abe1609140ba89031440cb4509a5](https://github.com/sagemath/sagetrac-mirror/commit/41dc83f8bfd6abe1609140ba89031440cb4509a5)



---

archive/issue_comments_430074.json:
```json
{
    "body": "**Branch:** [u/vdelecroix/22886](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/22886)",
    "created_at": "2017-04-27T13:42:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22886#issuecomment-430074",
    "user": "https://github.com/videlec"
}
```

**Branch:** [u/vdelecroix/22886](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/22886)



---

archive/issue_comments_430075.json:
```json
{
    "body": "**Changing commit** from \"[41dc83f8bfd6abe1609140ba89031440cb4509a5](https://github.com/sagemath/sagetrac-mirror/commit/41dc83f8bfd6abe1609140ba89031440cb4509a5)\" to \"[cca8edfcb800a6535057c9547bb2b14b7ff6a8b5](https://github.com/sagemath/sagetrac-mirror/commit/cca8edfcb800a6535057c9547bb2b14b7ff6a8b5)\".",
    "created_at": "2017-04-27T13:44:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22886#issuecomment-430075",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[41dc83f8bfd6abe1609140ba89031440cb4509a5](https://github.com/sagemath/sagetrac-mirror/commit/41dc83f8bfd6abe1609140ba89031440cb4509a5)" to "[cca8edfcb800a6535057c9547bb2b14b7ff6a8b5](https://github.com/sagemath/sagetrac-mirror/commit/cca8edfcb800a6535057c9547bb2b14b7ff6a8b5)".



---

archive/issue_comments_430076.json:
```json
{
    "body": "<a id='comment:2'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cca8edfcb800a6535057c9547bb2b14b7ff6a8b5\">cca8edf</a></td><td><code>fix headers</code></td></tr></table>\n",
    "created_at": "2017-04-27T13:44:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22886#issuecomment-430076",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cca8edfcb800a6535057c9547bb2b14b7ff6a8b5">cca8edf</a></td><td><code>fix headers</code></td></tr></table>




---

archive/issue_comments_430077.json:
```json
{
    "body": "**Changing branch** from \"[u/vdelecroix/22886](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/22886)\" to \"[u/jdemeyer/22886](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/22886)\".",
    "created_at": "2017-04-28T09:56:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22886#issuecomment-430077",
    "user": "https://github.com/jdemeyer"
}
```

**Changing branch** from "[u/vdelecroix/22886](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/22886)" to "[u/jdemeyer/22886](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/22886)".



---

archive/issue_comments_430078.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2017-04-28T11:19:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22886#issuecomment-430078",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_430079.json:
```json
{
    "body": "**Reviewer:** Jeroen Demeyer",
    "created_at": "2017-04-28T11:19:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22886#issuecomment-430079",
    "user": "https://github.com/jdemeyer"
}
```

**Reviewer:** Jeroen Demeyer



---

archive/issue_comments_430080.json:
```json
{
    "body": "<a id='comment:4'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/48cd83bcd4fe14eafc0a208fff2566656b0a3a5b\">48cd83b</a></td><td><code>fix headers</code></td></tr></table>\n",
    "created_at": "2017-04-28T11:19:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22886#issuecomment-430080",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:4'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/48cd83bcd4fe14eafc0a208fff2566656b0a3a5b">48cd83b</a></td><td><code>fix headers</code></td></tr></table>




---

archive/issue_comments_430081.json:
```json
{
    "body": "**Changing commit** from \"[cca8edfcb800a6535057c9547bb2b14b7ff6a8b5](https://github.com/sagemath/sagetrac-mirror/commit/cca8edfcb800a6535057c9547bb2b14b7ff6a8b5)\" to \"[48cd83bcd4fe14eafc0a208fff2566656b0a3a5b](https://github.com/sagemath/sagetrac-mirror/commit/48cd83bcd4fe14eafc0a208fff2566656b0a3a5b)\".",
    "created_at": "2017-04-28T11:19:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22886#issuecomment-430081",
    "user": "https://github.com/jdemeyer"
}
```

**Changing commit** from "[cca8edfcb800a6535057c9547bb2b14b7ff6a8b5](https://github.com/sagemath/sagetrac-mirror/commit/cca8edfcb800a6535057c9547bb2b14b7ff6a8b5)" to "[48cd83bcd4fe14eafc0a208fff2566656b0a3a5b](https://github.com/sagemath/sagetrac-mirror/commit/48cd83bcd4fe14eafc0a208fff2566656b0a3a5b)".



---

archive/issue_comments_430082.json:
```json
{
    "body": "**Changing status** from positive_review to needs_work.",
    "created_at": "2017-04-29T10:06:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22886#issuecomment-430082",
    "user": "https://github.com/vbraun"
}
```

**Changing status** from positive_review to needs_work.



---

archive/issue_comments_430083.json:
```json
{
    "body": "<a id='comment:5'></a>\nOn OSX there is lots of breakage of the form:\n\n```\nsage -t --long src/sage/misc/inherit_comparison.pyx\n**********************************************************************\nFile \"src/sage/misc/inherit_comparison.pyx\", line 54, in sage.misc.inherit_comparison.InheritComparisonMetaclass\nFailed example:\n    cython('''\n    from sage.misc.inherit_comparison cimport InheritComparisonMetaclass\n    cdef class Base(object):\n        def `__richcmp__`(left, right, int op):\n            print(\"Calling Base.__richcmp__\")\n            return left is right\n    cdef class Derived(Base):\n        def `__hash__`(self):\n            return 1\n    cdef class DerivedWithRichcmp(Base):\n        def `__getmetaclass__`(_):\n            from sage.misc.inherit_comparison import InheritComparisonMetaclass\n            return InheritComparisonMetaclass\n        def `__hash__`(self):\n            return 1\n    ''')\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 509, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 872, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.misc.inherit_comparison.InheritComparisonMetaclass[0]>\", line 19, in <module>\n        ''')\n      File \"sage/misc/lazy_import.pyx\", line 389, in sage.misc.lazy_import.LazyImport.__call__ (/Users/buildslave-sage/slave/sage_git/build/src/build/cythonized/sage/misc/lazy_import.c:4016)\n        return self._get_object()(*args, **kwds)\n      File \"sage/misc/cython_c.pyx\", line 65, in sage.misc.cython_c.cython_compile (/Users/buildslave-sage/slave/sage_git/build/src/build/cythonized/sage/misc/cython_c.c:1192)\n        cython_import_all(tmpfile, get_globals(),\n      File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/misc/cython.py\", line 789, in cython_import_all\n        create_local_c_file=create_local_c_file)\n      File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/misc/cython.py\", line 766, in cython_import\n        **kwds)\n      File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/misc/cython.py\", line 554, in cython\n        raise RuntimeError(\"Error compiling {}:\\n{}\\n{}\".format(filename, log, err))\n    RuntimeError: Error compiling /Users/buildslave-sage/slave/sage_git/dot_sage/temp/osx/75462/tmp_S_2CnH.spyx:\n    running build\n    running build_ext\n    building '_Users_buildslave_sage_slave_sage_git_dot_sage_temp_osx_75462_tmp_S_2CnH_spyx_0' extension\n    creating build\n    creating build/temp.macosx-10.9-x86_64-2.7\n    gcc -fno-strict-aliasing -I/Users/buildslave-sage/slave/sage_git/build/local/var/tmp/sage/build/python2-2.7.13.p1/include -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -I/Users/buildslave-sage/slave/sage_git/build/local/include -I/Users/buildslave-sage/slave/sage_git/build/local/include/python2.7 -I/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/numpy/core/include -I/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages -I/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/ext -I/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/cysignals -I/Users/buildslave-sage/slave/sage_git/dot_sage/temp/osx/75462 -I/Users/buildslave-sage/slave/sage_git/build/local/include/python2.7 -c `_Users_buildslave_sage_slave_sage_git_dot_sage_temp_osx_`75462_tmp_S_2CnH_spyx_0.c -o build/temp.macosx-10.9-x86_64-2.7/_Users_buildslave_sage_slave_sage_git_dot_sage_temp_osx_75462_tmp_S_2CnH_spyx_0.o -w -O2\n    `_Users_buildslave_sage_slave_sage_git_dot_sage_temp_osx_`75462_tmp_S_2CnH_spyx_0.c:432:30: fatal error: cython_metaclass.h: No such file or directory\n    compilation terminated.\n    error: command 'gcc' failed with exit status 1\n```",
    "created_at": "2017-04-29T10:06:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22886#issuecomment-430083",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:5'></a>
On OSX there is lots of breakage of the form:

```
sage -t --long src/sage/misc/inherit_comparison.pyx
**********************************************************************
File "src/sage/misc/inherit_comparison.pyx", line 54, in sage.misc.inherit_comparison.InheritComparisonMetaclass
Failed example:
    cython('''
    from sage.misc.inherit_comparison cimport InheritComparisonMetaclass
    cdef class Base(object):
        def `__richcmp__`(left, right, int op):
            print("Calling Base.__richcmp__")
            return left is right
    cdef class Derived(Base):
        def `__hash__`(self):
            return 1
    cdef class DerivedWithRichcmp(Base):
        def `__getmetaclass__`(_):
            from sage.misc.inherit_comparison import InheritComparisonMetaclass
            return InheritComparisonMetaclass
        def `__hash__`(self):
            return 1
    ''')
Exception raised:
    Traceback (most recent call last):
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 509, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 872, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.misc.inherit_comparison.InheritComparisonMetaclass[0]>", line 19, in <module>
        ''')
      File "sage/misc/lazy_import.pyx", line 389, in sage.misc.lazy_import.LazyImport.__call__ (/Users/buildslave-sage/slave/sage_git/build/src/build/cythonized/sage/misc/lazy_import.c:4016)
        return self._get_object()(*args, **kwds)
      File "sage/misc/cython_c.pyx", line 65, in sage.misc.cython_c.cython_compile (/Users/buildslave-sage/slave/sage_git/build/src/build/cythonized/sage/misc/cython_c.c:1192)
        cython_import_all(tmpfile, get_globals(),
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/misc/cython.py", line 789, in cython_import_all
        create_local_c_file=create_local_c_file)
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/misc/cython.py", line 766, in cython_import
        **kwds)
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/misc/cython.py", line 554, in cython
        raise RuntimeError("Error compiling {}:\n{}\n{}".format(filename, log, err))
    RuntimeError: Error compiling /Users/buildslave-sage/slave/sage_git/dot_sage/temp/osx/75462/tmp_S_2CnH.spyx:
    running build
    running build_ext
    building '_Users_buildslave_sage_slave_sage_git_dot_sage_temp_osx_75462_tmp_S_2CnH_spyx_0' extension
    creating build
    creating build/temp.macosx-10.9-x86_64-2.7
    gcc -fno-strict-aliasing -I/Users/buildslave-sage/slave/sage_git/build/local/var/tmp/sage/build/python2-2.7.13.p1/include -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -I/Users/buildslave-sage/slave/sage_git/build/local/include -I/Users/buildslave-sage/slave/sage_git/build/local/include/python2.7 -I/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/numpy/core/include -I/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages -I/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/ext -I/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/cysignals -I/Users/buildslave-sage/slave/sage_git/dot_sage/temp/osx/75462 -I/Users/buildslave-sage/slave/sage_git/build/local/include/python2.7 -c `_Users_buildslave_sage_slave_sage_git_dot_sage_temp_osx_`75462_tmp_S_2CnH_spyx_0.c -o build/temp.macosx-10.9-x86_64-2.7/_Users_buildslave_sage_slave_sage_git_dot_sage_temp_osx_75462_tmp_S_2CnH_spyx_0.o -w -O2
    `_Users_buildslave_sage_slave_sage_git_dot_sage_temp_osx_`75462_tmp_S_2CnH_spyx_0.c:432:30: fatal error: cython_metaclass.h: No such file or directory
    compilation terminated.
    error: command 'gcc' failed with exit status 1
```



---

archive/issue_comments_430084.json:
```json
{
    "body": "<a id='comment:6'></a>\nThe `gcc` command in your sample looks wrong. Are the errors only related to `cython_metaclass.h` or gcc just fails to find any of the header?",
    "created_at": "2017-04-29T10:11:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22886#issuecomment-430084",
    "user": "https://github.com/videlec"
}
```

<a id='comment:6'></a>
The `gcc` command in your sample looks wrong. Are the errors only related to `cython_metaclass.h` or gcc just fails to find any of the header?



---

archive/issue_comments_430085.json:
```json
{
    "body": "<a id='comment:7'></a>\nI am seeing it too in sage-on-gentoo. The bulk seems to be `cython_metaclass.h` but it is not the only one\n\n```\nsage -t --long /usr/lib64/python2.7/site-packages/sage/libs/pynac/pynac.pxd\n**********************************************************************\nFile \"/usr/lib64/python2.7/site-packages/sage/libs/pynac/pynac.pxd\", line 10, in sage.libs.pynac.pynac\nFailed example:\n    cython(  # long time\n    '''\n    #clang c++\n    #clib pynac\n    #cargs --std=c++11\n    cimport sage.libs.pynac.pynac\n    ''')\nException raised:\n    Traceback (most recent call last):\n      File \"/usr/lib64/python2.7/site-packages/sage/doctest/forker.py\", line 512, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/usr/lib64/python2.7/site-packages/sage/doctest/forker.py\", line 875, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.libs.pynac.pynac[0]>\", line 7, in <module>\n        ''')\n      File \"sage/misc/lazy_import.pyx\", line 389, in sage.misc.lazy_import.LazyImport.__call__ (/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python2_7/build/cythonized/sage/misc/lazy_import.c:4016)\n        return self._get_object()(*args, **kwds)\n      File \"sage/misc/cython_c.pyx\", line 65, in sage.misc.cython_c.cython_compile (/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python2_7/build/cythonized/sage/misc/cython_c.c:1192)\n        cython_import_all(tmpfile, get_globals(),\n      File \"/usr/lib64/python2.7/site-packages/sage/misc/cython.py\", line 789, in cython_import_all\n        create_local_c_file=create_local_c_file)\n      File \"/usr/lib64/python2.7/site-packages/sage/misc/cython.py\", line 766, in cython_import\n        **kwds)\n      File \"/usr/lib64/python2.7/site-packages/sage/misc/cython.py\", line 554, in cython\n        raise RuntimeError(\"Error compiling {}:\\n{}\\n{}\".format(filename, log, err))\n    RuntimeError: Error compiling /home/fbissey/.sage/temp/moonloop/5134/tmp_2LMfAG.spyx:\n    running build\n    running build_ext\n    building '_home_fbissey__sage_temp_moonloop_5134_tmp_2LMfAG_spyx_0' extension\n    creating build\n    creating build/temp.linux-x86_64-2.7\n    x86_64-pc-linux-gnu-g++ -pthread -fPIC -I/usr/include -I/usr/include/python2.7 -I/usr/lib64/python2.7/site-packages/numpy/core/include -I/usr/lib64/python2.7/site-packages -I/usr/lib64/python2.7/site-packages/sage/ext -I/usr/lib64/python2.7/site-packages/cysignals -I/usr/lib64/python2.7/site-packages/cysignals -I/home/fbissey/.sage/temp/moonloop/5134 -I/usr/include/python2.7 -c `_home_fbissey__sage_temp_moonloop_`5134_tmp_2LMfAG_spyx_0.cpp -o build/temp.linux-x86_64-2.7/_home_fbissey__sage_temp_moonloop_5134_tmp_2LMfAG_spyx_0.o -w -O2 --std=c++11\n\n    `_home_fbissey__sage_temp_moonloop_`5134_tmp_2LMfAG_spyx_0.cpp:457:24: fatal error: pynac_wrap.h: No such file or directory\n    compilation terminated.\n    error: command 'x86_64-pc-linux-gnu-g++' failed with exit status 1\n```",
    "created_at": "2017-04-29T10:37:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22886#issuecomment-430085",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:7'></a>
I am seeing it too in sage-on-gentoo. The bulk seems to be `cython_metaclass.h` but it is not the only one

```
sage -t --long /usr/lib64/python2.7/site-packages/sage/libs/pynac/pynac.pxd
**********************************************************************
File "/usr/lib64/python2.7/site-packages/sage/libs/pynac/pynac.pxd", line 10, in sage.libs.pynac.pynac
Failed example:
    cython(  # long time
    '''
    #clang c++
    #clib pynac
    #cargs --std=c++11
    cimport sage.libs.pynac.pynac
    ''')
Exception raised:
    Traceback (most recent call last):
      File "/usr/lib64/python2.7/site-packages/sage/doctest/forker.py", line 512, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/lib64/python2.7/site-packages/sage/doctest/forker.py", line 875, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.libs.pynac.pynac[0]>", line 7, in <module>
        ''')
      File "sage/misc/lazy_import.pyx", line 389, in sage.misc.lazy_import.LazyImport.__call__ (/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python2_7/build/cythonized/sage/misc/lazy_import.c:4016)
        return self._get_object()(*args, **kwds)
      File "sage/misc/cython_c.pyx", line 65, in sage.misc.cython_c.cython_compile (/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python2_7/build/cythonized/sage/misc/cython_c.c:1192)
        cython_import_all(tmpfile, get_globals(),
      File "/usr/lib64/python2.7/site-packages/sage/misc/cython.py", line 789, in cython_import_all
        create_local_c_file=create_local_c_file)
      File "/usr/lib64/python2.7/site-packages/sage/misc/cython.py", line 766, in cython_import
        **kwds)
      File "/usr/lib64/python2.7/site-packages/sage/misc/cython.py", line 554, in cython
        raise RuntimeError("Error compiling {}:\n{}\n{}".format(filename, log, err))
    RuntimeError: Error compiling /home/fbissey/.sage/temp/moonloop/5134/tmp_2LMfAG.spyx:
    running build
    running build_ext
    building '_home_fbissey__sage_temp_moonloop_5134_tmp_2LMfAG_spyx_0' extension
    creating build
    creating build/temp.linux-x86_64-2.7
    x86_64-pc-linux-gnu-g++ -pthread -fPIC -I/usr/include -I/usr/include/python2.7 -I/usr/lib64/python2.7/site-packages/numpy/core/include -I/usr/lib64/python2.7/site-packages -I/usr/lib64/python2.7/site-packages/sage/ext -I/usr/lib64/python2.7/site-packages/cysignals -I/usr/lib64/python2.7/site-packages/cysignals -I/home/fbissey/.sage/temp/moonloop/5134 -I/usr/include/python2.7 -c `_home_fbissey__sage_temp_moonloop_`5134_tmp_2LMfAG_spyx_0.cpp -o build/temp.linux-x86_64-2.7/_home_fbissey__sage_temp_moonloop_5134_tmp_2LMfAG_spyx_0.o -w -O2 --std=c++11

    `_home_fbissey__sage_temp_moonloop_`5134_tmp_2LMfAG_spyx_0.cpp:457:24: fatal error: pynac_wrap.h: No such file or directory
    compilation terminated.
    error: command 'x86_64-pc-linux-gnu-g++' failed with exit status 1
```



---

archive/issue_comments_430086.json:
```json
{
    "body": "**Dependencies:** #22461",
    "created_at": "2017-04-29T10:40:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22886#issuecomment-430086",
    "user": "https://github.com/jdemeyer"
}
```

**Dependencies:** #22461



---

archive/issue_comments_430087.json:
```json
{
    "body": "<a id='comment:8'></a>\nAh, I see. This is essentially yet another problem caused by #22461",
    "created_at": "2017-04-29T10:40:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22886#issuecomment-430087",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'></a>
Ah, I see. This is essentially yet another problem caused by #22461



---

archive/issue_comments_430088.json:
```json
{
    "body": "<a id='comment:9'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a62de8477a9905969211d52febba6fd2b94117a9\">a62de84</a></td><td><code>Move module_list aliases to env.py</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7a04c1cf037f6a1c398db2ba93b193f5c4313b33\">7a04c1c</a></td><td><code>Import pkgconfig only when needed</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f06d3b365a6927e4fd0b4d0d8bf67299ee13e2d1\">f06d3b3</a></td><td><code>Merge tag '8.1.beta5' into t/23799/ticket/23799</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4bd969374c03571089426628c100640739ee31bb\">4bd9693</a></td><td><code>Merge commit 'f06d3b365a6927e4fd0b4d0d8bf67299ee13e2d1' into t/22886/22886</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4766e9bceb6bbd4f867f1225e16d5fa81f8334e9\">4766e9b</a></td><td><code>Implement cython() using cythonize()</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cdbea87b23f5cca49c6a840e73e69d2ce6f06c29\">cdbea87</a></td><td><code>Merge commit '4766e9bceb6bbd4f867f1225e16d5fa81f8334e9' into t/22886/22886</code></td></tr></table>\n",
    "created_at": "2017-09-15T11:40:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22886#issuecomment-430088",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a62de8477a9905969211d52febba6fd2b94117a9">a62de84</a></td><td><code>Move module_list aliases to env.py</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7a04c1cf037f6a1c398db2ba93b193f5c4313b33">7a04c1c</a></td><td><code>Import pkgconfig only when needed</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f06d3b365a6927e4fd0b4d0d8bf67299ee13e2d1">f06d3b3</a></td><td><code>Merge tag '8.1.beta5' into t/23799/ticket/23799</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4bd969374c03571089426628c100640739ee31bb">4bd9693</a></td><td><code>Merge commit 'f06d3b365a6927e4fd0b4d0d8bf67299ee13e2d1' into t/22886/22886</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4766e9bceb6bbd4f867f1225e16d5fa81f8334e9">4766e9b</a></td><td><code>Implement cython() using cythonize()</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cdbea87b23f5cca49c6a840e73e69d2ce6f06c29">cdbea87</a></td><td><code>Merge commit '4766e9bceb6bbd4f867f1225e16d5fa81f8334e9' into t/22886/22886</code></td></tr></table>




---

archive/issue_comments_430089.json:
```json
{
    "body": "**Changing commit** from \"[48cd83bcd4fe14eafc0a208fff2566656b0a3a5b](https://github.com/sagemath/sagetrac-mirror/commit/48cd83bcd4fe14eafc0a208fff2566656b0a3a5b)\" to \"[cdbea87b23f5cca49c6a840e73e69d2ce6f06c29](https://github.com/sagemath/sagetrac-mirror/commit/cdbea87b23f5cca49c6a840e73e69d2ce6f06c29)\".",
    "created_at": "2017-09-15T11:40:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22886#issuecomment-430089",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[48cd83bcd4fe14eafc0a208fff2566656b0a3a5b](https://github.com/sagemath/sagetrac-mirror/commit/48cd83bcd4fe14eafc0a208fff2566656b0a3a5b)" to "[cdbea87b23f5cca49c6a840e73e69d2ce6f06c29](https://github.com/sagemath/sagetrac-mirror/commit/cdbea87b23f5cca49c6a840e73e69d2ce6f06c29)".



---

archive/issue_comments_430090.json:
```json
{
    "body": "<a id='comment:10'></a>\nMerged in the dependencies.",
    "created_at": "2017-09-15T11:40:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22886#issuecomment-430090",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:10'></a>
Merged in the dependencies.



---

archive/issue_comments_430091.json:
```json
{
    "body": "<a id='comment:11'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6700ab33f3844190f9dcfc323492b65188796d85\">6700ab3</a></td><td><code>Fix cython_metaclass header</code></td></tr></table>\n",
    "created_at": "2017-09-15T11:46:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22886#issuecomment-430091",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6700ab33f3844190f9dcfc323492b65188796d85">6700ab3</a></td><td><code>Fix cython_metaclass header</code></td></tr></table>




---

archive/issue_comments_430092.json:
```json
{
    "body": "**Changing commit** from \"[cdbea87b23f5cca49c6a840e73e69d2ce6f06c29](https://github.com/sagemath/sagetrac-mirror/commit/cdbea87b23f5cca49c6a840e73e69d2ce6f06c29)\" to \"[6700ab33f3844190f9dcfc323492b65188796d85](https://github.com/sagemath/sagetrac-mirror/commit/6700ab33f3844190f9dcfc323492b65188796d85)\".",
    "created_at": "2017-09-15T11:46:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22886#issuecomment-430092",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[cdbea87b23f5cca49c6a840e73e69d2ce6f06c29](https://github.com/sagemath/sagetrac-mirror/commit/cdbea87b23f5cca49c6a840e73e69d2ce6f06c29)" to "[6700ab33f3844190f9dcfc323492b65188796d85](https://github.com/sagemath/sagetrac-mirror/commit/6700ab33f3844190f9dcfc323492b65188796d85)".



---

archive/issue_comments_430093.json:
```json
{
    "body": "**Changing dependencies** from \"#22461\" to \"#23799, #22461\".",
    "created_at": "2017-09-15T11:47:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22886#issuecomment-430093",
    "user": "https://github.com/jdemeyer"
}
```

**Changing dependencies** from "#22461" to "#23799, #22461".



---

archive/issue_comments_430094.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2017-09-15T11:47:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22886#issuecomment-430094",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_430095.json:
```json
{
    "body": "<a id='comment:13'></a>\nGiven that I gave this ticket positive_review earlier, this should be set back to positive_review (modulo the dependencies of course) if tests pass.",
    "created_at": "2017-09-15T11:48:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22886#issuecomment-430095",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:13'></a>
Given that I gave this ticket positive_review earlier, this should be set back to positive_review (modulo the dependencies of course) if tests pass.



---

archive/issue_comments_430096.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2017-09-15T12:15:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22886#issuecomment-430096",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_430097.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2017-10-05T06:54:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22886#issuecomment-430097",
    "user": "https://github.com/vbraun"
}
```

**Resolution:** fixed



---

archive/issue_comments_430098.json:
```json
{
    "body": "**Changing branch** from \"[u/jdemeyer/22886](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/22886)\" to \"[6700ab33f3844190f9dcfc323492b65188796d85](https://github.com/sagemath/sagetrac-mirror/commit/6700ab33f3844190f9dcfc323492b65188796d85)\".",
    "created_at": "2017-10-05T06:54:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22886#issuecomment-430098",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/jdemeyer/22886](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/22886)" to "[6700ab33f3844190f9dcfc323492b65188796d85](https://github.com/sagemath/sagetrac-mirror/commit/6700ab33f3844190f9dcfc323492b65188796d85)".



---

archive/issue_events_067592.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-10-05T06:54:15Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/22886",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22886#event-67592"
}
```
