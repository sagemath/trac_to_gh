# Issue 22077: Upgrade eclib to version 20170104

archive/issues_021840.json:
```json
{
    "body": "The current eclib version in Sage (as of 7.5.beta5) is v20160720.\n\n**New tarball**: http://homepages.warwick.ac.uk/staff/J.E.Cremona/ftp/eclib-20170104.tar.bz2\n\nOf relevance to Sage are a bugfix and some extra functionality related to modular symbols, see #10256 and #21046.\n\nCC:  @categorie\n\nKeywords: eclib\n\nReviewer: Jeroen Demeyer\n\nAuthor: John Cremona\n\nBranch: cb3fd05c95fb3afbaed9ba621038293b5412d6e0\n\nCommit: cb3fd05c95fb3afbaed9ba621038293b5412d6e0\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/22077\n\n",
    "closed_at": "2017-01-21T16:34:58Z",
    "created_at": "2016-12-19T14:01:24Z",
    "labels": [
        "component: packages: standard"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.5",
    "title": "Upgrade eclib to version 20170104",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22077",
    "user": "https://github.com/JohnCremona"
}
```
The current eclib version in Sage (as of 7.5.beta5) is v20160720.

**New tarball**: http://homepages.warwick.ac.uk/staff/J.E.Cremona/ftp/eclib-20170104.tar.bz2

Of relevance to Sage are a bugfix and some extra functionality related to modular symbols, see #10256 and #21046.

CC:  @categorie

Keywords: eclib

Reviewer: Jeroen Demeyer

Author: John Cremona

Branch: cb3fd05c95fb3afbaed9ba621038293b5412d6e0

Commit: cb3fd05c95fb3afbaed9ba621038293b5412d6e0

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/22077





---

archive/issue_comments_302771.json:
```json
{
    "body": "<a id='comment:1'></a>I will upload a branch as soon as I have tested the new build and all doctests.",
    "created_at": "2016-12-19T14:01:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22077#issuecomment-302771",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:1'></a>I will upload a branch as soon as I have tested the new build and all doctests.



---

archive/issue_comments_302772.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-12-19T16:20:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22077#issuecomment-302772",
    "user": "https://github.com/JohnCremona"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_302773.json:
```json
{
    "body": "<a id='comment:2'></a>OK, please review.  As well as the new package code I made some small changes to the output of some modular symbol doctests.  In each case I checked that the change is exactly that which one would expect from the new eclib code (a few integers fivided by 2).",
    "created_at": "2016-12-19T16:20:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22077#issuecomment-302773",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:2'></a>OK, please review.  As well as the new package code I made some small changes to the output of some modular symbol doctests.  In each case I checked that the change is exactly that which one would expect from the new eclib code (a few integers fivided by 2).



---

archive/issue_comments_302774.json:
```json
{
    "body": "<a id='comment:3'></a>So, what about https://github.com/JohnCremona/eclib/issues/10\n\nDo we still need the `NTL_ALL` macro?",
    "created_at": "2016-12-19T19:36:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22077#issuecomment-302774",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:3'></a>So, what about https://github.com/JohnCremona/eclib/issues/10

Do we still need the `NTL_ALL` macro?



---

archive/issue_comments_302775.json:
```json
{
    "body": "<a id='comment:4'></a>Replying to [comment:3 jdemeyer]:\n> So, what about https://github.com/JohnCremona/eclib/issues/10\n> \n> Do we still need the `NTL_ALL` macro?\n\n\nIf you look here: https://github.com/JohnCremona/eclib/commits/master, specifically at the commits made in January this year, you will see that the code now works (at least it is supposed to) with or without NTL_ALL being set.  This is controlled by the --enable-mpfp flag to ./configure.  That was quite a lot of work since there were quite a lot of tests whose output was trivially different with/without that option set.\n\nNote that the default configurations is to have --enable-mpfp set and hence NTL_ALL set, you have to turn it off using --disable-mpfp.  Since Sage's spkg-install does not turn it off, it is on in Sage.\n\nSo I think the only thing I did not do is update and close that Issue.  Sorry!",
    "created_at": "2016-12-19T19:56:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22077#issuecomment-302775",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:4'></a>Replying to [comment:3 jdemeyer]:
> So, what about https://github.com/JohnCremona/eclib/issues/10
> 
> Do we still need the `NTL_ALL` macro?


If you look here: https://github.com/JohnCremona/eclib/commits/master, specifically at the commits made in January this year, you will see that the code now works (at least it is supposed to) with or without NTL_ALL being set.  This is controlled by the --enable-mpfp flag to ./configure.  That was quite a lot of work since there were quite a lot of tests whose output was trivially different with/without that option set.

Note that the default configurations is to have --enable-mpfp set and hence NTL_ALL set, you have to turn it off using --disable-mpfp.  Since Sage's spkg-install does not turn it off, it is on in Sage.

So I think the only thing I did not do is update and close that Issue.  Sorry!



---

archive/issue_comments_302776.json:
```json
{
    "body": "<a id='comment:5'></a>If so, can you apply this additional patch\n\n```diff\ndiff --git a/src/sage/libs/eclib/__init__.pxd b/src/sage/libs/eclib/__init__.pxd\nindex a666ec1..e42d0cc 100644\n--- a/src/sage/libs/eclib/__init__.pxd\n+++ b/src/sage/libs/eclib/__init__.pxd\n@@ -1,5 +1,4 @@\n # distutils: language = c++\n-# distutils: extra_compile_args = -DNTL_ALL\n # distutils: libraries = ec ntl pari gmp m\n \n # NOTE: eclib includes have specific dependencies and must be included\n```",
    "created_at": "2016-12-20T07:48:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22077#issuecomment-302776",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:5'></a>If so, can you apply this additional patch

```diff
diff --git a/src/sage/libs/eclib/__init__.pxd b/src/sage/libs/eclib/__init__.pxd
index a666ec1..e42d0cc 100644
--- a/src/sage/libs/eclib/__init__.pxd
+++ b/src/sage/libs/eclib/__init__.pxd
@@ -1,5 +1,4 @@
 # distutils: language = c++
-# distutils: extra_compile_args = -DNTL_ALL
 # distutils: libraries = ec ntl pari gmp m
 
 # NOTE: eclib includes have specific dependencies and must be included
```



---

archive/issue_comments_302777.json:
```json
{
    "body": "<a id='comment:6'></a>Regarding the changed doctests, I cannot really review those. But I'm happy to assume that you know what you are doing and just accept the changed output.",
    "created_at": "2016-12-20T07:50:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22077#issuecomment-302777",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:6'></a>Regarding the changed doctests, I cannot really review those. But I'm happy to assume that you know what you are doing and just accept the changed output.



---

archive/issue_comments_302778.json:
```json
{
    "body": "<a id='comment:7'></a>OK, I can make that additional change.  After that I'll force a rebuild of eclib in Sage and watch: it should be that -DNTL_ALL is set during compilation anyway.  However I just looked at the log from my build of the new spkg yesterday and every compile line only contains \"-D NTL_ALL\" and no other instances of \"NTL_ALL\".\n\nAbout the doctests: I ran them past Rob Pollack and Chris Wuthrich who are experts, and also the remarks I made above were supposed to be a justification for the correctness of the new values.",
    "created_at": "2016-12-20T09:21:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22077#issuecomment-302778",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:7'></a>OK, I can make that additional change.  After that I'll force a rebuild of eclib in Sage and watch: it should be that -DNTL_ALL is set during compilation anyway.  However I just looked at the log from my build of the new spkg yesterday and every compile line only contains "-D NTL_ALL" and no other instances of "NTL_ALL".

About the doctests: I ran them past Rob Pollack and Chris Wuthrich who are experts, and also the remarks I made above were supposed to be a justification for the correctness of the new values.



---

archive/issue_comments_302779.json:
```json
{
    "body": "<a id='comment:8'></a>After writing that I realised that I did not know when the presence of the line you suggest deleting has any effect.  It has nothing to do with building libec at build time, I realise, but rather is there to make sure that the cython compilations which read eclib's header files have the right macros set.  And that must be crucial given that the compiled code must then link to the library libec!  So I now think that we must continue to set NTL_ALL in this cython file, otherwise there will be errors which including eclib's header files.\n\nI checked to see what other compiler flags are set at eclib build time.  There is one other (apart from lots put there by autotools):  FLINT_LEVEL=1.  But that one is not an issue since it controls some implementations (in some eclib .cc files) and not headers.\n\nDoes this make sense?  If so, no further patching is needed.",
    "created_at": "2016-12-20T09:37:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22077#issuecomment-302779",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:8'></a>After writing that I realised that I did not know when the presence of the line you suggest deleting has any effect.  It has nothing to do with building libec at build time, I realise, but rather is there to make sure that the cython compilations which read eclib's header files have the right macros set.  And that must be crucial given that the compiled code must then link to the library libec!  So I now think that we must continue to set NTL_ALL in this cython file, otherwise there will be errors which including eclib's header files.

I checked to see what other compiler flags are set at eclib build time.  There is one other (apart from lots put there by autotools):  FLINT_LEVEL=1.  But that one is not an issue since it controls some implementations (in some eclib .cc files) and not headers.

Does this make sense?  If so, no further patching is needed.



---

archive/issue_comments_302780.json:
```json
{
    "body": "<a id='comment:9'></a>Replying to [comment:8 cremona]:\n> It has nothing to do with building libec at build time, I realise, but rather is there to make sure that the cython compilations which read eclib's header files have the right macros set.\n\n\nExactly. This is about compiling Sage library files (Cython extensions) against `libec`.\n\n> And that must be crucial given that the compiled code must then link to the library libec!  So I now think that we must continue to set NTL_ALL in this cython file, otherwise there will be errors which including eclib's header files.\n\n\nThat's a pity because `-DNTL_ALL` should not be needed. That was precisely the point that I was trying to make at https://github.com/JohnCremona/eclib/issues/10: eclib should not force other packages (like Sage) to use certain compiler flags. The `NTL_ALL` macro should be considered an implementation detail of `eclib` and it should not influence other software built against `eclib`.\n\nBut this is a minor point which won't influence this Sage ticket.",
    "created_at": "2016-12-20T13:32:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22077#issuecomment-302780",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:9'></a>Replying to [comment:8 cremona]:
> It has nothing to do with building libec at build time, I realise, but rather is there to make sure that the cython compilations which read eclib's header files have the right macros set.


Exactly. This is about compiling Sage library files (Cython extensions) against `libec`.

> And that must be crucial given that the compiled code must then link to the library libec!  So I now think that we must continue to set NTL_ALL in this cython file, otherwise there will be errors which including eclib's header files.


That's a pity because `-DNTL_ALL` should not be needed. That was precisely the point that I was trying to make at https://github.com/JohnCremona/eclib/issues/10: eclib should not force other packages (like Sage) to use certain compiler flags. The `NTL_ALL` macro should be considered an implementation detail of `eclib` and it should not influence other software built against `eclib`.

But this is a minor point which won't influence this Sage ticket.



---

archive/issue_comments_302781.json:
```json
{
    "body": "<a id='comment:10'></a>I understand your point, but it is more than just an implementation detail, as it affects the interface.  When compiled with the NTL_ALL option, functions which compute real or complex values (e.g. periods of elliptic curves) do so to arbitrary precision, returning values with type RR (NTL reals) for example, while without that option the same named function will return a C double.\n\nI do understand that this can be viewed as bad design on my part and not a feature which a professional library should have.  eclib has undergone a lot of transition since it was just \"my code\" (until 2007) so that by now it is almost respectable.  One of the remaining issues is this one: users should not have to decide at build time whether they want to use doubles or arbitrary precision for a large collection of functions; the library should provide both and allow the uers to use whichever is most appropriate in the circumstances.  In some cases, because of overloading, the same function name can be re-used; but in others different names would be necessary (e.g. for periods of elliptic curves, where the input is the same exact data whether ones wants low or high precision).  It will happen one day.\n\nI will copy some of this discussions to https://github.com/JohnCremona/eclib/issues/10",
    "created_at": "2016-12-20T13:45:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22077#issuecomment-302781",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:10'></a>I understand your point, but it is more than just an implementation detail, as it affects the interface.  When compiled with the NTL_ALL option, functions which compute real or complex values (e.g. periods of elliptic curves) do so to arbitrary precision, returning values with type RR (NTL reals) for example, while without that option the same named function will return a C double.

I do understand that this can be viewed as bad design on my part and not a feature which a professional library should have.  eclib has undergone a lot of transition since it was just "my code" (until 2007) so that by now it is almost respectable.  One of the remaining issues is this one: users should not have to decide at build time whether they want to use doubles or arbitrary precision for a large collection of functions; the library should provide both and allow the uers to use whichever is most appropriate in the circumstances.  In some cases, because of overloading, the same function name can be re-used; but in others different names would be necessary (e.g. for periods of elliptic curves, where the input is the same exact data whether ones wants low or high precision).  It will happen one day.

I will copy some of this discussions to https://github.com/JohnCremona/eclib/issues/10



---

archive/issue_comments_302782.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-12-22T09:18:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22077#issuecomment-302782",
    "user": "https://github.com/JohnCremona"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_302783.json:
```json
{
    "body": "<a id='comment:11'></a>I am resetting this to \"needs work\" just so I can work some more on adding functions to make the interface for modular symbols better as in #10256.  (There was also a test output file committed to the last eclib release by mistake).  It looks as if this missed the 7.5 release anyway.",
    "created_at": "2016-12-22T09:18:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22077#issuecomment-302783",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:11'></a>I am resetting this to "needs work" just so I can work some more on adding functions to make the interface for modular symbols better as in #10256.  (There was also a test output file committed to the last eclib release by mistake).  It looks as if this missed the 7.5 release anyway.



---

archive/issue_comments_302784.json:
```json
{
    "body": "<a id='comment:12'></a>Do you mean you want to keep working on `eclib` itself or on the Sage interface?",
    "created_at": "2016-12-22T12:54:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22077#issuecomment-302784",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:12'></a>Do you mean you want to keep working on `eclib` itself or on the Sage interface?



---

archive/issue_comments_302785.json:
```json
{
    "body": "<a id='comment:13'></a>Both.   There are normalization issues around modular symbols that I am sorting out on the eclib side as well as giving access to them via Sage.  So there will be a new eclib release (possibly today if I can finish) and at the same time I have   branch for #10256 which will depend on that (hence #10256 has this ticket as a dependency).",
    "created_at": "2016-12-22T13:46:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22077#issuecomment-302785",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:13'></a>Both.   There are normalization issues around modular symbols that I am sorting out on the eclib side as well as giving access to them via Sage.  So there will be a new eclib release (possibly today if I can finish) and at the same time I have   branch for #10256 which will depend on that (hence #10256 has this ticket as a dependency).



---

archive/issue_comments_302786.json:
```json
{
    "body": "<a id='comment:14'></a>Fine for me. In case you want to change your mind, feel free to set this back to needs_review.",
    "created_at": "2016-12-22T13:47:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22077#issuecomment-302786",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:14'></a>Fine for me. In case you want to change your mind, feel free to set this back to needs_review.



---

archive/issue_comments_302787.json:
```json
{
    "body": "<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-12-22T20:36:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22077#issuecomment-302787",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_302788.json:
```json
{
    "body": "<a id='comment:17'></a>OK, so here is another new version.  I don't expect to need to make more changes as I work on #10256.  On the other hand there is perhaps little point in getting this in before that anyway: I made some more changes to modular symbol doctest output just so they pass but those tests will all be reworked in #10256 anyway.  It would not hurt for someone else to check that the new release still works OK rather than having to deal with both tickets at once.  I don't know.  Anyway, #10256 will depend on this as it is now.",
    "created_at": "2016-12-22T20:40:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22077#issuecomment-302788",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:17'></a>OK, so here is another new version.  I don't expect to need to make more changes as I work on #10256.  On the other hand there is perhaps little point in getting this in before that anyway: I made some more changes to modular symbol doctest output just so they pass but those tests will all be reworked in #10256 anyway.  It would not hurt for someone else to check that the new release still works OK rather than having to deal with both tickets at once.  I don't know.  Anyway, #10256 will depend on this as it is now.



---

archive/issue_comments_302789.json:
```json
{
    "body": "<a id='comment:18'></a>Needs review then?",
    "created_at": "2016-12-23T07:02:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22077#issuecomment-302789",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:18'></a>Needs review then?



---

archive/issue_comments_302790.json:
```json
{
    "body": "<a id='comment:19'></a>Replying to [comment:18 jdemeyer]:\n> Needs review then?\n\n\nNot yet.  I uploaded that new version last night but then realised that I have yet to ensure that the modular symbols are normalised as to sign (I dealt with the factor of 2 ok, touch wood).  This probably means a delay of several days now...",
    "created_at": "2016-12-23T10:40:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22077#issuecomment-302790",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:19'></a>Replying to [comment:18 jdemeyer]:
> Needs review then?


Not yet.  I uploaded that new version last night but then realised that I have yet to ensure that the modular symbols are normalised as to sign (I dealt with the factor of 2 ok, touch wood).  This probably means a delay of several days now...



---

archive/issue_comments_302791.json:
```json
{
    "body": "<a id='comment:20'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-12-23T15:51:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22077#issuecomment-302791",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:20'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_302792.json:
```json
{
    "body": "<a id='comment:22'></a>With luck this version (v20161230) will be the last bugfix version with the new modular symbols functionality.  Right now this all works fine with the branch soon to be uploaded to #10256, but I should make a version here which passes all tests even if the relevant tests will all be superseded there.",
    "created_at": "2016-12-30T17:54:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22077#issuecomment-302792",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:22'></a>With luck this version (v20161230) will be the last bugfix version with the new modular symbols functionality.  Right now this all works fine with the branch soon to be uploaded to #10256, but I should make a version here which passes all tests even if the relevant tests will all be superseded there.



---

archive/issue_comments_302793.json:
```json
{
    "body": "<a id='comment:23'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-12-30T18:03:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22077#issuecomment-302793",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:23'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_302794.json:
```json
{
    "body": "<a id='comment:24'></a>Please review, using v20161230 of eclib (as in the link).  The only doctest changes are to do with scaling of modular symbols, which will be dealt with properly in #10256, so the only thing to do is check that the new source builds OK and all test pass.",
    "created_at": "2016-12-30T18:06:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22077#issuecomment-302794",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:24'></a>Please review, using v20161230 of eclib (as in the link).  The only doctest changes are to do with scaling of modular symbols, which will be dealt with properly in #10256, so the only thing to do is check that the new source builds OK and all test pass.



---

archive/issue_comments_302795.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-12-30T18:06:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22077#issuecomment-302795",
    "user": "https://github.com/JohnCremona"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_302796.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-01-01T19:10:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22077#issuecomment-302796",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_302797.json:
```json
{
    "body": "<a id='comment:27'></a>Very sorry, JD -- see #10256",
    "created_at": "2017-01-03T10:39:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22077#issuecomment-302797",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:27'></a>Very sorry, JD -- see #10256



---

archive/issue_comments_302798.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-01-03T10:39:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22077#issuecomment-302798",
    "user": "https://github.com/JohnCremona"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_302799.json:
```json
{
    "body": "<a id='comment:28'></a>Another version will appear shortly.  For the record: the sign of plus modular symbols was being set correctly when L(E,1) is nonzero but not otherwise (random) and the sign of the minus symbol was not being set at all.  Now both are dealt with.\n\nThe new tarball is in place, and I will update the branch soon.\n\nI suggest that when this has yet again had a review by Jeroen, we do not set it to positive review until Chris is happy over at #10256.",
    "created_at": "2017-01-03T15:14:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22077#issuecomment-302799",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:28'></a>Another version will appear shortly.  For the record: the sign of plus modular symbols was being set correctly when L(E,1) is nonzero but not otherwise (random) and the sign of the minus symbol was not being set at all.  Now both are dealt with.

The new tarball is in place, and I will update the branch soon.

I suggest that when this has yet again had a review by Jeroen, we do not set it to positive review until Chris is happy over at #10256.



---

archive/issue_comments_302800.json:
```json
{
    "body": "<a id='comment:29'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-01-03T16:36:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22077#issuecomment-302800",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:29'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_302801.json:
```json
{
    "body": "<a id='comment:30'></a>OK, ready for review again.  Apart from a general check that nothing is broken this should wait until #10256 is also good.",
    "created_at": "2017-01-03T16:37:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22077#issuecomment-302801",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:30'></a>OK, ready for review again.  Apart from a general check that nothing is broken this should wait until #10256 is also good.



---

archive/issue_comments_302802.json:
```json
{
    "body": "<a id='comment:31'></a>I fear I am losing all credibility here.  Scrap v20170103 and watch this space.",
    "created_at": "2017-01-04T09:08:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22077#issuecomment-302802",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:31'></a>I fear I am losing all credibility here.  Scrap v20170103 and watch this space.



---

archive/issue_comments_302803.json:
```json
{
    "body": "<a id='comment:32'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-01-04T19:55:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22077#issuecomment-302803",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:32'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_302804.json:
```json
{
    "body": "<a id='comment:33'></a>Another attempt, with more testing this time.\n\n---\nNew commits:",
    "created_at": "2017-01-04T19:58:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22077#issuecomment-302804",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:33'></a>Another attempt, with more testing this time.

---
New commits:



---

archive/issue_comments_302805.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-01-04T19:59:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22077#issuecomment-302805",
    "user": "https://github.com/JohnCremona"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_302806.json:
```json
{
    "body": "<a id='comment:36'></a>Can you squash all those commits? I see little point in keeping all those incremental upgrades as separate commits.",
    "created_at": "2017-01-05T13:29:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22077#issuecomment-302806",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:36'></a>Can you squash all those commits? I see little point in keeping all those incremental upgrades as separate commits.



---

archive/issue_comments_302807.json:
```json
{
    "body": "<a id='comment:37'></a>Probably, I would not be happy at #10256 if you squash commits here. Does it really harm having them?",
    "created_at": "2017-01-05T13:33:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22077#issuecomment-302807",
    "user": "https://github.com/categorie"
}
```

<a id='comment:37'></a>Probably, I would not be happy at #10256 if you squash commits here. Does it really harm having them?



---

archive/issue_comments_302808.json:
```json
{
    "body": "<a id='comment:38'></a>Replying to [comment:37 wuthrich]:\n> Probably, I would not be happy at #10256 if you squash commits here.\n\n\nNever mind then.",
    "created_at": "2017-01-05T13:35:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22077#issuecomment-302808",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:38'></a>Replying to [comment:37 wuthrich]:
> Probably, I would not be happy at #10256 if you squash commits here.


Never mind then.



---

archive/issue_comments_302809.json:
```json
{
    "body": "<a id='comment:39'></a>Yes, sorry about the tangle.  We certainly could disentangle: on this ticket that's what you were suggesting anyway, and on the other one I think there are <6 files affected and one could always use the non-git route of copying those 6 files elsewhere first and starting a new branch...\nI can do that if necessary.",
    "created_at": "2017-01-05T14:19:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22077#issuecomment-302809",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:39'></a>Yes, sorry about the tangle.  We certainly could disentangle: on this ticket that's what you were suggesting anyway, and on the other one I think there are <6 files affected and one could always use the non-git route of copying those 6 files elsewhere first and starting a new branch...
I can do that if necessary.



---

archive/issue_comments_302810.json:
```json
{
    "body": "<a id='comment:40'></a>I made a clean single commit on top of 7.5.rc1 which is at u/cremona/22077new.  It could be used instead of the original u/cremona/22077, but only if #10256 is also cleaned up.  Next...",
    "created_at": "2017-01-05T19:10:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22077#issuecomment-302810",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:40'></a>I made a clean single commit on top of 7.5.rc1 which is at u/cremona/22077new.  It could be used instead of the original u/cremona/22077, but only if #10256 is also cleaned up.  Next...



---

archive/issue_comments_302811.json:
```json
{
    "body": "<a id='comment:41'></a>Jeroen, how about using my clean branch here, and at #10256 using one I just made which merges this with the current branch there (u/wuthrich/ticket/10256)?  I resolved the merge conflicts in 3 files, so now have a version of that branch which is no worse than before, while this one is simpler.",
    "created_at": "2017-01-05T19:29:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22077#issuecomment-302811",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:41'></a>Jeroen, how about using my clean branch here, and at #10256 using one I just made which merges this with the current branch there (u/wuthrich/ticket/10256)?  I resolved the merge conflicts in 3 files, so now have a version of that branch which is no worse than before, while this one is simpler.



---

archive/issue_comments_302812.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-01-05T19:41:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22077#issuecomment-302812",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_302813.json:
```json
{
    "body": "<a id='comment:42'></a>That's all fine for me. Just change branches and set this one back to needs_review.",
    "created_at": "2017-01-05T19:41:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22077#issuecomment-302813",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:42'></a>That's all fine for me. Just change branches and set this one back to needs_review.



---

archive/issue_comments_302814.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-01-05T20:47:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22077#issuecomment-302814",
    "user": "https://github.com/categorie"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_302815.json:
```json
{
    "body": "<a id='comment:43'></a>New commits:",
    "created_at": "2017-01-05T20:47:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22077#issuecomment-302815",
    "user": "https://github.com/categorie"
}
```

<a id='comment:43'></a>New commits:



---

archive/issue_comments_302816.json:
```json
{
    "body": "<a id='comment:44'></a>Thanks.  Now I'll replace the branch at #10256 with a tidied one too.",
    "created_at": "2017-01-05T21:02:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22077#issuecomment-302816",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:44'></a>Thanks.  Now I'll replace the branch at #10256 with a tidied one too.



---

archive/issue_comments_302817.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-01-05T21:30:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22077#issuecomment-302817",
    "user": "https://github.com/JohnCremona"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_302818.json:
```json
{
    "body": "<a id='comment:45'></a>Apologies, I messed up -- the new branch is certainly a cleaned up version of its predecessor but that one was wrong.  I will fix this in the morning.\n\nIgnore the above comment, this (=branch u/cremona/22077new = commit cb3fd05)  is fine.  Just note that the additional work on #10256 will involve changes to sage/libs/eclib as well as sage/schemes/elliptic_curves, in order to expose some new functionality in eclib.  This one *only* does the minimum to make eclib c20170104 work OK and pass tests.",
    "created_at": "2017-01-05T21:30:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22077#issuecomment-302818",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:45'></a>Apologies, I messed up -- the new branch is certainly a cleaned up version of its predecessor but that one was wrong.  I will fix this in the morning.

Ignore the above comment, this (=branch u/cremona/22077new = commit cb3fd05)  is fine.  Just note that the additional work on #10256 will involve changes to sage/libs/eclib as well as sage/schemes/elliptic_curves, in order to expose some new functionality in eclib.  This one *only* does the minimum to make eclib c20170104 work OK and pass tests.



---

archive/issue_comments_302819.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-01-06T09:52:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22077#issuecomment-302819",
    "user": "https://github.com/JohnCremona"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_302820.json:
```json
{
    "body": "<a id='comment:47'></a>Note that #10256 which depends on this has a postive review.  I don't know if this proprty is inherited!",
    "created_at": "2017-01-09T09:22:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22077#issuecomment-302820",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:47'></a>Note that #10256 which depends on this has a postive review.  I don't know if this proprty is inherited!



---

archive/issue_comments_302821.json:
```json
{
    "body": "<a id='comment:48'></a>Good. I'll try to review this today.",
    "created_at": "2017-01-09T09:33:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22077#issuecomment-302821",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:48'></a>Good. I'll try to review this today.



---

archive/issue_comments_302822.json:
```json
{
    "body": "<a id='comment:49'></a>I didn't check the mathematics. But the package builds fine.",
    "created_at": "2017-01-09T09:58:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22077#issuecomment-302822",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:49'></a>I didn't check the mathematics. But the package builds fine.



---

archive/issue_comments_302823.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-01-09T09:58:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22077#issuecomment-302823",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_302824.json:
```json
{
    "body": "<a id='comment:50'></a>Thanks.  The mathematical changes are effectively reviewed (already) at #10256.",
    "created_at": "2017-01-09T10:10:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22077#issuecomment-302824",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:50'></a>Thanks.  The mathematical changes are effectively reviewed (already) at #10256.



---

archive/issue_comments_302825.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-01-21T16:34:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22077#issuecomment-302825",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_058081.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-01-21T16:34:58Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/22077",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22077#event-58081"
}
```
