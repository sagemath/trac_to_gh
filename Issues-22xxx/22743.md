# Issue 22743: little cleanup of Wehler K3

archive/issues_022506.json:
```json
{
    "assignees": [],
    "body": "<div id=\"comment:0\"></div>\n\nin particular to make that all elements of orbits belong to the K3 itself.\n\nplus a general pyflakes cleanup\n\nComponent: **geometry**\n\nAuthor: **Fr\u00e9d\u00e9ric Chapoton**\n\nBranch/Commit: **[`07aeb0b`](https://github.com/sagemath/sagetrac-mirror/commit/07aeb0bfd9a2c2bc7cbf448d4ba5b08454ef2008)**\n\nReviewer: **Ben Hutz**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/22743_\n\n",
    "closed_at": "2017-04-05T19:37:51Z",
    "created_at": "2017-04-02T19:17:49Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20geometry",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.0",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "little cleanup of Wehler K3",
    "type": "issue",
    "updated_at": "2017-04-05T19:37:51Z",
    "url": "https://github.com/sagemath/sage/issues/22743",
    "user": "https://github.com/fchapoton"
}
```
<div id="comment:0"></div>

in particular to make that all elements of orbits belong to the K3 itself.

plus a general pyflakes cleanup

Component: **geometry**

Author: **Frédéric Chapoton**

Branch/Commit: **[`07aeb0b`](https://github.com/sagemath/sagetrac-mirror/commit/07aeb0bfd9a2c2bc7cbf448d4ba5b08454ef2008)**

Reviewer: **Ben Hutz**

_Issue created by migration from https://trac.sagemath.org/ticket/22743_





---

archive/issue_events_314680.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-04-02T19:17:49Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/22743",
    "milestone_number": null,
    "milestone_title": "sage-8.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22743#event-314680"
}
```



---

archive/issue_events_314681.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-04-02T19:17:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22743",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20geometry",
    "label_color": "0000ff",
    "label_name": "c: geometry",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22743#event-314681"
}
```



---

archive/issue_events_314682.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-04-02T19:17:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22743",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22743#event-314682"
}
```



---

archive/issue_events_314683.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-04-02T19:17:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22743",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22743#event-314683"
}
```



---

archive/issue_events_314684.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-04-02T19:18:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22743",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22743#event-314684"
}
```



---

archive/issue_comments_338367.json:
```json
{
    "body": "<div id=\"comment:1\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fb596986a557bdd2d17d765bb3d3987325687a28\"><code>fb59698</code></a></td><td><code>little cleanup of Wehler K3</code></td></tr></table>\n",
    "created_at": "2017-04-02T19:18:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22743#issuecomment-338367",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:1"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fb596986a557bdd2d17d765bb3d3987325687a28"><code>fb59698</code></a></td><td><code>little cleanup of Wehler K3</code></td></tr></table>




---

archive/issue_comments_338368.json:
```json
{
    "body": "Branch: **[u/chapoton/22743](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/22743)**",
    "created_at": "2017-04-02T19:18:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22743#issuecomment-338368",
    "user": "https://github.com/fchapoton"
}
```

Branch: **[u/chapoton/22743](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/22743)**



---

archive/issue_comments_338369.json:
```json
{
    "body": "Commit: **[`fb59698`](https://github.com/sagemath/sagetrac-mirror/commit/fb596986a557bdd2d17d765bb3d3987325687a28)**",
    "created_at": "2017-04-02T19:18:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22743#issuecomment-338369",
    "user": "https://github.com/fchapoton"
}
```

Commit: **[`fb59698`](https://github.com/sagemath/sagetrac-mirror/commit/fb596986a557bdd2d17d765bb3d3987325687a28)**



---

archive/issue_comments_338370.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nneeded for #22649, please review",
    "created_at": "2017-04-02T19:23:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22743#issuecomment-338370",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:2" align="right">comment:2</div>

needed for #22649, please review



---

archive/issue_comments_338371.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nIt's building now so I can run some tests. But one question from looking through the code.\n\nIn a couple places you've changed\n\n```\ncopy(Q)\n```\nto\n\n```\nself(copy(Q))\n```\nWhen copying a subscheme point it preserves the codomain, so is there a particular reason you're adding that extra coercion to the subscheme?\n\nEverything else seems like standard clean-up.",
    "created_at": "2017-04-02T19:48:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22743#issuecomment-338371",
    "user": "https://github.com/bhutz"
}
```

<div id="comment:3" align="right">comment:3</div>

It's building now so I can run some tests. But one question from looking through the code.

In a couple places you've changed

```
copy(Q)
```
to

```
self(copy(Q))
```
When copying a subscheme point it preserves the codomain, so is there a particular reason you're adding that extra coercion to the subscheme?

Everything else seems like standard clean-up.



---

archive/issue_comments_338372.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nyes, this is the main reason for this ticket.\n\nI want all members of an orbit to belong to the same parent. If the given input is returned in the orbit, it does not belong to the K3, but to the ambient projective space. Try something like\n\n[u.parent() for u in orbit]",
    "created_at": "2017-04-02T19:50:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22743#issuecomment-338372",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:4" align="right">comment:4</div>

yes, this is the main reason for this ticket.

I want all members of an orbit to belong to the same parent. If the given input is returned in the orbit, it does not belong to the K3, but to the ambient projective space. Try something like

[u.parent() for u in orbit]



---

archive/issue_comments_338373.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nWith correct input, that works just fine for me.  The problem looks to me like it lies in the doctest not in the code:\n\n```\nsage: X = WehlerK3Surface([Z, Y])\nsage: T = PP(0, 0, 1, 1, 0, 0)\n```\n\nNotice that the doctest is mistakenly defining the initial point on the ambient space and not the K3 surface.\n\n\nYour fix does prevent this bad input problem. That is what you're trying to fix?",
    "created_at": "2017-04-02T20:12:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22743#issuecomment-338373",
    "user": "https://github.com/bhutz"
}
```

<div id="comment:5" align="right">comment:5</div>

With correct input, that works just fine for me.  The problem looks to me like it lies in the doctest not in the code:

```
sage: X = WehlerK3Surface([Z, Y])
sage: T = PP(0, 0, 1, 1, 0, 0)
```

Notice that the doctest is mistakenly defining the initial point on the ambient space and not the K3 surface.


Your fix does prevent this bad input problem. That is what you're trying to fix?



---

archive/issue_comments_338374.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nWell, in #22649, I am painfuly trying to modernize (for python3) the comparison of scheme morphisms. This triggered a doctest failure in WehlerK3, that I tracked to the fact the the parent of orbit[0] was not the same as the parent of the last element of the orbit.\n\nSo I guess I do not mind the way we fix it here : either by fixing the initial point in the doctest or by using this self(copy(Q)) in the code (or even both..)",
    "created_at": "2017-04-02T20:16:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22743#issuecomment-338374",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:6" align="right">comment:6</div>

Well, in #22649, I am painfuly trying to modernize (for python3) the comparison of scheme morphisms. This triggered a doctest failure in WehlerK3, that I tracked to the fact the the parent of orbit[0] was not the same as the parent of the last element of the orbit.

So I guess I do not mind the way we fix it here : either by fixing the initial point in the doctest or by using this self(copy(Q)) in the code (or even both..)



---

archive/issue_comments_338375.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nI see. Then I say we should fix it both ways. Well, at least change the doctest in one of the two orbit functions. That way both the 'good' and 'bad' inputs are checked.\n\nThere is no way a user would call that function with a point not on the K3 surface, so adding the coercion should not cause any problems other than some extra computation. Since the function does succeed with the 'bad' input, those points should all have the same parent.",
    "created_at": "2017-04-02T20:23:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22743#issuecomment-338375",
    "user": "https://github.com/bhutz"
}
```

<div id="comment:7" align="right">comment:7</div>

I see. Then I say we should fix it both ways. Well, at least change the doctest in one of the two orbit functions. That way both the 'good' and 'bad' inputs are checked.

There is no way a user would call that function with a point not on the K3 surface, so adding the coercion should not cause any problems other than some extra computation. Since the function does succeed with the 'bad' input, those points should all have the same parent.



---

archive/issue_comments_338376.json:
```json
{
    "body": "Changed branch from **[u/chapoton/22743](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/22743)** to **[u/bhutz/22743](https://github.com/sagemath/sagetrac-mirror/tree/u/bhutz/22743)**",
    "created_at": "2017-04-02T21:14:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22743#issuecomment-338376",
    "user": "https://github.com/bhutz"
}
```

Changed branch from **[u/chapoton/22743](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/22743)** to **[u/bhutz/22743](https://github.com/sagemath/sagetrac-mirror/tree/u/bhutz/22743)**



---

archive/issue_comments_338377.json:
```json
{
    "body": "Changed commit from **[`fb59698`](https://github.com/sagemath/sagetrac-mirror/commit/fb596986a557bdd2d17d765bb3d3987325687a28)** to **[`07aeb0b`](https://github.com/sagemath/sagetrac-mirror/commit/07aeb0bfd9a2c2bc7cbf448d4ba5b08454ef2008)**",
    "created_at": "2017-04-02T21:14:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22743#issuecomment-338377",
    "user": "https://github.com/bhutz"
}
```

Changed commit from **[`fb59698`](https://github.com/sagemath/sagetrac-mirror/commit/fb596986a557bdd2d17d765bb3d3987325687a28)** to **[`07aeb0b`](https://github.com/sagemath/sagetrac-mirror/commit/07aeb0bfd9a2c2bc7cbf448d4ba5b08454ef2008)**



---

archive/issue_events_314685.json:
```json
{
    "actor": "https://github.com/bhutz",
    "created_at": "2017-04-02T21:14:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22743",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22743#event-314685"
}
```



---

archive/issue_events_314686.json:
```json
{
    "actor": "https://github.com/bhutz",
    "created_at": "2017-04-02T21:14:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22743",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22743#event-314686"
}
```



---

archive/issue_comments_338378.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nall tests pass.\n\nI also made the small tweak to the one doc test.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/07aeb0bfd9a2c2bc7cbf448d4ba5b08454ef2008\"><code>07aeb0b</code></a></td><td><code>22743: change doctest</code></td></tr></table>\n",
    "created_at": "2017-04-02T21:14:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22743#issuecomment-338378",
    "user": "https://github.com/bhutz"
}
```

<div id="comment:8" align="right">comment:8</div>

all tests pass.

I also made the small tweak to the one doc test.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/07aeb0bfd9a2c2bc7cbf448d4ba5b08454ef2008"><code>07aeb0b</code></a></td><td><code>22743: change doctest</code></td></tr></table>




---

archive/issue_comments_338379.json:
```json
{
    "body": "Reviewer: **Ben Hutz**",
    "created_at": "2017-04-02T21:14:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22743#issuecomment-338379",
    "user": "https://github.com/bhutz"
}
```

Reviewer: **Ben Hutz**



---

archive/issue_events_314687.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-04-05T19:37:51Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22743",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22743#event-314687"
}
```



---

archive/issue_events_314688.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "001535f71f97b0f6bf86c9f945f17490a6106ee3",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2017-04-05T19:37:51Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/22743",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22743#event-314688"
}
```



---

archive/issue_comments_338380.json:
```json
{
    "body": "Changed branch from **[u/bhutz/22743](https://github.com/sagemath/sagetrac-mirror/tree/u/bhutz/22743)** to **[`07aeb0b`](https://github.com/sagemath/sagetrac-mirror/commit/07aeb0bfd9a2c2bc7cbf448d4ba5b08454ef2008)**",
    "created_at": "2017-04-05T19:37:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22743#issuecomment-338380",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/bhutz/22743](https://github.com/sagemath/sagetrac-mirror/tree/u/bhutz/22743)** to **[`07aeb0b`](https://github.com/sagemath/sagetrac-mirror/commit/07aeb0bfd9a2c2bc7cbf448d4ba5b08454ef2008)**
