# Issue 22701: Setting up a Polyhedron from both Vrep and Hrep - for backend='field'

archive/issues_022464.json:
```json
{
    "body": "CC:  @jplab @mforets @mo271 @novoselt @tscrim\n\nKeywords: polytope, geometry, days84\n\nCurrently, only one of the two is allowed.\nFor at least some backends (certainly, the generic (`\"field\"`) backend and polymake (#22683)), it makes sense to initialize with both if they are known, to avoid expensive recomputation.  (This could also be the basis of code that delegates to a particular backend for particular features.)\nUsers should also be allowed to indicate whether the given presentations are already minimal.\n\nIn this ticket, we implement this for `Polyhedron_field`, enabling fast `base_extend`.\n\nWhen both V-rep and H-rep are given, they must be minimal; the interface is designed to allow for future extensions.\n\nThe top-level constructor `Polyhedron` is unchanged in this ticket. It is still an error if `Polyhedron(vertices=..., inequalities=...)` is attempted. \n\nWithout this ticket:\n\n```\nsage: p = polytopes.hypercube(6, backend='ppl')\nsage: %time q = p.base_extend(AA)\nCPU times: user 2.27 s, sys: 10.3 ms, total: 2.28 s\nWall time: 2.28 s\nsage: q\nA 6-dimensional polyhedron in AA^6 defined as the convex hull of 64 vertices\n```\n\nWith this ticket:\n\n```\nCPU times: user 13.4 ms, sys: 603 \u00b5s, total: 14 ms\nWall time: 14.9 ms\n```\n\n\nRelated: \n- #17339: `Polyhedron` class mistreats empty inputs\n\nFollow-up:\n- #26368: Setting up a `Polyhedron` from both Vrep and Hrep - for `backend='polymake'`\n- #26366: `Polyhedron` - lazy backend; minimal vs. non-minimal presentations; `Polyhedron` constructor with both Vrep, Hrep\n\nIssue created by migration from https://trac.sagemath.org/ticket/22701\n\n",
    "closed_at": "2018-10-01T22:35:47Z",
    "created_at": "2017-03-28T18:25:43Z",
    "labels": [
        "component: geometry"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.4",
    "title": "Setting up a Polyhedron from both Vrep and Hrep - for backend='field'",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22701",
    "user": "https://github.com/mkoeppe"
}
```
CC:  @jplab @mforets @mo271 @novoselt @tscrim

Keywords: polytope, geometry, days84

Currently, only one of the two is allowed.
For at least some backends (certainly, the generic (`"field"`) backend and polymake (#22683)), it makes sense to initialize with both if they are known, to avoid expensive recomputation.  (This could also be the basis of code that delegates to a particular backend for particular features.)
Users should also be allowed to indicate whether the given presentations are already minimal.

In this ticket, we implement this for `Polyhedron_field`, enabling fast `base_extend`.

When both V-rep and H-rep are given, they must be minimal; the interface is designed to allow for future extensions.

The top-level constructor `Polyhedron` is unchanged in this ticket. It is still an error if `Polyhedron(vertices=..., inequalities=...)` is attempted. 

Without this ticket:

```
sage: p = polytopes.hypercube(6, backend='ppl')
sage: %time q = p.base_extend(AA)
CPU times: user 2.27 s, sys: 10.3 ms, total: 2.28 s
Wall time: 2.28 s
sage: q
A 6-dimensional polyhedron in AA^6 defined as the convex hull of 64 vertices
```

With this ticket:

```
CPU times: user 13.4 ms, sys: 603 Âµs, total: 14 ms
Wall time: 14.9 ms
```


Related: 
- #17339: `Polyhedron` class mistreats empty inputs

Follow-up:
- #26368: Setting up a `Polyhedron` from both Vrep and Hrep - for `backend='polymake'`
- #26366: `Polyhedron` - lazy backend; minimal vs. non-minimal presentations; `Polyhedron` constructor with both Vrep, Hrep

Issue created by migration from https://trac.sagemath.org/ticket/22701





---

archive/issue_comments_312644.json:
```json
{
    "body": "in another software you can instantiate a polyhedron with \"just\" the h-rep (or v-rep), and compute the complementary representation on-demand. this is useful especially when you work in high dimensions, and makes sense because there are questions which only rely on having just one representation.\n\nso i wonder if this can be considered in this ticket, something like a keyword argument  `compute_complementary_representation` which is true by default, to cover those use cases.",
    "created_at": "2017-04-11T15:40:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22701#issuecomment-312644",
    "user": "https://github.com/mforets"
}
```

in another software you can instantiate a polyhedron with "just" the h-rep (or v-rep), and compute the complementary representation on-demand. this is useful especially when you work in high dimensions, and makes sense because there are questions which only rely on having just one representation.

so i wonder if this can be considered in this ticket, something like a keyword argument  `compute_complementary_representation` which is true by default, to cover those use cases.



---

archive/issue_comments_312645.json:
```json
{
    "body": "I think we could have a separate \"lazy\" backend that can only hold a given Hrep or Vrep. Whenever anything needs to be computed that requires the other representation, one could change to an actual backend.",
    "created_at": "2017-04-11T15:44:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22701#issuecomment-312645",
    "user": "https://github.com/mkoeppe"
}
```

I think we could have a separate "lazy" backend that can only hold a given Hrep or Vrep. Whenever anything needs to be computed that requires the other representation, one could change to an actual backend.



---

archive/issue_comments_312646.json:
```json
{
    "body": "New commits:",
    "created_at": "2018-09-30T05:53:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22701#issuecomment-312646",
    "user": "https://github.com/mkoeppe"
}
```

New commits:



---

archive/issue_events_059143.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2018-09-30T05:53:51Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/22701",
    "milestone": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22701#event-59143"
}
```



---

archive/issue_comments_312647.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-09-30T05:53:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22701#issuecomment-312647",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_312648.json:
```json
{
    "body": "One little thing:\n\n```diff\n-raise ValueError(\"If both Vrep and Hrep are provided, they must be minimal and Vrep_minimal and Hrep_minimal must be set True to indicate this.\")\n+raise ValueError(\"if both Vrep and Hrep are provided, they must be minimal\"\n                  \" and Vrep_minimal and Hrep_minimal must both be True\")\n```\nOtherwise LGTM.\n\n---\n\nOne good way to do things lazily is use the ``@`lazy_attribute`. It also works well when setting `self._foo = x`.\n\n```\nsage: class Foo(object):\n....:     @lazy_attribute\n....:     def test(self):\n....:         return [x for x in WeylGroup(['E',8],prefix='s')]\n....:     \nsage: F = Foo()\nsage: F.test = 5\nsage: F.test\n5\nsage: B = Foo()\nsage: B.test  # This will take a while\n```",
    "created_at": "2018-09-30T07:54:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22701#issuecomment-312648",
    "user": "https://github.com/tscrim"
}
```

One little thing:

```diff
-raise ValueError("If both Vrep and Hrep are provided, they must be minimal and Vrep_minimal and Hrep_minimal must be set True to indicate this.")
+raise ValueError("if both Vrep and Hrep are provided, they must be minimal"
                  " and Vrep_minimal and Hrep_minimal must both be True")
```
Otherwise LGTM.

---

One good way to do things lazily is use the ``@`lazy_attribute`. It also works well when setting `self._foo = x`.

```
sage: class Foo(object):
....:     @lazy_attribute
....:     def test(self):
....:         return [x for x in WeylGroup(['E',8],prefix='s')]
....:     
sage: F = Foo()
sage: F.test = 5
sage: F.test
5
sage: B = Foo()
sage: B.test  # This will take a while
```



---

archive/issue_comments_312649.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-09-30T08:46:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22701#issuecomment-312649",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_312650.json:
```json
{
    "body": "(Thanks for the info on lazy_attribute. I've opened ticket #26366 for possible discussion of a lazy backend; but I do not plan to work on it.)",
    "created_at": "2018-09-30T08:58:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22701#issuecomment-312650",
    "user": "https://github.com/mkoeppe"
}
```

(Thanks for the info on lazy_attribute. I've opened ticket #26366 for possible discussion of a lazy backend; but I do not plan to work on it.)



---

archive/issue_comments_312651.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-09-30T13:11:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22701#issuecomment-312651",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_312652.json:
```json
{
    "body": "Thanks.",
    "created_at": "2018-09-30T13:11:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22701#issuecomment-312652",
    "user": "https://github.com/tscrim"
}
```

Thanks.



---

archive/issue_comments_312653.json:
```json
{
    "body": "Thank you for the review.",
    "created_at": "2018-09-30T17:15:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22701#issuecomment-312653",
    "user": "https://github.com/mkoeppe"
}
```

Thank you for the review.



---

archive/issue_events_059144.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-10-01T22:35:47Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/22701",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22701#event-59144"
}
```



---

archive/issue_comments_312654.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-10-01T22:35:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22701#issuecomment-312654",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
