# Issue 22701: Setting up a Polyhedron from both Vrep and Hrep - for backend='field'

archive/issues_022464.json:
```json
{
    "body": "Currently, only one of the two is allowed.\nFor at least some backends (certainly, the generic (`\"field\"`) backend and polymake (#22683)), it makes sense to initialize with both if they are known, to avoid expensive recomputation.  (This could also be the basis of code that delegates to a particular backend for particular features.)\nUsers should also be allowed to indicate whether the given presentations are already minimal.\n\nIn this ticket, we implement this for `Polyhedron_field`, enabling fast `base_extend`.\n\nWhen both V-rep and H-rep are given, they must be minimal; the interface is designed to allow for future extensions.\n\nThe top-level constructor `Polyhedron` is unchanged in this ticket. It is still an error if `Polyhedron(vertices=..., inequalities=...)` is attempted. \n\nWithout this ticket:\n\n```\nsage: p = polytopes.hypercube(6, backend='ppl')\nsage: %time q = p.base_extend(AA)\nCPU times: user 2.27 s, sys: 10.3 ms, total: 2.28 s\nWall time: 2.28 s\nsage: q\nA 6-dimensional polyhedron in AA^6 defined as the convex hull of 64 vertices\n```\n\nWith this ticket:\n\n```\nCPU times: user 13.4 ms, sys: 603 \u00b5s, total: 14 ms\nWall time: 14.9 ms\n```\n\n\nRelated: \n- #17339: `Polyhedron` class mistreats empty inputs\n\nFollow-up:\n- #26368: Setting up a `Polyhedron` from both Vrep and Hrep - for `backend='polymake'`\n- #26366: `Polyhedron` - lazy backend; minimal vs. non-minimal presentations; `Polyhedron` constructor with both Vrep, Hrep\n\nCC:  @jplab @mforets @mo271 @novoselt @tscrim\n\nKeywords: polytope, geometry, days84\n\nBranch/Commit: e34d84523dbb0602c1ca73d6ea3a59bb79f66425\n\nReviewer: Travis Scrimshaw\n\nAuthor: Matthias Koeppe\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/22701\n\n",
    "closed_at": "2018-10-01T22:35:47Z",
    "created_at": "2017-03-28T18:25:43Z",
    "labels": [
        "component: geometry"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.4",
    "title": "Setting up a Polyhedron from both Vrep and Hrep - for backend='field'",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22701",
    "user": "https://github.com/mkoeppe"
}
```
Currently, only one of the two is allowed.
For at least some backends (certainly, the generic (`"field"`) backend and polymake (#22683)), it makes sense to initialize with both if they are known, to avoid expensive recomputation.  (This could also be the basis of code that delegates to a particular backend for particular features.)
Users should also be allowed to indicate whether the given presentations are already minimal.

In this ticket, we implement this for `Polyhedron_field`, enabling fast `base_extend`.

When both V-rep and H-rep are given, they must be minimal; the interface is designed to allow for future extensions.

The top-level constructor `Polyhedron` is unchanged in this ticket. It is still an error if `Polyhedron(vertices=..., inequalities=...)` is attempted. 

Without this ticket:

```
sage: p = polytopes.hypercube(6, backend='ppl')
sage: %time q = p.base_extend(AA)
CPU times: user 2.27 s, sys: 10.3 ms, total: 2.28 s
Wall time: 2.28 s
sage: q
A 6-dimensional polyhedron in AA^6 defined as the convex hull of 64 vertices
```

With this ticket:

```
CPU times: user 13.4 ms, sys: 603 Âµs, total: 14 ms
Wall time: 14.9 ms
```


Related: 
- #17339: `Polyhedron` class mistreats empty inputs

Follow-up:
- #26368: Setting up a `Polyhedron` from both Vrep and Hrep - for `backend='polymake'`
- #26366: `Polyhedron` - lazy backend; minimal vs. non-minimal presentations; `Polyhedron` constructor with both Vrep, Hrep

CC:  @jplab @mforets @mo271 @novoselt @tscrim

Keywords: polytope, geometry, days84

Branch/Commit: e34d84523dbb0602c1ca73d6ea3a59bb79f66425

Reviewer: Travis Scrimshaw

Author: Matthias Koeppe

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/22701





---

archive/issue_comments_423056.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -3,6 +3,9 @@\n Users should also be allowed to indicate whether the given presentations are already minimal.\n \n In particular this could help to implement a fast version of `change_backend()` (#22575) and could be the basis of code that delegates to a particular backend for particular features.\n+\n+Related: \n+- #17339: Polyhedron class mistreats empty inputs\n \n Comment: 1\n \n``````\n",
    "created_at": "2017-03-28T18:34:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22701#issuecomment-423056",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -3,6 +3,9 @@
 Users should also be allowed to indicate whether the given presentations are already minimal.
 
 In particular this could help to implement a fast version of `change_backend()` (#22575) and could be the basis of code that delegates to a particular backend for particular features.
+
+Related: 
+- #17339: Polyhedron class mistreats empty inputs
 
 Comment: 1
 
``````




---

archive/issue_comments_423057.json:
```json
{
    "body": "<a id='comment:4'></a>in another software you can instantiate a polyhedron with \"just\" the h-rep (or v-rep), and compute the complementary representation on-demand. this is useful especially when you work in high dimensions, and makes sense because there are questions which only rely on having just one representation.\n\nso i wonder if this can be considered in this ticket, something like a keyword argument  `compute_complementary_representation` which is true by default, to cover those use cases.",
    "created_at": "2017-04-11T15:40:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22701#issuecomment-423057",
    "user": "https://github.com/mforets"
}
```

<a id='comment:4'></a>in another software you can instantiate a polyhedron with "just" the h-rep (or v-rep), and compute the complementary representation on-demand. this is useful especially when you work in high dimensions, and makes sense because there are questions which only rely on having just one representation.

so i wonder if this can be considered in this ticket, something like a keyword argument  `compute_complementary_representation` which is true by default, to cover those use cases.



---

archive/issue_comments_423058.json:
```json
{
    "body": "<a id='comment:5'></a>I think we could have a separate \"lazy\" backend that can only hold a given Hrep or Vrep. Whenever anything needs to be computed that requires the other representation, one could change to an actual backend.",
    "created_at": "2017-04-11T15:44:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22701#issuecomment-423058",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:5'></a>I think we could have a separate "lazy" backend that can only hold a given Hrep or Vrep. Whenever anything needs to be computed that requires the other representation, one could change to an actual backend.



---

archive/issue_comments_423059.json:
```json
{
    "body": "Changing branch from \"\" to \"u/mkoeppe/setting_up_a_polyhedron_from_both_vrep_and_hrep\"",
    "created_at": "2018-09-30T05:43:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22701#issuecomment-423059",
    "user": "https://github.com/mkoeppe"
}
```

Changing branch from "" to "u/mkoeppe/setting_up_a_polyhedron_from_both_vrep_and_hrep"



---

archive/issue_comments_423060.json:
```json
{
    "body": "Changing commit from \"\" to \"6d91f255cacaf7fb89b3a8ad1ebcc470e7ef7437\"",
    "created_at": "2018-09-30T05:53:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22701#issuecomment-423060",
    "user": "https://github.com/mkoeppe"
}
```

Changing commit from "" to "6d91f255cacaf7fb89b3a8ad1ebcc470e7ef7437"



---

archive/issue_comments_423061.json:
```json
{
    "body": "Changing author from \"\" to \"Matthias Koeppe\"",
    "created_at": "2018-09-30T05:53:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22701#issuecomment-423061",
    "user": "https://github.com/mkoeppe"
}
```

Changing author from "" to "Matthias Koeppe"



---

archive/issue_comments_423062.json:
```json
{
    "body": "<a id='comment:7'></a>New commits:",
    "created_at": "2018-09-30T05:53:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22701#issuecomment-423062",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:7'></a>New commits:



---

archive/issue_comments_423063.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,34 @@\n+Currently, only one of the two is allowed.\n+For at least some backends (certainly, the generic (`\"field\"`) backend and polymake (#22683)), it makes sense to initialize with both if they are known, to avoid expensive recomputation.  (This could also be the basis of code that delegates to a particular backend for particular features.)\n+Users should also be allowed to indicate whether the given presentations are already minimal.\n \n+In this ticket, we implement this for `Polyhedron_field`, enabling fast `base_extend`.\n+\n+When both V-rep and H-rep are given, they must be minimal; the interface is designed to allow for future extensions.\n+\n+The top-level constructor `Polyhedron` is unchanged in this ticket. It is still an error if `Polyhedron(vertices=..., inequalities=...)` is attempted. \n+\n+Without this ticket:\n+\n+```\n+sage: p = polytopes.hypercube(6, backend='ppl')\n+sage: %time q = p.base_extend(AA)\n+CPU times: user 2.27 s, sys: 10.3 ms, total: 2.28 s\n+Wall time: 2.28 s\n+sage: q\n+A 6-dimensional polyhedron in AA^6 defined as the convex hull of 64 vertices\n+```\n+\n+With this ticket:\n+\n+```\n+CPU times: user 13.4 ms, sys: 603 \u00b5s, total: 14 ms\n+Wall time: 14.9 ms\n+```\n+\n+\n+Related: \n+- #17339: Polyhedron class mistreats empty inputs\n \n Comment: 1\n \n``````\n",
    "created_at": "2018-09-30T05:53:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22701#issuecomment-423063",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,34 @@
+Currently, only one of the two is allowed.
+For at least some backends (certainly, the generic (`"field"`) backend and polymake (#22683)), it makes sense to initialize with both if they are known, to avoid expensive recomputation.  (This could also be the basis of code that delegates to a particular backend for particular features.)
+Users should also be allowed to indicate whether the given presentations are already minimal.
 
+In this ticket, we implement this for `Polyhedron_field`, enabling fast `base_extend`.
+
+When both V-rep and H-rep are given, they must be minimal; the interface is designed to allow for future extensions.
+
+The top-level constructor `Polyhedron` is unchanged in this ticket. It is still an error if `Polyhedron(vertices=..., inequalities=...)` is attempted. 
+
+Without this ticket:
+
+```
+sage: p = polytopes.hypercube(6, backend='ppl')
+sage: %time q = p.base_extend(AA)
+CPU times: user 2.27 s, sys: 10.3 ms, total: 2.28 s
+Wall time: 2.28 s
+sage: q
+A 6-dimensional polyhedron in AA^6 defined as the convex hull of 64 vertices
+```
+
+With this ticket:
+
+```
+CPU times: user 13.4 ms, sys: 603 Âµs, total: 14 ms
+Wall time: 14.9 ms
+```
+
+
+Related: 
+- #17339: Polyhedron class mistreats empty inputs
 
 Comment: 1
 
``````




---

archive/issue_events_059143.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2018-09-30T05:53:51Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/22701",
    "milestone": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22701#event-59143"
}
```



---

archive/issue_comments_423064.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-09-30T05:53:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22701#issuecomment-423064",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_423065.json:
```json
{
    "body": "<a id='comment:8'></a>One little thing:\n\n```diff\n-raise ValueError(\"If both Vrep and Hrep are provided, they must be minimal and Vrep_minimal and Hrep_minimal must be set True to indicate this.\")\n+raise ValueError(\"if both Vrep and Hrep are provided, they must be minimal\"\n                  \" and Vrep_minimal and Hrep_minimal must both be True\")\n```\nOtherwise LGTM.\n\n---\n\nOne good way to do things lazily is use the ``@`lazy_attribute`. It also works well when setting `self._foo = x`.\n\n```\nsage: class Foo(object):\n....:     @lazy_attribute\n....:     def test(self):\n....:         return [x for x in WeylGroup(['E',8],prefix='s')]\n....:     \nsage: F = Foo()\nsage: F.test = 5\nsage: F.test\n5\nsage: B = Foo()\nsage: B.test  # This will take a while\n```",
    "created_at": "2018-09-30T07:54:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22701#issuecomment-423065",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:8'></a>One little thing:

```diff
-raise ValueError("If both Vrep and Hrep are provided, they must be minimal and Vrep_minimal and Hrep_minimal must be set True to indicate this.")
+raise ValueError("if both Vrep and Hrep are provided, they must be minimal"
                  " and Vrep_minimal and Hrep_minimal must both be True")
```
Otherwise LGTM.

---

One good way to do things lazily is use the ``@`lazy_attribute`. It also works well when setting `self._foo = x`.

```
sage: class Foo(object):
....:     @lazy_attribute
....:     def test(self):
....:         return [x for x in WeylGroup(['E',8],prefix='s')]
....:     
sage: F = Foo()
sage: F.test = 5
sage: F.test
5
sage: B = Foo()
sage: B.test  # This will take a while
```



---

archive/issue_comments_423066.json:
```json
{
    "body": "Changing commit from \"6d91f255cacaf7fb89b3a8ad1ebcc470e7ef7437\" to \"e34d84523dbb0602c1ca73d6ea3a59bb79f66425\"",
    "created_at": "2018-09-30T08:46:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22701#issuecomment-423066",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "6d91f255cacaf7fb89b3a8ad1ebcc470e7ef7437" to "e34d84523dbb0602c1ca73d6ea3a59bb79f66425"



---

archive/issue_comments_423067.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-09-30T08:46:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22701#issuecomment-423067",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_423068.json:
```json
{
    "body": "<a id='comment:10'></a>(Thanks for the info on lazy_attribute. I've opened ticket #26366 for possible discussion of a lazy backend; but I do not plan to work on it.)",
    "created_at": "2018-09-30T08:58:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22701#issuecomment-423068",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:10'></a>(Thanks for the info on lazy_attribute. I've opened ticket #26366 for possible discussion of a lazy backend; but I do not plan to work on it.)



---

archive/issue_comments_423069.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Travis Scrimshaw\"",
    "created_at": "2018-09-30T13:11:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22701#issuecomment-423069",
    "user": "https://github.com/tscrim"
}
```

Changing reviewer from "" to "Travis Scrimshaw"



---

archive/issue_comments_423070.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-09-30T13:11:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22701#issuecomment-423070",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_423071.json:
```json
{
    "body": "<a id='comment:11'></a>Thanks.",
    "created_at": "2018-09-30T13:11:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22701#issuecomment-423071",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:11'></a>Thanks.



---

archive/issue_comments_423072.json:
```json
{
    "body": "<a id='comment:12'></a>Thank you for the review.",
    "created_at": "2018-09-30T17:15:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22701#issuecomment-423072",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:12'></a>Thank you for the review.



---

archive/issue_comments_423073.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,38 @@\n+Currently, only one of the two is allowed.\n+For at least some backends (certainly, the generic (`\"field\"`) backend and polymake (#22683)), it makes sense to initialize with both if they are known, to avoid expensive recomputation.  (This could also be the basis of code that delegates to a particular backend for particular features.)\n+Users should also be allowed to indicate whether the given presentations are already minimal.\n \n+In this ticket, we implement this for `Polyhedron_field`, enabling fast `base_extend`.\n+\n+When both V-rep and H-rep are given, they must be minimal; the interface is designed to allow for future extensions.\n+\n+The top-level constructor `Polyhedron` is unchanged in this ticket. It is still an error if `Polyhedron(vertices=..., inequalities=...)` is attempted. \n+\n+Without this ticket:\n+\n+```\n+sage: p = polytopes.hypercube(6, backend='ppl')\n+sage: %time q = p.base_extend(AA)\n+CPU times: user 2.27 s, sys: 10.3 ms, total: 2.28 s\n+Wall time: 2.28 s\n+sage: q\n+A 6-dimensional polyhedron in AA^6 defined as the convex hull of 64 vertices\n+```\n+\n+With this ticket:\n+\n+```\n+CPU times: user 13.4 ms, sys: 603 \u00b5s, total: 14 ms\n+Wall time: 14.9 ms\n+```\n+\n+\n+Related: \n+- #17339: `Polyhedron` class mistreats empty inputs\n+\n+Follow-up:\n+- #26368: Setting up a `Polyhedron` from both Vrep and Hrep - for `backend='polymake'`\n+- #26366: `Polyhedron` - lazy backend; minimal vs. non-minimal presentations; `Polyhedron` constructor with both Vrep, Hrep\n \n Comment: 1\n \n``````\n",
    "created_at": "2018-09-30T17:27:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22701#issuecomment-423073",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,38 @@
+Currently, only one of the two is allowed.
+For at least some backends (certainly, the generic (`"field"`) backend and polymake (#22683)), it makes sense to initialize with both if they are known, to avoid expensive recomputation.  (This could also be the basis of code that delegates to a particular backend for particular features.)
+Users should also be allowed to indicate whether the given presentations are already minimal.
 
+In this ticket, we implement this for `Polyhedron_field`, enabling fast `base_extend`.
+
+When both V-rep and H-rep are given, they must be minimal; the interface is designed to allow for future extensions.
+
+The top-level constructor `Polyhedron` is unchanged in this ticket. It is still an error if `Polyhedron(vertices=..., inequalities=...)` is attempted. 
+
+Without this ticket:
+
+```
+sage: p = polytopes.hypercube(6, backend='ppl')
+sage: %time q = p.base_extend(AA)
+CPU times: user 2.27 s, sys: 10.3 ms, total: 2.28 s
+Wall time: 2.28 s
+sage: q
+A 6-dimensional polyhedron in AA^6 defined as the convex hull of 64 vertices
+```
+
+With this ticket:
+
+```
+CPU times: user 13.4 ms, sys: 603 Âµs, total: 14 ms
+Wall time: 14.9 ms
+```
+
+
+Related: 
+- #17339: `Polyhedron` class mistreats empty inputs
+
+Follow-up:
+- #26368: Setting up a `Polyhedron` from both Vrep and Hrep - for `backend='polymake'`
+- #26366: `Polyhedron` - lazy backend; minimal vs. non-minimal presentations; `Polyhedron` constructor with both Vrep, Hrep
 
 Comment: 1
 
``````




---

archive/issue_events_059144.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-10-01T22:35:47Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/22701",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22701#event-59144"
}
```



---

archive/issue_comments_423074.json:
```json
{
    "body": "Changing branch from \"u/mkoeppe/setting_up_a_polyhedron_from_both_vrep_and_hrep\" to \"e34d84523dbb0602c1ca73d6ea3a59bb79f66425\"",
    "created_at": "2018-10-01T22:35:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22701#issuecomment-423074",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/mkoeppe/setting_up_a_polyhedron_from_both_vrep_and_hrep" to "e34d84523dbb0602c1ca73d6ea3a59bb79f66425"



---

archive/issue_comments_423075.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-10-01T22:35:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22701#issuecomment-423075",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
