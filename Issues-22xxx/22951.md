# Issue 22951: Integrated curves and geodesics on manifolds

archive/issues_022714.json:
```json
{
    "assignees": [],
    "body": "This ticket implements curves defined by a system of differential equations, in particular geodesics on differentiable manifolds.\n\nThis is part of the \u200b[SageManifolds project](http://sagemanifolds.obspm.fr/) ; see the metaticket #18528 for an overview. \n\nCC:  @egourgoulhon @sagetrac-mbejger @man74cio @tscrim\n\nKeywords: **curve, geodesic**\n\nBranch/Commit: **[`1c7e727`](https://github.com/sagemath/sagetrac-mirror/commit/1c7e7279ab269d9ac9e05696eac77a2fe5cdbf3e)**\n\nReviewer: **Eric Gourgoulhon, Travis Scrimshaw**\n\nAuthor: **Karim Van Aelst**\n\nComponent: **geometry**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/22951_\n\n",
    "closed_at": "2017-08-11T18:18:06Z",
    "created_at": "2017-05-05T15:01:10Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20geometry",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement",
        "https://github.com/sagemath/sage/labels/c%3A%20manifolds"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Integrated curves and geodesics on manifolds",
    "type": "issue",
    "updated_at": "2017-08-11T18:18:06Z",
    "url": "https://github.com/sagemath/sage/issues/22951",
    "user": "https://github.com/sagetrac-karimvanaelst"
}
```
This ticket implements curves defined by a system of differential equations, in particular geodesics on differentiable manifolds.

This is part of the ​[SageManifolds project](http://sagemanifolds.obspm.fr/) ; see the metaticket #18528 for an overview. 

CC:  @egourgoulhon @sagetrac-mbejger @man74cio @tscrim

Keywords: **curve, geodesic**

Branch/Commit: **[`1c7e727`](https://github.com/sagemath/sagetrac-mirror/commit/1c7e7279ab269d9ac9e05696eac77a2fe5cdbf3e)**

Reviewer: **Eric Gourgoulhon, Travis Scrimshaw**

Author: **Karim Van Aelst**

Component: **geometry**

_Issue created by migration from https://trac.sagemath.org/ticket/22951_





---

archive/issue_events_321575.json:
```json
{
    "actor": "https://github.com/sagetrac-karimvanaelst",
    "created_at": "2017-05-05T15:01:10Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/22951",
    "milestone_number": null,
    "milestone_title": "sage-8.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22951#event-321575"
}
```



---

archive/issue_events_321576.json:
```json
{
    "actor": "https://github.com/sagetrac-karimvanaelst",
    "created_at": "2017-05-05T15:01:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22951",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20geometry",
    "label_color": "0000ff",
    "label_name": "c: geometry",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22951#event-321576"
}
```



---

archive/issue_events_321577.json:
```json
{
    "actor": "https://github.com/sagetrac-karimvanaelst",
    "created_at": "2017-05-05T15:01:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22951",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22951#event-321577"
}
```



---

archive/issue_events_321578.json:
```json
{
    "actor": "https://github.com/sagetrac-karimvanaelst",
    "created_at": "2017-05-05T15:01:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22951",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22951#event-321578"
}
```



---

archive/issue_events_321579.json:
```json
{
    "actor": "https://github.com/sagetrac-karimvanaelst",
    "created_at": "2017-05-05T15:01:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22951",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20manifolds",
    "label_color": "eeeeee",
    "label_name": "c: manifolds",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22951#event-321579"
}
```



---

archive/issue_comments_342730.json:
```json
{
    "body": "Changed commit from **[`c58d902`](https://github.com/sagemath/sagetrac-mirror/commit/c58d90285342fe430a186343b3ca2d86b905802c)** to **[`2328a7f`](https://github.com/sagemath/sagetrac-mirror/commit/2328a7f7a61314952a72fd35a269770b5e2bb114)**",
    "created_at": "2017-05-31T13:04:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22951#issuecomment-342730",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`c58d902`](https://github.com/sagemath/sagetrac-mirror/commit/c58d90285342fe430a186343b3ca2d86b905802c)** to **[`2328a7f`](https://github.com/sagemath/sagetrac-mirror/commit/2328a7f7a61314952a72fd35a269770b5e2bb114)**



---

archive/issue_comments_342731.json:
```json
{
    "body": "<div id=\"comment:1\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2328a7f7a61314952a72fd35a269770b5e2bb114\"><code>2328a7f</code></a></td><td><code>bugsremoved, documentation completed, mapping implemented</code></td></tr></table>\n",
    "created_at": "2017-05-31T13:04:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22951#issuecomment-342731",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:1"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2328a7f7a61314952a72fd35a269770b5e2bb114"><code>2328a7f</code></a></td><td><code>bugsremoved, documentation completed, mapping implemented</code></td></tr></table>




---

archive/issue_comments_342732.json:
```json
{
    "body": "Changed commit from **[`2328a7f`](https://github.com/sagemath/sagetrac-mirror/commit/2328a7f7a61314952a72fd35a269770b5e2bb114)** to **[`6928d9d`](https://github.com/sagemath/sagetrac-mirror/commit/6928d9df219e28a5a94af9a8ab5d133bb49ae001)**",
    "created_at": "2017-06-23T19:03:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22951#issuecomment-342732",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`2328a7f`](https://github.com/sagemath/sagetrac-mirror/commit/2328a7f7a61314952a72fd35a269770b5e2bb114)** to **[`6928d9d`](https://github.com/sagemath/sagetrac-mirror/commit/6928d9df219e28a5a94af9a8ab5d133bb49ae001)**



---

archive/issue_comments_342733.json:
```json
{
    "body": "<div id=\"comment:3\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6928d9df219e28a5a94af9a8ab5d133bb49ae001\"><code>6928d9d</code></a></td><td><code>more numerical solvers, an analytical solver, parents, parameters detected</code></td></tr></table>\n",
    "created_at": "2017-06-23T19:03:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22951#issuecomment-342733",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:3"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6928d9df219e28a5a94af9a8ab5d133bb49ae001"><code>6928d9d</code></a></td><td><code>more numerical solvers, an analytical solver, parents, parameters detected</code></td></tr></table>




---

archive/issue_events_321580.json:
```json
{
    "actor": "https://github.com/sagetrac-karimvanaelst",
    "created_at": "2017-06-25T13:02:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22951",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22951#event-321580"
}
```



---

archive/issue_comments_342734.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nThank you very much for this piece of work! It's a great enhancement to manifolds in Sage. Moreover the code looks very good and the documentation is carefully written and nice. A first quick comments (more will follow):\n\n- Some doctests fail due to some extra (debug?) messages:\n\n```\nFile \"src/sage/manifolds/differentiable/manifold_homset.py\", line 575, in sage.manifolds.differentiable.manifold_homset.IntegratedCurveSet\nFailed example:\n    c = H(eqns_rhs, vels, t, v, name='c') ; c\nExpected:\n    Integrated curve c in the 2-dimensional differentiable\n     manifold M\nGot:\n    The curve was correctly set.\n    No parameter appears in the differential system defining the curve.\n    Integrated curve c in the 2-dimensional differentiable manifold M\n```\n- Another doctest failure is that of `c.__reduce__()` in line 556 of `integrated_curve.py`, apparently due to `<class 'sage.manifolds.differentiable.manifold_homset.IntegratedCurveSet_with_category.element_class'>` appearing instead of `<class 'sage.manifolds.differentiable.integrated_curve.IntegratedCurveSet_with_category.element_class'>`\n\n- Some methods are too verbose, e.g. `solve`, `tangent_vector_eval_at`, `plot_integrated` and `__call__` in class `IntegratedCurve`; `verbose=False` should be the default (this seems a general policy in Sage)\n\n- The documentation fails to build: \n  * in `integrated_curve.py`, line 1712: the continuation mark `....:` is invalid in a plot directive; line 2413: a final quote is missing in `'epolar_ON)`\n  * in `manifold_homset.py`, lines 938 and 1386:  `EXAMPLES:` must be replaced by `EXAMPLES::`",
    "created_at": "2017-06-25T15:10:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22951#issuecomment-342734",
    "user": "https://github.com/egourgoulhon"
}
```

<div id="comment:5" align="right">comment:5</div>

Thank you very much for this piece of work! It's a great enhancement to manifolds in Sage. Moreover the code looks very good and the documentation is carefully written and nice. A first quick comments (more will follow):

- Some doctests fail due to some extra (debug?) messages:

```
File "src/sage/manifolds/differentiable/manifold_homset.py", line 575, in sage.manifolds.differentiable.manifold_homset.IntegratedCurveSet
Failed example:
    c = H(eqns_rhs, vels, t, v, name='c') ; c
Expected:
    Integrated curve c in the 2-dimensional differentiable
     manifold M
Got:
    The curve was correctly set.
    No parameter appears in the differential system defining the curve.
    Integrated curve c in the 2-dimensional differentiable manifold M
```
- Another doctest failure is that of `c.__reduce__()` in line 556 of `integrated_curve.py`, apparently due to `<class 'sage.manifolds.differentiable.manifold_homset.IntegratedCurveSet_with_category.element_class'>` appearing instead of `<class 'sage.manifolds.differentiable.integrated_curve.IntegratedCurveSet_with_category.element_class'>`

- Some methods are too verbose, e.g. `solve`, `tangent_vector_eval_at`, `plot_integrated` and `__call__` in class `IntegratedCurve`; `verbose=False` should be the default (this seems a general policy in Sage)

- The documentation fails to build: 
  * in `integrated_curve.py`, line 1712: the continuation mark `....:` is invalid in a plot directive; line 2413: a final quote is missing in `'epolar_ON)`
  * in `manifold_homset.py`, lines 938 and 1386:  `EXAMPLES:` must be replaced by `EXAMPLES::`



---

archive/issue_events_321581.json:
```json
{
    "actor": "https://github.com/egourgoulhon",
    "created_at": "2017-06-25T15:10:57Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22951",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22951#event-321581"
}
```



---

archive/issue_events_321582.json:
```json
{
    "actor": "https://github.com/egourgoulhon",
    "created_at": "2017-06-25T15:10:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22951",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22951#event-321582"
}
```



---

archive/issue_comments_342735.json:
```json
{
    "body": "Reviewer: **Eric Gourgoulhon**",
    "created_at": "2017-06-25T15:10:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22951#issuecomment-342735",
    "user": "https://github.com/egourgoulhon"
}
```

Reviewer: **Eric Gourgoulhon**



---

archive/issue_comments_342736.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nA few more comments:\n- Do not use `.keys()` to iterate over the keys of a dictionary, but simply the dictionary itself, i.e. replace `for key in parameters_values.keys():` by `for key in parameters_values:`. Similarly, do not use `.keys()` to check for a key in a dictionary, i.e. replace `if 'cubic spline' in self._interpolations.keys():` by `if 'cubic spline' in self._interpolations:`\n- The rendering of some math formulas in the html documentation is not correct: the antislashes must be suppressed in `(v\\_th0, v\\_ph0)` and `epolar\\_ON`, etc. Morevover, some `:MATH:` appear explicitely in the html output (example in the documentation of class `IntegratedAutoparallelCurve`). \n- In the documentation of `solve_analytical`, do not write \n\n```\nboolean 'FALSE'\n``` \nbut \n\n```\nboolean ``False``\n```",
    "created_at": "2017-06-25T16:02:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22951#issuecomment-342736",
    "user": "https://github.com/egourgoulhon"
}
```

<div id="comment:6" align="right">comment:6</div>

A few more comments:
- Do not use `.keys()` to iterate over the keys of a dictionary, but simply the dictionary itself, i.e. replace `for key in parameters_values.keys():` by `for key in parameters_values:`. Similarly, do not use `.keys()` to check for a key in a dictionary, i.e. replace `if 'cubic spline' in self._interpolations.keys():` by `if 'cubic spline' in self._interpolations:`
- The rendering of some math formulas in the html documentation is not correct: the antislashes must be suppressed in `(v\_th0, v\_ph0)` and `epolar\_ON`, etc. Morevover, some `:MATH:` appear explicitely in the html output (example in the documentation of class `IntegratedAutoparallelCurve`). 
- In the documentation of `solve_analytical`, do not write 

```
boolean 'FALSE'
``` 
but 

```
boolean ``False``
```



---

archive/issue_comments_342737.json:
```json
{
    "body": "<div id=\"comment:7\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1adbcdc288727d60413f08b0dac7a78cae86dd48\"><code>1adbcdc</code></a></td><td><code>corrections to doctests, documentation, iteration over dictionary, and verbose set to False everywhere</code></td></tr></table>\n",
    "created_at": "2017-06-27T08:04:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22951#issuecomment-342737",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:7"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1adbcdc288727d60413f08b0dac7a78cae86dd48"><code>1adbcdc</code></a></td><td><code>corrections to doctests, documentation, iteration over dictionary, and verbose set to False everywhere</code></td></tr></table>




---

archive/issue_comments_342738.json:
```json
{
    "body": "Changed commit from **[`6928d9d`](https://github.com/sagemath/sagetrac-mirror/commit/6928d9df219e28a5a94af9a8ab5d133bb49ae001)** to **[`1adbcdc`](https://github.com/sagemath/sagetrac-mirror/commit/1adbcdc288727d60413f08b0dac7a78cae86dd48)**",
    "created_at": "2017-06-27T08:04:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22951#issuecomment-342738",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`6928d9d`](https://github.com/sagemath/sagetrac-mirror/commit/6928d9df219e28a5a94af9a8ab5d133bb49ae001)** to **[`1adbcdc`](https://github.com/sagemath/sagetrac-mirror/commit/1adbcdc288727d60413f08b0dac7a78cae86dd48)**



---

archive/issue_events_321583.json:
```json
{
    "actor": "https://github.com/sagetrac-karimvanaelst",
    "created_at": "2017-06-27T08:06:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22951",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22951#event-321583"
}
```



---

archive/issue_events_321584.json:
```json
{
    "actor": "https://github.com/sagetrac-karimvanaelst",
    "created_at": "2017-06-27T08:06:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22951",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22951#event-321584"
}
```



---

archive/issue_comments_342739.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nThanks for the changes.\nHere are more comments:\n- There are still some failed doctests:\n\n```\n5 items had failures:\n   1 of  12 in sage.manifolds.differentiable.integrated_curve.IntegratedAutoparallelCurve.__reduce__\n   1 of  27 in sage.manifolds.differentiable.integrated_curve.IntegratedCurve\n   1 of  98 in sage.manifolds.differentiable.integrated_curve.IntegratedCurve.?\n   1 of  13 in sage.manifolds.differentiable.integrated_curve.IntegratedCurve.__reduce__\n   1 of  14 in sage.manifolds.differentiable.integrated_curve.IntegratedGeodesic.__reduce__\n    [369 tests, 5 failures, 43.70 s]\n----------------------------------------------------------------------\nsage -t --long --warn-long 82.5 src/sage/manifolds/differentiable/integrated_curve.py  # 5 doctests failed\n```\n- The method `__call__` of class `IntegratedCurve` should return a manifold point, not a list of coordinates\n- Lines 428-437 of `integrated_curve.py` could be replaced by a mere\n\n```\n        if initial_pt not in chart.domain():\n            raise ValueError(\"initial point should be in the \" +\n                             \"domain of the chart\")\n```\n  Btw notice that, by convention, error messages start with a lower case letter and do not end by any ponctuation mark.\n- To ensure that the `print` function used in `integrated_curve.py` complies with Python3, please insert\n\n``` \nfrom __future__ import print_function\n```\n  in the heading of this file.\n- I am wondering whether it is worth to keep the arguments `is_identity` and  `is_isomorphism` in the `__init__`'s of the integrated curve classes and in the related construction methods of class `DifferentiableManifold`; this adds some code complexity for something which regards only curves *(a,b)* --> **R** and for which it is difficult to imagine a use case... Do you agree?\n- Maybe the documentation TOC would be more descriptive if the title \"Integrated Curves in Manifolds\" in line 2 of `integrated_curve.py` were replaced by \"Integrated Curves and Geodesics in Manifolds\".\n- In the docstring of method `plot_integrated`, the keyword arguments `display_tangent`, `plot_points_tangent`, `color_tangent` and `width_tangent` are not documented.\n- In the second sentence of the main docstring in `manifold_homset.py`, starting line 9, the classes `IntegratedCurveSet`, `IntegratedAutoparallelCurveSet` and `IntegratedGeodesicSet` should be added to the list of subclasses of `DifferentiableManifoldHomset`",
    "created_at": "2017-07-02T15:35:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22951#issuecomment-342739",
    "user": "https://github.com/egourgoulhon"
}
```

<div id="comment:9" align="right">comment:9</div>

Thanks for the changes.
Here are more comments:
- There are still some failed doctests:

```
5 items had failures:
   1 of  12 in sage.manifolds.differentiable.integrated_curve.IntegratedAutoparallelCurve.__reduce__
   1 of  27 in sage.manifolds.differentiable.integrated_curve.IntegratedCurve
   1 of  98 in sage.manifolds.differentiable.integrated_curve.IntegratedCurve.?
   1 of  13 in sage.manifolds.differentiable.integrated_curve.IntegratedCurve.__reduce__
   1 of  14 in sage.manifolds.differentiable.integrated_curve.IntegratedGeodesic.__reduce__
    [369 tests, 5 failures, 43.70 s]
----------------------------------------------------------------------
sage -t --long --warn-long 82.5 src/sage/manifolds/differentiable/integrated_curve.py  # 5 doctests failed
```
- The method `__call__` of class `IntegratedCurve` should return a manifold point, not a list of coordinates
- Lines 428-437 of `integrated_curve.py` could be replaced by a mere

```
        if initial_pt not in chart.domain():
            raise ValueError("initial point should be in the " +
                             "domain of the chart")
```
  Btw notice that, by convention, error messages start with a lower case letter and do not end by any ponctuation mark.
- To ensure that the `print` function used in `integrated_curve.py` complies with Python3, please insert

``` 
from __future__ import print_function
```
  in the heading of this file.
- I am wondering whether it is worth to keep the arguments `is_identity` and  `is_isomorphism` in the `__init__`'s of the integrated curve classes and in the related construction methods of class `DifferentiableManifold`; this adds some code complexity for something which regards only curves *(a,b)* --> **R** and for which it is difficult to imagine a use case... Do you agree?
- Maybe the documentation TOC would be more descriptive if the title "Integrated Curves in Manifolds" in line 2 of `integrated_curve.py` were replaced by "Integrated Curves and Geodesics in Manifolds".
- In the docstring of method `plot_integrated`, the keyword arguments `display_tangent`, `plot_points_tangent`, `color_tangent` and `width_tangent` are not documented.
- In the second sentence of the main docstring in `manifold_homset.py`, starting line 9, the classes `IntegratedCurveSet`, `IntegratedAutoparallelCurveSet` and `IntegratedGeodesicSet` should be added to the list of subclasses of `DifferentiableManifoldHomset`



---

archive/issue_comments_342740.json:
```json
{
    "body": "<div id=\"comment:10\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9d1bab6b9124fea8fa8551cb0c3129e9a001452e\"><code>9d1bab6</code></a></td><td><code>Merge branch 'public/manifolds/integrated_curve' of git://trac.sagemath.org/sage into develop</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/80eb4690bd57eb744218ea7f8805d34c8f036156\"><code>80eb469</code></a></td><td><code>doctests failures reported in last review corrected, method `__call__` now returns a manifold point, syntax of error messages corrected, print_function imported, implementation relative to arguments is_identity and is_isomorphism removed (in particular, identity map not implemented by method one of parent classes), documentation completed as suggested in last review, slight corrections in method 'solve'</code></td></tr></table>\n",
    "created_at": "2017-07-07T09:37:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22951#issuecomment-342740",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:10"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9d1bab6b9124fea8fa8551cb0c3129e9a001452e"><code>9d1bab6</code></a></td><td><code>Merge branch 'public/manifolds/integrated_curve' of git://trac.sagemath.org/sage into develop</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/80eb4690bd57eb744218ea7f8805d34c8f036156"><code>80eb469</code></a></td><td><code>doctests failures reported in last review corrected, method `__call__` now returns a manifold point, syntax of error messages corrected, print_function imported, implementation relative to arguments is_identity and is_isomorphism removed (in particular, identity map not implemented by method one of parent classes), documentation completed as suggested in last review, slight corrections in method 'solve'</code></td></tr></table>




---

archive/issue_comments_342741.json:
```json
{
    "body": "Changed commit from **[`1adbcdc`](https://github.com/sagemath/sagetrac-mirror/commit/1adbcdc288727d60413f08b0dac7a78cae86dd48)** to **[`80eb469`](https://github.com/sagemath/sagetrac-mirror/commit/80eb4690bd57eb744218ea7f8805d34c8f036156)**",
    "created_at": "2017-07-07T09:37:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22951#issuecomment-342741",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`1adbcdc`](https://github.com/sagemath/sagetrac-mirror/commit/1adbcdc288727d60413f08b0dac7a78cae86dd48)** to **[`80eb469`](https://github.com/sagemath/sagetrac-mirror/commit/80eb4690bd57eb744218ea7f8805d34c8f036156)**



---

archive/issue_comments_342742.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\n- Doctests failures reported in last review were due to implementation adapted to version 8.0.beta5 instead of version 8.0.rc0; doctests are now consistent with version 8.0.rc0.\n- Method `__call__` of class `IntegratedCurve` now does return a manifold point instead of a list of coordinates, which is indeed much more consistent with the purpose of the class (which is to represent curves in manifold).\n- Former lines 428-437 (which now are lines 440-449) cannot be replaced by the suggested lines, since the fact that some initial coordinates may be expressions needs to be taken into account.\n- `print_function` is now imported.\n- All implementation relative to arguments `is_identity` and `is_isomorphism` is removed. In particular, no identity map is implemented by method `one` of the parent classes; this is justified by the lack of relevance of the identity map within the framework of the classes of this ticket, whose purpose is mainly devoted to numerical issues (therefore, any user is left free to set a numerical version of the identity if needed).\n- The title of the documentation of `integrated_curve.py`, now in line 3, is now \"Integrated Curves and Geodesics in Manifolds\".\n- The documentation of method `plot_integrated` is now complete.\n- The main docstring of `manifold_homset.py` is now complete.\n\n\n\nReplying to [@egourgoulhon](#comment:9):\n> Thanks for the changes.\n> Here are more comments:\n> - There are still some failed doctests:\n> \n> ```\n> 5 items had failures:\n>    1 of  12 in sage.manifolds.differentiable.integrated_curve.IntegratedAutoparallelCurve.__reduce__\n>    1 of  27 in sage.manifolds.differentiable.integrated_curve.IntegratedCurve\n>    1 of  98 in sage.manifolds.differentiable.integrated_curve.IntegratedCurve.?\n>    1 of  13 in sage.manifolds.differentiable.integrated_curve.IntegratedCurve.__reduce__\n>    1 of  14 in sage.manifolds.differentiable.integrated_curve.IntegratedGeodesic.__reduce__\n>     [369 tests, 5 failures, 43.70 s]\n> ----------------------------------------------------------------------\n> sage -t --long --warn-long 82.5 src/sage/manifolds/differentiable/integrated_curve.py  # 5 doctests failed\n> ```\n> - The method `__call__` of class `IntegratedCurve` should return a manifold point, not a list of coordinates\n> - Lines 428-437 of `integrated_curve.py` could be replaced by a mere\n> \n> ```\n>         if initial_pt not in chart.domain():\n>             raise ValueError(\"initial point should be in the \" +\n>                              \"domain of the chart\")\n> ```\n>   Btw notice that, by convention, error messages start with a lower case letter and do not end by any ponctuation mark.\n> - To ensure that the `print` function used in `integrated_curve.py` complies with Python3, please insert\n> \n> ``` \n> from __future__ import print_function\n> ```\n>   in the heading of this file.\n> - I am wondering whether it is worth to keep the arguments `is_identity` and  `is_isomorphism` in the `__init__`'s of the integrated curve classes and in the related construction methods of class `DifferentiableManifold`; this adds some code complexity for something which regards only curves *(a,b)* --> **R** and for which it is difficult to imagine a use case... Do you agree?\n> - Maybe the documentation TOC would be more descriptive if the title \"Integrated Curves in Manifolds\" in line 2 of `integrated_curve.py` were replaced by \"Integrated Curves and Geodesics in Manifolds\".\n> - In the docstring of method `plot_integrated`, the keyword arguments `display_tangent`, `plot_points_tangent`, `color_tangent` and `width_tangent` are not documented.\n> - In the second sentence of the main docstring in `manifold_homset.py`, starting line 9, the classes `IntegratedCurveSet`, `IntegratedAutoparallelCurveSet` and `IntegratedGeodesicSet` should be added to the list of subclasses of `DifferentiableManifoldHomset`",
    "created_at": "2017-07-07T11:14:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22951#issuecomment-342742",
    "user": "https://github.com/sagetrac-karimvanaelst"
}
```

<div id="comment:11" align="right">comment:11</div>

- Doctests failures reported in last review were due to implementation adapted to version 8.0.beta5 instead of version 8.0.rc0; doctests are now consistent with version 8.0.rc0.
- Method `__call__` of class `IntegratedCurve` now does return a manifold point instead of a list of coordinates, which is indeed much more consistent with the purpose of the class (which is to represent curves in manifold).
- Former lines 428-437 (which now are lines 440-449) cannot be replaced by the suggested lines, since the fact that some initial coordinates may be expressions needs to be taken into account.
- `print_function` is now imported.
- All implementation relative to arguments `is_identity` and `is_isomorphism` is removed. In particular, no identity map is implemented by method `one` of the parent classes; this is justified by the lack of relevance of the identity map within the framework of the classes of this ticket, whose purpose is mainly devoted to numerical issues (therefore, any user is left free to set a numerical version of the identity if needed).
- The title of the documentation of `integrated_curve.py`, now in line 3, is now "Integrated Curves and Geodesics in Manifolds".
- The documentation of method `plot_integrated` is now complete.
- The main docstring of `manifold_homset.py` is now complete.



Replying to [@egourgoulhon](#comment:9):
> Thanks for the changes.
> Here are more comments:
> - There are still some failed doctests:
> 
> ```
> 5 items had failures:
>    1 of  12 in sage.manifolds.differentiable.integrated_curve.IntegratedAutoparallelCurve.__reduce__
>    1 of  27 in sage.manifolds.differentiable.integrated_curve.IntegratedCurve
>    1 of  98 in sage.manifolds.differentiable.integrated_curve.IntegratedCurve.?
>    1 of  13 in sage.manifolds.differentiable.integrated_curve.IntegratedCurve.__reduce__
>    1 of  14 in sage.manifolds.differentiable.integrated_curve.IntegratedGeodesic.__reduce__
>     [369 tests, 5 failures, 43.70 s]
> ----------------------------------------------------------------------
> sage -t --long --warn-long 82.5 src/sage/manifolds/differentiable/integrated_curve.py  # 5 doctests failed
> ```
> - The method `__call__` of class `IntegratedCurve` should return a manifold point, not a list of coordinates
> - Lines 428-437 of `integrated_curve.py` could be replaced by a mere
> 
> ```
>         if initial_pt not in chart.domain():
>             raise ValueError("initial point should be in the " +
>                              "domain of the chart")
> ```
>   Btw notice that, by convention, error messages start with a lower case letter and do not end by any ponctuation mark.
> - To ensure that the `print` function used in `integrated_curve.py` complies with Python3, please insert
> 
> ``` 
> from __future__ import print_function
> ```
>   in the heading of this file.
> - I am wondering whether it is worth to keep the arguments `is_identity` and  `is_isomorphism` in the `__init__`'s of the integrated curve classes and in the related construction methods of class `DifferentiableManifold`; this adds some code complexity for something which regards only curves *(a,b)* --> **R** and for which it is difficult to imagine a use case... Do you agree?
> - Maybe the documentation TOC would be more descriptive if the title "Integrated Curves in Manifolds" in line 2 of `integrated_curve.py` were replaced by "Integrated Curves and Geodesics in Manifolds".
> - In the docstring of method `plot_integrated`, the keyword arguments `display_tangent`, `plot_points_tangent`, `color_tangent` and `width_tangent` are not documented.
> - In the second sentence of the main docstring in `manifold_homset.py`, starting line 9, the classes `IntegratedCurveSet`, `IntegratedAutoparallelCurveSet` and `IntegratedGeodesicSet` should be added to the list of subclasses of `DifferentiableManifoldHomset`



---

archive/issue_comments_342743.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nReplying to [@sagetrac-karimvanaelst](#comment:11):\n\nThanks for the changes.\n> - Doctests failures reported in last review were due to implementation adapted to version 8.0.beta5 instead of version 8.0.rc0; doctests are now consistent with version 8.0.rc0.\n\nOK. \n\n> - Method `__call__` of class `IntegratedCurve` now does return a manifold point instead of a list of coordinates, which is indeed much more consistent with the purpose of the class (which is to represent curves in manifold).\n\nOK, very good.\n\n> - Former lines 428-437 (which now are lines 440-449) cannot be replaced by the suggested lines, since the fact that some initial coordinates may be expressions needs to be taken into account.\n\nOK.\n> - `print_function` is now imported.\n> - All implementation relative to arguments `is_identity` and `is_isomorphism` is removed. \n\n`is_identity` and `is_isomorphism` still appear in the documentation of the integrated curve methods of class `DifferentiableManifold`...\n\n>In particular, no identity map is implemented by method `one` of the parent classes; this is justified by the lack of relevance of the identity map within the framework of the classes of this ticket, whose purpose is mainly devoted to numerical issues (therefore, any user is left free to set a numerical version of the identity if needed).\n\nIndeed.\n\n> - The title of the documentation of `integrated_curve.py`, now in line 3, is now \"Integrated Curves and Geodesics in Manifolds\".\n\nThanks.\n\n> - The documentation of method `plot_integrated` is now complete.\n\nIn that documentation, the default value of `plot_points_tangent` should appear as 10, not 75.\n> - The main docstring of `manifold_homset.py` is now complete.\n\nThanks.\n\nA few minor points regarding the Poincar\u00e9 half-plane example in the main docstring of `integrated_curve.py`:\n- typo: `Poicar\u00e9` --> `Poincar\u00e9`\n- the plot does not appear in the documentation (missing `sphinx_plot`)\n- on this example, we have\n\n  ```\n  sage: c(0) == p\n  True\n  ```\n  but\n\n  ```\n  sage: c.tangent_vector_eval_at(0) == v\n  False\n  ```\n  Indeed, `c.tangent_vector_eval_at(0)` is a tangent vector at `p`:\n\n  ```\n  sage: c.tangent_vector_eval_at(0) in M.tangent_space(p)\n  True\n  ```\n  but it does not coincide with `v`:\n\n  ```\n  sage: c.tangent_vector_eval_at(0).display()\n  1.0865965337902876 d/dx + 1.536951899804222 d/dy\n  ```\n\nFinally, as revealed by the patchbot, the syntax for the example blocs should be `EXAMPLES:`, not `EXAMPLE:`, even if there is only one example.\n\n\n\n>",
    "created_at": "2017-07-09T14:43:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22951#issuecomment-342743",
    "user": "https://github.com/egourgoulhon"
}
```

<div id="comment:12" align="right">comment:12</div>

Replying to [@sagetrac-karimvanaelst](#comment:11):

Thanks for the changes.
> - Doctests failures reported in last review were due to implementation adapted to version 8.0.beta5 instead of version 8.0.rc0; doctests are now consistent with version 8.0.rc0.

OK. 

> - Method `__call__` of class `IntegratedCurve` now does return a manifold point instead of a list of coordinates, which is indeed much more consistent with the purpose of the class (which is to represent curves in manifold).

OK, very good.

> - Former lines 428-437 (which now are lines 440-449) cannot be replaced by the suggested lines, since the fact that some initial coordinates may be expressions needs to be taken into account.

OK.
> - `print_function` is now imported.
> - All implementation relative to arguments `is_identity` and `is_isomorphism` is removed. 

`is_identity` and `is_isomorphism` still appear in the documentation of the integrated curve methods of class `DifferentiableManifold`...

>In particular, no identity map is implemented by method `one` of the parent classes; this is justified by the lack of relevance of the identity map within the framework of the classes of this ticket, whose purpose is mainly devoted to numerical issues (therefore, any user is left free to set a numerical version of the identity if needed).

Indeed.

> - The title of the documentation of `integrated_curve.py`, now in line 3, is now "Integrated Curves and Geodesics in Manifolds".

Thanks.

> - The documentation of method `plot_integrated` is now complete.

In that documentation, the default value of `plot_points_tangent` should appear as 10, not 75.
> - The main docstring of `manifold_homset.py` is now complete.

Thanks.

A few minor points regarding the Poincaré half-plane example in the main docstring of `integrated_curve.py`:
- typo: `Poicaré` --> `Poincaré`
- the plot does not appear in the documentation (missing `sphinx_plot`)
- on this example, we have

  ```
  sage: c(0) == p
  True
  ```
  but

  ```
  sage: c.tangent_vector_eval_at(0) == v
  False
  ```
  Indeed, `c.tangent_vector_eval_at(0)` is a tangent vector at `p`:

  ```
  sage: c.tangent_vector_eval_at(0) in M.tangent_space(p)
  True
  ```
  but it does not coincide with `v`:

  ```
  sage: c.tangent_vector_eval_at(0).display()
  1.0865965337902876 d/dx + 1.536951899804222 d/dy
  ```

Finally, as revealed by the patchbot, the syntax for the example blocs should be `EXAMPLES:`, not `EXAMPLE:`, even if there is only one example.



>



---

archive/issue_events_321585.json:
```json
{
    "actor": "https://github.com/egourgoulhon",
    "created_at": "2017-07-09T14:43:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22951",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22951#event-321585"
}
```



---

archive/issue_events_321586.json:
```json
{
    "actor": "https://github.com/egourgoulhon",
    "created_at": "2017-07-09T14:43:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22951",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22951#event-321586"
}
```



---

archive/issue_comments_342744.json:
```json
{
    "body": "<div id=\"comment:13\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a91fb48e8168731d1377b70b24f90a7319d66bf6\"><code>a91fb48</code></a></td><td><code>changes suggested by review, simpler 'an_element' methods</code></td></tr></table>\n",
    "created_at": "2017-07-12T13:50:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22951#issuecomment-342744",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:13"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a91fb48e8168731d1377b70b24f90a7319d66bf6"><code>a91fb48</code></a></td><td><code>changes suggested by review, simpler 'an_element' methods</code></td></tr></table>




---

archive/issue_comments_342745.json:
```json
{
    "body": "Changed commit from **[`80eb469`](https://github.com/sagemath/sagetrac-mirror/commit/80eb4690bd57eb744218ea7f8805d34c8f036156)** to **[`a91fb48`](https://github.com/sagemath/sagetrac-mirror/commit/a91fb48e8168731d1377b70b24f90a7319d66bf6)**",
    "created_at": "2017-07-12T13:50:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22951#issuecomment-342745",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`80eb469`](https://github.com/sagemath/sagetrac-mirror/commit/80eb4690bd57eb744218ea7f8805d34c8f036156)** to **[`a91fb48`](https://github.com/sagemath/sagetrac-mirror/commit/a91fb48e8168731d1377b70b24f90a7319d66bf6)**



---

archive/issue_events_321587.json:
```json
{
    "actor": "https://github.com/sagetrac-karimvanaelst",
    "created_at": "2017-07-12T14:30:55Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22951",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22951#event-321587"
}
```



---

archive/issue_events_321588.json:
```json
{
    "actor": "https://github.com/sagetrac-karimvanaelst",
    "created_at": "2017-07-12T14:30:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22951",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22951#event-321588"
}
```



---

archive/issue_comments_342746.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReplying to [@egourgoulhon](#comment:12):\n\n- `is_identity` and `is_isomorphism` no longer appear in the documentation of the integrated curve methods of class `DifferentiableManifold` as it should be.\n\n- The default value of `plot_points_tangent` indicated in the documentation of `plot_integrated` is now correctly set to 10.\n\n- Method `tangent_vector_eval_at` evaluates a vector tangent to the curve using an interpolation. If this method is called on the initial point of the curve, the method does not try to return the initial tangent vector provided by the user when the curve was set, although this would obviously always be the  most correct result. One reason for this is that the initial tangent vector may be defined in terms of expressions, i.e. it may have non numerical components. On the contrary, `tangent_vector_eval_at` always returns a fully numerical tangent vector, since it uses an interpolation, which itself was built from a numerical solution, which itself could only be computed if numerical values were provided for all the parameters of the system defining the curve (in particular, if some components of the initial tangent vector were expressions, the user should have provided numerical values for those when calling method `solve`). This explains the obvious lack of precision of this method in the case of the Poincar\u00e9 half-plane example pointed out in [comment:12](#comment:12). Of course, to face this and get better results, one may merely reduce the step of integration when calling method `solve`.\n\n- All `EXAMPLE:` were changed to `EXAMPLES:` as they should.",
    "created_at": "2017-07-12T14:30:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22951#issuecomment-342746",
    "user": "https://github.com/sagetrac-karimvanaelst"
}
```

<div id="comment:14" align="right">comment:14</div>

Replying to [@egourgoulhon](#comment:12):

- `is_identity` and `is_isomorphism` no longer appear in the documentation of the integrated curve methods of class `DifferentiableManifold` as it should be.

- The default value of `plot_points_tangent` indicated in the documentation of `plot_integrated` is now correctly set to 10.

- Method `tangent_vector_eval_at` evaluates a vector tangent to the curve using an interpolation. If this method is called on the initial point of the curve, the method does not try to return the initial tangent vector provided by the user when the curve was set, although this would obviously always be the  most correct result. One reason for this is that the initial tangent vector may be defined in terms of expressions, i.e. it may have non numerical components. On the contrary, `tangent_vector_eval_at` always returns a fully numerical tangent vector, since it uses an interpolation, which itself was built from a numerical solution, which itself could only be computed if numerical values were provided for all the parameters of the system defining the curve (in particular, if some components of the initial tangent vector were expressions, the user should have provided numerical values for those when calling method `solve`). This explains the obvious lack of precision of this method in the case of the Poincaré half-plane example pointed out in [comment:12](#comment:12). Of course, to face this and get better results, one may merely reduce the step of integration when calling method `solve`.

- All `EXAMPLE:` were changed to `EXAMPLES:` as they should.



---

archive/issue_comments_342747.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nThanks for these last changes. I agree with your comments on `tangent_vector_eval_at`. \n\nThe ticket is in very good shape; the patchbot reports some \"Timed out\" failures, but they are not related to this ticket (this is well known issue, discussed [here](https://groups.google.com/forum/#!topic/sage-devel/ltWtGP4n54E)). Thank you very much for this nice work!",
    "created_at": "2017-07-13T09:54:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22951#issuecomment-342747",
    "user": "https://github.com/egourgoulhon"
}
```

<div id="comment:15" align="right">comment:15</div>

Thanks for these last changes. I agree with your comments on `tangent_vector_eval_at`. 

The ticket is in very good shape; the patchbot reports some "Timed out" failures, but they are not related to this ticket (this is well known issue, discussed [here](https://groups.google.com/forum/#!topic/sage-devel/ltWtGP4n54E)). Thank you very much for this nice work!



---

archive/issue_events_321589.json:
```json
{
    "actor": "https://github.com/egourgoulhon",
    "created_at": "2017-07-13T09:54:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22951",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22951#event-321589"
}
```



---

archive/issue_events_321590.json:
```json
{
    "actor": "https://github.com/egourgoulhon",
    "created_at": "2017-07-13T09:54:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22951",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22951#event-321590"
}
```



---

archive/issue_comments_342748.json:
```json
{
    "body": "Changed commit from **[`a91fb48`](https://github.com/sagemath/sagetrac-mirror/commit/a91fb48e8168731d1377b70b24f90a7319d66bf6)** to **[`7479f47`](https://github.com/sagemath/sagetrac-mirror/commit/7479f47d6514428ad0bd00269af33b2fb495354c)**",
    "created_at": "2017-07-13T17:05:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22951#issuecomment-342748",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`a91fb48`](https://github.com/sagemath/sagetrac-mirror/commit/a91fb48e8168731d1377b70b24f90a7319d66bf6)** to **[`7479f47`](https://github.com/sagemath/sagetrac-mirror/commit/7479f47d6514428ad0bd00269af33b2fb495354c)**



---

archive/issue_comments_342749.json:
```json
{
    "body": "<div id=\"comment:16\"></div>\n\nBranch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7479f47d6514428ad0bd00269af33b2fb495354c\"><code>7479f47</code></a></td><td><code>'init' of autoparallel_curve now robust to change of default chart, tiny corrections in documentation</code></td></tr></table>\n",
    "created_at": "2017-07-13T17:05:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22951#issuecomment-342749",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:16"></div>

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7479f47d6514428ad0bd00269af33b2fb495354c"><code>7479f47</code></a></td><td><code>'init' of autoparallel_curve now robust to change of default chart, tiny corrections in documentation</code></td></tr></table>




---

archive/issue_events_321591.json:
```json
{
    "actor": "https://github.com/sagetrac-git",
    "created_at": "2017-07-13T17:05:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22951",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22951#event-321591"
}
```



---

archive/issue_events_321592.json:
```json
{
    "actor": "https://github.com/sagetrac-git",
    "created_at": "2017-07-13T17:05:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22951",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22951#event-321592"
}
```



---

archive/issue_comments_342750.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nCommit [7479f47](https://github.com/sagemath/sagetrac-mirror/commit/7479f47d6514428ad0bd00269af33b2fb495354c) mainly corrects `__init__` of `IntegratedAutoparallelCurve` in order to obtain the right equations from the affine connection in terms of the chart chosen by the user, even if it is not the default chart.",
    "created_at": "2017-07-13T17:19:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22951#issuecomment-342750",
    "user": "https://github.com/sagetrac-karimvanaelst"
}
```

<div id="comment:17" align="right">comment:17</div>

Commit [7479f47](https://github.com/sagemath/sagetrac-mirror/commit/7479f47d6514428ad0bd00269af33b2fb495354c) mainly corrects `__init__` of `IntegratedAutoparallelCurve` in order to obtain the right equations from the affine connection in terms of the chart chosen by the user, even if it is not the default chart.



---

archive/issue_events_321593.json:
```json
{
    "actor": "https://github.com/egourgoulhon",
    "created_at": "2017-07-13T20:06:26Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22951",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22951#event-321593"
}
```



---

archive/issue_events_321594.json:
```json
{
    "actor": "https://github.com/egourgoulhon",
    "created_at": "2017-07-13T20:06:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22951",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22951#event-321594"
}
```



---

archive/issue_comments_342751.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nThanks for these last improvements.\nEverything looks good to me.",
    "created_at": "2017-07-13T20:06:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22951#issuecomment-342751",
    "user": "https://github.com/egourgoulhon"
}
```

<div id="comment:18" align="right">comment:18</div>

Thanks for these last improvements.
Everything looks good to me.



---

archive/issue_comments_342752.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\n\n```\nsage -t --long --warn-long 85.3 src/sage/manifolds/differentiable/integrated_curve.py\n**********************************************************************\nFile \"src/sage/manifolds/differentiable/integrated_curve.py\", line 171, in sage.manifolds.differentiable.integrated_curve.IntegratedCurve\nFailed example:\n    c = M.integrated_curve(eqns, D, (t, 0, 5), v, name='c',\n                                                 verbose=True)\nExpected:\n    The curve was correctly set.\n    Parameters appearing in the differential system defining the\n     curve are [B_0, L, T, q, m].\nGot:\n    The curve was correctly set.\n    Parameters appearing in the differential system defining the curve are [B_0, L, T, m, q].\n**********************************************************************\nFile \"src/sage/manifolds/differentiable/integrated_curve.py\", line 925, in sage.manifolds.differentiable.integrated_curve.IntegratedCurve.?\nFailed example:\n    sol = c.solve(parameters_values={m:1, q:1, L:10, T:1})\nExpected:\n    Traceback (most recent call last):\n    ...\n    ValueError: numerical values should be provided for each of\n     the parameters [B_0, L, T, q, m]\nGot:\n    <BLANKLINE>\n    Traceback (most recent call last):\n      File \"/mnt/disk/home/release/Sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 509, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/mnt/disk/home/release/Sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 872, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.manifolds.differentiable.integrated_curve.IntegratedCurve.?[10]>\", line 1, in <module>\n        sol = c.solve(parameters_values={m:Integer(1), q:Integer(1), L:Integer(10), T:Integer(1)})\n      File \"/mnt/disk/home/release/Sage/local/lib/python2.7/site-packages/sage/manifolds/differentiable/integrated_curve.py\", line 1015, in solve\n        \"{}\".format(sorted(self._parameters)))\n    ValueError: numerical values should be provided for each of the parameters [B_0, L, T, m, q]\n**********************************************************************\n2 items had failures:\n   1 of  29 in sage.manifolds.differentiable.integrated_curve.IntegratedCurve\n   1 of  98 in sage.manifolds.differentiable.integrated_curve.IntegratedCurve.?\n    [387 tests, 2 failures, 49.99 s]\n```",
    "created_at": "2017-07-22T07:29:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22951#issuecomment-342752",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:19" align="right">comment:19</div>


```
sage -t --long --warn-long 85.3 src/sage/manifolds/differentiable/integrated_curve.py
**********************************************************************
File "src/sage/manifolds/differentiable/integrated_curve.py", line 171, in sage.manifolds.differentiable.integrated_curve.IntegratedCurve
Failed example:
    c = M.integrated_curve(eqns, D, (t, 0, 5), v, name='c',
                                                 verbose=True)
Expected:
    The curve was correctly set.
    Parameters appearing in the differential system defining the
     curve are [B_0, L, T, q, m].
Got:
    The curve was correctly set.
    Parameters appearing in the differential system defining the curve are [B_0, L, T, m, q].
**********************************************************************
File "src/sage/manifolds/differentiable/integrated_curve.py", line 925, in sage.manifolds.differentiable.integrated_curve.IntegratedCurve.?
Failed example:
    sol = c.solve(parameters_values={m:1, q:1, L:10, T:1})
Expected:
    Traceback (most recent call last):
    ...
    ValueError: numerical values should be provided for each of
     the parameters [B_0, L, T, q, m]
Got:
    <BLANKLINE>
    Traceback (most recent call last):
      File "/mnt/disk/home/release/Sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 509, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/mnt/disk/home/release/Sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 872, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.manifolds.differentiable.integrated_curve.IntegratedCurve.?[10]>", line 1, in <module>
        sol = c.solve(parameters_values={m:Integer(1), q:Integer(1), L:Integer(10), T:Integer(1)})
      File "/mnt/disk/home/release/Sage/local/lib/python2.7/site-packages/sage/manifolds/differentiable/integrated_curve.py", line 1015, in solve
        "{}".format(sorted(self._parameters)))
    ValueError: numerical values should be provided for each of the parameters [B_0, L, T, m, q]
**********************************************************************
2 items had failures:
   1 of  29 in sage.manifolds.differentiable.integrated_curve.IntegratedCurve
   1 of  98 in sage.manifolds.differentiable.integrated_curve.IntegratedCurve.?
    [387 tests, 2 failures, 49.99 s]
```



---

archive/issue_events_321595.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-07-22T07:29:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22951",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22951#event-321595"
}
```



---

archive/issue_events_321596.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-07-22T07:29:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22951",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22951#event-321596"
}
```



---

archive/issue_comments_342753.json:
```json
{
    "body": "Changed commit from **[`7479f47`](https://github.com/sagemath/sagetrac-mirror/commit/7479f47d6514428ad0bd00269af33b2fb495354c)** to **[`0f0c67b`](https://github.com/sagemath/sagetrac-mirror/commit/0f0c67b2de1300f0f39a2e6592be1cea64862729)**",
    "created_at": "2017-07-23T23:54:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22951#issuecomment-342753",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`7479f47`](https://github.com/sagemath/sagetrac-mirror/commit/7479f47d6514428ad0bd00269af33b2fb495354c)** to **[`0f0c67b`](https://github.com/sagemath/sagetrac-mirror/commit/0f0c67b2de1300f0f39a2e6592be1cea64862729)**



---

archive/issue_comments_342754.json:
```json
{
    "body": "<div id=\"comment:20\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0f0c67b2de1300f0f39a2e6592be1cea64862729\"><code>0f0c67b</code></a></td><td><code>Various types of cleanup.</code></td></tr></table>\n",
    "created_at": "2017-07-23T23:54:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22951#issuecomment-342754",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:20"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0f0c67b2de1300f0f39a2e6592be1cea64862729"><code>0f0c67b</code></a></td><td><code>Various types of cleanup.</code></td></tr></table>




---

archive/issue_comments_342755.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nThis should fix the doctest errors. I also did some other cleanup in terms of code, PEP8, and documentation. In particular, I suspect the pdf doc would not have built previously.",
    "created_at": "2017-07-23T23:56:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22951#issuecomment-342755",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:21" align="right">comment:21</div>

This should fix the doctest errors. I also did some other cleanup in terms of code, PEP8, and documentation. In particular, I suspect the pdf doc would not have built previously.



---

archive/issue_comments_342756.json:
```json
{
    "body": "Changed reviewer from **Eric Gourgoulhon** to **Eric Gourgoulhon, Travis Scrimshaw**",
    "created_at": "2017-07-23T23:56:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22951#issuecomment-342756",
    "user": "https://github.com/tscrim"
}
```

Changed reviewer from **Eric Gourgoulhon** to **Eric Gourgoulhon, Travis Scrimshaw**



---

archive/issue_events_321597.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-07-23T23:56:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22951",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22951#event-321597"
}
```



---

archive/issue_events_321598.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-07-23T23:56:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22951",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22951#event-321598"
}
```



---

archive/issue_events_321599.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-07-23T23:56:35Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/22951",
    "milestone_number": null,
    "milestone_title": "sage-8.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22951#event-321599"
}
```



---

archive/issue_events_321600.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-07-23T23:56:35Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/22951",
    "milestone_number": null,
    "milestone_title": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22951#event-321600"
}
```



---

archive/issue_comments_342757.json:
```json
{
    "body": "<div id=\"comment:22\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/95ef0140f61111d1d908f05b6289918d5077c914\"><code>95ef014</code></a></td><td><code>Fix some doctests and sphinx_plot trivial errors in integrated curves</code></td></tr></table>\n",
    "created_at": "2017-07-25T16:27:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22951#issuecomment-342757",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:22"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/95ef0140f61111d1d908f05b6289918d5077c914"><code>95ef014</code></a></td><td><code>Fix some doctests and sphinx_plot trivial errors in integrated curves</code></td></tr></table>




---

archive/issue_comments_342758.json:
```json
{
    "body": "Changed commit from **[`0f0c67b`](https://github.com/sagemath/sagetrac-mirror/commit/0f0c67b2de1300f0f39a2e6592be1cea64862729)** to **[`95ef014`](https://github.com/sagemath/sagetrac-mirror/commit/95ef0140f61111d1d908f05b6289918d5077c914)**",
    "created_at": "2017-07-25T16:27:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22951#issuecomment-342758",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`0f0c67b`](https://github.com/sagemath/sagetrac-mirror/commit/0f0c67b2de1300f0f39a2e6592be1cea64862729)** to **[`95ef014`](https://github.com/sagemath/sagetrac-mirror/commit/95ef0140f61111d1d908f05b6289918d5077c914)**



---

archive/issue_comments_342759.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nReplying to [@tscrim](#comment:21):\n> This should fix the doctest errors. I also did some other cleanup in terms of code, PEP8, and documentation. In particular, I suspect the pdf doc would not have built previously.\n\nThanks a lot for the cleanup! The above commit fixes an error in a PLOT directive (missing `=` sign), and fixes some failed doctests in `manifold.py` and `manifold_homset.py` due to the replacement of \"w.r.t.\" by \"with respect to\". It also adds some extra cleanup.\n\nI let you set the ticket back to positive review if this is OK for you.",
    "created_at": "2017-07-25T16:36:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22951#issuecomment-342759",
    "user": "https://github.com/egourgoulhon"
}
```

<div id="comment:23" align="right">comment:23</div>

Replying to [@tscrim](#comment:21):
> This should fix the doctest errors. I also did some other cleanup in terms of code, PEP8, and documentation. In particular, I suspect the pdf doc would not have built previously.

Thanks a lot for the cleanup! The above commit fixes an error in a PLOT directive (missing `=` sign), and fixes some failed doctests in `manifold.py` and `manifold_homset.py` due to the replacement of "w.r.t." by "with respect to". It also adds some extra cleanup.

I let you set the ticket back to positive review if this is OK for you.



---

archive/issue_events_321601.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-07-26T01:29:29Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22951",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22951#event-321601"
}
```



---

archive/issue_events_321602.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-07-26T01:29:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22951",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22951#event-321602"
}
```



---

archive/issue_comments_342760.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nReplying to [@egourgoulhon](#comment:23):\n> Replying to [@tscrim](#comment:21):\n> > This should fix the doctest errors. I also did some other cleanup in terms of code, PEP8, and documentation. In particular, I suspect the pdf doc would not have built previously.\n\n> \n> Thanks a lot for the cleanup! The above commit fixes an error in a PLOT directive (missing `=` sign),\n\nThanks.\n\n> and fixes some failed doctests in `manifold.py` and `manifold_homset.py` due to the replacement of \"w.r.t.\" by \"with respect to\". It also adds some extra cleanup.\n\nSorry; I blindly did a search and replace in `integrated_curves.py` (although I do prefer the explicitness).\n\n> I let you set the ticket back to positive review if this is OK for you. \n\nYep, it is all good. Thank you.",
    "created_at": "2017-07-26T01:29:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22951#issuecomment-342760",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:24" align="right">comment:24</div>

Replying to [@egourgoulhon](#comment:23):
> Replying to [@tscrim](#comment:21):
> > This should fix the doctest errors. I also did some other cleanup in terms of code, PEP8, and documentation. In particular, I suspect the pdf doc would not have built previously.

> 
> Thanks a lot for the cleanup! The above commit fixes an error in a PLOT directive (missing `=` sign),

Thanks.

> and fixes some failed doctests in `manifold.py` and `manifold_homset.py` due to the replacement of "w.r.t." by "with respect to". It also adds some extra cleanup.

Sorry; I blindly did a search and replace in `integrated_curves.py` (although I do prefer the explicitness).

> I let you set the ticket back to positive review if this is OK for you. 

Yep, it is all good. Thank you.



---

archive/issue_comments_342761.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\n\n```\nsage -t --long src/sage/manifolds/differentiable/integrated_curve.py\n**********************************************************************\nFile \"src/sage/manifolds/differentiable/integrated_curve.py\", line 239, in sage.manifolds.differentiable.integrated_curve.IntegratedCurve\nFailed example:\n    v.display()\nExpected:\n    -0.9303968397216424 d/dx1 - 0.3408080563014475 d/dx2 +\n     1.0000000000000004 d/dx3\nGot:\n    -0.9303968397216426 d/dx1 - 0.3408080563014474 d/dx2 + 1.0000000000000004 d/dx3\n**********************************************************************\nFile \"src/sage/manifolds/differentiable/integrated_curve.py\", line 1669, in sage.manifolds.differentiable.integrated_curve.IntegratedCurve.?\nFailed example:\n    tg_vec[:]\nExpected:\n    [0.7392639473853356, -0.6734182305341726, 1.0000000000000007]\nGot:\n    [0.7392639473853356, -0.6734182305341726, 1.0000000000000009]\n**********************************************************************\n2 items had failures:\n   1 of  28 in sage.manifolds.differentiable.integrated_curve.IntegratedCurve\n   1 of  98 in sage.manifolds.differentiable.integrated_curve.IntegratedCurve.?\n    [380 tests, 2 failures, 68.55 s]\n```\n\n```\nsage -t --long src/sage/manifolds/differentiable/manifold.py\n**********************************************************************\nFile \"src/sage/manifolds/differentiable/manifold.py\", line 2663, in sage.manifolds.differentiable.manifold.DifferentiableManifold.?\nFailed example:\n    tgt_vec[:]\nExpected:\n    [-0.8481008455360024, 0.5298346120470748, 1.0000000000000007]\nGot:\n    [-0.8481008455360024, 0.5298346120470748, 1.0000000000000004]\n**********************************************************************\n1 item had failures:\n   1 of 161 in sage.manifolds.differentiable.manifold.DifferentiableManifold.?\n    [490 tests, 1 failure, 35.89 s]\n```\n\n```\nsage -t --long src/sage/manifolds/differentiable/manifold.py\n**********************************************************************\nFile \"src/sage/manifolds/differentiable/manifold.py\", line 2797, in sage.manifolds.differentiable.manifold.DifferentiableManifold.?\nFailed example:\n    tgt_vec[:]\nExpected:\n    [0.9999999999999732, -1.016513736236512]\nGot:\n    [0.9999999999999732, -1.0165137362366825]\n**********************************************************************\nFile \"src/sage/manifolds/differentiable/manifold.py\", line 2917, in sage.manifolds.differentiable.manifold.DifferentiableManifold.?\nFailed example:\n    tgt_vec[:]\nExpected:\n    [-1.090742147346732, 0.620568327518154]\nGot:\n    [-1.0907421473467311, 0.6205683275181549]\n**********************************************************************\n1 item had failures:\n   2 of 161 in sage.manifolds.differentiable.manifold.DifferentiableManifold.?\n    [490 tests, 2 failures, 65.30 s]\n```\nYou should probably add an # abs tol to all numerical results unless you intentionally write code with IEEE floating point reproducibility in mind.",
    "created_at": "2017-07-29T15:22:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22951#issuecomment-342761",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:25" align="right">comment:25</div>


```
sage -t --long src/sage/manifolds/differentiable/integrated_curve.py
**********************************************************************
File "src/sage/manifolds/differentiable/integrated_curve.py", line 239, in sage.manifolds.differentiable.integrated_curve.IntegratedCurve
Failed example:
    v.display()
Expected:
    -0.9303968397216424 d/dx1 - 0.3408080563014475 d/dx2 +
     1.0000000000000004 d/dx3
Got:
    -0.9303968397216426 d/dx1 - 0.3408080563014474 d/dx2 + 1.0000000000000004 d/dx3
**********************************************************************
File "src/sage/manifolds/differentiable/integrated_curve.py", line 1669, in sage.manifolds.differentiable.integrated_curve.IntegratedCurve.?
Failed example:
    tg_vec[:]
Expected:
    [0.7392639473853356, -0.6734182305341726, 1.0000000000000007]
Got:
    [0.7392639473853356, -0.6734182305341726, 1.0000000000000009]
**********************************************************************
2 items had failures:
   1 of  28 in sage.manifolds.differentiable.integrated_curve.IntegratedCurve
   1 of  98 in sage.manifolds.differentiable.integrated_curve.IntegratedCurve.?
    [380 tests, 2 failures, 68.55 s]
```

```
sage -t --long src/sage/manifolds/differentiable/manifold.py
**********************************************************************
File "src/sage/manifolds/differentiable/manifold.py", line 2663, in sage.manifolds.differentiable.manifold.DifferentiableManifold.?
Failed example:
    tgt_vec[:]
Expected:
    [-0.8481008455360024, 0.5298346120470748, 1.0000000000000007]
Got:
    [-0.8481008455360024, 0.5298346120470748, 1.0000000000000004]
**********************************************************************
1 item had failures:
   1 of 161 in sage.manifolds.differentiable.manifold.DifferentiableManifold.?
    [490 tests, 1 failure, 35.89 s]
```

```
sage -t --long src/sage/manifolds/differentiable/manifold.py
**********************************************************************
File "src/sage/manifolds/differentiable/manifold.py", line 2797, in sage.manifolds.differentiable.manifold.DifferentiableManifold.?
Failed example:
    tgt_vec[:]
Expected:
    [0.9999999999999732, -1.016513736236512]
Got:
    [0.9999999999999732, -1.0165137362366825]
**********************************************************************
File "src/sage/manifolds/differentiable/manifold.py", line 2917, in sage.manifolds.differentiable.manifold.DifferentiableManifold.?
Failed example:
    tgt_vec[:]
Expected:
    [-1.090742147346732, 0.620568327518154]
Got:
    [-1.0907421473467311, 0.6205683275181549]
**********************************************************************
1 item had failures:
   2 of 161 in sage.manifolds.differentiable.manifold.DifferentiableManifold.?
    [490 tests, 2 failures, 65.30 s]
```
You should probably add an # abs tol to all numerical results unless you intentionally write code with IEEE floating point reproducibility in mind.



---

archive/issue_events_321603.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-07-29T15:22:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22951",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22951#event-321603"
}
```



---

archive/issue_events_321604.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-07-29T15:22:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22951",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22951#event-321604"
}
```



---

archive/issue_comments_342762.json:
```json
{
    "body": "<div id=\"comment:26\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1c7e7279ab269d9ac9e05696eac77a2fe5cdbf3e\"><code>1c7e727</code></a></td><td><code>absolute tolerance in doctests, corrections regarding tests on interpolations</code></td></tr></table>\n",
    "created_at": "2017-08-04T14:31:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22951#issuecomment-342762",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:26"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1c7e7279ab269d9ac9e05696eac77a2fe5cdbf3e"><code>1c7e727</code></a></td><td><code>absolute tolerance in doctests, corrections regarding tests on interpolations</code></td></tr></table>




---

archive/issue_comments_342763.json:
```json
{
    "body": "Changed commit from **[`95ef014`](https://github.com/sagemath/sagetrac-mirror/commit/95ef0140f61111d1d908f05b6289918d5077c914)** to **[`1c7e727`](https://github.com/sagemath/sagetrac-mirror/commit/1c7e7279ab269d9ac9e05696eac77a2fe5cdbf3e)**",
    "created_at": "2017-08-04T14:31:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22951#issuecomment-342763",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`95ef014`](https://github.com/sagemath/sagetrac-mirror/commit/95ef0140f61111d1d908f05b6289918d5077c914)** to **[`1c7e727`](https://github.com/sagemath/sagetrac-mirror/commit/1c7e7279ab269d9ac9e05696eac77a2fe5cdbf3e)**



---

archive/issue_comments_342764.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nThanks a lot for all the corrections.\n\nAs suggested, an absolute tolerance (# abs tol) was added to all numerical results in the doctests.\n\nAdditionally, methods `__call__` and `tangent_vector_eval_at` of class `integrated_curve` were modified following the model of corrections made in method `plot_integrated` (starting on lines 1907, now 1908, and 2084, now 2085) in commit [0f0c67b](https://github.com/sagemath/sagetrac-mirror/commit/0f0c67b2de1300f0f39a2e6592be1cea64862729).\n\n(Precisions about these are given here in case of future improvements regarding interpolation.\n\nThe corrections in methods `__call__`, `tangent_vector_eval_at` and `plot_integrated` concern tests on the class of the objects implementing interpolations of the numerical solutions computed with method `solve`.\nFor now, only class `sage.calculus.interpolation.Spline` is used, but these tests anticipate the fact that new classes implementing other methods of interpolation might be introduced.\nOf course, in such case, tests such as `if not isinstance(interpolation[0], Spline):` (such as in lines 1604, 1694,..) should become `if not isinstance(interpolation[0], (Spline, OtherInterpolationClass)):`.\n\nBut modifications of the source code induced by the introduction of new interpolation classes should be limited to the above tests and the content of method `interpolate`.\nThis means that an instance of `OtherInterpolationClass` should allow to be called as it is done in lines 1609, 1709, 1954, ..., and should admit a method `derivative` to be called in lines 1703, 2018...)",
    "created_at": "2017-08-04T14:52:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22951#issuecomment-342764",
    "user": "https://github.com/sagetrac-karimvanaelst"
}
```

<div id="comment:27" align="right">comment:27</div>

Thanks a lot for all the corrections.

As suggested, an absolute tolerance (# abs tol) was added to all numerical results in the doctests.

Additionally, methods `__call__` and `tangent_vector_eval_at` of class `integrated_curve` were modified following the model of corrections made in method `plot_integrated` (starting on lines 1907, now 1908, and 2084, now 2085) in commit [0f0c67b](https://github.com/sagemath/sagetrac-mirror/commit/0f0c67b2de1300f0f39a2e6592be1cea64862729).

(Precisions about these are given here in case of future improvements regarding interpolation.

The corrections in methods `__call__`, `tangent_vector_eval_at` and `plot_integrated` concern tests on the class of the objects implementing interpolations of the numerical solutions computed with method `solve`.
For now, only class `sage.calculus.interpolation.Spline` is used, but these tests anticipate the fact that new classes implementing other methods of interpolation might be introduced.
Of course, in such case, tests such as `if not isinstance(interpolation[0], Spline):` (such as in lines 1604, 1694,..) should become `if not isinstance(interpolation[0], (Spline, OtherInterpolationClass)):`.

But modifications of the source code induced by the introduction of new interpolation classes should be limited to the above tests and the content of method `interpolate`.
This means that an instance of `OtherInterpolationClass` should allow to be called as it is done in lines 1609, 1709, 1954, ..., and should admit a method `derivative` to be called in lines 1703, 2018...)



---

archive/issue_events_321605.json:
```json
{
    "actor": "https://github.com/sagetrac-karimvanaelst",
    "created_at": "2017-08-04T14:56:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22951",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22951#event-321605"
}
```



---

archive/issue_events_321606.json:
```json
{
    "actor": "https://github.com/sagetrac-karimvanaelst",
    "created_at": "2017-08-04T14:56:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22951",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22951#event-321606"
}
```



---

archive/issue_comments_342765.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nThanks for the update.\nLGTM and the patchbot gives green light.",
    "created_at": "2017-08-07T15:57:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22951#issuecomment-342765",
    "user": "https://github.com/egourgoulhon"
}
```

<div id="comment:29" align="right">comment:29</div>

Thanks for the update.
LGTM and the patchbot gives green light.



---

archive/issue_events_321607.json:
```json
{
    "actor": "https://github.com/egourgoulhon",
    "created_at": "2017-08-07T15:57:28Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22951",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22951#event-321607"
}
```



---

archive/issue_events_321608.json:
```json
{
    "actor": "https://github.com/egourgoulhon",
    "created_at": "2017-08-07T15:57:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22951",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22951#event-321608"
}
```



---

archive/issue_comments_342766.json:
```json
{
    "body": "Changed branch from **[public/manifolds/integrated_curve](https://github.com/sagemath/sagetrac-mirror/tree/public/manifolds/integrated_curve)** to **[`1c7e727`](https://github.com/sagemath/sagetrac-mirror/commit/1c7e7279ab269d9ac9e05696eac77a2fe5cdbf3e)**",
    "created_at": "2017-08-11T18:18:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22951#issuecomment-342766",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[public/manifolds/integrated_curve](https://github.com/sagemath/sagetrac-mirror/tree/public/manifolds/integrated_curve)** to **[`1c7e727`](https://github.com/sagemath/sagetrac-mirror/commit/1c7e7279ab269d9ac9e05696eac77a2fe5cdbf3e)**



---

archive/issue_events_321609.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-08-11T18:18:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22951",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22951#event-321609"
}
```



---

archive/issue_events_321610.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "fc058c7e1e3886b56cc5bf2b459aab21c64ee490",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2017-08-11T18:18:06Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/22951",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22951#event-321610"
}
```
