# Issue 22643: Upgrade fplll/fpylll to new release

archive/issues_022406.json:
```json
{
    "body": "As mentioned in #12426 comment 106, there are symbol lookup errors when fpylll accesses fplll\n\n```\nsage: import fpylll\n---------------------------------------------------------------------------\nImportError                               Traceback (most recent call last)\n<ipython-input-1-5722816e3197> in <module>()\n----> 1 import fpylll\n\n/Users/mkoeppe/s/sage/sage-rebasing/homebrew-gcc/local/lib/python2.7/site-packages/fpylll/__init__.py in <module>()\n      4 from .fplll.gso import GSO\n      5 from .fplll.lll import LLL\n----> 6 from .fplll.enumeration import Enumeration, EnumerationError\n      7 from .fplll.bkz import BKZ\n      8 from .fplll.bkz_param import load_strategies_json\n\nImportError: dlopen(/Users/mkoeppe/s/sage/sage-rebasing/homebrew-gcc/local/lib/python2.7/site-packages/fpylll/fplll/enumeration.so, 2): Symbol not found: __ZN5fplll14EnumerationDynINS_5FP_NRIA1_10dpe_structEEE16process_solutionEd\n  Referenced from: /Users/mkoeppe/s/sage/sage-rebasing/homebrew-gcc/local/lib/python2.7/site-packages/fpylll/fplll/enumeration.so\n  Expected in: flat namespace\n in /Users/mkoeppe/s/sage/sage-rebasing/homebrew-gcc/local/lib/python2.7/site-packages/fpylll/fplll/enumeration.so\n```\n\n*tarballs*\n\n- https://github.com/fplll/fplll/releases/download/5.1.0/fplll-5.1.0.tar.gz\n- https://github.com/fplll/fpylll/releases/download/0.2.4dev/fpylll-0.2.4dev.tar.gz\n\n\n\nAssignee: @malb\n\nCC:  @kiwifb @dimpase @malb\n\nBranch/Commit: d0d5ca778cf897f2b1c9742f9d0b9966625d591e\n\nUpstream: Fixed upstream, in a later stable release.\n\nReviewer: Fran\u00e7ois Bissey\n\nAuthor: Martin Albrecht\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/22643\n\n",
    "closed_at": "2017-04-03T21:00:05Z",
    "created_at": "2017-03-19T01:10:44Z",
    "labels": [
        "component: porting",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.0",
    "title": "Upgrade fplll/fpylll to new release",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22643",
    "user": "https://github.com/mkoeppe"
}
```
As mentioned in #12426 comment 106, there are symbol lookup errors when fpylll accesses fplll

```
sage: import fpylll
---------------------------------------------------------------------------
ImportError                               Traceback (most recent call last)
<ipython-input-1-5722816e3197> in <module>()
----> 1 import fpylll

/Users/mkoeppe/s/sage/sage-rebasing/homebrew-gcc/local/lib/python2.7/site-packages/fpylll/__init__.py in <module>()
      4 from .fplll.gso import GSO
      5 from .fplll.lll import LLL
----> 6 from .fplll.enumeration import Enumeration, EnumerationError
      7 from .fplll.bkz import BKZ
      8 from .fplll.bkz_param import load_strategies_json

ImportError: dlopen(/Users/mkoeppe/s/sage/sage-rebasing/homebrew-gcc/local/lib/python2.7/site-packages/fpylll/fplll/enumeration.so, 2): Symbol not found: __ZN5fplll14EnumerationDynINS_5FP_NRIA1_10dpe_structEEE16process_solutionEd
  Referenced from: /Users/mkoeppe/s/sage/sage-rebasing/homebrew-gcc/local/lib/python2.7/site-packages/fpylll/fplll/enumeration.so
  Expected in: flat namespace
 in /Users/mkoeppe/s/sage/sage-rebasing/homebrew-gcc/local/lib/python2.7/site-packages/fpylll/fplll/enumeration.so
```

*tarballs*

- https://github.com/fplll/fplll/releases/download/5.1.0/fplll-5.1.0.tar.gz
- https://github.com/fplll/fpylll/releases/download/0.2.4dev/fpylll-0.2.4dev.tar.gz



Assignee: @malb

CC:  @kiwifb @dimpase @malb

Branch/Commit: d0d5ca778cf897f2b1c9742f9d0b9966625d591e

Upstream: Fixed upstream, in a later stable release.

Reviewer: FranÃ§ois Bissey

Author: Martin Albrecht

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/22643





---

archive/issue_comments_424179.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-As mentioned in #12426 comment 106, there are symbol lookup errors when fpylll accesses fplll.\n+As mentioned in #12426 comment 106, there are symbol lookup errors when fpylll accesses fplll\n``````\n",
    "created_at": "2017-03-19T15:43:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22643#issuecomment-424179",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-As mentioned in #12426 comment 106, there are symbol lookup errors when fpylll accesses fplll.
+As mentioned in #12426 comment 106, there are symbol lookup errors when fpylll accesses fplll
``````




---

archive/issue_comments_424180.json:
```json
{
    "body": "Replying to [ticket:22643 mkoeppe]:\n> As mentioned in #12426 comment 106\n\n\nIt would be nice if the ticket description would be self-contained.",
    "created_at": "2017-03-19T15:43:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22643#issuecomment-424180",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [ticket:22643 mkoeppe]:
> As mentioned in #12426 comment 106


It would be nice if the ticket description would be self-contained.



---

archive/issue_comments_424181.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,22 @@\n As mentioned in #12426 comment 106, there are symbol lookup errors when fpylll accesses fplll\n+\n+```\n+sage: import fpylll\n+---------------------------------------------------------------------------\n+ImportError                               Traceback (most recent call last)\n+<ipython-input-1-5722816e3197> in <module>()\n+----> 1 import fpylll\n+\n+/Users/mkoeppe/s/sage/sage-rebasing/homebrew-gcc/local/lib/python2.7/site-packages/fpylll/__init__.py in <module>()\n+      4 from .fplll.gso import GSO\n+      5 from .fplll.lll import LLL\n+----> 6 from .fplll.enumeration import Enumeration, EnumerationError\n+      7 from .fplll.bkz import BKZ\n+      8 from .fplll.bkz_param import load_strategies_json\n+\n+ImportError: dlopen(/Users/mkoeppe/s/sage/sage-rebasing/homebrew-gcc/local/lib/python2.7/site-packages/fpylll/fplll/enumeration.so, 2): Symbol not found: __ZN5fplll14EnumerationDynINS_5FP_NRIA1_10dpe_structEEE16process_solutionEd\n+  Referenced from: /Users/mkoeppe/s/sage/sage-rebasing/homebrew-gcc/local/lib/python2.7/site-packages/fpylll/fplll/enumeration.so\n+  Expected in: flat namespace\n+ in /Users/mkoeppe/s/sage/sage-rebasing/homebrew-gcc/local/lib/python2.7/site-packages/fpylll/fplll/enumeration.so\n+```\n+\n``````\n",
    "created_at": "2017-03-19T21:16:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22643#issuecomment-424181",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,22 @@
 As mentioned in #12426 comment 106, there are symbol lookup errors when fpylll accesses fplll
+
+```
+sage: import fpylll
+---------------------------------------------------------------------------
+ImportError                               Traceback (most recent call last)
+<ipython-input-1-5722816e3197> in <module>()
+----> 1 import fpylll
+
+/Users/mkoeppe/s/sage/sage-rebasing/homebrew-gcc/local/lib/python2.7/site-packages/fpylll/__init__.py in <module>()
+      4 from .fplll.gso import GSO
+      5 from .fplll.lll import LLL
+----> 6 from .fplll.enumeration import Enumeration, EnumerationError
+      7 from .fplll.bkz import BKZ
+      8 from .fplll.bkz_param import load_strategies_json
+
+ImportError: dlopen(/Users/mkoeppe/s/sage/sage-rebasing/homebrew-gcc/local/lib/python2.7/site-packages/fpylll/fplll/enumeration.so, 2): Symbol not found: __ZN5fplll14EnumerationDynINS_5FP_NRIA1_10dpe_structEEE16process_solutionEd
+  Referenced from: /Users/mkoeppe/s/sage/sage-rebasing/homebrew-gcc/local/lib/python2.7/site-packages/fpylll/fplll/enumeration.so
+  Expected in: flat namespace
+ in /Users/mkoeppe/s/sage/sage-rebasing/homebrew-gcc/local/lib/python2.7/site-packages/fpylll/fplll/enumeration.so
+```
+
``````




---

archive/issue_comments_424182.json:
```json
{
    "body": "<a id='comment:5'></a>\nMy current investigation shows that the missing symbols is in libfplll.dylib but it is a local symbol (\"t\") not a global one and as such it is not seen by objects linking to libfplll.dylib. I am not sure why it is the case but is likely because it was produced with a template.",
    "created_at": "2017-03-20T22:23:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22643#issuecomment-424182",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:5'></a>
My current investigation shows that the missing symbols is in libfplll.dylib but it is a local symbol ("t") not a global one and as such it is not seen by objects linking to libfplll.dylib. I am not sure why it is the case but is likely because it was produced with a template.



---

archive/issue_comments_424183.json:
```json
{
    "body": "<a id='comment:6'></a>\nThe method `process_solution` in enumerate.h is declared private. That's why the symbol is local. It probably shouldn't make its way into the sage interface in the first place. And if it is needed in the sage interface it needs to be public. Digging sage's side...",
    "created_at": "2017-03-20T22:30:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22643#issuecomment-424183",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:6'></a>
The method `process_solution` in enumerate.h is declared private. That's why the symbol is local. It probably shouldn't make its way into the sage interface in the first place. And if it is needed in the sage interface it needs to be public. Digging sage's side...



---

archive/issue_comments_424184.json:
```json
{
    "body": "<a id='comment:7'></a>\nWait not sage's side, fpylll's side.",
    "created_at": "2017-03-20T22:31:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22643#issuecomment-424184",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:7'></a>
Wait not sage's side, fpylll's side.



---

archive/issue_comments_424185.json:
```json
{
    "body": "<a id='comment:8'></a>\nThis is typically why I hate C++. So, in fplll, `EnumerationDyn` in `enumerate.h` defines a private method `process_solution`, but it is a derived class from `EnumerationBase` in `enumerate_base.h` which does also have a `process_solution` method but this one is only protected. I think there is a conflict there. But that's one of the point where my head hurts with C++.\n\nActually the method `process_subsolution` is in the same boat in both files.",
    "created_at": "2017-03-21T01:54:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22643#issuecomment-424185",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:8'></a>
This is typically why I hate C++. So, in fplll, `EnumerationDyn` in `enumerate.h` defines a private method `process_solution`, but it is a derived class from `EnumerationBase` in `enumerate_base.h` which does also have a `process_solution` method but this one is only protected. I think there is a conflict there. But that's one of the point where my head hurts with C++.

Actually the method `process_subsolution` is in the same boat in both files.



---

archive/issue_comments_424186.json:
```json
{
    "body": "<a id='comment:9'></a>\nWell moving in `process_solution` into protected in `EnumerationDyn` didn't change a thing. Don't know enough c++.",
    "created_at": "2017-03-21T02:22:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22643#issuecomment-424186",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:9'></a>
Well moving in `process_solution` into protected in `EnumerationDyn` didn't change a thing. Don't know enough c++.



---

archive/issue_comments_424187.json:
```json
{
    "body": "<a id='comment:10'></a>\nI've been bitten by this before and couldn't resolve it then. Have you tried the nuclear option of making everything public? I can also ask our resident C++ expert.",
    "created_at": "2017-03-21T09:53:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22643#issuecomment-424187",
    "user": "https://github.com/malb"
}
```

<a id='comment:10'></a>
I've been bitten by this before and couldn't resolve it then. Have you tried the nuclear option of making everything public? I can also ask our resident C++ expert.



---

archive/issue_comments_424188.json:
```json
{
    "body": "<a id='comment:11'></a>\nReplying to [malb](#comment%3A10):\n> I've been bitten by this before and couldn't resolve it then. Have you tried the nuclear option of making everything public? I can also ask our resident C++ expert.\n\n\nOnly `process_solution` and `process_subsolution` to no effect. I am even sure what is the chain leading to the creation of this symbol in fplll or why fpylll thinks it should have it.",
    "created_at": "2017-03-21T09:56:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22643#issuecomment-424188",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:11'></a>
Replying to [malb](#comment%3A10):
> I've been bitten by this before and couldn't resolve it then. Have you tried the nuclear option of making everything public? I can also ask our resident C++ expert.


Only `process_solution` and `process_subsolution` to no effect. I am even sure what is the chain leading to the creation of this symbol in fplll or why fpylll thinks it should have it.



---

archive/issue_comments_424189.json:
```json
{
    "body": "<a id='comment:12'></a>\nReplying to [fbissey](#comment%3A11):\n> Replying to [malb](#comment%3A10):\n> > I've been bitten by this before and couldn't resolve it then. Have you tried the nuclear option of making everything public? I can also ask our resident C++ expert.\n\n> \n> Only `process_solution` and `process_subsolution` to no effect.\n\n\nI should qualify that. I moved them to public in `enumerate.h` but not the parent ones in `enumerate_base.h`.",
    "created_at": "2017-03-22T01:49:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22643#issuecomment-424189",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:12'></a>
Replying to [fbissey](#comment%3A11):
> Replying to [malb](#comment%3A10):
> > I've been bitten by this before and couldn't resolve it then. Have you tried the nuclear option of making everything public? I can also ask our resident C++ expert.

> 
> Only `process_solution` and `process_subsolution` to no effect.


I should qualify that. I moved them to public in `enumerate.h` but not the parent ones in `enumerate_base.h`.



---

archive/issue_comments_424190.json:
```json
{
    "body": "<a id='comment:13'></a>\nit's strange that creating fplll with clang works fine, while making a cython extension fails. It might well be a cython bug.\nSo the 1st step towards debugging this might be to try to trigger this without cython.",
    "created_at": "2017-03-22T09:34:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22643#issuecomment-424190",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:13'></a>
it's strange that creating fplll with clang works fine, while making a cython extension fails. It might well be a cython bug.
So the 1st step towards debugging this might be to try to trigger this without cython.



---

archive/issue_comments_424191.json:
```json
{
    "body": "<a id='comment:14'></a>\nReplying to [dimpase](#comment%3A13):\n> It might well be a cython bug.\n\n\nCython only creates a `.cpp` file. This seems like a linking issue, which Cython has nothing to do with.",
    "created_at": "2017-03-22T09:38:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22643#issuecomment-424191",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:14'></a>
Replying to [dimpase](#comment%3A13):
> It might well be a cython bug.


Cython only creates a `.cpp` file. This seems like a linking issue, which Cython has nothing to do with.



---

archive/issue_comments_424192.json:
```json
{
    "body": "<a id='comment:15'></a>\nReplying to [jdemeyer](#comment%3A14):\n> Replying to [dimpase](#comment%3A13):\n> > It might well be a cython bug.\n\n> \n> Cython only creates a `.cpp` file. This seems like a linking issue, which Cython has nothing to do with.\n\nit is perfectly possible to create a `.cpp` file that will produce a linking failure.\nGiven that fplll passes all of its own checks, it seems a bit strange that fpylll fails here.\n\nBy the way, I wonder what precisely are options passed to clang that lead to this. \n\n* Does it get `-std=c++11`? \n* Does it get `-stdlib=libc++`?",
    "created_at": "2017-03-22T10:35:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22643#issuecomment-424192",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:15'></a>
Replying to [jdemeyer](#comment%3A14):
> Replying to [dimpase](#comment%3A13):
> > It might well be a cython bug.

> 
> Cython only creates a `.cpp` file. This seems like a linking issue, which Cython has nothing to do with.

it is perfectly possible to create a `.cpp` file that will produce a linking failure.
Given that fplll passes all of its own checks, it seems a bit strange that fpylll fails here.

By the way, I wonder what precisely are options passed to clang that lead to this. 

* Does it get `-std=c++11`? 
* Does it get `-stdlib=libc++`?



---

archive/issue_comments_424193.json:
```json
{
    "body": "<a id='comment:16'></a>\nReplying to [dimpase](#comment%3A15):\n> Replying to [jdemeyer](#comment%3A14):\n> > Replying to [dimpase](#comment%3A13):\n> > > It might well be a cython bug.\n\n> > \n> > Cython only creates a `.cpp` file. This seems like a linking issue, which Cython has nothing to do with.\n\n> it is perfectly possible to create a `.cpp` file that will produce a linking failure.\n> Given that fplll passes all of its own checks, it seems a bit strange that fpylll fails here.\n> \n> By the way, I wonder what precisely are options passed to clang that lead to this. \n> \n> * Does it get `-std=c++11`? \n> * Does it get `-stdlib=libc++`?\n> \n\n\nThere may be something to look there. `fplll` is compiled with `-std=c++11` but not `fpylll`. For the second, well it is a recent OS X so implicitly we are using `--stdlib=libc++` since this is the default one - I would have to point to the gnu one for it to be used.",
    "created_at": "2017-03-22T10:47:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22643#issuecomment-424193",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:16'></a>
Replying to [dimpase](#comment%3A15):
> Replying to [jdemeyer](#comment%3A14):
> > Replying to [dimpase](#comment%3A13):
> > > It might well be a cython bug.

> > 
> > Cython only creates a `.cpp` file. This seems like a linking issue, which Cython has nothing to do with.

> it is perfectly possible to create a `.cpp` file that will produce a linking failure.
> Given that fplll passes all of its own checks, it seems a bit strange that fpylll fails here.
> 
> By the way, I wonder what precisely are options passed to clang that lead to this. 
> 
> * Does it get `-std=c++11`? 
> * Does it get `-stdlib=libc++`?
> 


There may be something to look there. `fplll` is compiled with `-std=c++11` but not `fpylll`. For the second, well it is a recent OS X so implicitly we are using `--stdlib=libc++` since this is the default one - I would have to point to the gnu one for it to be used.



---

archive/issue_comments_424194.json:
```json
{
    "body": "<a id='comment:17'></a>\nReplying to [fbissey](#comment%3A16):\n> \n> There may be something to look there. `fplll` is compiled with `-std=c++11` but not `fpylll`. For the second, well it is a recent OS X so implicitly we are using `--stdlib=libc++` since this is the default one - I would have to point to the gnu one for it to be used.\n\n\nNope, adding `-std=c++11` in fpylll didn't help so it is not sufficient.",
    "created_at": "2017-03-22T10:53:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22643#issuecomment-424194",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:17'></a>
Replying to [fbissey](#comment%3A16):
> 
> There may be something to look there. `fplll` is compiled with `-std=c++11` but not `fpylll`. For the second, well it is a recent OS X so implicitly we are using `--stdlib=libc++` since this is the default one - I would have to point to the gnu one for it to be used.


Nope, adding `-std=c++11` in fpylll didn't help so it is not sufficient.



---

archive/issue_comments_424195.json:
```json
{
    "body": "<a id='comment:18'></a>\nto give you some context, I get \n\n```\nbuilding 'fplll.integer_matrix' extension\ngcc -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -Wstrict-prototypes -I/usr/local/lib/python2.7/site-packages/cysignals -I/usr/local/include/python2.7 -c build/src/fpylll/fplll/integer_matrix.cpp -o build/temp.macosx-10.4-x86_64-2.7/build/src/fpylll/fplll/integer_matrix.o -std=c++11 -stdlib=libc++\nclang: error: invalid deployment target for -stdlib=libc++ (requires OS X 10.7 or later)\n```\nif I try using non-sage python; I first got that `build/temp.macosx-10.4` and weird C++ errors, and then this after I added explicit\n`-stdlib=libc++` in `setup.py`.\n\nSo this is some sort of p/cython misconfiguration related to (lack of) c++ support we have seen a lot already.\n\nPS. this particular error is fixed by `export MACOSX_DEPLOYMENT_TARGET=10.12`, and I am able to reproduce the import problem.",
    "created_at": "2017-03-22T10:57:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22643#issuecomment-424195",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:18'></a>
to give you some context, I get 

```
building 'fplll.integer_matrix' extension
gcc -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -Wstrict-prototypes -I/usr/local/lib/python2.7/site-packages/cysignals -I/usr/local/include/python2.7 -c build/src/fpylll/fplll/integer_matrix.cpp -o build/temp.macosx-10.4-x86_64-2.7/build/src/fpylll/fplll/integer_matrix.o -std=c++11 -stdlib=libc++
clang: error: invalid deployment target for -stdlib=libc++ (requires OS X 10.7 or later)
```
if I try using non-sage python; I first got that `build/temp.macosx-10.4` and weird C++ errors, and then this after I added explicit
`-stdlib=libc++` in `setup.py`.

So this is some sort of p/cython misconfiguration related to (lack of) c++ support we have seen a lot already.

PS. this particular error is fixed by `export MACOSX_DEPLOYMENT_TARGET=10.12`, and I am able to reproduce the import problem.



---

archive/issue_comments_424196.json:
```json
{
    "body": "<a id='comment:19'></a>\nthis is what this mangled symbol stands for:\n\n```\n$ c++filt -n _ZN5fplll14EnumerationDynINS_5FP_NRIA1_10dpe_structEEE16process_solutionEd\nfplll::EnumerationDyn<fplll::FP_NR<dpe_struct [1]> >::process_solution(double)\n```\nhowever `enumeration.so` only has\n\n```\ntypeinfo for fplll::EnumerationDyn<fplll::FP_NR<dpe_struct [1]> >\n  and\ntypeinfo name for fplll::EnumerationDyn<fplll::FP_NR<dpe_struct [1]> >\n```\n(I extracted the latter running `nm -gU` on that .so file.)\nIn comparison, `enumeration.so` built with `gcc`, also has\n\n```\nfplll::EnumerationDyn<fplll::FP_NR<dpe_struct [1]> >::~EnumerationDyn()\n```\n\nI have no idea why this happens.\n\n---\n\nmoreover, the same kind of difference can be traced by to `fplll.dynlib`, where the one built with gcc does have\nexplicit `process_solution` entries, e.g.\n\n```\nfplll::EnumerationDyn<fplll::FP_NR<dpe_struct [1]> >::process_solution(double)\n```\nbut the one built with clang does not. So perhaps the problem is already in `fplll.dynlib`, it's just not tested properly.",
    "created_at": "2017-03-22T14:12:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22643#issuecomment-424196",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:19'></a>
this is what this mangled symbol stands for:

```
$ c++filt -n _ZN5fplll14EnumerationDynINS_5FP_NRIA1_10dpe_structEEE16process_solutionEd
fplll::EnumerationDyn<fplll::FP_NR<dpe_struct [1]> >::process_solution(double)
```
however `enumeration.so` only has

```
typeinfo for fplll::EnumerationDyn<fplll::FP_NR<dpe_struct [1]> >
  and
typeinfo name for fplll::EnumerationDyn<fplll::FP_NR<dpe_struct [1]> >
```
(I extracted the latter running `nm -gU` on that .so file.)
In comparison, `enumeration.so` built with `gcc`, also has

```
fplll::EnumerationDyn<fplll::FP_NR<dpe_struct [1]> >::~EnumerationDyn()
```

I have no idea why this happens.

---

moreover, the same kind of difference can be traced by to `fplll.dynlib`, where the one built with gcc does have
explicit `process_solution` entries, e.g.

```
fplll::EnumerationDyn<fplll::FP_NR<dpe_struct [1]> >::process_solution(double)
```
but the one built with clang does not. So perhaps the problem is already in `fplll.dynlib`, it's just not tested properly.



---

archive/issue_comments_424197.json:
```json
{
    "body": "<a id='comment:20'></a>\nThe `-g` option of `nm` only show global symbols. The faulty one is \"local\", you will find it in the clang version if you don't pass any option to `nm`. What type of symbol is it according to `nm` for gcc on OS X for you?\n\nOn linux it is of type \"W\", according to the man page:\n\nThe symbol is a weak symbol that has not been specifically tagged as a weak object symbol. When a weak defined symbol is linked with a normal defined symbol, the normal defined symbol is used with no error. When a weak undefined symbol is linked and the symbol is not defined, the value of the symbol is determined in a system-specific manner without error. On some systems, uppercase indicates that a default value has been specified.",
    "created_at": "2017-03-22T21:00:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22643#issuecomment-424197",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:20'></a>
The `-g` option of `nm` only show global symbols. The faulty one is "local", you will find it in the clang version if you don't pass any option to `nm`. What type of symbol is it according to `nm` for gcc on OS X for you?

On linux it is of type "W", according to the man page:

The symbol is a weak symbol that has not been specifically tagged as a weak object symbol. When a weak defined symbol is linked with a normal defined symbol, the normal defined symbol is used with no error. When a weak undefined symbol is linked and the symbol is not defined, the value of the symbol is determined in a system-specific manner without error. On some systems, uppercase indicates that a default value has been specified.



---

archive/issue_comments_424198.json:
```json
{
    "body": "<a id='comment:21'></a>\nReplying to [fbissey](#comment%3A20):\n> The `-g` option of `nm` only show global symbols. The faulty one is \"local\", you will find it in the clang version if you don't pass any option to `nm`. What type of symbol is it according to `nm` for gcc on OS X for you?\n> \n\nrunning `nm` without options, I see that `gcc` makes them type 'T', whereas `clang` makes them type 't'. I.e. `gcc` makes them externally exposed, whereas `clang` does not (`t` stands for non-external section symbol, and `T` stands for external section symbol).\nIn fact, `clang` is totally correct there - private class members must not be exposed.\n\nIt seems that the design only works on `gcc` due to a bug there :-)\n\nAlso, it appears that `fplll` does not supply any tests for this \"enumeration\" functionality. I'm trying to write one now, so that it can be seen purely on C++ level.",
    "created_at": "2017-03-22T22:17:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22643#issuecomment-424198",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:21'></a>
Replying to [fbissey](#comment%3A20):
> The `-g` option of `nm` only show global symbols. The faulty one is "local", you will find it in the clang version if you don't pass any option to `nm`. What type of symbol is it according to `nm` for gcc on OS X for you?
> 

running `nm` without options, I see that `gcc` makes them type 'T', whereas `clang` makes them type 't'. I.e. `gcc` makes them externally exposed, whereas `clang` does not (`t` stands for non-external section symbol, and `T` stands for external section symbol).
In fact, `clang` is totally correct there - private class members must not be exposed.

It seems that the design only works on `gcc` due to a bug there :-)

Also, it appears that `fplll` does not supply any tests for this "enumeration" functionality. I'm trying to write one now, so that it can be seen purely on C++ level.



---

archive/issue_comments_424199.json:
```json
{
    "body": "<a id='comment:22'></a>\nNeed this patch to build with clang on OSX https://github.com/fplll/fplll/commit/f372182bbe0f0597e7d6e39f8d23f18a21d1d500\n\nHere's the backported patch for 5.0.3 https://github.com/conda-forge/fplll-feedstock/blob/master/recipe/enumeration-link-error.patch",
    "created_at": "2017-03-23T11:28:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22643#issuecomment-424199",
    "user": "https://github.com/isuruf"
}
```

<a id='comment:22'></a>
Need this patch to build with clang on OSX https://github.com/fplll/fplll/commit/f372182bbe0f0597e7d6e39f8d23f18a21d1d500

Here's the backported patch for 5.0.3 https://github.com/conda-forge/fplll-feedstock/blob/master/recipe/enumeration-link-error.patch



---

archive/issue_comments_424200.json:
```json
{
    "body": "<a id='comment:23'></a>\nDoh! Sage's fplll is not current! Thanks!",
    "created_at": "2017-03-23T11:36:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22643#issuecomment-424200",
    "user": "https://github.com/malb"
}
```

<a id='comment:23'></a>
Doh! Sage's fplll is not current! Thanks!



---

archive/issue_comments_424201.json:
```json
{
    "body": "<a id='comment:24'></a>\nReplying to [malb](#comment%3A23):\n> Doh! Sage's fplll is not current! Thanks!\n\n\nwith the current fplll master branch, I get the following error in building fpylll with clang:\n\n```\nbuilding 'fplll.bkz_param' extension\ngcc -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -Wstrict-prototypes -I/usr/local/lib/python2.7/site-packages/cysignals -I/usr/local/include/python2.7 -c build/src/fpylll/fplll/bkz_param.cpp -o build/temp.macosx-10.4-x86_64-2.7/build/src/fpylll/fplll/bkz_param.o -std=c++11 -stdlib=libc++\nbuild/src/fpylll/fplll/bkz_param.cpp:2084:44: error: no member named 'probability' in 'fplll::Pruning'\n  __pyx_t_5 = PyFloat_FromDouble(__pyx_v_p.probability); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 65, __pyx_L1_error)\n                                 ~~~~~~~~~ ^\nbuild/src/fpylll/fplll/bkz_param.cpp:2185:16: error: no member named 'probability' in 'fplll::Pruning'\n  __pyx_v_self.probability = __pyx_t_1;\n  ~~~~~~~~~~~~ ^\n2 errors generated.\nerror: command 'gcc' failed with exit status 1\n\n$ gcc -v\nConfigured with: --prefix=/Applications/Xcode.app/Contents/Developer/usr --with-gxx-include-dir=/usr/include/c++/4.2.1\nApple LLVM version 8.0.0 (clang-800.0.42.1)\nTarget: x86_64-apple-darwin16.4.0\nThread model: posix\nInstalledDir: /Volumes/Sage/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin\n```",
    "created_at": "2017-03-23T12:58:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22643#issuecomment-424201",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:24'></a>
Replying to [malb](#comment%3A23):
> Doh! Sage's fplll is not current! Thanks!


with the current fplll master branch, I get the following error in building fpylll with clang:

```
building 'fplll.bkz_param' extension
gcc -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -Wstrict-prototypes -I/usr/local/lib/python2.7/site-packages/cysignals -I/usr/local/include/python2.7 -c build/src/fpylll/fplll/bkz_param.cpp -o build/temp.macosx-10.4-x86_64-2.7/build/src/fpylll/fplll/bkz_param.o -std=c++11 -stdlib=libc++
build/src/fpylll/fplll/bkz_param.cpp:2084:44: error: no member named 'probability' in 'fplll::Pruning'
  __pyx_t_5 = PyFloat_FromDouble(__pyx_v_p.probability); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 65, __pyx_L1_error)
                                 ~~~~~~~~~ ^
build/src/fpylll/fplll/bkz_param.cpp:2185:16: error: no member named 'probability' in 'fplll::Pruning'
  __pyx_v_self.probability = __pyx_t_1;
  ~~~~~~~~~~~~ ^
2 errors generated.
error: command 'gcc' failed with exit status 1

$ gcc -v
Configured with: --prefix=/Applications/Xcode.app/Contents/Developer/usr --with-gxx-include-dir=/usr/include/c++/4.2.1
Apple LLVM version 8.0.0 (clang-800.0.42.1)
Target: x86_64-apple-darwin16.4.0
Thread model: posix
InstalledDir: /Volumes/Sage/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin
```



---

archive/issue_comments_424202.json:
```json
{
    "body": "<a id='comment:25'></a>\nReplying to [dimpase](#comment%3A24):\n> Replying to [malb](#comment%3A23):\n> > Doh! Sage's fplll is not current! Thanks!\n\n> \n> with the current fplll master branch, I get the following error in building fpylll with clang:\n>  \n\noh, fpylll isn't up do date in Sage, either. With the git master version of fpylll, everything works.\nMartin, time for new fp(y)lll Sage packages?",
    "created_at": "2017-03-23T13:15:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22643#issuecomment-424202",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:25'></a>
Replying to [dimpase](#comment%3A24):
> Replying to [malb](#comment%3A23):
> > Doh! Sage's fplll is not current! Thanks!

> 
> with the current fplll master branch, I get the following error in building fpylll with clang:
>  

oh, fpylll isn't up do date in Sage, either. With the git master version of fpylll, everything works.
Martin, time for new fp(y)lll Sage packages?



---

archive/issue_comments_424203.json:
```json
{
    "body": "<a id='comment:26'></a>\nfpylll 0.2.3dev with fplll 5.0.3 + patch I mentioned works on OSX with clang.\n\nIt's great to have new releases though.",
    "created_at": "2017-03-23T13:26:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22643#issuecomment-424203",
    "user": "https://github.com/isuruf"
}
```

<a id='comment:26'></a>
fpylll 0.2.3dev with fplll 5.0.3 + patch I mentioned works on OSX with clang.

It's great to have new releases though.



---

archive/issue_comments_424204.json:
```json
{
    "body": "<a id='comment:27'></a>\nAgreed, I'll get on that.",
    "created_at": "2017-03-23T13:45:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22643#issuecomment-424204",
    "user": "https://github.com/malb"
}
```

<a id='comment:27'></a>
Agreed, I'll get on that.



---

archive/issue_events_067140.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/22643",
    "rename": {
        "from": "build with clang: fplll symbol not found errors",
        "to": "Upgrade fplll/fpylll to new release"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22643#event-67140"
}
```



---

archive/issue_comments_424205.json:
```json
{
    "body": "Set assignee to @malb.",
    "created_at": "2017-03-23T13:45:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22643#issuecomment-424205",
    "user": "https://github.com/malb"
}
```

Set assignee to @malb.



---

archive/issue_comments_424206.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -20,3 +20,9 @@\n  in /Users/mkoeppe/s/sage/sage-rebasing/homebrew-gcc/local/lib/python2.7/site-packages/fpylll/fplll/enumeration.so\n ```\n \n+*tarballs*\n+\n+- https://github.com/fplll/fplll/releases/download/5.1.0/fplll-5.1.0.tar.gz\n+- https://github.com/fplll/fpylll/releases/download/0.2.4dev/fpylll-0.2.4dev.tar.gz\n+\n+\n``````\n",
    "created_at": "2017-03-26T17:45:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22643#issuecomment-424206",
    "user": "https://github.com/malb"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -20,3 +20,9 @@
  in /Users/mkoeppe/s/sage/sage-rebasing/homebrew-gcc/local/lib/python2.7/site-packages/fpylll/fplll/enumeration.so
 ```
 
+*tarballs*
+
+- https://github.com/fplll/fplll/releases/download/5.1.0/fplll-5.1.0.tar.gz
+- https://github.com/fplll/fpylll/releases/download/0.2.4dev/fpylll-0.2.4dev.tar.gz
+
+
``````




---

archive/issue_comments_424207.json:
```json
{
    "body": "Changing branch from \"\" to \"u/malb/22643-fplll-upgrade\"",
    "created_at": "2017-03-26T18:25:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22643#issuecomment-424207",
    "user": "https://github.com/malb"
}
```

Changing branch from "" to "u/malb/22643-fplll-upgrade"



---

archive/issue_comments_424208.json:
```json
{
    "body": "Changing upstream from \"N/A\" to \"Fixed upstream, in a later stable release.\"",
    "created_at": "2017-03-26T18:26:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22643#issuecomment-424208",
    "user": "https://github.com/malb"
}
```

Changing upstream from "N/A" to "Fixed upstream, in a later stable release."



---

archive/issue_comments_424209.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-03-26T18:26:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22643#issuecomment-424209",
    "user": "https://github.com/malb"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_424210.json:
```json
{
    "body": "Changing commit from \"\" to \"d0d5ca778cf897f2b1c9742f9d0b9966625d591e\"",
    "created_at": "2017-03-26T18:26:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22643#issuecomment-424210",
    "user": "https://github.com/malb"
}
```

Changing commit from "" to "d0d5ca778cf897f2b1c9742f9d0b9966625d591e"



---

archive/issue_comments_424211.json:
```json
{
    "body": "<a id='comment:30'></a>\nNew commits:\n|                                                                                                                                          |                                       |\n|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------|\n|[d0d5ca7](https://github.com/sagemath/sagetrac-mirror/commit/d0d5ca778cf897f2b1c9742f9d0b9966625d591e)|`update fplll/fpylll to 5.1.0/0.2.4dev`|",
    "created_at": "2017-03-26T18:26:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22643#issuecomment-424211",
    "user": "https://github.com/malb"
}
```

<a id='comment:30'></a>
New commits:
|                                                                                                                                          |                                       |
|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------|
|[d0d5ca7](https://github.com/sagemath/sagetrac-mirror/commit/d0d5ca778cf897f2b1c9742f9d0b9966625d591e)|`update fplll/fpylll to 5.1.0/0.2.4dev`|



---

archive/issue_comments_424212.json:
```json
{
    "body": "Changing author from \"\" to \"Martin Albrecht\"",
    "created_at": "2017-03-26T18:26:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22643#issuecomment-424212",
    "user": "https://github.com/malb"
}
```

Changing author from "" to "Martin Albrecht"



---

archive/issue_comments_424213.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-03-26T22:47:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22643#issuecomment-424213",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_424214.json:
```json
{
    "body": "<a id='comment:31'></a>\nWorks for me, solve the problem at hand fully.",
    "created_at": "2017-03-26T22:47:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22643#issuecomment-424214",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:31'></a>
Works for me, solve the problem at hand fully.



---

archive/issue_comments_424215.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Fran\u00e7ois Bissey\"",
    "created_at": "2017-03-26T22:47:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22643#issuecomment-424215",
    "user": "https://github.com/kiwifb"
}
```

Changing reviewer from "" to "FranÃ§ois Bissey"



---

archive/issue_comments_424216.json:
```json
{
    "body": "<a id='comment:32'></a>\nworks on FreeBSD 11.0 with clang (libc++) / gfortran (sic!, cf.  #22679) too.",
    "created_at": "2017-03-27T14:30:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22643#issuecomment-424216",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:32'></a>
works on FreeBSD 11.0 with clang (libc++) / gfortran (sic!, cf.  #22679) too.



---

archive/issue_comments_424217.json:
```json
{
    "body": "Changing branch from \"u/malb/22643-fplll-upgrade\" to \"d0d5ca778cf897f2b1c9742f9d0b9966625d591e\"",
    "created_at": "2017-04-03T21:00:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22643#issuecomment-424217",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/malb/22643-fplll-upgrade" to "d0d5ca778cf897f2b1c9742f9d0b9966625d591e"



---

archive/issue_events_067141.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-04-03T21:00:05Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/22643",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22643#event-67141"
}
```



---

archive/issue_comments_424218.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-04-03T21:00:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22643#issuecomment-424218",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
