# Issue 22463: Skip sage_setup tests when not running in a git repository

archive/issues_022226.json:
```json
{
    "assignees": [],
    "body": "Two tests that always fail for in the Docker container for Sage are the ones in `src/sage_setup/clean.py` and `src/sage_setup/find.py`.  This is in part because as designed, these tests don't make sense outside of a Sage development environment. \n\nBut in the Docker container (as well as the Windows installer) most build artifacts get cleaned up, so these tests no longer make sense.\n\nI feel like the easiest workaround is to just exclude the `sage_setup` tests entirely when running `sage -t -a` outside of a source repository.  These tests are important for testing the build tools themselves, but once Sage is built it's more important to focus on running tests of runtime behavior.\n\nI'm open to other suggestions, but it would be nice to get this fixed so as to have reliable tests in the Docker container builds.\n\n(For a little additional context: There are two build modes for the Docker container, one for 'develop' and one for 'releases'.  The 'develop' mode doesn't do as much cleanup, and so these tests in fact will work.  But then when making a 'release' image and subsequently running the tests, these tests fail since more cleanup is done for the 'release' images.)\n\nBranch/Commit: **[`a8185b8`](https://github.com/sagemath/sagetrac-mirror/commit/a8185b8ab1b2a00eac8929078bc2991253854372)**\n\nReviewer: **Jeroen Demeyer**\n\nAuthor: **Erik Bray**\n\nComponent: **doctest framework**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/22463_\n\n",
    "closed_at": "2017-03-01T18:50:32Z",
    "created_at": "2017-02-27T16:36:51Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20doctest%20framework",
        "https://github.com/sagemath/sage/labels/p%3A%204%20%E2%80%93%20minor",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-7.6",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Skip sage_setup tests when not running in a git repository",
    "type": "issue",
    "updated_at": "2017-03-01T18:50:32Z",
    "url": "https://github.com/sagemath/sage/issues/22463",
    "user": "https://github.com/embray"
}
```
Two tests that always fail for in the Docker container for Sage are the ones in `src/sage_setup/clean.py` and `src/sage_setup/find.py`.  This is in part because as designed, these tests don't make sense outside of a Sage development environment. 

But in the Docker container (as well as the Windows installer) most build artifacts get cleaned up, so these tests no longer make sense.

I feel like the easiest workaround is to just exclude the `sage_setup` tests entirely when running `sage -t -a` outside of a source repository.  These tests are important for testing the build tools themselves, but once Sage is built it's more important to focus on running tests of runtime behavior.

I'm open to other suggestions, but it would be nice to get this fixed so as to have reliable tests in the Docker container builds.

(For a little additional context: There are two build modes for the Docker container, one for 'develop' and one for 'releases'.  The 'develop' mode doesn't do as much cleanup, and so these tests in fact will work.  But then when making a 'release' image and subsequently running the tests, these tests fail since more cleanup is done for the 'release' images.)

Branch/Commit: **[`a8185b8`](https://github.com/sagemath/sagetrac-mirror/commit/a8185b8ab1b2a00eac8929078bc2991253854372)**

Reviewer: **Jeroen Demeyer**

Author: **Erik Bray**

Component: **doctest framework**

_Issue created by migration from https://trac.sagemath.org/ticket/22463_





---

archive/issue_events_314044.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-02-27T16:36:51Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/22463",
    "milestone_number": null,
    "milestone_title": "sage-7.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22463#event-314044"
}
```



---

archive/issue_events_314045.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-02-27T16:36:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22463",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20doctest%20framework",
    "label_color": "000080",
    "label_name": "c: doctest framework",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22463#event-314045"
}
```



---

archive/issue_events_314046.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-02-27T16:36:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22463",
    "label": "https://github.com/sagemath/sage/labels/p%3A%204%20%E2%80%93%20minor",
    "label_color": "ffe799",
    "label_name": "p: 4 \u2013 minor",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22463#event-314046"
}
```



---

archive/issue_events_314047.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-02-27T16:36:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22463",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22463#event-314047"
}
```



---

archive/issue_events_314048.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-02-27T16:36:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22463",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22463#event-314048"
}
```



---

archive/issue_comments_332688.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nDoesn't seem to actually be skipping the tests.",
    "created_at": "2017-02-27T16:56:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22463#issuecomment-332688",
    "user": "https://github.com/embray"
}
```

<div id="comment:2" align="right">comment:2</div>

Doesn't seem to actually be skipping the tests.



---

archive/issue_events_314049.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-02-27T16:56:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22463",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22463#event-314049"
}
```



---

archive/issue_events_314050.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-02-27T16:56:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22463",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22463#event-314050"
}
```



---

archive/issue_comments_332689.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nScratch that--I just forgot to reinstall.",
    "created_at": "2017-02-27T17:00:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22463#issuecomment-332689",
    "user": "https://github.com/embray"
}
```

<div id="comment:3" align="right">comment:3</div>

Scratch that--I just forgot to reinstall.



---

archive/issue_events_314051.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-02-27T17:00:28Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22463",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22463#event-314051"
}
```



---

archive/issue_events_314052.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-02-27T17:00:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22463",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22463#event-314052"
}
```



---

archive/issue_comments_332690.json:
```json
{
    "body": "Reviewer: **Jeroen Demeyer**",
    "created_at": "2017-02-28T09:32:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22463#issuecomment-332690",
    "user": "https://github.com/jdemeyer"
}
```

Reviewer: **Jeroen Demeyer**



---

archive/issue_events_314053.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-02-28T09:32:49Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22463",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22463#event-314053"
}
```



---

archive/issue_events_314054.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-02-28T09:32:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22463",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22463#event-314054"
}
```



---

archive/issue_comments_332691.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nThanks--it would be good to have this in 7.6.",
    "created_at": "2017-02-28T13:18:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22463#issuecomment-332691",
    "user": "https://github.com/embray"
}
```

<div id="comment:5" align="right">comment:5</div>

Thanks--it would be good to have this in 7.6.



---

archive/issue_comments_332692.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nThank you, thank you Erik for this. This will reduce my patching.",
    "created_at": "2017-03-01T04:00:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22463#issuecomment-332692",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:6" align="right">comment:6</div>

Thank you, thank you Erik for this. This will reduce my patching.



---

archive/issue_comments_332693.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nReplying to [@kiwifb](#comment:6):\n> Thank you, thank you Erik for this. This will reduce my patching.\n\nI have another suite of patches I've been working on that I think you'll like (I started months ago before Christmas vacation but have just been bogged down with other things).  The purpose is to get Sage working better at runtime (including the test suite) when not running out of a source tree. So it will work much better when \"installed\" in a distro.",
    "created_at": "2017-03-01T08:37:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22463#issuecomment-332693",
    "user": "https://github.com/embray"
}
```

<div id="comment:7" align="right">comment:7</div>

Replying to [@kiwifb](#comment:6):
> Thank you, thank you Erik for this. This will reduce my patching.

I have another suite of patches I've been working on that I think you'll like (I started months ago before Christmas vacation but have just been bogged down with other things).  The purpose is to get Sage working better at runtime (including the test suite) when not running out of a source tree. So it will work much better when "installed" in a distro.



---

archive/issue_events_314055.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-03-01T18:50:32Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22463",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22463#event-314055"
}
```



---

archive/issue_events_314056.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-03-01T18:50:32Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/22463",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22463#event-314056"
}
```



---

archive/issue_comments_332694.json:
```json
{
    "body": "Changed branch from **[u/embray/docker-tests](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/docker-tests)** to **[`a8185b8`](https://github.com/sagemath/sagetrac-mirror/commit/a8185b8ab1b2a00eac8929078bc2991253854372)**",
    "created_at": "2017-03-01T18:50:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22463#issuecomment-332694",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/embray/docker-tests](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/docker-tests)** to **[`a8185b8`](https://github.com/sagemath/sagetrac-mirror/commit/a8185b8ab1b2a00eac8929078bc2991253854372)**
