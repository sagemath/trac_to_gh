# Issue 22764: Remove the link SAGE_LOCAL/lib/python

archive/issues_022527.json:
```json
{
    "body": "We do not need the link `SAGE_LOCAL/lib/python`, pointing to `python2.7`, and it can interfere with the Python 3 build, at least on OS X. (See #22756.)\n\n\nBranch/Commit: [fb90d5e3667237f2d9fc7ba982b466bc52802b1d](https://github.com/sagemath/sagetrac-mirror/commit/fb90d5e3667237f2d9fc7ba982b466bc52802b1d)\n\nReviewer: Volker Braun\n\nAuthor: John Palmieri\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/22764\n\n",
    "closed_at": "2017-04-18T22:36:43Z",
    "created_at": "2017-04-05T21:51:04Z",
    "labels": [
        "component: build",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.0",
    "title": "Remove the link SAGE_LOCAL/lib/python",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22764",
    "user": "https://github.com/jhpalmieri"
}
```
We do not need the link `SAGE_LOCAL/lib/python`, pointing to `python2.7`, and it can interfere with the Python 3 build, at least on OS X. (See #22756.)


Branch/Commit: [fb90d5e3667237f2d9fc7ba982b466bc52802b1d](https://github.com/sagemath/sagetrac-mirror/commit/fb90d5e3667237f2d9fc7ba982b466bc52802b1d)

Reviewer: Volker Braun

Author: John Palmieri

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/22764





---

archive/issue_comments_427178.json:
```json
{
    "body": "Branch: [u/jhpalmieri/no-local-lib-python](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/no-local-lib-python)",
    "created_at": "2017-04-05T21:52:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22764#issuecomment-427178",
    "user": "https://github.com/jhpalmieri"
}
```

Branch: [u/jhpalmieri/no-local-lib-python](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/no-local-lib-python)



---

archive/issue_comments_427179.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-04-05T21:54:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22764#issuecomment-427179",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_427180.json:
```json
{
    "body": "<a id='comment:2'></a>\nNew commits:\n|                                                                                                                                          |                                                                |\n|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------|\n|[0e90d52](https://github.com/sagemath/sagetrac-mirror/commit/0e90d5294f2dd1f95f2e96bf34830d1256a3f211)|`Trac 22764: remove the link SAGE_LOCAL/lib/python -> python2.7`|",
    "created_at": "2017-04-05T21:54:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22764#issuecomment-427180",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:2'></a>
New commits:
|                                                                                                                                          |                                                                |
|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------|
|[0e90d52](https://github.com/sagemath/sagetrac-mirror/commit/0e90d5294f2dd1f95f2e96bf34830d1256a3f211)|`Trac 22764: remove the link SAGE_LOCAL/lib/python -> python2.7`|



---

archive/issue_comments_427181.json:
```json
{
    "body": "Commit: [0e90d5294f2dd1f95f2e96bf34830d1256a3f211](https://github.com/sagemath/sagetrac-mirror/commit/0e90d5294f2dd1f95f2e96bf34830d1256a3f211)",
    "created_at": "2017-04-05T21:54:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22764#issuecomment-427181",
    "user": "https://github.com/jhpalmieri"
}
```

Commit: [0e90d5294f2dd1f95f2e96bf34830d1256a3f211](https://github.com/sagemath/sagetrac-mirror/commit/0e90d5294f2dd1f95f2e96bf34830d1256a3f211)



---

archive/issue_comments_427182.json:
```json
{
    "body": "Changing commit from \"[0e90d5294f2dd1f95f2e96bf34830d1256a3f211](https://github.com/sagemath/sagetrac-mirror/commit/0e90d5294f2dd1f95f2e96bf34830d1256a3f211)\" to \"[f33e86f76463c02dee30513fd5553ebbe5a228d5](https://github.com/sagemath/sagetrac-mirror/commit/f33e86f76463c02dee30513fd5553ebbe5a228d5)\"",
    "created_at": "2017-04-05T22:09:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22764#issuecomment-427182",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "[0e90d5294f2dd1f95f2e96bf34830d1256a3f211](https://github.com/sagemath/sagetrac-mirror/commit/0e90d5294f2dd1f95f2e96bf34830d1256a3f211)" to "[f33e86f76463c02dee30513fd5553ebbe5a228d5](https://github.com/sagemath/sagetrac-mirror/commit/f33e86f76463c02dee30513fd5553ebbe5a228d5)"



---

archive/issue_comments_427183.json:
```json
{
    "body": "<a id='comment:3'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                        |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------|\n|[f33e86f](https://github.com/sagemath/sagetrac-mirror/commit/f33e86f76463c02dee30513fd5553ebbe5a228d5)|`trac 22764: replace a few instances of`|",
    "created_at": "2017-04-05T22:09:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22764#issuecomment-427183",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                        |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------|
|[f33e86f](https://github.com/sagemath/sagetrac-mirror/commit/f33e86f76463c02dee30513fd5553ebbe5a228d5)|`trac 22764: replace a few instances of`|



---

archive/issue_comments_427184.json:
```json
{
    "body": "<a id='comment:4'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                               |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------|\n|[b02ecf3](https://github.com/sagemath/sagetrac-mirror/commit/b02ecf34018f48b24012623c5388a34d589bb3d2)|`trac 22764: in a few comments and print statements, fix a few`|",
    "created_at": "2017-04-05T22:34:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22764#issuecomment-427184",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                               |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------|
|[b02ecf3](https://github.com/sagemath/sagetrac-mirror/commit/b02ecf34018f48b24012623c5388a34d589bb3d2)|`trac 22764: in a few comments and print statements, fix a few`|



---

archive/issue_comments_427185.json:
```json
{
    "body": "Changing commit from \"[f33e86f76463c02dee30513fd5553ebbe5a228d5](https://github.com/sagemath/sagetrac-mirror/commit/f33e86f76463c02dee30513fd5553ebbe5a228d5)\" to \"[b02ecf34018f48b24012623c5388a34d589bb3d2](https://github.com/sagemath/sagetrac-mirror/commit/b02ecf34018f48b24012623c5388a34d589bb3d2)\"",
    "created_at": "2017-04-05T22:34:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22764#issuecomment-427185",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "[f33e86f76463c02dee30513fd5553ebbe5a228d5](https://github.com/sagemath/sagetrac-mirror/commit/f33e86f76463c02dee30513fd5553ebbe5a228d5)" to "[b02ecf34018f48b24012623c5388a34d589bb3d2](https://github.com/sagemath/sagetrac-mirror/commit/b02ecf34018f48b24012623c5388a34d589bb3d2)"



---

archive/issue_comments_427186.json:
```json
{
    "body": "<a id='comment:5'></a>\nsee also #22638",
    "created_at": "2017-04-06T12:10:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22764#issuecomment-427186",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:5'></a>
see also #22638



---

archive/issue_comments_427187.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-04-06T20:33:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22764#issuecomment-427187",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_427188.json:
```json
{
    "body": "<a id='comment:6'></a>\ndoes not apply",
    "created_at": "2017-04-06T20:33:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22764#issuecomment-427188",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:6'></a>
does not apply



---

archive/issue_comments_427189.json:
```json
{
    "body": "<a id='comment:7'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                      |\n|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------|\n|[df6a763](https://github.com/sagemath/sagetrac-mirror/commit/df6a763f1c6190cbcb33501fdf7b6f4e5ee46400)|`trac 22764: rebase to Sage 8.0.beta1`|",
    "created_at": "2017-04-06T20:39:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22764#issuecomment-427189",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                      |
|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------|
|[df6a763](https://github.com/sagemath/sagetrac-mirror/commit/df6a763f1c6190cbcb33501fdf7b6f4e5ee46400)|`trac 22764: rebase to Sage 8.0.beta1`|



---

archive/issue_comments_427190.json:
```json
{
    "body": "Changing commit from \"[b02ecf34018f48b24012623c5388a34d589bb3d2](https://github.com/sagemath/sagetrac-mirror/commit/b02ecf34018f48b24012623c5388a34d589bb3d2)\" to \"[df6a763f1c6190cbcb33501fdf7b6f4e5ee46400](https://github.com/sagemath/sagetrac-mirror/commit/df6a763f1c6190cbcb33501fdf7b6f4e5ee46400)\"",
    "created_at": "2017-04-06T20:39:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22764#issuecomment-427190",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "[b02ecf34018f48b24012623c5388a34d589bb3d2](https://github.com/sagemath/sagetrac-mirror/commit/b02ecf34018f48b24012623c5388a34d589bb3d2)" to "[df6a763f1c6190cbcb33501fdf7b6f4e5ee46400](https://github.com/sagemath/sagetrac-mirror/commit/df6a763f1c6190cbcb33501fdf7b6f4e5ee46400)"



---

archive/issue_comments_427191.json:
```json
{
    "body": "<a id='comment:8'></a>\nThis should apply now. The old version changed `src/sage/all.py` to fix a doctest. The conflict replaced the old doctest with the one from Sage 8.0.beta1 that looks more robust to me. I haven't built with this change, though, so I can't promise no doctest failures.",
    "created_at": "2017-04-06T20:42:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22764#issuecomment-427191",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:8'></a>
This should apply now. The old version changed `src/sage/all.py` to fix a doctest. The conflict replaced the old doctest with the one from Sage 8.0.beta1 that looks more robust to me. I haven't built with this change, though, so I can't promise no doctest failures.



---

archive/issue_comments_427192.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-04-06T20:42:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22764#issuecomment-427192",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_427193.json:
```json
{
    "body": "<a id='comment:9'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                  |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------|\n|[7cd0d62](https://github.com/sagemath/sagetrac-mirror/commit/7cd0d62ad1fe72747813b665682fea591aaf2a80)|`trac 22764: merge with 8.0.beta1`|",
    "created_at": "2017-04-06T20:47:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22764#issuecomment-427193",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                  |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------|
|[7cd0d62](https://github.com/sagemath/sagetrac-mirror/commit/7cd0d62ad1fe72747813b665682fea591aaf2a80)|`trac 22764: merge with 8.0.beta1`|



---

archive/issue_comments_427194.json:
```json
{
    "body": "Changing commit from \"[df6a763f1c6190cbcb33501fdf7b6f4e5ee46400](https://github.com/sagemath/sagetrac-mirror/commit/df6a763f1c6190cbcb33501fdf7b6f4e5ee46400)\" to \"[7cd0d62ad1fe72747813b665682fea591aaf2a80](https://github.com/sagemath/sagetrac-mirror/commit/7cd0d62ad1fe72747813b665682fea591aaf2a80)\"",
    "created_at": "2017-04-06T20:47:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22764#issuecomment-427194",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "[df6a763f1c6190cbcb33501fdf7b6f4e5ee46400](https://github.com/sagemath/sagetrac-mirror/commit/df6a763f1c6190cbcb33501fdf7b6f4e5ee46400)" to "[7cd0d62ad1fe72747813b665682fea591aaf2a80](https://github.com/sagemath/sagetrac-mirror/commit/7cd0d62ad1fe72747813b665682fea591aaf2a80)"



---

archive/issue_comments_427195.json:
```json
{
    "body": "<a id='comment:10'></a>\nEdit: moved the comment to #22756.",
    "created_at": "2017-04-06T23:38:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22764#issuecomment-427195",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:10'></a>
Edit: moved the comment to #22756.



---

archive/issue_comments_427196.json:
```json
{
    "body": "<a id='comment:11'></a>\nI don't agree with the change to `src/bin/sage`. It needs to check whether Sage was built inside `$SAGE_LOCAL` and the new code doesn't do that (it could potentially import a different version of Sage installed on the system).",
    "created_at": "2017-04-07T08:31:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22764#issuecomment-427196",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:11'></a>
I don't agree with the change to `src/bin/sage`. It needs to check whether Sage was built inside `$SAGE_LOCAL` and the new code doesn't do that (it could potentially import a different version of Sage installed on the system).



---

archive/issue_comments_427197.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-04-07T08:31:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22764#issuecomment-427197",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_427198.json:
```json
{
    "body": "<a id='comment:12'></a>\nI wasn't completely satisfied with that change, either. We could do something like this instead:\n\n```diff\ndiff --git a/src/bin/sage b/src/bin/sage\nindex cc6e41cbed..b26618a3b8 100755\n--- a/src/bin/sage\n+++ b/src/bin/sage\n@@ -383,7 +383,15 @@ fi\n # Prepare for running Sage, either interactively or non-interactively.\n sage_setup() {\n     # Check that we're not in a source tarball which hasn't been built yet (#13561).\n-    if ! python -c 'import sage.version' 2> /dev/null ; then\n+    if [ ! -x \"$SAGE_LOCAL/bin/python\" ]; then\n+        built=no\n+    else\n+        PYTHON_VERSION=$(\"$SAGE_LOCAL/bin/python\" -c 'import sys; print(\"%d.%d\" % sys.version_info[:2])')\n+        if [ ! -d \"$SAGE_LOCAL/lib/python$PYTHON_VERSION/site-packages/sage\" ]; then\n+            built=no\n+        fi\n+    fi\n+    if [ $built = no ]; then\n         echo >&2 '************************************************************************'\n         echo >&2 'It seems that you are attempting to run Sage from an unpacked source'\n         echo >&2 'tarball, but you have not compiled it yet (or maybe the build has not'\n```\nHow about that?",
    "created_at": "2017-04-07T14:31:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22764#issuecomment-427198",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:12'></a>
I wasn't completely satisfied with that change, either. We could do something like this instead:

```diff
diff --git a/src/bin/sage b/src/bin/sage
index cc6e41cbed..b26618a3b8 100755
--- a/src/bin/sage
+++ b/src/bin/sage
@@ -383,7 +383,15 @@ fi
 # Prepare for running Sage, either interactively or non-interactively.
 sage_setup() {
     # Check that we're not in a source tarball which hasn't been built yet (#13561).
-    if ! python -c 'import sage.version' 2> /dev/null ; then
+    if [ ! -x "$SAGE_LOCAL/bin/python" ]; then
+        built=no
+    else
+        PYTHON_VERSION=$("$SAGE_LOCAL/bin/python" -c 'import sys; print("%d.%d" % sys.version_info[:2])')
+        if [ ! -d "$SAGE_LOCAL/lib/python$PYTHON_VERSION/site-packages/sage" ]; then
+            built=no
+        fi
+    fi
+    if [ $built = no ]; then
         echo >&2 '************************************************************************'
         echo >&2 'It seems that you are attempting to run Sage from an unpacked source'
         echo >&2 'tarball, but you have not compiled it yet (or maybe the build has not'
```
How about that?



---

archive/issue_comments_427199.json:
```json
{
    "body": "<a id='comment:13'></a>\nCan't we just check for the presence of SAGE_LOCAL/bin/sage instead of messing around with python minutae?",
    "created_at": "2017-04-08T17:41:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22764#issuecomment-427199",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:13'></a>
Can't we just check for the presence of SAGE_LOCAL/bin/sage instead of messing around with python minutae?



---

archive/issue_comments_427200.json:
```json
{
    "body": "<a id='comment:14'></a>\nI think that `SAGE_LOCAL/bin/sage` can get installed well before the Sage library.",
    "created_at": "2017-04-08T18:09:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22764#issuecomment-427200",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:14'></a>
I think that `SAGE_LOCAL/bin/sage` can get installed well before the Sage library.



---

archive/issue_comments_427201.json:
```json
{
    "body": "<a id='comment:15'></a>\nYes, but so what? Its only a sanity check that you don't try to run an unpacked source tarball.",
    "created_at": "2017-04-08T18:27:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22764#issuecomment-427201",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:15'></a>
Yes, but so what? Its only a sanity check that you don't try to run an unpacked source tarball.



---

archive/issue_comments_427202.json:
```json
{
    "body": "<a id='comment:16'></a>\nEither way is fine with me: check for `local/lib/python$PYTHON_VERSION/site-packages/sage/` or for `local/bin/sage`.",
    "created_at": "2017-04-08T18:48:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22764#issuecomment-427202",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:16'></a>
Either way is fine with me: check for `local/lib/python$PYTHON_VERSION/site-packages/sage/` or for `local/bin/sage`.



---

archive/issue_comments_427203.json:
```json
{
    "body": "Changing commit from \"[7cd0d62ad1fe72747813b665682fea591aaf2a80](https://github.com/sagemath/sagetrac-mirror/commit/7cd0d62ad1fe72747813b665682fea591aaf2a80)\" to \"[ab49413b6ee1f7eebcc9044caf2c0abc45aad746](https://github.com/sagemath/sagetrac-mirror/commit/ab49413b6ee1f7eebcc9044caf2c0abc45aad746)\"",
    "created_at": "2017-04-09T16:33:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22764#issuecomment-427203",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "[7cd0d62ad1fe72747813b665682fea591aaf2a80](https://github.com/sagemath/sagetrac-mirror/commit/7cd0d62ad1fe72747813b665682fea591aaf2a80)" to "[ab49413b6ee1f7eebcc9044caf2c0abc45aad746](https://github.com/sagemath/sagetrac-mirror/commit/ab49413b6ee1f7eebcc9044caf2c0abc45aad746)"



---

archive/issue_comments_427204.json:
```json
{
    "body": "<a id='comment:17'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                     |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------|\n|[ab49413](https://github.com/sagemath/sagetrac-mirror/commit/ab49413b6ee1f7eebcc9044caf2c0abc45aad746)|`trac 22764: change how check whether Sage is built.`|",
    "created_at": "2017-04-09T16:33:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22764#issuecomment-427204",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:17'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                     |
|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------|
|[ab49413](https://github.com/sagemath/sagetrac-mirror/commit/ab49413b6ee1f7eebcc9044caf2c0abc45aad746)|`trac 22764: change how check whether Sage is built.`|



---

archive/issue_comments_427205.json:
```json
{
    "body": "<a id='comment:18'></a>\nI decided that I like the more involved check. It is not complicated and it is more in line with the printed message, especially the part \"(or maybe the build has not finished)\".",
    "created_at": "2017-04-09T16:34:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22764#issuecomment-427205",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:18'></a>
I decided that I like the more involved check. It is not complicated and it is more in line with the printed message, especially the part "(or maybe the build has not finished)".



---

archive/issue_comments_427206.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-04-09T16:34:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22764#issuecomment-427206",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_427207.json:
```json
{
    "body": "<a id='comment:19'></a>\nThats hardcoding the assumption that python is a symlink to python3 when built with SAGE_PYTHON3=yes and would conflict with #22582",
    "created_at": "2017-04-09T18:32:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22764#issuecomment-427207",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:19'></a>
Thats hardcoding the assumption that python is a symlink to python3 when built with SAGE_PYTHON3=yes and would conflict with #22582



---

archive/issue_comments_427208.json:
```json
{
    "body": "<a id='comment:20'></a>\nReplying to [vbraun](#comment%3A19):\n> Thats hardcoding the assumption that python is a symlink to python3 when built with SAGE_PYTHON3=yes\n\n\nYes, you're right.\n\n> and would conflict with #22582\n\n\nIt would conflict with your current branch at #22582, but there is another option: making a reliable symlink `python -> python3` when `SAGE_PYTHON3=yes`. As I said at #22582, I would like to hear some other opinions about those two options. (As I also said at #22582, maybe `SAGE_PYTHON3` should control some run-time aspects of Sage, not just build-time. If such were available and did not just include the symlink, we could use those for this check.)",
    "created_at": "2017-04-09T20:10:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22764#issuecomment-427208",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:20'></a>
Replying to [vbraun](#comment%3A19):
> Thats hardcoding the assumption that python is a symlink to python3 when built with SAGE_PYTHON3=yes


Yes, you're right.

> and would conflict with #22582


It would conflict with your current branch at #22582, but there is another option: making a reliable symlink `python -> python3` when `SAGE_PYTHON3=yes`. As I said at #22582, I would like to hear some other opinions about those two options. (As I also said at #22582, maybe `SAGE_PYTHON3` should control some run-time aspects of Sage, not just build-time. If such were available and did not just include the symlink, we could use those for this check.)



---

archive/issue_comments_427209.json:
```json
{
    "body": "<a id='comment:21'></a>\nReplying to [vbraun](#comment%3A19):\n> Thats hardcoding the assumption that python is a symlink to python3 when built with SAGE_PYTHON3=yes and would conflict with #22582\n\n\nAnother way of looking at this: if we're not really thinking about how to run Sage using python3, that it's premature to do so, then: if you build with `SAGE_PYTHON3=yes`, the build will not complete because Sage isn't ready for Python 3 yet, so no matter what the symlink points to, you will get this message. If you build without `SAGE_PYTHON3=yes`, then the symlink should point to `python2` and this check will behave as it always has.\n\nIf we just check whether `local/bin/sage` exists, then you will get a less clear error message if Sage hasn't finished building yet, for whatever reason.\n\nOnce we figure out whether `SAGE_PYTHON3` has run-time effects or not, we can modify this check.",
    "created_at": "2017-04-12T17:17:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22764#issuecomment-427209",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:21'></a>
Replying to [vbraun](#comment%3A19):
> Thats hardcoding the assumption that python is a symlink to python3 when built with SAGE_PYTHON3=yes and would conflict with #22582


Another way of looking at this: if we're not really thinking about how to run Sage using python3, that it's premature to do so, then: if you build with `SAGE_PYTHON3=yes`, the build will not complete because Sage isn't ready for Python 3 yet, so no matter what the symlink points to, you will get this message. If you build without `SAGE_PYTHON3=yes`, then the symlink should point to `python2` and this check will behave as it always has.

If we just check whether `local/bin/sage` exists, then you will get a less clear error message if Sage hasn't finished building yet, for whatever reason.

Once we figure out whether `SAGE_PYTHON3` has run-time effects or not, we can modify this check.



---

archive/issue_comments_427210.json:
```json
{
    "body": "<a id='comment:22'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                        |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------|\n|[4715169](https://github.com/sagemath/sagetrac-mirror/commit/4715169cfe365879fa69f1046516731a7f50aa82)|`merging with 8.0.beta2`|\n|[fb90d5e](https://github.com/sagemath/sagetrac-mirror/commit/fb90d5e3667237f2d9fc7ba982b466bc52802b1d)|`trac 22764: check whether Sage is built by looking for local/bin/sage`|",
    "created_at": "2017-04-12T21:25:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22764#issuecomment-427210",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:22'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                        |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------|
|[4715169](https://github.com/sagemath/sagetrac-mirror/commit/4715169cfe365879fa69f1046516731a7f50aa82)|`merging with 8.0.beta2`|
|[fb90d5e](https://github.com/sagemath/sagetrac-mirror/commit/fb90d5e3667237f2d9fc7ba982b466bc52802b1d)|`trac 22764: check whether Sage is built by looking for local/bin/sage`|



---

archive/issue_comments_427211.json:
```json
{
    "body": "Changing commit from \"[ab49413b6ee1f7eebcc9044caf2c0abc45aad746](https://github.com/sagemath/sagetrac-mirror/commit/ab49413b6ee1f7eebcc9044caf2c0abc45aad746)\" to \"[fb90d5e3667237f2d9fc7ba982b466bc52802b1d](https://github.com/sagemath/sagetrac-mirror/commit/fb90d5e3667237f2d9fc7ba982b466bc52802b1d)\"",
    "created_at": "2017-04-12T21:25:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22764#issuecomment-427211",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "[ab49413b6ee1f7eebcc9044caf2c0abc45aad746](https://github.com/sagemath/sagetrac-mirror/commit/ab49413b6ee1f7eebcc9044caf2c0abc45aad746)" to "[fb90d5e3667237f2d9fc7ba982b466bc52802b1d](https://github.com/sagemath/sagetrac-mirror/commit/fb90d5e3667237f2d9fc7ba982b466bc52802b1d)"



---

archive/issue_comments_427212.json:
```json
{
    "body": "<a id='comment:23'></a>\nBut I don't really care that much.",
    "created_at": "2017-04-12T21:25:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22764#issuecomment-427212",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:23'></a>
But I don't really care that much.



---

archive/issue_comments_427213.json:
```json
{
    "body": "<a id='comment:24'></a>\nShould we bump the version numbers for python2 and python3, to make sure their spkg-install files get run, so the link actually gets removed when people upgrade?",
    "created_at": "2017-04-14T20:27:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22764#issuecomment-427213",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:24'></a>
Should we bump the version numbers for python2 and python3, to make sure their spkg-install files get run, so the link actually gets removed when people upgrade?



---

archive/issue_comments_427214.json:
```json
{
    "body": "Reviewer: Volker Braun",
    "created_at": "2017-04-16T22:49:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22764#issuecomment-427214",
    "user": "https://github.com/vbraun"
}
```

Reviewer: Volker Braun



---

archive/issue_comments_427215.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-04-16T22:49:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22764#issuecomment-427215",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_427216.json:
```json
{
    "body": "<a id='comment:25'></a>\nIts not actually harmful, so I'm fine with leaving the old link hang around...",
    "created_at": "2017-04-16T22:49:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22764#issuecomment-427216",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:25'></a>
Its not actually harmful, so I'm fine with leaving the old link hang around...



---

archive/issue_comments_427217.json:
```json
{
    "body": "<a id='comment:26'></a>\nThe link can break the python3 build on OS X, but #22756 bumps the version number on python3 to try to address this. It still may break the first time, but in such a way that the build will get far enough to delete the link. After that it should work the next time.",
    "created_at": "2017-04-17T04:03:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22764#issuecomment-427217",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:26'></a>
The link can break the python3 build on OS X, but #22756 bumps the version number on python3 to try to address this. It still may break the first time, but in such a way that the build will get far enough to delete the link. After that it should work the next time.



---

archive/issue_comments_427218.json:
```json
{
    "body": "Changing branch from \"[u/jhpalmieri/no-local-lib-python](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/no-local-lib-python)\" to \"[fb90d5e3667237f2d9fc7ba982b466bc52802b1d](https://github.com/sagemath/sagetrac-mirror/commit/fb90d5e3667237f2d9fc7ba982b466bc52802b1d)\"",
    "created_at": "2017-04-18T22:36:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22764#issuecomment-427218",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "[u/jhpalmieri/no-local-lib-python](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/no-local-lib-python)" to "[fb90d5e3667237f2d9fc7ba982b466bc52802b1d](https://github.com/sagemath/sagetrac-mirror/commit/fb90d5e3667237f2d9fc7ba982b466bc52802b1d)"



---

archive/issue_events_067383.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-04-18T22:36:43Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/22764",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22764#event-67383"
}
```



---

archive/issue_comments_427219.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-04-18T22:36:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22764#issuecomment-427219",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
