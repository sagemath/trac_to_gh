# Issue 22764: Remove the link SAGE_LOCAL/lib/python

archive/issues_022527.json:
```json
{
    "assignees": [],
    "body": "We do not need the link `SAGE_LOCAL/lib/python`, pointing to `python2.7`, and it can interfere with the Python 3 build, at least on OS X. (See #22756.)\n\n\nBranch/Commit: **[`fb90d5e`](https://github.com/sagemath/sagetrac-mirror/commit/fb90d5e3667237f2d9fc7ba982b466bc52802b1d)**\n\nReviewer: **Volker Braun**\n\nAuthor: **John Palmieri**\n\nComponent: **build**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/22764_\n\n",
    "closed_at": "2017-04-18T22:36:43Z",
    "created_at": "2017-04-05T21:51:04Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20build",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.0",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Remove the link SAGE_LOCAL/lib/python",
    "type": "issue",
    "updated_at": "2017-04-18T22:36:43Z",
    "url": "https://github.com/sagemath/sage/issues/22764",
    "user": "https://github.com/jhpalmieri"
}
```
We do not need the link `SAGE_LOCAL/lib/python`, pointing to `python2.7`, and it can interfere with the Python 3 build, at least on OS X. (See #22756.)


Branch/Commit: **[`fb90d5e`](https://github.com/sagemath/sagetrac-mirror/commit/fb90d5e3667237f2d9fc7ba982b466bc52802b1d)**

Reviewer: **Volker Braun**

Author: **John Palmieri**

Component: **build**

_Issue created by migration from https://trac.sagemath.org/ticket/22764_





---

archive/issue_events_314949.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2017-04-05T21:51:04Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/22764",
    "milestone_number": null,
    "milestone_title": "sage-8.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22764#event-314949"
}
```



---

archive/issue_events_314950.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2017-04-05T21:51:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22764",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20build",
    "label_color": "0000b0",
    "label_name": "c: build",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22764#event-314950"
}
```



---

archive/issue_events_314951.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2017-04-05T21:51:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22764",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22764#event-314951"
}
```



---

archive/issue_events_314952.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2017-04-05T21:51:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22764",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22764#event-314952"
}
```



---

archive/issue_comments_338849.json:
```json
{
    "body": "Branch: **[u/jhpalmieri/no-local-lib-python](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/no-local-lib-python)**",
    "created_at": "2017-04-05T21:52:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22764#issuecomment-338849",
    "user": "https://github.com/jhpalmieri"
}
```

Branch: **[u/jhpalmieri/no-local-lib-python](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/no-local-lib-python)**



---

archive/issue_events_314953.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2017-04-05T21:54:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22764",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22764#event-314953"
}
```



---

archive/issue_comments_338850.json:
```json
{
    "body": "<div id=\"comment:2\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0e90d5294f2dd1f95f2e96bf34830d1256a3f211\"><code>0e90d52</code></a></td><td><code>Trac 22764: remove the link SAGE_LOCAL/lib/python -> python2.7</code></td></tr></table>\n",
    "created_at": "2017-04-05T21:54:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22764#issuecomment-338850",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:2"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0e90d5294f2dd1f95f2e96bf34830d1256a3f211"><code>0e90d52</code></a></td><td><code>Trac 22764: remove the link SAGE_LOCAL/lib/python -> python2.7</code></td></tr></table>




---

archive/issue_comments_338851.json:
```json
{
    "body": "Commit: **[`0e90d52`](https://github.com/sagemath/sagetrac-mirror/commit/0e90d5294f2dd1f95f2e96bf34830d1256a3f211)**",
    "created_at": "2017-04-05T21:54:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22764#issuecomment-338851",
    "user": "https://github.com/jhpalmieri"
}
```

Commit: **[`0e90d52`](https://github.com/sagemath/sagetrac-mirror/commit/0e90d5294f2dd1f95f2e96bf34830d1256a3f211)**



---

archive/issue_comments_338852.json:
```json
{
    "body": "Changed commit from **[`0e90d52`](https://github.com/sagemath/sagetrac-mirror/commit/0e90d5294f2dd1f95f2e96bf34830d1256a3f211)** to **[`f33e86f`](https://github.com/sagemath/sagetrac-mirror/commit/f33e86f76463c02dee30513fd5553ebbe5a228d5)**",
    "created_at": "2017-04-05T22:09:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22764#issuecomment-338852",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`0e90d52`](https://github.com/sagemath/sagetrac-mirror/commit/0e90d5294f2dd1f95f2e96bf34830d1256a3f211)** to **[`f33e86f`](https://github.com/sagemath/sagetrac-mirror/commit/f33e86f76463c02dee30513fd5553ebbe5a228d5)**



---

archive/issue_comments_338853.json:
```json
{
    "body": "<div id=\"comment:3\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f33e86f76463c02dee30513fd5553ebbe5a228d5\"><code>f33e86f</code></a></td><td><code>trac 22764: replace a few instances of</code></td></tr></table>\n",
    "created_at": "2017-04-05T22:09:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22764#issuecomment-338853",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:3"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f33e86f76463c02dee30513fd5553ebbe5a228d5"><code>f33e86f</code></a></td><td><code>trac 22764: replace a few instances of</code></td></tr></table>




---

archive/issue_comments_338854.json:
```json
{
    "body": "<div id=\"comment:4\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b02ecf34018f48b24012623c5388a34d589bb3d2\"><code>b02ecf3</code></a></td><td><code>trac 22764: in a few comments and print statements, fix a few</code></td></tr></table>\n",
    "created_at": "2017-04-05T22:34:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22764#issuecomment-338854",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:4"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b02ecf34018f48b24012623c5388a34d589bb3d2"><code>b02ecf3</code></a></td><td><code>trac 22764: in a few comments and print statements, fix a few</code></td></tr></table>




---

archive/issue_comments_338855.json:
```json
{
    "body": "Changed commit from **[`f33e86f`](https://github.com/sagemath/sagetrac-mirror/commit/f33e86f76463c02dee30513fd5553ebbe5a228d5)** to **[`b02ecf3`](https://github.com/sagemath/sagetrac-mirror/commit/b02ecf34018f48b24012623c5388a34d589bb3d2)**",
    "created_at": "2017-04-05T22:34:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22764#issuecomment-338855",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`f33e86f`](https://github.com/sagemath/sagetrac-mirror/commit/f33e86f76463c02dee30513fd5553ebbe5a228d5)** to **[`b02ecf3`](https://github.com/sagemath/sagetrac-mirror/commit/b02ecf34018f48b24012623c5388a34d589bb3d2)**



---

archive/issue_comments_338856.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nsee also #22638",
    "created_at": "2017-04-06T12:10:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22764#issuecomment-338856",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:5" align="right">comment:5</div>

see also #22638



---

archive/issue_events_314954.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-04-06T20:33:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22764",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22764#event-314954"
}
```



---

archive/issue_events_314955.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-04-06T20:33:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22764",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22764#event-314955"
}
```



---

archive/issue_comments_338857.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\ndoes not apply",
    "created_at": "2017-04-06T20:33:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22764#issuecomment-338857",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:6" align="right">comment:6</div>

does not apply



---

archive/issue_comments_338858.json:
```json
{
    "body": "<div id=\"comment:7\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/df6a763f1c6190cbcb33501fdf7b6f4e5ee46400\"><code>df6a763</code></a></td><td><code>trac 22764: rebase to Sage 8.0.beta1</code></td></tr></table>\n",
    "created_at": "2017-04-06T20:39:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22764#issuecomment-338858",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:7"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/df6a763f1c6190cbcb33501fdf7b6f4e5ee46400"><code>df6a763</code></a></td><td><code>trac 22764: rebase to Sage 8.0.beta1</code></td></tr></table>




---

archive/issue_comments_338859.json:
```json
{
    "body": "Changed commit from **[`b02ecf3`](https://github.com/sagemath/sagetrac-mirror/commit/b02ecf34018f48b24012623c5388a34d589bb3d2)** to **[`df6a763`](https://github.com/sagemath/sagetrac-mirror/commit/df6a763f1c6190cbcb33501fdf7b6f4e5ee46400)**",
    "created_at": "2017-04-06T20:39:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22764#issuecomment-338859",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`b02ecf3`](https://github.com/sagemath/sagetrac-mirror/commit/b02ecf34018f48b24012623c5388a34d589bb3d2)** to **[`df6a763`](https://github.com/sagemath/sagetrac-mirror/commit/df6a763f1c6190cbcb33501fdf7b6f4e5ee46400)**



---

archive/issue_comments_338860.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nThis should apply now. The old version changed `src/sage/all.py` to fix a doctest. The conflict replaced the old doctest with the one from Sage 8.0.beta1 that looks more robust to me. I haven't built with this change, though, so I can't promise no doctest failures.",
    "created_at": "2017-04-06T20:42:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22764#issuecomment-338860",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:8" align="right">comment:8</div>

This should apply now. The old version changed `src/sage/all.py` to fix a doctest. The conflict replaced the old doctest with the one from Sage 8.0.beta1 that looks more robust to me. I haven't built with this change, though, so I can't promise no doctest failures.



---

archive/issue_events_314956.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2017-04-06T20:42:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22764",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22764#event-314956"
}
```



---

archive/issue_events_314957.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2017-04-06T20:42:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22764",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22764#event-314957"
}
```



---

archive/issue_comments_338861.json:
```json
{
    "body": "<div id=\"comment:9\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7cd0d62ad1fe72747813b665682fea591aaf2a80\"><code>7cd0d62</code></a></td><td><code>trac 22764: merge with 8.0.beta1</code></td></tr></table>\n",
    "created_at": "2017-04-06T20:47:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22764#issuecomment-338861",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:9"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7cd0d62ad1fe72747813b665682fea591aaf2a80"><code>7cd0d62</code></a></td><td><code>trac 22764: merge with 8.0.beta1</code></td></tr></table>




---

archive/issue_comments_338862.json:
```json
{
    "body": "Changed commit from **[`df6a763`](https://github.com/sagemath/sagetrac-mirror/commit/df6a763f1c6190cbcb33501fdf7b6f4e5ee46400)** to **[`7cd0d62`](https://github.com/sagemath/sagetrac-mirror/commit/7cd0d62ad1fe72747813b665682fea591aaf2a80)**",
    "created_at": "2017-04-06T20:47:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22764#issuecomment-338862",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`df6a763`](https://github.com/sagemath/sagetrac-mirror/commit/df6a763f1c6190cbcb33501fdf7b6f4e5ee46400)** to **[`7cd0d62`](https://github.com/sagemath/sagetrac-mirror/commit/7cd0d62ad1fe72747813b665682fea591aaf2a80)**



---

archive/issue_comments_338863.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nEdit: moved the comment to #22756.",
    "created_at": "2017-04-06T23:38:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22764#issuecomment-338863",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:10" align="right">comment:10</div>

Edit: moved the comment to #22756.



---

archive/issue_comments_338864.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nI don't agree with the change to `src/bin/sage`. It needs to check whether Sage was built inside `$SAGE_LOCAL` and the new code doesn't do that (it could potentially import a different version of Sage installed on the system).",
    "created_at": "2017-04-07T08:31:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22764#issuecomment-338864",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:11" align="right">comment:11</div>

I don't agree with the change to `src/bin/sage`. It needs to check whether Sage was built inside `$SAGE_LOCAL` and the new code doesn't do that (it could potentially import a different version of Sage installed on the system).



---

archive/issue_events_314958.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-04-07T08:31:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22764",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22764#event-314958"
}
```



---

archive/issue_events_314959.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-04-07T08:31:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22764",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22764#event-314959"
}
```



---

archive/issue_comments_338865.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nI wasn't completely satisfied with that change, either. We could do something like this instead:\n\n```diff\ndiff --git a/src/bin/sage b/src/bin/sage\nindex cc6e41cbed..b26618a3b8 100755\n--- a/src/bin/sage\n+++ b/src/bin/sage\n@@ -383,7 +383,15 @@ fi\n # Prepare for running Sage, either interactively or non-interactively.\n sage_setup() {\n     # Check that we're not in a source tarball which hasn't been built yet (#13561).\n-    if ! python -c 'import sage.version' 2> /dev/null ; then\n+    if [ ! -x \"$SAGE_LOCAL/bin/python\" ]; then\n+        built=no\n+    else\n+        PYTHON_VERSION=$(\"$SAGE_LOCAL/bin/python\" -c 'import sys; print(\"%d.%d\" % sys.version_info[:2])')\n+        if [ ! -d \"$SAGE_LOCAL/lib/python$PYTHON_VERSION/site-packages/sage\" ]; then\n+            built=no\n+        fi\n+    fi\n+    if [ $built = no ]; then\n         echo >&2 '************************************************************************'\n         echo >&2 'It seems that you are attempting to run Sage from an unpacked source'\n         echo >&2 'tarball, but you have not compiled it yet (or maybe the build has not'\n```\nHow about that?",
    "created_at": "2017-04-07T14:31:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22764#issuecomment-338865",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:12" align="right">comment:12</div>

I wasn't completely satisfied with that change, either. We could do something like this instead:

```diff
diff --git a/src/bin/sage b/src/bin/sage
index cc6e41cbed..b26618a3b8 100755
--- a/src/bin/sage
+++ b/src/bin/sage
@@ -383,7 +383,15 @@ fi
 # Prepare for running Sage, either interactively or non-interactively.
 sage_setup() {
     # Check that we're not in a source tarball which hasn't been built yet (#13561).
-    if ! python -c 'import sage.version' 2> /dev/null ; then
+    if [ ! -x "$SAGE_LOCAL/bin/python" ]; then
+        built=no
+    else
+        PYTHON_VERSION=$("$SAGE_LOCAL/bin/python" -c 'import sys; print("%d.%d" % sys.version_info[:2])')
+        if [ ! -d "$SAGE_LOCAL/lib/python$PYTHON_VERSION/site-packages/sage" ]; then
+            built=no
+        fi
+    fi
+    if [ $built = no ]; then
         echo >&2 '************************************************************************'
         echo >&2 'It seems that you are attempting to run Sage from an unpacked source'
         echo >&2 'tarball, but you have not compiled it yet (or maybe the build has not'
```
How about that?



---

archive/issue_comments_338866.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nCan't we just check for the presence of SAGE_LOCAL/bin/sage instead of messing around with python minutae?",
    "created_at": "2017-04-08T17:41:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22764#issuecomment-338866",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:13" align="right">comment:13</div>

Can't we just check for the presence of SAGE_LOCAL/bin/sage instead of messing around with python minutae?



---

archive/issue_comments_338867.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nI think that `SAGE_LOCAL/bin/sage` can get installed well before the Sage library.",
    "created_at": "2017-04-08T18:09:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22764#issuecomment-338867",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:14" align="right">comment:14</div>

I think that `SAGE_LOCAL/bin/sage` can get installed well before the Sage library.



---

archive/issue_comments_338868.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nYes, but so what? Its only a sanity check that you don't try to run an unpacked source tarball.",
    "created_at": "2017-04-08T18:27:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22764#issuecomment-338868",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:15" align="right">comment:15</div>

Yes, but so what? Its only a sanity check that you don't try to run an unpacked source tarball.



---

archive/issue_comments_338869.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nEither way is fine with me: check for `local/lib/python$PYTHON_VERSION/site-packages/sage/` or for `local/bin/sage`.",
    "created_at": "2017-04-08T18:48:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22764#issuecomment-338869",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:16" align="right">comment:16</div>

Either way is fine with me: check for `local/lib/python$PYTHON_VERSION/site-packages/sage/` or for `local/bin/sage`.



---

archive/issue_comments_338870.json:
```json
{
    "body": "Changed commit from **[`7cd0d62`](https://github.com/sagemath/sagetrac-mirror/commit/7cd0d62ad1fe72747813b665682fea591aaf2a80)** to **[`ab49413`](https://github.com/sagemath/sagetrac-mirror/commit/ab49413b6ee1f7eebcc9044caf2c0abc45aad746)**",
    "created_at": "2017-04-09T16:33:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22764#issuecomment-338870",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`7cd0d62`](https://github.com/sagemath/sagetrac-mirror/commit/7cd0d62ad1fe72747813b665682fea591aaf2a80)** to **[`ab49413`](https://github.com/sagemath/sagetrac-mirror/commit/ab49413b6ee1f7eebcc9044caf2c0abc45aad746)**



---

archive/issue_comments_338871.json:
```json
{
    "body": "<div id=\"comment:17\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ab49413b6ee1f7eebcc9044caf2c0abc45aad746\"><code>ab49413</code></a></td><td><code>trac 22764: change how check whether Sage is built.</code></td></tr></table>\n",
    "created_at": "2017-04-09T16:33:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22764#issuecomment-338871",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:17"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ab49413b6ee1f7eebcc9044caf2c0abc45aad746"><code>ab49413</code></a></td><td><code>trac 22764: change how check whether Sage is built.</code></td></tr></table>




---

archive/issue_comments_338872.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nI decided that I like the more involved check. It is not complicated and it is more in line with the printed message, especially the part \"(or maybe the build has not finished)\".",
    "created_at": "2017-04-09T16:34:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22764#issuecomment-338872",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:18" align="right">comment:18</div>

I decided that I like the more involved check. It is not complicated and it is more in line with the printed message, especially the part "(or maybe the build has not finished)".



---

archive/issue_events_314960.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2017-04-09T16:34:40Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22764",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22764#event-314960"
}
```



---

archive/issue_events_314961.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2017-04-09T16:34:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22764",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22764#event-314961"
}
```



---

archive/issue_comments_338873.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nThats hardcoding the assumption that python is a symlink to python3 when built with SAGE_PYTHON3=yes and would conflict with #22582",
    "created_at": "2017-04-09T18:32:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22764#issuecomment-338873",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:19" align="right">comment:19</div>

Thats hardcoding the assumption that python is a symlink to python3 when built with SAGE_PYTHON3=yes and would conflict with #22582



---

archive/issue_comments_338874.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nReplying to [@vbraun](#comment:19):\n> Thats hardcoding the assumption that python is a symlink to python3 when built with SAGE_PYTHON3=yes\n\nYes, you're right.\n\n> and would conflict with #22582\n\nIt would conflict with your current branch at #22582, but there is another option: making a reliable symlink `python -> python3` when `SAGE_PYTHON3=yes`. As I said at #22582, I would like to hear some other opinions about those two options. (As I also said at #22582, maybe `SAGE_PYTHON3` should control some run-time aspects of Sage, not just build-time. If such were available and did not just include the symlink, we could use those for this check.)",
    "created_at": "2017-04-09T20:10:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22764#issuecomment-338874",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:20" align="right">comment:20</div>

Replying to [@vbraun](#comment:19):
> Thats hardcoding the assumption that python is a symlink to python3 when built with SAGE_PYTHON3=yes

Yes, you're right.

> and would conflict with #22582

It would conflict with your current branch at #22582, but there is another option: making a reliable symlink `python -> python3` when `SAGE_PYTHON3=yes`. As I said at #22582, I would like to hear some other opinions about those two options. (As I also said at #22582, maybe `SAGE_PYTHON3` should control some run-time aspects of Sage, not just build-time. If such were available and did not just include the symlink, we could use those for this check.)



---

archive/issue_comments_338875.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nReplying to [@vbraun](#comment:19):\n> Thats hardcoding the assumption that python is a symlink to python3 when built with SAGE_PYTHON3=yes and would conflict with #22582\n\nAnother way of looking at this: if we're not really thinking about how to run Sage using python3, that it's premature to do so, then: if you build with `SAGE_PYTHON3=yes`, the build will not complete because Sage isn't ready for Python 3 yet, so no matter what the symlink points to, you will get this message. If you build without `SAGE_PYTHON3=yes`, then the symlink should point to `python2` and this check will behave as it always has.\n\nIf we just check whether `local/bin/sage` exists, then you will get a less clear error message if Sage hasn't finished building yet, for whatever reason.\n\nOnce we figure out whether `SAGE_PYTHON3` has run-time effects or not, we can modify this check.",
    "created_at": "2017-04-12T17:17:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22764#issuecomment-338875",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:21" align="right">comment:21</div>

Replying to [@vbraun](#comment:19):
> Thats hardcoding the assumption that python is a symlink to python3 when built with SAGE_PYTHON3=yes and would conflict with #22582

Another way of looking at this: if we're not really thinking about how to run Sage using python3, that it's premature to do so, then: if you build with `SAGE_PYTHON3=yes`, the build will not complete because Sage isn't ready for Python 3 yet, so no matter what the symlink points to, you will get this message. If you build without `SAGE_PYTHON3=yes`, then the symlink should point to `python2` and this check will behave as it always has.

If we just check whether `local/bin/sage` exists, then you will get a less clear error message if Sage hasn't finished building yet, for whatever reason.

Once we figure out whether `SAGE_PYTHON3` has run-time effects or not, we can modify this check.



---

archive/issue_comments_338876.json:
```json
{
    "body": "<div id=\"comment:22\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4715169cfe365879fa69f1046516731a7f50aa82\"><code>4715169</code></a></td><td><code>merging with 8.0.beta2</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fb90d5e3667237f2d9fc7ba982b466bc52802b1d\"><code>fb90d5e</code></a></td><td><code>trac 22764: check whether Sage is built by looking for local/bin/sage</code></td></tr></table>\n",
    "created_at": "2017-04-12T21:25:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22764#issuecomment-338876",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:22"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4715169cfe365879fa69f1046516731a7f50aa82"><code>4715169</code></a></td><td><code>merging with 8.0.beta2</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fb90d5e3667237f2d9fc7ba982b466bc52802b1d"><code>fb90d5e</code></a></td><td><code>trac 22764: check whether Sage is built by looking for local/bin/sage</code></td></tr></table>




---

archive/issue_comments_338877.json:
```json
{
    "body": "Changed commit from **[`ab49413`](https://github.com/sagemath/sagetrac-mirror/commit/ab49413b6ee1f7eebcc9044caf2c0abc45aad746)** to **[`fb90d5e`](https://github.com/sagemath/sagetrac-mirror/commit/fb90d5e3667237f2d9fc7ba982b466bc52802b1d)**",
    "created_at": "2017-04-12T21:25:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22764#issuecomment-338877",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`ab49413`](https://github.com/sagemath/sagetrac-mirror/commit/ab49413b6ee1f7eebcc9044caf2c0abc45aad746)** to **[`fb90d5e`](https://github.com/sagemath/sagetrac-mirror/commit/fb90d5e3667237f2d9fc7ba982b466bc52802b1d)**



---

archive/issue_comments_338878.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nBut I don't really care that much.",
    "created_at": "2017-04-12T21:25:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22764#issuecomment-338878",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:23" align="right">comment:23</div>

But I don't really care that much.



---

archive/issue_comments_338879.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nShould we bump the version numbers for python2 and python3, to make sure their spkg-install files get run, so the link actually gets removed when people upgrade?",
    "created_at": "2017-04-14T20:27:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22764#issuecomment-338879",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:24" align="right">comment:24</div>

Should we bump the version numbers for python2 and python3, to make sure their spkg-install files get run, so the link actually gets removed when people upgrade?



---

archive/issue_comments_338880.json:
```json
{
    "body": "Reviewer: **Volker Braun**",
    "created_at": "2017-04-16T22:49:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22764#issuecomment-338880",
    "user": "https://github.com/vbraun"
}
```

Reviewer: **Volker Braun**



---

archive/issue_events_314962.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-04-16T22:49:36Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22764",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22764#event-314962"
}
```



---

archive/issue_events_314963.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-04-16T22:49:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22764",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22764#event-314963"
}
```



---

archive/issue_comments_338881.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nIts not actually harmful, so I'm fine with leaving the old link hang around...",
    "created_at": "2017-04-16T22:49:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22764#issuecomment-338881",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:25" align="right">comment:25</div>

Its not actually harmful, so I'm fine with leaving the old link hang around...



---

archive/issue_comments_338882.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nThe link can break the python3 build on OS X, but #22756 bumps the version number on python3 to try to address this. It still may break the first time, but in such a way that the build will get far enough to delete the link. After that it should work the next time.",
    "created_at": "2017-04-17T04:03:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22764#issuecomment-338882",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:26" align="right">comment:26</div>

The link can break the python3 build on OS X, but #22756 bumps the version number on python3 to try to address this. It still may break the first time, but in such a way that the build will get far enough to delete the link. After that it should work the next time.



---

archive/issue_comments_338883.json:
```json
{
    "body": "Changed branch from **[u/jhpalmieri/no-local-lib-python](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/no-local-lib-python)** to **[`fb90d5e`](https://github.com/sagemath/sagetrac-mirror/commit/fb90d5e3667237f2d9fc7ba982b466bc52802b1d)**",
    "created_at": "2017-04-18T22:36:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22764#issuecomment-338883",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/jhpalmieri/no-local-lib-python](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/no-local-lib-python)** to **[`fb90d5e`](https://github.com/sagemath/sagetrac-mirror/commit/fb90d5e3667237f2d9fc7ba982b466bc52802b1d)**



---

archive/issue_events_314964.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-04-18T22:36:43Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22764",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22764#event-314964"
}
```



---

archive/issue_events_314965.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "e881dd76985c72d9717d26416afa1d0a1b8b7993",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2017-04-18T22:36:43Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/22764",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22764#event-314965"
}
```
