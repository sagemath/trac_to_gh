# Issue 22509: Install packages in temporary root before copying to $SAGE_LOCAL

archive/issues_022272.json:
```json
{
    "assignees": [],
    "body": "Currently we build packages, in most cases, by setting `--prefix=$SAGE_LOCAL` (in `./configure`, or the equivalent in non-autoconf packages), and then installing directly to that prefix.\n\nThis is fine to keep as is.  But with automake packages we can also set `DESTDIR` (https://www.gnu.org/software/automake/manual/html_node/DESTDIR.html#DESTDIR) to an alternative (typically temporary) directory into which to install.  This has a couple advantages:\n\n* Although it's not as usual for `make install` to fail after a successful `make`, it *can* happen. This prevents messy partial installs in the case of a failed `make install` run.\n\n* It gives us the opportunity to make an exact list of the files that were installed.  This is a prerequisite to improving package uninstallation/reinstallation in sage-dist (see #22510).\n\nThis is also standard operating procedure in most other packaging systems, so it would be good for Sage to adopt too.  The general approach is the same as that used for converting an arbitrary Makefile to support this convention--everywhere a file is installed, prefix the installation path with `$(DESTDIR)` (or in this case a variable we'll call `$SAGE_DESTDIR`).\n\nFor packages that already support the `DESTDIR` convention, then, we pass `DESTDIR=$SAGE_DESTDIR` to `make install`.  It is also already possible for Python packages (e.g. `pip install --root`).\n\nSince the introduction of the build helper scripts in #23160, it makes the most sense to make these changes directly in the helper scripts, and then update more packages to use those helper scripts where possible.\n\nDependent tickets:\n\n* #24106 - implement the basic functionality of supporting staged installs through `sage-spkg`\n* #24024 - update more `spkg-build/install` scripts to use the `sdh_` helper functions, since that is the fastest way to add `DESTDIR` support for many packages.\n* #24646 - add support for `--root=${SAGE_DESTDIR}` to Python spkgs\n* #24645 - add support for post-install scripts; this can be useful for cases where, for example, local files are generated after the package is installed, or to handle cases where one file is shared by multiple packages and needs to be updated when a package that uses it is installed (see e.g. [#22510 comment:5](https://github.com/sagemath/sage/issues/22510#comment:5))\n* #????? - convert all spkgs to support staged-install; for many packages this can be covered by using the helper functions, but some packages require additional steps; in particular, packages that have files that are manually copied into `$SAGE_LOCAL`, rather than through a standard installer\n\nDepends on #23059\nDepends on #23096\nDepends on #23160\nDepends on #23781\n\nCC:  @mkoeppe\n\nBranch/Commit: **[u/embray/build/destdir](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/build/destdir) @ [`c1d5453`](https://github.com/sagemath/sagetrac-mirror/commit/c1d5453c2735cdda78d53dc36b56fb54ec7dd336)**\n\nAuthor: **Erik Bray**\n\nComponent: **build**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/22509_\n\n",
    "created_at": "2017-03-03T13:23:24Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20build",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement",
        "https://github.com/sagemath/sage/labels/needs%20review"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Install packages in temporary root before copying to $SAGE_LOCAL",
    "type": "issue",
    "updated_at": "2020-02-09T22:34:08Z",
    "url": "https://github.com/sagemath/sage/issues/22509",
    "user": "https://github.com/embray"
}
```
Currently we build packages, in most cases, by setting `--prefix=$SAGE_LOCAL` (in `./configure`, or the equivalent in non-autoconf packages), and then installing directly to that prefix.

This is fine to keep as is.  But with automake packages we can also set `DESTDIR` (https://www.gnu.org/software/automake/manual/html_node/DESTDIR.html#DESTDIR) to an alternative (typically temporary) directory into which to install.  This has a couple advantages:

* Although it's not as usual for `make install` to fail after a successful `make`, it *can* happen. This prevents messy partial installs in the case of a failed `make install` run.

* It gives us the opportunity to make an exact list of the files that were installed.  This is a prerequisite to improving package uninstallation/reinstallation in sage-dist (see #22510).

This is also standard operating procedure in most other packaging systems, so it would be good for Sage to adopt too.  The general approach is the same as that used for converting an arbitrary Makefile to support this convention--everywhere a file is installed, prefix the installation path with `$(DESTDIR)` (or in this case a variable we'll call `$SAGE_DESTDIR`).

For packages that already support the `DESTDIR` convention, then, we pass `DESTDIR=$SAGE_DESTDIR` to `make install`.  It is also already possible for Python packages (e.g. `pip install --root`).

Since the introduction of the build helper scripts in #23160, it makes the most sense to make these changes directly in the helper scripts, and then update more packages to use those helper scripts where possible.

Dependent tickets:

* #24106 - implement the basic functionality of supporting staged installs through `sage-spkg`
* #24024 - update more `spkg-build/install` scripts to use the `sdh_` helper functions, since that is the fastest way to add `DESTDIR` support for many packages.
* #24646 - add support for `--root=${SAGE_DESTDIR}` to Python spkgs
* #24645 - add support for post-install scripts; this can be useful for cases where, for example, local files are generated after the package is installed, or to handle cases where one file is shared by multiple packages and needs to be updated when a package that uses it is installed (see e.g. [#22510 comment:5](https://github.com/sagemath/sage/issues/22510#comment:5))
* #????? - convert all spkgs to support staged-install; for many packages this can be covered by using the helper functions, but some packages require additional steps; in particular, packages that have files that are manually copied into `$SAGE_LOCAL`, rather than through a standard installer

Depends on #23059
Depends on #23096
Depends on #23160
Depends on #23781

CC:  @mkoeppe

Branch/Commit: **[u/embray/build/destdir](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/build/destdir) @ [`c1d5453`](https://github.com/sagemath/sagetrac-mirror/commit/c1d5453c2735cdda78d53dc36b56fb54ec7dd336)**

Author: **Erik Bray**

Component: **build**

_Issue created by migration from https://trac.sagemath.org/ticket/22509_





---

archive/issue_events_311781.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-03-03T13:23:24Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "milestone_number": null,
    "milestone_title": "sage-7.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22509#event-311781"
}
```



---

archive/issue_events_311782.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-03-03T13:23:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20build",
    "label_color": "0000b0",
    "label_name": "c: build",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22509#event-311782"
}
```



---

archive/issue_events_311783.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-03-03T13:23:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22509#event-311783"
}
```



---

archive/issue_events_311784.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-03-03T13:23:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22509#event-311784"
}
```



---

archive/issue_comments_333332.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-Currently we build packages, in most cases, but setting `--prefix=$SAGE_LOCAL` (in `./configure`, or the equivalent in non-autoconf packages), and then install directly to that prefix.\n+Currently we build packages, in most cases, by setting `--prefix=$SAGE_LOCAL` (in `./configure`, or the equivalent in non-autoconf packages), and then installing directly to that prefix.\n \n This is fine to keep as is.  But with automake packages we can also set `DESTDIR` (https://www.gnu.org/software/automake/manual/html_node/DESTDIR.html#DESTDIR) to an alternative (typically temporary) directory into which to install.  This has a couple advantages:\n \n``````\n",
    "created_at": "2017-04-18T11:42:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333332",
    "user": "https://github.com/embray"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-Currently we build packages, in most cases, but setting `--prefix=$SAGE_LOCAL` (in `./configure`, or the equivalent in non-autoconf packages), and then install directly to that prefix.
+Currently we build packages, in most cases, by setting `--prefix=$SAGE_LOCAL` (in `./configure`, or the equivalent in non-autoconf packages), and then installing directly to that prefix.
 
 This is fine to keep as is.  But with automake packages we can also set `DESTDIR` (https://www.gnu.org/software/automake/manual/html_node/DESTDIR.html#DESTDIR) to an alternative (typically temporary) directory into which to install.  This has a couple advantages:
 
``````




---

archive/issue_events_311785.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-04-18T11:42:12Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "milestone_number": null,
    "milestone_title": "sage-7.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22509#event-311785"
}
```



---

archive/issue_events_311786.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-04-18T11:42:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "label": "https://github.com/sagemath/sage/labels/wishlist%20item",
    "label_color": "e81ff9",
    "label_name": "wishlist item",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22509#event-311786"
}
```



---

archive/issue_comments_333333.json:
```json
{
    "body": "Author: **Erik Bray**",
    "created_at": "2017-05-31T12:13:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333333",
    "user": "https://github.com/embray"
}
```

Author: **Erik Bray**



---

archive/issue_comments_333334.json:
```json
{
    "body": "Dependencies: **#23096**",
    "created_at": "2017-05-31T12:13:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333334",
    "user": "https://github.com/embray"
}
```

Dependencies: **#23096**



---

archive/issue_comments_333335.json:
```json
{
    "body": "Commit: **[`a25a42a`](https://github.com/sagemath/sagetrac-mirror/commit/a25a42a02a89a20058d41d95c56efc1cd0875f26)**",
    "created_at": "2017-05-31T12:13:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333335",
    "user": "https://github.com/embray"
}
```

Commit: **[`a25a42a`](https://github.com/sagemath/sagetrac-mirror/commit/a25a42a02a89a20058d41d95c56efc1cd0875f26)**



---

archive/issue_comments_333336.json:
```json
{
    "body": "Branch: **[u/embray/build/destdir](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/build/destdir)**",
    "created_at": "2017-05-31T12:13:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333336",
    "user": "https://github.com/embray"
}
```

Branch: **[u/embray/build/destdir](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/build/destdir)**



---

archive/issue_comments_333337.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nStarted work on this, and converted I think all standard packages to work with a staged installation (install first to a temporary directory, then copy from the temp directory into `$SAGE_LOCAL`).\n\nAs I wrote in the description, most packages are easy--either they use automake, or at least a Makefile that's compatible with the `DESTDIR` convention, or they are Python packages in which case the `--root` option does the same thing.  A handful of packages needed hand-tweaking.\n\nThis is currently implemented in such a way that if a package *doesn't* yet support staged install, it will still install just fine. The only major downside is that the installed files are not recorded yet, so they wouldn't be able to take advantage of improved uninstall.\n\nThat said, I'm going to continue converting the remaining packages. My only question is whether to continue work in this ticket, or separate the general changes (i.e. to `sage-spkg`) from the updates to the packages themselves.\n\n---\nLast 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3fa088a137af80e1e5a6caf0e7ecdde76ac48cd3\"><code>3fa088a</code></a></td><td><code>Update pip install to use --root</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/30aad2f0fc94fb4e3a09dfa5e14c28ab95e165c8\"><code>30aad2f</code></a></td><td><code>Update freetype and pkgconf to use DESTDIR</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b1aabaa32decdde4e8573d06b034e1df1dabfaca\"><code>b1aabaa</code></a></td><td><code>Updated various packages with non-standard installers or that are otherwise</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/223608f53595217d2a66b5ddf06a65020a961670\"><code>223608f</code></a></td><td><code>Update cephes to work with staged install.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/27878c313369cb6b3116eb7b7f0df0be09982ea7\"><code>27878c3</code></a></td><td><code>Update openblas to use staged install</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ecd214c42ca6863a249318ae6de6cce1340a9e9d\"><code>ecd214c</code></a></td><td><code>Update lcalc to support staged install</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3d64db8dbc2f89d40a65f949d15e87e47a4647fc\"><code>3d64db8</code></a></td><td><code>Update zn_poly, which doesn't really have a proper installer, to use staged install</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/609393ad73188016b15137552dc6e481886686ff\"><code>609393a</code></a></td><td><code>Roll back accidental change from dc46ea2dfa97be79d7ef8ddbe9130d4c717acc3d that broke build of Python 2 on Cygwin.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/03424e19de9385c6a30cae01fedfac065cf3a53c\"><code>03424e1</code></a></td><td><code>Merge remote-tracking branch 'upstream/u/embray/cygwin/ticket-23059' into u/embray/build/destdir</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a25a42a02a89a20058d41d95c56efc1cd0875f26\"><code>a25a42a</code></a></td><td><code>Updated the python2/3 pacakges to use staged install.</code></td></tr></table>\n",
    "created_at": "2017-05-31T12:13:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333337",
    "user": "https://github.com/embray"
}
```

<div id="comment:3" align="right">comment:3</div>

Started work on this, and converted I think all standard packages to work with a staged installation (install first to a temporary directory, then copy from the temp directory into `$SAGE_LOCAL`).

As I wrote in the description, most packages are easy--either they use automake, or at least a Makefile that's compatible with the `DESTDIR` convention, or they are Python packages in which case the `--root` option does the same thing.  A handful of packages needed hand-tweaking.

This is currently implemented in such a way that if a package *doesn't* yet support staged install, it will still install just fine. The only major downside is that the installed files are not recorded yet, so they wouldn't be able to take advantage of improved uninstall.

That said, I'm going to continue converting the remaining packages. My only question is whether to continue work in this ticket, or separate the general changes (i.e. to `sage-spkg`) from the updates to the packages themselves.

---
Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3fa088a137af80e1e5a6caf0e7ecdde76ac48cd3"><code>3fa088a</code></a></td><td><code>Update pip install to use --root</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/30aad2f0fc94fb4e3a09dfa5e14c28ab95e165c8"><code>30aad2f</code></a></td><td><code>Update freetype and pkgconf to use DESTDIR</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b1aabaa32decdde4e8573d06b034e1df1dabfaca"><code>b1aabaa</code></a></td><td><code>Updated various packages with non-standard installers or that are otherwise</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/223608f53595217d2a66b5ddf06a65020a961670"><code>223608f</code></a></td><td><code>Update cephes to work with staged install.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/27878c313369cb6b3116eb7b7f0df0be09982ea7"><code>27878c3</code></a></td><td><code>Update openblas to use staged install</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ecd214c42ca6863a249318ae6de6cce1340a9e9d"><code>ecd214c</code></a></td><td><code>Update lcalc to support staged install</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3d64db8dbc2f89d40a65f949d15e87e47a4647fc"><code>3d64db8</code></a></td><td><code>Update zn_poly, which doesn't really have a proper installer, to use staged install</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/609393ad73188016b15137552dc6e481886686ff"><code>609393a</code></a></td><td><code>Roll back accidental change from dc46ea2dfa97be79d7ef8ddbe9130d4c717acc3d that broke build of Python 2 on Cygwin.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/03424e19de9385c6a30cae01fedfac065cf3a53c"><code>03424e1</code></a></td><td><code>Merge remote-tracking branch 'upstream/u/embray/cygwin/ticket-23059' into u/embray/build/destdir</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a25a42a02a89a20058d41d95c56efc1cd0875f26"><code>a25a42a</code></a></td><td><code>Updated the python2/3 pacakges to use staged install.</code></td></tr></table>




---

archive/issue_events_311787.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-05-31T12:13:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22509#event-311787"
}
```



---

archive/issue_comments_333338.json:
```json
{
    "body": "Changed dependencies from **#23096** to **#23059 #23096**",
    "created_at": "2017-05-31T12:14:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333338",
    "user": "https://github.com/embray"
}
```

Changed dependencies from **#23096** to **#23059 #23096**



---

archive/issue_comments_333339.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nBy way of explanation, the idea here is that there is a variable exported by `sage-spkg` called `$SAGE_INST_TEMP` (the name is open to bikeshedding), so this is expected to be passed to each `spkg-install` to use an alternative install root.  In principle this could be defined in each `spkg-install` individually, but it's less trouble to standardize in one place, and in any case `sage-spkg` still needs to know this path to copy files from it to `$SAGE_LOCAL`.\n\nOf course, if we take this approach, the developer docs will also need to be updated with some guidance on how to implement staged installation for new packages.",
    "created_at": "2017-05-31T12:19:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333339",
    "user": "https://github.com/embray"
}
```

<div id="comment:5" align="right">comment:5</div>

By way of explanation, the idea here is that there is a variable exported by `sage-spkg` called `$SAGE_INST_TEMP` (the name is open to bikeshedding), so this is expected to be passed to each `spkg-install` to use an alternative install root.  In principle this could be defined in each `spkg-install` individually, but it's less trouble to standardize in one place, and in any case `sage-spkg` still needs to know this path to copy files from it to `$SAGE_LOCAL`.

Of course, if we take this approach, the developer docs will also need to be updated with some guidance on how to implement staged installation for new packages.



---

archive/issue_comments_333340.json:
```json
{
    "body": "Changed commit from **[`a25a42a`](https://github.com/sagemath/sagetrac-mirror/commit/a25a42a02a89a20058d41d95c56efc1cd0875f26)** to **[`8a621af`](https://github.com/sagemath/sagetrac-mirror/commit/8a621af7a5f3e10d1337c07b42d04edee6a8f1b8)**",
    "created_at": "2017-05-31T12:25:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333340",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`a25a42a`](https://github.com/sagemath/sagetrac-mirror/commit/a25a42a02a89a20058d41d95c56efc1cd0875f26)** to **[`8a621af`](https://github.com/sagemath/sagetrac-mirror/commit/8a621af7a5f3e10d1337c07b42d04edee6a8f1b8)**



---

archive/issue_comments_333341.json:
```json
{
    "body": "<div id=\"comment:6\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3a32187468218cd79e6a5c0defb1f365a488c147\"><code>3a32187</code></a></td><td><code>Roll back accidental change from dc46ea2dfa97be79d7ef8ddbe9130d4c717acc3d that broke build of Python 2 on Cygwin.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8a621af7a5f3e10d1337c07b42d04edee6a8f1b8\"><code>8a621af</code></a></td><td><code>Updated the python2/3 pacakges to use staged install.</code></td></tr></table>\n",
    "created_at": "2017-05-31T12:25:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333341",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:6"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3a32187468218cd79e6a5c0defb1f365a488c147"><code>3a32187</code></a></td><td><code>Roll back accidental change from dc46ea2dfa97be79d7ef8ddbe9130d4c717acc3d that broke build of Python 2 on Cygwin.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8a621af7a5f3e10d1337c07b42d04edee6a8f1b8"><code>8a621af</code></a></td><td><code>Updated the python2/3 pacakges to use staged install.</code></td></tr></table>




---

archive/issue_comments_333342.json:
```json
{
    "body": "<div id=\"comment:7\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1391089b36f43b45fa0eb7bf04e83fc1e351dfea\"><code>1391089</code></a></td><td><code>Remove the '-v' from the 'cp' command.</code></td></tr></table>\n",
    "created_at": "2017-05-31T13:13:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333342",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:7"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1391089b36f43b45fa0eb7bf04e83fc1e351dfea"><code>1391089</code></a></td><td><code>Remove the '-v' from the 'cp' command.</code></td></tr></table>




---

archive/issue_comments_333343.json:
```json
{
    "body": "Changed commit from **[`8a621af`](https://github.com/sagemath/sagetrac-mirror/commit/8a621af7a5f3e10d1337c07b42d04edee6a8f1b8)** to **[`1391089`](https://github.com/sagemath/sagetrac-mirror/commit/1391089b36f43b45fa0eb7bf04e83fc1e351dfea)**",
    "created_at": "2017-05-31T13:13:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333343",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`8a621af`](https://github.com/sagemath/sagetrac-mirror/commit/8a621af7a5f3e10d1337c07b42d04edee6a8f1b8)** to **[`1391089`](https://github.com/sagemath/sagetrac-mirror/commit/1391089b36f43b45fa0eb7bf04e83fc1e351dfea)**



---

archive/issue_comments_333344.json:
```json
{
    "body": "<div id=\"comment:8\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e2941230aea00481d6cf1f58992faa006a7b63f2\"><code>e294123</code></a></td><td><code>Add staged install support for atlas</code></td></tr></table>\n",
    "created_at": "2017-05-31T13:34:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333344",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:8"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e2941230aea00481d6cf1f58992faa006a7b63f2"><code>e294123</code></a></td><td><code>Add staged install support for atlas</code></td></tr></table>




---

archive/issue_comments_333345.json:
```json
{
    "body": "Changed commit from **[`1391089`](https://github.com/sagemath/sagetrac-mirror/commit/1391089b36f43b45fa0eb7bf04e83fc1e351dfea)** to **[`e294123`](https://github.com/sagemath/sagetrac-mirror/commit/e2941230aea00481d6cf1f58992faa006a7b63f2)**",
    "created_at": "2017-05-31T13:34:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333345",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`1391089`](https://github.com/sagemath/sagetrac-mirror/commit/1391089b36f43b45fa0eb7bf04e83fc1e351dfea)** to **[`e294123`](https://github.com/sagemath/sagetrac-mirror/commit/e2941230aea00481d6cf1f58992faa006a7b63f2)**



---

archive/issue_comments_333346.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -4,6 +4,6 @@\n \n * Although it's not as usual for `make install` to fail after a successful `make`, it *can* happen. This prevents messy partial installs in the case of a failed `make install` run.\n \n-* It gives us the opportunity to make an exact list of the files that were installed.  This is a prerequisite to improving package uninstallation/reinstallation in sage-dist.\n+* It gives us the opportunity to make an exact list of the files that were installed.  This is a prerequisite to improving package uninstallation/reinstallation in sage-dist (see #22520).\n \n This is also standard operating procedure in most other packaging systems, so it would be good for Sage to adopt too.  It is also already possible for Python packages (e.g. `pip install --root`), and shouldn't be too hard to patch into whatever packages don't support it out of the box for whatever reason.\n``````\n",
    "created_at": "2017-05-31T13:58:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333346",
    "user": "https://github.com/embray"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -4,6 +4,6 @@
 
 * Although it's not as usual for `make install` to fail after a successful `make`, it *can* happen. This prevents messy partial installs in the case of a failed `make install` run.
 
-* It gives us the opportunity to make an exact list of the files that were installed.  This is a prerequisite to improving package uninstallation/reinstallation in sage-dist.
+* It gives us the opportunity to make an exact list of the files that were installed.  This is a prerequisite to improving package uninstallation/reinstallation in sage-dist (see #22520).
 
 This is also standard operating procedure in most other packaging systems, so it would be good for Sage to adopt too.  It is also already possible for Python packages (e.g. `pip install --root`), and shouldn't be too hard to patch into whatever packages don't support it out of the box for whatever reason.
``````




---

archive/issue_comments_333347.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -4,6 +4,6 @@\n \n * Although it's not as usual for `make install` to fail after a successful `make`, it *can* happen. This prevents messy partial installs in the case of a failed `make install` run.\n \n-* It gives us the opportunity to make an exact list of the files that were installed.  This is a prerequisite to improving package uninstallation/reinstallation in sage-dist (see #22520).\n+* It gives us the opportunity to make an exact list of the files that were installed.  This is a prerequisite to improving package uninstallation/reinstallation in sage-dist (see #22510).\n \n This is also standard operating procedure in most other packaging systems, so it would be good for Sage to adopt too.  It is also already possible for Python packages (e.g. `pip install --root`), and shouldn't be too hard to patch into whatever packages don't support it out of the box for whatever reason.\n``````\n",
    "created_at": "2017-05-31T13:59:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333347",
    "user": "https://github.com/embray"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -4,6 +4,6 @@
 
 * Although it's not as usual for `make install` to fail after a successful `make`, it *can* happen. This prevents messy partial installs in the case of a failed `make install` run.
 
-* It gives us the opportunity to make an exact list of the files that were installed.  This is a prerequisite to improving package uninstallation/reinstallation in sage-dist (see #22520).
+* It gives us the opportunity to make an exact list of the files that were installed.  This is a prerequisite to improving package uninstallation/reinstallation in sage-dist (see #22510).
 
 This is also standard operating procedure in most other packaging systems, so it would be good for Sage to adopt too.  It is also already possible for Python packages (e.g. `pip install --root`), and shouldn't be too hard to patch into whatever packages don't support it out of the box for whatever reason.
``````




---

archive/issue_comments_333348.json:
```json
{
    "body": "<div id=\"comment:11\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/00f6de8d173a25b865c26c6af3f588b49e8401eb\"><code>00f6de8</code></a></td><td><code>This file should be deleted from the temp install dir during staged install on OSX</code></td></tr></table>\n",
    "created_at": "2017-06-01T08:15:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333348",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:11"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/00f6de8d173a25b865c26c6af3f588b49e8401eb"><code>00f6de8</code></a></td><td><code>This file should be deleted from the temp install dir during staged install on OSX</code></td></tr></table>




---

archive/issue_comments_333349.json:
```json
{
    "body": "Changed commit from **[`e294123`](https://github.com/sagemath/sagetrac-mirror/commit/e2941230aea00481d6cf1f58992faa006a7b63f2)** to **[`00f6de8`](https://github.com/sagemath/sagetrac-mirror/commit/00f6de8d173a25b865c26c6af3f588b49e8401eb)**",
    "created_at": "2017-06-01T08:15:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333349",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`e294123`](https://github.com/sagemath/sagetrac-mirror/commit/e2941230aea00481d6cf1f58992faa006a7b63f2)** to **[`00f6de8`](https://github.com/sagemath/sagetrac-mirror/commit/00f6de8d173a25b865c26c6af3f588b49e8401eb)**



---

archive/issue_comments_333350.json:
```json
{
    "body": "<div id=\"comment:12\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/16bc700b5cb5cb54697702154f37f1121238fb15\"><code>16bc700</code></a></td><td><code>Update freetype and pkgconf to use DESTDIR</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/eb660c7c262195f4d8910f3e8e6a1953b24e3c91\"><code>eb660c7</code></a></td><td><code>Updated various packages with non-standard installers or that are otherwise</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8de16d2f311650cb4308b11935735350f586d54c\"><code>8de16d2</code></a></td><td><code>Update cephes to work with staged install.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/73c45e6c71706a012ec3e2209da63ca6efb4176f\"><code>73c45e6</code></a></td><td><code>Update openblas to use staged install</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e1ad6d5ff7b7b5e11a8de9316c2dbb4971036d65\"><code>e1ad6d5</code></a></td><td><code>Update lcalc to support staged install</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f07e0568957fd46d4ada5f9b6b18fc04de1767b1\"><code>f07e056</code></a></td><td><code>Update zn_poly, which doesn't really have a proper installer, to use staged install</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9997a37138448b82eef16b34645c902ed93e03c9\"><code>9997a37</code></a></td><td><code>Updated the python2/3 pacakges to use staged install.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f9cfa6f2e806c6d809f3429429e8f05273616297\"><code>f9cfa6f</code></a></td><td><code>Remove the '-v' from the 'cp' command.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e51f578ed9c1a31e24461ec935e043204aa0d65d\"><code>e51f578</code></a></td><td><code>Add staged install support for atlas</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/48e9ffbf5fe86d3186a505ae1e9ab1b13c8195f2\"><code>48e9ffb</code></a></td><td><code>This file should be deleted from the temp install dir during staged install on OSX</code></td></tr></table>\n",
    "created_at": "2017-06-02T07:36:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333350",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:12"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/16bc700b5cb5cb54697702154f37f1121238fb15"><code>16bc700</code></a></td><td><code>Update freetype and pkgconf to use DESTDIR</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/eb660c7c262195f4d8910f3e8e6a1953b24e3c91"><code>eb660c7</code></a></td><td><code>Updated various packages with non-standard installers or that are otherwise</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8de16d2f311650cb4308b11935735350f586d54c"><code>8de16d2</code></a></td><td><code>Update cephes to work with staged install.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/73c45e6c71706a012ec3e2209da63ca6efb4176f"><code>73c45e6</code></a></td><td><code>Update openblas to use staged install</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e1ad6d5ff7b7b5e11a8de9316c2dbb4971036d65"><code>e1ad6d5</code></a></td><td><code>Update lcalc to support staged install</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f07e0568957fd46d4ada5f9b6b18fc04de1767b1"><code>f07e056</code></a></td><td><code>Update zn_poly, which doesn't really have a proper installer, to use staged install</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9997a37138448b82eef16b34645c902ed93e03c9"><code>9997a37</code></a></td><td><code>Updated the python2/3 pacakges to use staged install.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f9cfa6f2e806c6d809f3429429e8f05273616297"><code>f9cfa6f</code></a></td><td><code>Remove the '-v' from the 'cp' command.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e51f578ed9c1a31e24461ec935e043204aa0d65d"><code>e51f578</code></a></td><td><code>Add staged install support for atlas</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/48e9ffbf5fe86d3186a505ae1e9ab1b13c8195f2"><code>48e9ffb</code></a></td><td><code>This file should be deleted from the temp install dir during staged install on OSX</code></td></tr></table>




---

archive/issue_comments_333351.json:
```json
{
    "body": "Changed commit from **[`00f6de8`](https://github.com/sagemath/sagetrac-mirror/commit/00f6de8d173a25b865c26c6af3f588b49e8401eb)** to **[`48e9ffb`](https://github.com/sagemath/sagetrac-mirror/commit/48e9ffbf5fe86d3186a505ae1e9ab1b13c8195f2)**",
    "created_at": "2017-06-02T07:36:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333351",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`00f6de8`](https://github.com/sagemath/sagetrac-mirror/commit/00f6de8d173a25b865c26c6af3f588b49e8401eb)** to **[`48e9ffb`](https://github.com/sagemath/sagetrac-mirror/commit/48e9ffbf5fe86d3186a505ae1e9ab1b13c8195f2)**



---

archive/issue_events_311788.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-06-06T19:46:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22509#event-311788"
}
```



---

archive/issue_events_311789.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-06-06T19:46:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22509#event-311789"
}
```



---

archive/issue_events_311790.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-06-06T19:46:06Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "milestone_number": null,
    "milestone_title": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22509#event-311790"
}
```



---

archive/issue_events_311791.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-06-06T19:46:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "label": "https://github.com/sagemath/sage/labels/wishlist%20item",
    "label_color": "e81ff9",
    "label_name": "wishlist item",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22509#event-311791"
}
```



---

archive/issue_comments_333352.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nThis already fails on the first package... `patch`:\n\n```\nMaking install in src\nmake[5]: Entering directory `/opt/sage/sage-git/local/var/tmp/sage/build/patch-2.7.5/src/src'\nmake[6]: Entering directory `/opt/sage/sage-git/local/var/tmp/sage/build/patch-2.7.5/src/src'\n /bin/mkdir -p '/opt/sage/sage-git/local/var/tmp/sage/build/patch-2.7.5/inst/opt/sage/sage-git/local/bin'\n  /usr/bin/install -c patch '/opt/sage/sage-git/local/var/tmp/sage/build/patch-2.7.5/inst/opt/sage/sage-git/local/bin'\nmake[6]: Nothing to be done for `install-data-am'.\nmake[6]: Leaving directory `/opt/sage/sage-git/local/var/tmp/sage/build/patch-2.7.5/src/src'\nmake[5]: Leaving directory `/opt/sage/sage-git/local/var/tmp/sage/build/patch-2.7.5/src/src'\nMaking install in tests\nmake[5]: Entering directory `/opt/sage/sage-git/local/var/tmp/sage/build/patch-2.7.5/src/tests'\nmake[6]: Entering directory `/opt/sage/sage-git/local/var/tmp/sage/build/patch-2.7.5/src/tests'\nmake[6]: Nothing to be done for `install-exec-am'.\nmake[6]: Nothing to be done for `install-data-am'.\nmake[6]: Leaving directory `/opt/sage/sage-git/local/var/tmp/sage/build/patch-2.7.5/src/tests'\nmake[5]: Leaving directory `/opt/sage/sage-git/local/var/tmp/sage/build/patch-2.7.5/src/tests'\nmake[5]: Entering directory `/opt/sage/sage-git/local/var/tmp/sage/build/patch-2.7.5/src'\nmake[6]: Entering directory `/opt/sage/sage-git/local/var/tmp/sage/build/patch-2.7.5/src'\nmake[6]: Nothing to be done for `install-exec-am'.\n /bin/mkdir -p '/opt/sage/sage-git/local/var/tmp/sage/build/patch-2.7.5/inst/opt/sage/sage-git/local/share/man/man1'\n /usr/bin/install -c -m 644 'patch.man' '/opt/sage/sage-git/local/var/tmp/sage/build/patch-2.7.5/inst/opt/sage/sage-git/local/share/man/man1/patch.1'\nmake[6]: Leaving directory `/opt/sage/sage-git/local/var/tmp/sage/build/patch-2.7.5/src'\nmake[5]: Leaving directory `/opt/sage/sage-git/local/var/tmp/sage/build/patch-2.7.5/src'\nmake[4]: Leaving directory `/opt/sage/sage-git/local/var/tmp/sage/build/patch-2.7.5/src'\nmake[3]: Leaving directory `/opt/sage/sage-git/local/var/tmp/sage/build/patch-2.7.5/src'\nCannot find the patch program we just installed\n```",
    "created_at": "2017-06-06T19:46:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333352",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:13" align="right">comment:13</div>

This already fails on the first package... `patch`:

```
Making install in src
make[5]: Entering directory `/opt/sage/sage-git/local/var/tmp/sage/build/patch-2.7.5/src/src'
make[6]: Entering directory `/opt/sage/sage-git/local/var/tmp/sage/build/patch-2.7.5/src/src'
 /bin/mkdir -p '/opt/sage/sage-git/local/var/tmp/sage/build/patch-2.7.5/inst/opt/sage/sage-git/local/bin'
  /usr/bin/install -c patch '/opt/sage/sage-git/local/var/tmp/sage/build/patch-2.7.5/inst/opt/sage/sage-git/local/bin'
make[6]: Nothing to be done for `install-data-am'.
make[6]: Leaving directory `/opt/sage/sage-git/local/var/tmp/sage/build/patch-2.7.5/src/src'
make[5]: Leaving directory `/opt/sage/sage-git/local/var/tmp/sage/build/patch-2.7.5/src/src'
Making install in tests
make[5]: Entering directory `/opt/sage/sage-git/local/var/tmp/sage/build/patch-2.7.5/src/tests'
make[6]: Entering directory `/opt/sage/sage-git/local/var/tmp/sage/build/patch-2.7.5/src/tests'
make[6]: Nothing to be done for `install-exec-am'.
make[6]: Nothing to be done for `install-data-am'.
make[6]: Leaving directory `/opt/sage/sage-git/local/var/tmp/sage/build/patch-2.7.5/src/tests'
make[5]: Leaving directory `/opt/sage/sage-git/local/var/tmp/sage/build/patch-2.7.5/src/tests'
make[5]: Entering directory `/opt/sage/sage-git/local/var/tmp/sage/build/patch-2.7.5/src'
make[6]: Entering directory `/opt/sage/sage-git/local/var/tmp/sage/build/patch-2.7.5/src'
make[6]: Nothing to be done for `install-exec-am'.
 /bin/mkdir -p '/opt/sage/sage-git/local/var/tmp/sage/build/patch-2.7.5/inst/opt/sage/sage-git/local/share/man/man1'
 /usr/bin/install -c -m 644 'patch.man' '/opt/sage/sage-git/local/var/tmp/sage/build/patch-2.7.5/inst/opt/sage/sage-git/local/share/man/man1/patch.1'
make[6]: Leaving directory `/opt/sage/sage-git/local/var/tmp/sage/build/patch-2.7.5/src'
make[5]: Leaving directory `/opt/sage/sage-git/local/var/tmp/sage/build/patch-2.7.5/src'
make[4]: Leaving directory `/opt/sage/sage-git/local/var/tmp/sage/build/patch-2.7.5/src'
make[3]: Leaving directory `/opt/sage/sage-git/local/var/tmp/sage/build/patch-2.7.5/src'
Cannot find the patch program we just installed
```



---

archive/issue_comments_333353.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nI see `${SAGE_INST_TEMP}${SAGE_LOCAL}` occuring in various places, maybe you should define a new variable for this.",
    "created_at": "2017-06-06T19:47:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333353",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:14" align="right">comment:14</div>

I see `${SAGE_INST_TEMP}${SAGE_LOCAL}` occuring in various places, maybe you should define a new variable for this.



---

archive/issue_comments_333354.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nLet me say that this a very brave patch :-)",
    "created_at": "2017-06-06T19:48:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333354",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:15" align="right">comment:15</div>

Let me say that this a very brave patch :-)



---

archive/issue_comments_333355.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nReplying to [@jdemeyer](#comment:14):\n> I see `${SAGE_INST_TEMP}${SAGE_LOCAL}` occuring in various places, maybe you should define a new variable for this.\n\nYeah, I keep thinking about that.  At first I was just going to redefine `$SAGE_LOCAL` to that, but that doesn't work because one needs the bare `$SAGE_LOCAL`, e.g., for the prefix.  I think I just need a good name for the combined path.  Maybe `$SAGE_LOCAL_TEMP`?",
    "created_at": "2017-06-07T11:48:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333355",
    "user": "https://github.com/embray"
}
```

<div id="comment:16" align="right">comment:16</div>

Replying to [@jdemeyer](#comment:14):
> I see `${SAGE_INST_TEMP}${SAGE_LOCAL}` occuring in various places, maybe you should define a new variable for this.

Yeah, I keep thinking about that.  At first I was just going to redefine `$SAGE_LOCAL` to that, but that doesn't work because one needs the bare `$SAGE_LOCAL`, e.g., for the prefix.  I think I just need a good name for the combined path.  Maybe `$SAGE_LOCAL_TEMP`?



---

archive/issue_comments_333356.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nReplying to [@jdemeyer](#comment:15):\n> Let me say that this a very brave patch :-)\n\nThanks! I just hope you agree with it in principle, because I really think it should be done.  Open to ideas on the specific details, although I think this is already pretty close.  There's a lot of things we could be doing better packaging-wise in the first place of course, but I'm still just trying to make the least disruptive changes I can.",
    "created_at": "2017-06-07T12:01:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333356",
    "user": "https://github.com/embray"
}
```

<div id="comment:17" align="right">comment:17</div>

Replying to [@jdemeyer](#comment:15):
> Let me say that this a very brave patch :-)

Thanks! I just hope you agree with it in principle, because I really think it should be done.  Open to ideas on the specific details, although I think this is already pretty close.  There's a lot of things we could be doing better packaging-wise in the first place of course, but I'm still just trying to make the least disruptive changes I can.



---

archive/issue_comments_333357.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nReplying to [@embray](#comment:16):\n> Maybe `$SAGE_LOCAL_TEMP`?\n\nI would prefer `$SAGE_TEMP_LOCAL` simply because that's consistent with the order (first `SAGE_INST_TEMP`, then `SAGE_LOCAL`).",
    "created_at": "2017-06-07T12:41:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333357",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:18" align="right">comment:18</div>

Replying to [@embray](#comment:16):
> Maybe `$SAGE_LOCAL_TEMP`?

I would prefer `$SAGE_TEMP_LOCAL` simply because that's consistent with the order (first `SAGE_INST_TEMP`, then `SAGE_LOCAL`).



---

archive/issue_comments_333358.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nThat's fine.  But before I do a mass rename on this, perhaps you (and/or others) could have a look at #23160.  It would be very nice to have this, or something like it, as a dependency on this ticket so that I can make a few bulk changes once (in the case of #23160 it would be replacing all calls to `$MAKE/make install` with `sdh_make_install`, and then many future tweaks can be made in one place--the definition of `sdh_make_install`).",
    "created_at": "2017-06-07T14:45:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333358",
    "user": "https://github.com/embray"
}
```

<div id="comment:19" align="right">comment:19</div>

That's fine.  But before I do a mass rename on this, perhaps you (and/or others) could have a look at #23160.  It would be very nice to have this, or something like it, as a dependency on this ticket so that I can make a few bulk changes once (in the case of #23160 it would be replacing all calls to `$MAKE/make install` with `sdh_make_install`, and then many future tweaks can be made in one place--the definition of `sdh_make_install`).



---

archive/issue_comments_333359.json:
```json
{
    "body": "<div id=\"comment:20\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d794f9701e20106fbdd412ceee990a685090d24f\"><code>d794f97</code></a></td><td><code>Updates the autotools spkg to use staged install</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7bcbccb7a1b223017eb45d334cb097f365632c48\"><code>7bcbccb</code></a></td><td><code>Fix installation of files containing spaces in their names</code></td></tr></table>\n",
    "created_at": "2017-06-07T14:46:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333359",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:20"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d794f9701e20106fbdd412ceee990a685090d24f"><code>d794f97</code></a></td><td><code>Updates the autotools spkg to use staged install</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7bcbccb7a1b223017eb45d334cb097f365632c48"><code>7bcbccb</code></a></td><td><code>Fix installation of files containing spaces in their names</code></td></tr></table>




---

archive/issue_comments_333360.json:
```json
{
    "body": "Changed commit from **[`48e9ffb`](https://github.com/sagemath/sagetrac-mirror/commit/48e9ffbf5fe86d3186a505ae1e9ab1b13c8195f2)** to **[`7bcbccb`](https://github.com/sagemath/sagetrac-mirror/commit/7bcbccb7a1b223017eb45d334cb097f365632c48)**",
    "created_at": "2017-06-07T14:46:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333360",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`48e9ffb`](https://github.com/sagemath/sagetrac-mirror/commit/48e9ffbf5fe86d3186a505ae1e9ab1b13c8195f2)** to **[`7bcbccb`](https://github.com/sagemath/sagetrac-mirror/commit/7bcbccb7a1b223017eb45d334cb097f365632c48)**



---

archive/issue_comments_333361.json:
```json
{
    "body": "<div id=\"comment:21\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9eb5876c6793718ba6225aaba0e07fcf71eab432\"><code>9eb5876</code></a></td><td><code>Remove this sanity check</code></td></tr></table>\n",
    "created_at": "2017-06-07T14:52:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333361",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:21"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9eb5876c6793718ba6225aaba0e07fcf71eab432"><code>9eb5876</code></a></td><td><code>Remove this sanity check</code></td></tr></table>




---

archive/issue_comments_333362.json:
```json
{
    "body": "Changed commit from **[`7bcbccb`](https://github.com/sagemath/sagetrac-mirror/commit/7bcbccb7a1b223017eb45d334cb097f365632c48)** to **[`9eb5876`](https://github.com/sagemath/sagetrac-mirror/commit/9eb5876c6793718ba6225aaba0e07fcf71eab432)**",
    "created_at": "2017-06-07T14:52:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333362",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`7bcbccb`](https://github.com/sagemath/sagetrac-mirror/commit/7bcbccb7a1b223017eb45d334cb097f365632c48)** to **[`9eb5876`](https://github.com/sagemath/sagetrac-mirror/commit/9eb5876c6793718ba6225aaba0e07fcf71eab432)**



---

archive/issue_comments_333363.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nReplying to [@jdemeyer](#comment:13):\n> This already fails on the first package... `patch`:\n\nJust a peculiarity of that package's `spkg-install`.  I removed the seemingly pointless check for now.",
    "created_at": "2017-06-07T14:54:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333363",
    "user": "https://github.com/embray"
}
```

<div id="comment:22" align="right">comment:22</div>

Replying to [@jdemeyer](#comment:13):
> This already fails on the first package... `patch`:

Just a peculiarity of that package's `spkg-install`.  I removed the seemingly pointless check for now.



---

archive/issue_comments_333364.json:
```json
{
    "body": "<div id=\"comment:23\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5f7d07967411a4c2ebdf2a837f6427bc210a761e\"><code>5f7d079</code></a></td><td><code>Fix sagenb installation</code></td></tr></table>\n",
    "created_at": "2017-06-08T07:39:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333364",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:23"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5f7d07967411a4c2ebdf2a837f6427bc210a761e"><code>5f7d079</code></a></td><td><code>Fix sagenb installation</code></td></tr></table>




---

archive/issue_comments_333365.json:
```json
{
    "body": "Changed commit from **[`9eb5876`](https://github.com/sagemath/sagetrac-mirror/commit/9eb5876c6793718ba6225aaba0e07fcf71eab432)** to **[`5f7d079`](https://github.com/sagemath/sagetrac-mirror/commit/5f7d07967411a4c2ebdf2a837f6427bc210a761e)**",
    "created_at": "2017-06-08T07:39:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333365",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`9eb5876`](https://github.com/sagemath/sagetrac-mirror/commit/9eb5876c6793718ba6225aaba0e07fcf71eab432)** to **[`5f7d079`](https://github.com/sagemath/sagetrac-mirror/commit/5f7d07967411a4c2ebdf2a837f6427bc210a761e)**



---

archive/issue_comments_333366.json:
```json
{
    "body": "<div id=\"comment:24\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/23799c8b38066712b67354916bba6c265b4f15d2\"><code>23799c8</code></a></td><td><code>Actually fix sagenb install</code></td></tr></table>\n",
    "created_at": "2017-06-08T08:30:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333366",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:24"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/23799c8b38066712b67354916bba6c265b4f15d2"><code>23799c8</code></a></td><td><code>Actually fix sagenb install</code></td></tr></table>




---

archive/issue_comments_333367.json:
```json
{
    "body": "Changed commit from **[`5f7d079`](https://github.com/sagemath/sagetrac-mirror/commit/5f7d07967411a4c2ebdf2a837f6427bc210a761e)** to **[`23799c8`](https://github.com/sagemath/sagetrac-mirror/commit/23799c8b38066712b67354916bba6c265b4f15d2)**",
    "created_at": "2017-06-08T08:30:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333367",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`5f7d079`](https://github.com/sagemath/sagetrac-mirror/commit/5f7d07967411a4c2ebdf2a837f6427bc210a761e)** to **[`23799c8`](https://github.com/sagemath/sagetrac-mirror/commit/23799c8b38066712b67354916bba6c265b4f15d2)**



---

archive/issue_comments_333368.json:
```json
{
    "body": "<div id=\"comment:25\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f30f96437555e3e86fba17c028afe8f1fb72542d\"><code>f30f964</code></a></td><td><code>Remove this sanity check</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/637d13628ebd79c5f9976d2241793efd3380c6e4\"><code>637d136</code></a></td><td><code>Fix sagenb installation</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/03b50fea279268b525f46cb35961e9e7332d54f6\"><code>03b50fe</code></a></td><td><code>Actually fix sagenb install</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2095d1d5fa3fbfbc39010fa7caa061d2be1cd77c\"><code>2095d1d</code></a></td><td><code>Make sure the path these symlinks are installed in exists first.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/48304f2970132eeda72c4e3c7edd1ba7c55095fa\"><code>48304f2</code></a></td><td><code>Some more enhancements to the sage-dist-helpers:</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5f0637dbbcdb3dd87c69e803cd694d10ed86e52d\"><code>5f0637d</code></a></td><td><code>Include the PKG_NAME, PKG_BASE, and PKG_VER variables directly in the install</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b5633e10f551c453adf785be2614bfcf7faa6852\"><code>b5633e1</code></a></td><td><code>Now that sdh_make_install implements DESTDIR we can replace all manual</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f41ab626a625b7b544c4a0731df061c35237a365\"><code>f41ab62</code></a></td><td><code>A few more standard autotools packages that are easily updated but I missed previously</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/06e7339f535ee8fc69454b202aa17be1f466a50a\"><code>06e7339</code></a></td><td><code>Disable pip installation when installing Python 3; see #23398</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/84a6827229bbaa3a26154b1202d4f12fe4acad43\"><code>84a6827</code></a></td><td><code>Don't override the valgrind suppression file from python2; add a separate one for Python 3</code></td></tr></table>\n",
    "created_at": "2017-07-11T15:21:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333368",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:25"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f30f96437555e3e86fba17c028afe8f1fb72542d"><code>f30f964</code></a></td><td><code>Remove this sanity check</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/637d13628ebd79c5f9976d2241793efd3380c6e4"><code>637d136</code></a></td><td><code>Fix sagenb installation</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/03b50fea279268b525f46cb35961e9e7332d54f6"><code>03b50fe</code></a></td><td><code>Actually fix sagenb install</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2095d1d5fa3fbfbc39010fa7caa061d2be1cd77c"><code>2095d1d</code></a></td><td><code>Make sure the path these symlinks are installed in exists first.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/48304f2970132eeda72c4e3c7edd1ba7c55095fa"><code>48304f2</code></a></td><td><code>Some more enhancements to the sage-dist-helpers:</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5f0637dbbcdb3dd87c69e803cd694d10ed86e52d"><code>5f0637d</code></a></td><td><code>Include the PKG_NAME, PKG_BASE, and PKG_VER variables directly in the install</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b5633e10f551c453adf785be2614bfcf7faa6852"><code>b5633e1</code></a></td><td><code>Now that sdh_make_install implements DESTDIR we can replace all manual</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f41ab626a625b7b544c4a0731df061c35237a365"><code>f41ab62</code></a></td><td><code>A few more standard autotools packages that are easily updated but I missed previously</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/06e7339f535ee8fc69454b202aa17be1f466a50a"><code>06e7339</code></a></td><td><code>Disable pip installation when installing Python 3; see #23398</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/84a6827229bbaa3a26154b1202d4f12fe4acad43"><code>84a6827</code></a></td><td><code>Don't override the valgrind suppression file from python2; add a separate one for Python 3</code></td></tr></table>




---

archive/issue_comments_333369.json:
```json
{
    "body": "Changed commit from **[`23799c8`](https://github.com/sagemath/sagetrac-mirror/commit/23799c8b38066712b67354916bba6c265b4f15d2)** to **[`84a6827`](https://github.com/sagemath/sagetrac-mirror/commit/84a6827229bbaa3a26154b1202d4f12fe4acad43)**",
    "created_at": "2017-07-11T15:21:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333369",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`23799c8`](https://github.com/sagemath/sagetrac-mirror/commit/23799c8b38066712b67354916bba6c265b4f15d2)** to **[`84a6827`](https://github.com/sagemath/sagetrac-mirror/commit/84a6827229bbaa3a26154b1202d4f12fe4acad43)**



---

archive/issue_comments_333370.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nNow depends on #23160.  Updates a bunch of packages to use the helper functions--once that change is made once it will be much easier to make mass updates simply by updating the helper functions.",
    "created_at": "2017-07-11T15:23:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333370",
    "user": "https://github.com/embray"
}
```

<div id="comment:26" align="right">comment:26</div>

Now depends on #23160.  Updates a bunch of packages to use the helper functions--once that change is made once it will be much easier to make mass updates simply by updating the helper functions.



---

archive/issue_comments_333371.json:
```json
{
    "body": "Changed dependencies from **#23059 #23096** to **#23059 #23096 #23160**",
    "created_at": "2017-07-11T15:23:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333371",
    "user": "https://github.com/embray"
}
```

Changed dependencies from **#23059 #23096** to **#23059 #23096 #23160**



---

archive/issue_comments_333372.json:
```json
{
    "body": "Changed commit from **[`84a6827`](https://github.com/sagemath/sagetrac-mirror/commit/84a6827229bbaa3a26154b1202d4f12fe4acad43)** to **[`0885622`](https://github.com/sagemath/sagetrac-mirror/commit/0885622958923d3f9f00725076b6553e10b8de4b)**",
    "created_at": "2017-07-11T15:28:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333372",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`84a6827`](https://github.com/sagemath/sagetrac-mirror/commit/84a6827229bbaa3a26154b1202d4f12fe4acad43)** to **[`0885622`](https://github.com/sagemath/sagetrac-mirror/commit/0885622958923d3f9f00725076b6553e10b8de4b)**



---

archive/issue_comments_333373.json:
```json
{
    "body": "<div id=\"comment:27\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0885622958923d3f9f00725076b6553e10b8de4b\"><code>0885622</code></a></td><td><code>Handle the 2to3 script better so that Python2 and Python3 don't overwrite each other</code></td></tr></table>\n",
    "created_at": "2017-07-11T15:28:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333373",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:27"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0885622958923d3f9f00725076b6553e10b8de4b"><code>0885622</code></a></td><td><code>Handle the 2to3 script better so that Python2 and Python3 don't overwrite each other</code></td></tr></table>




---

archive/issue_comments_333374.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nReplying to [@jdemeyer](#comment:18):\n> Replying to [@embray](#comment:16):\n> > Maybe `$SAGE_LOCAL_TEMP`?\n\n> \n> I would prefer `$SAGE_TEMP_LOCAL` simply because that's consistent with the order (first `SAGE_INST_TEMP`, then `SAGE_LOCAL`).\n\nActually, I think I'm going to rename `$SAGE_INST_TEMP` to `$SAGE_DESTDIR` for consistency with the DESTDIR convention. I think that makes it clear what it's for.  Then the `$SAGE_DESTDIR$SAGE_LOCAL` combination can be called `$SAGE_DESTDIR_LOCAL`.",
    "created_at": "2017-07-12T11:15:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333374",
    "user": "https://github.com/embray"
}
```

<div id="comment:28" align="right">comment:28</div>

Replying to [@jdemeyer](#comment:18):
> Replying to [@embray](#comment:16):
> > Maybe `$SAGE_LOCAL_TEMP`?

> 
> I would prefer `$SAGE_TEMP_LOCAL` simply because that's consistent with the order (first `SAGE_INST_TEMP`, then `SAGE_LOCAL`).

Actually, I think I'm going to rename `$SAGE_INST_TEMP` to `$SAGE_DESTDIR` for consistency with the DESTDIR convention. I think that makes it clear what it's for.  Then the `$SAGE_DESTDIR$SAGE_LOCAL` combination can be called `$SAGE_DESTDIR_LOCAL`.



---

archive/issue_comments_333375.json:
```json
{
    "body": "Changed commit from **[`0885622`](https://github.com/sagemath/sagetrac-mirror/commit/0885622958923d3f9f00725076b6553e10b8de4b)** to **[`62e916b`](https://github.com/sagemath/sagetrac-mirror/commit/62e916b7cda969e7798fb096672923a2c049fa10)**",
    "created_at": "2017-07-12T16:07:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333375",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`0885622`](https://github.com/sagemath/sagetrac-mirror/commit/0885622958923d3f9f00725076b6553e10b8de4b)** to **[`62e916b`](https://github.com/sagemath/sagetrac-mirror/commit/62e916b7cda969e7798fb096672923a2c049fa10)**



---

archive/issue_comments_333376.json:
```json
{
    "body": "<div id=\"comment:29\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/57ea8c9df098426c4116d9644260ade6fff42b8f\"><code>57ea8c9</code></a></td><td><code>Added the ability for packages to have a post-install script called spkg-postinst.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/76703a467e7f4d053066c95dde6a416fb4afa3c7\"><code>76703a4</code></a></td><td><code>Add special post-install handling for the backports/__init__.py shared</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/be4f47afdf4260100fd30cf38f3317056b86ccef\"><code>be4f47a</code></a></td><td><code>Remove some no-longer used local variables</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/62e916b7cda969e7798fb096672923a2c049fa10\"><code>62e916b</code></a></td><td><code>Add handling for packages that install .info files and update share/info/dir</code></td></tr></table>\n",
    "created_at": "2017-07-12T16:07:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333376",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:29"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/57ea8c9df098426c4116d9644260ade6fff42b8f"><code>57ea8c9</code></a></td><td><code>Added the ability for packages to have a post-install script called spkg-postinst.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/76703a467e7f4d053066c95dde6a416fb4afa3c7"><code>76703a4</code></a></td><td><code>Add special post-install handling for the backports/__init__.py shared</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/be4f47afdf4260100fd30cf38f3317056b86ccef"><code>be4f47a</code></a></td><td><code>Remove some no-longer used local variables</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/62e916b7cda969e7798fb096672923a2c049fa10"><code>62e916b</code></a></td><td><code>Add handling for packages that install .info files and update share/info/dir</code></td></tr></table>




---

archive/issue_comments_333377.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nReplying to [@jdemeyer](#comment:14):\n> I see `${SAGE_INST_TEMP}${SAGE_LOCAL}` occuring in various places, maybe you should define a new variable for this.\n\nActually on second thought, there was a reason for this: The idea was that if `$SAGE_INST_TEMP` isn't set then installation straight into `$SAGE_LOCAL` will still work.  The way this works currently is `$SAGE_INST_TEMP` is set by `sage-spkg` which handles the details of how to copy from the temporary install path into SAGE_LOCAL, and record the file manifest.\n\nBut if you're just running a package's spkg-install directly, then `$SAGE_INST_TEMP` is not set.  With #23179 in place I could make it so that `$SAGE_INST_TEMP` is always set in the script wrappers.  But I'm not necessarily sure that's desirable, since if you're running the script outside of sage-spkg the implementation details of staged installation are not meaningful, and it may be more useful to install directly into SAGE_LOCAL assuming it's for testing purposes.  Of course, one can always manually pass in a value for `$SAGE_INST_TEMP`.\n\nSo I think it would be better *not* to combine `$SAGE_INST_TEMP$SAGE_LOCAL` into a single variable, unless others are convinced that there is no use case for installing without `$SAGE_INST_TEMP` set.\n\n(I do still want to rename it `$SAGE_DESTDIR`--in this way it is used quite analogously to the way `$(DESTDIR)` is used in Makefiles.)",
    "created_at": "2017-07-13T08:21:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333377",
    "user": "https://github.com/embray"
}
```

<div id="comment:30" align="right">comment:30</div>

Replying to [@jdemeyer](#comment:14):
> I see `${SAGE_INST_TEMP}${SAGE_LOCAL}` occuring in various places, maybe you should define a new variable for this.

Actually on second thought, there was a reason for this: The idea was that if `$SAGE_INST_TEMP` isn't set then installation straight into `$SAGE_LOCAL` will still work.  The way this works currently is `$SAGE_INST_TEMP` is set by `sage-spkg` which handles the details of how to copy from the temporary install path into SAGE_LOCAL, and record the file manifest.

But if you're just running a package's spkg-install directly, then `$SAGE_INST_TEMP` is not set.  With #23179 in place I could make it so that `$SAGE_INST_TEMP` is always set in the script wrappers.  But I'm not necessarily sure that's desirable, since if you're running the script outside of sage-spkg the implementation details of staged installation are not meaningful, and it may be more useful to install directly into SAGE_LOCAL assuming it's for testing purposes.  Of course, one can always manually pass in a value for `$SAGE_INST_TEMP`.

So I think it would be better *not* to combine `$SAGE_INST_TEMP$SAGE_LOCAL` into a single variable, unless others are convinced that there is no use case for installing without `$SAGE_INST_TEMP` set.

(I do still want to rename it `$SAGE_DESTDIR`--in this way it is used quite analogously to the way `$(DESTDIR)` is used in Makefiles.)



---

archive/issue_comments_333378.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nIf it helps makes things more readable I could use the curly-brace syntax like `${SAGE_INST_TEMP}${SAGE_LOCAL}` rather then running them directly together.",
    "created_at": "2017-07-13T08:24:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333378",
    "user": "https://github.com/embray"
}
```

<div id="comment:31" align="right">comment:31</div>

If it helps makes things more readable I could use the curly-brace syntax like `${SAGE_INST_TEMP}${SAGE_LOCAL}` rather then running them directly together.



---

archive/issue_comments_333379.json:
```json
{
    "body": "<div id=\"comment:32\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/01c05f0c3bdd164d07846c72324e15f897328d6b\"><code>01c05f0</code></a></td><td><code>Rename $SAGE_INST_TEMP to $SAGE_DESTDIR</code></td></tr></table>\n",
    "created_at": "2017-07-13T08:27:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333379",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:32"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/01c05f0c3bdd164d07846c72324e15f897328d6b"><code>01c05f0</code></a></td><td><code>Rename $SAGE_INST_TEMP to $SAGE_DESTDIR</code></td></tr></table>




---

archive/issue_comments_333380.json:
```json
{
    "body": "Changed commit from **[`62e916b`](https://github.com/sagemath/sagetrac-mirror/commit/62e916b7cda969e7798fb096672923a2c049fa10)** to **[`01c05f0`](https://github.com/sagemath/sagetrac-mirror/commit/01c05f0c3bdd164d07846c72324e15f897328d6b)**",
    "created_at": "2017-07-13T08:27:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333380",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`62e916b`](https://github.com/sagemath/sagetrac-mirror/commit/62e916b7cda969e7798fb096672923a2c049fa10)** to **[`01c05f0`](https://github.com/sagemath/sagetrac-mirror/commit/01c05f0c3bdd164d07846c72324e15f897328d6b)**



---

archive/issue_comments_333381.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nI think that, pending #23160, this is basically ready.  I've tested it quite extensively myself on Linux and Cygwin and haven't encountered any more obvious problems.\n\nThe only exception would be that there are still some packages that write files that clobber each other, but they are only cases of optional/experimental packages clobbering standard packages, or optional/experimental packages clobbering each other.  These include:\n\n* openblas / atlas\n* mpir / gmp\n* boost_cropped / boost\n* pari_seadata_small / database_pari\n* database_stein_watkins_small / database_stein_watkins\n* gcc / compilerwrapper\n\nHowever, these incompatibilities were already the status quo.  While it will be possible in the future to improve the status quo (#23465 is work in that direction), I think these cases can be fixed independently of this ticket.  This ticket otherwise fixes all examples among standard (and some optional packages) where files were overwriting each other.",
    "created_at": "2017-07-20T16:08:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333381",
    "user": "https://github.com/embray"
}
```

<div id="comment:33" align="right">comment:33</div>

I think that, pending #23160, this is basically ready.  I've tested it quite extensively myself on Linux and Cygwin and haven't encountered any more obvious problems.

The only exception would be that there are still some packages that write files that clobber each other, but they are only cases of optional/experimental packages clobbering standard packages, or optional/experimental packages clobbering each other.  These include:

* openblas / atlas
* mpir / gmp
* boost_cropped / boost
* pari_seadata_small / database_pari
* database_stein_watkins_small / database_stein_watkins
* gcc / compilerwrapper

However, these incompatibilities were already the status quo.  While it will be possible in the future to improve the status quo (#23465 is work in that direction), I think these cases can be fixed independently of this ticket.  This ticket otherwise fixes all examples among standard (and some optional packages) where files were overwriting each other.



---

archive/issue_events_311792.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-07-20T16:08:33Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22509#event-311792"
}
```



---

archive/issue_events_311793.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-07-20T16:08:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22509#event-311793"
}
```



---

archive/issue_comments_333382.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nOn OS X, I get this with the `patch` package:\n\n```\ncp: illegal option -- u\nusage: cp [-R [-H | -L | -P]] [-fi | -n] [-apvX] source_file target_file\n       cp [-R [-H | -L | -P]] [-fi | -n] [-apvX] source_file ... target_directory\ncp: illegal option -- u\nusage: cp [-R [-H | -L | -P]] [-fi | -n] [-apvX] source_file target_file\n       cp [-R [-H | -L | -P]] [-fi | -n] [-apvX] source_file ... target_directory\nSuccessfully installed patch-2.7.5\n```\nA little later the same error causes yasm not to be installed, so mpir won't install:\n\n```\n[mpir-3.0.0.p0] configure: error: no system-wide yasm found\n```\nIn addition to fixing the `cp` command in `sage-spkg`, should you also check for errors after executing commands like this so as to avoid \"Successfully installed patch-2.7.5\" when it didn't actually successfully install?",
    "created_at": "2017-07-20T16:54:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333382",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:34" align="right">comment:34</div>

On OS X, I get this with the `patch` package:

```
cp: illegal option -- u
usage: cp [-R [-H | -L | -P]] [-fi | -n] [-apvX] source_file target_file
       cp [-R [-H | -L | -P]] [-fi | -n] [-apvX] source_file ... target_directory
cp: illegal option -- u
usage: cp [-R [-H | -L | -P]] [-fi | -n] [-apvX] source_file target_file
       cp [-R [-H | -L | -P]] [-fi | -n] [-apvX] source_file ... target_directory
Successfully installed patch-2.7.5
```
A little later the same error causes yasm not to be installed, so mpir won't install:

```
[mpir-3.0.0.p0] configure: error: no system-wide yasm found
```
In addition to fixing the `cp` command in `sage-spkg`, should you also check for errors after executing commands like this so as to avoid "Successfully installed patch-2.7.5" when it didn't actually successfully install?



---

archive/issue_events_311794.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2017-07-20T16:54:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22509#event-311794"
}
```



---

archive/issue_events_311795.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2017-07-20T16:54:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22509#event-311795"
}
```



---

archive/issue_comments_333383.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nSee also https://developer.apple.com/legacy/library/documentation/Darwin/Reference/ManPages/man1/cp.1.html (this page says it is retired, but it agrees with the man page on my Mac) and possibly also https://stackoverflow.com/questions/1132508/how-to-emulate-cp-update-behavior-on-mac-os-x.",
    "created_at": "2017-07-20T17:00:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333383",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:35" align="right">comment:35</div>

See also https://developer.apple.com/legacy/library/documentation/Darwin/Reference/ManPages/man1/cp.1.html (this page says it is retired, but it agrees with the man page on my Mac) and possibly also https://stackoverflow.com/questions/1132508/how-to-emulate-cp-update-behavior-on-mac-os-x.



---

archive/issue_comments_333384.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nThanks for the quick feedback!  I'll have to take a look at the OSX manpage \ud83d\ude1e.  This is fairly simple functionality to duplicate.",
    "created_at": "2017-07-20T17:01:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333384",
    "user": "https://github.com/embray"
}
```

<div id="comment:36" align="right">comment:36</div>

Thanks for the quick feedback!  I'll have to take a look at the OSX manpage .  This is fairly simple functionality to duplicate.



---

archive/issue_comments_333385.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nHonestly, the `-u` isn't even necessary.  In most cases it's going to be superfluous so I'd probably just remove it.",
    "created_at": "2017-07-20T17:10:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333385",
    "user": "https://github.com/embray"
}
```

<div id="comment:37" align="right">comment:37</div>

Honestly, the `-u` isn't even necessary.  In most cases it's going to be superfluous so I'd probably just remove it.



---

archive/issue_comments_333386.json:
```json
{
    "body": "Changed commit from **[`01c05f0`](https://github.com/sagemath/sagetrac-mirror/commit/01c05f0c3bdd164d07846c72324e15f897328d6b)** to **[`d950036`](https://github.com/sagemath/sagetrac-mirror/commit/d9500366634b7eb5b24eea91dbf5fd78a50848e3)**",
    "created_at": "2017-07-20T17:14:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333386",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`01c05f0`](https://github.com/sagemath/sagetrac-mirror/commit/01c05f0c3bdd164d07846c72324e15f897328d6b)** to **[`d950036`](https://github.com/sagemath/sagetrac-mirror/commit/d9500366634b7eb5b24eea91dbf5fd78a50848e3)**



---

archive/issue_comments_333387.json:
```json
{
    "body": "<div id=\"comment:38\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d9500366634b7eb5b24eea91dbf5fd78a50848e3\"><code>d950036</code></a></td><td><code>Don't use the -u option to cp.  It's not portable to BSD's cp, and is</code></td></tr></table>\n",
    "created_at": "2017-07-20T17:14:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333387",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:38"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d9500366634b7eb5b24eea91dbf5fd78a50848e3"><code>d950036</code></a></td><td><code>Don't use the -u option to cp.  It's not portable to BSD's cp, and is</code></td></tr></table>




---

archive/issue_events_311796.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-07-20T17:15:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22509#event-311796"
}
```



---

archive/issue_events_311797.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-07-20T17:15:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22509#event-311797"
}
```



---

archive/issue_events_311798.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2017-07-20T21:06:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22509#event-311798"
}
```



---

archive/issue_events_311799.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2017-07-20T21:06:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22509#event-311799"
}
```



---

archive/issue_comments_333388.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\n`ncurses` fails to install for me (on OS X):\n\n```\nCopying package files from temporary location /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.0.rc0/local/var/tmp/sage/build/ncurses-6.0/inst to /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.0.rc0/local\ncp: /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.0.rc0/local/var/tmp/sage/build/ncurses-6.0/inst/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.0.rc0/local//lib/terminfo is a directory (not copied).\n************************************************************************\nError copying files for ncurses.\n************************************************************************\n```",
    "created_at": "2017-07-20T21:06:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333388",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:40" align="right">comment:40</div>

`ncurses` fails to install for me (on OS X):

```
Copying package files from temporary location /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.0.rc0/local/var/tmp/sage/build/ncurses-6.0/inst to /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.0.rc0/local
cp: /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.0.rc0/local/var/tmp/sage/build/ncurses-6.0/inst/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.0.rc0/local//lib/terminfo is a directory (not copied).
************************************************************************
Error copying files for ncurses.
************************************************************************
```



---

archive/issue_comments_333389.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nDo you know the correct way to copy a symbolic link without dereferencing it on OSX?  It should be `-P`, but according to that man page it only respects `-P` if `-R` is used also.  But this is copying files one at a time.  I *could* use `-R` but would still have to loop over all the files anyways in order to build the manifest.  Also that man page says:\n\n```\nIn -R mode, cp will continue copying even if errors are detected.\n```\n\nwhich isn't necessarily what I want either.",
    "created_at": "2017-07-21T08:16:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333389",
    "user": "https://github.com/embray"
}
```

<div id="comment:41" align="right">comment:41</div>

Do you know the correct way to copy a symbolic link without dereferencing it on OSX?  It should be `-P`, but according to that man page it only respects `-P` if `-R` is used also.  But this is copying files one at a time.  I *could* use `-R` but would still have to loop over all the files anyways in order to build the manifest.  Also that man page says:

```
In -R mode, cp will continue copying even if errors are detected.
```

which isn't necessarily what I want either.



---

archive/issue_comments_333390.json:
```json
{
    "body": "<div id=\"comment:42\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d605943e4ee29256ea30180803b96aa6a2d6917c\"><code>d605943</code></a></td><td><code>Just use 'cp -a' which seems to be compatible across most cp's.</code></td></tr></table>\n",
    "created_at": "2017-07-21T08:21:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333390",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:42"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d605943e4ee29256ea30180803b96aa6a2d6917c"><code>d605943</code></a></td><td><code>Just use 'cp -a' which seems to be compatible across most cp's.</code></td></tr></table>




---

archive/issue_comments_333391.json:
```json
{
    "body": "Changed commit from **[`d950036`](https://github.com/sagemath/sagetrac-mirror/commit/d9500366634b7eb5b24eea91dbf5fd78a50848e3)** to **[`d605943`](https://github.com/sagemath/sagetrac-mirror/commit/d605943e4ee29256ea30180803b96aa6a2d6917c)**",
    "created_at": "2017-07-21T08:21:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333391",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`d950036`](https://github.com/sagemath/sagetrac-mirror/commit/d9500366634b7eb5b24eea91dbf5fd78a50848e3)** to **[`d605943`](https://github.com/sagemath/sagetrac-mirror/commit/d605943e4ee29256ea30180803b96aa6a2d6917c)**



---

archive/issue_events_311800.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-07-21T08:22:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22509#event-311800"
}
```



---

archive/issue_events_311801.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-07-21T08:22:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22509#event-311801"
}
```



---

archive/issue_comments_333392.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\n~~It occurs to me that the `pkgconf` package isn't being handled quite correctly.  This leads to problems when re-installing / upgrading that package.~~\n\nNevermind, for the purposes of *this* ticket it's fine.  It's only a problem in #22510.",
    "created_at": "2017-07-21T12:24:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333392",
    "user": "https://github.com/embray"
}
```

<div id="comment:44" align="right">comment:44</div>

~~It occurs to me that the `pkgconf` package isn't being handled quite correctly.  This leads to problems when re-installing / upgrading that package.~~

Nevermind, for the purposes of *this* ticket it's fine.  It's only a problem in #22510.



---

archive/issue_comments_333393.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\nNow python2 and python3 don't install:\n\n```\nInstalling valgrind suppression file...\n./spkg-install: line 140: ./python: is a directory\nTesting importing of various modules...\n./spkg-install: line 162: ./python: is a directory\nctypes module failed to import\n./spkg-install: line 162: ./python: is a directory\nmath module failed to import\n./spkg-install: line 162: ./python: is a directory\nhashlib module failed to import\n./spkg-install: line 162: ./python: is a directory\ncrypt module failed to import\n./spkg-install: line 162: ./python: is a directory\nreadline module failed to import\n./spkg-install: line 162: ./python: is a directory\nsocket module failed to import\n./spkg-install: line 171: ./python: is a directory\n_scproxy module failed to import\nError: One or more modules failed to import.\n```",
    "created_at": "2017-07-22T05:10:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333393",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:45" align="right">comment:45</div>

Now python2 and python3 don't install:

```
Installing valgrind suppression file...
./spkg-install: line 140: ./python: is a directory
Testing importing of various modules...
./spkg-install: line 162: ./python: is a directory
ctypes module failed to import
./spkg-install: line 162: ./python: is a directory
math module failed to import
./spkg-install: line 162: ./python: is a directory
hashlib module failed to import
./spkg-install: line 162: ./python: is a directory
crypt module failed to import
./spkg-install: line 162: ./python: is a directory
readline module failed to import
./spkg-install: line 162: ./python: is a directory
socket module failed to import
./spkg-install: line 171: ./python: is a directory
_scproxy module failed to import
Error: One or more modules failed to import.
```



---

archive/issue_comments_333394.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">comment:46</div>\n\nDoes OSX have case-insensitivity or something?",
    "created_at": "2017-07-31T09:11:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333394",
    "user": "https://github.com/embray"
}
```

<div id="comment:46" align="right">comment:46</div>

Does OSX have case-insensitivity or something?



---

archive/issue_comments_333395.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">comment:47</div>\n\nOr in other words, if I have in the same directory an executable called `python` and a directory called `Python` (as is the case in the CPython source tree) what will happen if I run `./python` on OSX?",
    "created_at": "2017-07-31T10:44:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333395",
    "user": "https://github.com/embray"
}
```

<div id="comment:47" align="right">comment:47</div>

Or in other words, if I have in the same directory an executable called `python` and a directory called `Python` (as is the case in the CPython source tree) what will happen if I run `./python` on OSX?



---

archive/issue_comments_333396.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">comment:48</div>\n\nCoincidentally, I just discovered that this also fixes a rare race condition that results from the fact that multiple packages write to `$SAGE_LOCAL/usr/share/info/dir`.  If two packages that write to that file are installed in parallel there are probably a number of ways that can go wrong, such as (what just happened to me):\n\nA) `[ ! -d $(DESTDIR)$info_dir ] ...`\n\nB) `mkdir $(DESTDIR)$info_dir`\n\nA) `... || mkdir $(DESTDIR)$info_dir`\n\n\nresulting in directory already exists error.",
    "created_at": "2017-07-31T12:21:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333396",
    "user": "https://github.com/embray"
}
```

<div id="comment:48" align="right">comment:48</div>

Coincidentally, I just discovered that this also fixes a rare race condition that results from the fact that multiple packages write to `$SAGE_LOCAL/usr/share/info/dir`.  If two packages that write to that file are installed in parallel there are probably a number of ways that can go wrong, such as (what just happened to me):

A) `[ ! -d $(DESTDIR)$info_dir ] ...`

B) `mkdir $(DESTDIR)$info_dir`

A) `... || mkdir $(DESTDIR)$info_dir`


resulting in directory already exists error.



---

archive/issue_comments_333397.json:
```json
{
    "body": "<div id=\"comment:49\" align=\"right\">comment:49</div>\n\nReplying to [@embray](#comment:46):\n> Does OSX have case-insensitivity or something?\n\nIt turns out Python's `./configure` explicitly checks this.  Does the build log say something like\n\n```\nchecking for case-insensitive build directory...yes\n```\n\n?",
    "created_at": "2017-07-31T12:30:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333397",
    "user": "https://github.com/embray"
}
```

<div id="comment:49" align="right">comment:49</div>

Replying to [@embray](#comment:46):
> Does OSX have case-insensitivity or something?

It turns out Python's `./configure` explicitly checks this.  Does the build log say something like

```
checking for case-insensitive build directory...yes
```

?



---

archive/issue_comments_333398.json:
```json
{
    "body": "<div id=\"comment:50\" align=\"right\">comment:50</div>\n\nIndeed, it looks like on *any* OS (including OSX) if a case-insensitive filesystem is being built on it outputs the Python executable in the build dir as `python.exe` so we just need to look for that I guess.",
    "created_at": "2017-07-31T12:39:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333398",
    "user": "https://github.com/embray"
}
```

<div id="comment:50" align="right">comment:50</div>

Indeed, it looks like on *any* OS (including OSX) if a case-insensitive filesystem is being built on it outputs the Python executable in the build dir as `python.exe` so we just need to look for that I guess.



---

archive/issue_comments_333399.json:
```json
{
    "body": "Changed commit from **[`d605943`](https://github.com/sagemath/sagetrac-mirror/commit/d605943e4ee29256ea30180803b96aa6a2d6917c)** to **[`dbdb947`](https://github.com/sagemath/sagetrac-mirror/commit/dbdb94788f6275e19c5fd150bec8a889188f3164)**",
    "created_at": "2017-07-31T12:45:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333399",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`d605943`](https://github.com/sagemath/sagetrac-mirror/commit/d605943e4ee29256ea30180803b96aa6a2d6917c)** to **[`dbdb947`](https://github.com/sagemath/sagetrac-mirror/commit/dbdb94788f6275e19c5fd150bec8a889188f3164)**



---

archive/issue_comments_333400.json:
```json
{
    "body": "<div id=\"comment:51\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dbdb94788f6275e19c5fd150bec8a889188f3164\"><code>dbdb947</code></a></td><td><code>Fix Python build on non-Cygwin systems (namely OSX) with case-insensitive filesystems</code></td></tr></table>\n",
    "created_at": "2017-07-31T12:45:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333400",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:51"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dbdb94788f6275e19c5fd150bec8a889188f3164"><code>dbdb947</code></a></td><td><code>Fix Python build on non-Cygwin systems (namely OSX) with case-insensitive filesystems</code></td></tr></table>




---

archive/issue_comments_333401.json:
```json
{
    "body": "<div id=\"comment:52\" align=\"right\">comment:52</div>\n\nGive that a try. I can't imagine there's any other reason for this.",
    "created_at": "2017-07-31T12:45:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333401",
    "user": "https://github.com/embray"
}
```

<div id="comment:52" align="right">comment:52</div>

Give that a try. I can't imagine there's any other reason for this.



---

archive/issue_comments_333402.json:
```json
{
    "body": "<div id=\"comment:53\" align=\"right\">comment:53</div>\n\nYes, OS X has a type of case-insensitivity. The current branch gets a little farther, but still fails. With python2:\n\n```\nInstalling valgrind suppression file...\nTesting importing of various modules...\nTraceback (most recent call last):\n  File \"<string>\", line 1, in <module>\n  File \"/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta0/local/var/tmp/sage/build/python2-2.7.13.p1/src/Lib/ctypes/__init__.py\", line 7, in <module>\n    from _ctypes import Union, Structure, Array\nImportError: dlopen(/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta0/local/var/tmp/sage/build/python2-2.7.13.p1/src/build/lib.macosx-10.9-x86_64-2.7/_ctypes.so, 2): Symbol not found: _PyUnicodeUCS4_AsEncodedString\n  Referenced from: /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta0/local/var/tmp/sage/build/python2-2.7.13.p1/src/build/lib.macosx-10.9-x86_64-2.7/_ctypes.so\n  Expected in: flat namespace\n in /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta0/local/var/tmp/sage/build/python2-2.7.13.p1/src/build/lib.macosx-10.9-x86_64-2.7/_ctypes.so\nctypes module failed to import\nmath module imported OK\nTraceback (most recent call last):\n  File \"<string>\", line 1, in <module>\n  File \"/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta0/local/var/tmp/sage/build/python2-2.7.13.p1/src/Lib/hashlib.py\", line 158, in <module>\n    import struct\n  File \"/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta0/local/var/tmp/sage/build/python2-2.7.13.p1/src/Lib/struct.py\", line 1, in <module>\n    from _struct import *\nImportError: dlopen(/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta0/local/var/tmp/sage/build/python2-2.7.13.p1/src/build/lib.macosx-10.9-x86_64-2.7/_struct.so, 2): Symbol not found: _PyUnicodeUCS4_AsEncodedString\n  Referenced from: /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta0/local/var/tmp/sage/build/python2-2.7.13.p1/src/build/lib.macosx-10.9-x86_64-2.7/_struct.so\n  Expected in: flat namespace\n in /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta0/local/var/tmp/sage/build/python2-2.7.13.p1/src/build/lib.macosx-10.9-x86_64-2.7/_struct.so\nhashlib module failed to import\ncrypt module imported OK\nreadline module imported OK\nTraceback (most recent call last):\n  File \"<string>\", line 1, in <module>\n  File \"/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta0/local/var/tmp/sage/build/python2-2.7.13.p1/src/Lib/socket.py\", line 47, in <module>\n    import _socket\nImportError: dlopen(/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta0/local/var/tmp/sage/build/python2-2.7.13.p1/src/build/lib.macosx-10.9-x86_64-2.7/_socket.so, 2): Symbol not found: _PyUnicodeUCS4_AsEncodedString\n  Referenced from: /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta0/local/var/tmp/sage/build/python2-2.7.13.p1/src/build/lib.macosx-10.9-x86_64-2.7/_socket.so\n  Expected in: flat namespace\n in /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta0/local/var/tmp/sage/build/python2-2.7.13.p1/src/build/lib.macosx-10.9-x86_64-2.7/_socket.so\nsocket module failed to import\n_scproxy module imported OK\nError: One or more modules failed to import.\n```\nIt's odd that some of the modules succeeded while others failed.\n\nWith python3:\n\n```\nInstalling valgrind suppression file...\ndyld: Library not loaded: /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta0/local/lib/libpython3.6m.dylib\n  Referenced from: /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta0/local/var/tmp/sage/build/python3-3.6.1/src/./python.exe\n  Reason: image not found\ndyld: Library not loaded: /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta0/local/lib/libpython3.6m.dylib\n  Referenced from: /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta0/local/var/tmp/sage/build/python3-3.6.1/src/./python.exe\n  Reason: image not found\nTesting importing of various modules...\ndyld: Library not loaded: /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta0/local/lib/libpython3.6m.dylib\n  Referenced from: /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta0/local/var/tmp/sage/build/python3-3.6.1/src/./python.exe\n  Reason: image not found\n./spkg-install: line 160: 84992 Abort trap: 6           $PYTHON -c \"import $module\"\nctypes module failed to import\ndyld: Library not loaded: /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta0/local/lib/libpython3.6m.dylib\n  Referenced from: /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta0/local/var/tmp/sage/build/python3-3.6.1/src/./python.exe\n  Reason: image not found\n./spkg-install: line 160: 84993 Abort trap: 6           $PYTHON -c \"import $module\"\nmath module failed to import\ndyld: Library not loaded: /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta0/local/lib/libpython3.6m.dylib\n  Referenced from: /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta0/local/var/tmp/sage/build/python3-3.6.1/src/./python.exe\n  Reason: image not found\n./spkg-install: line 160: 84995 Abort trap: 6           $PYTHON -c \"import $module\"\nhashlib module failed to import\ndyld: Library not loaded: /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta0/local/lib/libpython3.6m.dylib\n  Referenced from: /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta0/local/var/tmp/sage/build/python3-3.6.1/src/./python.exe\n  Reason: image not found\n./spkg-install: line 160: 84997 Abort trap: 6           $PYTHON -c \"import $module\"\ncrypt module failed to import\ndyld: Library not loaded: /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta0/local/lib/libpython3.6m.dylib\n  Referenced from: /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta0/local/var/tmp/sage/build/python3-3.6.1/src/./python.exe\n  Reason: image not found\n./spkg-install: line 160: 84998 Abort trap: 6           $PYTHON -c \"import $module\"\nreadline module failed to import\ndyld: Library not loaded: /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta0/local/lib/libpython3.6m.dylib\n  Referenced from: /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta0/local/var/tmp/sage/build/python3-3.6.1/src/./python.exe\n  Reason: image not found\n./spkg-install: line 160: 85000 Abort trap: 6           $PYTHON -c \"import $module\"\nsocket module failed to import\ndyld: Library not loaded: /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta0/local/lib/libpython3.6m.dylib\n  Referenced from: /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta0/local/var/tmp/sage/build/python3-3.6.1/src/./python.exe\n  Reason: image not found\n./spkg-install: line 176: 85001 Abort trap: 6           $PYTHON -c \"import _scproxy\"\n_scproxy module failed to import\nError: One or more modules failed to import.\n```",
    "created_at": "2017-07-31T17:24:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333402",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:53" align="right">comment:53</div>

Yes, OS X has a type of case-insensitivity. The current branch gets a little farther, but still fails. With python2:

```
Installing valgrind suppression file...
Testing importing of various modules...
Traceback (most recent call last):
  File "<string>", line 1, in <module>
  File "/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta0/local/var/tmp/sage/build/python2-2.7.13.p1/src/Lib/ctypes/__init__.py", line 7, in <module>
    from _ctypes import Union, Structure, Array
ImportError: dlopen(/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta0/local/var/tmp/sage/build/python2-2.7.13.p1/src/build/lib.macosx-10.9-x86_64-2.7/_ctypes.so, 2): Symbol not found: _PyUnicodeUCS4_AsEncodedString
  Referenced from: /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta0/local/var/tmp/sage/build/python2-2.7.13.p1/src/build/lib.macosx-10.9-x86_64-2.7/_ctypes.so
  Expected in: flat namespace
 in /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta0/local/var/tmp/sage/build/python2-2.7.13.p1/src/build/lib.macosx-10.9-x86_64-2.7/_ctypes.so
ctypes module failed to import
math module imported OK
Traceback (most recent call last):
  File "<string>", line 1, in <module>
  File "/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta0/local/var/tmp/sage/build/python2-2.7.13.p1/src/Lib/hashlib.py", line 158, in <module>
    import struct
  File "/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta0/local/var/tmp/sage/build/python2-2.7.13.p1/src/Lib/struct.py", line 1, in <module>
    from _struct import *
ImportError: dlopen(/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta0/local/var/tmp/sage/build/python2-2.7.13.p1/src/build/lib.macosx-10.9-x86_64-2.7/_struct.so, 2): Symbol not found: _PyUnicodeUCS4_AsEncodedString
  Referenced from: /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta0/local/var/tmp/sage/build/python2-2.7.13.p1/src/build/lib.macosx-10.9-x86_64-2.7/_struct.so
  Expected in: flat namespace
 in /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta0/local/var/tmp/sage/build/python2-2.7.13.p1/src/build/lib.macosx-10.9-x86_64-2.7/_struct.so
hashlib module failed to import
crypt module imported OK
readline module imported OK
Traceback (most recent call last):
  File "<string>", line 1, in <module>
  File "/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta0/local/var/tmp/sage/build/python2-2.7.13.p1/src/Lib/socket.py", line 47, in <module>
    import _socket
ImportError: dlopen(/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta0/local/var/tmp/sage/build/python2-2.7.13.p1/src/build/lib.macosx-10.9-x86_64-2.7/_socket.so, 2): Symbol not found: _PyUnicodeUCS4_AsEncodedString
  Referenced from: /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta0/local/var/tmp/sage/build/python2-2.7.13.p1/src/build/lib.macosx-10.9-x86_64-2.7/_socket.so
  Expected in: flat namespace
 in /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta0/local/var/tmp/sage/build/python2-2.7.13.p1/src/build/lib.macosx-10.9-x86_64-2.7/_socket.so
socket module failed to import
_scproxy module imported OK
Error: One or more modules failed to import.
```
It's odd that some of the modules succeeded while others failed.

With python3:

```
Installing valgrind suppression file...
dyld: Library not loaded: /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta0/local/lib/libpython3.6m.dylib
  Referenced from: /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta0/local/var/tmp/sage/build/python3-3.6.1/src/./python.exe
  Reason: image not found
dyld: Library not loaded: /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta0/local/lib/libpython3.6m.dylib
  Referenced from: /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta0/local/var/tmp/sage/build/python3-3.6.1/src/./python.exe
  Reason: image not found
Testing importing of various modules...
dyld: Library not loaded: /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta0/local/lib/libpython3.6m.dylib
  Referenced from: /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta0/local/var/tmp/sage/build/python3-3.6.1/src/./python.exe
  Reason: image not found
./spkg-install: line 160: 84992 Abort trap: 6           $PYTHON -c "import $module"
ctypes module failed to import
dyld: Library not loaded: /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta0/local/lib/libpython3.6m.dylib
  Referenced from: /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta0/local/var/tmp/sage/build/python3-3.6.1/src/./python.exe
  Reason: image not found
./spkg-install: line 160: 84993 Abort trap: 6           $PYTHON -c "import $module"
math module failed to import
dyld: Library not loaded: /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta0/local/lib/libpython3.6m.dylib
  Referenced from: /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta0/local/var/tmp/sage/build/python3-3.6.1/src/./python.exe
  Reason: image not found
./spkg-install: line 160: 84995 Abort trap: 6           $PYTHON -c "import $module"
hashlib module failed to import
dyld: Library not loaded: /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta0/local/lib/libpython3.6m.dylib
  Referenced from: /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta0/local/var/tmp/sage/build/python3-3.6.1/src/./python.exe
  Reason: image not found
./spkg-install: line 160: 84997 Abort trap: 6           $PYTHON -c "import $module"
crypt module failed to import
dyld: Library not loaded: /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta0/local/lib/libpython3.6m.dylib
  Referenced from: /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta0/local/var/tmp/sage/build/python3-3.6.1/src/./python.exe
  Reason: image not found
./spkg-install: line 160: 84998 Abort trap: 6           $PYTHON -c "import $module"
readline module failed to import
dyld: Library not loaded: /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta0/local/lib/libpython3.6m.dylib
  Referenced from: /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta0/local/var/tmp/sage/build/python3-3.6.1/src/./python.exe
  Reason: image not found
./spkg-install: line 160: 85000 Abort trap: 6           $PYTHON -c "import $module"
socket module failed to import
dyld: Library not loaded: /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta0/local/lib/libpython3.6m.dylib
  Referenced from: /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta0/local/var/tmp/sage/build/python3-3.6.1/src/./python.exe
  Reason: image not found
./spkg-install: line 176: 85001 Abort trap: 6           $PYTHON -c "import _scproxy"
_scproxy module failed to import
Error: One or more modules failed to import.
```



---

archive/issue_comments_333403.json:
```json
{
    "body": "<div id=\"comment:54\" align=\"right\">comment:54</div>\n\nI see.  This probably means that some `DYLD_LIBRARY_PATH` or similar needs to be set in order for Python being run out of the source tree to link with the correct libpython.\n\nThanks for your testing / patience--I need to bother nthiery to get me an OSX machine I can test on so that this will be easier in the future.\n\nOther than this Python thing I don't anticipate too many other issues with this.  The only reason Python is being stubborn is that I made a somewhat non-trivial change to how the Python self-tests are performed.  Very few of the other packages otherwise have significant changes to how they're installed (though a few do).",
    "created_at": "2017-08-01T13:22:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333403",
    "user": "https://github.com/embray"
}
```

<div id="comment:54" align="right">comment:54</div>

I see.  This probably means that some `DYLD_LIBRARY_PATH` or similar needs to be set in order for Python being run out of the source tree to link with the correct libpython.

Thanks for your testing / patience--I need to bother nthiery to get me an OSX machine I can test on so that this will be easier in the future.

Other than this Python thing I don't anticipate too many other issues with this.  The only reason Python is being stubborn is that I made a somewhat non-trivial change to how the Python self-tests are performed.  Very few of the other packages otherwise have significant changes to how they're installed (though a few do).



---

archive/issue_comments_333404.json:
```json
{
    "body": "<div id=\"comment:55\" align=\"right\">comment:55</div>\n\nPython has also always been finicky to install on OS X. Anyway, imitating what was there already for linux works on this machine: adding\n\n```\nif [ \"$UNAME\" = \"Darwin\" ]; then\n   export DYLD_LIBRARY_PATH=\".\"\nfi\n```\nright before `echo \"Testing importing of various modules...\"`, for example, fixed both `python2` and `python3`.\n\nOther issues: this one is strange and non-repeatable, but I saw this once with maxima:\n\n```\nFound local metadata for maxima-5.39.0.p0\nCould not find platform independent libraries <prefix>\nCould not find platform dependent libraries <exec_prefix>\nConsider setting $PYTHONHOME to <prefix>[:<exec_prefix>]\nImportError: No module named site\n************************************************************************\nError downloading maxima-5.39.0.tar.gz\n************************************************************************\n```\nIn this case, the maxima tarball had already been downloaded to the `upstream` directory. When I ran \"make\" again, it went smoothly. I don't know if this is worth investigating.\n\nMore importantly, I get build errors with `gsl` and `numpy`. For `gsl`:\n\n```\nchecking build system type... x86_64-apple-darwin16.7.0\nchecking host system type... x86_64-apple-darwin16.7.0\nchecking for gcc... gcc\nchecking whether the C compiler works... yes\nchecking for C compiler default output file name... a.out\nchecking for suffix of executables... \nchecking whether we are cross compiling... configure: error: in `/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta0/local/var/tmp/sage/build/gsl-2.3/src':\nconfigure: error: cannot run C compiled programs.\nIf you meant to cross compile, use `--host'.\nSee `config.log' for more details\n```\nconfig.log says\n\n```\nconfigure:3480: checking whether the C compiler works\nconfigure:3502: gcc -g -O2   -L/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib -Wl,-rpath,/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib  conftest.c -lopenblas   -lm >&5\nconfigure:3506: $? = 0\nconfigure:3554: result: yes\nconfigure:3557: checking for C compiler default output file name\nconfigure:3559: result: a.out\nconfigure:3565: checking for suffix of executables\nconfigure:3572: gcc -o conftest -g -O2   -L/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib -Wl,-rpath,/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib  conftest.c -lopenblas   -lm >&5\nconfigure:3576: $? = 0\nconfigure:3598: result: \nconfigure:3620: checking whether we are cross compiling\nconfigure:3628: gcc -o conftest -g -O2   -L/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib -Wl,-rpath,/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib  conftest.c -lopenblas   -lm >&5\nconfigure:3632: $? = 0\nconfigure:3639: ./conftest\ndyld: Library not loaded: /Users/palmieri/Desktop/Sage_stuff/git/sage/local/var/tmp/sage/build/openblas-0.2.19.p0/inst/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/libopenblas_haswell-r0.2.19.dylib\n  Referenced from: /Users/palmieri/Desktop/Sage_stuff/git/sage/local/var/tmp/sage/build/gsl-2.3/src/./conftest\n  Reason: image not found\n./configure: line 3641:  5891 Abort trap: 6           ./conftest$ac_cv_exeext\nconfigure:3643: $? = 134\nconfigure:3650: error: in `/Users/palmieri/Desktop/Sage_stuff/git/sage/local/var/tmp/sage/build/gsl-2.3/src':\nconfigure:3652: error: cannot run C compiled programs.\nIf you meant to cross compile, use `--host'.\n```\nI don't know why it seems to be looking for `libopenblas_haswell-r0.2.19.dylib` in the temporary directory; the command invoking `./configure` has the correct `--prefix` and `--libdir`.\n\nFor `numpy`:\n\n```\nCopying numpy.egg-info to /Users/palmieri/Desktop/Sage_stuff/git/sage/local/var/tmp/sage/build/numpy-1.12.1/inst/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/numpy-1.12.1-py2.7.egg-info\nrunning install_scripts\ncreating /Users/palmieri/Desktop/Sage_stuff/git/sage/local/var/tmp/sage/build/numpy-1.12.1/inst/Users/palmieri/Desktop/Sage_stuff/git/sage/local/bin\ncopying build/scripts.macosx-10.9-x86_64-2.7/f2py2 -> /Users/palmieri/Desktop/Sage_stuff/git/sage/local/var/tmp/sage/build/numpy-1.12.1/inst/Users/palmieri/Desktop/Sage_stuff/git/sage/local/bin\nchanging mode of /Users/palmieri/Desktop/Sage_stuff/git/sage/local/var/tmp/sage/build/numpy-1.12.1/inst/Users/palmieri/Desktop/Sage_stuff/git/sage/local/bin/f2py2 to 755\nTraceback (most recent call last):\n  File \"<stdin>\", line 3, in <module>\n  File \"/Users/palmieri/Desktop/Sage_stuff/git/sage/local/var/tmp/sage/build/numpy-1.12.1/inst/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/numpy/__init__.py\", line 142, in <module>\n    from . import add_newdocs\n  File \"/Users/palmieri/Desktop/Sage_stuff/git/sage/local/var/tmp/sage/build/numpy-1.12.1/inst/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/numpy/add_newdocs.py\", line 13, in <module>\n    from numpy.lib import add_newdoc\n  File \"/Users/palmieri/Desktop/Sage_stuff/git/sage/local/var/tmp/sage/build/numpy-1.12.1/inst/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/numpy/lib/__init__.py\", line 8, in <module>\n    from .type_check import *\n  File \"/Users/palmieri/Desktop/Sage_stuff/git/sage/local/var/tmp/sage/build/numpy-1.12.1/inst/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/numpy/lib/type_check.py\", line 11, in <module>\n    import numpy.core.numeric as _nx\n  File \"/Users/palmieri/Desktop/Sage_stuff/git/sage/local/var/tmp/sage/build/numpy-1.12.1/inst/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/numpy/core/__init__.py\", line 24, in <module>\n    raise ImportError(msg)\nImportError: \nImporting the multiarray numpy extension module failed.  Most\nlikely you are trying to import a failed build of numpy.\nIf you're working with a numpy git repo, try `git clean -xdf` (removes all\nfiles not under version control).  Otherwise reinstall numpy.\n```",
    "created_at": "2017-08-01T18:23:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333404",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:55" align="right">comment:55</div>

Python has also always been finicky to install on OS X. Anyway, imitating what was there already for linux works on this machine: adding

```
if [ "$UNAME" = "Darwin" ]; then
   export DYLD_LIBRARY_PATH="."
fi
```
right before `echo "Testing importing of various modules..."`, for example, fixed both `python2` and `python3`.

Other issues: this one is strange and non-repeatable, but I saw this once with maxima:

```
Found local metadata for maxima-5.39.0.p0
Could not find platform independent libraries <prefix>
Could not find platform dependent libraries <exec_prefix>
Consider setting $PYTHONHOME to <prefix>[:<exec_prefix>]
ImportError: No module named site
************************************************************************
Error downloading maxima-5.39.0.tar.gz
************************************************************************
```
In this case, the maxima tarball had already been downloaded to the `upstream` directory. When I ran "make" again, it went smoothly. I don't know if this is worth investigating.

More importantly, I get build errors with `gsl` and `numpy`. For `gsl`:

```
checking build system type... x86_64-apple-darwin16.7.0
checking host system type... x86_64-apple-darwin16.7.0
checking for gcc... gcc
checking whether the C compiler works... yes
checking for C compiler default output file name... a.out
checking for suffix of executables... 
checking whether we are cross compiling... configure: error: in `/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta0/local/var/tmp/sage/build/gsl-2.3/src':
configure: error: cannot run C compiled programs.
If you meant to cross compile, use `--host'.
See `config.log' for more details
```
config.log says

```
configure:3480: checking whether the C compiler works
configure:3502: gcc -g -O2   -L/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib -Wl,-rpath,/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib  conftest.c -lopenblas   -lm >&5
configure:3506: $? = 0
configure:3554: result: yes
configure:3557: checking for C compiler default output file name
configure:3559: result: a.out
configure:3565: checking for suffix of executables
configure:3572: gcc -o conftest -g -O2   -L/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib -Wl,-rpath,/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib  conftest.c -lopenblas   -lm >&5
configure:3576: $? = 0
configure:3598: result: 
configure:3620: checking whether we are cross compiling
configure:3628: gcc -o conftest -g -O2   -L/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib -Wl,-rpath,/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib  conftest.c -lopenblas   -lm >&5
configure:3632: $? = 0
configure:3639: ./conftest
dyld: Library not loaded: /Users/palmieri/Desktop/Sage_stuff/git/sage/local/var/tmp/sage/build/openblas-0.2.19.p0/inst/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/libopenblas_haswell-r0.2.19.dylib
  Referenced from: /Users/palmieri/Desktop/Sage_stuff/git/sage/local/var/tmp/sage/build/gsl-2.3/src/./conftest
  Reason: image not found
./configure: line 3641:  5891 Abort trap: 6           ./conftest$ac_cv_exeext
configure:3643: $? = 134
configure:3650: error: in `/Users/palmieri/Desktop/Sage_stuff/git/sage/local/var/tmp/sage/build/gsl-2.3/src':
configure:3652: error: cannot run C compiled programs.
If you meant to cross compile, use `--host'.
```
I don't know why it seems to be looking for `libopenblas_haswell-r0.2.19.dylib` in the temporary directory; the command invoking `./configure` has the correct `--prefix` and `--libdir`.

For `numpy`:

```
Copying numpy.egg-info to /Users/palmieri/Desktop/Sage_stuff/git/sage/local/var/tmp/sage/build/numpy-1.12.1/inst/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/numpy-1.12.1-py2.7.egg-info
running install_scripts
creating /Users/palmieri/Desktop/Sage_stuff/git/sage/local/var/tmp/sage/build/numpy-1.12.1/inst/Users/palmieri/Desktop/Sage_stuff/git/sage/local/bin
copying build/scripts.macosx-10.9-x86_64-2.7/f2py2 -> /Users/palmieri/Desktop/Sage_stuff/git/sage/local/var/tmp/sage/build/numpy-1.12.1/inst/Users/palmieri/Desktop/Sage_stuff/git/sage/local/bin
changing mode of /Users/palmieri/Desktop/Sage_stuff/git/sage/local/var/tmp/sage/build/numpy-1.12.1/inst/Users/palmieri/Desktop/Sage_stuff/git/sage/local/bin/f2py2 to 755
Traceback (most recent call last):
  File "<stdin>", line 3, in <module>
  File "/Users/palmieri/Desktop/Sage_stuff/git/sage/local/var/tmp/sage/build/numpy-1.12.1/inst/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/numpy/__init__.py", line 142, in <module>
    from . import add_newdocs
  File "/Users/palmieri/Desktop/Sage_stuff/git/sage/local/var/tmp/sage/build/numpy-1.12.1/inst/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/numpy/add_newdocs.py", line 13, in <module>
    from numpy.lib import add_newdoc
  File "/Users/palmieri/Desktop/Sage_stuff/git/sage/local/var/tmp/sage/build/numpy-1.12.1/inst/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/numpy/lib/__init__.py", line 8, in <module>
    from .type_check import *
  File "/Users/palmieri/Desktop/Sage_stuff/git/sage/local/var/tmp/sage/build/numpy-1.12.1/inst/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/numpy/lib/type_check.py", line 11, in <module>
    import numpy.core.numeric as _nx
  File "/Users/palmieri/Desktop/Sage_stuff/git/sage/local/var/tmp/sage/build/numpy-1.12.1/inst/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/numpy/core/__init__.py", line 24, in <module>
    raise ImportError(msg)
ImportError: 
Importing the multiarray numpy extension module failed.  Most
likely you are trying to import a failed build of numpy.
If you're working with a numpy git repo, try `git clean -xdf` (removes all
files not under version control).  Otherwise reinstall numpy.
```



---

archive/issue_comments_333405.json:
```json
{
    "body": "<div id=\"comment:56\" align=\"right\">comment:56</div>\n\nI don't get any of these problems.  I will probably need an OSX machine to investigate.\n\nIt could have something to do with the\n\n```\nLIBS=\"`pkg-config --libs-only-l cblas` -lm\"\n```\npassed to `configure` in gsl's spkg-install.  But that *shouldn't* be a problem.",
    "created_at": "2017-08-07T08:57:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333405",
    "user": "https://github.com/embray"
}
```

<div id="comment:56" align="right">comment:56</div>

I don't get any of these problems.  I will probably need an OSX machine to investigate.

It could have something to do with the

```
LIBS="`pkg-config --libs-only-l cblas` -lm"
```
passed to `configure` in gsl's spkg-install.  But that *shouldn't* be a problem.



---

archive/issue_comments_333406.json:
```json
{
    "body": "<div id=\"comment:57\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4360f314520c3394f788d64b3585f391b5c6b8c7\"><code>4360f31</code></a></td><td><code>Added the ability for packages to have a post-install script called spkg-postinst.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0972a41e1de2dfe3e9f1e74d5e46dff4df939d82\"><code>0972a41</code></a></td><td><code>Add special post-install handling for the backports/__init__.py shared</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/41c73a3b12f8096d8c734607a849d9549e029461\"><code>41c73a3</code></a></td><td><code>Remove some no-longer used local variables</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/750943a34b27fc9d134326bf85d9f0278718effe\"><code>750943a</code></a></td><td><code>Add handling for packages that install .info files and update share/info/dir</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/53a9c478704380f9cacb9e36c632b67bdee05e33\"><code>53a9c47</code></a></td><td><code>Rename $SAGE_INST_TEMP to $SAGE_DESTDIR</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/76157141ee63f260a097bc8a4fa46cf79f266322\"><code>7615714</code></a></td><td><code>Don't use the -u option to cp.  It's not portable to BSD's cp, and is</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d4bb6f7849adf520b557af4038e3c9b2d749e942\"><code>d4bb6f7</code></a></td><td><code>Just use 'cp -a' which seems to be compatible across most cp's.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ed8957174bfc4fd7d74a113bb38cf340c9f50714\"><code>ed89571</code></a></td><td><code>Fix Python build on non-Cygwin systems (namely OSX) with case-insensitive filesystems</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/44228b281303b311abb8026429a6c2327d5a9d8b\"><code>44228b2</code></a></td><td><code>On OSX DYLD_LIBRARY_PATH should be set a la LD_LIBRARY_PATH to run Python from its build directory</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ce38d0756f226ec9a87b55890e716edd80f0cbdc\"><code>ce38d07</code></a></td><td><code>Work around bug in OpenBLAS's Makefile with its use of DESTDIR with</code></td></tr></table>\n",
    "created_at": "2017-08-09T13:06:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333406",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:57"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4360f314520c3394f788d64b3585f391b5c6b8c7"><code>4360f31</code></a></td><td><code>Added the ability for packages to have a post-install script called spkg-postinst.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0972a41e1de2dfe3e9f1e74d5e46dff4df939d82"><code>0972a41</code></a></td><td><code>Add special post-install handling for the backports/__init__.py shared</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/41c73a3b12f8096d8c734607a849d9549e029461"><code>41c73a3</code></a></td><td><code>Remove some no-longer used local variables</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/750943a34b27fc9d134326bf85d9f0278718effe"><code>750943a</code></a></td><td><code>Add handling for packages that install .info files and update share/info/dir</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/53a9c478704380f9cacb9e36c632b67bdee05e33"><code>53a9c47</code></a></td><td><code>Rename $SAGE_INST_TEMP to $SAGE_DESTDIR</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/76157141ee63f260a097bc8a4fa46cf79f266322"><code>7615714</code></a></td><td><code>Don't use the -u option to cp.  It's not portable to BSD's cp, and is</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d4bb6f7849adf520b557af4038e3c9b2d749e942"><code>d4bb6f7</code></a></td><td><code>Just use 'cp -a' which seems to be compatible across most cp's.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ed8957174bfc4fd7d74a113bb38cf340c9f50714"><code>ed89571</code></a></td><td><code>Fix Python build on non-Cygwin systems (namely OSX) with case-insensitive filesystems</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/44228b281303b311abb8026429a6c2327d5a9d8b"><code>44228b2</code></a></td><td><code>On OSX DYLD_LIBRARY_PATH should be set a la LD_LIBRARY_PATH to run Python from its build directory</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ce38d0756f226ec9a87b55890e716edd80f0cbdc"><code>ce38d07</code></a></td><td><code>Work around bug in OpenBLAS's Makefile with its use of DESTDIR with</code></td></tr></table>




---

archive/issue_comments_333407.json:
```json
{
    "body": "Changed commit from **[`dbdb947`](https://github.com/sagemath/sagetrac-mirror/commit/dbdb94788f6275e19c5fd150bec8a889188f3164)** to **[`ce38d07`](https://github.com/sagemath/sagetrac-mirror/commit/ce38d0756f226ec9a87b55890e716edd80f0cbdc)**",
    "created_at": "2017-08-09T13:06:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333407",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`dbdb947`](https://github.com/sagemath/sagetrac-mirror/commit/dbdb94788f6275e19c5fd150bec8a889188f3164)** to **[`ce38d07`](https://github.com/sagemath/sagetrac-mirror/commit/ce38d0756f226ec9a87b55890e716edd80f0cbdc)**



---

archive/issue_comments_333408.json:
```json
{
    "body": "<div id=\"comment:58\" align=\"right\">comment:58</div>\n\nRebased on the latest (positively reviewed) #23160.\n\nI added the `DYLD_LIBRARY_PATH` fix needed for Python installation.\n\nAlso added an *untested* possible fix for the gsl installation issue.  I think the issue here was a bug in OpenBLAS's Makefile on OSX with how it uses `install_name_tool`, and this should fix it but I'm not positive.  Chances are this would also fix the problem with numpy which is probably trying to link (unsuccessfully) to openblas.",
    "created_at": "2017-08-09T13:11:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333408",
    "user": "https://github.com/embray"
}
```

<div id="comment:58" align="right">comment:58</div>

Rebased on the latest (positively reviewed) #23160.

I added the `DYLD_LIBRARY_PATH` fix needed for Python installation.

Also added an *untested* possible fix for the gsl installation issue.  I think the issue here was a bug in OpenBLAS's Makefile on OSX with how it uses `install_name_tool`, and this should fix it but I'm not positive.  Chances are this would also fix the problem with numpy which is probably trying to link (unsuccessfully) to openblas.



---

archive/issue_comments_333409.json:
```json
{
    "body": "<div id=\"comment:59\" align=\"right\">comment:59</div>\n\nThis works now, Sage builds and all tests pass.",
    "created_at": "2017-08-09T17:30:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333409",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:59" align="right">comment:59</div>

This works now, Sage builds and all tests pass.



---

archive/issue_comments_333410.json:
```json
{
    "body": "<div id=\"comment:60\" align=\"right\">comment:60</div>\n\nSeveral packages fail their test suites. flint:\n\n```\ngcc -fno-common -ansi -pedantic -Wall -O2 -funroll-loops -g -mpopcnt    -c -o test_helpers.o test_helpers.c\nmake  build/test/t-add_ssaaaa  build/test/t-add_sssaaaaaa  build/test/t-count_leading_zeros  build/test/t-count_trailing_zeros  build/test/t-sdiv_qrnnd  build/test/t-smul_ppmm  build/test/t-sub_ddmmss  build/test/t-udiv_qrnnd  build/test/t-udiv_qrnnd_preinv  build/test/t-umul_ppmm\nmkdir -p build/test\ngcc -fno-common -ansi -pedantic -Wall -O2 -funroll-loops -g -mpopcnt  -I/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta1/local/var/tmp/sage/build/flint-2.5.2.p1/src -I/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta1/local/include -I/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta1/local/include -I/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta1/local/include -L/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta1/local/lib -Wl,-rpath,/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta1/local/lib  test/t-add_ssaaaa.c -o build/test/t-add_ssaaaa -L/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta1/local/var/tmp/sage/build/flint-2.5.2.p1/src -L/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta1/local/lib -L/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta1/local/lib -L/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta1/local/lib -lflint -lmpfr -lgmp -lm -lntl -lpthread \n\n[snip]\n\ngcc -fno-common -ansi -pedantic -Wall -O2 -funroll-loops -g -mpopcnt  -I/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta1/local/var/tmp/sage/build/flint-2.5.2.p1/src -I/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta1/local/include -I/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta1/local/include -I/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta1/local/include -L/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta1/local/lib -Wl,-rpath,/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta1/local/lib  test/t-udiv_qrnnd_preinv.c -o build/test/t-udiv_qrnnd_preinv -L/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta1/local/var/tmp/sage/build/flint-2.5.2.p1/src -L/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta1/local/lib -L/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta1/local/lib -L/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta1/local/lib -lflint -lmpfr -lgmp -lm -lntl -lpthread \ngcc -fno-common -ansi -pedantic -Wall -O2 -funroll-loops -g -mpopcnt  -I/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta1/local/var/tmp/sage/build/flint-2.5.2.p1/src -I/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta1/local/include -I/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta1/local/include -I/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta1/local/include -L/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta1/local/lib -Wl,-rpath,/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta1/local/lib  test/t-umul_ppmm.c -o build/test/t-umul_ppmm -L/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta1/local/var/tmp/sage/build/flint-2.5.2.p1/src -L/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta1/local/lib -L/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta1/local/lib -L/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta1/local/lib -lflint -lmpfr -lgmp -lm -lntl -lpthread \n(BUILD_DIR=build; export BUILD_DIR; make -f Makefile.subdirs -C . check || exit$?;)\ndyld: Library not loaded: /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta1/local/lib/libflint-13.5.2.dylib\n  Referenced from: /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta1/local/var/tmp/sage/build/flint-2.5.2.p1/src/build/test/t-add_ssaaaa\n  Reason: image not found\nmake[4]: *** [build/test/t-add_ssaaaa_RUN] Abort trap: 6\n/bin/sh: exit2: command not found\nmake[3]: *** [check] Error 127\nError: FLINT failed to pass its test suite.\n```\narb:\n\n```\nRunning the test suite for arb-2.8.1.p1...\nmake[4]: Nothing to be done for `shared'.\nmake[5]: Nothing to be done for `shared'.\n    CC   ../build/fmpr/test/t-abs_bound_le_2exp_fmpz\n    CC   ../build/fmpr/test/t-abs_bound_lt_2exp_fmpz\n    CC   ../build/fmpr/test/t-abs_bound_lt_2exp_si\n    CC   ../build/fmpr/test/t-add\n    CC   ../build/fmpr/test/t-add_naive\n    CC   ../build/fmpr/test/t-cmp\n    CC   ../build/fmpr/test/t-cmp_2exp_si\n    CC   ../build/fmpr/test/t-cmpabs\n    CC   ../build/fmpr/test/t-cmpabs_2exp_si\n    CC   ../build/fmpr/test/t-div\n    CC   ../build/fmpr/test/t-divappr_abs_ubound\n    CC   ../build/fmpr/test/t-exp\n    CC   ../build/fmpr/test/t-expm1\n    CC   ../build/fmpr/test/t-get_d\n    CC   ../build/fmpr/test/t-get_fmpz\n    CC   ../build/fmpr/test/t-get_mpfr\n    CC   ../build/fmpr/test/t-log\n    CC   ../build/fmpr/test/t-log1p\n    CC   ../build/fmpr/test/t-mul\n    CC   ../build/fmpr/test/t-mul_fmpz\n    CC   ../build/fmpr/test/t-mul_naive\n    CC   ../build/fmpr/test/t-mul_si\n    CC   ../build/fmpr/test/t-mul_ui\n    CC   ../build/fmpr/test/t-normalise\n    CC   ../build/fmpr/test/t-root\n    CC   ../build/fmpr/test/t-rsqrt\n    CC   ../build/fmpr/test/t-set_fmpq\n    CC   ../build/fmpr/test/t-set_fmpz_2exp\n    CC   ../build/fmpr/test/t-set_round_mpn\n    CC   ../build/fmpr/test/t-set_round_ui_2exp_fmpz\n    CC   ../build/fmpr/test/t-set_round_uiui_2exp_fmpz\n    CC   ../build/fmpr/test/t-sqrt\n    CC   ../build/fmpr/test/t-sub\n    CC   ../build/fmpr/test/t-sum\n    CC   ../build/fmpr/test/t-ulp\ndyld: Library not loaded: /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta1/local/lib/libarb-1.1.1.dylib\n  Referenced from: /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta1/local/var/tmp/sage/build/arb-2.8.1.p1/src/fmpr/../build/fmpr/test/t-abs_bound_le_2exp_fmpz\n  Reason: image not found\nmake[4]: *** [../build/fmpr/test/t-abs_bound_le_2exp_fmpz_RUN] Abort trap: 6\nmake[3]: *** [check] Error 2\n```\nR:\n\n```\nRunning the test suite for r-3.4.0.p0...\n../../bin/R: line 246: /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta1/local/lib/R//etc/ldpaths: No such file or directory\nmake[6]: *** [test-Examples-Base] Error 1\nmake[5]: *** [test-Examples] Error 2\nmake[4]: *** [test-all-basics] Error 1\nmake[3]: *** [check] Error 2\nError while running the R testsuite ... exiting\n```\nSingular:\n\n```\nRunning the test suite for singular-4.1.0p3.p0...\n./spkg-check: line 33: Singular: command not found\nError loading the freegb library in Singular.\n```\npycrypto:\n\n```\nRunning the test suite for pycrypto-2.6.1.p2...\nPyCrypto will now be tested\nrunning test\nTraceback (most recent call last):\n  File \"setup.py\", line 456, in <module>\n    core.setup(**kw)\n  File \"/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta1/local/lib/python2.7/distutils/core.py\", line 151, in setup\n    dist.run_commands()\n  File \"/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta1/local/lib/python2.7/distutils/dist.py\", line 953, in run_commands\n    self.run_command(cmd)\n  File \"/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta1/local/lib/python2.7/distutils/dist.py\", line 972, in run_command\n    cmd_obj.run()\n  File \"setup.py\", line 321, in run\n    from Crypto import SelfTest\nImportError: No module named Crypto\nError: PyCrypto failed to pass its test suite.\n```\ncvxopt:\n\n```\nRunning the test suite for cvxopt-1.1.8.p2...\nTesting in /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta1/local/var/tmp/sage/build/cvxopt-1.1.8.p2/src/examples/doc/chap10\nTesting l1svc.py ...\nTraceback (most recent call last):\n  File \"l1svc.py\", line 3, in <module>\n    from cvxopt import normal, setseed\nImportError: No module named cvxopt\nError: test /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta1/local/var/tmp/sage/build/cvxopt-1.1.8.p2/src/examples/doc/chap10/l1svc.py failed\n```",
    "created_at": "2017-08-09T21:33:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333410",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:60" align="right">comment:60</div>

Several packages fail their test suites. flint:

```
gcc -fno-common -ansi -pedantic -Wall -O2 -funroll-loops -g -mpopcnt    -c -o test_helpers.o test_helpers.c
make  build/test/t-add_ssaaaa  build/test/t-add_sssaaaaaa  build/test/t-count_leading_zeros  build/test/t-count_trailing_zeros  build/test/t-sdiv_qrnnd  build/test/t-smul_ppmm  build/test/t-sub_ddmmss  build/test/t-udiv_qrnnd  build/test/t-udiv_qrnnd_preinv  build/test/t-umul_ppmm
mkdir -p build/test
gcc -fno-common -ansi -pedantic -Wall -O2 -funroll-loops -g -mpopcnt  -I/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta1/local/var/tmp/sage/build/flint-2.5.2.p1/src -I/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta1/local/include -I/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta1/local/include -I/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta1/local/include -L/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta1/local/lib -Wl,-rpath,/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta1/local/lib  test/t-add_ssaaaa.c -o build/test/t-add_ssaaaa -L/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta1/local/var/tmp/sage/build/flint-2.5.2.p1/src -L/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta1/local/lib -L/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta1/local/lib -L/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta1/local/lib -lflint -lmpfr -lgmp -lm -lntl -lpthread 

[snip]

gcc -fno-common -ansi -pedantic -Wall -O2 -funroll-loops -g -mpopcnt  -I/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta1/local/var/tmp/sage/build/flint-2.5.2.p1/src -I/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta1/local/include -I/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta1/local/include -I/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta1/local/include -L/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta1/local/lib -Wl,-rpath,/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta1/local/lib  test/t-udiv_qrnnd_preinv.c -o build/test/t-udiv_qrnnd_preinv -L/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta1/local/var/tmp/sage/build/flint-2.5.2.p1/src -L/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta1/local/lib -L/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta1/local/lib -L/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta1/local/lib -lflint -lmpfr -lgmp -lm -lntl -lpthread 
gcc -fno-common -ansi -pedantic -Wall -O2 -funroll-loops -g -mpopcnt  -I/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta1/local/var/tmp/sage/build/flint-2.5.2.p1/src -I/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta1/local/include -I/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta1/local/include -I/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta1/local/include -L/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta1/local/lib -Wl,-rpath,/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta1/local/lib  test/t-umul_ppmm.c -o build/test/t-umul_ppmm -L/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta1/local/var/tmp/sage/build/flint-2.5.2.p1/src -L/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta1/local/lib -L/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta1/local/lib -L/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta1/local/lib -lflint -lmpfr -lgmp -lm -lntl -lpthread 
(BUILD_DIR=build; export BUILD_DIR; make -f Makefile.subdirs -C . check || exit$?;)
dyld: Library not loaded: /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta1/local/lib/libflint-13.5.2.dylib
  Referenced from: /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta1/local/var/tmp/sage/build/flint-2.5.2.p1/src/build/test/t-add_ssaaaa
  Reason: image not found
make[4]: *** [build/test/t-add_ssaaaa_RUN] Abort trap: 6
/bin/sh: exit2: command not found
make[3]: *** [check] Error 127
Error: FLINT failed to pass its test suite.
```
arb:

```
Running the test suite for arb-2.8.1.p1...
make[4]: Nothing to be done for `shared'.
make[5]: Nothing to be done for `shared'.
    CC   ../build/fmpr/test/t-abs_bound_le_2exp_fmpz
    CC   ../build/fmpr/test/t-abs_bound_lt_2exp_fmpz
    CC   ../build/fmpr/test/t-abs_bound_lt_2exp_si
    CC   ../build/fmpr/test/t-add
    CC   ../build/fmpr/test/t-add_naive
    CC   ../build/fmpr/test/t-cmp
    CC   ../build/fmpr/test/t-cmp_2exp_si
    CC   ../build/fmpr/test/t-cmpabs
    CC   ../build/fmpr/test/t-cmpabs_2exp_si
    CC   ../build/fmpr/test/t-div
    CC   ../build/fmpr/test/t-divappr_abs_ubound
    CC   ../build/fmpr/test/t-exp
    CC   ../build/fmpr/test/t-expm1
    CC   ../build/fmpr/test/t-get_d
    CC   ../build/fmpr/test/t-get_fmpz
    CC   ../build/fmpr/test/t-get_mpfr
    CC   ../build/fmpr/test/t-log
    CC   ../build/fmpr/test/t-log1p
    CC   ../build/fmpr/test/t-mul
    CC   ../build/fmpr/test/t-mul_fmpz
    CC   ../build/fmpr/test/t-mul_naive
    CC   ../build/fmpr/test/t-mul_si
    CC   ../build/fmpr/test/t-mul_ui
    CC   ../build/fmpr/test/t-normalise
    CC   ../build/fmpr/test/t-root
    CC   ../build/fmpr/test/t-rsqrt
    CC   ../build/fmpr/test/t-set_fmpq
    CC   ../build/fmpr/test/t-set_fmpz_2exp
    CC   ../build/fmpr/test/t-set_round_mpn
    CC   ../build/fmpr/test/t-set_round_ui_2exp_fmpz
    CC   ../build/fmpr/test/t-set_round_uiui_2exp_fmpz
    CC   ../build/fmpr/test/t-sqrt
    CC   ../build/fmpr/test/t-sub
    CC   ../build/fmpr/test/t-sum
    CC   ../build/fmpr/test/t-ulp
dyld: Library not loaded: /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta1/local/lib/libarb-1.1.1.dylib
  Referenced from: /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta1/local/var/tmp/sage/build/arb-2.8.1.p1/src/fmpr/../build/fmpr/test/t-abs_bound_le_2exp_fmpz
  Reason: image not found
make[4]: *** [../build/fmpr/test/t-abs_bound_le_2exp_fmpz_RUN] Abort trap: 6
make[3]: *** [check] Error 2
```
R:

```
Running the test suite for r-3.4.0.p0...
../../bin/R: line 246: /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta1/local/lib/R//etc/ldpaths: No such file or directory
make[6]: *** [test-Examples-Base] Error 1
make[5]: *** [test-Examples] Error 2
make[4]: *** [test-all-basics] Error 1
make[3]: *** [check] Error 2
Error while running the R testsuite ... exiting
```
Singular:

```
Running the test suite for singular-4.1.0p3.p0...
./spkg-check: line 33: Singular: command not found
Error loading the freegb library in Singular.
```
pycrypto:

```
Running the test suite for pycrypto-2.6.1.p2...
PyCrypto will now be tested
running test
Traceback (most recent call last):
  File "setup.py", line 456, in <module>
    core.setup(**kw)
  File "/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta1/local/lib/python2.7/distutils/core.py", line 151, in setup
    dist.run_commands()
  File "/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta1/local/lib/python2.7/distutils/dist.py", line 953, in run_commands
    self.run_command(cmd)
  File "/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta1/local/lib/python2.7/distutils/dist.py", line 972, in run_command
    cmd_obj.run()
  File "setup.py", line 321, in run
    from Crypto import SelfTest
ImportError: No module named Crypto
Error: PyCrypto failed to pass its test suite.
```
cvxopt:

```
Running the test suite for cvxopt-1.1.8.p2...
Testing in /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta1/local/var/tmp/sage/build/cvxopt-1.1.8.p2/src/examples/doc/chap10
Testing l1svc.py ...
Traceback (most recent call last):
  File "l1svc.py", line 3, in <module>
    from cvxopt import normal, setseed
ImportError: No module named cvxopt
Error: test /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-8.1.beta1/local/var/tmp/sage/build/cvxopt-1.1.8.p2/src/examples/doc/chap10/l1svc.py failed
```



---

archive/issue_comments_333411.json:
```json
{
    "body": "<div id=\"comment:61\" align=\"right\">comment:61</div>\n\nHow are you running these?  I don't know why it would work any differently.",
    "created_at": "2017-08-10T18:21:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333411",
    "user": "https://github.com/embray"
}
```

<div id="comment:61" align="right">comment:61</div>

How are you running these?  I don't know why it would work any differently.



---

archive/issue_comments_333412.json:
```json
{
    "body": "<div id=\"comment:62\" align=\"right\">comment:62</div>\n\nI get failures from `make distclean; export SAGE_CHECK=yes; make`. I get some (but not all) of these failures from  `./sage -f -c PKG_NAME`; this is after unsetting `SAGE_CHECK` and running `make`. But once the package has been installed successfully, then `./sage -f -c PKG_NAME` may behave differently, because it may be using installed versions of libraries, binaries, etc.; if it hasn't been installed, it won't be installed until `spkg-check` finishes successfully.",
    "created_at": "2017-08-10T19:02:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333412",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:62" align="right">comment:62</div>

I get failures from `make distclean; export SAGE_CHECK=yes; make`. I get some (but not all) of these failures from  `./sage -f -c PKG_NAME`; this is after unsetting `SAGE_CHECK` and running `make`. But once the package has been installed successfully, then `./sage -f -c PKG_NAME` may behave differently, because it may be using installed versions of libraries, binaries, etc.; if it hasn't been installed, it won't be installed until `spkg-check` finishes successfully.



---

archive/issue_comments_333413.json:
```json
{
    "body": "<div id=\"comment:63\" align=\"right\">comment:63</div>\n\nIn `build/pkgs/widgetsnbextension/spkg-install` you write\n\n```\n# Note: Setting PYTHONPATH here is something of a hack to support\n# installation into $SAGE_DESTDIR.  This might be better handled\n# as a post-install step\nSITE_PACKAGES=\"$(sage-python23 -c 'import site; print(site.getsitepackages()[0])')\"\nPYTHONPATH=\"$SAGE_DESTDIR$SITE_PACKAGES\" jupyter nbextension enable --sys-prefix --py widgetsnbextension\n```\nI agree that this looks more like a post-install step, so why didn't you implement it that way?",
    "created_at": "2017-08-11T11:35:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333413",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:63" align="right">comment:63</div>

In `build/pkgs/widgetsnbextension/spkg-install` you write

```
# Note: Setting PYTHONPATH here is something of a hack to support
# installation into $SAGE_DESTDIR.  This might be better handled
# as a post-install step
SITE_PACKAGES="$(sage-python23 -c 'import site; print(site.getsitepackages()[0])')"
PYTHONPATH="$SAGE_DESTDIR$SITE_PACKAGES" jupyter nbextension enable --sys-prefix --py widgetsnbextension
```
I agree that this looks more like a post-install step, so why didn't you implement it that way?



---

archive/issue_comments_333414.json:
```json
{
    "body": "<div id=\"comment:64\" align=\"right\">comment:64</div>\n\nI am a bit lost where the `DESTDIR` stuff for autoconf packages is actually implemented. For Python packages, I see that you added the `--root` option to `PIP_INSTALL`.",
    "created_at": "2017-08-11T12:00:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333414",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:64" align="right">comment:64</div>

I am a bit lost where the `DESTDIR` stuff for autoconf packages is actually implemented. For Python packages, I see that you added the `--root` option to `PIP_INSTALL`.



---

archive/issue_comments_333415.json:
```json
{
    "body": "<div id=\"comment:65\" align=\"right\">comment:65</div>\n\nReplying to [@embray](#comment:33):\n> This ticket otherwise fixes all examples among standard (and some optional packages) where files were overwriting each other.\n\nWhat is the relevance of that for this ticket?\n\nAll those packages worked before. If such clobbering is no longer allowed, I consider that a regression introduced by this ticket.",
    "created_at": "2017-08-11T12:03:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333415",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:65" align="right">comment:65</div>

Replying to [@embray](#comment:33):
> This ticket otherwise fixes all examples among standard (and some optional packages) where files were overwriting each other.

What is the relevance of that for this ticket?

All those packages worked before. If such clobbering is no longer allowed, I consider that a regression introduced by this ticket.



---

archive/issue_comments_333416.json:
```json
{
    "body": "<div id=\"comment:66\" align=\"right\">comment:66</div>\n\nReplying to [@jdemeyer](#comment:63):\n> I agree that this looks more like a post-install step, so why didn't you implement it that way?\n\nWhen I first wrote that, support for post-install scripts wasn't added yet.  Now that it's there, I could probably revisit things like that.  Though I'd have to review what exactly `jupyter nbextension enable` does.  If it just writes some files then this might be fine.",
    "created_at": "2017-08-11T12:29:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333416",
    "user": "https://github.com/embray"
}
```

<div id="comment:66" align="right">comment:66</div>

Replying to [@jdemeyer](#comment:63):
> I agree that this looks more like a post-install step, so why didn't you implement it that way?

When I first wrote that, support for post-install scripts wasn't added yet.  Now that it's there, I could probably revisit things like that.  Though I'd have to review what exactly `jupyter nbextension enable` does.  If it just writes some files then this might be fine.



---

archive/issue_comments_333417.json:
```json
{
    "body": "<div id=\"comment:67\" align=\"right\">comment:67</div>\n\nReplying to [@jhpalmieri](#comment:62):\n> I get failures from `make distclean; export SAGE_CHECK=yes; make`. I get some (but not all) of these failures from  `./sage -f -c PKG_NAME`; this is after unsetting `SAGE_CHECK` and running `make`. But once the package has been installed successfully, then `./sage -f -c PKG_NAME` may behave differently, because it may be using installed versions of libraries, binaries, etc.; if it hasn't been installed, it won't be installed until `spkg-check` finishes successfully.\n\nI'm having trouble building python3 with `SAGE_CHECK=yes`.  Did that ever work in the first place?",
    "created_at": "2017-08-11T12:42:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333417",
    "user": "https://github.com/embray"
}
```

<div id="comment:67" align="right">comment:67</div>

Replying to [@jhpalmieri](#comment:62):
> I get failures from `make distclean; export SAGE_CHECK=yes; make`. I get some (but not all) of these failures from  `./sage -f -c PKG_NAME`; this is after unsetting `SAGE_CHECK` and running `make`. But once the package has been installed successfully, then `./sage -f -c PKG_NAME` may behave differently, because it may be using installed versions of libraries, binaries, etc.; if it hasn't been installed, it won't be installed until `spkg-check` finishes successfully.

I'm having trouble building python3 with `SAGE_CHECK=yes`.  Did that ever work in the first place?



---

archive/issue_comments_333418.json:
```json
{
    "body": "<div id=\"comment:68\" align=\"right\">comment:68</div>\n\nIn my experience, neither `python2` nor `python3` passed their self tests. With `python2` at least, this was true on a range of platforms. We should probably change the default value of `SAGE_CHECK_PACKAGES` to exclude `python3`; it already excludes `python2`.\n\nEdit: I created #23612.",
    "created_at": "2017-08-11T15:00:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333418",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:68" align="right">comment:68</div>

In my experience, neither `python2` nor `python3` passed their self tests. With `python2` at least, this was true on a range of platforms. We should probably change the default value of `SAGE_CHECK_PACKAGES` to exclude `python3`; it already excludes `python2`.

Edit: I created #23612.



---

archive/issue_comments_333419.json:
```json
{
    "body": "<div id=\"comment:69\" align=\"right\">comment:69</div>\n\nOn the topic of the other SAGE_CHECK failures, the problem is probably similar to the problems I was having with Python: The checks are being performed before the files are installed from `SAGE_DESTDIR` into `SAGE_LOCAL`, so at the very least it might be necessary to set `LD_LIBRARY_PATH/DYLIB_LIBRARY_PATH`, but possibly other paths as well?\n\nRather than trying to fix every `spkg-check`, which may be difficult especially if I can't reproduce all the problems, it might be better for the sake of this ticket if I moved execution of `spkg-check` until after installation to `SAGE_LOCAL`.  This has the downside that the package still gets installed even if the check failed, but that's the existing situation anyways.  Once #22510 is done (which depends on this) it will be easier to do things like make a backup of an old package--try installing the new one--and revert to the old one if the installation failed.",
    "created_at": "2017-08-21T15:14:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333419",
    "user": "https://github.com/embray"
}
```

<div id="comment:69" align="right">comment:69</div>

On the topic of the other SAGE_CHECK failures, the problem is probably similar to the problems I was having with Python: The checks are being performed before the files are installed from `SAGE_DESTDIR` into `SAGE_LOCAL`, so at the very least it might be necessary to set `LD_LIBRARY_PATH/DYLIB_LIBRARY_PATH`, but possibly other paths as well?

Rather than trying to fix every `spkg-check`, which may be difficult especially if I can't reproduce all the problems, it might be better for the sake of this ticket if I moved execution of `spkg-check` until after installation to `SAGE_LOCAL`.  This has the downside that the package still gets installed even if the check failed, but that's the existing situation anyways.  Once #22510 is done (which depends on this) it will be easier to do things like make a backup of an old package--try installing the new one--and revert to the old one if the installation failed.



---

archive/issue_comments_333420.json:
```json
{
    "body": "<div id=\"comment:70\" align=\"right\">comment:70</div>\n\nReplying to [@jdemeyer](#comment:64):\n> I am a bit lost where the `DESTDIR` stuff for autoconf packages is actually implemented. For Python packages, I see that you added the `--root` option to `PIP_INSTALL`.\n\nJust realized I never replied to this.  `DESTDIR=` is added in the helper function `sdh_make_install` (which is partly why I wanted that feature implemented for this ticket).  Note that it assumes `SAGE_DESTDIR` is set, which it may not be if the `spkg-install` is not being run from `sage-spkg`.  It might be worth noting that this is intentional--if `SAGE_DESTDIR` is left blank then direct installation to `SAGE_LOCAL` proceeds as normal, which is important and useful for testing, if nothing else. \n\nOtherwise, `SAGE_DESTDIR` is set in `sage-spkg`, and gets passed to `make install`, in most cases, by way of `sdh_make_install`.",
    "created_at": "2017-08-21T15:19:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333420",
    "user": "https://github.com/embray"
}
```

<div id="comment:70" align="right">comment:70</div>

Replying to [@jdemeyer](#comment:64):
> I am a bit lost where the `DESTDIR` stuff for autoconf packages is actually implemented. For Python packages, I see that you added the `--root` option to `PIP_INSTALL`.

Just realized I never replied to this.  `DESTDIR=` is added in the helper function `sdh_make_install` (which is partly why I wanted that feature implemented for this ticket).  Note that it assumes `SAGE_DESTDIR` is set, which it may not be if the `spkg-install` is not being run from `sage-spkg`.  It might be worth noting that this is intentional--if `SAGE_DESTDIR` is left blank then direct installation to `SAGE_LOCAL` proceeds as normal, which is important and useful for testing, if nothing else. 

Otherwise, `SAGE_DESTDIR` is set in `sage-spkg`, and gets passed to `make install`, in most cases, by way of `sdh_make_install`.



---

archive/issue_comments_333421.json:
```json
{
    "body": "<div id=\"comment:71\" align=\"right\">comment:71</div>\n\nFor some reason on Linux I couldn't reproduce the problems running the tests for flint or arb (despite running `make distclean` first).  But I did get the same problems for the other packages.  As I wrote [here](https://github.com/sagemath/sage/issues/22509#comment:69) it seems to be mostly a matter of setting the required environment variables.  But I think I'll still revert to the old behavior for SAGE_CHECK for now, just to keep this simpler.",
    "created_at": "2017-08-21T17:26:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333421",
    "user": "https://github.com/embray"
}
```

<div id="comment:71" align="right">comment:71</div>

For some reason on Linux I couldn't reproduce the problems running the tests for flint or arb (despite running `make distclean` first).  But I did get the same problems for the other packages.  As I wrote [here](https://github.com/sagemath/sage/issues/22509#comment:69) it seems to be mostly a matter of setting the required environment variables.  But I think I'll still revert to the old behavior for SAGE_CHECK for now, just to keep this simpler.



---

archive/issue_comments_333422.json:
```json
{
    "body": "Changed commit from **[`ce38d07`](https://github.com/sagemath/sagetrac-mirror/commit/ce38d0756f226ec9a87b55890e716edd80f0cbdc)** to **[`7001343`](https://github.com/sagemath/sagetrac-mirror/commit/70013431e8c8a4ac4f49191378aea54e006b1a4b)**",
    "created_at": "2017-09-04T08:37:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333422",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`ce38d07`](https://github.com/sagemath/sagetrac-mirror/commit/ce38d0756f226ec9a87b55890e716edd80f0cbdc)** to **[`7001343`](https://github.com/sagemath/sagetrac-mirror/commit/70013431e8c8a4ac4f49191378aea54e006b1a4b)**



---

archive/issue_comments_333423.json:
```json
{
    "body": "<div id=\"comment:72\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ed2446b0cec371fd5fa83389f50e6b719b849467\"><code>ed2446b</code></a></td><td><code>Move spkg-check to after the package has been installed to SAGE_LOCAL.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/70013431e8c8a4ac4f49191378aea54e006b1a4b\"><code>7001343</code></a></td><td><code>Enable widgetsnbextension in the notebook's config file as a postinst step.</code></td></tr></table>\n",
    "created_at": "2017-09-04T08:37:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333423",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:72"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ed2446b0cec371fd5fa83389f50e6b719b849467"><code>ed2446b</code></a></td><td><code>Move spkg-check to after the package has been installed to SAGE_LOCAL.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/70013431e8c8a4ac4f49191378aea54e006b1a4b"><code>7001343</code></a></td><td><code>Enable widgetsnbextension in the notebook's config file as a postinst step.</code></td></tr></table>




---

archive/issue_comments_333424.json:
```json
{
    "body": "<div id=\"comment:73\" align=\"right\">comment:73</div>\n\nJust remembered there was still unfinished work on this that I hadn't pushed yet.  I think now it's addressed all the issues that have been raised so far.",
    "created_at": "2017-09-04T08:38:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333424",
    "user": "https://github.com/embray"
}
```

<div id="comment:73" align="right">comment:73</div>

Just remembered there was still unfinished work on this that I hadn't pushed yet.  I think now it's addressed all the issues that have been raised so far.



---

archive/issue_comments_333425.json:
```json
{
    "body": "<div id=\"comment:74\" align=\"right\">comment:74</div>\n\nOne concern with this patch is that it's really a patch bomb, which might be hard to get reviewed and merged.\n\nI don't think you have answered [comment:65]",
    "created_at": "2017-09-04T09:31:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333425",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:74" align="right">comment:74</div>

One concern with this patch is that it's really a patch bomb, which might be hard to get reviewed and merged.

I don't think you have answered [comment:65]



---

archive/issue_comments_333426.json:
```json
{
    "body": "<div id=\"comment:75\" align=\"right\">comment:75</div>\n\nI thought I addressed this somewhere but maybe not...\n\nReplying to [@jdemeyer](#comment:65):\n> Replying to [@embray](#comment:33):\n> > This ticket otherwise fixes all examples among standard (and some optional packages) where files were overwriting each other.\n\n> \n> What is the relevance of that for this ticket?\n> \n> All those packages worked before. If such clobbering is no longer allowed, I consider that a regression introduced by this ticket.\n\nI wouldn't consider it a regression at all.  The fact that some packages overwrote files installed by other packages is a bug, just one that hasn't had very serious effects.  Most cases of this were very minor (e.g. python3 overwrote the valgrind.supp installed by python2).\n\nThe goal of this ticket is, along with #22510 (where this becomes important) is to make sagedist work a little more like a real OS packaging system in that files are belonged by packages, with any one file belonging to just one package.  That way, uninstalling one package does not break another package that owns some of the same file(s).\n\nIn theory one *could* design a packaging system where a file can belong to multiple packages, and only be removed once all packages that use it are removed.  But this is more complicated, and only works if that file is identical for all packages that use it (it may not be).\n\nThere is one particular example of a file shared between packages where this ticket *would* introduce a regression if it didn't carefully handle this case: There's a file `info/share/dir` that is updated by any package that installs an `info` manual.  The new way packages are installed by ticket is such that each package will write a fresh `info/share/dir`, and then overwrite the existing one, rather than updating the existing one.  This makes sure to always update `info/share/dir` in a post-install script for those packages. \n\nOther than that, the other cases are mostly trivial.",
    "created_at": "2017-09-04T10:28:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333426",
    "user": "https://github.com/embray"
}
```

<div id="comment:75" align="right">comment:75</div>

I thought I addressed this somewhere but maybe not...

Replying to [@jdemeyer](#comment:65):
> Replying to [@embray](#comment:33):
> > This ticket otherwise fixes all examples among standard (and some optional packages) where files were overwriting each other.

> 
> What is the relevance of that for this ticket?
> 
> All those packages worked before. If such clobbering is no longer allowed, I consider that a regression introduced by this ticket.

I wouldn't consider it a regression at all.  The fact that some packages overwrote files installed by other packages is a bug, just one that hasn't had very serious effects.  Most cases of this were very minor (e.g. python3 overwrote the valgrind.supp installed by python2).

The goal of this ticket is, along with #22510 (where this becomes important) is to make sagedist work a little more like a real OS packaging system in that files are belonged by packages, with any one file belonging to just one package.  That way, uninstalling one package does not break another package that owns some of the same file(s).

In theory one *could* design a packaging system where a file can belong to multiple packages, and only be removed once all packages that use it are removed.  But this is more complicated, and only works if that file is identical for all packages that use it (it may not be).

There is one particular example of a file shared between packages where this ticket *would* introduce a regression if it didn't carefully handle this case: There's a file `info/share/dir` that is updated by any package that installs an `info` manual.  The new way packages are installed by ticket is such that each package will write a fresh `info/share/dir`, and then overwrite the existing one, rather than updating the existing one.  This makes sure to always update `info/share/dir` in a post-install script for those packages. 

Other than that, the other cases are mostly trivial.



---

archive/issue_comments_333427.json:
```json
{
    "body": "<div id=\"comment:76\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/02750584ab2382f1b986e674adc7a98c0ed279bb\"><code>0275058</code></a></td><td><code>On OSX DYLD_LIBRARY_PATH should be set a la LD_LIBRARY_PATH to run Python from its build directory</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8e193dba196ccdfe5f5bc37c462a5fa02ac7e910\"><code>8e193db</code></a></td><td><code>Move spkg-check to after the package has been installed to SAGE_LOCAL.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/53e3dc54db7658c6eceb50d573eeb324d886a532\"><code>53e3dc5</code></a></td><td><code>Enable widgetsnbextension in the notebook's config file as a postinst step.</code></td></tr></table>\n",
    "created_at": "2017-09-04T10:34:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333427",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:76"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/02750584ab2382f1b986e674adc7a98c0ed279bb"><code>0275058</code></a></td><td><code>On OSX DYLD_LIBRARY_PATH should be set a la LD_LIBRARY_PATH to run Python from its build directory</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8e193dba196ccdfe5f5bc37c462a5fa02ac7e910"><code>8e193db</code></a></td><td><code>Move spkg-check to after the package has been installed to SAGE_LOCAL.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/53e3dc54db7658c6eceb50d573eeb324d886a532"><code>53e3dc5</code></a></td><td><code>Enable widgetsnbextension in the notebook's config file as a postinst step.</code></td></tr></table>




---

archive/issue_comments_333428.json:
```json
{
    "body": "Changed commit from **[`7001343`](https://github.com/sagemath/sagetrac-mirror/commit/70013431e8c8a4ac4f49191378aea54e006b1a4b)** to **[`53e3dc5`](https://github.com/sagemath/sagetrac-mirror/commit/53e3dc54db7658c6eceb50d573eeb324d886a532)**",
    "created_at": "2017-09-04T10:34:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333428",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`7001343`](https://github.com/sagemath/sagetrac-mirror/commit/70013431e8c8a4ac4f49191378aea54e006b1a4b)** to **[`53e3dc5`](https://github.com/sagemath/sagetrac-mirror/commit/53e3dc54db7658c6eceb50d573eeb324d886a532)**



---

archive/issue_comments_333429.json:
```json
{
    "body": "<div id=\"comment:77\" align=\"right\">comment:77</div>\n\nHad to rebase after I realized I pop'd the completely wrong stash entry into an earlier commit.",
    "created_at": "2017-09-04T10:35:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333429",
    "user": "https://github.com/embray"
}
```

<div id="comment:77" align="right">comment:77</div>

Had to rebase after I realized I pop'd the completely wrong stash entry into an earlier commit.



---

archive/issue_comments_333430.json:
```json
{
    "body": "<div id=\"comment:78\" align=\"right\">comment:78</div>\n\nReplying to [@jdemeyer](#comment:74):\n> One concern with this patch is that it's really a patch bomb, which might be hard to get reviewed and merged.\n\nTrue, but there's not much other way to handle it (I don't mind separating some changes out to separate tickets but some of them go hand-in-hand with this). John did test this extensively in OSX and got it working.  The only remaining concern was that some `spkg-check` tests weren't working.  I believe I've addressed that now, though it's hard to be 100% sure since some of those tests aren't working for me with or without this patch.\n\n> I don't think you have answered [comment:65]\n\nDone.",
    "created_at": "2017-09-04T10:37:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333430",
    "user": "https://github.com/embray"
}
```

<div id="comment:78" align="right">comment:78</div>

Replying to [@jdemeyer](#comment:74):
> One concern with this patch is that it's really a patch bomb, which might be hard to get reviewed and merged.

True, but there's not much other way to handle it (I don't mind separating some changes out to separate tickets but some of them go hand-in-hand with this). John did test this extensively in OSX and got it working.  The only remaining concern was that some `spkg-check` tests weren't working.  I believe I've addressed that now, though it's hard to be 100% sure since some of those tests aren't working for me with or without this patch.

> I don't think you have answered [comment:65]

Done.



---

archive/issue_comments_333431.json:
```json
{
    "body": "<div id=\"comment:79\" align=\"right\">comment:79</div>\n\nIn an effort to split this up a little bit, I'm moving some of the fixes for the Python2/3 packages to a separate ticket, since it can work independently of this ticket: #23781",
    "created_at": "2017-09-04T17:18:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333431",
    "user": "https://github.com/embray"
}
```

<div id="comment:79" align="right">comment:79</div>

In an effort to split this up a little bit, I'm moving some of the fixes for the Python2/3 packages to a separate ticket, since it can work independently of this ticket: #23781



---

archive/issue_comments_333432.json:
```json
{
    "body": "Changed dependencies from **#23059 #23096 #23160** to **#23059 #23096 #23160 #21726**",
    "created_at": "2017-09-04T17:18:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333432",
    "user": "https://github.com/embray"
}
```

Changed dependencies from **#23059 #23096 #23160** to **#23059 #23096 #23160 #21726**



---

archive/issue_comments_333433.json:
```json
{
    "body": "<div id=\"comment:80\" align=\"right\">comment:80</div>\n\nWrong ticket.",
    "created_at": "2017-09-04T17:19:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333433",
    "user": "https://github.com/embray"
}
```

<div id="comment:80" align="right">comment:80</div>

Wrong ticket.



---

archive/issue_comments_333434.json:
```json
{
    "body": "Changed dependencies from **#23059 #23096 #23160 #21726** to **#23059 #23096 #23160 #23781**",
    "created_at": "2017-09-04T17:19:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333434",
    "user": "https://github.com/embray"
}
```

Changed dependencies from **#23059 #23096 #23160 #21726** to **#23059 #23096 #23160 #23781**



---

archive/issue_comments_333435.json:
```json
{
    "body": "Changed commit from **[`53e3dc5`](https://github.com/sagemath/sagetrac-mirror/commit/53e3dc54db7658c6eceb50d573eeb324d886a532)** to **[`f97fdf9`](https://github.com/sagemath/sagetrac-mirror/commit/f97fdf916d7a58006d1be37c419180c8c8ee1893)**",
    "created_at": "2017-09-04T18:02:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333435",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`53e3dc5`](https://github.com/sagemath/sagetrac-mirror/commit/53e3dc54db7658c6eceb50d573eeb324d886a532)** to **[`f97fdf9`](https://github.com/sagemath/sagetrac-mirror/commit/f97fdf916d7a58006d1be37c419180c8c8ee1893)**



---

archive/issue_comments_333436.json:
```json
{
    "body": "<div id=\"comment:81\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/71cb02d1ae524fa40910ff9eaed5ba03f0ce289f\"><code>71cb02d</code></a></td><td><code>Added the ability for packages to have a post-install script called spkg-postinst.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/013e6f329bb215f4bd37423b1224cabbaac97ab6\"><code>013e6f3</code></a></td><td><code>Add special post-install handling for the backports/__init__.py shared</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b8867259c68a782f235912cff35aa3108dead396\"><code>b886725</code></a></td><td><code>Remove some no-longer used local variables</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f94b3ec48660ca9a226f90074683dbf672440f1f\"><code>f94b3ec</code></a></td><td><code>Add handling for packages that install .info files and update share/info/dir</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f4960ea1e510e836c35612a1c0fc1698a7c6ade5\"><code>f4960ea</code></a></td><td><code>Rename $SAGE_INST_TEMP to $SAGE_DESTDIR</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/36ff6cac7e67438ab46b4efd9bde3955ab11fc5a\"><code>36ff6ca</code></a></td><td><code>Don't use the -u option to cp.  It's not portable to BSD's cp, and is</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/25c4d01bb69035512f218029c1c6665a67704f5d\"><code>25c4d01</code></a></td><td><code>Just use 'cp -a' which seems to be compatible across most cp's.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8c9a60f8f37eb1015f8a4cbcf0f15ad43658bba0\"><code>8c9a60f</code></a></td><td><code>Work around bug in OpenBLAS's Makefile with its use of DESTDIR with</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1389380f87705b23698db8aea3c4476b845e9e3b\"><code>1389380</code></a></td><td><code>Move spkg-check to after the package has been installed to SAGE_LOCAL.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f97fdf916d7a58006d1be37c419180c8c8ee1893\"><code>f97fdf9</code></a></td><td><code>Enable widgetsnbextension in the notebook's config file as a postinst step.</code></td></tr></table>\n",
    "created_at": "2017-09-04T18:02:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333436",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:81"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/71cb02d1ae524fa40910ff9eaed5ba03f0ce289f"><code>71cb02d</code></a></td><td><code>Added the ability for packages to have a post-install script called spkg-postinst.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/013e6f329bb215f4bd37423b1224cabbaac97ab6"><code>013e6f3</code></a></td><td><code>Add special post-install handling for the backports/__init__.py shared</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b8867259c68a782f235912cff35aa3108dead396"><code>b886725</code></a></td><td><code>Remove some no-longer used local variables</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f94b3ec48660ca9a226f90074683dbf672440f1f"><code>f94b3ec</code></a></td><td><code>Add handling for packages that install .info files and update share/info/dir</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f4960ea1e510e836c35612a1c0fc1698a7c6ade5"><code>f4960ea</code></a></td><td><code>Rename $SAGE_INST_TEMP to $SAGE_DESTDIR</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/36ff6cac7e67438ab46b4efd9bde3955ab11fc5a"><code>36ff6ca</code></a></td><td><code>Don't use the -u option to cp.  It's not portable to BSD's cp, and is</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/25c4d01bb69035512f218029c1c6665a67704f5d"><code>25c4d01</code></a></td><td><code>Just use 'cp -a' which seems to be compatible across most cp's.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8c9a60f8f37eb1015f8a4cbcf0f15ad43658bba0"><code>8c9a60f</code></a></td><td><code>Work around bug in OpenBLAS's Makefile with its use of DESTDIR with</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1389380f87705b23698db8aea3c4476b845e9e3b"><code>1389380</code></a></td><td><code>Move spkg-check to after the package has been installed to SAGE_LOCAL.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f97fdf916d7a58006d1be37c419180c8c8ee1893"><code>f97fdf9</code></a></td><td><code>Enable widgetsnbextension in the notebook's config file as a postinst step.</code></td></tr></table>




---

archive/issue_comments_333437.json:
```json
{
    "body": "<div id=\"comment:82\" align=\"right\">comment:82</div>\n\nReplying to [@embray](#comment:78):\n> Replying to [@jdemeyer](#comment:74):\n> > One concern with this patch is that it's really a patch bomb, which might be hard to get reviewed and merged.\n\n> \n> True, but there's not much other way to handle it\n\nWhy do you think that? This doesn't have to be an all-or-nothing patch: you could first implement the general framework and then gradually fix packages.\n\nAnyway, if you find somebody else to review this, I don't mind at all. But for me, I am quite discouraged from reviewing such a big patch. And then there is also the potential for merge conflicts if you make so many changes.",
    "created_at": "2017-09-05T13:49:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333437",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:82" align="right">comment:82</div>

Replying to [@embray](#comment:78):
> Replying to [@jdemeyer](#comment:74):
> > One concern with this patch is that it's really a patch bomb, which might be hard to get reviewed and merged.

> 
> True, but there's not much other way to handle it

Why do you think that? This doesn't have to be an all-or-nothing patch: you could first implement the general framework and then gradually fix packages.

Anyway, if you find somebody else to review this, I don't mind at all. But for me, I am quite discouraged from reviewing such a big patch. And then there is also the potential for merge conflicts if you make so many changes.



---

archive/issue_comments_333438.json:
```json
{
    "body": "<div id=\"comment:83\" align=\"right\">comment:83</div>\n\nI'm not sure how you would propose breaking this up.  It is pretty all-or-nothing: Either DESTDIR installation works or it doesn't.\n\nThere's no sense in \"gradually fix packages\" because they've already *all* been fixed here, and in a way that is likely to result in only minor conflicts at worse (no more so than in #23179--the analysis in [this comment](https://github.com/sagemath/sage/issues/23179#comment:43) still mostly applies).\n\nI could break it up into multiple tickets--I already did in one case.  But for the most part I don't see what that solves.  If you want guidance on what to review, start by ignoring all the `build/pkgs` changes since the vast majority of them are completely mechanistic.",
    "created_at": "2017-09-05T14:07:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333438",
    "user": "https://github.com/embray"
}
```

<div id="comment:83" align="right">comment:83</div>

I'm not sure how you would propose breaking this up.  It is pretty all-or-nothing: Either DESTDIR installation works or it doesn't.

There's no sense in "gradually fix packages" because they've already *all* been fixed here, and in a way that is likely to result in only minor conflicts at worse (no more so than in #23179--the analysis in [this comment](https://github.com/sagemath/sage/issues/23179#comment:43) still mostly applies).

I could break it up into multiple tickets--I already did in one case.  But for the most part I don't see what that solves.  If you want guidance on what to review, start by ignoring all the `build/pkgs` changes since the vast majority of them are completely mechanistic.



---

archive/issue_comments_333439.json:
```json
{
    "body": "<div id=\"comment:84\" align=\"right\">comment:84</div>\n\nReplying to [@embray](#comment:83):\n> I'm not sure how you would propose breaking this up.  It is pretty all-or-nothing: Either DESTDIR installation works or it doesn't.\n\nYou could start with \"`DESTDIR` works for a few selected packages\" or \"`DESTDIR` works for Python packages only\"\n\n> in a way that is likely to result in only minor conflicts at worse\n\nA merge conflict is a merge conflict. It doesn't matter how minor it is.",
    "created_at": "2017-09-05T14:35:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333439",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:84" align="right">comment:84</div>

Replying to [@embray](#comment:83):
> I'm not sure how you would propose breaking this up.  It is pretty all-or-nothing: Either DESTDIR installation works or it doesn't.

You could start with "`DESTDIR` works for a few selected packages" or "`DESTDIR` works for Python packages only"

> in a way that is likely to result in only minor conflicts at worse

A merge conflict is a merge conflict. It doesn't matter how minor it is.



---

archive/issue_comments_333440.json:
```json
{
    "body": "<div id=\"comment:85\" align=\"right\">comment:85</div>\n\nAlright, that's fair.  I'll see if I can break this up a bit more.  \n\nFact remains, there's not much benefit to this unless all packages are updated.  There's no real logical way I can think of to carving it up into multiple tickets, when it can all be done at once.  But for the sake of making review easier I'll try out your suggestion...",
    "created_at": "2017-09-05T15:42:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333440",
    "user": "https://github.com/embray"
}
```

<div id="comment:85" align="right">comment:85</div>

Alright, that's fair.  I'll see if I can break this up a bit more.  

Fact remains, there's not much benefit to this unless all packages are updated.  There's no real logical way I can think of to carving it up into multiple tickets, when it can all be done at once.  But for the sake of making review easier I'll try out your suggestion...



---

archive/issue_comments_333441.json:
```json
{
    "body": "<div id=\"comment:86\" align=\"right\">comment:86</div>\n\nReplying to [@embray](#comment:85):\n> I'll see if I can break this up a bit more.\n\nLet me mention that this is a personal \"pet peeve\". If somebody else (John Palmieri for example) is happy with this ticket and wants to review it, I won't object to that.",
    "created_at": "2017-09-06T08:21:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333441",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:86" align="right">comment:86</div>

Replying to [@embray](#comment:85):
> I'll see if I can break this up a bit more.

Let me mention that this is a personal "pet peeve". If somebody else (John Palmieri for example) is happy with this ticket and wants to review it, I won't object to that.



---

archive/issue_comments_333442.json:
```json
{
    "body": "<div id=\"comment:87\" align=\"right\">comment:87</div>\n\nI'm not sure I understand the build process well enough to be competent enough to review it.",
    "created_at": "2017-09-06T14:18:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333442",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:87" align="right">comment:87</div>

I'm not sure I understand the build process well enough to be competent enough to review it.



---

archive/issue_comments_333443.json:
```json
{
    "body": "<div id=\"comment:88\" align=\"right\">comment:88</div>\n\nReplying to [@jdemeyer](#comment:86):\n> Replying to [@embray](#comment:85):\n> > I'll see if I can break this up a bit more.\n\n> \n> Let me mention that this is a personal \"pet peeve\". If somebody else (John Palmieri for example) is happy with this ticket and wants to review it, I won't object to that.\n\nIt's fine--I see your point.  I think it's easier to review if one patch contains just:\n\n* The basic structural changes\n* A few motivating examples for the different cases\n\nand then leave the remaining boilerplate changes to a separate ticket.",
    "created_at": "2017-09-06T15:28:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333443",
    "user": "https://github.com/embray"
}
```

<div id="comment:88" align="right">comment:88</div>

Replying to [@jdemeyer](#comment:86):
> Replying to [@embray](#comment:85):
> > I'll see if I can break this up a bit more.

> 
> Let me mention that this is a personal "pet peeve". If somebody else (John Palmieri for example) is happy with this ticket and wants to review it, I won't object to that.

It's fine--I see your point.  I think it's easier to review if one patch contains just:

* The basic structural changes
* A few motivating examples for the different cases

and then leave the remaining boilerplate changes to a separate ticket.



---

archive/issue_comments_333444.json:
```json
{
    "body": "<div id=\"comment:89\" align=\"right\">comment:89</div>\n\nReplying to [@embray](#comment:88):\n> I think it's easier to review if one patch contains just:\n> \n> * The basic structural changes\n> * A few motivating examples for the different cases\n\nExactly. But I would prefer to finish #23781 and #21535 first.",
    "created_at": "2017-09-06T21:29:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333444",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:89" align="right">comment:89</div>

Replying to [@embray](#comment:88):
> I think it's easier to review if one patch contains just:
> 
> * The basic structural changes
> * A few motivating examples for the different cases

Exactly. But I would prefer to finish #23781 and #21535 first.



---

archive/issue_comments_333445.json:
```json
{
    "body": "<div id=\"comment:90\" align=\"right\">comment:90</div>\n\nI'm not exactly sure what #21535 has to do with this.",
    "created_at": "2017-09-07T09:48:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333445",
    "user": "https://github.com/embray"
}
```

<div id="comment:90" align="right">comment:90</div>

I'm not exactly sure what #21535 has to do with this.



---

archive/issue_comments_333446.json:
```json
{
    "body": "<div id=\"comment:91\" align=\"right\">comment:91</div>\n\nReplying to [@embray](#comment:90):\n> I'm not exactly sure what #21535 has to do with this.\n\nIt's unrelated. I just mentioned it because I can only keep track of a limited number of build-system tickets in my brain cache.",
    "created_at": "2017-09-07T10:18:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333446",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:91" align="right">comment:91</div>

Replying to [@embray](#comment:90):
> I'm not exactly sure what #21535 has to do with this.

It's unrelated. I just mentioned it because I can only keep track of a limited number of build-system tickets in my brain cache.



---

archive/issue_comments_333447.json:
```json
{
    "body": "<div id=\"comment:92\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/be70ddb7efa5935b58bf31b5bebfb4f472b928ec\"><code>be70ddb</code></a></td><td><code>Added the ability for packages to have a post-install script called spkg-postinst.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e246937533ebea75a42e56898d29a7c2b3cdb4b0\"><code>e246937</code></a></td><td><code>Add special post-install handling for the backports/__init__.py shared</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/87a02ac25b1b17cf09a44edcd2046f913e449164\"><code>87a02ac</code></a></td><td><code>Remove some no-longer used local variables</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/592731866e491d27f38ad65492af07f85cff2e23\"><code>5927318</code></a></td><td><code>Add handling for packages that install .info files and update share/info/dir</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/73245de422500f2649b856ee5c44837586278d46\"><code>73245de</code></a></td><td><code>Rename $SAGE_INST_TEMP to $SAGE_DESTDIR</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a771cd891ed1478f5359f4a6611c6914fcd11f59\"><code>a771cd8</code></a></td><td><code>Don't use the -u option to cp.  It's not portable to BSD's cp, and is</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/512504710450294645f1a65c67b5f6df660a534a\"><code>5125047</code></a></td><td><code>Just use 'cp -a' which seems to be compatible across most cp's.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3e8e7b5868e4b8ff55616ba761523e974a68d608\"><code>3e8e7b5</code></a></td><td><code>Work around bug in OpenBLAS's Makefile with its use of DESTDIR with</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/58676b476bfcd1e2c636c3b97afb44ba1eb52683\"><code>58676b4</code></a></td><td><code>Move spkg-check to after the package has been installed to SAGE_LOCAL.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c1d5453c2735cdda78d53dc36b56fb54ec7dd336\"><code>c1d5453</code></a></td><td><code>Enable widgetsnbextension in the notebook's config file as a postinst step.</code></td></tr></table>\n",
    "created_at": "2017-10-11T15:07:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333447",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:92"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/be70ddb7efa5935b58bf31b5bebfb4f472b928ec"><code>be70ddb</code></a></td><td><code>Added the ability for packages to have a post-install script called spkg-postinst.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e246937533ebea75a42e56898d29a7c2b3cdb4b0"><code>e246937</code></a></td><td><code>Add special post-install handling for the backports/__init__.py shared</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/87a02ac25b1b17cf09a44edcd2046f913e449164"><code>87a02ac</code></a></td><td><code>Remove some no-longer used local variables</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/592731866e491d27f38ad65492af07f85cff2e23"><code>5927318</code></a></td><td><code>Add handling for packages that install .info files and update share/info/dir</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/73245de422500f2649b856ee5c44837586278d46"><code>73245de</code></a></td><td><code>Rename $SAGE_INST_TEMP to $SAGE_DESTDIR</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a771cd891ed1478f5359f4a6611c6914fcd11f59"><code>a771cd8</code></a></td><td><code>Don't use the -u option to cp.  It's not portable to BSD's cp, and is</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/512504710450294645f1a65c67b5f6df660a534a"><code>5125047</code></a></td><td><code>Just use 'cp -a' which seems to be compatible across most cp's.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3e8e7b5868e4b8ff55616ba761523e974a68d608"><code>3e8e7b5</code></a></td><td><code>Work around bug in OpenBLAS's Makefile with its use of DESTDIR with</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/58676b476bfcd1e2c636c3b97afb44ba1eb52683"><code>58676b4</code></a></td><td><code>Move spkg-check to after the package has been installed to SAGE_LOCAL.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c1d5453c2735cdda78d53dc36b56fb54ec7dd336"><code>c1d5453</code></a></td><td><code>Enable widgetsnbextension in the notebook's config file as a postinst step.</code></td></tr></table>




---

archive/issue_comments_333448.json:
```json
{
    "body": "Changed commit from **[`f97fdf9`](https://github.com/sagemath/sagetrac-mirror/commit/f97fdf916d7a58006d1be37c419180c8c8ee1893)** to **[`c1d5453`](https://github.com/sagemath/sagetrac-mirror/commit/c1d5453c2735cdda78d53dc36b56fb54ec7dd336)**",
    "created_at": "2017-10-11T15:07:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333448",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`f97fdf9`](https://github.com/sagemath/sagetrac-mirror/commit/f97fdf916d7a58006d1be37c419180c8c8ee1893)** to **[`c1d5453`](https://github.com/sagemath/sagetrac-mirror/commit/c1d5453c2735cdda78d53dc36b56fb54ec7dd336)**



---

archive/issue_comments_333449.json:
```json
{
    "body": "<div id=\"comment:93\" align=\"right\">comment:93</div>\n\nWent ahead and rebased on current #23781.  But I'm now I'm going to do some surgery to break this into some smaller tickets for which this ticket will serve as the mothership.",
    "created_at": "2017-10-11T15:09:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333449",
    "user": "https://github.com/embray"
}
```

<div id="comment:93" align="right">comment:93</div>

Went ahead and rebased on current #23781.  But I'm now I'm going to do some surgery to break this into some smaller tickets for which this ticket will serve as the mothership.



---

archive/issue_events_311802.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-10-11T15:14:45Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22509#event-311802"
}
```



---

archive/issue_events_311803.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-10-11T15:14:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22509#event-311803"
}
```



---

archive/issue_comments_333450.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,4 +6,8 @@\n \n * It gives us the opportunity to make an exact list of the files that were installed.  This is a prerequisite to improving package uninstallation/reinstallation in sage-dist (see #22510).\n \n-This is also standard operating procedure in most other packaging systems, so it would be good for Sage to adopt too.  It is also already possible for Python packages (e.g. `pip install --root`), and shouldn't be too hard to patch into whatever packages don't support it out of the box for whatever reason.\n+This is also standard operating procedure in most other packaging systems, so it would be good for Sage to adopt too.  The general approach is the same as that used for converting an arbitrary Makefile to support this convention--everywhere a file is installed, prefix the installation path with `$(DESTDIR)` (or in this case a variable we'll call `$SAGE_DESTDIR`).\n+\n+For packages that already support the `DESTDIR` convention, then, we pass `DESTDIR=$SAGE_DESTDIR` to `make install`.  It is also already possible for Python packages (e.g. `pip install --root`).\n+\n+Since the introduction of the build helper scripts in #23160, it makes the most sense to make these changes directly in the helper scripts, and then update more packages to use those helper scripts where possible.\n``````\n",
    "created_at": "2017-10-11T15:14:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333450",
    "user": "https://github.com/embray"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,4 +6,8 @@
 
 * It gives us the opportunity to make an exact list of the files that were installed.  This is a prerequisite to improving package uninstallation/reinstallation in sage-dist (see #22510).
 
-This is also standard operating procedure in most other packaging systems, so it would be good for Sage to adopt too.  It is also already possible for Python packages (e.g. `pip install --root`), and shouldn't be too hard to patch into whatever packages don't support it out of the box for whatever reason.
+This is also standard operating procedure in most other packaging systems, so it would be good for Sage to adopt too.  The general approach is the same as that used for converting an arbitrary Makefile to support this convention--everywhere a file is installed, prefix the installation path with `$(DESTDIR)` (or in this case a variable we'll call `$SAGE_DESTDIR`).
+
+For packages that already support the `DESTDIR` convention, then, we pass `DESTDIR=$SAGE_DESTDIR` to `make install`.  It is also already possible for Python packages (e.g. `pip install --root`).
+
+Since the introduction of the build helper scripts in #23160, it makes the most sense to make these changes directly in the helper scripts, and then update more packages to use those helper scripts where possible.
``````




---

archive/issue_comments_333451.json:
```json
{
    "body": "<div id=\"comment:95\" align=\"right\">comment:95</div>\n\nReplying to [@embray](#comment:93):\n> Went ahead and rebased on current #23781.\n\nThis doesn't need to depend on #23781. Just leave the Python build script alone.",
    "created_at": "2017-10-20T14:50:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333451",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:95" align="right">comment:95</div>

Replying to [@embray](#comment:93):
> Went ahead and rebased on current #23781.

This doesn't need to depend on #23781. Just leave the Python build script alone.



---

archive/issue_comments_333452.json:
```json
{
    "body": "<div id=\"comment:96\" align=\"right\">comment:96</div>\n\nUhh, it does need to in a manner of speaking.  Eventually the Python build script needs to be updated to support this.  But I'm already working on completely breaking this up in to separate tickets.",
    "created_at": "2017-10-23T08:47:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333452",
    "user": "https://github.com/embray"
}
```

<div id="comment:96" align="right">comment:96</div>

Uhh, it does need to in a manner of speaking.  Eventually the Python build script needs to be updated to support this.  But I'm already working on completely breaking this up in to separate tickets.



---

archive/issue_comments_333453.json:
```json
{
    "body": "<div id=\"comment:97\" align=\"right\">comment:97</div>\n\nAdded #24106--a simplified ticket demonstrating the core functionality of the branch on this ticket.  Will add followup tickets with additional details.",
    "created_at": "2017-10-25T15:04:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333453",
    "user": "https://github.com/embray"
}
```

<div id="comment:97" align="right">comment:97</div>

Added #24106--a simplified ticket demonstrating the core functionality of the branch on this ticket.  Will add followup tickets with additional details.



---

archive/issue_comments_333454.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -11,3 +11,11 @@\n For packages that already support the `DESTDIR` convention, then, we pass `DESTDIR=$SAGE_DESTDIR` to `make install`.  It is also already possible for Python packages (e.g. `pip install --root`).\n \n Since the introduction of the build helper scripts in #23160, it makes the most sense to make these changes directly in the helper scripts, and then update more packages to use those helper scripts where possible.\n+\n+Dependent tickets:\n+\n+* #24106 - implement the basic functionality of supporting staged installs through `sage-spkg`\n+* #24024 - update more `spkg-build/install` scripts to use the `sdh_` helper functions, since that is the fastest way to add `DESTDIR` support for many packages.\n+* #????? - add support for `--root=${SAGE_DESTDIR}` to Python spkgs\n+* #????? - add support for post-install scripts; this can be useful for cases where, for example, local files are generated after the package is installed, or to handle cases where one file is shared by multiple packages and needs to be updated when a package that uses it is installed (see e.g. [#22510 comment:5](https://github.com/sagemath/sage/issues/22510#comment:5))\n+* #????? - convert all spkgs to support staged-install; for many packages this can be covered by using the helper functions, but some packages require additional steps; in particular, packages that have files that are manually copied into `$SAGE_LOCAL`, rather than through a standard installer\n``````\n",
    "created_at": "2017-10-25T15:04:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333454",
    "user": "https://github.com/embray"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -11,3 +11,11 @@
 For packages that already support the `DESTDIR` convention, then, we pass `DESTDIR=$SAGE_DESTDIR` to `make install`.  It is also already possible for Python packages (e.g. `pip install --root`).
 
 Since the introduction of the build helper scripts in #23160, it makes the most sense to make these changes directly in the helper scripts, and then update more packages to use those helper scripts where possible.
+
+Dependent tickets:
+
+* #24106 - implement the basic functionality of supporting staged installs through `sage-spkg`
+* #24024 - update more `spkg-build/install` scripts to use the `sdh_` helper functions, since that is the fastest way to add `DESTDIR` support for many packages.
+* #????? - add support for `--root=${SAGE_DESTDIR}` to Python spkgs
+* #????? - add support for post-install scripts; this can be useful for cases where, for example, local files are generated after the package is installed, or to handle cases where one file is shared by multiple packages and needs to be updated when a package that uses it is installed (see e.g. [#22510 comment:5](https://github.com/sagemath/sage/issues/22510#comment:5))
+* #????? - convert all spkgs to support staged-install; for many packages this can be covered by using the helper functions, but some packages require additional steps; in particular, packages that have files that are manually copied into `$SAGE_LOCAL`, rather than through a standard installer
``````




---

archive/issue_events_311804.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-12-12T08:27:24Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "milestone_number": null,
    "milestone_title": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22509#event-311804"
}
```



---

archive/issue_events_311805.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-12-12T08:27:24Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "milestone_number": null,
    "milestone_title": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22509#event-311805"
}
```



---

archive/issue_comments_333455.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -17,5 +17,5 @@\n * #24106 - implement the basic functionality of supporting staged installs through `sage-spkg`\n * #24024 - update more `spkg-build/install` scripts to use the `sdh_` helper functions, since that is the fastest way to add `DESTDIR` support for many packages.\n * #????? - add support for `--root=${SAGE_DESTDIR}` to Python spkgs\n-* #????? - add support for post-install scripts; this can be useful for cases where, for example, local files are generated after the package is installed, or to handle cases where one file is shared by multiple packages and needs to be updated when a package that uses it is installed (see e.g. [#22510 comment:5](https://github.com/sagemath/sage/issues/22510#comment:5))\n+* #24645 - add support for post-install scripts; this can be useful for cases where, for example, local files are generated after the package is installed, or to handle cases where one file is shared by multiple packages and needs to be updated when a package that uses it is installed (see e.g. [#22510 comment:5](https://github.com/sagemath/sage/issues/22510#comment:5))\n * #????? - convert all spkgs to support staged-install; for many packages this can be covered by using the helper functions, but some packages require additional steps; in particular, packages that have files that are manually copied into `$SAGE_LOCAL`, rather than through a standard installer\n``````\n",
    "created_at": "2018-02-02T13:04:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333455",
    "user": "https://github.com/embray"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -17,5 +17,5 @@
 * #24106 - implement the basic functionality of supporting staged installs through `sage-spkg`
 * #24024 - update more `spkg-build/install` scripts to use the `sdh_` helper functions, since that is the fastest way to add `DESTDIR` support for many packages.
 * #????? - add support for `--root=${SAGE_DESTDIR}` to Python spkgs
-* #????? - add support for post-install scripts; this can be useful for cases where, for example, local files are generated after the package is installed, or to handle cases where one file is shared by multiple packages and needs to be updated when a package that uses it is installed (see e.g. [#22510 comment:5](https://github.com/sagemath/sage/issues/22510#comment:5))
+* #24645 - add support for post-install scripts; this can be useful for cases where, for example, local files are generated after the package is installed, or to handle cases where one file is shared by multiple packages and needs to be updated when a package that uses it is installed (see e.g. [#22510 comment:5](https://github.com/sagemath/sage/issues/22510#comment:5))
 * #????? - convert all spkgs to support staged-install; for many packages this can be covered by using the helper functions, but some packages require additional steps; in particular, packages that have files that are manually copied into `$SAGE_LOCAL`, rather than through a standard installer
``````




---

archive/issue_comments_333456.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -16,6 +16,6 @@\n \n * #24106 - implement the basic functionality of supporting staged installs through `sage-spkg`\n * #24024 - update more `spkg-build/install` scripts to use the `sdh_` helper functions, since that is the fastest way to add `DESTDIR` support for many packages.\n-* #????? - add support for `--root=${SAGE_DESTDIR}` to Python spkgs\n+* #24646 - add support for `--root=${SAGE_DESTDIR}` to Python spkgs\n * #24645 - add support for post-install scripts; this can be useful for cases where, for example, local files are generated after the package is installed, or to handle cases where one file is shared by multiple packages and needs to be updated when a package that uses it is installed (see e.g. [#22510 comment:5](https://github.com/sagemath/sage/issues/22510#comment:5))\n * #????? - convert all spkgs to support staged-install; for many packages this can be covered by using the helper functions, but some packages require additional steps; in particular, packages that have files that are manually copied into `$SAGE_LOCAL`, rather than through a standard installer\n``````\n",
    "created_at": "2018-02-02T13:51:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333456",
    "user": "https://github.com/embray"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -16,6 +16,6 @@
 
 * #24106 - implement the basic functionality of supporting staged installs through `sage-spkg`
 * #24024 - update more `spkg-build/install` scripts to use the `sdh_` helper functions, since that is the fastest way to add `DESTDIR` support for many packages.
-* #????? - add support for `--root=${SAGE_DESTDIR}` to Python spkgs
+* #24646 - add support for `--root=${SAGE_DESTDIR}` to Python spkgs
 * #24645 - add support for post-install scripts; this can be useful for cases where, for example, local files are generated after the package is installed, or to handle cases where one file is shared by multiple packages and needs to be updated when a package that uses it is installed (see e.g. [#22510 comment:5](https://github.com/sagemath/sage/issues/22510#comment:5))
 * #????? - convert all spkgs to support staged-install; for many packages this can be covered by using the helper functions, but some packages require additional steps; in particular, packages that have files that are manually copied into `$SAGE_LOCAL`, rather than through a standard installer
``````




---

archive/issue_comments_333457.json:
```json
{
    "body": "<div id=\"comment:101\" align=\"right\">comment:101</div>\n\nI am surprised now to see that #22509 and #24106 are distinct tickets. Isn't this one a \"duplicate\"? There is a stale branch here, is that still relevant?",
    "created_at": "2018-02-02T15:20:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333457",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:101" align="right">comment:101</div>

I am surprised now to see that #22509 and #24106 are distinct tickets. Isn't this one a "duplicate"? There is a stale branch here, is that still relevant?



---

archive/issue_comments_333458.json:
```json
{
    "body": "<div id=\"comment:102\" align=\"right\">comment:102</div>\n\nsee [comment:93]",
    "created_at": "2018-02-02T15:41:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333458",
    "user": "https://github.com/embray"
}
```

<div id="comment:102" align="right">comment:102</div>

see [comment:93]



---

archive/issue_comments_333459.json:
```json
{
    "body": "<div id=\"comment:103\" align=\"right\">comment:103</div>\n\nReplying to [@embray](#comment:28):\n> Then the `$SAGE_DESTDIR$SAGE_LOCAL` combination can be called `$SAGE_DESTDIR_LOCAL`.\n\nI don't remember if there was a reason not to do this, but I'll introduce this variable in #25001.",
    "created_at": "2018-03-19T08:27:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333459",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:103" align="right">comment:103</div>

Replying to [@embray](#comment:28):
> Then the `$SAGE_DESTDIR$SAGE_LOCAL` combination can be called `$SAGE_DESTDIR_LOCAL`.

I don't remember if there was a reason not to do this, but I'll introduce this variable in #25001.



---

archive/issue_comments_333460.json:
```json
{
    "body": "<div id=\"comment:104\" align=\"right\">comment:104</div>\n\nYes, there was a reason: [#22509 comment:30](https://github.com/sagemath/sage/issues/22509#comment:30)\n\nThough I suppose if `$SAGE_DESTDIR` isn't set then it's fine if `$SAGE_DESTDIR_LOCAL == $SAGE_LOCAL`.",
    "created_at": "2018-03-19T08:41:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333460",
    "user": "https://github.com/embray"
}
```

<div id="comment:104" align="right">comment:104</div>

Yes, there was a reason: [#22509 comment:30](https://github.com/sagemath/sage/issues/22509#comment:30)

Though I suppose if `$SAGE_DESTDIR` isn't set then it's fine if `$SAGE_DESTDIR_LOCAL == $SAGE_LOCAL`.



---

archive/issue_events_311806.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-04-26T12:13:55Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "milestone_number": null,
    "milestone_title": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22509#event-311806"
}
```



---

archive/issue_events_311807.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-04-26T12:13:55Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "milestone_number": null,
    "milestone_title": "sage-8.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22509#event-311807"
}
```



---

archive/issue_comments_333461.json:
```json
{
    "body": "<div id=\"comment:106\" align=\"right\">comment:106</div>\n\nI believe this issue can reasonably be addressed for Sage 8.4.",
    "created_at": "2018-07-18T11:47:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333461",
    "user": "https://github.com/embray"
}
```

<div id="comment:106" align="right">comment:106</div>

I believe this issue can reasonably be addressed for Sage 8.4.



---

archive/issue_events_311808.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-07-18T11:47:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "milestone_number": null,
    "milestone_title": "sage-8.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22509#event-311808"
}
```



---

archive/issue_events_311809.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-07-18T11:47:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "milestone_number": null,
    "milestone_title": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22509#event-311809"
}
```



---

archive/issue_events_311810.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-10-28T11:41:42Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "milestone_number": null,
    "milestone_title": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22509#event-311810"
}
```



---

archive/issue_events_311811.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-10-28T11:41:42Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "milestone_number": null,
    "milestone_title": "sage-8.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22509#event-311811"
}
```



---

archive/issue_events_311812.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-12-28T14:10:15Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "milestone_number": null,
    "milestone_title": "sage-8.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22509#event-311812"
}
```



---

archive/issue_events_311813.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-12-28T14:10:15Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "milestone_number": null,
    "milestone_title": "sage-8.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22509#event-311813"
}
```



---

archive/issue_comments_333462.json:
```json
{
    "body": "<div id=\"comment:108\" align=\"right\">comment:108</div>\n\nRetargeting some of my tickets (somewhat optimistically for now).",
    "created_at": "2018-12-28T14:10:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333462",
    "user": "https://github.com/embray"
}
```

<div id="comment:108" align="right">comment:108</div>

Retargeting some of my tickets (somewhat optimistically for now).



---

archive/issue_comments_333463.json:
```json
{
    "body": "<div id=\"comment:109\" align=\"right\">comment:109</div>\n\nMoving all my in-progress tickets to 8.8 milestone.",
    "created_at": "2019-03-25T10:43:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333463",
    "user": "https://github.com/embray"
}
```

<div id="comment:109" align="right">comment:109</div>

Moving all my in-progress tickets to 8.8 milestone.



---

archive/issue_events_311814.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-03-25T10:43:18Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "milestone_number": null,
    "milestone_title": "sage-8.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22509#event-311814"
}
```



---

archive/issue_events_311815.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-03-25T10:43:18Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "milestone_number": null,
    "milestone_title": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22509#event-311815"
}
```



---

archive/issue_events_311816.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-06-14T14:50:27Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "milestone_number": null,
    "milestone_title": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22509#event-311816"
}
```



---

archive/issue_events_311817.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-06-14T14:50:27Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "milestone_number": null,
    "milestone_title": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22509#event-311817"
}
```



---

archive/issue_comments_333464.json:
```json
{
    "body": "<div id=\"comment:110\" align=\"right\">comment:110</div>\n\nTickets still needing working or clarification should be moved to the next release milestone at the soonest (please feel free to revert if you think the ticket is close to being resolved).",
    "created_at": "2019-06-14T14:50:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333464",
    "user": "https://github.com/embray"
}
```

<div id="comment:110" align="right">comment:110</div>

Tickets still needing working or clarification should be moved to the next release milestone at the soonest (please feel free to revert if you think the ticket is close to being resolved).



---

archive/issue_comments_333465.json:
```json
{
    "body": "<div id=\"comment:111\" align=\"right\">comment:111</div>\n\nTicket retargeted after milestone closed",
    "created_at": "2019-12-30T14:48:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333465",
    "user": "https://github.com/embray"
}
```

<div id="comment:111" align="right">comment:111</div>

Ticket retargeted after milestone closed



---

archive/issue_events_311818.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-12-30T14:48:17Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "milestone_number": null,
    "milestone_title": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22509#event-311818"
}
```



---

archive/issue_events_311819.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-12-30T14:48:17Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "milestone_number": null,
    "milestone_title": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22509#event-311819"
}
```



---

archive/issue_events_311820.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-02-09T22:34:08Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "milestone_number": null,
    "milestone_title": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22509#event-311820"
}
```



---

archive/issue_events_311821.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-02-09T22:34:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22509#event-311821"
}
```



---

archive/issue_events_311822.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-02-09T22:34:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22509#event-311822"
}
```



---

archive/issue_comments_333466.json:
```json
{
    "body": "<div id=\"comment:112\" align=\"right\">comment:112</div>\n\nI suggest to close this ticket because its goals have been achieved and the remaining tasks seem to be covered by #24024.",
    "created_at": "2020-02-09T22:34:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22509#issuecomment-333466",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:112" align="right">comment:112</div>

I suggest to close this ticket because its goals have been achieved and the remaining tasks seem to be covered by #24024.
