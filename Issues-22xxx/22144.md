# Issue 22144: simplify the Graphics3d object of polyhedra

archive/issues_021907.json:
```json
{
    "assignees": [],
    "body": "Currently, every face is in its own IndexFaceSet.\n\nOne can use one IndexFaceSet for all the faces together.\n\nAlso enhance the STL ouput by cutting no-triangular faces into triangles.\n\nand make sure that all faces are oriented outwards.\n\nThis may also help simplify further the PLY export later.\n\nCC:  @ohanar @kcrisman @nilesjohnson @VivianePons @sagetrac-ams\n\nKeywords: **days82**\n\nBranch/Commit: **[`ed1815a`](https://github.com/sagemath/sagetrac-mirror/commit/ed1815abd41de4c68c04a3224647099f9e02d8fe)**\n\nReviewer: **Alba M\u00e1laga**\n\nAuthor: **Fr\u00e9d\u00e9ric Chapoton**\n\nComponent: **graphics**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/22144_\n\n",
    "closed_at": "2017-01-21T21:21:38Z",
    "created_at": "2017-01-06T14:17:56Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20graphics",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-7.5",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "simplify the Graphics3d object of polyhedra",
    "type": "issue",
    "updated_at": "2017-01-21T21:21:38Z",
    "url": "https://github.com/sagemath/sage/issues/22144",
    "user": "https://github.com/fchapoton"
}
```
Currently, every face is in its own IndexFaceSet.

One can use one IndexFaceSet for all the faces together.

Also enhance the STL ouput by cutting no-triangular faces into triangles.

and make sure that all faces are oriented outwards.

This may also help simplify further the PLY export later.

CC:  @ohanar @kcrisman @nilesjohnson @VivianePons @sagetrac-ams

Keywords: **days82**

Branch/Commit: **[`ed1815a`](https://github.com/sagemath/sagetrac-mirror/commit/ed1815abd41de4c68c04a3224647099f9e02d8fe)**

Reviewer: **Alba Málaga**

Author: **Frédéric Chapoton**

Component: **graphics**

_Issue created by migration from https://trac.sagemath.org/ticket/22144_





---

archive/issue_events_310024.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-01-06T14:17:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/22144",
    "milestone_number": null,
    "milestone_title": "sage-7.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22144#event-310024"
}
```



---

archive/issue_events_310025.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-01-06T14:17:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22144",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20graphics",
    "label_color": "0000ff",
    "label_name": "c: graphics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22144#event-310025"
}
```



---

archive/issue_events_310026.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-01-06T14:17:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22144",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22144#event-310026"
}
```



---

archive/issue_events_310027.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-01-06T14:17:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22144",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22144#event-310027"
}
```



---

archive/issue_comments_326641.json:
```json
{
    "body": "<div id=\"comment:1\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6c54142cffa2e7fd61bff6edac32b3ee277bb44d\">6c54142</a></td><td><code>simplify slightly the Graphics3d object of polyhedra</code></td></tr></table>\n",
    "created_at": "2017-01-06T14:18:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22144#issuecomment-326641",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:1"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6c54142cffa2e7fd61bff6edac32b3ee277bb44d">6c54142</a></td><td><code>simplify slightly the Graphics3d object of polyhedra</code></td></tr></table>




---

archive/issue_events_310028.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-01-06T14:18:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22144",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22144#event-310028"
}
```



---

archive/issue_comments_326642.json:
```json
{
    "body": "Branch: **[u/chapoton/22144](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/22144)**",
    "created_at": "2017-01-06T14:18:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22144#issuecomment-326642",
    "user": "https://github.com/fchapoton"
}
```

Branch: **[u/chapoton/22144](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/22144)**



---

archive/issue_comments_326643.json:
```json
{
    "body": "Commit: **[`6c54142`](https://github.com/sagemath/sagetrac-mirror/commit/6c54142cffa2e7fd61bff6edac32b3ee277bb44d)**",
    "created_at": "2017-01-06T14:18:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22144#issuecomment-326643",
    "user": "https://github.com/fchapoton"
}
```

Commit: **[`6c54142`](https://github.com/sagemath/sagetrac-mirror/commit/6c54142cffa2e7fd61bff6edac32b3ee277bb44d)**



---

archive/issue_comments_326644.json:
```json
{
    "body": "<div id=\"comment:2\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/740b0a75791503690f4236530847dc2cb10dad98\">740b0a7</a></td><td><code>trac 22144 correct one doctest</code></td></tr></table>\n",
    "created_at": "2017-01-06T16:41:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22144#issuecomment-326644",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:2"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/740b0a75791503690f4236530847dc2cb10dad98">740b0a7</a></td><td><code>trac 22144 correct one doctest</code></td></tr></table>




---

archive/issue_comments_326645.json:
```json
{
    "body": "Changed commit from **[`6c54142`](https://github.com/sagemath/sagetrac-mirror/commit/6c54142cffa2e7fd61bff6edac32b3ee277bb44d)** to **[`740b0a7`](https://github.com/sagemath/sagetrac-mirror/commit/740b0a75791503690f4236530847dc2cb10dad98)**",
    "created_at": "2017-01-06T16:41:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22144#issuecomment-326645",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`6c54142`](https://github.com/sagemath/sagetrac-mirror/commit/6c54142cffa2e7fd61bff6edac32b3ee277bb44d)** to **[`740b0a7`](https://github.com/sagemath/sagetrac-mirror/commit/740b0a75791503690f4236530847dc2cb10dad98)**



---

archive/issue_comments_326646.json:
```json
{
    "body": "<div id=\"comment:3\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/443559cfc01c639ba280bb132f5f32606a90a2d4\">443559c</a></td><td><code>simplify slightly the Graphics3d object of polyhedra</code></td></tr></table>\n",
    "created_at": "2017-01-06T16:59:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22144#issuecomment-326646",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:3"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/443559cfc01c639ba280bb132f5f32606a90a2d4">443559c</a></td><td><code>simplify slightly the Graphics3d object of polyhedra</code></td></tr></table>




---

archive/issue_comments_326647.json:
```json
{
    "body": "Changed commit from **[`740b0a7`](https://github.com/sagemath/sagetrac-mirror/commit/740b0a75791503690f4236530847dc2cb10dad98)** to **[`443559c`](https://github.com/sagemath/sagetrac-mirror/commit/443559cfc01c639ba280bb132f5f32606a90a2d4)**",
    "created_at": "2017-01-06T16:59:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22144#issuecomment-326647",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`740b0a7`](https://github.com/sagemath/sagetrac-mirror/commit/740b0a75791503690f4236530847dc2cb10dad98)** to **[`443559c`](https://github.com/sagemath/sagetrac-mirror/commit/443559cfc01c639ba280bb132f5f32606a90a2d4)**



---

archive/issue_comments_326648.json:
```json
{
    "body": "<div id=\"comment:4\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/976fd8eaa5bd9815f71e0cfaf18811a8c6fce1dc\">976fd8e</a></td><td><code>simplify slightly the Graphics3d object of polyhedra</code></td></tr></table>\n",
    "created_at": "2017-01-07T08:18:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22144#issuecomment-326648",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:4"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/976fd8eaa5bd9815f71e0cfaf18811a8c6fce1dc">976fd8e</a></td><td><code>simplify slightly the Graphics3d object of polyhedra</code></td></tr></table>




---

archive/issue_comments_326649.json:
```json
{
    "body": "Changed commit from **[`443559c`](https://github.com/sagemath/sagetrac-mirror/commit/443559cfc01c639ba280bb132f5f32606a90a2d4)** to **[`976fd8e`](https://github.com/sagemath/sagetrac-mirror/commit/976fd8eaa5bd9815f71e0cfaf18811a8c6fce1dc)**",
    "created_at": "2017-01-07T08:18:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22144#issuecomment-326649",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`443559c`](https://github.com/sagemath/sagetrac-mirror/commit/443559cfc01c639ba280bb132f5f32606a90a2d4)** to **[`976fd8e`](https://github.com/sagemath/sagetrac-mirror/commit/976fd8eaa5bd9815f71e0cfaf18811a8c6fce1dc)**



---

archive/issue_comments_326650.json:
```json
{
    "body": "Changed commit from **[`976fd8e`](https://github.com/sagemath/sagetrac-mirror/commit/976fd8eaa5bd9815f71e0cfaf18811a8c6fce1dc)** to **[`5f16820`](https://github.com/sagemath/sagetrac-mirror/commit/5f16820fa2dfb05e78674028bd097ec4ca0d55ec)**",
    "created_at": "2017-01-10T12:33:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22144#issuecomment-326650",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`976fd8e`](https://github.com/sagemath/sagetrac-mirror/commit/976fd8eaa5bd9815f71e0cfaf18811a8c6fce1dc)** to **[`5f16820`](https://github.com/sagemath/sagetrac-mirror/commit/5f16820fa2dfb05e78674028bd097ec4ca0d55ec)**



---

archive/issue_comments_326651.json:
```json
{
    "body": "<div id=\"comment:5\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/443559cfc01c639ba280bb132f5f32606a90a2d4\">443559c</a></td><td><code>simplify slightly the Graphics3d object of polyhedra</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/088e974c355530177ce8e363f792815492d3acaa\">088e974</a></td><td><code>trac 22144 enhance stl ouput (for polyhedra in particular)</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5f16820fa2dfb05e78674028bd097ec4ca0d55ec\">5f16820</a></td><td><code>Merge branch 'u/chapoton/22144' in alternative branch</code></td></tr></table>\n",
    "created_at": "2017-01-10T12:33:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22144#issuecomment-326651",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:5"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/443559cfc01c639ba280bb132f5f32606a90a2d4">443559c</a></td><td><code>simplify slightly the Graphics3d object of polyhedra</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/088e974c355530177ce8e363f792815492d3acaa">088e974</a></td><td><code>trac 22144 enhance stl ouput (for polyhedra in particular)</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5f16820fa2dfb05e78674028bd097ec4ca0d55ec">5f16820</a></td><td><code>Merge branch 'u/chapoton/22144' in alternative branch</code></td></tr></table>




---

archive/issue_comments_326652.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,4 +2,6 @@\n \n One can use one IndexFaceSet for all the faces together.\n \n-This may help simplify the STL or PLY export later.\n+Also enhance the STL ouput by cutting no-triangular faces into triangles.\n+\n+This may also help simplify further the PLY export later.\n``````\n",
    "created_at": "2017-01-10T12:35:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22144#issuecomment-326652",
    "user": "https://github.com/fchapoton"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,4 +2,6 @@
 
 One can use one IndexFaceSet for all the faces together.
 
-This may help simplify the STL or PLY export later.
+Also enhance the STL ouput by cutting no-triangular faces into triangles.
+
+This may also help simplify further the PLY export later.
``````




---

archive/issue_comments_326653.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\ncould you please try\n\n```\nsage: P = polytopes.truncated_octahedron()\nsage: Q = P.plot().all[-1]\nsage: Q.save('machin.stl')\n```\nit works for me. The second line isolate the IndexFaceSet from other bells and whistles (plot of edges and vertices)\n\nuseful: https://threejs.org/editor/",
    "created_at": "2017-01-10T20:18:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22144#issuecomment-326653",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:9" align="right">comment:9</div>

could you please try

```
sage: P = polytopes.truncated_octahedron()
sage: Q = P.plot().all[-1]
sage: Q.save('machin.stl')
```
it works for me. The second line isolate the IndexFaceSet from other bells and whistles (plot of edges and vertices)

useful: https://threejs.org/editor/



---

archive/issue_comments_326654.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nI tried your example.  \n\nFor me, the second line still was a `Graphics3DGroup` so no `face_list` attribute that `save(...stl)` uses at this point in its code. So `Q.save('machin.stl')` fails with the error message `'Graphics3dGroup' object has no attribute 'face_list'`.  \n\nHowever, `P.plot().all[-1].all[i]` will give a `Graphics3D Object` for every appropriate `i` ( here there are 14 faces, so `i in range(14)`). Then we can recover the full list of faces by putting all faces together. \n\n```\nsage: P = polytopes.truncated_octahedron()\nsage: Q = P.plot().all[-1].all[:-1]\nsage: my_face_list = [face for face_as_IFS in Q for face in face_as_IFS.face_list()] \n```\n\nAnd then, I can call the `save(....stl')` method on an IndexFaceSet built out from this list.\n\n```\nsage: from sage.plot.plot3d.index_face_set import IndexFaceSet\nsage: polytope_as_IFS = IndexFaceSet(my_face_list)\nsage: polytope_as_IFS.save('machin.stl')\n```\n\nIt will again fail, but for a different reason - the faces are not triangles. \n\n[Edit] By the way, I was testing on the develop branch checked out from the github repository.",
    "created_at": "2017-01-11T08:59:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22144#issuecomment-326654",
    "user": "https://github.com/sagetrac-ams"
}
```

<div id="comment:10" align="right">comment:10</div>

I tried your example.  

For me, the second line still was a `Graphics3DGroup` so no `face_list` attribute that `save(...stl)` uses at this point in its code. So `Q.save('machin.stl')` fails with the error message `'Graphics3dGroup' object has no attribute 'face_list'`.  

However, `P.plot().all[-1].all[i]` will give a `Graphics3D Object` for every appropriate `i` ( here there are 14 faces, so `i in range(14)`). Then we can recover the full list of faces by putting all faces together. 

```
sage: P = polytopes.truncated_octahedron()
sage: Q = P.plot().all[-1].all[:-1]
sage: my_face_list = [face for face_as_IFS in Q for face in face_as_IFS.face_list()] 
```

And then, I can call the `save(....stl')` method on an IndexFaceSet built out from this list.

```
sage: from sage.plot.plot3d.index_face_set import IndexFaceSet
sage: polytope_as_IFS = IndexFaceSet(my_face_list)
sage: polytope_as_IFS.save('machin.stl')
```

It will again fail, but for a different reason - the faces are not triangles. 

[Edit] By the way, I was testing on the develop branch checked out from the github repository.



---

archive/issue_comments_326655.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nwell, of course (but I should have said that), I meant \"try with the branch applied\"",
    "created_at": "2017-01-11T09:01:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22144#issuecomment-326655",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:11" align="right">comment:11</div>

well, of course (but I should have said that), I meant "try with the branch applied"



---

archive/issue_comments_326656.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nReplying to [@fchapoton](#comment:11):\n> well, of course (but I should have said that), I meant \"try with the branch applied\"\n\nOh, my fault.  \n\nOK, after switching branches it did worked. Coool!!!  \n\nThe text file looks fine and I verified that after import to Blender that there were not duplicated vertices and the normals are consistent.",
    "created_at": "2017-01-11T09:21:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22144#issuecomment-326656",
    "user": "https://github.com/sagetrac-ams"
}
```

<div id="comment:12" align="right">comment:12</div>

Replying to [@fchapoton](#comment:11):
> well, of course (but I should have said that), I meant "try with the branch applied"

Oh, my fault.  

OK, after switching branches it did worked. Coool!!!  

The text file looks fine and I verified that after import to Blender that there were not duplicated vertices and the normals are consistent.



---

archive/issue_comments_326657.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nPlease, can you explain at what point the truncated octahedron faces are triangulated in this example?   \n\nIt seems to me that you do it very early in the workflow, somewhere inside the `plot` call (anyway `P` has not method `triangulate`). But you don't need the triangulated faces for all 3D file formats exports. I agree you need triangular faces for `stl`, and `3ds`, however triangular faces are not required for `obj`.",
    "created_at": "2017-01-11T09:43:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22144#issuecomment-326657",
    "user": "https://github.com/sagetrac-ams"
}
```

<div id="comment:13" align="right">comment:13</div>

Please, can you explain at what point the truncated octahedron faces are triangulated in this example?   

It seems to me that you do it very early in the workflow, somewhere inside the `plot` call (anyway `P` has not method `triangulate`). But you don't need the triangulated faces for all 3D file formats exports. I agree you need triangular faces for `stl`, and `3ds`, however triangular faces are not required for `obj`.



---

archive/issue_comments_326658.json:
```json
{
    "body": "Blender screenshot showing inconsistent normals on the exported stl.",
    "created_at": "2017-01-11T10:04:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22144#issuecomment-326658",
    "user": "https://github.com/sagetrac-ams"
}
```

Blender screenshot showing inconsistent normals on the exported stl.



---

archive/issue_comments_326659.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nAttachment: **[blender_wrong_normals.png](https://github.com/sagemath/sage/files/ticket22144/blender_wrong_normals.png)**\n\nSorry, it seems I overlooked some inconsistently oriented normals on the first test. ![](https://github.com/sagemath/sage/files/ticket22144/blender_wrong_normals.png)\n\nYou can see after importing the `machin.stl` file generated with your example into Blender that part of the normals is pointing inwards and part is pointing outwards. Of course, it is possible to correct it afterwards, after exporting, but it would be nice to have normals of polyhedrons already consistent when saved to `stl` format.",
    "created_at": "2017-01-11T10:08:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22144#issuecomment-326659",
    "user": "https://github.com/sagetrac-ams"
}
```

<div id="comment:14" align="right">comment:14</div>

Attachment: **[blender_wrong_normals.png](https://github.com/sagemath/sage/files/ticket22144/blender_wrong_normals.png)**

Sorry, it seems I overlooked some inconsistently oriented normals on the first test. ![](https://github.com/sagemath/sage/files/ticket22144/blender_wrong_normals.png)

You can see after importing the `machin.stl` file generated with your example into Blender that part of the normals is pointing inwards and part is pointing outwards. Of course, it is possible to correct it afterwards, after exporting, but it would be nice to have normals of polyhedrons already consistent when saved to `stl` format.



---

archive/issue_comments_326660.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nsorry, I was not available this morning, I should be there after lunch\n\nyes, there is an issue about orientation of faces, that needs to be investigated.",
    "created_at": "2017-01-11T11:04:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22144#issuecomment-326660",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:15" align="right">comment:15</div>

sorry, I was not available this morning, I should be there after lunch

yes, there is an issue about orientation of faces, that needs to be investigated.



---

archive/issue_comments_326661.json:
```json
{
    "body": "Changed commit from **[`5f16820`](https://github.com/sagemath/sagetrac-mirror/commit/5f16820fa2dfb05e78674028bd097ec4ca0d55ec)** to **[`f71dba9`](https://github.com/sagemath/sagetrac-mirror/commit/f71dba9c48b8dc477d00a6a76397fb3a95bc7619)**",
    "created_at": "2017-01-11T12:55:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22144#issuecomment-326661",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`5f16820`](https://github.com/sagemath/sagetrac-mirror/commit/5f16820fa2dfb05e78674028bd097ec4ca0d55ec)** to **[`f71dba9`](https://github.com/sagemath/sagetrac-mirror/commit/f71dba9c48b8dc477d00a6a76397fb3a95bc7619)**



---

archive/issue_comments_326662.json:
```json
{
    "body": "<div id=\"comment:16\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5715c6d44bffd8e655f8c9aa591568a4c74a33d6\">5715c6d</a></td><td><code>Merge branch 'u/chapoton/22144' in 7.5.rc3</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f71dba9c48b8dc477d00a6a76397fb3a95bc7619\">f71dba9</a></td><td><code>trac 22144 trying to have normal vectors going outwards</code></td></tr></table>\n",
    "created_at": "2017-01-11T12:55:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22144#issuecomment-326662",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:16"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5715c6d44bffd8e655f8c9aa591568a4c74a33d6">5715c6d</a></td><td><code>Merge branch 'u/chapoton/22144' in 7.5.rc3</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f71dba9c48b8dc477d00a6a76397fb3a95bc7619">f71dba9</a></td><td><code>trac 22144 trying to have normal vectors going outwards</code></td></tr></table>




---

archive/issue_comments_326663.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\ncould you please try again with the new branch ?",
    "created_at": "2017-01-11T12:56:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22144#issuecomment-326663",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:17" align="right">comment:17</div>

could you please try again with the new branch ?



---

archive/issue_comments_326664.json:
```json
{
    "body": "Blender screenshot showing that normals are not yet consistently pointing outwards.",
    "created_at": "2017-01-11T13:54:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22144#issuecomment-326664",
    "user": "https://github.com/sagetrac-ams"
}
```

Blender screenshot showing that normals are not yet consistently pointing outwards.



---

archive/issue_comments_326665.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nAttachment: **[blender-still-wrong-normals.png](https://github.com/sagemath/sage/files/ticket22144/blender-still-wrong-normals.png)**\n\nThe export to `stl` still works but the normals are not yet consistent and pointing outwards.\n\n![](https://github.com/sagemath/sage/files/ticket22144/blender-still-wrong-normals.png)",
    "created_at": "2017-01-11T13:56:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22144#issuecomment-326665",
    "user": "https://github.com/sagetrac-ams"
}
```

<div id="comment:18" align="right">comment:18</div>

Attachment: **[blender-still-wrong-normals.png](https://github.com/sagemath/sage/files/ticket22144/blender-still-wrong-normals.png)**

The export to `stl` still works but the normals are not yet consistent and pointing outwards.

![](https://github.com/sagemath/sage/files/ticket22144/blender-still-wrong-normals.png)



---

archive/issue_comments_326666.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nreally ? ...surprising. Did you rebuild sage ? using \"sage -br\"\n\nWhen I try this using https://threejs.org/editor/\nit seems that all facets are correctly oriented..",
    "created_at": "2017-01-11T13:59:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22144#issuecomment-326666",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:19" align="right">comment:19</div>

really ? ...surprising. Did you rebuild sage ? using "sage -br"

When I try this using https://threejs.org/editor/
it seems that all facets are correctly oriented..



---

archive/issue_comments_326667.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nYes, I did rebuild. I will try uploading my model into the website you listed.  \n\nCan you explain how do you test using https://threejs.org/editor/ ? Where do you upload the stl, or do you use directly the faces as lists of vertices ?",
    "created_at": "2017-01-11T14:00:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22144#issuecomment-326667",
    "user": "https://github.com/sagetrac-ams"
}
```

<div id="comment:20" align="right">comment:20</div>

Yes, I did rebuild. I will try uploading my model into the website you listed.  

Can you explain how do you test using https://threejs.org/editor/ ? Where do you upload the stl, or do you use directly the faces as lists of vertices ?



---

archive/issue_comments_326668.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nWait, wait, what does it mean to rebuild using `sage -br` ? The way I did the rebuild was\n\n```\n$ git pull trac u/chapoton/22144\n$ make\n``` \n\nShould I pass a parameter to `make`, like `--force-something` or `--sage-br` in order to ensure that it recompiles the interesting function ?",
    "created_at": "2017-01-11T14:10:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22144#issuecomment-326668",
    "user": "https://github.com/sagetrac-ams"
}
```

<div id="comment:21" align="right">comment:21</div>

Wait, wait, what does it mean to rebuild using `sage -br` ? The way I did the rebuild was

```
$ git pull trac u/chapoton/22144
$ make
``` 

Should I pass a parameter to `make`, like `--force-something` or `--sage-br` in order to ensure that it recompiles the interesting function ?



---

archive/issue_comments_326669.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nI upload the stl (using the file menu / import). When facets were wrong, some of them did no appear until one ask (in the geometry panel) to show every triangle with both sides.",
    "created_at": "2017-01-11T14:11:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22144#issuecomment-326669",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:22" align="right">comment:22</div>

I upload the stl (using the file menu / import). When facets were wrong, some of them did no appear until one ask (in the geometry panel) to show every triangle with both sides.



---

archive/issue_comments_326670.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\n\"sage -br\" should be equivalent to \"make\" here. It does not care about building the doc, which is faster in general. In some sense \"sage -br\" is like a small-scale \"make\", that is sufficient very often when you do not switch branch",
    "created_at": "2017-01-11T14:13:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22144#issuecomment-326670",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:23" align="right">comment:23</div>

"sage -br" should be equivalent to "make" here. It does not care about building the doc, which is faster in general. In some sense "sage -br" is like a small-scale "make", that is sufficient very often when you do not switch branch



---

archive/issue_comments_326671.json:
```json
{
    "body": "Blender screenshot of consistent normals pointing outwards.",
    "created_at": "2017-01-11T14:20:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22144#issuecomment-326671",
    "user": "https://github.com/sagetrac-ams"
}
```

Blender screenshot of consistent normals pointing outwards.



---

archive/issue_comments_326672.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nAttachment: **[blender-consistent-normals.png](https://github.com/sagemath/sage/files/ticket22144/blender-consistent-normals.png)**\n\nOk, I see now that I was not looking at the good file. I looked at the old version of the `stl`, sorry.  \n\nThe version generated with the new code has consistent normals pointing outwards. \n\n![](https://github.com/sagemath/sage/files/ticket22144/blender-consistent-normals.png)\n\ncongrats, so how did you got it ?",
    "created_at": "2017-01-11T14:21:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22144#issuecomment-326672",
    "user": "https://github.com/sagetrac-ams"
}
```

<div id="comment:24" align="right">comment:24</div>

Attachment: **[blender-consistent-normals.png](https://github.com/sagemath/sage/files/ticket22144/blender-consistent-normals.png)**

Ok, I see now that I was not looking at the good file. I looked at the old version of the `stl`, sorry.  

The version generated with the new code has consistent normals pointing outwards. 

![](https://github.com/sagemath/sage/files/ticket22144/blender-consistent-normals.png)

congrats, so how did you got it ?



---

archive/issue_comments_326673.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nok, good.\n\nI just reversed the list the vertices when needed. You can look at my latest commit by clicking on the link \"commits\" besides the name of the branch near the top of this page",
    "created_at": "2017-01-11T14:22:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22144#issuecomment-326673",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:25" align="right">comment:25</div>

ok, good.

I just reversed the list the vertices when needed. You can look at my latest commit by clicking on the link "commits" besides the name of the branch near the top of this page



---

archive/issue_comments_326674.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -4,4 +4,6 @@\n \n Also enhance the STL ouput by cutting no-triangular faces into triangles.\n \n+and make sure that all faces are oriented outwards.\n+\n This may also help simplify further the PLY export later.\n``````\n",
    "created_at": "2017-01-11T14:27:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22144#issuecomment-326674",
    "user": "https://github.com/fchapoton"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -4,4 +4,6 @@
 
 Also enhance the STL ouput by cutting no-triangular faces into triangles.
 
+and make sure that all faces are oriented outwards.
+
 This may also help simplify further the PLY export later.
``````




---

archive/issue_comments_326675.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nOh, thank you ! Actually, the link (commits) disappear when the site auto-updates with new inputs to the ticket's discussion (at least on this computer). Updating the site in the browser solves this issue.",
    "created_at": "2017-01-11T14:30:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22144#issuecomment-326675",
    "user": "https://github.com/sagetrac-ams"
}
```

<div id="comment:27" align="right">comment:27</div>

Oh, thank you ! Actually, the link (commits) disappear when the site auto-updates with new inputs to the ticket's discussion (at least on this computer). Updating the site in the browser solves this issue.



---

archive/issue_comments_326676.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nHow do you know that the `facet_equation.A()` is already pointing outwards ? \n\n(cf. `_init_solid_3d(self, polyhedron)` in the commit f71dba9c48b8dc477d00a6a76397fb3a95bc7619)",
    "created_at": "2017-01-11T14:38:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22144#issuecomment-326676",
    "user": "https://github.com/sagetrac-ams"
}
```

<div id="comment:28" align="right">comment:28</div>

How do you know that the `facet_equation.A()` is already pointing outwards ? 

(cf. `_init_solid_3d(self, polyhedron)` in the commit f71dba9c48b8dc477d00a6a76397fb3a95bc7619)



---

archive/issue_comments_326677.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nWell, I assumed that the facet_equations are coming from the defining inequations of the polytope, so must be all coherent.\n\nIt was either everybody inwards or everybody outwards, so I tried < 0 and it works.",
    "created_at": "2017-01-11T14:41:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22144#issuecomment-326677",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:29" align="right">comment:29</div>

Well, I assumed that the facet_equations are coming from the defining inequations of the polytope, so must be all coherent.

It was either everybody inwards or everybody outwards, so I tried < 0 and it works.



---

archive/issue_comments_326678.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nSo you think it will be *always* everybody outwards ? \n\nI was also thinking that this method will not translate easily to polyhedra that are not convex polytopes. But I am not even sure whether you can define those in Sage... and anyway, if it is possible to have, let say, a genus 1 polyhedron, it would be a different question and a different ticket.",
    "created_at": "2017-01-11T14:51:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22144#issuecomment-326678",
    "user": "https://github.com/sagetrac-ams"
}
```

<div id="comment:30" align="right">comment:30</div>

So you think it will be *always* everybody outwards ? 

I was also thinking that this method will not translate easily to polyhedra that are not convex polytopes. But I am not even sure whether you can define those in Sage... and anyway, if it is possible to have, let say, a genus 1 polyhedron, it would be a different question and a different ticket.



---

archive/issue_comments_326679.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nWell, I have not checked this, really, I admit. The idea is that inequalities are always stored as \"vector . (?,?,?) + scalar >= 0\". So taking the vector part of a facet should give the same normal in a coherent way, unless somebody somewhere has decided to change signs for some strange reason.\n\nI have launched my patchbot to check that no doctest is broken anywhere else in sage.\n\nMaybe you should check that some of the examples in Polyhedron? still plot as expected. In particular for open polyhedra, cones, etc. A priori, there should be no problem, but it's better to check a little bit.",
    "created_at": "2017-01-11T14:58:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22144#issuecomment-326679",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:31" align="right">comment:31</div>

Well, I have not checked this, really, I admit. The idea is that inequalities are always stored as "vector . (?,?,?) + scalar >= 0". So taking the vector part of a facet should give the same normal in a coherent way, unless somebody somewhere has decided to change signs for some strange reason.

I have launched my patchbot to check that no doctest is broken anywhere else in sage.

Maybe you should check that some of the examples in Polyhedron? still plot as expected. In particular for open polyhedra, cones, etc. A priori, there should be no problem, but it's better to check a little bit.



---

archive/issue_comments_326680.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nOk, I'll do that. \n\nI have one more question, I cannot figure out in the code where do you actually triangulate the polyhedron's faces. I am worried about it because I am interested in both `stl` and `obj` formats for export and in `obj` I prefer to use *quadri*s rather than *tri*s.",
    "created_at": "2017-01-11T15:05:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22144#issuecomment-326680",
    "user": "https://github.com/sagetrac-ams"
}
```

<div id="comment:32" align="right">comment:32</div>

Ok, I'll do that. 

I have one more question, I cannot figure out in the code where do you actually triangulate the polyhedron's faces. I am worried about it because I am interested in both `stl` and `obj` formats for export and in `obj` I prefer to use *quadri*s rather than *tri*s.



---

archive/issue_comments_326681.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nthe chopping into triangles is done in the commit\n\ntrac 22144 enhance stl ouput (for polyhedra in particular)\n\nand happens inside the stl string method, so will not affect other file format exports.\n\nyou can see the context by clicking on the commit and then enlarging the value of \"context\" in the little menu \"diff options\" on the right",
    "created_at": "2017-01-11T15:08:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22144#issuecomment-326681",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:33" align="right">comment:33</div>

the chopping into triangles is done in the commit

trac 22144 enhance stl ouput (for polyhedra in particular)

and happens inside the stl string method, so will not affect other file format exports.

you can see the context by clicking on the commit and then enlarging the value of "context" in the little menu "diff options" on the right



---

archive/issue_comments_326682.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nby the way, the better normals for facets should also have enhanced the obj output..",
    "created_at": "2017-01-11T15:10:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22144#issuecomment-326682",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:34" align="right">comment:34</div>

by the way, the better normals for facets should also have enhanced the obj output..



---

archive/issue_comments_326683.json:
```json
{
    "body": "<div id=\"comment:35\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d201dfbbf5f4dc6d95f21b978ddcc7744f70ac56\">d201dfb</a></td><td><code>trac 22144 adding a doctest for STL of many-sided faces</code></td></tr></table>\n",
    "created_at": "2017-01-11T15:28:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22144#issuecomment-326683",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:35"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d201dfbbf5f4dc6d95f21b978ddcc7744f70ac56">d201dfb</a></td><td><code>trac 22144 adding a doctest for STL of many-sided faces</code></td></tr></table>




---

archive/issue_comments_326684.json:
```json
{
    "body": "Changed commit from **[`f71dba9`](https://github.com/sagemath/sagetrac-mirror/commit/f71dba9c48b8dc477d00a6a76397fb3a95bc7619)** to **[`d201dfb`](https://github.com/sagemath/sagetrac-mirror/commit/d201dfbbf5f4dc6d95f21b978ddcc7744f70ac56)**",
    "created_at": "2017-01-11T15:28:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22144#issuecomment-326684",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`f71dba9`](https://github.com/sagemath/sagetrac-mirror/commit/f71dba9c48b8dc477d00a6a76397fb3a95bc7619)** to **[`d201dfb`](https://github.com/sagemath/sagetrac-mirror/commit/d201dfbbf5f4dc6d95f21b978ddcc7744f70ac56)**



---

archive/issue_comments_326685.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nI went trough all of the examples in `plot3d?` The plot looked reasonably good. But did you wanted to test the on-screen image or the `stl` export ? \n\nNone of those examples could export to `stl` before (I mean in Sage 7.4), but now, some of them manage to actually export : \n  \n\n```\nsage: plot3d(lambda x, y: x^2 + y^2, (-2,2), (-2,2)).save('rho2.stl')\n```\n\n```\nsage: plot3d(sin(x*y), (x, -pi, pi), (y, -pi, pi)).save('sinxy.stl')\n```\n\nand many others.\n\nThose who do not work, have options added (other than `plot_points` or `mesh` or `transformation`), like for example:\n\n```\nsage: x,y = var('x,y')\nsage: P = plot3d(x+y+sin(x*y), (x,-10,10),(y,-10,10), opacity=0.87, color='blue')\nsage: Q = plot3d(x-2*y-cos(x*y),(x,-10,10),(y,-10,10),opacity=0.3,color='red')\nsage: (P+Q).save('twoplanes.stl')\n```",
    "created_at": "2017-01-11T16:12:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22144#issuecomment-326685",
    "user": "https://github.com/sagetrac-ams"
}
```

<div id="comment:36" align="right">comment:36</div>

I went trough all of the examples in `plot3d?` The plot looked reasonably good. But did you wanted to test the on-screen image or the `stl` export ? 

None of those examples could export to `stl` before (I mean in Sage 7.4), but now, some of them manage to actually export : 
  

```
sage: plot3d(lambda x, y: x^2 + y^2, (-2,2), (-2,2)).save('rho2.stl')
```

```
sage: plot3d(sin(x*y), (x, -pi, pi), (y, -pi, pi)).save('sinxy.stl')
```

and many others.

Those who do not work, have options added (other than `plot_points` or `mesh` or `transformation`), like for example:

```
sage: x,y = var('x,y')
sage: P = plot3d(x+y+sin(x*y), (x,-10,10),(y,-10,10), opacity=0.87, color='blue')
sage: Q = plot3d(x-2*y-cos(x*y),(x,-10,10),(y,-10,10),opacity=0.3,color='red')
sage: (P+Q).save('twoplanes.stl')
```



---

archive/issue_comments_326686.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nNo, I was just meaning to check the displayed plots. Thanks for doing that.\n\nYour job as a reviewer, if you accept it:\n\n- check that all doctests pass (wait for the bot, and run the tests yourself on the modified files)\n- check that the doc is good and correctly formatted (should be ok, but you can think of improvements)\n- be sure that this is an improvement over the existing situation\n- ideally, be sure that there is no better solution to do the same thing (should not apply here)\n\nThis should be an easy review, I think. If you have more questions or suggestions, I am all ears. Once you are satisfied, set to positive review and put your name in the reviewer field at top of the page.\n\nI also think one could keep further enhancements to later tickets.",
    "created_at": "2017-01-11T16:18:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22144#issuecomment-326686",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:37" align="right">comment:37</div>

No, I was just meaning to check the displayed plots. Thanks for doing that.

Your job as a reviewer, if you accept it:

- check that all doctests pass (wait for the bot, and run the tests yourself on the modified files)
- check that the doc is good and correctly formatted (should be ok, but you can think of improvements)
- be sure that this is an improvement over the existing situation
- ideally, be sure that there is no better solution to do the same thing (should not apply here)

This should be an easy review, I think. If you have more questions or suggestions, I am all ears. Once you are satisfied, set to positive review and put your name in the reviewer field at top of the page.

I also think one could keep further enhancements to later tickets.



---

archive/issue_comments_326687.json:
```json
{
    "body": "Changed keywords from none to **days82**",
    "created_at": "2017-01-11T17:52:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22144#issuecomment-326687",
    "user": "https://github.com/VivianePons"
}
```

Changed keywords from none to **days82**



---

archive/issue_comments_326688.json:
```json
{
    "body": "Changed commit from **[`d201dfb`](https://github.com/sagemath/sagetrac-mirror/commit/d201dfbbf5f4dc6d95f21b978ddcc7744f70ac56)** to **[`ed1815a`](https://github.com/sagemath/sagetrac-mirror/commit/ed1815abd41de4c68c04a3224647099f9e02d8fe)**",
    "created_at": "2017-01-11T18:15:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22144#issuecomment-326688",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`d201dfb`](https://github.com/sagemath/sagetrac-mirror/commit/d201dfbbf5f4dc6d95f21b978ddcc7744f70ac56)** to **[`ed1815a`](https://github.com/sagemath/sagetrac-mirror/commit/ed1815abd41de4c68c04a3224647099f9e02d8fe)**



---

archive/issue_comments_326689.json:
```json
{
    "body": "<div id=\"comment:39\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ed1815abd41de4c68c04a3224647099f9e02d8fe\">ed1815a</a></td><td><code>trac 22144 fixing one doctest</code></td></tr></table>\n",
    "created_at": "2017-01-11T18:15:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22144#issuecomment-326689",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:39"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ed1815abd41de4c68c04a3224647099f9e02d8fe">ed1815a</a></td><td><code>trac 22144 fixing one doctest</code></td></tr></table>




---

archive/issue_comments_326690.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nThere is one test \n\n`$ sage -t src/sage/geometry/polyhedron/plot.py`  \n\nthat fails.\n\n```\nFailed example:\n    proj.polygons\nExpected:\n    [[2, 0, 1], [3, 0, 1], [3, 0, 2], [3, 1, 2]]\nGot:\n    [[1, 0, 2], [3, 0, 1], [2, 0, 3], [3, 1, 2]]\n```\n\nI looked through the example, and exported the stl in this precise example. It works, and normal are consistent, so maybe you should change the expected result accordingly in the doc.",
    "created_at": "2017-01-11T23:15:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22144#issuecomment-326690",
    "user": "https://github.com/sagetrac-ams"
}
```

<div id="comment:40" align="right">comment:40</div>

There is one test 

`$ sage -t src/sage/geometry/polyhedron/plot.py`  

that fails.

```
Failed example:
    proj.polygons
Expected:
    [[2, 0, 1], [3, 0, 1], [3, 0, 2], [3, 1, 2]]
Got:
    [[1, 0, 2], [3, 0, 1], [2, 0, 3], [3, 1, 2]]
```

I looked through the example, and exported the stl in this precise example. It works, and normal are consistent, so maybe you should change the expected result accordingly in the doc.



---

archive/issue_comments_326691.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nyes, done already",
    "created_at": "2017-01-12T07:33:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22144#issuecomment-326691",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:41" align="right">comment:41</div>

yes, done already



---

archive/issue_events_310029.json:
```json
{
    "actor": "https://github.com/sagetrac-ams",
    "created_at": "2017-01-12T09:34:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22144",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22144#event-310029"
}
```



---

archive/issue_events_310030.json:
```json
{
    "actor": "https://github.com/sagetrac-ams",
    "created_at": "2017-01-12T09:34:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22144",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22144#event-310030"
}
```



---

archive/issue_comments_326692.json:
```json
{
    "body": "Reviewer: **Alba M\u00e1laga**",
    "created_at": "2017-01-12T09:34:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22144#issuecomment-326692",
    "user": "https://github.com/sagetrac-ams"
}
```

Reviewer: **Alba Málaga**



---

archive/issue_comments_326693.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nGood job! All tests passed on my computer and the documentation looks good.",
    "created_at": "2017-01-12T09:34:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22144#issuecomment-326693",
    "user": "https://github.com/sagetrac-ams"
}
```

<div id="comment:42" align="right">comment:42</div>

Good job! All tests passed on my computer and the documentation looks good.



---

archive/issue_comments_326694.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\na sequel in #22196, to use the much more efficient binary STL format instead",
    "created_at": "2017-01-17T16:38:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22144#issuecomment-326694",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:43" align="right">comment:43</div>

a sequel in #22196, to use the much more efficient binary STL format instead



---

archive/issue_comments_326695.json:
```json
{
    "body": "Changed branch from **[u/chapoton/22144](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/22144)** to **[`ed1815a`](https://github.com/sagemath/sagetrac-mirror/commit/ed1815abd41de4c68c04a3224647099f9e02d8fe)**",
    "created_at": "2017-01-21T21:21:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22144#issuecomment-326695",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/chapoton/22144](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/22144)** to **[`ed1815a`](https://github.com/sagemath/sagetrac-mirror/commit/ed1815abd41de4c68c04a3224647099f9e02d8fe)**



---

archive/issue_events_310031.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-01-21T21:21:38Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22144",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22144#event-310031"
}
```



---

archive/issue_events_310032.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "7ac3b20f97f959d6891f173308b99d7428afb575",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2017-01-21T21:21:38Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/22144",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22144#event-310032"
}
```
