# Issue 22144: simplify the Graphics3d object of polyhedra

archive/issues_021907.json:
```json
{
    "body": "Currently, every face is in its own IndexFaceSet.\n\nOne can use one IndexFaceSet for all the faces together.\n\nAlso enhance the STL ouput by cutting no-triangular faces into triangles.\n\nand make sure that all faces are oriented outwards.\n\nThis may also help simplify further the PLY export later.\n\nCC:  @ohanar @kcrisman @nilesjohnson vivianepons ams\n\nKeywords: days82\n\nReviewer: Alba M\u00e1laga\n\nAuthor: Fr\u00e9d\u00e9ric Chapoton\n\nBranch: ed1815abd41de4c68c04a3224647099f9e02d8fe\n\nCommit: ed1815abd41de4c68c04a3224647099f9e02d8fe\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/22144\n\n",
    "closed_at": "2017-01-21T21:21:38Z",
    "created_at": "2017-01-06T14:17:56Z",
    "labels": [
        "component: graphics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.5",
    "title": "simplify the Graphics3d object of polyhedra",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22144",
    "user": "https://github.com/fchapoton"
}
```
Currently, every face is in its own IndexFaceSet.

One can use one IndexFaceSet for all the faces together.

Also enhance the STL ouput by cutting no-triangular faces into triangles.

and make sure that all faces are oriented outwards.

This may also help simplify further the PLY export later.

CC:  @ohanar @kcrisman @nilesjohnson vivianepons ams

Keywords: days82

Reviewer: Alba Málaga

Author: Frédéric Chapoton

Branch: ed1815abd41de4c68c04a3224647099f9e02d8fe

Commit: ed1815abd41de4c68c04a3224647099f9e02d8fe

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/22144





---

archive/issue_comments_303667.json:
```json
{
    "body": "<a id='comment:1'></a>New commits:",
    "created_at": "2017-01-06T14:18:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22144#issuecomment-303667",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:1'></a>New commits:



---

archive/issue_comments_303668.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-01-06T14:18:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22144#issuecomment-303668",
    "user": "https://github.com/fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_303669.json:
```json
{
    "body": "<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-01-06T16:41:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22144#issuecomment-303669",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_303670.json:
```json
{
    "body": "<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-01-06T16:59:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22144#issuecomment-303670",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_303671.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-01-07T08:18:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22144#issuecomment-303671",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_303672.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-01-10T12:33:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22144#issuecomment-303672",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_303673.json:
```json
{
    "body": "<a id='comment:9'></a>could you please try\n\n```\nsage: P = polytopes.truncated_octahedron()\nsage: Q = P.plot().all[-1]\nsage: Q.save('machin.stl')\n```\nit works for me. The second line isolate the IndexFaceSet from other bells and whistles (plot of edges and vertices)\n\nuseful: https://threejs.org/editor/",
    "created_at": "2017-01-10T20:18:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22144#issuecomment-303673",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:9'></a>could you please try

```
sage: P = polytopes.truncated_octahedron()
sage: Q = P.plot().all[-1]
sage: Q.save('machin.stl')
```
it works for me. The second line isolate the IndexFaceSet from other bells and whistles (plot of edges and vertices)

useful: https://threejs.org/editor/



---

archive/issue_comments_303674.json:
```json
{
    "body": "<a id='comment:10'></a>I tried your example.  \n\nFor me, the second line still was a `Graphics3DGroup` so no `face_list` attribute that `save(...stl)` uses at this point in its code. So `Q.save('machin.stl')` fails with the error message `'Graphics3dGroup' object has no attribute 'face_list'`.  \n\nHowever, `P.plot().all[-1].all[i]` will give a `Graphics3D Object` for every appropriate `i` ( here there are 14 faces, so `i in range(14)`). Then we can recover the full list of faces by putting all faces together. \n\n```\nsage: P = polytopes.truncated_octahedron()\nsage: Q = P.plot().all[-1].all[:-1]\nsage: my_face_list = [face for face_as_IFS in Q for face in face_as_IFS.face_list()] \n```\n\nAnd then, I can call the `save(....stl')` method on an IndexFaceSet built out from this list.\n\n```\nsage: from sage.plot.plot3d.index_face_set import IndexFaceSet\nsage: polytope_as_IFS = IndexFaceSet(my_face_list)\nsage: polytope_as_IFS.save('machin.stl')\n```\n\nIt will again fail, but for a different reason - the faces are not triangles. \n\n[Edit] By the way, I was testing on the develop branch checked out from the github repository.",
    "created_at": "2017-01-11T08:59:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22144#issuecomment-303674",
    "user": "https://trac.sagemath.org/admin/accounts/users/ams"
}
```

<a id='comment:10'></a>I tried your example.  

For me, the second line still was a `Graphics3DGroup` so no `face_list` attribute that `save(...stl)` uses at this point in its code. So `Q.save('machin.stl')` fails with the error message `'Graphics3dGroup' object has no attribute 'face_list'`.  

However, `P.plot().all[-1].all[i]` will give a `Graphics3D Object` for every appropriate `i` ( here there are 14 faces, so `i in range(14)`). Then we can recover the full list of faces by putting all faces together. 

```
sage: P = polytopes.truncated_octahedron()
sage: Q = P.plot().all[-1].all[:-1]
sage: my_face_list = [face for face_as_IFS in Q for face in face_as_IFS.face_list()] 
```

And then, I can call the `save(....stl')` method on an IndexFaceSet built out from this list.

```
sage: from sage.plot.plot3d.index_face_set import IndexFaceSet
sage: polytope_as_IFS = IndexFaceSet(my_face_list)
sage: polytope_as_IFS.save('machin.stl')
```

It will again fail, but for a different reason - the faces are not triangles. 

[Edit] By the way, I was testing on the develop branch checked out from the github repository.



---

archive/issue_comments_303675.json:
```json
{
    "body": "<a id='comment:11'></a>well, of course (but I should have said that), I meant \"try with the branch applied\"",
    "created_at": "2017-01-11T09:01:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22144#issuecomment-303675",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:11'></a>well, of course (but I should have said that), I meant "try with the branch applied"



---

archive/issue_comments_303676.json:
```json
{
    "body": "<a id='comment:12'></a>Replying to [comment:11 chapoton]:\n> well, of course (but I should have said that), I meant \"try with the branch applied\"\n\n\nOh, my fault.  \n\nOK, after switching branches it did worked. Coool!!!  \n\nThe text file looks fine and I verified that after import to Blender that there were not duplicated vertices and the normals are consistent.",
    "created_at": "2017-01-11T09:21:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22144#issuecomment-303676",
    "user": "https://trac.sagemath.org/admin/accounts/users/ams"
}
```

<a id='comment:12'></a>Replying to [comment:11 chapoton]:
> well, of course (but I should have said that), I meant "try with the branch applied"


Oh, my fault.  

OK, after switching branches it did worked. Coool!!!  

The text file looks fine and I verified that after import to Blender that there were not duplicated vertices and the normals are consistent.



---

archive/issue_comments_303677.json:
```json
{
    "body": "<a id='comment:13'></a>Please, can you explain at what point the truncated octahedron faces are triangulated in this example?   \n\nIt seems to me that you do it very early in the workflow, somewhere inside the `plot` call (anyway `P` has not method `triangulate`). But you don't need the triangulated faces for all 3D file formats exports. I agree you need triangular faces for `stl`, and `3ds`, however triangular faces are not required for `obj`.",
    "created_at": "2017-01-11T09:43:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22144#issuecomment-303677",
    "user": "https://trac.sagemath.org/admin/accounts/users/ams"
}
```

<a id='comment:13'></a>Please, can you explain at what point the truncated octahedron faces are triangulated in this example?   

It seems to me that you do it very early in the workflow, somewhere inside the `plot` call (anyway `P` has not method `triangulate`). But you don't need the triangulated faces for all 3D file formats exports. I agree you need triangular faces for `stl`, and `3ds`, however triangular faces are not required for `obj`.



---

archive/issue_comments_303678.json:
```json
{
    "body": "Blender screenshot showing inconsistent normals on the exported stl.",
    "created_at": "2017-01-11T10:04:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22144#issuecomment-303678",
    "user": "https://trac.sagemath.org/admin/accounts/users/ams"
}
```

Blender screenshot showing inconsistent normals on the exported stl.



---

archive/issue_comments_303679.json:
```json
{
    "body": "<a id='comment:14'></a>Attachment [blender_wrong_normals.png](tarball://root/attachments/some-uuid/ticket22144/blender_wrong_normals.png) by ams created at 2017-01-11 10:08:51\n\nSorry, it seems I overlooked some inconsistently oriented normals on the first test. ![](blender_wrong_normals.png)\n\nYou can see after importing the `machin.stl` file generated with your example into Blender that part of the normals is pointing inwards and part is pointing outwards. Of course, it is possible to correct it afterwards, after exporting, but it would be nice to have normals of polyhedrons already consistent when saved to `stl` format.",
    "created_at": "2017-01-11T10:08:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22144#issuecomment-303679",
    "user": "https://trac.sagemath.org/admin/accounts/users/ams"
}
```

<a id='comment:14'></a>Attachment [blender_wrong_normals.png](tarball://root/attachments/some-uuid/ticket22144/blender_wrong_normals.png) by ams created at 2017-01-11 10:08:51

Sorry, it seems I overlooked some inconsistently oriented normals on the first test. ![](blender_wrong_normals.png)

You can see after importing the `machin.stl` file generated with your example into Blender that part of the normals is pointing inwards and part is pointing outwards. Of course, it is possible to correct it afterwards, after exporting, but it would be nice to have normals of polyhedrons already consistent when saved to `stl` format.



---

archive/issue_comments_303680.json:
```json
{
    "body": "<a id='comment:15'></a>sorry, I was not available this morning, I should be there after lunch\n\nyes, there is an issue about orientation of faces, that needs to be investigated.",
    "created_at": "2017-01-11T11:04:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22144#issuecomment-303680",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:15'></a>sorry, I was not available this morning, I should be there after lunch

yes, there is an issue about orientation of faces, that needs to be investigated.



---

archive/issue_comments_303681.json:
```json
{
    "body": "<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-01-11T12:55:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22144#issuecomment-303681",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_303682.json:
```json
{
    "body": "<a id='comment:17'></a>could you please try again with the new branch ?",
    "created_at": "2017-01-11T12:56:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22144#issuecomment-303682",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:17'></a>could you please try again with the new branch ?



---

archive/issue_comments_303683.json:
```json
{
    "body": "Blender screenshot showing that normals are not yet consistently pointing outwards.",
    "created_at": "2017-01-11T13:54:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22144#issuecomment-303683",
    "user": "https://trac.sagemath.org/admin/accounts/users/ams"
}
```

Blender screenshot showing that normals are not yet consistently pointing outwards.



---

archive/issue_comments_303684.json:
```json
{
    "body": "<a id='comment:18'></a>Attachment [blender-still-wrong-normals.png](tarball://root/attachments/some-uuid/ticket22144/blender-still-wrong-normals.png) by ams created at 2017-01-11 13:56:42\n\nThe export to `stl` still works but the normals are not yet consistent and pointing outwards.\n\n![](blender-still-wrong-normals.png)",
    "created_at": "2017-01-11T13:56:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22144#issuecomment-303684",
    "user": "https://trac.sagemath.org/admin/accounts/users/ams"
}
```

<a id='comment:18'></a>Attachment [blender-still-wrong-normals.png](tarball://root/attachments/some-uuid/ticket22144/blender-still-wrong-normals.png) by ams created at 2017-01-11 13:56:42

The export to `stl` still works but the normals are not yet consistent and pointing outwards.

![](blender-still-wrong-normals.png)



---

archive/issue_comments_303685.json:
```json
{
    "body": "<a id='comment:19'></a>really ? ...surprising. Did you rebuild sage ? using \"sage -br\"\n\nWhen I try this using https://threejs.org/editor/\nit seems that all facets are correctly oriented..",
    "created_at": "2017-01-11T13:59:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22144#issuecomment-303685",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:19'></a>really ? ...surprising. Did you rebuild sage ? using "sage -br"

When I try this using https://threejs.org/editor/
it seems that all facets are correctly oriented..



---

archive/issue_comments_303686.json:
```json
{
    "body": "<a id='comment:20'></a>Yes, I did rebuild. I will try uploading my model into the website you listed.  \n\nCan you explain how do you test using https://threejs.org/editor/ ? Where do you upload the stl, or do you use directly the faces as lists of vertices ?",
    "created_at": "2017-01-11T14:00:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22144#issuecomment-303686",
    "user": "https://trac.sagemath.org/admin/accounts/users/ams"
}
```

<a id='comment:20'></a>Yes, I did rebuild. I will try uploading my model into the website you listed.  

Can you explain how do you test using https://threejs.org/editor/ ? Where do you upload the stl, or do you use directly the faces as lists of vertices ?



---

archive/issue_comments_303687.json:
```json
{
    "body": "<a id='comment:21'></a>Wait, wait, what does it mean to rebuild using `sage -br` ? The way I did the rebuild was\n\n```\n$ git pull trac u/chapoton/22144\n$ make\n``` \n\nShould I pass a parameter to `make`, like `--force-something` or `--sage-br` in order to ensure that it recompiles the interesting function ?",
    "created_at": "2017-01-11T14:10:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22144#issuecomment-303687",
    "user": "https://trac.sagemath.org/admin/accounts/users/ams"
}
```

<a id='comment:21'></a>Wait, wait, what does it mean to rebuild using `sage -br` ? The way I did the rebuild was

```
$ git pull trac u/chapoton/22144
$ make
``` 

Should I pass a parameter to `make`, like `--force-something` or `--sage-br` in order to ensure that it recompiles the interesting function ?



---

archive/issue_comments_303688.json:
```json
{
    "body": "<a id='comment:22'></a>I upload the stl (using the file menu / import). When facets were wrong, some of them did no appear until one ask (in the geometry panel) to show every triangle with both sides.",
    "created_at": "2017-01-11T14:11:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22144#issuecomment-303688",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:22'></a>I upload the stl (using the file menu / import). When facets were wrong, some of them did no appear until one ask (in the geometry panel) to show every triangle with both sides.



---

archive/issue_comments_303689.json:
```json
{
    "body": "<a id='comment:23'></a>\"sage -br\" should be equivalent to \"make\" here. It does not care about building the doc, which is faster in general. In some sense \"sage -br\" is like a small-scale \"make\", that is sufficient very often when you do not switch branch",
    "created_at": "2017-01-11T14:13:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22144#issuecomment-303689",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:23'></a>"sage -br" should be equivalent to "make" here. It does not care about building the doc, which is faster in general. In some sense "sage -br" is like a small-scale "make", that is sufficient very often when you do not switch branch



---

archive/issue_comments_303690.json:
```json
{
    "body": "Blender screenshot of consistent normals pointing outwards.",
    "created_at": "2017-01-11T14:20:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22144#issuecomment-303690",
    "user": "https://trac.sagemath.org/admin/accounts/users/ams"
}
```

Blender screenshot of consistent normals pointing outwards.



---

archive/issue_comments_303691.json:
```json
{
    "body": "<a id='comment:24'></a>Attachment [blender-consistent-normals.png](tarball://root/attachments/some-uuid/ticket22144/blender-consistent-normals.png) by ams created at 2017-01-11 14:21:18\n\nOk, I see now that I was not looking at the good file. I looked at the old version of the `stl`, sorry.  \n\nThe version generated with the new code has consistent normals pointing outwards. \n\n![](blender-consistent-normals.png)\n\ncongrats, so how did you got it ?",
    "created_at": "2017-01-11T14:21:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22144#issuecomment-303691",
    "user": "https://trac.sagemath.org/admin/accounts/users/ams"
}
```

<a id='comment:24'></a>Attachment [blender-consistent-normals.png](tarball://root/attachments/some-uuid/ticket22144/blender-consistent-normals.png) by ams created at 2017-01-11 14:21:18

Ok, I see now that I was not looking at the good file. I looked at the old version of the `stl`, sorry.  

The version generated with the new code has consistent normals pointing outwards. 

![](blender-consistent-normals.png)

congrats, so how did you got it ?



---

archive/issue_comments_303692.json:
```json
{
    "body": "<a id='comment:25'></a>ok, good.\n\nI just reversed the list the vertices when needed. You can look at my latest commit by clicking on the link \"commits\" besides the name of the branch near the top of this page",
    "created_at": "2017-01-11T14:22:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22144#issuecomment-303692",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:25'></a>ok, good.

I just reversed the list the vertices when needed. You can look at my latest commit by clicking on the link "commits" besides the name of the branch near the top of this page



---

archive/issue_comments_303693.json:
```json
{
    "body": "<a id='comment:27'></a>Oh, thank you ! Actually, the link (commits) disappear when the site auto-updates with new inputs to the ticket's discussion (at least on this computer). Updating the site in the browser solves this issue.",
    "created_at": "2017-01-11T14:30:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22144#issuecomment-303693",
    "user": "https://trac.sagemath.org/admin/accounts/users/ams"
}
```

<a id='comment:27'></a>Oh, thank you ! Actually, the link (commits) disappear when the site auto-updates with new inputs to the ticket's discussion (at least on this computer). Updating the site in the browser solves this issue.



---

archive/issue_comments_303694.json:
```json
{
    "body": "<a id='comment:28'></a>How do you know that the `facet_equation.A()` is already pointing outwards ? \n\n(cf. `_init_solid_3d(self, polyhedron)` in the commit f71dba9c48b8dc477d00a6a76397fb3a95bc7619)",
    "created_at": "2017-01-11T14:38:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22144#issuecomment-303694",
    "user": "https://trac.sagemath.org/admin/accounts/users/ams"
}
```

<a id='comment:28'></a>How do you know that the `facet_equation.A()` is already pointing outwards ? 

(cf. `_init_solid_3d(self, polyhedron)` in the commit f71dba9c48b8dc477d00a6a76397fb3a95bc7619)



---

archive/issue_comments_303695.json:
```json
{
    "body": "<a id='comment:29'></a>Well, I assumed that the facet_equations are coming from the defining inequations of the polytope, so must be all coherent.\n\nIt was either everybody inwards or everybody outwards, so I tried < 0 and it works.",
    "created_at": "2017-01-11T14:41:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22144#issuecomment-303695",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:29'></a>Well, I assumed that the facet_equations are coming from the defining inequations of the polytope, so must be all coherent.

It was either everybody inwards or everybody outwards, so I tried < 0 and it works.



---

archive/issue_comments_303696.json:
```json
{
    "body": "<a id='comment:30'></a>So you think it will be *always* everybody outwards ? \n\nI was also thinking that this method will not translate easily to polyhedra that are not convex polytopes. But I am not even sure whether you can define those in Sage... and anyway, if it is possible to have, let say, a genus 1 polyhedron, it would be a different question and a different ticket.",
    "created_at": "2017-01-11T14:51:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22144#issuecomment-303696",
    "user": "https://trac.sagemath.org/admin/accounts/users/ams"
}
```

<a id='comment:30'></a>So you think it will be *always* everybody outwards ? 

I was also thinking that this method will not translate easily to polyhedra that are not convex polytopes. But I am not even sure whether you can define those in Sage... and anyway, if it is possible to have, let say, a genus 1 polyhedron, it would be a different question and a different ticket.



---

archive/issue_comments_303697.json:
```json
{
    "body": "<a id='comment:31'></a>Well, I have not checked this, really, I admit. The idea is that inequalities are always stored as \"vector . (?,?,?) + scalar >= 0\". So taking the vector part of a facet should give the same normal in a coherent way, unless somebody somewhere has decided to change signs for some strange reason.\n\nI have launched my patchbot to check that no doctest is broken anywhere else in sage.\n\nMaybe you should check that some of the examples in Polyhedron? still plot as expected. In particular for open polyhedra, cones, etc. A priori, there should be no problem, but it's better to check a little bit.",
    "created_at": "2017-01-11T14:58:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22144#issuecomment-303697",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:31'></a>Well, I have not checked this, really, I admit. The idea is that inequalities are always stored as "vector . (?,?,?) + scalar >= 0". So taking the vector part of a facet should give the same normal in a coherent way, unless somebody somewhere has decided to change signs for some strange reason.

I have launched my patchbot to check that no doctest is broken anywhere else in sage.

Maybe you should check that some of the examples in Polyhedron? still plot as expected. In particular for open polyhedra, cones, etc. A priori, there should be no problem, but it's better to check a little bit.



---

archive/issue_comments_303698.json:
```json
{
    "body": "<a id='comment:32'></a>Ok, I'll do that. \n\nI have one more question, I cannot figure out in the code where do you actually triangulate the polyhedron's faces. I am worried about it because I am interested in both `stl` and `obj` formats for export and in `obj` I prefer to use *quadri*s rather than *tri*s.",
    "created_at": "2017-01-11T15:05:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22144#issuecomment-303698",
    "user": "https://trac.sagemath.org/admin/accounts/users/ams"
}
```

<a id='comment:32'></a>Ok, I'll do that. 

I have one more question, I cannot figure out in the code where do you actually triangulate the polyhedron's faces. I am worried about it because I am interested in both `stl` and `obj` formats for export and in `obj` I prefer to use *quadri*s rather than *tri*s.



---

archive/issue_comments_303699.json:
```json
{
    "body": "<a id='comment:33'></a>the chopping into triangles is done in the commit\n\ntrac 22144 enhance stl ouput (for polyhedra in particular)\n\nand happens inside the stl string method, so will not affect other file format exports.\n\nyou can see the context by clicking on the commit and then enlarging the value of \"context\" in the little menu \"diff options\" on the right",
    "created_at": "2017-01-11T15:08:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22144#issuecomment-303699",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:33'></a>the chopping into triangles is done in the commit

trac 22144 enhance stl ouput (for polyhedra in particular)

and happens inside the stl string method, so will not affect other file format exports.

you can see the context by clicking on the commit and then enlarging the value of "context" in the little menu "diff options" on the right



---

archive/issue_comments_303700.json:
```json
{
    "body": "<a id='comment:34'></a>by the way, the better normals for facets should also have enhanced the obj output..",
    "created_at": "2017-01-11T15:10:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22144#issuecomment-303700",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:34'></a>by the way, the better normals for facets should also have enhanced the obj output..



---

archive/issue_comments_303701.json:
```json
{
    "body": "<a id='comment:35'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-01-11T15:28:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22144#issuecomment-303701",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:35'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_303702.json:
```json
{
    "body": "<a id='comment:36'></a>I went trough all of the examples in `plot3d?` The plot looked reasonably good. But did you wanted to test the on-screen image or the `stl` export ? \n\nNone of those examples could export to `stl` before (I mean in Sage 7.4), but now, some of them manage to actually export : \n  \n```\nsage: plot3d(lambda x, y: x^2 + y^2, (-2,2), (-2,2)).save('rho2.stl')\n```\n\n```\nsage: plot3d(sin(x*y), (x, -pi, pi), (y, -pi, pi)).save('sinxy.stl')\n```\n\nand many others.\n\nThose who do not work, have options added (other than `plot_points` or `mesh` or `transformation`), like for example:\n\n```\nsage: x,y = var('x,y')\nsage: P = plot3d(x+y+sin(x*y), (x,-10,10),(y,-10,10), opacity=0.87, color='blue')\nsage: Q = plot3d(x-2*y-cos(x*y),(x,-10,10),(y,-10,10),opacity=0.3,color='red')\nsage: (P+Q).save('twoplanes.stl')\n```",
    "created_at": "2017-01-11T16:12:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22144#issuecomment-303702",
    "user": "https://trac.sagemath.org/admin/accounts/users/ams"
}
```

<a id='comment:36'></a>I went trough all of the examples in `plot3d?` The plot looked reasonably good. But did you wanted to test the on-screen image or the `stl` export ? 

None of those examples could export to `stl` before (I mean in Sage 7.4), but now, some of them manage to actually export : 
  
```
sage: plot3d(lambda x, y: x^2 + y^2, (-2,2), (-2,2)).save('rho2.stl')
```

```
sage: plot3d(sin(x*y), (x, -pi, pi), (y, -pi, pi)).save('sinxy.stl')
```

and many others.

Those who do not work, have options added (other than `plot_points` or `mesh` or `transformation`), like for example:

```
sage: x,y = var('x,y')
sage: P = plot3d(x+y+sin(x*y), (x,-10,10),(y,-10,10), opacity=0.87, color='blue')
sage: Q = plot3d(x-2*y-cos(x*y),(x,-10,10),(y,-10,10),opacity=0.3,color='red')
sage: (P+Q).save('twoplanes.stl')
```



---

archive/issue_comments_303703.json:
```json
{
    "body": "<a id='comment:37'></a>No, I was just meaning to check the displayed plots. Thanks for doing that.\n\nYour job as a reviewer, if you accept it:\n\n- check that all doctests pass (wait for the bot, and run the tests yourself on the modified files)\n- check that the doc is good and correctly formatted (should be ok, but you can think of improvements)\n- be sure that this is an improvement over the existing situation\n- ideally, be sure that there is no better solution to do the same thing (should not apply here)\n\nThis should be an easy review, I think. If you have more questions or suggestions, I am all ears. Once you are satisfied, set to positive review and put your name in the reviewer field at top of the page.\n\nI also think one could keep further enhancements to later tickets.",
    "created_at": "2017-01-11T16:18:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22144#issuecomment-303703",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:37'></a>No, I was just meaning to check the displayed plots. Thanks for doing that.

Your job as a reviewer, if you accept it:

- check that all doctests pass (wait for the bot, and run the tests yourself on the modified files)
- check that the doc is good and correctly formatted (should be ok, but you can think of improvements)
- be sure that this is an improvement over the existing situation
- ideally, be sure that there is no better solution to do the same thing (should not apply here)

This should be an easy review, I think. If you have more questions or suggestions, I am all ears. Once you are satisfied, set to positive review and put your name in the reviewer field at top of the page.

I also think one could keep further enhancements to later tickets.



---

archive/issue_comments_303704.json:
```json
{
    "body": "Changing keywords from \"\" to \"days82\".",
    "created_at": "2017-01-11T17:52:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22144#issuecomment-303704",
    "user": "https://github.com/VivianePons"
}
```

Changing keywords from "" to "days82".



---

archive/issue_comments_303705.json:
```json
{
    "body": "<a id='comment:39'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-01-11T18:15:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22144#issuecomment-303705",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:39'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_303706.json:
```json
{
    "body": "<a id='comment:40'></a>There is one test \n\n`$ sage -t src/sage/geometry/polyhedron/plot.py`  \n\nthat fails.\n\n```\nFailed example:\n    proj.polygons\nExpected:\n    [[2, 0, 1], [3, 0, 1], [3, 0, 2], [3, 1, 2]]\nGot:\n    [[1, 0, 2], [3, 0, 1], [2, 0, 3], [3, 1, 2]]\n```\n\nI looked through the example, and exported the stl in this precise example. It works, and normal are consistent, so maybe you should change the expected result accordingly in the doc.",
    "created_at": "2017-01-11T23:15:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22144#issuecomment-303706",
    "user": "https://trac.sagemath.org/admin/accounts/users/ams"
}
```

<a id='comment:40'></a>There is one test 

`$ sage -t src/sage/geometry/polyhedron/plot.py`  

that fails.

```
Failed example:
    proj.polygons
Expected:
    [[2, 0, 1], [3, 0, 1], [3, 0, 2], [3, 1, 2]]
Got:
    [[1, 0, 2], [3, 0, 1], [2, 0, 3], [3, 1, 2]]
```

I looked through the example, and exported the stl in this precise example. It works, and normal are consistent, so maybe you should change the expected result accordingly in the doc.



---

archive/issue_comments_303707.json:
```json
{
    "body": "<a id='comment:41'></a>yes, done already",
    "created_at": "2017-01-12T07:33:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22144#issuecomment-303707",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:41'></a>yes, done already



---

archive/issue_comments_303708.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-01-12T09:34:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22144#issuecomment-303708",
    "user": "https://trac.sagemath.org/admin/accounts/users/ams"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_303709.json:
```json
{
    "body": "<a id='comment:42'></a>Good job! All tests passed on my computer and the documentation looks good.",
    "created_at": "2017-01-12T09:34:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22144#issuecomment-303709",
    "user": "https://trac.sagemath.org/admin/accounts/users/ams"
}
```

<a id='comment:42'></a>Good job! All tests passed on my computer and the documentation looks good.



---

archive/issue_comments_303710.json:
```json
{
    "body": "<a id='comment:43'></a>a sequel in #22196, to use the much more efficient binary STL format instead",
    "created_at": "2017-01-17T16:38:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22144#issuecomment-303710",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:43'></a>a sequel in #22196, to use the much more efficient binary STL format instead



---

archive/issue_events_058220.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-01-21T21:21:38Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/22144",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22144#event-58220"
}
```



---

archive/issue_comments_303711.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-01-21T21:21:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22144",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22144#issuecomment-303711",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
