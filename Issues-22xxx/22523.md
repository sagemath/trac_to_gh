# Issue 22523: Symbolic power of a matrix

archive/issues_022286.json:
```json
{
    "body": "Compute the k-th power of a matrix, where k is a symbolic variable.\n\nSee [this question](https://ask.sagemath.org/question/35658/general-power-of-a-matrix/#35666).\n\nFollow-up at #25082.\n\n**CC:**  tmonteil\n\n**Keywords:** days84\n\n**Branch:** [3c82b4370366942e55885cdf88b504d4caaa6529](https://github.com/sagemath/sagetrac-mirror/commit/3c82b4370366942e55885cdf88b504d4caaa6529)\n\n**Reviewer:** Travis Scrimshaw\n\n**Author:** Marcelo Forets\n\nIssue created by migration from https://trac.sagemath.org/ticket/22523\n\n",
    "closed_at": "2017-04-23T12:58:09Z",
    "created_at": "2017-03-06T00:44:16Z",
    "labels": [
        "component: linear algebra",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.0",
    "title": "Symbolic power of a matrix",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22523",
    "user": "https://github.com/mforets"
}
```
Compute the k-th power of a matrix, where k is a symbolic variable.

See [this question](https://ask.sagemath.org/question/35658/general-power-of-a-matrix/#35666).

Follow-up at #25082.

**CC:**  tmonteil

**Keywords:** days84

**Branch:** [3c82b4370366942e55885cdf88b504d4caaa6529](https://github.com/sagemath/sagetrac-mirror/commit/3c82b4370366942e55885cdf88b504d4caaa6529)

**Reviewer:** Travis Scrimshaw

**Author:** Marcelo Forets

Issue created by migration from https://trac.sagemath.org/ticket/22523





---

archive/issue_comments_337848.json:
```json
{
    "body": "**Branch:** [u/mforets/symbolic_power_of_a_matrix](https://github.com/sagemath/sagetrac-mirror/tree/u/mforets/symbolic_power_of_a_matrix)",
    "created_at": "2017-03-10T18:55:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22523#issuecomment-337848",
    "user": "https://github.com/mforets"
}
```

**Branch:** [u/mforets/symbolic_power_of_a_matrix](https://github.com/sagemath/sagetrac-mirror/tree/u/mforets/symbolic_power_of_a_matrix)



---

archive/issue_comments_337849.json:
```json
{
    "body": "<a id='comment:2'></a>\nthis patch is broken:\n\n```\nsage: A = random_matrix(RDF, 2)\nsage: A\n\n[-0.9428173549065391  -0.301642050267529]\n[ 0.6212822063471177 -0.9690284523509545]\nsage: A^x\n...\nAttributeError: 'sage.matrix.matrix_real_double_dense.Matrix_real_double_dense' object has no attribute '_matrix_power_symbolic'\n```\n\njust adding the new `_matrix_power_symbolic` and updating the generic ` __pow__` doesn't seem to be correct. some hints?\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ce9ac0b084b0a1b2f4c00b3a8d23232da2a1acdb\">ce9ac0b</a></td><td><code>added the code, but the method is not found</code></td></tr></table>\n",
    "created_at": "2017-03-10T19:06:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22523#issuecomment-337849",
    "user": "https://github.com/mforets"
}
```

<a id='comment:2'></a>
this patch is broken:

```
sage: A = random_matrix(RDF, 2)
sage: A

[-0.9428173549065391  -0.301642050267529]
[ 0.6212822063471177 -0.9690284523509545]
sage: A^x
...
AttributeError: 'sage.matrix.matrix_real_double_dense.Matrix_real_double_dense' object has no attribute '_matrix_power_symbolic'
```

just adding the new `_matrix_power_symbolic` and updating the generic ` __pow__` doesn't seem to be correct. some hints?

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ce9ac0b084b0a1b2f4c00b3a8d23232da2a1acdb">ce9ac0b</a></td><td><code>added the code, but the method is not found</code></td></tr></table>




---

archive/issue_comments_337850.json:
```json
{
    "body": "**Commit:** [ce9ac0b084b0a1b2f4c00b3a8d23232da2a1acdb](https://github.com/sagemath/sagetrac-mirror/commit/ce9ac0b084b0a1b2f4c00b3a8d23232da2a1acdb)",
    "created_at": "2017-03-10T19:06:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22523#issuecomment-337850",
    "user": "https://github.com/mforets"
}
```

**Commit:** [ce9ac0b084b0a1b2f4c00b3a8d23232da2a1acdb](https://github.com/sagemath/sagetrac-mirror/commit/ce9ac0b084b0a1b2f4c00b3a8d23232da2a1acdb)



---

archive/issue_comments_337851.json:
```json
{
    "body": "<a id='comment:3'></a>\nEither `_matrix_power_symbolic` is a function and then you should call `_matrix_power_symbolic(self, n)`, or `_matrix_power_symbolic` is a method (of a generic matrix class), and then you should call `self._matrix_power_symbolic(n)`. Here, you seem to mix both points by calling `self._matrix_power_symbolic(self, n)` (so that `self` is used for the two arguments of `_matrix_power_symbolic`).",
    "created_at": "2017-03-10T19:12:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22523#issuecomment-337851",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:3'></a>
Either `_matrix_power_symbolic` is a function and then you should call `_matrix_power_symbolic(self, n)`, or `_matrix_power_symbolic` is a method (of a generic matrix class), and then you should call `self._matrix_power_symbolic(n)`. Here, you seem to mix both points by calling `self._matrix_power_symbolic(self, n)` (so that `self` is used for the two arguments of `_matrix_power_symbolic`).



---

archive/issue_comments_337852.json:
```json
{
    "body": "<a id='comment:4'></a>\nReplying to [tmonteil](#comment%3A3):\n> Either `_matrix_power_symbolic` is a function and then you should call `_matrix_power_symbolic(self, n)`, or `_matrix_power_symbolic` is a method (of a generic matrix class), and then you should call `self._matrix_power_symbolic(n)`. Here, you seem to mix both points by calling `self._matrix_power_symbolic(self, n)` (so that `self` is used for the first two arguments of `_matrix_power_symbolic`). \n\n>",
    "created_at": "2017-03-10T19:19:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22523#issuecomment-337852",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:4'></a>
Replying to [tmonteil](#comment%3A3):
> Either `_matrix_power_symbolic` is a function and then you should call `_matrix_power_symbolic(self, n)`, or `_matrix_power_symbolic` is a method (of a generic matrix class), and then you should call `self._matrix_power_symbolic(n)`. Here, you seem to mix both points by calling `self._matrix_power_symbolic(self, n)` (so that `self` is used for the first two arguments of `_matrix_power_symbolic`). 

>



---

archive/issue_comments_337853.json:
```json
{
    "body": "<a id='comment:5'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/215cd88ee7d32aeec709d8b1a81f7b53f897742e\">215cd88</a></td><td><code>Add symbolic matrix power.</code></td></tr></table>\n",
    "created_at": "2017-03-11T13:30:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22523#issuecomment-337853",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/215cd88ee7d32aeec709d8b1a81f7b53f897742e">215cd88</a></td><td><code>Add symbolic matrix power.</code></td></tr></table>




---

archive/issue_comments_337854.json:
```json
{
    "body": "**Changing commit** from \"[ce9ac0b084b0a1b2f4c00b3a8d23232da2a1acdb](https://github.com/sagemath/sagetrac-mirror/commit/ce9ac0b084b0a1b2f4c00b3a8d23232da2a1acdb)\" to \"[215cd88ee7d32aeec709d8b1a81f7b53f897742e](https://github.com/sagemath/sagetrac-mirror/commit/215cd88ee7d32aeec709d8b1a81f7b53f897742e)\".",
    "created_at": "2017-03-11T13:30:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22523#issuecomment-337854",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[ce9ac0b084b0a1b2f4c00b3a8d23232da2a1acdb](https://github.com/sagemath/sagetrac-mirror/commit/ce9ac0b084b0a1b2f4c00b3a8d23232da2a1acdb)" to "[215cd88ee7d32aeec709d8b1a81f7b53f897742e](https://github.com/sagemath/sagetrac-mirror/commit/215cd88ee7d32aeec709d8b1a81f7b53f897742e)".



---

archive/issue_events_204852.json:
```json
{
    "actor": "https://github.com/mforets",
    "created_at": "2017-03-11T13:30:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22523",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22523#event-204852"
}
```



---

archive/issue_comments_337855.json:
```json
{
    "body": "<a id='comment:7'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3d69f78e9165026d9e98b8b2815e39ca26997b2a\">3d69f78</a></td><td><code>amend call to top-level var</code></td></tr></table>\n",
    "created_at": "2017-03-11T19:59:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22523#issuecomment-337855",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3d69f78e9165026d9e98b8b2815e39ca26997b2a">3d69f78</a></td><td><code>amend call to top-level var</code></td></tr></table>




---

archive/issue_comments_337856.json:
```json
{
    "body": "**Changing commit** from \"[215cd88ee7d32aeec709d8b1a81f7b53f897742e](https://github.com/sagemath/sagetrac-mirror/commit/215cd88ee7d32aeec709d8b1a81f7b53f897742e)\" to \"[3d69f78e9165026d9e98b8b2815e39ca26997b2a](https://github.com/sagemath/sagetrac-mirror/commit/3d69f78e9165026d9e98b8b2815e39ca26997b2a)\".",
    "created_at": "2017-03-11T19:59:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22523#issuecomment-337856",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[215cd88ee7d32aeec709d8b1a81f7b53f897742e](https://github.com/sagemath/sagetrac-mirror/commit/215cd88ee7d32aeec709d8b1a81f7b53f897742e)" to "[3d69f78e9165026d9e98b8b2815e39ca26997b2a](https://github.com/sagemath/sagetrac-mirror/commit/3d69f78e9165026d9e98b8b2815e39ca26997b2a)".



---

archive/issue_comments_337857.json:
```json
{
    "body": "**Changing commit** from \"[3d69f78e9165026d9e98b8b2815e39ca26997b2a](https://github.com/sagemath/sagetrac-mirror/commit/3d69f78e9165026d9e98b8b2815e39ca26997b2a)\" to \"[f6de852ce1f5eb5817ff2336ec1558b2425c9356](https://github.com/sagemath/sagetrac-mirror/commit/f6de852ce1f5eb5817ff2336ec1558b2425c9356)\".",
    "created_at": "2017-03-12T15:29:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22523#issuecomment-337857",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[3d69f78e9165026d9e98b8b2815e39ca26997b2a](https://github.com/sagemath/sagetrac-mirror/commit/3d69f78e9165026d9e98b8b2815e39ca26997b2a)" to "[f6de852ce1f5eb5817ff2336ec1558b2425c9356](https://github.com/sagemath/sagetrac-mirror/commit/f6de852ce1f5eb5817ff2336ec1558b2425c9356)".



---

archive/issue_comments_337858.json:
```json
{
    "body": "<a id='comment:8'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f6de852ce1f5eb5817ff2336ec1558b2425c9356\">f6de852</a></td><td><code>get rid of var and get rid of taking the derivative</code></td></tr></table>\n",
    "created_at": "2017-03-12T15:29:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22523#issuecomment-337858",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f6de852ce1f5eb5817ff2336ec1558b2425c9356">f6de852</a></td><td><code>get rid of var and get rid of taking the derivative</code></td></tr></table>




---

archive/issue_comments_337859.json:
```json
{
    "body": "<a id='comment:9'></a>\nalso related, this other [ask.sagemath question](https://ask.sagemath.org/question/8280/an-nvarn/)",
    "created_at": "2017-04-10T07:47:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22523#issuecomment-337859",
    "user": "https://github.com/mforets"
}
```

<a id='comment:9'></a>
also related, this other [ask.sagemath question](https://ask.sagemath.org/question/8280/an-nvarn/)



---

archive/issue_comments_337860.json:
```json
{
    "body": "<a id='comment:10'></a>\nthe patchbot is complaining about:\n\n```\nsage -t --long src/doc/en/reference/references/index.rst\n    Error: TAB character found at line 797\n    [0 tests, 0.00 s]\n----------------------------------------------------------------------\nsage -t --long src/doc/en/reference/references/index.rst  # Tab character found\n----------------------------------------------------------------------\n```\n\ni'll try to fix this.",
    "created_at": "2017-04-10T07:51:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22523#issuecomment-337860",
    "user": "https://github.com/mforets"
}
```

<a id='comment:10'></a>
the patchbot is complaining about:

```
sage -t --long src/doc/en/reference/references/index.rst
    Error: TAB character found at line 797
    [0 tests, 0.00 s]
----------------------------------------------------------------------
sage -t --long src/doc/en/reference/references/index.rst  # Tab character found
----------------------------------------------------------------------
```

i'll try to fix this.



---

archive/issue_comments_337861.json:
```json
{
    "body": "**Changing commit** from \"[f6de852ce1f5eb5817ff2336ec1558b2425c9356](https://github.com/sagemath/sagetrac-mirror/commit/f6de852ce1f5eb5817ff2336ec1558b2425c9356)\" to \"[883bb4a6fd679c6f0f193db108a6189b8cddf4ad](https://github.com/sagemath/sagetrac-mirror/commit/883bb4a6fd679c6f0f193db108a6189b8cddf4ad)\".",
    "created_at": "2017-04-11T08:48:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22523#issuecomment-337861",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[f6de852ce1f5eb5817ff2336ec1558b2425c9356](https://github.com/sagemath/sagetrac-mirror/commit/f6de852ce1f5eb5817ff2336ec1558b2425c9356)" to "[883bb4a6fd679c6f0f193db108a6189b8cddf4ad](https://github.com/sagemath/sagetrac-mirror/commit/883bb4a6fd679c6f0f193db108a6189b8cddf4ad)".



---

archive/issue_comments_337862.json:
```json
{
    "body": "<a id='comment:11'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/883bb4a6fd679c6f0f193db108a6189b8cddf4ad\">883bb4a</a></td><td><code>remove tab character in a reference</code></td></tr></table>\n",
    "created_at": "2017-04-11T08:48:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22523#issuecomment-337862",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/883bb4a6fd679c6f0f193db108a6189b8cddf4ad">883bb4a</a></td><td><code>remove tab character in a reference</code></td></tr></table>




---

archive/issue_comments_337863.json:
```json
{
    "body": "<a id='comment:12'></a>\nSome quick comments:\n\n- Use `Jk[i,i]` instead of `Jk[i][i]` as the latter creates a temporary `vector` object. However, I would do\n\n  ```python\n            Jk_ii = Jk[i,i]\n            if hasattr(Jk_ii, 'radical_expression'):\n                Jk_ii = Jk_ii.radical_expression()\n  ```\n- Use <code>\\`</code> instead of `$` for latex formatting in docstrings.\n- In the `INPUT:` block: <code>- \\`\\`A\\`\\` -- a square matrix over an exact field</code> Note the removal of the period too.\n- Make `A` and `A^n` in latex.\n- Is there some reason why the function is not a `cdef` function?\n- I don't understand why you try to change the base ring to `QQbar`. Could you justify this?\n- This seems strange: `vector(SR, i).list()`. Why not `[SR.zero()]*i`?\n- I would use a call to `binomial` instead of `(factorial_n/(factorial(n-i)*factorial(i))` because it probably requires less operations when `n` is big. Perhaps some testing is needed here.\n- How many of those imports are needed in the function? Having them there slows the function down.\n- I'm not completely sure about creating the blank (dense) matrix and then filling it in afterwards. I feel like a better solution would be to just construct the data for the matrix and then construct the matrix from that (if this is even needed).",
    "created_at": "2017-04-11T16:02:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22523#issuecomment-337863",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:12'></a>
Some quick comments:

- Use `Jk[i,i]` instead of `Jk[i][i]` as the latter creates a temporary `vector` object. However, I would do

  ```python
            Jk_ii = Jk[i,i]
            if hasattr(Jk_ii, 'radical_expression'):
                Jk_ii = Jk_ii.radical_expression()
  ```
- Use <code>\`</code> instead of `$` for latex formatting in docstrings.
- In the `INPUT:` block: <code>- \`\`A\`\` -- a square matrix over an exact field</code> Note the removal of the period too.
- Make `A` and `A^n` in latex.
- Is there some reason why the function is not a `cdef` function?
- I don't understand why you try to change the base ring to `QQbar`. Could you justify this?
- This seems strange: `vector(SR, i).list()`. Why not `[SR.zero()]*i`?
- I would use a call to `binomial` instead of `(factorial_n/(factorial(n-i)*factorial(i))` because it probably requires less operations when `n` is big. Perhaps some testing is needed here.
- How many of those imports are needed in the function? Having them there slows the function down.
- I'm not completely sure about creating the blank (dense) matrix and then filling it in afterwards. I feel like a better solution would be to just construct the data for the matrix and then construct the matrix from that (if this is even needed).



---

archive/issue_events_204853.json:
```json
{
    "actor": "https://github.com/mforets",
    "created_at": "2017-04-11T18:15:07Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22523",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22523#event-204853"
}
```



---

archive/issue_events_204854.json:
```json
{
    "actor": "https://github.com/mforets",
    "created_at": "2017-04-11T18:15:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22523",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22523#event-204854"
}
```



---

archive/issue_comments_337864.json:
```json
{
    "body": "<a id='comment:14'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c473b60796d78a49cc572901dd7192d9ecea5cf5\">c473b60</a></td><td><code>fix docstring formatting</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/32e7cf9cee379d13642eeefdf81aa89ff73efc3b\">32e7cf9</a></td><td><code>updates in _matrix_power_symbolic</code></td></tr></table>\n",
    "created_at": "2017-04-12T19:15:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22523#issuecomment-337864",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c473b60796d78a49cc572901dd7192d9ecea5cf5">c473b60</a></td><td><code>fix docstring formatting</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/32e7cf9cee379d13642eeefdf81aa89ff73efc3b">32e7cf9</a></td><td><code>updates in _matrix_power_symbolic</code></td></tr></table>




---

archive/issue_comments_337865.json:
```json
{
    "body": "**Changing commit** from \"[883bb4a6fd679c6f0f193db108a6189b8cddf4ad](https://github.com/sagemath/sagetrac-mirror/commit/883bb4a6fd679c6f0f193db108a6189b8cddf4ad)\" to \"[32e7cf9cee379d13642eeefdf81aa89ff73efc3b](https://github.com/sagemath/sagetrac-mirror/commit/32e7cf9cee379d13642eeefdf81aa89ff73efc3b)\".",
    "created_at": "2017-04-12T19:15:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22523#issuecomment-337865",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[883bb4a6fd679c6f0f193db108a6189b8cddf4ad](https://github.com/sagemath/sagetrac-mirror/commit/883bb4a6fd679c6f0f193db108a6189b8cddf4ad)" to "[32e7cf9cee379d13642eeefdf81aa89ff73efc3b](https://github.com/sagemath/sagetrac-mirror/commit/32e7cf9cee379d13642eeefdf81aa89ff73efc3b)".



---

archive/issue_comments_337866.json:
```json
{
    "body": "<a id='comment:15'></a>\n@tscrim : thanks for the feedback, i've tried to correct the formatting issues.\n\nsome testing for the algorithm before changes (before 32e7cf9):\n\nTest in the rationals, two-dimensional:\n\n```\n    sage: k = var('k')\n    sage: A = matrix(QQ, 2, [1/2, -1, 2, 0])\n    sage: timeit('A^k')\n    5 loops, best of 3: 105 ms per loop\n```\n\nTest of the [stochastic matrix](https://en.wikipedia.org/wiki/Stochastic_matrix) in wikipedia:\n\n```\n    sage: A = matrix([[0, 0, 1/2, 0, 1/2], [0, 0, 1, 0, 0], [1/4, 1/4, 0, 1/4, 1/4], [0, 0, 1/2, 0, 1/2], [0, 0, 0, 0, 1]])\n    sage: timeit('A^k')\n    5 loops, best of 3: 192 ms per loop\n```\n\nTest in the symbolic ring:\n\n```\n    sage: n = var('n')\n    sage: A = matrix([[pi, e],[0, -2*I]])\n    sage: timeit('A^n')\n    25 loops, best of 3: 26 ms per loop\n```\n\nhere are some partial answers:\n\n> - Use `Jk[i,i]` instead of `Jk[i][i]` as the latter creates a temporary `vector` object. However, I would do\n> \n>   ```python\n>             Jk_ii = Jk[i,i]\n>             if hasattr(Jk_ii, 'radical_expression'):\n>                 Jk_ii = Jk_ii.radical_expression()\n>   ```\n\n\nyes, it is better that way. it didn't have an impact in the timing of my quick examples above, though (+- 10ms)\n\n> - I don't understand why you try to change the base ring to `QQbar`. Could you justify this?\n\n\nthis is to cover the cases where the eigenvalues do not belong to the same ring as the given matrix. in general the `jordan_form` method breaks with the message `RuntimeError: Some eigenvalue does not exist in Rational Field.` \n\nFor example consider taking the jordan form of `A = matrix(2, [1, 2, 1, -2])`. \n\nOn the other hand, the example `A = matrix([[pi, e],[0, -2*I]])` tests the case when it is not possible to transform to QQbar (it would break with ``TypeError: Illegal initializer for algebraic number``). \n\n> - This seems strange: `vector(SR, i).list()`. Why not `[SR.zero()]*i`?\n\n\nsure, i'm used to thinking in matrices/vectors in the 1st place, rather than lists :) \n\ndone in the new commit, for the record it didn't have an impact on timeit for the 3 examples above (+- 5..10ms)\n\n> - I would use a call to `binomial` instead of `(factorial_n/(factorial(n-i)*factorial(i))` because it probably requires less operations when `n` is big. Perhaps some testing is needed here.\n\n\nright, at least with the binomial method the code is more clear.\n\nmore generally, i'm not confident that jordanization will be useful at all for \n'big' n, since this operation is very costly. however if the matrix is very sparse then maybe it works, i didn't try any of that.\n\n> - How many of those imports are needed in the function? Having them there slows the function down.\n\n\nwell yes, i was able to get rid of importing vector, based on the suggestion of above.",
    "created_at": "2017-04-12T19:24:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22523#issuecomment-337866",
    "user": "https://github.com/mforets"
}
```

<a id='comment:15'></a>
@tscrim : thanks for the feedback, i've tried to correct the formatting issues.

some testing for the algorithm before changes (before 32e7cf9):

Test in the rationals, two-dimensional:

```
    sage: k = var('k')
    sage: A = matrix(QQ, 2, [1/2, -1, 2, 0])
    sage: timeit('A^k')
    5 loops, best of 3: 105 ms per loop
```

Test of the [stochastic matrix](https://en.wikipedia.org/wiki/Stochastic_matrix) in wikipedia:

```
    sage: A = matrix([[0, 0, 1/2, 0, 1/2], [0, 0, 1, 0, 0], [1/4, 1/4, 0, 1/4, 1/4], [0, 0, 1/2, 0, 1/2], [0, 0, 0, 0, 1]])
    sage: timeit('A^k')
    5 loops, best of 3: 192 ms per loop
```

Test in the symbolic ring:

```
    sage: n = var('n')
    sage: A = matrix([[pi, e],[0, -2*I]])
    sage: timeit('A^n')
    25 loops, best of 3: 26 ms per loop
```

here are some partial answers:

> - Use `Jk[i,i]` instead of `Jk[i][i]` as the latter creates a temporary `vector` object. However, I would do
> 
>   ```python
>             Jk_ii = Jk[i,i]
>             if hasattr(Jk_ii, 'radical_expression'):
>                 Jk_ii = Jk_ii.radical_expression()
>   ```


yes, it is better that way. it didn't have an impact in the timing of my quick examples above, though (+- 10ms)

> - I don't understand why you try to change the base ring to `QQbar`. Could you justify this?


this is to cover the cases where the eigenvalues do not belong to the same ring as the given matrix. in general the `jordan_form` method breaks with the message `RuntimeError: Some eigenvalue does not exist in Rational Field.` 

For example consider taking the jordan form of `A = matrix(2, [1, 2, 1, -2])`. 

On the other hand, the example `A = matrix([[pi, e],[0, -2*I]])` tests the case when it is not possible to transform to QQbar (it would break with ``TypeError: Illegal initializer for algebraic number``). 

> - This seems strange: `vector(SR, i).list()`. Why not `[SR.zero()]*i`?


sure, i'm used to thinking in matrices/vectors in the 1st place, rather than lists :) 

done in the new commit, for the record it didn't have an impact on timeit for the 3 examples above (+- 5..10ms)

> - I would use a call to `binomial` instead of `(factorial_n/(factorial(n-i)*factorial(i))` because it probably requires less operations when `n` is big. Perhaps some testing is needed here.


right, at least with the binomial method the code is more clear.

more generally, i'm not confident that jordanization will be useful at all for 
'big' n, since this operation is very costly. however if the matrix is very sparse then maybe it works, i didn't try any of that.

> - How many of those imports are needed in the function? Having them there slows the function down.


well yes, i was able to get rid of importing vector, based on the suggestion of above.



---

archive/issue_comments_337867.json:
```json
{
    "body": "<a id='comment:16'></a>\n> Is there some reason why the function is not a cdef function? \n\n\ni tried `def` -> `cdef` in the function's definition, but this breaks many things (compilation). where can i learn more about using cdef in Sage library code? thanks\n\n> I'm not completely sure about creating the blank (dense) matrix and then filling it in afterwards. I feel like a better solution would be to just construct the data for the matrix and then construct the matrix from that (if this is even needed). \n\n\nhmm i would normally use the same matrix to store partial computations (instead of creating a new one, say). are you suggesting that it's preferable to do differently like what, use lists? \n\nin this particular case, there are `FJ_k.set_row(i, Jk_row_i)` and `FJ.set_block(k, k, FJ_k)` inside a loop. yes, the matrix `FJ` is needed afterwards to do the computation `P * FJ * Pinv`.",
    "created_at": "2017-04-13T13:11:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22523#issuecomment-337867",
    "user": "https://github.com/mforets"
}
```

<a id='comment:16'></a>
> Is there some reason why the function is not a cdef function? 


i tried `def` -> `cdef` in the function's definition, but this breaks many things (compilation). where can i learn more about using cdef in Sage library code? thanks

> I'm not completely sure about creating the blank (dense) matrix and then filling it in afterwards. I feel like a better solution would be to just construct the data for the matrix and then construct the matrix from that (if this is even needed). 


hmm i would normally use the same matrix to store partial computations (instead of creating a new one, say). are you suggesting that it's preferable to do differently like what, use lists? 

in this particular case, there are `FJ_k.set_row(i, Jk_row_i)` and `FJ.set_block(k, k, FJ_k)` inside a loop. yes, the matrix `FJ` is needed afterwards to do the computation `P * FJ * Pinv`.



---

archive/issue_comments_337868.json:
```json
{
    "body": "<a id='comment:17'></a>\nReplying to [mforets](#comment%3A16):\n> > Is there some reason why the function is not a cdef function? \n\n> \n> i tried `def` -> `cdef` in the function's definition, but this breaks many things (compilation). where can i learn more about using cdef in Sage library code? thanks\n\n\nHmm...interesting. I will try this and see what I can do. To learn about `cdef`, you should probably go to Cython's docs. The error messages on these failures can be helpful sometimes to fix things.\n\n> > I'm not completely sure about creating the blank (dense) matrix and then filling it in afterwards. I feel like a better solution would be to just construct the data for the matrix and then construct the matrix from that (if this is even needed). \n\n> \n> hmm i would normally use the same matrix to store partial computations (instead of creating a new one, say). are you suggesting that it's preferable to do differently like what, use lists? \n\n\nIdeally you would use a single list, but a list of lists also works. At least for dense matrices. If the matrix was expected to be sparse, then a dict is good. The issue is more of that element creation is a relatively heavy operation compared to creating lists. Although I would directly modify the matrix `FJ`.\n\n> in this particular case, there are `FJ_k.set_row(i, Jk_row_i)` and `FJ.set_block(k, k, FJ_k)` inside a loop. yes, the matrix `FJ` is needed afterwards to do the computation `P * FJ * Pinv`.\n\n\nHowever, `FJ_k` is not. I would just like to modify `FJ` since the intermediate matrix `FJ_k` doesn't really need to be there.",
    "created_at": "2017-04-15T04:12:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22523#issuecomment-337868",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:17'></a>
Replying to [mforets](#comment%3A16):
> > Is there some reason why the function is not a cdef function? 

> 
> i tried `def` -> `cdef` in the function's definition, but this breaks many things (compilation). where can i learn more about using cdef in Sage library code? thanks


Hmm...interesting. I will try this and see what I can do. To learn about `cdef`, you should probably go to Cython's docs. The error messages on these failures can be helpful sometimes to fix things.

> > I'm not completely sure about creating the blank (dense) matrix and then filling it in afterwards. I feel like a better solution would be to just construct the data for the matrix and then construct the matrix from that (if this is even needed). 

> 
> hmm i would normally use the same matrix to store partial computations (instead of creating a new one, say). are you suggesting that it's preferable to do differently like what, use lists? 


Ideally you would use a single list, but a list of lists also works. At least for dense matrices. If the matrix was expected to be sparse, then a dict is good. The issue is more of that element creation is a relatively heavy operation compared to creating lists. Although I would directly modify the matrix `FJ`.

> in this particular case, there are `FJ_k.set_row(i, Jk_row_i)` and `FJ.set_block(k, k, FJ_k)` inside a loop. yes, the matrix `FJ` is needed afterwards to do the computation `P * FJ * Pinv`.


However, `FJ_k` is not. I would just like to modify `FJ` since the intermediate matrix `FJ_k` doesn't really need to be there.



---

archive/issue_comments_337869.json:
```json
{
    "body": "<a id='comment:18'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3c82b4370366942e55885cdf88b504d4caaa6529\">3c82b43</a></td><td><code>directly modify FJ</code></td></tr></table>\n",
    "created_at": "2017-04-17T22:31:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22523#issuecomment-337869",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:18'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3c82b4370366942e55885cdf88b504d4caaa6529">3c82b43</a></td><td><code>directly modify FJ</code></td></tr></table>




---

archive/issue_comments_337870.json:
```json
{
    "body": "**Changing commit** from \"[32e7cf9cee379d13642eeefdf81aa89ff73efc3b](https://github.com/sagemath/sagetrac-mirror/commit/32e7cf9cee379d13642eeefdf81aa89ff73efc3b)\" to \"[3c82b4370366942e55885cdf88b504d4caaa6529](https://github.com/sagemath/sagetrac-mirror/commit/3c82b4370366942e55885cdf88b504d4caaa6529)\".",
    "created_at": "2017-04-17T22:31:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22523#issuecomment-337870",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[32e7cf9cee379d13642eeefdf81aa89ff73efc3b](https://github.com/sagemath/sagetrac-mirror/commit/32e7cf9cee379d13642eeefdf81aa89ff73efc3b)" to "[3c82b4370366942e55885cdf88b504d4caaa6529](https://github.com/sagemath/sagetrac-mirror/commit/3c82b4370366942e55885cdf88b504d4caaa6529)".



---

archive/issue_events_204855.json:
```json
{
    "actor": "https://github.com/mforets",
    "created_at": "2017-04-17T22:38:24Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/22523",
    "milestone": "sage-7.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22523#event-204855"
}
```



---

archive/issue_events_204856.json:
```json
{
    "actor": "https://github.com/mforets",
    "created_at": "2017-04-17T22:38:24Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/22523",
    "milestone": "sage-8.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22523#event-204856"
}
```



---

archive/issue_events_204857.json:
```json
{
    "actor": "https://github.com/mforets",
    "created_at": "2017-04-17T22:38:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22523",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22523#event-204857"
}
```



---

archive/issue_events_204858.json:
```json
{
    "actor": "https://github.com/mforets",
    "created_at": "2017-04-17T22:38:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22523",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22523#event-204858"
}
```



---

archive/issue_comments_337871.json:
```json
{
    "body": "<a id='comment:20'></a>\nfor the 2x2 case there is a simple closed formula by [K. S. Williams](http://people.math.carleton.ca/~williams/papers/pdf/175.pdf). since it does not require the jordan form, it can also be used with an inexact ring, and maybe it's faster (i don't plan to try it, just a comment.)",
    "created_at": "2017-04-17T22:48:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22523#issuecomment-337871",
    "user": "https://github.com/mforets"
}
```

<a id='comment:20'></a>
for the 2x2 case there is a simple closed formula by [K. S. Williams](http://people.math.carleton.ca/~williams/papers/pdf/175.pdf). since it does not require the jordan form, it can also be used with an inexact ring, and maybe it's faster (i don't plan to try it, just a comment.)



---

archive/issue_comments_337872.json:
```json
{
    "body": "**Reviewer:** Travis Scrimshaw",
    "created_at": "2017-04-17T23:18:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22523#issuecomment-337872",
    "user": "https://github.com/tscrim"
}
```

**Reviewer:** Travis Scrimshaw



---

archive/issue_comments_337873.json:
```json
{
    "body": "<a id='comment:21'></a>\nLet's get this into Sage. Positive review.",
    "created_at": "2017-04-17T23:18:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22523#issuecomment-337873",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:21'></a>
Let's get this into Sage. Positive review.



---

archive/issue_events_204859.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-04-17T23:18:13Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22523",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22523#event-204859"
}
```



---

archive/issue_events_204860.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-04-17T23:18:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22523",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22523#event-204860"
}
```



---

archive/issue_events_204861.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-04-23T12:58:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/22523",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22523#event-204861"
}
```



---

archive/issue_events_204862.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-04-23T12:58:09Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/22523",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22523#event-204862"
}
```



---

archive/issue_comments_337874.json:
```json
{
    "body": "**Changing branch** from \"[u/mforets/symbolic_power_of_a_matrix](https://github.com/sagemath/sagetrac-mirror/tree/u/mforets/symbolic_power_of_a_matrix)\" to \"[3c82b4370366942e55885cdf88b504d4caaa6529](https://github.com/sagemath/sagetrac-mirror/commit/3c82b4370366942e55885cdf88b504d4caaa6529)\".",
    "created_at": "2017-04-23T12:58:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22523#issuecomment-337874",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/mforets/symbolic_power_of_a_matrix](https://github.com/sagemath/sagetrac-mirror/tree/u/mforets/symbolic_power_of_a_matrix)" to "[3c82b4370366942e55885cdf88b504d4caaa6529](https://github.com/sagemath/sagetrac-mirror/commit/3c82b4370366942e55885cdf88b504d4caaa6529)".



---

archive/issue_comments_337875.json:
```json
{
    "body": "**Changing commit** from \"[3c82b4370366942e55885cdf88b504d4caaa6529](https://github.com/sagemath/sagetrac-mirror/commit/3c82b4370366942e55885cdf88b504d4caaa6529)\" to \"\".",
    "created_at": "2018-04-02T18:08:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22523#issuecomment-337875",
    "user": "https://github.com/slel"
}
```

**Changing commit** from "[3c82b4370366942e55885cdf88b504d4caaa6529](https://github.com/sagemath/sagetrac-mirror/commit/3c82b4370366942e55885cdf88b504d4caaa6529)" to "".



---

archive/issue_comments_337876.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,3 +1,5 @@\n Compute the k-th power of a matrix, where k is a symbolic variable.\n \n See [this question](https://ask.sagemath.org/question/35658/general-power-of-a-matrix/#35666).\n+\n+Follow-up at #25082.\n``````\n",
    "created_at": "2018-04-02T18:08:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22523#issuecomment-337876",
    "user": "https://github.com/slel"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,3 +1,5 @@
 Compute the k-th power of a matrix, where k is a symbolic variable.
 
 See [this question](https://ask.sagemath.org/question/35658/general-power-of-a-matrix/#35666).
+
+Follow-up at #25082.
``````




---

archive/issue_comments_337877.json:
```json
{
    "body": "<a id='comment:23'></a>\nFollow-up at #25028 after a bug was reported (and a fix found) at\n[Ask Sage question 41622](https://ask.sagemath.org/question/41622/bug-in-general-power-of-a-matrix).",
    "created_at": "2018-04-02T18:08:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22523#issuecomment-337877",
    "user": "https://github.com/slel"
}
```

<a id='comment:23'></a>
Follow-up at #25028 after a bug was reported (and a fix found) at
[Ask Sage question 41622](https://ask.sagemath.org/question/41622/bug-in-general-power-of-a-matrix).
