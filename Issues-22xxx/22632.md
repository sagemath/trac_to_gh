# Issue 22632: Cythonize CombinatorialFreeModuleElement

archive/issues_022395.json:
```json
{
    "assignees": [],
    "body": "We move `CombintorialFreeModuleElement` to its own class `IndexedFreeModuleElement` and cythonize it for (future) speed gains.\n\nCC:  @sagetrac-sage-combinat @nthiery @jdemeyer @fchapoton\n\nKeywords: **days85**\n\nBranch: **[`20cd0da`](https://github.com/sagemath/sagetrac-mirror/commit/20cd0dafdc07517145c3d8a20cbf8baa08e334dc)**\n\nReviewer: **Nicolas M. Thi\u00e9ry**\n\nAuthor: **Travis Scrimshaw**\n\nComponent: **performance**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/22632_\n\n",
    "closed_at": "2017-05-21T10:08:32Z",
    "created_at": "2017-03-17T15:04:39Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/performance",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.0",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Cythonize CombinatorialFreeModuleElement",
    "type": "issue",
    "updated_at": "2017-07-15T09:28:30Z",
    "url": "https://github.com/sagemath/sage/issues/22632",
    "user": "https://github.com/tscrim"
}
```
We move `CombintorialFreeModuleElement` to its own class `IndexedFreeModuleElement` and cythonize it for (future) speed gains.

CC:  @sagetrac-sage-combinat @nthiery @jdemeyer @fchapoton

Keywords: **days85**

Branch: **[`20cd0da`](https://github.com/sagemath/sagetrac-mirror/commit/20cd0dafdc07517145c3d8a20cbf8baa08e334dc)**

Reviewer: **Nicolas M. Thi√©ry**

Author: **Travis Scrimshaw**

Component: **performance**

_Issue created by migration from https://trac.sagemath.org/ticket/22632_





---

archive/issue_events_316136.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-03-17T15:04:39Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "milestone_number": null,
    "milestone_title": "sage-8.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22632#event-316136"
}
```



---

archive/issue_events_316137.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-03-17T15:04:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "label": "https://github.com/sagemath/sage/labels/performance",
    "label_color": "696969",
    "label_name": "performance",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22632#event-316137"
}
```



---

archive/issue_events_316138.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-03-17T15:04:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22632#event-316138"
}
```



---

archive/issue_events_316139.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-03-17T15:04:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22632#event-316139"
}
```



---

archive/issue_comments_336122.json:
```json
{
    "body": "Branch: **[public/combinat/cythonize_CFM_element-22632](https://github.com/sagemath/sagetrac-mirror/tree/public/combinat/cythonize_CFM_element-22632)**",
    "created_at": "2017-03-17T15:05:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336122",
    "user": "https://github.com/tscrim"
}
```

Branch: **[public/combinat/cythonize_CFM_element-22632](https://github.com/sagemath/sagetrac-mirror/tree/public/combinat/cythonize_CFM_element-22632)**



---

archive/issue_events_316140.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-03-17T15:05:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22632#event-316140"
}
```



---

archive/issue_comments_336123.json:
```json
{
    "body": "<div id=\"comment:1\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e9186745d5df8cf7092e17103dee9c12b6b33ebf\"><code>e918674</code></a></td><td><code>Moving CombinatorialFreeModuleElement to own (Cython) file.</code></td></tr></table>\n",
    "created_at": "2017-03-17T15:05:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336123",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:1"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e9186745d5df8cf7092e17103dee9c12b6b33ebf"><code>e918674</code></a></td><td><code>Moving CombinatorialFreeModuleElement to own (Cython) file.</code></td></tr></table>




---

archive/issue_comments_336124.json:
```json
{
    "body": "Commit: **[`e918674`](https://github.com/sagemath/sagetrac-mirror/commit/e9186745d5df8cf7092e17103dee9c12b6b33ebf)**",
    "created_at": "2017-03-17T15:05:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336124",
    "user": "https://github.com/tscrim"
}
```

Commit: **[`e918674`](https://github.com/sagemath/sagetrac-mirror/commit/e9186745d5df8cf7092e17103dee9c12b6b33ebf)**



---

archive/issue_comments_336125.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nI Travis,\n\nI'm curious, is there any performance gain. I had the impression that storing everything in python dict simply kills all possibilities of optimization ? \n\nWe discussed during past sage days, to re-implement combinatorial free modules, using arrays with a global dict for all object used only during input and output and not during linear algebra.\n\nFlorent",
    "created_at": "2017-03-17T15:54:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336125",
    "user": "https://github.com/hivert"
}
```

<div id="comment:3" align="right">comment:3</div>

I Travis,

I'm curious, is there any performance gain. I had the impression that storing everything in python dict simply kills all possibilities of optimization ? 

We discussed during past sage days, to re-implement combinatorial free modules, using arrays with a global dict for all object used only during input and output and not during linear algebra.

Florent



---

archive/issue_comments_336126.json:
```json
{
    "body": "Changed commit from **[`e918674`](https://github.com/sagemath/sagetrac-mirror/commit/e9186745d5df8cf7092e17103dee9c12b6b33ebf)** to **[`6b9d88b`](https://github.com/sagemath/sagetrac-mirror/commit/6b9d88b14b162c5d7ea88c3339896c3adc6e79da)**",
    "created_at": "2017-03-17T16:52:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336126",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`e918674`](https://github.com/sagemath/sagetrac-mirror/commit/e9186745d5df8cf7092e17103dee9c12b6b33ebf)** to **[`6b9d88b`](https://github.com/sagemath/sagetrac-mirror/commit/6b9d88b14b162c5d7ea88c3339896c3adc6e79da)**



---

archive/issue_comments_336127.json:
```json
{
    "body": "<div id=\"comment:4\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6b9d88b14b162c5d7ea88c3339896c3adc6e79da\"><code>6b9d88b</code></a></td><td><code>Doing some additional tweaks.</code></td></tr></table>\n",
    "created_at": "2017-03-17T16:52:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336127",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:4"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6b9d88b14b162c5d7ea88c3339896c3adc6e79da"><code>6b9d88b</code></a></td><td><code>Doing some additional tweaks.</code></td></tr></table>




---

archive/issue_comments_336128.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nThere seems to be a little bit with doing basic operations:\n\n```\nsage: C = CombinatorialFreeModule(QQ, [1,2,3])\nsage: x = sum(C.basis())\nsage: %timeit [x + x for _ in range(1000)]\n100 loops, best of 3: 2.57 ms per loop\n```\nvs old:\n\n```\nsage: C = CombinatorialFreeModule(QQ, [1,2,3])\nsage: x = sum(C.basis())\nsage: %timeit [x + x for _ in range(1000)]\n100 loops, best of 3: 2.94 ms per loop\n```\nWhile it's not much, it is something like a 10-15% speedup, but it is something likely to be called a significant number of times. It's even more so for scalar multiplication:\n\n```\nsage: s = SymmetricFunctions(ZZ).s()\nsage: x = s.an_element()\nsage: %timeit [4*x for _ in range(1000)]\n100 loops, best of 3: 2.49 ms per loop\n```\nvs old:\n\n```\nsage: %timeit [4*x for _ in range(1000)]\n100 loops, best of 3: 3.42 ms per loop\n```\nI might even be able to get some more speed if I am smarter in how we create the results of, e.g., `_add_`.",
    "created_at": "2017-03-17T16:52:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336128",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:5" align="right">comment:5</div>

There seems to be a little bit with doing basic operations:

```
sage: C = CombinatorialFreeModule(QQ, [1,2,3])
sage: x = sum(C.basis())
sage: %timeit [x + x for _ in range(1000)]
100 loops, best of 3: 2.57 ms per loop
```
vs old:

```
sage: C = CombinatorialFreeModule(QQ, [1,2,3])
sage: x = sum(C.basis())
sage: %timeit [x + x for _ in range(1000)]
100 loops, best of 3: 2.94 ms per loop
```
While it's not much, it is something like a 10-15% speedup, but it is something likely to be called a significant number of times. It's even more so for scalar multiplication:

```
sage: s = SymmetricFunctions(ZZ).s()
sage: x = s.an_element()
sage: %timeit [4*x for _ in range(1000)]
100 loops, best of 3: 2.49 ms per loop
```
vs old:

```
sage: %timeit [4*x for _ in range(1000)]
100 loops, best of 3: 3.42 ms per loop
```
I might even be able to get some more speed if I am smarter in how we create the results of, e.g., `_add_`.



---

archive/issue_comments_336129.json:
```json
{
    "body": "<div id=\"comment:6\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f1fcdd97670b9450f31e1230250dba8cde53c790\"><code>f1fcdd9</code></a></td><td><code>Do not go through _from_dict but directly create an element.</code></td></tr></table>\n",
    "created_at": "2017-03-17T17:02:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336129",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:6"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f1fcdd97670b9450f31e1230250dba8cde53c790"><code>f1fcdd9</code></a></td><td><code>Do not go through _from_dict but directly create an element.</code></td></tr></table>




---

archive/issue_comments_336130.json:
```json
{
    "body": "Changed commit from **[`6b9d88b`](https://github.com/sagemath/sagetrac-mirror/commit/6b9d88b14b162c5d7ea88c3339896c3adc6e79da)** to **[`f1fcdd9`](https://github.com/sagemath/sagetrac-mirror/commit/f1fcdd97670b9450f31e1230250dba8cde53c790)**",
    "created_at": "2017-03-17T17:02:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336130",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`6b9d88b`](https://github.com/sagemath/sagetrac-mirror/commit/6b9d88b14b162c5d7ea88c3339896c3adc6e79da)** to **[`f1fcdd9`](https://github.com/sagemath/sagetrac-mirror/commit/f1fcdd97670b9450f31e1230250dba8cde53c790)**



---

archive/issue_comments_336131.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nThat gives a very nice speed boost:\n\n```\nsage: C = CombinatorialFreeModule(QQ, [1,2,3])\n....: x = sum(C.basis())\n....: %timeit [x + x for _ in range(1000)]\n....: \n1000 loops, best of 3: 1.84 ms per loop\nsage: s = SymmetricFunctions(ZZ).s()\nsage: x = s.an_element()\nsage: %timeit [4*x for _ in range(1000)]\n100 loops, best of 3: 2.05 ms per loop\n```\nNow those Python calls become relatively expensive, so we should avoid them.",
    "created_at": "2017-03-17T17:03:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336131",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:7" align="right">comment:7</div>

That gives a very nice speed boost:

```
sage: C = CombinatorialFreeModule(QQ, [1,2,3])
....: x = sum(C.basis())
....: %timeit [x + x for _ in range(1000)]
....: 
1000 loops, best of 3: 1.84 ms per loop
sage: s = SymmetricFunctions(ZZ).s()
sage: x = s.an_element()
sage: %timeit [4*x for _ in range(1000)]
100 loops, best of 3: 2.05 ms per loop
```
Now those Python calls become relatively expensive, so we should avoid them.



---

archive/issue_comments_336132.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nFr\u00e9d\u00e9ric, I'm cc-ing you because you might want to note that I am taking care of the `__cmp__` issue here as well.",
    "created_at": "2017-03-17T17:04:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336132",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:8" align="right">comment:8</div>

Fr√©d√©ric, I'm cc-ing you because you might want to note that I am taking care of the `__cmp__` issue here as well.



---

archive/issue_events_316141.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-03-25T08:10:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22632#event-316141"
}
```



---

archive/issue_events_316142.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-03-25T08:10:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22632#event-316142"
}
```



---

archive/issue_comments_336133.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nmany broken doctests..",
    "created_at": "2017-03-25T08:10:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336133",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:9" align="right">comment:9</div>

many broken doctests..



---

archive/issue_comments_336134.json:
```json
{
    "body": "<div id=\"comment:10\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1d4aa1c1ae110e7318dca183c7ed8be0dbf0ba32\"><code>1d4aa1c</code></a></td><td><code>Fixing unpickling issues.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4ee3313767ce3b3be2f7b5a8f5938d0d6c3e0edc\"><code>4ee3313</code></a></td><td><code>Fixing Cython not inheriting `_rmul_` and `_lmul_` from different signatures.</code></td></tr></table>\n",
    "created_at": "2017-03-25T18:04:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336134",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:10"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1d4aa1c1ae110e7318dca183c7ed8be0dbf0ba32"><code>1d4aa1c</code></a></td><td><code>Fixing unpickling issues.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4ee3313767ce3b3be2f7b5a8f5938d0d6c3e0edc"><code>4ee3313</code></a></td><td><code>Fixing Cython not inheriting `_rmul_` and `_lmul_` from different signatures.</code></td></tr></table>




---

archive/issue_comments_336135.json:
```json
{
    "body": "Changed commit from **[`f1fcdd9`](https://github.com/sagemath/sagetrac-mirror/commit/f1fcdd97670b9450f31e1230250dba8cde53c790)** to **[`4ee3313`](https://github.com/sagemath/sagetrac-mirror/commit/4ee3313767ce3b3be2f7b5a8f5938d0d6c3e0edc)**",
    "created_at": "2017-03-25T18:04:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336135",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`f1fcdd9`](https://github.com/sagemath/sagetrac-mirror/commit/f1fcdd97670b9450f31e1230250dba8cde53c790)** to **[`4ee3313`](https://github.com/sagemath/sagetrac-mirror/commit/4ee3313767ce3b3be2f7b5a8f5938d0d6c3e0edc)**



---

archive/issue_events_316143.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-03-25T18:06:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22632#event-316143"
}
```



---

archive/issue_events_316144.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-03-25T18:06:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22632#event-316144"
}
```



---

archive/issue_comments_336136.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nFixed the pickling issues and the other failures (incompatible signatures for `_lmul_` and `_rmul_`).",
    "created_at": "2017-03-25T18:06:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336136",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:11" align="right">comment:11</div>

Fixed the pickling issues and the other failures (incompatible signatures for `_lmul_` and `_rmul_`).



---

archive/issue_comments_336137.json:
```json
{
    "body": "Changed commit from **[`4ee3313`](https://github.com/sagemath/sagetrac-mirror/commit/4ee3313767ce3b3be2f7b5a8f5938d0d6c3e0edc)** to **[`d87735d`](https://github.com/sagemath/sagetrac-mirror/commit/d87735db11bdeab38d4932ca3b46abba8d4ba185)**",
    "created_at": "2017-03-28T05:30:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336137",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`4ee3313`](https://github.com/sagemath/sagetrac-mirror/commit/4ee3313767ce3b3be2f7b5a8f5938d0d6c3e0edc)** to **[`d87735d`](https://github.com/sagemath/sagetrac-mirror/commit/d87735db11bdeab38d4932ca3b46abba8d4ba185)**



---

archive/issue_comments_336138.json:
```json
{
    "body": "<div id=\"comment:12\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d87735db11bdeab38d4932ca3b46abba8d4ba185\"><code>d87735d</code></a></td><td><code>Fixed trivial doctest failure.</code></td></tr></table>\n",
    "created_at": "2017-03-28T05:30:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336138",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:12"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d87735db11bdeab38d4932ca3b46abba8d4ba185"><code>d87735d</code></a></td><td><code>Fixed trivial doctest failure.</code></td></tr></table>




---

archive/issue_comments_336139.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nPatchbot is green (essentially, doctest failure is independent).",
    "created_at": "2017-04-14T05:44:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336139",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:13" align="right">comment:13</div>

Patchbot is green (essentially, doctest failure is independent).



---

archive/issue_comments_336140.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nping",
    "created_at": "2017-05-13T22:55:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336140",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:14" align="right">comment:14</div>

ping



---

archive/issue_comments_336141.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\n\n```\ndiff --git a/src/doc/en/thematic_tutorials/tutorial-objects-and-classes.rst b/src/doc/en/thematic_tutorials/tutorial-objects-and-classes.rst\nindex 3f964bf..749ab5f 100644\n--- a/src/doc/en/thematic_tutorials/tutorial-objects-and-classes.rst\n+++ b/src/doc/en/thematic_tutorials/tutorial-objects-and-classes.rst\n@@ -285,8 +285,7 @@ Some particular actions modify the data structure of ``el``::\n        sage: el.__class__\n         <class 'sage.combinat.free_module.CombinatorialFreeModule_with_category.element_class'>\n        sage: el.__dict__\n-       {'__custom_name': 'foo',\n-        '_monomial_coefficients': {[1, 2, 3]: 1, [1, 3, 2]: 3}}\n+       {'__custom_name': 'foo'}\n```\n\nPlausibly the explanation around that change needs to be updated a bit: there remains no \"normal\" attribute in this example. Maybe `el.foo=1` could be issued before, and a comment added after that `_monomial_coefficients` is a Cython attribute?\n\nIn general, this seems to be calling for changing the running example for this tutorial. The current one is a bit complicated. But that's for a later ticket.",
    "created_at": "2017-05-16T15:29:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336141",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:15" align="right">comment:15</div>


```
diff --git a/src/doc/en/thematic_tutorials/tutorial-objects-and-classes.rst b/src/doc/en/thematic_tutorials/tutorial-objects-and-classes.rst
index 3f964bf..749ab5f 100644
--- a/src/doc/en/thematic_tutorials/tutorial-objects-and-classes.rst
+++ b/src/doc/en/thematic_tutorials/tutorial-objects-and-classes.rst
@@ -285,8 +285,7 @@ Some particular actions modify the data structure of ``el``::
        sage: el.__class__
         <class 'sage.combinat.free_module.CombinatorialFreeModule_with_category.element_class'>
        sage: el.__dict__
-       {'__custom_name': 'foo',
-        '_monomial_coefficients': {[1, 2, 3]: 1, [1, 3, 2]: 3}}
+       {'__custom_name': 'foo'}
```

Plausibly the explanation around that change needs to be updated a bit: there remains no "normal" attribute in this example. Maybe `el.foo=1` could be issued before, and a comment added after that `_monomial_coefficients` is a Cython attribute?

In general, this seems to be calling for changing the running example for this tutorial. The current one is a bit complicated. But that's for a later ticket.



---

archive/issue_comments_336142.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\n\n```\n@@ -242,7 +238,8 @@ class FreeAlgebraElement(AlgebraElement, CombinatorialFreeModuleElement):\n             if self_on_left:\n                 return Factorization([(self, 1)]) * scalar\n             return scalar * Factorization([(self, 1)])\n-        return super(FreeAlgebraElement, self)._acted_upon_(scalar, self_on_left)\n+        ret = super(FreeAlgebraElement, self)._acted_upon_(scalar, self_on_left)\n+        return ret\n \n```\nWhat's the point?",
    "created_at": "2017-05-16T15:32:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336142",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:16" align="right">comment:16</div>


```
@@ -242,7 +238,8 @@ class FreeAlgebraElement(AlgebraElement, CombinatorialFreeModuleElement):
             if self_on_left:
                 return Factorization([(self, 1)]) * scalar
             return scalar * Factorization([(self, 1)])
-        return super(FreeAlgebraElement, self)._acted_upon_(scalar, self_on_left)
+        ret = super(FreeAlgebraElement, self)._acted_upon_(scalar, self_on_left)
+        return ret
 
```
What's the point?



---

archive/issue_comments_336143.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nAs you notice, I am going through the changes. Up to those details, it looks good :-)",
    "created_at": "2017-05-16T15:32:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336143",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:17" align="right">comment:17</div>

As you notice, I am going through the changes. Up to those details, it looks good :-)



---

archive/issue_comments_336144.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nAbout `_divide_if_possible_`: since we are moving it anyway, shall we use the occasion to put it somewhere meaningful? Maybe as a method in EuclideanDomains, as `x._divide_if_possible(r)`, next to `quo_rem` which it depends on?",
    "created_at": "2017-05-16T15:38:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336144",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:18" align="right">comment:18</div>

About `_divide_if_possible_`: since we are moving it anyway, shall we use the occasion to put it somewhere meaningful? Maybe as a method in EuclideanDomains, as `x._divide_if_possible(r)`, next to `quo_rem` which it depends on?



---

archive/issue_comments_336145.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nI would move the comment about handling old pickles in the doc of\n`CombinatorialFreeModule.Element.__setstate__`, with a trac ref.\nPlease also add a brief comment and trac ref for the `unpickle_override`\nat the end of the file.",
    "created_at": "2017-05-16T15:46:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336145",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:19" align="right">comment:19</div>

I would move the comment about handling old pickles in the doc of
`CombinatorialFreeModule.Element.__setstate__`, with a trac ref.
Please also add a brief comment and trac ref for the `unpickle_override`
at the end of the file.



---

archive/issue_comments_336146.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nCould you elaborate a bit why we need `CombinatorialFreeModule.Element` to be a subclass of `IndexedFreeModuleElement`? In particular, can you provide a minimal non-working example?",
    "created_at": "2017-05-16T15:50:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336146",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:20" align="right">comment:20</div>

Could you elaborate a bit why we need `CombinatorialFreeModule.Element` to be a subclass of `IndexedFreeModuleElement`? In particular, can you provide a minimal non-working example?



---

archive/issue_comments_336147.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\n\n```\n# TODO: move the content of this class to CombinatorialFreeModule.Element and ModulesWithBasis.Element\ncdef class IndexedFreeModuleElement(Element):\n```\n\nThe TODO could be updated :-)",
    "created_at": "2017-05-16T15:52:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336147",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:21" align="right">comment:21</div>


```
# TODO: move the content of this class to CombinatorialFreeModule.Element and ModulesWithBasis.Element
cdef class IndexedFreeModuleElement(Element):
```

The TODO could be updated :-)



---

archive/issue_comments_336148.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nI am wondering whether the printing methods (_sorted_items_for_printing, latex, repr, asciiart, ...) should be moved to `Modules.WithBasis.ElementMethods`. We are moving them anyway, and I believe they would be a reasonable default implementation. That would require providing a default value for `parent._print_options` though, and deciding for a generic idiom to run through the items.\n\nWhat do you think?\n\nWe could also keep that for a later ticket.",
    "created_at": "2017-05-16T15:59:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336148",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:22" align="right">comment:22</div>

I am wondering whether the printing methods (_sorted_items_for_printing, latex, repr, asciiart, ...) should be moved to `Modules.WithBasis.ElementMethods`. We are moving them anyway, and I believe they would be a reasonable default implementation. That would require providing a default value for `parent._print_options` though, and deciding for a generic idiom to run through the items.

What do you think?

We could also keep that for a later ticket.



---

archive/issue_comments_336149.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nInstead of `sage.modules.with_basis.indexed_free_module_element`, we could use the shorter `sage.modules.with_basis.element`. That would be consistent with the nearby `morphism` module.\nI don't foresee other element classes in this module that would not be element classes for `IndexedFreeModule`.",
    "created_at": "2017-05-16T16:11:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336149",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:23" align="right">comment:23</div>

Instead of `sage.modules.with_basis.indexed_free_module_element`, we could use the shorter `sage.modules.with_basis.element`. That would be consistent with the nearby `morphism` module.
I don't foresee other element classes in this module that would not be element classes for `IndexedFreeModule`.



---

archive/issue_comments_336150.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nUsers will have code importing `CombinatorialFreeModuleElement`. We should support them with a deprecation alias \"Please use `CombinatorialFreeModule.Element` or `IndexedFreeModuleElement`.\"\n\nIf we wan't to be even kinder to our users, helping them prepare for the next step, we could have `sage.modules.with_basis.indexed_free_module.IndexedFreeModule` (or just `.free_module.`?) be an alias for `CombinatorialFreeModuleElement`. Then the above message warning would suggest `IndexedFreeModule.Element`.",
    "created_at": "2017-05-16T16:14:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336150",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:24" align="right">comment:24</div>

Users will have code importing `CombinatorialFreeModuleElement`. We should support them with a deprecation alias "Please use `CombinatorialFreeModule.Element` or `IndexedFreeModuleElement`."

If we wan't to be even kinder to our users, helping them prepare for the next step, we could have `sage.modules.with_basis.indexed_free_module.IndexedFreeModule` (or just `.free_module.`?) be an alias for `CombinatorialFreeModuleElement`. Then the above message warning would suggest `IndexedFreeModule.Element`.



---

archive/issue_comments_336151.json:
```json
{
    "body": "Changed commit from **[`d87735d`](https://github.com/sagemath/sagetrac-mirror/commit/d87735db11bdeab38d4932ca3b46abba8d4ba185)** to **[`f66cb0d`](https://github.com/sagemath/sagetrac-mirror/commit/f66cb0d2a72a70fb65d22bc115d75d4e85614899)**",
    "created_at": "2017-05-17T16:28:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336151",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`d87735d`](https://github.com/sagemath/sagetrac-mirror/commit/d87735db11bdeab38d4932ca3b46abba8d4ba185)** to **[`f66cb0d`](https://github.com/sagemath/sagetrac-mirror/commit/f66cb0d2a72a70fb65d22bc115d75d4e85614899)**



---

archive/issue_comments_336152.json:
```json
{
    "body": "<div id=\"comment:25\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fbefa6609239a333936d50e6ca557ee6e1c81699\"><code>fbefa66</code></a></td><td><code>Merge branch 'public/combinat/cythonize_CFM_element-22632' of git://trac.sagemath.org/sage into public/combinat/cythonize_CFM_element-22632</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/68cdf6702c8e35ee97b5d9fa508821076b78b0e7\"><code>68cdf67</code></a></td><td><code>Fixing things from testing.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/99c99bf5a7d34e8e691e2979c0138fd09728c3a4\"><code>99c99bf</code></a></td><td><code>Moving _divide_if_possible to EuclideanDomains.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cafb215ba2b808eb5207bf12aed48bb1e01bb235\"><code>cafb215</code></a></td><td><code>Remove map_coefficients call in __truediv__.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a8eeca663681d30ea986fd15a5f90d30b5363059\"><code>a8eeca6</code></a></td><td><code>Remove comment and deprecate CombinatorialFreeModuleElement.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6b9694218d2cf7ba2ad82f9db3a9bd6c8d13f47b\"><code>6b96942</code></a></td><td><code>Rename indexed_free_module_element to indexed_element.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f66cb0d2a72a70fb65d22bc115d75d4e85614899\"><code>f66cb0d</code></a></td><td><code>Updating tutorial.</code></td></tr></table>\n",
    "created_at": "2017-05-17T16:28:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336152",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:25"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fbefa6609239a333936d50e6ca557ee6e1c81699"><code>fbefa66</code></a></td><td><code>Merge branch 'public/combinat/cythonize_CFM_element-22632' of git://trac.sagemath.org/sage into public/combinat/cythonize_CFM_element-22632</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/68cdf6702c8e35ee97b5d9fa508821076b78b0e7"><code>68cdf67</code></a></td><td><code>Fixing things from testing.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/99c99bf5a7d34e8e691e2979c0138fd09728c3a4"><code>99c99bf</code></a></td><td><code>Moving _divide_if_possible to EuclideanDomains.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cafb215ba2b808eb5207bf12aed48bb1e01bb235"><code>cafb215</code></a></td><td><code>Remove map_coefficients call in __truediv__.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a8eeca663681d30ea986fd15a5f90d30b5363059"><code>a8eeca6</code></a></td><td><code>Remove comment and deprecate CombinatorialFreeModuleElement.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6b9694218d2cf7ba2ad82f9db3a9bd6c8d13f47b"><code>6b96942</code></a></td><td><code>Rename indexed_free_module_element to indexed_element.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f66cb0d2a72a70fb65d22bc115d75d4e85614899"><code>f66cb0d</code></a></td><td><code>Updating tutorial.</code></td></tr></table>




---

archive/issue_comments_336153.json:
```json
{
    "body": "<div id=\"comment:26\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e0553bef39dbcee0dbaf72e6e38f9ad93f87d1c3\"><code>e0553be</code></a></td><td><code>Adding comments about pickles.</code></td></tr></table>\n",
    "created_at": "2017-05-17T16:44:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336153",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:26"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e0553bef39dbcee0dbaf72e6e38f9ad93f87d1c3"><code>e0553be</code></a></td><td><code>Adding comments about pickles.</code></td></tr></table>




---

archive/issue_comments_336154.json:
```json
{
    "body": "Changed commit from **[`f66cb0d`](https://github.com/sagemath/sagetrac-mirror/commit/f66cb0d2a72a70fb65d22bc115d75d4e85614899)** to **[`e0553be`](https://github.com/sagemath/sagetrac-mirror/commit/e0553bef39dbcee0dbaf72e6e38f9ad93f87d1c3)**",
    "created_at": "2017-05-17T16:44:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336154",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`f66cb0d`](https://github.com/sagemath/sagetrac-mirror/commit/f66cb0d2a72a70fb65d22bc115d75d4e85614899)** to **[`e0553be`](https://github.com/sagemath/sagetrac-mirror/commit/e0553bef39dbcee0dbaf72e6e38f9ad93f87d1c3)**



---

archive/issue_comments_336155.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\n- [comment:15](#comment:15) I added a comment. Feel free to change. I also agree that a tutorial update should be done on a separate ticket.\n- [comment:16](#comment:16) I had separated that in order to track down a bug ([4ee3313](https://github.com/sagemath/sagetrac-mirror/commit/4ee3313767ce3b3be2f7b5a8f5938d0d6c3e0edc)).\n- [comment:18](#comment:18) Good point. Done\n- [comment:19](#comment:19) I feel these are basically useless to repeating what the code makes (more) clear, but added.\n- [comment:20](#comment:20) This doesn't work with any subclasses where you need a `_mul_` from the category. Change it and try to multiply two symmetric group algebra elements for example:\n\n  ```\n  sage: SymmetricGroupAlgebra(QQ, 3)\n  Symmetric group algebra of order 3 over Rational Field\n  sage: prod(_.algebra_generators())\n  ...\n  TypeError: 'NotImplementedType' object is not callable\n  ```\n  There were also pickling issues.\n- [comment:21](#comment:21) Done.\n- [comment:22](#comment:22) -1 as that is a little too close to enforcing elements being printed as sums, which is not what we want.\n- [comment:23](#comment:23) I changed the file name to `indexed_element` as `element` is too generic for my tastes, but I left the class name the same.\n- [comment:24](#comment:24) Done, but I slightly disagree with needing a deprecation because it was never imported into the global namespace. However, it was in the (public) doc, so it is good to have it. At this point, I think we should reference both and let the user decide.",
    "created_at": "2017-05-17T16:45:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336155",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:27" align="right">comment:27</div>

- [comment:15](#comment:15) I added a comment. Feel free to change. I also agree that a tutorial update should be done on a separate ticket.
- [comment:16](#comment:16) I had separated that in order to track down a bug ([4ee3313](https://github.com/sagemath/sagetrac-mirror/commit/4ee3313767ce3b3be2f7b5a8f5938d0d6c3e0edc)).
- [comment:18](#comment:18) Good point. Done
- [comment:19](#comment:19) I feel these are basically useless to repeating what the code makes (more) clear, but added.
- [comment:20](#comment:20) This doesn't work with any subclasses where you need a `_mul_` from the category. Change it and try to multiply two symmetric group algebra elements for example:

  ```
  sage: SymmetricGroupAlgebra(QQ, 3)
  Symmetric group algebra of order 3 over Rational Field
  sage: prod(_.algebra_generators())
  ...
  TypeError: 'NotImplementedType' object is not callable
  ```
  There were also pickling issues.
- [comment:21](#comment:21) Done.
- [comment:22](#comment:22) -1 as that is a little too close to enforcing elements being printed as sums, which is not what we want.
- [comment:23](#comment:23) I changed the file name to `indexed_element` as `element` is too generic for my tastes, but I left the class name the same.
- [comment:24](#comment:24) Done, but I slightly disagree with needing a deprecation because it was never imported into the global namespace. However, it was in the (public) doc, so it is good to have it. At this point, I think we should reference both and let the user decide.



---

archive/issue_comments_336156.json:
```json
{
    "body": "Changed commit from **[`e0553be`](https://github.com/sagemath/sagetrac-mirror/commit/e0553bef39dbcee0dbaf72e6e38f9ad93f87d1c3)** to **[`b21fb16`](https://github.com/sagemath/sagetrac-mirror/commit/b21fb167ab9562160ba5650e03ffd44a68be2c37)**",
    "created_at": "2017-05-18T17:59:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336156",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`e0553be`](https://github.com/sagemath/sagetrac-mirror/commit/e0553bef39dbcee0dbaf72e6e38f9ad93f87d1c3)** to **[`b21fb16`](https://github.com/sagemath/sagetrac-mirror/commit/b21fb167ab9562160ba5650e03ffd44a68be2c37)**



---

archive/issue_comments_336157.json:
```json
{
    "body": "<div id=\"comment:28\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b21fb167ab9562160ba5650e03ffd44a68be2c37\"><code>b21fb16</code></a></td><td><code>22632: just a touch of polishing on the thematic tutorial change</code></td></tr></table>\n",
    "created_at": "2017-05-18T17:59:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336157",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:28"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b21fb167ab9562160ba5650e03ffd44a68be2c37"><code>b21fb16</code></a></td><td><code>22632: just a touch of polishing on the thematic tutorial change</code></td></tr></table>




---

archive/issue_comments_336158.json:
```json
{
    "body": "<div id=\"comment:29\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b13a870be54a27bfa1f2f71230256defc5b0d3a9\"><code>b13a870</code></a></td><td><code>22632: use trac role instead of full url in doc</code></td></tr></table>\n",
    "created_at": "2017-05-18T18:04:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336158",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:29"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b13a870be54a27bfa1f2f71230256defc5b0d3a9"><code>b13a870</code></a></td><td><code>22632: use trac role instead of full url in doc</code></td></tr></table>




---

archive/issue_comments_336159.json:
```json
{
    "body": "Changed commit from **[`b21fb16`](https://github.com/sagemath/sagetrac-mirror/commit/b21fb167ab9562160ba5650e03ffd44a68be2c37)** to **[`b13a870`](https://github.com/sagemath/sagetrac-mirror/commit/b13a870be54a27bfa1f2f71230256defc5b0d3a9)**",
    "created_at": "2017-05-18T18:04:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336159",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`b21fb16`](https://github.com/sagemath/sagetrac-mirror/commit/b21fb167ab9562160ba5650e03ffd44a68be2c37)** to **[`b13a870`](https://github.com/sagemath/sagetrac-mirror/commit/b13a870be54a27bfa1f2f71230256defc5b0d3a9)**



---

archive/issue_comments_336160.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nReplying to [@tscrim](#comment:27):\n> - [comment:15](#comment:15) I added a comment. Feel free to change.\n\nThanks; I did a second pass on it. Good to go.\n\n> - [comment:22](#comment:22) -1 as that is a little too close to enforcing elements being printed as sums, which is not what we want.\n\nI see it as merely providing a sane default which works generically\nbut can be overridden at will. Anyway, that's admittedly out of scope\nfor this ticket; we can decide later on.\n\n> - [comment:23](#comment:23) I changed the file name to `indexed_element` as `element` is too generic for my tastes, but I left the class name the same.\n\nSounds good.\n\n> it was never imported into the global namespace.\n> However, it was in the (public) doc, so it is good to have it.\n\nYup, exactly.\n\n> At this point, I think we should reference both and let the user decide.\n\nOk!\n\nOut of curiosity, I am now going to have a quick look at the inheritance thing of\ncomment:20. Other than that, it's good to go; thanks for all the hard\nwork!",
    "created_at": "2017-05-18T18:13:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336160",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:30" align="right">comment:30</div>

Replying to [@tscrim](#comment:27):
> - [comment:15](#comment:15) I added a comment. Feel free to change.

Thanks; I did a second pass on it. Good to go.

> - [comment:22](#comment:22) -1 as that is a little too close to enforcing elements being printed as sums, which is not what we want.

I see it as merely providing a sane default which works generically
but can be overridden at will. Anyway, that's admittedly out of scope
for this ticket; we can decide later on.

> - [comment:23](#comment:23) I changed the file name to `indexed_element` as `element` is too generic for my tastes, but I left the class name the same.

Sounds good.

> it was never imported into the global namespace.
> However, it was in the (public) doc, so it is good to have it.

Yup, exactly.

> At this point, I think we should reference both and let the user decide.

Ok!

Out of curiosity, I am now going to have a quick look at the inheritance thing of
comment:20. Other than that, it's good to go; thanks for all the hard
work!



---

archive/issue_comments_336161.json:
```json
{
    "body": "Changed commit from **[`b13a870`](https://github.com/sagemath/sagetrac-mirror/commit/b13a870be54a27bfa1f2f71230256defc5b0d3a9)** to **[`dec9bd6`](https://github.com/sagemath/sagetrac-mirror/commit/dec9bd65d49e91af6c662b658e838b1476306ec5)**",
    "created_at": "2017-05-18T18:57:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336161",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`b13a870`](https://github.com/sagemath/sagetrac-mirror/commit/b13a870be54a27bfa1f2f71230256defc5b0d3a9)** to **[`dec9bd6`](https://github.com/sagemath/sagetrac-mirror/commit/dec9bd65d49e91af6c662b658e838b1476306ec5)**



---

archive/issue_comments_336162.json:
```json
{
    "body": "<div id=\"comment:31\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dec9bd65d49e91af6c662b658e838b1476306ec5\"><code>dec9bd6</code></a></td><td><code>22632: make CombinatorialFreeModule.Element an alias (and not subclass) of IndexedFreeModuleElement</code></td></tr></table>\n",
    "created_at": "2017-05-18T18:57:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336162",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:31"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dec9bd65d49e91af6c662b658e838b1476306ec5"><code>dec9bd6</code></a></td><td><code>22632: make CombinatorialFreeModule.Element an alias (and not subclass) of IndexedFreeModuleElement</code></td></tr></table>




---

archive/issue_comments_336163.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nAdvantage of the above commit:\n- A bit simpler: no distinction anymore between `CFF.Element` and `IndexedFreeModuleElement`. In particular there is no risk to have someone use directly IndexedFreeModule without inheriting from it.\n- Avoids a double inheritance, with CFF.element_class deriving from CFF.Element itself deriving from `IndexedFreeModuleElement`\n\nInconvenient:\n- requires to override element_class\n\nI believe it's worth it. What do you think?",
    "created_at": "2017-05-18T19:04:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336163",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:32" align="right">comment:32</div>

Advantage of the above commit:
- A bit simpler: no distinction anymore between `CFF.Element` and `IndexedFreeModuleElement`. In particular there is no risk to have someone use directly IndexedFreeModule without inheriting from it.
- Avoids a double inheritance, with CFF.element_class deriving from CFF.Element itself deriving from `IndexedFreeModuleElement`

Inconvenient:
- requires to override element_class

I believe it's worth it. What do you think?



---

archive/issue_comments_336164.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nRunning tests here ...",
    "created_at": "2017-05-18T19:04:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336164",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:33" align="right">comment:33</div>

Running tests here ...



---

archive/issue_comments_336165.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nI am not so convinced as it hides a fault in a non-trivial way; it something that we should not need to do. I do agree it is more simple. Nevertheless, one should typically use a subclass of the `CFM.Element` when subclassing `CFM` and needing a new element class if they want to use the same data structures. Although I don't think there is too much difference between our two hacks.\n\nAlso, in some ways it almost looks like you are moving the unpickling to a completely unrelated class since\n\n```\nregister_unpickle_override(\"sage.combinat.free_module\",\n                           \"CombinatorialFreeModuleElement\",\n                           CombinatorialFreeModule.Element)\n```\nIf you want the `__setstate__` in `IndexedFreeModuleElement`, then this `register_unpickle_override` should redirect to that.",
    "created_at": "2017-05-18T19:30:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336165",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:34" align="right">comment:34</div>

I am not so convinced as it hides a fault in a non-trivial way; it something that we should not need to do. I do agree it is more simple. Nevertheless, one should typically use a subclass of the `CFM.Element` when subclassing `CFM` and needing a new element class if they want to use the same data structures. Although I don't think there is too much difference between our two hacks.

Also, in some ways it almost looks like you are moving the unpickling to a completely unrelated class since

```
register_unpickle_override("sage.combinat.free_module",
                           "CombinatorialFreeModuleElement",
                           CombinatorialFreeModule.Element)
```
If you want the `__setstate__` in `IndexedFreeModuleElement`, then this `register_unpickle_override` should redirect to that.



---

archive/issue_comments_336166.json:
```json
{
    "body": "<div id=\"comment:35\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6665822c21ba3765553f3df12e640c5042958d0d\"><code>6665822</code></a></td><td><code>22632: revert  b13a870be: the trac link is in an error message!</code></td></tr></table>\n",
    "created_at": "2017-05-18T21:43:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336166",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:35"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6665822c21ba3765553f3df12e640c5042958d0d"><code>6665822</code></a></td><td><code>22632: revert  b13a870be: the trac link is in an error message!</code></td></tr></table>




---

archive/issue_comments_336167.json:
```json
{
    "body": "Changed commit from **[`dec9bd6`](https://github.com/sagemath/sagetrac-mirror/commit/dec9bd65d49e91af6c662b658e838b1476306ec5)** to **[`6665822`](https://github.com/sagemath/sagetrac-mirror/commit/6665822c21ba3765553f3df12e640c5042958d0d)**",
    "created_at": "2017-05-18T21:43:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336167",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`dec9bd6`](https://github.com/sagemath/sagetrac-mirror/commit/dec9bd65d49e91af6c662b658e838b1476306ec5)** to **[`6665822`](https://github.com/sagemath/sagetrac-mirror/commit/6665822c21ba3765553f3df12e640c5042958d0d)**



---

archive/issue_comments_336168.json:
```json
{
    "body": "Changed commit from **[`6665822`](https://github.com/sagemath/sagetrac-mirror/commit/6665822c21ba3765553f3df12e640c5042958d0d)** to **[`4a77584`](https://github.com/sagemath/sagetrac-mirror/commit/4a77584f43adbbc36b279591929a7a4370292ad3)**",
    "created_at": "2017-05-18T21:45:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336168",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`6665822`](https://github.com/sagemath/sagetrac-mirror/commit/6665822c21ba3765553f3df12e640c5042958d0d)** to **[`4a77584`](https://github.com/sagemath/sagetrac-mirror/commit/4a77584f43adbbc36b279591929a7a4370292ad3)**



---

archive/issue_comments_336169.json:
```json
{
    "body": "<div id=\"comment:36\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/076d7cb3002acc3d2233756af99983b054ca4a32\"><code>076d7cb</code></a></td><td><code>22632: revert  b13a870be: the trac link is in an error message!</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4a77584f43adbbc36b279591929a7a4370292ad3\"><code>4a77584</code></a></td><td><code>22632: let register_pickle_override refer to IndexedFreeModuleElement and move it close by</code></td></tr></table>\n",
    "created_at": "2017-05-18T21:45:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336169",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:36"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/076d7cb3002acc3d2233756af99983b054ca4a32"><code>076d7cb</code></a></td><td><code>22632: revert  b13a870be: the trac link is in an error message!</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4a77584f43adbbc36b279591929a7a4370292ad3"><code>4a77584</code></a></td><td><code>22632: let register_pickle_override refer to IndexedFreeModuleElement and move it close by</code></td></tr></table>




---

archive/issue_comments_336170.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nReplying to [@tscrim](#comment:34):\n> I am not so convinced as it hides a fault in a non-trivial way; it something that we should not need to do. I do agree it is more simple. Nevertheless, one should typically use a subclass of the `CFM.Element` when subclassing `CFM` and needing a new element class if they want to use the same data structures. \n> Although I don't think there is too much difference between our two hacks.\n\nOk. I agree, it's minor anyway.\n\n> Also, in some ways it almost looks like you are moving the unpickling to a completely unrelated class since\n> \n> ```\n> register_unpickle_override(\"sage.combinat.free_module\",\n>                            \"CombinatorialFreeModuleElement\",\n>                            CombinatorialFreeModule.Element)\n> ```\n> If you want the `__setstate__` in `IndexedFreeModuleElement`, then this `register_unpickle_override` should redirect to that.\n\nGood point. Fixed. This prompted me to move the\n`register_unpickle_overide` next to `IndexedFreeModuleElement`.\n\nSorry for the forced-push; I had screwed up my commit just before.\n\nAltogether, I believe this is good to go!",
    "created_at": "2017-05-18T21:52:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336170",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:37" align="right">comment:37</div>

Replying to [@tscrim](#comment:34):
> I am not so convinced as it hides a fault in a non-trivial way; it something that we should not need to do. I do agree it is more simple. Nevertheless, one should typically use a subclass of the `CFM.Element` when subclassing `CFM` and needing a new element class if they want to use the same data structures. 
> Although I don't think there is too much difference between our two hacks.

Ok. I agree, it's minor anyway.

> Also, in some ways it almost looks like you are moving the unpickling to a completely unrelated class since
> 
> ```
> register_unpickle_override("sage.combinat.free_module",
>                            "CombinatorialFreeModuleElement",
>                            CombinatorialFreeModule.Element)
> ```
> If you want the `__setstate__` in `IndexedFreeModuleElement`, then this `register_unpickle_override` should redirect to that.

Good point. Fixed. This prompted me to move the
`register_unpickle_overide` next to `IndexedFreeModuleElement`.

Sorry for the forced-push; I had screwed up my commit just before.

Altogether, I believe this is good to go!



---

archive/issue_events_316145.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2017-05-18T21:53:19Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22632#event-316145"
}
```



---

archive/issue_events_316146.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2017-05-18T21:53:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22632#event-316146"
}
```



---

archive/issue_comments_336171.json:
```json
{
    "body": "Reviewer: **Nicolas M. Thi\u00e9ry**",
    "created_at": "2017-05-18T21:53:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336171",
    "user": "https://github.com/nthiery"
}
```

Reviewer: **Nicolas M. Thi√©ry**



---

archive/issue_comments_336172.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nOh, I forgot about cafb215ba2b808e: what's the rationale for replacing .map_coefficients by what looks like hand written equivalent?",
    "created_at": "2017-05-18T22:00:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336172",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:39" align="right">comment:39</div>

Oh, I forgot about cafb215ba2b808e: what's the rationale for replacing .map_coefficients by what looks like hand written equivalent?



---

archive/issue_comments_336173.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nOops, failing tests. Probably a triviality. Investigating.",
    "created_at": "2017-05-18T22:02:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336173",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:40" align="right">comment:40</div>

Oops, failing tests. Probably a triviality. Investigating.



---

archive/issue_events_316147.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2017-05-18T22:02:32Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22632#event-316147"
}
```



---

archive/issue_events_316148.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2017-05-18T22:02:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22632#event-316148"
}
```



---

archive/issue_comments_336174.json:
```json
{
    "body": "<div id=\"comment:41\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/06a299e1c6d6734ec4930dc4f720dca5a4ead6ad\"><code>06a299e</code></a></td><td><code>22632: fix typo in attribute name</code></td></tr></table>\n",
    "created_at": "2017-05-18T22:07:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336174",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:41"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/06a299e1c6d6734ec4930dc4f720dca5a4ead6ad"><code>06a299e</code></a></td><td><code>22632: fix typo in attribute name</code></td></tr></table>




---

archive/issue_comments_336175.json:
```json
{
    "body": "Changed commit from **[`4a77584`](https://github.com/sagemath/sagetrac-mirror/commit/4a77584f43adbbc36b279591929a7a4370292ad3)** to **[`06a299e`](https://github.com/sagemath/sagetrac-mirror/commit/06a299e1c6d6734ec4930dc4f720dca5a4ead6ad)**",
    "created_at": "2017-05-18T22:07:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336175",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`4a77584`](https://github.com/sagemath/sagetrac-mirror/commit/4a77584f43adbbc36b279591929a7a4370292ad3)** to **[`06a299e`](https://github.com/sagemath/sagetrac-mirror/commit/06a299e1c6d6734ec4930dc4f720dca5a4ead6ad)**



---

archive/issue_comments_336176.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nIt comes from the same commit :-) Just a typo in `_monomial_cofficients`. Fixed.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/06a299e1c6d6734ec4930dc4f720dca5a4ead6ad\"><code>06a299e</code></a></td><td><code>22632: fix typo in attribute name</code></td></tr></table>\n",
    "created_at": "2017-05-18T22:09:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336176",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:42" align="right">comment:42</div>

It comes from the same commit :-) Just a typo in `_monomial_cofficients`. Fixed.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/06a299e1c6d6734ec4930dc4f720dca5a4ead6ad"><code>06a299e</code></a></td><td><code>22632: fix typo in attribute name</code></td></tr></table>




---

archive/issue_events_316149.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2017-05-18T22:10:49Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22632#event-316149"
}
```



---

archive/issue_events_316150.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2017-05-18T22:10:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22632#event-316150"
}
```



---

archive/issue_comments_336177.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\n\n```\nsage -t src/sage/homology/simplicial_complex.py  # 1 doctest failed\nsage -t src/sage/algebras/iwahori_hecke_algebra.py  # 18 doctests failed\nsage -t src/sage/calculus/calculus.py  # 1 doctest failed\nsage -t src/sage/categories/sets_cat.py  # 1 doctest failed\nsage -t src/sage/categories/hopf_algebras_with_basis.py  # 1 doctest failed\nsage -t src/sage/categories/algebras_with_basis.py  # 1 doctest failed\nsage -t src/sage/combinat/free_module.py  # 1 doctest failed\n```\n\nTwo types of failures:\n\n```\n...\n        return type(self)(F, {k: c._divide_if_possible(x)\n      File \"sage/structure/element.pyx\", line 459, in sage.structure.element.Element.__getattr__ (/opt/sage/src/build/cythonized/sage/structure/element.c:4256)\n        return self.getattr_from_category(name)\n      File \"sage/structure/element.pyx\", line 472, in sage.structure.element.Element.getattr_from_category (/opt/sage/src/build/cythonized/sage/structure/element.c:4365)\n        return getattr_from_other_class(self, cls, name)\n      File \"sage/structure/misc.pyx\", line 300, in sage.structure.misc.getattr_from_other_class (/opt/sage/src/build/cythonized/sage/structure/misc.c:1933)\n        raise dummy_attribute_error\n    AttributeError: 'sage.rings.polynomial.laurent_polynomial.LaurentPolynomial_univariate' object has no attribute '_divide_if_possible'\n```\n\nand trivial one about the element_class name. Working on the latter.",
    "created_at": "2017-05-18T23:59:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336177",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:44" align="right">comment:44</div>


```
sage -t src/sage/homology/simplicial_complex.py  # 1 doctest failed
sage -t src/sage/algebras/iwahori_hecke_algebra.py  # 18 doctests failed
sage -t src/sage/calculus/calculus.py  # 1 doctest failed
sage -t src/sage/categories/sets_cat.py  # 1 doctest failed
sage -t src/sage/categories/hopf_algebras_with_basis.py  # 1 doctest failed
sage -t src/sage/categories/algebras_with_basis.py  # 1 doctest failed
sage -t src/sage/combinat/free_module.py  # 1 doctest failed
```

Two types of failures:

```
...
        return type(self)(F, {k: c._divide_if_possible(x)
      File "sage/structure/element.pyx", line 459, in sage.structure.element.Element.__getattr__ (/opt/sage/src/build/cythonized/sage/structure/element.c:4256)
        return self.getattr_from_category(name)
      File "sage/structure/element.pyx", line 472, in sage.structure.element.Element.getattr_from_category (/opt/sage/src/build/cythonized/sage/structure/element.c:4365)
        return getattr_from_other_class(self, cls, name)
      File "sage/structure/misc.pyx", line 300, in sage.structure.misc.getattr_from_other_class (/opt/sage/src/build/cythonized/sage/structure/misc.c:1933)
        raise dummy_attribute_error
    AttributeError: 'sage.rings.polynomial.laurent_polynomial.LaurentPolynomial_univariate' object has no attribute '_divide_if_possible'
```

and trivial one about the element_class name. Working on the latter.



---

archive/issue_comments_336178.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\nThe former probably comes from a parent whose categories are not initialized.",
    "created_at": "2017-05-19T00:06:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336178",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:45" align="right">comment:45</div>

The former probably comes from a parent whose categories are not initialized.



---

archive/issue_comments_336179.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">comment:46</div>\n\nReplying to [@nthiery](#comment:45):\n> The former probably comes from a parent whose categories are not initialized.\n\nThe problem comes from the fact that Laurent polynomials are not in Euclidean domains. There are also a number of natural rings that are not Euclidean domains, but have a `quo_rem` that we could at least try this with (e.g., **Z**[x]). So I'm thinking of demoting it back down from the category.",
    "created_at": "2017-05-19T02:24:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336179",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:46" align="right">comment:46</div>

Replying to [@nthiery](#comment:45):
> The former probably comes from a parent whose categories are not initialized.

The problem comes from the fact that Laurent polynomials are not in Euclidean domains. There are also a number of natural rings that are not Euclidean domains, but have a `quo_rem` that we could at least try this with (e.g., **Z**[x]). So I'm thinking of demoting it back down from the category.



---

archive/issue_comments_336180.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">comment:47</div>\n\nI just found out the same :-)\nYeah, either demoting it back down, or lifting it up to Rings(). After all, it's a private method. So if it fails because it requires another method which is not implemented, that's ok. At least it will be easier to discover than if it's hidden in some random Python module. It's consistent with FreeModule's requirement of taking a ring as input.",
    "created_at": "2017-05-19T02:35:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336180",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:47" align="right">comment:47</div>

I just found out the same :-)
Yeah, either demoting it back down, or lifting it up to Rings(). After all, it's a private method. So if it fails because it requires another method which is not implemented, that's ok. At least it will be easier to discover than if it's hidden in some random Python module. It's consistent with FreeModule's requirement of taking a ring as input.



---

archive/issue_comments_336181.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">comment:48</div>\n\nFor the other failure: it stems from the fact that the created element\nclass's name is set to reflect that it's the element class of a given\nparent:\n\n```\nsage: A = Algebras(QQ).WithBasis().example()\nsage: A.element_class\n<class 'sage.combinat.free_module.FreeAlgebra_with_category.element_class'>\n```\n\nHowever the work is half baked, since the module is not set\naccordingly: there is no class\n`sage.combinat.free_module.FreeAlgebra`; the module part comes from\n`CombinatorialFreeModuleElement.__module__` (I am running this example\nwithout the ticket). With the `...Element` being moved, the module\npart gets changed to `sage.modules.with_basis.indexed_element`.\n\nTwo options:\n- Not care and just update the doctests\n- Improve the output of the element class by setting the module of the\n  parent as module.\n\nI just implemented the latter to check that it worked. The end result\nis more consistent for the user; here we get:\n\n```\n<class 'sage.categories.examples.algebras_with_basis.FreeAlgebra_with_category.element_class'>\n```\n\nHowever changing `__module__` might possibly break some introspection\nstuff (I checked `A.element_class??`, and that was fine). It will also\nrequire updating other doctests.\n\nWhat do you think?",
    "created_at": "2017-05-19T02:44:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336181",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:48" align="right">comment:48</div>

For the other failure: it stems from the fact that the created element
class's name is set to reflect that it's the element class of a given
parent:

```
sage: A = Algebras(QQ).WithBasis().example()
sage: A.element_class
<class 'sage.combinat.free_module.FreeAlgebra_with_category.element_class'>
```

However the work is half baked, since the module is not set
accordingly: there is no class
`sage.combinat.free_module.FreeAlgebra`; the module part comes from
`CombinatorialFreeModuleElement.__module__` (I am running this example
without the ticket). With the `...Element` being moved, the module
part gets changed to `sage.modules.with_basis.indexed_element`.

Two options:
- Not care and just update the doctests
- Improve the output of the element class by setting the module of the
  parent as module.

I just implemented the latter to check that it worked. The end result
is more consistent for the user; here we get:

```
<class 'sage.categories.examples.algebras_with_basis.FreeAlgebra_with_category.element_class'>
```

However changing `__module__` might possibly break some introspection
stuff (I checked `A.element_class??`, and that was fine). It will also
require updating other doctests.

What do you think?



---

archive/issue_comments_336182.json:
```json
{
    "body": "Changed commit from **[`06a299e`](https://github.com/sagemath/sagetrac-mirror/commit/06a299e1c6d6734ec4930dc4f720dca5a4ead6ad)** to **[`c889c4e`](https://github.com/sagemath/sagetrac-mirror/commit/c889c4e9d791e692bec161f7c5bcc6afea8f4615)**",
    "created_at": "2017-05-19T02:46:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336182",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`06a299e`](https://github.com/sagemath/sagetrac-mirror/commit/06a299e1c6d6734ec4930dc4f720dca5a4ead6ad)** to **[`c889c4e`](https://github.com/sagemath/sagetrac-mirror/commit/c889c4e9d791e692bec161f7c5bcc6afea8f4615)**



---

archive/issue_comments_336183.json:
```json
{
    "body": "<div id=\"comment:49\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c889c4e9d791e692bec161f7c5bcc6afea8f4615\"><code>c889c4e</code></a></td><td><code>22632: Fix the module part in dynamically created element classes, for consistency</code></td></tr></table>\n",
    "created_at": "2017-05-19T02:46:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336183",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:49"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c889c4e9d791e692bec161f7c5bcc6afea8f4615"><code>c889c4e</code></a></td><td><code>22632: Fix the module part in dynamically created element classes, for consistency</code></td></tr></table>




---

archive/issue_comments_336184.json:
```json
{
    "body": "Changed commit from **[`c889c4e`](https://github.com/sagemath/sagetrac-mirror/commit/c889c4e9d791e692bec161f7c5bcc6afea8f4615)** to **[`5a34041`](https://github.com/sagemath/sagetrac-mirror/commit/5a34041b0ab06dfbe1089698d50075c0525e066c)**",
    "created_at": "2017-05-19T02:48:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336184",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`c889c4e`](https://github.com/sagemath/sagetrac-mirror/commit/c889c4e9d791e692bec161f7c5bcc6afea8f4615)** to **[`5a34041`](https://github.com/sagemath/sagetrac-mirror/commit/5a34041b0ab06dfbe1089698d50075c0525e066c)**



---

archive/issue_comments_336185.json:
```json
{
    "body": "<div id=\"comment:50\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/23f28c0f126b839b0d3b3f34dbc21fed24ae5e26\"><code>23f28c0</code></a></td><td><code>Moving _divide_if_possible to Rings.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5a34041b0ab06dfbe1089698d50075c0525e066c\"><code>5a34041</code></a></td><td><code>Merge branch 'public/combinat/cythonize_CFM_element-22632' of git://trac.sagemath.org/sage into public/combinat/cythonize_CFM_element-22632</code></td></tr></table>\n",
    "created_at": "2017-05-19T02:48:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336185",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:50"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/23f28c0f126b839b0d3b3f34dbc21fed24ae5e26"><code>23f28c0</code></a></td><td><code>Moving _divide_if_possible to Rings.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5a34041b0ab06dfbe1089698d50075c0525e066c"><code>5a34041</code></a></td><td><code>Merge branch 'public/combinat/cythonize_CFM_element-22632' of git://trac.sagemath.org/sage into public/combinat/cythonize_CFM_element-22632</code></td></tr></table>




---

archive/issue_comments_336186.json:
```json
{
    "body": "<div id=\"comment:51\" align=\"right\">comment:51</div>\n\nReplying to [@nthiery](#comment:47):\n> I just found out the same :-)\n> Yeah, either demoting it back down, or lifting it up to Rings(). After all, it's a private method. So if it fails because it requires another method which is not implemented, that's ok. At least it will be easier to discover than if it's hidden in some random Python module. It's consistent with FreeModule's requirement of taking a ring as input.\n\nI think lifting it up to the category of `Rings` works for now.",
    "created_at": "2017-05-19T02:52:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336186",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:51" align="right">comment:51</div>

Replying to [@nthiery](#comment:47):
> I just found out the same :-)
> Yeah, either demoting it back down, or lifting it up to Rings(). After all, it's a private method. So if it fails because it requires another method which is not implemented, that's ok. At least it will be easier to discover than if it's hidden in some random Python module. It's consistent with FreeModule's requirement of taking a ring as input.

I think lifting it up to the category of `Rings` works for now.



---

archive/issue_comments_336187.json:
```json
{
    "body": "<div id=\"comment:52\" align=\"right\">comment:52</div>\n\nReplying to [@nthiery](#comment:48):\n> For the other failure: it stems from the fact that the created element\n> class's name is set to reflect that it's the element class of a given\n> ...\n> Two options:\n> \n> - Not care and just update the doctests\n> - Improve the output of the element class by setting the module of the parent as module. \n\n>\n>  What do you think?\n\nThis seems to be a can of worms. :/ Although I would rather have the latter as well since it is a more proper fix. Since you've done it, we might as well keep it.",
    "created_at": "2017-05-19T03:02:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336187",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:52" align="right">comment:52</div>

Replying to [@nthiery](#comment:48):
> For the other failure: it stems from the fact that the created element
> class's name is set to reflect that it's the element class of a given
> ...
> Two options:
> 
> - Not care and just update the doctests
> - Improve the output of the element class by setting the module of the parent as module. 

>
>  What do you think?

This seems to be a can of worms. :/ Although I would rather have the latter as well since it is a more proper fix. Since you've done it, we might as well keep it.



---

archive/issue_comments_336188.json:
```json
{
    "body": "<div id=\"comment:53\" align=\"right\">comment:53</div>\n\nOk; tests running here. Let's keep it only if there are just trivial doctests updates.",
    "created_at": "2017-05-19T03:17:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336188",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:53" align="right">comment:53</div>

Ok; tests running here. Let's keep it only if there are just trivial doctests updates.



---

archive/issue_comments_336189.json:
```json
{
    "body": "Changed commit from **[`5a34041`](https://github.com/sagemath/sagetrac-mirror/commit/5a34041b0ab06dfbe1089698d50075c0525e066c)** to **[`4c63230`](https://github.com/sagemath/sagetrac-mirror/commit/4c63230f181aebf2b24ea6bd14d9868cce3dbef8)**",
    "created_at": "2017-05-19T04:18:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336189",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`5a34041`](https://github.com/sagemath/sagetrac-mirror/commit/5a34041b0ab06dfbe1089698d50075c0525e066c)** to **[`4c63230`](https://github.com/sagemath/sagetrac-mirror/commit/4c63230f181aebf2b24ea6bd14d9868cce3dbef8)**



---

archive/issue_comments_336190.json:
```json
{
    "body": "<div id=\"comment:54\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7cd9c4c0ad17ac6c4abe7a65082742c9ee99546b\"><code>7cd9c4c</code></a></td><td><code>22632: trivial doctest updates (element_class names)</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4c63230f181aebf2b24ea6bd14d9868cce3dbef8\"><code>4c63230</code></a></td><td><code>Merge branch 'public/combinat/cythonize_CFM_element-22632' of trac.sagemath.org:sage into t/22632/public/combinat/cythonize_CFM_element-22632</code></td></tr></table>\n",
    "created_at": "2017-05-19T04:18:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336190",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:54"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7cd9c4c0ad17ac6c4abe7a65082742c9ee99546b"><code>7cd9c4c</code></a></td><td><code>22632: trivial doctest updates (element_class names)</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4c63230f181aebf2b24ea6bd14d9868cce3dbef8"><code>4c63230</code></a></td><td><code>Merge branch 'public/combinat/cythonize_CFM_element-22632' of trac.sagemath.org:sage into t/22632/public/combinat/cythonize_CFM_element-22632</code></td></tr></table>




---

archive/issue_comments_336191.json:
```json
{
    "body": "Changed commit from **[`4c63230`](https://github.com/sagemath/sagetrac-mirror/commit/4c63230f181aebf2b24ea6bd14d9868cce3dbef8)** to **[`b11d26e`](https://github.com/sagemath/sagetrac-mirror/commit/b11d26e6fbd0fa2668b242e13c006fe57510ebb2)**",
    "created_at": "2017-05-19T04:21:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336191",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`4c63230`](https://github.com/sagemath/sagetrac-mirror/commit/4c63230f181aebf2b24ea6bd14d9868cce3dbef8)** to **[`b11d26e`](https://github.com/sagemath/sagetrac-mirror/commit/b11d26e6fbd0fa2668b242e13c006fe57510ebb2)**



---

archive/issue_comments_336192.json:
```json
{
    "body": "<div id=\"comment:55\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b11d26e6fbd0fa2668b242e13c006fe57510ebb2\"><code>b11d26e</code></a></td><td><code>22632: trivial indentation fix</code></td></tr></table>\n",
    "created_at": "2017-05-19T04:21:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336192",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:55"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b11d26e6fbd0fa2668b242e13c006fe57510ebb2"><code>b11d26e</code></a></td><td><code>22632: trivial indentation fix</code></td></tr></table>




---

archive/issue_comments_336193.json:
```json
{
    "body": "<div id=\"comment:56\" align=\"right\">comment:56</div>\n\nAll doctests updates were trivial. Being tired, I may have missed a few. Please rerun the tests, and if all goes well, or there just are some more trivial doctest updates, you can set a positive review on my behalf.\n\nCheers",
    "created_at": "2017-05-19T04:21:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336193",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:56" align="right">comment:56</div>

All doctests updates were trivial. Being tired, I may have missed a few. Please rerun the tests, and if all goes well, or there just are some more trivial doctest updates, you can set a positive review on my behalf.

Cheers



---

archive/issue_comments_336194.json:
```json
{
    "body": "<div id=\"comment:57\" align=\"right\">comment:57</div>\n\nTests pass for me too.",
    "created_at": "2017-05-19T20:26:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336194",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:57" align="right">comment:57</div>

Tests pass for me too.



---

archive/issue_events_316151.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-05-19T20:26:55Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22632#event-316151"
}
```



---

archive/issue_events_316152.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-05-19T20:26:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22632#event-316152"
}
```



---

archive/issue_comments_336195.json:
```json
{
    "body": "<div id=\"comment:58\" align=\"right\">comment:58</div>\n\nThank you for the review.",
    "created_at": "2017-05-19T20:27:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336195",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:58" align="right">comment:58</div>

Thank you for the review.



---

archive/issue_comments_336196.json:
```json
{
    "body": "<div id=\"comment:59\" align=\"right\">comment:59</div>\n\nMy pleasure! I am glad this is done.",
    "created_at": "2017-05-19T20:32:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336196",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:59" align="right">comment:59</div>

My pleasure! I am glad this is done.



---

archive/issue_events_316153.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-05-20T11:40:19Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22632#event-316153"
}
```



---

archive/issue_events_316154.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-05-20T11:40:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22632#event-316154"
}
```



---

archive/issue_comments_336197.json:
```json
{
    "body": "<div id=\"comment:60\" align=\"right\">comment:60</div>\n\nPDF docs dont build",
    "created_at": "2017-05-20T11:40:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336197",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:60" align="right">comment:60</div>

PDF docs dont build



---

archive/issue_comments_336198.json:
```json
{
    "body": "<div id=\"comment:61\" align=\"right\">comment:61</div>\n\nCompiling the doc here ...",
    "created_at": "2017-05-20T12:31:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336198",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:61" align="right">comment:61</div>

Compiling the doc here ...



---

archive/issue_comments_336199.json:
```json
{
    "body": "<div id=\"comment:62\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/20cd0dafdc07517145c3d8a20cbf8baa08e334dc\"><code>20cd0da</code></a></td><td><code>22632: fixed ReST typo preventing the pdf doc compilation</code></td></tr></table>\n",
    "created_at": "2017-05-20T13:08:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336199",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:62"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/20cd0dafdc07517145c3d8a20cbf8baa08e334dc"><code>20cd0da</code></a></td><td><code>22632: fixed ReST typo preventing the pdf doc compilation</code></td></tr></table>




---

archive/issue_comments_336200.json:
```json
{
    "body": "Changed commit from **[`b11d26e`](https://github.com/sagemath/sagetrac-mirror/commit/b11d26e6fbd0fa2668b242e13c006fe57510ebb2)** to **[`20cd0da`](https://github.com/sagemath/sagetrac-mirror/commit/20cd0dafdc07517145c3d8a20cbf8baa08e334dc)**",
    "created_at": "2017-05-20T13:08:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336200",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`b11d26e`](https://github.com/sagemath/sagetrac-mirror/commit/b11d26e6fbd0fa2668b242e13c006fe57510ebb2)** to **[`20cd0da`](https://github.com/sagemath/sagetrac-mirror/commit/20cd0dafdc07517145c3d8a20cbf8baa08e334dc)**



---

archive/issue_comments_336201.json:
```json
{
    "body": "<div id=\"comment:63\" align=\"right\">comment:63</div>\n\nArg, the exact same `_mul_` mistake has appeared a couple days ago in some other ticket.\n\nI'll set back a positive review when the pdf doc compilation will be finished, in case there wouldbe something else.\n\nThanks Volker for reporting ...",
    "created_at": "2017-05-20T13:09:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336201",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:63" align="right">comment:63</div>

Arg, the exact same `_mul_` mistake has appeared a couple days ago in some other ticket.

I'll set back a positive review when the pdf doc compilation will be finished, in case there wouldbe something else.

Thanks Volker for reporting ...



---

archive/issue_comments_336202.json:
```json
{
    "body": "<div id=\"comment:64\" align=\"right\">comment:64</div>\n\nThe only other error I get is:\n\n```\n[docpdf] l.42 \\addto\n[docpdf]            \\extrasmagyar{\\def\\pageautorefname{page}}\n```\n\nAnd I assume this is related to an outdate latex install on my machine:\n\n```\n[docpdf] Package sphinx Warning: \n[docpdf] ******** ERROR !! PLEASE UPDATE titlesec.sty !!********\n[docpdf] ******** THIS VERSION SWALLOWS SECTION NUMBERS.********.\n```\n\nSo, putting this back to positive review. Travis, can you double check things compile on your machine?",
    "created_at": "2017-05-20T13:27:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336202",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:64" align="right">comment:64</div>

The only other error I get is:

```
[docpdf] l.42 \addto
[docpdf]            \extrasmagyar{\def\pageautorefname{page}}
```

And I assume this is related to an outdate latex install on my machine:

```
[docpdf] Package sphinx Warning: 
[docpdf] ******** ERROR !! PLEASE UPDATE titlesec.sty !!********
[docpdf] ******** THIS VERSION SWALLOWS SECTION NUMBERS.********.
```

So, putting this back to positive review. Travis, can you double check things compile on your machine?



---

archive/issue_events_316155.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2017-05-20T13:28:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22632#event-316155"
}
```



---

archive/issue_events_316156.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2017-05-20T13:28:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22632#event-316156"
}
```



---

archive/issue_comments_336203.json:
```json
{
    "body": "<div id=\"comment:66\" align=\"right\">comment:66</div>\n\npdf doc built for me too.",
    "created_at": "2017-05-20T14:52:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336203",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:66" align="right">comment:66</div>

pdf doc built for me too.



---

archive/issue_comments_336204.json:
```json
{
    "body": "Changed branch from **[public/combinat/cythonize_CFM_element-22632](https://github.com/sagemath/sagetrac-mirror/tree/public/combinat/cythonize_CFM_element-22632)** to **[`20cd0da`](https://github.com/sagemath/sagetrac-mirror/commit/20cd0dafdc07517145c3d8a20cbf8baa08e334dc)**",
    "created_at": "2017-05-21T10:08:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336204",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[public/combinat/cythonize_CFM_element-22632](https://github.com/sagemath/sagetrac-mirror/tree/public/combinat/cythonize_CFM_element-22632)** to **[`20cd0da`](https://github.com/sagemath/sagetrac-mirror/commit/20cd0dafdc07517145c3d8a20cbf8baa08e334dc)**



---

archive/issue_events_316157.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-05-21T10:08:32Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22632#event-316157"
}
```



---

archive/issue_events_316158.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "6207566fcc3785722fd72ec8a5f236c39e82fc62",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2017-05-21T10:08:32Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22632#event-316158"
}
```



---

archive/issue_comments_336205.json:
```json
{
    "body": "Changed commit from **[`20cd0da`](https://github.com/sagemath/sagetrac-mirror/commit/20cd0dafdc07517145c3d8a20cbf8baa08e334dc)** to none",
    "created_at": "2017-07-13T08:14:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336205",
    "user": "https://github.com/jdemeyer"
}
```

Changed commit from **[`20cd0da`](https://github.com/sagemath/sagetrac-mirror/commit/20cd0dafdc07517145c3d8a20cbf8baa08e334dc)** to none



---

archive/issue_comments_336206.json:
```json
{
    "body": "<div id=\"comment:68\" align=\"right\">comment:68</div>\n\nQuestion: what exactly is the purpose of the condition involving `is_extension_type()` in `__make_element_class__`?\n\nI am trying to understand how/why `is_extension_type` is used in Sage. In other places in `parent.pyx`, it is to determine whether `__class__` can be assigned to. But in `__make_element_class__`, it's not so clear to me.\n\n(I know it's not directly related to this ticket, but `git blame` brought me here since this ticket made changes to `__make_element_class__`)",
    "created_at": "2017-07-13T08:14:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336206",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:68" align="right">comment:68</div>

Question: what exactly is the purpose of the condition involving `is_extension_type()` in `__make_element_class__`?

I am trying to understand how/why `is_extension_type` is used in Sage. In other places in `parent.pyx`, it is to determine whether `__class__` can be assigned to. But in `__make_element_class__`, it's not so clear to me.

(I know it's not directly related to this ticket, but `git blame` brought me here since this ticket made changes to `__make_element_class__`)



---

archive/issue_comments_336207.json:
```json
{
    "body": "<div id=\"comment:69\" align=\"right\">comment:69</div>\n\nHi Jeroen!\n\nIn ``__make_element_class__``, we need to decide how elements shall inherit from categories: either by subclassing ``P.Element`` (or the relevant class), or by using the ``getattr`` trick. The current rule is to subclass if ``P.Element`` is a Python class, and use ``getattr`` if ``P.Element`` is an extension type. ``is_extension_type`` is used to do the test.",
    "created_at": "2017-07-13T14:56:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336207",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:69" align="right">comment:69</div>

Hi Jeroen!

In ``__make_element_class__``, we need to decide how elements shall inherit from categories: either by subclassing ``P.Element`` (or the relevant class), or by using the ``getattr`` trick. The current rule is to subclass if ``P.Element`` is a Python class, and use ``getattr`` if ``P.Element`` is an extension type. ``is_extension_type`` is used to do the test.



---

archive/issue_comments_336208.json:
```json
{
    "body": "<div id=\"comment:70\" align=\"right\">comment:70</div>\n\nThanks. That answers the factual question (\"how is it done?\") but not really the reason.\n\nThere are many differences between Python and Cython classes and I'm trying to understand which property matters here. I am asking because I tried to *always* use the dynamic class (using `inherit=True` in `__make_element_class__` even for Cython element classes) and there is not much that breaks.\n\nThese are the main differences between Python and Cython classes that I can think of:\n\n1. The fact that `__class__` can be assigned to for Python classes (I don't think this is the reason here)\n\n2. The fact that Python classes have a `__dict__` (this is no longer true: Python classes with `__slots__` don't have a `__dict__` by default and Cython classes do support `__dict__` if you declare it as attribute)\n\n3. The fact that Python classes always support multiple inheritance, which may or may not work for Cython classes\n\n4. Pickling (although Cython 0.26 does support pickling of Cython classes)\n\n5. Various performance differences\n\n6. ...",
    "created_at": "2017-07-14T08:48:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336208",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:70" align="right">comment:70</div>

Thanks. That answers the factual question ("how is it done?") but not really the reason.

There are many differences between Python and Cython classes and I'm trying to understand which property matters here. I am asking because I tried to *always* use the dynamic class (using `inherit=True` in `__make_element_class__` even for Cython element classes) and there is not much that breaks.

These are the main differences between Python and Cython classes that I can think of:

1. The fact that `__class__` can be assigned to for Python classes (I don't think this is the reason here)

2. The fact that Python classes have a `__dict__` (this is no longer true: Python classes with `__slots__` don't have a `__dict__` by default and Cython classes do support `__dict__` if you declare it as attribute)

3. The fact that Python classes always support multiple inheritance, which may or may not work for Cython classes

4. Pickling (although Cython 0.26 does support pickling of Cython classes)

5. Various performance differences

6. ...



---

archive/issue_comments_336209.json:
```json
{
    "body": "<div id=\"comment:71\" align=\"right\">comment:71</div>\n\nReplying to [@jdemeyer](#comment:70):\n> I am asking because I tried to *always* use the dynamic class (using `inherit=True` in `__make_element_class__` even for Cython element classes) and there is not much that breaks.\n\nTo elaborate on this: after making this change\n\n```diff\ndiff --git a/src/sage/structure/parent.pyx b/src/sage/structure/parent.pyx\nindex a387136..ea7c60c 100644\n--- a/src/sage/structure/parent.pyx\n+++ b/src/sage/structure/parent.pyx\n@@ -571,7 +571,7 @@ cdef class Parent(sage.structure.category_object.CategoryObject):\n         # By default, don't fiddle with extension types yet; inheritance from\n         # categories will probably be achieved in a different way\n         if inherit is None:\n-            inherit = not is_extension_type(cls)\n+            inherit = True\n         if inherit:\n             if name is None:\n                 name = \"%s_with_category\"%cls.__name__\n```\nI ran all doctests in `rings`, `categories` and `structure` and the only non-trivial doctest failures were involving enumerated sets (`src/sage/categories/examples/infinite_enumerated_sets.py`, `src/sage/categories/sets_cat.py`, `src/sage/categories/enumerated_sets.py`)",
    "created_at": "2017-07-14T08:59:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336209",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:71" align="right">comment:71</div>

Replying to [@jdemeyer](#comment:70):
> I am asking because I tried to *always* use the dynamic class (using `inherit=True` in `__make_element_class__` even for Cython element classes) and there is not much that breaks.

To elaborate on this: after making this change

```diff
diff --git a/src/sage/structure/parent.pyx b/src/sage/structure/parent.pyx
index a387136..ea7c60c 100644
--- a/src/sage/structure/parent.pyx
+++ b/src/sage/structure/parent.pyx
@@ -571,7 +571,7 @@ cdef class Parent(sage.structure.category_object.CategoryObject):
         # By default, don't fiddle with extension types yet; inheritance from
         # categories will probably be achieved in a different way
         if inherit is None:
-            inherit = not is_extension_type(cls)
+            inherit = True
         if inherit:
             if name is None:
                 name = "%s_with_category"%cls.__name__
```
I ran all doctests in `rings`, `categories` and `structure` and the only non-trivial doctest failures were involving enumerated sets (`src/sage/categories/examples/infinite_enumerated_sets.py`, `src/sage/categories/sets_cat.py`, `src/sage/categories/enumerated_sets.py`)



---

archive/issue_comments_336210.json:
```json
{
    "body": "<div id=\"comment:72\" align=\"right\">comment:72</div>\n\nHi Jeroen,\n\nThanks for running this interesting experiment!\n\nI indeed would have been expecting things not too break too much. Systematically using dynamic classes would certainly simplify Sage's infrastructure. The only potential reason for not doing it is performance (speed and memory footprint). At the time we set this up, there was some consensual claim that systematically using a dynamic class would induce a performance loss for low granularity objects (e.g. finite field elements). Hence the above rule of thumb I implemented for deciding when to do what.\n\nHowever I don't remember anyone doing some serious benchmarking to actually assess the validity of that claim. That would be very welcome! And this hints again at having some speed-regression test infrastructure for Sage.\n\nCheers,\n                   Nicolas\n\nPS: I could imagine code breaking in situations like:\n\n```\ncdef class MyElement:\n    ....\n\ncdef foo(MyElement x):\n    x.bar()\n```\n\nwhere `foo` would be called on an instance of a dynamic subclass of `MyElement`, and `foo` be provided by some category.\n\nApparently we have no instance of that idiom in Sage :-)",
    "created_at": "2017-07-14T11:47:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336210",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:72" align="right">comment:72</div>

Hi Jeroen,

Thanks for running this interesting experiment!

I indeed would have been expecting things not too break too much. Systematically using dynamic classes would certainly simplify Sage's infrastructure. The only potential reason for not doing it is performance (speed and memory footprint). At the time we set this up, there was some consensual claim that systematically using a dynamic class would induce a performance loss for low granularity objects (e.g. finite field elements). Hence the above rule of thumb I implemented for deciding when to do what.

However I don't remember anyone doing some serious benchmarking to actually assess the validity of that claim. That would be very welcome! And this hints again at having some speed-regression test infrastructure for Sage.

Cheers,
                   Nicolas

PS: I could imagine code breaking in situations like:

```
cdef class MyElement:
    ....

cdef foo(MyElement x):
    x.bar()
```

where `foo` would be called on an instance of a dynamic subclass of `MyElement`, and `foo` be provided by some category.

Apparently we have no instance of that idiom in Sage :-)



---

archive/issue_comments_336211.json:
```json
{
    "body": "<div id=\"comment:73\" align=\"right\">comment:73</div>\n\nComments on this actual ticket: contrary to most element classes which are implemented in Cython, it seems that `CombinatorialFreeModule_with_category.element_class` actually does do the inheritance from the category in the \"normal\" way, using `dynamic_class()`, just like Python classes. So this is a good testcase for #23435.",
    "created_at": "2017-07-15T08:06:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336211",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:73" align="right">comment:73</div>

Comments on this actual ticket: contrary to most element classes which are implemented in Cython, it seems that `CombinatorialFreeModule_with_category.element_class` actually does do the inheritance from the category in the "normal" way, using `dynamic_class()`, just like Python classes. So this is a good testcase for #23435.



---

archive/issue_comments_336212.json:
```json
{
    "body": "<div id=\"comment:74\" align=\"right\">comment:74</div>\n\nIn the light of #23435, is it important that `CombinatorialFreeModule_with_category.element_class` has a `__dict__`? In other words, is it important to support the following (example taken from `src/doc/en/thematic_tutorials/tutorial-objects-and-classes.rst`):\n\n```\nSome particular actions modify the data structure of ``el``::\n\n    sage: el.rename(\"bla\")\n    sage: el\n    bla\n\n.. note::\n\n    The class is stored in a particular attribute called ``__class__``,\n    and the normal attributes are stored in a dictionary called ``__dict__``::\n\n        sage: F = CombinatorialFreeModule(QQ, Permutations())\n        sage: el = 3*F([1,3,2])+ F([1,2,3])\n        sage: el.rename(\"foo\")\n        sage: el.blah = 42\n        sage: el.__class__\n        <class 'sage.combinat.free_module.CombinatorialFreeModule_with_category.element_class'>\n        sage: el.__dict__\n        {'__custom_name': 'foo',\n         'blah': 42}\n```",
    "created_at": "2017-07-15T08:10:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336212",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:74" align="right">comment:74</div>

In the light of #23435, is it important that `CombinatorialFreeModule_with_category.element_class` has a `__dict__`? In other words, is it important to support the following (example taken from `src/doc/en/thematic_tutorials/tutorial-objects-and-classes.rst`):

```
Some particular actions modify the data structure of ``el``::

    sage: el.rename("bla")
    sage: el
    bla

.. note::

    The class is stored in a particular attribute called ``__class__``,
    and the normal attributes are stored in a dictionary called ``__dict__``::

        sage: F = CombinatorialFreeModule(QQ, Permutations())
        sage: el = 3*F([1,3,2])+ F([1,2,3])
        sage: el.rename("foo")
        sage: el.blah = 42
        sage: el.__class__
        <class 'sage.combinat.free_module.CombinatorialFreeModule_with_category.element_class'>
        sage: el.__dict__
        {'__custom_name': 'foo',
         'blah': 42}
```



---

archive/issue_comments_336213.json:
```json
{
    "body": "<div id=\"comment:75\" align=\"right\">comment:75</div>\n\nAnother question about this ticket: why are the arithmetic methods of `IndexedFreeModuleElement` implemented as `cdef` instead of `cpdef`?\n\n```\n    cdef _add_(self, other):\n```\nEvery other class (except for `IndexedFreeModuleElement` and `LieAlgebraElement`) implements those as `cpdef _add_`.\n\nThis is confusing because\n\n```\nsage: F = CombinatorialFreeModule(QQ, Permutations())\nsage: el = 3*F([1,3,2])+ F([1,2,3])\nsage: el._add_(el)\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-31-91def7298b70> in <module>()\n----> 1 el._add_(el)\n\nTypeError: 'NotImplementedType' object is not callable\n```\n\nIt also prevents a Python class inheriting from `IndexedFreeModuleElement` to override this `_add_`.",
    "created_at": "2017-07-15T08:56:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336213",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:75" align="right">comment:75</div>

Another question about this ticket: why are the arithmetic methods of `IndexedFreeModuleElement` implemented as `cdef` instead of `cpdef`?

```
    cdef _add_(self, other):
```
Every other class (except for `IndexedFreeModuleElement` and `LieAlgebraElement`) implements those as `cpdef _add_`.

This is confusing because

```
sage: F = CombinatorialFreeModule(QQ, Permutations())
sage: el = 3*F([1,3,2])+ F([1,2,3])
sage: el._add_(el)
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-31-91def7298b70> in <module>()
----> 1 el._add_(el)

TypeError: 'NotImplementedType' object is not callable
```

It also prevents a Python class inheriting from `IndexedFreeModuleElement` to override this `_add_`.



---

archive/issue_comments_336214.json:
```json
{
    "body": "<div id=\"comment:76\" align=\"right\">comment:76</div>\n\nReplying to [@jdemeyer](#comment:75):\n> Another question about this ticket: why are the arithmetic methods of `IndexedFreeModuleElement` implemented as `cdef` instead of `cpdef`?\n> \n> ```\n>     cdef _add_(self, other):\n> ```\n> Every other class (except for `IndexedFreeModuleElement` and `LieAlgebraElement`) implements those as `cpdef _add_`.\n\nThat is not quite true. They are `cdef` in `Element`, and so I followed suit. I see now in the doc for `Element`, that it says it should be `cpdef`. Is it because `Element` is special in that they are essentially acting as pure virtual methods that they aren't `cpdef`?",
    "created_at": "2017-07-15T09:01:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336214",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:76" align="right">comment:76</div>

Replying to [@jdemeyer](#comment:75):
> Another question about this ticket: why are the arithmetic methods of `IndexedFreeModuleElement` implemented as `cdef` instead of `cpdef`?
> 
> ```
>     cdef _add_(self, other):
> ```
> Every other class (except for `IndexedFreeModuleElement` and `LieAlgebraElement`) implements those as `cpdef _add_`.

That is not quite true. They are `cdef` in `Element`, and so I followed suit. I see now in the doc for `Element`, that it says it should be `cpdef`. Is it because `Element` is special in that they are essentially acting as pure virtual methods that they aren't `cpdef`?



---

archive/issue_comments_336215.json:
```json
{
    "body": "<div id=\"comment:77\" align=\"right\">comment:77</div>\n\nFollow-up: #23440",
    "created_at": "2017-07-15T09:23:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336215",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:77" align="right">comment:77</div>

Follow-up: #23440



---

archive/issue_comments_336216.json:
```json
{
    "body": "<div id=\"comment:78\" align=\"right\">comment:78</div>\n\nReplying to [@tscrim](#comment:76):\n> That is not quite true. They are `cdef` in `Element`, and so I followed suit. I see now in the doc for `Element`, that it says it should be `cpdef`. Is it because `Element` is special in that they are essentially acting as pure virtual methods that they aren't `cpdef`?\n\nYes, the `Element` base class is special. The arithmetic methods of `Element` do indeed act as \"pure virtual\" methods. I implemented them that way to allow fast calling in the Cython world while at the same time not existing in the Python world.",
    "created_at": "2017-07-15T09:28:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22632#issuecomment-336216",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:78" align="right">comment:78</div>

Replying to [@tscrim](#comment:76):
> That is not quite true. They are `cdef` in `Element`, and so I followed suit. I see now in the doc for `Element`, that it says it should be `cpdef`. Is it because `Element` is special in that they are essentially acting as pure virtual methods that they aren't `cpdef`?

Yes, the `Element` base class is special. The arithmetic methods of `Element` do indeed act as "pure virtual" methods. I implemented them that way to allow fast calling in the Cython world while at the same time not existing in the Python world.
