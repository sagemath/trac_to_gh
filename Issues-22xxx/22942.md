# Issue 22942: update python3 spkg to version 3.6.1

archive/issues_022705.json:
```json
{
    "body": "needed for #22305\n\nhttps://www.python.org/ftp/python/3.6.1/Python-3.6.1.tgz\n\nrenamed to Python-3.6.1.tar.gz\n\nCC:  @jdemeyer @embray @tscrim\n\nBranch/Commit: 7c393d7d7dc3eb62fb8061b9f4118e54a47228dc\n\nReviewer: Fr\u00e9d\u00e9ric Chapoton\n\nAuthor: John Palmieri\n\nDependencies: #22582\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/22942\n\n",
    "closed_at": "2017-05-16T22:22:00Z",
    "created_at": "2017-05-03T19:55:23Z",
    "labels": [
        "component: python3"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.0",
    "title": "update python3 spkg to version 3.6.1",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22942",
    "user": "https://github.com/fchapoton"
}
```
needed for #22305

https://www.python.org/ftp/python/3.6.1/Python-3.6.1.tgz

renamed to Python-3.6.1.tar.gz

CC:  @jdemeyer @embray @tscrim

Branch/Commit: 7c393d7d7dc3eb62fb8061b9f4118e54a47228dc

Reviewer: Frédéric Chapoton

Author: John Palmieri

Dependencies: #22582

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/22942





---

archive/issue_comments_337494.json:
```json
{
    "body": "<a id='comment:1'></a>Adding #22582 as a dependency because it makes some changes to the python3 spkg-install file.",
    "created_at": "2017-05-03T20:29:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22942#issuecomment-337494",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:1'></a>Adding #22582 as a dependency because it makes some changes to the python3 spkg-install file.



---

archive/issue_comments_337495.json:
```json
{
    "body": "<a id='comment:2'></a>and this is probably going to interfere with Cygwin, sigh..",
    "created_at": "2017-05-04T06:49:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22942#issuecomment-337495",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:2'></a>and this is probably going to interfere with Cygwin, sigh..



---

archive/issue_comments_337496.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,6 @@\n needed for #22305\n+\n+https://www.python.org/ftp/python/3.6.1/Python-3.6.1.tar.xz\n \n Comment: 1\n \n``````\n",
    "created_at": "2017-05-04T08:46:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22942#issuecomment-337496",
    "user": "https://github.com/fchapoton"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,6 @@
 needed for #22305
+
+https://www.python.org/ftp/python/3.6.1/Python-3.6.1.tar.xz
 
 Comment: 1
 
``````




---

archive/issue_comments_337497.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,6 @@\n+needed for #22305\n \n+https://www.python.org/ftp/python/3.6.1/Python-3.6.1.tgz\n \n Comment: 1\n \n``````\n",
    "created_at": "2017-05-04T08:46:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22942#issuecomment-337497",
    "user": "https://github.com/fchapoton"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,6 @@
+needed for #22305
 
+https://www.python.org/ftp/python/3.6.1/Python-3.6.1.tgz
 
 Comment: 1
 
``````




---

archive/issue_comments_337498.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,8 @@\n+needed for #22305\n \n+https://www.python.org/ftp/python/3.6.1/Python-3.6.1.tgz\n+\n+renamed to Python-3.6.1.tar.gz\n \n Comment: 1\n \n``````\n",
    "created_at": "2017-05-04T08:53:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22942#issuecomment-337498",
    "user": "https://github.com/fchapoton"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,8 @@
+needed for #22305
 
+https://www.python.org/ftp/python/3.6.1/Python-3.6.1.tgz
+
+renamed to Python-3.6.1.tar.gz
 
 Comment: 1
 
``````




---

archive/issue_comments_337499.json:
```json
{
    "body": "<a id='comment:6'></a>maybe our patches will need to be updated\n\n---\nNew commits:",
    "created_at": "2017-05-04T08:54:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22942#issuecomment-337499",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:6'></a>maybe our patches will need to be updated

---
New commits:



---

archive/issue_comments_337500.json:
```json
{
    "body": "<a id='comment:7'></a>indeed\n\n```\n[python3-3.6.1] Error applying '../patches/3.5.2-struct_siginfo_si_band.patch'\n```",
    "created_at": "2017-05-04T08:55:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22942#issuecomment-337500",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:7'></a>indeed

```
[python3-3.6.1] Error applying '../patches/3.5.2-struct_siginfo_si_band.patch'
```



---

archive/issue_comments_337501.json:
```json
{
    "body": "<a id='comment:8'></a>An interesting bunch of patches here:\n\nhttps://github.com/cygwinports/python3",
    "created_at": "2017-05-04T09:00:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22942#issuecomment-337501",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:8'></a>An interesting bunch of patches here:

https://github.com/cygwinports/python3



---

archive/issue_comments_337502.json:
```json
{
    "body": "<a id='comment:9'></a>Most of the existing patches being used come from there.  A few come directly from bugs.python.org issues.",
    "created_at": "2017-05-04T16:50:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22942#issuecomment-337502",
    "user": "https://github.com/embray"
}
```

<a id='comment:9'></a>Most of the existing patches being used come from there.  A few come directly from bugs.python.org issues.



---

archive/issue_comments_337503.json:
```json
{
    "body": "<a id='comment:10'></a>I am not able to do the required job: refresh the patches, maybe remove some, or add others.\n\nSo I would appreciate if someone else can take care of this ticket.",
    "created_at": "2017-05-04T18:00:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22942#issuecomment-337503",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:10'></a>I am not able to do the required job: refresh the patches, maybe remove some, or add others.

So I would appreciate if someone else can take care of this ticket.



---

archive/issue_comments_337504.json:
```json
{
    "body": "<a id='comment:11'></a>With #22756, #22582, and the following changes, this builds for me on OS X. I'm not sure about the change to `3.5.2-struct_siginfo_si_band.patch`, but the other change makes sense: our patch (which we took from a Python bug report) is now included in version 3.6.1.\n\n```diff\ndiff --git a/build/pkgs/python3/patches/3.5.2-struct_siginfo_si_band.patch b/build/pkgs/python3/patches/3.5.2-struct_siginfo_si_band.patch\nindex c2ee610..2848c9e 100644\n--- a/build/pkgs/python3/patches/3.5.2-struct_siginfo_si_band.patch\n+++ b/build/pkgs/python3/patches/3.5.2-struct_siginfo_si_band.patch\n@@ -39,15 +39,12 @@ index 2fbe259..8281f95 100755\n  { $as_echo \"$as_me:${as_lineno-$LINENO}: checking for time.h that defines altzone\" >&5\n  $as_echo_n \"checking for time.h that defines altzone... \" >&6; }\n diff --git a/configure.ac b/configure.ac\n-index 8ef1760..6bfee80 100644\n---- a/configure.ac\n-+++ b/configure.ac\n-@@ -3692,7 +3692,9 @@\n- AC_CHECK_MEMBERS([struct stat.st_flags])\n- AC_CHECK_MEMBERS([struct stat.st_gen])\n- AC_CHECK_MEMBERS([struct stat.st_birthtime])\n--AC_STRUCT_ST_BLOCKS\n-+AC_CHECK_MEMBERS([struct stat.st_blocks])\n+--- a/configure.ac     2017-05-04 10:49:21.000000000 -0700\n++++ b/configure.ac     2017-05-04 10:49:50.000000000 -0700\n+@@ -3930,6 +3930,8 @@\n+   #include <sys/types.h>\n+   #include <pwd.h>\n+ ]])\n +# Issue #21085: In Cygwin, siginfo_t does not have si_band field.\n +AC_CHECK_MEMBERS([siginfo_t.si_band], [], [], [[#include <signal.h>]])\n  \ndiff --git a/build/pkgs/python3/patches/pyport-apple-c++.patch b/build/pkgs/python3/patches/pyport-apple-c++.patch\ndeleted file mode 100644\nindex 61aea6e..0000000\n--- a/build/pkgs/python3/patches/pyport-apple-c++.patch\n+++ /dev/null\n@@ -1,23 +0,0 @@\n---- a/Include/pyport.h 2017-04-07 13:26:39.000000000 -0700\n-+++ b/Include/pyport.h 2017-04-07 13:27:54.000000000 -0700\n-@@ -688,6 +688,12 @@\n- #endif\n- \n- #ifdef _PY_PORT_CTYPE_UTF8_ISSUE\n-+#ifndef __cplusplus\n-+   /* The workaround below is unsafe in C++ because\n-+    * the <locale> defines these symbols as real functions,\n-+    * with a slightly different signature.\n-+    * See issue #10910\n-+    */\n- #include <ctype.h>\n- #include <wctype.h>\n- #undef isalnum\n-@@ -705,6 +711,7 @@\n- #undef toupper\n- #define toupper(c) towupper(btowc(c))\n- #endif\n-+#endif\n- \n- \n- /* Declarations for symbol visibility.\n```\nAt some point it would be good to refresh the patches, since some apply with some fuzz.",
    "created_at": "2017-05-04T18:09:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22942#issuecomment-337504",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:11'></a>With #22756, #22582, and the following changes, this builds for me on OS X. I'm not sure about the change to `3.5.2-struct_siginfo_si_band.patch`, but the other change makes sense: our patch (which we took from a Python bug report) is now included in version 3.6.1.

```diff
diff --git a/build/pkgs/python3/patches/3.5.2-struct_siginfo_si_band.patch b/build/pkgs/python3/patches/3.5.2-struct_siginfo_si_band.patch
index c2ee610..2848c9e 100644
--- a/build/pkgs/python3/patches/3.5.2-struct_siginfo_si_band.patch
+++ b/build/pkgs/python3/patches/3.5.2-struct_siginfo_si_band.patch
@@ -39,15 +39,12 @@ index 2fbe259..8281f95 100755
  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for time.h that defines altzone" >&5
  $as_echo_n "checking for time.h that defines altzone... " >&6; }
 diff --git a/configure.ac b/configure.ac
-index 8ef1760..6bfee80 100644
---- a/configure.ac
-+++ b/configure.ac
-@@ -3692,7 +3692,9 @@
- AC_CHECK_MEMBERS([struct stat.st_flags])
- AC_CHECK_MEMBERS([struct stat.st_gen])
- AC_CHECK_MEMBERS([struct stat.st_birthtime])
--AC_STRUCT_ST_BLOCKS
-+AC_CHECK_MEMBERS([struct stat.st_blocks])
+--- a/configure.ac     2017-05-04 10:49:21.000000000 -0700
++++ b/configure.ac     2017-05-04 10:49:50.000000000 -0700
+@@ -3930,6 +3930,8 @@
+   #include <sys/types.h>
+   #include <pwd.h>
+ ]])
 +# Issue #21085: In Cygwin, siginfo_t does not have si_band field.
 +AC_CHECK_MEMBERS([siginfo_t.si_band], [], [], [[#include <signal.h>]])
  
diff --git a/build/pkgs/python3/patches/pyport-apple-c++.patch b/build/pkgs/python3/patches/pyport-apple-c++.patch
deleted file mode 100644
index 61aea6e..0000000
--- a/build/pkgs/python3/patches/pyport-apple-c++.patch
+++ /dev/null
@@ -1,23 +0,0 @@
---- a/Include/pyport.h 2017-04-07 13:26:39.000000000 -0700
-+++ b/Include/pyport.h 2017-04-07 13:27:54.000000000 -0700
-@@ -688,6 +688,12 @@
- #endif
- 
- #ifdef _PY_PORT_CTYPE_UTF8_ISSUE
-+#ifndef __cplusplus
-+   /* The workaround below is unsafe in C++ because
-+    * the <locale> defines these symbols as real functions,
-+    * with a slightly different signature.
-+    * See issue #10910
-+    */
- #include <ctype.h>
- #include <wctype.h>
- #undef isalnum
-@@ -705,6 +711,7 @@
- #undef toupper
- #define toupper(c) towupper(btowc(c))
- #endif
-+#endif
- 
- 
- /* Declarations for symbol visibility.
```
At some point it would be good to refresh the patches, since some apply with some fuzz.



---

archive/issue_comments_337505.json:
```json
{
    "body": "<a id='comment:12'></a>Looks fine to me !^",
    "created_at": "2017-05-05T08:53:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22942#issuecomment-337505",
    "user": "https://github.com/embray"
}
```

<a id='comment:12'></a>Looks fine to me !^



---

archive/issue_comments_337506.json:
```json
{
    "body": "<a id='comment:13'></a>Okay, I will prepare a proper branch.",
    "created_at": "2017-05-05T14:43:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22942#issuecomment-337506",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:13'></a>Okay, I will prepare a proper branch.



---

archive/issue_comments_337507.json:
```json
{
    "body": "<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-05-05T15:56:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22942#issuecomment-337507",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_337508.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-05-05T15:58:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22942#issuecomment-337508",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_337509.json:
```json
{
    "body": "<a id='comment:16'></a>It fails on enum34 with SAGE_PYTHON3=yes, because \n\n```\nThe basic issue is that enum34 is not meant to be installed in Python versions 3.4+. \n```\nDamn!!!\n\nREF: https://bitbucket.org/stoneleaf/enum34/issues/19/enum34-isnt-compatible-with-python-36",
    "created_at": "2017-05-10T10:16:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22942#issuecomment-337509",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:16'></a>It fails on enum34 with SAGE_PYTHON3=yes, because 

```
The basic issue is that enum34 is not meant to be installed in Python versions 3.4+. 
```
Damn!!!

REF: https://bitbucket.org/stoneleaf/enum34/issues/19/enum34-isnt-compatible-with-python-36



---

archive/issue_comments_337510.json:
```json
{
    "body": "<a id='comment:17'></a>It looks like `enum34` is only used by `traitlets`. Does `traitlets` need it with Python 3.6, or does Python 3.6 provide the necessary functionality on its own?",
    "created_at": "2017-05-10T17:34:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22942#issuecomment-337510",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:17'></a>It looks like `enum34` is only used by `traitlets`. Does `traitlets` need it with Python 3.6, or does Python 3.6 provide the necessary functionality on its own?



---

archive/issue_comments_337511.json:
```json
{
    "body": "<a id='comment:18'></a>First, enum34 built for me with SAGE_PYTHON3=yes. Second, anyway, we could make this change to its spkg-install file:\n\n```diff\ndiff --git a/build/pkgs/enum34/spkg-install b/build/pkgs/enum34/spkg-install\nindex c1a2289ade..0f465dfd7e 100755\n--- a/build/pkgs/enum34/spkg-install\n+++ b/build/pkgs/enum34/spkg-install\n@@ -1,3 +1,7 @@\n #!/usr/bin/env bash\n \n-cd src && $PIP_INSTALL .\n+if [ \"$SAGE_PYTHON3\" = \"yes\" ]; then\n+    echo \"Not installing enum34: not necessary with Python 3.5 or later.\"\n+else\n+    cd src && $PIP_INSTALL .\n+fi\n```\nI tried this and traitlets built without it: I think traitlets only really needs it with Python 3.4 or earlier. I'll try a complete build with this patch to see how things go.",
    "created_at": "2017-05-10T19:22:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22942#issuecomment-337511",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:18'></a>First, enum34 built for me with SAGE_PYTHON3=yes. Second, anyway, we could make this change to its spkg-install file:

```diff
diff --git a/build/pkgs/enum34/spkg-install b/build/pkgs/enum34/spkg-install
index c1a2289ade..0f465dfd7e 100755
--- a/build/pkgs/enum34/spkg-install
+++ b/build/pkgs/enum34/spkg-install
@@ -1,3 +1,7 @@
 #!/usr/bin/env bash
 
-cd src && $PIP_INSTALL .
+if [ "$SAGE_PYTHON3" = "yes" ]; then
+    echo "Not installing enum34: not necessary with Python 3.5 or later."
+else
+    cd src && $PIP_INSTALL .
+fi
```
I tried this and traitlets built without it: I think traitlets only really needs it with Python 3.4 or earlier. I'll try a complete build with this patch to see how things go.



---

archive/issue_comments_337512.json:
```json
{
    "body": "<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-05-10T21:27:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22942#issuecomment-337512",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_337513.json:
```json
{
    "body": "<a id='comment:20'></a>This worked for me, so I've added it to the branch.",
    "created_at": "2017-05-10T21:28:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22942#issuecomment-337513",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:20'></a>This worked for me, so I've added it to the branch.



---

archive/issue_comments_337514.json:
```json
{
    "body": "<a id='comment:21'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-05-10T21:28:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22942#issuecomment-337514",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:21'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_337515.json:
```json
{
    "body": "<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-05-10T21:29:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22942#issuecomment-337515",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_337516.json:
```json
{
    "body": "<a id='comment:23'></a>Alternatively, we could use https://github.com/jstasiak/enum-compat. But since we have complete control over our Python versions, I don't think we need to do that.",
    "created_at": "2017-05-10T21:33:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22942#issuecomment-337516",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:23'></a>Alternatively, we could use https://github.com/jstasiak/enum-compat. But since we have complete control over our Python versions, I don't think we need to do that.



---

archive/issue_comments_337517.json:
```json
{
    "body": "<a id='comment:24'></a>The latest branch works for me with SAGE_PYTHON3=yes.",
    "created_at": "2017-05-11T07:37:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22942#issuecomment-337517",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:24'></a>The latest branch works for me with SAGE_PYTHON3=yes.



---

archive/issue_comments_337518.json:
```json
{
    "body": "<a id='comment:25'></a>and also works with python2",
    "created_at": "2017-05-11T15:10:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22942#issuecomment-337518",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:25'></a>and also works with python2



---

archive/issue_comments_337519.json:
```json
{
    "body": "<a id='comment:26'></a>I am therefore tempted to give a positive review.\n\n`@`embray and others, do you have any objection, related to Cygwin or not ?",
    "created_at": "2017-05-11T20:14:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22942#issuecomment-337519",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:26'></a>I am therefore tempted to give a positive review.

`@`embray and others, do you have any objection, related to Cygwin or not ?



---

archive/issue_comments_337520.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-05-13T09:02:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22942#issuecomment-337520",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_337521.json:
```json
{
    "body": "<a id='comment:27'></a>I am setting to positive. If somebody objects, it's time to speak.",
    "created_at": "2017-05-13T09:02:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22942#issuecomment-337521",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:27'></a>I am setting to positive. If somebody objects, it's time to speak.



---

archive/issue_comments_337522.json:
```json
{
    "body": "<a id='comment:28'></a>The new python version improved syntax checking it seems:\n\n```\n$ sage -t --long src/sage/tests/py3_syntax.py\nRunning doctests with ID 2017-05-14-10-13-07-3c005bd2.\nGit branch: develop\nUsing --optional=mpir,python2,sage\nDoctesting 1 file.\nsage -t --long --warn-long 72.0 src/sage/tests/py3_syntax.py\n**********************************************************************\nFile \"src/sage/tests/py3_syntax.py\", line 17, in sage.tests.py3_syntax\nFailed example:\n    py3_syntax.run_tests('.py')   # long time\nExpected nothing\nGot:\n    Invalid Python 3 syntax found:\n      File \"src/sage/calculus/calculus.py\", line 2205\n        global _syms\n        ^\n    SyntaxError: name '_syms' is used prior to global declaration\n    <BLANKLINE>\n    <BLANKLINE>\n**********************************************************************\n1 item had failures:\n   1 of   4 in sage.tests.py3_syntax\n    [29 tests, 1 failure, 18.18 s]\n----------------------------------------------------------------------\nsage -t --long --warn-long 72.0 src/sage/tests/py3_syntax.py  # 1 doctest failed\n----------------------------------------------------------------------\nTotal time for all tests: 18.4 seconds\n    cpu time: 1.4 seconds\n    cumulative wall time: 18.2 seconds\n```",
    "created_at": "2017-05-14T08:18:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22942#issuecomment-337522",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:28'></a>The new python version improved syntax checking it seems:

```
$ sage -t --long src/sage/tests/py3_syntax.py
Running doctests with ID 2017-05-14-10-13-07-3c005bd2.
Git branch: develop
Using --optional=mpir,python2,sage
Doctesting 1 file.
sage -t --long --warn-long 72.0 src/sage/tests/py3_syntax.py
**********************************************************************
File "src/sage/tests/py3_syntax.py", line 17, in sage.tests.py3_syntax
Failed example:
    py3_syntax.run_tests('.py')   # long time
Expected nothing
Got:
    Invalid Python 3 syntax found:
      File "src/sage/calculus/calculus.py", line 2205
        global _syms
        ^
    SyntaxError: name '_syms' is used prior to global declaration
    <BLANKLINE>
    <BLANKLINE>
**********************************************************************
1 item had failures:
   1 of   4 in sage.tests.py3_syntax
    [29 tests, 1 failure, 18.18 s]
----------------------------------------------------------------------
sage -t --long --warn-long 72.0 src/sage/tests/py3_syntax.py  # 1 doctest failed
----------------------------------------------------------------------
Total time for all tests: 18.4 seconds
    cpu time: 1.4 seconds
    cumulative wall time: 18.2 seconds
```



---

archive/issue_comments_337523.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-05-14T08:18:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22942#issuecomment-337523",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_337524.json:
```json
{
    "body": "<a id='comment:29'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-05-14T11:33:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22942#issuecomment-337524",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:29'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_337525.json:
```json
{
    "body": "<a id='comment:30'></a>Indeed. Fixed.\n\nVolker, can I set to positive in order to try again ?",
    "created_at": "2017-05-14T11:34:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22942#issuecomment-337525",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:30'></a>Indeed. Fixed.

Volker, can I set to positive in order to try again ?



---

archive/issue_comments_337526.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-05-14T11:48:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22942#issuecomment-337526",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_337527.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-05-14T12:13:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22942#issuecomment-337527",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_337528.json:
```json
{
    "body": "<a id='comment:33'></a>I seem to get doctest failures with this change. I think it would be better to move the definition of `_syms` earlier in the file. I'll try both ways more methodically, though.\n\n```diff\ndiff --git a/src/sage/calculus/calculus.py b/src/sage/calculus/calculus.py\nindex 38a2ef7151..33204a5dee 100644\n--- a/src/sage/calculus/calculus.py\n+++ b/src/sage/calculus/calculus.py\n@@ -1991,8 +1991,22 @@ _inverse_laplace = function_factory('ilt',\n \n ######################################i################\n \n+# Parser for symbolic ring elements\n \n+# We keep two dictionaries syms_cur and syms_default to keep the current symbol\n+# table and the state of the table at startup respectively. These are used by\n+# the restore() function (see sage.misc.reset).\n+#\n+# The dictionary _syms is used as a lookup table for the system function\n+# registry by _find_func() below. It gets updated by\n+# symbolic_expression_from_string() before calling the parser.\n+_syms = syms_cur = symbol_table.get('functions', {})\n+syms_default = dict(syms_cur)\n \n+# This dictionary is used to pass a lookup table other than the system registry\n+# to the parser. A global variable is necessary since the parser calls the\n+# _find_var() and _find_func() functions below without extra arguments.\n+_augmented_syms = {}\n \n #######################################################\n \n@@ -2254,25 +2268,6 @@ def maxima_options(**kwds):\n     \"\"\"\n     return ','.join(['%s=%s'%(key,mapped_opts(val)) for key, val in six.iteritems(kwds)])\n \n-\n-# Parser for symbolic ring elements\n-\n-# We keep two dictionaries syms_cur and syms_default to keep the current symbol\n-# table and the state of the table at startup respectively. These are used by\n-# the restore() function (see sage.misc.reset).\n-#\n-# The dictionary _syms is used as a lookup table for the system function\n-# registry by _find_func() below. It gets updated by\n-# symbolic_expression_from_string() before calling the parser.\n-_syms = syms_cur = symbol_table.get('functions', {})\n-syms_default = dict(syms_cur)\n-\n-# This dictionary is used to pass a lookup table other than the system registry\n-# to the parser. A global variable is necessary since the parser calls the\n-# _find_var() and _find_func() functions below without extra arguments.\n-_augmented_syms = {}\n-\n-\n def _find_var(name):\n     \"\"\"\n     Function to pass to Parser for constructing\n```",
    "created_at": "2017-05-14T15:11:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22942#issuecomment-337528",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:33'></a>I seem to get doctest failures with this change. I think it would be better to move the definition of `_syms` earlier in the file. I'll try both ways more methodically, though.

```diff
diff --git a/src/sage/calculus/calculus.py b/src/sage/calculus/calculus.py
index 38a2ef7151..33204a5dee 100644
--- a/src/sage/calculus/calculus.py
+++ b/src/sage/calculus/calculus.py
@@ -1991,8 +1991,22 @@ _inverse_laplace = function_factory('ilt',
 
 ######################################i################
 
+# Parser for symbolic ring elements
 
+# We keep two dictionaries syms_cur and syms_default to keep the current symbol
+# table and the state of the table at startup respectively. These are used by
+# the restore() function (see sage.misc.reset).
+#
+# The dictionary _syms is used as a lookup table for the system function
+# registry by _find_func() below. It gets updated by
+# symbolic_expression_from_string() before calling the parser.
+_syms = syms_cur = symbol_table.get('functions', {})
+syms_default = dict(syms_cur)
 
+# This dictionary is used to pass a lookup table other than the system registry
+# to the parser. A global variable is necessary since the parser calls the
+# _find_var() and _find_func() functions below without extra arguments.
+_augmented_syms = {}
 
 #######################################################
 
@@ -2254,25 +2268,6 @@ def maxima_options(**kwds):
     """
     return ','.join(['%s=%s'%(key,mapped_opts(val)) for key, val in six.iteritems(kwds)])
 
-
-# Parser for symbolic ring elements
-
-# We keep two dictionaries syms_cur and syms_default to keep the current symbol
-# table and the state of the table at startup respectively. These are used by
-# the restore() function (see sage.misc.reset).
-#
-# The dictionary _syms is used as a lookup table for the system function
-# registry by _find_func() below. It gets updated by
-# symbolic_expression_from_string() before calling the parser.
-_syms = syms_cur = symbol_table.get('functions', {})
-syms_default = dict(syms_cur)
-
-# This dictionary is used to pass a lookup table other than the system registry
-# to the parser. A global variable is necessary since the parser calls the
-# _find_var() and _find_func() functions below without extra arguments.
-_augmented_syms = {}
-
-
 def _find_var(name):
     """
     Function to pass to Parser for constructing
```



---

archive/issue_comments_337529.json:
```json
{
    "body": "<a id='comment:34'></a>No, never mind, everything is fine.",
    "created_at": "2017-05-14T16:20:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22942#issuecomment-337529",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:34'></a>No, never mind, everything is fine.



---

archive/issue_comments_337530.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-05-16T22:22:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22942#issuecomment-337530",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_059492.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-05-16T22:22:00Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/22942",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22942#event-59492"
}
```
