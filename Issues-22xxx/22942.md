# Issue 22942: update python3 spkg to version 3.6.1

archive/issues_022705.json:
```json
{
    "assignees": [],
    "body": "needed for #22305\n\nhttps://www.python.org/ftp/python/3.6.1/Python-3.6.1.tgz\n\nrenamed to Python-3.6.1.tar.gz\n\nDepends on #22582\n\nCC:  @jdemeyer @embray @tscrim\n\nBranch/Commit: **[`7c393d7`](https://github.com/sagemath/sagetrac-mirror/commit/7c393d7d7dc3eb62fb8061b9f4118e54a47228dc)**\n\nReviewer: **Fr\u00e9d\u00e9ric Chapoton**\n\nAuthor: **John Palmieri**\n\nComponent: **python3**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/22942_\n\n",
    "closed_at": "2017-05-16T22:22:00Z",
    "created_at": "2017-05-03T19:55:23Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20python3",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.0",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "update python3 spkg to version 3.6.1",
    "type": "issue",
    "updated_at": "2017-05-16T22:22:00Z",
    "url": "https://github.com/sagemath/sage/issues/22942",
    "user": "https://github.com/fchapoton"
}
```
needed for #22305

https://www.python.org/ftp/python/3.6.1/Python-3.6.1.tgz

renamed to Python-3.6.1.tar.gz

Depends on #22582

CC:  @jdemeyer @embray @tscrim

Branch/Commit: **[`7c393d7`](https://github.com/sagemath/sagetrac-mirror/commit/7c393d7d7dc3eb62fb8061b9f4118e54a47228dc)**

Reviewer: **Frédéric Chapoton**

Author: **John Palmieri**

Component: **python3**

_Issue created by migration from https://trac.sagemath.org/ticket/22942_





---

archive/issue_events_321466.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-05-03T19:55:23Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/22942",
    "milestone_number": null,
    "milestone_title": "sage-8.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22942#event-321466"
}
```



---

archive/issue_events_321467.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-05-03T19:55:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22942",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20python3",
    "label_color": "000080",
    "label_name": "c: python3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22942#event-321467"
}
```



---

archive/issue_events_321468.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-05-03T19:55:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22942",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22942#event-321468"
}
```



---

archive/issue_events_321469.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-05-03T19:55:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22942",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22942#event-321469"
}
```



---

archive/issue_comments_342562.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nAdding #22582 as a dependency because it makes some changes to the python3 spkg-install file.",
    "created_at": "2017-05-03T20:29:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22942#issuecomment-342562",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:1" align="right">comment:1</div>

Adding #22582 as a dependency because it makes some changes to the python3 spkg-install file.



---

archive/issue_comments_342563.json:
```json
{
    "body": "Dependencies: **#22582**",
    "created_at": "2017-05-03T20:29:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22942#issuecomment-342563",
    "user": "https://github.com/jhpalmieri"
}
```

Dependencies: **#22582**



---

archive/issue_comments_342564.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nand this is probably going to interfere with Cygwin, sigh..",
    "created_at": "2017-05-04T06:49:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22942#issuecomment-342564",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:2" align="right">comment:2</div>

and this is probably going to interfere with Cygwin, sigh..



---

archive/issue_comments_342565.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,3 @@\n needed for #22305\n+\n+https://www.python.org/ftp/python/3.6.1/Python-3.6.1.tar.xz\n``````\n",
    "created_at": "2017-05-04T08:46:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22942#issuecomment-342565",
    "user": "https://github.com/fchapoton"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,3 @@
 needed for #22305
+
+https://www.python.org/ftp/python/3.6.1/Python-3.6.1.tar.xz
``````




---

archive/issue_events_321470.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-05-04T08:46:06Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/22942",
    "title_is": "update python3 spkg to version 3.6.1",
    "title_was": "update python3 to version at least 3.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22942#event-321470"
}
```



---

archive/issue_comments_342566.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n needed for #22305\n \n-https://www.python.org/ftp/python/3.6.1/Python-3.6.1.tar.xz\n+https://www.python.org/ftp/python/3.6.1/Python-3.6.1.tgz\n``````\n",
    "created_at": "2017-05-04T08:46:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22942#issuecomment-342566",
    "user": "https://github.com/fchapoton"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
 needed for #22305
 
-https://www.python.org/ftp/python/3.6.1/Python-3.6.1.tar.xz
+https://www.python.org/ftp/python/3.6.1/Python-3.6.1.tgz
``````




---

archive/issue_comments_342567.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,5 @@\n needed for #22305\n \n https://www.python.org/ftp/python/3.6.1/Python-3.6.1.tgz\n+\n+renamed to Python-3.6.1.tar.gz\n``````\n",
    "created_at": "2017-05-04T08:53:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22942#issuecomment-342567",
    "user": "https://github.com/fchapoton"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,5 @@
 needed for #22305
 
 https://www.python.org/ftp/python/3.6.1/Python-3.6.1.tgz
+
+renamed to Python-3.6.1.tar.gz
``````




---

archive/issue_comments_342568.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nmaybe our patches will need to be updated\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/644e94497a0c38c6e79068511bfd9471fb31d61f\"><code>644e944</code></a></td><td><code>python3 update to 3.6.1</code></td></tr></table>\n",
    "created_at": "2017-05-04T08:54:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22942#issuecomment-342568",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:6" align="right">comment:6</div>

maybe our patches will need to be updated

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/644e94497a0c38c6e79068511bfd9471fb31d61f"><code>644e944</code></a></td><td><code>python3 update to 3.6.1</code></td></tr></table>




---

archive/issue_comments_342569.json:
```json
{
    "body": "Commit: **[`644e944`](https://github.com/sagemath/sagetrac-mirror/commit/644e94497a0c38c6e79068511bfd9471fb31d61f)**",
    "created_at": "2017-05-04T08:54:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22942#issuecomment-342569",
    "user": "https://github.com/fchapoton"
}
```

Commit: **[`644e944`](https://github.com/sagemath/sagetrac-mirror/commit/644e94497a0c38c6e79068511bfd9471fb31d61f)**



---

archive/issue_comments_342570.json:
```json
{
    "body": "Branch: **[public/python3.6.1](https://github.com/sagemath/sagetrac-mirror/tree/public/python3.6.1)**",
    "created_at": "2017-05-04T08:54:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22942#issuecomment-342570",
    "user": "https://github.com/fchapoton"
}
```

Branch: **[public/python3.6.1](https://github.com/sagemath/sagetrac-mirror/tree/public/python3.6.1)**



---

archive/issue_comments_342571.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nindeed\n\n```\n[python3-3.6.1] Error applying '../patches/3.5.2-struct_siginfo_si_band.patch'\n```",
    "created_at": "2017-05-04T08:55:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22942#issuecomment-342571",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:7" align="right">comment:7</div>

indeed

```
[python3-3.6.1] Error applying '../patches/3.5.2-struct_siginfo_si_band.patch'
```



---

archive/issue_comments_342572.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nAn interesting bunch of patches here:\n\nhttps://github.com/cygwinports/python3",
    "created_at": "2017-05-04T09:00:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22942#issuecomment-342572",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:8" align="right">comment:8</div>

An interesting bunch of patches here:

https://github.com/cygwinports/python3



---

archive/issue_comments_342573.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nMost of the existing patches being used come from there.  A few come directly from bugs.python.org issues.",
    "created_at": "2017-05-04T16:50:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22942#issuecomment-342573",
    "user": "https://github.com/embray"
}
```

<div id="comment:9" align="right">comment:9</div>

Most of the existing patches being used come from there.  A few come directly from bugs.python.org issues.



---

archive/issue_comments_342574.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nI am not able to do the required job: refresh the patches, maybe remove some, or add others.\n\nSo I would appreciate if someone else can take care of this ticket.",
    "created_at": "2017-05-04T18:00:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22942#issuecomment-342574",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:10" align="right">comment:10</div>

I am not able to do the required job: refresh the patches, maybe remove some, or add others.

So I would appreciate if someone else can take care of this ticket.



---

archive/issue_comments_342575.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nWith #22756, #22582, and the following changes, this builds for me on OS X. I'm not sure about the change to `3.5.2-struct_siginfo_si_band.patch`, but the other change makes sense: our patch (which we took from a Python bug report) is now included in version 3.6.1.\n\n```diff\ndiff --git a/build/pkgs/python3/patches/3.5.2-struct_siginfo_si_band.patch b/build/pkgs/python3/patches/3.5.2-struct_siginfo_si_band.patch\nindex c2ee610..2848c9e 100644\n--- a/build/pkgs/python3/patches/3.5.2-struct_siginfo_si_band.patch\n+++ b/build/pkgs/python3/patches/3.5.2-struct_siginfo_si_band.patch\n@@ -39,15 +39,12 @@ index 2fbe259..8281f95 100755\n  { $as_echo \"$as_me:${as_lineno-$LINENO}: checking for time.h that defines altzone\" >&5\n  $as_echo_n \"checking for time.h that defines altzone... \" >&6; }\n diff --git a/configure.ac b/configure.ac\n-index 8ef1760..6bfee80 100644\n---- a/configure.ac\n-+++ b/configure.ac\n-@@ -3692,7 +3692,9 @@\n- AC_CHECK_MEMBERS([struct stat.st_flags])\n- AC_CHECK_MEMBERS([struct stat.st_gen])\n- AC_CHECK_MEMBERS([struct stat.st_birthtime])\n--AC_STRUCT_ST_BLOCKS\n-+AC_CHECK_MEMBERS([struct stat.st_blocks])\n+--- a/configure.ac     2017-05-04 10:49:21.000000000 -0700\n++++ b/configure.ac     2017-05-04 10:49:50.000000000 -0700\n+@@ -3930,6 +3930,8 @@\n+   #include <sys/types.h>\n+   #include <pwd.h>\n+ ]])\n +# Issue #21085: In Cygwin, siginfo_t does not have si_band field.\n +AC_CHECK_MEMBERS([siginfo_t.si_band], [], [], [[#include <signal.h>]])\n  \ndiff --git a/build/pkgs/python3/patches/pyport-apple-c++.patch b/build/pkgs/python3/patches/pyport-apple-c++.patch\ndeleted file mode 100644\nindex 61aea6e..0000000\n--- a/build/pkgs/python3/patches/pyport-apple-c++.patch\n+++ /dev/null\n@@ -1,23 +0,0 @@\n---- a/Include/pyport.h 2017-04-07 13:26:39.000000000 -0700\n-+++ b/Include/pyport.h 2017-04-07 13:27:54.000000000 -0700\n-@@ -688,6 +688,12 @@\n- #endif\n- \n- #ifdef _PY_PORT_CTYPE_UTF8_ISSUE\n-+#ifndef __cplusplus\n-+   /* The workaround below is unsafe in C++ because\n-+    * the <locale> defines these symbols as real functions,\n-+    * with a slightly different signature.\n-+    * See issue #10910\n-+    */\n- #include <ctype.h>\n- #include <wctype.h>\n- #undef isalnum\n-@@ -705,6 +711,7 @@\n- #undef toupper\n- #define toupper(c) towupper(btowc(c))\n- #endif\n-+#endif\n- \n- \n- /* Declarations for symbol visibility.\n```\nAt some point it would be good to refresh the patches, since some apply with some fuzz.",
    "created_at": "2017-05-04T18:09:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22942#issuecomment-342575",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:11" align="right">comment:11</div>

With #22756, #22582, and the following changes, this builds for me on OS X. I'm not sure about the change to `3.5.2-struct_siginfo_si_band.patch`, but the other change makes sense: our patch (which we took from a Python bug report) is now included in version 3.6.1.

```diff
diff --git a/build/pkgs/python3/patches/3.5.2-struct_siginfo_si_band.patch b/build/pkgs/python3/patches/3.5.2-struct_siginfo_si_band.patch
index c2ee610..2848c9e 100644
--- a/build/pkgs/python3/patches/3.5.2-struct_siginfo_si_band.patch
+++ b/build/pkgs/python3/patches/3.5.2-struct_siginfo_si_band.patch
@@ -39,15 +39,12 @@ index 2fbe259..8281f95 100755
  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for time.h that defines altzone" >&5
  $as_echo_n "checking for time.h that defines altzone... " >&6; }
 diff --git a/configure.ac b/configure.ac
-index 8ef1760..6bfee80 100644
---- a/configure.ac
-+++ b/configure.ac
-@@ -3692,7 +3692,9 @@
- AC_CHECK_MEMBERS([struct stat.st_flags])
- AC_CHECK_MEMBERS([struct stat.st_gen])
- AC_CHECK_MEMBERS([struct stat.st_birthtime])
--AC_STRUCT_ST_BLOCKS
-+AC_CHECK_MEMBERS([struct stat.st_blocks])
+--- a/configure.ac     2017-05-04 10:49:21.000000000 -0700
++++ b/configure.ac     2017-05-04 10:49:50.000000000 -0700
+@@ -3930,6 +3930,8 @@
+   #include <sys/types.h>
+   #include <pwd.h>
+ ]])
 +# Issue #21085: In Cygwin, siginfo_t does not have si_band field.
 +AC_CHECK_MEMBERS([siginfo_t.si_band], [], [], [[#include <signal.h>]])
  
diff --git a/build/pkgs/python3/patches/pyport-apple-c++.patch b/build/pkgs/python3/patches/pyport-apple-c++.patch
deleted file mode 100644
index 61aea6e..0000000
--- a/build/pkgs/python3/patches/pyport-apple-c++.patch
+++ /dev/null
@@ -1,23 +0,0 @@
---- a/Include/pyport.h 2017-04-07 13:26:39.000000000 -0700
-+++ b/Include/pyport.h 2017-04-07 13:27:54.000000000 -0700
-@@ -688,6 +688,12 @@
- #endif
- 
- #ifdef _PY_PORT_CTYPE_UTF8_ISSUE
-+#ifndef __cplusplus
-+   /* The workaround below is unsafe in C++ because
-+    * the <locale> defines these symbols as real functions,
-+    * with a slightly different signature.
-+    * See issue #10910
-+    */
- #include <ctype.h>
- #include <wctype.h>
- #undef isalnum
-@@ -705,6 +711,7 @@
- #undef toupper
- #define toupper(c) towupper(btowc(c))
- #endif
-+#endif
- 
- 
- /* Declarations for symbol visibility.
```
At some point it would be good to refresh the patches, since some apply with some fuzz.



---

archive/issue_comments_342576.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nLooks fine to me !^",
    "created_at": "2017-05-05T08:53:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22942#issuecomment-342576",
    "user": "https://github.com/embray"
}
```

<div id="comment:12" align="right">comment:12</div>

Looks fine to me !^



---

archive/issue_comments_342577.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nOkay, I will prepare a proper branch.",
    "created_at": "2017-05-05T14:43:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22942#issuecomment-342577",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:13" align="right">comment:13</div>

Okay, I will prepare a proper branch.



---

archive/issue_comments_342578.json:
```json
{
    "body": "Changed commit from **[`644e944`](https://github.com/sagemath/sagetrac-mirror/commit/644e94497a0c38c6e79068511bfd9471fb31d61f)** to **[`3821151`](https://github.com/sagemath/sagetrac-mirror/commit/3821151a0f02808ac9a6edd28544cac0a27c241f)**",
    "created_at": "2017-05-05T15:56:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22942#issuecomment-342578",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`644e944`](https://github.com/sagemath/sagetrac-mirror/commit/644e94497a0c38c6e79068511bfd9471fb31d61f)** to **[`3821151`](https://github.com/sagemath/sagetrac-mirror/commit/3821151a0f02808ac9a6edd28544cac0a27c241f)**



---

archive/issue_comments_342579.json:
```json
{
    "body": "<div id=\"comment:14\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f54941ae85923d7c55faff136e3885f3a68cb333\"><code>f54941a</code></a></td><td><code>Merge branch 'develop' into t/22942/public/python3.6.1</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3821151a0f02808ac9a6edd28544cac0a27c241f\"><code>3821151</code></a></td><td><code>trac 22942: update python3 patches</code></td></tr></table>\n",
    "created_at": "2017-05-05T15:56:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22942#issuecomment-342579",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:14"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f54941ae85923d7c55faff136e3885f3a68cb333"><code>f54941a</code></a></td><td><code>Merge branch 'develop' into t/22942/public/python3.6.1</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3821151a0f02808ac9a6edd28544cac0a27c241f"><code>3821151</code></a></td><td><code>trac 22942: update python3 patches</code></td></tr></table>




---

archive/issue_events_321471.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2017-05-05T15:58:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22942",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22942#event-321471"
}
```



---

archive/issue_comments_342580.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nIt fails on enum34 with SAGE_PYTHON3=yes, because \n\n```\nThe basic issue is that enum34 is not meant to be installed in Python versions 3.4+. \n```\nDamn!!!\n\nREF: https://bitbucket.org/stoneleaf/enum34/issues/19/enum34-isnt-compatible-with-python-36",
    "created_at": "2017-05-10T10:16:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22942#issuecomment-342580",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:16" align="right">comment:16</div>

It fails on enum34 with SAGE_PYTHON3=yes, because 

```
The basic issue is that enum34 is not meant to be installed in Python versions 3.4+. 
```
Damn!!!

REF: https://bitbucket.org/stoneleaf/enum34/issues/19/enum34-isnt-compatible-with-python-36



---

archive/issue_comments_342581.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nIt looks like `enum34` is only used by `traitlets`. Does `traitlets` need it with Python 3.6, or does Python 3.6 provide the necessary functionality on its own?",
    "created_at": "2017-05-10T17:34:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22942#issuecomment-342581",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:17" align="right">comment:17</div>

It looks like `enum34` is only used by `traitlets`. Does `traitlets` need it with Python 3.6, or does Python 3.6 provide the necessary functionality on its own?



---

archive/issue_comments_342582.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nFirst, enum34 built for me with SAGE_PYTHON3=yes. Second, anyway, we could make this change to its spkg-install file:\n\n```diff\ndiff --git a/build/pkgs/enum34/spkg-install b/build/pkgs/enum34/spkg-install\nindex c1a2289ade..0f465dfd7e 100755\n--- a/build/pkgs/enum34/spkg-install\n+++ b/build/pkgs/enum34/spkg-install\n@@ -1,3 +1,7 @@\n #!/usr/bin/env bash\n \n-cd src && $PIP_INSTALL .\n+if [ \"$SAGE_PYTHON3\" = \"yes\" ]; then\n+    echo \"Not installing enum34: not necessary with Python 3.5 or later.\"\n+else\n+    cd src && $PIP_INSTALL .\n+fi\n```\nI tried this and traitlets built without it: I think traitlets only really needs it with Python 3.4 or earlier. I'll try a complete build with this patch to see how things go.",
    "created_at": "2017-05-10T19:22:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22942#issuecomment-342582",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:18" align="right">comment:18</div>

First, enum34 built for me with SAGE_PYTHON3=yes. Second, anyway, we could make this change to its spkg-install file:

```diff
diff --git a/build/pkgs/enum34/spkg-install b/build/pkgs/enum34/spkg-install
index c1a2289ade..0f465dfd7e 100755
--- a/build/pkgs/enum34/spkg-install
+++ b/build/pkgs/enum34/spkg-install
@@ -1,3 +1,7 @@
 #!/usr/bin/env bash
 
-cd src && $PIP_INSTALL .
+if [ "$SAGE_PYTHON3" = "yes" ]; then
+    echo "Not installing enum34: not necessary with Python 3.5 or later."
+else
+    cd src && $PIP_INSTALL .
+fi
```
I tried this and traitlets built without it: I think traitlets only really needs it with Python 3.4 or earlier. I'll try a complete build with this patch to see how things go.



---

archive/issue_comments_342583.json:
```json
{
    "body": "<div id=\"comment:19\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2bc12b62a5aadc732a3acd119e81f799279b6d92\"><code>2bc12b6</code></a></td><td><code>trac 22942: do not build enum34 with Python 3.5 or later</code></td></tr></table>\n",
    "created_at": "2017-05-10T21:27:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22942#issuecomment-342583",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:19"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2bc12b62a5aadc732a3acd119e81f799279b6d92"><code>2bc12b6</code></a></td><td><code>trac 22942: do not build enum34 with Python 3.5 or later</code></td></tr></table>




---

archive/issue_comments_342584.json:
```json
{
    "body": "Changed commit from **[`3821151`](https://github.com/sagemath/sagetrac-mirror/commit/3821151a0f02808ac9a6edd28544cac0a27c241f)** to **[`2bc12b6`](https://github.com/sagemath/sagetrac-mirror/commit/2bc12b62a5aadc732a3acd119e81f799279b6d92)**",
    "created_at": "2017-05-10T21:27:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22942#issuecomment-342584",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`3821151`](https://github.com/sagemath/sagetrac-mirror/commit/3821151a0f02808ac9a6edd28544cac0a27c241f)** to **[`2bc12b6`](https://github.com/sagemath/sagetrac-mirror/commit/2bc12b62a5aadc732a3acd119e81f799279b6d92)**



---

archive/issue_comments_342585.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nThis worked for me, so I've added it to the branch.",
    "created_at": "2017-05-10T21:28:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22942#issuecomment-342585",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:20" align="right">comment:20</div>

This worked for me, so I've added it to the branch.



---

archive/issue_comments_342586.json:
```json
{
    "body": "<div id=\"comment:21\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0f0ed1c5cea43225d5cdb412b76d9e055a7c2c13\"><code>0f0ed1c</code></a></td><td><code>trac 22942: do not build enum34 with Python 3.5 or later</code></td></tr></table>\n",
    "created_at": "2017-05-10T21:28:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22942#issuecomment-342586",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:21"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0f0ed1c5cea43225d5cdb412b76d9e055a7c2c13"><code>0f0ed1c</code></a></td><td><code>trac 22942: do not build enum34 with Python 3.5 or later</code></td></tr></table>




---

archive/issue_comments_342587.json:
```json
{
    "body": "Changed commit from **[`2bc12b6`](https://github.com/sagemath/sagetrac-mirror/commit/2bc12b62a5aadc732a3acd119e81f799279b6d92)** to **[`0f0ed1c`](https://github.com/sagemath/sagetrac-mirror/commit/0f0ed1c5cea43225d5cdb412b76d9e055a7c2c13)**",
    "created_at": "2017-05-10T21:28:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22942#issuecomment-342587",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`2bc12b6`](https://github.com/sagemath/sagetrac-mirror/commit/2bc12b62a5aadc732a3acd119e81f799279b6d92)** to **[`0f0ed1c`](https://github.com/sagemath/sagetrac-mirror/commit/0f0ed1c5cea43225d5cdb412b76d9e055a7c2c13)**



---

archive/issue_comments_342588.json:
```json
{
    "body": "Changed commit from **[`0f0ed1c`](https://github.com/sagemath/sagetrac-mirror/commit/0f0ed1c5cea43225d5cdb412b76d9e055a7c2c13)** to **[`45e44a0`](https://github.com/sagemath/sagetrac-mirror/commit/45e44a0d5d00ae08e04644de04d7adf03884946d)**",
    "created_at": "2017-05-10T21:29:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22942#issuecomment-342588",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`0f0ed1c`](https://github.com/sagemath/sagetrac-mirror/commit/0f0ed1c5cea43225d5cdb412b76d9e055a7c2c13)** to **[`45e44a0`](https://github.com/sagemath/sagetrac-mirror/commit/45e44a0d5d00ae08e04644de04d7adf03884946d)**



---

archive/issue_comments_342589.json:
```json
{
    "body": "<div id=\"comment:22\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/45e44a0d5d00ae08e04644de04d7adf03884946d\"><code>45e44a0</code></a></td><td><code>trac 22942: do not build enum34 with Python 3.4 or later</code></td></tr></table>\n",
    "created_at": "2017-05-10T21:29:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22942#issuecomment-342589",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:22"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/45e44a0d5d00ae08e04644de04d7adf03884946d"><code>45e44a0</code></a></td><td><code>trac 22942: do not build enum34 with Python 3.4 or later</code></td></tr></table>




---

archive/issue_comments_342590.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nAlternatively, we could use https://github.com/jstasiak/enum-compat. But since we have complete control over our Python versions, I don't think we need to do that.",
    "created_at": "2017-05-10T21:33:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22942#issuecomment-342590",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:23" align="right">comment:23</div>

Alternatively, we could use https://github.com/jstasiak/enum-compat. But since we have complete control over our Python versions, I don't think we need to do that.



---

archive/issue_comments_342591.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nThe latest branch works for me with SAGE_PYTHON3=yes.",
    "created_at": "2017-05-11T07:37:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22942#issuecomment-342591",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:24" align="right">comment:24</div>

The latest branch works for me with SAGE_PYTHON3=yes.



---

archive/issue_comments_342592.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nand also works with python2",
    "created_at": "2017-05-11T15:10:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22942#issuecomment-342592",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:25" align="right">comment:25</div>

and also works with python2



---

archive/issue_comments_342593.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nI am therefore tempted to give a positive review.\n\n@embray and others, do you have any objection, related to Cygwin or not ?",
    "created_at": "2017-05-11T20:14:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22942#issuecomment-342593",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:26" align="right">comment:26</div>

I am therefore tempted to give a positive review.

@embray and others, do you have any objection, related to Cygwin or not ?



---

archive/issue_events_321472.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-05-13T09:02:33Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22942",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22942#event-321472"
}
```



---

archive/issue_events_321473.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-05-13T09:02:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22942",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22942#event-321473"
}
```



---

archive/issue_comments_342594.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nI am setting to positive. If somebody objects, it's time to speak.",
    "created_at": "2017-05-13T09:02:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22942#issuecomment-342594",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:27" align="right">comment:27</div>

I am setting to positive. If somebody objects, it's time to speak.



---

archive/issue_comments_342595.json:
```json
{
    "body": "Author: **John Palmieri**",
    "created_at": "2017-05-13T09:02:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22942#issuecomment-342595",
    "user": "https://github.com/fchapoton"
}
```

Author: **John Palmieri**



---

archive/issue_comments_342596.json:
```json
{
    "body": "Reviewer: **Fr\u00e9d\u00e9ric Chapoton**",
    "created_at": "2017-05-13T09:02:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22942#issuecomment-342596",
    "user": "https://github.com/fchapoton"
}
```

Reviewer: **Frédéric Chapoton**



---

archive/issue_comments_342597.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nThe new python version improved syntax checking it seems:\n\n```\n$ sage -t --long src/sage/tests/py3_syntax.py\nRunning doctests with ID 2017-05-14-10-13-07-3c005bd2.\nGit branch: develop\nUsing --optional=mpir,python2,sage\nDoctesting 1 file.\nsage -t --long --warn-long 72.0 src/sage/tests/py3_syntax.py\n**********************************************************************\nFile \"src/sage/tests/py3_syntax.py\", line 17, in sage.tests.py3_syntax\nFailed example:\n    py3_syntax.run_tests('.py')   # long time\nExpected nothing\nGot:\n    Invalid Python 3 syntax found:\n      File \"src/sage/calculus/calculus.py\", line 2205\n        global _syms\n        ^\n    SyntaxError: name '_syms' is used prior to global declaration\n    <BLANKLINE>\n    <BLANKLINE>\n**********************************************************************\n1 item had failures:\n   1 of   4 in sage.tests.py3_syntax\n    [29 tests, 1 failure, 18.18 s]\n----------------------------------------------------------------------\nsage -t --long --warn-long 72.0 src/sage/tests/py3_syntax.py  # 1 doctest failed\n----------------------------------------------------------------------\nTotal time for all tests: 18.4 seconds\n    cpu time: 1.4 seconds\n    cumulative wall time: 18.2 seconds\n```",
    "created_at": "2017-05-14T08:18:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22942#issuecomment-342597",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:28" align="right">comment:28</div>

The new python version improved syntax checking it seems:

```
$ sage -t --long src/sage/tests/py3_syntax.py
Running doctests with ID 2017-05-14-10-13-07-3c005bd2.
Git branch: develop
Using --optional=mpir,python2,sage
Doctesting 1 file.
sage -t --long --warn-long 72.0 src/sage/tests/py3_syntax.py
**********************************************************************
File "src/sage/tests/py3_syntax.py", line 17, in sage.tests.py3_syntax
Failed example:
    py3_syntax.run_tests('.py')   # long time
Expected nothing
Got:
    Invalid Python 3 syntax found:
      File "src/sage/calculus/calculus.py", line 2205
        global _syms
        ^
    SyntaxError: name '_syms' is used prior to global declaration
    <BLANKLINE>
    <BLANKLINE>
**********************************************************************
1 item had failures:
   1 of   4 in sage.tests.py3_syntax
    [29 tests, 1 failure, 18.18 s]
----------------------------------------------------------------------
sage -t --long --warn-long 72.0 src/sage/tests/py3_syntax.py  # 1 doctest failed
----------------------------------------------------------------------
Total time for all tests: 18.4 seconds
    cpu time: 1.4 seconds
    cumulative wall time: 18.2 seconds
```



---

archive/issue_events_321474.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-05-14T08:18:43Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22942",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22942#event-321474"
}
```



---

archive/issue_events_321475.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-05-14T08:18:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22942",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22942#event-321475"
}
```



---

archive/issue_comments_342598.json:
```json
{
    "body": "Changed commit from **[`45e44a0`](https://github.com/sagemath/sagetrac-mirror/commit/45e44a0d5d00ae08e04644de04d7adf03884946d)** to **[`7c393d7`](https://github.com/sagemath/sagetrac-mirror/commit/7c393d7d7dc3eb62fb8061b9f4118e54a47228dc)**",
    "created_at": "2017-05-14T11:33:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22942#issuecomment-342598",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`45e44a0`](https://github.com/sagemath/sagetrac-mirror/commit/45e44a0d5d00ae08e04644de04d7adf03884946d)** to **[`7c393d7`](https://github.com/sagemath/sagetrac-mirror/commit/7c393d7d7dc3eb62fb8061b9f4118e54a47228dc)**



---

archive/issue_comments_342599.json:
```json
{
    "body": "<div id=\"comment:29\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c82f856e9c5c2cb4f311354820cb6b884fd34cc4\"><code>c82f856</code></a></td><td><code>Merge branch 'public/python3.6.1' in 8.0.b6</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7c393d7d7dc3eb62fb8061b9f4118e54a47228dc\"><code>7c393d7</code></a></td><td><code>trac 22941 fixing syntax in calculus.py</code></td></tr></table>\n",
    "created_at": "2017-05-14T11:33:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22942#issuecomment-342599",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:29"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c82f856e9c5c2cb4f311354820cb6b884fd34cc4"><code>c82f856</code></a></td><td><code>Merge branch 'public/python3.6.1' in 8.0.b6</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7c393d7d7dc3eb62fb8061b9f4118e54a47228dc"><code>7c393d7</code></a></td><td><code>trac 22941 fixing syntax in calculus.py</code></td></tr></table>




---

archive/issue_comments_342600.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nIndeed. Fixed.\n\nVolker, can I set to positive in order to try again ?",
    "created_at": "2017-05-14T11:34:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22942#issuecomment-342600",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:30" align="right">comment:30</div>

Indeed. Fixed.

Volker, can I set to positive in order to try again ?



---

archive/issue_events_321476.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-05-14T11:48:15Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22942",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22942#event-321476"
}
```



---

archive/issue_events_321477.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-05-14T11:48:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22942",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22942#event-321477"
}
```



---

archive/issue_events_321478.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-05-14T12:13:20Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22942",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22942#event-321478"
}
```



---

archive/issue_events_321479.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-05-14T12:13:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22942",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22942#event-321479"
}
```



---

archive/issue_comments_342601.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nI seem to get doctest failures with this change. I think it would be better to move the definition of `_syms` earlier in the file. I'll try both ways more methodically, though.\n\n```diff\ndiff --git a/src/sage/calculus/calculus.py b/src/sage/calculus/calculus.py\nindex 38a2ef7151..33204a5dee 100644\n--- a/src/sage/calculus/calculus.py\n+++ b/src/sage/calculus/calculus.py\n@@ -1991,8 +1991,22 @@ _inverse_laplace = function_factory('ilt',\n \n ######################################i################\n \n+# Parser for symbolic ring elements\n \n+# We keep two dictionaries syms_cur and syms_default to keep the current symbol\n+# table and the state of the table at startup respectively. These are used by\n+# the restore() function (see sage.misc.reset).\n+#\n+# The dictionary _syms is used as a lookup table for the system function\n+# registry by _find_func() below. It gets updated by\n+# symbolic_expression_from_string() before calling the parser.\n+_syms = syms_cur = symbol_table.get('functions', {})\n+syms_default = dict(syms_cur)\n \n+# This dictionary is used to pass a lookup table other than the system registry\n+# to the parser. A global variable is necessary since the parser calls the\n+# _find_var() and _find_func() functions below without extra arguments.\n+_augmented_syms = {}\n \n #######################################################\n \n@@ -2254,25 +2268,6 @@ def maxima_options(**kwds):\n     \"\"\"\n     return ','.join(['%s=%s'%(key,mapped_opts(val)) for key, val in six.iteritems(kwds)])\n \n-\n-# Parser for symbolic ring elements\n-\n-# We keep two dictionaries syms_cur and syms_default to keep the current symbol\n-# table and the state of the table at startup respectively. These are used by\n-# the restore() function (see sage.misc.reset).\n-#\n-# The dictionary _syms is used as a lookup table for the system function\n-# registry by _find_func() below. It gets updated by\n-# symbolic_expression_from_string() before calling the parser.\n-_syms = syms_cur = symbol_table.get('functions', {})\n-syms_default = dict(syms_cur)\n-\n-# This dictionary is used to pass a lookup table other than the system registry\n-# to the parser. A global variable is necessary since the parser calls the\n-# _find_var() and _find_func() functions below without extra arguments.\n-_augmented_syms = {}\n-\n-\n def _find_var(name):\n     \"\"\"\n     Function to pass to Parser for constructing\n```",
    "created_at": "2017-05-14T15:11:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22942#issuecomment-342601",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:33" align="right">comment:33</div>

I seem to get doctest failures with this change. I think it would be better to move the definition of `_syms` earlier in the file. I'll try both ways more methodically, though.

```diff
diff --git a/src/sage/calculus/calculus.py b/src/sage/calculus/calculus.py
index 38a2ef7151..33204a5dee 100644
--- a/src/sage/calculus/calculus.py
+++ b/src/sage/calculus/calculus.py
@@ -1991,8 +1991,22 @@ _inverse_laplace = function_factory('ilt',
 
 ######################################i################
 
+# Parser for symbolic ring elements
 
+# We keep two dictionaries syms_cur and syms_default to keep the current symbol
+# table and the state of the table at startup respectively. These are used by
+# the restore() function (see sage.misc.reset).
+#
+# The dictionary _syms is used as a lookup table for the system function
+# registry by _find_func() below. It gets updated by
+# symbolic_expression_from_string() before calling the parser.
+_syms = syms_cur = symbol_table.get('functions', {})
+syms_default = dict(syms_cur)
 
+# This dictionary is used to pass a lookup table other than the system registry
+# to the parser. A global variable is necessary since the parser calls the
+# _find_var() and _find_func() functions below without extra arguments.
+_augmented_syms = {}
 
 #######################################################
 
@@ -2254,25 +2268,6 @@ def maxima_options(**kwds):
     """
     return ','.join(['%s=%s'%(key,mapped_opts(val)) for key, val in six.iteritems(kwds)])
 
-
-# Parser for symbolic ring elements
-
-# We keep two dictionaries syms_cur and syms_default to keep the current symbol
-# table and the state of the table at startup respectively. These are used by
-# the restore() function (see sage.misc.reset).
-#
-# The dictionary _syms is used as a lookup table for the system function
-# registry by _find_func() below. It gets updated by
-# symbolic_expression_from_string() before calling the parser.
-_syms = syms_cur = symbol_table.get('functions', {})
-syms_default = dict(syms_cur)
-
-# This dictionary is used to pass a lookup table other than the system registry
-# to the parser. A global variable is necessary since the parser calls the
-# _find_var() and _find_func() functions below without extra arguments.
-_augmented_syms = {}
-
-
 def _find_var(name):
     """
     Function to pass to Parser for constructing
```



---

archive/issue_comments_342602.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nNo, never mind, everything is fine.",
    "created_at": "2017-05-14T16:20:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22942#issuecomment-342602",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:34" align="right">comment:34</div>

No, never mind, everything is fine.



---

archive/issue_events_321480.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-05-16T22:22:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22942",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22942#event-321480"
}
```



---

archive/issue_events_321481.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "127bae79104d5934e2167b3079c5d83e7b12476d",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2017-05-16T22:22:00Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/22942",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22942#event-321481"
}
```



---

archive/issue_comments_342603.json:
```json
{
    "body": "Changed branch from **[public/python3.6.1](https://github.com/sagemath/sagetrac-mirror/tree/public/python3.6.1)** to **[`7c393d7`](https://github.com/sagemath/sagetrac-mirror/commit/7c393d7d7dc3eb62fb8061b9f4118e54a47228dc)**",
    "created_at": "2017-05-16T22:22:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22942",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22942#issuecomment-342603",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[public/python3.6.1](https://github.com/sagemath/sagetrac-mirror/tree/public/python3.6.1)** to **[`7c393d7`](https://github.com/sagemath/sagetrac-mirror/commit/7c393d7d7dc3eb62fb8061b9f4118e54a47228dc)**
