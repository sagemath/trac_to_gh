# Issue 22009: sage -t src/sage/misc/latex.py opens 2 sage.pdf file

archive/issues_021772.json:
```json
{
    "assignees": [],
    "body": "This was introduced in #21947.\n\nCC:  @mo271 @sagetrac-jepperlein\n\nBranch/Commit: **[`6568cf1`](https://github.com/sagemath/sagetrac-mirror/commit/6568cf13fab12e68973bb9003c760724b2598ee6)**\n\nReviewer: **Fran\u00e7ois Bissey**\n\nAuthor: **S\u00e9bastien Labb\u00e9**\n\nComponent: **misc**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/22009_\n\n",
    "closed_at": "2016-12-05T00:44:34Z",
    "created_at": "2016-12-02T07:20:33Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/p%3A%201%20%E2%80%93%20blocker",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-7.5",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "sage -t src/sage/misc/latex.py opens 2 sage.pdf file",
    "type": "issue",
    "updated_at": "2016-12-05T00:44:34Z",
    "url": "https://github.com/sagemath/sage/issues/22009",
    "user": "https://github.com/seblabbe"
}
```
This was introduced in #21947.

CC:  @mo271 @sagetrac-jepperlein

Branch/Commit: **[`6568cf1`](https://github.com/sagemath/sagetrac-mirror/commit/6568cf13fab12e68973bb9003c760724b2598ee6)**

Reviewer: **François Bissey**

Author: **Sébastien Labbé**

Component: **misc**

_Issue created by migration from https://trac.sagemath.org/ticket/22009_





---

archive/issue_events_308329.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2016-12-02T07:20:33Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/22009",
    "milestone_number": null,
    "milestone_title": "sage-7.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22009#event-308329"
}
```



---

archive/issue_events_308330.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2016-12-02T07:20:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22009",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22009#event-308330"
}
```



---

archive/issue_events_308331.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2016-12-02T07:20:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22009",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22009#event-308331"
}
```



---

archive/issue_comments_324221.json:
```json
{
    "body": "Branch: **[u/slabbe/22009](https://github.com/sagemath/sagetrac-mirror/tree/u/slabbe/22009)**",
    "created_at": "2016-12-02T07:30:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22009#issuecomment-324221",
    "user": "https://github.com/seblabbe"
}
```

Branch: **[u/slabbe/22009](https://github.com/sagemath/sagetrac-mirror/tree/u/slabbe/22009)**



---

archive/issue_events_308332.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2016-12-02T07:30:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22009",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22009#event-308332"
}
```



---

archive/issue_comments_324222.json:
```json
{
    "body": "<div id=\"comment:1\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6568cf13fab12e68973bb9003c760724b2598ee6\">6568cf1</a></td><td><code>22009: adding not tested for view tests</code></td></tr></table>\n",
    "created_at": "2016-12-02T07:30:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22009#issuecomment-324222",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:1"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6568cf13fab12e68973bb9003c760724b2598ee6">6568cf1</a></td><td><code>22009: adding not tested for view tests</code></td></tr></table>




---

archive/issue_comments_324223.json:
```json
{
    "body": "Commit: **[`6568cf1`](https://github.com/sagemath/sagetrac-mirror/commit/6568cf13fab12e68973bb9003c760724b2598ee6)**",
    "created_at": "2016-12-02T07:30:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22009#issuecomment-324223",
    "user": "https://github.com/seblabbe"
}
```

Commit: **[`6568cf1`](https://github.com/sagemath/sagetrac-mirror/commit/6568cf13fab12e68973bb9003c760724b2598ee6)**



---

archive/issue_comments_324224.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nSomething that happened to me with those tests as well is that I got a more verbose output the first time\n\n```\nFile \"/usr/lib64/python2.7/site-packages/sage/misc/latex.py\", line 2157, in sage.misc.latex.?\nFailed example:\n    view(4, margin=5, debug=True)\nExpected:\n    \\documentclass{article}\n    ...\n    \\usepackage[tightpage,active]{preview}\n    \\PreviewEnvironment{page}\n    \\setlength\\PreviewBorder{5.000000mm}\n    \\begin{document}\\begin{page}$4$\\end{page}\n    \\end{document}\n    ...\nGot:\n    This is XeTeX, Version 3.14159265-2.6-0.99991 (TeX Live 2014) (preloaded format=xelatex)\n     restricted \\write18 enabled.\n    entering extended mode\n    LaTeX2e <2014/05/01>\n    Babel <3.9l> and hyphenation patterns for 48 languages loaded.\n...\n```\nIt ends up being a super set of the expected output. I didn't get it when running the test remotely. I will have to check if you need to be on the machine to see that.",
    "created_at": "2016-12-02T07:37:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22009#issuecomment-324224",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:2" align="right">comment:2</div>

Something that happened to me with those tests as well is that I got a more verbose output the first time

```
File "/usr/lib64/python2.7/site-packages/sage/misc/latex.py", line 2157, in sage.misc.latex.?
Failed example:
    view(4, margin=5, debug=True)
Expected:
    \documentclass{article}
    ...
    \usepackage[tightpage,active]{preview}
    \PreviewEnvironment{page}
    \setlength\PreviewBorder{5.000000mm}
    \begin{document}\begin{page}$4$\end{page}
    \end{document}
    ...
Got:
    This is XeTeX, Version 3.14159265-2.6-0.99991 (TeX Live 2014) (preloaded format=xelatex)
     restricted \write18 enabled.
    entering extended mode
    LaTeX2e <2014/05/01>
    Babel <3.9l> and hyphenation patterns for 48 languages loaded.
...
```
It ends up being a super set of the expected output. I didn't get it when running the test remotely. I will have to check if you need to be on the machine to see that.



---

archive/issue_comments_324225.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nIt must be because of the `debug=True` option that is given to many subcommands in the view function. What does `debug=True` mean anyway, printing which info? Since it is not well defined, it seems not the proper way to doctest the view function.\n\nAlso, we do not know where the .tex and the .pdf files are generated. And there is no way to run the view function without opening the generated .pdf file. So, it is difficult to test the `view` function properly.\n\nPersonnally, I will not spend to much time trying to improve how `view` is tested. I would rather replace `view` by something more object oriented like [slabbe/tikz_picture.py](https://github.com/seblabbe/slabbe/blob/master/slabbe/tikz_picture.py). I intend to make the module `tikz_picture.py` in my package more general during the next year. Then, I will propose, if there is interest, to include this into Sage.",
    "created_at": "2016-12-02T08:11:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22009#issuecomment-324225",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:3" align="right">comment:3</div>

It must be because of the `debug=True` option that is given to many subcommands in the view function. What does `debug=True` mean anyway, printing which info? Since it is not well defined, it seems not the proper way to doctest the view function.

Also, we do not know where the .tex and the .pdf files are generated. And there is no way to run the view function without opening the generated .pdf file. So, it is difficult to test the `view` function properly.

Personnally, I will not spend to much time trying to improve how `view` is tested. I would rather replace `view` by something more object oriented like [slabbe/tikz_picture.py](https://github.com/seblabbe/slabbe/blob/master/slabbe/tikz_picture.py). I intend to make the module `tikz_picture.py` in my package more general during the next year. Then, I will propose, if there is interest, to include this into Sage.



---

archive/issue_events_308333.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2016-12-02T08:17:25Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22009",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22009#event-308333"
}
```



---

archive/issue_events_308334.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2016-12-02T08:17:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22009",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22009#event-308334"
}
```



---

archive/issue_comments_324226.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nOK, in any case the change is rather trivial. I don't like seeing windows poping up either in the middle of what I am doing because doctests are running in the background. Which is exactly what happened to me this afternoon.\n\nCan you fill in the author section please.",
    "created_at": "2016-12-02T08:17:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22009#issuecomment-324226",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:4" align="right">comment:4</div>

OK, in any case the change is rather trivial. I don't like seeing windows poping up either in the middle of what I am doing because doctests are running in the background. Which is exactly what happened to me this afternoon.

Can you fill in the author section please.



---

archive/issue_comments_324227.json:
```json
{
    "body": "Reviewer: **Fran\u00e7ois Bissey**",
    "created_at": "2016-12-02T08:17:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22009#issuecomment-324227",
    "user": "https://github.com/kiwifb"
}
```

Reviewer: **François Bissey**



---

archive/issue_comments_324228.json:
```json
{
    "body": "Author: **S\u00e9bastien Labb\u00e9**",
    "created_at": "2016-12-02T08:21:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22009#issuecomment-324228",
    "user": "https://github.com/seblabbe"
}
```

Author: **Sébastien Labbé**



---

archive/issue_comments_324229.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nI fully agree with slabbe's statement, view is definitely the wrong place to generate latex code, as it can for example not be tested without popping up windows. Sorry for introducing this doctest.",
    "created_at": "2016-12-02T08:23:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22009#issuecomment-324229",
    "user": "https://github.com/sagetrac-jepperlein"
}
```

<div id="comment:6" align="right">comment:6</div>

I fully agree with slabbe's statement, view is definitely the wrong place to generate latex code, as it can for example not be tested without popping up windows. Sorry for introducing this doctest.



---

archive/issue_comments_324230.json:
```json
{
    "body": "Changed author from **S\u00e9bastien Labb\u00e9** to none",
    "created_at": "2016-12-02T08:23:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22009#issuecomment-324230",
    "user": "https://github.com/sagetrac-jepperlein"
}
```

Changed author from **Sébastien Labbé** to none



---

archive/issue_comments_324231.json:
```json
{
    "body": "Author: **S\u00e9bastien Labb\u00e9**",
    "created_at": "2016-12-02T08:24:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22009#issuecomment-324231",
    "user": "https://github.com/sagetrac-jepperlein"
}
```

Author: **Sébastien Labbé**



---

archive/issue_events_308335.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-12-03T16:25:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22009",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22009#event-308335"
}
```



---

archive/issue_events_308336.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-12-03T16:25:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22009",
    "label": "https://github.com/sagemath/sage/labels/p%3A%201%20%E2%80%93%20blocker",
    "label_color": "ff0000",
    "label_name": "p: 1 \u2013 blocker",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22009#event-308336"
}
```



---

archive/issue_events_308337.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-12-05T00:44:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22009",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22009#event-308337"
}
```



---

archive/issue_events_308338.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "0e02b51b5da5c6fef3c49b0e91c784b0e47b43ec",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2016-12-05T00:44:34Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/22009",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22009#event-308338"
}
```



---

archive/issue_comments_324232.json:
```json
{
    "body": "Changed branch from **[u/slabbe/22009](https://github.com/sagemath/sagetrac-mirror/tree/u/slabbe/22009)** to **[`6568cf1`](https://github.com/sagemath/sagetrac-mirror/commit/6568cf13fab12e68973bb9003c760724b2598ee6)**",
    "created_at": "2016-12-05T00:44:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22009#issuecomment-324232",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/slabbe/22009](https://github.com/sagemath/sagetrac-mirror/tree/u/slabbe/22009)** to **[`6568cf1`](https://github.com/sagemath/sagetrac-mirror/commit/6568cf13fab12e68973bb9003c760724b2598ee6)**
