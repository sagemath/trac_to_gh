# Issue 22009: sage -t src/sage/misc/latex.py opens 2 sage.pdf file

archive/issues_021772.json:
```json
{
    "body": "This was introduced in #21947.\n\nCC:  @mo271 jepperlein\n\nBranch/Commit: [6568cf13fab12e68973bb9003c760724b2598ee6](https://github.com/sagemath/sagetrac-mirror/commit/6568cf13fab12e68973bb9003c760724b2598ee6)\n\nReviewer: Fran\u00e7ois Bissey\n\nAuthor: S\u00e9bastien Labb\u00e9\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/22009\n\n",
    "closed_at": "2016-12-05T00:44:34Z",
    "created_at": "2016-12-02T07:20:33Z",
    "labels": [
        "component: misc",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.5",
    "title": "sage -t src/sage/misc/latex.py opens 2 sage.pdf file",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22009",
    "user": "https://github.com/seblabbe"
}
```
This was introduced in #21947.

CC:  @mo271 jepperlein

Branch/Commit: [6568cf13fab12e68973bb9003c760724b2598ee6](https://github.com/sagemath/sagetrac-mirror/commit/6568cf13fab12e68973bb9003c760724b2598ee6)

Reviewer: François Bissey

Author: Sébastien Labbé

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/22009





---

archive/issue_comments_409603.json:
```json
{
    "body": "Branch: [u/slabbe/22009](https://github.com/sagemath/sagetrac-mirror/tree/u/slabbe/22009)",
    "created_at": "2016-12-02T07:30:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22009#issuecomment-409603",
    "user": "https://github.com/seblabbe"
}
```

Branch: [u/slabbe/22009](https://github.com/sagemath/sagetrac-mirror/tree/u/slabbe/22009)



---

archive/issue_comments_409604.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-12-02T07:30:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22009#issuecomment-409604",
    "user": "https://github.com/seblabbe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_409605.json:
```json
{
    "body": "<a id='comment:1'></a>\nNew commits:\n|                                                                                                                                          |                                         |\n|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------|\n|[6568cf1](https://github.com/sagemath/sagetrac-mirror/commit/6568cf13fab12e68973bb9003c760724b2598ee6)|`22009: adding not tested for view tests`|",
    "created_at": "2016-12-02T07:30:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22009#issuecomment-409605",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:1'></a>
New commits:
|                                                                                                                                          |                                         |
|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------|
|[6568cf1](https://github.com/sagemath/sagetrac-mirror/commit/6568cf13fab12e68973bb9003c760724b2598ee6)|`22009: adding not tested for view tests`|



---

archive/issue_comments_409606.json:
```json
{
    "body": "Commit: [6568cf13fab12e68973bb9003c760724b2598ee6](https://github.com/sagemath/sagetrac-mirror/commit/6568cf13fab12e68973bb9003c760724b2598ee6)",
    "created_at": "2016-12-02T07:30:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22009#issuecomment-409606",
    "user": "https://github.com/seblabbe"
}
```

Commit: [6568cf13fab12e68973bb9003c760724b2598ee6](https://github.com/sagemath/sagetrac-mirror/commit/6568cf13fab12e68973bb9003c760724b2598ee6)



---

archive/issue_comments_409607.json:
```json
{
    "body": "<a id='comment:2'></a>\nSomething that happened to me with those tests as well is that I got a more verbose output the first time\n\n```\nFile \"/usr/lib64/python2.7/site-packages/sage/misc/latex.py\", line 2157, in sage.misc.latex.?\nFailed example:\n    view(4, margin=5, debug=True)\nExpected:\n    \\documentclass{article}\n    ...\n    \\usepackage[tightpage,active]{preview}\n    \\PreviewEnvironment{page}\n    \\setlength\\PreviewBorder{5.000000mm}\n    \\begin{document}\\begin{page}$4$\\end{page}\n    \\end{document}\n    ...\nGot:\n    This is XeTeX, Version 3.14159265-2.6-0.99991 (TeX Live 2014) (preloaded format=xelatex)\n     restricted \\write18 enabled.\n    entering extended mode\n    LaTeX2e <2014/05/01>\n    Babel <3.9l> and hyphenation patterns for 48 languages loaded.\n...\n```\nIt ends up being a super set of the expected output. I didn't get it when running the test remotely. I will have to check if you need to be on the machine to see that.",
    "created_at": "2016-12-02T07:37:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22009#issuecomment-409607",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:2'></a>
Something that happened to me with those tests as well is that I got a more verbose output the first time

```
File "/usr/lib64/python2.7/site-packages/sage/misc/latex.py", line 2157, in sage.misc.latex.?
Failed example:
    view(4, margin=5, debug=True)
Expected:
    \documentclass{article}
    ...
    \usepackage[tightpage,active]{preview}
    \PreviewEnvironment{page}
    \setlength\PreviewBorder{5.000000mm}
    \begin{document}\begin{page}$4$\end{page}
    \end{document}
    ...
Got:
    This is XeTeX, Version 3.14159265-2.6-0.99991 (TeX Live 2014) (preloaded format=xelatex)
     restricted \write18 enabled.
    entering extended mode
    LaTeX2e <2014/05/01>
    Babel <3.9l> and hyphenation patterns for 48 languages loaded.
...
```
It ends up being a super set of the expected output. I didn't get it when running the test remotely. I will have to check if you need to be on the machine to see that.



---

archive/issue_comments_409608.json:
```json
{
    "body": "<a id='comment:3'></a>\nIt must be because of the `debug=True` option that is given to many subcommands in the view function. What does `debug=True` mean anyway, printing which info? Since it is not well defined, it seems not the proper way to doctest the view function.\n\nAlso, we do not know where the .tex and the .pdf files are generated. And there is no way to run the view function without opening the generated .pdf file. So, it is difficult to test the `view` function properly.\n\nPersonnally, I will not spend to much time trying to improve how `view` is tested. I would rather replace `view` by something more object oriented like [slabbe/tikz_picture.py](https://github.com/seblabbe/slabbe/blob/master/slabbe/tikz_picture.py). I intend to make the module `tikz_picture.py` in my package more general during the next year. Then, I will propose, if there is interest, to include this into Sage.",
    "created_at": "2016-12-02T08:11:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22009#issuecomment-409608",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:3'></a>
It must be because of the `debug=True` option that is given to many subcommands in the view function. What does `debug=True` mean anyway, printing which info? Since it is not well defined, it seems not the proper way to doctest the view function.

Also, we do not know where the .tex and the .pdf files are generated. And there is no way to run the view function without opening the generated .pdf file. So, it is difficult to test the `view` function properly.

Personnally, I will not spend to much time trying to improve how `view` is tested. I would rather replace `view` by something more object oriented like [slabbe/tikz_picture.py](https://github.com/seblabbe/slabbe/blob/master/slabbe/tikz_picture.py). I intend to make the module `tikz_picture.py` in my package more general during the next year. Then, I will propose, if there is interest, to include this into Sage.



---

archive/issue_comments_409609.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-12-02T08:17:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22009#issuecomment-409609",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_409610.json:
```json
{
    "body": "<a id='comment:4'></a>\nOK, in any case the change is rather trivial. I don't like seeing windows poping up either in the middle of what I am doing because doctests are running in the background. Which is exactly what happened to me this afternoon.\n\nCan you fill in the author section please.",
    "created_at": "2016-12-02T08:17:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22009#issuecomment-409610",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:4'></a>
OK, in any case the change is rather trivial. I don't like seeing windows poping up either in the middle of what I am doing because doctests are running in the background. Which is exactly what happened to me this afternoon.

Can you fill in the author section please.



---

archive/issue_comments_409611.json:
```json
{
    "body": "Reviewer: Fran\u00e7ois Bissey",
    "created_at": "2016-12-02T08:17:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22009#issuecomment-409611",
    "user": "https://github.com/kiwifb"
}
```

Reviewer: François Bissey



---

archive/issue_comments_409612.json:
```json
{
    "body": "Author: S\u00e9bastien Labb\u00e9",
    "created_at": "2016-12-02T08:21:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22009#issuecomment-409612",
    "user": "https://github.com/seblabbe"
}
```

Author: Sébastien Labbé



---

archive/issue_comments_409613.json:
```json
{
    "body": "<a id='comment:6'></a>\nI fully agree with slabbe's statement, view is definitely the wrong place to generate latex code, as it can for example not be tested without popping up windows. Sorry for introducing this doctest.",
    "created_at": "2016-12-02T08:23:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22009#issuecomment-409613",
    "user": "https://trac.sagemath.org/admin/accounts/users/jepperlein"
}
```

<a id='comment:6'></a>
I fully agree with slabbe's statement, view is definitely the wrong place to generate latex code, as it can for example not be tested without popping up windows. Sorry for introducing this doctest.



---

archive/issue_comments_409614.json:
```json
{
    "body": "Changing author from \"S\u00e9bastien Labb\u00e9\" to \"\"",
    "created_at": "2016-12-02T08:23:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22009#issuecomment-409614",
    "user": "https://trac.sagemath.org/admin/accounts/users/jepperlein"
}
```

Changing author from "Sébastien Labbé" to ""



---

archive/issue_comments_409615.json:
```json
{
    "body": "Author: S\u00e9bastien Labb\u00e9",
    "created_at": "2016-12-02T08:24:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22009#issuecomment-409615",
    "user": "https://trac.sagemath.org/admin/accounts/users/jepperlein"
}
```

Author: Sébastien Labbé



---

archive/issue_events_065919.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-12-05T00:44:34Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/22009",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22009#event-65919"
}
```



---

archive/issue_comments_409616.json:
```json
{
    "body": "Changing branch from \"[u/slabbe/22009](https://github.com/sagemath/sagetrac-mirror/tree/u/slabbe/22009)\" to \"[6568cf13fab12e68973bb9003c760724b2598ee6](https://github.com/sagemath/sagetrac-mirror/commit/6568cf13fab12e68973bb9003c760724b2598ee6)\"",
    "created_at": "2016-12-05T00:44:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22009#issuecomment-409616",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "[u/slabbe/22009](https://github.com/sagemath/sagetrac-mirror/tree/u/slabbe/22009)" to "[6568cf13fab12e68973bb9003c760724b2598ee6](https://github.com/sagemath/sagetrac-mirror/commit/6568cf13fab12e68973bb9003c760724b2598ee6)"



---

archive/issue_comments_409617.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-12-05T00:44:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22009#issuecomment-409617",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
