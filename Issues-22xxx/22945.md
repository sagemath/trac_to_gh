# Issue 22945: py3: test ticket for unicode

archive/issues_022708.json:
```json
{
    "assignees": [],
    "body": "trying to move forward using unicode_literals and see what happens\n\nCC:  @tscrim\n\nKeywords: **unicode**\n\nBranch/Commit: **[u/chapoton/22945](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/22945) @ [93cd4e1](https://github.com/sagemath/sagetrac-mirror/commit/93cd4e145810e80aadc5de4aaa2b3a94e1f8421a)**\n\nComponent: **python3**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/22945_\n\n",
    "closed_at": "2017-10-22T19:22:13Z",
    "created_at": "2017-05-04T09:58:49Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20python3",
        "https://github.com/sagemath/sage/labels/enhancement",
        "https://github.com/sagemath/sage/labels/wontfix"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "py3: test ticket for unicode",
    "type": "issue",
    "updated_at": "2017-10-22T19:22:13Z",
    "url": "https://github.com/sagemath/sage/issues/22945",
    "user": "https://github.com/fchapoton"
}
```
trying to move forward using unicode_literals and see what happens

CC:  @tscrim

Keywords: **unicode**

Branch/Commit: **[u/chapoton/22945](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/22945) @ [93cd4e1](https://github.com/sagemath/sagetrac-mirror/commit/93cd4e145810e80aadc5de4aaa2b3a94e1f8421a)**

Component: **python3**

_Issue created by migration from https://trac.sagemath.org/ticket/22945_





---

archive/issue_events_320010.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-05-04T09:58:49Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/22945",
    "milestone_number": null,
    "milestone_title": "sage-8.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22945#event-320010"
}
```



---

archive/issue_events_320011.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-05-04T09:58:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22945",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20python3",
    "label_color": "000080",
    "label_name": "c: python3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22945#event-320011"
}
```



---

archive/issue_events_320012.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-05-04T09:58:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22945",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22945#event-320012"
}
```



---

archive/issue_events_320013.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-05-04T09:58:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22945",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22945#event-320013"
}
```



---

archive/issue_comments_342722.json:
```json
{
    "body": "Commit: **[93cd4e1](https://github.com/sagemath/sagetrac-mirror/commit/93cd4e145810e80aadc5de4aaa2b3a94e1f8421a)**",
    "created_at": "2017-05-04T09:59:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22945#issuecomment-342722",
    "user": "https://github.com/fchapoton"
}
```

Commit: **[93cd4e1](https://github.com/sagemath/sagetrac-mirror/commit/93cd4e145810e80aadc5de4aaa2b3a94e1f8421a)**



---

archive/issue_comments_342723.json:
```json
{
    "body": "<div id=\"comment:1\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/93cd4e145810e80aadc5de4aaa2b3a94e1f8421a\">93cd4e1</a></td><td><code>test branch for unicode</code></td></tr></table>\n",
    "created_at": "2017-05-04T09:59:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22945#issuecomment-342723",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:1"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/93cd4e145810e80aadc5de4aaa2b3a94e1f8421a">93cd4e1</a></td><td><code>test branch for unicode</code></td></tr></table>




---

archive/issue_comments_342724.json:
```json
{
    "body": "Branch: **[u/chapoton/22945](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/22945)**",
    "created_at": "2017-05-04T09:59:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22945#issuecomment-342724",
    "user": "https://github.com/fchapoton"
}
```

Branch: **[u/chapoton/22945](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/22945)**



---

archive/issue_comments_342725.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nthis branch is probably not a very good idea..",
    "created_at": "2017-05-04T18:03:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22945#issuecomment-342725",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:2" align="right">comment:2</div>

this branch is probably not a very good idea..



---

archive/issue_comments_342726.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nFr\u00e9d\u00e9ric, you probably have read http://python-future.org/unicode_literals.html\n\nHave you thought about changing the cython language_level (see [#22214 comment:4](https://github.com/sagemath/sage/issues/22214#comment:4)) when using cython for python3, so using `unicode_literals` might be unnecessary.\n\n*When compiling Cython code with language level 3, the str type is identified with exactly the Unicode string type at Cython compile time, i.e. it does not identify with bytes when running in Python 2.* (https://cython.readthedocs.io/en/latest/src/tutorial/strings.html)",
    "created_at": "2017-05-15T22:58:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22945#issuecomment-342726",
    "user": "https://github.com/a-andre"
}
```

<div id="comment:3" align="right">comment:3</div>

Frédéric, you probably have read http://python-future.org/unicode_literals.html

Have you thought about changing the cython language_level (see [#22214 comment:4](https://github.com/sagemath/sage/issues/22214#comment:4)) when using cython for python3, so using `unicode_literals` might be unnecessary.

*When compiling Cython code with language level 3, the str type is identified with exactly the Unicode string type at Cython compile time, i.e. it does not identify with bytes when running in Python 2.* (https://cython.readthedocs.io/en/latest/src/tutorial/strings.html)



---

archive/issue_comments_342727.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nfirst preparation step is #22946",
    "created_at": "2017-06-19T17:16:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22945#issuecomment-342727",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:4" align="right">comment:4</div>

first preparation step is #22946



---

archive/issue_comments_342728.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nThis triggers an amusing infinite loop in `CartanType`:\n\n```\nFile \"/home/u1/chapoton/sage/local/lib/python2.7/site-packages/sage/combinat/root_system/cartan_type.py\", line 708, in __call__\n        return type_reducible.CartanType([ CartanType(subtype) for subtype in t ])\n```\nagain and again..",
    "created_at": "2017-06-23T15:02:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22945#issuecomment-342728",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:5" align="right">comment:5</div>

This triggers an amusing infinite loop in `CartanType`:

```
File "/home/u1/chapoton/sage/local/lib/python2.7/site-packages/sage/combinat/root_system/cartan_type.py", line 708, in __call__
        return type_reducible.CartanType([ CartanType(subtype) for subtype in t ])
```
again and again..



---

archive/issue_comments_342729.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nand one also need to fix this:\n\n```\nPolynomialRing(QQ, u'x')\n```",
    "created_at": "2017-06-23T15:05:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22945#issuecomment-342729",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:6" align="right">comment:6</div>

and one also need to fix this:

```
PolynomialRing(QQ, u'x')
```



---

archive/issue_comments_342730.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nReplying to [@fchapoton](#comment:5):\n> This triggers an amusing infinite loop in `CartanType`:\n> \n> ```\n> File \"/home/u1/chapoton/sage/local/lib/python2.7/site-packages/sage/combinat/root_system/cartan_type.py\", line 708, in __call__\n>         return type_reducible.CartanType([ CartanType(subtype) for subtype in t ])\n> ```\n> again and again..\n\nI am pretty sure it is because of the check\n\n```\n        if isinstance(t, str):\n```\nin `CartanTypeFactory.__call__` and not recognizing it as unicode, so it continues on, then tries to split it up as a reducible type, which then repeats the process because it is a unicode string (which is iterable). So this will recurse indefinitely for any input when you iterate over it, you get the same type of object.",
    "created_at": "2017-06-23T15:25:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22945#issuecomment-342730",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:7" align="right">comment:7</div>

Replying to [@fchapoton](#comment:5):
> This triggers an amusing infinite loop in `CartanType`:
> 
> ```
> File "/home/u1/chapoton/sage/local/lib/python2.7/site-packages/sage/combinat/root_system/cartan_type.py", line 708, in __call__
>         return type_reducible.CartanType([ CartanType(subtype) for subtype in t ])
> ```
> again and again..

I am pretty sure it is because of the check

```
        if isinstance(t, str):
```
in `CartanTypeFactory.__call__` and not recognizing it as unicode, so it continues on, then tries to split it up as a reducible type, which then repeats the process because it is a unicode string (which is iterable). So this will recurse indefinitely for any input when you iterate over it, you get the same type of object.



---

archive/issue_comments_342731.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nI made #23323 for the Cartan problem",
    "created_at": "2017-06-23T16:52:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22945#issuecomment-342731",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:8" align="right">comment:8</div>

I made #23323 for the Cartan problem



---

archive/issue_comments_342732.json:
```json
{
    "body": "Replying to [ticket:22945 chapoton]:\n> trying to move forward using unicode_literals and see what happens\n\nLooking at #23372, I don't think that it makes sense to support `unicode_literals` everywhere. In functions which do non-trivial text handling, unicode should be supported. But for simple things like `QQ[u'x']`, I don't see the point.",
    "created_at": "2017-07-07T13:27:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22945#issuecomment-342732",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [ticket:22945 chapoton]:
> trying to move forward using unicode_literals and see what happens

Looking at #23372, I don't think that it makes sense to support `unicode_literals` everywhere. In functions which do non-trivial text handling, unicode should be supported. But for simple things like `QQ[u'x']`, I don't see the point.



---

archive/issue_comments_342733.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nindeed. We should rather fix #14153 and #18370.",
    "created_at": "2017-07-07T13:29:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22945#issuecomment-342733",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:10" align="right">comment:10</div>

indeed. We should rather fix #14153 and #18370.



---

archive/issue_events_320014.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-10-22T19:01:06Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/22945",
    "milestone_number": null,
    "milestone_title": "sage-8.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22945#event-320014"
}
```



---

archive/issue_events_320015.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-10-22T19:01:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22945",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22945#event-320015"
}
```



---

archive/issue_events_320016.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-10-22T19:01:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22945",
    "label": "https://github.com/sagemath/sage/labels/invalid",
    "label_color": "a6a6a6",
    "label_name": "invalid",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22945#event-320016"
}
```



---

archive/issue_comments_342734.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nI propose to close this one as invalid. It does not make much sense to force unicode literals everywhere.",
    "created_at": "2017-10-22T19:01:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/22945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/22945#issuecomment-342734",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:11" align="right">comment:11</div>

I propose to close this one as invalid. It does not make much sense to force unicode literals everywhere.



---

archive/issue_events_320017.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-10-22T19:01:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22945",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22945#event-320017"
}
```



---

archive/issue_events_320018.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-10-22T19:22:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/22945",
    "label": "https://github.com/sagemath/sage/labels/wontfix",
    "label_color": "a6a6a6",
    "label_name": "wontfix",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22945#event-320018"
}
```



---

archive/issue_events_320019.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-10-22T19:22:13Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/22945",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22945#event-320019"
}
```



---

archive/issue_events_320020.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-10-22T19:22:13Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/22945",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/22945#event-320020"
}
```
