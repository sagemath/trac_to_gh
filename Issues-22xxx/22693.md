# Issue 22693: LatticePoset: Antidoubling, part 2

archive/issues_022456.json:
```json
{
    "body": "This patch adds a backend function to see if a lattice is constructible with Alan Day's doubling construction of convex subsets.\n\nTo be added to frontend #22648 later.\n\nCC:  @mantepse @tscrim\n\nBranch/Commit: [8597c98fcf5866ad8c1759cfee296cab19b2328c](https://github.com/sagemath/sagetrac-mirror/commit/8597c98fcf5866ad8c1759cfee296cab19b2328c)\n\nReviewer: Travis Scrimshaw\n\nAuthor: Jori M\u00e4ntysalo\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/22693\n\n",
    "closed_at": "2017-04-23T12:57:51Z",
    "created_at": "2017-03-28T04:12:55Z",
    "labels": [
        "component: combinatorics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.0",
    "title": "LatticePoset: Antidoubling, part 2",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22693",
    "user": "https://github.com/jm58660"
}
```
This patch adds a backend function to see if a lattice is constructible with Alan Day's doubling construction of convex subsets.

To be added to frontend #22648 later.

CC:  @mantepse @tscrim

Branch/Commit: [8597c98fcf5866ad8c1759cfee296cab19b2328c](https://github.com/sagemath/sagetrac-mirror/commit/8597c98fcf5866ad8c1759cfee296cab19b2328c)

Reviewer: Travis Scrimshaw

Author: Jori MÃ¤ntysalo

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/22693





---

archive/issue_comments_425543.json:
```json
{
    "body": "Changing branch from \"\" to \"u/jmantysalo/antidoubling-part-2\"",
    "created_at": "2017-03-28T04:13:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22693#issuecomment-425543",
    "user": "https://github.com/jm58660"
}
```

Changing branch from "" to "u/jmantysalo/antidoubling-part-2"



---

archive/issue_comments_425544.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-03-28T04:14:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22693#issuecomment-425544",
    "user": "https://github.com/jm58660"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_425545.json:
```json
{
    "body": "Changing commit from \"\" to \"79faf902d860d1a19091d9906a7da01a18440a41\"",
    "created_at": "2017-03-28T04:14:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22693#issuecomment-425545",
    "user": "https://github.com/jm58660"
}
```

Changing commit from "" to "79faf902d860d1a19091d9906a7da01a18440a41"



---

archive/issue_comments_425546.json:
```json
{
    "body": "<a id='comment:2'></a>\nNew commits:\n|                                                                                                                                          |                                  |\n|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------|\n|[79faf90](https://github.com/sagemath/sagetrac-mirror/commit/79faf902d860d1a19091d9906a7da01a18440a41)|`Another \"antidoubling\" function.`|",
    "created_at": "2017-03-28T04:14:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22693#issuecomment-425546",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:2'></a>
New commits:
|                                                                                                                                          |                                  |
|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------|
|[79faf90](https://github.com/sagemath/sagetrac-mirror/commit/79faf902d860d1a19091d9906a7da01a18440a41)|`Another "antidoubling" function.`|



---

archive/issue_comments_425547.json:
```json
{
    "body": "<a id='comment:3'></a>\nArghs, the example is incorrect. Example from http://www.math.hawaii.edu/~jb/inflation.pdf page 8 shows how to construct a lattice by doubling a non-convex set (\"Reppe's lattice\"), but begins with a 9-element lattice that is *not* constructible by any doubling.",
    "created_at": "2017-03-30T04:55:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22693#issuecomment-425547",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:3'></a>
Arghs, the example is incorrect. Example from http://www.math.hawaii.edu/~jb/inflation.pdf page 8 shows how to construct a lattice by doubling a non-convex set ("Reppe's lattice"), but begins with a 9-element lattice that is *not* constructible by any doubling.



---

archive/issue_comments_425548.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-03-30T04:55:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22693#issuecomment-425548",
    "user": "https://github.com/jm58660"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_425549.json:
```json
{
    "body": "<a id='comment:4'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                  |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------|\n|[a80e877](https://github.com/sagemath/sagetrac-mirror/commit/a80e877f130d8fcfd18213d2d9bac2de1447942c)|`Correct example.`|",
    "created_at": "2017-03-30T07:37:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22693#issuecomment-425549",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                  |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------|
|[a80e877](https://github.com/sagemath/sagetrac-mirror/commit/a80e877f130d8fcfd18213d2d9bac2de1447942c)|`Correct example.`|



---

archive/issue_comments_425550.json:
```json
{
    "body": "Changing commit from \"79faf902d860d1a19091d9906a7da01a18440a41\" to \"a80e877f130d8fcfd18213d2d9bac2de1447942c\"",
    "created_at": "2017-03-30T07:37:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22693#issuecomment-425550",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "79faf902d860d1a19091d9906a7da01a18440a41" to "a80e877f130d8fcfd18213d2d9bac2de1447942c"



---

archive/issue_comments_425551.json:
```json
{
    "body": "<a id='comment:5'></a>\nNow a correct example. It is done with\n\n```\nL = Posets.BooleanLattice(3)\nL = L.day_doubling([1,3])\n\ndef double_no_check(self, S):\n    S_ = [self._element_to_vertex(e) for e in S]\n\n    g = self.hasse_diagram()\n    g.relabel(lambda e: (e, 0))\n\n    for e in S:\n        g.add_edge((e, 0), (e, 1))\n        for e_up in self.upper_covers(e):\n            if e_up in S:\n                g.add_edge((e, 1), (e_up, 1))\n            else:\n                g.delete_edge((e, 0), (e_up, 0))\n                g.add_edge((e, 1), (e_up, 0))\n\n    return LatticePoset(g)\n\nL = double_no_check(L, [(3, 1), (6, 0), (2, 0), (5, 0), (1, 1), (4, 0)])\n```\n\nwhere `(3, 0)` shows that the subset to double is not convex.\n\nI may be that there is no smaller example of a lattice costructible by doublings of some subset but not constructible by doublings of convex subset.",
    "created_at": "2017-03-30T07:43:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22693#issuecomment-425551",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:5'></a>
Now a correct example. It is done with

```
L = Posets.BooleanLattice(3)
L = L.day_doubling([1,3])

def double_no_check(self, S):
    S_ = [self._element_to_vertex(e) for e in S]

    g = self.hasse_diagram()
    g.relabel(lambda e: (e, 0))

    for e in S:
        g.add_edge((e, 0), (e, 1))
        for e_up in self.upper_covers(e):
            if e_up in S:
                g.add_edge((e, 1), (e_up, 1))
            else:
                g.delete_edge((e, 0), (e_up, 0))
                g.add_edge((e, 1), (e_up, 0))

    return LatticePoset(g)

L = double_no_check(L, [(3, 1), (6, 0), (2, 0), (5, 0), (1, 1), (4, 0)])
```

where `(3, 0)` shows that the subset to double is not convex.

I may be that there is no smaller example of a lattice costructible by doublings of some subset but not constructible by doublings of convex subset.



---

archive/issue_comments_425552.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-03-30T07:43:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22693#issuecomment-425552",
    "user": "https://github.com/jm58660"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_425553.json:
```json
{
    "body": "Changing commit from \"a80e877f130d8fcfd18213d2d9bac2de1447942c\" to \"ee37ec56626c5a48efdbb26e4658bede69a30db9\"",
    "created_at": "2017-04-03T06:48:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22693#issuecomment-425553",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "a80e877f130d8fcfd18213d2d9bac2de1447942c" to "ee37ec56626c5a48efdbb26e4658bede69a30db9"



---

archive/issue_comments_425554.json:
```json
{
    "body": "<a id='comment:6'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                         |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------|\n|[ee37ec5](https://github.com/sagemath/sagetrac-mirror/commit/ee37ec56626c5a48efdbb26e4658bede69a30db9)|`Merge branch 'develop' into t/22693/antidoubling-part-2`|",
    "created_at": "2017-04-03T06:48:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22693#issuecomment-425554",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                         |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------|
|[ee37ec5](https://github.com/sagemath/sagetrac-mirror/commit/ee37ec56626c5a48efdbb26e4658bede69a30db9)|`Merge branch 'develop' into t/22693/antidoubling-part-2`|



---

archive/issue_comments_425555.json:
```json
{
    "body": "<a id='comment:7'></a>\nIs there something I can do to make reviewing easier?",
    "created_at": "2017-04-10T04:26:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22693#issuecomment-425555",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:7'></a>
Is there something I can do to make reviewing easier?



---

archive/issue_comments_425556.json:
```json
{
    "body": "<a id='comment:8'></a>\nTravis? The code is quite direct implementation from the paper.",
    "created_at": "2017-04-19T05:56:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22693#issuecomment-425556",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:8'></a>
Travis? The code is quite direct implementation from the paper.



---

archive/issue_comments_425557.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Travis Scrimshaw\"",
    "created_at": "2017-04-19T15:26:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22693#issuecomment-425557",
    "user": "https://github.com/tscrim"
}
```

Changing reviewer from "" to "Travis Scrimshaw"



---

archive/issue_comments_425558.json:
```json
{
    "body": "<a id='comment:9'></a>\nOne little thing:\n\n```diff\n-                for ji in congs_ji[cong]:\n-                    if self.is_lequal(ji, mi):\n-                        return False\n+                if any(self.is_lequal(ji, mi) for ji in congs_ji[cong]):\n+                    return False\n```\nIMO this is cleaner (and I think it might be marginally faster). Otherwise LGTM.",
    "created_at": "2017-04-19T15:26:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22693#issuecomment-425558",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:9'></a>
One little thing:

```diff
-                for ji in congs_ji[cong]:
-                    if self.is_lequal(ji, mi):
-                        return False
+                if any(self.is_lequal(ji, mi) for ji in congs_ji[cong]):
+                    return False
```
IMO this is cleaner (and I think it might be marginally faster). Otherwise LGTM.



---

archive/issue_comments_425559.json:
```json
{
    "body": "<a id='comment:10'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                         |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------|\n|[cf697dd](https://github.com/sagemath/sagetrac-mirror/commit/cf697ddc307a98ad40296d75ebd27b286681180e)|`Merge branch 'develop' into t/22693/antidoubling-part-2`|\n|[8597c98](https://github.com/sagemath/sagetrac-mirror/commit/8597c98fcf5866ad8c1759cfee296cab19b2328c)|`for-loop to any-clause.`|",
    "created_at": "2017-04-19T16:39:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22693#issuecomment-425559",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                         |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------|
|[cf697dd](https://github.com/sagemath/sagetrac-mirror/commit/cf697ddc307a98ad40296d75ebd27b286681180e)|`Merge branch 'develop' into t/22693/antidoubling-part-2`|
|[8597c98](https://github.com/sagemath/sagetrac-mirror/commit/8597c98fcf5866ad8c1759cfee296cab19b2328c)|`for-loop to any-clause.`|



---

archive/issue_comments_425560.json:
```json
{
    "body": "Changing commit from \"ee37ec56626c5a48efdbb26e4658bede69a30db9\" to \"8597c98fcf5866ad8c1759cfee296cab19b2328c\"",
    "created_at": "2017-04-19T16:39:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22693#issuecomment-425560",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "ee37ec56626c5a48efdbb26e4658bede69a30db9" to "8597c98fcf5866ad8c1759cfee296cab19b2328c"



---

archive/issue_comments_425561.json:
```json
{
    "body": "<a id='comment:11'></a>\nReplying to [tscrim](#comment%3A9):\n> One little thing:\n\n\nDone. (And tested, just to be sure...)",
    "created_at": "2017-04-20T04:07:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22693#issuecomment-425561",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:11'></a>
Replying to [tscrim](#comment%3A9):
> One little thing:


Done. (And tested, just to be sure...)



---

archive/issue_comments_425562.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-04-20T04:11:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22693#issuecomment-425562",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_425563.json:
```json
{
    "body": "<a id='comment:12'></a>\nThanks.",
    "created_at": "2017-04-20T04:11:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22693#issuecomment-425563",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:12'></a>
Thanks.



---

archive/issue_events_067249.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-04-23T12:57:51Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/22693",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22693#event-67249"
}
```



---

archive/issue_comments_425564.json:
```json
{
    "body": "Changing branch from \"u/jmantysalo/antidoubling-part-2\" to \"8597c98fcf5866ad8c1759cfee296cab19b2328c\"",
    "created_at": "2017-04-23T12:57:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22693#issuecomment-425564",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/jmantysalo/antidoubling-part-2" to "8597c98fcf5866ad8c1759cfee296cab19b2328c"



---

archive/issue_comments_425565.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-04-23T12:57:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22693#issuecomment-425565",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
