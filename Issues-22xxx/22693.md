# Issue 22693: LatticePoset: Antidoubling, part 2

archive/issues_022456.json:
```json
{
    "body": "This patch adds a backend function to see if a lattice is constructible with Alan Day's doubling construction of convex subsets.\n\nTo be added to frontend #22648 later.\n\nCC:  @mantepse @tscrim\n\nBranch/Commit: 8597c98fcf5866ad8c1759cfee296cab19b2328c\n\nReviewer: Travis Scrimshaw\n\nAuthor: Jori M\u00e4ntysalo\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/22693\n\n",
    "closed_at": "2017-04-23T12:57:51Z",
    "created_at": "2017-03-28T04:12:55Z",
    "labels": [
        "component: combinatorics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.0",
    "title": "LatticePoset: Antidoubling, part 2",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22693",
    "user": "https://github.com/jm58660"
}
```
This patch adds a backend function to see if a lattice is constructible with Alan Day's doubling construction of convex subsets.

To be added to frontend #22648 later.

CC:  @mantepse @tscrim

Branch/Commit: 8597c98fcf5866ad8c1759cfee296cab19b2328c

Reviewer: Travis Scrimshaw

Author: Jori MÃ¤ntysalo

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/22693





---

archive/issue_comments_312558.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-03-28T04:14:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22693#issuecomment-312558",
    "user": "https://github.com/jm58660"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_312559.json:
```json
{
    "body": "<a id='comment:2'></a>New commits:",
    "created_at": "2017-03-28T04:14:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22693#issuecomment-312559",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:2'></a>New commits:



---

archive/issue_comments_312560.json:
```json
{
    "body": "<a id='comment:3'></a>Arghs, the example is incorrect. Example from http://www.math.hawaii.edu/~jb/inflation.pdf page 8 shows how to construct a lattice by doubling a non-convex set (\"Reppe's lattice\"), but begins with a 9-element lattice that is *not* constructible by any doubling.",
    "created_at": "2017-03-30T04:55:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22693#issuecomment-312560",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:3'></a>Arghs, the example is incorrect. Example from http://www.math.hawaii.edu/~jb/inflation.pdf page 8 shows how to construct a lattice by doubling a non-convex set ("Reppe's lattice"), but begins with a 9-element lattice that is *not* constructible by any doubling.



---

archive/issue_comments_312561.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-03-30T04:55:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22693#issuecomment-312561",
    "user": "https://github.com/jm58660"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_312562.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-03-30T07:37:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22693#issuecomment-312562",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_312563.json:
```json
{
    "body": "<a id='comment:5'></a>Now a correct example. It is done with\n\n```\nL = Posets.BooleanLattice(3)\nL = L.day_doubling([1,3])\n\ndef double_no_check(self, S):\n    S_ = [self._element_to_vertex(e) for e in S]\n\n    g = self.hasse_diagram()\n    g.relabel(lambda e: (e, 0))\n\n    for e in S:\n        g.add_edge((e, 0), (e, 1))\n        for e_up in self.upper_covers(e):\n            if e_up in S:\n                g.add_edge((e, 1), (e_up, 1))\n            else:\n                g.delete_edge((e, 0), (e_up, 0))\n                g.add_edge((e, 1), (e_up, 0))\n\n    return LatticePoset(g)\n\nL = double_no_check(L, [(3, 1), (6, 0), (2, 0), (5, 0), (1, 1), (4, 0)])\n```\n\nwhere `(3, 0)` shows that the subset to double is not convex.\n\nI may be that there is no smaller example of a lattice costructible by doublings of some subset but not constructible by doublings of convex subset.",
    "created_at": "2017-03-30T07:43:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22693#issuecomment-312563",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:5'></a>Now a correct example. It is done with

```
L = Posets.BooleanLattice(3)
L = L.day_doubling([1,3])

def double_no_check(self, S):
    S_ = [self._element_to_vertex(e) for e in S]

    g = self.hasse_diagram()
    g.relabel(lambda e: (e, 0))

    for e in S:
        g.add_edge((e, 0), (e, 1))
        for e_up in self.upper_covers(e):
            if e_up in S:
                g.add_edge((e, 1), (e_up, 1))
            else:
                g.delete_edge((e, 0), (e_up, 0))
                g.add_edge((e, 1), (e_up, 0))

    return LatticePoset(g)

L = double_no_check(L, [(3, 1), (6, 0), (2, 0), (5, 0), (1, 1), (4, 0)])
```

where `(3, 0)` shows that the subset to double is not convex.

I may be that there is no smaller example of a lattice costructible by doublings of some subset but not constructible by doublings of convex subset.



---

archive/issue_comments_312564.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-03-30T07:43:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22693#issuecomment-312564",
    "user": "https://github.com/jm58660"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_312565.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-04-03T06:48:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22693#issuecomment-312565",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_312566.json:
```json
{
    "body": "<a id='comment:7'></a>Is there something I can do to make reviewing easier?",
    "created_at": "2017-04-10T04:26:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22693#issuecomment-312566",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:7'></a>Is there something I can do to make reviewing easier?



---

archive/issue_comments_312567.json:
```json
{
    "body": "<a id='comment:8'></a>Travis? The code is quite direct implementation from the paper.",
    "created_at": "2017-04-19T05:56:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22693#issuecomment-312567",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:8'></a>Travis? The code is quite direct implementation from the paper.



---

archive/issue_comments_312568.json:
```json
{
    "body": "<a id='comment:9'></a>One little thing:\n\n```diff\n-                for ji in congs_ji[cong]:\n-                    if self.is_lequal(ji, mi):\n-                        return False\n+                if any(self.is_lequal(ji, mi) for ji in congs_ji[cong]):\n+                    return False\n```\nIMO this is cleaner (and I think it might be marginally faster). Otherwise LGTM.",
    "created_at": "2017-04-19T15:26:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22693#issuecomment-312568",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:9'></a>One little thing:

```diff
-                for ji in congs_ji[cong]:
-                    if self.is_lequal(ji, mi):
-                        return False
+                if any(self.is_lequal(ji, mi) for ji in congs_ji[cong]):
+                    return False
```
IMO this is cleaner (and I think it might be marginally faster). Otherwise LGTM.



---

archive/issue_comments_312569.json:
```json
{
    "body": "<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-04-19T16:39:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22693#issuecomment-312569",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_312570.json:
```json
{
    "body": "<a id='comment:11'></a>Replying to [comment:9 tscrim]:\n> One little thing:\n\n\nDone. (And tested, just to be sure...)",
    "created_at": "2017-04-20T04:07:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22693#issuecomment-312570",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:11'></a>Replying to [comment:9 tscrim]:
> One little thing:


Done. (And tested, just to be sure...)



---

archive/issue_comments_312571.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-04-20T04:11:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22693#issuecomment-312571",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_312572.json:
```json
{
    "body": "<a id='comment:12'></a>Thanks.",
    "created_at": "2017-04-20T04:11:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22693#issuecomment-312572",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:12'></a>Thanks.



---

archive/issue_events_059138.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-04-23T12:57:51Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/22693",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22693#event-59138"
}
```



---

archive/issue_comments_312573.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-04-23T12:57:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22693#issuecomment-312573",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
