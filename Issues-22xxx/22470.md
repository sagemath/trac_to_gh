# Issue 22470: Replace _pari_ -> __pari__

archive/issues_022233.json:
```json
{
    "body": "Special methods in Python usually have double leading and trailing underscores. For this reason, it makes sense to use `__pari__` for conversion to CyPari2.\n\nCC:  @defeo @videlec\n\nReviewer: Luca De Feo\n\nAuthor: Jeroen Demeyer\n\nBranch: ab2c895b5e8a817ce6670ecdfedf79ce20390a87\n\nCommit: ab2c895b5e8a817ce6670ecdfedf79ce20390a87\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/22470\n\n",
    "closed_at": "2017-03-27T20:42:16Z",
    "created_at": "2017-02-28T11:03:34Z",
    "labels": [
        "component: interfaces"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.6",
    "title": "Replace _pari_ -> __pari__",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22470",
    "user": "https://github.com/jdemeyer"
}
```
Special methods in Python usually have double leading and trailing underscores. For this reason, it makes sense to use `__pari__` for conversion to CyPari2.

CC:  @defeo @videlec

Reviewer: Luca De Feo

Author: Jeroen Demeyer

Branch: ab2c895b5e8a817ce6670ecdfedf79ce20390a87

Commit: ab2c895b5e8a817ce6670ecdfedf79ce20390a87

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/22470





---

archive/issue_comments_308627.json:
```json
{
    "body": "<a id='comment:1'></a>One reason for double underscore is that they correspond to actual implementation of special Python syntax\n- `a.__len__()` is `len(a)`\n- `a.__add__(b)` is `a + b`\n- etc\n\nDo you have an actual reference for why we have to switch fron one to two underscores?",
    "created_at": "2017-02-28T12:13:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22470#issuecomment-308627",
    "user": "https://github.com/videlec"
}
```

<a id='comment:1'></a>One reason for double underscore is that they correspond to actual implementation of special Python syntax
- `a.__len__()` is `len(a)`
- `a.__add__(b)` is `a + b`
- etc

Do you have an actual reference for why we have to switch fron one to two underscores?



---

archive/issue_comments_308628.json:
```json
{
    "body": "<a id='comment:2'></a>Aren't those double-underscore identifiers reserved for use by Python itself?",
    "created_at": "2017-02-28T12:13:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22470#issuecomment-308628",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:2'></a>Aren't those double-underscore identifiers reserved for use by Python itself?



---

archive/issue_comments_308629.json:
```json
{
    "body": "<a id='comment:3'></a>Replying to [comment:2 mmezzarobba]:\n> Aren't those double-underscore identifiers reserved for use by Python itself?\n\n\nDo you have a reference for that? There is something about underscores in [PEP 8](https://www.python.org/dev/peps/pep-0008/#id36) but, after reading it, I still don't know which underscore style to use. And the Sage `_foo_` style doesn't even exist for PEP 8.\n\nThere is some more in https://docs.python.org/3/reference/lexical_analysis.html#reserved-classes-of-identifiers but again it's not really clear.",
    "created_at": "2017-02-28T12:56:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22470#issuecomment-308629",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:3'></a>Replying to [comment:2 mmezzarobba]:
> Aren't those double-underscore identifiers reserved for use by Python itself?


Do you have a reference for that? There is something about underscores in [PEP 8](https://www.python.org/dev/peps/pep-0008/#id36) but, after reading it, I still don't know which underscore style to use. And the Sage `_foo_` style doesn't even exist for PEP 8.

There is some more in https://docs.python.org/3/reference/lexical_analysis.html#reserved-classes-of-identifiers but again it's not really clear.



---

archive/issue_comments_308630.json:
```json
{
    "body": "<a id='comment:4'></a>In order to defend `__pari__`: that's also the style used by NumPy, which defines special methods like `__array__`.",
    "created_at": "2017-02-28T13:02:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22470#issuecomment-308630",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:4'></a>In order to defend `__pari__`: that's also the style used by NumPy, which defines special methods like `__array__`.



---

archive/issue_comments_308631.json:
```json
{
    "body": "<a id='comment:5'></a>Replying to [comment:3 jdemeyer]:\n> Replying to [comment:2 mmezzarobba]:\n> > Aren't those double-underscore identifiers reserved for use by Python itself?\n\n> \n> Do you have a reference for that?\n\n\nhttps://docs.python.org/2/reference/lexical_analysis.html#reserved-classes-of-identifiers\nsays:\n\n> `__*__`\n>     System-defined names. These names are defined by the interpreter and its implementation (including the standard library). Current system names are discussed in the Special method names section and elsewhere. More will likely be defined in future versions of Python. Any use of __*__ names, in any context, that does not follow explicitly documented use, is subject to breakage without warning.",
    "created_at": "2017-02-28T13:07:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22470#issuecomment-308631",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:5'></a>Replying to [comment:3 jdemeyer]:
> Replying to [comment:2 mmezzarobba]:
> > Aren't those double-underscore identifiers reserved for use by Python itself?

> 
> Do you have a reference for that?


https://docs.python.org/2/reference/lexical_analysis.html#reserved-classes-of-identifiers
says:

> `__*__`
>     System-defined names. These names are defined by the interpreter and its implementation (including the standard library). Current system names are discussed in the Special method names section and elsewhere. More will likely be defined in future versions of Python. Any use of __*__ names, in any context, that does not follow explicitly documented use, is subject to breakage without warning.



---

archive/issue_comments_308632.json:
```json
{
    "body": "<a id='comment:6'></a>Replying to [comment:1 vdelecroix]:\n> One reason for double underscore is that they correspond to actual implementation of special Python syntax\n> - `a.__len__()` is `len(a)`\n> - `a.__add__(b)` is `a + b`\n> - etc\n\n\nOne could argue that `x.__pari__()` is `pari(x)` that's not really relevant.\n\nSpecial methods in Python use the `__foo__` underscore style. I consider `__pari__` to be very similar in spirit to Python's `__int__` or NumPy's `__array__`. Since no PEP or Python documentation documents how to name custom special methods, I think that `__pari__` makes the most sense.",
    "created_at": "2017-02-28T13:13:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22470#issuecomment-308632",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:6'></a>Replying to [comment:1 vdelecroix]:
> One reason for double underscore is that they correspond to actual implementation of special Python syntax
> - `a.__len__()` is `len(a)`
> - `a.__add__(b)` is `a + b`
> - etc


One could argue that `x.__pari__()` is `pari(x)` that's not really relevant.

Special methods in Python use the `__foo__` underscore style. I consider `__pari__` to be very similar in spirit to Python's `__int__` or NumPy's `__array__`. Since no PEP or Python documentation documents how to name custom special methods, I think that `__pari__` makes the most sense.



---

archive/issue_comments_308633.json:
```json
{
    "body": "<a id='comment:7'></a>Let's look at our options:\n\n1. `_pari_()`: not documented/used anywhere except for Sage.\n\n2. `_pari()`: meant for *private* methods, which is not correct here. We want this method to be part of the CyPari2 public API.\n\n3. `__pari()`: even more private, so even less applicable.\n\n4. `__pari__()`: consistent with Python and NumPy. The only issue is that creating such names possibly goes against the Python documentation.\n\n5. `pari()`: very simple but it doesn't make it clear that it has a special meaning. Higher chance of false positives with people using a `pari()` method for something else.",
    "created_at": "2017-02-28T13:23:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22470#issuecomment-308633",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:7'></a>Let's look at our options:

1. `_pari_()`: not documented/used anywhere except for Sage.

2. `_pari()`: meant for *private* methods, which is not correct here. We want this method to be part of the CyPari2 public API.

3. `__pari()`: even more private, so even less applicable.

4. `__pari__()`: consistent with Python and NumPy. The only issue is that creating such names possibly goes against the Python documentation.

5. `pari()`: very simple but it doesn't make it clear that it has a special meaning. Higher chance of false positives with people using a `pari()` method for something else.



---

archive/issue_comments_308634.json:
```json
{
    "body": "<a id='comment:8'></a>for me it the match is between 2 and 4. But it concerns more than just pari (e.g. magma, maxima, gap and such). What about having the discussion on sage-devel?",
    "created_at": "2017-02-28T15:46:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22470#issuecomment-308634",
    "user": "https://github.com/videlec"
}
```

<a id='comment:8'></a>for me it the match is between 2 and 4. But it concerns more than just pari (e.g. magma, maxima, gap and such). What about having the discussion on sage-devel?



---

archive/issue_comments_308635.json:
```json
{
    "body": "<a id='comment:9'></a>Replying to [comment:8 vdelecroix]:\n> for me it the match is between 2 and 4.\n\n\nMy first choice is 4, my second choice would be 5.\n\n> But it concerns more than just pari (e.g. magma, maxima, gap and such).\n\n\nRight, but we do not have to change everything at the same time. We can do this for each interface separately. I just wanted to do this for `_pari_` now because of CyPari2.\n\n> What about having the discussion on sage-devel?\n\n\nI could try...",
    "created_at": "2017-02-28T15:59:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22470#issuecomment-308635",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:9'></a>Replying to [comment:8 vdelecroix]:
> for me it the match is between 2 and 4.


My first choice is 4, my second choice would be 5.

> But it concerns more than just pari (e.g. magma, maxima, gap and such).


Right, but we do not have to change everything at the same time. We can do this for each interface separately. I just wanted to do this for `_pari_` now because of CyPari2.

> What about having the discussion on sage-devel?


I could try...



---

archive/issue_comments_308636.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-02-28T16:28:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22470#issuecomment-308636",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_308637.json:
```json
{
    "body": "<a id='comment:11'></a>E-mail to `sage-devel` sent...\n\n---\nLast 10 new commits:",
    "created_at": "2017-02-28T16:28:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22470#issuecomment-308637",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:11'></a>E-mail to `sage-devel` sent...

---
Last 10 new commits:



---

archive/issue_comments_308638.json:
```json
{
    "body": "<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-03-01T08:39:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22470#issuecomment-308638",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_308639.json:
```json
{
    "body": "<a id='comment:13'></a>On my sage-devel post, I don't see much objections to `__pari__`. But people are stressing backwards-compatibility, so I will take care of that.",
    "created_at": "2017-03-01T18:58:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22470#issuecomment-308639",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:13'></a>On my sage-devel post, I don't see much objections to `__pari__`. But people are stressing backwards-compatibility, so I will take care of that.



---

archive/issue_comments_308640.json:
```json
{
    "body": "<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-03-01T19:32:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22470#issuecomment-308640",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_308641.json:
```json
{
    "body": "<a id='comment:15'></a>Replying to [comment:13 jdemeyer]:\n> On my sage-devel post, I don't see much objections to `__pari__`.\n\n\nThere is some though. I always find it hard to make a decision in these circumstances. I'm in favor of the change, but what should be considered as sufficient consensus?",
    "created_at": "2017-03-03T15:53:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22470#issuecomment-308641",
    "user": "https://github.com/defeo"
}
```

<a id='comment:15'></a>Replying to [comment:13 jdemeyer]:
> On my sage-devel post, I don't see much objections to `__pari__`.


There is some though. I always find it hard to make a decision in these circumstances. I'm in favor of the change, but what should be considered as sufficient consensus?



---

archive/issue_comments_308642.json:
```json
{
    "body": "<a id='comment:16'></a>Replying to [comment:15 defeo]:\n> what should be considered as sufficient consensus?\n\n\nI don't feel like I should answer this question, since I am too much biased in favour of `__pari__`.\n\nAt least the objections about backwards compatibility are taken care of with the last commit.",
    "created_at": "2017-03-03T21:09:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22470#issuecomment-308642",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:16'></a>Replying to [comment:15 defeo]:
> what should be considered as sufficient consensus?


I don't feel like I should answer this question, since I am too much biased in favour of `__pari__`.

At least the objections about backwards compatibility are taken care of with the last commit.



---

archive/issue_comments_308643.json:
```json
{
    "body": "<a id='comment:17'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-03-14T23:09:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22470#issuecomment-308643",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:17'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_308644.json:
```json
{
    "body": "<a id='comment:18'></a>After a lenghty discussion in https://groups.google.com/forum/#!topic/sage-devel/G1TuFbh0d-A, this ticket wins!",
    "created_at": "2017-03-17T13:58:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22470#issuecomment-308644",
    "user": "https://github.com/defeo"
}
```

<a id='comment:18'></a>After a lenghty discussion in https://groups.google.com/forum/#!topic/sage-devel/G1TuFbh0d-A, this ticket wins!



---

archive/issue_comments_308645.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-03-17T13:58:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22470#issuecomment-308645",
    "user": "https://github.com/defeo"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_058755.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-03-27T20:42:16Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/22470",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22470#event-58755"
}
```



---

archive/issue_comments_308646.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-03-27T20:42:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22470#issuecomment-308646",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
