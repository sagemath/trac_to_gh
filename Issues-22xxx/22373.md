# Issue 22373: Bug in Poset.is_slender(?)

archive/issues_022136.json:
```json
{
    "body": "\n\nCC:  @mezzarobba @jm58660\n\nBranch/Commit: [7608202b228c7d6ff5388d19632f415a575f13b1](https://github.com/sagemath/sagetrac-mirror/commit/7608202b228c7d6ff5388d19632f415a575f13b1)\n\nReviewer: Jori M\u00e4ntysalo, Fr\u00e9d\u00e9ric Chapoton\n\nAuthor: Marc Mezzarobba, Jori M\u00e4ntysalo, Fr\u00e9d\u00e9ric Chapoton\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/22373\n\n",
    "closed_at": "2017-03-27T20:42:30Z",
    "created_at": "2017-02-12T18:00:52Z",
    "labels": [
        "component: combinatorics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.6",
    "title": "Bug in Poset.is_slender(?)",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22373",
    "user": "https://github.com/jdemeyer"
}
```


CC:  @mezzarobba @jm58660

Branch/Commit: [7608202b228c7d6ff5388d19632f415a575f13b1](https://github.com/sagemath/sagetrac-mirror/commit/7608202b228c7d6ff5388d19632f415a575f13b1)

Reviewer: Jori Mäntysalo, Frédéric Chapoton

Author: Marc Mezzarobba, Jori Mäntysalo, Frédéric Chapoton

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/22373





---

archive/issue_comments_417508.json:
```json
{
    "body": "Changing branch from \"\" to \"u/jdemeyer/bug_in_poset_is_slender___\"",
    "created_at": "2017-02-12T18:07:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22373",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22373#issuecomment-417508",
    "user": "https://github.com/jdemeyer"
}
```

Changing branch from "" to "u/jdemeyer/bug_in_poset_is_slender___"



---

archive/issue_comments_417509.json:
```json
{
    "body": "<a id='comment:2'></a>\niteritems is not python3-compatible\n\nyou should rather use\n\n```\nfrom six import iteritems\nfor xx in iteritems(dd):\n    pass\n```\n\n---\nNew commits:\n|                                                                                                                                          |                            |\n|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------|\n|[90a31a1](https://github.com/sagemath/sagetrac-mirror/commit/90a31a1749d3314e2e3be44e952f7b69301b520d)|`Bug in Poset.is_slender(?)`|",
    "created_at": "2017-02-12T20:42:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22373",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22373#issuecomment-417509",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:2'></a>
iteritems is not python3-compatible

you should rather use

```
from six import iteritems
for xx in iteritems(dd):
    pass
```

---
New commits:
|                                                                                                                                          |                            |
|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------|
|[90a31a1](https://github.com/sagemath/sagetrac-mirror/commit/90a31a1749d3314e2e3be44e952f7b69301b520d)|`Bug in Poset.is_slender(?)`|



---

archive/issue_comments_417510.json:
```json
{
    "body": "Changing commit from \"\" to \"90a31a1749d3314e2e3be44e952f7b69301b520d\"",
    "created_at": "2017-02-12T20:42:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22373",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22373#issuecomment-417510",
    "user": "https://github.com/fchapoton"
}
```

Changing commit from "" to "90a31a1749d3314e2e3be44e952f7b69301b520d"



---

archive/issue_comments_417511.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-02-14T18:51:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22373",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22373#issuecomment-417511",
    "user": "https://github.com/mezzarobba"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_417512.json:
```json
{
    "body": "Changing branch from \"u/jdemeyer/bug_in_poset_is_slender___\" to \"u/mmezzarobba/22373-is_slender\"",
    "created_at": "2017-02-14T18:51:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22373",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22373#issuecomment-417512",
    "user": "https://github.com/mezzarobba"
}
```

Changing branch from "u/jdemeyer/bug_in_poset_is_slender___" to "u/mmezzarobba/22373-is_slender"



---

archive/issue_comments_417513.json:
```json
{
    "body": "Changing commit from \"90a31a1749d3314e2e3be44e952f7b69301b520d\" to \"47969450c6e7e449a126438d55fcdaf040a281ac\"",
    "created_at": "2017-02-14T18:51:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22373",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22373#issuecomment-417513",
    "user": "https://github.com/mezzarobba"
}
```

Changing commit from "90a31a1749d3314e2e3be44e952f7b69301b520d" to "47969450c6e7e449a126438d55fcdaf040a281ac"



---

archive/issue_comments_417514.json:
```json
{
    "body": "<a id='comment:4'></a>\nReplying to [chapoton](#comment%3A2):\n> iteritems is not python3-compatible\n\n\nFixed, thanks!\n\nWithout this patch, #22029 made one of the doctests of `is_slender()` fail.\nJori, can you tell if there was indeed a bug and perhaps how to add a test for the fix that would work even without #22029? Thanks!\n\n---\nNew commits:\n|                                                                                                                                          |                            |\n|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------|\n|[4796945](https://github.com/sagemath/sagetrac-mirror/commit/47969450c6e7e449a126438d55fcdaf040a281ac)|`Bug in Poset.is_slender(?)`|",
    "created_at": "2017-02-14T18:51:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22373",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22373#issuecomment-417514",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:4'></a>
Replying to [chapoton](#comment%3A2):
> iteritems is not python3-compatible


Fixed, thanks!

Without this patch, #22029 made one of the doctests of `is_slender()` fail.
Jori, can you tell if there was indeed a bug and perhaps how to add a test for the fix that would work even without #22029? Thanks!

---
New commits:
|                                                                                                                                          |                            |
|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------|
|[4796945](https://github.com/sagemath/sagetrac-mirror/commit/47969450c6e7e449a126438d55fcdaf040a281ac)|`Bug in Poset.is_slender(?)`|



---

archive/issue_comments_417515.json:
```json
{
    "body": "<a id='comment:5'></a>\nReplying to [mmezzarobba](#comment%3A4):\n\n> Without this patch, #22029 made one of the doctests of `is_slender()` fail.\n> Jori, can you tell if there was indeed a bug and perhaps how to add a test for the fix that would work even without #22029?\n\n\nWhat was the failing example?\n\nI would guess that the other patch shows some hidden bug in an example poset. That should be easy to spot, just make all the example posets with and without the patch and try\n\n```\nL.hasse_diagram().canonical_label().dig6_string()\n```",
    "created_at": "2017-02-15T04:54:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22373",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22373#issuecomment-417515",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:5'></a>
Replying to [mmezzarobba](#comment%3A4):

> Without this patch, #22029 made one of the doctests of `is_slender()` fail.
> Jori, can you tell if there was indeed a bug and perhaps how to add a test for the fix that would work even without #22029?


What was the failing example?

I would guess that the other patch shows some hidden bug in an example poset. That should be easy to spot, just make all the example posets with and without the patch and try

```
L.hasse_diagram().canonical_label().dig6_string()
```



---

archive/issue_comments_417516.json:
```json
{
    "body": "<a id='comment:6'></a>\nReplying to [jmantysalo](#comment%3A5):\n> What was the failing example?\n\n\nIt must have been the one with `certificate=True`, since my patch only touches the certificate. But I don't remember exactly which changes elsewhere made it fail.",
    "created_at": "2017-02-15T21:57:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22373",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22373#issuecomment-417516",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:6'></a>
Replying to [jmantysalo](#comment%3A5):
> What was the failing example?


It must have been the one with `certificate=True`, since my patch only touches the certificate. But I don't remember exactly which changes elsewhere made it fail.



---

archive/issue_comments_417517.json:
```json
{
    "body": "<a id='comment:7'></a>\nYes, I have been an idiot when doing the `certificate`-code. Test code:\n\n```\nset_random_seed(332211)\nD = Posets.DiamondPoset(5)._hasse_diagram\n\nfor i in range(100):\n    P = Posets.RandomPoset(randint(10, 20), 0.2)\n    if P.is_slender():\n        if P._hasse_diagram.subgraph_search(D) is not None:\n            print(\"Bug 1\")\n            break\n    else:\n        if P._hasse_diagram.subgraph_search(D) is None:\n            print(\"Bug 2\")\n            break\n        _, cert = P.is_slender(certificate=True)\n        P_ = P.subposet(P.interval(cert[0], cert[1]))\n        if P_.height() != 3:\n            print(\"Bug 3\")\n            break\n        if P_.cardinality() < 5:\n            print(\"Bug 4\")\n            break\nelse:\n    print(\"All OK\")\n```",
    "created_at": "2017-02-16T06:43:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22373",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22373#issuecomment-417517",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:7'></a>
Yes, I have been an idiot when doing the `certificate`-code. Test code:

```
set_random_seed(332211)
D = Posets.DiamondPoset(5)._hasse_diagram

for i in range(100):
    P = Posets.RandomPoset(randint(10, 20), 0.2)
    if P.is_slender():
        if P._hasse_diagram.subgraph_search(D) is not None:
            print("Bug 1")
            break
    else:
        if P._hasse_diagram.subgraph_search(D) is None:
            print("Bug 2")
            break
        _, cert = P.is_slender(certificate=True)
        P_ = P.subposet(P.interval(cert[0], cert[1]))
        if P_.height() != 3:
            print("Bug 3")
            break
        if P_.cardinality() < 5:
            print("Bug 4")
            break
else:
    print("All OK")
```



---

archive/issue_comments_417518.json:
```json
{
    "body": "<a id='comment:8'></a>\nHow should we define this to be on\n\n```\nLatticePoset({0: [1, 2, 3, 4], 1: [6], 2: [6], 3: [6], 4: [5], 5: [6]})\n```\n\n? I think that my test code has error, when I compare it to the definition in the docstring.",
    "created_at": "2017-02-16T13:55:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22373",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22373#issuecomment-417518",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:8'></a>
How should we define this to be on

```
LatticePoset({0: [1, 2, 3, 4], 1: [6], 2: [6], 3: [6], 4: [5], 5: [6]})
```

? I think that my test code has error, when I compare it to the definition in the docstring.



---

archive/issue_comments_417519.json:
```json
{
    "body": "Changing branch from \"u/mmezzarobba/22373-is_slender\" to \"public/22373\"",
    "created_at": "2017-03-15T17:00:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22373",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22373#issuecomment-417519",
    "user": "https://github.com/fchapoton"
}
```

Changing branch from "u/mmezzarobba/22373-is_slender" to "public/22373"



---

archive/issue_comments_417520.json:
```json
{
    "body": "Changing commit from \"47969450c6e7e449a126438d55fcdaf040a281ac\" to \"7608202b228c7d6ff5388d19632f415a575f13b1\"",
    "created_at": "2017-03-15T17:00:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22373",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22373#issuecomment-417520",
    "user": "https://github.com/fchapoton"
}
```

Changing commit from "47969450c6e7e449a126438d55fcdaf040a281ac" to "7608202b228c7d6ff5388d19632f415a575f13b1"



---

archive/issue_comments_417521.json:
```json
{
    "body": "<a id='comment:9'></a>\nI added a doctest, currently return the wrong answer 5.\n\nI also changed six.iteritems to iteritems in the full file.\n\n---\nNew commits:\n|                                                                                                                                          |                                                          |\n|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------|\n|[6feb62f](https://github.com/sagemath/sagetrac-mirror/commit/6feb62faa5e936b4a55f7dc9f084af328ba61ec9)|`Merge branch 'u/mmezzarobba/22373-is_slender' in 7.6.rc0`|\n|[7608202](https://github.com/sagemath/sagetrac-mirror/commit/7608202b228c7d6ff5388d19632f415a575f13b1)|`trac 22373 adding a doctest`|",
    "created_at": "2017-03-15T17:00:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22373",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22373#issuecomment-417521",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:9'></a>
I added a doctest, currently return the wrong answer 5.

I also changed six.iteritems to iteritems in the full file.

---
New commits:
|                                                                                                                                          |                                                          |
|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------|
|[6feb62f](https://github.com/sagemath/sagetrac-mirror/commit/6feb62faa5e936b4a55f7dc9f084af328ba61ec9)|`Merge branch 'u/mmezzarobba/22373-is_slender' in 7.6.rc0`|
|[7608202](https://github.com/sagemath/sagetrac-mirror/commit/7608202b228c7d6ff5388d19632f415a575f13b1)|`trac 22373 adding a doctest`|



---

archive/issue_comments_417522.json:
```json
{
    "body": "<a id='comment:10'></a>\nok, green bot. Looks good to me. Jori, if you agree, you can set to positive.",
    "created_at": "2017-03-16T07:18:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22373",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22373#issuecomment-417522",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:10'></a>
ok, green bot. Looks good to me. Jori, if you agree, you can set to positive.



---

archive/issue_comments_417523.json:
```json
{
    "body": "<a id='comment:11'></a>\nReplying to [chapoton](#comment%3A10):\n> ok, green bot. Looks good to me. Jori, if you agree, you can set to positive.\n\n\nYes, seems to be OK.",
    "created_at": "2017-03-16T08:43:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22373",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22373#issuecomment-417523",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:11'></a>
Replying to [chapoton](#comment%3A10):
> ok, green bot. Looks good to me. Jori, if you agree, you can set to positive.


Yes, seems to be OK.



---

archive/issue_comments_417524.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-03-16T08:43:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22373",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22373#issuecomment-417524",
    "user": "https://github.com/jm58660"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_417525.json:
```json
{
    "body": "Changing author from \"Marc Mezzarobba\" to \"Marc Mezzarobba, Jori M\u00e4ntysalo, Fr\u00e9d\u00e9ric Chapoton\"",
    "created_at": "2017-03-16T13:26:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22373",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22373#issuecomment-417525",
    "user": "https://github.com/mezzarobba"
}
```

Changing author from "Marc Mezzarobba" to "Marc Mezzarobba, Jori Mäntysalo, Frédéric Chapoton"



---

archive/issue_comments_417526.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Jori M\u00e4ntysalo, Fr\u00e9d\u00e9ric Chapoton\"",
    "created_at": "2017-03-16T13:26:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22373",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22373#issuecomment-417526",
    "user": "https://github.com/mezzarobba"
}
```

Changing reviewer from "" to "Jori Mäntysalo, Frédéric Chapoton"



---

archive/issue_comments_417527.json:
```json
{
    "body": "Changing branch from \"public/22373\" to \"7608202b228c7d6ff5388d19632f415a575f13b1\"",
    "created_at": "2017-03-27T20:42:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22373",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22373#issuecomment-417527",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "public/22373" to "7608202b228c7d6ff5388d19632f415a575f13b1"



---

archive/issue_comments_417528.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-03-27T20:42:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22373",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22373#issuecomment-417528",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_066630.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-03-27T20:42:30Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/22373",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22373#event-66630"
}
```
